import{aw as X,aK as x,b0 as K,b1 as P,b2 as gi,b3 as Vo,b4 as Ye,b5 as xs,b6 as Rs,b7 as Ds,b8 as fi,af as pi,A as pe,b9 as te,ba as Ls,bb as Es,aN as Os,az as M,as as F,bc as Vs,aL as L,bd as g,be as U,bf as H,aU as tt,bg as Nn,bh as N,bi as ke,bj as ie,bk as re,bl as le,bm as R,aO as se,bn as Pe,aD as y,bo as Ke,bp as C,bq as mi,ak as Ee,a6 as mt,ao as I,br as It,bs as vi,bt as Ps,bu as ks,bv as Ms,bw as Bs,bx as As,an as ze,aI as Fs,aB as z,u as st,by as Pt,H as yi,bz as Be,bA as vt,E as Ns,n as $s,Y as Us,I as Hs,B as Ws,aj as Po,bB as be,aE as qt,aq as ae,aQ as ee,aC as $n,aA as ct,bC as j,ap as fe,bD as ne,bE as nt,bF as At,bG as $e,aH as we,aF as zs,K as Xn,ay as qn,bH as wi,aY as Ft,bI as Si,bJ as js,bK as Gs,bL as Xs,bM as _i,bN as qs,V as Ys,bO as Ks,bP as Qs,bQ as Zs,bR as Js,aG as er,bS as tr,aZ as nr,bT as or,aS as Ae,bU as ir,bV as ar,bW as sr,bX as rr,bY as lr,aT as Ci,bZ as bi,b_ as cr,b$ as ur,c0 as dr,c1 as hr,c2 as gr,c3 as fr,c4 as pr}from"./vendor-48013226.js";import{_ as A,E as Yn,V as yt,a as Ti,b as pt,c as hn,d as kt,e as ko,f as Un,g as Ii,h as xi,i as Yt,u as Kn,j as wt,k as Mo,l as mr,m as vr,n as yr,o as wr,p as Ri,q as Di,r as gt,s as Bo,T as mn,t as Nt,v as Ze,w as De,x as Sr,y as _r,z as Cr,A as Pn,B as br,M as Ao,C as Tr}from"./vuetify-f7bbfc1e.js";import{v as Ir,a as Li,m as _,b as xr,c as Rr,d as Dr,I as Lr,e as Er,f as Or,g as Vr,h as Le,i as Pr,j as kr,k as Mr,l as Br,n as Je,o as Ar,p as Fr,C as Nr,q as $r,D as Ur,R as Hr,r as Qn,s as Ei,t as vn,u as je,w as gn,x as Oi,y as Vi,z as Wr,A as zr,V as Qe,B as jr,E as yn,_ as Gr,F as Pi,G as ki,H as Xr,J as qr,K as wn,L as Mi,M as Yr,N as Bi,O as Kr,P as Kt,Q as Ai,S as Fo,T as Qr,U as No,W as $o,X as Zr,Y as Jr,Z as el,$ as tl,a0 as nl,a1 as ol,a2 as il,a3 as al,a4 as Fi,a5 as sl}from"./vtk.js-2c901129.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();const rl=X({name:"App",components:{}});function ll(e,t,n,s,o,i){const a=P("router-view");return x(),K(a)}const cl=A(rl,[["render",ll]]);function ul(e){const t=e.split(/\/+/g);return t.splice(-1,1),t.join("/")}function dl(e){return e.split(/\/+/g).at(-1)??e}function St(e){return e.replace(/\/+/g,"/").replace(/\/$/,"")}function _t(...e){return St(e.join("/"))}function Hn(e){return e.replace(/\//g,"_")}function Uo(e){return new File([e],Hn(e.name))}class Ni{constructor(){this.webWorker=null,this.initializeCheck=null}async runTask(t,n,s,o){return gi(this.webWorker,t,n,o,s,_t("/","/itk/pipelines"),_t("/","/itk/pipeline.worker.js"))}async initialize(){return this.initializeCheck||(this.initializeCheck=new Promise((t,n)=>{this.runTask("dicom",[],[],[]).then(s=>{s.webWorker?this.webWorker=s.webWorker:n(new Error("Could not initialize webworker"))}).then(async()=>{try{await Vo(this.webWorker,new File([],""),null)}catch{}t()}).catch(n)})),this.initializeCheck}async categorizeFiles(t){await this.initialize();const n=await Promise.all(t.map(async(l,c)=>{const u=await l.arrayBuffer();return{type:Ye.BinaryFile,data:{path:c.toString(),data:new Uint8Array(u)}}})),s=["--action","categorize","--memory-io","0","--files",...n.map(l=>l.data.path)],o=[{type:Ye.TextStream}],i=await this.runTask("dicom",s,n,o),a=JSON.parse(i.outputs[0].data.data);return Object.fromEntries(Object.entries(a).map(([l,c])=>[l,c.map(u=>t[parseInt(u,10)])]))}async readTags(t,n){const s=n.map(a=>a.tag),i=(await Vo(this.webWorker,Uo(t),s)).tags;return n.reduce((a,r)=>{const{tag:l,name:c}=r;return i.has(l)?{...a,[c]:i.get(l)}:a},{})}async getVolumeSlice(t,n=!1){await this.initialize();const s=await t.arrayBuffer(),o=[{type:Ye.BinaryFile,data:{path:Hn(t.name),data:new Uint8Array(s)}}],i=["--action","getSliceImage","--thumbnail",n.toString(),"--file",Hn(t.name),"--memory-io","0"],a=[{type:Ye.Image}];return(await this.runTask("dicom",i,o,a)).outputs[0].data}async resample(t,n){await this.initialize();const{size:s,spacing:o,origin:i,direction:a}=t,r=["--action","resample","0","--size",s.join(","),"--spacing",o.join(","),"--origin",i.join(","),"--direction",a.join(","),"--memory-io","0"],l=[{type:Ye.Image,data:n}],c=[{type:Ye.Image}];return(await this.runTask("dicom",r,l,c)).outputs[0].data}async buildImage(t){return await this.initialize(),(await xs(t.map(s=>Uo(s)))).image}}const $t={vti:"application/vnd.unknown.vti",vtp:"application/vnd.unknown.vtp",stl:"model/stl",dcm:"application/dicom",zip:"application/zip",json:"application/json",gipl:"application/vnd.unknown.gipl","gipl.gz":"application/vnd.unknown.gipl",hdf5:"application/x-hdf5",jpg:"image/jpeg",jpeg:"image/jpeg",lsm:"application/vnd.unknown.lsm",mnc:"application/vnd.unknown.minc","mnc.gz":"application/vnd.unknown.minc",mnc2:"application/vnd.unknown.minc",mgh:"application/vnd.unknown.mgh",mgz:"application/vnd.unknown.mgh","mgh.gz":"application/vnd.unknown.mgh",mha:"application/vnd.unknown.metaimage",mhd:"application/vnd.unknown.metaimage",mrc:"application/vnd.unknown.mrc",nia:"application/vnd.unknown.nifti-1",nii:"application/vnd.unknown.nifti-1","nii.gz":"application/vnd.unknown.nifti-1",hdr:"application/vnd.unknown.nifti-1",nrrd:"application/vnd.unknown.nrrd",nhdr:"application/vnd.unknown.nrrd",png:"image/png",pic:"application/vnd.unknown.biorad",tif:"image/tiff",tiff:"image/tiff",vtk:"application/vnd.unknown.vtk",isq:"application/vnd.unknown.scanco",fdf:"application/vnd.unknown.fdf"},Ho=new Set(Object.keys($t)),Wo=new Set(Object.values($t)),$i=new Set(["application/zip"]),zo=[{mime:"application/dicom",skip:128,header:Array.from("DICM").map(e=>e.charCodeAt(0))}],hl=512;function gl(e,t){if(t.length>e.length)return!1;for(let n=0;n<t.length;n+=1)if(t[n]!==e[n])return!1;return!0}async function fl(e){return new Promise(t=>{const n=e.slice(0,hl),s=new FileReader;s.onload=()=>{const o=new Uint8Array(s.result);for(let i=0;i<zo.length;i+=1){const{mime:a,header:r,skip:l=0}=zo[i];if(gl(o.slice(l),r)){t(a);return}}t(null)},s.readAsArrayBuffer(n)})}async function Ui(e){const t=e.type.toLowerCase();if(Wo.has(t))return t;if(Ho.has(t))return $t[t];const n=[...Ho].find(o=>e.name.toLowerCase().endsWith(`.${o}`));if(n)return $t[n];const s=await fl(e);return s&&Wo.has(s)?s:null}async function pl(e){const t=await Ui(e)??"";return new File([e],e.name,{type:t.toLowerCase()})}async function ml(e,t){return new Promise(n=>{const s=new globalThis.FileReader;if(s.onload=()=>n(s.result),t==="ArrayBuffer")s.readAsArrayBuffer(e);else if(t==="Text")s.readAsText(e);else throw new TypeError(`readAs${t} is not a function`)})}async function vl(e){return ml(e,"ArrayBuffer")}const Wn=new Map;function Hi(e){return e}function Wi(){let e=null,t=null;const n=i=>{e&&e(i)},s=i=>{t&&t(i)};return{promise:new Promise((i,a)=>{e=i,t=a}),resolve:n,reject:s}}function Ut(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}function zi(e,t,n){return Math.min(n,Math.max(t,e))}function jo(e,...t){return t.reduce((n,s)=>({...n,[s]:e[s]}),{})}function Qt(e,t){const n=[[],[]];return t.forEach(s=>{const o=e(s)?0:1;n[o].push(s)}),n}const yl=(e,t,n)=>(e in t||(t[e]=n),t[e]);function Zn(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function wl(e,t=Yn){const n=Math.round(e);return Math.abs(n-e)<=t?n:e}function Sl(e){return e instanceof Error?e:new Error(JSON.stringify(e))}function _l(e){if(!e)return"#ffffff";const t=document.createElement("canvas").getContext("2d");if(!t)throw new Error("Could not create canvas context");return t.fillStyle=e,t.fillStyle}class ji{constructor(t){this.msgID=0,this.worker=t,this.waiting={},this.worker.onmessage=this.handleMessage.bind(this)}postMessage(t,n=[]){const s={id:this.msgID,message:t},o=Wi();return this.waiting[s.id]=o,this.worker.postMessage(s,n),this.msgID+=1,o.promise}handleMessage(t){const{id:n,error:s,message:o}=t.data;if(n in this.waiting){const i=this.waiting[n];delete this.waiting[n],s?i.reject(new Error(s)):i.resolve(o)}}}const Jn=e=>async t=>{const s=await new ji(new Worker(new URL("/assets/async.reader.worker-f0ea3ad1.js",self.location),{type:"module"})).postMessage({file:t,readerName:e});if(s.status==="success")return Ir(s.obj);throw s.error},Cl=e=>async t=>{const s=await new ji(new Worker(new URL("/assets/async.writer.worker-42a67950.js",self.location),{type:"module"})).postMessage({obj:t.getState(),writerName:e});if(s.status==="success")return s.data;throw s.error},bl=Jn("stl"),Gi=Jn("vti"),Tl=Jn("vtp"),Il=Cl("vti"),xl=Array.from(new Set(Array.from(Rs.keys()).map(e=>$t[e.toLowerCase()])));Li.setReadImageArrayBufferFromITK(Ds);async function Rl(e){const t=await vl(e),n=Li.newInstance();n.setFileName(e.name);try{await n.parseAsArrayBuffer(t)}catch{throw new Error("Failed to parse file")}return n.getOutputData()}function Dl(e){e.set("application/vnd.unknown.vti",Gi),e.set("application/vnd.unknown.vtp",Tl),e.set("model/stl",bl),xl.forEach(t=>{e.set(t,Rl)})}function Xi(e,t){const n=_.debounce(t.renderWindow.render,5);e.resize=()=>{if(t.container){const a=t.container.getBoundingClientRect();if(a.width===a.height&&a.width===0)return;const r=window.devicePixelRatio||1,l=Math.max(10,Math.floor(r*a.width)),c=Math.max(10,Math.floor(r*a.height));t.renderWindow.getViews()[0].setSize(l,c),e.invokeResize({width:l,height:c}),e.render(!0)}},e.render=(a=!0)=>{t.orientationWidget.updateMarkerOrientation(),a?t.renderWindow.render():n()};let s=null;e.renderLater=()=>{s==null&&(s=setTimeout(()=>{e.render(),s=null},0))},e.removeAllRepresentations=()=>{t.representations.forEach(a=>t.renderer.removeViewProp(a)),t.representations.length=0},e.updateCamera=(a,r,l)=>{const c=fi(l);pi(c,c,a),t.camera.setFocalPoint(...l),t.camera.setPosition(...c),t.camera.setDirectionOfProjection(...a),t.camera.setViewUp(...r)};const{setContainer:o}=e;e.setContainer=a=>{o(a),t.cornerAnnotation.setContainer(null)};const{resetCamera:i}=e;e.resetCamera=(...a)=>{i(a),t.renderer.updateLightsGeometryToFollowCamera()}}function Ll(e,t){t.classHierarchy.push("vtkLPSView3DProxy"),Xi(e,t)}function qi(e,t,n={}){Object.assign(t,n),xr.extend(e,t,n),Ll(e,t)}const El=_.newInstance(qi,"vtkLPSView3DProxy"),Ol={newInstance:El,extend:qi};function Vl(e,t){t.classHierarchy.push("vtkLPSView2DProxy");const n={...e};Xi(e,t),e.bindRepresentationToManipulator=()=>{},e.resetCamera=(s=null)=>{t.renderer.resetCamera(s)},e.addRepresentation=s=>{s&&(t.representations.indexOf(s)===-1&&(t.representations.push(s),t.renderer.addViewProp(s)),s.setSlicingMode&&t.slicingMode&&s.setSlicingMode(t.slicingMode))},e.setSlicingMode=s=>{if(t.axis="IJK".indexOf(s),n.setSlicingMode(s)&&s){let o=t.representations.length;for(;o--;){const i=t.representations[o];i.setSlicingMode&&i.setSlicingMode(s)}}},e.resizeToFit=(s,o,i)=>{const[a,r]=t.renderWindow.getViews()[0].getSize();let l,c;s===0&&o===1?[,c,l]=i:s===0&&o===2?[,l,c]=i:s===1&&o===0?[c,,l]=i:s===1&&o===2?[l,,c]=i:s===2&&o===0?[c,l]=i:s===2&&o===1&&([l,c]=i);const u=a/r,d=l/c;let h=0;u>=d?h=c/2:h=l/2/u,t.camera.setParallelScale(h)}}const Pl={slicingMode:null};function Yi(e,t,n={}){Object.assign(t,n,Pl),_.setGet(e,t,["slicingMode"]),Rr.extend(e,t,n),Vl(e,t)}const kl=_.newInstance(Yi,"vtkLPSView2DProxy"),Ml={newInstance:kl,extend:Yi},Bl={X:"I",Y:"J",Z:"K",I:"I",J:"J",K:"K"};function Al(e,t){t.classHierarchy.push("vtkIJKSliceRepresentationProxy");const n={...e};e.setSlicingMode=s=>n.setSlicingMode(Bl[s])}const Fl={};function Ki(e,t,n={}){Object.assign(t,Fl,n),Dr.extend(e,t),_.proxyPropertyMapping(e,t,{opacity:{modelKey:"property",property:"opacity"}}),Al(e,t)}const Nl=_.newInstance(Ki,"vtkIJKSliceRepresentationProxy"),Qi={newInstance:Nl,extend:Ki},{InterpolationType:$l}=Lr;function Ul(e,t){t.classHierarchy.push("vtkLabelMapSliceRepProxy");let n=null;t.property.setUseLookupTableScalarRange(!0),t.property.setInterpolationType($l.NEAREST),t.mapper.setRelativeCoincidentTopologyPolygonOffsetParameters(-2,-2);let s=null;function o(a){const r=a.getColorMap();if(r===s)return;s=r;const l=Er.newInstance(),c=Or.newInstance();Object.keys(r).forEach(u=>{const d=Number(u);l.addRGBPoint(d,...r[u].slice(0,3).map(h=>h/255)),c.addPoint(d,r[u][3]/255)}),t.property.setRGBTransferFunction(l),t.property.setScalarOpacity(c)}function i(a){n&&(n.unsubscribe(),n=null),a&&(n=a.onModified(()=>o(a)),o(a))}e.setColorBy=()=>{},e.delete=_.chain(e.delete,()=>{n&&(n.unsubscribe(),n=null)}),t.sourceDependencies.push({setInputData:i})}const Hl={};function Zi(e,t,n={}){Object.assign(t,Hl,n),Qi.extend(e,t),Ul(e,t)}const Wl=_.newInstance(Zi,"vtkLabelMapSliceRepProxy"),zl={newInstance:Wl,extend:Zi};function qe(e,t=[],n=[],s={},o={}){return{class:e,options:{links:n,ui:t,...s},props:o}}function Go(e,t=[],n={}){return qe(e,[],[],t,n)}const jl={definitions:{Proxy:{LookupTable:qe(Vr,[],[],{presetName:"Default (Cool to Warm)"}),PiecewiseFunction:qe(Le)},Sources:{TrivialProducer:qe(Pr)},Representations:{ImageSlice:qe(Qi),LabelMapSlice:qe(zl),Volume:qe(kr),Geometry:qe(Mr)},Views:{View3D:Go(Ol),View2D:Go(Ml)}},representations:{View3D:{vtkImageData:{name:"Volume"},vtkPolyData:{name:"Geometry"}},View2D:{vtkImageData:{name:"ImageSlice"},vtkLabelMap:{name:"LabelMapSlice"}}}};function Gl({stencil:e,location:t,slicingIndex:n,indexToWorld:s}){const[o,i]=e.size,a=Math.floor((o-1)/2),r=Math.floor((i-1)/2),l=o+1,c=i+1,u=[],d=[],h={},v=(f,m)=>{const w=`${f},${m}`;if(w in h)return h[w];const T=[...t].map(O=>Math.round(O));n===0?(T[1]+=f-a-.5,T[2]+=m-r-.5):n===1?(T[0]+=f-a-.5,T[2]+=m-r-.5):n===2&&(T[0]+=f-a-.5,T[1]+=m-r-.5);const S=[];pe(S,T,s),u.push(S);const b=u.length-1;return h[w]=b,b},p=(f,m)=>f<0||f>=o||m<0||m>=i?0:e.pixels[m*o+f]||0;for(let f=0;f<c;f++)for(let m=0;m<l;m++){const w=p(m,f)+p(m-1,f)+p(m,f-1)+p(m-1,f-1);if(w>0&&w<4){const T=v(m,f);if(p(m,f)!==p(m,f-1)){const S=v(m+1,f);d.push([T,S])}if(p(m,f)!==p(m-1,f)){const S=v(m,f+1);d.push([T,S])}}}return{points:new Float32Array(u.flat()),lines:new Uint16Array(d.map(([f,m])=>[2,f,m]).flat())}}function Xl(e,t){t.classHierarchy.push("vtkPaintBrushContextRepresentation"),t.internalPolyData=Je.newInstance({mtime:0}),t.internalArrays={points:t.internalPolyData.getPoints(),lines:t.internalPolyData.getLines()},t.pipelines={brush:{source:e,mapper:Ar.newInstance({transformCoordinate:Fr.newInstance({coordinateSystem:Nr.WORLD})}),actor:$r.newInstance({pickable:!1,parentProp:e})}};const n=t.pipelines.brush.actor.getProperty();n.setLineWidth(2),n.setColor([1,0,0]),n.setDisplayLocation(Ur.FOREGROUND),n.setRepresentation(Hr.SURFACE),Qn.connectPipeline(t.pipelines.brush),e.addActor(t.pipelines.brush.actor),e.requestData=(s,o)=>{const i=s[0],a=i.getStencil(),r=i.getBrush(),{indexToWorld:l,worldToIndex:c}=t;if(a&&r.getOrigin()){const u=[];pe(u,r.getOrigin(),c);const d=Gl({stencil:a,location:u,slicingIndex:t.slicingIndex,indexToWorld:l}),{points:h,lines:v}=t.internalArrays;h.setData(d.points),v.setData(d.lines),t.internalPolyData.modified()}o[0]=t.internalPolyData}}const ql={defaultScale:1,drawBorder:!1,drawFace:!0,worldToIndex:null,indexToWorld:null,slicingIndex:0};function Ji(e,t,n={}){Object.assign(t,ql,n),Br.extend(e,t,n),_.setGet(e,t,["slicingIndex","indexToWorld","worldToIndex"]),_.get(e,t,["mapper","actor"]),Xl(e,t)}const Yl=_.newInstance(Ji,"vtkPaintBrushContextRepresentation"),Kl={newInstance:Yl,extend:Ji};function kn(e){return e.altKey||e.controlKey||e.shiftKey}function Ql(e,t){t.classHierarchy.push("vtkPaintWidgetProp"),_.setGet(e,t,["manipulator"]);let n=!1;e.handleLeftButtonPress=s=>{if(!t.manipulator||kn(s))return _.VOID;const o=t.manipulator.handleEvent(s,t._apiSpecificRenderWindow);return o?(t.widgetState.getBrush().setOrigin(...o),n=!0,e.invokeStartInteractionEvent(),_.EVENT_ABORT):_.VOID},e.handleMouseMove=s=>{if(kn(s))return _.VOID;const o=t.manipulator.handleEvent(s,t._apiSpecificRenderWindow);return o?(t.widgetState.getBrush().setOrigin(...o),n&&e.invokeInteractionEvent(),_.EVENT_ABORT):_.VOID},e.handleLeftButtonRelease=s=>!n||kn(s)?_.VOID:(n=!1,e.invokeEndInteractionEvent(),_.EVENT_ABORT),e.handleMouseWheel=()=>n?_.EVENT_ABORT:_.VOID,e.grabFocus=()=>{t.hasFocus||(t.hasFocus=!0,t._interactor.requestAnimation(e))},e.loseFocus=()=>{t.hasFocus&&t._interactor.cancelAnimation(e),t.hasFocus=!1}}function Zl(){return Ei.createBuilder().addStateFromMixin({labels:["brush"],name:"brush",mixins:["origin","scale1","visible","color"],initialValues:{scale1:1,origin:null,visible:!0}}).addField({name:"stencil",initialValue:null}).build()}function Jl(e,t){t.classHierarchy.push("vtkPaintWidget"),t.methodsToLink=["slicingIndex","indexToWorld","worldToIndex"],e.getRepresentationsForViewType=()=>[{builder:Kl,labels:["brush"]}],t.manipulator=je.newInstance()}const ec={};function ea(e,t,n={}){Object.assign(t,ec,n),vn.extend(e,t,{...n,behavior:Ql,widgetState:Zl()}),_.get(e,t,["manipulator"]),Jl(e,t)}const tc=_.newInstance(ea,"vtkPaintWidget"),nc={newInstance:tc,extend:ea};function oc(e,t){const n=new Uint8Array(e*t),s=(m,w)=>{n[m+w*e]=1},o=(m,w,T)=>{const S=T*e+m,b=S+(w-m+1);n.fill(1,S,b)};let i=0,a=0,r=e-1,l=t-1,c=r,u=l;const d=u&1;let h=4*(1-c)*u*u,v=4*(d+1)*c*c,p=h+v+d*c*c,f=0;a+=Math.floor((u+1)/2),l=a-d,c*=8*c,u*=8*u;do o(i,r,a),o(i,r,l),f=2*p,f<=v&&(a++,l--,v+=c,p+=v),(f>=h||2*p>v)&&(i++,r--,h+=u,p+=h);while(i<=r);for(;a-l<t;)s(i-1,a),s(r+1,a++),s(i-1,l),s(r+1,l--);return n}class ic{constructor(){this.size=1,this.scale=[1,1],this.recomputeStencil()}setSize(t){this.size=Math.max(0,t),this.recomputeStencil()}setScale(t){this.scale=t,this.recomputeStencil()}recomputeStencil(){const t=[Math.ceil(this.size*this.scale[0]),Math.ceil(this.size*this.scale[1])];this.cachedStencil={size:t,pixels:oc(t[0],t[1])}}getStencil(){return this.cachedStencil}}let ac=class{constructor(){this.factory=nc.newInstance(),this.brush=new ic,this.brushValue=1}updateWidgetStencil(){const t=this.brush.getStencil();this.factory.getWidgetState().setStencil(t)}setBrushSize(t){this.brush.setSize(t),this.updateWidgetStencil()}setBrushScale(t){this.brush.setScale(t),this.updateWidgetStencil()}setBrushValue(t){this.brushValue=t}paintLabelmap(t,n,s,o){const i=this.brush.getStencil(),a=[...s.map(D=>Math.round(D))],r=a[n];a.splice(n,1);let l=[...a];o&&(l=[...o.map(D=>Math.round(D))],l.splice(n,1));const c=t.getPointData().getScalars().getData(),u=t.getDimensions(),d=u[0],h=u[0]*u[1],v=D=>D[0]>=0&&D[1]>=0&&D[2]>=0&&D[0]<u[0]&&D[1]<u[1]&&D[2]<u[2],{pixels:p,size:f}=i,m=Math.floor((f[0]-1)/2),w=Math.floor((f[1]-1)/2),T=[...a],S=[...l],b=[0,0,0],O=[0,0];for(let D=0;D<f[1];D++){const k=D-w,E=D*f[0];for(let $=0;$<f[0];$++){const Y=$-m,Z=E+$;if(p[Z]){T[0]=a[0]+Y,T[1]=a[1]+k,S[0]=l[0]+Y,S[1]=l[1]+k;const B=S[0]-T[0],W=S[1]-T[1];let J=Math.abs(Math.abs(B)>Math.abs(W)?B:W);const Ce=B/J,me=W/J;for([O[0],O[1]]=T;J-->=0;){if(O.splice(n,0,r),b[0]=Math.round(O[0]),b[1]=Math.round(O[1]),b[2]=Math.round(O[2]),v(b)){const Ge=b[0]+b[1]*d+b[2]*h;c[Ge]=this.brushValue}O.splice(n,1),O[0]+=Ce,O[1]+=me}}}}t.modified()}};function sc({paint:e,proxies:t,dicomIO:n}={}){const s={$paint:e??new ac,$proxies:t,$dicomIO:n??new Ni};return()=>s}var ta=(e=>(e.Volume="View3D",e.Slice="View2D",e))(ta||{});class rc{constructor(t){this.viewProxies=new Map,this.dataProxies=new Map,this.proxyManager=t}delete(){const t=n=>this.proxyManager.deleteProxy(n);this.viewProxies.forEach(t),this.dataProxies.forEach(t)}createView(t,n){if(this.viewProxies.has(t))throw new Error("Cannot create a view with the same ID");const s=this.proxyManager.createProxy("Views",n,{name:n});return this.viewProxies.set(t,s),s}getView(t){return this.viewProxies.get(t)}removeView(t){const n=this.viewProxies.get(t);n&&(this.proxyManager.deleteProxy(n),this.viewProxies.delete(t))}addData(t,n){if(this.dataProxies.has(t))return;const s=this.proxyManager.createProxy("Sources","TrivialProducer");s.setInputData(n),this.dataProxies.set(t,s)}getData(t){return this.dataProxies.get(t)??null}updateData(t,n){const s=this.dataProxies.get(t);s&&s.setInputData(n)}deleteData(t){const n=this.dataProxies.get(t);if(this.dataProxies.delete(t),n)this.proxyManager.deleteProxy(n);else throw new Error("Did not find proxy for ID")}getDataRepresentationForView(t,n){const s=this.dataProxies.get(t),o=this.viewProxies.get(n);return!s||!o?null:this.proxyManager.getRepresentation(s,o)}}function lc(){const{exitPointerLock:e}=document;document.exitPointerLock=()=>{try{e==null||e.call(document)}catch{}}}const{VITE_SENTRY_DSN:na}={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},oa="error-reporting-off",cc=!!na,uc=e=>{localStorage.getItem(oa)!=="true"&&cc&&Ls({app:e,dsn:na,integrations:[new Es],tracesSampleRate:.1,replaysSessionSampleRate:.1,replaysOnErrorSampleRate:1})},dc=()=>{Vs(200)};te("error-reporting",()=>{const e=Os(oa,"false"),t=M(e.value==="true");return F(t,()=>{e.value=String(t.value),t.value&&dc()}),{disableReporting:t}});const Xo=[{username:"Mitchel",password:"12345"},{username:"Glisant",password:"12345"},{username:"admin",password:"admin123"}];const hc={data(){return{timeofday:"Day",container:"container",invalidLogin:!1,loaded:!1}},created(){this.timeofday=this.getTimeOfDay(),this.container=`${this.container} ${this.timeofday.toLowerCase()}`,window.localStorage.setItem("userLoggedIn","GUEST USER")},mounted(){setTimeout(()=>{this.loaded=!0},100)},methods:{getTimeOfDay(){const e=new Date().getHours();return e>=5&&e<12?"Morning":e>=12&&e<18?"Afternoon":e>=18&&e<23?"Evening":"Day"},login(e){e.preventDefault(),Xo.find(n=>n.username===this.username&&n.password===this.password)?(window.localStorage.setItem("userLoggedIn",this.username),this.$router.push("/home")):this.invalidLogin=!0},signup(e){e.preventDefault();const t={username:this.username,password:this.password};Xo.push(t),this.$router.push("/home")}}},Zt=e=>(re("data-v-4ccf444f"),e=e(),le(),e),gc=Zt(()=>g("h4",null,"Sign into your account",-1)),fc={for:"username"},pc=Zt(()=>g("p",null,"Username not found",-1)),mc=[pc],vc={for:"password"},yc=Zt(()=>g("p",null,"Invalid Password",-1)),wc=[yc],Sc=Zt(()=>g("button",{type:"submit",style:{"align-self":"center"}},"Log In",-1)),_c=Zt(()=>g("h4",{style:{"margin-top":"40px"}},"Don't have an account?",-1));function Cc(e,t,n,s,o,i){return x(),L("div",{class:N(o.container)},[g("div",{class:N(["login-form",{loaded:o.loaded}])},[g("h2",null,"Good "+U(o.timeofday),1),gc,g("form",{onSubmit:t[4]||(t[4]=(...a)=>i.login&&i.login(...a))},[g("label",fc,[H("User name "),tt(g("input",{type:"text",id:"username","onUpdate:modelValue":t[0]||(t[0]=a=>e.username=a),required:""},null,512),[[Nn,e.username]])]),g("div",{class:N(["invalidLogin",{view:o.invalidLogin}])},mc,2),g("label",vc,[H("Password "),tt(g("input",{type:"password",id:"password","onUpdate:modelValue":t[1]||(t[1]=a=>e.password=a),required:""},null,512),[[Nn,e.password]])]),g("div",{class:N(["invalidLogin",{view:o.invalidLogin}])},wc,2),Sc,_c,g("h4",{onClick:t[2]||(t[2]=(...a)=>i.signup&&i.signup(...a)),onKeydown:t[3]||(t[3]=ke(ie((...a)=>e.handleKeyDown&&e.handleKeyDown(...a),["prevent"]),["space"])),style:{color:"#0085ff"},class:"sign-up-b"}," Try as Guest ",32)],32)],2)],2)}const bc=A(hc,[["render",Cc],["__scopeId","data-v-4ccf444f"]]);const Tc={props:{username:String},methods:{getTimeOfDay(){const e=new Date().getHours();return e>=5&&e<12?"Morning":e>=12&&e<18?"Afternoon":e>=18&&e<23?"Evening":"Night"}},data(){return{timeofday:"Day"}},created(){this.timeofday=this.getTimeOfDay()}},Ic={class:"greeting"};function xc(e,t,n,s,o,i){return x(),L("div",Ic,[g("h2",null,"Good "+U(o.timeofday)+",",1),g("h1",null,U(n.username),1)])}const Rc=A(Tc,[["render",xc],["__scopeId","data-v-91098397"]]);const Dc={props:{patient:Object},methods:{updatepatient(e){window.localStorage.setItem("currentPatient",JSON.stringify(e))}},data(){return{isHovered:!1,currentPatient:""}}};function Lc(e,t,n,s,o,i){const a=P("router-link");return x(),K(a,{to:"/analysis",style:{"text-decoration":"none"}},{default:R(()=>[g("div",{class:"patient",onMouseover:t[0]||(t[0]=r=>o.isHovered=!0),onFocusin:t[1]||(t[1]=r=>o.isHovered=!0),onClick:t[2]||(t[2]=r=>i.updatepatient(n.patient)),onKeydown:t[3]||(t[3]=ke(ie((...r)=>e.handleKeyDown&&e.handleKeyDown(...r),["prevent"]),["space"])),onMouseout:t[4]||(t[4]=r=>o.isHovered=!1),onFocusout:t[5]||(t[5]=r=>o.isHovered=!1)},[g("h3",{class:N({hovered:o.isHovered})},U(n.patient.name),3),g("h3",{class:N({hovered:o.isHovered})},U(n.patient.lastname),3),g("h3",{class:N({hovered:o.isHovered})},U(n.patient.dob),3),g("h3",{class:N({hovered:o.isHovered})},U(n.patient.gender),3),g("h3",{class:N({hovered:o.isHovered})},U(n.patient.scandate),3),g("h3",{class:N({hovered:o.isHovered})},U(n.patient.scanlocation),3)],32)]),_:1})}const Ec=A(Dc,[["render",Lc],["__scopeId","data-v-1d35c230"]]);const Oc={},Vc={class:"loading-container"},Pc=g("div",{class:"loading-spinner"},null,-1),kc=g("p",{class:"loading-text"},"Loading...",-1),Mc=[Pc,kc];function Bc(e,t){return x(),L("div",Vc,Mc)}const ia=A(Oc,[["render",Bc]]);const Ac={props:{patients:{type:Array}},data(){return{filter:"",loaded:!1}},computed:{filteredPatients(){const e=this.filter.toLowerCase().replace(/\s/g,"");return e===""?this.patients:this.patients.filter(t=>t.name.toLowerCase().includes(e)||t.lastname.toLowerCase().includes(e)||t.scanlocation.toLowerCase().includes(e))}},methods:{},components:{PatientElement:Ec,LoadingScreen:ia},mounted(){setTimeout(()=>{this.loaded=!0},600)}},Fc=e=>(re("data-v-84376fbc"),e=e(),le(),e),Nc=Fc(()=>g("div",{class:"patient-header"},[g("h3",null,"Last Name"),g("h3",null,"First Name"),g("h3",null,"Date of Birth"),g("h3",null,"Gender"),g("h3",null,"Scan Date"),g("h3",null,"Scan Location")],-1)),$c={key:0,class:"patient-container"},Uc={key:1};function Hc(e,t,n,s,o,i){const a=P("PatientElement"),r=P("LoadingScreen");return x(),L(se,null,[Nc,o.loaded?(x(),L("div",$c,[(x(!0),L(se,null,Pe(i.filteredPatients,l=>(x(),L("div",{key:l.id},[y(a,{patient:l},null,8,["patient"])]))),128))])):(x(),L("div",Uc,[y(r)]))],64)}const Wc=A(Ac,[["render",Hc],["__scopeId","data-v-84376fbc"]]),qo=0,Ct=te("id",()=>{let e=qo;return{nextId(){return String(++e)},reset(){e=qo}}}),eo=["Sagittal","Coronal","Axial"];function ft(){return{Sagittal:0,Coronal:0,Axial:0}}function aa(){return{Sagittal:[0,0],Coronal:[0,0],Axial:[0,0]}}function We(e,t,n){const s=2*n[t];return e.slice(s,s+2)}function Te(e){switch(e){case"Superior":case"Inferior":return"Axial";case"Left":case"Right":return"Sagittal";case"Posterior":case"Anterior":return"Coronal";default:throw new Error(`Invalid LPS direction: ${e}`)}}const sa=()=>({Left:Ke(1,0,0),Right:Ke(-1,0,0),Posterior:Ke(0,1,0),Anterior:Ke(0,-1,0),Superior:Ke(0,0,1),Inferior:Ke(0,0,-1),Sagittal:0,Coronal:1,Axial:2});function ra(e){const t=[0,1,2],n=[0,1,2],s=sa();for(let o=0;o<3;o++){let i=0,a=[0,0],r=[0,0];t.forEach((p,f)=>{n.forEach((m,w)=>{const T=e[p*3+m];Math.abs(T)>Math.abs(i)&&(i=T,a=[p,m],r=[f,w])})});const[l,c]=a,u=e.slice(l*3,(l+1)*3),d=Math.sign(i),h=u.map(p=>p*d),v=u.map(p=>p*-d);c===0?(s.Left=h,s.Right=v,s.Sagittal=l):c===1?(s.Posterior=h,s.Anterior=v,s.Coronal=l):c===2&&(s.Superior=h,s.Inferior=v,s.Axial=l),t.splice(r[0],1),n.splice(r[1],1)}return s}var oe=(e=>(e.WindowLevel="WindowLevel",e.Pan="Pan",e.Zoom="Zoom",e.Ruler="Ruler",e.Paint="Paint",e.Rectangle="Rectangle",e.Crosshairs="Crosshairs",e.Crop="Crop",e.Contour="Contour",e))(oe||{}),Re=(e=>(e.V="V",e.H="H",e))(Re||{}),Sn=(e=>(e.DICOM="dicom",e.IMAGE="image",e))(Sn||{});const zc=C.nativeEnum(Sn),jc=C.union([C.literal("Left"),C.literal("Right"),C.literal("Posterior"),C.literal("Anterior"),C.literal("Superior"),C.literal("Inferior")]),Gc=C.object({id:C.string(),path:C.string(),type:zc}),Xc=C.object({archiveSrc:C.object({path:C.string()}).optional(),uriSrc:C.object({uri:C.string(),name:C.string()}).optional()}),la=Xc.extend({parent:C.lazy(()=>la.optional())}),qc=C.nativeEnum(Re),ca=C.lazy(()=>C.object({name:C.string().optional(),direction:qc,items:C.array(C.union([ca,C.string()]))})),He=C.tuple([C.number(),C.number(),C.number()]),Yc=C.object({width:C.number(),level:C.number(),min:C.number(),max:C.number()}),Kc=C.object({slice:C.number(),min:C.number(),max:C.number(),axisDirection:jc}),Qc=C.object({parallelScale:C.number().optional(),position:He.optional(),focalPoint:He.optional(),directionOfProjection:He.optional(),viewUp:He.optional()}),to=C.object({arrayName:C.string(),location:C.string()}),Zc=C.object({position:C.number(),height:C.number(),width:C.number(),xBias:C.number(),yBias:C.number()}),Jc=C.object({x:C.number(),y:C.number(),midpoint:C.number(),sharpness:C.number()}),eu=C.object({mode:C.literal(Le.Mode.Gaussians),gaussians:Zc.array(),mappingRange:C.tuple([C.number(),C.number()])}),tu=C.object({mode:C.literal(Le.Mode.Points),preset:C.string(),shift:C.number(),mappingRange:C.tuple([C.number(),C.number()])}),nu=C.object({mode:C.literal(Le.Mode.Nodes),nodes:Jc.array(),mappingRange:C.tuple([C.number(),C.number()])}),no=C.union([eu,tu,nu]),oo=C.object({preset:C.string(),mappingRange:C.tuple([C.number(),C.number()])});C.object({colorBy:to,transferFunction:oo,opacityFunction:no});const ou=C.object({enabled:C.boolean(),lightFollowsCamera:C.boolean(),volumeQuality:C.number(),useVolumetricScatteringBlending:C.boolean(),volumetricScatteringBlending:C.number(),useLocalAmbientOcclusion:C.boolean(),laoKernelSize:C.number(),laoKernelRadius:C.number(),ambient:C.number(),diffuse:C.number(),specular:C.number()}),iu=C.object({colorBy:to,transferFunction:oo,opacityFunction:no,cvr:ou}),au=C.object({opacity:C.number()}),su=C.object({colorBy:to,transferFunction:oo,opacityFunction:no,blendConfig:au}),ru=C.object({window:Yc.optional(),slice:Kc.optional(),layers:su.optional(),camera:Qc.optional(),volumeColorConfig:iu.optional()}),lu=C.union([C.literal("2D"),C.literal("3D")]),cu=C.object({id:C.string(),type:lu,props:C.record(C.any()),config:C.record(ru)}),uu=C.object({id:C.string(),parent:C.string(),path:C.string()});C.union([C.literal("Axial"),C.literal("Sagittal"),C.literal("Coronal")]);const du=C.object({planeOrigin:He,planeNormal:He}),hu=C.object({imageID:C.string(),frameOfReference:du,slice:C.number(),id:C.string(),name:C.string(),color:C.string(),label:C.string().optional(),labelName:C.string().optional()}),ua=e=>C.object({tools:C.array(e),labels:C.record(e.partial())}),da=hu.extend({firstPoint:He,secondPoint:He}),gu=ua(da),fu=da.extend({id:C.string(),fillColor:C.string().optional()}),pu=ua(fu),mu=C.object({position:He}),vu=C.nativeEnum(oe),yu=C.object({activeLabelmapID:C.string().nullable(),brushSize:C.number(),brushValue:C.number(),labelmapOpacity:C.number()}),wu=C.object({Sagittal:C.tuple([C.number(),C.number()]),Coronal:C.tuple([C.number(),C.number()]),Axial:C.tuple([C.number(),C.number()])}),Su=C.record(wu),_u=C.object({rulers:gu.optional(),rectangles:pu.optional(),crosshairs:mu,paint:yu,crop:Su,current:vu}),Cu=C.object({selectionKey:C.string(),sourceSelectionKeys:C.string().array()}).array(),bu=C.object({version:C.string(),datasets:Gc.array(),remoteFiles:C.record(la.array()),labelMaps:uu.array(),tools:_u,views:cu.array(),primarySelection:C.string().optional(),layout:ca,parentToLayers:Cu}),io=e=>({fileSrc:{file:e,fileType:e.type}});function ha(e){return!!e.uriSrc||!!e.parent&&ha(e.parent)}function ga(e){var t;if(e!=null&&e.fileSrc)return e.fileSrc.file.name;if(e!=null&&e.uriSrc)return e.uriSrc.name;if((t=e==null?void 0:e.dicomSrc)!=null&&t.sources.length){const{sources:n}=e.dicomSrc,[s]=n,o=n.length>1?` (+${n.length-1} more)`:"";return`${ga(s)}${o}`}return null}function fa(e){const t={...e};return delete t.fileSrc,t.parent&&(t.parent=fa(t.parent)),t}const rt=te("files",{state:()=>({byDataID:{}}),getters:{getDataSources:e=>t=>e.byDataID[t]??[],getFiles:e=>t=>(e.byDataID[t]??[]).map(n=>n.fileSrc.file)},actions:{remove(e){e in this.byDataID&&delete this.byDataID[e]},add(e,t){this.byDataID[e]=t}}});async function pa(e,t,n){const s=rt(),{zip:o}=e,{manifest:{datasets:i,remoteFiles:a}}=e;t.forEach(r=>{const l=s.getDataSources(r);if(!l.length)throw new Error(`No files for dataID: ${r}`);const[c,u]=Qt(ha,l);a[r]=c.map(fa);const d=`data/${r}/`;u.forEach(h=>{const{file:v}=h.fileSrc,p=`${d}/${v.name}`;o.file(p,v)}),i.push({id:r,path:d,type:n})})}const ma=()=>({name:"(none)",orientation:mi(),lpsOrientation:sa(),spacing:Ke(1,1,1),origin:Ee(),dimensions:Ke(1,1,1),worldBounds:[0,1,0,1,0,1],worldToIndex:mt(),indexToWorld:mt()}),xe=te("images",{state:()=>({idList:[],dataIndex:Object.create(null),metadata:Object.create(null)}),actions:{addVTKImageData(e,t){const n=Ct().nextId();return this.idList.push(n),this.dataIndex[n]=t,this.$proxies.addData(n,t),this.metadata[n]={...ma(),name:e},this.updateData(n,t),n},updateData(e,t){if(e in this.metadata){const n={name:this.metadata[e].name,dimensions:t.getDimensions(),spacing:t.getSpacing(),origin:t.getOrigin(),orientation:t.getDirection(),lpsOrientation:ra(t.getDirection()),worldBounds:t.getBounds(),worldToIndex:t.getWorldToIndex(),indexToWorld:t.getIndexToWorld()};this.metadata[e]=n}this.$proxies.updateData(e,t),this.dataIndex[e]=t},deleteData(e){e in this.dataIndex&&(delete this.dataIndex[e],delete this.metadata[e],Ut(this.idList,e))},async serialize(e){const t=rt(),n=this.idList.filter(s=>s in t.byDataID);await pa(e,n,Sn.IMAGE)}}}),Tu="Anonymous",Iu="ANONYMOUS";function xu(e,t){return`${e}!!${t}`}const Ru=(e,t)=>e.readTags(t,[{name:"PatientName",tag:"0010|0010",strconv:!0},{name:"PatientID",tag:"0010|0020",strconv:!0},{name:"PatientBirthDate",tag:"0010|0030"},{name:"PatientSex",tag:"0010|0040"},{name:"StudyInstanceUID",tag:"0020|000d"},{name:"StudyDate",tag:"0008|0020"},{name:"StudyTime",tag:"0008|0030"},{name:"StudyID",tag:"0020|0010",strconv:!0},{name:"AccessionNumber",tag:"0008|0050"},{name:"StudyDescription",tag:"0008|1030",strconv:!0},{name:"Modality",tag:"0008|0060"},{name:"SeriesInstanceUID",tag:"0020|000e"},{name:"SeriesNumber",tag:"0020|0011"},{name:"SeriesDescription",tag:"0008|103e",strconv:!0}]),_e=te("dicom",{state:()=>({sliceData:{},volumeToImageID:{},imageIDToVolumeKey:{},patientInfo:{},patientStudies:{},studyInfo:{},studyVolumes:{},volumeInfo:{},volumeStudy:{},studyPatient:{},needsRebuild:{}}),actions:{async importFiles(e){if(!e.length)return[];const t=this.$dicomIO,n=new Map(e.map(a=>[a.fileSrc.file,a])),s=[...n.keys()],o=await t.categorizeFiles(s),i=rt();return Object.entries(o).forEach(([a,r])=>{const l=r.map(c=>{const u=n.get(c);if(!u)throw new Error("Did not match File with source DataSource");return u});i.add(a,l)}),await Promise.all(Object.entries(o).map(async([a,r])=>{if(!(a in this.volumeInfo)){const l=await Ru(t,r[0]),c={PatientID:l.PatientID||Iu,PatientName:l.PatientName||Tu,PatientBirthDate:l.PatientBirthDate||"",PatientSex:l.PatientSex||""},u=jo(l,"StudyID","StudyInstanceUID","StudyDate","StudyTime","AccessionNumber","StudyDescription"),d={...jo(l,"Modality","SeriesInstanceUID","SeriesNumber","SeriesDescription"),NumberOfSlices:r.length,VolumeID:a};this._updateDatabase(c,u,d)}a in this.volumeToImageID&&(this.needsRebuild[a]=!0)})),Object.keys(o)},_updateDatabase(e,t,n){const s=e.PatientID,o=t.StudyInstanceUID,i=n.VolumeID;s in this.patientInfo||(this.patientInfo[s]=e,this.patientStudies[s]=[]),o in this.studyInfo||(this.studyInfo[o]=t,this.studyVolumes[o]=[],this.studyPatient[o]=s,this.patientStudies[s].push(o)),i in this.volumeInfo||(this.volumeInfo[i]=n,this.volumeStudy[i]=o,this.sliceData[i]={},this.studyVolumes[o].push(i))},deleteVolume(e){const t=xe();if(e in this.volumeInfo){const n=this.volumeStudy[e];if(delete this.volumeInfo[e],delete this.sliceData[e],delete this.volumeStudy[e],e in this.volumeToImageID){const s=this.volumeToImageID[e];t.deleteData(s),delete this.volumeToImageID[e],delete this.imageIDToVolumeKey[s]}Ut(this.studyVolumes[n],e),this.studyVolumes[n].length===0&&this.deleteStudy(n)}},deleteStudy(e){if(e in this.studyInfo){const t=this.studyPatient[e];delete this.studyInfo[e],delete this.studyPatient[e],[...this.studyVolumes[e]].forEach(n=>this.deleteVolume(n)),delete this.studyVolumes[e],Ut(this.patientStudies[t],e),this.patientStudies[t].length===0&&this.deletePatient(t)}},deletePatient(e){e in this.patientInfo&&(delete this.patientInfo[e],[...this.patientStudies[e]].forEach(t=>this.deleteStudy(t)),delete this.patientStudies[e])},async serialize(e){const t=Object.keys(this.volumeInfo);await pa(e,t,Sn.DICOM)},async deserialize(e){return this.importFiles(e).then(t=>{if(t.length!==1)throw new Error("Invalid state file.");return t[0]})},async getVolumeSlice(e,t,n=!1){const s=this.$dicomIO,o=rt(),i=xu(t,n);if(e in this.sliceData&&i in this.sliceData[e])return this.sliceData[e][i];if(!(e in this.volumeInfo))throw new Error(`Cannot find given volume key: ${e}`);const r=this.volumeInfo[e].NumberOfSlices;if(t<1||t>r)throw new Error(`Slice ${t} is out of bounds`);const l=o.getFiles(e);if(!l)throw new Error(`No files found for volume key: ${e}`);const c=l[t-1],u=await s.getVolumeSlice(c,n);return this.sliceData[e][i]=u,u},async getVolumeThumbnail(e){const{NumberOfSlices:t}=this.volumeInfo[e],n=Math.ceil(t/2);return this.getVolumeSlice(e,n,!0)},async buildVolume(e,t=!1){const n=xe(),s=this.$dicomIO;if(!(t||this.needsRebuild[e])&&this.volumeToImageID[e]){const c=this.volumeToImageID[e];return n.dataIndex[c]}const a=rt().getFiles(e);if(!a)throw new Error("No files for volume key");const r=gn.convertItkToVtkImage(await s.buildImage(a)),l=this.volumeToImageID[e];if(l)n.updateData(l,r);else{const c=this.volumeInfo[e].SeriesInstanceUID,u=n.addVTKImageData(c,r);this.imageIDToVolumeKey[u]=e,this.volumeToImageID[e]=u}return delete this.needsRebuild[e],r}}}),va=te("models",{state:()=>({idList:[],dataIndex:{},metadata:{}}),actions:{addVTKPolyData(e,t){const n=Ct().nextId();return this.idList.push(n),this.dataIndex[n]=t,this.$proxies.addData(n,t),n}}});var zn=(e=>(e[e.Error=0]="Error",e[e.Warning=1]="Warning",e[e.Info=2]="Info",e[e.Success=3]="Success",e))(zn||{});const Jt=te("message",{state:()=>({_nextID:1,byID:{},msgList:[]}),getters:{messages(){return this.msgList.map(e=>this.byID[e])},importantMessages(){return this.messages.filter(e=>e.type!==3)}},actions:{addError(e,t){return t instanceof Error?this._addMessage({type:0,title:e},{details:String(t),persist:!1}):this._addMessage({type:0,title:e},t)},addWarning(e,t){return this._addMessage({type:1,title:e},t)},addInfo(e,t){return this._addMessage({type:2,title:e},t)},addSuccess(e,t){return this._addMessage({type:3,title:e},t)},clearOne(e){e in this.byID&&(Ut(this.msgList,e),delete this.byID[e])},clearAll(){this.byID={},this.msgList=[]},_addMessage(e,t){const n=String(this._nextID++),s={persist:!1,...typeof t=="string"?{details:t}:t};return this.byID[n]={...e,options:s,id:n},this.msgList.push(n),n}}});async function ao(e,t){try{return await t()}catch(n){n instanceof Error&&Jt().addError(e,{details:`${n}. More details can be found in the developer's console.`}),console.error(n)}}const Ht=e=>({type:"dicom",volumeKey:e}),Wt=e=>({type:"image",dataID:e}),ya=e=>{if(e.type==="image")return e.dataID;if(e.type==="dicom")return _e().volumeToImageID[e.volumeKey];const t=e;throw new Error(`invalid selection type ${t}`)},Du=async e=>{const t=xe(),n=_e();return e.type==="dicom"?(await ao("Failed to build volume",()=>n.buildVolume(e.volumeKey)),t.dataIndex[ya(e)]):t.dataIndex[e.dataID]},wa=e=>_e().imageIDToVolumeKey[e]??e,Sa=e=>_e().volumeToImageID[e]??e;function Lu(e,t){return e.type==="dicom"&&t.type==="dicom"?e.volumeKey===t.volumeKey:e.type==="image"&&t.type==="image"?e.dataID===t.dataID:!1}const xt=te("dataset",()=>{const e=xe(),t=va(),n=_e(),s=rt(),o=M(null),i=I(()=>{if(o.value)return ya(o.value)}),a=I(()=>{const{dataIndex:d}=e;return i.value&&d[i.value]||null}),r=I(()=>[...e.idList,...t.idList]);function l(d){return this.$proxies.getData(d)}function c(d){o.value=d,d!==null&&d.type==="dicom"&&ao("Failed to build volume",()=>n.buildVolume(d.volumeKey))}async function u(d){if(await n.serialize(d),await e.serialize(d),o.value!==null){let h=null;o.value.type==="dicom"?h=o.value.volumeKey:h=o.value.dataID;const{manifest:v}=d;v.primarySelection=h}}return e.$onAction(({name:d,args:h,after:v})=>{d==="deleteData"&&v(()=>{const[p]=h,f=o.value;(f==null?void 0:f.type)==="image"&&f.dataID===p&&(o.value=null),s.remove(p)})}),n.$onAction(({name:d,args:h,after:v})=>{d==="deleteVolume"&&v(()=>{const[p]=h,f=o.value;(f==null?void 0:f.type)==="dicom"&&p===f.volumeKey&&(o.value=null),s.remove(p)})}),{primarySelection:o,primaryDataset:a,allDataIDs:r,getDataProxyByID:l,setPrimarySelection:c,serialize:u}});function Eu(e,t,n){return{message:e,inputDataStackTrace:[t],cause:n}}const Mn=Symbol("DoneSentinel");class _n{constructor(t){this.handlers=Array.from(t??[])}async execute(t,n){return this.startExecutionContext(t,n)}async startExecutionContext(t,n){const s=[...this.handlers],o=[],i=Wi(),a=(h,v)=>{v?i.reject(v):i.resolve(h)},r=async(h,v)=>{let p=!1,f;const m=v>=s.length,w={done:S=>{if(p)throw new Error("done() called twice!");return p=!0,f=S,Mn},execute:async(S,b)=>{const O=this.execute(S,b??n);return o.push(O),O},extra:n};let T;m&&(T=Mn);try{if(m)T=Mn;else{const S=s[v];T=await S(h,w)}}catch(S){const b=S instanceof Error?S:new Error(S?String(S):"Unknown error occurred");a(void 0,b);return}if(p||m){a(f);return}r(T,v+1)},l={ok:!0,data:[],errors:[]};try{await r(t,0);const h=await i.promise;h!=null&&l.data.push(h)}catch(h){const v=h instanceof Error?h.message:String(h);l.ok=!1,l.errors.push(Eu(v,t,h))}const c=await Promise.all(o),[u,d]=Qt(h=>h.ok,c);return d.length>0&&(l.ok=!1),u.forEach(h=>{l.data.push(...h.data)}),d.forEach(h=>{const{errors:v}=h;v.forEach(p=>{p.inputDataStackTrace.push(t)}),l.errors.push(...v)}),l}}const Ou=(e,{extra:t,done:n})=>{const{fileSrc:s}=e;return t!=null&&t.dicomDataSources&&(s==null?void 0:s.fileType)==="application/dicom"?(t.dicomDataSources.push(e),n()):e},Vu={testURL:e=>{const{protocol:t}=new It(e,window.location.href);return t==="http:"||t==="https:"},fetchURL:async(e,t={})=>{var c;const{progress:n}=t,s=await fetch(e);if(s.status!==200)throw new Error(`Fetching resource failed (HTTP code ${s.status})`);if(!n)return s.blob();const o=Number(s.headers.get("content-length"))??-1;if(o<0)return n(1/0),s.blob();const i=(c=s.body)==null?void 0:c.getReader();if(!i)return null;const a=new Uint8Array(o);let r=0,l=!1;do{const u=await i.read();l=u.done,u.value&&!l&&(a.set(u.value,r),r+=u.value.length,n(r/o))}while(!l);return new Blob([a])}},so=[Vu];function Pu(e){return!!so.find(t=>t.testURL(e))}async function ku(e,t,n){const s=so.find(a=>a.testURL(e));if(!s)throw new Error(`Cannot find a handler for URL: ${e}`);const o=n==null?void 0:n.cache;if(o!=null&&o.has(e))return o.get(e);const i=s.fetchURL(e,n).then(a=>{if(!a)throw new Error(`Failed to download ${e}`);return new File([a],t)});return i.catch(()=>{o==null||o.delete(e)}),o==null||o.set(e,i),i}async function Mu(e,t){const n=so.find(a=>a.testURL(e));if(!n)throw new Error(`Cannot find a handler for URL: ${e}`);const s=await n.fetchURL(e,t);if(!s)throw new Error(`Failed to download ${e}`);const o=await s.arrayBuffer(),i=new TextDecoder;return JSON.parse(i.decode(new Uint8Array(o)))}const _a=async(e,{execute:t,done:n,extra:s})=>{const{fileSrc:o,uriSrc:i}=e;if(!o&&i&&Pu(i.uri))try{const a=await ku(i.uri,i.name,{cache:s==null?void 0:s.fetchFileCache});return t({...e,fileSrc:{file:a,fileType:""}}),n()}catch(a){throw new Error(`Could not download URL ${i.uri}`,{cause:a instanceof Error?a:void 0})}return e};async function ro(e){const t=await vi.loadAsync(e),n=[],s=[];return t.forEach((o,i)=>{if(!i.dir){const a=dl(i.name),r=ul(i.name),l=t.file(i.name);l&&(n.push(l.async("blob").then(c=>new File([c],a))),s.push(r))}}),Promise.all(n).then(o=>o.map((i,a)=>({file:i,archivePath:s[a]})))}function Ca(e){return!!e.fileSrc&&$i.has(e.fileSrc.fileType)}const Bu=async(e,{execute:t,done:n})=>Ca(e)?((await ro(e.fileSrc.file)).forEach(o=>{t({fileSrc:{file:o.file,fileType:""},archiveSrc:{path:`${o.archivePath}/${o.file.name}`},parent:e})}),n()):e;async function Au(e,t){let n=t==null?void 0:t.get(e);return n||(n=ro(e).then(s=>s.reduce((o,i)=>{const a=_t(i.archivePath,i.file.name);return Object.assign(o,{[a]:i.file})},{})),t&&t.set(e,n),n)}const ba=async(e,{extra:t,execute:n,done:s})=>{const{fileSrc:o,archiveSrc:i,parent:a}=e,{archiveCache:r}=t??{};if(!o&&i&&a){if(!(a!=null&&a.fileSrc))throw new Error("Cannot extract an archive target with an unresolved parent");if(!Ca(a))throw new Error("Parent is not a supported archive file");const l=await Au(a.fileSrc.file,r),c=St(i.path),u=l[c];if(!u)throw new Error(`Failed to find archive member ${c}`);return n({...e,fileSrc:{file:u,fileType:""}}),s()}return e},Fu=e=>new It(e).protocol==="s3:";function Nu(e,t){return`https://${e}.s3.amazonaws.com/${t}`}async function $u(e,t,n=()=>{}){const s=new Ps({region:"us-east-1",signer:{sign:async i=>i}}),o=async i=>{const a=new ks({Bucket:e,Prefix:t,ContinuationToken:i,MaxKeys:1e3});let r;try{r=await s.send(a)}catch(l){throw console.error(l),l}if(!r.Contents)throw new Error("S3 returned no objects");r.Contents.forEach(l=>{if(!l.Key)return;const c=l.Key,u=Nu(e,l.Key);n(c,u)}),r.IsTruncated&&r.NextContinuationToken&&await o(r.NextContinuationToken)};await o()}const Uu=e=>{const{hostname:t,pathname:n}=new It(e),s=n.replace(/^\//,"");return[t,s]},Hu=async(e,t=()=>{})=>{const[n,s]=Uu(e);await $u(n,s,t)},Wu=async(e,{execute:t,done:n})=>{const{uriSrc:s}=e;if(s&&Fu(s.uri))try{return await Hu(s.uri,(o,i)=>{t({uriSrc:{uri:i,name:o},parent:e})}),n()}catch(o){throw new Error(`Could not download S3 URI ${s.uri}`,{cause:o instanceof Error?o:void 0})}return e},zu=e=>new It(e).protocol==="gs:",ju=e=>{const{hostname:t,pathname:n}=new It(e),s=n.replace(/^\//,"");return[t,s]},Gu=e=>`https://storage.googleapis.com/storage/v1/b/${e}/o`;async function Xu(e,t,n=()=>{}){const s=[],o=async i=>{const a=new It(Gu(e));a.searchParams.append("prefix",t),a.searchParams.append("maxResults","1000"),i&&a.searchParams.append("pageToken",i);const r=await Mu(a.toString());if(r.kind!=="storage#objects")throw new Error("GCS did not return a list of objects!");s.push(...r.items),r.items.forEach(l=>n(l)),r.nextPageToken&&await o(r.nextPageToken)};return await o(),s}const qu=async(e,t=()=>{})=>{const[n,s]=ju(e);return Xu(n,s,t)},Yu=async(e,{execute:t,done:n})=>{const{uriSrc:s}=e;if(s&&zu(s.uri))try{return await qu(s.uri,o=>{t({uriSrc:{uri:o.mediaLink,name:o.name},parent:e})}),n()}catch(o){throw new Error(`Could not download GCS URI ${s.uri}`,{cause:o instanceof Error?o:void 0})}return e},Ku=async(e,{done:t})=>{if(!e.fileSrc)return e;const{fileSrc:n}=e;if(!Wn.has(n.fileType))return e;const o=await Wn.get(n.fileType)(n.file),i=rt();if(o.isA("vtkImageData")){const a=xe().addVTKImageData(n.file.name,o);return i.add(a,[e]),t({dataID:a,dataSource:e,dataType:"image"})}if(o.isA("vtkPolyData")){const a=va().addVTKPolyData(n.file.name,o);return i.add(a,[e]),t({dataID:a,dataSource:e,dataType:"model"})}throw new Error("Data reader did not produce a valid dataset")},Qu=C.object({url:C.string(),name:C.optional(C.string())}),Zu=C.object({resources:C.array(Qu)});async function Ju(e){const t=new TextDecoder,n=await e.arrayBuffer(),s=t.decode(new Uint8Array(n));return Zu.parse(JSON.parse(s))}const ed=async(e,{done:t,execute:n})=>{const{fileSrc:s}=e;if((s==null?void 0:s.fileType)==="application/json"){const o=[];try{(await Ju(s.file)).resources.forEach(a=>{o.push({uriSrc:{uri:a.url,name:a.name??new URL(a.url).pathname},parent:e})})}catch{return e}return o.forEach(i=>{n(i)}),t()}return e};function td(e,t){t.classHierarchy.push("vtkLabelMap"),t.colorMap===null&&(t.colorMap={0:[0,0,0,0],1:[0,0,0,255]})}const nd={colorMap:null};function Ta(e,t,n={}){Object.assign(t,nd,n),Oi.extend(e,t,n),_.setGet(e,t,["colorMap"]),td(e,t)}const od=_.newInstance(Ta,"vtkLabelMap"),Ia={newInstance:od,extend:Ta},ue={Coronal:"Coronal",Sagittal:"Sagittal",Axial:"Axial",Three:"3D"},xa={[ue.Coronal]:{viewType:"2D",props:{viewDirection:"Right",viewUp:"Superior"}},[ue.Sagittal]:{viewType:"2D",props:{viewDirection:"Posterior",viewUp:"Superior"}},[ue.Axial]:{viewType:"2D",props:{viewDirection:"Superior",viewUp:"Anterior"}},[ue.Three]:{viewType:"3D",props:{viewDirection:"Posterior",viewUp:"Superior"}}},id=xa[ue.Axial],Yo=[{name:"Axial Only",direction:Re.H,items:[ue.Axial]},{name:"Axial Primary",direction:Re.V,items:[ue.Axial,{direction:Re.H,items:[ue.Three,ue.Coronal,ue.Sagittal]}]},{name:"3D Primary",direction:Re.V,items:[ue.Three,{direction:Re.H,items:[ue.Coronal,ue.Sagittal,ue.Axial]}]},{name:"Quad View",direction:Re.H,items:[{direction:Re.V,items:[ue.Coronal,ue.Three]},{direction:Re.V,items:[ue.Sagittal,ue.Axial]}]},{name:"3D Only",direction:Re.H,items:[ue.Three]}].reduce((e,t)=>({...e,[t.name]:t}),{}),Mt={0:[0,0,0,0],1:[153,153,0,255],2:[76,76,0,255],3:[255,255,0,255],4:[0,76,0,255],5:[0,153,0,255],6:[0,255,0,255],7:[76,0,0,255],8:[153,0,0,255],9:[255,0,0,255],10:[0,76,76,255],11:[0,153,153,255],12:[0,255,255,255],13:[0,0,76,255],14:[0,0,153,255]},ad=["#58f24c","#8de4d3","#f0a4b1","#a3c9fe","#c8f251","#fea53b"],sd={red:{color:"red"},green:{color:"#00ff00"},white:{color:"#ffffff"}},rd={artifact:{color:"#888888",fillColor:"#ffbf0040"},innocuous:{color:"#00ff00",fillColor:"#00ff0020"},lesion:{color:"red",fillColor:"transparent"}},ld="q",cd="w",Ko={CT:"CT-AAA",MR:"CT-Coronary-Arteries-2",US:"US-Fetal"},ud=Uint8Array;function dd(e){const t=new ud(e.getNumberOfPoints()),n=Ia.newInstance(e.get("spacing","origin","direction"));return n.getPointData().setScalars(Vi.newInstance({numberOfComponents:1,values:t})),n.setDimensions(e.getDimensions()),n.computeTransforms(),n.setColorMap(Mt),n}function hd(e){const t=Ia.newInstance(e.get("spacing","origin","direction","indexToWorld","worldToIndex","dataDescription","pointData"));return t.setDimensions(e.getDimensions()),t.computeTransforms(),t.setColorMap(Mt),t}const pn=te("labelmap",{state:()=>({idList:[],labelmaps:Object.create(null),parentImage:Object.create(null)}),actions:{newLabelmapFromImage(e){const n=xe().dataIndex[e];if(!n)return null;const s=Ct().nextId(),o=dd(n);return this.idList.push(s),this.parentImage[s]=e,this.labelmaps[s]=o,this.$proxies.addData(s,o),s},async serialize(e){const{labelMaps:t}=e.manifest,{zip:n}=e;await Promise.all(Object.entries(this.labelmaps).map(async([s,o])=>{const i=`labels/${s}.vti`,a=wa(this.parentImage[s]);t.push({id:s,parent:a,path:i});const r=await Il(o);n.file(i,r)}))},async deserialize(e,t,n){const{labelMaps:s}=e,o={};return s.forEach(async i=>{const[a]=t.filter(d=>_t(d.archivePath,d.file.name)===St(i.path)).map(d=>d.file);i.parent=n[i.parent];const{parent:r}=i,l=Ct().nextId();o[i.id]=l;const c=await Gi(a),u=hd(c);this.idList.push(l),this.parentImage[l]=Sa(r),this.labelmaps[l]=u,this.$proxies.addData(l,u)}),o}}});async function gd(e,t,n,s=[{type:Ye.Image}]){const o=navigator.hardwareConcurrency?navigator.hardwareConcurrency:6,i=n[0],a=Math.min(parseInt(o/2,10),Math.max(i.size[i.size.length-1],1),4),r=a.toString(),l=[...Array(a).keys()].map(v=>{const p=[...[...Array(n.length).keys()].map(m=>m.toString()),"0",...t,"--max-total-splits",r,"--split",v.toString(),"--number-of-splits",r,"--memory-io"],f=n.map(m=>({type:Ye.Image,data:Ms(m)}));return[e,p,s,f,_t("/","/itk/pipelines"),_t("/","/itk/pipeline.worker.js")]}),c=new Bs(o,gi),u=await c.runTasks(l).promise;c.terminateWorkers();const h=u.filter(v=>v.returnValue===0).map(({outputs:v})=>v[0].data);return As(h)}const fd=["size","direction","origin","spacing"];function pd(e,t){return fd.map(s=>Zn(e[s],t[s])).every(s=>s)}async function md(e,t){if(pd(e,t))return t;const{size:n,spacing:s,origin:o,direction:i}=e,a=["--size",n.join(","),"--spacing",s.join(","),"--origin",o.join(","),"--direction",i.join(",")];return gd("resample",a,[t])}const Ra=e=>{throw new Error(`Unknown DataSelection: ${e}`)},vd=e=>e.type==="dicom"?e.volumeKey:e.type==="image"?e.dataID:Ra(e),Vt=e=>{const t=vd(e);return`${e.type}::${t}`},Bn=e=>{const[t,n]=e.split("::");return t==="dicom"?Ht(n):t==="image"?Wt(n):Ra(t)},Rt=te("layer",()=>{const e=M({}),t=M({});async function n(h,v){if(!h)throw new Error("Tried to addLayer without parent data selection");const p=Vt(h),f=`${p}::${Vt(v)}`;this.parentToLayers[p]=[...this.parentToLayers[p]??[],{selection:v,id:f}];const[m,w]=await Promise.all([h,v].map(Du));if(!Wr.intersects(m.getBounds(),w.getBounds()))throw this.deleteLayer(h,v),new Error("Image bounds do not intersect, so no overlap in physical space");const T=await md(gn.convertVtkToItkImage(m),gn.convertVtkToItkImage(w)),S=gn.convertItkToVtkImage(T);this.$proxies.addData(f,S),this.layerImages[f]=S}async function s(h,v){return ao("Failed to build layer",()=>this._addLayer(h,v))}function o(h,v){if(!h)throw new Error("Tried to deleteLayer without parent data selection");const p=Vt(h),f=this.parentToLayers[p]??[],m=f.find(({selection:w})=>Lu(w,v));m&&(this.parentToLayers[p]=f.filter(w=>w!==m),delete this.layerImages[m.id],this.$proxies.getData(m.id)&&this.$proxies.deleteData(m.id))}function i(h){if(!h)return[];const v=Vt(h);return e.value[v]??[]}const a=h=>Object.values(e.value).flat().flat().find(({id:v})=>v===h),r=h=>{const v=Rt();v.getLayers(h).forEach(({selection:p})=>v.deleteLayer(h,p)),Object.keys(v.parentToLayers).map(p=>Bn(p)).forEach(p=>v.deleteLayer(p,h))};xe().$onAction(({name:h,args:v})=>{if(h!=="deleteData")return;const[p]=v,f=Wt(p);r(f)}),_e().$onAction(({name:h,args:v})=>{if(h!=="deleteVolume")return;const[p]=v,f=Ht(p);r(f)});function u(h){h.manifest.parentToLayers=Object.entries(this.parentToLayers).map(([v,p])=>({selectionKey:v,sourceSelectionKeys:p.map(({selection:f})=>Vt(f))}))}function d(h,v){const p=m=>{if(m.type==="dicom")return Ht(v[m.volumeKey]);if(m.type==="image")return Wt(v[m.dataID]);const w=m;throw new Error(`invalid selection type ${w}`)},{parentToLayers:f}=h;f.forEach(({selectionKey:m,sourceSelectionKeys:w})=>{const T=p(Bn(m));w.forEach(S=>{const b=p(Bn(S));this.addLayer(T,b)})})}return{parentToLayers:e,layerImages:t,_addLayer:n,addLayer:s,deleteLayer:o,getLayers:i,getLayer:a,serialize:u,deserialize:d}});function Da(e){const t=xe();if(e&&e in t.metadata){const{lpsOrientation:n}=t.metadata[e],s=t.dataIndex[e];if(s){const o=s.getSpatialExtent();return{Sagittal:We(o,"Sagittal",n),Coronal:We(o,"Coronal",n),Axial:We(o,"Axial",n)}}}return aa()}function ce(){const e=xt(),t=_e(),n=xe(),s=Rt(),o=I(()=>{const{primarySelection:u}=e,{volumeToImageID:d}=t;return(u==null?void 0:u.type)==="image"?u.dataID:(u==null?void 0:u.type)==="dicom"&&d[u.volumeKey]||null}),i=I(()=>{const{metadata:u}=n,d=o.value;return d?u[d]:ma()}),a=I(()=>{if(o.value)return n.dataIndex[o.value]}),r=I(()=>Da(o.value)),l=I(()=>!!e.primarySelection&&!e.primaryDataset),c=I(()=>s.getLayers(e.primarySelection).filter(({id:u})=>u in s.layerImages));return{currentImageData:a,currentImageID:o,currentImageMetadata:i,currentImageExtent:r,isImageLoading:l,currentLayers:c}}function An(e,t){return[Math.max(t[0],Math.min(t[1],e[0])),Math.max(t[0],Math.min(t[1],e[1]))]}function ht(e,t,n,s){const{indexToWorld:o,orientation:i,lpsOrientation:a}=t,r=[0,0,0],l=a[n];r[l]=e[n][s],pe(r,r,o);const c=-(s*2-1),u=[...i.slice(l*3,l*3+3).map(d=>d*c)];return zr.newInstance({origin:r,normal:u})}const bt=te("crop",()=>{const e=xe(),t=ze({croppingByImageID:{}}),n=c=>I(()=>{const u=z(c);if(u&&u in t.croppingByImageID&&u in e.metadata){const d=t.croppingByImageID[u],h=e.metadata[u];return[ht(d,h,"Sagittal",0),ht(d,h,"Sagittal",1),ht(d,h,"Coronal",0),ht(d,h,"Coronal",1),ht(d,h,"Axial",0),ht(d,h,"Axial",1)]}return null}),s=(c,u)=>{const d=Da(c);return{Sagittal:An(u.Sagittal,d.Sagittal),Coronal:An(u.Coronal,d.Coronal),Axial:An(u.Axial,d.Axial)}},o=(c,u)=>{t.croppingByImageID[c]=s(c,u)},i=(c,u,d)=>{c in t.croppingByImageID&&o(c,{...t.croppingByImageID[c],[u]:d})},a=c=>{const u=e.dataIndex[c];if(!u)return;const{lpsOrientation:d}=e.metadata[c],h=u.getSpatialExtent();o(c,{Sagittal:We(h,"Sagittal",d),Coronal:We(h,"Coronal",d),Axial:We(h,"Axial",d)})};function r(c){const{tools:u}=c.manifest;u.crop=t.croppingByImageID}function l(c,u){const d=c.tools.crop;Object.entries(d).forEach(([h,v])=>{const p=u[h];o(p,v)})}return{croppingByImageID:Fs(t.croppingByImageID),getComputedVTKPlanes:n,setCropping:o,setCroppingForAxis:i,resetCropping:a,serialize:r,deserialize:l}});function yd(){return Ei.createBuilder().addField({name:"placed",initialValue:!1}).addField({name:"indexToWorld",initialValue:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}).addField({name:"worldToIndex",initialValue:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}).addStateFromMixin({labels:["handle"],mixins:["origin","bounds"],name:"handle",initialValues:{origin:null}}).build()}function wd(e,t){return t.map((n,s)=>Math.max(e[s*2],Math.min(e[s*2+1],n)))}function Sd(e,t){t.classHierarchy.push("vtkCrosshairsWidgetProp");let n=!1;_.setGet(e,t,["manipulator"]);function s(o){return o.altKey||o.controlKey||o.shiftKey}e.handleLeftButtonPress=o=>!t.pickable||s(o)?_.VOID:(t.widgetState.setPlaced(!0),n=!0,t._interactor.requestAnimation(e),t._apiSpecificRenderWindow.setCursor("crosshairs"),e.invokeStartInteractionEvent(),e.handleMouseMove(o),_.EVENT_ABORT),e.handleMouseMove=o=>{if((!t.widgetState.getPlaced()||n)&&t.pickable&&t.manipulator&&!s(o)){const i=t.manipulator.handleEvent(o,t._apiSpecificRenderWindow),a=t.widgetState.getHandle(),r=t.widgetState.getWorldToIndex(),l=t.widgetState.getIndexToWorld();if(r.length&&l.length){const c=Ee(),u=Ee(),d=a.getBounds();pe(c,i,r);const h=wd(d,c);return pe(u,h,l),a.setOrigin(u),e.invokeInteractionEvent(),_.EVENT_ABORT}}return _.VOID},e.handleLeftButtonRelease=()=>{n&&t.pickable&&(t._interactor.cancelAnimation(e),t._apiSpecificRenderWindow.setCursor("default"),e.invokeEndInteractionEvent()),n=!1},e.grabFocus=()=>{},e.loseFocus=()=>{}}function _d(e,t){t.classHierarchy.push("vtkCrosshairsWidget"),t.behavior=Sd,t.widgetState=yd(),e.getRepresentationsForViewType=n=>{switch(n){case Qe.DEFAULT:case Qe.GEOMETRY:case Qe.SLICE:case Qe.VOLUME:default:return[]}},t.widgetState.onBoundsChange(n=>{const s=[(n[0]+n[1])*.5,(n[2]+n[3])*.5,(n[4]+n[5])*.5];t.widgetState.getHandle().setOrigin(s)}),t.manipulator=je.newInstance()}const Cd={};function La(e,t,n={}){Object.assign(t,Cd,n),vn.extend(e,t,n),_.setGet(e,t,["manipulator"]),_d(e,t)}const bd=_.newInstance(La,"vtkCrosshairsWidget"),Td={newInstance:bd,extend:La};function Tt(e,t,n,s){t in e||(e[t]={}),e[t][n]={...e[t][n],...s}}function en(e,t){Object.keys(e).forEach(n=>{delete e[n][t]})}function tn(e,t,n){var s;return t==null||n==null?null:(s=e[t])==null?void 0:s[n]}const Id=(e,t,n)=>{const s=e.manifest.datasets.map(i=>i.id),{views:o}=e.manifest;o.forEach(i=>{s.forEach(a=>{var c;const{config:r}=i,l=(c=t[i.id])==null?void 0:c[a];if(l!==void 0){const u=yl(a,r,{});u[n]=l}})})},nn=(e,t)=>n=>{Id(n,e,t)},lo=()=>({slice:0,min:0,max:1,axisDirection:"Inferior"}),Dt=te("viewSlice",()=>{const e=ze({}),t=(l,c)=>tn(e,l,c),n=(l,c,u)=>{const d={...lo(),...t(l,c),...u};d.slice=zi(d.slice,d.min,d.max),Tt(e,l,c,d)},s=(l,c)=>{const u=t(l,c);u&&n(l,c,{slice:Math.ceil((u.min+u.max)/2)})},o=l=>{delete e[l]},i=(l,c)=>{var u;c?(u=e[c])==null||delete u[l]:en(e,l)},a=nn(e,"slice");return{configs:e,getConfig:t,updateConfig:n,resetSlice:s,removeView:o,removeData:i,serialize:a,deserialize:(l,c)=>{Object.entries(c).forEach(([u,d])=>{d.slice&&n(l,u,d.slice)})}}}),Ea=()=>({width:1,level:.5,min:0,max:1}),co=te("windowing",()=>{const e=ze({}),t=M(!0),n=d=>{t.value=d},s=(d,h)=>tn(e,d,h),o=(d,h)=>{var p;if(!t.value)return;const v=(p=e[d])==null?void 0:p[h];v&&Object.keys(e).filter(f=>f!==d).forEach(f=>{Tt(e,f,h,v)})},i=(d,h,v)=>{var p;Tt(e,d,h,{...Ea(),...(p=e[d])==null?void 0:p[h],...v}),t.value&&o(d,h)},a=(d,h)=>{var m;const v=(m=e[d])==null?void 0:m[h];if(v==null)return;const p=v.max-v.min,f=(v.max+v.min)/2;i(d,h,{width:p,level:f})},r=d=>{delete e[d]},l=(d,h)=>{var v;h?(v=e[h])==null||delete v[d]:en(e,d)},c=nn(e,"window");return{configs:e,getConfig:s,setSyncAcrossViews:n,updateConfig:i,resetWindowLevel:a,removeView:r,removeData:l,serialize:c,deserialize:(d,h)=>{Object.entries(h).forEach(([v,p])=>{p.window&&i(d,v,p.window)})}}});function Oa(e,t){var s,o;const n=(o=(s=t.getRenderWindow())==null?void 0:s.getViews())==null?void 0:o[0];if(n){const[i,a,r]=e;return n.worldToDisplay(i,a,r,t)}return null}function xd(e,t){const n=t.getCanvas();if(!n)return null;const s=n.getBoundingClientRect(),o=n.width/s.width,i=n.height/s.height;return[o*(e.clientX-s.left),i*(s.height-e.clientY+s.top)]}function Rd(e,t,n,s){var a;const o=(a=t.getRenderWindow())==null?void 0:a.getViews()[0];if(!o)return null;const i=xd(e,o);return i?jr(i[0],i[1],n,s,t,o):null}function zt(e,t){var o,i;const n=Oa(e,t),s=(i=(o=t.getRenderWindow())==null?void 0:o.getViews())==null?void 0:i[0];if(n&&s){const[,a]=s.getViewportSize(t);return[n[0]/devicePixelRatio,(a-n[1])/devicePixelRatio]}return null}function uo(e){var o,i,a;const{pokedRenderer:t}=e,n=(i=(o=t==null?void 0:t.getRenderWindow())==null?void 0:o.getViews())==null?void 0:i[0],s=(a=n==null?void 0:n.getContainer())==null?void 0:a.getBoundingClientRect();return!("position"in e)||!s?null:[s.left+e.position.x/devicePixelRatio,s.top+s.height-e.position.y/devicePixelRatio]}function Dd(e,t,n){const s=yn.getPresetByName(e);if(s.OpacityPoints){const o=s.OpacityPoints,i=[];for(let c=0;c<o.length;c+=2)i.push([o[c],o[c+1]]);const[a,r]=t,l=r-a;return i.map(([c,u])=>[(c-a)/l+n,u])}return null}function Va(e){return yn.getPresetByName(e).OpacityPoints?{mode:Le.Mode.Points,preset:e,shift:0}:{mode:Le.Mode.Gaussians,gaussians:JSON.parse(JSON.stringify(Le.Defaults.Gaussians))}}function Pa(e){const t=yn.getPresetByName(e);if(!t)return null;const{AbsoluteRange:n,RGBPoints:s}=t;if(n&&s){let o=1/0,i=-1/0;for(let a=0;a<s.length;a+=4)o=Math.min(o,s[a]),i=Math.max(i,s[a]);return[o,i]}return null}const Ld=[{Name:"CT-AAA",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,143.556,0,166.222,.686275,214.389,.696078,419.736,.833333,3071,.803922],RGBPoints:[-3024,0,0,0,143.556,.615686,.356863,.184314,166.222,.882353,.603922,.290196,214.389,1,1,1,419.736,1,.937033,.954531,3071,.827451,.658824,1],EffectiveRange:[143.556,419.736]},{Name:"CT-AAA2",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,129.542,0,145.244,.166667,157.02,.5,169.918,.627451,395.575,.8125,1578.73,.8125,3071,.8125],RGBPoints:[-3024,0,0,0,129.542,.54902,.25098,.14902,145.244,.6,.627451,.843137,157.02,.890196,.47451,.6,169.918,.992157,.870588,.392157,395.575,1,.886275,.658824,1578.73,1,.829256,.957922,3071,.827451,.658824,1],EffectiveRange:[0,1600]},{Name:"CT-Bone",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-16.4458,0,641.385,.715686,3071,.705882],RGBPoints:[-3024,0,0,0,-16.4458,.729412,.254902,.301961,641.385,.905882,.815686,.552941,3071,1,1,1],EffectiveRange:[-16.4458,641.385]},{Name:"CT-Bones",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-1e3,0,152.19,0,278.93,.190476,952,.2],RGBPoints:[-1e3,.3,.3,1,-488,.3,1,.3,463.28,1,0,0,659.15,1,.912535,.0374849,953,1,.3,.3],EffectiveRange:[152.19,952]},{Name:"CT-Cardiac",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-77.6875,0,94.9518,.285714,179.052,.553571,260.439,.848214,3071,.875],RGBPoints:[-3024,0,0,0,-77.6875,.54902,.25098,.14902,94.9518,.882353,.603922,.290196,179.052,1,.937033,.954531,260.439,.615686,0,0,3071,.827451,.658824,1],EffectiveRange:[-77.6875,260.439]},{Name:"CT-Cardiac2",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,42.8964,0,163.488,.428571,277.642,.776786,1587,.754902,3071,.754902],RGBPoints:[-3024,0,0,0,42.8964,.54902,.25098,.14902,163.488,.917647,.639216,.0588235,277.642,1,.878431,.623529,1587,1,1,1,3071,.827451,.658824,1],EffectiveRange:[42.8964,1587]},{Name:"CT-Cardiac3",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-86.9767,0,45.3791,.169643,139.919,.589286,347.907,.607143,1224.16,.607143,3071,.616071],RGBPoints:[-3024,0,0,0,-86.9767,0,.25098,1,45.3791,1,0,0,139.919,1,.894893,.894893,347.907,1,1,.25098,1224.16,1,1,1,3071,.827451,.658824,1],EffectiveRange:[-86.9767,1224.16]},{Name:"CT-Chest-Contrast-Enhanced",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,67.0106,0,251.105,.446429,439.291,.625,3071,.616071],RGBPoints:[-3024,0,0,0,67.0106,.54902,.25098,.14902,251.105,.882353,.603922,.290196,439.291,1,.937033,.954531,3071,.827451,.658824,1],EffectiveRange:[67.0106,439.291]},{Name:"CT-Chest-Vessels",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-1278.35,0,22.8277,.428571,439.291,.625,3071,.616071],RGBPoints:[-3024,0,0,0,-1278.35,.54902,.25098,.14902,22.8277,.882353,.603922,.290196,439.291,1,.937033,.954531,3071,.827451,.658824,1],EffectiveRange:[-1278.35,439.291]},{Name:"CT-Coronary-Arteries",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,136.47,0,159.215,.258929,318.43,.571429,478.693,.776786,3661,1],RGBPoints:[-2048,0,0,0,136.47,0,0,0,159.215,.159804,.159804,.159804,318.43,.764706,.764706,.764706,478.693,1,1,1,3661,1,1,1],EffectiveRange:[136.47,478.693]},{Name:"CT-Coronary-Arteries-2",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,142.677,0,145.016,.116071,192.174,.5625,217.24,.776786,384.347,.830357,3661,.830357],RGBPoints:[-2048,0,0,0,142.677,0,0,0,145.016,.615686,0,.0156863,192.174,.909804,.454902,0,217.24,.972549,.807843,.611765,384.347,.909804,.909804,1,3661,1,1,1],EffectiveRange:[142.677,384.347]},{Name:"CT-Coronary-Arteries-3",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,128.643,0,129.982,.0982143,173.636,.669643,255.884,.857143,584.878,.866071,3661,1],RGBPoints:[-2048,0,0,0,128.643,0,0,0,129.982,.615686,0,.0156863,173.636,.909804,.454902,0,255.884,.886275,.886275,.886275,584.878,.968627,.968627,.968627,3661,1,1,1],EffectiveRange:[128.643,584.878]},{Name:"CT-Cropped-Volume-Bone",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,-451,0,-450,1,1050,1,3661,1],RGBPoints:[-2048,0,0,0,-451,0,0,0,-450,.0556356,.0556356,.0556356,1050,1,1,1,3661,1,1,1],EffectiveRange:[-451,1050]},{Name:"CT-Fat",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-1e3,0,-100,0,-99,.15,-60,.15,-59,0,101.2,0,952,0],RGBPoints:[-1e3,.3,.3,1,-497.5,.3,1,.3,-99,0,0,1,-76.946,0,1,0,-65.481,.835431,.888889,.0165387,83.89,1,0,0,463.28,1,0,0,659.15,1,.912535,.0374849,2952,1,.300267,.299886],EffectiveRange:[-100,101.2]},{Name:"CT-Liver-Vasculature",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,149.113,0,157.884,.482143,339.96,.660714,388.526,.830357,1197.95,.839286,3661,.848214],RGBPoints:[-2048,0,0,0,149.113,0,0,0,157.884,.501961,.25098,0,339.96,.695386,.59603,.36886,388.526,.854902,.85098,.827451,1197.95,1,1,1,3661,1,1,1],EffectiveRange:[149.113,1197.95]},{Name:"CT-Lung",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-1e3,0,-600,0,-599,.15,-400,.15,-399,0,2952,0],RGBPoints:[-1e3,.3,.3,1,-600,0,0,1,-530,.134704,.781726,.0724558,-460,.929244,1,.109473,-400,.888889,.254949,.0240258,2952,1,.3,.3],EffectiveRange:[-600,-399]},{Name:"CT-MIP",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-637.62,0,700,1,3071,1],RGBPoints:[-3024,0,0,0,-637.62,1,1,1,700,1,1,1,3071,1,1,1],EffectiveRange:[-637.62,700]},{Name:"CT-Muscle",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-155.407,0,217.641,.676471,419.736,.833333,3071,.803922],RGBPoints:[-3024,0,0,0,-155.407,.54902,.25098,.14902,217.641,.882353,.603922,.290196,419.736,1,.937033,.954531,3071,.827451,.658824,1],EffectiveRange:[-155.407,419.736]},{Name:"CT-Pulmonary-Arteries",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,-568.625,0,-364.081,.0714286,-244.813,.401786,18.2775,.607143,447.798,.830357,3592.73,.839286],RGBPoints:[-2048,0,0,0,-568.625,0,0,0,-364.081,.396078,.301961,.180392,-244.813,.611765,.352941,.0705882,18.2775,.843137,.0156863,.156863,447.798,.752941,.752941,.752941,3592.73,1,1,1],EffectiveRange:[-568.625,447.798]},{Name:"CT-Soft-Tissue",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,-167.01,0,-160,1,240,1,3661,1],RGBPoints:[-2048,0,0,0,-167.01,0,0,0,-160,.0556356,.0556356,.0556356,240,1,1,1,3661,1,1,1],EffectiveRange:[-167.01,240]},{Name:"CT-Air",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,.705882,-900,.715686,-500,0,3071,0],RGBPoints:[-3024,1,1,1,-900,.2,1,1,-500,.3,.3,1,3071,0,0,0],EffectiveRange:[-1200,-200]},{Name:"CT-X-ray",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-200,0,1500,.05,3071,.05],RGBPoints:[-3024,1,1,1,3071,1,1,1],EffectiveRange:[-250,1550]},{Name:"MR-Angio",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,151.354,0,158.279,.4375,190.112,.580357,200.873,.732143,3661,.741071],RGBPoints:[-2048,0,0,0,151.354,0,0,0,158.279,.74902,.376471,0,190.112,1,.866667,.733333,200.873,.937255,.937255,.937255,3661,1,1,1],EffectiveRange:[151.354,200.873]},{Name:"MR-Default",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[0,0,20,0,40,.15,120,.3,220,.375,1024,.5],RGBPoints:[0,0,0,0,20,.168627,0,0,40,.403922,.145098,.0784314,120,.780392,.607843,.380392,220,.847059,.835294,.788235,1024,1,1,1],EffectiveRange:[0,220]},{Name:"MR-MIP",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[0,0,98.3725,0,416.637,1,2800,1],RGBPoints:[0,1,1,1,98.3725,1,1,1,416.637,1,1,1,2800,1,1,1],EffectiveRange:[0,416.637]},{Name:"MR-T2-Brain",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[0,0,36.05,0,218.302,.171429,412.406,1,641,1],RGBPoints:[0,0,0,0,98.7223,.956863,.839216,.192157,412.406,0,.592157,.807843,641,1,1,1],EffectiveRange:[0,412.406]},{Name:"DTI-FA-Brain",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[0,0,0,0,.3501,.0158,.49379,.7619,.6419,1,.992,1,.995,0,.995,0],RGBPoints:[0,1,0,0,0,1,0,0,.24974,.4941,1,0,.49949,0,.9882,1,.7492,.51764,0,1,.995,1,0,0,.995,1,0,0],EffectiveRange:[0,1]},{Name:"US-Fetal",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-10,0,0,0,270,.8],RGBPoints:[-10,.325,.153,.153,74,.474,.392,.302,136,.718,.51,.443,270,.76,.44,.53],EffectiveRange:[-10,270]},{ColorSpace:"Lab",Name:"2hot",RGBPoints:[-1,.0416667,0,0,-.873016,.208333,0,0,-.746032,.375,0,0,-.619048,.541667,0,0,-.492063,.708333,0,0,-.365079,.854137,0,0,-.238095,.937488,.039062,0,-.111111,1,.208333,0,.015873,1,.375,0,.142857,1,.541667,0,.269841,1,.708333,0,.396825,1,.858805,.03125,.52381,1,.947392,.15625,.650794,1,1,.3125,.777778,1,1,.5625,.904762,1,1,.8125,1,1,1,1]}];function Ed(e){for(let t=0;t<e.length;t+=1)yn.addPreset(e[t])}Ed(Ld);const Od=[{group:"CT",presets:["CT-AAA","CT-AAA2","CT-Bone","CT-Bones","CT-Cardiac","CT-Cardiac2","CT-Cardiac3","CT-Chest-Contrast-Enhanced","CT-Chest-Vessels","CT-Coronary-Arteries","CT-Coronary-Arteries-2","CT-Coronary-Arteries-3","CT-Cropped-Volume-Bone","CT-Fat","CT-Liver-Vasculature","CT-Lung","CT-MIP","CT-Muscle","CT-Pulmonary-Arteries","CT-Soft-Tissue","CT-Air","CT-X-ray"]},{group:"MR",presets:["MR-Default","MR-Angio","MR-MIP","MR-T2-Brain"]},{group:"DTI",presets:["DTI-FA-Brain"]},{group:"US",presets:["US-Fetal"]}],jn="CT-AAA";Od.flatMap(e=>e.presets);const Vd={PT:"2hot"};function Pd(e){const n=Rt().getLayer(e);if(n&&n.selection.type==="dicom"){const s=_e(),{Modality:o=void 0}=s.volumeInfo[n.selection.volumeKey];return o&&Vd[o]||jn}return jn}const Qo=()=>({colorBy:{arrayName:"",location:"pointData"},transferFunction:{preset:"",mappingRange:[0,1]},opacityFunction:{mode:Le.Mode.Gaussians,gaussians:[],mappingRange:[0,1]},blendConfig:{opacity:.6}}),ka=te("layerColoring",()=>{const e=ze({}),t=(p,f)=>tn(e,p,f),n=(p,f,m)=>{const w={...Qo(),...t(p,f),...m};Tt(e,p,f,w)},s=(p,f=Hi)=>(m,w,T)=>{const S=t(m,w)??Qo(),b=f({...S[p],...T});n(m,w,{[p]:b})},o=s("colorBy"),i=s("transferFunction"),a=s("opacityFunction"),r=s("blendConfig"),l=(p,f,m)=>{const T=Rt().layerImages[f];if(!T)return;const S=T.getPointData().getScalars().getRange(),b=Pa(m);i(p,f,{preset:m,mappingRange:b||S});const D=Va(m);D.mappingRange=S,a(p,f,D)},c=(p,f,m)=>{const w=m.getPointData().getScalars();o(p,f,{arrayName:w.getName()+f,location:"pointData"}),l(p,f,Pd(f))},u=p=>{delete e[p]},d=(p,f)=>{var m;f?(m=e[f])==null||delete m[p]:en(e,p)},h=nn(e,"layers");return{configs:e,getConfig:t,updateConfig:n,updateColorBy:o,updateColorTransferFunction:i,updateOpacityFunction:a,updateBlendConfig:r,resetToDefault:c,setColorPreset:l,removeView:u,removeData:d,serialize:h,deserialize:(p,f)=>{Object.entries(f).forEach(([m,w])=>{w.layers&&n(p,m,w.layers)})}}}),ho=te("viewCamera",()=>{const e=ze({}),t=(r,l)=>tn(e,r,l),n=(r,l,c)=>{const u={...t(r,l),...c};Tt(e,r,l,u)},s=r=>{delete e[r]},o=(r,l)=>{var c;l?(c=e[l])==null||delete c[r]:en(e,r)},i=nn(e,"camera");return{configs:e,getConfig:t,updateConfig:n,removeView:s,removeData:o,serialize:i,deserialize:(r,l)=>{Object.entries(l).forEach(([c,u])=>{u.camera&&n(r,c,u.camera)})}}}),kd=.2,Md=.7,Bd=.3;function Ad(e){const t=_e();if(e in t.imageIDToVolumeKey){const n=t.imageIDToVolumeKey[e],{Modality:s}=t.volumeInfo[n];if(s in Ko)return Ko[s]}return jn}const Zo=()=>({colorBy:{arrayName:"",location:"pointData"},transferFunction:{preset:"",mappingRange:[0,1]},opacityFunction:{mode:Le.Mode.Gaussians,gaussians:[],mappingRange:[0,1]},cvr:{enabled:!0,lightFollowsCamera:!0,volumeQuality:2,useVolumetricScatteringBlending:!0,volumetricScatteringBlending:.5,useLocalAmbientOcclusion:!0,laoKernelRadius:5,laoKernelSize:15,ambient:kd,diffuse:Md,specular:Bd}}),Fd=te("volumeColoring",()=>{const e=ze({}),t=(p,f)=>tn(e,p,f),n=(p,f,m)=>{const w={...Zo(),...t(p,f),...m};Tt(e,p,f,w)},s=(p,f=Hi)=>(m,w,T)=>{const S=t(m,w)??Zo(),b=f({...S[p],...T});n(m,w,{[p]:b})},o=s("colorBy"),i=s("transferFunction"),a=s("opacityFunction"),r=s("cvr"),l=(p,f,m)=>{const T=xe().dataIndex[f];if(!T)return;const S=T.getPointData().getScalars().getRange(),b=Pa(m);i(p,f,{preset:m,mappingRange:b||S});const D=Va(m);D.mappingRange=S,a(p,f,D)},c=(p,f,m)=>{const w=m.getPointData().getScalars();o(p,f,{arrayName:w.getName(),location:"pointData"}),l(p,f,Ad(f))},u=p=>{delete e[p]},d=(p,f)=>{var m;f?(m=e[f])==null||delete m[p]:en(e,p)},h=nn(e,"volumeColorConfig");return{configs:e,getConfig:t,updateConfig:n,updateColorBy:o,updateColorTransferFunction:i,updateOpacityFunction:a,updateCVRParameters:r,resetToDefaultColoring:c,setColorPreset:l,removeView:u,removeData:d,serialize:h,deserialize:(p,f)=>{Object.entries(f).forEach(([m,w])=>{w.volumeColorConfig&&n(p,m,w.volumeColorConfig)})}}}),Jo=te("viewConfig",()=>{const e=Dt(),t=co(),n=ka(),s=ho(),o=Fd(),i=u=>{e.removeView(u),t.removeView(u),n.removeView(u),s.removeView(u),o.removeView(u)},a=(u,d)=>{e.removeData(u,d),t.removeData(u,d),n.removeData(u,d),s.removeData(u,d),o.removeData(u,d)},r=u=>{e.serialize(u),t.serialize(u),n.serialize(u),s.serialize(u),o.serialize(u)},l=(u,d,h)=>{const v={};Object.entries(d).forEach(([p,f])=>{const m=h[p];v[m]=f}),e.deserialize(u,v),t.deserialize(u,v),n.deserialize(u,v),s.deserialize(u,v),o.deserialize(u,v)};return xe().$onAction(({name:u,args:d})=>{if(u==="deleteData"){const[h]=d;a(h)}}),{removeView:i,removeData:a,serialize:r,deserialize:l}}),de=te("view",{state:()=>({layout:{direction:Re.V,items:[]},viewSpecs:structuredClone(xa)}),getters:{viewIDs(e){return Object.keys(e.viewSpecs)},getViewProxy(){return e=>this.$proxies.getView(e)},getDataRepresentationForView(){return(e,t)=>this.$proxies.getDataRepresentationForView(e,t)}},actions:{createOrGetViewProxy(e,t){return this.$proxies.getView(e)??this.$proxies.createView(e,t)},addView(e){e in this.viewSpecs||(this.viewSpecs[e]=structuredClone(id))},removeView(e){e in this.viewSpecs&&(delete this.viewSpecs[e],this.$proxies.removeView(e))},setLayout(e){this.layout=e;const t=[e];for(;t.length;)t.shift().items.forEach(s=>{typeof s=="string"?this.addView(s):t.push(s)})},serialize(e){const t=Jo(),{manifest:n}=e,{views:s}=n;n.layout=this.layout,Object.entries(this.viewSpecs).forEach(([o,i])=>{const a=i.viewType,{props:r}=i,c={id:o,type:a,props:r,config:{}};s.push(c)}),t.serialize(e)},deserialize(e,t){const n=Jo();e.forEach(s=>{const o=s.id,i={viewType:s.type,props:s.props};this.viewSpecs[o]=i;const{config:a}=s;n.deserialize(o,a,t)})}}}),jt=te("crosshairs",()=>{const e=Td.newInstance(),t=e.getWidgetState(),n=t.getHandle(),s=M(!1),{currentImageID:o,currentImageMetadata:i}=ce(),a=M([0,0,0]),r=I(()=>{const w=Ee();return pe(w,a.value,i.value.worldToIndex),w}),l=Dt(),c=de(),u=I(()=>{const w=z(o);return w?c.viewIDs.filter(T=>!!l.getConfig(T,w)):[]});function d(){return e}function h(w){a.value=w}F(r,w=>{if(s.value){const T=z(o),{lpsOrientation:S}=z(i);if(!T)return;u.value.forEach(b=>{const O=l.getConfig(b,T),D=Te(O.axisDirection),k=S[D],E=Math.round(w[k]);l.updateConfig(b,T,{slice:E})})}}),F(i,w=>{t.setIndexToWorld(w.indexToWorld),t.setWorldToIndex(w.worldToIndex);const[T,S,b]=w.dimensions,O=[0,T-1,0,S-1,0,b-1];n.setBounds(Gr(O,.5))},{immediate:!0}),n.onModified(()=>{const w=n.getOrigin();w&&(a.value=w)});function v(){return t.setPlaced(!1),s.value=!0,!0}function p(){s.value=!1}function f(w){const{crosshairs:T}=w.manifest.tools;T.position=a.value}function m(w){const{crosshairs:T}=w.tools;a.value=T.position}return{getWidgetFactory:d,setPosition:h,position:a,imagePosition:r,activateTool:v,deactivateTool:p,serialize:f,deserialize:m}}),Nd=4,$d=1,lt=te("paint",()=>{const e=M(null),t=M(Nd),n=M($d),s=M([]),o=M(1),i=M(!1),{currentImageID:a}=ce();function r(){return this.$paint.factory}const l=I(()=>e.value?pn().labelmaps[e.value]??null:null);function c(D){if(!D){e.value=null;return}const k=pn(),E=Object.entries(k.parentImage).find(([,$])=>D===$);E?[e.value]=E:e.value=k.newLabelmapFromImage(D)}function u(D){t.value=Math.round(D),this.$paint.setBrushSize(D)}function d(D){n.value=D,this.$paint.setBrushValue(D)}function h(D){o.value=Math.min(1,Math.max(0,D))}function v(D){if(!l.value)return;const k=s.value.length-1;if(k>=0){const E=s.value[k],$=k>=1?s.value[k-1]:void 0;this.$paint.paintLabelmap(l.value,D,E,$)}}function p(D){if(!l.value)return;const k=l.value.getSpacing();k.splice(D,1);const E=[1/k[0],1/k[1]];this.$paint.setBrushScale(E)}function f(D,k){s.value=[fi(D)],v.call(this,k)}function m(D,k){s.value.push(D),v.call(this,k)}function w(D,k){s.value.push(D),v.call(this,k)}function T(){const D=a.value;return D?(c(D),this.$paint.setBrushSize(this.brushSize),i.value=!0,!0):!1}function S(){e.value=null,i.value=!1}function b(D){const{paint:k}=D.manifest.tools;k.activeLabelmapID=e.value,k.brushSize=t.value,k.brushValue=n.value,k.labelmapOpacity=o.value}function O(D,k){const{paint:E}=D.tools;this.setBrushSize(E.brushSize),this.setBrushValue(E.brushValue),this.setLabelmapOpacity(E.labelmapOpacity),i.value=D.tools.current===oe.Paint,E.activeLabelmapID!==null&&(e.value=k[E.activeLabelmapID])}return F(a,D=>{i.value&&c(D)}),{activeLabelmapID:e,brushSize:t,brushValue:n,strokePoints:s,labelmapOpacity:o,isActive:i,getWidgetFactory:r,activateTool:T,deactivateTool:S,selectOrCreateLabelmap:c,setBrushSize:u,setBrushValue:d,setLabelmapOpacity:h,setSliceAxis:p,startStroke:f,placeStrokePoint:m,endStroke:w,serialize:b,deserialize:O}}),ei=Ee();function Cn(e,t,n){const s=(n==null?void 0:n.epsilon)??Yn,o=(n==null?void 0:n.allowNonIntegralSlice)??!1,i=(n==null?void 0:n.allowOutOfBoundsSlice)??!1,{planeNormal:a,planeOrigin:r}=e,{dimensions:l,lpsOrientation:c,worldToIndex:u}=t;let d=null;const{Left:h,Right:v,Posterior:p,Anterior:f,Superior:m,Inferior:w}=c;if(st(h,a)||st(v,a)?d="Sagittal":st(p,a)||st(f,a)?d="Coronal":(st(m,a)||st(w,a))&&(d="Axial"),!d)return null;pe(ei,r,u);const T=c[d],S=wl(ei[T],s);return!o&&!Number.isInteger(S)||!i&&(S<0||S>=l[T])?null:{axis:d,slice:S}}const Ud={labelName:"New Label"},Hd=e=>{const t=M({}),n=M(),s=d=>{n.value=d},o=(d={})=>{const h=Ct().nextId();return t.value[h]={...Ud,...e,...d},s(h),h},i=d=>{if(!(d in t.value))throw new Error("Label does not exist");if(delete t.value[d],t.value={...t.value},d===n.value){const h=Object.keys(t.value);h.length!==0?s(h[0]):s("")}},a=(d,h)=>{if(!(d in t.value))throw new Error("Label does not exist");t.value={...t.value,[d]:{...t.value[d],...h}}},r=M(!0),l=()=>{r.value&&(t.value={}),r.value=!1},c=(d,h=!0)=>{h&&l();const{labelName:v}=d,p=Object.entries(t.value).find(([,{labelName:f}])=>f===v);if(p){const[f]=p;return a(f,d),f}return o(d)};return{labels:t,activeLabel:n,setActiveLabel:s,addLabel:o,deleteLabel:i,updateLabel:a,mergeLabel:c,mergeLabels:(d,h=!0)=>{Object.entries(d??{}).forEach(([v,p])=>c({...p,labelName:v},h))}}},Wd=()=>({frameOfReference:{planeOrigin:[0,0,0],planeNormal:[1,0,0]},slice:-1,imageID:"",placing:!1,color:ad[0],name:"baseAnnotationTool"}),go=({toolDefaults:e,initialLabels:t,newLabelDefault:n})=>{const s=M([]),o=M(Object.create(null)),i=I(()=>{const m=o.value;return s.value.map(w=>m[w])}),a=Hd(n);a.mergeLabels(t,!1);function r(m){if(!m)return{labelName:""};const w=a.labels.value[m];return w||{labelName:""}}function l(m){const w=Ct().nextId();if(w in o.value)throw new Error("Cannot add tool with conflicting ID");return o.value[w]={...Wd(),...e(),label:a.activeLabel.value,...m,...r(m.label),id:w},s.value.push(w),w}function c(m){m in o.value&&(Ut(s.value,m),delete o.value[m])}function u(m,w){m in o.value&&(o.value[m]={...o.value[m],...w,id:m})}F(a.labels,()=>{s.value.forEach(m=>{const w=o.value[m],T=r(w.label);u(m,{...w,...T})})});function d(m){const w=o.value[m],{currentImageID:T,currentImageMetadata:S}=ce(),b=T.value;if(!b||w.imageID!==b)return;const O=Cn(w.frameOfReference,S.value);if(!O)return;const D=de(),k=D.viewIDs.filter($=>{const Z=D.viewSpecs[$].props.viewDirection;return Z&&Te(Z)===O.axis}),E=Dt();k.forEach($=>{E.updateConfig($,b,{slice:w.slice})})}const h=()=>!0,v=()=>{},p=()=>({tools:s.value.map(w=>o.value[w]).filter(w=>!w.placing).map(({imageID:w,...T})=>({imageID:wa(w),...T})),labels:a.labels.value});function f(m,w){const T=Object.fromEntries(Object.entries((m==null?void 0:m.labels)??{}).map(([S,b])=>{const O=a.mergeLabel(b);return[S,O]}));m==null||m.tools.map(({imageID:S,label:b,...O})=>({...O,imageID:Sa(w[S]),label:b&&T[b]||""})).forEach(S=>l.call(this,S))}return{...a,toolIDs:s,toolByID:o,tools:i,addTool:l,removeTool:c,updateTool:u,jumpToTool:d,activateTool:h,deactivateTool:v,serialize:p,deserialize:f}},zd=()=>({firstPoint:[0,0,0],secondPoint:[0,0,0],id:"",name:"Ruler"}),jd={color:"#ffffff"},Fe=te("ruler",()=>{const{toolIDs:e,toolByID:t,tools:n,addTool:s,updateTool:o,removeTool:i,jumpToTool:a,serialize:r,deserialize:l,activateTool:c,deactivateTool:u,...d}=go({toolDefaults:zd,initialLabels:sd,newLabelDefault:jd}),h=I(()=>{const f=t.value;return e.value.reduce((m,w)=>{const{firstPoint:T,secondPoint:S}=f[w];return Object.assign(m,{[w]:Math.sqrt(Pi(T,S))})},{})});function v(f){f.manifest.tools.rulers=r()}function p(f,m){l.call(this,f.tools.rulers,m)}return{...d,rulerIDs:e,rulerByID:t,rulers:n,lengthByID:h,addRuler:s,updateRuler:o,removeRuler:i,jumpToRuler:a,serialize:v,deserialize:p,activateTool:c,deactivateTool:u}}),Gd=()=>({firstPoint:[0,0,0],secondPoint:[0,0,0],id:"",name:"Rectangle",fillColor:"transparent"}),Xd={color:"#ffffff",fillColor:"transparent"},Ne=te("rectangles",()=>{const{serialize:e,deserialize:t,...n}=go({toolDefaults:Gd,initialLabels:rd,newLabelDefault:Xd});function s(i){i.manifest.tools.rectangles=e()}function o(i,a){t.call(this,i.tools.rectangles,a)}return{...n,serialize:s,deserialize:o}});function Ma(){return{t:mt(),_tInv:null}}const Bt=Ee(),ti=mi();function bn(e,t,n){const s=n??Ee();return yi(Bt,e[0],e[1],0),pe(s,Bt,t.t),s}function Ba(e){const t=mt();return Ns(t,e),t}function qd(e){return e._tInv=e._tInv??Ba(e.t),e._tInv}function et(e,t,n){const s=n??Be(),o=qd(t);return pe(Bt,e,o),vt(s,Bt[0],Bt[1]),s}function Yd(e){const t=[0,0,0];pe(t,t,e.t);const n=[0,0,1];return $s(ti,e.t),Us(n,n,ti),Hs(n,n),{planeNormal:n,planeOrigin:t}}const Kd={0:Pt(0,1,0,0,0,0,1,0,1,0,0,0,0,0,0,1),1:Pt(1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1),2:mt()};function Qd(e,t,n){const s=mt();return Ws(s,[0,0,t]),Po(s,Kd[n],s),Po(s,e,s),{t:s,_tInv:Ba(s)}}var ye=(e=>(e.Select="Select",e.FreehandDraw="FreehandDraw",e.CircleNudge="CircleNudge",e.PointPlacing="PointPlacing",e.Threshold="Threshold",e))(ye||{});const Zd=()=>({id:"",name:"Contour",polyLine:[],referencePlane:Ma()}),Tn=te("contour",()=>{const e=M(),t=M("FreehandDraw"),{serialize:n,deserialize:s,...o}=go({toolDefaults:Zd,initialLabels:{"Default label":{color:"#ff0000"}},newLabelDefault:{color:"#ff0000"}});function i(l){e.value=l}function a(l){return e.value===l&&(e.value=null),o.removeTool(l)}function r(l){t.value=l}return{...o,removeTool:a,serialize:()=>{},deserialize:()=>{},selectedContourID:e,mode:t,selectContour:i,setMode:r}});function Aa(e){return e===oe.Ruler?Fe():e===oe.Rectangle?Ne():e===oe.Paint?lt():e===oe.Crosshairs?jt():e===oe.Contour?Tn():null}function Jd(e){const t=Aa(e);return t?t.activateTool():!0}function eh(e){const t=Aa(e);t&&t.deactivateTool()}const Oe=te("tool",{state:()=>({currentTool:oe.WindowLevel}),actions:{setCurrentTool(e){Jd(e)&&(eh(this.currentTool),this.currentTool=e)},serialize(e){const{tools:t}=e.manifest,n=Fe(),s=Ne(),o=jt(),i=lt(),a=bt();n.serialize(e),s.serialize(e),o.serialize(e),i.serialize(e),a.serialize(e),t.current=this.currentTool},deserialize(e,t,n){const{tools:s}=e,o=Fe(),i=Ne(),a=jt(),r=lt(),l=bt();o.deserialize(e,n),i.deserialize(e,n),a.deserialize(e),r.deserialize(e,t),l.deserialize(e,n),this.currentTool=s.current}}}),Fa="manifest.json";async function th(e){const t=await pl(e);return $i.has(t.type)?(await vi.loadAsync(t)).file(Fa)!==null:!1}const fo=(e,{done:t})=>t({dataSource:e}),In=async e=>{let t=e;const{fileSrc:n}=t;if(n&&n.fileType===""){const s=await Ui(n.file);s&&(t={...t,fileSrc:{...n,fileType:s}})}return t},nh=async(e,{extra:t,done:n})=>{const{uriSrc:s}=e;if(s){const o=await new _n([_a,In,fo]).execute(e,t);if(!o.ok)throw o.errors[0].cause;return n({dataSource:o.data[0].dataSource})}return e},oh=async(e,{execute:t})=>{const{fileSrc:n,parent:s}=e;if(!n&&s){const o=await t(s);if(!o.ok)throw new Error("Could not process parent",{cause:Sl(o.errors[0].cause)});return{...e,parent:o.data[0].dataSource}}return e},ih=async(e,{extra:t,done:n})=>{if(e.archiveSrc){const o=await new _n([ba,In,fo]).execute(e,t);if(!o.ok)throw o.errors[0].cause;return n({dataSource:o.data[0].dataSource})}return e};function ah(e,t,n){const s=n.filter(i=>St(i.archivePath)===St(e.path)).map(i=>io(i.file)),o=t.remoteFiles[e.id]??[];return[...s,...o]}async function sh(e,t,{extra:n,execute:s}){const o=new Map,i=t.map(c=>({...c,archivePath:St(c.archivePath)})),{datasets:a}=e,r={},l=new _n([In,nh,oh,ih,fo]);return await Promise.all(a.map(async c=>{let u=ah(c,e,i);u=await Promise.all(u.map(async v=>{const p=await l.execute(v,{...n,archiveCache:o});if(!p.ok)throw p.errors[0].cause;return p.data[0].dataSource}));const d=[],h=await Promise.all(u.map(v=>s(v,{...n,archiveCache:o,dicomDataSources:d})));if(d.length){const v=_e(),p=await v.importFiles(d);if(p.length!==1)throw new Error("Obtained more than one volume from DICOM import");const[f]=p;await v.buildVolume(f),r[c.id]=f}else if(h.length===1){if(!h[0].ok)throw h[0].errors[0].cause;const[v]=h;if(v.data.length!==1)throw new Error("Import encountered multiple volumes for a single dataset");const{dataID:p}=v.data[0];if(!p)throw new Error("Failed to import dataset");r[c.id]=p}else throw new Error("Could not load any data from the session")})),r}const rh=async(e,{done:t,extra:n,execute:s})=>{const{fileSrc:o}=e;if(o&&await th(o.file)){const i=await ro(o.file),[a,r]=Qt(d=>d.file.name===Fa,i);if(a.length!==1)throw new Error("State file does not have exactly 1 manifest");const l=bu.parse(JSON.parse(await a[0].file.text()));de().setLayout(l.layout);const c=await sh(l,r,{extra:n,execute:s,done:t});if(l.primarySelection!==void 0){const d=c[l.primarySelection];let h;d in _e().volumeInfo?h=Ht(d):h=Wt(d),xt().setPrimarySelection(h)}de().deserialize(l.views,c);const u=await pn().deserialize(l,r,c);return Oe().deserialize(l,u,c),Rt().deserialize(l,c),t()}return e},Na=C.string(),po=C.object({color:Na}),lh=po,ch=C.intersection(po,C.object({fillColor:Na})),uh=C.object({labels:C.record(po).or(C.null()).optional(),rulerLabels:C.record(lh).or(C.null()).optional(),rectangleLabels:C.record(ch).or(C.null()).optional()}),dh=async e=>{const t=new TextDecoder,n=await e.arrayBuffer(),s=t.decode(new Uint8Array(n));return uh.parse(JSON.parse(s))},hh=e=>{const t=n=>n===void 0?e.labels:n;Fe().mergeLabels(t(e.rulerLabels)),Ne().mergeLabels(t(e.rectangleLabels))},gh=async(e,{done:t})=>{const{fileSrc:n}=e;if((n==null?void 0:n.fileType)==="application/json"){try{const s=await dh(n.file);hh(s)}catch{return e}return t()}return e};function $a(e){if(e.data.length===0)return null;const{dataID:t,dataType:n}=e.data[0];return t?n==="dicom"?Ht(t):n==="image"?Wt(t):null:null}function fh(e){const t=String(e);return!t||t==="[object Object]"?"Unknown error. More details in the dev console.":t}const ph=()=>{throw new Error("Failed to handle resource")};async function Ua(e){const t=[In,gh,rh,ed,Yu,Wu,_a,ba,Bu,Ou,Ku,ph],n={fetchFileCache:new Map,dicomDataSources:[]},s=new _n(t),o=await Promise.all(e.map(r=>s.execute(r,n)));if(!n.dicomDataSources.length)return o;const i={dicomSrc:{sources:n.dicomDataSources}},a={ok:!0,data:[],errors:[]};try{const r=await _e().importFiles(n.dicomDataSources);a.data.push(...r.map(l=>({dataID:l,dataType:"dicom",dataSource:i})))}catch(r){a.ok=!1,a.errors.push({message:fh(r),cause:r,inputDataStackTrace:[i]})}return[...o.filter(r=>r.data.length),a]}const mh={name:"ToolButton",props:{icon:{type:String,required:!0},name:{type:String,required:!0},size:{type:[Number,String],default:40},buttonClass:[String,Array,Object],tooltipLocation:{type:String,default:"right"}},computed:{sizeV(){return Number(this.size)},iconSize(){return Math.floor(.6*this.sizeV)},classV(){const e=this.buttonClass;return typeof e=="string"?e:Array.isArray(e)?e.join(" "):e&&Object.keys(e).length?Object.keys(this.buttonClass).filter(t=>this.buttonClass[t]).join(" "):""}}};function vh(e,t,n,s,o,i){return x(),K(pt,qt({variant:"text",rounded:0,dark:"",height:i.sizeV,width:i.sizeV,"min-width":i.sizeV,"max-width":i.sizeV,class:i.classV},e.$attrs),{default:R(()=>[y(yt,{size:i.iconSize},{default:R(()=>[H(U(n.icon),1)]),_:1},8,["size"]),y(Ti,{location:n.tooltipLocation,activator:"parent",transition:"slide-x-transition"},{default:R(()=>[g("span",null,U(n.name),1)]),_:1},8,["location"]),be(e.$slots,"default")]),_:3},16,["height","width","min-width","max-width","class"])}const Ue=A(mh,[["render",vh]]),Ha=Symbol("ItemGroup"),Wa=X({props:{modelValue:null,mandatory:Boolean,equalsTest:Function},setup(e,{emit:t,slots:n}){const{modelValue:s,mandatory:o,equalsTest:i}=ae(e),a=M();return F(s,c=>{c!==a.value&&(a.value=c)}),ee(()=>{a.value=s.value}),$n(Ha,{selectItem:c=>{o.value&&!c||(a.value=c,t("update:modelValue",a.value))},isSelected:c=>a.value==null?!1:i.value?i.value(c,a.value):c===a.value}),()=>{var c;return(c=n.default)==null?void 0:c.call(n)}}}),za=X({props:{value:{type:null,required:!0}},setup(e,{slots:t}){const{value:n}=ae(e),s=ct(Ha);if(!s)throw new Error("GroupableItem needs ItemGroup!");const o=()=>{s.selectItem(n.value)},i=()=>{s&&s.selectItem(s.isSelected(n.value)?void 0:n.value)};return()=>{var a;return(a=t.default)==null?void 0:a.call(t,{active:s.isSelected(n.value),select:o,toggle:i})}}});function ja(e){return`#${e.map(n=>`0${n.toString(16)}`.slice(-2)).join("")}`}function yh(e){const t=e.startsWith("#")?e.substring(1):e,n=[0,0,0,255],s=Math.min(4,t.length/2);for(let o=0;o<s;o++)n[o]=Number.parseInt(t.substring(2*o,2*o+2),16);return n}function wh(e,t=5){const n={},s=[],o=Object.entries(e);for(;o.length;){const[i,a]=o.shift(),r=ja(a).toUpperCase();n[r]=Number(i);let l=s[s.length-1];(!l||l.length===t)&&(l=[],s.push(l)),l.push(r)}return{hexToValue:n,swatches:s}}const Sh=X({name:"PaintControls",setup(){const e=lt(),{hexToValue:t,swatches:n}=wh(Mt,3),s=I(()=>{const c=e.brushValue;return c in Mt?ja(Mt[c]):null}),o=c=>{const u=`${c}FF`.toUpperCase();u in t&&e.setBrushValue(t[u])},i=I(()=>e.brushSize),a=c=>{e.setBrushSize(Number(c))},r=I(()=>e.labelmapOpacity);return{brushSize:i,setBrushSize:a,swatches:n,brushColor:s,setBrushColor:o,opacity:r,setOpacity:c=>{e.setLabelmapOpacity(Number(c))}}}});function _h(e,t,n,s,o,i){return x(),K(Yt,{width:"350px"},{default:R(()=>[y(xi,null,{default:R(()=>[y(hn,{"no-gutters":"",align:"center"},{default:R(()=>[y(kt,null,{default:R(()=>[y(ko,{"model-value":e.brushSize,"onUpdate:modelValue":e.setBrushSize,density:"compact","hide-details":"",label:"Size",min:"1",max:"50"},{append:R(()=>[y(Un,{"model-value":e.brushSize,onInput:e.setBrushSize,variant:"underlined",class:"mt-n1 pt-0",style:{width:"40px"},"hide-details":"",type:"number",min:"1",max:"50"},null,8,["model-value","onInput"])]),_:1},8,["model-value","onUpdate:modelValue"])]),_:1})]),_:1}),y(hn,{"no-gutters":"",align:"center"},{default:R(()=>[y(kt,null,{default:R(()=>[y(ko,{"model-value":e.opacity,"onUpdate:modelValue":e.setOpacity,density:"compact","hide-details":"",label:"Opacity",min:"0",max:"1",step:"0.01"},{append:R(()=>[y(Un,{"model-value":e.opacity,onInput:e.setOpacity,variant:"underlined",class:"mt-n1 pt-0",style:{width:"40px"},"hide-details":"",type:"number",min:"0",max:"1",step:"0.1"},null,8,["model-value","onInput"])]),_:1},8,["model-value","onUpdate:modelValue"])]),_:1})]),_:1}),y(hn,{"no-gutters":"",align:"center"},{default:R(()=>[y(kt,null,{default:R(()=>[y(Ii,{"hide-canvas":"","hide-inputs":"","hide-mode-switch":"","hide-sliders":"","show-swatches":"",elevation:"0",swatches:e.swatches,"model-value":e.brushColor,"onUpdate:modelValue":e.setBrushColor},null,8,["swatches","model-value","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})}const Ga=A(Sh,[["render",_h],["__scopeId","data-v-6027fe65"]]),Ch=X({name:"MenuToolButton",props:{icon:{type:String,required:!0},name:{type:String,required:!0},size:{type:[Number,String],default:40},active:Boolean,disabled:Boolean,mobileOnlyMenu:Boolean},components:{ToolButton:Ue},setup(e){const t=Kn(),n=I(()=>!t.mobile.value),s=M(!1),o=I(()=>!e.mobileOnlyMenu||t.mobile.value);F(s,a=>{s.value=a&&o.value});const i=I(()=>e.active);return F(i,a=>{a||(s.value=!1)}),{showLeft:n,menuOn:s,enableMenu:o}}});const bh={class:"menu-content elevation-24"};function Th(e,t,n,s,o,i){const a=P("tool-button");return x(),K(wt,{"no-click-animation":"","close-on-content-click":!1,modelValue:e.menuOn,"onUpdate:modelValue":t[1]||(t[1]=r=>e.menuOn=r),location:e.showLeft?"left":"right",class:"overflow-auto"},{activator:R(({props:r})=>[y(a,qt({icon:e.icon,name:e.name,buttonClass:["tool-btn",e.active?"tool-btn-selected":""],disabled:e.disabled,size:e.size,onClick:t[0]||(t[0]=l=>e.$emit("click"))},r),{default:R(()=>[e.active&&e.enableMenu?(x(),K(yt,{key:0,class:N([e.showLeft?"menu-more-left":"menu-more-right"]),size:"18"},{default:R(()=>[H(U(e.showLeft?"mdi-menu-left":"mdi-menu-right"),1)]),_:1},8,["class"])):j("",!0)]),_:2},1040,["icon","name","buttonClass","disabled","size"])]),default:R(()=>[g("div",bh,[be(e.$slots,"default",{},void 0,!0)])]),_:3},8,["modelValue","location"])}const Xa=A(Ch,[["render",Th],["__scopeId","data-v-b1e30b7b"]]),Ih=X({components:{ToolButton:Ue},setup(){const{currentImageID:e}=ce(),t=bt();return{resetCrop:()=>{const s=e.value;s&&t.resetCropping(s)}}}});function xh(e,t,n,s,o,i){const a=P("tool-button");return x(),K(Yt,{dark:""},{default:R(()=>[y(a,{size:"40",icon:"mdi-restore",name:"Reset Crop",onClick:e.resetCrop},null,8,["onClick"])]),_:1})}const qa=A(Ih,[["render",xh]]),Rh={class:"d-flex flex-row"},Dh={class:"flex-grow-1 d-flex flex-column justify-space-between mr-4"},Lh=X({__name:"LabelEditor",props:{label:null,labelsStore:null},emits:["close"],setup(e,{emit:t}){const n=e,s=I(()=>n.labelsStore.labels[n.label]),o=M(s.value.labelName);F(o,r=>{n.labelsStore.updateLabel(n.label,{labelName:r})});const i=M(_l(s.value.color));F(i,r=>{n.labelsStore.updateLabel(n.label,{color:r})});const a=()=>{t("close"),n.labelsStore.deleteLabel(n.label)};return(r,l)=>(x(),K(Yt,null,{default:R(()=>[y(mr,{class:"d-flex flex-row align-center"},{default:R(()=>[H(" Edit Label "),y(Mo),y(pt,{variant:"text",density:"compact",icon:"mdi-close",onClick:l[0]||(l[0]=c=>r.$emit("close"))})]),_:1}),y(yr,null,{default:R(()=>[g("div",Rh,[g("div",Dh,[g("div",null,[y(Un,{modelValue:o.value,"onUpdate:modelValue":l[1]||(l[1]=c=>o.value=c),onKeydown:l[2]||(l[2]=ke(ie(c=>r.$emit("close"),["stop"]),["enter"])),label:"Name",class:"flex-grow-0"},null,8,["modelValue"])]),y(vr,{class:"mb-2 px-0"},{default:R(()=>[y(pt,{color:"secondary",variant:"elevated",onClick:l[3]||(l[3]=c=>r.$emit("close"))},{default:R(()=>[H(" Done ")]),_:1}),y(Mo),y(pt,{color:"red",variant:"tonal",onClick:a},{default:R(()=>[H(" Delete label ")]),_:1})]),_:1})]),y(Ii,{modelValue:i.value,"onUpdate:modelValue":l[4]||(l[4]=c=>i.value=c),mode:"rgb",label:"Color"},null,8,["modelValue"])])]),_:1})]),_:1}))}}),Eh={class:"dot-container mr-3"},Oh={class:"overflow-hidden"},Vh=X({__name:"LabelControls",props:{labelsStore:null},setup(e){const t=e,n=I(()=>Object.entries(t.labelsStore.labels)),s=I(()=>n.value.findIndex(([c])=>c===t.labelsStore.activeLabel)),o=M(void 0),i=()=>{o.value=t.labelsStore.addLabel()},a=M(!1);fe(()=>{a.value=!!o.value});const r=Kn(),l=I(()=>r.mobile.value);return(c,u)=>(x(),L(se,null,[y(Yt,{class:"pt-2"},{default:R(()=>[y(Ri,null,{default:R(()=>[H("Labels")]),_:1}),y(xi,null,{default:R(()=>[y(Di,{"model-value":z(s),"selected-class":"card-active",mandatory:""},{default:R(()=>[y(hn,{dense:""},{default:R(()=>[(x(!0),L(se,null,Pe(z(n),([d,{labelName:h,color:v}])=>(x(),K(kt,{cols:"6",key:d},{default:R(()=>[y(gt,null,{default:R(({selectedClass:p,toggle:f})=>[y(Bo,{variant:"tonal",class:N(["w-100 d-flex",p]),onClick:()=>{f(),e.labelsStore.setActiveLabel(d)}},{default:R(()=>[g("div",Eh,[g("div",{class:"color-dot",style:ne({background:v})},null,4)]),g("span",Oh,U(h),1),y(pt,{icon:"mdi-pencil",density:"compact",class:"ml-auto",variant:"plain",onClick:ie(()=>{o.value=d,a.value=!0},["stop"])},null,8,["onClick"])]),_:2},1032,["class","onClick"])]),_:2},1024)]),_:2},1024))),128)),y(kt,{cols:"6"},{default:R(()=>[y(Bo,{variant:"outlined",class:"w-100",onClick:i},{default:R(()=>[y(yt,{class:"mr-2"},{default:R(()=>[H("mdi-plus")]),_:1}),H(" Add Label ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])]),_:1})]),_:1}),y(wr,{modelValue:a.value,"onUpdate:modelValue":u[1]||(u[1]=d=>a.value=d),width:z(l)?"100%":"50%"},{default:R(()=>[o.value?(x(),K(Lh,{key:0,onClose:u[0]||(u[0]=d=>o.value=void 0),label:o.value,labelsStore:e.labelsStore},null,8,["label","labelsStore"])):j("",!0)]),_:1},8,["modelValue","width"])],64))}});const mo=A(Vh,[["__scopeId","data-v-3ba66c80"]]),Ya=X({__name:"RulerControls",setup(e){const t=Fe();return(n,s)=>(x(),K(mo,{"labels-store":z(t)},null,8,["labels-store"]))}}),Ka=X({__name:"RectangleControls",setup(e){const t=Ne();return(n,s)=>(x(),K(mo,{"labels-store":z(t)},null,8,["labels-store"]))}}),Qa=X({__name:"ContourControls",setup(e){const t=Tn(),{mode:n}=nt(t);function s(o){t.setMode(o)}return(o,i)=>(x(),K(Yt,{dark:""},{default:R(()=>[y(Ri,{class:"my-1"},{default:R(()=>[H("Tools")]),_:1}),y(Di,{mandatory:"","selected-class":"tool-btn-selected","model-value":z(n),"onUpdate:modelValue":s},{default:R(()=>[y(gt,{value:z(ye).Select},{default:R(({selectedClass:a,toggle:r})=>[y(Ue,{size:"40",icon:"mdi-cursor-default",name:"Select",buttonClass:a||"",onClick:r},null,8,["buttonClass","onClick"])]),_:1},8,["value"]),y(gt,{value:z(ye).FreehandDraw},{default:R(({selectedClass:a,toggle:r})=>[y(Ue,{size:"40",icon:"mdi-draw",name:"Freehand",buttonClass:a||"",onClick:r},null,8,["buttonClass","onClick"])]),_:1},8,["value"]),y(gt,{value:z(ye).PointPlacing},{default:R(({selectedClass:a,toggle:r})=>[y(Ue,{size:"40",icon:"mdi-vector-polyline",name:"Point Placing",buttonClass:a||"",onClick:r},null,8,["buttonClass","onClick"])]),_:1},8,["value"]),y(gt,{value:z(ye).Threshold},{default:R(({selectedClass:a,toggle:r})=>[y(Ue,{size:"40",icon:"mdi-math-integral",name:"Threshold",buttonClass:a||"",onClick:r},null,8,["buttonClass","onClick"])]),_:1},8,["value"]),y(gt,{value:z(ye).CircleNudge},{default:R(({selectedClass:a,toggle:r})=>[y(Ue,{size:"40",icon:"mdi-circle-multiple-outline",name:"Nudge",buttonClass:a||"",onClick:r},null,8,["buttonClass","onClick"])]),_:1},8,["value"])]),_:1},8,["model-value"]),y(mo,{"labels-store":z(t)},null,8,["labels-store"])]),_:1}))}});const Ph=X({components:{ToolButton:Ue,MenuToolButton:Xa,ItemGroup:Wa,GroupableItem:za,PaintControls:Ga,CropControls:qa,RulerControls:Ya,RectangleControls:Ka,ContourControls:Qa},setup(){const e=xt(),t=Oe();console.log(nt(t));const n=I(()=>!e.primaryDataset),s=I(()=>t.currentTool),o=Ne(),i=Fe(),a=M(!1),r=M(!1);return At("Escape",()=>{a.value=!1,r.value=!1}),{currentTool:s,setCurrentTool:t.setCurrentTool,noCurrentImage:n,Tools:oe,paintMenu:a,cropMenu:r,rectangleStore:o,rulerStore:i}}});function kh(e,t,n,s,o,i){const a=P("tool-button"),r=P("groupable-item"),l=P("paint-controls"),c=P("menu-tool-button"),u=P("rectangle-controls"),d=P("ruler-controls"),h=P("contour-controls"),v=P("crop-controls"),p=P("item-group");return x(),K(p,{mandatory:"","model-value":e.currentTool,"onUpdate:modelValue":t[0]||(t[0]=f=>e.setCurrentTool(f))},{default:R(()=>[y(r,{value:e.Tools.WindowLevel},{default:R(({active:f,toggle:m})=>[y(a,{icon:"mdi-circle-half-full",name:"Window & Level",buttonClass:["tool-btn",f?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Pan},{default:R(({active:f,toggle:m})=>[y(a,{icon:"mdi-cursor-move",name:"Pan",buttonClass:["tool-btn",f?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Zoom},{default:R(({active:f,toggle:m})=>[y(a,{icon:"mdi-magnify-plus-outline",name:"Zoom",buttonClass:["tool-btn",f?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Crosshairs},{default:R(({active:f,toggle:m})=>[y(a,{icon:"mdi-crosshairs",name:"Crosshairs",buttonClass:["tool-btn",f?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Paint},{default:R(({active:f,toggle:m})=>[y(c,{icon:"mdi-brush",name:"Paint",active:f,disabled:e.noCurrentImage,onClick:m},{default:R(()=>[y(l)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Rectangle},{default:R(({active:f,toggle:m})=>[y(c,{icon:"mdi-vector-square",name:"Rectangle",mobileOnlyMenu:!0,active:f,disabled:e.noCurrentImage,onClick:m},{default:R(()=>[y(u)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Ruler},{default:R(({active:f,toggle:m})=>[y(c,{icon:"mdi-ruler",name:"Ruler",mobileOnlyMenu:!0,active:f,disabled:e.noCurrentImage,onClick:m},{default:R(()=>[y(d)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Contour},{default:R(({active:f,toggle:m})=>[y(c,{icon:"mdi-shape-circle-plus",name:"Contour",active:f,disabled:e.noCurrentImage,onClick:m},{default:R(()=>[y(h)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Crop},{default:R(({active:f,toggle:m})=>[y(c,{icon:"mdi-crop",name:"Crop",active:f,disabled:e.noCurrentImage,onClick:m},{default:R(()=>[y(v)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"])]),_:1},8,["model-value"])}const Mh=A(Ph,[["render",kh],["__scopeId","data-v-63968322"]]);function Gt(e){$e(()=>e.unsubscribe())}function Bh(e,t=!1){const n=M(t);let s=!0;const o={position:[0,0,0],parallelScale:0};Gt(e.onModified(()=>{if(s&&n.value){const r=e.getPosition(),l=e.getParallelScale();(!st(r,o.position)||l!==o.parallelScale)&&(n.value=!1)}}));function i(r){if(s){s=!1;try{r()}finally{s=!0}}}function a(){o.position=e.getPosition(),o.parallelScale=e.getParallelScale()}return{resizeToFit:n,ignoreResizeToFitTracking:i,resetResizeToFitTracking:a}}function Ah(e){if(!e||e==="none")return 0;const t=e.match(/matrix(?:3d)?\((.+)\)/)[1].split(",").map(s=>Number(s));return e.includes("3d")?t[13]:t[5]}const Fh={props:{slice:{type:Number,default:0},min:{type:Number,required:!0},max:{type:Number,required:!0},step:{type:Number,required:!0},handleHeight:{type:Number,default:20}},data(){return{maxHandlePos:0,dragging:!1,initialHandlePos:0,initialMousePosY:0,yOffset:0}},computed:{handlePosition(){const e=this.max-this.min<=0?1:this.max-this.min,t=this.maxHandlePos*((this.slice-this.min)/e);return this.dragging?this.draggingHandlePos:t},draggingHandlePos(){return Math.min(Math.max(0,this.initialHandlePos+this.yOffset),this.maxHandlePos)}},mounted(){this.updateMaxHandlePos(),this.resizeObserver=new ResizeObserver(e=>{e.length===1&&this.updateMaxHandlePos()}),this.resizeObserver.observe(this.$refs.handleContainer)},beforeUnmount(){this.resizeObserver.disconnect()},methods:{updateMaxHandlePos(){this.maxHandlePos=this.$refs.handleContainer.clientHeight-this.handleHeight},onDragStart(e){if(e.preventDefault(),this.dragging=!0,this.initialMousePosY=e.pageY,e.target===this.$refs.handle){const t=window.getComputedStyle(this.$refs.handle);this.initialHandlePos=Ah(t.transform)}else{const{y:t}=this.$refs.handleContainer.getBoundingClientRect();this.initialHandlePos=Math.max(0,Math.min(this.maxHandlePos,e.pageY-t-this.handleHeight/2));const n=this.getNearestSlice(this.initialHandlePos);this.$emit("input",n)}this.yOffset=0,this.$refs.handleContainer.setPointerCapture(e.pointerId)},onDragMove(e){if(!this.$refs.handleContainer.hasPointerCapture(e.pointerId))return;e.preventDefault(),this.yOffset=e.pageY-this.initialMousePosY;const t=this.getNearestSlice(this.handlePosition);this.$emit("input",t)},onDragEnd(e){if(!this.$refs.handleContainer.hasPointerCapture(e.pointerId))return;e.preventDefault(),this.$refs.handleContainer.releasePointerCapture(e.pointerId),this.dragging=!1;const t=this.getNearestSlice(this.handlePosition);this.$emit("input",t)},getNearestSlice(e){const n=e/this.maxHandlePos*(this.max-this.min)+this.min;return Math.round(n/this.step)*this.step}}},Nh=e=>(re("data-v-45b64a9f"),e=e(),le(),e),$h=Nh(()=>g("div",{class:"slice-slider-track"},null,-1));function Uh(e,t,n,s,o,i){return x(),L("div",{class:"slice-slider",ref:"handleContainer",onPointerdown:t[0]||(t[0]=(...a)=>i.onDragStart&&i.onDragStart(...a)),onPointermove:t[1]||(t[1]=(...a)=>i.onDragMove&&i.onDragMove(...a)),onPointerup:t[2]||(t[2]=(...a)=>i.onDragEnd&&i.onDragEnd(...a)),onPointercancel:t[3]||(t[3]=(...a)=>i.onDragEnd&&i.onDragEnd(...a)),onContextmenu:t[4]||(t[4]=a=>a.preventDefault())},[$h,g("div",{class:"slice-slider-handle",ref:"handle",style:ne({height:`${n.handleHeight}px`,transform:`translate3d(0, ${i.handlePosition}px, 0)`})},null,4)],544)}const Hh=A(Fh,[["render",Uh],["__scopeId","data-v-45b64a9f"]]),Wh="_gridRoot_102tk_2",zh="_row_102tk_9",jh="_cell_102tk_16",Gh="_top_102tk_20",Xh="_left_102tk_21",qh="_center_102tk_25",Yh="_middle_102tk_26",Kh="_bottom_102tk_30",Qh="_right_102tk_31",Zh={gridRoot:Wh,row:zh,cell:jh,top:Gh,left:Xh,center:qh,middle:Yh,bottom:Kh,right:Qh},Jh={};function eg(e,t){return x(),L("div",{class:N(e.$style.gridRoot)},[g("div",{class:N([e.$style.top,e.$style.row])},[g("div",{class:N([e.$style.left,e.$style.cell])},[be(e.$slots,"top-left")],2),g("div",{class:N([e.$style.center,e.$style.cell])},[be(e.$slots,"top-center")],2),g("div",{class:N([e.$style.right,e.$style.cell])},[be(e.$slots,"top-right")],2)],2),g("div",{class:N([e.$style.middle,e.$style.row])},[g("div",{class:N([e.$style.left,e.$style.cell])},[be(e.$slots,"middle-left")],2),g("div",{class:N([e.$style.center,e.$style.cell])},[be(e.$slots,"middle-center")],2),g("div",{class:N([e.$style.right,e.$style.cell])},[be(e.$slots,"middle-right")],2)],2),g("div",{class:N([e.$style.bottom,e.$style.row])},[g("div",{class:N([e.$style.left,e.$style.cell])},[be(e.$slots,"bottom-left")],2),g("div",{class:N([e.$style.center,e.$style.cell])},[be(e.$slots,"bottom-center")],2),g("div",{class:N([e.$style.right,e.$style.cell])},[be(e.$slots,"bottom-right")],2)],2)],2)}const tg={$style:Zh},ng=A(Jh,[["render",eg],["__cssModules",tg]]);function xn(e,t){const n=new ResizeObserver(s=>{s.length===1&&t(s[0])});return F(e,(s,o)=>{o&&n.unobserve(o),s&&n.observe(s)},{immediate:!0}),we(()=>{const s=z(e);s&&n.unobserve(s)}),n}function Se(e){return n=>{let s=null;const o=()=>{s==null||s.unsubscribe(),s=null};$e(o),zs(e)?fe(()=>{o(),e.value&&(s=e.value(n))}):e&&(s=e(n))}}function un(e){return e.map((t,n)=>({value:t,axis:n})).filter(({value:t})=>Math.abs(t)>Yn).sort((t,n)=>Math.abs(n.value)-Math.abs(t.value)).map(({value:t,axis:n})=>(Math.sign(t)===1?"LPS":"RAI")[n]).join("")}function og(e){const t=I(()=>e.value.getCamera()),n=M(""),s=M(""),o=M(""),i=M("");function a(){const l=t.value.getViewUp(),c=t.value.getDirectionOfProjection(),u=[0,0,0];Xn(u,c,l);const d=l.map(v=>v*-1),h=u.map(v=>v*-1);n.value=un(l),i.value=un(u),o.value=un(d),s.value=un(h)}return Se(I(()=>t.value.onModified))(a),a(),{top:n,right:i,bottom:o,left:s}}function ig(e,t,n){const s=I(()=>n.value.orientation),o=I(()=>ra(s.value)),i=I(()=>o.value[z(e)]),a=I(()=>o.value[z(t)]);return{cameraDirVec:i,cameraUpVec:a}}function dn(e,t){return Math.min(t-e,1)/256}const ag=X({name:"WindowLevelTool",props:{viewId:{type:String,required:!0}},setup(e){const{viewId:t}=ae(e),n=co(),s=de(),{currentImageID:o}=ce(),i=I(()=>s.getViewProxy(t.value)),a=Ea(),r=I(()=>n.getConfig(t.value,o.value)),l=I(()=>({min:1e-12,max:r.value!=null?r.value.max-r.value.min:a.max,step:r.value!=null?dn(r.value.min,r.value.max):dn(a.min,a.max)})),c=I(()=>({min:r.value!=null?r.value.min:a.min,max:r.value!=null?r.value.max:a.max,step:r.value!=null?dn(r.value.min,r.value.max):dn(a.min,a.max)})),u=I(()=>r.value!=null?r.value.width:a.width),d=I(()=>r.value!=null?r.value.level:a.level),h=ki.newInstance({button:1,scrollEnabled:!1});F(i,(p,f)=>{f&&f.getInteractorStyle2D().removeMouseManipulator(h),p&&i.value.getInteractorStyle2D().addMouseManipulator(h)},{immediate:!0}),we(()=>{i.value.isDeleted()||i.value.getInteractorStyle2D().removeMouseManipulator(h)});function v(){h.removeAllListeners();const p=l.value,f=c.value;h.setVerticalListener(p.min,p.max,p.step,()=>u.value,m=>{o.value!=null&&n.updateConfig(t.value,o.value,{width:m})}),h.setHorizontalListener(f.min,f.max,f.step,()=>d.value,m=>{o.value!=null&&n.updateConfig(t.value,o.value,{level:m})})}return F(()=>JSON.stringify({w:l.value,l:c.value}),v,{immediate:!0}),()=>null}});function sg(e){const t=Oe();return I(()=>t.currentTool===oe.WindowLevel).value?qn(ag,e):[]}const rg=X({name:"SliceScrollTool",props:{viewId:{type:String,required:!0}},setup(e){const{viewId:t}=ae(e),n=Dt(),s=de(),{currentImageID:o}=ce(),i=I(()=>s.getViewProxy(t.value)),a=lo(),r=I(()=>n.getConfig(t.value,o.value)),l=I(()=>({min:r.value!=null?r.value.min:a.min,max:r.value!=null?r.value.max:a.max,step:1,default:r.value!=null?r.value.slice:a.slice})),c=M(0),u=ki.newInstance({button:-1,scrollEnabled:!0});F(i,(h,v)=>{v&&v.getInteractorStyle2D().removeMouseManipulator(u),h&&i.value.getInteractorStyle2D().addMouseManipulator(u)},{immediate:!0}),we(()=>{i.value.isDeleted()||i.value.getInteractorStyle2D().removeMouseManipulator(u)});function d(){u.removeAllListeners();const h=l.value;u.setScrollListener(h.min,h.max,h.step,()=>c.value,v=>{o.value!==null&&n.updateConfig(t.value,o.value,{slice:v})})}return F(l,h=>{c.value=h.default,d()},{immediate:!0}),()=>null}}),Za=X({name:"MouseManipulatorTool",props:{name:String,viewId:{type:String,required:!0},manipulatorClass:{type:Object,required:!0},options:{type:Array,default:()=>[]}},setup(e){const{viewId:t,options:n}=ae(e),s=de(),o=I(()=>s.getViewProxy(t.value)),i=I(()=>o.value.isA("vtkView2DProxy")?o.value.getInteractorStyle2D():o.value.getInteractorStyle3D()),a=[];function r(l,c,u){l!==null&&(u.forEach(d=>l.removeMouseManipulator(d)),c.forEach(d=>l.addMouseManipulator(d)))}return F(n,l=>{for(;a.length>l.length;){const u=a.pop();i.value.removeMouseManipulator(u),u.delete()}const c=Array.from(a);for(let u=a.length;u<l.length;++u)a.push(e.manipulatorClass.newInstance(l[u]));l.forEach((u,d)=>{"button"in u&&a[d].setButton(u.button),a[d].setShift(!!u.shift),a[d].setControl(!!u.control)}),r(i.value,a,c)},{immediate:!0}),F(i,(l,c)=>{a.forEach(u=>{c&&c.removeMouseManipulator(u),l&&l.addMouseManipulator(u)})},{immediate:!0}),we(()=>{o.value.isDeleted()||a.forEach(l=>i.value.removeMouseManipulator(l))}),()=>null}});function lg(e){const t=Oe(),n=[];return n.push({button:2}),n.push({button:1,shift:!0}),t.currentTool===oe.Pan&&n.push({button:1}),qn(Za,{...e,name:"PanTool",manipulatorClass:Xr,options:n})}function cg(e){const t=Oe(),n=[];return n.push({button:3,flipDirection:!0}),n.push({button:1,control:!0,flipDirection:!0}),t.currentTool===oe.Zoom&&n.push({button:1,flipDirection:!0}),qn(Za,{...e,name:"ZoomTool",manipulatorClass:qr,options:n})}var Xt=(e=>(e.PlacingFirst="PlacingFirst",e.PlacingSecond="PlacingSecond",e.Select="Select",e.Dragging="Dragging",e))(Xt||{});function ni(e){return e.altKey||e.controlKey||e.shiftKey}function ug(e,t){t.classHierarchy.push("vtkRulerWidgetProp"),t.interactionState="Select";let n=null;_.setGet(e,t,["interactionState"]),_.setGet(e,t,["manipulator"]),_.event(e,t,"RightClickEvent"),_.event(e,t,"PlacedEvent"),e.deactivateAllHandles=()=>{t.widgetState.deactivate(),t.activeState=null},e.setFirstPoint=o=>{t.widgetState.getFirstPoint().setOrigin(o)},e.setSecondPoint=o=>{t.widgetState.getSecondPoint().setOrigin(o)};const s=e.setInteractionState;e.setInteractionState=o=>{const i=s(o);return i&&o==="PlacingFirst"&&(t.widgetState.setIsPlaced(!1),t.widgetState.getFirstPoint().setVisible(!1),t.widgetState.getSecondPoint().setVisible(!1)),i},e.resetInteractions=()=>{t._interactor.cancelAnimation(e,!0)},e.handleLeftButtonPress=o=>{var l;if(!t.manipulator||ni(o))return _.VOID;const i=t._widgetManager.getActiveWidget();if(i&&i!==e)return _.VOID;const a=t.manipulator.handleEvent(o,t._apiSpecificRenderWindow);if(!a.length)return _.VOID;const r=e.getInteractionState();return r==="PlacingFirst"?(e.setFirstPoint(a),e.setSecondPoint(a),t.widgetState.getFirstPoint().setVisible(!0),t.widgetState.getSecondPoint().setVisible(!0),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),e.setInteractionState("PlacingSecond"),_.EVENT_ABORT):r==="PlacingSecond"?(e.setSecondPoint(a),t.widgetState.setIsPlaced(!0),e.setInteractionState("Select"),e.invokeEndInteractionEvent(),e.invokePlacedEvent(),t._interactor.cancelAnimation(e),_.EVENT_ABORT):(l=t.activeState)!=null&&l.getActive()&&t.pickable?(n=t.activeState,e.setInteractionState("Dragging"),t._apiSpecificRenderWindow.setCursor("grabbing"),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),_.EVENT_ABORT):_.VOID},e.handleMouseMove=o=>{const i=t.manipulator.handleEvent(o,t._apiSpecificRenderWindow);return i.length?e.getInteractionState()==="PlacingSecond"?(t.widgetState.getSecondPoint().setOrigin(i),t.widgetState.getSecondPoint().setVisible(!0),e.invokeInteractionEvent(),_.EVENT_ABORT):e.getInteractionState()==="Dragging"&&n?(n.setOrigin(i),e.invokeInteractionEvent(),_.EVENT_ABORT):_.VOID:_.VOID},e.handleLeftButtonRelease=o=>{if(n){const i=t.manipulator.handleEvent(o,t._apiSpecificRenderWindow);i.length&&n.setOrigin(i),n=null,e.setInteractionState("Select"),t._apiSpecificRenderWindow.setCursor("pointer"),t.widgetState.deactivate(),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent(),t._widgetManager.enablePicking()}},e.handleRightButtonPress=o=>ni(o)||e.getInteractionState()!=="Select"||!t.activeState?_.VOID:(e.invokeRightClickEvent(o),_.EVENT_ABORT),e.grabFocus=()=>{throw new Error("grabFocus is not implemented")},e.loseFocus=()=>{throw new Error("loseFocus is not implemented")}}const dg=20;function hg(e,t,n,s){let o=n();const i=t.$subscribe(()=>{const r=n();(s?s(o,r):o!==r)&&(o=r,e.modified())}),a=e.delete;e.delete=()=>{i(),a()}}function gg(e,t,{id:n,store:s,key:o,visible:i=!0}){Object.assign(t,{id:n,_store:s,key:o}),wn.extend(e,t,{}),Mi.extend(e,t,{visible:i}),Yr.extend(e,t,{scale1:dg});const a=()=>t._store.rulerByID[t.id],r=l=>t._store.updateRuler(t.id,l);e.getOrigin=()=>{var l;return(l=a())==null?void 0:l[t.key]},e.setOrigin=l=>{r({[t.key]:l}),e.modified()},hg(e,t._store,()=>{var l;return(l=a())==null?void 0:l[t.key]})}const oi=_.newInstance(gg,"vtkRulerWidgetStatePoint"),Ja="points";function ii(e,t,n){let s=t.onModified(n);const o=e.delete;e.delete=()=>{s.unsubscribe(),s=null,o()}}function fg(e,t){const n=oi({id:t.id,store:t._store,key:"firstPoint",visible:!0}),s=oi({id:t.id,store:t._store,key:"secondPoint",visible:!0});ii(e,n,()=>e.modified()),ii(e,s,()=>e.modified()),t.labels={[Ja]:[n,s]},e.getFirstPoint=()=>n,e.getSecondPoint=()=>s}const pg=e=>({isPlaced:!1,...e});function mg(e,t,n){Object.assign(t,pg(n)),wn.extend(e,t,n),Bi.extend(e,t),_.get(e,t,["id"]),_.setGet(e,t,["isPlaced"]),_.moveToProtected(e,t,["store"]),fg(e,t)}const vg=_.newInstance(mg,"vtkRulerWidgetState");function yg(e,t){t.classHierarchy.push("vtkRulerWidget"),e.getRepresentationsForViewType=()=>[{builder:Kr,labels:[Ja],initialValues:{scaleInPixels:!0}}],e.getLength=()=>{const n=t.widgetState.getFirstPoint().getOrigin(),s=t.widgetState.getSecondPoint().getOrigin();return!n||!s?0:Math.sqrt(Pi(n,s))},t.manipulator=je.newInstance()}const wg={};function es(e,t,n={}){Object.assign(t,wg,n),vn.extend(e,t,{...n,behavior:ug,widgetState:vg(n)}),_.get(e,t,["manipulator"]),yg(e,t)}const Sg=_.newInstance(es,"vtkRulerWidget"),ts={newInstance:Sg,extend:es};function on(e,t,n,s){const{lpsOrientation:o}=s,i=o[Te(t)],a=o[t],r=[0,0,0];r[i]=n,pe(r,r,s.indexToWorld),e.setUserNormal(a),e.setUserOrigin(r)}const _g=X({props:{point1:Array,point2:Array,color:String,length:Number,viewId:{type:String,required:!0},textOffset:{type:Number,default:8},textSize:{type:Number,default:14}},setup(e){const{viewId:t,point1:n,point2:s,textOffset:o,length:i}=ae(e),a=M(),r=M(),l=de(),c=I(()=>l.getViewProxy(t.value)),u=()=>{const p=c.value.getRenderer(),f=z(n),m=z(s);if(f){const w=zt(f,p);w&&(a.value={x:w[0],y:w[1]})}else a.value=null;if(m){const w=zt(m,p);w&&(r.value={x:w[0],y:w[1]})}else r.value=null};Se(I(()=>c.value.getCamera().onModified))(u),F([c,n,s],u,{deep:!0,immediate:!0});const h=I(()=>{const p=z(a),f=z(r),m=o.value;return!p||!f?null:f.x>p.x?{dx:m,dy:-m,anchor:"start"}:{dx:-m,dy:-m,anchor:"end"}}),v=ct(mn);return xn(v,()=>{u()}),{devicePixelRatio,textdx:I(()=>{var p;return((p=h.value)==null?void 0:p.dx)??0}),textdy:I(()=>{var p;return((p=h.value)==null?void 0:p.dy)??0}),anchor:I(()=>{var p;return((p=h.value)==null?void 0:p.anchor)??"start"}),first:a,second:r,rulerLength:I(()=>{var p;return((p=i==null?void 0:i.value)==null?void 0:p.toFixed(2))??""})}}});const Cg=["x1","y1","x2","y2","stroke"],bg=["cx","cy","stroke","r"],Tg=["cx","cy","stroke","r"],Ig=["x","y","dx","dy","text-anchor","font-size"];function xg(e,t,n,s,o,i){return x(),L("g",null,[e.first&&e.second?(x(),L("line",{key:0,x1:e.first.x,y1:e.first.y,x2:e.second.x,y2:e.second.y,stroke:e.color,"stroke-width":"1"},null,8,Cg)):j("",!0),e.first?(x(),L("circle",{key:1,cx:e.first.x,cy:e.first.y,stroke:e.color,"stroke-width":"1",fill:"transparent",r:10/e.devicePixelRatio},null,8,bg)):j("",!0),e.second?(x(),L("circle",{key:2,cx:e.second.x,cy:e.second.y,stroke:e.color,"stroke-width":"1",fill:"transparent",r:10/e.devicePixelRatio,class:"handle"},null,8,Tg)):j("",!0),e.second?(x(),L("text",{key:3,x:e.second.x,y:e.second.y,dx:e.textdx,dy:e.textdy,"text-anchor":e.anchor,"stroke-width":"0.75",stroke:"black",fill:"white","font-size":`${e.textSize}px`,"font-weight":"bold"},U(e.rulerLength),9,Ig)):j("",!0)])}const Rg=A(_g,[["render",xg],["__scopeId","data-v-85f6f954"]]),Dg=X({name:"RulerWidget2D",emits:["placed","contextmenu"],props:{rulerId:{type:String,required:!0},widgetManager:{type:Object,required:!0},viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},currentSlice:{type:Number,required:!0},isPlacing:{type:Boolean,default:!1}},components:{RulerSVG2D:Rg},setup(e,{emit:t}){const{rulerId:n,widgetManager:s,viewDirection:o,currentSlice:i,isPlacing:a}=ae(e),r=Fe(),l=I(()=>r.rulerByID[n.value]),{currentImageID:c,currentImageMetadata:u}=ce(),d=ts.newInstance({id:n.value,store:r,isPlaced:!a.value}),h=M(null);ee(()=>{h.value=s.value.addWidget(d)}),$e(()=>{h.value&&(s.value.removeWidget(h.value),h.value.delete(),d.delete())}),F([a,h],([S,b])=>{S&&b&&b.setInteractionState(Xt.PlacingFirst)},{immediate:!0}),F([i,c,h],()=>{var b;const S=(b=h.value)==null?void 0:b.getWidgetState().getIsPlaced();h.value&&!S&&(h.value.resetInteractions(),h.value.setInteractionState(Xt.PlacingFirst))}),Se(I(()=>{var S;return(S=h.value)==null?void 0:S.onPlacedEvent}))(()=>{t("placed")});let p=null;ee(()=>{h.value&&(p=h.value.onRightClickEvent(S=>{const b=uo(S);b&&t("contextmenu",b)}))}),we(()=>{p&&(p.unsubscribe(),p=null)});const f=je.newInstance();ee(()=>{h.value&&h.value.setManipulator(f)}),fe(()=>{var S;on(f,o.value,((S=l.value)==null?void 0:S.slice)??i.value,u.value)}),F(()=>{var S;return!!h.value&&((S=l.value)==null?void 0:S.slice)===i.value},S=>{var b;(b=h.value)==null||b.setVisibility(S)},{immediate:!0}),ee(()=>{h.value&&(h.value.setHandleVisibility(!1),s.value.renderWidgets())});const m=S=>{const b=M(!1),O=()=>{S.value&&(b.value=S.value.getVisible())};return Se(I(()=>{var k;return(k=S.value)==null?void 0:k.onModified}))(()=>O()),wi(S,()=>O()),b},w=m(I(()=>{var S;return(S=h.value)==null?void 0:S.getWidgetState().getFirstPoint()})),T=m(I(()=>{var S;return(S=h.value)==null?void 0:S.getWidgetState().getSecondPoint()}));return{ruler:l,firstPoint:I(()=>w.value?l.value.firstPoint:void 0),secondPoint:I(()=>T.value?l.value.secondPoint:void 0),length:I(()=>r.lengthByID[l.value.id])}}});function Lg(e,t,n,s,o,i){const a=P("RulerSVG2D");return tt((x(),K(a,{"view-id":e.viewId,point1:e.firstPoint,point2:e.secondPoint,color:e.ruler.color,length:e.length},null,8,["view-id","point1","point2","color","length"])),[[Ft,e.currentSlice===e.ruler.slice]])}const Eg=A(Dg,[["render",Lg]]),Og=X({name:"RulerTool",props:{viewId:{type:String,required:!0},currentSlice:{type:Number,required:!0},viewDirection:{type:String,required:!0},widgetManager:{type:Object,required:!0}},components:{RulerWidget2D:Eg},setup(e){const{viewDirection:t,currentSlice:n}=ae(e),s=Oe(),o=Fe(),{rulers:i,activeLabel:a}=nt(o),{currentImageID:r,currentImageMetadata:l}=ce(),c=I(()=>s.currentTool===oe.Ruler),u=I(()=>Te(t.value)),d=M(null);F(d,(S,b)=>{b!=null&&o.updateRuler(b,{placing:!1}),S!=null&&o.updateRuler(S,{placing:!0})},{immediate:!0}),F([c,r],([S,b])=>{d.value!=null&&(o.removeRuler(d.value),d.value=null),S&&b&&(d.value=o.addRuler({imageID:b,placing:!0}))},{immediate:!0}),F([a,d],([S,b])=>{b!=null&&o.updateRuler(b,{label:S,...S&&o.labels[S]})},{immediate:!0}),$e(()=>{d.value!=null&&(o.removeRuler(d.value),d.value=null)});const h=()=>{r.value&&(d.value=o.addRuler({imageID:r.value,placing:!0}))},v=()=>{const{lpsOrientation:S,indexToWorld:b}=l.value,O=S[t.value],D=S[u.value],k=[0,0,0];return k[D]=n.value,pe(k,k,b),{planeNormal:O,planeOrigin:k}};F([n,d],([S,b])=>{b&&o.updateRuler(b,{frameOfReference:v(),slice:S})},{immediate:!0});const p=ze({show:!1,x:0,y:0,forRulerID:""}),f=(S,b)=>{[p.x,p.y]=b,p.show=!0,p.forRulerID=S},m=()=>{o.removeRuler(p.forRulerID)},w=S=>{if(!S.frameOfReference)return!1;const b=Cn(S.frameOfReference,l.value,{allowOutOfBoundsSlice:!0});return!!b&&b.axis===u.value};return{rulers:I(()=>{const{lengthByID:S}=o,b=r.value;return i.value.filter(D=>D.imageID===b&&w(D)).map(D=>({...D,length:S[D.id]}))}),placingRulerID:d,contextMenu:p,openContextMenu:f,deleteRulerFromContextMenu:m,onRulerPlaced:h}}});const Vg={class:"overlay-no-events"},Pg={class:"overlay-no-events"};function kg(e,t,n,s,o,i){const a=P("RulerWidget2D");return x(),L("div",Vg,[(x(),L("svg",Pg,[(x(!0),L(se,null,Pe(e.rulers,r=>(x(),K(a,{key:r.id,"ruler-id":r.id,"is-placing":r.id===e.placingRulerID,"current-slice":e.currentSlice,"view-id":e.viewId,"view-direction":e.viewDirection,"widget-manager":e.widgetManager,onContextmenu:l=>e.openContextMenu(r.id,l),onPlaced:e.onRulerPlaced},null,8,["ruler-id","is-placing","current-slice","view-id","view-direction","widget-manager","onContextmenu","onPlaced"]))),128))])),y(wt,{modelValue:e.contextMenu.show,"onUpdate:modelValue":t[0]||(t[0]=r=>e.contextMenu.show=r),class:"position-absolute",style:ne({top:`${e.contextMenu.y}px`,left:`${e.contextMenu.x}px`}),"close-on-click":"","close-on-content-click":""},{default:R(()=>[y(Nt,{density:"compact"},{default:R(()=>[y(Ze,{onClick:e.deleteRulerFromContextMenu},{default:R(()=>[y(De,null,{default:R(()=>[H("Delete")]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1},8,["modelValue","style"])])}const Mg=A(Og,[["render",kg],["__scopeId","data-v-6e6ae374"]]);function Bg(e,t){t.classHierarchy.push("vtkRectangleWidget")}const Ag={};function ns(e,t,n={}){Object.assign(t,Ag,n);const{store:s,...o}=n,i={...s,rulerByID:s.toolByID,updateRuler:s.updateTool};ts.extend(e,t,{store:i,...o}),Bg(e,t)}const Fg=_.newInstance(ns,"vtkRectangleWidget"),Ng={newInstance:Fg,extend:ns},$g=X({props:{point1:Array,point2:Array,color:String,fillColor:String,viewId:{type:String,required:!0}},setup(e){const{viewId:t,point1:n,point2:s}=ae(e),o=M(),i=M(),a=de(),r=I(()=>a.getViewProxy(t.value)),l=()=>{const h=r.value.getRenderer(),v=z(n),p=z(s);if(v){const f=zt(v,h);f&&(o.value={x:f[0],y:f[1]})}else o.value=null;if(p){const f=zt(p,h);f&&(i.value={x:f[0],y:f[1]})}else i.value=null},c=I(()=>{var m,w,T,S;const[h,v]=[((m=o.value)==null?void 0:m.x)??0,((w=o.value)==null?void 0:w.y)??0],[p,f]=[((T=i.value)==null?void 0:T.x)??h,((S=i.value)==null?void 0:S.y)??v];return{x:Math.min(h,p),y:Math.min(v,f),width:Math.abs(h-p),height:Math.abs(v-f)}});Se(I(()=>r.value.getCamera().onModified))(l),F([r,n,s],l,{deep:!0,immediate:!0});const d=ct(mn);return xn(d,()=>{l()}),{devicePixelRatio,first:o,second:i,rectangle:c}}}),Ug=["x","y","width","height","stroke","fill"],Hg=["cx","cy","stroke","r"],Wg=["cx","cy","stroke","r"];function zg(e,t,n,s,o,i){return x(),L("g",null,[g("rect",{x:e.rectangle.x,y:e.rectangle.y,width:e.rectangle.width,height:e.rectangle.height,stroke:e.color,"stroke-width":"1",fill:e.fillColor},null,8,Ug),e.first?(x(),L("circle",{key:0,cx:e.first.x,cy:e.first.y,stroke:e.color,"stroke-width":"1",fill:"transparent",r:10/e.devicePixelRatio},null,8,Hg)):j("",!0),e.second?(x(),L("circle",{key:1,cx:e.second.x,cy:e.second.y,stroke:e.color,"stroke-width":"1",fill:"transparent",r:10/e.devicePixelRatio},null,8,Wg)):j("",!0)])}const jg=A($g,[["render",zg]]),Gg=Ne,Xg=Ng,qg=jg,Yg=X({name:"RectangleWidget2D",emits:["placed","contextmenu"],props:{toolId:{type:String,required:!0},widgetManager:{type:Object,required:!0},viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},currentSlice:{type:Number,required:!0},isPlacing:{type:Boolean,default:!1}},components:{SVG2DComponent:qg},setup(e,{emit:t}){const{toolId:n,widgetManager:s,viewDirection:o,currentSlice:i,isPlacing:a}=ae(e),r=M(n.value),l=Gg(),c=I(()=>l.toolByID[r.value]),{currentImageID:u,currentImageMetadata:d}=ce(),h=Xg.newInstance({id:r.value,store:l,isPlaced:!a.value}),v=M(null);ee(()=>{v.value=s.value.addWidget(h)}),$e(()=>{v.value&&(s.value.removeWidget(v.value),v.value.delete(),h.delete())}),F([a,v],([b,O])=>{b&&O&&O.setInteractionState(Xt.PlacingFirst)},{immediate:!0}),F([i,u,v],()=>{var O;const b=(O=v.value)==null?void 0:O.getWidgetState().getIsPlaced();v.value&&!b&&(v.value.resetInteractions(),v.value.setInteractionState(Xt.PlacingFirst))}),Se(I(()=>{var b;return(b=v.value)==null?void 0:b.onPlacedEvent}))(()=>{t("placed")});let f=null;ee(()=>{v.value&&(f=v.value.onRightClickEvent(b=>{const O=uo(b);O&&t("contextmenu",O)}))}),we(()=>{f&&(f.unsubscribe(),f=null)});const m=je.newInstance();ee(()=>{v.value&&v.value.setManipulator(m)}),fe(()=>{var b;on(m,o.value,((b=c.value)==null?void 0:b.slice)??i.value,d.value)}),F(()=>{var b;return!!v.value&&((b=c.value)==null?void 0:b.slice)===i.value},b=>{var O;(O=v.value)==null||O.setVisibility(b)},{immediate:!0}),ee(()=>{v.value&&(v.value.setHandleVisibility(!1),s.value.renderWidgets())});const w=b=>{const O=M(!1),D=()=>{b.value&&(O.value=b.value.getVisible())};return Se(I(()=>{var E;return(E=b.value)==null?void 0:E.onModified}))(()=>D()),wi(b,()=>D()),O},T=w(I(()=>{var b;return(b=v.value)==null?void 0:b.getWidgetState().getFirstPoint()})),S=w(I(()=>{var b;return(b=v.value)==null?void 0:b.getWidgetState().getSecondPoint()}));return{tool:c,firstPoint:I(()=>T.value?c.value.firstPoint:void 0),secondPoint:I(()=>S.value?c.value.secondPoint:void 0)}}});function Kg(e,t,n,s,o,i){const a=P("SVG2DComponent");return tt((x(),K(a,{"view-id":e.viewId,point1:e.firstPoint,point2:e.secondPoint,color:e.tool.color,"fill-color":e.tool.fillColor},null,8,["view-id","point1","point2","color","fill-color"])),[[Ft,e.currentSlice===e.tool.slice]])}const Qg=A(Yg,[["render",Kg]]),Zg=Ne,Jg=X({name:"RectangleTool",props:{viewId:{type:String,required:!0},currentSlice:{type:Number,required:!0},viewDirection:{type:String,required:!0},widgetManager:{type:Object,required:!0}},components:{RectangleWidget2D:Qg},setup(e){const{viewDirection:t,currentSlice:n}=ae(e),s=Oe(),o=Zg(),{tools:i,activeLabel:a}=nt(o),{currentImageID:r,currentImageMetadata:l}=ce(),c=I(()=>s.currentTool===oe.Rectangle),u=I(()=>Te(t.value)),d=M(null);F(d,(S,b)=>{b!=null&&o.updateTool(b,{placing:!1}),S!=null&&o.updateTool(S,{placing:!0})},{immediate:!0}),F([c,r],([S,b])=>{d.value!=null&&(o.removeTool(d.value),d.value=null),S&&b&&(d.value=o.addTool({imageID:b,placing:!0}))},{immediate:!0}),F([a,d],([S,b])=>{b!=null&&o.updateTool(b,{label:S,...S&&o.labels[S]})},{immediate:!0}),$e(()=>{d.value!=null&&(o.removeTool(d.value),d.value=null)});const h=()=>{r.value&&(d.value=o.addTool({imageID:r.value,placing:!0}))},v=()=>{const{lpsOrientation:S,indexToWorld:b}=l.value,O=S[t.value],D=S[u.value],k=[0,0,0];return k[D]=n.value,pe(k,k,b),{planeNormal:O,planeOrigin:k}};F([n,d],([S,b])=>{b&&o.updateTool(b,{frameOfReference:v(),slice:S})},{immediate:!0});const p=ze({show:!1,x:0,y:0,forToolID:""}),f=(S,b)=>{[p.x,p.y]=b,p.show=!0,p.forToolID=S},m=()=>{o.removeTool(p.forToolID)},w=S=>{if(!S.frameOfReference)return!1;const b=Cn(S.frameOfReference,l.value,{allowOutOfBoundsSlice:!0});return!!b&&b.axis===u.value};return{tools:I(()=>{const S=r.value;return i.value.filter(b=>b.imageID===S&&w(b))}),placingToolID:d,contextMenu:p,openContextMenu:f,deleteToolFromContextMenu:m,onToolPlaced:h}}});const ef={class:"overlay-no-events"},tf={class:"overlay-no-events"};function nf(e,t,n,s,o,i){const a=P("RectangleWidget2D");return x(),L("div",ef,[(x(),L("svg",tf,[(x(!0),L(se,null,Pe(e.tools,r=>(x(),K(a,{key:r.id,"tool-id":r.id,"is-placing":r.id===e.placingToolID,"current-slice":e.currentSlice,"view-id":e.viewId,"view-direction":e.viewDirection,"widget-manager":e.widgetManager,onContextmenu:l=>e.openContextMenu(r.id,l),onPlaced:e.onToolPlaced},null,8,["tool-id","is-placing","current-slice","view-id","view-direction","widget-manager","onContextmenu","onPlaced"]))),128))])),y(wt,{modelValue:e.contextMenu.show,"onUpdate:modelValue":t[0]||(t[0]=r=>e.contextMenu.show=r),class:"position-absolute",style:ne({top:`${e.contextMenu.y}px`,left:`${e.contextMenu.x}px`}),"close-on-click":"","close-on-content-click":""},{default:R(()=>[y(Nt,{density:"compact"},{default:R(()=>[y(Ze,{onClick:e.deleteToolFromContextMenu},{default:R(()=>[y(De,null,{default:R(()=>[H("Delete")]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1},8,["modelValue","style"])])}const of=A(Jg,[["render",nf],["__scopeId","data-v-152d5701"]]),af=32,ai=2,sf=4;function rf(e,t){t.classHierarchy.push("vtkContourRepresentation"),t._polyData=Je.newInstance({mtime:0}),t._pdPoints=null,t._pdLines=null,t._pipelines={lines:{source:e,mapper:Kt.newInstance(),actor:Ai.newInstance({parentProp:e})}},t._pipelines.lines.actor.getProperty().setLineWidth(2),Qn.connectPipeline(t._pipelines.lines),e.addActor(t._pipelines.lines.actor),e.getRepresentationStates=(i=t.inputData[0])=>i;function n(i){var f,m;const a=i.getPolyLine(),r=i.getReferencePlane(),l=i.getPolyLineLength(),c=i.getFinalized(),u=c?1:0;if(!a||!r)return;((f=t._pdPoints)==null?void 0:f.length)!==l*3&&(t._pdPoints=new Float32Array(l*3)),((m=t._pdLines)==null?void 0:m.length)!==l+1&&(t._pdLines=new Float32Array(l+1+u));let d=0,h=0;t._pdLines[h++]=l+u;const v=Be(),p=Ee();for(let w=0;w<a.length;)t._pdLines[h++]=d/3,yi(v,a[w++],a[w++]),bn(v,r,p),t._pdPoints[d++]=p[0],t._pdPoints[d++]=p[1],t._pdPoints[d++]=p[2];c&&(t._pdLines[h]=0)}let s=ai;e.requestData=(i,a)=>{const r=e.getRepresentationStates(i[0]);n(r),t._pdPoints&&t._pdLines&&(t._polyData.getPoints().setData(t._pdPoints),t._polyData.getLines().setData(t._pdLines),t._polyData.getPoints().modified(),t._polyData.modified()),s=r.getSelected()?sf:ai,t._pipelines.lines.actor.getProperty().setLineWidth(s),t._pipelines.lines.actor.getProperty().setColor(r.getColor()),a[0]=t._polyData},e.getSelectedState=()=>t.inputData[0];const{updateActorVisibility:o}=e;e.updateActorVisibility=(i=Fo.FRONT_BUFFER,a=!0,r=!0)=>{i===Fo.PICKING_BUFFER?t._pipelines.lines.actor.getProperty().setLineWidth(af):t._pipelines.lines.actor.getProperty().setLineWidth(s),o(i,a,r)}}const lf={};function os(e,t,n={}){const s={...lf,...n};Qn.extend(e,t,s),rf(e,t)}const cf=_.newInstance(os,"vtkContourRepresentation"),uf={newInstance:cf,extend:os};var Ve=(e=>(e.Select="Select",e.Freehand="Freehand",e.Nudge="Nudge",e.PointPlacing="PointPlacing",e.Threshold="Threshold",e))(Ve||{});const Q={Idle:"Idle",Moving:"Moving",FreehandDrawing:"FreehandDrawing",Nudging:"Nudging",PointPlacing:"PointPlacing",Thresholding:"Thresholding"};function he(e){return e.altKey||e.controlKey||e.shiftKey}function Ie(e,t){const n=e.manipulator.handleEvent(t,e._apiSpecificRenderWindow);return(n==null?void 0:n.length)===3?n:null}function is(e,t){const n=(t==null?void 0:t.degree)??2,s=(t==null?void 0:t.interPointSpacing)??.1,o=(t==null?void 0:t.closed)??!1,i=(t==null?void 0:t.clamped)??!1,a=e.length/3,r=[],l=Be();let c=0;for(let p=0;p<e.length;p+=2){const f=[e[p],e[p+1]];r.push(f),p>0&&(c+=Si(l,f)),js(l,f)}o&&r.push(...r.slice(0,n+1));let u;if(i){u=[];const p=r.length;for(let f=0;f<p+n+1;f++)u.push(f)}const d=!i&&o?1-1/(a+1):1,h=(t==null?void 0:t.dt)??s/c,v=[];for(let p=0;p<1;p+=h){const f=Gs(p*d,n,r,u);v.push(f[0],f[1])}return v}function df(e,t){const n={...e};function s(){return e.getMode()===Ve.Freehand}function o(){e.setInteractionState(Q.Idle),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent()}e.resetInteractionState=()=>{s()&&!e.isInteractionIdle()&&(t.widgetState.clearPolyLine(),o()),n.resetInteractionState()},e.handleLeftButtonPress=i=>{var l;if(((l=n.handleLeftButtonPress)==null?void 0:l.call(n,i))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||!t.manipulator||he(i))return _.VOID;if(t.widgetState.getFinalized())return _.VOID;const a=t._widgetManager.getActiveWidget();if(a&&a!==e)return _.VOID;const r=Ie(t,i);return r?(e.setInteractionState(Q.FreehandDrawing),t.widgetState.clearPolyLine(),t.widgetState.add3dPointToPolyLine(r),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),_.EVENT_ABORT):_.VOID},e.handleMouseMove=i=>{var r;if(((r=n.handleMouseMove)==null?void 0:r.call(n,i))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||e.getInteractionState()!==Q.FreehandDrawing||he(i))return _.VOID;const a=Ie(t,i);return a&&(t.widgetState.add3dPointToPolyLine(a),e.invokeInteractionEvent()),_.EVENT_ABORT},e.handleLeftButtonRelease=i=>{var l;if(((l=n.handleLeftButtonRelease)==null?void 0:l.call(n,i))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||e.getInteractionState()!==Q.FreehandDrawing||he(i))return _.VOID;const a=Ie(t,i);if(a&&t.widgetState.add3dPointToPolyLine(a),t.widgetState.getPolyLine().length>=3*2){const c=is(t.widgetState.getPolyLine(),{degree:2,interPointSpacing:.01,closed:!0,clamped:!1});t.widgetState.setPolyLine(c),t.widgetState.setFinalized(!0)}return o(),_.EVENT_ABORT}}const hf=new Set([Ve.Nudge]);function gf(e,t){const n={...e};let s=[0,0],o=null;_.event(e,t,"SelectedEvent");const i=Be();function a(l){if(!o)return;Xs(i,l,s);const c=t.widgetState.getPolyLine();for(let u=0;u<c.length;u+=2)c[u]=o[u]+i[0],c[u+1]=o[u+1]+i[1];t.widgetState.modified()}function r(){e.setInteractionState(Q.Idle),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent()}e.resetInteractionState=()=>{e.getInteractionState()===Q.Moving&&r(),n.resetInteractionState()},e.handleLeftButtonPress=l=>{var u;if(((u=n.handleLeftButtonPress)==null?void 0:u.call(n,l))===_.EVENT_ABORT)return _.EVENT_ABORT;if(he(l))return _.VOID;if(t._widgetManager.getActiveWidget()!==e)return hf.has(e.getMode())||e.invokeSelectedEvent(!1),_.VOID;e.invokeSelectedEvent(!0);const c=Ie(t,l);return c?(s=et(c,t.widgetState.getReferencePlane()),o=[...t.widgetState.getPolyLine()],e.setInteractionState(Q.Moving),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),_.EVENT_ABORT):_.EVENT_ABORT},e.handleMouseMove=l=>{var u;if(((u=n.handleMouseMove)==null?void 0:u.call(n,l))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!e.isSelected()||e.getInteractionState()!==Q.Moving||he(l))return _.VOID;const c=Ie(t,l);return c&&(a(et(c,t.widgetState.getReferencePlane())),e.invokeInteractionEvent()),_.EVENT_ABORT},e.handleLeftButtonRelease=l=>{var u;if(((u=n.handleLeftButtonRelease)==null?void 0:u.call(n,l))===_.EVENT_ABORT)return _.EVENT_ABORT;if(e.getInteractionState()!==Q.Moving||he(l))return _.VOID;const c=Ie(t,l);return c&&a(et(c,t.widgetState.getReferencePlane())),r(),_.EVENT_ABORT}}function Fn(e,t,n){return(e+t)%n}function ff(e,t,n){e[0]=(t[0]+n[0])/2,e[1]=(t[1]+n[1])/2}function pf(e,t,n){const{radius:s,center:o}=t,i=s**2,a=Ee(),r=[0,0,0],l=[0,0];for(let c=0;c<e.length;c+=2){vt(l,e[c],e[c+1]),bn(l,n,r);const u=qs(r,o);u>=i||(pi(a,r,o),Ys(a,a,Math.sqrt(i/u)),Ks(r,o,a),et(r,n,l),e[c]=l[0],e[c+1]=l[1])}}function mf(e,t,n){if(e.length<2)return;const s=t**2,o=n**2,i=Be(),a=Be(),r=Be(),l=Be();let c=0,u=!1,d=!1;do{let h=c;const v=Fn(c,2,e.length);vt(i,e[c],e[c+1]),vt(a,e[v],e[v+1]);const p=_i(i,a);if(p<s)ff(r,i,a),e.splice(v,2),e.splice(c,2),e.splice(c,0,...r);else if(p>o){const m=1/(Math.ceil(Math.sqrt(p/o))+1),w=[];for(let T=m;T<1;T+=m)Qs(l,i,a,T),w.push(...l);e.splice(v,0,...w),h=Fn(c,w.length+2,e.length)}else h=Fn(c,2,e.length);d=u,u=h<c,c=h}while(!d)}function vf(e,t,n,s=1e-4,o=.1){pf(e,t,n),mf(e,s,o)}function yf(e,t){let n=0,s=1/0;const o=Be();for(let i=0;i<e.length;i+=2){vt(o,e[i],e[i+1]);const a=_i(o,t);a<s&&(n=i,s=a)}return n}const wf=.95;function Sf(e,t){const n={...e};t._radius=1;function s(){return e.getMode()===Ve.Nudge}function o(a){const r=t.widgetState.getPolyLine(),l=t.widgetState.getReferencePlane();vf(r,{center:a,radius:t._radius},l),t.widgetState.modified()}function i(){e.getWidgetState().getCircleContext().setVisible(!1),e.setInteractionState(Q.Idle),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent()}e.resetInteractionState=()=>{s()&&!e.isInteractionIdle()&&i(),n.resetInteractionState()},e.handleLeftButtonPress=a=>{var T;if(((T=n.handleLeftButtonPress)==null?void 0:T.call(n,a))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||!e.isSelected()||!t.manipulator||he(a))return _.VOID;const r=t._widgetManager.getActiveWidget();if(r&&r!==e)return _.VOID;const l=Ie(t,a);if(!l)return _.VOID;const{widgetState:c}=t,u=c.getPolyLine(),d=c.getReferencePlane(),h=yf(u,et(l,d)),v=Zs(l,bn([u[h],u[h+1]],d));t._radius=v*wf;const p=t.manipulator.getNormal(),f=t._renderer.getActiveCamera().getViewUp(),m=Ee();Xn(m,f,p);const w=c.getCircleContext();return w.setDirection(p),w.setUp(f),w.setRight(m),w.setOrigin(l),w.setScale3([t._radius,t._radius,1]),w.setVisible(!0),e.setInteractionState(Q.Nudging),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),_.EVENT_ABORT},e.handleMouseMove=a=>{var l;if(((l=n.handleMouseMove)==null?void 0:l.call(n,a))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||!e.isSelected()||e.getInteractionState()!==Q.Nudging||he(a))return _.VOID;const r=Ie(t,a);return r&&(e.getWidgetState().getCircleContext().setOrigin(r),o(r),e.invokeInteractionEvent()),_.EVENT_ABORT},e.handleLeftButtonRelease=a=>{var l;if(((l=n.handleLeftButtonRelease)==null?void 0:l.call(n,a))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||!e.isSelected()||e.getInteractionState()!==Q.Nudging||he(a))return _.VOID;const r=Ie(t,a);return r&&o(r),i(),_.EVENT_ABORT}}function _f(e,t){const n={...e};function s(){return e.getMode()===Ve.PointPlacing}function o(){t._widgetManager.releaseFocus(),e.setInteractionState(Q.Idle),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent()}function i(r){const l=t.widgetState.getPolyLine(),c=l.length-1;l[c-1]=r[0],l[c]=r[1],t.widgetState.modified()}function a(){t.widgetState.getPolyLine().splice(-2,2),t.widgetState.modified()}e.resetInteractionState=()=>{s()&&!e.isInteractionIdle()&&(t.widgetState.clearPolyLine(),o()),n.resetInteractionState()},e.handleLeftButtonPress=r=>{var d;if(((d=n.handleLeftButtonPress)==null?void 0:d.call(n,r))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||!t.manipulator||he(r))return _.VOID;if(t.widgetState.getFinalized())return _.VOID;const l=t._widgetManager.getActiveWidget();if(l&&l!==e)return _.VOID;const c=Ie(t,r);if(!c)return _.VOID;const u=et(c,t.widgetState.getReferencePlane());return e.getInteractionState()===Q.PointPlacing?(i(u),t.widgetState.add2dPointToPolyLine(u),e.invokeInteractionEvent()):(t._widgetManager.grabFocus(e),e.setInteractionState(Q.PointPlacing),t.widgetState.setFinalized(!1),t.widgetState.clearPolyLine(),t.widgetState.add2dPointToPolyLine(u),t.widgetState.add2dPointToPolyLine(u),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent()),_.EVENT_ABORT},e.handleMouseMove=r=>{var c;if(((c=n.handleMouseMove)==null?void 0:c.call(n,r))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||e.getInteractionState()!==Q.PointPlacing||he(r))return _.VOID;const l=Ie(t,r);if(l){const u=et(l,t.widgetState.getReferencePlane());i(u),e.invokeInteractionEvent()}return _.EVENT_ABORT},e.handleRightButtonPress=r=>{var l;if(((l=n.handleRightButtonPress)==null?void 0:l.call(n,r))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||e.getInteractionState()!==Q.PointPlacing||he(r))return _.VOID;if(a(),t.widgetState.getPolyLineLength()<=2)t.widgetState.clearPolyLine();else{const c=is(t.widgetState.getPolyLine(),{degree:2,interPointSpacing:.01,closed:!0,clamped:!1});t.widgetState.setPolyLine(c),t.widgetState.setFinalized(!0)}return o(),_.EVENT_ABORT}}const{vtkErrorMacro:Cf}=_;function bf(e,t){t.classHierarchy.push("vtkImageMarchingSquares"),e.getContourValues=()=>t.contourValues,e.setContourValues=a=>{t.contourValues=a,e.modified()};const n=[],s=[],o=[],i=Qr.newInstance();e.getPixelScalars=(a,r,l,c,u,d,h,v)=>{n[0]=l*c+r*u[0]+a,n[1]=n[0]+1,n[2]=n[0]+u[0],n[3]=n[2]+1;const p=a>=0,f=r>=0,m=a+1<u[0],w=r+1<u[1];s[0]=p&&f?v[n[0]]:0,s[1]=m&&f?v[n[1]]:0,s[2]=p&&w?v[n[2]]:0,s[3]=m&&w?v[n[3]]:0},e.getPixelPoints=(a,r,l,c,u,d)=>{o[0]=u[0]+a*d[0],o[1]=u[1]+r*d[1],o[2]=o[0]+d[0],o[3]=o[1],o[4]=o[0],o[5]=o[1]+d[1],o[6]=o[2],o[7]=o[5]},e.produceLines=(a,r,l,c,u,d,h,v,p,f,m)=>{var k;const w=[1,2,8,4],T=[];let S;e.getPixelScalars(r,l,c,u,d,h,v,p);let b=0;for(let E=0;E<4;E++)s[E]>=a&&(b|=w[E]);const O=No.getCase(b);if(O[0]<0)return;e.getPixelPoints(r,l,c,d,h,v);const D=h[2]+c*v[2];for(let E=0;O[E]>=0;E+=2){m.push(2);for(let $=0;$<2;$++){const Y=No.getEdge(O[E+$]);if(S=void 0,t.mergePoints&&(S=(k=i.isInsertedEdge(n[Y[0]],n[Y[1]]))==null?void 0:k.value),S===void 0){const B=Y[0]*2,W=o[B],J=o[B+1],Ce=Y[1]*2,me=o[Ce],Ge=o[Ce+1];T[0]=W+.5*(me-W),T[1]=J+.5*(Ge-J),S=f.length/3,f.push(T[0],T[1],D),t.mergePoints&&i.insertEdge(n[Y[0]],n[Y[1]],S)}m.push(S)}}},e.requestData=(a,r)=>{const l=a[0];if(!l){Cf("Invalid or missing input");return}const c=l.getOrigin(),u=l.getSpacing(),d=l.getDimensions(),h=l.getPointData().getScalars().getData(),v=[],p=[],f=d[0]*d[1];let m=Math.round(t.slice);m>=d[2]&&(m=0);for(let T=0;T<t.contourValues.length;++T){for(let S=-1;S<d[1];++S)for(let b=-1;b<d[0];++b)e.produceLines(t.contourValues[T],b,S,m,f,d,c,u,h,v,p);i.initialize()}const w=Je.newInstance();w.getPoints().setData(new Float32Array(v),3),w.getLines().setData(new Uint32Array(p)),r[0]=w}}const Tf={contourValues:[],slice:0,mergePoints:!1};function as(e,t,n={}){Object.assign(t,Tf,n),_.obj(e,t),_.algo(e,t,1,1),_.setGet(e,t,["slice","mergePoints"]),_.algo(e,t,1,1),bf(e,t)}const If=_.newInstance(as,"vtkImageMarchingSquares"),xf={newInstance:If,extend:as},ss=2,Rf=1,Df=0;function Lf(e,t){const n=[...e];return n.splice(t,1),n}function Ef(e,t){const[n,s]=Lf(e.getDimensions(),t),o=new Uint8Array(n*s),i=Vi.newInstance({values:o,numberOfComponents:1}),a=Oi.newInstance();return a.setDimensions([n,s,1]),a.getPointData().setScalars(i),a}function Of(e,t,n){const s=[...e];return s.splice(t,0,n),s}function fn(e,t){const n=[...e];return n.splice(t,1),n}function Vf(e,t){return Si(e,t)}function si(e,t=3){if(t>3)throw new Error("Cannot support dim > 3");const n=e.getPointData().getScalars().getData(),[s,o,i]=e.getDimensions(),a=t===3?s*o:0,r=t>=2?s:0;return{get:l=>{const c=l[0]??0,u=l[1]??0,d=l[2]??0;return n[d*a+u*r+c]},set:(l,c)=>{const u=l[0]??0,d=l[1]??0,h=l[2]??0;n[h*a+d*r+u]=c},inBounds:l=>{const c=l[0]??0,u=l[1]??0,d=l[2]??0;return c>=0&&c<s&&u>=0&&u<o&&d>=0&&d<i},fill:l=>{n.fill(l)}}}function Pf(e,t,n,s,o,i,a,r=Vf){const l=si(e,3),c=si(s,2),u=fn(o,t),d=l.get(o),h=d-i,v=d+i;c.fill(Df);const p=[u];for(;p.length;){const f=p.shift();if(!c.inBounds(f)||c.get(f)!==0||r(u,f)>a)continue;c.set(f,Rf);const m=Of(f,t,n),w=l.get(m);if(w<h||w>v)continue;c.set(f,ss);const[T,S]=f;for(let b=-1;b<=1;b++)for(let O=-1;O<=1;O++)(!b&&O||b&&!O)&&p.push([T+b,S+O])}}function kf(e){const t=xf.newInstance({mergePoints:!0});return t.setContourValues([ss]),t.setInputData(e),t.getOutputData()}Pt(0,1,0,0,0,0,1,0,1,0,0,0,0,0,0,1),Pt(1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1),Pt(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);function Mf(e,t){t.classHierarchy.push("vtkContourLoopExtraction");const n=new Set;e.traverseLoop=(s,o,i,a,r)=>{let l=i,c=a,u=!1,d=0;for(;!u;){const{cellPointIds:h}=s.getCellPoints(l);if(!h)continue;c=h[0]!==c?h[0]:h[1],d++;const v=o*d;r.push({t:v,ptId:c});const p=s.getPointCells(c);if(p.length!==2||c===a)return c;p.length===2?(l=p[0]!==l?p[0]:p[1],n.add(l)):u=!0}return c},e.computeConvexHull=(s,o)=>{const i=s.getPoints().getData(),a=[];for(let u=0;u<i.length;u+=3)a.push([i[u],i[u+1]]);const r=Js(a,1/0),l=new i.constructor(r.length*3),c=new Uint32Array(1+r.length+1);c[0]=r.length;for(let u=0,d=0;u<r.length;u++,d+=3){const h=r[u];l[d]=h[0],l[d+1]=h[1],l[d+2]=0,c[u+1]=u}c[c.length-1]=c[1],o.getPoints().setData(l),o.getLines().setData(c)},e.extractContours=(s,o)=>{var l;const i=[];n.clear();const a=s.getLines();o.getPoints().setData(Float32Array.from(s.getPoints().getData()));for(let c=0;c<a.getNumberOfCells();c++){if(n.has(c))continue;const{cellPointIds:u}=s.getCellPoints(c);if(!u)continue;n.add(c);const d=u[0],h=[];h.push({t:0,ptId:d});const v=e.traverseLoop(s,1,c,d,h);d!==v&&(e.traverseLoop(s,-1,c,d,h),h.sort((p,f)=>p.t<f.t?-1:1),h.length&&h[0].ptId!==((l=h.at(-1))==null?void 0:l.ptId)&&h.push({...h.at(-1)})),h.length&&i.push(h)}const r=o.getLines();if(r.resize(0),e.getMergeContours()&&i.length){let c=0,u=0;i.forEach((d,h)=>{d.length>u&&(c=h,u=d.length)}),r.insertNextCell(i[c].map(d=>d.ptId))}else i.forEach(c=>{r.insertNextCell(c.map(u=>u.ptId))})},e.requestData=(s,o)=>{const[i]=s;o[0]||(o[0]=Je.newInstance());const[a]=o;e.getConvexHull()?e.computeConvexHull(i,a):e.extractContours(i,a),a.modified()}}const Bf={mergeContours:!1,convexHull:!1};function rs(e,t,n={}){Object.assign(t,Bf,n),_.obj(e,t),_.algo(e,t,1,1),_.setGet(e,t,["mergeContours","convexHull"]),Mf(e,t)}const Af=_.newInstance(rs,"vtkContourLoopExtraction"),Ff={newInstance:Af,extend:rs};function Nf(e){return Array.isArray(e)?[...e]:e.constructor.from(e)}function $f(e,t){t.classHierarchy.push("vtkTransformPolyDataToPlane"),e.requestData=(n,s)=>{const o=e.getRefPlane()??Ma(),[i]=n;s[0]||(s[0]=Je.newInstance());const[a]=s,r=Float32Array.from(i.getPoints().getData());a.getPoints().setData(r);const l=[0,0],c=[0,0,0];for(let d=0;d<r.length;d+=3)vt(l,r[d],r[d+1]),bn(l,o,c),r[d]=c[0],r[d+1]=c[1],r[d+2]=c[2];const u=i.getLines().getData();a.getLines().setData(Nf(u)),a.modified()}}const Uf={refPlane:null};function ls(e,t,n={}){Object.assign(t,Uf,n),_.obj(e,t),_.algo(e,t,1,1),_.setGet(e,t,["refPlane"]),$f(e,t)}const Hf=_.newInstance(ls,"vtkTransformPolyDataToPlane"),Wf={newInstance:Hf,extend:ls},zf="m",jf="c",Gf=2;function Xf(){const e=Ai.newInstance(),t=Kt.newInstance(),n=e.getProperty();return e.setMapper(t),{actor:e,mapper:t,property:n}}function qf(e,t){const n={...e};t.imageData=null,t.sliceAxis=0,t.slice=0,t.loops=Je.newInstance(),t.maskBoundaryLines=Je.newInstance(),t.mergeContours=!1,t.doConvexHull=!1,t.contour=Xf(),t.contour.property.setLineWidth(Gf),t.contourLoopExtraction=Ff.newInstance(),t.transformPolyData=Wf.newInstance(),t.transformPolyData.setInputConnection(t.contourLoopExtraction.getOutputPort());function s(){t.contour.mapper.setInputData(Je.newInstance())}function o(){var w;(w=t._renderer)==null||w.addActor(t.contour.actor)}function i(){var w;(w=t._renderer)==null||w.removeActor(t.contour.actor)}function a(){const w=t.widgetState.getStore(),T=t.widgetState.getId(),S=w.toolByID[T],b=t.contourLoopExtraction.getOutputData(),O=b.getLines(),D=b.getPoints(),k=O.getData().length,E=[0,0,0];for(let $=0;$<k;){const Y=O.getCell($);$+=Y.length+1;const Z=[];let{length:B}=Y;Y[0]===Y.at(-1)&&B--;for(let W=0;W<B;W++)D.getPoint(Y[W],E),Z.push(E[0],E[1]);w.addTool({...S,polyLine:Z})}}s();let r=null,l=null,c=0,u=0,d=[0,0,0],h=[0,0,0],v=[0,0];function p(){if(!r)return;t.transformPolyData.setRefPlane(t.widgetState.getReferencePlane());const w=t.transformPolyData.getOutputData();t.contour.mapper.setInputData(w),t.contour.mapper.modified()}function f(){return e.getMode()===Ve.Threshold}function m(){i(),s(),e.getWidgetState().getCircleContext().setVisible(!1),t._widgetManager.releaseFocus(),e.setInteractionState(Q.Idle),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent()}e.resetInteractionState=()=>{f()&&!e.isInteractionIdle()&&m(),n.resetInteractionState()},e.setThresholdingImageSlice=(w,T,S)=>{t.imageData=w,t.sliceAxis=T,t.slice=Math.round(S)},e.handleKeyPress=w=>{var S;if(((S=n.handleKeyPress)==null?void 0:S.call(n,w))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!f()||!t.manipulator||he(w)||t.widgetState.getFinalized()||e.getInteractionState()!==Q.Thresholding)return _.VOID;let T=!1;return w.key===zf?(t.mergeContours=!t.mergeContours,t.contourLoopExtraction.setMergeContours(t.mergeContours),T=!0):w.key===jf&&(t.doConvexHull=!t.doConvexHull,t.contourLoopExtraction.setConvexHull(t.doConvexHull),T=!0),T?(p(),e.invokeInteractionEvent(),_.EVENT_ABORT):_.VOID},e.handleLeftButtonPress=w=>{var O;if(((O=n.handleLeftButtonPress)==null?void 0:O.call(n,w))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!f()||!t.manipulator||he(w))return _.VOID;if(!t.imageData||t.sliceAxis==null||t.slice==null)return _.VOID;if(r=t.imageData,c=t.sliceAxis,u=t.slice,l=Ef(r,c),t.widgetState.getFinalized())return _.VOID;const T=t._widgetManager.getActiveWidget();if(T&&T!==e)return _.VOID;const S=Ie(t,w);if(!S)return _.VOID;o(),t.mergeContours=!1;const b=t.imageData.worldToIndex(S);return d=S,h=$o(b),v=fn(h,c),t._widgetManager.grabFocus(e),e.setInteractionState(Q.Thresholding),t.widgetState.setFinalized(!1),t.widgetState.clearPolyLine(),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),_.EVENT_ABORT},e.handleMouseMove=w=>{var S;if(((S=n.handleMouseMove)==null?void 0:S.call(n,w))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!f()||e.getInteractionState()!==Q.Thresholding||he(w))return _.VOID;if(!r)return _.VOID;const T=$o(r.worldToIndex(Ie(t,w)));if(T&&r&&l){const b=fn(T,c),O=Math.abs(b[0]-v[0]),D=Math.abs(b[1]-v[1]),k=r.getDimensions(),E=fn(k,c),$=Math.sqrt(E[0]**2+k[1]**2),Y=r.getPointData().getScalars().getRange(),Z=Y[1]-Y[0],B=Math.min(D,$)/$*Z;Pf(r,c,u,l,h,B,O),t.maskBoundaryLines=kf(l),t.maskBoundaryLines.buildLinks(),t.contourLoopExtraction.setInputData(t.maskBoundaryLines),p();const W=t.manipulator.getNormal(),J=t._renderer.getActiveCamera().getViewUp(),Ce=Ee();Xn(Ce,J,W);const me=t.widgetState.getCircleContext();me.setDirection(W),me.setUp(J),me.setRight(Ce),me.setOrigin(d),me.setScale3([O,D,1]),me.setVisible(!0),e.invokeInteractionEvent()}return _.EVENT_ABORT},e.handleLeftButtonRelease=w=>{var T;return((T=n.handleLeftButtonRelease)==null?void 0:T.call(n,w))===_.EVENT_ABORT?_.EVENT_ABORT:!f()||e.getInteractionState()!==Q.Thresholding||he(w)?_.VOID:(a(),m(),_.EVENT_ABORT)}}function Yf(e,t){t.classHierarchy.push("vtkContourWidgetProp"),t.interactionState=Q.Idle,t.mode=null,_.event(e,t,"RightClickEvent"),_.setGet(e,t,["manipulator"]),_.setGet(e,t,["mode"]),_.setGet(e,t,["interactionState"]),e.setDisplayCallback=n=>t.representations[0].setDisplayCallback(n),e.isInteractionIdle=()=>e.getInteractionState()===Q.Idle,e.resetInteractionState=()=>{e.setInteractionState(Q.Idle)},e.isSelected=()=>t.widgetState.getSelected(),e.handleRightButtonPress=n=>he(n)||t._widgetManager.getActiveWidget()!==e?_.VOID:(e.invokeRightClickEvent(n),_.EVENT_ABORT),gf(e,t),df(e,t),_f(e,t),Sf(e,t),qf(e,t)}function Kf(e,t,n){wn.extend(e,t,n),Zr.extend(e,t,n),Mi.extend(e,t,n),Jr.extend(e,t,n),el.extend(e,t,n)}const Qf=_.newInstance(Kf,"vtkCircleContextContourWidgetState");function Zf(e,t){t.classHierarchy.push("vtkContourWidgetState"),t._circleContextState=Qf(),e.bindState(t._circleContextState,["circleContext"]),e.getCircleContext=()=>t._circleContextState;function n(){return t._store.toolByID[t.id]}e.getPolyLine=()=>{var o;return er((o=n())==null?void 0:o.polyLine)},e.getReferencePlane=()=>{var o;return(o=n())==null?void 0:o.referencePlane},e.getPolyLineLength=()=>{var i;const o=(i=n())==null?void 0:i.polyLine;return o?o.length/2:0};const s=Be();e.add3dPointToPolyLine=o=>{const i=e.getPolyLine(),a=e.getReferencePlane();!i||!a||(et(o,a,s),e.add2dPointToPolyLine(s))},e.add2dPointToPolyLine=o=>{const i=e.getPolyLine();i&&(i.push(...o),e.modified())},e.clearPolyLine=()=>{const o=e.getPolyLine();o&&(o.length=0,e.modified())},e.setPolyLine=o=>{const i=n();i&&(i.polyLine=o,e.modified())},e.getColor=()=>{var i;const o=(i=n())==null?void 0:i.label;return o?yh(t._store.labels[o].color).map(a=>a/255):null}}const Jf=e=>({finalized:!1,selected:!1,...e});function ep(e,t,n){if(Object.assign(t,Jf(n)),wn.extend(e,t,n),Bi.extend(e,t),_.get(e,t,["id"]),_.setGet(e,t,["finalized","selected"]),_.moveToProtected(e,t,["store"]),_.get(e,t,["_store"]),!t.id)throw new Error("No ID provided!");if(!t._store)throw new Error("No store provided!");Zf(e,t)}const tp=_.newInstance(ep,"vtkContourWidgetState");function np(e){return tp(e)}function op(e,t){t.classHierarchy.push("vtkContourWidget"),e.getRepresentationsForViewType=n=>{switch(n){case Qe.DEFAULT:case Qe.GEOMETRY:case Qe.SLICE:case Qe.VOLUME:default:return[{builder:uf},{builder:tl,labels:["circleContext"]}]}},e.setManipulator(t.manipulator||je.newInstance())}const ip=e=>({manipulator:null,behavior:Yf,widgetState:np(e),...e});function cs(e,t,n={}){Object.assign(t,ip(n)),vn.extend(e,t,n),_.setGet(e,t,["manipulator"]),_.event(e,t,"finalized"),op(e,t)}const ap=_.newInstance(cs,"vtkContourWidget"),sp={newInstance:ap,extend:cs},rp={[ye.Select]:Ve.Select,[ye.FreehandDraw]:Ve.Freehand,[ye.CircleNudge]:Ve.Nudge,[ye.PointPlacing]:Ve.PointPlacing,[ye.Threshold]:Ve.Threshold},lp=X({name:"ContourWidget2D",emits:["finalize","select","contextmenu"],props:{contourId:{type:String,required:!0},widgetManager:{type:Object,required:!0},viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},currentSlice:{type:Number,required:!0},drawing:{type:Boolean,default:!1},selected:{type:Boolean,default:!1},mode:{type:String,required:!0}},setup(e,{emit:t}){const{viewId:n,contourId:s,widgetManager:o,viewDirection:i,currentSlice:a,drawing:r,selected:l,mode:c}=ae(e),u=Tn(),d=I(()=>u.toolByID[s.value]),{currentImageData:h,currentImageID:v,currentImageMetadata:p}=ce(),f=I(()=>u.$proxies.getView(n.value)),m=sp.newInstance({id:s.value,store:u,finalized:!r.value}),w=M(null),T=I(()=>{var E;return(E=w.value)==null?void 0:E.getWidgetState()});ee(()=>{w.value=o.value.addWidget(m)}),$e(()=>{w.value&&(o.value.removeWidget(w.value),w.value.delete(),m.delete())}),fe(()=>{var $;const E=rp[c.value];($=w.value)==null||$.setMode(E)}),F([a,v,w],()=>{var E;(E=w.value)==null||E.resetInteractionState()}),we(()=>{var E;(E=w.value)==null||E.resetInteractionState()}),Se(I(()=>{var E;return(E=w.value)==null?void 0:E.onEndInteractionEvent}))(()=>{var E;(E=w.value)!=null&&E.getWidgetState().getFinalized()&&t("finalize")}),Se(I(()=>{var E;return(E=w.value)==null?void 0:E.onSelectedEvent}))(E=>{t("select",E)}),fe(()=>{var E,$;(E=T.value)==null||E.setSelected(l.value),($=f.value)==null||$.renderLater()});let O=null;ee(()=>{w.value&&(O=w.value.onRightClickEvent(E=>{const $=uo(E);$&&t("contextmenu",$)}))}),we(()=>{O&&(O.unsubscribe(),O=null)});const D=je.newInstance();ee(()=>{var E;(E=w.value)==null||E.setManipulator(D)}),fe(()=>{on(D,i.value,a.value,p.value)}),F(()=>{var E;return!!f.value&&!!w.value&&((E=d.value)==null?void 0:E.slice)===a.value},E=>{var $;($=w.value)==null||$.setVisibility(E)},{immediate:!0}),ee(()=>{var E;w.value&&(w.value.setHandleVisibility(!1),o.value.renderWidgets(),(E=f.value)==null||E.renderLater())}),F(()=>{var E;return(E=w.value)==null?void 0:E.getWidgetState().getColor()},()=>{var E,$;(E=w.value)==null||E.getWidgetState().modified(),($=f.value)==null||$.renderLater()});const k=I(()=>p.value.lpsOrientation[Te(i.value)]);return fe(()=>{const E=h.value,$=k.value,Y=a.value;w.value&&E&&w.value.setThresholdingImageSlice(E,$,Y)}),()=>null}}),cp=new Set([ye.FreehandDraw,ye.PointPlacing,ye.Threshold]);function up(e,t,n=1e-6){return Math.abs(e-t)<n}const dp=X({components:{ContourWidget2D:lp},props:{viewId:{type:String,required:!0},currentSlice:{type:Number,required:!0},viewDirection:{type:String,required:!0},widgetManager:{type:Object,required:!0}},setup(e){const{viewId:t,viewDirection:n,currentSlice:s}=ae(e),o=Oe(),i=Tn(),{currentImageID:a,currentImageMetadata:r}=ce(),l=I(()=>Te(n.value)),{mode:c,selectedContourID:u}=nt(i),d=M(null),h=I(()=>o.currentTool===oe.Contour),v=I(()=>de().viewSpecs[t.value].viewType),p=(B,W)=>{const{toolByID:J}=i;if(!(B in J))return!1;const{referencePlane:Ce,imageID:me}=J[B],Ge=Yd(Ce),Lt=Cn(Ge,r.value,{allowOutOfBoundsSlice:!0});if(!Lt)return!1;const Ln=(W==null?void 0:W.checkImageID)??!1,sn=(W==null?void 0:W.checkSlice)??!1,{axis:En,slice:rn}=Lt;return En===l.value&&(!Ln||me===a.value)&&(!sn||up(rn,s.value))},f=I(()=>i.toolIDs.filter(B=>p(B,{checkImageID:!0})).map(B=>i.toolByID[B]).filter(Boolean)),m=()=>{d.value=null},w=()=>{a.value&&!d.value&&(d.value=i.addTool({imageID:a.value}))},T=()=>{d.value!=null&&(i.removeTool(d.value),d.value=null)},{activeLabel:S}=nt(i);F([S,d],([B,W])=>{W&&i.updateTool(W,{label:B})},{immediate:!0}),F([h,a],([B,W])=>{T(),B&&W&&w()},{immediate:!0}),F(c,B=>{T(),cp.has(B)&&w()},{immediate:!0}),$e(()=>{T()});const b=B=>{B===d.value&&(m(),w())};function O(){const{lpsOrientation:B,indexToWorld:W}=r.value,J=B[l.value];return Qd(W,s.value,J)}F([s,d],([B,W])=>{W&&i.updateTool(W,{slice:B,referencePlane:O()})},{immediate:!0});const D=(B,W)=>{W?i.selectContour(B):B===u.value&&i.selectContour(null)};F([s,a],()=>{const B=u.value;B&&p(B,{checkImageID:!0,checkSlice:!0})&&i.selectContour(null)}),At(["Delete","Backspace"],B=>{B.preventDefault(),u.value&&i.removeTool(u.value)});const k=ze({visible:!1,x:0,y:0,id:""}),E=(B,W)=>{[k.x,k.y]=W,k.visible=!0,k.id=B},$=()=>{i.removeTool(k.id)},Y=I(()=>{const{id:B}=k;if(!(B in i.toolByID))return[];const W=i.toolByID[B];return Object.entries(i.labels).map(([J,Ce])=>({id:J,name:Ce.labelName,isCurrent:W.label===J}))}),Z=B=>{i.updateTool(k.id,{label:B})};return{isToolActive:h,is2D:I(()=>v.value==="2D"),contours:f,drawingContourID:d,selectedContourID:u,toolMode:I(()=>h.value?c.value:ye.Select),contextMenu:k,contextMenuLabels:Y,onContourFinalized:b,onContourSelected:D,onContextMenu:E,deleteFromContextMenu:$,setLabelFromContextMenu:Z}}});const hp=e=>(re("data-v-f660d016"),e=e(),le(),e),gp={key:0,class:"overlay-no-events"},fp=hp(()=>g("span",null,"Change label to...",-1));function pp(e,t,n,s,o,i){const a=P("ContourWidget2D");return e.is2D?(x(),L("div",gp,[(x(!0),L(se,null,Pe(e.contours,r=>(x(),K(a,{key:r.id,"view-id":e.viewId,"current-slice":e.currentSlice,"contour-id":r.id,"view-direction":e.viewDirection,"widget-manager":e.widgetManager,drawing:e.drawingContourID===r.id,mode:e.toolMode,selected:e.selectedContourID===r.id,onFinalize:l=>e.onContourFinalized(r.id),onSelect:l=>e.onContourSelected(r.id,l),onContextmenu:l=>e.onContextMenu(r.id,l)},null,8,["view-id","current-slice","contour-id","view-direction","widget-manager","drawing","mode","selected","onFinalize","onSelect","onContextmenu"]))),128)),y(wt,{modelValue:e.contextMenu.visible,"onUpdate:modelValue":t[1]||(t[1]=r=>e.contextMenu.visible=r),style:ne({position:"absolute",top:`${e.contextMenu.y}px`,left:`${e.contextMenu.x}px`}),"close-on-click":"","close-on-content-click":""},{default:R(()=>[y(Nt,{dense:""},{default:R(()=>[y(Ze,{onClick:t[0]||(t[0]=ie(()=>{},["stop"]))},{default:R(()=>[y(De,{class:"d-flex flex-row align-center justify-space-betwen"},{default:R(()=>[fp,y(yt,null,{default:R(()=>[H("mdi-chevron-right")]),_:1})]),_:1}),y(wt,{"open-on-hover":"",activator:"parent",location:"end"},{default:R(()=>[y(Nt,{dense:""},{default:R(()=>[(x(!0),L(se,null,Pe(e.contextMenuLabels,(r,l)=>(x(),K(Ze,{key:l},{default:R(()=>[y(Sr,{label:r.name,"model-value":r.isCurrent,onClick:c=>e.setLabelFromContextMenu(r.id)},null,8,["label","model-value","onClick"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),y(Ze,{onClick:e.deleteFromContextMenu},{default:R(()=>[y(De,null,{default:R(()=>[H("Delete")]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1},8,["modelValue","style"])])):j("",!0)}const mp=A(dp,[["render",pp],["__scopeId","data-v-f660d016"]]),vp=X({name:"PaintWidget2D",props:{widgetManager:{type:Object,required:!0},viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},slice:{type:Number,required:!0}},setup(e){const{widgetManager:t,viewDirection:n,slice:s,viewId:o}=ae(e),i=lt(),a=i.getWidgetFactory(),r=de(),l=I(()=>r.getViewProxy(o.value)),c=M(),{currentImageMetadata:u}=ce(),d=I(()=>Te(n.value)),h=I(()=>u.value.lpsOrientation[d.value]),v=m=>{const{worldToIndex:w}=u.value,T=Ee();return pe(T,m,w),T};ee(()=>{const m=t.value;if(c.value=m.addWidget(a),!c.value)throw new Error("[PaintWidget2D] failed to create view widget")}),fe(()=>{const m=c.value,w=u.value,T=w.lpsOrientation[d.value];m&&(m.setSlicingIndex(T),m.setIndexToWorld(w.indexToWorld),m.setWorldToIndex(w.worldToIndex))});const p=[];ee(()=>{const m=c.value;p.push(m.onStartInteractionEvent(()=>{const w=m.getWidgetState(),T=v(w.getBrush().getOrigin());i.startStroke(T,h.value)}),m.onInteractionEvent(()=>{const w=m.getWidgetState(),T=v(w.getBrush().getOrigin());i.placeStrokePoint(T,h.value)}),m.onEndInteractionEvent(()=>{const w=m.getWidgetState(),T=v(w.getBrush().getOrigin());i.endStroke(T,h.value)}))}),$e(()=>{for(;p.length;)p.pop().unsubscribe()});const f=je.newInstance();return ee(()=>{c.value.setManipulator(f)}),fe(()=>{on(f,n.value,s.value,u.value)}),ee(()=>{c.value.setVisibility(!1)}),Gt(l.value.getInteractor().onMouseEnter(()=>{const m=c.value;m&&(i.setSliceAxis(h.value),m.setVisibility(!0))})),Gt(l.value.getInteractor().onMouseLeave(()=>{const m=c.value;m&&m.setVisibility(!1)})),ee(()=>{const m=t.value;m.renderWidgets(),m.grabFocus(c.value)}),we(()=>{t.value.removeWidget(c.value),t.value.releaseFocus()}),()=>null}}),yp=X({name:"PaintTool",props:{viewId:{type:String,required:!0},slice:{type:Number,required:!0},viewDirection:{type:String,required:!0},widgetManager:{type:Object,required:!0}},components:{PaintWidget2D:vp},setup(){const e=lt();return{active:I(()=>e.isActive)}}});const wp={class:"overlay-no-events"};function Sp(e,t,n,s,o,i){const a=P("PaintWidget2D");return x(),L("div",wp,[e.active?(x(),K(a,{key:0,slice:e.slice,"view-id":e.viewId,"view-direction":e.viewDirection,"widget-manager":e.widgetManager},null,8,["slice","view-id","view-direction","widget-manager"])):j("",!0)])}const _p=A(yp,[["render",Sp],["__scopeId","data-v-5ff6d31b"]]);function Cp(e,t){const n=de(),s=I(()=>n.getViewProxy(e.value)),o=I(()=>{var u;const c=(u=t.baseImage)==null?void 0:u.value;return c?n.getDataRepresentationForView(c,e.value):null}),i=I(()=>{var u;return(((u=t.labelmaps)==null?void 0:u.value)??[]).map(d=>n.getDataRepresentationForView(d,e.value)).filter(Boolean)}),a=I(()=>{var c;return(((c=t.layers)==null?void 0:c.value)??[]).map(u=>n.getDataRepresentationForView(u,e.value)).filter(Boolean)}),r=I(()=>{var u;return(((u=t.models)==null?void 0:u.value)??[]).map(d=>n.getDataRepresentationForView(d,e.value)).filter(Boolean)}),l=I(()=>[o.value,...i.value,...a.value,...r.value].filter(Boolean));return F([s,l],([c,u],[,d])=>{if(!c)throw new Error("[useSceneBuilder] No view available");d&&Zn(u,d)||(c.removeAllRepresentations(),u.forEach(h=>{c.addRepresentation(h)}),c.getRenderer().computeVisiblePropBounds(),c.renderLater())},{immediate:!0}),{baseImageRep:o,labelmapReps:i,layerReps:a,modelReps:r}}function bp(e,t,n,...s){const o=ho();let i=!0;const a=[];s.indexOf("position")>-1&&a.push(()=>{t.value!==null&&i&&o.updateConfig(e.value,t.value,{position:n.value.getCamera().getPosition()})}),s.indexOf("viewUp")>-1&&a.push(()=>{t.value!==null&&i&&o.updateConfig(e.value,t.value,{viewUp:n.value.getCamera().getViewUp()})}),s.indexOf("focalPoint")>-1&&a.push(()=>{t.value!==null&&i&&o.updateConfig(e.value,t.value,{focalPoint:n.value.getCamera().getFocalPoint()})}),s.indexOf("directionOfProjection")>-1&&a.push(()=>{t.value!==null&&i&&o.updateConfig(e.value,t.value,{directionOfProjection:n.value.getCamera().getDirectionOfProjection()})}),s.indexOf("parallelScale")>-1&&a.push(()=>{t.value!==null&&i&&o.updateConfig(e.value,t.value,{parallelScale:n.value.getCamera().getParallelScale()})}),Gt(n.value.getCamera().onModified(()=>{a.forEach(c=>c())}));function r(c){i=!1;try{c()}finally{i=!0}}function l(c){r(()=>{s.forEach(u=>{if(u==="parallelScale"&&c.parallelScale)n.value.getCamera().setParallelScale(c.parallelScale);else if(u==="position"&&c.position){const{position:d}=c;n.value.getCamera().setPosition(d[0],d[1],d[2])}else if(u==="focalPoint"&&c.focalPoint){const{focalPoint:d}=c;n.value.getCamera().setFocalPoint(d[0],d[1],d[2]),n.value.getInteractorStyle2D().setCenterOfRotation([...d]),n.value.getInteractorStyle3D().setCenterOfRotation([...d])}else if(u==="directionOfProjection"&&c.directionOfProjection){const{directionOfProjection:d}=c;n.value.getCamera().setDirectionOfProjection(d[0],d[1],d[2])}else if(u==="viewUp"&&c.viewUp){const{viewUp:d}=c;n.value.getCamera().setViewUp(d[0],d[1],d[2])}})})}return{restoreCameraConfig:l}}const Tp=X({name:"CrosshairsWidget2D",props:{widgetManager:{type:Object,required:!0},viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},slice:{type:Number,required:!0}},setup(e){const{widgetManager:t,viewDirection:n,slice:s}=ae(e),i=jt().getWidgetFactory(),a=M(),{currentImageMetadata:r}=ce();ee(()=>{const c=t.value;if(a.value=c.addWidget(i),!a.value)throw new Error("[PaintWidget2D] failed to create view widget")});const l=je.newInstance();return ee(()=>{a.value.setManipulator(l)}),fe(()=>{on(l,n.value,s.value,r.value)}),ee(()=>{a.value.setVisibility(!0)}),ee(()=>{t.value.renderWidgets()}),we(()=>{t.value.removeWidget(a.value)}),()=>null}}),Ip=X({props:{position:Array,viewId:{type:String,required:!0}},setup(e){const{viewId:t,position:n}=ae(e),s=M(),o=de(),i=I(()=>o.getViewProxy(t.value)),a=()=>{const c=i.value.getRenderer(),u=z(n);if(u){const d=zt(u,c);d&&(s.value={x:d[0],y:d[1]})}};Se(I(()=>i.value.getCamera().onModified))(a),fe(a);const l=ct(mn);return xn(l,()=>{a()}),{devicePixelRatio,x:I(()=>{var c;return(c=s.value)==null?void 0:c.x}),y:I(()=>{var c;return(c=s.value)==null?void 0:c.y})}}});const xp=["x1","x2","y2"],Rp=["x1","y1","x2"],Dp=["y1","x2","y2"],Lp=["x1","y1","y2"];function Ep(e,t,n,s,o,i){return x(),L("g",null,[e.x!=null&&e.y!=null?(x(),L("line",{key:0,x1:e.x,y1:"0%",x2:e.x,y2:e.y-8,stroke:"yellow","stroke-width":"1"},null,8,xp)):j("",!0),e.x!=null&&e.y!=null?(x(),L("line",{key:1,x1:e.x,y1:e.y+8,x2:e.x,y2:"100%",stroke:"yellow","stroke-width":"1"},null,8,Rp)):j("",!0),e.x!=null&&e.y!=null?(x(),L("line",{key:2,x1:"0%",y1:e.y,x2:e.x-8,y2:e.y,stroke:"yellow","stroke-width":"1"},null,8,Dp)):j("",!0),e.x!=null&&e.y!=null?(x(),L("line",{key:3,x1:e.x+8,y1:e.y,x2:"100%",y2:e.y,stroke:"yellow","stroke-width":"1"},null,8,Lp)):j("",!0)])}const Op=A(Ip,[["render",Ep],["__scopeId","data-v-d7c70d6c"]]),Vp=X({name:"CrosshairsTool",props:{viewId:{type:String,required:!0},slice:{type:Number,required:!0},viewDirection:{type:String,required:!0},widgetManager:{type:Object,required:!0}},components:{CrosshairsWidget2D:Tp,CrosshairSVG2D:Op},setup(e){const{viewDirection:t,slice:n}=ae(e),s=Oe(),{position:o,imagePosition:i}=nt(jt()),{currentImageMetadata:a}=ce(),r=I(()=>s.currentTool===oe.Crosshairs),l=I(()=>{const{lpsOrientation:c,dimensions:u}=a.value,d=Te(t.value),h=c[d],v=zi(i.value[h],0,u[h]-1);return Math.round(v)===n.value});return{active:r,position:o,isVisible:l}}});const Pp={key:0,class:"overlay-no-events"},kp={class:"overlay-no-events"};function Mp(e,t,n,s,o,i){const a=P("CrosshairSVG2D"),r=P("CrosshairsWidget2D");return e.active?(x(),L("div",Pp,[(x(),L("svg",kp,[tt(y(a,{"view-id":e.viewId,position:e.position},null,8,["view-id","position"]),[[Ft,e.isVisible]])])),y(r,{slice:e.slice,"view-id":e.viewId,"view-direction":e.viewDirection,"widget-manager":e.widgetManager},null,8,["slice","view-id","view-direction","widget-manager"])])):j("",!0)}const Bp=A(Vp,[["render",Mp],["__scopeId","data-v-8f19f7a7"]]);function Ap(e,t){const n=de(),s=M(null),o=a=>{s.value=a??null},i=I(()=>n.createOrGetViewProxy(z(e),z(t)));return F(i,(a,r)=>{r.setContainer(null),a.setContainer(s.value)}),F(s,a=>{i.value.setContainer(a),i.value.modified()}),{viewProxy:i,setContainer:o}}function Fp(e,t){Se(I(()=>z(e).onModified))(t)}function us(e){const t=M(!1),n=()=>{t.value=!!z(e).getContainer()};return n(),Fp(e,n),t}function ds(e,t){const n=us(e);F(n,s=>{s&&t()},{immediate:!0})}function Np(e,t){const n=us(e);F(n,(s,o)=>{o&&!s&&t()},{immediate:!0})}function $p(e){const t=I(()=>nl.newInstance({pickingEnabled:!1,useSvgLayer:!1,captureOn:ol.MOUSE_MOVE}));return ds(e,()=>{t.value.setRenderer(e.value.getRenderer()),t.value.enablePicking()}),Np(e,()=>{t.value.disablePicking()}),F(t,(n,s)=>{n&&(n.setRenderer(e.value.getRenderer()),n.enablePicking()),s&&s.delete()}),$e(()=>{t.value.delete()}),{widgetManager:t}}function hs(e){const t=Dt(),{currentImageMetadata:n,currentImageID:s}=ce();return I(()=>{const o=t.getConfig(z(e),s.value);if(!o)return null;const{lpsOrientation:i}=n.value,a=Te(o.axisDirection),r=[0,0,0];return r[i[a]]=o.slice,{axisName:a,axisIndex:i[a],number:o.slice,planeNormal:i[o.axisDirection],planeOrigin:r}})}function Up(e){const t=M(null),n=()=>{var o;t.value=((o=z(e))==null?void 0:o.getContainer())??null};return Se(I(()=>{var o;return(o=z(e))==null?void 0:o.onModified}))(n),n(),t}function Hp(e,t){const n=M([]),s=I(()=>{var r,l,c;return(c=(l=(r=z(t))==null?void 0:r.getRenderWindow())==null?void 0:l.getViews())==null?void 0:c[0]}),o=Up(s),i=()=>{const r=z(e),l=z(t);r==null||!l||(n.value=r.map(c=>{const u=Oa(c,l);return[u[0]/devicePixelRatio,u[1]/devicePixelRatio]}))},a=Se(I(()=>{var r;return(r=z(t))==null?void 0:r.getActiveCamera().onModified}));return tr(o,i),fe(i),a(i),i(),n}function Wp(e,t){const n=Hp(e,t);return I(()=>{var r,l;const o=n.value,i=z(t),a=(l=(r=i==null?void 0:i.getRenderWindow())==null?void 0:r.getViews())==null?void 0:l[0];if(i&&a){const[,c]=a.getViewportSize(i);return o.map(u=>[u[0],c/devicePixelRatio-u[1]])}return null})}const zp=X({props:{line:{required:!0,type:Object},clickWidth:{default:20,type:Number},outOfBounds:{default:!1,type:Boolean}},setup(){const e=M("grab"),t=M(null),n=M(0);return{onPointer:(i,a)=>{var r,l;i?(r=t.value)==null||r.setPointerCapture(a.pointerId):(l=t.value)==null||l.releasePointerCapture(a.pointerId),e.value=i?"grabbing":"grab"},onHover:i=>{n.value=i?2:0},cursor:e,grabLineEl:t,focusWidth:n}}});const jp=["x1","y1","x2","y2","stroke-width"],Gp=["x1","y1","x2","y2","stroke-width","stroke-dasharray"],Xp=["x1","y1","x2","y2","stroke-width"],qp=["x1","y1","x2","y2","stroke-width"];function Yp(e,t,n,s,o,i){return x(),L("g",null,[g("line",{x1:e.line.startEdge[0],y1:e.line.startEdge[1],x2:e.line.startCrop[0],y2:e.line.startCrop[1],"stroke-width":2+e.focusWidth,"stroke-dasharray":"6","stroke-linecap":"square",stroke:"rgba(200, 255, 0, 0.5)"},null,8,jp),g("line",{x1:e.line.startCrop[0],y1:e.line.startCrop[1],x2:e.line.endCrop[0],y2:e.line.endCrop[1],"stroke-width":2+e.focusWidth,"stroke-dasharray":e.outOfBounds?6:"none","stroke-linecap":"butt",stroke:"rgb(200, 255, 0)"},null,8,Gp),g("line",{x1:e.line.endCrop[0],y1:e.line.endCrop[1],x2:e.line.endEdge[0],y2:e.line.endEdge[1],"stroke-width":2+e.focusWidth,"stroke-dasharray":"6","stroke-linecap":"square",stroke:"rgba(200, 255, 0, 0.5)"},null,8,Xp),g("line",qt({ref:"grabLineEl",class:"pointer-events-all",style:{cursor:e.cursor},onPointerenter:t[0]||(t[0]=a=>e.onHover(!0)),onPointerleave:t[1]||(t[1]=a=>e.onHover(!1)),onPointerdown:t[2]||(t[2]=a=>e.onPointer(!0,a)),onPointerup:t[3]||(t[3]=a=>e.onPointer(!1,a)),x1:e.line.startEdge[0],y1:e.line.startEdge[1],x2:e.line.endEdge[0],y2:e.line.endEdge[1],fill:"none","stroke-opacity":"0","stroke-dasharray":"none","stroke-width":Number(e.$attrs["stroke-width"]||0)+e.clickWidth||0},e.$attrs),null,16,qp)])}const Kp=A(zp,[["render",Yp],["__scopeId","data-v-926e0a5c"]]);function ri(e,t,n,s){const o=hs(e);return I(()=>{const i=e.value,a=t.value,r=n.value,l=s.value,c=o.value;if(!i||!a||!c)return null;const u=c.axisName,[d]=eo.filter(S=>S!==a&&S!==u),h=r[a],v=r[d],p=l[d],f=r[u],m=c.number,w=m<f[0]||f[1]<m,T=S=>{const b=ft(),O=ft(),D=ft(),k=ft();return b[a]=h[S],O[a]=h[S],D[a]=h[S],k[a]=h[S],[b[d],k[d]]=p,[O[d],D[d]]=v,{startEdge:b,startCrop:O,endCrop:D,endEdge:k}};return{lowerLine:T(0),upperLine:T(1),outOfBounds:w}})}function li(e,t,n){const s=I(()=>{const i=e.value,{lpsOrientation:a,indexToWorld:r}=t.value;return i?[i.lowerLine.startEdge,i.lowerLine.startCrop,i.lowerLine.endCrop,i.lowerLine.endEdge,i.upperLine.startEdge,i.upperLine.startCrop,i.upperLine.endCrop,i.upperLine.endEdge].map(l=>{const c=[0,0,0];c[a.Sagittal]=l.Sagittal,c[a.Coronal]=l.Coronal,c[a.Axial]=l.Axial;const u=[0,0,0];return pe(u,c,r),u}):null}),o=Wp(s,n);return I(()=>{const i=e.value,a=o.value;return!i||!(a!=null&&a.length)?null:{lowerLine:{startEdge:a[0],startCrop:a[1],endCrop:a[2],endEdge:a[3]},upperLine:{startEdge:a[4],startCrop:a[5],endCrop:a[6],endEdge:a[7]},outOfBounds:i.outOfBounds}})}function Qp({mouseEventToLPSPoint:e,getCropEdgePos:t,setCropEdgePos:n}){const s=M(),o=M(),i=M(ft()),a=M(0);return{onPointerDown:(u,d,h)=>{const v=e(h);v&&(i.value=v,a.value=t(u,d),s.value=u,o.value=d)},onPointerMove:u=>{if(s.value==null||o.value==null)return;const d=s.value,h=e(u);if(!h)return;const v=h[d]-i.value[d];n(d,o.value,a.value+v)},onPointerUp:()=>{s.value=null,o.value=null}}}const Zp=X({props:{viewId:{required:!0,type:String}},components:{Crop2DLineHandle:Kp},setup(e){const{viewId:t}=ae(e),n=de(),s=I(()=>n.getViewProxy(t.value)),o=I(()=>{var D;return(D=s.value)==null?void 0:D.getRenderer()}),{currentImageExtent:i,currentImageID:a,currentImageMetadata:r}=ce(),l=hs(t),c=I(()=>{var D;return((D=l.value)==null?void 0:D.axisName)??null}),u=bt(),d=I(()=>{const D=a.value;return D&&D in u.croppingByImageID?u.croppingByImageID[D]:aa()}),h=I(()=>eo.filter(D=>c.value&&D!==c.value)),v=I(()=>h.value[0]??null),p=I(()=>h.value[1]??null),f=ri(t,v,d,i),m=ri(t,p,d,i),w=li(f,r,o),T=li(m,r,o),{onPointerDown:S,onPointerMove:b,onPointerUp:O}=Qp({mouseEventToLPSPoint(D){const k=o.value;if(!k)return null;const E=l.value;if(!E)return null;const{lpsOrientation:$,worldToIndex:Y}=r.value,Z=Rd(D,k,E.planeOrigin,E.planeNormal);if(!Z)return null;pe(Z,Z,Y);const B=ft();return B.Sagittal=Z[$.Sagittal],B.Coronal=Z[$.Coronal],B.Axial=Z[$.Axial],B},getCropEdgePos(D,k){return d.value[D][k]},setCropEdgePos(D,k,E){if(!a.value)return;const $=d.value,[Y,Z]=$[D],[B,W]=i.value[D],J=[Y,Z];k===0?J[0]=Math.max(B,Math.min(E,Z)):k===1&&(J[1]=Math.max(Y,Math.min(E,W))),u.setCroppingForAxis(a.value,D,J)}});return{ax1:I(()=>({name:v.value,lines:w.value})),ax2:I(()=>({name:p.value,lines:T.value})),onPointerDown:S,onPointerMove:b,onPointerUp:O}}});function Jp(e,t,n,s,o,i){const a=P("crop-2D-line-handle");return x(),L("g",null,[e.ax1.lines!=null?(x(),L(se,{key:0},[y(a,{line:e.ax1.lines.lowerLine,"out-of-bounds":e.ax1.lines.outOfBounds,onPointerdown:t[0]||(t[0]=r=>e.onPointerDown(e.ax1.name,0,r)),onPointermove:e.onPointerMove,onPointerup:e.onPointerUp},null,8,["line","out-of-bounds","onPointermove","onPointerup"]),y(a,{line:e.ax1.lines.upperLine,"out-of-bounds":e.ax1.lines.outOfBounds,onPointerdown:t[1]||(t[1]=r=>e.onPointerDown(e.ax1.name,1,r)),onPointermove:e.onPointerMove,onPointerup:e.onPointerUp},null,8,["line","out-of-bounds","onPointermove","onPointerup"])],64)):j("",!0),e.ax2.lines!=null?(x(),L(se,{key:1},[y(a,{line:e.ax2.lines.lowerLine,"out-of-bounds":e.ax2.lines.outOfBounds,onPointerdown:t[2]||(t[2]=r=>e.onPointerDown(e.ax2.name,0,r)),onPointermove:e.onPointerMove,onPointerup:e.onPointerUp},null,8,["line","out-of-bounds","onPointermove","onPointerup"]),y(a,{line:e.ax2.lines.upperLine,"out-of-bounds":e.ax2.lines.outOfBounds,onPointerdown:t[3]||(t[3]=r=>e.onPointerDown(e.ax2.name,1,r)),onPointermove:e.onPointerMove,onPointerup:e.onPointerUp},null,8,["line","out-of-bounds","onPointermove","onPointerup"])],64)):j("",!0)])}const em=A(Zp,[["render",Jp],["__scopeId","data-v-e3a0b15f"]]);function tm(e){return e.Sagittal[0]<=e.Sagittal[1]&&e.Coronal[0]<=e.Coronal[1]&&e.Axial[0]<=e.Axial[1]}function nm(e,t){return e.Axial[0]===t.Axial[0]&&e.Axial[1]===t.Axial[1]&&e.Sagittal[0]===t.Sagittal[0]&&e.Sagittal[1]===t.Sagittal[1]&&e.Coronal[0]===t.Coronal[0]&&e.Coronal[1]===t.Coronal[1]}const om=X({props:{viewId:{type:String,required:!0}},setup(e){const{viewId:t}=ae(e),n=ct(_r);if(!n)throw new Error("Crop3D component cannot access the 2D widget manager.");const s=de(),o=I(()=>s.getViewProxy(t.value)),i=bt(),{currentImageID:a,currentImageMetadata:r}=ce(),l=I(()=>{const p=a.value;return p&&p in i.croppingByImageID?i.croppingByImageID[p]:null}),c=il.newInstance(),u=c.getWidgetState();c.setEdgeHandlesEnabled(!1),c.setFaceHandlesEnabled(!0),c.setCornerHandlesEnabled(!0);const d=M();F(n,(p,f)=>{f&&f.removeWidget(c),p&&(d.value=p.addWidget(c))}),ds(o,()=>{n.value&&(d.value=n.value.addWidget(c),d.value.getRepresentations().forEach(p=>{p.getActors().forEach(f=>{f.getProperty().setAmbient(1)})}),o.value.renderLater())}),we(()=>{n.value&&n.value.removeWidget(c)}),F(r,p=>{u.setWorldToIndexT(p.worldToIndex),u.setIndexToWorldT(p.indexToWorld),u.placeWidget(p.worldBounds)},{immediate:!0});const h=p=>{const{lpsOrientation:f}=r.value,m=[0,0,0,0,0,0];eo.forEach(w=>{[m[f[w]*2],m[f[w]*2+1]]=p[w]}),Zn(m,u.getCroppingPlanes().getPlanes())||(u.getCroppingPlanes().setPlanes(m),o.value.renderLater())};return F(l,p=>{p&&h(p)},{immediate:!0}),Se(u.getCroppingPlanes().onModified)(()=>{const p=a.value;if(!p)return;const f=u.getCroppingPlanes().getPlanes(),{lpsOrientation:m}=r.value,w={Sagittal:We(f,"Sagittal",m),Coronal:We(f,"Coronal",m),Axial:We(f,"Axial",m)},T=l.value;T&&nm(w,T)||(tm(w)?i.setCropping(p,w):T&&h(T))}),()=>null}}),im=X({props:{viewId:{type:String,required:!0}},components:{Crop2D:em,Crop3D:om},setup(e){const{viewId:t}=ae(e),{currentImageID:n}=ce(),s=bt(),o=Oe(),i=I(()=>o.currentTool===oe.Crop);F(n,r=>{r&&!(r in s.croppingByImageID)&&s.resetCropping(r)},{immediate:!0});const a=I(()=>de().viewSpecs[t.value].viewType);return{active:i,viewType:a}}});const am={class:"overlay-no-events"};function sm(e,t,n,s,o,i){const a=P("crop-2D"),r=P("crop-3D");return x(),L("svg",am,[e.active&&e.viewType==="2D"?(x(),K(a,{key:0,"view-id":e.viewId},null,8,["view-id"])):j("",!0),e.active&&e.viewType==="3D"?(x(),K(r,{key:1,"view-id":e.viewId},null,8,["view-id"])):j("",!0)])}const rm=A(im,[["render",sm],["__scopeId","data-v-c08e53d9"]]),ci="ProxyManager";function lm(e){const t=ct("ProxyManager");return t?e(t):null}function cm(e=ci){return ct(e??ci)}const ui={ArrowLeft:-1,ArrowRight:1,ArrowUp:-1,ArrowDown:1},um=X({name:"VtkTwoView",props:{id:{type:String,required:!0},viewDirection:{type:String,required:!0},viewUp:{type:String,required:!0}},components:{SliceSlider:Hh,ViewOverlayGrid:ng,WindowLevelTool:sg,SliceScrollTool:rg,PanTool:lg,ZoomTool:cg,RulerTool:Mg,RectangleTool:of,PaintTool:_p,CrosshairsTool:Bp,CropTool:rm,ContourTool:mp},setup(e){const t=co(),n=Dt(),s=ho(),o=ka(),i=lt(),{id:a,viewDirection:r,viewUp:l}=ae(e),c=M(),u=I(()=>Te(r.value)),{currentImageData:d,currentImageID:h,currentImageMetadata:v,isImageLoading:p,currentLayers:f}=ce(),m=_e(),w=lo(),T=I(()=>n.getConfig(a.value,h.value)),S=I(()=>{var V;return((V=T.value)==null?void 0:V.slice)??w.slice}),b=I(()=>{var V;return((V=T.value)==null?void 0:V.min)??w.min}),O=I(()=>{var V;return((V=T.value)==null?void 0:V.max)??w.max}),D=I({get:()=>t.getConfig(a.value,h.value),set:V=>{const G=h.value;G!==null&&V!=null&&t.updateConfig(a.value,G,V)}}),k=I(()=>{var V;return(V=D.value)==null?void 0:V.width}),E=I(()=>{var V;return(V=D.value)==null?void 0:V.level}),$=I(()=>{if(h.value!==null&&h.value in m.imageIDToVolumeKey){const V=m.imageIDToVolumeKey[h.value],G=m.volumeInfo[V],ge=m.volumeStudy[V],ve=m.studyInfo[ge],Xe=m.studyPatient[ge],Vn=m.patientInfo[Xe].PatientID,cn=ve.StudyID,Me=ve.StudyDescription,Ot=G.SeriesNumber,at=G.SeriesDescription;return{patientID:Vn,studyID:cn,studyDescription:Me,seriesNumber:Ot,seriesDescription:at}}return null}),Y=I(()=>{const{lpsOrientation:V,dimensions:G}=v.value,ge=V[u.value];return{min:0,max:G[ge]-1}}),Z=V=>{h.value!==null&&n.updateConfig(a.value,h.value,{slice:V})},{viewProxy:B,setContainer:W}=Ap(a,ta.Slice);nr(()=>{B.value.getInteractorStyle2D().removeAllManipulators()}),ee(()=>{W(c.value),B.value.setOrientationAxesVisibility(!1)}),we(()=>{W(null)}),fe(()=>{const V=v.value.lpsOrientation[u.value];B.value.setSlicingMode("IJK"[V])}),F([a,h,r],([V,G,ge])=>{!G||T.value!=null||(n.updateConfig(V,G,{...Y.value,axisDirection:ge}),n.resetSlice(V,G))},{immediate:!0});const J=M(!1),Ce=V=>{if(!h.value||!J.value)return;const G=ui[V.key]??0;G&&(n.updateConfig(a.value,h.value,{slice:S.value+G}),V.stopPropagation())};or(Object.keys(ui),Ce),xn(c,()=>B.value.resize());const me=M();$n(mn,me);const{widgetManager:Ge}=$p(B);$n(Cr,Ge),F(d,V=>{if(h.value==null||D.value!=null||!V)return;const G=V.getPointData().getScalars().getRange();t.updateConfig(a.value,h.value,{min:G[0],max:G[1]}),t.resetWindowLevel(a.value,h.value)},{immediate:!0});const Lt=pn(),Ln=I(()=>Lt.idList.filter(V=>Lt.parentImage[V]===h.value)),sn=I(()=>f.value.map(({id:V})=>V)),{baseImageRep:En,labelmapReps:rn,layerReps:On}=Cp(a,{baseImage:h,labelmaps:Ln,layers:sn}),{cameraDirVec:_o,cameraUpVec:Co}=ig(r,l,v),{resizeToFit:it,ignoreResizeToFitTracking:bo,resetResizeToFitTracking:_s}=Bh(B.value.getCamera(),!1),To=()=>bo(()=>{const V=v.value.lpsOrientation[Te(r.value)],G=v.value.lpsOrientation[Te(l.value)],ge=v.value.dimensions.map((ve,Xe)=>ve*v.value.spacing[Xe]);B.value.resizeToFit(V,G,ge),_s()}),Io=()=>{const V=v.value.worldBounds,G=[(V[0]+V[1])/2,(V[2]+V[3])/2,(V[4]+V[5])/2];bo(()=>{B.value.updateCamera(_o.value,Co.value,G),B.value.resetCamera(V)}),To(),B.value.renderLater()};Gt(B.value.onResize(()=>{it.value&&To()})),F(it,()=>{it.value&&Io()});const{restoreCameraConfig:Cs}=bp(a,h,B,"parallelScale","position","focalPoint","viewUp");F([h,_o,Co],()=>{const V=s.getConfig(a.value,h.value);V?(Cs(V),B.value.getRenderer().resetCameraClippingRange(),B.value.renderLater(),it.value=!1):it.value?Io():it.value=!0},{immediate:!0,deep:!0});const{top:bs,left:Ts}=og(B);fe(()=>{if(T.value==null||D.value==null)return;const{slice:V}=T.value,{width:G,level:ge}=D.value,ve=En.value;ve&&(ve.setSlice(V),ve.setWindowWidth(G),ve.setWindowLevel(ge)),[...On.value,...rn.value].forEach(Xe=>{Xe.setSlice(V)}),B.value.renderLater()}),fe(()=>{const{labelmapOpacity:V}=i;rn.value.forEach(G=>{G.setOpacity(V)})});const Et=I(()=>sn.value.map(V=>o.getConfig(a.value,V))),Is=Rt();F([a,f],()=>{f.value.forEach(({id:V},G)=>{const ge=Is.layerImages[V],ve=Et.value[G];ge&&!ve&&o.resetToDefault(a.value,V,ge)})},{immediate:!0});const xo=cm(),Ro=I(()=>Et.value.map(V=>V==null?void 0:V.colorBy)),Do=I(()=>Et.value.map(V=>V==null?void 0:V.transferFunction)),Lo=I(()=>Et.value.map(V=>V==null?void 0:V.opacityFunction)),Eo=I(()=>Et.value.map(V=>V==null?void 0:V.blendConfig));return F([On,Ro,Do,Lo,Eo],()=>{On.value.map((V,G)=>[V,Ro.value[G],Do.value[G],Lo.value[G],Eo.value[G]]).forEach(([V,G,ge,ve,Xe])=>{if(!G||!ge||!ve||!Xe)return;const{arrayName:ln,location:Vn}=G,cn=ge,Me=ve,Ot=xo.getLookupTable(ln);Ot.setMode(al.Preset),Ot.setPresetName(cn.preset),Ot.setDataRange(...cn.mappingRange);const at=xo.getPiecewiseFunction(ln);switch(at.setMode(Me.mode),at.setDataRange(...Me.mappingRange),Me.mode){case Le.Mode.Gaussians:at.setGaussians(Me.gaussians);break;case Le.Mode.Points:{const Oo=Dd(Me.preset,Me.mappingRange,Me.shift);Oo&&at.setPoints(Oo);break}case Le.Mode.Nodes:at.setNodes(Me.nodes);break}V.setRescaleOnColorBy(!1),V.setColorBy(ln,Vn),V.setOpacity(Xe.opacity),B.value.renderLater()})},{immediate:!0,deep:!0}),{vtkContainerRef:c,toolContainer:me,viewID:a,viewProxy:B,viewAxis:u,active:!0,currentSlice:S,sliceMin:b,sliceMax:O,windowWidth:k,windowLevel:E,topLabel:bs,leftLabel:Ts,isImageLoading:p,setSlice:Z,widgetManager:Ge,dicomInfo:$,enableResizeToFit(){it.value=!0},hover:J}}});const dm=e=>(re("data-v-f1605346"),e=e(),le(),e),hm={class:"vtk-gutter"},gm={class:"vtk-sub-container"},fm={class:"vtk-view",ref:"vtkContainerRef"},pm={class:"overlay-no-events tool-layer",ref:"toolContainer"},mm={class:"annotation-cell"},vm={class:"annotation-cell"},ym={class:"annotation-cell"},wm={key:0},Sm={class:"annotation-cell"},_m={key:0,class:"overlay-no-events loading"},Cm=dm(()=>g("div",null,"Loading the image",-1));function bm(e,t,n,s,o,i){const a=P("slice-slider"),r=P("pan-tool"),l=P("zoom-tool"),c=P("slice-scroll-tool"),u=P("window-level-tool"),d=P("contour-tool"),h=P("ruler-tool"),v=P("rectangle-tool"),p=P("paint-tool"),f=P("crosshairs-tool"),m=P("crop-tool"),w=P("view-overlay-grid");return x(),L("div",{class:"vtk-container-wrapper",tabindex:"0",onPointerenter:t[0]||(t[0]=T=>e.hover=!0),onPointerleave:t[1]||(t[1]=T=>e.hover=!1),onFocusin:t[2]||(t[2]=T=>e.hover=!0),onFocusout:t[3]||(t[3]=T=>e.hover=!1)},[g("div",hm,[y(pt,{dark:"",icon:"",size:"medium",variant:"text",onClick:e.enableResizeToFit},{default:R(()=>[y(yt,{size:"medium",class:"py-1"},{default:R(()=>[H("mdi-camera-flip-outline")]),_:1}),y(Ti,{location:"right",activator:"parent",transition:"slide-x-transition"},{default:R(()=>[H(" Reset Camera ")]),_:1})]),_:1},8,["onClick"]),y(a,{class:"slice-slider",slice:e.currentSlice,min:e.sliceMin,max:e.sliceMax,step:1,"handle-height":20,onInput:e.setSlice},null,8,["slice","min","max","onInput"])]),g("div",{class:N(["vtk-container",e.active?"active":""])},[g("div",gm,[g("div",fm,null,512)]),g("div",pm,[y(r,{"view-id":e.viewID},null,8,["view-id"]),y(l,{"view-id":e.viewID},null,8,["view-id"]),y(c,{"view-id":e.viewID},null,8,["view-id"]),y(u,{"view-id":e.viewID},null,8,["view-id"]),y(d,{"view-id":e.viewID,"widget-manager":e.widgetManager,"view-direction":e.viewDirection,"current-slice":e.currentSlice},null,8,["view-id","widget-manager","view-direction","current-slice"]),y(h,{"view-id":e.viewID,"widget-manager":e.widgetManager,"view-direction":e.viewDirection,"current-slice":e.currentSlice},null,8,["view-id","widget-manager","view-direction","current-slice"]),y(v,{"view-id":e.viewID,"widget-manager":e.widgetManager,"view-direction":e.viewDirection,"current-slice":e.currentSlice},null,8,["view-id","widget-manager","view-direction","current-slice"]),y(p,{"view-id":e.viewID,"view-direction":e.viewDirection,"widget-manager":e.widgetManager,slice:e.currentSlice},null,8,["view-id","view-direction","widget-manager","slice"]),y(f,{"view-id":e.viewID,"view-direction":e.viewDirection,"widget-manager":e.widgetManager,slice:e.currentSlice},null,8,["view-id","view-direction","widget-manager","slice"]),y(m,{"view-id":e.viewID},null,8,["view-id"])],512),y(w,{class:"overlay-no-events view-annotations"},{"top-center":R(()=>[g("div",mm,[g("span",null,U(e.topLabel),1)])]),"middle-left":R(()=>[g("div",vm,[g("span",null,U(e.leftLabel),1)])]),"bottom-left":R(()=>[g("div",ym,[g("div",null,"Slice: "+U(e.currentSlice+1)+"/"+U(e.sliceMax+1),1),typeof e.windowWidth=="number"&&typeof e.windowLevel=="number"?(x(),L("div",wm," W/L: "+U(e.windowWidth.toFixed(2))+" / "+U(e.windowLevel.toFixed(2)),1)):j("",!0)])]),"top-right":R(()=>[g("div",Sm,[e.dicomInfo!==null?(x(),K(wt,{key:0,"open-on-hover":"",location:"bottom left",left:"","nudge-left":"10",dark:"","max-width":"300px"},{activator:R(({props:T})=>[y(yt,qt(T,{dark:"",size:"x-large",class:"pointer-events-all hover-info"}),{default:R(()=>[H(" mdi-information ")]),_:2},1040)]),default:R(()=>[y(Nt,{class:"bg-grey-darken-3"},{default:R(()=>[y(Ze,null,{default:R(()=>[y(De,{class:"font-weight-bold"},{default:R(()=>[H(" PATIENT / CASE ")]),_:1}),y(Pn),y(De,null,{default:R(()=>[H(" ID: "+U(e.dicomInfo.patientID),1)]),_:1})]),_:1}),y(Ze,null,{default:R(()=>[y(De,{class:"font-weight-bold"},{default:R(()=>[H(" STUDY ")]),_:1}),y(Pn),y(De,null,{default:R(()=>[H(" ID: "+U(e.dicomInfo.studyID),1)]),_:1}),y(De,null,{default:R(()=>[H(U(e.dicomInfo.studyDescription),1)]),_:1})]),_:1}),y(Ze,null,{default:R(()=>[y(De,{class:"font-weight-bold"},{default:R(()=>[H(" SERIES ")]),_:1}),y(Pn),y(De,null,{default:R(()=>[H(" Series #: "+U(e.dicomInfo.seriesNumber),1)]),_:1}),y(De,null,{default:R(()=>[H(U(e.dicomInfo.seriesDescription),1)]),_:1})]),_:1})]),_:1})]),_:1})):j("",!0)])]),_:1}),y(Ae,{name:"loading"},{default:R(()=>[e.isImageLoading?(x(),L("div",_m,[Cm,g("div",null,[y(br,{indeterminate:"",color:"blue"})])])):j("",!0)]),_:1})],2)],32)}const gs=A(um,[["render",bm],["__scopeId","data-v-f1605346"]]);const Tm={components:{CheckContoursToolStrip:Mh,VtkTwoView:gs}},Im={class:"viewers-tools-container"},xm={class:"tool-strip"};function Rm(e,t,n,s,o,i){const a=P("VtkTwoView"),r=P("CheckContoursToolStrip");return x(),L("div",Im,[y(a,{key:"sagitalv",id:"Sagittal",viewDirection:"Posterior",viewUp:"Superior"}),g("div",xm,[y(r)]),y(a,{key:"sagitalv",id:"Coronal",viewDirection:"Right",viewUp:"Superior"})])}const fs=A(Tm,[["render",Rm],["__scopeId","data-v-2880b87f"]]);async function Dm(e){const t=e.createReader(),n=[];let s=[];do s=await new Promise((o,i)=>{t.readEntries(o,i)}),n.push(...s);while(s.length);return n}async function Lm(e){return new Promise((t,n)=>{e.file(t,n)})}async function Em(e){const t=[...e],n=[];for(;t.length;){const s=t.shift();s.isFile?n.push(s):t.push(...await Dm(s))}return Promise.all(n.map(Lm))}const Om={name:"DragAndDrop",props:{enabled:Boolean},data(){return{dragHover:!1}},methods:{onDragOver(e){if(this.enabled){e.preventDefault();const{types:t}=e.dataTransfer;(t&&t instanceof Array?t.indexOf("Files")!==-1:"Files"in t)&&(this.dragHover=!0,this.dragTimeout!==null&&(window.clearTimeout(this.dragTimeout),this.dragTimeout=null))}},onDragLeave(){this.enabled&&(this.dragTimeout=window.setTimeout(()=>{this.dragHover=!1,this.dragTimeout=null},50))},async onDrop(e){if(this.enabled)if(this.dragHover=!1,e.dataTransfer.items){const t=[...e.dataTransfer.items].map(s=>(s.webkitGetAsEntry||s.getAsEntry).call(s)),n=await Em(t);this.$emit("drop-files",n)}else this.$emit("drop-files",Array.from(e.dataTransfer.files))}},created(){this.dragTimeout=null}};function Vm(e,t,n,s,o,i){return x(),L("div",qt({onDragover:t[0]||(t[0]=ie((...a)=>i.onDragOver&&i.onDragOver(...a),["prevent"])),onDragleave:t[1]||(t[1]=(...a)=>i.onDragLeave&&i.onDragLeave(...a)),onDrop:t[2]||(t[2]=ie((...a)=>i.onDrop&&i.onDrop(...a),["prevent"]))},e.$attrs),[be(e.$slots,"default",{dragHover:o.dragHover})],16)}const Pm=A(Om,[["render",Vm]]);function km(e){let t=e;for(;t;)t!==e?console.error("The above error was caused by:",t):console.error(t),t instanceof Error?t=t.cause:t=null}function Mm(){const e=Jt(),t=n=>{e.addError("Application error (click for details)",n.error)};ee(()=>{window.addEventListener("error",t)}),we(()=>{window.removeEventListener("error",t)})}var Gn=(e=>(e[e.ProxyCreated=0]="ProxyCreated",e[e.ProxyModified=1]="ProxyModified",e[e.ProxyDeleted=2]="ProxyDeleted",e[e.ProxyRegistrationChange=3]="ProxyRegistrationChange",e))(Gn||{});function di(e,t){const n=[];lm(s=>{const o=Object.create(null);n.push(s.onProxyRegistrationChange(i=>{const{action:a,proxyId:r,proxy:l}=i;a==="register"?(e===0&&t(r,l),e===1&&(o[r]=l.onModified(()=>t(r,l)))):a==="unregister"&&(r in o&&(o[r].unsubscribe(),delete o[r]),e===2&&t(r,null))}))}),we(()=>{for(;n.length;)n.pop().unsubscribe()})}function Bm(){const e=new Map,t=ar(()=>{Jt().addError(Ao.WebGLLost.title,Ao.WebGLLost.details)},100);di(Gn.ProxyCreated,(n,s)=>{if(!s||!s.isA("vtkViewProxy"))return;const i=s.getRenderWindow().getViews()[0].getCanvas(),a=ir(i,"webglcontextlost",t);e.set(n,a)}),di(Gn.ProxyDeleted,n=>{e.has(n)&&(e.get(n)(),e.delete(n))})}const Am=sr({position:"bottom-left",timeout:3e3,hideProgressBar:!0,maxToasts:3,transition:"Vue-Toastification__fade"}),Fm=()=>Am;function Nm(){const e=Fm(),t=Jt();let n=0,s=null,o=null;const i=()=>{n=0,s=null,o=null},a=u=>{o=u},r=()=>{n++,s===null&&(s=e.info("Loading datasets...",{timeout:!1,closeButton:!1,closeOnClick:!1}))},l=()=>{n--,n===0&&s!==null&&(o?(e.dismiss(s),t.addError("Some files failed to load",o)):e.update(s,{content:"Datasets loaded!",options:{type:rr.SUCCESS,timeout:3e3,closeButton:"button",closeOnClick:!0}}),i())};return{runAsLoading:async u=>{r();try{return await u(a)}finally{l()}}}}const hi=e=>{const t={[oe.Rectangle]:Ne(),[oe.Ruler]:Fe()},n=Oe(),s=t[n.currentTool];if(!s)return;const o=Object.entries(s.labels),i=o.findIndex(([r])=>r===s.activeLabel),[a]=o.at((i+e)%o.length);s.setActiveLabel(a)};function $m(){At(ld,()=>hi(-1)),At(cd,()=>hi(1))}async function Um(e,t){const n=xt();let s;try{s=await Ua(e)}catch(a){t(a);return}const[o,i]=Qt(a=>a.ok,s);if(!n.primarySelection&&o.length){const a=$a(o[0]);a&&n.setPrimarySelection(a)}if(i.length){const a=i.map(l=>{const[c]=l.errors,u=ga(c.inputDataStackTrace[0]);return km(c.cause),`- ${u}: ${c.message}`}),r=new Error(`These files failed to load:
${a.join(`
`)}`);t(r)}}const Hm=X({components:{},setup(){const e=xe(),t=Jt(),n=de();Mm(),Bm(),$m();const{runAsLoading:s}=Nm(),o=M("Quad View"),{layout:i}=nt(n);F(o,()=>{const f=Yo[o.value]||[];n.setLayout(f)},{immediate:!0}),F(i,()=>{var f;(f=i.value)!=null&&f.name&&i.value.name!==o.value&&(o.value=i.value.name)});async function a(f){if(!f)return;const m=Array.from(f).map(io);s(w=>Um(m,w))}const r=document.createElement("input");r.setAttribute("type","file"),r.setAttribute("multiple","multiple"),r.setAttribute("accept","*"),r.addEventListener("change",()=>a(r.files));function l(){r.value="",r.click()}const c=I(()=>e.idList.length>0),u=I(()=>t.importantMessages.length),d=I(()=>t.importantMessages.find(f=>f.type===zn.Error)?"error":t.importantMessages.find(f=>f.type===zn.Warning)?"warning":"primary"),h=M(!1),v=M(!1),p=Kn();return{aboutBoxDialog:M(!1),messageDialog:M(!1),settingsDialog:M(!1),saveDialog:h,saveHappening:v,leftSideBar:M(!p.mobile.value),mobile:p.mobile,messageCount:u,messageBadgeColor:d,layoutName:o,currentLayout:i,Layouts:Yo,userPromptFiles:l,openFiles:a,hasData:c}}});const Wm={components:{DragAndDrop:Pm,HandleUpload:Hm,CheckContours:fs},data(){return{showOverlay:!1,showTextOverlay:!1,isDraggingOver:!1,loadFileText:"Load Files",browseTextFile:"Browse your data to automatically add a new study.",dataStore:xt(),currentPatientStoreID:null}},methods:{async openFiles(e){const t=Array.from(e).map(io);this.loadFiles(t)},async loadFiles(e){const t=await Ua(e);this.currentPatientStoreID=t[0].data[0].dataID;const s=Qt(h=>h.ok,t)[0];if(!this.dataStore.primarySelection&&s.length){const h=$a(s[0]);h&&this.dataStore.setPrimarySelection(h)}const o=_e(),i=this.currentPatientStoreID,a=o.volumeInfo[i],r=o.volumeStudy[i],l=o.studyInfo[r],c=o.studyPatient[r],u=o.patientInfo[c],d={id:1,name:u.PatientID,lastname:u.PatientName,dob:u.PatientBirthDate,gender:u.PatientSex,scandate:l.StudyDate,scanlocation:a.SeriesDescription};this.$emit("new-patient",d),this.openOverlay()},handleKeyDown(e){e.key===" "&&this.showOverlay()},openOverlay(){this.showOverlay&&(this.showTextOverlay=!1),this.showOverlay=!this.showOverlay,this.showOverlay&&setTimeout(()=>{this.showTextOverlay=!0},200)},openFileDialog(){this.$refs.fileInput.click()},handleFileChange(e){const t=e.target.files[0];this.openFiles(t)},handleDragEnter(e){e.preventDefault(),this.isDraggingOver=!0},handleDragOver(e){e.preventDefault(),this.isDraggingOver=!0,this.loadFileText="Drop File to Upload"},handleDragLeave(e){e.preventDefault(),this.isDraggingOver=!1,this.loadFileText="Load Files"},handleDrop(e){e.preventDefault(),this.isDraggingOver=!1,this.loadFileText="Load Files";let t;e.dataTransfer?t=e.dataTransfer.files:e.target&&e.target.files&&(t=e.target.files),console.log(t)}}},vo=e=>(re("data-v-382c1de8"),e=e(),le(),e),zm={style:{position:"relative"}},jm=vo(()=>g("i",{class:"fa-solid fa-user-plus",style:{color:"#ffffff"}},null,-1)),Gm=vo(()=>g("i",{class:"fa-solid fa-file-import fa-2xl",style:{color:"#ffffff"}},null,-1)),Xm=vo(()=>g("br",null,null,-1)),qm={style:{display:"none"}};function Ym(e,t,n,s,o,i){const a=P("HandleUpload"),r=P("drag-and-drop"),l=P("CheckContours");return x(),L(se,null,[y(a,{ref:"handleUpload"},null,512),g("div",zm,[g("button",{onClick:t[0]||(t[0]=(...c)=>i.openOverlay&&i.openOverlay(...c))},[H(" Add New Patient "),jm]),y(r,{enabled:"",onDropFiles:i.openFiles,id:"app-container"},{default:R(()=>[g("div",{class:N(["overlay",{show:o.showOverlay}]),onDragover:t[9]||(t[9]=(...c)=>i.handleDragOver&&i.handleDragOver(...c))},[g("div",{class:N(["add-patient-header",{visible:o.showTextOverlay}])},[g("i",{onClick:t[1]||(t[1]=(...c)=>i.openOverlay&&i.openOverlay(...c)),onKeydown:t[2]||(t[2]=ke(ie((...c)=>i.handleKeyDown&&i.handleKeyDown(...c),["prevent"]),["space"])),class:"fa-solid fa-xmark fa-xl",style:{color:"#ffffff"}},null,32)],2),g("div",{onClick:t[4]||(t[4]=(...c)=>i.openFileDialog&&i.openFileDialog(...c)),onDragenter:t[5]||(t[5]=(...c)=>i.handleDragEnter&&i.handleDragEnter(...c)),onDragleave:t[6]||(t[6]=(...c)=>i.handleDragLeave&&i.handleDragLeave(...c)),onDrop:t[7]||(t[7]=(...c)=>i.handleDrop&&i.handleDrop(...c)),onKeydown:t[8]||(t[8]=ke(ie((...c)=>i.handleKeyDown&&i.handleKeyDown(...c),["prevent"]),["space"])),class:N(["load-files",{visible:o.showTextOverlay}])},[g("input",{type:"file",ref:"fileInput",style:{display:"none"},onChange:t[3]||(t[3]=(...c)=>i.handleFileChange&&i.handleFileChange(...c)),"aria-labelledby":"fileInput"},null,544),Gm,Xm,g("h2",null,U(o.loadFileText),1),g("h4",null,U(o.browseTextFile),1)],34)],34)]),_:1},8,["onDropFiles"])]),g("div",qm,[y(l)])],64)}const Km=A(Wm,[["render",Ym],["__scopeId","data-v-382c1de8"]]);const Qm={data(){return{searchTerm:""}},methods:{handleInput(){this.$emit("search-term-updated",this.searchTerm)},handleSearch(){this.$emit("search-term-updated",this.searchTerm)}}},Zm={class:"searchbar"};function Jm(e,t,n,s,o,i){return x(),L("div",Zm,[tt(g("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=a=>o.searchTerm=a),onInput:t[1]||(t[1]=(...a)=>i.handleInput&&i.handleInput(...a)),placeholder:"Find Patient...","aria-labelledby":"findPatientSearchBox"},null,544),[[Nn,o.searchTerm]])])}const ev=A(Qm,[["render",Jm],["__scopeId","data-v-93436b4b"]]);const tv={methods:{logOutUser(){window.localStorage.setItem("userLoggedIn","GUEST USER"),window.localStorage.clear()}}},nv=e=>(re("data-v-a1f7f5c7"),e=e(),le(),e),ov=nv(()=>g("i",{class:"fa-solid fa-arrow-right-from-bracket",style:{color:"#ffffff"}},null,-1));function iv(e,t,n,s,o,i){const a=P("router-link");return x(),K(a,{to:"/login",style:{"text-decoration":"none"}},{default:R(()=>[g("button",{onClick:t[0]||(t[0]=(...r)=>i.logOutUser&&i.logOutUser(...r))},[H(" Log Out "),ov])]),_:1})}const av=A(tv,[["render",iv],["__scopeId","data-v-a1f7f5c7"]]);const sv={data(){return{username:"GUEST USER",filter:"",container:"container",patients:[{id:111,name:"SAMPLE",lastname:"SAMPLE",dob:"01/02/1982",breathingrate:"60",age:"32",weight:65,height:175,gender:"Male",scandate:"01/02/2023",scanlocation:"Area 19 Office"}]}},components:{HomeGreetings:Rc,PatientContainer:Wc,AddPatient:Km,FindPatient:ev,LogOut:av},mounted(){this.username=window.localStorage.getItem("userLoggedIn"),window.localStorage.setItem("currentView","QualityCheck")},methods:{updatefilter(){},getTimeOfDay(){const e=new Date().getHours();return e>=5&&e<12?"Morning":e>=12&&e<18?"Afternoon":e>=18&&e<23?"Evening":"Day"},handleNewPatient(e){this.patients.push(e)}},created(){this.timeofday=this.getTimeOfDay(),this.container=`${this.container} ${this.timeofday.toLowerCase()}`}},ps=e=>(re("data-v-94767a96"),e=e(),le(),e),rv={class:"home"},lv=ps(()=>g("br",null,null,-1)),cv={class:"user-bar"},uv=ps(()=>g("h5",{style:{color:"grey","margin-left":"90%"}},"Area 19 OCG Prototype V.0.1",-1));function dv(e,t,n,s,o,i){const a=P("HomeGreetings"),r=P("AddPatient"),l=P("FindPatient"),c=P("LogOut"),u=P("PatientContainer");return x(),L("div",{class:N(o.container)},[g("div",rv,[y(a,{username:o.username},null,8,["username"]),lv,g("div",cv,[y(r,{onNewPatient:i.handleNewPatient},null,8,["onNewPatient"]),y(l,{onSearchTermUpdated:i.updatefilter},null,8,["onSearchTermUpdated"]),y(c,{style:{"margin-left":"auto","align-self":"center"}})]),y(u,{patients:o.patients},null,8,["patients"]),uv])],2)}const hv=A(sv,[["render",dv],["__scopeId","data-v-94767a96"]]),gv=X({components:{ToolButton:Ue,MenuToolButton:Xa,ItemGroup:Wa,GroupableItem:za,PaintControls:Ga,CropControls:qa,RulerControls:Ya,RectangleControls:Ka,ContourControls:Qa},setup(){const e=xt(),t=Oe(),n=I(()=>!e.primaryDataset),s=I(()=>t.currentTool),o=Ne(),i=Fe(),a=M(!1),r=M(!1);return At("Escape",()=>{a.value=!1,r.value=!1}),{currentTool:s,setCurrentTool:t.setCurrentTool,noCurrentImage:n,Tools:oe,paintMenu:a,cropMenu:r,rectangleStore:o,rulerStore:i}}});const yo=e=>(re("data-v-001108e5"),e=e(),le(),e),fv=yo(()=>g("div",{class:"my-1 tool-separator"},null,-1)),pv=yo(()=>g("div",{class:"my-1 tool-separator"},null,-1)),mv=yo(()=>g("div",{class:"my-1 tool-separator"},null,-1));function vv(e,t,n,s,o,i){const a=P("tool-button"),r=P("groupable-item"),l=P("paint-controls"),c=P("menu-tool-button"),u=P("rectangle-controls"),d=P("ruler-controls"),h=P("contour-controls"),v=P("crop-controls"),p=P("item-group");return x(),K(p,{mandatory:"","model-value":e.currentTool,"onUpdate:modelValue":t[0]||(t[0]=f=>e.setCurrentTool(f))},{default:R(()=>[fv,y(r,{value:e.Tools.WindowLevel},{default:R(({active:f,toggle:m})=>[y(a,{icon:"mdi-circle-half-full",name:"Window & Level",buttonClass:["tool-btn",f?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Pan},{default:R(({active:f,toggle:m})=>[y(a,{icon:"mdi-cursor-move",name:"Pan",buttonClass:["tool-btn",f?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Zoom},{default:R(({active:f,toggle:m})=>[y(a,{icon:"mdi-magnify-plus-outline",name:"Zoom",buttonClass:["tool-btn",f?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Crosshairs},{default:R(({active:f,toggle:m})=>[y(a,{icon:"mdi-crosshairs",name:"Crosshairs",buttonClass:["tool-btn",f?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),pv,y(r,{value:e.Tools.Paint},{default:R(({active:f,toggle:m})=>[y(c,{icon:"mdi-brush",name:"Paint",active:f,disabled:e.noCurrentImage,onClick:m},{default:R(()=>[y(l)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Rectangle},{default:R(({active:f,toggle:m})=>[y(c,{icon:"mdi-vector-square",name:"Rectangle",mobileOnlyMenu:!0,active:f,disabled:e.noCurrentImage,onClick:m},{default:R(()=>[y(u)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Ruler},{default:R(({active:f,toggle:m})=>[y(c,{icon:"mdi-ruler",name:"Ruler",mobileOnlyMenu:!0,active:f,disabled:e.noCurrentImage,onClick:m},{default:R(()=>[y(d)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Contour},{default:R(({active:f,toggle:m})=>[y(c,{icon:"mdi-shape-circle-plus",name:"Contour","mobile-only-menu":"",active:f,disabled:e.noCurrentImage,onClick:m},{default:R(()=>[y(h)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),mv,y(r,{value:e.Tools.Crop},{default:R(({active:f,toggle:m})=>[y(c,{icon:"mdi-crop",name:"Crop",active:f,disabled:e.noCurrentImage,onClick:m},{default:R(()=>[y(v)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"])]),_:1},8,["model-value"])}const yv=A(gv,[["render",vv],["__scopeId","data-v-001108e5"]]);const wv={props:{number:{type:Number,default:1}}},Sv={class:"circleIcon"};function _v(e,t,n,s,o,i){return x(),L("div",Sv,U(n.number),1)}const Cv=A(wv,[["render",_v],["__scopeId","data-v-071ecef1"]]);const bv={components:{ToolStrip:yv,IconNumber:Cv},props:{activeComponent:{type:String,default:"analysis"}},data(){return{patient:null,patientName:null,patientLastName:null,patientBrate:null,patientage:null,patientweight:null,patientheight:null,patientgender:null,checkContours:null}},mounted(){const e=window.sessionStorage.getItem("currentQaView");e?this.handleclick(e):this.checkContours=!1,this.patient=JSON.parse(window.localStorage.getItem("currentPatient")),this.patientName=this.patient.name.toUpperCase(),this.patientLastName=this.patient.lastname.toUpperCase(),this.patientBrate=this.patient.breathingrate,this.patientage=this.patient.age,this.patientweight=this.patient.weight,this.patientheight=this.patient.height,this.patientgender=this.patient.gender},methods:{handleclick(e){e==="CheckBreathingSplits"?this.checkContours=!1:this.checkContours=!0,window.sessionStorage.setItem("currentQaView",e),this.$emit("updatequalitycheck",this.checkContours)}}},ot=e=>(re("data-v-afc27cb0"),e=e(),le(),e),Tv={class:"header-container"},Iv={class:"patient-info-container"},xv={class:"patient-name"},Rv=ot(()=>g("h3",{class:"label"},"PATIENT",-1)),Dv={class:"breathing-rate"},Lv=ot(()=>g("h3",{class:"label",style:{"text-align":"left"}},[H("RESTING "),g("br"),H("HEART RATE")],-1)),Ev={class:"info"},Ov=ot(()=>g("h3",{class:"label"},"AGE",-1)),Vv=ot(()=>g("h3",{class:"label"},"WEIGHT",-1)),Pv=ot(()=>g("h3",{class:"label"},"HEIGHT",-1)),kv=ot(()=>g("h3",{class:"label"},"GENDER",-1)),Mv={key:0,class:"tools"},Bv={key:1,class:"quality-screen-toggle"},Av=ot(()=>g("h2",null,"CHECK BREATHING SPLITS",-1)),Fv=ot(()=>g("h2",null,"CHECK CONTOURS",-1));function Nv(e,t,n,s,o,i){const a=P("ToolStrip"),r=P("IconNumber");return x(),L("div",Tv,[g("div",Iv,[g("div",xv,[Rv,g("h3",null,U(o.patientName)+" "+U(o.patientLastName),1)]),g("div",Dv,[g("h1",null,U(o.patientBrate),1),Lv]),g("div",Ev,[g("div",null,[Ov,g("h3",null,U(o.patientage),1)]),g("div",null,[Vv,g("h3",null,U(o.patientweight)+" Kg",1)]),g("div",null,[Pv,g("h3",null,U(o.patientheight)+" cm",1)]),g("div",null,[kv,g("h3",null,U(o.patientgender),1)])])]),n.activeComponent=="GraphicalAnalysis"?(x(),L("div",Mv,[y(a)])):j("",!0),n.activeComponent=="QualityCheck"?(x(),L("div",Bv,[g("div",{class:N(["toggleQaContainer",{clicked:o.checkContours==!1}]),onClick:t[0]||(t[0]=l=>i.handleclick("CheckBreathingSplits")),onKeydown:t[1]||(t[1]=ke(ie((...l)=>e.handleKeyDown&&e.handleKeyDown(...l),["prevent"]),["space"]))},[y(r),Av],34),g("div",{class:N(["toggleQaContainer",{clicked:o.checkContours}]),onClick:t[2]||(t[2]=l=>i.handleclick("CheckContours")),onKeydown:t[3]||(t[3]=ke(ie((...l)=>e.handleKeyDown&&e.handleKeyDown(...l),["prevent"]),["space"]))},[y(r,{number:2}),Fv],34)])):j("",!0)])}const $v=A(bv,[["render",Nv],["__scopeId","data-v-afc27cb0"]]);const Uv={data(){return{selectedTool:"QualityCheck"}},methods:{selectTool(e){this.selectedTool!==e&&(this.selectedTool=e,this.$emit("tool-selected",e))},handleKeyDown(e){console.log(e),e.key==="1"?this.selectTool("QualityCheck"):e.key==="2"?this.selectTool("GraphicalAnalysis"):this.selectTool("ReportMaker")}},mounted(){this.selectedTool=window.localStorage.getItem("currentView")}},Rn=e=>(re("data-v-46cbd000"),e=e(),le(),e),Hv={class:"toolbar"},Wv={class:"tools"},zv={class:"tool"},jv={key:0,class:"fa-solid fa-people-arrows fa-xl"},Gv={key:1,class:"fa-solid fa-people-arrows fa-lg"},Xv=Rn(()=>g("h4",{class:"section-tag"},"Patient List",-1)),qv={key:0,class:"fa-solid fa-file-circle-check fa-xl"},Yv={key:1,class:"fa-solid fa-file-circle-check fa-lg"},Kv=Rn(()=>g("h4",{class:"section-tag"},"Quality Check",-1)),Qv={key:0,class:"fa-sharp fa-solid fa-microscope fa-xl"},Zv={key:1,class:"fa-sharp fa-solid fa-microscope fa-lg"},Jv=Rn(()=>g("h4",{class:"section-tag"},"Analysis",-1)),e0={key:0,class:"fa-regular fa-file-pdf fa-xl"},t0={key:1,class:"fa-regular fa-file-pdf fa-lg"},n0=Rn(()=>g("h4",{class:"section-tag"},"Report",-1));function o0(e,t,n,s,o,i){const a=P("router-link");return x(),L("div",Hv,[g("div",Wv,[y(a,{to:"/home",style:{"text-decoration":"none"},class:"normal"},{default:R(()=>[g("div",zv,[e.$matches.mediumLaptop.min?(x(),L("i",jv)):(x(),L("i",Gv)),Xv])]),_:1}),g("div",{class:N(["tool",{active:o.selectedTool==="QualityCheck"}]),onClick:t[0]||(t[0]=r=>i.selectTool("QualityCheck")),onKeydown:t[1]||(t[1]=ie((...r)=>i.handleKeyDown&&i.handleKeyDown(...r),["prevent"]))},[e.$matches.mediumLaptop.min?(x(),L("i",qv)):(x(),L("i",Yv)),Kv],34),g("div",{class:N(["tool",{active:o.selectedTool==="GraphicalAnalysis"}]),onClick:t[2]||(t[2]=r=>i.selectTool("GraphicalAnalysis")),onKeydown:t[3]||(t[3]=ie((...r)=>i.handleKeyDown&&i.handleKeyDown(...r),["prevent"]))},[e.$matches.mediumLaptop.min?(x(),L("i",Qv)):(x(),L("i",Zv)),Jv],34),g("div",{class:N(["tool",{active:o.selectedTool==="ReportMaker"}]),onClick:t[4]||(t[4]=r=>i.selectTool("ReportMaker")),onKeydown:t[5]||(t[5]=ie((...r)=>i.handleKeyDown&&i.handleKeyDown(...r),["prevent"]))},[e.$matches.mediumLaptop.min?(x(),L("i",e0)):(x(),L("i",t0)),n0],34)])])}const i0=A(Uv,[["render",o0],["__scopeId","data-v-46cbd000"]]);const a0={props:{heartrate:{type:Number,required:!0},duration:{type:String,required:!0},state:{type:String,required:!0},isActive:{type:Boolean,required:!0},stateColor:{type:String,required:!1,default:"#66C9DA"}},data(){return{isHovered:!1}},methods:{handleClick(){this.$emit("state-change",this.state)}}},ms=e=>(re("data-v-258e6b3d"),e=e(),le(),e),s0={class:"button-content"},r0={style:{display:"flex","justify-content":"space-between"}},l0=ms(()=>g("h4",null,"HEART RATE",-1)),c0=ms(()=>g("h4",null,"DURATION",-1));function u0(e,t,n,s,o,i){return x(),L("div",{class:N({"custom-button":!0,highlighted:n.isActive}),onClick:t[0]||(t[0]=(...a)=>i.handleClick&&i.handleClick(...a)),onMouseover:t[1]||(t[1]=a=>o.isHovered=!0),onFocusin:t[2]||(t[2]=a=>o.isHovered=!0),onMouseout:t[3]||(t[3]=a=>o.isHovered=!1),onFocusout:t[4]||(t[4]=a=>o.isHovered=!1),onKeydown:t[5]||(t[5]=ke(ie((...a)=>e.handleKeyDown&&e.handleKeyDown(...a),["prevent"]),["space"]))},[g("div",s0,[g("div",null,[g("h1",{style:ne({color:n.stateColor})},U(n.state),5)]),g("div",r0,[g("div",null,[g("h2",null,U(n.heartrate)+" BPM",1),l0]),g("div",null,[g("h2",null,U(n.duration),1),c0])])])],34)}const d0=A(a0,[["render",u0],["__scopeId","data-v-258e6b3d"]]),h0={name:"PatientInfoHUD",mounted(){const{canvas:e}=this.$refs;e.width=this.numImages*this.imgWidth,e.height=this.imgHeight,this.addPhaseId(),this.addHRInfo()},data(){return{paddingX:15}},props:{isHidden:{type:Boolean},numImages:{type:Number,required:!0},imgWidth:{type:Number,required:!0},imgHeight:{type:Number,required:!0}},methods:{addPhaseId(){const{canvas:e}=this.$refs,t=e.getContext("2d");t.font="500 12px Roboto",t.textAlign="left",t.textBaseline="middle",t.fillStyle="white";const{numImages:n}=this,s=this.paddingX,o=15;for(let i=0;i<n;i++)t.fillText(`Phase ${i+1}`,s+this.imgWidth*i,o)},addHRInfo(){const{canvas:e}=this.$refs,t=e.getContext("2d");t.font="500 12px Roboto",t.textAlign="left",t.textBaseline="middle",t.fillStyle="white";const{numImages:n}=this,s=this.paddingX,o=30;for(let i=0;i<n;i++)t.fillText(`HR ${this.getRandomInt(106,30)}`,s+this.imgWidth*i,o)},getRandomInt(e,t){return t+Math.floor(Math.random()*(e-t))}}},g0={ref:"canvas"};function f0(e,t,n,s,o,i){return x(),L("div",null,[g("canvas",g0,null,512)])}const p0=A(h0,[["render",f0]]);const m0={name:"RangeSlider",props:{maxExpand:{type:Number,default:10},minExpand:{type:Number,default:3},canvasWidth:{type:Number},sliceObj:{type:Object},numImages:Number,imgWidth:Number},data(){return{canvasHeight:44,thumbRadius:3,isDragging:!1,startThumbX:0,endThumbX:0,minValue:0,maxValue:100,startValue:0,startValueParent:0,endValue:10,startDragX:null,scrollerHeight:12,canvasCursor:"pointer"}},mounted(){this.endValue=1/(this.imgWidth*this.numImages/(this.canvasWidth-8)/100),console.log(`IMAGE STRIP WIDTH: ${this.canvasWidth}`),this.drawCanvas(),this.throttledSliderMove=lr(this.moveScale,5)},methods:{drawCurrentView(e,t){const n=e,s=Math.abs(t-e),{canvas:o}=this.$refs,i=o.getContext("2d");i.strokeStyle="#FFFFFF",i.fillStyle="#FFFFFF05";const a=35,r=(this.canvasHeight-a)/2;i.lineWidth=3;const l=6;i.beginPath(),i.moveTo(n+l,r),i.lineTo(n+s-l,r),i.arcTo(n+s,r,n+s,r+l,l),i.lineTo(n+s,r+a-l),i.arcTo(n+s,r+a,n+s-l,r+a,l),i.lineTo(n+l,r+a),i.arcTo(n,r+a,n,r+a-l,l),i.lineTo(n,r+l),i.arcTo(n,r,n+l,r,l),i.closePath(),i.fill(),i.stroke()},drawHandle(e,t,n,s,o,i,a){const r=e,l=t+s,c=n+o;r.beginPath(),r.moveTo(t+i,n),r.lineTo(l-i,n),r.quadraticCurveTo(l,n,l,n+i),r.lineTo(l,c-i),r.quadraticCurveTo(l,c,l-i,c),r.lineTo(t+i,c),r.quadraticCurveTo(t,c,t,c-i),r.lineTo(t,n+i),r.quadraticCurveTo(t,n,t+i,n),r.closePath(),r.lineWidth=2,r.strokeStyle=a,r.stroke(),r.fillStyle=a,r.fill()},drawSegment(e,t,n){const{canvas:s}=this.$refs,o=s.getContext("2d"),i=(this.canvasHeight-32)/2,a=Math.abs(t-e);this.drawHandle(o,e,i,8,32,4,n),o.fillStyle=n,o.fillRect(e,s.height/2-this.scrollerHeight/2,a,this.scrollerHeight),this.drawHandle(o,t,i,8,32,4,n)},drawTrack(){const{canvas:e}=this.$refs,t=e.getContext("2d");t.fillStyle="#3D3D3D",t.fillRect(0,e.height/2-this.scrollerHeight/2,e.width,this.scrollerHeight)},drawCanvas(){const{canvas:e}=this.$refs,t=e.getContext("2d");e.width=this.canvasWidth-8,e.height=this.canvasHeight;const n=this.getValueToXPosition(this.startValue),s=this.getValueToXPosition(this.endValue),o=this.getObjLocToVal(this.sliceObj.states.FREEBREATHING.start),i=this.getObjLocToVal(this.sliceObj.states.FREEBREATHING.end),a=this.getObjLocToVal(this.sliceObj.states.HYPERVENTILATION.start),r=this.getObjLocToVal(this.sliceObj.states.HYPERVENTILATION.end),l=this.getObjLocToVal(this.sliceObj.states.BREATHHOLD.start),c=this.getObjLocToVal(this.sliceObj.states.BREATHHOLD.end);t.clearRect(0,0,e.width,e.height),this.drawTrack(),this.drawSegment(o,i-7,"#5FBBCB"),this.drawSegment(a+3,r-7,"#C24ABC"),this.drawSegment(l+3,c-7,"#D95476"),this.drawCurrentView(n,s)},getObjLocToVal(e){const t=e.XLocation/(this.imgWidth*this.numImages);return this.getValueToXPosition(t*100)},getValueToXPosition(e){const t=this.maxValue-this.minValue,n=this.canvasWidth-8-this.thumbRadius*2;return(e-this.minValue)*n/t+this.thumbRadius},getXPositionToValue(e){const t=this.maxValue-this.minValue,n=this.canvasWidth-8-this.thumbRadius*2;return(e-this.thumbRadius)*t/n+this.minValue},handleMouseDown(e){const{canvas:t}=this.$refs,n=t.getBoundingClientRect(),s=e.clientX-n.left,o=this.getValueToXPosition(this.startValue),i=this.getValueToXPosition(this.endValue);this.startDragX=s,s<i&&s>o&&(this.isDragging="middle",this.canvasCursor="grab")},handledblCkick(e){const{canvas:t}=this.$refs,n=t.getBoundingClientRect(),s=e.clientX-n.left,o=Math.abs(this.startValue-this.endValue),i=Math.min(Math.max(this.getXPositionToValue(s)-o/2,0),this.maxValue-o);this.startValue=i,this.endValue=this.startValue+o,this.throttledSliderMove(this.startValue),this.drawCanvas()},handleMouseMove(e){if(!this.isDragging)return;const{canvas:t}=this.$refs,n=t.getBoundingClientRect(),s=e.clientX-n.left,o=this.getXPositionToValue(s),i=o-this.getXPositionToValue(this.startDragX);this.endValue+i>this.maxValue||this.startValue+i<this.minValue||(this.startValue+=i,this.endValue+=i,this.throttledSliderMove(this.startValue),this.drawCanvas(),this.startDragX=this.getValueToXPosition(o))},handleMouseUp(){this.isDragging&&(this.isDragging=!1,this.canvasCursor="pointer")},moveScale(e){this.$emit("move",e)},updatePosition(e){const t=e-this.startValue;this.startValue=e,this.endValue+=t,this.drawCanvas()}},watch:{canvasWidth(){this.drawCanvas()}}};function v0(e,t,n,s,o,i){return x(),L("div",{class:"range-slider",style:ne({width:n.canvasWidth+"px"})},[g("canvas",{ref:"canvas",onMousedown:t[0]||(t[0]=(...a)=>i.handleMouseDown&&i.handleMouseDown(...a)),onDblclick:t[1]||(t[1]=(...a)=>i.handledblCkick&&i.handledblCkick(...a)),onMousemove:t[2]||(t[2]=(...a)=>i.handleMouseMove&&i.handleMouseMove(...a)),onMouseup:t[3]||(t[3]=(...a)=>i.handleMouseUp&&i.handleMouseUp(...a)),onMouseleave:t[4]||(t[4]=(...a)=>i.handleMouseUp&&i.handleMouseUp(...a)),onFocusout:t[5]||(t[5]=(...a)=>i.handleMouseUp&&i.handleMouseUp(...a)),style:ne({cursor:o.canvasCursor})},null,36)],4)}const y0=A(m0,[["render",v0],["__scopeId","data-v-363fb1ad"]]);const w0={props:{hasLabel:null},data(){return{showContextMenu:!1,showError:!1,contextMenuX:0,contextMenuY:0}},methods:{openContextMenu(e){this.showContextMenu=!0,this.contextMenuX=e.clientX,this.contextMenuY=e.clientY},closeContextMenu(){this.showContextMenu=!1,this.showError=!1},addLabel(e){this.$emit("add-label",e),this.showContextMenu=!1},removeLabel(){this.$emit("remove-label"),this.showContextMenu=!1},popError(e){this.showError=!0,this.contextMenuX=e.clientX,this.contextMenuY=e.clientY},handleKeyPress(){}}},ut=e=>(re("data-v-d079620a"),e=e(),le(),e),S0=ut(()=>g("i",{class:"fa-solid fa-plus fa-sm",style:{color:"#ffffff"}},null,-1)),_0=ut(()=>g("h5",null,"Add Systole Label",-1)),C0=[S0,_0],b0=ut(()=>g("i",{class:"fa-solid fa-circle-plus fa-sm",style:{color:"#ffffff"}},null,-1)),T0=ut(()=>g("h5",null,"Add Diastole Label",-1)),I0=[b0,T0],x0=ut(()=>g("i",{class:"fa-regular fa-trash-can fa-sm",style:{color:"#ffffff"}},null,-1)),R0=ut(()=>g("h5",null,"Delete Label",-1)),D0=[x0,R0],L0=ut(()=>g("div",{class:"warning"},[g("i",{class:"fa-solid fa-triangle-exclamation",style:{color:"#ffcc00"}}),g("h5",null,"Unable to edit label! Please click within a breathing state.")],-1)),E0=[L0];function O0(e,t,n,s,o,i){return x(),L("div",{onContextmenu:t[6]||(t[6]=ie((...a)=>i.openContextMenu&&i.openContextMenu(...a),["prevent"])),onClick:t[7]||(t[7]=(...a)=>i.closeContextMenu&&i.closeContextMenu(...a)),onMousewheelPassive:t[8]||(t[8]=(...a)=>i.closeContextMenu&&i.closeContextMenu(...a)),onKeypress:t[9]||(t[9]=ie((...a)=>i.handleKeyPress&&i.handleKeyPress(...a),["prevent"]))},[be(e.$slots,"default",{},void 0,!0),y(Ae,{name:"fade"},{default:R(()=>[o.showContextMenu?(x(),L("div",{key:0,class:"custom-context-menu",style:ne({top:`${o.contextMenuY}px`,left:`${o.contextMenuX}px`})},[g("div",{class:N(["option",{noClick:n.hasLabel}]),onClick:t[0]||(t[0]=a=>i.addLabel("systoles")),onKeypress:t[1]||(t[1]=(...a)=>e.h&&e.h(...a))},C0,34),g("div",{class:N(["option",{noClick:n.hasLabel}]),onClick:t[2]||(t[2]=a=>i.addLabel("diastoles")),onKeypress:t[3]||(t[3]=(...a)=>e.h&&e.h(...a))},I0,34),g("div",{class:N(["option",{noClick:!n.hasLabel}]),onClick:t[4]||(t[4]=a=>i.removeLabel()),onKeypress:t[5]||(t[5]=(...a)=>e.h&&e.h(...a))},D0,34)],4)):j("",!0)]),_:1}),y(Ae,{name:"fade"},{default:R(()=>[o.showError?(x(),L("div",{key:0,class:"custom-context-menu",style:ne({top:`${o.contextMenuY}px`,left:`${o.contextMenuX}px`})},E0,4)):j("",!0)]),_:1})],32)}const V0=A(w0,[["render",O0],["__scopeId","data-v-d079620a"]]);const P0={emits:["update-slice","remove-label","add-label"],props:{isHidden:{type:Boolean},numImages:{type:Number,required:!0},imgWidth:{type:Number,required:!0},sliceObj:{type:Object,required:!0},BARHEIGHT:{type:Number,default:284},BARWIDTH:{type:Number,default:800}},components:{AddCardiacCycle:V0},data(){return{handlerBarWidth:9,cardiacCyclesLabelWidth:110,handleBarGrab:{width:30,height:28},addNewLabelX:0,hasLabelOnClick:!1,canvasCursor:"default",moving:!1,movingObj:"none",barHeight:this.BARHEIGHT,startX:0,barWidth:this.BARWIDTH,mouse:{x:null,y:null}}},mounted(){this.addXLocations(),this.drawTrimmer()},watch:{barWidth(){this.drawTrimmer()},barHeight(){this.drawTrimmer()}},methods:{drawCycleLabel(e){const t=e,n=t.XLocation,s=t.id,o=this.cardiacCyclesLabelWidth,{canvas:i}=this.$refs,a=i.getContext("2d");a.fillStyle="#00000070";const r=8,l=35,c=15;a.beginPath(),a.moveTo(n+c,r),a.lineTo(n+o-c,r),a.arcTo(n+o,r,n+o,r+c,c),a.lineTo(n+o,r+l-c),a.arcTo(n+o,r+l,n+o-c,r+l,c),a.lineTo(n+c,r+l),a.arcTo(n,r+l,n,r+l-c,c),a.lineTo(n,r+c),a.arcTo(n,r,n+c,r,c),a.closePath(),a.fill(),a.font="300 18px Roboto",a.textAlign="center",a.textBaseline="middle",a.fillStyle="white";const u=n+o/2,d=r+l/2;a.fillText(s,u,d);const h=2,v=3,p=2.5,f="rgba(255,255,255,0.65)";for(let m=0;m<3;m++){const w=n-10+o/2+v+m*(2*h+v),T=18+p+10+(2*h+p);a.beginPath(),a.arc(w,T,h,0,Math.PI*2),a.fillStyle=f,a.fill(),a.closePath()}},drawBars(e,t){const{canvas:n}=this.$refs,s=n.getContext("2d");s.fillStyle=t;const o=this.sliceObj.states[e].start.XLocation+this.handlerBarWidth,i=this.sliceObj.states[e].end.XLocation;s.beginPath(),s.moveTo(o,0),s.lineTo(i,0),s.moveTo(o,this.barHeight),s.lineTo(i,this.barHeight),s.lineWidth=3,s.strokeStyle=t,s.stroke()},drawTrimmer(){const{canvas:e}=this.$refs,t=e.getContext("2d"),n=this.barWidth,s=this.barHeight;e.width=n,e.height=s,t.clearRect(0,0,e.width,e.height),Object.entries(this.sliceObj.states).forEach(([o,i])=>{this.drawBars(o,i.color),i.cardiacCycles.systoles.forEach(a=>this.drawCycleLabel(a)),i.cardiacCycles.diastoles.forEach(a=>this.drawCycleLabel(a)),this.drawStartEndHandlers(i)})},findIfLabelOnClick(){const e=Math.floor(this.addNewLabelX/this.imgWidth)+1,t=this.findStateUserClicked();try{const{cardiacCycles:n}=this.sliceObj.states[t];let s=null,o=null;if(Object.keys(n).some(i=>(o=n[i].findIndex(a=>a.phaseLocation===e?(s=i,!0):!1),o!==-1)),o!==-1)return{state:t,foundLabel:s,foundIndex:o}}catch{return"error"}return null},findStateUserClicked(){let e=null;return Object.keys(this.sliceObj.states).some(t=>{const n=this.sliceObj.states[t].end.XLocation;return this.sliceObj.states[t].start.XLocation<=this.mouse.x&&this.mouse.x<=n?(e=t,!0):!1}),e},findObjonCursor(e){const t=this.sliceObj.states[e],{start:n,end:s,cardiacCycles:o}=t;if(this.checkMouseOnStart(n))return n;if(this.checkMouseOnEnd(s))return s;const i=this.checkAllLabels(o.systoles);if(i)return i;const a=this.checkAllLabels(o.diastoles);return a||null},checkMouseOnStart(e){const t=e.XLocation,n=t+this.handleBarGrab.width,s=this.barHeight/2-this.handleBarGrab.height,o=this.barHeight/2+this.handleBarGrab.height;return this.checkMouseInArea(t,n,s,o)},checkMouseOnEnd(e){const t=e.XLocation-this.handleBarGrab.width,n=t+this.handleBarGrab.width,s=this.barHeight/2-this.handleBarGrab.height,o=this.barHeight/2+this.handleBarGrab.height;return this.checkMouseInArea(t,n,s,o)},checkMouseOnLabel(e){const t=e.XLocation,n=t+this.cardiacCyclesLabelWidth,s=8,o=40;return this.checkMouseInArea(t,n,s,o)},checkAllLabels(e){return e.find(t=>this.checkMouseOnLabel(t))},checkMouseInArea(e,t,n,s){return this.mouse.x>=e&&this.mouse.x<=t&&this.mouse.y>=n&&this.mouse.y<=s},startResize(e){this.$refs.menu.closeContextMenu(),this.mouse.x=e.offsetX,this.mouse.y=e.offsetY,this.startX=this.mouse.x;const t=this.findStateUserClicked();if(t){const n=this.findObjonCursor(t);n&&(this.moving=!0,this.movingObj=n)}},handleNotMoving(){const e=this.findStateUserClicked();this.updateCursor(),e&&(this.findObjonCursor(e)?this.updateCursor("grab"):this.updateCursor())},handleCheckUpperLowerBound(e,t,n,s,o){return e==="start"?this.sliceObj.states[t].start.XLocation+n+this.imgWidth>this.sliceObj.states[t].end.XLocation||this.sliceObj.states[t].start.XLocation+n<=s:this.sliceObj.states[t].end.XLocation+n-this.imgWidth-50<this.sliceObj.states[t].start.XLocation||this.sliceObj.states[t].end.XLocation+n>=o},mousemoving(e){if(!(e.offsetX>=this.sliceObj.states.FREEBREATHING.start.XLocation&&e.offsetX<=this.sliceObj.states.BREATHHOLD.end.XLocation+30||this.moving)){this.updateCursor();return}if(this.mouse.x=e.offsetX,this.mouse.y=e.offsetY,!this.moving){this.handleNotMoving();return}e.preventDefault();const t=e.offsetX,n=t-this.startX;if(this.movingObj.id==="end"||this.movingObj.id==="start"){const s=this.getPreviousKey(this.sliceObj.states,this.movingObj.state),o=this.getNextKey(this.sliceObj.states,this.movingObj.state),i=s?this.sliceObj.states[s].end.XLocation:0,a=o?this.sliceObj.states[o].start.XLocation:this.barWidth;if(this.handleCheckUpperLowerBound(this.movingObj.id,this.movingObj.state,n,i,a))return;const{cardiacCycles:r}=this.sliceObj.states[this.movingObj.state];if(Object.keys(r).some(c=>r[c].some(d=>this.checkCollisionStartEnd(d,n))))return;this.startX=t,this.movingObj.XLocation+=n,requestAnimationFrame(this.drawTrimmer);return}this.movingObj.XLocation+n<=this.sliceObj.states[this.movingObj.state].start.XLocation||this.movingObj.XLocation+n>this.sliceObj.states[this.movingObj.state].end.XLocation-this.cardiacCyclesLabelWidth||(this.movingObj.XLocation+=n,requestAnimationFrame(this.drawTrimmer),this.startX=t)},checkCollisionStartEnd(e,t){return this.movingObj.id==="start"?t<0?!1:this.movingObj.XLocation+t-10>=(e.phaseLocation-1)*this.imgWidth:this.movingObj.id==="end"?t>0?!1:this.movingObj.XLocation+t+15<=e.phaseLocation*this.imgWidth:!1},drawhandle(e,t,n,s,o,i,a){const r=e;r.beginPath(),r.moveTo(t+i,n),r.lineTo(s-i,n),r.quadraticCurveTo(s,n,s,n+i),r.lineTo(s,o-i),r.quadraticCurveTo(s,o,s-i,o),r.lineTo(t+i,o),r.quadraticCurveTo(t,o,t,o-i),r.lineTo(t,n+i),r.quadraticCurveTo(t,n,t+i,n),r.closePath(),r.lineWidth=2,r.strokeStyle=a,r.stroke(),r.fillStyle=a,r.fill();const l=2.5,c=3,u=2.5,d="rgba(255,255,255,0.65)";for(let h=0;h<3;h++)for(let v=0;v<2;v++){const p=t+i+c+v*(2*l+c),f=n+i+u+10+h*(2*l+u);r.beginPath(),r.arc(p,f,l,0,Math.PI*2),r.fillStyle=d,r.fill(),r.closePath()}},drawStartEndHandlers(e){const t=e,{canvas:n}=this.$refs,s=n.getContext("2d"),o=5,i=this.handlerBarWidth+o,a=this.barHeight,r=0;let l=t.start.XLocation;t.start.XLocation=l;const c=t.color;s.beginPath(),s.moveTo(l+o,r),s.lineTo(l+i-o,r),s.lineTo(l+i-o,r+a),s.lineTo(l+o,r+a),s.arcTo(l,r+a,l,r+a-o,o),s.lineTo(l,r+o),s.arcTo(l,r,l+o,r,o),s.closePath(),s.fillStyle=c,s.fill(),this.drawhandle(s,l+o-4,a/2-this.handleBarGrab.height,l+this.handleBarGrab.width,a/2+this.handleBarGrab.height,8,c),l=t.end.XLocation,t.end.XLocation=l,l-=o,s.beginPath(),s.moveTo(l+o,r),s.arcTo(l+i,r,l+i,r+o,o),s.lineTo(l+i,r+a-o),s.arcTo(l+i,r+a,l+i-o,r+a,o),s.lineTo(l+o,r+a),s.closePath(),s.fillStyle=c,s.fill(),this.drawhandle(s,l-this.handleBarGrab.width+o+7,a/2-this.handleBarGrab.height,l+o+4,a/2+this.handleBarGrab.height,8,c)},checksingleobj(e){return this.mouse.x>=e.location&&this.mouse.x<=e.location+e.width},snapObject(){this.movingObj.phaseLocation=this.convertXLocationtoPhase(this.movingObj.XLocation,this.movingObj.id),this.movingObj.XLocation=this.convertPhaseLocationtoX(this.movingObj.phaseLocation,this.movingObj.id)},endResize(){this.moving&&(this.moving=!1,this.snapObject(),this.drawTrimmer(),this.startX=this.mouse.x,this.moving=!1,this.movingObj="none",this.$emit("update-slice",this.sliceObj))},updateCursor(e="default"){this.canvasCursor=e},getNextKey(e,t){const n=Object.keys(e),s=n.indexOf(t);return s===-1||s===n.length-1?!1:n[s+1]},getPreviousKey(e,t){const n=Object.keys(e),s=n.indexOf(t);return s<=0?!1:n[s-1]},handleAddLabel(e){const t=this.findStateUserClicked(),n=e==="systoles"?"Systole":"Diastole",s=Math.floor(this.mouse.x/this.imgWidth)+1,o=this.convertPhaseLocationtoX(s),i={id:n,state:t,phaseLocation:s,XLocation:o};this.$emit("add-label",{id:this.sliceObj.id,target:e,state:t,newLabel:i}),this.drawTrimmer()},handleRightClick(e){if(this.addNewLabelX=e.offsetX,this.mouse.x=this.addNewLabelX,this.hasLabelOnClick=this.findIfLabelOnClick(),this.hasLabelOnClick==="error"){this.$refs.menu.popError(e);return}this.$refs.menu.openContextMenu(e)},handleRemoveLabel(){const{state:e,foundLabel:t,foundIndex:n}=this.hasLabelOnClick,s=this.sliceObj.states[e].cardiacCycles[t],o=this.removeElementAtIndex(s,n);this.$emit("remove-label",{id:this.sliceObj.id,state:e,cycle:t,newArray:o}),this.drawTrimmer()},removeElementAtIndex(e,t){if(t<0||t>=e.length)throw new Error("Index is out of range");const n=[...e];return n.splice(t,1),n},convertPhaseLocationtoX(e,t){let n;if(t==="start")n=(e-1)*this.imgWidth;else if(t==="end")n=e*this.imgWidth-this.handlerBarWidth;else{const s=(this.imgWidth-this.cardiacCyclesLabelWidth)/2;n=(e-1)*this.imgWidth+s}return n},convertXLocationtoPhase(e,t){let n;if(t==="start"){const s=e+this.imgWidth/2;n=Math.floor(s/this.imgWidth)+1}else if(t==="end"){const s=e-this.imgWidth/2;n=Math.floor(s/this.imgWidth)+1}else{const s=e+this.cardiacCyclesLabelWidth/2;n=Math.floor(s/this.imgWidth)+1}return n},addXLocation(e,t){const n=e;n.XLocation=this.convertPhaseLocationtoX(n.phaseLocation,t)},addXLocations(){Object.entries(this.sliceObj.states).forEach(([e])=>{const t=this.sliceObj.states[e];this.addXLocation(t.start,"start"),this.addXLocation(t.end,"end"),t.cardiacCycles.diastoles.forEach(n=>this.addXLocation(n)),t.cardiacCycles.systoles.forEach(n=>this.addXLocation(n))})}}};function k0(e,t,n,s,o,i){const a=P("AddCardiacCycle");return x(),L(se,null,[g("div",{class:N([{hide:n.isHidden},"horizontal-bar"])},[g("canvas",{ref:"canvas",style:ne({cursor:o.canvasCursor}),onMousedown:t[0]||(t[0]=(...r)=>i.startResize&&i.startResize(...r)),onFocusin:t[1]||(t[1]=(...r)=>i.startResize&&i.startResize(...r)),onFocusout:t[2]||(t[2]=(...r)=>i.endResize&&i.endResize(...r)),onMousemove:t[3]||(t[3]=(...r)=>i.mousemoving&&i.mousemoving(...r)),onMouseup:t[4]||(t[4]=(...r)=>i.endResize&&i.endResize(...r)),onMouseout:t[5]||(t[5]=(...r)=>i.endResize&&i.endResize(...r)),onContextmenu:t[6]||(t[6]=ie((...r)=>i.handleRightClick&&i.handleRightClick(...r),["prevent"])),onMousewheelPassive:t[7]||(t[7]=(...r)=>this.$refs.menu.closeContextMenu&&this.$refs.menu.closeContextMenu(...r))},null,36)],2),y(a,{ref:"menu","has-label":o.hasLabelOnClick,onAddLabel:i.handleAddLabel,onRemoveLabel:i.handleRemoveLabel},null,8,["has-label","onAddLabel","onRemoveLabel"])],64)}const M0=A(P0,[["render",k0],["__scopeId","data-v-548ead61"]]);const B0={components:{ImageStripSlider:y0,VideoTrimmer:M0,ImageBarImageInfo:p0},emits:["newstate","update-slice","remove-label","add-label"],props:{currentState:{type:String,default:"FREEBREATHING"},maxWidth:{type:Number,default:1560},isHidden:{type:Boolean,default:!0},hideinfo:{type:Boolean,required:!0,default:!0},numImages:{type:Number,default:100},id:{type:String},sliceObj:{type:Object,required:!0}},data(){return{imageWidth:286,requestId:null,videTrimWidth:null,imageHeight:284,imageRatio:0,originalImageWidth:0,imageHeightWidthRatio:0,heightHere:284,viewState:"FREEBREATHING"}},created(){this.videTrimWidth=this.imageWidth*this.numImages},mounted(){const e=new Image;e.src="./images/test.png",e.onload=()=>{this.imageHeightWidthRatio=e.naturalHeight/e.naturalWidth,this.imageHeight=this.imageWidth*this.imageHeightWidthRatio,this.$refs.videotrimmer.barHeight=this.imageHeight},e.onerror=()=>{console.error("Failed to load the image.")},this.drawMovieStrip(),setTimeout(()=>{this.$emit("loaded")},1500)},methods:{drawMovieStrip(){const e=this.$refs.movieStripCanvas,t=e.getContext("2d"),{numImages:n}=this;e.width=this.imageWidth*n,e.height=this.imageHeight,this.videTrimWidth=e.width,t.clearRect(0,0,e.width,e.height);const s=Array(n).fill("./images/test.png"),{imageWidth:o}=this;let i=0;const a=s.map(r=>new Promise((l,c)=>{const u=new Image;u.src=r,u.onload=()=>{l(u)},u.onerror=d=>{c(d)}}));Promise.all(a).then(r=>{r.forEach(l=>{t.drawImage(l,i,0,o,this.imageHeight),i+=o})}).catch(r=>{console.error(r)})},scrollX(e){const t="image-container",n=this.$refs[t];e.ctrlKey?n.scrollLeft+=e.deltaY*2.5:n.scrollLeft+=e.deltaY/4,this.$refs.sliderBar.updatePosition(100*n.scrollLeft/n.scrollWidth),this.getScrollState()},moveX(e){const t="image-container";this.$refs[t].scrollLeft=this.$refs[t].scrollWidth*(e/100),this.getScrollState()},getScrollState(){const e=["FREEBREATHING","HYPERVENTILATION","BREATHHOLD"],t=this.sliceObj,n=this.$refs["image-container"].scrollLeft;if(!(t.states[this.viewState].start.XLocation<n&&n<t.states[this.viewState].end.XLocation)){const s=e.find(o=>n<t.states[o].end.XLocation);s&&(this.viewState=s,this.$emit("newstate",this.viewState))}},scrollAnimation(e,t){const n=e,s=n.scrollLeft,o=300;let i;function a(r){i||(i=r);const l=r-i,c=Math.min(l/o,1);n.scrollLeft=s+t*c,c<1&&requestAnimationFrame(a)}requestAnimationFrame(a)},scrollToState(e){const t=this.$refs["image-container"],n=this.sliceObj.states[e].start.XLocation,s=n-t.scrollLeft;this.scrollAnimation(t,s),this.$refs.sliderBar.updatePosition(100*n/t.scrollWidth)},handleUpdateSlice(e){this.$emit("update-slice",e),this.$refs.sliderBar.drawCanvas()},handleRemoveLabel(e){this.$emit("remove-label",e)},handleAddLabel(e){this.$emit("add-label",e)}}},A0={style:{height:"284px"}},F0={class:"video-trimmer-container",ref:"video-trimmer-container"},N0={ref:"movieStripCanvas"},$0={key:0};function U0(e,t,n,s,o,i){const a=P("VideoTrimmer"),r=P("ImageBarImageInfo"),l=P("ImageStripSlider");return x(),L(se,null,[g("div",A0,[g("div",{class:"strip",style:ne({width:n.maxWidth-250+"px"}),ref:"image-container",onMousewheelPassive:t[0]||(t[0]=(...c)=>i.scrollX&&i.scrollX(...c))},[g("div",F0,[y(a,{"slice-obj":n.sliceObj,BARHEIGHT:o.imageHeight,BARWIDTH:o.videTrimWidth,numImages:this.numImages,imgWidth:o.imageWidth,isHidden:!n.isHidden,ref:"videotrimmer",onUpdateSlice:i.handleUpdateSlice,onRemoveLabel:i.handleRemoveLabel,onAddLabel:i.handleAddLabel},null,8,["slice-obj","BARHEIGHT","BARWIDTH","numImages","imgWidth","isHidden","onUpdateSlice","onRemoveLabel","onAddLabel"])],512),g("div",{style:ne({height:o.heightHere+"px"}),ref:"moviestripcont"},[g("canvas",N0,null,512)],4),y(Ae,null,{default:R(()=>[n.hideinfo?(x(),L("div",$0,[y(r,{numImages:this.numImages,imgWidth:o.imageWidth,imgHeight:o.heightHere},null,8,["numImages","imgWidth","imgHeight"])])):j("",!0)]),_:1})],36)]),y(l,{numImages:this.numImages,imgWidth:o.imageWidth,"slice-obj":n.sliceObj,canvasWidth:n.maxWidth-250,onUpdateDone:i.drawMovieStrip,onMove:i.moveX,ref:"sliderBar"},null,8,["numImages","imgWidth","slice-obj","canvasWidth","onUpdateDone","onMove"])],64)}const H0=A(B0,[["render",U0],["__scopeId","data-v-a536b1c7"]]);const W0={props:{iconSource:{type:String,default:"input-cursor"},id:{type:Number},status:{type:Boolean,default:!0},iconHeight:{type:Number,default:30}},methods:{handleclick(){this.$emit("toggleVisibility",this.status)}}},z0=["src"];function j0(e,t,n,s,o,i){return x(),L("div",{onClick:t[0]||(t[0]=(...a)=>i.handleclick&&i.handleclick(...a)),class:N(["circle2",{clicked:n.status}]),onKeydown:t[1]||(t[1]=ke(ie((...a)=>e.handleKeyDown&&e.handleKeyDown(...a),["prevent"]),["space"]))},[g("div",{class:N([{clicked:n.status},"icon-container"])},[g("img",{src:"/icons/"+n.iconSource+".svg",style:ne({height:n.iconHeight+"px"}),alt:"Icon"},null,12,z0)],2)],34)}const G0=A(W0,[["render",j0],["__scopeId","data-v-2d9b6532"]]);const X0={props:{givenWidth:{type:Number},givenHeight:{type:Number},count:{type:Number,default:1},flexDirection:{type:String,default:"column"},radius:{type:Number,default:5}}};function q0(e,t,n,s,o,i){return x(),L("div",{class:"cards",style:ne({flexDirection:n.flexDirection})},[(x(!0),L(se,null,Pe(n.count,a=>(x(),L("div",{key:a,class:"card is-loading",style:ne({width:n.givenWidth+"px",height:n.givenHeight+"px",borderRadius:n.radius+"px"})},null,4))),128))],4)}const Y0=A(X0,[["render",q0]]);const K0={props:{allowedWidth:{type:Number}},components:{SquareLoader:Y0}},wo=e=>(re("data-v-b8f7eb4b"),e=e(),le(),e),Q0={class:"slice"},Z0={class:"state-control"},J0=wo(()=>g("br",null,null,-1)),e1=wo(()=>g("br",null,null,-1)),t1={style:{overflow:"hidden"}},n1=wo(()=>g("br",null,null,-1));function o1(e,t,n,s,o,i){const a=P("SquareLoader");return x(),L("div",Q0,[g("div",Z0,[y(a,{"given-width":100,givenHeight:35}),J0,y(a,{"given-width":45,givenHeight:45,count:3,flexDirection:"row",radius:50}),e1,y(a,{"given-width":180,givenHeight:65,count:3})]),g("div",t1,[y(a,{"given-width":284,givenHeight:250,count:Math.floor((n.allowedWidth-250)/284)+1,flexDirection:"row"},null,8,["count"]),n1,y(a,{"given-width":n.allowedWidth-270,givenHeight:44},null,8,["given-width"])])])}const i1=A(K0,[["render",o1],["__scopeId","data-v-b8f7eb4b"]]);const a1={components:{StateButtons:d0,ImageBar:H0,IconToggleQA:G0,SkeletonLoaderCBS:i1},props:{sliceInfo:{type:Object}},data(){return{stateButtons:this.sliceInfo.stateButtons,allowedWidth:null,loading:!0}},methods:{handleStateChange(e){const t=e.replace(/\s/g,"");this.$emit("state-change",t),this.$refs.imgBar.scrollToState(t)},handleNewState(e){this.$emit("state-change",e)},handleUpdateSlice(e){this.$emit("update-slice",e)},handleRemoveLabel(e){this.$emit("remove-label",e)},handleAddLabel(e){this.$emit("add-label",e)},handleResize(){this.allowedWidth=window.innerWidth-100,this.allowedWidth>2e3&&(this.allowedWidth=2e3)}},created(){window.addEventListener("resize",this.handleResize),this.handleResize()}},s1={class:"state-control"},r1={class:"slice-name"},l1={class:"toggle-icons-container"},c1={class:"state-buttons"},u1={class:"movie-strip"};function d1(e,t,n,s,o,i){const a=P("SkeletonLoaderCBS"),r=P("IconToggleQA"),l=P("StateButtons"),c=P("ImageBar");return x(),L(se,null,[tt(y(a,{allowedWidth:o.allowedWidth},null,8,["allowedWidth"]),[[Ft,o.loading]]),y(Ae,{name:"slide-fade"},{default:R(()=>[tt(g("div",{class:"slice",style:ne({width:o.allowedWidth+"px"})},[g("div",s1,[g("h1",r1,U(n.sliceInfo.name),1),g("div",l1,[y(r,{id:n.sliceInfo.id,onToggleVisibility:t[0]||(t[0]=u=>e.$emit("toggle-trimmer",n.sliceInfo.id)),iconSource:"adjust-trim",status:n.sliceInfo.imgBarProperties.showTrimmer},null,8,["id","status"]),y(r,{id:n.sliceInfo.id,onToggleVisibility:t[1]||(t[1]=u=>e.$emit("toggle-patient-info",n.sliceInfo.id)),iconSource:"hide-bottom",status:n.sliceInfo.imgBarProperties.showPatientInfo},null,8,["id","status"]),y(r,{id:n.sliceInfo.id,status:n.sliceInfo.imgBarProperties.showGraph,iconSource:"show-contours",onToggleVisibility:t[2]||(t[2]=u=>e.$emit("toggle-graph",n.sliceInfo.id))},null,8,["id","status"])]),g("div",c1,[y(l,{id:n.sliceInfo.id,heartrate:o.stateButtons.FREEBREATHING.heartrate,duration:o.stateButtons.FREEBREATHING.duration,state:"FREE BREATHING","is-active":o.stateButtons.currentState==="FREEBREATHING",onStateChange:i.handleStateChange},null,8,["id","heartrate","duration","is-active","onStateChange"]),y(l,{id:n.sliceInfo.id,heartrate:o.stateButtons.HYPERVENTILATION.heartrate,duration:o.stateButtons.HYPERVENTILATION.duration,state:"HYPERVENTILATION","is-active":o.stateButtons.currentState==="HYPERVENTILATION",stateColor:o.stateButtons.HYPERVENTILATION.stateColor,onStateChange:i.handleStateChange},null,8,["id","heartrate","duration","is-active","stateColor","onStateChange"]),y(l,{id:n.sliceInfo.id,heartrate:o.stateButtons.BREATHHOLD.heartrate,duration:o.stateButtons.BREATHHOLD.duration,state:"BREATHHOLD","is-active":o.stateButtons.currentState==="BREATHHOLD",stateColor:o.stateButtons.BREATHHOLD.stateColor,onStateChange:i.handleStateChange},null,8,["id","heartrate","duration","is-active","stateColor","onStateChange"])])]),g("div",u1,[y(c,{id:n.sliceInfo.sliceOBJ.id,isHidden:n.sliceInfo.imgBarProperties.showTrimmer,hideinfo:n.sliceInfo.imgBarProperties.showPatientInfo,"slice-obj":n.sliceInfo.sliceOBJ,currentState:o.stateButtons.currentState,maxWidth:o.allowedWidth,ref:"imgBar",onNewstate:i.handleNewState,onUpdateSlice:i.handleUpdateSlice,onRemoveLabel:i.handleRemoveLabel,onAddLabel:i.handleAddLabel,onLoaded:t[3]||(t[3]=u=>o.loading=!1)},null,8,["id","isHidden","hideinfo","slice-obj","currentState","maxWidth","onNewstate","onUpdateSlice","onRemoveLabel","onAddLabel"])])],4),[[Ft,!o.loading]])]),_:1})],64)}const h1=A(a1,[["render",d1],["__scopeId","data-v-64ce29ce"]]);const g1={components:{BreathingSplitRow:h1},data(){return{caseObj:{slice1:{id:"slice1",states:{FREEBREATHING:{color:"#79CFDE",start:{id:"start",state:"FREEBREATHING",phaseLocation:1},end:{id:"end",state:"FREEBREATHING",phaseLocation:4},cardiacCycles:{systoles:[{id:"Systole",state:"FREEBREATHING",phaseLocation:1},{id:"Systole",state:"FREEBREATHING",phaseLocation:2}],diastoles:[{id:"Diastole",state:"FREEBREATHING",phaseLocation:3}]}},HYPERVENTILATION:{color:"#C24ABC",start:{id:"start",state:"HYPERVENTILATION",phaseLocation:5},end:{id:"end",state:"HYPERVENTILATION",phaseLocation:20},cardiacCycles:{systoles:[{id:"Systole",state:"HYPERVENTILATION",phaseLocation:5}],diastoles:[{id:"Diastole",state:"HYPERVENTILATION",phaseLocation:6}]}},BREATHHOLD:{color:"#d95476",start:{id:"start",state:"BREATHHOLD",phaseLocation:21},end:{id:"end",state:"BREATHHOLD",phaseLocation:30},cardiacCycles:{systoles:[{id:"Systole",state:"BREATHHOLD",phaseLocation:25}],diastoles:[{id:"Diastole",state:"BREATHHOLD",phaseLocation:28}]}}}},slice2:{id:"slice2",states:{FREEBREATHING:{color:"#79CFDE",start:{id:"start",state:"FREEBREATHING",phaseLocation:1},end:{id:"end",state:"FREEBREATHING",phaseLocation:10},cardiacCycles:{systoles:[{id:"Systole",state:"FREEBREATHING",phaseLocation:3}],diastoles:[{id:"Diastole",state:"FREEBREATHING",phaseLocation:5}]}},HYPERVENTILATION:{color:"#C24ABC",start:{id:"start",state:"HYPERVENTILATION",phaseLocation:11},end:{id:"end",state:"HYPERVENTILATION",phaseLocation:30},cardiacCycles:{systoles:[{id:"Systole",state:"HYPERVENTILATION",phaseLocation:12}],diastoles:[{id:"Diastole",state:"HYPERVENTILATION",phaseLocation:20}]}},BREATHHOLD:{color:"#d95476",start:{id:"start",state:"BREATHHOLD",phaseLocation:31},end:{id:"end",state:"BREATHHOLD",phaseLocation:80},cardiacCycles:{systoles:[{id:"Systole",state:"BREATHHOLD",phaseLocation:35}],diastoles:[{id:"Diastole",state:"BREATHHOLD",phaseLocation:60}]}}}}},sliceInfo1:{name:"SLICE 1",id:1,sliceOBJ:null,stateButtons:{currentState:"FREEBREATHING",FREEBREATHING:{state:"FREEBREATHING",heartrate:80,duration:"01:32",stateColor:"#E242E6"},HYPERVENTILATION:{state:"HYPERVENTILATION",heartrate:120,duration:"02:32",stateColor:"#E242E6"},BREATHHOLD:{state:"BREATHHOLD",heartrate:70,duration:"00:32",stateColor:"#D95476"}},imgBarProperties:{showTrimmer:!0,showPatientInfo:!0,showGraph:!1}},sliceInfo2:{name:"SLICE 2",id:2,sliceOBJ:null,stateButtons:{currentState:"FREEBREATHING",FREEBREATHING:{state:"FREEBREATHING",heartrate:50,duration:"01:32",stateColor:"#E242E6"},HYPERVENTILATION:{state:"HYPERVENTILATION",heartrate:60,duration:"01:32",stateColor:"#E242E6"},BREATHHOLD:{state:"BREATHHOLD",heartrate:125,duration:"01:32",stateColor:"#D95476"}},imgBarProperties:{showTrimmer:!0,showPatientInfo:!0,showGraph:!1}}}},methods:{handleUpdateSlice(e){const t=e.id;this.caseObj[t]=e},handleRemoveLabel(e){this.caseObj[e.id].states[e.state].cardiacCycles[e.cycle]=e.newArray},handleAddLabel(e){this.caseObj[e.id].states[e.state].cardiacCycles[e.target].push(e.newLabel)}},created(){this.sliceInfo1.sliceOBJ=this.caseObj.slice1,this.sliceInfo2.sliceOBJ=this.caseObj.slice2}},f1={class:"slices-containers"};function p1(e,t,n,s,o,i){const a=P("BreathingSplitRow");return x(),L("div",f1,[y(a,{"slice-info":o.sliceInfo1,onToggleTrimmer:t[0]||(t[0]=r=>o.sliceInfo1.imgBarProperties.showTrimmer=!o.sliceInfo1.imgBarProperties.showTrimmer),onTogglePatientInfo:t[1]||(t[1]=r=>o.sliceInfo1.imgBarProperties.showPatientInfo=!o.sliceInfo1.imgBarProperties.showPatientInfo),onToggleGraph:t[2]||(t[2]=r=>o.sliceInfo1.imgBarProperties.showGraph=!o.sliceInfo1.imgBarProperties.showGraph),onStateChange:t[3]||(t[3]=r=>o.sliceInfo1.stateButtons.currentState=r),onUpdateSlice:i.handleUpdateSlice,onRemoveLabel:i.handleRemoveLabel,onAddLabel:i.handleAddLabel},null,8,["slice-info","onUpdateSlice","onRemoveLabel","onAddLabel"]),y(a,{"slice-info":o.sliceInfo2,onToggleTrimmer:t[4]||(t[4]=r=>o.sliceInfo2.imgBarProperties.showTrimmer=!o.sliceInfo2.imgBarProperties.showTrimmer),onTogglePatientInfo:t[5]||(t[5]=r=>o.sliceInfo2.imgBarProperties.showPatientInfo=!o.sliceInfo2.imgBarProperties.showPatientInfo),onToggleGraph:t[6]||(t[6]=r=>o.sliceInfo2.imgBarProperties.showGraph=!o.sliceInfo2.imgBarProperties.showGraph),onStateChange:t[7]||(t[7]=r=>o.sliceInfo2.stateButtons.currentState=r),onUpdateSlice:i.handleUpdateSlice,onRemoveLabel:i.handleRemoveLabel,onAddLabel:i.handleAddLabel},null,8,["slice-info","onUpdateSlice","onRemoveLabel","onAddLabel"])])}const m1=A(g1,[["render",p1],["__scopeId","data-v-ab7f5aee"]]);const v1={components:{CheckBreathingSplits:m1,CheckContours:fs,LoadingScreen:ia},data(){return{currentComponent:"CheckBreathingSplits"}},methods:{handleButtonClicked(e){this.activeButton=e},toggleComponent(e){this.currentComponent=e}},mounted(){const e=window.sessionStorage.getItem("currentQaView");e?this.currentComponent=e:this.currentComponent="CheckBreathingSplits"}},y1={class:"qualitycontainer"};function w1(e,t,n,s,o,i){return x(),L("div",y1,[g("div",{class:N([{loaded:1},"comp-container"])},[y(Ae,{name:"fade"},{default:R(()=>[(x(),K(Ci(o.currentComponent)))]),_:1})])])}const S1=A(v1,[["render",w1],["__scopeId","data-v-25c3d57c"]]);const _1={props:{editable:{type:Boolean}},data(){return{imageSource:null,hovering:!1}},methods:{openImageDialog(){this.$refs.imageInput.click()},handleImageChange(e){this.uploadImage(e.target.files[0])},handleImageDrop(e){e.preventDefault();const t=e.dataTransfer.files[0];this.uploadImage(t)},handleDragOver(e){e.preventDefault(),this.hovering=!0},handleDragLeave(){this.hovering=!1},uploadImage(e){if(e){const t=new FileReader;t.onloadend=()=>{this.imageSource=t.result},t.readAsDataURL(e)}}}},C1=["src"];function b1(e,t,n,s,o,i){return x(),L("div",{class:"logo-holder",onClick:t[2]||(t[2]=(...a)=>i.openImageDialog&&i.openImageDialog(...a)),onDragenter:t[3]||(t[3]=(...a)=>i.handleDragOver&&i.handleDragOver(...a)),onDragover:t[4]||(t[4]=(...a)=>i.handleDragOver&&i.handleDragOver(...a)),onDrop:t[5]||(t[5]=(...a)=>i.handleImageDrop&&i.handleImageDrop(...a)),onDragleave:t[6]||(t[6]=(...a)=>i.handleDragLeave&&i.handleDragLeave(...a)),ref:"logoContainer",onKeydown:t[7]||(t[7]=ke(ie((...a)=>e.handleKeyDown&&e.handleKeyDown(...a),["prevent"]),["space"]))},[o.imageSource?(x(),L("img",{key:0,src:o.imageSource,alt:"Uploaded Logo",style:{cursor:"pointer"}},null,8,C1)):j("",!0),n.editable&&!o.imageSource?(x(),L("div",{key:1,class:N(["place-holder",{hover:o.hovering}])},[g("h4",{onDragover:t[0]||(t[0]=(...a)=>i.handleDragOver&&i.handleDragOver(...a))},"Click or Drop Logo",32)],2)):j("",!0),g("input",{ref:"imageInput",type:"file",style:{display:"none"},accept:"image/*",onChange:t[1]||(t[1]=(...a)=>i.handleImageChange&&i.handleImageChange(...a)),"aria-labelledby":"logoImageInput"},null,544)],544)}const T1=A(_1,[["render",b1],["__scopeId","data-v-bca1a7a6"]]);const I1={props:{id:{type:String,required:!0},options:{type:Array,required:!0},editable:{type:Boolean,default:!0}},data(){return{selectedOption:"Select..."}},methods:{onOptionSelected(e){const t=e.target.value;this.selectedOption=t,this.$emit("option-selected",this.id,t)}}},x1=e=>(re("data-v-6a5101fe"),e=e(),le(),e),R1={key:0,class:"select"},D1=["id"],L1=x1(()=>g("option",{value:"",disabled:"",selected:""},"Select...",-1)),E1=["value"],O1={key:1,class:"selected-option"};function V1(e,t,n,s,o,i){return n.editable?(x(),L("div",R1,[g("select",{id:n.id,required:"",onChange:t[0]||(t[0]=a=>i.onOptionSelected(a)),"aria-labelledby":"dropDownComponentinReportElement"},[L1,(x(!0),L(se,null,Pe(n.options,(a,r)=>(x(),L("option",{key:r,value:a.value},U(a.label),9,E1))),128))],40,D1)])):(x(),L("h5",O1,U(o.selectedOption),1))}const P1=A(I1,[["render",V1],["__scopeId","data-v-6a5101fe"]]);const k1={props:{id:{type:String},width:{type:Number,default:200},height:{type:Number,default:250},canvasText:{type:String,default:"Select or Drop Image"},addBar:{type:String,default:null},editable:{type:Boolean,default:!0}},data(){return{moveMode:!1,isMoving:!1,cStartX:null,cStartY:null,canvasX:0,canvasY:0,zoomValue:1,defaultZoomValue:1,originalImage:null,hovering:!1}},methods:{setupCanvas(){const{canvas:e}=this.$refs,t=e.getContext("2d");e.width=this.width*(1/.75),e.height=this.height,t.fillStyle="rgba(0, 0, 0, 0.3)",t.fillRect(0,0,e.width,e.height),t.fillStyle="white",t.font="20px Arial",t.textAlign="center",t.textBaseline="middle",this.wrapText(t,this.canvasText,e.width/2,e.height/2,150)},wrapText(e,t,n,s,o){let i=s;const a=t.split(" ");let r="";const l=e.measureText("M").width*1.2;for(let c=0;c<a.length;c++){const u=`${r+a[c]} `;e.measureText(u).width>o&&c>0?(e.fillText(r,n,i),r=`${a[c]} `,i+=l):r=u}e.fillText(r,n,i)},drawImage(){const{canvas:e}=this.$refs,t=e.getContext("2d");t.clearRect(0,0,e.width,e.height),t.drawImage(this.originalImage,0,0)},openFilePicker(){this.$refs.imageLoaderInput.click()},uploadImage(e){const t=e.target.files[0],{canvas:n}=this.$refs;if(t){const s=new FileReader;s.onload=o=>{this.originalImage=new Image,this.originalImage.onload=()=>{n.width=this.originalImage.width+10,n.height=this.originalImage.height+10,this.drawImage()},this.originalImage.src=o.target.result,this.updateImageZoom(),this.resetImagePositionAndZoom()},s.readAsDataURL(t)}},uploadImageDrop(e){const{canvas:t}=this.$refs;if(e){const n=new FileReader;n.onload=s=>{this.originalImage=new Image,this.originalImage.onload=()=>{t.width=this.originalImage.width+10,t.height=this.originalImage.height+10,this.drawImage()},this.originalImage.src=s.target.result,this.updateImageZoom(),this.resetImagePositionAndZoom()},n.readAsDataURL(e)}},handleImageDrop(e){e.preventDefault();const t=e.dataTransfer.files[0];this.uploadImageDrop(t),this.hovering=!1},handleDragOver(e){e.preventDefault(),this.hovering=!0},handleDragLeave(){this.hovering=!1},toggleMoveMode(){this.originalImage&&(this.moveMode=!this.moveMode)},handleMouseDown(e){this.moveMode&&(this.isMoving=!0,this.cStartX=e.clientX,this.cStartY=e.clientY)},handleMouseMove(e){if(!(!this.moveMode||!this.isMoving)){if(this.cStartX!==void 0&&this.cStartY!==void 0){const t=e.clientX-this.cStartX,n=e.clientY-this.cStartY;this.canvasX+=t,this.canvasY+=n,this.$refs.canvas.style.transform=`translate(${this.canvasX}px, ${this.canvasY}px)`,this.cStartX=e.clientX,this.cStartY=e.clientY}}},handleMouseUp(){this.isMoving=!1,this.cStartX=void 0,this.cStartY=void 0},zoomIn(){this.zoomValue+=.025,this.updateImageZoom()},zoomOut(){this.zoomValue-=.025,this.updateImageZoom()},resetImagePositionAndZoom(){this.moveMode=!1,this.zoomValue=this.defaultZoomValue,this.updateImageZoom()},updateImageZoom(){if(this.originalImage){const e=this.$refs.zoomControl;e.style.transform=`scale(${this.zoomValue})`,e.style.transformOrigin="0 0"}},async captureScreenshot(){const e=this.$refs["vascular-image-div"];bi(e,{logging:!1,scale:3}).then(t=>{const n=t.toDataURL("image/png");this.$emit("screenshot-captured",this.id,n)}).catch(t=>{console.error("Error capturing screenshot:",t)})}},mounted(){if(this.setupCanvas(),this.addBar){const e=new Image;e.src=this.addBar,e.onload=()=>{this.$refs.barGraphLegend.src=e.src}}},watch:{editable(){this.moveMode&&(this.moveMode=!this.moveMode,this.handleMouseUp())}}},Dn=e=>(re("data-v-3e2c92d2"),e=e(),le(),e),M1={key:0,class:"buttons"},B1={class:"upload-button",title:"Upload File",alt:"Upload File",style:{position:"relative"}},A1=Dn(()=>g("i",{class:"fas fa-upload fa-lg",style:{color:"#ffffff"}},null,-1)),F1=[A1],N1={key:0,class:"move-button",title:"Move",alt:"Move",style:{position:"relative"}},$1=Dn(()=>g("i",{class:"fas fa-arrows fa-lg",style:{color:"#ffffff"}},null,-1)),U1=[$1],H1={key:1,class:"zoom-in-button",title:"Zoom In",alt:"Zoom In",style:{position:"relative"}},W1=Dn(()=>g("i",{class:"fas fa-search-plus fa-lg",style:{color:"#ffffff"}},null,-1)),z1=[W1],j1={key:2,class:"zoom-out-button",title:"Zoom Out",alt:"Zoom Out",style:{position:"relative"}},G1=Dn(()=>g("i",{class:"fas fa-search-minus fa-lg",style:{color:"#ffffff"}},null,-1)),X1=[G1],q1={ref:"vascular-image-div"},Y1={key:0,style:{position:"relative"}},K1={style:{"user-select":"none","-webkit-user-drag":"none"},id:"bar-graph-legend-os",ref:"barGraphLegend",alt:"Image Not Loaded"};function Q1(e,t,n,s,o,i){return x(),L("div",{id:"image-container",class:N({moving:o.moveMode,hover:o.hovering}),style:ne({height:n.height+"px",width:n.width+"pt"}),onDragenter:t[8]||(t[8]=(...a)=>i.handleDragOver&&i.handleDragOver(...a)),onDragover:t[9]||(t[9]=(...a)=>i.handleDragOver&&i.handleDragOver(...a)),onDrop:t[10]||(t[10]=(...a)=>i.handleImageDrop&&i.handleImageDrop(...a)),onDragleave:t[11]||(t[11]=(...a)=>i.handleDragLeave&&i.handleDragLeave(...a))},[n.editable?(x(),L("div",M1,[g("div",B1,[g("button",{class:"upload-buttons upload-image",onClick:t[0]||(t[0]=(...a)=>i.openFilePicker&&i.openFilePicker(...a))},F1),g("input",{type:"file",ref:"imageLoaderInput",name:"imageLoader",style:{display:"none"},accept:"image/*",onChange:t[1]||(t[1]=(...a)=>i.uploadImage&&i.uploadImage(...a)),"aria-labelledby":"hiddenImageInputinReport"},null,544)]),o.originalImage?(x(),L("div",N1,[g("button",{class:N(["upload-buttons",{moving:o.moveMode}]),style:{left:"50px"},onClick:t[2]||(t[2]=(...a)=>i.toggleMoveMode&&i.toggleMoveMode(...a))},U1,2)])):j("",!0),o.originalImage?(x(),L("div",H1,[g("button",{class:"upload-buttons",style:{left:"90px"},onClick:t[3]||(t[3]=(...a)=>i.zoomIn&&i.zoomIn(...a))},z1)])):j("",!0),o.originalImage?(x(),L("div",j1,[g("button",{class:"upload-buttons",style:{left:"130px"},onClick:t[4]||(t[4]=(...a)=>i.zoomOut&&i.zoomOut(...a))},X1)])):j("",!0)])):j("",!0),g("div",q1,[n.addBar?(x(),L("div",Y1,[g("img",K1,null,512)])):j("",!0),g("div",{style:ne({height:n.height+"px",width:n.width+"pt"}),ref:"zoomControl"},[g("canvas",{ref:"canvas",id:"vascular-image",onMousedown:t[5]||(t[5]=(...a)=>i.handleMouseDown&&i.handleMouseDown(...a)),onMousemove:t[6]||(t[6]=(...a)=>i.handleMouseMove&&i.handleMouseMove(...a)),onMouseup:t[7]||(t[7]=(...a)=>i.handleMouseUp&&i.handleMouseUp(...a))},null,544)],4)],512)],38)}const Z1=A(k1,[["render",Q1],["__scopeId","data-v-3e2c92d2"]]);const J1={props:{id:{type:String,required:!1},values:{type:Array,required:!0}},data(){return{outerradius:85/2-1,LAD:null,LCX:null,RCA:null}},watch:{values(){this.setValues(),this.createChart()}},mounted(){this.setValues(),this.createChart()},methods:{setValues(){[this.LAD,this.LCX,this.RCA]=this.values},createChart(){const e=this.$refs.chartCanvas,t=e.getContext("2d");e.width=85,e.height=85;const n=e.width/2,s=e.height/2,o=this.outerradius,i=o/4;t.clearRect(0,0,e.width,e.height);const a=this.getColors([this.RCA,this.LAD,this.LCX]),r=[1,1,1],l=r.reduce((u,d)=>u+d,0);let c=0;r.forEach((u,d)=>{const h=u/l*Math.PI*2,v=c+h;t.beginPath(),t.moveTo(n+o*Math.cos(c),s+o*Math.sin(c)),t.arc(n,s,o,c,v),t.arc(n,s,i,v,c,!0),t.closePath(),t.fillStyle=a[d],t.fill(),t.lineWidth=.5,t.strokeStyle="black",t.stroke(),c=v}),t.beginPath(),t.arc(n,s,o,0,Math.PI*2),t.strokeStyle="#00000",t.lineWidth=0,t.stroke(),t.beginPath(),t.arc(n,s,i,0,Math.PI*2),t.strokeStyle="#00000",t.lineWidth=0,t.stroke()},numberToColorGradient(e){let t=e;t=t.toString().replace(/%/g,"");const n=[{color:[1,25,242],minPercentage:0,maxPercentage:.23},{color:[0,227,252],minPercentage:.23,maxPercentage:.45},{color:[44,246,91],minPercentage:.45,maxPercentage:.6},{color:[252,208,13],minPercentage:.6,maxPercentage:.75},{color:[255,16,1],minPercentage:.75,maxPercentage:1}];t=Math.min(Math.max(Number(t),-20),20);const s=(t+20)/40;let o,i;for(let u=0;u<n.length;u++)if(s>=n[u].minPercentage&&s<=n[u].maxPercentage){o=n[u],i=n[u+1];break}i||(o=n[n.length-2],i=n[n.length-1]);const a=(s-o.minPercentage)/(i.maxPercentage-o.minPercentage),r=Math.round(o.color[0]+a*(i.color[0]-o.color[0])),l=Math.round(o.color[1]+a*(i.color[1]-o.color[1])),c=Math.round(o.color[2]+a*(i.color[2]-o.color[2]));return`rgb(${r}, ${l}, ${c})`},getColors(e){return[this.numberToColorGradient(e[0]),this.numberToColorGradient(e[1]),this.numberToColorGradient(e[2])]}}},ey={style:{position:"relative"}},ty={ref:"chartCanvas"},ny={style:{position:"absolute",color:"rgb(255, 255, 255)",top:"10px",left:"14px",width:"38px",height:"20px","text-align":"center"}},oy={style:{position:"absolute",color:"rgb(255, 255, 255)",top:"55px",left:"12px",width:"38px",height:"20px","text-align":"center"}},iy={style:{position:"absolute",color:"rgb(255, 255, 255)",top:"32px",left:"52px",width:"35px",height:"20px","text-align":"center"}};function ay(e,t,n,s,o,i){return x(),L("div",ey,[g("canvas",ty,null,512),g("div",ny,[g("h5",null,U(o.LAD),1)]),g("div",oy,[g("h5",null,U(o.RCA),1)]),g("div",iy,[g("h5",null,U(o.LCX),1)])])}const sy=A(J1,[["render",ay],["__scopeId","data-v-4c39254e"]]);const ry={props:{id:{type:String,required:!0},propValue:{type:String,required:!0,default:"00"},editable:{type:Boolean,default:!0}},data(){return{editing:0,editedValue:this.propValue}},methods:{stopEditing(){this.$emit("updateValue",this.id,this.editedValue)},updateProp(e){this.editedValue=e.target.value}},watch:{editable(){this.$refs.inputField.readOnly=!this.editable}},mounted(){this.editable||(this.$refs.inputField.readOnly=!0)}},ly=["value"];function cy(e,t,n,s,o,i){return x(),L("input",{value:n.propValue,onInput:t[0]||(t[0]=(...a)=>i.updateProp&&i.updateProp(...a)),onBlur:t[1]||(t[1]=(...a)=>i.stopEditing&&i.stopEditing(...a)),ref:"inputField",class:N({edit:n.editable})},null,42,ly)}const uy=A(ry,[["render",cy],["__scopeId","data-v-e918b819"]]);const dy={props:{id:{type:String,required:!0},propValue:{type:String,required:!0,default:"00"},placeholder:{type:String,default:""},editable:{type:Boolean,default:!0}},data(){return{editing:0,editedValue:this.propValue}},methods:{stopEditing(){this.$emit("updateValue",this.id,this.editedValue)},updateProp(e){this.editedValue=e.target.value}},mounted(){this.editable||(this.$refs.inputField.readOnly=!0)},watch:{editable(){this.$refs.inputField.readOnly=!this.editable}}},hy=["value","placeholder"];function gy(e,t,n,s,o,i){return x(),L("textarea",{value:n.propValue,onInput:t[0]||(t[0]=(...a)=>i.updateProp&&i.updateProp(...a)),onBlur:t[1]||(t[1]=(...a)=>i.stopEditing&&i.stopEditing(...a)),ref:"inputField",class:N({edit:n.editable,noedit:!n.editable}),placeholder:n.placeholder,"aria-labelledby":"textAreaInReportEditable"},null,42,hy)}const fy=A(dy,[["render",gy],["__scopeId","data-v-ab34c9dc"]]);const py={components:{ReportLogoHolder:T1,ReportDropDown:P1,ReportImageContainer:Z1,ReportStrainMaps:sy,ReportTextBox:uy,ReportTextBoxMultiple:fy},props:{editable:{type:Boolean,required:!0,default:!0}},data(){return{genderOptions:[{value:"Female",label:"Female"},{value:"Male",label:"Male"},{value:"Other",label:"Other"}],completeDataOptions:[{value:"Yes",label:"Yes"},{value:"No",label:"No"}],imageQualityOptions:[{value:"Excellent",label:"Excellent"},{value:"Good",label:"Good"},{value:"OK",label:"OK"},{value:"Bad",label:"Bad"}],OS_REPORT_VALUES:{reportTitle:"BE-OS CMR Report",reportLogo:null,patientName:"PATIENT NAME",patientGender:"",patientAge:"00",patientDOB:"DD-Mon-YYYY",patientID:"123 456 789",rbhNumber:"000 000 000",protocol:"OS C-",scanDate:"DD-Mon-YYYY",scanTime:"00:00",completeData:"",imageQuality:"",reader:"Reader Name, MD",verifier:"Verifier Name, MD",scannerSystem:"Philips Ingenia",fieldStrength:"1.5T",softwareVersion:"5.7.1.3",starClaimer:"*Normal values are continuously being updated, therefore, may be subject to changes",summary:"",heartRateBaseline:"00",heartRateHV:"00",heartRateBH:"00",dtheartrate:"00",dtheartrateNormalRange:">15",vascularGlobal:"00",vascularLAD:"00",vascularLCX:"00",vascularRCA:"00",normalRangeVascular:">9.1",strainLADBaseline:"00",strainLADHV:"00",strainLADBH:"00",strainLCXBaseline:"00",strainLCXHV:"00",strainLCXBH:"00",strainRCABaseline:"00",strainRCAHV:"00",strainRCABH:"00",strainGLOBALBaseline:"00",strainGLOBALHV:"00",strainGLOBALBH:"00",vascularImage:"",strainImage:"",oxygenSensitiveMap:"",strainMapImage:"",strainMapBaseline:"",strainMapHV:"",strainMapBH:"",normalRange:"<-20%"}}},methods:{onOptionSelected(e,t){this.OS_REPORT_VALUES[e]=t},handleLogoUpdate(e){this.OS_REPORT_VALUES.reportLogo=e},handleUpdateValues(e,t){this.OS_REPORT_VALUES[e]=t},downloadReport(){this.buildPDF()},async getImage(e){await this.$refs[e].captureScreenshot()},async getImages(){await this.getImage("strainImage"),await this.getImage("vascularImage"),await this.getImage("oxygenSensitiveMap"),await this.captureScreenshot("strainMapImage","territorymapimg"),await this.captureScreenshot("reportLogo","reportLogo")},async captureScreenshot(e,t){const n=this.$refs[t];bi(n,{logging:!1,scale:3}).then(s=>{const o=s.toDataURL("image/png");this.handleImageScreenshot(e,o)}).catch(s=>{console.error("Error capturing screenshot:",s)})},handleImageScreenshot(e,t){this.OS_REPORT_VALUES[e]=t},buildPDF(){const e=this.OS_REPORT_VALUES;window.jsPDF=window.jspdf.jsPDF;const t=cr("p","pt",[612,792]);t.addFont("/fonts/Roboto-Light.ttf","Roboto","normal"),t.addFont("/fonts/arial_italic.ttf","Arial","normal"),t.addFont("/fonts/arial_greek.ttf","ArialGreek","normal"),t.setFont("helvetica","bold"),t.setFontSize(22),t.text(e.reportTitle,42,60),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Patient",42,80),e.reportLogo!=null&&t.addImage(e.reportLogo,"PNG",413,25,150,52.5),t.setFontSize(15),t.setTextColor("#229ED7"),t.text(e.patientName,42,97),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Gender:",43,114),t.setFontSize(10),t.setTextColor("#000917"),t.text(e.patientGender,81,114),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Age:",164,114),t.setFontSize(10),t.setTextColor("#000917"),t.text(e.patientAge,187,114),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("DOB:",269,114),t.setFontSize(10),t.setTextColor("#000917"),t.text(e.patientDOB,294,114),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Patient ID:",410,114),t.setFontSize(10),t.setTextColor("#000917"),t.text(e.patientID,460,114),t.setLineWidth(.1),t.line(577,120,35,122),t.setFontSize(10),t.setTextColor("#5E5D6C"),t.text("Exam",42,148),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("RBH number:",42,162),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.rbhNumber,42,175),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Protocol:",42,189),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.protocol,42,202),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Date:",42,216),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.scanDate,42,229),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Time:",42,243),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.scanTime,42,256),t.setFontSize(10),t.setTextColor("#5E5D6C"),t.text("Scan",42,293),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Complete Data:",42,307),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.completeData,42,320),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Image Quality:",42,334),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.imageQuality,42,347),t.setFontSize(10),t.setTextColor("#5E5D6C"),t.text("Analytical Team",42,383),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Reader:",42,397),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.reader,42,410),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Verified By:",42,424),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.verifier,42,437),t.setFontSize(10),t.setTextColor("#5E5D6C"),t.text("Scanner",42,473),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("System:",42,487),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.scannerSystem,42,500),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Field Strength:",42,514),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.fieldStrength,42,527),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Software Version:",42,541),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.softwareVersion,42,554),t.setTextColor("#5E5D6C"),t.setFont("helvetica","normal"),t.setFont("Arial"),this.processSentences(e.starClaimer,120,t,42,594),t.text("For research use only.",42,760),t.setFont("helvetica","bold"),t.setFontSize(12),t.setTextColor("#5E5D6C"),t.text("SUMMARY",170,148),t.setFillColor("#f8f8f8"),t.setDrawColor(255,255,255),t.roundedRect(166,155,425,110,10,10,"FD"),t.setFontSize(9),t.setTextColor("#000917"),this.processSentences(e.summary,380,t,178,170),t.setFillColor("#f8f8f8"),t.setDrawColor(255,255,255),t.roundedRect(166,270,425,500,10,10,"FD"),t.setFillColor("#e0e0e0"),t.setDrawColor(255,255,255),t.roundedRect(176,275,405,55,5,5,"FD"),t.setFontSize(10),t.setTextColor("#000917"),t.text("Heart Rate",186,305),t.text("Normal Range",186,320),t.text(e.heartRateBaseline,286,305),t.text(e.heartRateHV,379,305),t.text(e.heartRateBH,440,305),t.text(e.dtheartrate,520,305),t.text(e.dtheartrateNormalRange,520,320),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("BASELINE",286,290),t.text("HV",379,290),t.text("BH @ 30 SEC",440,290),t.setFont("helvetica","normal"),t.setFont("ArialGreek"),t.text("Δ",520,290),t.setFont("helvetica","bold"),t.text("HR",530,290),t.setFillColor("#e0e0e0"),t.setDrawColor(255,255,255),t.roundedRect(176,350,200,75,5,5,"FD"),t.roundedRect(381,350,200,75,5,5,"FD"),t.setFontSize(12),t.text("VASCULAR",180,345),t.text("STRAIN",385,345),t.setFontSize(8),t.text("B-MORE",185,365),t.setTextColor("#000917"),t.setFontSize(9),t.text("Global",185,380),t.text("LAD",185,392),t.text("LCX",185,404),t.text("RCA",185,415),t.text(e.vascularGlobal,230,380),t.text("*Normal Range: ",260,380),t.text(e.normalRangeVascular,330,380),t.text(e.vascularLAD,230,392),t.text(e.vascularLCX,230,404),t.text(e.vascularRCA,230,415),t.setFontSize(8),t.setTextColor("#5E5D6C"),t.text("B-MORE",390,365),t.text("BASELINE",435,365),t.text("HV",485,365),t.text("BH @ 30 SEC",522,365),t.setFontSize(9),t.setTextColor("#000917"),t.text("Global",390,380),t.text("LAD",390,392),t.text("LCX",390,404),t.text("RCA",390,415),t.text(e.strainGLOBALBaseline,435,380),t.text(e.strainGLOBALHV,485,380),t.text(e.strainGLOBALBH,523,380),t.text(e.strainLADBaseline,435,392),t.text(e.strainLADHV,485,392),t.text(e.strainLADBH,523,392),t.text(e.strainLCXBaseline,435,404),t.text(e.strainLCXHV,485,404),t.text(e.strainLCXBH,523,404),t.text(e.strainRCABaseline,435,415),t.text(e.strainRCAHV,485,415),t.text(e.strainRCABH,523,415),t.roundedRect(176,430,200,187.5,0,0,"FD"),t.roundedRect(381,430,200,187.5,0,0,"FD"),t.setFontSize(12),t.setTextColor("#000917"),t.text("Oxygen Sensitive Map",210,635),t.text("STRAIN MAPS",382,635),t.setFontSize(8),t.setTextColor("#5E5D6C"),t.text("BASELINE",390,753),t.text("HYPER-",467,748),t.text("VENTILATION",455,758),t.text("BREATH-",535,743),t.text("HOLD",540,753),t.text("(30 sec)",537,763),t.setFillColor("#e0e0e0"),t.setDrawColor(255,255,255),t.roundedRect(375,715,75,25,7,7,"FD"),t.setFontSize(9),t.setTextColor("#000917"),t.text("Normal Range: ",380,724.5),t.text(e.normalRange,380,734.5),t.addImage(e.strainImage,"PNG",381,430,200,187.5),t.addImage(e.vascularImage,"PNG",176,430,200,187.5),t.addImage(e.oxygenSensitiveMap,"PNG",201,650,150,112.5),t.addImage(e.strainMapImage,"PNG",376,645,210,70);const n=new Date().toLocaleDateString("en-US");t.save(`Area19_Report_${e.patientName}_${n}.pdf`)},processSentences(e,t,n,s,o){function i(u){const d=document.createElement("span");d.style.font="10px Arial",d.style.position="absolute",d.style.visibility="hidden",d.textContent=u,document.body.appendChild(d);const{width:h}=d.getBoundingClientRect();return document.body.removeChild(d),h}let a=e.trim().split(new RegExp("(?<=[.!?])|\\n"));a=a.map(u=>u.replace(/\n/g,""));function r(u,d){const h=u.split(" "),v=[];let p=h[0];for(let f=1;f<h.length;f++){const m=`${p} ${h[f]}`;i(m)<=d?p=m:(v.push(p),p=h[f])}return v.push(p),v}let l=0,c=o;a.forEach(u=>{i(u)>t?r(u,t).forEach(h=>{l>0&&(c+=14),n.text(h,s,c),l++}):(l>0&&(c+=14),n.text(u,s,c),l++)})}},watch:{OS_REPORT_VALUES:{handler(){window.localStorage.setItem("reportValues",JSON.stringify(this.OS_REPORT_VALUES))},deep:!0},editable(){this.editable||this.getImages()}}},q=e=>(re("data-v-d503f07e"),e=e(),le(),e),my={class:"print-area"},vy={id:"report-element",class:"report-element"},yy={class:"row1"},wy={ref:"reportLogo"},Sy={class:"row2"},_y=q(()=>g("h5",null,"Patient",-1)),Cy={class:"row3",style:{"border-bottom":"1px solid black"}},by={id:"gender",style:{display:"flex",gap:"5px"}},Ty=q(()=>g("h5",null,"Gender:",-1)),Iy={class:"below"},xy={class:"left-column"},Ry={class:"Exam"},Dy=q(()=>g("h4",{style:{"margin-bottom":"5px"}},"Exam",-1)),Ly=q(()=>g("h5",{style:{height:"15px"}},"RBH number:",-1)),Ey=q(()=>g("h5",{style:{height:"15px"}},"Protocol:",-1)),Oy=q(()=>g("h5",{style:{height:"15px"}},"Date:",-1)),Vy=q(()=>g("h5",{style:{height:"15px"}},"Time:",-1)),Py={class:"Scan"},ky=q(()=>g("h4",{style:{"margin-bottom":"5px"}},"Scan",-1)),My=q(()=>g("h5",null,"Complete Data:",-1)),By=q(()=>g("h5",null,"Image Quality:",-1)),Ay={class:"Technologist"},Fy=q(()=>g("h4",{style:{"margin-bottom":"10px"}},"Analytical Team",-1)),Ny=q(()=>g("h5",{style:{height:"15px"}},"Reader:",-1)),$y=q(()=>g("h5",{style:{height:"15px"}},"Verified by:",-1)),Uy={class:"Scanner"},Hy=q(()=>g("h4",{style:{"margin-bottom":"10px"}},"Scanner",-1)),Wy=q(()=>g("h5",{style:{height:"15px"}},"System:",-1)),zy=q(()=>g("h5",{style:{height:"15px"}},"Field Strength:",-1)),jy=q(()=>g("h5",{style:{height:"15px"}},"Software Version:",-1)),Gy={class:"Scanner"},Xy=q(()=>g("div",null,[g("h5",{style:{width:"150px","font-style":"italic"}}," For research use only. ")],-1)),qy={class:"right-column"},Yy={class:"summary"},Ky=q(()=>g("h4",{style:{height:"15px"}},"SUMMARY",-1)),Qy={class:"detailed-report"},Zy={class:"overview"},Jy=q(()=>g("div",{class:"labels"},[g("br"),g("h5",{style:{width:"120px"}},"Heart Rate"),g("h5",{style:{width:"120px"}},"Normal Range")],-1)),ew={class:"baselinevals"},tw=q(()=>g("h5",{style:{color:"#5e5d6c"}},"BASELINE",-1)),nw={class:"hyperventvals"},ow=q(()=>g("h5",{style:{color:"#5e5d6c"}},"HV",-1)),iw={class:"BHvals"},aw=q(()=>g("h5",{style:{color:"#5e5d6c",width:"90px"}},"BH @ 30 SEC",-1)),sw={class:"baselinevals"},rw=q(()=>g("h5",{style:{color:"#5e5d6c"}},"Δ HR",-1)),lw={class:"overview_middle"},cw={class:"col"},uw=q(()=>g("h4",null,"VASCULAR",-1)),dw={class:"vals"},hw={class:"valuesOCG",style:{"padding-left":"10px","padding-top":"10px"}},gw=q(()=>g("h6",{style:{"margin-bottom":"10px","padding-left":"5px"}}," B-MORE ",-1)),fw={style:{display:"flex",position:"relative"}},pw={style:{position:"absolute",left:"80px",width:"190px"}},mw={style:{"margin-left":"25px"}},vw={class:"col",style:{"margin-left":"2%"}},yw=q(()=>g("h4",null,"STRAIN",-1)),ww={class:"vals"},Sw={class:"valuesSTRAIN"},_w=q(()=>g("div",{class:"strain-containter"},[g("h6",null,"B-MORE"),g("h5",null,"Global"),g("h5",null,"LAD"),g("h5",null,"LCX"),g("h5",null,"RCA")],-1)),Cw={class:"strain-containter"},bw=q(()=>g("h6",null,"BASELINE",-1)),Tw={class:"strain-containter"},Iw=q(()=>g("h6",{style:{"padding-left":"8%"}},"HV",-1)),xw={class:"strain-containter"},Rw=q(()=>g("h6",null,"BH @ 30 SEC",-1)),Dw={class:"overview_graphs"},Lw={style:{display:"flex","flex-direction":"column","align-items":"center",width:"278px"}},Ew=q(()=>g("h4",{style:{color:"black"}},"Oxygen Sensitive Map",-1)),Ow={class:"strainmaps"},Vw=q(()=>g("h4",{style:{color:"black"}},"STRAIN MAPS",-1)),Pw={class:"territorymaps",ref:"territorymapimg"},kw={style:{"margin-right":"auto","background-color":"#8f8f8f3b",width:"90px",padding:"2px","padding-left":"5px","border-radius":"10px"}},Mw=q(()=>g("div",{class:"mapnames"},[g("h5",null,"BASELINE"),g("h5",null,"HYPER-VENTILATION"),g("h5",null,[H(" BREATH-HOLD "),g("br"),H(" (30 sec) ")])],-1));function Bw(e,t,n,s,o,i){const a=P("ReportTextBox"),r=P("ReportLogoHolder"),l=P("ReportDropDown"),c=P("ReportTextBoxMultiple"),u=P("ReportImageContainer"),d=P("ReportStrainMaps");return x(),L("div",my,[g("div",vy,[g("div",yy,[y(a,{id:"reportTitle",editable:n.editable,propValue:o.OS_REPORT_VALUES.reportTitle,onUpdateValue:i.handleUpdateValues,style:{width:"450px",color:"#000000","font-weight":"bold","font-size":"30px",height:"40px",padding:"0%"}},null,8,["editable","propValue","onUpdateValue"]),g("div",wy,[y(r,{editable:n.editable,onImageUpdated:i.handleLogoUpdate},null,8,["editable","onImageUpdated"])],512)]),g("div",Sy,[_y,y(a,{id:"patientName",editable:n.editable,propValue:o.OS_REPORT_VALUES.patientName,onUpdateValue:i.handleUpdateValues,style:{width:"650px",color:"#229ed7","font-weight":"500","font-size":"30px",height:"35px",padding:"0%"}},null,8,["editable","propValue","onUpdateValue"])]),g("div",Cy,[g("div",by,[Ty,y(l,{editable:n.editable,id:"patientGender",options:o.genderOptions,onOptionSelected:i.onOptionSelected},null,8,["editable","options","onOptionSelected"])]),g("div",null,[g("h5",null,[H(" Age: "),y(a,{id:"patientAge",editable:n.editable,propValue:o.OS_REPORT_VALUES.patientAge,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"])])]),g("div",null,[g("h5",null,[H(" DOB: "),y(a,{id:"patientDOB",editable:n.editable,propValue:o.OS_REPORT_VALUES.patientDOB,onUpdateValue:i.handleUpdateValues,style:{width:"120px"}},null,8,["editable","propValue","onUpdateValue"])])]),g("div",null,[g("h5",null,[H(" Patient ID: "),y(a,{id:"patientID",editable:n.editable,propValue:o.OS_REPORT_VALUES.patientID,onUpdateValue:i.handleUpdateValues,style:{width:"110px"}},null,8,["editable","propValue","onUpdateValue"])])])]),g("div",Iy,[g("div",xy,[g("div",Ry,[Dy,Ly,y(a,{id:"rbhNumber",editable:n.editable,propValue:o.OS_REPORT_VALUES.rbhNumber,onUpdateValue:i.handleUpdateValues,style:{width:"110px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"]),Ey,y(a,{id:"protocol",editable:n.editable,propValue:o.OS_REPORT_VALUES.protocol,onUpdateValue:i.handleUpdateValues,style:{width:"110px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"]),Oy,y(a,{id:"scanDate",editable:n.editable,propValue:o.OS_REPORT_VALUES.scanDate,onUpdateValue:i.handleUpdateValues,style:{width:"110px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"]),Vy,y(a,{id:"scanTime",editable:n.editable,propValue:o.OS_REPORT_VALUES.scanTime,onUpdateValue:i.handleUpdateValues,style:{width:"110px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"])]),g("div",Py,[ky,My,y(l,{id:"completeData",editable:n.editable,options:o.completeDataOptions,onOptionSelected:i.onOptionSelected},null,8,["editable","options","onOptionSelected"]),By,y(l,{id:"imageQuality",editable:n.editable,options:o.imageQualityOptions,onOptionSelected:i.onOptionSelected},null,8,["editable","options","onOptionSelected"])]),g("div",Ay,[Fy,Ny,y(a,{id:"reader",editable:n.editable,propValue:o.OS_REPORT_VALUES.reader,onUpdateValue:i.handleUpdateValues,style:{width:"150px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"]),$y,y(a,{id:"verifier",editable:n.editable,propValue:o.OS_REPORT_VALUES.verifier,onUpdateValue:i.handleUpdateValues,style:{width:"150px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"])]),g("div",Uy,[Hy,Wy,y(a,{id:"scannerSystem",editable:n.editable,propValue:o.OS_REPORT_VALUES.scannerSystem,onUpdateValue:i.handleUpdateValues,style:{width:"150px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"]),zy,y(a,{id:"fieldStrength",editable:n.editable,propValue:o.OS_REPORT_VALUES.fieldStrength,onUpdateValue:i.handleUpdateValues,style:{width:"100px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"]),jy,y(a,{id:"softwareVersion",editable:n.editable,propValue:o.OS_REPORT_VALUES.softwareVersion,onUpdateValue:i.handleUpdateValues,style:{width:"100px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"])]),g("div",Gy,[y(c,{id:"starClaimer",editable:n.editable,propValue:o.OS_REPORT_VALUES.starClaimer,onUpdateValue:i.handleUpdateValues,style:{width:"170px",height:"120px",padding:"0px","padding-top":"5px","font-style":"italic"}},null,8,["editable","propValue","onUpdateValue"])]),Xy]),g("div",qy,[g("div",Yy,[Ky,y(c,{id:"summary",editable:n.editable,propValue:o.OS_REPORT_VALUES.summary,placeholder:"Type Summary Here...",onUpdateValue:i.handleUpdateValues,style:{width:"100%",padding:"10px 10px",height:"190px","font-size":"14px",color:"black","background-color":"#f8f8f8"}},null,8,["editable","propValue","onUpdateValue"])]),g("div",Qy,[g("div",Zy,[Jy,g("div",ew,[tw,y(a,{id:"heartRateBaseline",editable:n.editable,propValue:o.OS_REPORT_VALUES.heartRateBaseline,onUpdateValue:i.handleUpdateValues,style:{width:"60px","padding-left":"0px","font-size":"14px"}},null,8,["editable","propValue","onUpdateValue"])]),g("div",nw,[ow,y(a,{id:"heartRateHV",editable:n.editable,propValue:o.OS_REPORT_VALUES.heartRateHV,onUpdateValue:i.handleUpdateValues,style:{width:"60px","padding-left":"0px","font-size":"14px"}},null,8,["editable","propValue","onUpdateValue"])]),g("div",iw,[aw,y(a,{id:"heartRateBH",editable:n.editable,propValue:o.OS_REPORT_VALUES.heartRateBH,onUpdateValue:i.handleUpdateValues,style:{width:"60px","padding-left":"0px","font-size":"14px"}},null,8,["editable","propValue","onUpdateValue"])]),g("div",sw,[rw,y(a,{id:"dtheartrate",editable:n.editable,propValue:o.OS_REPORT_VALUES.dtheartrate,onUpdateValue:i.handleUpdateValues,style:{width:"60px","padding-left":"0px","font-size":"14px"}},null,8,["editable","propValue","onUpdateValue"]),y(a,{id:"dtheartrateNormalRange",editable:n.editable,propValue:o.OS_REPORT_VALUES.dtheartrateNormalRange,onUpdateValue:i.handleUpdateValues,style:{width:"60px","padding-left":"0px","font-size":"14px"}},null,8,["editable","propValue","onUpdateValue"])])]),g("div",lw,[g("div",cw,[uw,g("div",dw,[g("div",hw,[gw,g("div",fw,[g("h5",null,[H(" Global "),y(a,{id:"vascularGlobal",editable:n.editable,propValue:o.OS_REPORT_VALUES.vascularGlobal,onUpdateValue:i.handleUpdateValues,style:{"margin-left":"12px","padding-left":"4%"}},null,8,["editable","propValue","onUpdateValue"])]),g("div",pw,[g("h5",mw,[H(" *Normal Range: "),y(a,{id:"normalRangeVascular",editable:n.editable,propValue:o.OS_REPORT_VALUES.normalRangeVascular,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"])])])]),g("h5",null,[H(" LAD "),y(a,{id:"vascularLAD",editable:n.editable,propValue:o.OS_REPORT_VALUES.vascularLAD,onUpdateValue:i.handleUpdateValues,style:{"margin-left":"24.5px"}},null,8,["editable","propValue","onUpdateValue"])]),g("h5",null,[H(" LCX "),y(a,{id:"vascularLCX",editable:n.editable,propValue:o.OS_REPORT_VALUES.vascularLCX,onUpdateValue:i.handleUpdateValues,style:{"margin-left":"25.5px"}},null,8,["editable","propValue","onUpdateValue"])]),g("h5",null,[H(" RCA "),y(a,{id:"vascularRCA",editable:n.editable,propValue:o.OS_REPORT_VALUES.vascularRCA,onUpdateValue:i.handleUpdateValues,style:{"margin-left":"23px"}},null,8,["editable","propValue","onUpdateValue"])])])]),y(u,{id:"vascularImage",ref:"vascularImage",editable:n.editable,"add-bar":"./images/bar.png",onScreenshotCaptured:i.handleImageScreenshot},null,8,["editable","add-bar","onScreenshotCaptured"])]),g("div",vw,[yw,g("div",ww,[g("div",Sw,[_w,g("div",Cw,[bw,y(a,{id:"strainGLOBALBaseline",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainGLOBALBaseline,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),y(a,{id:"strainLADBaseline",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainLADBaseline,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),y(a,{id:"strainLCXBaseline",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainLCXBaseline,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),y(a,{id:"strainRCABaseline",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainRCABaseline,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"])]),g("div",Tw,[Iw,y(a,{id:"strainGLOBALHV",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainGLOBALHV,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),y(a,{id:"strainLADHV",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainLADHV,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),y(a,{id:"strainLCXHV",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainLCXHV,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),y(a,{id:"strainRCAHV",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainRCAHV,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"])]),g("div",xw,[Rw,y(a,{id:"strainGLOBALBH",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainGLOBALBH,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),y(a,{id:"strainLADBH",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainLADBH,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),y(a,{id:"strainLCXBH",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainLCXBH,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),y(a,{id:"strainRCABH",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainRCABH,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"])])])]),y(u,{id:"strainImage",ref:"strainImage",editable:n.editable,onScreenshotCaptured:i.handleImageScreenshot},null,8,["editable","onScreenshotCaptured"])])]),g("div",Dw,[g("div",Lw,[Ew,y(u,{id:"oxygenSensitiveMap",ref:"oxygenSensitiveMap",editable:n.editable,width:150,height:150,canvasText:"Upload OS-Map",onScreenshotCaptured:i.handleImageScreenshot},null,8,["editable","onScreenshotCaptured"])]),g("div",Ow,[Vw,g("div",Pw,[y(d,{id:"strainMapBaseline",values:[o.OS_REPORT_VALUES.strainLADBaseline,o.OS_REPORT_VALUES.strainLCXBaseline,o.OS_REPORT_VALUES.strainRCABaseline]},null,8,["values"]),y(d,{id:"strainMapHV",values:[o.OS_REPORT_VALUES.strainLADHV,o.OS_REPORT_VALUES.strainLCXHV,o.OS_REPORT_VALUES.strainRCAHV]},null,8,["values"]),y(d,{id:"strainMapBH",values:[o.OS_REPORT_VALUES.strainLADBH,o.OS_REPORT_VALUES.strainLCXBH,o.OS_REPORT_VALUES.strainRCABH]},null,8,["values"])],512),g("div",null,[g("p",kw,[H(" Normal Range: "),y(a,{id:"normalRange",editable:n.editable,propValue:o.OS_REPORT_VALUES.normalRange,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"])])]),Mw])])])])])])])}const Aw=A(py,[["render",Bw],["__scopeId","data-v-d503f07e"]]);const Fw={components:{Report:Aw},methods:{printReport(){this.$refs.editablereport.buildPDF()},handleEdit(){this.edit=!this.edit},handleSave(){this.edit?(this.showPopup=!0,setTimeout(()=>{this.showPopup=!1},3e3)):this.$refs.editablereport.downloadReport()}},data(){return{edit:!0,showPopup:!1}}},an=e=>(re("data-v-d6cad36d"),e=e(),le(),e),Nw={class:"reportcontainermain"},$w={class:"reporthere"},Uw={class:"toolbar"},Hw=an(()=>g("h1",null,"Edit",-1)),Ww=[Hw],zw=an(()=>g("button",{class:"tool"},[g("h1",null,"Share")],-1)),jw=an(()=>g("h1",null,"Print",-1)),Gw=[jw],Xw={style:{position:"relative"}},qw=an(()=>g("h1",null,"Save",-1)),Yw=[qw],Kw=an(()=>g("h5",null,"Please stop editing first.",-1)),Qw=[Kw];function Zw(e,t,n,s,o,i){const a=P("Report");return x(),L("div",Nw,[g("div",$w,[y(a,{ref:"editablereport",editable:o.edit},null,8,["editable"])]),g("div",Uw,[g("button",{class:N(["tool",{clicked:o.edit}]),onClick:t[0]||(t[0]=(...r)=>i.handleEdit&&i.handleEdit(...r))},Ww,2),zw,g("button",{class:"tool",onClick:t[1]||(t[1]=(...r)=>i.printReport&&i.printReport(...r))},Gw),g("div",Xw,[g("button",{class:"tool",onClick:t[2]||(t[2]=(...r)=>i.handleSave&&i.handleSave(...r))},Yw),g("div",{class:N(["popup",{show:o.showPopup}])},Qw,2)])])])}const Jw=A(Fw,[["render",Zw],["__scopeId","data-v-d6cad36d"]]);const eS={props:{dataToGraph:{type:Array}},watch:{dataToGraph:{deep:!0,handler(){this.drawLines()}}},data(){return{canvasId:"myCanvas",minX:0,minY:0,maxX:15,maxY:1,unitsPerTickX:5,unitsPerTickY:.25,title:"Normalized SI (RV-LV)",padding:15,tickSize:.1,axisColor:"white",pointRadius:1,font:"10pt Arial",fontHeight:10,rangeX:null,rangeY:null,numXTicks:null,numYTicks:null,x:null,y:null,width:null,height:null,scaleX:null,scaleY:null,context:null,data:null}},methods:{drawSysDias(e,t){const n=e;n.save(),n.translate(this.x,this.y+this.height),n.font="12px Arial",n.fillStyle="white",n.fillText("Systole",0*this.scaleX,0-(this.height+this.padding));const s=n.createLinearGradient(t*this.scaleX,0,this.maxX*this.scaleX-50,0);s.addColorStop(0,"rgba(38, 151, 192, 0.25)"),s.addColorStop(1,"#686F7100"),n.fillStyle=s,n.fillRect(t*this.scaleX,0,this.maxX*this.scaleX,0-(this.height+2*this.padding)),n.strokeStyle="white",n.lineWidth=1,n.beginPath(),n.moveTo(t*this.scaleX,0),n.lineTo(t*this.scaleX,0-(this.height+2*this.padding)),n.stroke(),n.fillStyle="white",n.fillText("Diastole",t*this.scaleX+5,0-(this.height+this.padding)),n.restore()},getLongestValueWidth(e){let t=0;const n=e;n.font=this.font;for(let s=0;s<=this.numYTicks;s++){const o=this.maxY-s*this.unitsPerTickY;t=Math.max(t,n.measureText(o).width)}return t},drawXAxis(e){const t=e;t.save(),t.beginPath(),t.moveTo(this.x,this.y+this.height),t.strokeStyle=this.axisColor,t.lineWidth=1,t.stroke(),t.font=this.font,t.fillStyle="white",t.textAlign="center",t.textBaseline="middle";for(let n=-1;n<this.numXTicks;n++){const s=Math.round((n+1)*this.maxX/this.numXTicks);t.save(),t.translate((n+1)*this.width/this.numXTicks+this.x,this.y+this.height+this.padding),t.fillText(s,0,0),t.restore()}t.restore()},drawYAxis(e){const t=e;t.save(),t.save(),t.beginPath(),t.moveTo(this.x,this.y),t.strokeStyle=this.axisColor,t.stroke(),t.restore(),t.font=this.font,t.fillStyle="white",t.textAlign="right",t.textBaseline="middle";for(let n=0;n<=this.numYTicks;n++){const s=this.maxY-n*this.maxY/this.numYTicks;t.save(),t.translate(this.x-this.padding+5,n*this.height/this.numYTicks+this.y),t.fillText(s,0,0),t.restore()}t.restore()},drawLine(e,t,n,s){const o=e;o.save(),this.transformContext(o),o.lineWidth=s,o.strokeStyle=n,o.fillStyle=n,o.shadowBlur=10,o.shadowColor=n,o.beginPath(),o.moveTo(t[0].x*this.scaleX,t[0].y*this.scaleY);for(let i=0;i<t.length;i++){const a=t[i];o.lineTo(a.x*this.scaleX,a.y*this.scaleY),o.stroke(),o.closePath(),o.beginPath(),o.arc(a.x*this.scaleX,a.y*this.scaleY,this.pointRadius,0,2*Math.PI,!1),o.fill(),o.closePath(),o.beginPath(),o.moveTo(a.x*this.scaleX,a.y*this.scaleY)}o.restore()},transformContext(e){e.translate(this.x,this.y+this.height),e.scale(1,-1)},generateRandomData(e){const t=[];for(let n=0;n<=e;n++){const s=n*1,o=Math.random();t.push({x:s,y:o})}return t},drawLines(){const{context:e}=this;e.clearRect(0+this.padding,this.y-2*this.padding,this.width+4*this.padding,this.height+4*this.padding);const t=["#a2191a","#105a93","#1f7c55"];for(let n=0;n<this.dataToGraph.length;n++)this.dataToGraph[n]===1&&this.drawLine(e,this.data[n],t[n],2);this.drawSysDias(e,7.5),this.drawXAxis(e),this.drawYAxis(e)}},mounted(){const{canvas:e}=this.$refs,t=e.getContext("2d");this.x=this.getLongestValueWidth(t)+this.padding*2+25,this.context=t,this.y=this.padding*2,this.width=e.width-this.x-this.padding*2,this.height=e.height-this.y-this.padding-this.fontHeight,this.rangeX=this.maxX-this.minY,this.scaleX=this.width/this.rangeX,this.rangeY=this.maxY-this.minY,this.scaleY=this.height/this.rangeY,this.numXTicks=Math.round(this.rangeX/this.unitsPerTickX),this.numYTicks=Math.round(this.rangeY/this.unitsPerTickY),this.drawXAxis(t),this.drawYAxis(t),t.save(),t.translate(10,this.height/1.5),t.rotate(270*Math.PI/180),t.font="12px Arial",t.fillStyle="white",t.textAlign="center",t.textBaseline="middle",t.fillText(this.title,0,0),t.restore(),this.drawSysDias(t,7.5);const n=[this.generateRandomData(15),this.generateRandomData(15),this.generateRandomData(15)];this.data=n,this.drawLines()}},tS={ref:"canvas",width:"411",height:"206",style:{}};function nS(e,t,n,s,o,i){return x(),L("div",null,[g("canvas",tS,null,512)])}const oS=A(eS,[["render",nS],["__scopeId","data-v-01332437"]]),iS={props:{id:{type:Number,required:!0}},data(){return{sectionOpacities:[.7,.7,.7],hoveredSection:-1,outerradius:60}},mounted(){this.createChart()},methods:{createChart(){const e=this.$refs.chartCanvas,t=e.getContext("2d"),n=e.width/2-85,s=e.height/2,o=this.outerradius,i=o/3;t.clearRect(0,0,e.width,e.height),e.addEventListener("click",this.handleChartClick),e.addEventListener("mousemove",this.handleChartHover),e.addEventListener("mouseleave",this.handleChartLeave),e.addEventListener("dblclick",this.handleChartDoubleClick);const a=["#a2191a","#105a93","#1f7c55"],r=[1,1,1],l=r.reduce((u,d)=>u+d,0);let c=0;r.forEach((u,d)=>{const h=u/l*Math.PI*2,v=c+h;t.beginPath(),t.moveTo(n+o*Math.cos(c),s+o*Math.sin(c)),t.arc(n,s,o,c,v),t.arc(n,s,i,v,c,!0),t.closePath();const p=this.hoveredSection===d?this.sectionOpacities[d]+.3:this.sectionOpacities[d];t.globalAlpha=p,t.fillStyle=a[d],t.fill(),t.globalAlpha=1,t.strokeStyle="#ffffff",t.lineWidth=2,t.stroke(),c=v}),t.beginPath(),t.arc(n,s,o,0,Math.PI*2),t.strokeStyle="#ffffff",t.lineWidth=1,t.stroke(),t.beginPath(),t.arc(n,s,i,0,Math.PI*2),t.strokeStyle="#ffffff",t.lineWidth=1,t.stroke()},handleChartClick(e){const t=this.$refs.chartCanvas,n=t.getBoundingClientRect(),s=e.clientX-n.left,o=e.clientY-n.top,i=t.width/2-85,a=t.height/2,r=this.outerradius,l=r/3,c=Math.sqrt((s-i)**2+(o-a)**2);if(c<l)this.sectionOpacities=[.7,.7,.7];else{if(c>=r)return;{const u=Math.atan2(o-a,s-i),d=u>=0?u:u+Math.PI*2,h=Math.floor(d/(Math.PI*2)*3);this.sectionOpacities[h]=this.sectionOpacities[h]===.7?.2:.7}}this.createChart(),this.$emit("segment-updated",this.id,this.sectionOpacities)},handleChartDoubleClick(e){const t=this.$refs.chartCanvas,n=t.getBoundingClientRect(),s=e.clientX-n.left,o=e.clientY-n.top,i=t.width/2-85,a=t.height/2,r=this.outerradius,l=r/3,c=Math.sqrt((s-i)**2+(o-a)**2);if(c<l)this.sectionOpacities=[.7,.7,.7];else{if(c>=r)return;{const u=Math.atan2(o-a,s-i),d=u>=0?u:u+Math.PI*2,h=Math.floor(d/(Math.PI*2)*3);this.sectionOpacities=[.2,.2,.2],this.sectionOpacities[h]=.7}}this.createChart(),this.$emit("segment-updated",this.id,this.sectionOpacities)},handleChartHover(e){const t=this.$refs.chartCanvas,n=t.getBoundingClientRect(),s=e.clientX-n.left,o=e.clientY-n.top,i=t.width/2-85,a=t.height/2,r=this.outerradius,l=r/3,c=Math.sqrt((s-i)**2+(o-a)**2);if(c<l)this.hoveredSection=-1;else if(c>=r){this.handleChartLeave();return}else{const u=Math.atan2(o-a,s-i),d=u>=0?u:u+Math.PI*2,h=Math.floor(d/(Math.PI*2)*3);this.hoveredSection=h}this.createChart()},handleChartLeave(){this.hoveredSection=-1,this.createChart()}}},aS={ref:"chartCanvas"};function sS(e,t,n,s,o,i){return x(),L("div",null,[g("canvas",aS,null,512)])}const rS=A(iS,[["render",sS]]);const lS={props:{label:{type:String,default:"Territory Min"},textOpacity:{type:Number,default:1}},updated(){},data(){return{setTextOpacity:this.textOpacity}},methods:{handleMouseEnter(){this.setTextOpacity+=.3},handleMouseLeave(){this.setTextOpacity-=.3},handleClick(){this.$emit("biomarker-click",this.label)}}};function cS(e,t,n,s,o,i){return x(),L("div",null,[g("h4",{onMouseenter:t[0]||(t[0]=(...a)=>i.handleMouseEnter&&i.handleMouseEnter(...a)),onFocusin:t[1]||(t[1]=(...a)=>i.handleMouseEnter&&i.handleMouseEnter(...a)),onMouseleave:t[2]||(t[2]=(...a)=>i.handleMouseLeave&&i.handleMouseLeave(...a)),onFocusout:t[3]||(t[3]=(...a)=>i.handleMouseLeave&&i.handleMouseLeave(...a)),onClick:t[4]||(t[4]=(...a)=>i.handleClick&&i.handleClick(...a)),style:ne({opacity:o.setTextOpacity}),onKeydown:t[5]||(t[5]=ke(ie((...a)=>e.handleKeyDown&&e.handleKeyDown(...a),["prevent"]),["space"]))},U(n.label),37)])}const uS=A(lS,[["render",cS],["__scopeId","data-v-65722d25"]]);const dS={components:{SimpleGraph:oS,TerritoriesSegments:rS,GraphTerritories:uS},data(){return{canGraph:[{id:1,allowed:[1,1,1]},{id:2,allowed:[1,1,1]},{id:3,allowed:[1,1,1]}],itemHeight:510,showComponent:[1,1,1],territoryGraphs:[{id:1,title:"Territory Min",opacity:.3},{id:2,title:"Territory Absolute Velocity",opacity:.3},{id:3,title:"Territory Median",opacity:.3},{id:4,title:"Sector Median",opacity:.3},{id:5,title:"Sector Max",opacity:.3},{id:6,title:"Sector Min",opacity:.3}]}},methods:{handleSegmentUpdate(e,t){for(let n=0;n<3;n++)this.canGraph[e-1].allowed[n]=t[n]>.5},scrollX(e,t){const n=`scrollContainer${t}`;this.$refs[n].scrollLeft+=e.deltaY/10},handleToggleMarker(e){console.log(e),this.showComponent[e]=!1,this.showComponent[e]=!0}}},So=e=>(re("data-v-e71c7254"),e=e(),le(),e),hS={class:"biomarkerviewer"},gS={class:"biomarkercomponent"},fS={class:"graphs"},pS=So(()=>g("div",{class:"headertitle"},[g("h2",null,"ANALYSIS")],-1)),mS={class:"content"},vS={class:"left"},yS={class:"right"},wS={key:0},SS={class:"biomarkercomponent"},_S={class:"graphs"},CS=So(()=>g("h2",null,"ANALYSIS",-1)),bS={class:"content"},TS={class:"left"},IS={class:"right"},xS={key:0},RS={class:"biomarkercomponent"},DS={class:"graphs"},LS=So(()=>g("h2",null,"ANALYSIS",-1)),ES={class:"content"},OS={class:"left"},VS={class:"right"},PS={key:0};function kS(e,t,n,s,o,i){const a=P("ScreenTemp"),r=P("GraphTerritories"),l=P("TerritoriesSegments"),c=P("SimpleGraph");return x(),L("div",hS,[g("div",gS,[g("div",{class:"screen1",style:ne({height:o.itemHeight+"px"})},[y(a)],4),g("div",fS,[pS,g("div",{class:"territoryGraphs",ref:"scrollContainer0",onMousewheel:t[1]||(t[1]=u=>i.scrollX(u,0))},[(x(!0),L(se,null,Pe(o.territoryGraphs,u=>(x(),L("div",{key:u.id},[y(r,{id:u.id,label:u.title,textOpacity:u.opacity,onBiomarkerClick:t[0]||(t[0]=d=>i.handleToggleMarker(0))},null,8,["id","label","textOpacity"])]))),128))],544),g("div",mS,[g("div",vS,[y(l,{id:1,onSegmentUpdated:i.handleSegmentUpdate},null,8,["onSegmentUpdated"])]),g("div",yS,[y(Ae,{name:"fade"},{default:R(()=>[o.showComponent[0]?(x(),L("div",wS,[y(c,{dataToGraph:o.canGraph[0].allowed},null,8,["dataToGraph"])])):j("",!0)]),_:1})])])])]),g("div",SS,[g("div",{class:"screen1",style:ne({height:o.itemHeight+"px"})},[y(a)],4),g("div",_S,[CS,g("div",{class:"territoryGraphs",ref:"scrollContainer1",onMousewheel:t[3]||(t[3]=u=>i.scrollX(u,1))},[(x(!0),L(se,null,Pe(o.territoryGraphs,u=>(x(),L("div",{key:u.id},[y(r,{id:u.id,label:u.title,textOpacity:u.opacity,onBiomarkerClick:t[2]||(t[2]=d=>i.handleToggleMarker(1))},null,8,["id","label","textOpacity"])]))),128))],544),g("div",bS,[g("div",TS,[y(l,{id:2,onSegmentUpdated:i.handleSegmentUpdate},null,8,["onSegmentUpdated"])]),g("div",IS,[y(Ae,{name:"fade"},{default:R(()=>[o.showComponent[1]?(x(),L("div",xS,[y(c,{dataToGraph:o.canGraph[1].allowed},null,8,["dataToGraph"])])):j("",!0)]),_:1})])])])]),g("div",RS,[g("div",{class:"screen1",style:ne({height:o.itemHeight+"px"})},[y(a)],4),g("div",DS,[LS,g("div",{class:"territoryGraphs",ref:"scrollContainer2",onMousewheel:t[5]||(t[5]=u=>i.scrollX(u,2))},[(x(!0),L(se,null,Pe(o.territoryGraphs,u=>(x(),L("div",{key:u.id},[y(r,{label:u.title,textOpacity:u.opacity,onBiomarkerClick:t[4]||(t[4]=d=>i.handleToggleMarker(2))},null,8,["label","textOpacity"])]))),128))],544),g("div",ES,[g("div",OS,[y(l,{id:3,onSegmentUpdated:i.handleSegmentUpdate},null,8,["onSegmentUpdated"])]),g("div",VS,[y(Ae,{name:"fade"},{default:R(()=>[o.showComponent[2]?(x(),L("div",PS,[y(c,{dataToGraph:o.canGraph[2].allowed},null,8,["dataToGraph"])])):j("",!0)]),_:1})])])])])])}const MS=A(dS,[["render",kS],["__scopeId","data-v-e71c7254"]]);const BS={components:{PatientHeaderInfo:$v,AnalysisNavigationBar:i0,VtkTwoView:gs,QualityCheck:S1,ReportMaker:Jw,GraphicalAnalysis:MS},data(){return{container:"container",currentComponent:"QualityCheck"}},methods:{getTimeOfDay(){const e=new Date().getHours();return e>=5&&e<12?"Morning":e>=12&&e<18?"Afternoon":e>=18&&e<23?"Evening":"Day"},handleToolSelected(e){e==="ReportMaker"?this.currentComponent="ReportMaker":e==="QualityCheck"?this.currentComponent="QualityCheck":e==="GraphicalAnalysis"&&(this.currentComponent="GraphicalAnalysis"),window.localStorage.setItem("currentView",this.currentComponent)},handleUpdateQualityCheck(e){e?this.$refs.mainAnalysisComponent.toggleComponent("CheckContours"):this.$refs.mainAnalysisComponent.toggleComponent("CheckBreathingSplits")}},created(){this.timeofday=this.getTimeOfDay(),this.container=`${this.container} ${this.timeofday.toLowerCase()}`},mounted(){this.currentComponent=window.localStorage.getItem("currentView")}},vs=e=>(re("data-v-a9c51548"),e=e(),le(),e),AS=vs(()=>g("div",{class:"mobile-overlay"},[g("div",{class:"warning"},[g("h2",null,[H(" It appears that you are trying to use our app on a screen size of less than 1200 px wide. "),g("br"),H(" Currently our app is limited to larger devices. Please try on a larger laptop. ")])])],-1)),FS={class:"body"},NS={class:"navigationBar"},$S={class:"header-main"},US={class:"header"},HS={class:"main"},WS=vs(()=>g("h5",{style:{"margin-left":"auto",color:"grey"}}," Area 19 OCG Prototype V.0.1 ",-1));function zS(e,t,n,s,o,i){const a=P("AnalysisNavigationBar"),r=P("PatientHeaderInfo");return x(),L(se,null,[AS,g("div",{class:N(o.container)},[g("div",FS,[g("div",NS,[y(a,{onToolSelected:i.handleToolSelected},null,8,["onToolSelected"])]),g("div",$S,[g("div",US,[y(r,{activeComponent:o.currentComponent,onUpdatequalitycheck:i.handleUpdateQualityCheck},null,8,["activeComponent","onUpdatequalitycheck"])]),g("div",HS,[y(Ae,{name:"fade"},{default:R(()=>[(x(),K(Ci(o.currentComponent),{ref:"mainAnalysisComponent"},null,512))]),_:1})]),WS])])],2)],64)}const jS=A(BS,[["render",zS],["__scopeId","data-v-a9c51548"]]),GS=[{path:"/",redirect:"/login"},{path:"/login",name:"Login",component:bc},{path:"/home",name:"Home",component:hv},{path:"/analysis",name:"Analysis",component:jS}],XS=ur({history:dr(),routes:GS});lc();Kt.setResolveCoincidentTopologyToPolygonOffset();Kt.setResolveCoincidentTopologyPolygonOffsetParameters(-3,-3);Kt.setResolveCoincidentTopologyLineOffsetParameters(-3,-3);Fi.setResolveCoincidentTopologyToPolygonOffset();Fi.setResolveCoincidentTopologyPolygonOffsetParameters(1,1);Dl(Wn);const ys=sl.newInstance({proxyConfiguration:jl}),ws=new Ni;ws.initialize();const Ss=hr();Ss.use(sc({proxies:new rc(ys),dicomIO:ws}));const dt=gr(cl);uc(dt);dt.provide("ProxyManager",ys);dt.use(Ss);dt.use(fr);dt.use(Tr);dt.use(pr,{smallLaptop:1200,mediumLaptop:1300,largerLaptop:1400,xLargeLaptop:1600,desktop:1900,_4K:2500});dt.use(XS).mount("#app");
//# sourceMappingURL=index-fe362582.js.map
