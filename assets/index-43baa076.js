import{aw as q,aK as D,b0 as Y,b1 as M,b2 as ga,b3 as Oo,b4 as Ye,b5 as Ci,b6 as bi,b7 as Di,b8 as pa,af as fa,A as pe,b9 as Z,ba as Ii,bb as Ti,aN as Un,az as V,as as N,bc as xi,aL as x,bd as u,be as F,bf as X,aU as Ue,bg as mn,bh as $,bi as vt,bj as Se,bk as oe,bl as ae,bm as L,aO as ne,bn as fe,bo as j,aD as w,bp as Je,bq as C,br as ma,ak as Me,a6 as yt,ao as T,bs as Lt,bt as va,bu as Li,bv as Ri,bw as ki,bx as Mi,by as Ei,an as Ve,aI as Pi,aB as U,u as lt,bz as Vt,H as ya,bA as Ne,bB as wt,E as Oi,n as Ai,Y as Bi,I as Vi,B as $i,aj as Ao,bC as De,aE as Jt,aq as ie,aQ as se,aC as Gn,aA as Rt,bD as z,ap as ge,bE as St,bF as wa,bG as He,aH as Ee,aF as Fi,K as Jn,ay as Zn,bH as Sa,aY as Ht,bI as _a,bJ as Ni,bK as Hi,bL as zi,bM as Ca,bN as Wi,V as ji,bO as Ui,bP as Gi,bQ as Xi,bR as Ki,aG as qi,bS as Yi,aZ as Ji,bT as Zi,aS as _e,bU as Qi,bV as wn,aM as kt,bW as er,bX as Bo,bY as tr,bZ as Vo,b_ as $o,b$ as nr,c0 as or,c1 as ar,aT as sr,c2 as ir,c3 as rr,c4 as lr,c5 as cr,c6 as dr,c7 as ur}from"./vendor-0d601a45.js";import{_ as A,E as Qn,V as _t,a as ba,b as mt,c as gn,d as $t,e as Fo,f as Xn,g as Da,h as Ia,i as Zt,u as Ta,j as Ct,k as No,l as hr,m as gr,n as pr,o as fr,p as xa,q as La,r as pt,s as Ho,T as Sn,t as zt,v as et,w as Re,x as mr,y as vr,z as yr,A as Fn,B as wr,C as Sr}from"./vuetify-ec25be11.js";import{v as _r,a as Ra,m as _,b as Cr,c as br,d as Dr,I as Ir,e as Tr,f as xr,g as Lr,h as ke,i as Rr,j as kr,k as Mr,l as Er,n as tt,o as Pr,p as Or,C as Ar,q as Br,D as Vr,R as $r,r as eo,s as ka,t as _n,u as Ge,w as pn,x as Ma,y as Ea,z as Fr,A as Nr,V as Qe,B as Hr,E as Cn,_ as zr,F as Pa,G as Oa,H as Wr,J as jr,K as bn,L as Aa,M as Ur,N as Ba,O as Gr,P as Qt,Q as Va,S as zo,T as Xr,U as Wo,W as jo,X as Kr,Y as qr,Z as Yr,$ as Jr,a0 as Zr,a1 as Qr,a2 as el,a3 as tl,a4 as $a,a5 as nl}from"./vtk.js-bd03a6e8.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();const ol=q({name:"App",components:{}});function al(e,t,n,s,o,a){const i=M("router-view");return D(),Y(i)}const sl=A(ol,[["render",al]]);function il(e){const t=e.split(/\/+/g);return t.splice(-1,1),t.join("/")}function rl(e){return e.split(/\/+/g).at(-1)??e}function bt(e){return e.replace(/\/+/g,"/").replace(/\/$/,"")}function Dt(...e){return bt(e.join("/"))}function Kn(e){return e.replace(/\//g,"_")}function Uo(e){return new File([e],Kn(e.name))}class Fa{constructor(){this.webWorker=null,this.initializeCheck=null}async runTask(t,n,s,o){return ga(this.webWorker,t,n,o,s,Dt("/","/itk/pipelines"),Dt("/","/itk/pipeline.worker.js"))}async initialize(){return this.initializeCheck||(this.initializeCheck=new Promise((t,n)=>{this.runTask("dicom",[],[],[]).then(s=>{s.webWorker?this.webWorker=s.webWorker:n(new Error("Could not initialize webworker"))}).then(async()=>{try{await Oo(this.webWorker,new File([],""),null)}catch{}t()}).catch(n)})),this.initializeCheck}async categorizeFiles(t){await this.initialize();const n=await Promise.all(t.map(async(l,c)=>{const d=await l.arrayBuffer();return{type:Ye.BinaryFile,data:{path:c.toString(),data:new Uint8Array(d)}}})),s=["--action","categorize","--memory-io","0","--files",...n.map(l=>l.data.path)],o=[{type:Ye.TextStream}],a=await this.runTask("dicom",s,n,o),i=JSON.parse(a.outputs[0].data.data);return Object.fromEntries(Object.entries(i).map(([l,c])=>[l,c.map(d=>t[parseInt(d,10)])]))}async readTags(t,n){const s=n.map(i=>i.tag),a=(await Oo(this.webWorker,Uo(t),s)).tags;return n.reduce((i,r)=>{const{tag:l,name:c}=r;return a.has(l)?{...i,[c]:a.get(l)}:i},{})}async getVolumeSlice(t,n=!1){await this.initialize();const s=await t.arrayBuffer(),o=[{type:Ye.BinaryFile,data:{path:Kn(t.name),data:new Uint8Array(s)}}],a=["--action","getSliceImage","--thumbnail",n.toString(),"--file",Kn(t.name),"--memory-io","0"],i=[{type:Ye.Image}];return(await this.runTask("dicom",a,o,i)).outputs[0].data}async resample(t,n){await this.initialize();const{size:s,spacing:o,origin:a,direction:i}=t,r=["--action","resample","0","--size",s.join(","),"--spacing",o.join(","),"--origin",a.join(","),"--direction",i.join(","),"--memory-io","0"],l=[{type:Ye.Image,data:n}],c=[{type:Ye.Image}];return(await this.runTask("dicom",r,l,c)).outputs[0].data}async buildImage(t){return await this.initialize(),(await Ci(t.map(s=>Uo(s)))).image}}const Wt={vti:"application/vnd.unknown.vti",vtp:"application/vnd.unknown.vtp",stl:"model/stl",dcm:"application/dicom",zip:"application/zip",json:"application/json",gipl:"application/vnd.unknown.gipl","gipl.gz":"application/vnd.unknown.gipl",hdf5:"application/x-hdf5",jpg:"image/jpeg",jpeg:"image/jpeg",lsm:"application/vnd.unknown.lsm",mnc:"application/vnd.unknown.minc","mnc.gz":"application/vnd.unknown.minc",mnc2:"application/vnd.unknown.minc",mgh:"application/vnd.unknown.mgh",mgz:"application/vnd.unknown.mgh","mgh.gz":"application/vnd.unknown.mgh",mha:"application/vnd.unknown.metaimage",mhd:"application/vnd.unknown.metaimage",mrc:"application/vnd.unknown.mrc",nia:"application/vnd.unknown.nifti-1",nii:"application/vnd.unknown.nifti-1","nii.gz":"application/vnd.unknown.nifti-1",hdr:"application/vnd.unknown.nifti-1",nrrd:"application/vnd.unknown.nrrd",nhdr:"application/vnd.unknown.nrrd",png:"image/png",pic:"application/vnd.unknown.biorad",tif:"image/tiff",tiff:"image/tiff",vtk:"application/vnd.unknown.vtk",isq:"application/vnd.unknown.scanco",fdf:"application/vnd.unknown.fdf"},Go=new Set(Object.keys(Wt)),Xo=new Set(Object.values(Wt)),Na=new Set(["application/zip"]),Ko=[{mime:"application/dicom",skip:128,header:Array.from("DICM").map(e=>e.charCodeAt(0))}],ll=512;function cl(e,t){if(t.length>e.length)return!1;for(let n=0;n<t.length;n+=1)if(t[n]!==e[n])return!1;return!0}async function dl(e){return new Promise(t=>{const n=e.slice(0,ll),s=new FileReader;s.onload=()=>{const o=new Uint8Array(s.result);for(let a=0;a<Ko.length;a+=1){const{mime:i,header:r,skip:l=0}=Ko[a];if(cl(o.slice(l),r)){t(i);return}}t(null)},s.readAsArrayBuffer(n)})}async function Ha(e){const t=e.type.toLowerCase();if(Xo.has(t))return t;if(Go.has(t))return Wt[t];const n=[...Go].find(o=>e.name.toLowerCase().endsWith(`.${o}`));if(n)return Wt[n];const s=await dl(e);return s&&Xo.has(s)?s:null}async function ul(e){const t=await Ha(e)??"";return new File([e],e.name,{type:t.toLowerCase()})}async function hl(e,t){return new Promise(n=>{const s=new globalThis.FileReader;if(s.onload=()=>n(s.result),t==="ArrayBuffer")s.readAsArrayBuffer(e);else if(t==="Text")s.readAsText(e);else throw new TypeError(`readAs${t} is not a function`)})}async function gl(e){return hl(e,"ArrayBuffer")}const qn=new Map;function za(e){return e}function Wa(){let e=null,t=null;const n=a=>{e&&e(a)},s=a=>{t&&t(a)};return{promise:new Promise((a,i)=>{e=a,t=i}),resolve:n,reject:s}}function jt(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}function ja(e,t,n){return Math.min(n,Math.max(t,e))}function qo(e,...t){return t.reduce((n,s)=>({...n,[s]:e[s]}),{})}function Dn(e,t){const n=[[],[]];return t.forEach(s=>{const o=e(s)?0:1;n[o].push(s)}),n}const pl=(e,t,n)=>(e in t||(t[e]=n),t[e]);function to(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function fl(e,t=Qn){const n=Math.round(e);return Math.abs(n-e)<=t?n:e}function ml(e){return e instanceof Error?e:new Error(JSON.stringify(e))}function vl(e){if(!e)return"#ffffff";const t=document.createElement("canvas").getContext("2d");if(!t)throw new Error("Could not create canvas context");return t.fillStyle=e,t.fillStyle}class Ua{constructor(t){this.msgID=0,this.worker=t,this.waiting={},this.worker.onmessage=this.handleMessage.bind(this)}postMessage(t,n=[]){const s={id:this.msgID,message:t},o=Wa();return this.waiting[s.id]=o,this.worker.postMessage(s,n),this.msgID+=1,o.promise}handleMessage(t){const{id:n,error:s,message:o}=t.data;if(n in this.waiting){const a=this.waiting[n];delete this.waiting[n],s?a.reject(new Error(s)):a.resolve(o)}}}const no=e=>async t=>{const s=await new Ua(new Worker(new URL("/assets/async.reader.worker-f0ea3ad1.js",self.location),{type:"module"})).postMessage({file:t,readerName:e});if(s.status==="success")return _r(s.obj);throw s.error},yl=e=>async t=>{const s=await new Ua(new Worker(new URL("/assets/async.writer.worker-42a67950.js",self.location),{type:"module"})).postMessage({obj:t.getState(),writerName:e});if(s.status==="success")return s.data;throw s.error},wl=no("stl"),Ga=no("vti"),Sl=no("vtp"),_l=yl("vti"),Cl=Array.from(new Set(Array.from(bi.keys()).map(e=>Wt[e.toLowerCase()])));Ra.setReadImageArrayBufferFromITK(Di);async function bl(e){const t=await gl(e),n=Ra.newInstance();n.setFileName(e.name);try{await n.parseAsArrayBuffer(t)}catch{throw new Error("Failed to parse file")}return n.getOutputData()}function Dl(e){e.set("application/vnd.unknown.vti",Ga),e.set("application/vnd.unknown.vtp",Sl),e.set("model/stl",wl),Cl.forEach(t=>{e.set(t,bl)})}function Xa(e,t){const n=_.debounce(t.renderWindow.render,5);e.resize=()=>{if(t.container){const i=t.container.getBoundingClientRect();if(i.width===i.height&&i.width===0)return;const r=window.devicePixelRatio||1,l=Math.max(10,Math.floor(r*i.width)),c=Math.max(10,Math.floor(r*i.height));t.renderWindow.getViews()[0].setSize(l,c),e.invokeResize({width:l,height:c}),e.render(!0)}},e.render=(i=!0)=>{t.orientationWidget.updateMarkerOrientation(),i?t.renderWindow.render():n()};let s=null;e.renderLater=()=>{s==null&&(s=setTimeout(()=>{e.render(),s=null},0))},e.removeAllRepresentations=()=>{t.representations.forEach(i=>t.renderer.removeViewProp(i)),t.representations.length=0},e.updateCamera=(i,r,l)=>{const c=pa(l);fa(c,c,i),t.camera.setFocalPoint(...l),t.camera.setPosition(...c),t.camera.setDirectionOfProjection(...i),t.camera.setViewUp(...r)};const{setContainer:o}=e;e.setContainer=i=>{o(i),t.cornerAnnotation.setContainer(null)};const{resetCamera:a}=e;e.resetCamera=(...i)=>{a(i),t.renderer.updateLightsGeometryToFollowCamera()}}function Il(e,t){t.classHierarchy.push("vtkLPSView3DProxy"),Xa(e,t)}function Ka(e,t,n={}){Object.assign(t,n),Cr.extend(e,t,n),Il(e,t)}const Tl=_.newInstance(Ka,"vtkLPSView3DProxy"),xl={newInstance:Tl,extend:Ka};function Ll(e,t){t.classHierarchy.push("vtkLPSView2DProxy");const n={...e};Xa(e,t),e.bindRepresentationToManipulator=()=>{},e.resetCamera=(s=null)=>{t.renderer.resetCamera(s)},e.addRepresentation=s=>{s&&(t.representations.indexOf(s)===-1&&(t.representations.push(s),t.renderer.addViewProp(s)),s.setSlicingMode&&t.slicingMode&&s.setSlicingMode(t.slicingMode))},e.setSlicingMode=s=>{if(t.axis="IJK".indexOf(s),n.setSlicingMode(s)&&s){let o=t.representations.length;for(;o--;){const a=t.representations[o];a.setSlicingMode&&a.setSlicingMode(s)}}},e.resizeToFit=(s,o,a)=>{const[i,r]=t.renderWindow.getViews()[0].getSize();let l,c;s===0&&o===1?[,c,l]=a:s===0&&o===2?[,l,c]=a:s===1&&o===0?[c,,l]=a:s===1&&o===2?[l,,c]=a:s===2&&o===0?[c,l]=a:s===2&&o===1&&([l,c]=a);const d=i/r,h=l/c;let g=0;d>=h?g=c/2:g=l/2/d,t.camera.setParallelScale(g)}}const Rl={slicingMode:null};function qa(e,t,n={}){Object.assign(t,n,Rl),_.setGet(e,t,["slicingMode"]),br.extend(e,t,n),Ll(e,t)}const kl=_.newInstance(qa,"vtkLPSView2DProxy"),Ml={newInstance:kl,extend:qa},El={X:"I",Y:"J",Z:"K",I:"I",J:"J",K:"K"};function Pl(e,t){t.classHierarchy.push("vtkIJKSliceRepresentationProxy");const n={...e};e.setSlicingMode=s=>n.setSlicingMode(El[s])}const Ol={};function Ya(e,t,n={}){Object.assign(t,Ol,n),Dr.extend(e,t),_.proxyPropertyMapping(e,t,{opacity:{modelKey:"property",property:"opacity"}}),Pl(e,t)}const Al=_.newInstance(Ya,"vtkIJKSliceRepresentationProxy"),Ja={newInstance:Al,extend:Ya},{InterpolationType:Bl}=Ir;function Vl(e,t){t.classHierarchy.push("vtkLabelMapSliceRepProxy");let n=null;t.property.setUseLookupTableScalarRange(!0),t.property.setInterpolationType(Bl.NEAREST),t.mapper.setRelativeCoincidentTopologyPolygonOffsetParameters(-2,-2);let s=null;function o(i){const r=i.getColorMap();if(r===s)return;s=r;const l=Tr.newInstance(),c=xr.newInstance();Object.keys(r).forEach(d=>{const h=Number(d);l.addRGBPoint(h,...r[d].slice(0,3).map(g=>g/255)),c.addPoint(h,r[d][3]/255)}),t.property.setRGBTransferFunction(l),t.property.setScalarOpacity(c)}function a(i){n&&(n.unsubscribe(),n=null),i&&(n=i.onModified(()=>o(i)),o(i))}e.setColorBy=()=>{},e.delete=_.chain(e.delete,()=>{n&&(n.unsubscribe(),n=null)}),t.sourceDependencies.push({setInputData:a})}const $l={};function Za(e,t,n={}){Object.assign(t,$l,n),Ja.extend(e,t),Vl(e,t)}const Fl=_.newInstance(Za,"vtkLabelMapSliceRepProxy"),Nl={newInstance:Fl,extend:Za};function qe(e,t=[],n=[],s={},o={}){return{class:e,options:{links:n,ui:t,...s},props:o}}function Yo(e,t=[],n={}){return qe(e,[],[],t,n)}const Hl={definitions:{Proxy:{LookupTable:qe(Lr,[],[],{presetName:"Default (Cool to Warm)"}),PiecewiseFunction:qe(ke)},Sources:{TrivialProducer:qe(Rr)},Representations:{ImageSlice:qe(Ja),LabelMapSlice:qe(Nl),Volume:qe(kr),Geometry:qe(Mr)},Views:{View3D:Yo(xl),View2D:Yo(Ml)}},representations:{View3D:{vtkImageData:{name:"Volume"},vtkPolyData:{name:"Geometry"}},View2D:{vtkImageData:{name:"ImageSlice"},vtkLabelMap:{name:"LabelMapSlice"}}}};function zl({stencil:e,location:t,slicingIndex:n,indexToWorld:s}){const[o,a]=e.size,i=Math.floor((o-1)/2),r=Math.floor((a-1)/2),l=o+1,c=a+1,d=[],h=[],g={},v=(f,m)=>{const y=`${f},${m}`;if(y in g)return g[y];const I=[...t].map(E=>Math.round(E));n===0?(I[1]+=f-i-.5,I[2]+=m-r-.5):n===1?(I[0]+=f-i-.5,I[2]+=m-r-.5):n===2&&(I[0]+=f-i-.5,I[1]+=m-r-.5);const S=[];pe(S,I,s),d.push(S);const b=d.length-1;return g[y]=b,b},p=(f,m)=>f<0||f>=o||m<0||m>=a?0:e.pixels[m*o+f]||0;for(let f=0;f<c;f++)for(let m=0;m<l;m++){const y=p(m,f)+p(m-1,f)+p(m,f-1)+p(m-1,f-1);if(y>0&&y<4){const I=v(m,f);if(p(m,f)!==p(m,f-1)){const S=v(m+1,f);h.push([I,S])}if(p(m,f)!==p(m-1,f)){const S=v(m,f+1);h.push([I,S])}}}return{points:new Float32Array(d.flat()),lines:new Uint16Array(h.map(([f,m])=>[2,f,m]).flat())}}function Wl(e,t){t.classHierarchy.push("vtkPaintBrushContextRepresentation"),t.internalPolyData=tt.newInstance({mtime:0}),t.internalArrays={points:t.internalPolyData.getPoints(),lines:t.internalPolyData.getLines()},t.pipelines={brush:{source:e,mapper:Pr.newInstance({transformCoordinate:Or.newInstance({coordinateSystem:Ar.WORLD})}),actor:Br.newInstance({pickable:!1,parentProp:e})}};const n=t.pipelines.brush.actor.getProperty();n.setLineWidth(2),n.setColor([1,0,0]),n.setDisplayLocation(Vr.FOREGROUND),n.setRepresentation($r.SURFACE),eo.connectPipeline(t.pipelines.brush),e.addActor(t.pipelines.brush.actor),e.requestData=(s,o)=>{const a=s[0],i=a.getStencil(),r=a.getBrush(),{indexToWorld:l,worldToIndex:c}=t;if(i&&r.getOrigin()){const d=[];pe(d,r.getOrigin(),c);const h=zl({stencil:i,location:d,slicingIndex:t.slicingIndex,indexToWorld:l}),{points:g,lines:v}=t.internalArrays;g.setData(h.points),v.setData(h.lines),t.internalPolyData.modified()}o[0]=t.internalPolyData}}const jl={defaultScale:1,drawBorder:!1,drawFace:!0,worldToIndex:null,indexToWorld:null,slicingIndex:0};function Qa(e,t,n={}){Object.assign(t,jl,n),Er.extend(e,t,n),_.setGet(e,t,["slicingIndex","indexToWorld","worldToIndex"]),_.get(e,t,["mapper","actor"]),Wl(e,t)}const Ul=_.newInstance(Qa,"vtkPaintBrushContextRepresentation"),Gl={newInstance:Ul,extend:Qa};function Nn(e){return e.altKey||e.controlKey||e.shiftKey}function Xl(e,t){t.classHierarchy.push("vtkPaintWidgetProp"),_.setGet(e,t,["manipulator"]);let n=!1;e.handleLeftButtonPress=s=>{if(!t.manipulator||Nn(s))return _.VOID;const o=t.manipulator.handleEvent(s,t._apiSpecificRenderWindow);return o?(t.widgetState.getBrush().setOrigin(...o),n=!0,e.invokeStartInteractionEvent(),_.EVENT_ABORT):_.VOID},e.handleMouseMove=s=>{if(Nn(s))return _.VOID;const o=t.manipulator.handleEvent(s,t._apiSpecificRenderWindow);return o?(t.widgetState.getBrush().setOrigin(...o),n&&e.invokeInteractionEvent(),_.EVENT_ABORT):_.VOID},e.handleLeftButtonRelease=s=>!n||Nn(s)?_.VOID:(n=!1,e.invokeEndInteractionEvent(),_.EVENT_ABORT),e.handleMouseWheel=()=>n?_.EVENT_ABORT:_.VOID,e.grabFocus=()=>{t.hasFocus||(t.hasFocus=!0,t._interactor.requestAnimation(e))},e.loseFocus=()=>{t.hasFocus&&t._interactor.cancelAnimation(e),t.hasFocus=!1}}function Kl(){return ka.createBuilder().addStateFromMixin({labels:["brush"],name:"brush",mixins:["origin","scale1","visible","color"],initialValues:{scale1:1,origin:null,visible:!0}}).addField({name:"stencil",initialValue:null}).build()}function ql(e,t){t.classHierarchy.push("vtkPaintWidget"),t.methodsToLink=["slicingIndex","indexToWorld","worldToIndex"],e.getRepresentationsForViewType=()=>[{builder:Gl,labels:["brush"]}],t.manipulator=Ge.newInstance()}const Yl={};function es(e,t,n={}){Object.assign(t,Yl,n),_n.extend(e,t,{...n,behavior:Xl,widgetState:Kl()}),_.get(e,t,["manipulator"]),ql(e,t)}const Jl=_.newInstance(es,"vtkPaintWidget"),Zl={newInstance:Jl,extend:es};function Ql(e,t){const n=new Uint8Array(e*t),s=(m,y)=>{n[m+y*e]=1},o=(m,y,I)=>{const S=I*e+m,b=S+(y-m+1);n.fill(1,S,b)};let a=0,i=0,r=e-1,l=t-1,c=r,d=l;const h=d&1;let g=4*(1-c)*d*d,v=4*(h+1)*c*c,p=g+v+h*c*c,f=0;i+=Math.floor((d+1)/2),l=i-h,c*=8*c,d*=8*d;do o(a,r,i),o(a,r,l),f=2*p,f<=v&&(i++,l--,v+=c,p+=v),(f>=g||2*p>v)&&(a++,r--,g+=d,p+=g);while(a<=r);for(;i-l<t;)s(a-1,i),s(r+1,i++),s(a-1,l),s(r+1,l--);return n}class ec{constructor(){this.size=1,this.scale=[1,1],this.recomputeStencil()}setSize(t){this.size=Math.max(0,t),this.recomputeStencil()}setScale(t){this.scale=t,this.recomputeStencil()}recomputeStencil(){const t=[Math.ceil(this.size*this.scale[0]),Math.ceil(this.size*this.scale[1])];this.cachedStencil={size:t,pixels:Ql(t[0],t[1])}}getStencil(){return this.cachedStencil}}let tc=class{constructor(){this.factory=Zl.newInstance(),this.brush=new ec,this.brushValue=1}updateWidgetStencil(){const t=this.brush.getStencil();this.factory.getWidgetState().setStencil(t)}setBrushSize(t){this.brush.setSize(t),this.updateWidgetStencil()}setBrushScale(t){this.brush.setScale(t),this.updateWidgetStencil()}setBrushValue(t){this.brushValue=t}paintLabelmap(t,n,s,o){const a=this.brush.getStencil(),i=[...s.map(R=>Math.round(R))],r=i[n];i.splice(n,1);let l=[...i];o&&(l=[...o.map(R=>Math.round(R))],l.splice(n,1));const c=t.getPointData().getScalars().getData(),d=t.getDimensions(),h=d[0],g=d[0]*d[1],v=R=>R[0]>=0&&R[1]>=0&&R[2]>=0&&R[0]<d[0]&&R[1]<d[1]&&R[2]<d[2],{pixels:p,size:f}=a,m=Math.floor((f[0]-1)/2),y=Math.floor((f[1]-1)/2),I=[...i],S=[...l],b=[0,0,0],E=[0,0];for(let R=0;R<f[1];R++){const O=R-y,k=R*f[0];for(let H=0;H<f[0];H++){const J=H-m,ee=k+H;if(p[ee]){I[0]=i[0]+J,I[1]=i[1]+O,S[0]=l[0]+J,S[1]=l[1]+O;const B=S[0]-I[0],W=S[1]-I[1];let te=Math.abs(Math.abs(B)>Math.abs(W)?B:W);const be=B/te,me=W/te;for([E[0],E[1]]=I;te-->=0;){if(E.splice(n,0,r),b[0]=Math.round(E[0]),b[1]=Math.round(E[1]),b[2]=Math.round(E[2]),v(b)){const Xe=b[0]+b[1]*h+b[2]*g;c[Xe]=this.brushValue}E.splice(n,1),E[0]+=be,E[1]+=me}}}}t.modified()}};function nc({paint:e,proxies:t,dicomIO:n}={}){const s={$paint:e??new tc,$proxies:t,$dicomIO:n??new Fa};return()=>s}var ts=(e=>(e.Volume="View3D",e.Slice="View2D",e))(ts||{});class oc{constructor(t){this.viewProxies=new Map,this.dataProxies=new Map,this.proxyManager=t}delete(){const t=n=>this.proxyManager.deleteProxy(n);this.viewProxies.forEach(t),this.dataProxies.forEach(t)}createView(t,n){if(this.viewProxies.has(t))throw new Error("Cannot create a view with the same ID");const s=this.proxyManager.createProxy("Views",n,{name:n});return this.viewProxies.set(t,s),s}getView(t){return this.viewProxies.get(t)}removeView(t){const n=this.viewProxies.get(t);n&&(this.proxyManager.deleteProxy(n),this.viewProxies.delete(t))}addData(t,n){if(this.dataProxies.has(t))return;const s=this.proxyManager.createProxy("Sources","TrivialProducer");s.setInputData(n),this.dataProxies.set(t,s)}getData(t){return this.dataProxies.get(t)??null}updateData(t,n){const s=this.dataProxies.get(t);s&&s.setInputData(n)}deleteData(t){const n=this.dataProxies.get(t);if(this.dataProxies.delete(t),n)this.proxyManager.deleteProxy(n);else throw new Error("Did not find proxy for ID")}getDataRepresentationForView(t,n){const s=this.dataProxies.get(t),o=this.viewProxies.get(n);return!s||!o?null:this.proxyManager.getRepresentation(s,o)}}function ac(){const{exitPointerLock:e}=document;document.exitPointerLock=()=>{try{e==null||e.call(document)}catch{}}}const{VITE_SENTRY_DSN:ns}={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},os="error-reporting-off",sc=!!ns,ic=e=>{localStorage.getItem(os)!=="true"&&sc&&Ii({app:e,dsn:ns,integrations:[new Ti],tracesSampleRate:.1,replaysSessionSampleRate:.1,replaysOnErrorSampleRate:1})},rc=()=>{xi(200)};Z("error-reporting",()=>{const e=Un(os,"false"),t=V(e.value==="true");return N(t,()=>{e.value=String(t.value),t.value&&rc()}),{disableReporting:t}});const ut=Z({id:"ocg-app-state",state:()=>({currentDayTime:null,currentBackGroundImage:null,analysisScreenDims:{width:null,height:null},currentUser:V(Un("currentUser","")),currentView:V(Un("currentView","QualityCheck"))}),getters:{timeOfDay(){const e=new Date().getHours();return e>=5&&e<12?"Morning":e>=12&&e<18?"Afternoon":e>=18&&e<23?"Evening":"Day"}},actions:{setUser(e){this.currentUser=e},setView(e){this.currentView=e},setAnalysisSreenDims(e,t){this.analysisScreenDims={width:e,height:t}},logOut(){this.currentDayTime=null,this.currentBackGroundImage=null,this.currentUser=null,this.currentView="QualityCheck"}}}),lc=[{username:"Mitchel",password:"12345"},{username:"Glisant",password:"12345"},{username:"admin",password:"admin123"}];const cc={data(){return{appState:ut(),invalidLogin:!1,loaded:!1,username:null,password:null}},created(){this.timeofday=this.appState.timeOfDay,this.appState.currentUser&&this.$router.push("/home")},mounted(){setTimeout(()=>{this.loaded=!0},100),this.$refs.background.style.backgroundImage=`url('/images/${this.timeofday.toLowerCase()}.jpg')`},methods:{login(e){e.preventDefault(),lc.find(n=>n.username===this.username&&n.password===this.password)?(this.appState.setUser(this.username),this.$router.push("/home")):(this.invalidLogin=!0,setTimeout(()=>{this.invalidLogin=!1},2e3))},signup(e){e.preventDefault(),this.appState.setUser("GUEST USER"),this.$router.push("/home")},handleFocus(){this.invalidLogin=!1}}},en=e=>(oe("data-v-46423e3a"),e=e(),ae(),e),dc={class:"container",ref:"background"},uc=en(()=>u("h4",null,"Sign into your account",-1)),hc={for:"username"},gc=en(()=>u("p",null,"Username not found",-1)),pc=[gc],fc={for:"password"},mc=en(()=>u("p",null,"Invalid Password",-1)),vc=[mc],yc=en(()=>u("button",{type:"submit",style:{"align-self":"center"}},"Log In",-1)),wc=en(()=>u("h4",{style:{"margin-top":"40px"}},"Don't have an account?",-1));function Sc(e,t,n,s,o,a){return D(),x("div",dc,[u("div",{class:$(["login-form",{loaded:o.loaded}])},[u("h2",null,"Good "+F(o.appState.timeOfDay),1),uc,u("form",{onSubmit:t[5]||(t[5]=(...i)=>a.login&&a.login(...i))},[u("label",hc,[X("User name "),Ue(u("input",{type:"text",id:"username","onUpdate:modelValue":t[0]||(t[0]=i=>o.username=i),onFocusin:t[1]||(t[1]=(...i)=>a.handleFocus&&a.handleFocus(...i)),required:""},null,544),[[mn,o.username]])]),u("div",{class:$(["invalidLogin",{view:o.invalidLogin}])},pc,2),u("label",fc,[X("Password "),Ue(u("input",{type:"password",id:"password","onUpdate:modelValue":t[2]||(t[2]=i=>o.password=i),required:""},null,512),[[mn,o.password]])]),u("div",{class:$(["invalidLogin",{view:o.invalidLogin}])},vc,2),yc,wc,u("h4",{onClick:t[3]||(t[3]=(...i)=>a.signup&&a.signup(...i)),onKeydown:t[4]||(t[4]=vt(Se((...i)=>e.handleKeyDown&&e.handleKeyDown(...i),["prevent"]),["space"])),style:{color:"#0085ff"},class:"sign-up-b"}," Try as Guest ",32)],32)],2)],512)}const _c=A(cc,[["render",Sc],["__scopeId","data-v-46423e3a"]]),vn=Z({id:"patient-store",state:()=>({patients:[{id:0,name:"Jenna",lastname:"Charles",dob:"01/02/1988",breathingrate:"60",age:"32",weight:65,height:175,gender:"Female",scandate:"01/02/2021",scanlocation:"Area 19 Office"},{id:1,name:"Benny",lastname:"Adams",dob:"01/02/1989",breathingrate:"60",age:"32",weight:65,height:175,gender:"Male",scandate:"01/02/2022",scanlocation:"Montreal"},{id:2,name:"Emma",lastname:"Blanco",dob:"01/02/1992",breathingrate:"60",age:"32",weight:65,height:175,gender:"Female",scandate:"01/02/2023",scanlocation:"MUHC HQ"}],searchTerm:""}),getters:{},actions:{addPatient(e){this.patients.push(e)},deletePatient(e){const t=this.patients.findIndex(n=>n.id===e);t!==-1&&this.patients.splice(t,1)},getPatientbyID(e){const t=this.patients.findIndex(n=>n.id===e);return t!==-1?this.patients[t]:null}}});const Cc={props:{username:String},data(){return{appState:ut()}},created(){this.timeofday=this.appState.timeOfDay}},bc={class:"greeting"};function Dc(e,t,n,s,o,a){return D(),x("div",bc,[u("h2",null,"Good "+F(e.timeofday)+",",1),u("h1",null,F(n.username),1)])}const Ic=A(Cc,[["render",Dc],["__scopeId","data-v-2b8df9b2"]]),Be=Z({id:"active-study",state:()=>({activePatient:null,volumeKey:null,rawImageData:null,scaledImageData:null,readyToDraw:null,contourData:null,qualityCheck:{viewing:"CheckControursNew"},sliceData:[{name:"SLICE 1",id:1,sliceOBJ:{id:1,excludedImages:[],selectedImages:[],targetPhase:null,states:{FREEBREATHING:{color:"#79CFDE",start:{id:"start",state:"FREEBREATHING",phaseLocation:1},end:{id:"end",state:"FREEBREATHING",phaseLocation:30},cardiacCycles:{systoles:[{id:"Systole",state:"FREEBREATHING",phaseLocation:4}],diastoles:[{id:"Diastole",state:"FREEBREATHING",phaseLocation:20}]}},HYPERVENTILATION:{color:"#C24ABC",start:{id:"start",state:"HYPERVENTILATION",phaseLocation:31},end:{id:"end",state:"HYPERVENTILATION",phaseLocation:61},cardiacCycles:{systoles:[{id:"Systole",state:"HYPERVENTILATION",phaseLocation:35}],diastoles:[{id:"Diastole",state:"HYPERVENTILATION",phaseLocation:46}]}},BREATHHOLD:{color:"#d95476",start:{id:"start",state:"BREATHHOLD",phaseLocation:62},end:{id:"end",state:"BREATHHOLD",phaseLocation:88},cardiacCycles:{systoles:[{id:"Systole",state:"BREATHHOLD",phaseLocation:66}],diastoles:[{id:"Diastole",state:"BREATHHOLD",phaseLocation:75}]}}}},stateButtons:{currentState:"FREEBREATHING",FREEBREATHING:{state:"FREEBREATHING",heartrate:80,duration:"00:58",stateColor:"#66C9DA"},HYPERVENTILATION:{state:"HYPERVENTILATION",heartrate:96,duration:"01:02",stateColor:"#E242E6"},BREATHHOLD:{state:"BREATHHOLD",heartrate:82,duration:"00:45",stateColor:"#D95476"}},imgBarProperties:{showTrimmer:!0,showPatientInfo:!1,showGraph:!1,showSliderInfo:!1,showContours:!0}},{name:"SLICE 2",id:2,sliceOBJ:{id:2,excludedImages:[],selectedImages:[],states:{FREEBREATHING:{color:"#79CFDE",start:{id:"start",state:"FREEBREATHING",phaseLocation:1},end:{id:"end",state:"FREEBREATHING",phaseLocation:33},cardiacCycles:{systoles:[{id:"Systole",state:"FREEBREATHING",phaseLocation:4}],diastoles:[{id:"Diastole",state:"FREEBREATHING",phaseLocation:25}]}},HYPERVENTILATION:{color:"#C24ABC",start:{id:"start",state:"HYPERVENTILATION",phaseLocation:34},end:{id:"end",state:"HYPERVENTILATION",phaseLocation:65},cardiacCycles:{systoles:[{id:"Systole",state:"HYPERVENTILATION",phaseLocation:38}],diastoles:[{id:"Diastole",state:"HYPERVENTILATION",phaseLocation:46}]}},BREATHHOLD:{color:"#d95476",start:{id:"start",state:"BREATHHOLD",phaseLocation:66},end:{id:"end",state:"BREATHHOLD",phaseLocation:85},cardiacCycles:{systoles:[{id:"Systole",state:"BREATHHOLD",phaseLocation:69}],diastoles:[{id:"Diastole",state:"BREATHHOLD",phaseLocation:80}]}}}},stateButtons:{currentState:"FREEBREATHING",FREEBREATHING:{state:"FREEBREATHING",heartrate:80,duration:"00:58",stateColor:"#66C9DA"},HYPERVENTILATION:{state:"HYPERVENTILATION",heartrate:97,duration:"01:02",stateColor:"#E242E6"},BREATHHOLD:{state:"BREATHHOLD",heartrate:83,duration:"00:45",stateColor:"#D95476"}},imgBarProperties:{showTrimmer:!0,showPatientInfo:!1,showGraph:!1,showSliderInfo:!1,showContours:!0}}]}),getters:{targetPhase(){return this.sliceData[0].sliceOBJ.targetPhase}},actions:{setActive(e){this.rawImageData=null,this.scaledImageData=null,this.contourData=null,this.activePatient=e,this.volumeKey=this.activePatient.id},resetStates(){this.sliceData[0].stateButtons.currentState="FREEBREATHING",this.sliceData[1].stateButtons.currentState="FREEBREATHING"},setRawImage(e){this.rawImageData=e},setScaledImage(e){this.scaledImageData=e},deletePatient(e){const t=this.patients.findIndex(n=>n.id===e);t!==-1&&this.patients.splice(t,1)},toggleProperty(e,t){const n=this.sliceData[e-1].imgBarProperties[t];this.sliceData[e-1].imgBarProperties[t]=!n},getProperty(e,t){return this.sliceData[e-1].imgBarProperties[t]},setCurrentState(e,t){this.sliceData[e-1].stateButtons.currentState=t},excludeImage(e,t){const n=this.sliceData[t].sliceOBJ;if(n.selectedImages.length){n.selectedImages.forEach(o=>{const a=n.excludedImages.indexOf(o);a!==-1?(delete n.excludedImages[a],n.excludedImages=n.excludedImages.filter(i=>i!==null)):n.excludedImages.push(o)});return}const s=n.excludedImages.indexOf(e);s!==-1?(delete n.excludedImages[s],n.excludedImages=n.excludedImages.filter(o=>o!==null)):n.excludedImages.push(e)},selectImage(e,t){const n=this.sliceData[t].sliceOBJ,s=n.selectedImages.indexOf(e);s!==-1?(delete n.selectedImages[s],n.selectedImages=n.selectedImages.filter(o=>o!==null)):n.selectedImages.push(e)},clearSelect(e){const t=this.sliceData[e].sliceOBJ;t.selectedImages=[]},addLabel(e,t,n,s){this.sliceData[e-1].sliceOBJ.states[t].cardiacCycles[n].push(s)},deleteLabel(e,t,n,s){this.sliceData[e-1].sliceOBJ.states[t].cardiacCycles[n]=s}}});const Tc={emits:["removePatient"],props:{patient:Object,hovered:{type:Boolean}},created(){this.activeStudyStore=Be()},methods:{updatepatient(e){this.activeStudyStore.setActive(e)},handleMouseOver(){this.isHovered=!0,this.$refs.patientElement.focus()},handleMouseOut(){this.patient&&(this.isHovered=!1)},handleKeyDown(e){e.key==="Delete"&&this.$emit("removePatient",this.patient)}},data(){return{isHovered:!1,currentPatient:""}}};function xc(e,t,n,s,o,a){const i=M("router-link");return D(),Y(i,{to:"/analysis",style:{"text-decoration":"none"}},{default:L(()=>[u("div",{class:$(["patient",{containerHovered:n.hovered}]),tabindex:"-1",onMouseover:t[0]||(t[0]=(...r)=>a.handleMouseOver&&a.handleMouseOver(...r)),onFocusin:t[1]||(t[1]=(...r)=>a.handleMouseOver&&a.handleMouseOver(...r)),onClick:t[2]||(t[2]=r=>a.updatepatient(n.patient)),onKeydown:t[3]||(t[3]=(...r)=>a.handleKeyDown&&a.handleKeyDown(...r)),onMouseout:t[4]||(t[4]=(...r)=>a.handleMouseOut&&a.handleMouseOut(...r)),onFocusout:t[5]||(t[5]=(...r)=>a.handleMouseOut&&a.handleMouseOut(...r)),ref:"patientElement"},[u("h3",{class:$({hovered:o.isHovered})},F(n.patient.name),3),u("h3",{class:$({hovered:o.isHovered})},F(n.patient.lastname),3),u("h3",{class:$({hovered:o.isHovered})},F(n.patient.dob),3),u("h3",{class:$({hovered:o.isHovered})},F(n.patient.gender),3),u("h3",{class:$({hovered:o.isHovered})},F(n.patient.scandate),3),u("h3",{class:$({hovered:o.isHovered})},F(n.patient.scanlocation),3)],34)]),_:1})}const Lc=A(Tc,[["render",xc],["__scopeId","data-v-6fa6aa0d"]]);const Rc={},kc={class:"loading-container"},Mc=u("div",{class:"loading-spinner"},null,-1),Ec=u("p",{class:"loading-text"},"Loading...",-1),Pc=[Mc,Ec];function Oc(e,t){return D(),x("div",kc,Pc)}const Ac=A(Rc,[["render",Oc]]);const Bc={emits:["removePatient"],props:{patients:{type:Array},filter:{type:String,default:""}},data(){return{loaded:!1,sortBy:"lastname",sortOrder:1,patientProperties:{name:"First Name",lastname:"Last Name",dob:"Date of Birth",gender:"Gender",scandate:"Scan Date",scanlocation:"Scan Location"},filteredPatient:null,hovered:null}},created(){window.addEventListener("keydown",this.handleKeyDown)},unmounted(){window.removeEventListener("keydown",this.handleKeyDown)},computed:{filteredPatients(){const e=this.filter.toLowerCase().replace(/\s/g,"");let t=this.patients.slice();return e&&(t=t.filter(s=>s.name.toLowerCase().includes(e)||s.lastname.toLowerCase().includes(e)||s.scanlocation.toLowerCase().includes(e))),this.sortOrder?this.sortPatientsBy(t,this.sortBy):this.sortPatientsBy(t,this.sortBy).reverse()}},methods:{handleRemovePatient(e){this.$emit("removePatient",e)},setSort(e){this.sortBy=e,this.sortOrder?this.sortOrder=0:this.sortOrder=1},sortPatientsBy(e,t){const n=[...e];return n.sort((s,o)=>{const a=s[t],i=o[t];if(this.isDateString(a)&&this.isDateString(i)){const r=new Date(a),l=new Date(i);if(!r&&!l)return r-l}return typeof a=="string"&&typeof i=="string"?a.localeCompare(i,void 0,{sensitivity:"base"}):0}),n},isDateString(e){return typeof e=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(e)},handleKeyDown(e){e.key==="ArrowDown"||e.key==="Tab"&&this.hovered<this.filteredPatients.length-1?(e.preventDefault(),this.hovered+=1):e.key==="ArrowUp"&&this.hovered>=1?(e.preventDefault(),this.hovered-=1):e.key==="Delete"&&(e.preventDefault(),this.handleRemovePatient(this.filteredPatients[this.hovered]))}},components:{PatientElement:Lc,LoadingScreen:Ac},mounted(){setTimeout(()=>{this.loaded=!0},600)}},Vc={class:"patient-header"},$c=["onClick"],Fc={key:1};function Nc(e,t,n,s,o,a){const i=M("PatientElement"),r=M("LoadingScreen");return D(),x(ne,null,[u("div",Vc,[(D(!0),x(ne,null,fe(o.patientProperties,(l,c)=>(D(),x("div",{class:"property",key:c,onClick:d=>a.setSort(c),onKeydown:t[0]||(t[0]=(...d)=>a.handleKeyDown&&a.handleKeyDown(...d))},[u("h3",null,F(l),1),u("i",{class:"fa-solid fa-sort","aria-hidden":"true",style:j({color:o.sortBy==c?"white":null})},null,4)],40,$c))),128))]),o.loaded?(D(),x("div",{key:0,class:"patient-container",onMousemove:t[1]||(t[1]=l=>o.hovered=null)},[(D(!0),x(ne,null,fe(a.filteredPatients,(l,c)=>(D(),x("div",{key:l.id},[w(i,{patient:l,onRemovePatient:a.handleRemovePatient,hovered:c===o.hovered},null,8,["patient","onRemovePatient","hovered"])]))),128))],32)):(D(),x("div",Fc,[w(r)]))],64)}const Hc=A(Bc,[["render",Nc],["__scopeId","data-v-ad42c22c"]]),Jo=0,It=Z("id",()=>{let e=Jo;return{nextId(){return String(++e)},reset(){e=Jo}}}),oo=["Sagittal","Coronal","Axial"];function ft(){return{Sagittal:0,Coronal:0,Axial:0}}function as(){return{Sagittal:[0,0],Coronal:[0,0],Axial:[0,0]}}function je(e,t,n){const s=2*n[t];return e.slice(s,s+2)}function Ie(e){switch(e){case"Superior":case"Inferior":return"Axial";case"Left":case"Right":return"Sagittal";case"Posterior":case"Anterior":return"Coronal";default:throw new Error(`Invalid LPS direction: ${e}`)}}const ss=()=>({Left:Je(1,0,0),Right:Je(-1,0,0),Posterior:Je(0,1,0),Anterior:Je(0,-1,0),Superior:Je(0,0,1),Inferior:Je(0,0,-1),Sagittal:0,Coronal:1,Axial:2});function is(e){const t=[0,1,2],n=[0,1,2],s=ss();for(let o=0;o<3;o++){let a=0,i=[0,0],r=[0,0];t.forEach((p,f)=>{n.forEach((m,y)=>{const I=e[p*3+m];Math.abs(I)>Math.abs(a)&&(a=I,i=[p,m],r=[f,y])})});const[l,c]=i,d=e.slice(l*3,(l+1)*3),h=Math.sign(a),g=d.map(p=>p*h),v=d.map(p=>p*-h);c===0?(s.Left=g,s.Right=v,s.Sagittal=l):c===1?(s.Posterior=g,s.Anterior=v,s.Coronal=l):c===2&&(s.Superior=g,s.Inferior=v,s.Axial=l),t.splice(r[0],1),n.splice(r[1],1)}return s}var ce=(e=>(e.WindowLevel="WindowLevel",e.Pan="Pan",e.Zoom="Zoom",e.Ruler="Ruler",e.Paint="Paint",e.Rectangle="Rectangle",e.Crosshairs="Crosshairs",e.Crop="Crop",e.Contour="Contour",e))(ce||{}),Le=(e=>(e.V="V",e.H="H",e))(Le||{}),In=(e=>(e.DICOM="dicom",e.IMAGE="image",e))(In||{});const zc=C.nativeEnum(In),Wc=C.union([C.literal("Left"),C.literal("Right"),C.literal("Posterior"),C.literal("Anterior"),C.literal("Superior"),C.literal("Inferior")]),jc=C.object({id:C.string(),path:C.string(),type:zc}),Uc=C.object({archiveSrc:C.object({path:C.string()}).optional(),uriSrc:C.object({uri:C.string(),name:C.string()}).optional()}),rs=Uc.extend({parent:C.lazy(()=>rs.optional())}),Gc=C.nativeEnum(Le),ls=C.lazy(()=>C.object({name:C.string().optional(),direction:Gc,items:C.array(C.union([ls,C.string()]))})),We=C.tuple([C.number(),C.number(),C.number()]),Xc=C.object({width:C.number(),level:C.number(),min:C.number(),max:C.number()}),Kc=C.object({slice:C.number(),min:C.number(),max:C.number(),axisDirection:Wc}),qc=C.object({parallelScale:C.number().optional(),position:We.optional(),focalPoint:We.optional(),directionOfProjection:We.optional(),viewUp:We.optional()}),ao=C.object({arrayName:C.string(),location:C.string()}),Yc=C.object({position:C.number(),height:C.number(),width:C.number(),xBias:C.number(),yBias:C.number()}),Jc=C.object({x:C.number(),y:C.number(),midpoint:C.number(),sharpness:C.number()}),Zc=C.object({mode:C.literal(ke.Mode.Gaussians),gaussians:Yc.array(),mappingRange:C.tuple([C.number(),C.number()])}),Qc=C.object({mode:C.literal(ke.Mode.Points),preset:C.string(),shift:C.number(),mappingRange:C.tuple([C.number(),C.number()])}),ed=C.object({mode:C.literal(ke.Mode.Nodes),nodes:Jc.array(),mappingRange:C.tuple([C.number(),C.number()])}),so=C.union([Zc,Qc,ed]),io=C.object({preset:C.string(),mappingRange:C.tuple([C.number(),C.number()])});C.object({colorBy:ao,transferFunction:io,opacityFunction:so});const td=C.object({enabled:C.boolean(),lightFollowsCamera:C.boolean(),volumeQuality:C.number(),useVolumetricScatteringBlending:C.boolean(),volumetricScatteringBlending:C.number(),useLocalAmbientOcclusion:C.boolean(),laoKernelSize:C.number(),laoKernelRadius:C.number(),ambient:C.number(),diffuse:C.number(),specular:C.number()}),nd=C.object({colorBy:ao,transferFunction:io,opacityFunction:so,cvr:td}),od=C.object({opacity:C.number()}),ad=C.object({colorBy:ao,transferFunction:io,opacityFunction:so,blendConfig:od}),sd=C.object({window:Xc.optional(),slice:Kc.optional(),layers:ad.optional(),camera:qc.optional(),volumeColorConfig:nd.optional()}),id=C.union([C.literal("2D"),C.literal("3D")]),rd=C.object({id:C.string(),type:id,props:C.record(C.any()),config:C.record(sd)}),ld=C.object({id:C.string(),parent:C.string(),path:C.string()});C.union([C.literal("Axial"),C.literal("Sagittal"),C.literal("Coronal")]);const cd=C.object({planeOrigin:We,planeNormal:We}),dd=C.object({imageID:C.string(),frameOfReference:cd,slice:C.number(),id:C.string(),name:C.string(),color:C.string(),label:C.string().optional(),labelName:C.string().optional()}),cs=e=>C.object({tools:C.array(e),labels:C.record(e.partial())}),ds=dd.extend({firstPoint:We,secondPoint:We}),ud=cs(ds),hd=ds.extend({id:C.string(),fillColor:C.string().optional()}),gd=cs(hd),pd=C.object({position:We}),fd=C.nativeEnum(ce),md=C.object({activeLabelmapID:C.string().nullable(),brushSize:C.number(),brushValue:C.number(),labelmapOpacity:C.number()}),vd=C.object({Sagittal:C.tuple([C.number(),C.number()]),Coronal:C.tuple([C.number(),C.number()]),Axial:C.tuple([C.number(),C.number()])}),yd=C.record(vd),wd=C.object({rulers:ud.optional(),rectangles:gd.optional(),crosshairs:pd,paint:md,crop:yd,current:fd}),Sd=C.object({selectionKey:C.string(),sourceSelectionKeys:C.string().array()}).array(),_d=C.object({version:C.string(),datasets:jc.array(),remoteFiles:C.record(rs.array()),labelMaps:ld.array(),tools:wd,views:rd.array(),primarySelection:C.string().optional(),layout:ls,parentToLayers:Sd}),us=e=>({fileSrc:{file:e,fileType:e.type}});function hs(e){return!!e.uriSrc||!!e.parent&&hs(e.parent)}function gs(e){const t={...e};return delete t.fileSrc,t.parent&&(t.parent=gs(t.parent)),t}const ct=Z("files",{state:()=>({byDataID:{}}),getters:{getDataSources:e=>t=>e.byDataID[t]??[],getFiles:e=>t=>(e.byDataID[t]??[]).map(n=>n.fileSrc.file)},actions:{remove(e){e in this.byDataID&&delete this.byDataID[e]},add(e,t){this.byDataID[e]=t}}});async function ps(e,t,n){const s=ct(),{zip:o}=e,{manifest:{datasets:a,remoteFiles:i}}=e;t.forEach(r=>{const l=s.getDataSources(r);if(!l.length)throw new Error(`No files for dataID: ${r}`);const[c,d]=Dn(hs,l);i[r]=c.map(gs);const h=`data/${r}/`;d.forEach(g=>{const{file:v}=g.fileSrc,p=`${h}/${v.name}`;o.file(p,v)}),a.push({id:r,path:h,type:n})})}const fs=()=>({name:"(none)",orientation:ma(),lpsOrientation:ss(),spacing:Je(1,1,1),origin:Me(),dimensions:Je(1,1,1),worldBounds:[0,1,0,1,0,1],worldToIndex:yt(),indexToWorld:yt()}),Pe=Z("images",{state:()=>({idList:[],dataIndex:Object.create(null),metadata:Object.create(null)}),actions:{addVTKImageData(e,t){const n=It().nextId();return this.idList.push(n),this.dataIndex[n]=t,this.$proxies.addData(n,t),this.metadata[n]={...fs(),name:e},this.updateData(n,t),n},updateData(e,t){if(e in this.metadata){const n={name:this.metadata[e].name,dimensions:t.getDimensions(),spacing:t.getSpacing(),origin:t.getOrigin(),orientation:t.getDirection(),lpsOrientation:is(t.getDirection()),worldBounds:t.getBounds(),worldToIndex:t.getWorldToIndex(),indexToWorld:t.getIndexToWorld()};this.metadata[e]=n}this.$proxies.updateData(e,t),this.dataIndex[e]=t},deleteData(e){e in this.dataIndex&&(delete this.dataIndex[e],delete this.metadata[e],jt(this.idList,e))},async serialize(e){const t=ct(),n=this.idList.filter(s=>s in t.byDataID);await ps(e,n,In.IMAGE)}}}),Cd="Anonymous",bd="ANONYMOUS";function Dd(e,t){return`${e}!!${t}`}const Id=(e,t)=>e.readTags(t,[{name:"PatientName",tag:"0010|0010",strconv:!0},{name:"PatientID",tag:"0010|0020",strconv:!0},{name:"PatientBirthDate",tag:"0010|0030"},{name:"PatientSex",tag:"0010|0040"},{name:"StudyInstanceUID",tag:"0020|000d"},{name:"StudyDate",tag:"0008|0020"},{name:"StudyTime",tag:"0008|0030"},{name:"StudyID",tag:"0020|0010",strconv:!0},{name:"AccessionNumber",tag:"0008|0050"},{name:"StudyDescription",tag:"0008|1030",strconv:!0},{name:"Modality",tag:"0008|0060"},{name:"SeriesInstanceUID",tag:"0020|000e"},{name:"SeriesNumber",tag:"0020|0011"},{name:"SeriesDescription",tag:"0008|103e",strconv:!0}]),we=Z("dicom",{state:()=>({sliceData:{},volumeToImageID:{},imageIDToVolumeKey:{},patientInfo:{},patientStudies:{},studyInfo:{},studyVolumes:{},volumeInfo:{},volumeStudy:{},studyPatient:{},needsRebuild:{}}),actions:{async importFiles(e){if(!e.length)return[];const t=this.$dicomIO,n=new Map(e.map(i=>[i.fileSrc.file,i])),s=[...n.keys()],o=await t.categorizeFiles(s),a=ct();return Object.entries(o).forEach(([i,r])=>{const l=r.map(c=>{const d=n.get(c);if(!d)throw new Error("Did not match File with source DataSource");return d});a.add(i,l)}),await Promise.all(Object.entries(o).map(async([i,r])=>{if(!(i in this.volumeInfo)){const l=await Id(t,r[0]),c={PatientID:l.PatientID||bd,PatientName:l.PatientName||Cd,PatientBirthDate:l.PatientBirthDate||"",PatientSex:l.PatientSex||""},d=qo(l,"StudyID","StudyInstanceUID","StudyDate","StudyTime","AccessionNumber","StudyDescription"),h={...qo(l,"Modality","SeriesInstanceUID","SeriesNumber","SeriesDescription"),NumberOfSlices:r.length,VolumeID:i};this._updateDatabase(c,d,h)}i in this.volumeToImageID&&(this.needsRebuild[i]=!0)})),Object.keys(o)},_updateDatabase(e,t,n){const s=e.PatientID,o=t.StudyInstanceUID,a=n.VolumeID;s in this.patientInfo||(this.patientInfo[s]=e,this.patientStudies[s]=[]),o in this.studyInfo||(this.studyInfo[o]=t,this.studyVolumes[o]=[],this.studyPatient[o]=s,this.patientStudies[s].push(o)),a in this.volumeInfo||(this.volumeInfo[a]=n,this.volumeStudy[a]=o,this.sliceData[a]={},this.studyVolumes[o].push(a))},deleteVolume(e){const t=Pe();if(e in this.volumeInfo){const n=this.volumeStudy[e];if(delete this.volumeInfo[e],delete this.sliceData[e],delete this.volumeStudy[e],e in this.volumeToImageID){const s=this.volumeToImageID[e];t.deleteData(s),delete this.volumeToImageID[e],delete this.imageIDToVolumeKey[s]}jt(this.studyVolumes[n],e),this.studyVolumes[n].length===0&&this.deleteStudy(n)}},deleteStudy(e){if(e in this.studyInfo){const t=this.studyPatient[e];delete this.studyInfo[e],delete this.studyPatient[e],[...this.studyVolumes[e]].forEach(n=>this.deleteVolume(n)),delete this.studyVolumes[e],jt(this.patientStudies[t],e),this.patientStudies[t].length===0&&this.deletePatient(t)}},deletePatient(e){e in this.patientInfo&&(delete this.patientInfo[e],[...this.patientStudies[e]].forEach(t=>this.deleteStudy(t)),delete this.patientStudies[e])},async serialize(e){const t=Object.keys(this.volumeInfo);await ps(e,t,In.DICOM)},async deserialize(e){return this.importFiles(e).then(t=>{if(t.length!==1)throw new Error("Invalid state file.");return t[0]})},async getVolumeSlice(e,t,n=!1){const s=this.$dicomIO,o=ct(),a=Dd(t,n);if(e in this.sliceData&&a in this.sliceData[e])return this.sliceData[e][a];if(!(e in this.volumeInfo))throw new Error(`Cannot find given volume key: ${e}`);const r=this.volumeInfo[e].NumberOfSlices;if(t<1||t>r)throw new Error(`Slice ${t} is out of bounds`);const l=o.getFiles(e);if(!l)throw new Error(`No files found for volume key: ${e}`);const c=l[t-1],d=await s.getVolumeSlice(c,n);return this.sliceData[e][a]=d,d},async getVolumeThumbnail(e){const{NumberOfSlices:t}=this.volumeInfo[e],n=Math.ceil(t/2);return this.getVolumeSlice(e,n,!0)},async buildVolume(e,t=!1){const n=Pe(),s=this.$dicomIO;if(!(t||this.needsRebuild[e])&&this.volumeToImageID[e]){const c=this.volumeToImageID[e];return n.dataIndex[c]}const i=ct().getFiles(e);if(!i)throw new Error("No files for volume key");const r=pn.convertItkToVtkImage(await s.buildImage(i)),l=this.volumeToImageID[e];if(l)n.updateData(l,r);else{const c=this.volumeInfo[e].SeriesInstanceUID,d=n.addVTKImageData(c,r);this.imageIDToVolumeKey[d]=e,this.volumeToImageID[e]=d}return delete this.needsRebuild[e],r}}}),ms=Z("models",{state:()=>({idList:[],dataIndex:{},metadata:{}}),actions:{addVTKPolyData(e,t){const n=It().nextId();return this.idList.push(n),this.dataIndex[n]=t,this.$proxies.addData(n,t),n}}}),Td=Z("message",{state:()=>({_nextID:1,byID:{},msgList:[]}),getters:{messages(){return this.msgList.map(e=>this.byID[e])},importantMessages(){return this.messages.filter(e=>e.type!==3)}},actions:{addError(e,t){return t instanceof Error?this._addMessage({type:0,title:e},{details:String(t),persist:!1}):this._addMessage({type:0,title:e},t)},addWarning(e,t){return this._addMessage({type:1,title:e},t)},addInfo(e,t){return this._addMessage({type:2,title:e},t)},addSuccess(e,t){return this._addMessage({type:3,title:e},t)},clearOne(e){e in this.byID&&(jt(this.msgList,e),delete this.byID[e])},clearAll(){this.byID={},this.msgList=[]},_addMessage(e,t){const n=String(this._nextID++),s={persist:!1,...typeof t=="string"?{details:t}:t};return this.byID[n]={...e,options:s,id:n},this.msgList.push(n),n}}});async function ro(e,t){try{return await t()}catch(n){n instanceof Error&&Td().addError(e,{details:`${n}. More details can be found in the developer's console.`}),console.error(n)}}const Ut=e=>({type:"dicom",volumeKey:e}),Gt=e=>({type:"image",dataID:e}),vs=e=>{if(e.type==="image")return e.dataID;if(e.type==="dicom")return we().volumeToImageID[e.volumeKey];const t=e;throw new Error(`invalid selection type ${t}`)},xd=async e=>{const t=Pe(),n=we();return e.type==="dicom"?(await ro("Failed to build volume",()=>n.buildVolume(e.volumeKey)),t.dataIndex[vs(e)]):t.dataIndex[e.dataID]},ys=e=>we().imageIDToVolumeKey[e]??e,ws=e=>we().volumeToImageID[e]??e;function Ld(e,t){return e.type==="dicom"&&t.type==="dicom"?e.volumeKey===t.volumeKey:e.type==="image"&&t.type==="image"?e.dataID===t.dataID:!1}const Tn=Z("dataset",()=>{const e=Pe(),t=ms(),n=we(),s=ct(),o=V(null),a=T(()=>{if(o.value)return vs(o.value)}),i=T(()=>{const{dataIndex:h}=e;return a.value&&h[a.value]||null}),r=T(()=>[...e.idList,...t.idList]);function l(h){return this.$proxies.getData(h)}function c(h){o.value=h,h!==null&&h.type==="dicom"&&ro("Failed to build volume",()=>n.buildVolume(h.volumeKey))}async function d(h){if(await n.serialize(h),await e.serialize(h),o.value!==null){let g=null;o.value.type==="dicom"?g=o.value.volumeKey:g=o.value.dataID;const{manifest:v}=h;v.primarySelection=g}}return e.$onAction(({name:h,args:g,after:v})=>{h==="deleteData"&&v(()=>{const[p]=g,f=o.value;(f==null?void 0:f.type)==="image"&&f.dataID===p&&(o.value=null),s.remove(p)})}),n.$onAction(({name:h,args:g,after:v})=>{h==="deleteVolume"&&v(()=>{const[p]=g,f=o.value;(f==null?void 0:f.type)==="dicom"&&p===f.volumeKey&&(o.value=null),s.remove(p)})}),{primarySelection:o,primaryDataset:i,allDataIDs:r,getDataProxyByID:l,setPrimarySelection:c,serialize:d}});function Rd(e,t,n){return{message:e,inputDataStackTrace:[t],cause:n}}const Hn=Symbol("DoneSentinel");class xn{constructor(t){this.handlers=Array.from(t??[])}async execute(t,n){return this.startExecutionContext(t,n)}async startExecutionContext(t,n){const s=[...this.handlers],o=[],a=Wa(),i=(g,v)=>{v?a.reject(v):a.resolve(g)},r=async(g,v)=>{let p=!1,f;const m=v>=s.length,y={done:S=>{if(p)throw new Error("done() called twice!");return p=!0,f=S,Hn},execute:async(S,b)=>{const E=this.execute(S,b??n);return o.push(E),E},extra:n};let I;m&&(I=Hn);try{if(m)I=Hn;else{const S=s[v];I=await S(g,y)}}catch(S){const b=S instanceof Error?S:new Error(S?String(S):"Unknown error occurred");i(void 0,b);return}if(p||m){i(f);return}r(I,v+1)},l={ok:!0,data:[],errors:[]};try{await r(t,0);const g=await a.promise;g!=null&&l.data.push(g)}catch(g){const v=g instanceof Error?g.message:String(g);l.ok=!1,l.errors.push(Rd(v,t,g))}const c=await Promise.all(o),[d,h]=Dn(g=>g.ok,c);return h.length>0&&(l.ok=!1),d.forEach(g=>{l.data.push(...g.data)}),h.forEach(g=>{const{errors:v}=g;v.forEach(p=>{p.inputDataStackTrace.push(t)}),l.errors.push(...v)}),l}}const kd=(e,{extra:t,done:n})=>{const{fileSrc:s}=e;return t!=null&&t.dicomDataSources&&(s==null?void 0:s.fileType)==="application/dicom"?(t.dicomDataSources.push(e),n()):e},Md={testURL:e=>{const{protocol:t}=new Lt(e,window.location.href);return t==="http:"||t==="https:"},fetchURL:async(e,t={})=>{var c;const{progress:n}=t,s=await fetch(e);if(s.status!==200)throw new Error(`Fetching resource failed (HTTP code ${s.status})`);if(!n)return s.blob();const o=Number(s.headers.get("content-length"))??-1;if(o<0)return n(1/0),s.blob();const a=(c=s.body)==null?void 0:c.getReader();if(!a)return null;const i=new Uint8Array(o);let r=0,l=!1;do{const d=await a.read();l=d.done,d.value&&!l&&(i.set(d.value,r),r+=d.value.length,n(r/o))}while(!l);return new Blob([i])}},lo=[Md];function Ed(e){return!!lo.find(t=>t.testURL(e))}async function Pd(e,t,n){const s=lo.find(i=>i.testURL(e));if(!s)throw new Error(`Cannot find a handler for URL: ${e}`);const o=n==null?void 0:n.cache;if(o!=null&&o.has(e))return o.get(e);const a=s.fetchURL(e,n).then(i=>{if(!i)throw new Error(`Failed to download ${e}`);return new File([i],t)});return a.catch(()=>{o==null||o.delete(e)}),o==null||o.set(e,a),a}async function Od(e,t){const n=lo.find(i=>i.testURL(e));if(!n)throw new Error(`Cannot find a handler for URL: ${e}`);const s=await n.fetchURL(e,t);if(!s)throw new Error(`Failed to download ${e}`);const o=await s.arrayBuffer(),a=new TextDecoder;return JSON.parse(a.decode(new Uint8Array(o)))}const Ss=async(e,{execute:t,done:n,extra:s})=>{const{fileSrc:o,uriSrc:a}=e;if(!o&&a&&Ed(a.uri))try{const i=await Pd(a.uri,a.name,{cache:s==null?void 0:s.fetchFileCache});return t({...e,fileSrc:{file:i,fileType:""}}),n()}catch(i){throw new Error(`Could not download URL ${a.uri}`,{cause:i instanceof Error?i:void 0})}return e};async function co(e){const t=await va.loadAsync(e),n=[],s=[];return t.forEach((o,a)=>{if(!a.dir){const i=rl(a.name),r=il(a.name),l=t.file(a.name);l&&(n.push(l.async("blob").then(c=>new File([c],i))),s.push(r))}}),Promise.all(n).then(o=>o.map((a,i)=>({file:a,archivePath:s[i]})))}function _s(e){return!!e.fileSrc&&Na.has(e.fileSrc.fileType)}const Ad=async(e,{execute:t,done:n})=>_s(e)?((await co(e.fileSrc.file)).forEach(o=>{t({fileSrc:{file:o.file,fileType:""},archiveSrc:{path:`${o.archivePath}/${o.file.name}`},parent:e})}),n()):e;async function Bd(e,t){let n=t==null?void 0:t.get(e);return n||(n=co(e).then(s=>s.reduce((o,a)=>{const i=Dt(a.archivePath,a.file.name);return Object.assign(o,{[i]:a.file})},{})),t&&t.set(e,n),n)}const Cs=async(e,{extra:t,execute:n,done:s})=>{const{fileSrc:o,archiveSrc:a,parent:i}=e,{archiveCache:r}=t??{};if(!o&&a&&i){if(!(i!=null&&i.fileSrc))throw new Error("Cannot extract an archive target with an unresolved parent");if(!_s(i))throw new Error("Parent is not a supported archive file");const l=await Bd(i.fileSrc.file,r),c=bt(a.path),d=l[c];if(!d)throw new Error(`Failed to find archive member ${c}`);return n({...e,fileSrc:{file:d,fileType:""}}),s()}return e},Vd=e=>new Lt(e).protocol==="s3:";function $d(e,t){return`https://${e}.s3.amazonaws.com/${t}`}async function Fd(e,t,n=()=>{}){const s=new Li({region:"us-east-1",signer:{sign:async a=>a}}),o=async a=>{const i=new Ri({Bucket:e,Prefix:t,ContinuationToken:a,MaxKeys:1e3});let r;try{r=await s.send(i)}catch(l){throw console.error(l),l}if(!r.Contents)throw new Error("S3 returned no objects");r.Contents.forEach(l=>{if(!l.Key)return;const c=l.Key,d=$d(e,l.Key);n(c,d)}),r.IsTruncated&&r.NextContinuationToken&&await o(r.NextContinuationToken)};await o()}const Nd=e=>{const{hostname:t,pathname:n}=new Lt(e),s=n.replace(/^\//,"");return[t,s]},Hd=async(e,t=()=>{})=>{const[n,s]=Nd(e);await Fd(n,s,t)},zd=async(e,{execute:t,done:n})=>{const{uriSrc:s}=e;if(s&&Vd(s.uri))try{return await Hd(s.uri,(o,a)=>{t({uriSrc:{uri:a,name:o},parent:e})}),n()}catch(o){throw new Error(`Could not download S3 URI ${s.uri}`,{cause:o instanceof Error?o:void 0})}return e},Wd=e=>new Lt(e).protocol==="gs:",jd=e=>{const{hostname:t,pathname:n}=new Lt(e),s=n.replace(/^\//,"");return[t,s]},Ud=e=>`https://storage.googleapis.com/storage/v1/b/${e}/o`;async function Gd(e,t,n=()=>{}){const s=[],o=async a=>{const i=new Lt(Ud(e));i.searchParams.append("prefix",t),i.searchParams.append("maxResults","1000"),a&&i.searchParams.append("pageToken",a);const r=await Od(i.toString());if(r.kind!=="storage#objects")throw new Error("GCS did not return a list of objects!");s.push(...r.items),r.items.forEach(l=>n(l)),r.nextPageToken&&await o(r.nextPageToken)};return await o(),s}const Xd=async(e,t=()=>{})=>{const[n,s]=jd(e);return Gd(n,s,t)},Kd=async(e,{execute:t,done:n})=>{const{uriSrc:s}=e;if(s&&Wd(s.uri))try{return await Xd(s.uri,o=>{t({uriSrc:{uri:o.mediaLink,name:o.name},parent:e})}),n()}catch(o){throw new Error(`Could not download GCS URI ${s.uri}`,{cause:o instanceof Error?o:void 0})}return e},qd=async(e,{done:t})=>{if(!e.fileSrc)return e;const{fileSrc:n}=e;if(!qn.has(n.fileType))return e;const o=await qn.get(n.fileType)(n.file),a=ct();if(o.isA("vtkImageData")){const i=Pe().addVTKImageData(n.file.name,o);return a.add(i,[e]),t({dataID:i,dataSource:e,dataType:"image"})}if(o.isA("vtkPolyData")){const i=ms().addVTKPolyData(n.file.name,o);return a.add(i,[e]),t({dataID:i,dataSource:e,dataType:"model"})}throw new Error("Data reader did not produce a valid dataset")},Yd=C.object({url:C.string(),name:C.optional(C.string())}),Jd=C.object({resources:C.array(Yd)});async function Zd(e){const t=new TextDecoder,n=await e.arrayBuffer(),s=t.decode(new Uint8Array(n));return Jd.parse(JSON.parse(s))}const Qd=async(e,{done:t,execute:n})=>{const{fileSrc:s}=e;if((s==null?void 0:s.fileType)==="application/json"){const o=[];try{(await Zd(s.file)).resources.forEach(i=>{o.push({uriSrc:{uri:i.url,name:i.name??new URL(i.url).pathname},parent:e})})}catch{return e}return o.forEach(a=>{n(a)}),t()}return e};function eu(e,t){t.classHierarchy.push("vtkLabelMap"),t.colorMap===null&&(t.colorMap={0:[0,0,0,0],1:[0,0,0,255]})}const tu={colorMap:null};function bs(e,t,n={}){Object.assign(t,tu,n),Ma.extend(e,t,n),_.setGet(e,t,["colorMap"]),eu(e,t)}const nu=_.newInstance(bs,"vtkLabelMap"),Ds={newInstance:nu,extend:bs},re={Coronal:"Coronal",Coronal2:"Coronal2",Sagittal:"Sagittal",Axial:"Axial",Three:"3D"},Is={[re.Coronal]:{viewType:"2D",props:{viewDirection:"Right",viewUp:"Superior"}},[re.Coronal2]:{viewType:"2D",props:{viewDirection:"Right",viewUp:"Superior"}},[re.Sagittal]:{viewType:"2D",props:{viewDirection:"Right",viewUp:"Superior"}},[re.Axial]:{viewType:"2D",props:{viewDirection:"Superior",viewUp:"Anterior"}},[re.Three]:{viewType:"3D",props:{viewDirection:"Posterior",viewUp:"Superior"}}},ou=Is[re.Axial];[{name:"Axial Only",direction:Le.H,items:[re.Axial]},{name:"Axial Primary",direction:Le.V,items:[re.Axial,{direction:Le.H,items:[re.Three,re.Coronal,re.Sagittal]}]},{name:"3D Primary",direction:Le.V,items:[re.Three,{direction:Le.H,items:[re.Coronal,re.Sagittal,re.Axial]}]},{name:"Quad View",direction:Le.H,items:[{direction:Le.V,items:[re.Coronal,re.Three]},{direction:Le.V,items:[re.Sagittal,re.Axial]}]},{name:"3D Only",direction:Le.H,items:[re.Three]}].reduce((e,t)=>({...e,[t.name]:t}),{});const Ft={0:[0,0,0,0],1:[153,153,0,255],2:[76,76,0,255],3:[255,255,0,255],4:[0,76,0,255],5:[0,153,0,255],6:[0,255,0,255],7:[76,0,0,255],8:[153,0,0,255],9:[255,0,0,255],10:[0,76,76,255],11:[0,153,153,255],12:[0,255,255,255],13:[0,0,76,255],14:[0,0,153,255]},au=["#58f24c","#8de4d3","#f0a4b1","#a3c9fe","#c8f251","#fea53b"],su={red:{color:"red"},green:{color:"#00ff00"},white:{color:"#ffffff"}},iu={artifact:{color:"#888888",fillColor:"#ffbf0040"},innocuous:{color:"#00ff00",fillColor:"#00ff0020"},lesion:{color:"red",fillColor:"transparent"}},Zo={CT:"CT-AAA",MR:"CT-Coronary-Arteries-2",US:"US-Fetal"},ru=Uint8Array;function lu(e){const t=new ru(e.getNumberOfPoints()),n=Ds.newInstance(e.get("spacing","origin","direction"));return n.getPointData().setScalars(Ea.newInstance({numberOfComponents:1,values:t})),n.setDimensions(e.getDimensions()),n.computeTransforms(),n.setColorMap(Ft),n}function cu(e){const t=Ds.newInstance(e.get("spacing","origin","direction","indexToWorld","worldToIndex","dataDescription","pointData"));return t.setDimensions(e.getDimensions()),t.computeTransforms(),t.setColorMap(Ft),t}const yn=Z("labelmap",{state:()=>({idList:[],labelmaps:Object.create(null),parentImage:Object.create(null)}),actions:{newLabelmapFromImage(e){const n=Pe().dataIndex[e];if(!n)return null;const s=It().nextId(),o=lu(n);return this.idList.push(s),this.parentImage[s]=e,this.labelmaps[s]=o,this.$proxies.addData(s,o),s},async serialize(e){const{labelMaps:t}=e.manifest,{zip:n}=e;await Promise.all(Object.entries(this.labelmaps).map(async([s,o])=>{const a=`labels/${s}.vti`,i=ys(this.parentImage[s]);t.push({id:s,parent:i,path:a});const r=await _l(o);n.file(a,r)}))},async deserialize(e,t,n){const{labelMaps:s}=e,o={};return s.forEach(async a=>{const[i]=t.filter(h=>Dt(h.archivePath,h.file.name)===bt(a.path)).map(h=>h.file);a.parent=n[a.parent];const{parent:r}=a,l=It().nextId();o[a.id]=l;const c=await Ga(i),d=cu(c);this.idList.push(l),this.parentImage[l]=ws(r),this.labelmaps[l]=d,this.$proxies.addData(l,d)}),o}}});async function du(e,t,n,s=[{type:Ye.Image}]){const o=navigator.hardwareConcurrency?navigator.hardwareConcurrency:6,a=n[0],i=Math.min(parseInt(o/2,10),Math.max(a.size[a.size.length-1],1),4),r=i.toString(),l=[...Array(i).keys()].map(v=>{const p=[...[...Array(n.length).keys()].map(m=>m.toString()),"0",...t,"--max-total-splits",r,"--split",v.toString(),"--number-of-splits",r,"--memory-io"],f=n.map(m=>({type:Ye.Image,data:ki(m)}));return[e,p,s,f,Dt("/","/itk/pipelines"),Dt("/","/itk/pipeline.worker.js")]}),c=new Mi(o,ga),d=await c.runTasks(l).promise;c.terminateWorkers();const g=d.filter(v=>v.returnValue===0).map(({outputs:v})=>v[0].data);return Ei(g)}const uu=["size","direction","origin","spacing"];function hu(e,t){return uu.map(s=>to(e[s],t[s])).every(s=>s)}async function gu(e,t){if(hu(e,t))return t;const{size:n,spacing:s,origin:o,direction:a}=e,i=["--size",n.join(","),"--spacing",s.join(","),"--origin",o.join(","),"--direction",a.join(",")];return du("resample",i,[t])}const Ts=e=>{throw new Error(`Unknown DataSelection: ${e}`)},pu=e=>e.type==="dicom"?e.volumeKey:e.type==="image"?e.dataID:Ts(e),Bt=e=>{const t=pu(e);return`${e.type}::${t}`},zn=e=>{const[t,n]=e.split("::");return t==="dicom"?Ut(n):t==="image"?Gt(n):Ts(t)},Mt=Z("layer",()=>{const e=V({}),t=V({});async function n(g,v){if(!g)throw new Error("Tried to addLayer without parent data selection");const p=Bt(g),f=`${p}::${Bt(v)}`;this.parentToLayers[p]=[...this.parentToLayers[p]??[],{selection:v,id:f}];const[m,y]=await Promise.all([g,v].map(xd));if(!Fr.intersects(m.getBounds(),y.getBounds()))throw this.deleteLayer(g,v),new Error("Image bounds do not intersect, so no overlap in physical space");const I=await gu(pn.convertVtkToItkImage(m),pn.convertVtkToItkImage(y)),S=pn.convertItkToVtkImage(I);this.$proxies.addData(f,S),this.layerImages[f]=S}async function s(g,v){return ro("Failed to build layer",()=>this._addLayer(g,v))}function o(g,v){if(!g)throw new Error("Tried to deleteLayer without parent data selection");const p=Bt(g),f=this.parentToLayers[p]??[],m=f.find(({selection:y})=>Ld(y,v));m&&(this.parentToLayers[p]=f.filter(y=>y!==m),delete this.layerImages[m.id],this.$proxies.getData(m.id)&&this.$proxies.deleteData(m.id))}function a(g){if(!g)return[];const v=Bt(g);return e.value[v]??[]}const i=g=>Object.values(e.value).flat().flat().find(({id:v})=>v===g),r=g=>{const v=Mt();v.getLayers(g).forEach(({selection:p})=>v.deleteLayer(g,p)),Object.keys(v.parentToLayers).map(p=>zn(p)).forEach(p=>v.deleteLayer(p,g))};Pe().$onAction(({name:g,args:v})=>{if(g!=="deleteData")return;const[p]=v,f=Gt(p);r(f)}),we().$onAction(({name:g,args:v})=>{if(g!=="deleteVolume")return;const[p]=v,f=Ut(p);r(f)});function d(g){g.manifest.parentToLayers=Object.entries(this.parentToLayers).map(([v,p])=>({selectionKey:v,sourceSelectionKeys:p.map(({selection:f})=>Bt(f))}))}function h(g,v){const p=m=>{if(m.type==="dicom")return Ut(v[m.volumeKey]);if(m.type==="image")return Gt(v[m.dataID]);const y=m;throw new Error(`invalid selection type ${y}`)},{parentToLayers:f}=g;f.forEach(({selectionKey:m,sourceSelectionKeys:y})=>{const I=p(zn(m));y.forEach(S=>{const b=p(zn(S));this.addLayer(I,b)})})}return{parentToLayers:e,layerImages:t,_addLayer:n,addLayer:s,deleteLayer:o,getLayers:a,getLayer:i,serialize:d,deserialize:h}});function xs(e){const t=Pe();if(e&&e in t.metadata){const{lpsOrientation:n}=t.metadata[e],s=t.dataIndex[e];if(s){const o=s.getSpatialExtent();return{Sagittal:je(o,"Sagittal",n),Coronal:je(o,"Coronal",n),Axial:je(o,"Axial",n)}}}return as()}function le(){const e=Tn(),t=we(),n=Pe(),s=Mt(),o=T(()=>{const{primarySelection:d}=e,{volumeToImageID:h}=t;return(d==null?void 0:d.type)==="image"?d.dataID:(d==null?void 0:d.type)==="dicom"&&h[d.volumeKey]||null}),a=T(()=>{const{metadata:d}=n,h=o.value;return h?d[h]:fs()}),i=T(()=>{if(o.value)return n.dataIndex[o.value]}),r=T(()=>xs(o.value)),l=T(()=>!!e.primarySelection&&!e.primaryDataset),c=T(()=>s.getLayers(e.primarySelection).filter(({id:d})=>d in s.layerImages));return{currentImageData:i,currentImageID:o,currentImageMetadata:a,currentImageExtent:r,isImageLoading:l,currentLayers:c}}function Wn(e,t){return[Math.max(t[0],Math.min(t[1],e[0])),Math.max(t[0],Math.min(t[1],e[1]))]}function gt(e,t,n,s){const{indexToWorld:o,orientation:a,lpsOrientation:i}=t,r=[0,0,0],l=i[n];r[l]=e[n][s],pe(r,r,o);const c=-(s*2-1),d=[...a.slice(l*3,l*3+3).map(h=>h*c)];return Nr.newInstance({origin:r,normal:d})}const Tt=Z("crop",()=>{const e=Pe(),t=Ve({croppingByImageID:{}}),n=c=>T(()=>{const d=U(c);if(d&&d in t.croppingByImageID&&d in e.metadata){const h=t.croppingByImageID[d],g=e.metadata[d];return[gt(h,g,"Sagittal",0),gt(h,g,"Sagittal",1),gt(h,g,"Coronal",0),gt(h,g,"Coronal",1),gt(h,g,"Axial",0),gt(h,g,"Axial",1)]}return null}),s=(c,d)=>{const h=xs(c);return{Sagittal:Wn(d.Sagittal,h.Sagittal),Coronal:Wn(d.Coronal,h.Coronal),Axial:Wn(d.Axial,h.Axial)}},o=(c,d)=>{t.croppingByImageID[c]=s(c,d)},a=(c,d,h)=>{c in t.croppingByImageID&&o(c,{...t.croppingByImageID[c],[d]:h})},i=c=>{const d=e.dataIndex[c];if(!d)return;const{lpsOrientation:h}=e.metadata[c],g=d.getSpatialExtent();o(c,{Sagittal:je(g,"Sagittal",h),Coronal:je(g,"Coronal",h),Axial:je(g,"Axial",h)})};function r(c){const{tools:d}=c.manifest;d.crop=t.croppingByImageID}function l(c,d){const h=c.tools.crop;Object.entries(h).forEach(([g,v])=>{const p=d[g];o(p,v)})}return{croppingByImageID:Pi(t.croppingByImageID),getComputedVTKPlanes:n,setCropping:o,setCroppingForAxis:a,resetCropping:i,serialize:r,deserialize:l}});function fu(){return ka.createBuilder().addField({name:"placed",initialValue:!1}).addField({name:"indexToWorld",initialValue:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}).addField({name:"worldToIndex",initialValue:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}).addStateFromMixin({labels:["handle"],mixins:["origin","bounds"],name:"handle",initialValues:{origin:null}}).build()}function mu(e,t){return t.map((n,s)=>Math.max(e[s*2],Math.min(e[s*2+1],n)))}function vu(e,t){t.classHierarchy.push("vtkCrosshairsWidgetProp");let n=!1;_.setGet(e,t,["manipulator"]);function s(o){return o.altKey||o.controlKey||o.shiftKey}e.handleLeftButtonPress=o=>!t.pickable||s(o)?_.VOID:(t.widgetState.setPlaced(!0),n=!0,t._interactor.requestAnimation(e),t._apiSpecificRenderWindow.setCursor("crosshairs"),e.invokeStartInteractionEvent(),e.handleMouseMove(o),_.EVENT_ABORT),e.handleMouseMove=o=>{if((!t.widgetState.getPlaced()||n)&&t.pickable&&t.manipulator&&!s(o)){const a=t.manipulator.handleEvent(o,t._apiSpecificRenderWindow),i=t.widgetState.getHandle(),r=t.widgetState.getWorldToIndex(),l=t.widgetState.getIndexToWorld();if(r.length&&l.length){const c=Me(),d=Me(),h=i.getBounds();pe(c,a,r);const g=mu(h,c);return pe(d,g,l),i.setOrigin(d),e.invokeInteractionEvent(),_.EVENT_ABORT}}return _.VOID},e.handleLeftButtonRelease=()=>{n&&t.pickable&&(t._interactor.cancelAnimation(e),t._apiSpecificRenderWindow.setCursor("default"),e.invokeEndInteractionEvent()),n=!1},e.grabFocus=()=>{},e.loseFocus=()=>{}}function yu(e,t){t.classHierarchy.push("vtkCrosshairsWidget"),t.behavior=vu,t.widgetState=fu(),e.getRepresentationsForViewType=n=>{switch(n){case Qe.DEFAULT:case Qe.GEOMETRY:case Qe.SLICE:case Qe.VOLUME:default:return[]}},t.widgetState.onBoundsChange(n=>{const s=[(n[0]+n[1])*.5,(n[2]+n[3])*.5,(n[4]+n[5])*.5];t.widgetState.getHandle().setOrigin(s)}),t.manipulator=Ge.newInstance()}const wu={};function Ls(e,t,n={}){Object.assign(t,wu,n),_n.extend(e,t,n),_.setGet(e,t,["manipulator"]),yu(e,t)}const Su=_.newInstance(Ls,"vtkCrosshairsWidget"),_u={newInstance:Su,extend:Ls};function xt(e,t,n,s){t in e||(e[t]={}),e[t][n]={...e[t][n],...s}}function tn(e,t){Object.keys(e).forEach(n=>{delete e[n][t]})}function nn(e,t,n){var s;return t==null||n==null?null:(s=e[t])==null?void 0:s[n]}const Cu=(e,t,n)=>{const s=e.manifest.datasets.map(a=>a.id),{views:o}=e.manifest;o.forEach(a=>{s.forEach(i=>{var c;const{config:r}=a,l=(c=t[a.id])==null?void 0:c[i];if(l!==void 0){const d=pl(i,r,{});d[n]=l}})})},on=(e,t)=>n=>{Cu(n,e,t)},uo=()=>({slice:0,min:0,max:1,axisDirection:"Inferior"}),st=Z("viewSlice",()=>{const e=Ve({}),t=(l,c)=>nn(e,l,c),n=(l,c,d)=>{const h={...uo(),...t(l,c),...d};h.slice=ja(h.slice,h.min,h.max),xt(e,l,c,h)},s=(l,c)=>{const d=t(l,c);d&&n(l,c,{slice:Math.ceil((d.min+d.max)/2)})},o=l=>{delete e[l]},a=(l,c)=>{var d;c?(d=e[c])==null||delete d[l]:tn(e,l)},i=on(e,"slice");return{configs:e,getConfig:t,updateConfig:n,resetSlice:s,removeView:o,removeData:a,serialize:i,deserialize:(l,c)=>{Object.entries(c).forEach(([d,h])=>{h.slice&&n(l,d,h.slice)})}}}),Rs=()=>({width:1,level:.5,min:0,max:1}),ho=Z("windowing",()=>{const e=Ve({}),t=V(!0),n=h=>{t.value=h},s=(h,g)=>nn(e,h,g),o=(h,g)=>{var p;if(!t.value)return;const v=(p=e[h])==null?void 0:p[g];v&&Object.keys(e).filter(f=>f!==h).forEach(f=>{xt(e,f,g,v)})},a=(h,g,v)=>{var p;xt(e,h,g,{...Rs(),...(p=e[h])==null?void 0:p[g],...v}),t.value&&o(h,g)},i=(h,g)=>{var m;const v=(m=e[h])==null?void 0:m[g];if(v==null)return;const p=v.max-v.min,f=(v.max+v.min)/2;a(h,g,{width:p,level:f})},r=h=>{delete e[h]},l=(h,g)=>{var v;g?(v=e[g])==null||delete v[h]:tn(e,h)},c=on(e,"window");return{configs:e,getConfig:s,setSyncAcrossViews:n,updateConfig:a,resetWindowLevel:i,removeView:r,removeData:l,serialize:c,deserialize:(h,g)=>{Object.entries(g).forEach(([v,p])=>{p.window&&a(h,v,p.window)})}}});function ks(e,t){var s,o;const n=(o=(s=t.getRenderWindow())==null?void 0:s.getViews())==null?void 0:o[0];if(n){const[a,i,r]=e;return n.worldToDisplay(a,i,r,t)}return null}function bu(e,t){const n=t.getCanvas();if(!n)return null;const s=n.getBoundingClientRect(),o=n.width/s.width,a=n.height/s.height;return[o*(e.clientX-s.left),a*(s.height-e.clientY+s.top)]}function Du(e,t,n,s){var i;const o=(i=t.getRenderWindow())==null?void 0:i.getViews()[0];if(!o)return null;const a=bu(e,o);return a?Hr(a[0],a[1],n,s,t,o):null}function Xt(e,t){var o,a;const n=ks(e,t),s=(a=(o=t.getRenderWindow())==null?void 0:o.getViews())==null?void 0:a[0];if(n&&s){const[,i]=s.getViewportSize(t);return[n[0]/devicePixelRatio,(i-n[1])/devicePixelRatio]}return null}function go(e){var o,a,i;const{pokedRenderer:t}=e,n=(a=(o=t==null?void 0:t.getRenderWindow())==null?void 0:o.getViews())==null?void 0:a[0],s=(i=n==null?void 0:n.getContainer())==null?void 0:i.getBoundingClientRect();return!("position"in e)||!s?null:[s.left+e.position.x/devicePixelRatio,s.top+s.height-e.position.y/devicePixelRatio]}function Iu(e,t,n){const s=Cn.getPresetByName(e);if(s.OpacityPoints){const o=s.OpacityPoints,a=[];for(let c=0;c<o.length;c+=2)a.push([o[c],o[c+1]]);const[i,r]=t,l=r-i;return a.map(([c,d])=>[(c-i)/l+n,d])}return null}function Ms(e){return Cn.getPresetByName(e).OpacityPoints?{mode:ke.Mode.Points,preset:e,shift:0}:{mode:ke.Mode.Gaussians,gaussians:JSON.parse(JSON.stringify(ke.Defaults.Gaussians))}}function Es(e){const t=Cn.getPresetByName(e);if(!t)return null;const{AbsoluteRange:n,RGBPoints:s}=t;if(n&&s){let o=1/0,a=-1/0;for(let i=0;i<s.length;i+=4)o=Math.min(o,s[i]),a=Math.max(a,s[i]);return[o,a]}return null}const Tu=[{Name:"CT-AAA",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,143.556,0,166.222,.686275,214.389,.696078,419.736,.833333,3071,.803922],RGBPoints:[-3024,0,0,0,143.556,.615686,.356863,.184314,166.222,.882353,.603922,.290196,214.389,1,1,1,419.736,1,.937033,.954531,3071,.827451,.658824,1],EffectiveRange:[143.556,419.736]},{Name:"CT-AAA2",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,129.542,0,145.244,.166667,157.02,.5,169.918,.627451,395.575,.8125,1578.73,.8125,3071,.8125],RGBPoints:[-3024,0,0,0,129.542,.54902,.25098,.14902,145.244,.6,.627451,.843137,157.02,.890196,.47451,.6,169.918,.992157,.870588,.392157,395.575,1,.886275,.658824,1578.73,1,.829256,.957922,3071,.827451,.658824,1],EffectiveRange:[0,1600]},{Name:"CT-Bone",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-16.4458,0,641.385,.715686,3071,.705882],RGBPoints:[-3024,0,0,0,-16.4458,.729412,.254902,.301961,641.385,.905882,.815686,.552941,3071,1,1,1],EffectiveRange:[-16.4458,641.385]},{Name:"CT-Bones",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-1e3,0,152.19,0,278.93,.190476,952,.2],RGBPoints:[-1e3,.3,.3,1,-488,.3,1,.3,463.28,1,0,0,659.15,1,.912535,.0374849,953,1,.3,.3],EffectiveRange:[152.19,952]},{Name:"CT-Cardiac",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-77.6875,0,94.9518,.285714,179.052,.553571,260.439,.848214,3071,.875],RGBPoints:[-3024,0,0,0,-77.6875,.54902,.25098,.14902,94.9518,.882353,.603922,.290196,179.052,1,.937033,.954531,260.439,.615686,0,0,3071,.827451,.658824,1],EffectiveRange:[-77.6875,260.439]},{Name:"CT-Cardiac2",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,42.8964,0,163.488,.428571,277.642,.776786,1587,.754902,3071,.754902],RGBPoints:[-3024,0,0,0,42.8964,.54902,.25098,.14902,163.488,.917647,.639216,.0588235,277.642,1,.878431,.623529,1587,1,1,1,3071,.827451,.658824,1],EffectiveRange:[42.8964,1587]},{Name:"CT-Cardiac3",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-86.9767,0,45.3791,.169643,139.919,.589286,347.907,.607143,1224.16,.607143,3071,.616071],RGBPoints:[-3024,0,0,0,-86.9767,0,.25098,1,45.3791,1,0,0,139.919,1,.894893,.894893,347.907,1,1,.25098,1224.16,1,1,1,3071,.827451,.658824,1],EffectiveRange:[-86.9767,1224.16]},{Name:"CT-Chest-Contrast-Enhanced",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,67.0106,0,251.105,.446429,439.291,.625,3071,.616071],RGBPoints:[-3024,0,0,0,67.0106,.54902,.25098,.14902,251.105,.882353,.603922,.290196,439.291,1,.937033,.954531,3071,.827451,.658824,1],EffectiveRange:[67.0106,439.291]},{Name:"CT-Chest-Vessels",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-1278.35,0,22.8277,.428571,439.291,.625,3071,.616071],RGBPoints:[-3024,0,0,0,-1278.35,.54902,.25098,.14902,22.8277,.882353,.603922,.290196,439.291,1,.937033,.954531,3071,.827451,.658824,1],EffectiveRange:[-1278.35,439.291]},{Name:"CT-Coronary-Arteries",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,136.47,0,159.215,.258929,318.43,.571429,478.693,.776786,3661,1],RGBPoints:[-2048,0,0,0,136.47,0,0,0,159.215,.159804,.159804,.159804,318.43,.764706,.764706,.764706,478.693,1,1,1,3661,1,1,1],EffectiveRange:[136.47,478.693]},{Name:"CT-Coronary-Arteries-2",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,142.677,0,145.016,.116071,192.174,.5625,217.24,.776786,384.347,.830357,3661,.830357],RGBPoints:[-2048,0,0,0,142.677,0,0,0,145.016,.615686,0,.0156863,192.174,.909804,.454902,0,217.24,.972549,.807843,.611765,384.347,.909804,.909804,1,3661,1,1,1],EffectiveRange:[142.677,384.347]},{Name:"CT-Coronary-Arteries-3",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,128.643,0,129.982,.0982143,173.636,.669643,255.884,.857143,584.878,.866071,3661,1],RGBPoints:[-2048,0,0,0,128.643,0,0,0,129.982,.615686,0,.0156863,173.636,.909804,.454902,0,255.884,.886275,.886275,.886275,584.878,.968627,.968627,.968627,3661,1,1,1],EffectiveRange:[128.643,584.878]},{Name:"CT-Cropped-Volume-Bone",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,-451,0,-450,1,1050,1,3661,1],RGBPoints:[-2048,0,0,0,-451,0,0,0,-450,.0556356,.0556356,.0556356,1050,1,1,1,3661,1,1,1],EffectiveRange:[-451,1050]},{Name:"CT-Fat",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-1e3,0,-100,0,-99,.15,-60,.15,-59,0,101.2,0,952,0],RGBPoints:[-1e3,.3,.3,1,-497.5,.3,1,.3,-99,0,0,1,-76.946,0,1,0,-65.481,.835431,.888889,.0165387,83.89,1,0,0,463.28,1,0,0,659.15,1,.912535,.0374849,2952,1,.300267,.299886],EffectiveRange:[-100,101.2]},{Name:"CT-Liver-Vasculature",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,149.113,0,157.884,.482143,339.96,.660714,388.526,.830357,1197.95,.839286,3661,.848214],RGBPoints:[-2048,0,0,0,149.113,0,0,0,157.884,.501961,.25098,0,339.96,.695386,.59603,.36886,388.526,.854902,.85098,.827451,1197.95,1,1,1,3661,1,1,1],EffectiveRange:[149.113,1197.95]},{Name:"CT-Lung",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-1e3,0,-600,0,-599,.15,-400,.15,-399,0,2952,0],RGBPoints:[-1e3,.3,.3,1,-600,0,0,1,-530,.134704,.781726,.0724558,-460,.929244,1,.109473,-400,.888889,.254949,.0240258,2952,1,.3,.3],EffectiveRange:[-600,-399]},{Name:"CT-MIP",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-637.62,0,700,1,3071,1],RGBPoints:[-3024,0,0,0,-637.62,1,1,1,700,1,1,1,3071,1,1,1],EffectiveRange:[-637.62,700]},{Name:"CT-Muscle",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-155.407,0,217.641,.676471,419.736,.833333,3071,.803922],RGBPoints:[-3024,0,0,0,-155.407,.54902,.25098,.14902,217.641,.882353,.603922,.290196,419.736,1,.937033,.954531,3071,.827451,.658824,1],EffectiveRange:[-155.407,419.736]},{Name:"CT-Pulmonary-Arteries",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,-568.625,0,-364.081,.0714286,-244.813,.401786,18.2775,.607143,447.798,.830357,3592.73,.839286],RGBPoints:[-2048,0,0,0,-568.625,0,0,0,-364.081,.396078,.301961,.180392,-244.813,.611765,.352941,.0705882,18.2775,.843137,.0156863,.156863,447.798,.752941,.752941,.752941,3592.73,1,1,1],EffectiveRange:[-568.625,447.798]},{Name:"CT-Soft-Tissue",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,-167.01,0,-160,1,240,1,3661,1],RGBPoints:[-2048,0,0,0,-167.01,0,0,0,-160,.0556356,.0556356,.0556356,240,1,1,1,3661,1,1,1],EffectiveRange:[-167.01,240]},{Name:"CT-Air",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,.705882,-900,.715686,-500,0,3071,0],RGBPoints:[-3024,1,1,1,-900,.2,1,1,-500,.3,.3,1,3071,0,0,0],EffectiveRange:[-1200,-200]},{Name:"CT-X-ray",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-200,0,1500,.05,3071,.05],RGBPoints:[-3024,1,1,1,3071,1,1,1],EffectiveRange:[-250,1550]},{Name:"MR-Angio",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,151.354,0,158.279,.4375,190.112,.580357,200.873,.732143,3661,.741071],RGBPoints:[-2048,0,0,0,151.354,0,0,0,158.279,.74902,.376471,0,190.112,1,.866667,.733333,200.873,.937255,.937255,.937255,3661,1,1,1],EffectiveRange:[151.354,200.873]},{Name:"MR-Default",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[0,0,20,0,40,.15,120,.3,220,.375,1024,.5],RGBPoints:[0,0,0,0,20,.168627,0,0,40,.403922,.145098,.0784314,120,.780392,.607843,.380392,220,.847059,.835294,.788235,1024,1,1,1],EffectiveRange:[0,220]},{Name:"MR-MIP",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[0,0,98.3725,0,416.637,1,2800,1],RGBPoints:[0,1,1,1,98.3725,1,1,1,416.637,1,1,1,2800,1,1,1],EffectiveRange:[0,416.637]},{Name:"MR-T2-Brain",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[0,0,36.05,0,218.302,.171429,412.406,1,641,1],RGBPoints:[0,0,0,0,98.7223,.956863,.839216,.192157,412.406,0,.592157,.807843,641,1,1,1],EffectiveRange:[0,412.406]},{Name:"DTI-FA-Brain",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[0,0,0,0,.3501,.0158,.49379,.7619,.6419,1,.992,1,.995,0,.995,0],RGBPoints:[0,1,0,0,0,1,0,0,.24974,.4941,1,0,.49949,0,.9882,1,.7492,.51764,0,1,.995,1,0,0,.995,1,0,0],EffectiveRange:[0,1]},{Name:"US-Fetal",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-10,0,0,0,270,.8],RGBPoints:[-10,.325,.153,.153,74,.474,.392,.302,136,.718,.51,.443,270,.76,.44,.53],EffectiveRange:[-10,270]},{ColorSpace:"Lab",Name:"2hot",RGBPoints:[-1,.0416667,0,0,-.873016,.208333,0,0,-.746032,.375,0,0,-.619048,.541667,0,0,-.492063,.708333,0,0,-.365079,.854137,0,0,-.238095,.937488,.039062,0,-.111111,1,.208333,0,.015873,1,.375,0,.142857,1,.541667,0,.269841,1,.708333,0,.396825,1,.858805,.03125,.52381,1,.947392,.15625,.650794,1,1,.3125,.777778,1,1,.5625,.904762,1,1,.8125,1,1,1,1]}];function xu(e){for(let t=0;t<e.length;t+=1)Cn.addPreset(e[t])}xu(Tu);const Lu=[{group:"CT",presets:["CT-AAA","CT-AAA2","CT-Bone","CT-Bones","CT-Cardiac","CT-Cardiac2","CT-Cardiac3","CT-Chest-Contrast-Enhanced","CT-Chest-Vessels","CT-Coronary-Arteries","CT-Coronary-Arteries-2","CT-Coronary-Arteries-3","CT-Cropped-Volume-Bone","CT-Fat","CT-Liver-Vasculature","CT-Lung","CT-MIP","CT-Muscle","CT-Pulmonary-Arteries","CT-Soft-Tissue","CT-Air","CT-X-ray"]},{group:"MR",presets:["MR-Default","MR-Angio","MR-MIP","MR-T2-Brain"]},{group:"DTI",presets:["DTI-FA-Brain"]},{group:"US",presets:["US-Fetal"]}],Yn="CT-AAA";Lu.flatMap(e=>e.presets);const Ru={PT:"2hot"};function ku(e){const n=Mt().getLayer(e);if(n&&n.selection.type==="dicom"){const s=we(),{Modality:o=void 0}=s.volumeInfo[n.selection.volumeKey];return o&&Ru[o]||Yn}return Yn}const Qo=()=>({colorBy:{arrayName:"",location:"pointData"},transferFunction:{preset:"",mappingRange:[0,1]},opacityFunction:{mode:ke.Mode.Gaussians,gaussians:[],mappingRange:[0,1]},blendConfig:{opacity:.6}}),Ps=Z("layerColoring",()=>{const e=Ve({}),t=(p,f)=>nn(e,p,f),n=(p,f,m)=>{const y={...Qo(),...t(p,f),...m};xt(e,p,f,y)},s=(p,f=za)=>(m,y,I)=>{const S=t(m,y)??Qo(),b=f({...S[p],...I});n(m,y,{[p]:b})},o=s("colorBy"),a=s("transferFunction"),i=s("opacityFunction"),r=s("blendConfig"),l=(p,f,m)=>{const I=Mt().layerImages[f];if(!I)return;const S=I.getPointData().getScalars().getRange(),b=Es(m);a(p,f,{preset:m,mappingRange:b||S});const R=Ms(m);R.mappingRange=S,i(p,f,R)},c=(p,f,m)=>{const y=m.getPointData().getScalars();o(p,f,{arrayName:y.getName()+f,location:"pointData"}),l(p,f,ku(f))},d=p=>{delete e[p]},h=(p,f)=>{var m;f?(m=e[f])==null||delete m[p]:tn(e,p)},g=on(e,"layers");return{configs:e,getConfig:t,updateConfig:n,updateColorBy:o,updateColorTransferFunction:a,updateOpacityFunction:i,updateBlendConfig:r,resetToDefault:c,setColorPreset:l,removeView:d,removeData:h,serialize:g,deserialize:(p,f)=>{Object.entries(f).forEach(([m,y])=>{y.layers&&n(p,m,y.layers)})}}}),po=Z("viewCamera",()=>{const e=Ve({}),t=(r,l)=>nn(e,r,l),n=(r,l,c)=>{const d={...t(r,l),...c};xt(e,r,l,d)},s=r=>{delete e[r]},o=(r,l)=>{var c;l?(c=e[l])==null||delete c[r]:tn(e,r)},a=on(e,"camera");return{configs:e,getConfig:t,updateConfig:n,removeView:s,removeData:o,serialize:a,deserialize:(r,l)=>{Object.entries(l).forEach(([c,d])=>{d.camera&&n(r,c,d.camera)})}}}),Mu=.2,Eu=.7,Pu=.3;function Ou(e){const t=we();if(e in t.imageIDToVolumeKey){const n=t.imageIDToVolumeKey[e],{Modality:s}=t.volumeInfo[n];if(s in Zo)return Zo[s]}return Yn}const ea=()=>({colorBy:{arrayName:"",location:"pointData"},transferFunction:{preset:"",mappingRange:[0,1]},opacityFunction:{mode:ke.Mode.Gaussians,gaussians:[],mappingRange:[0,1]},cvr:{enabled:!0,lightFollowsCamera:!0,volumeQuality:2,useVolumetricScatteringBlending:!0,volumetricScatteringBlending:.5,useLocalAmbientOcclusion:!0,laoKernelRadius:5,laoKernelSize:15,ambient:Mu,diffuse:Eu,specular:Pu}}),Au=Z("volumeColoring",()=>{const e=Ve({}),t=(p,f)=>nn(e,p,f),n=(p,f,m)=>{const y={...ea(),...t(p,f),...m};xt(e,p,f,y)},s=(p,f=za)=>(m,y,I)=>{const S=t(m,y)??ea(),b=f({...S[p],...I});n(m,y,{[p]:b})},o=s("colorBy"),a=s("transferFunction"),i=s("opacityFunction"),r=s("cvr"),l=(p,f,m)=>{const I=Pe().dataIndex[f];if(!I)return;const S=I.getPointData().getScalars().getRange(),b=Es(m);a(p,f,{preset:m,mappingRange:b||S});const R=Ms(m);R.mappingRange=S,i(p,f,R)},c=(p,f,m)=>{const y=m.getPointData().getScalars();o(p,f,{arrayName:y.getName(),location:"pointData"}),l(p,f,Ou(f))},d=p=>{delete e[p]},h=(p,f)=>{var m;f?(m=e[f])==null||delete m[p]:tn(e,p)},g=on(e,"volumeColorConfig");return{configs:e,getConfig:t,updateConfig:n,updateColorBy:o,updateColorTransferFunction:a,updateOpacityFunction:i,updateCVRParameters:r,resetToDefaultColoring:c,setColorPreset:l,removeView:d,removeData:h,serialize:g,deserialize:(p,f)=>{Object.entries(f).forEach(([m,y])=>{y.volumeColorConfig&&n(p,m,y.volumeColorConfig)})}}}),ta=Z("viewConfig",()=>{const e=st(),t=ho(),n=Ps(),s=po(),o=Au(),a=d=>{e.removeView(d),t.removeView(d),n.removeView(d),s.removeView(d),o.removeView(d)},i=(d,h)=>{e.removeData(d,h),t.removeData(d,h),n.removeData(d,h),s.removeData(d,h),o.removeData(d,h)},r=d=>{e.serialize(d),t.serialize(d),n.serialize(d),s.serialize(d),o.serialize(d)},l=(d,h,g)=>{const v={};Object.entries(h).forEach(([p,f])=>{const m=g[p];v[m]=f}),e.deserialize(d,v),t.deserialize(d,v),n.deserialize(d,v),s.deserialize(d,v),o.deserialize(d,v)};return Pe().$onAction(({name:d,args:h})=>{if(d==="deleteData"){const[g]=h;i(g)}}),{removeView:a,removeData:i,serialize:r,deserialize:l}}),ue=Z("view",{state:()=>({layout:{direction:Le.V,items:[]},viewSpecs:structuredClone(Is)}),getters:{viewIDs(e){return Object.keys(e.viewSpecs)},getViewProxy(){return e=>this.$proxies.getView(e)},getDataRepresentationForView(){return(e,t)=>this.$proxies.getDataRepresentationForView(e,t)}},actions:{createOrGetViewProxy(e,t){return this.$proxies.getView(e)??this.$proxies.createView(e,t)},addView(e){e in this.viewSpecs||(this.viewSpecs[e]=structuredClone(ou))},removeView(e){e in this.viewSpecs&&(delete this.viewSpecs[e],this.$proxies.removeView(e))},setLayout(e){this.layout=e;const t=[e];for(;t.length;)t.shift().items.forEach(s=>{typeof s=="string"?this.addView(s):t.push(s)})},serialize(e){const t=ta(),{manifest:n}=e,{views:s}=n;n.layout=this.layout,Object.entries(this.viewSpecs).forEach(([o,a])=>{const i=a.viewType,{props:r}=a,c={id:o,type:i,props:r,config:{}};s.push(c)}),t.serialize(e)},deserialize(e,t){const n=ta();e.forEach(s=>{const o=s.id,a={viewType:s.type,props:s.props};this.viewSpecs[o]=a;const{config:i}=s;n.deserialize(o,i,t)})}}}),Kt=Z("crosshairs",()=>{const e=_u.newInstance(),t=e.getWidgetState(),n=t.getHandle(),s=V(!1),{currentImageID:o,currentImageMetadata:a}=le(),i=V([0,0,0]),r=T(()=>{const y=Me();return pe(y,i.value,a.value.worldToIndex),y}),l=st(),c=ue(),d=T(()=>{const y=U(o);return y?c.viewIDs.filter(I=>!!l.getConfig(I,y)):[]});function h(){return e}function g(y){i.value=y}N(r,y=>{if(s.value){const I=U(o),{lpsOrientation:S}=U(a);if(!I)return;d.value.forEach(b=>{const E=l.getConfig(b,I),R=Ie(E.axisDirection),O=S[R],k=Math.round(y[O]);l.updateConfig(b,I,{slice:k})})}}),N(a,y=>{t.setIndexToWorld(y.indexToWorld),t.setWorldToIndex(y.worldToIndex);const[I,S,b]=y.dimensions,E=[0,I-1,0,S-1,0,b-1];n.setBounds(zr(E,.5))},{immediate:!0}),n.onModified(()=>{const y=n.getOrigin();y&&(i.value=y)});function v(){return t.setPlaced(!1),s.value=!0,!0}function p(){s.value=!1}function f(y){const{crosshairs:I}=y.manifest.tools;I.position=i.value}function m(y){const{crosshairs:I}=y.tools;i.value=I.position}return{getWidgetFactory:h,setPosition:g,position:i,imagePosition:r,activateTool:v,deactivateTool:p,serialize:f,deserialize:m}}),Bu=4,Vu=1,dt=Z("paint",()=>{const e=V(null),t=V(Bu),n=V(Vu),s=V([]),o=V(1),a=V(!1),{currentImageID:i}=le();function r(){return this.$paint.factory}const l=T(()=>e.value?yn().labelmaps[e.value]??null:null);function c(R){if(!R){e.value=null;return}const O=yn(),k=Object.entries(O.parentImage).find(([,H])=>R===H);k?[e.value]=k:e.value=O.newLabelmapFromImage(R)}function d(R){t.value=Math.round(R),this.$paint.setBrushSize(R)}function h(R){n.value=R,this.$paint.setBrushValue(R)}function g(R){o.value=Math.min(1,Math.max(0,R))}function v(R){if(!l.value)return;const O=s.value.length-1;if(O>=0){const k=s.value[O],H=O>=1?s.value[O-1]:void 0;this.$paint.paintLabelmap(l.value,R,k,H)}}function p(R){if(!l.value)return;const O=l.value.getSpacing();O.splice(R,1);const k=[1/O[0],1/O[1]];this.$paint.setBrushScale(k)}function f(R,O){s.value=[pa(R)],v.call(this,O)}function m(R,O){s.value.push(R),v.call(this,O)}function y(R,O){s.value.push(R),v.call(this,O)}function I(){const R=i.value;return R?(c(R),this.$paint.setBrushSize(this.brushSize),a.value=!0,!0):!1}function S(){e.value=null,a.value=!1}function b(R){const{paint:O}=R.manifest.tools;O.activeLabelmapID=e.value,O.brushSize=t.value,O.brushValue=n.value,O.labelmapOpacity=o.value}function E(R,O){const{paint:k}=R.tools;this.setBrushSize(k.brushSize),this.setBrushValue(k.brushValue),this.setLabelmapOpacity(k.labelmapOpacity),a.value=R.tools.current===ce.Paint,k.activeLabelmapID!==null&&(e.value=O[k.activeLabelmapID])}return N(i,R=>{a.value&&c(R)}),{activeLabelmapID:e,brushSize:t,brushValue:n,strokePoints:s,labelmapOpacity:o,isActive:a,getWidgetFactory:r,activateTool:I,deactivateTool:S,selectOrCreateLabelmap:c,setBrushSize:d,setBrushValue:h,setLabelmapOpacity:g,setSliceAxis:p,startStroke:f,placeStrokePoint:m,endStroke:y,serialize:b,deserialize:E}}),na=Me();function Ln(e,t,n){const s=(n==null?void 0:n.epsilon)??Qn,o=(n==null?void 0:n.allowNonIntegralSlice)??!1,a=(n==null?void 0:n.allowOutOfBoundsSlice)??!1,{planeNormal:i,planeOrigin:r}=e,{dimensions:l,lpsOrientation:c,worldToIndex:d}=t;let h=null;const{Left:g,Right:v,Posterior:p,Anterior:f,Superior:m,Inferior:y}=c;if(lt(g,i)||lt(v,i)?h="Sagittal":lt(p,i)||lt(f,i)?h="Coronal":(lt(m,i)||lt(y,i))&&(h="Axial"),!h)return null;pe(na,r,d);const I=c[h],S=fl(na[I],s);return!o&&!Number.isInteger(S)||!a&&(S<0||S>=l[I])?null:{axis:h,slice:S}}const $u={labelName:"New Label"},Fu=e=>{const t=V({}),n=V(),s=h=>{n.value=h},o=(h={})=>{const g=It().nextId();return t.value[g]={...$u,...e,...h},s(g),g},a=h=>{if(!(h in t.value))throw new Error("Label does not exist");if(delete t.value[h],t.value={...t.value},h===n.value){const g=Object.keys(t.value);g.length!==0?s(g[0]):s("")}},i=(h,g)=>{if(!(h in t.value))throw new Error("Label does not exist");t.value={...t.value,[h]:{...t.value[h],...g}}},r=V(!0),l=()=>{r.value&&(t.value={}),r.value=!1},c=(h,g=!0)=>{g&&l();const{labelName:v}=h,p=Object.entries(t.value).find(([,{labelName:f}])=>f===v);if(p){const[f]=p;return i(f,h),f}return o(h)};return{labels:t,activeLabel:n,setActiveLabel:s,addLabel:o,deleteLabel:a,updateLabel:i,mergeLabel:c,mergeLabels:(h,g=!0)=>{Object.entries(h??{}).forEach(([v,p])=>c({...p,labelName:v},g))}}},Nu=()=>({frameOfReference:{planeOrigin:[0,0,0],planeNormal:[1,0,0]},slice:-1,imageID:"",placing:!1,color:au[0],name:"baseAnnotationTool"}),fo=({toolDefaults:e,initialLabels:t,newLabelDefault:n})=>{const s=V([]),o=V(Object.create(null)),a=T(()=>{const m=o.value;return s.value.map(y=>m[y])}),i=Fu(n);i.mergeLabels(t,!1);function r(m){if(!m)return{labelName:""};const y=i.labels.value[m];return y||{labelName:""}}function l(m){const y=It().nextId();if(y in o.value)throw new Error("Cannot add tool with conflicting ID");return o.value[y]={...Nu(),...e(),label:i.activeLabel.value,...m,...r(m.label),id:y},s.value.push(y),y}function c(m){m in o.value&&(jt(s.value,m),delete o.value[m])}function d(m,y){m in o.value&&(o.value[m]={...o.value[m],...y,id:m})}N(i.labels,()=>{s.value.forEach(m=>{const y=o.value[m],I=r(y.label);d(m,{...y,...I})})});function h(m){const y=o.value[m],{currentImageID:I,currentImageMetadata:S}=le(),b=I.value;if(!b||y.imageID!==b)return;const E=Ln(y.frameOfReference,S.value);if(!E)return;const R=ue(),O=R.viewIDs.filter(H=>{const ee=R.viewSpecs[H].props.viewDirection;return ee&&Ie(ee)===E.axis}),k=st();O.forEach(H=>{k.updateConfig(H,b,{slice:y.slice})})}const g=()=>!0,v=()=>{},p=()=>({tools:s.value.map(y=>o.value[y]).filter(y=>!y.placing).map(({imageID:y,...I})=>({imageID:ys(y),...I})),labels:i.labels.value});function f(m,y){const I=Object.fromEntries(Object.entries((m==null?void 0:m.labels)??{}).map(([S,b])=>{const E=i.mergeLabel(b);return[S,E]}));m==null||m.tools.map(({imageID:S,label:b,...E})=>({...E,imageID:ws(y[S]),label:b&&I[b]||""})).forEach(S=>l.call(this,S))}return{...i,toolIDs:s,toolByID:o,tools:a,addTool:l,removeTool:c,updateTool:d,jumpToTool:h,activateTool:g,deactivateTool:v,serialize:p,deserialize:f}},Hu=()=>({firstPoint:[0,0,0],secondPoint:[0,0,0],id:"",name:"Ruler"}),zu={color:"#ffffff"},ot=Z("ruler",()=>{const{toolIDs:e,toolByID:t,tools:n,addTool:s,updateTool:o,removeTool:a,jumpToTool:i,serialize:r,deserialize:l,activateTool:c,deactivateTool:d,...h}=fo({toolDefaults:Hu,initialLabels:su,newLabelDefault:zu}),g=T(()=>{const f=t.value;return e.value.reduce((m,y)=>{const{firstPoint:I,secondPoint:S}=f[y];return Object.assign(m,{[y]:Math.sqrt(Pa(I,S))})},{})});function v(f){f.manifest.tools.rulers=r()}function p(f,m){l.call(this,f.tools.rulers,m)}return{...h,rulerIDs:e,rulerByID:t,rulers:n,lengthByID:g,addRuler:s,updateRuler:o,removeRuler:a,jumpToRuler:i,serialize:v,deserialize:p,activateTool:c,deactivateTool:d}}),Wu=()=>({firstPoint:[0,0,0],secondPoint:[0,0,0],id:"",name:"Rectangle",fillColor:"transparent"}),ju={color:"#ffffff",fillColor:"transparent"},at=Z("rectangles",()=>{const{serialize:e,deserialize:t,...n}=fo({toolDefaults:Wu,initialLabels:iu,newLabelDefault:ju});function s(a){a.manifest.tools.rectangles=e()}function o(a,i){t.call(this,a.tools.rectangles,i)}return{...n,serialize:s,deserialize:o}});function Os(){return{t:yt(),_tInv:null}}const Nt=Me(),oa=ma();function Rn(e,t,n){const s=n??Me();return ya(Nt,e[0],e[1],0),pe(s,Nt,t.t),s}function As(e){const t=yt();return Oi(t,e),t}function Uu(e){return e._tInv=e._tInv??As(e.t),e._tInv}function nt(e,t,n){const s=n??Ne(),o=Uu(t);return pe(Nt,e,o),wt(s,Nt[0],Nt[1]),s}function Gu(e){const t=[0,0,0];pe(t,t,e.t);const n=[0,0,1];return Ai(oa,e.t),Bi(n,n,oa),Vi(n,n),{planeNormal:n,planeOrigin:t}}const Xu={0:Vt(0,1,0,0,0,0,1,0,1,0,0,0,0,0,0,1),1:Vt(1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1),2:yt()};function Ku(e,t,n){const s=yt();return $i(s,[0,0,t]),Ao(s,Xu[n],s),Ao(s,e,s),{t:s,_tInv:As(s)}}var ye=(e=>(e.Select="Select",e.FreehandDraw="FreehandDraw",e.CircleNudge="CircleNudge",e.PointPlacing="PointPlacing",e.Threshold="Threshold",e))(ye||{});const qu=()=>({id:"",name:"Contour",polyLine:[],referencePlane:Os()}),Et=Z("contour",()=>{const e=V(),t=V("FreehandDraw"),{serialize:n,deserialize:s,...o}=fo({toolDefaults:qu,initialLabels:{Endothelium:{color:"#008000"},Epithelium:{color:"#ff0000"}},newLabelDefault:{color:"#ff0000"}});function a(l){e.value=l}function i(l){return e.value===l&&(e.value=null),o.removeTool(l)}function r(l){t.value=l}return{...o,removeTool:i,serialize:()=>{},deserialize:()=>{},selectedContourID:e,mode:t,selectContour:a,setMode:r}});function Bs(e){return e===ce.Ruler?ot():e===ce.Rectangle?at():e===ce.Paint?dt():e===ce.Crosshairs?Kt():e===ce.Contour?Et():null}function Yu(e){const t=Bs(e);return t?t.activateTool():!0}function Ju(e){const t=Bs(e);t&&t.deactivateTool()}const ze=Z("tool",{state:()=>({currentTool:ce.WindowLevel}),actions:{setCurrentTool(e){Yu(e)&&(Ju(this.currentTool),this.currentTool=e)},serialize(e){const{tools:t}=e.manifest,n=ot(),s=at(),o=Kt(),a=dt(),i=Tt();n.serialize(e),s.serialize(e),o.serialize(e),a.serialize(e),i.serialize(e),t.current=this.currentTool},deserialize(e,t,n){const{tools:s}=e,o=ot(),a=at(),i=Kt(),r=dt(),l=Tt();o.deserialize(e,n),a.deserialize(e,n),i.deserialize(e),r.deserialize(e,t),l.deserialize(e,n),this.currentTool=s.current}}}),Vs="manifest.json";async function Zu(e){const t=await ul(e);return Na.has(t.type)?(await va.loadAsync(t)).file(Vs)!==null:!1}const mo=(e,{done:t})=>t({dataSource:e}),kn=async e=>{let t=e;const{fileSrc:n}=t;if(n&&n.fileType===""){const s=await Ha(n.file);s&&(t={...t,fileSrc:{...n,fileType:s}})}return t},Qu=async(e,{extra:t,done:n})=>{const{uriSrc:s}=e;if(s){const o=await new xn([Ss,kn,mo]).execute(e,t);if(!o.ok)throw o.errors[0].cause;return n({dataSource:o.data[0].dataSource})}return e},e0=async(e,{execute:t})=>{const{fileSrc:n,parent:s}=e;if(!n&&s){const o=await t(s);if(!o.ok)throw new Error("Could not process parent",{cause:ml(o.errors[0].cause)});return{...e,parent:o.data[0].dataSource}}return e},t0=async(e,{extra:t,done:n})=>{if(e.archiveSrc){const o=await new xn([Cs,kn,mo]).execute(e,t);if(!o.ok)throw o.errors[0].cause;return n({dataSource:o.data[0].dataSource})}return e};function n0(e,t,n){const s=n.filter(a=>bt(a.archivePath)===bt(e.path)).map(a=>us(a.file)),o=t.remoteFiles[e.id]??[];return[...s,...o]}async function o0(e,t,{extra:n,execute:s}){const o=new Map,a=t.map(c=>({...c,archivePath:bt(c.archivePath)})),{datasets:i}=e,r={},l=new xn([kn,Qu,e0,t0,mo]);return await Promise.all(i.map(async c=>{let d=n0(c,e,a);d=await Promise.all(d.map(async v=>{const p=await l.execute(v,{...n,archiveCache:o});if(!p.ok)throw p.errors[0].cause;return p.data[0].dataSource}));const h=[],g=await Promise.all(d.map(v=>s(v,{...n,archiveCache:o,dicomDataSources:h})));if(h.length){const v=we(),p=await v.importFiles(h);if(p.length!==1)throw new Error("Obtained more than one volume from DICOM import");const[f]=p;await v.buildVolume(f),r[c.id]=f}else if(g.length===1){if(!g[0].ok)throw g[0].errors[0].cause;const[v]=g;if(v.data.length!==1)throw new Error("Import encountered multiple volumes for a single dataset");const{dataID:p}=v.data[0];if(!p)throw new Error("Failed to import dataset");r[c.id]=p}else throw new Error("Could not load any data from the session")})),r}const a0=async(e,{done:t,extra:n,execute:s})=>{const{fileSrc:o}=e;if(o&&await Zu(o.file)){const a=await co(o.file),[i,r]=Dn(h=>h.file.name===Vs,a);if(i.length!==1)throw new Error("State file does not have exactly 1 manifest");const l=_d.parse(JSON.parse(await i[0].file.text()));ue().setLayout(l.layout);const c=await o0(l,r,{extra:n,execute:s,done:t});if(l.primarySelection!==void 0){const h=c[l.primarySelection];let g;h in we().volumeInfo?g=Ut(h):g=Gt(h),Tn().setPrimarySelection(g)}ue().deserialize(l.views,c);const d=await yn().deserialize(l,r,c);return ze().deserialize(l,d,c),Mt().deserialize(l,c),t()}return e},$s=C.string(),vo=C.object({color:$s}),s0=vo,i0=C.intersection(vo,C.object({fillColor:$s})),r0=C.object({labels:C.record(vo).or(C.null()).optional(),rulerLabels:C.record(s0).or(C.null()).optional(),rectangleLabels:C.record(i0).or(C.null()).optional()}),l0=async e=>{const t=new TextDecoder,n=await e.arrayBuffer(),s=t.decode(new Uint8Array(n));return r0.parse(JSON.parse(s))},c0=e=>{const t=n=>n===void 0?e.labels:n;ot().mergeLabels(t(e.rulerLabels)),at().mergeLabels(t(e.rectangleLabels))},d0=async(e,{done:t})=>{const{fileSrc:n}=e;if((n==null?void 0:n.fileType)==="application/json"){try{const s=await l0(n.file);c0(s)}catch{return e}return t()}return e};function u0(e){if(e.data.length===0)return null;const{dataID:t,dataType:n}=e.data[0];return t?n==="dicom"?Ut(t):n==="image"?Gt(t):null:null}function h0(e){const t=String(e);return!t||t==="[object Object]"?"Unknown error. More details in the dev console.":t}const g0=()=>{throw new Error("Failed to handle resource")};async function p0(e){const t=[kn,d0,a0,Qd,Kd,zd,Ss,Cs,Ad,kd,qd,g0],n={fetchFileCache:new Map,dicomDataSources:[]},s=new xn(t),o=await Promise.all(e.map(r=>s.execute(r,n)));if(!n.dicomDataSources.length)return o;const a={dicomSrc:{sources:n.dicomDataSources}},i={ok:!0,data:[],errors:[]};try{const r=await we().importFiles(n.dicomDataSources);i.data.push(...r.map(l=>({dataID:l,dataType:"dicom",dataSource:a})))}catch(r){i.ok=!1,i.errors.push({message:h0(r),cause:r,inputDataStackTrace:[a]})}return[...o.filter(r=>r.data.length),i]}const f0={name:"ToolButton",props:{icon:{type:String,required:!0},name:{type:String,required:!0},size:{type:[Number,String],default:40},buttonClass:[String,Array,Object],tooltipLocation:{type:String,default:"right"}},computed:{sizeV(){return Number(this.size)},iconSize(){return Math.floor(.6*this.sizeV)},classV(){const e=this.buttonClass;return typeof e=="string"?e:Array.isArray(e)?e.join(" "):e&&Object.keys(e).length?Object.keys(this.buttonClass).filter(t=>this.buttonClass[t]).join(" "):""}}};function m0(e,t,n,s,o,a){return D(),Y(mt,Jt({variant:"text",rounded:0,dark:"",height:a.sizeV,width:a.sizeV,"min-width":a.sizeV,"max-width":a.sizeV,class:a.classV},e.$attrs),{default:L(()=>[w(_t,{size:a.iconSize},{default:L(()=>[X(F(n.icon),1)]),_:1},8,["size"]),w(ba,{location:n.tooltipLocation,activator:"parent",transition:"slide-x-transition"},{default:L(()=>[u("span",null,F(n.name),1)]),_:1},8,["location"]),De(e.$slots,"default")]),_:3},16,["height","width","min-width","max-width","class"])}const Ze=A(f0,[["render",m0]]),Fs=Symbol("ItemGroup"),v0=q({props:{modelValue:null,mandatory:Boolean,equalsTest:Function},setup(e,{emit:t,slots:n}){const{modelValue:s,mandatory:o,equalsTest:a}=ie(e),i=V();return N(s,c=>{c!==i.value&&(i.value=c)}),se(()=>{i.value=s.value}),Gn(Fs,{selectItem:c=>{o.value&&!c||(i.value=c,t("update:modelValue",i.value))},isSelected:c=>i.value==null?!1:a.value?a.value(c,i.value):c===i.value}),()=>{var c;return(c=n.default)==null?void 0:c.call(n)}}}),y0=q({props:{value:{type:null,required:!0}},setup(e,{slots:t}){const{value:n}=ie(e),s=Rt(Fs);if(!s)throw new Error("GroupableItem needs ItemGroup!");const o=()=>{s.selectItem(n.value)},a=()=>{s&&s.selectItem(s.isSelected(n.value)?void 0:n.value)};return()=>{var i;return(i=t.default)==null?void 0:i.call(t,{active:s.isSelected(n.value),select:o,toggle:a})}}});function Ns(e){return`#${e.map(n=>`0${n.toString(16)}`.slice(-2)).join("")}`}function w0(e){const t=e.startsWith("#")?e.substring(1):e,n=[0,0,0,255],s=Math.min(4,t.length/2);for(let o=0;o<s;o++)n[o]=Number.parseInt(t.substring(2*o,2*o+2),16);return n}function S0(e,t=5){const n={},s=[],o=Object.entries(e);for(;o.length;){const[a,i]=o.shift(),r=Ns(i).toUpperCase();n[r]=Number(a);let l=s[s.length-1];(!l||l.length===t)&&(l=[],s.push(l)),l.push(r)}return{hexToValue:n,swatches:s}}const _0=q({name:"PaintControls",setup(){const e=dt(),{hexToValue:t,swatches:n}=S0(Ft,3),s=T(()=>{const c=e.brushValue;return c in Ft?Ns(Ft[c]):null}),o=c=>{const d=`${c}FF`.toUpperCase();d in t&&e.setBrushValue(t[d])},a=T(()=>e.brushSize),i=c=>{e.setBrushSize(Number(c))},r=T(()=>e.labelmapOpacity);return{brushSize:a,setBrushSize:i,swatches:n,brushColor:s,setBrushColor:o,opacity:r,setOpacity:c=>{e.setLabelmapOpacity(Number(c))}}}});function C0(e,t,n,s,o,a){return D(),Y(Zt,{width:"350px"},{default:L(()=>[w(Ia,null,{default:L(()=>[w(gn,{"no-gutters":"",align:"center"},{default:L(()=>[w($t,null,{default:L(()=>[w(Fo,{"model-value":e.brushSize,"onUpdate:modelValue":e.setBrushSize,density:"compact","hide-details":"",label:"Size",min:"1",max:"50"},{append:L(()=>[w(Xn,{"model-value":e.brushSize,onInput:e.setBrushSize,variant:"underlined",class:"mt-n1 pt-0",style:{width:"40px"},"hide-details":"",type:"number",min:"1",max:"50"},null,8,["model-value","onInput"])]),_:1},8,["model-value","onUpdate:modelValue"])]),_:1})]),_:1}),w(gn,{"no-gutters":"",align:"center"},{default:L(()=>[w($t,null,{default:L(()=>[w(Fo,{"model-value":e.opacity,"onUpdate:modelValue":e.setOpacity,density:"compact","hide-details":"",label:"Opacity",min:"0",max:"1",step:"0.01"},{append:L(()=>[w(Xn,{"model-value":e.opacity,onInput:e.setOpacity,variant:"underlined",class:"mt-n1 pt-0",style:{width:"40px"},"hide-details":"",type:"number",min:"0",max:"1",step:"0.1"},null,8,["model-value","onInput"])]),_:1},8,["model-value","onUpdate:modelValue"])]),_:1})]),_:1}),w(gn,{"no-gutters":"",align:"center"},{default:L(()=>[w($t,null,{default:L(()=>[w(Da,{"hide-canvas":"","hide-inputs":"","hide-mode-switch":"","hide-sliders":"","show-swatches":"",elevation:"0",swatches:e.swatches,"model-value":e.brushColor,"onUpdate:modelValue":e.setBrushColor},null,8,["swatches","model-value","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})}const b0=A(_0,[["render",C0],["__scopeId","data-v-6027fe65"]]),D0=q({name:"MenuToolButton",props:{icon:{type:String,required:!0},name:{type:String,required:!0},size:{type:[Number,String],default:40},active:Boolean,disabled:Boolean,mobileOnlyMenu:Boolean},components:{ToolButton:Ze},setup(e){const t=Ta(),n=T(()=>!t.mobile.value),s=V(!1),o=T(()=>!e.mobileOnlyMenu||t.mobile.value);N(s,i=>{s.value=i&&o.value});const a=T(()=>e.active);return N(a,i=>{i||(s.value=!1)}),{showLeft:n,menuOn:s,enableMenu:o}}});const I0={class:"menu-content elevation-24"};function T0(e,t,n,s,o,a){const i=M("tool-button");return D(),Y(Ct,{"no-click-animation":"","close-on-content-click":!1,modelValue:e.menuOn,"onUpdate:modelValue":t[1]||(t[1]=r=>e.menuOn=r),location:e.showLeft?"left":"right",class:"overflow-auto"},{activator:L(({props:r})=>[w(i,Jt({icon:e.icon,name:e.name,buttonClass:["tool-btn",e.active?"tool-btn-selected":""],disabled:e.disabled,size:e.size,onClick:t[0]||(t[0]=l=>e.$emit("click"))},r),{default:L(()=>[e.active&&e.enableMenu?(D(),Y(_t,{key:0,class:$([e.showLeft?"menu-more-left":"menu-more-right"]),size:"18"},{default:L(()=>[X(F(e.showLeft?"mdi-menu-left":"mdi-menu-right"),1)]),_:1},8,["class"])):z("",!0)]),_:2},1040,["icon","name","buttonClass","disabled","size"])]),default:L(()=>[u("div",I0,[De(e.$slots,"default",{},void 0,!0)])]),_:3},8,["modelValue","location"])}const x0=A(D0,[["render",T0],["__scopeId","data-v-b1e30b7b"]]),L0=q({components:{ToolButton:Ze},setup(){const{currentImageID:e}=le(),t=Tt();return{resetCrop:()=>{const s=e.value;s&&t.resetCropping(s)}}}});function R0(e,t,n,s,o,a){const i=M("tool-button");return D(),Y(Zt,{dark:""},{default:L(()=>[w(i,{size:"40",icon:"mdi-restore",name:"Reset Crop",onClick:e.resetCrop},null,8,["onClick"])]),_:1})}const k0=A(L0,[["render",R0]]),M0={class:"d-flex flex-row"},E0={class:"flex-grow-1 d-flex flex-column justify-space-between mr-4"},P0=q({__name:"LabelEditor",props:{label:null,labelsStore:null},emits:["close"],setup(e,{emit:t}){const n=e,s=T(()=>n.labelsStore.labels[n.label]),o=V(s.value.labelName);N(o,r=>{n.labelsStore.updateLabel(n.label,{labelName:r})});const a=V(vl(s.value.color));N(a,r=>{n.labelsStore.updateLabel(n.label,{color:r})});const i=()=>{t("close"),n.labelsStore.deleteLabel(n.label)};return(r,l)=>(D(),Y(Zt,null,{default:L(()=>[w(hr,{class:"d-flex flex-row align-center"},{default:L(()=>[X(" Edit Label "),w(No),w(mt,{variant:"text",density:"compact",icon:"mdi-close",onClick:l[0]||(l[0]=c=>r.$emit("close"))})]),_:1}),w(pr,null,{default:L(()=>[u("div",M0,[u("div",E0,[u("div",null,[w(Xn,{modelValue:o.value,"onUpdate:modelValue":l[1]||(l[1]=c=>o.value=c),onKeydown:l[2]||(l[2]=vt(Se(c=>r.$emit("close"),["stop"]),["enter"])),label:"Name",class:"flex-grow-0"},null,8,["modelValue"])]),w(gr,{class:"mb-2 px-0"},{default:L(()=>[w(mt,{color:"secondary",variant:"elevated",onClick:l[3]||(l[3]=c=>r.$emit("close"))},{default:L(()=>[X(" Done ")]),_:1}),w(No),w(mt,{color:"red",variant:"tonal",onClick:i},{default:L(()=>[X(" Delete label ")]),_:1})]),_:1})]),w(Da,{modelValue:a.value,"onUpdate:modelValue":l[4]||(l[4]=c=>a.value=c),mode:"rgb",label:"Color"},null,8,["modelValue"])])]),_:1})]),_:1}))}}),O0={class:"dot-container mr-3"},A0={class:"overflow-hidden"},B0=q({__name:"LabelControls",props:{labelsStore:null},setup(e){const t=e,n=T(()=>Object.entries(t.labelsStore.labels)),s=T(()=>n.value.findIndex(([c])=>c===t.labelsStore.activeLabel)),o=V(void 0),a=()=>{o.value=t.labelsStore.addLabel()},i=V(!1);ge(()=>{i.value=!!o.value});const r=Ta(),l=T(()=>r.mobile.value);return(c,d)=>(D(),x(ne,null,[w(Zt,{class:"pt-2"},{default:L(()=>[w(xa,null,{default:L(()=>[X("Labels")]),_:1}),w(Ia,null,{default:L(()=>[w(La,{"model-value":U(s),"selected-class":"card-active",mandatory:""},{default:L(()=>[w(gn,{dense:""},{default:L(()=>[(D(!0),x(ne,null,fe(U(n),([h,{labelName:g,color:v}])=>(D(),Y($t,{cols:"6",key:h},{default:L(()=>[w(pt,null,{default:L(({selectedClass:p,toggle:f})=>[w(Ho,{variant:"tonal",class:$(["w-100 d-flex",p]),onClick:()=>{f(),e.labelsStore.setActiveLabel(h)}},{default:L(()=>[u("div",O0,[u("div",{class:"color-dot",style:j({background:v})},null,4)]),u("span",A0,F(g),1),w(mt,{icon:"mdi-pencil",density:"compact",class:"ml-auto",variant:"plain",onClick:Se(()=>{o.value=h,i.value=!0},["stop"])},null,8,["onClick"])]),_:2},1032,["class","onClick"])]),_:2},1024)]),_:2},1024))),128)),w($t,{cols:"6"},{default:L(()=>[w(Ho,{variant:"outlined",class:"w-100",onClick:a},{default:L(()=>[w(_t,{class:"mr-2"},{default:L(()=>[X("mdi-plus")]),_:1}),X(" Add Label ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])]),_:1})]),_:1}),w(fr,{modelValue:i.value,"onUpdate:modelValue":d[1]||(d[1]=h=>i.value=h),width:U(l)?"100%":"50%"},{default:L(()=>[o.value?(D(),Y(P0,{key:0,onClose:d[0]||(d[0]=h=>o.value=void 0),label:o.value,labelsStore:e.labelsStore},null,8,["label","labelsStore"])):z("",!0)]),_:1},8,["modelValue","width"])],64))}});const yo=A(B0,[["__scopeId","data-v-3ba66c80"]]),V0=q({__name:"RulerControls",setup(e){const t=ot();return(n,s)=>(D(),Y(yo,{"labels-store":U(t)},null,8,["labels-store"]))}}),$0=q({__name:"RectangleControls",setup(e){const t=at();return(n,s)=>(D(),Y(yo,{"labels-store":U(t)},null,8,["labels-store"]))}}),F0=q({__name:"ContourControls",setup(e){const t=Et(),{mode:n}=St(t);function s(o){t.setMode(o)}return(o,a)=>(D(),Y(Zt,{dark:""},{default:L(()=>[w(xa,{class:"my-1"},{default:L(()=>[X("Tools")]),_:1}),w(La,{mandatory:"","selected-class":"tool-btn-selected","model-value":U(n),"onUpdate:modelValue":s},{default:L(()=>[w(pt,{value:U(ye).Select},{default:L(({selectedClass:i,toggle:r})=>[w(Ze,{size:"40",icon:"mdi-cursor-default",name:"Select",buttonClass:i||"",onClick:r},null,8,["buttonClass","onClick"])]),_:1},8,["value"]),w(pt,{value:U(ye).FreehandDraw},{default:L(({selectedClass:i,toggle:r})=>[w(Ze,{size:"40",icon:"mdi-draw",name:"Freehand",buttonClass:i||"",onClick:r},null,8,["buttonClass","onClick"])]),_:1},8,["value"]),w(pt,{value:U(ye).PointPlacing},{default:L(({selectedClass:i,toggle:r})=>[w(Ze,{size:"40",icon:"mdi-vector-polyline",name:"Point Placing",buttonClass:i||"",onClick:r},null,8,["buttonClass","onClick"])]),_:1},8,["value"]),w(pt,{value:U(ye).Threshold},{default:L(({selectedClass:i,toggle:r})=>[w(Ze,{size:"40",icon:"mdi-math-integral",name:"Threshold",buttonClass:i||"",onClick:r},null,8,["buttonClass","onClick"])]),_:1},8,["value"]),w(pt,{value:U(ye).CircleNudge},{default:L(({selectedClass:i,toggle:r})=>[w(Ze,{size:"40",icon:"mdi-circle-multiple-outline",name:"Nudge",buttonClass:i||"",onClick:r},null,8,["buttonClass","onClick"])]),_:1},8,["value"])]),_:1},8,["model-value"]),w(yo,{"labels-store":U(t)},null,8,["labels-store"])]),_:1}))}});const N0=q({components:{ToolButton:Ze,MenuToolButton:x0,ItemGroup:v0,GroupableItem:y0,PaintControls:b0,CropControls:k0,RulerControls:V0,RectangleControls:$0,ContourControls:F0},setup(){const e=Tn(),t=ze(),n=T(()=>!e.primaryDataset),s=T(()=>t.currentTool),o=at(),a=ot(),i=V(!1),r=V(!1);return wa("Escape",()=>{i.value=!1,r.value=!1}),{currentTool:s,setCurrentTool:t.setCurrentTool,noCurrentImage:n,Tools:ce,paintMenu:i,cropMenu:r,rectangleStore:o,rulerStore:a}}});function H0(e,t,n,s,o,a){const i=M("tool-button"),r=M("groupable-item"),l=M("paint-controls"),c=M("menu-tool-button"),d=M("rectangle-controls"),h=M("ruler-controls"),g=M("contour-controls"),v=M("crop-controls"),p=M("item-group");return D(),Y(p,{mandatory:"","model-value":e.currentTool,"onUpdate:modelValue":t[0]||(t[0]=f=>e.setCurrentTool(f))},{default:L(()=>[w(r,{value:e.Tools.WindowLevel},{default:L(({active:f,toggle:m})=>[w(i,{icon:"mdi-circle-half-full",name:"Window & Level",buttonClass:["tool-btn",f?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),w(r,{value:e.Tools.Pan},{default:L(({active:f,toggle:m})=>[w(i,{icon:"mdi-cursor-move",name:"Pan",buttonClass:["tool-btn",f?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),w(r,{value:e.Tools.Zoom},{default:L(({active:f,toggle:m})=>[w(i,{icon:"mdi-magnify-plus-outline",name:"Zoom",buttonClass:["tool-btn",f?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),w(r,{value:e.Tools.Crosshairs},{default:L(({active:f,toggle:m})=>[w(i,{icon:"mdi-crosshairs",name:"Crosshairs",buttonClass:["tool-btn",f?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),w(r,{value:e.Tools.Paint},{default:L(({active:f,toggle:m})=>[w(c,{icon:"mdi-brush",name:"Paint",active:f,disabled:e.noCurrentImage,onClick:m},{default:L(()=>[w(l)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),w(r,{value:e.Tools.Rectangle},{default:L(({active:f,toggle:m})=>[w(c,{icon:"mdi-vector-square",name:"Rectangle",mobileOnlyMenu:!0,active:f,disabled:e.noCurrentImage,onClick:m},{default:L(()=>[w(d)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),w(r,{value:e.Tools.Ruler},{default:L(({active:f,toggle:m})=>[w(c,{icon:"mdi-ruler",name:"Ruler",mobileOnlyMenu:!0,active:f,disabled:e.noCurrentImage,onClick:m},{default:L(()=>[w(h)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),w(r,{value:e.Tools.Contour},{default:L(({active:f,toggle:m})=>[w(c,{icon:"mdi-shape-circle-plus",name:"Contour",active:f,disabled:e.noCurrentImage,onClick:m},{default:L(()=>[w(g)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),w(r,{value:e.Tools.Crop},{default:L(({active:f,toggle:m})=>[w(c,{icon:"mdi-crop",name:"Crop",active:f,disabled:e.noCurrentImage,onClick:m},{default:L(()=>[w(v)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"])]),_:1},8,["model-value"])}const Hs=A(N0,[["render",H0],["__scopeId","data-v-323b8b77"]]);function qt(e){He(()=>e.unsubscribe())}function z0(e,t=!1){const n=V(t);let s=!0;const o={position:[0,0,0],parallelScale:0};qt(e.onModified(()=>{if(s&&n.value){const r=e.getPosition(),l=e.getParallelScale();(!lt(r,o.position)||l!==o.parallelScale)&&(n.value=!1)}}));function a(r){if(s){s=!1;try{r()}finally{s=!0}}}function i(){o.position=e.getPosition(),o.parallelScale=e.getParallelScale()}return{resizeToFit:n,ignoreResizeToFitTracking:a,resetResizeToFitTracking:i}}function W0(e){if(!e||e==="none")return 0;const t=e.match(/matrix(?:3d)?\((.+)\)/)[1].split(",").map(s=>Number(s));return e.includes("3d")?t[13]:t[5]}const j0={props:{slice:{type:Number,default:0},min:{type:Number,required:!0},max:{type:Number,required:!0},step:{type:Number,required:!0},handleHeight:{type:Number,default:20}},data(){return{maxHandlePos:0,dragging:!1,initialHandlePos:0,initialMousePosY:0,yOffset:0}},computed:{handlePosition(){const e=this.max-this.min<=0?1:this.max-this.min,t=this.maxHandlePos*((this.slice-this.min)/e);return this.dragging?this.draggingHandlePos:t},draggingHandlePos(){return Math.min(Math.max(0,this.initialHandlePos+this.yOffset),this.maxHandlePos)}},mounted(){this.updateMaxHandlePos(),this.resizeObserver=new ResizeObserver(e=>{e.length===1&&this.updateMaxHandlePos()}),this.resizeObserver.observe(this.$refs.handleContainer)},beforeUnmount(){this.resizeObserver.disconnect()},methods:{updateMaxHandlePos(){this.maxHandlePos=this.$refs.handleContainer.clientHeight-this.handleHeight},onDragStart(e){if(e.preventDefault(),this.dragging=!0,this.initialMousePosY=e.pageY,e.target===this.$refs.handle){const t=window.getComputedStyle(this.$refs.handle);this.initialHandlePos=W0(t.transform)}else{const{y:t}=this.$refs.handleContainer.getBoundingClientRect();this.initialHandlePos=Math.max(0,Math.min(this.maxHandlePos,e.pageY-t-this.handleHeight/2));const n=this.getNearestSlice(this.initialHandlePos);this.$emit("input",n)}this.yOffset=0,this.$refs.handleContainer.setPointerCapture(e.pointerId)},onDragMove(e){if(!this.$refs.handleContainer.hasPointerCapture(e.pointerId))return;e.preventDefault(),this.yOffset=e.pageY-this.initialMousePosY;const t=this.getNearestSlice(this.handlePosition);this.$emit("input",t)},onDragEnd(e){if(!this.$refs.handleContainer.hasPointerCapture(e.pointerId))return;e.preventDefault(),this.$refs.handleContainer.releasePointerCapture(e.pointerId),this.dragging=!1;const t=this.getNearestSlice(this.handlePosition);this.$emit("input",t)},getNearestSlice(e){const n=e/this.maxHandlePos*(this.max-this.min)+this.min;return Math.round(n/this.step)*this.step}}},U0=e=>(oe("data-v-45b64a9f"),e=e(),ae(),e),G0=U0(()=>u("div",{class:"slice-slider-track"},null,-1));function X0(e,t,n,s,o,a){return D(),x("div",{class:"slice-slider",ref:"handleContainer",onPointerdown:t[0]||(t[0]=(...i)=>a.onDragStart&&a.onDragStart(...i)),onPointermove:t[1]||(t[1]=(...i)=>a.onDragMove&&a.onDragMove(...i)),onPointerup:t[2]||(t[2]=(...i)=>a.onDragEnd&&a.onDragEnd(...i)),onPointercancel:t[3]||(t[3]=(...i)=>a.onDragEnd&&a.onDragEnd(...i)),onContextmenu:t[4]||(t[4]=i=>i.preventDefault())},[G0,u("div",{class:"slice-slider-handle",ref:"handle",style:j({height:`${n.handleHeight}px`,transform:`translate3d(0, ${a.handlePosition}px, 0)`})},null,4)],544)}const K0=A(j0,[["render",X0],["__scopeId","data-v-45b64a9f"]]),q0="_gridRoot_102tk_2",Y0="_row_102tk_9",J0="_cell_102tk_16",Z0="_top_102tk_20",Q0="_left_102tk_21",e1="_center_102tk_25",t1="_middle_102tk_26",n1="_bottom_102tk_30",o1="_right_102tk_31",a1={gridRoot:q0,row:Y0,cell:J0,top:Z0,left:Q0,center:e1,middle:t1,bottom:n1,right:o1},s1={};function i1(e,t){return D(),x("div",{class:$(e.$style.gridRoot)},[u("div",{class:$([e.$style.top,e.$style.row])},[u("div",{class:$([e.$style.left,e.$style.cell])},[De(e.$slots,"top-left")],2),u("div",{class:$([e.$style.center,e.$style.cell])},[De(e.$slots,"top-center")],2),u("div",{class:$([e.$style.right,e.$style.cell])},[De(e.$slots,"top-right")],2)],2),u("div",{class:$([e.$style.middle,e.$style.row])},[u("div",{class:$([e.$style.left,e.$style.cell])},[De(e.$slots,"middle-left")],2),u("div",{class:$([e.$style.center,e.$style.cell])},[De(e.$slots,"middle-center")],2),u("div",{class:$([e.$style.right,e.$style.cell])},[De(e.$slots,"middle-right")],2)],2),u("div",{class:$([e.$style.bottom,e.$style.row])},[u("div",{class:$([e.$style.left,e.$style.cell])},[De(e.$slots,"bottom-left")],2),u("div",{class:$([e.$style.center,e.$style.cell])},[De(e.$slots,"bottom-center")],2),u("div",{class:$([e.$style.right,e.$style.cell])},[De(e.$slots,"bottom-right")],2)],2)],2)}const r1={$style:a1},l1=A(s1,[["render",i1],["__cssModules",r1]]);function Mn(e,t){const n=new ResizeObserver(s=>{s.length===1&&t(s[0])});return N(e,(s,o)=>{o&&n.unobserve(o),s&&n.observe(s)},{immediate:!0}),Ee(()=>{const s=U(e);s&&n.unobserve(s)}),n}function Ce(e){return n=>{let s=null;const o=()=>{s==null||s.unsubscribe(),s=null};He(o),Fi(e)?ge(()=>{o(),e.value&&(s=e.value(n))}):e&&(s=e(n))}}function un(e){return e.map((t,n)=>({value:t,axis:n})).filter(({value:t})=>Math.abs(t)>Qn).sort((t,n)=>Math.abs(n.value)-Math.abs(t.value)).map(({value:t,axis:n})=>(Math.sign(t)===1?"LPS":"RAI")[n]).join("")}function c1(e){const t=T(()=>e.value.getCamera()),n=V(""),s=V(""),o=V(""),a=V("");function i(){const l=t.value.getViewUp(),c=t.value.getDirectionOfProjection(),d=[0,0,0];Jn(d,c,l);const h=l.map(v=>v*-1),g=d.map(v=>v*-1);n.value=un(l),a.value=un(d),o.value=un(h),s.value=un(g)}return Ce(T(()=>t.value.onModified))(i),i(),{top:n,right:a,bottom:o,left:s}}function d1(e,t,n){const s=T(()=>n.value.orientation),o=T(()=>is(s.value)),a=T(()=>o.value[U(e)]),i=T(()=>o.value[U(t)]);return{cameraDirVec:a,cameraUpVec:i}}function hn(e,t){return Math.min(t-e,1)/256}const u1=q({name:"WindowLevelTool",props:{viewId:{type:String,required:!0}},setup(e){const{viewId:t}=ie(e),n=ho(),s=ue(),{currentImageID:o}=le(),a=T(()=>s.getViewProxy(t.value)),i=Rs(),r=T(()=>n.getConfig(t.value,o.value)),l=T(()=>({min:1e-12,max:r.value!=null?r.value.max-r.value.min:i.max,step:r.value!=null?hn(r.value.min,r.value.max):hn(i.min,i.max)})),c=T(()=>({min:r.value!=null?r.value.min:i.min,max:r.value!=null?r.value.max:i.max,step:r.value!=null?hn(r.value.min,r.value.max):hn(i.min,i.max)})),d=T(()=>r.value!=null?r.value.width:i.width),h=T(()=>r.value!=null?r.value.level:i.level),g=Oa.newInstance({button:1,scrollEnabled:!1});N(a,(p,f)=>{f&&f.getInteractorStyle2D().removeMouseManipulator(g),p&&a.value.getInteractorStyle2D().addMouseManipulator(g)},{immediate:!0}),Ee(()=>{a.value.isDeleted()||a.value.getInteractorStyle2D().removeMouseManipulator(g)});function v(){g.removeAllListeners();const p=l.value,f=c.value;g.setVerticalListener(p.min,p.max,p.step,()=>d.value,m=>{o.value!=null&&n.updateConfig(t.value,o.value,{width:m})}),g.setHorizontalListener(f.min,f.max,f.step,()=>h.value,m=>{o.value!=null&&n.updateConfig(t.value,o.value,{level:m})})}return N(()=>JSON.stringify({w:l.value,l:c.value}),v,{immediate:!0}),()=>null}});function h1(e){const t=ze();return T(()=>t.currentTool===ce.WindowLevel).value?Zn(u1,e):[]}const g1=q({name:"SliceScrollTool",props:{viewId:{type:String,required:!0}},setup(e){const{viewId:t}=ie(e),n=st(),s=ue(),{currentImageID:o}=le(),a=T(()=>s.getViewProxy(t.value)),i=uo(),r=T(()=>n.getConfig(t.value,o.value)),l=T(()=>({min:r.value!=null?r.value.min:i.min,max:r.value!=null?r.value.max:i.max,step:1,default:r.value!=null?r.value.slice:i.slice})),c=V(0),d=Oa.newInstance({button:-1,scrollEnabled:!0});N(a,(g,v)=>{v&&v.getInteractorStyle2D().removeMouseManipulator(d),g&&a.value.getInteractorStyle2D().addMouseManipulator(d)},{immediate:!0}),Ee(()=>{a.value.isDeleted()||a.value.getInteractorStyle2D().removeMouseManipulator(d)});function h(){d.removeAllListeners();const g=l.value;d.setScrollListener(g.min,g.max,g.step,()=>c.value,v=>{o.value!==null&&n.updateConfig(t.value,o.value,{slice:v})})}return N(l,g=>{c.value=g.default,h()},{immediate:!0}),()=>null}}),zs=q({name:"MouseManipulatorTool",props:{name:String,viewId:{type:String,required:!0},manipulatorClass:{type:Object,required:!0},options:{type:Array,default:()=>[]}},setup(e){const{viewId:t,options:n}=ie(e),s=ue(),o=T(()=>s.getViewProxy(t.value)),a=T(()=>o.value.isA("vtkView2DProxy")?o.value.getInteractorStyle2D():o.value.getInteractorStyle3D()),i=[];function r(l,c,d){l!==null&&(d.forEach(h=>l.removeMouseManipulator(h)),c.forEach(h=>l.addMouseManipulator(h)))}return N(n,l=>{for(;i.length>l.length;){const d=i.pop();a.value.removeMouseManipulator(d),d.delete()}const c=Array.from(i);for(let d=i.length;d<l.length;++d)i.push(e.manipulatorClass.newInstance(l[d]));l.forEach((d,h)=>{"button"in d&&i[h].setButton(d.button),i[h].setShift(!!d.shift),i[h].setControl(!!d.control)}),r(a.value,i,c)},{immediate:!0}),N(a,(l,c)=>{i.forEach(d=>{c&&c.removeMouseManipulator(d),l&&l.addMouseManipulator(d)})},{immediate:!0}),Ee(()=>{o.value.isDeleted()||i.forEach(l=>a.value.removeMouseManipulator(l))}),()=>null}});function p1(e){const t=ze(),n=[];return n.push({button:2}),n.push({button:1,shift:!0}),t.currentTool===ce.Pan&&n.push({button:1}),Zn(zs,{...e,name:"PanTool",manipulatorClass:Wr,options:n})}function f1(e){const t=ze(),n=[];return n.push({button:3,flipDirection:!0}),n.push({button:1,control:!0,flipDirection:!0}),t.currentTool===ce.Zoom&&n.push({button:1,flipDirection:!0}),Zn(zs,{...e,name:"ZoomTool",manipulatorClass:jr,options:n})}var Yt=(e=>(e.PlacingFirst="PlacingFirst",e.PlacingSecond="PlacingSecond",e.Select="Select",e.Dragging="Dragging",e))(Yt||{});function aa(e){return e.altKey||e.controlKey||e.shiftKey}function m1(e,t){t.classHierarchy.push("vtkRulerWidgetProp"),t.interactionState="Select";let n=null;_.setGet(e,t,["interactionState"]),_.setGet(e,t,["manipulator"]),_.event(e,t,"RightClickEvent"),_.event(e,t,"PlacedEvent"),e.deactivateAllHandles=()=>{t.widgetState.deactivate(),t.activeState=null},e.setFirstPoint=o=>{t.widgetState.getFirstPoint().setOrigin(o)},e.setSecondPoint=o=>{t.widgetState.getSecondPoint().setOrigin(o)};const s=e.setInteractionState;e.setInteractionState=o=>{const a=s(o);return a&&o==="PlacingFirst"&&(t.widgetState.setIsPlaced(!1),t.widgetState.getFirstPoint().setVisible(!1),t.widgetState.getSecondPoint().setVisible(!1)),a},e.resetInteractions=()=>{t._interactor.cancelAnimation(e,!0)},e.handleLeftButtonPress=o=>{var l;if(!t.manipulator||aa(o))return _.VOID;const a=t._widgetManager.getActiveWidget();if(a&&a!==e)return _.VOID;const i=t.manipulator.handleEvent(o,t._apiSpecificRenderWindow);if(!i.length)return _.VOID;const r=e.getInteractionState();return r==="PlacingFirst"?(e.setFirstPoint(i),e.setSecondPoint(i),t.widgetState.getFirstPoint().setVisible(!0),t.widgetState.getSecondPoint().setVisible(!0),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),e.setInteractionState("PlacingSecond"),_.EVENT_ABORT):r==="PlacingSecond"?(e.setSecondPoint(i),t.widgetState.setIsPlaced(!0),e.setInteractionState("Select"),e.invokeEndInteractionEvent(),e.invokePlacedEvent(),t._interactor.cancelAnimation(e),_.EVENT_ABORT):(l=t.activeState)!=null&&l.getActive()&&t.pickable?(n=t.activeState,e.setInteractionState("Dragging"),t._apiSpecificRenderWindow.setCursor("grabbing"),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),_.EVENT_ABORT):_.VOID},e.handleMouseMove=o=>{const a=t.manipulator.handleEvent(o,t._apiSpecificRenderWindow);return a.length?e.getInteractionState()==="PlacingSecond"?(t.widgetState.getSecondPoint().setOrigin(a),t.widgetState.getSecondPoint().setVisible(!0),e.invokeInteractionEvent(),_.EVENT_ABORT):e.getInteractionState()==="Dragging"&&n?(n.setOrigin(a),e.invokeInteractionEvent(),_.EVENT_ABORT):_.VOID:_.VOID},e.handleLeftButtonRelease=o=>{if(n){const a=t.manipulator.handleEvent(o,t._apiSpecificRenderWindow);a.length&&n.setOrigin(a),n=null,e.setInteractionState("Select"),t._apiSpecificRenderWindow.setCursor("pointer"),t.widgetState.deactivate(),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent(),t._widgetManager.enablePicking()}},e.handleRightButtonPress=o=>aa(o)||e.getInteractionState()!=="Select"||!t.activeState?_.VOID:(e.invokeRightClickEvent(o),_.EVENT_ABORT),e.grabFocus=()=>{throw new Error("grabFocus is not implemented")},e.loseFocus=()=>{throw new Error("loseFocus is not implemented")}}const v1=20;function y1(e,t,n,s){let o=n();const a=t.$subscribe(()=>{const r=n();(s?s(o,r):o!==r)&&(o=r,e.modified())}),i=e.delete;e.delete=()=>{a(),i()}}function w1(e,t,{id:n,store:s,key:o,visible:a=!0}){Object.assign(t,{id:n,_store:s,key:o}),bn.extend(e,t,{}),Aa.extend(e,t,{visible:a}),Ur.extend(e,t,{scale1:v1});const i=()=>t._store.rulerByID[t.id],r=l=>t._store.updateRuler(t.id,l);e.getOrigin=()=>{var l;return(l=i())==null?void 0:l[t.key]},e.setOrigin=l=>{r({[t.key]:l}),e.modified()},y1(e,t._store,()=>{var l;return(l=i())==null?void 0:l[t.key]})}const sa=_.newInstance(w1,"vtkRulerWidgetStatePoint"),Ws="points";function ia(e,t,n){let s=t.onModified(n);const o=e.delete;e.delete=()=>{s.unsubscribe(),s=null,o()}}function S1(e,t){const n=sa({id:t.id,store:t._store,key:"firstPoint",visible:!0}),s=sa({id:t.id,store:t._store,key:"secondPoint",visible:!0});ia(e,n,()=>e.modified()),ia(e,s,()=>e.modified()),t.labels={[Ws]:[n,s]},e.getFirstPoint=()=>n,e.getSecondPoint=()=>s}const _1=e=>({isPlaced:!1,...e});function C1(e,t,n){Object.assign(t,_1(n)),bn.extend(e,t,n),Ba.extend(e,t),_.get(e,t,["id"]),_.setGet(e,t,["isPlaced"]),_.moveToProtected(e,t,["store"]),S1(e,t)}const b1=_.newInstance(C1,"vtkRulerWidgetState");function D1(e,t){t.classHierarchy.push("vtkRulerWidget"),e.getRepresentationsForViewType=()=>[{builder:Gr,labels:[Ws],initialValues:{scaleInPixels:!0}}],e.getLength=()=>{const n=t.widgetState.getFirstPoint().getOrigin(),s=t.widgetState.getSecondPoint().getOrigin();return!n||!s?0:Math.sqrt(Pa(n,s))},t.manipulator=Ge.newInstance()}const I1={};function js(e,t,n={}){Object.assign(t,I1,n),_n.extend(e,t,{...n,behavior:m1,widgetState:b1(n)}),_.get(e,t,["manipulator"]),D1(e,t)}const T1=_.newInstance(js,"vtkRulerWidget"),Us={newInstance:T1,extend:js};function an(e,t,n,s){const{lpsOrientation:o}=s,a=o[Ie(t)],i=o[t],r=[0,0,0];r[a]=n,pe(r,r,s.indexToWorld),e.setUserNormal(i),e.setUserOrigin(r)}const x1=q({props:{point1:Array,point2:Array,color:String,length:Number,viewId:{type:String,required:!0},textOffset:{type:Number,default:8},textSize:{type:Number,default:14}},setup(e){const{viewId:t,point1:n,point2:s,textOffset:o,length:a}=ie(e),i=V(),r=V(),l=ue(),c=T(()=>l.getViewProxy(t.value)),d=()=>{const p=c.value.getRenderer(),f=U(n),m=U(s);if(f){const y=Xt(f,p);y&&(i.value={x:y[0],y:y[1]})}else i.value=null;if(m){const y=Xt(m,p);y&&(r.value={x:y[0],y:y[1]})}else r.value=null};Ce(T(()=>c.value.getCamera().onModified))(d),N([c,n,s],d,{deep:!0,immediate:!0});const g=T(()=>{const p=U(i),f=U(r),m=o.value;return!p||!f?null:f.x>p.x?{dx:m,dy:-m,anchor:"start"}:{dx:-m,dy:-m,anchor:"end"}}),v=Rt(Sn);return Mn(v,()=>{d()}),{devicePixelRatio,textdx:T(()=>{var p;return((p=g.value)==null?void 0:p.dx)??0}),textdy:T(()=>{var p;return((p=g.value)==null?void 0:p.dy)??0}),anchor:T(()=>{var p;return((p=g.value)==null?void 0:p.anchor)??"start"}),first:i,second:r,rulerLength:T(()=>{var p;return((p=a==null?void 0:a.value)==null?void 0:p.toFixed(2))??""})}}});const L1=["x1","y1","x2","y2","stroke"],R1=["cx","cy","stroke","r"],k1=["cx","cy","stroke","r"],M1=["x","y","dx","dy","text-anchor","font-size"];function E1(e,t,n,s,o,a){return D(),x("g",null,[e.first&&e.second?(D(),x("line",{key:0,x1:e.first.x,y1:e.first.y,x2:e.second.x,y2:e.second.y,stroke:e.color,"stroke-width":"1"},null,8,L1)):z("",!0),e.first?(D(),x("circle",{key:1,cx:e.first.x,cy:e.first.y,stroke:e.color,"stroke-width":"1",fill:"transparent",r:10/e.devicePixelRatio},null,8,R1)):z("",!0),e.second?(D(),x("circle",{key:2,cx:e.second.x,cy:e.second.y,stroke:e.color,"stroke-width":"1",fill:"transparent",r:10/e.devicePixelRatio,class:"handle"},null,8,k1)):z("",!0),e.second?(D(),x("text",{key:3,x:e.second.x,y:e.second.y,dx:e.textdx,dy:e.textdy,"text-anchor":e.anchor,"stroke-width":"0.75",stroke:"black",fill:"white","font-size":`${e.textSize}px`,"font-weight":"bold"},F(e.rulerLength),9,M1)):z("",!0)])}const P1=A(x1,[["render",E1],["__scopeId","data-v-85f6f954"]]),O1=q({name:"RulerWidget2D",emits:["placed","contextmenu"],props:{rulerId:{type:String,required:!0},widgetManager:{type:Object,required:!0},viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},currentSlice:{type:Number,required:!0},isPlacing:{type:Boolean,default:!1}},components:{RulerSVG2D:P1},setup(e,{emit:t}){const{rulerId:n,widgetManager:s,viewDirection:o,currentSlice:a,isPlacing:i}=ie(e),r=ot(),l=T(()=>r.rulerByID[n.value]),{currentImageID:c,currentImageMetadata:d}=le(),h=Us.newInstance({id:n.value,store:r,isPlaced:!i.value}),g=V(null);se(()=>{g.value=s.value.addWidget(h)}),He(()=>{g.value&&(s.value.removeWidget(g.value),g.value.delete(),h.delete())}),N([i,g],([S,b])=>{S&&b&&b.setInteractionState(Yt.PlacingFirst)},{immediate:!0}),N([a,c,g],()=>{var b;const S=(b=g.value)==null?void 0:b.getWidgetState().getIsPlaced();g.value&&!S&&(g.value.resetInteractions(),g.value.setInteractionState(Yt.PlacingFirst))}),Ce(T(()=>{var S;return(S=g.value)==null?void 0:S.onPlacedEvent}))(()=>{t("placed")});let p=null;se(()=>{g.value&&(p=g.value.onRightClickEvent(S=>{const b=go(S);b&&t("contextmenu",b)}))}),Ee(()=>{p&&(p.unsubscribe(),p=null)});const f=Ge.newInstance();se(()=>{g.value&&g.value.setManipulator(f)}),ge(()=>{var S;an(f,o.value,((S=l.value)==null?void 0:S.slice)??a.value,d.value)}),N(()=>{var S;return!!g.value&&((S=l.value)==null?void 0:S.slice)===a.value},S=>{var b;(b=g.value)==null||b.setVisibility(S)},{immediate:!0}),se(()=>{g.value&&(g.value.setHandleVisibility(!1),s.value.renderWidgets())});const m=S=>{const b=V(!1),E=()=>{S.value&&(b.value=S.value.getVisible())};return Ce(T(()=>{var O;return(O=S.value)==null?void 0:O.onModified}))(()=>E()),Sa(S,()=>E()),b},y=m(T(()=>{var S;return(S=g.value)==null?void 0:S.getWidgetState().getFirstPoint()})),I=m(T(()=>{var S;return(S=g.value)==null?void 0:S.getWidgetState().getSecondPoint()}));return{ruler:l,firstPoint:T(()=>y.value?l.value.firstPoint:void 0),secondPoint:T(()=>I.value?l.value.secondPoint:void 0),length:T(()=>r.lengthByID[l.value.id])}}});function A1(e,t,n,s,o,a){const i=M("RulerSVG2D");return Ue((D(),Y(i,{"view-id":e.viewId,point1:e.firstPoint,point2:e.secondPoint,color:e.ruler.color,length:e.length},null,8,["view-id","point1","point2","color","length"])),[[Ht,e.currentSlice===e.ruler.slice]])}const B1=A(O1,[["render",A1]]),V1=q({name:"RulerTool",props:{viewId:{type:String,required:!0},currentSlice:{type:Number,required:!0},viewDirection:{type:String,required:!0},widgetManager:{type:Object,required:!0}},components:{RulerWidget2D:B1},setup(e){const{viewDirection:t,currentSlice:n}=ie(e),s=ze(),o=ot(),{rulers:a,activeLabel:i}=St(o),{currentImageID:r,currentImageMetadata:l}=le(),c=T(()=>s.currentTool===ce.Ruler),d=T(()=>Ie(t.value)),h=V(null);N(h,(S,b)=>{b!=null&&o.updateRuler(b,{placing:!1}),S!=null&&o.updateRuler(S,{placing:!0})},{immediate:!0}),N([c,r],([S,b])=>{h.value!=null&&(o.removeRuler(h.value),h.value=null),S&&b&&(h.value=o.addRuler({imageID:b,placing:!0}))},{immediate:!0}),N([i,h],([S,b])=>{b!=null&&o.updateRuler(b,{label:S,...S&&o.labels[S]})},{immediate:!0}),He(()=>{h.value!=null&&(o.removeRuler(h.value),h.value=null)});const g=()=>{r.value&&(h.value=o.addRuler({imageID:r.value,placing:!0}))},v=()=>{const{lpsOrientation:S,indexToWorld:b}=l.value,E=S[t.value],R=S[d.value],O=[0,0,0];return O[R]=n.value,pe(O,O,b),{planeNormal:E,planeOrigin:O}};N([n,h],([S,b])=>{b&&o.updateRuler(b,{frameOfReference:v(),slice:S})},{immediate:!0});const p=Ve({show:!1,x:0,y:0,forRulerID:""}),f=(S,b)=>{[p.x,p.y]=b,p.show=!0,p.forRulerID=S},m=()=>{o.removeRuler(p.forRulerID)},y=S=>{if(!S.frameOfReference)return!1;const b=Ln(S.frameOfReference,l.value,{allowOutOfBoundsSlice:!0});return!!b&&b.axis===d.value};return{rulers:T(()=>{const{lengthByID:S}=o,b=r.value;return a.value.filter(R=>R.imageID===b&&y(R)).map(R=>({...R,length:S[R.id]}))}),placingRulerID:h,contextMenu:p,openContextMenu:f,deleteRulerFromContextMenu:m,onRulerPlaced:g}}});const $1={class:"overlay-no-events"},F1={class:"overlay-no-events"};function N1(e,t,n,s,o,a){const i=M("RulerWidget2D");return D(),x("div",$1,[(D(),x("svg",F1,[(D(!0),x(ne,null,fe(e.rulers,r=>(D(),Y(i,{key:r.id,"ruler-id":r.id,"is-placing":r.id===e.placingRulerID,"current-slice":e.currentSlice,"view-id":e.viewId,"view-direction":e.viewDirection,"widget-manager":e.widgetManager,onContextmenu:l=>e.openContextMenu(r.id,l),onPlaced:e.onRulerPlaced},null,8,["ruler-id","is-placing","current-slice","view-id","view-direction","widget-manager","onContextmenu","onPlaced"]))),128))])),w(Ct,{modelValue:e.contextMenu.show,"onUpdate:modelValue":t[0]||(t[0]=r=>e.contextMenu.show=r),class:"position-absolute",style:j({top:`${e.contextMenu.y}px`,left:`${e.contextMenu.x}px`}),"close-on-click":"","close-on-content-click":""},{default:L(()=>[w(zt,{density:"compact"},{default:L(()=>[w(et,{onClick:e.deleteRulerFromContextMenu},{default:L(()=>[w(Re,null,{default:L(()=>[X("Delete")]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1},8,["modelValue","style"])])}const H1=A(V1,[["render",N1],["__scopeId","data-v-6e6ae374"]]);function z1(e,t){t.classHierarchy.push("vtkRectangleWidget")}const W1={};function Gs(e,t,n={}){Object.assign(t,W1,n);const{store:s,...o}=n,a={...s,rulerByID:s.toolByID,updateRuler:s.updateTool};Us.extend(e,t,{store:a,...o}),z1(e,t)}const j1=_.newInstance(Gs,"vtkRectangleWidget"),U1={newInstance:j1,extend:Gs},G1=q({props:{point1:Array,point2:Array,color:String,fillColor:String,viewId:{type:String,required:!0}},setup(e){const{viewId:t,point1:n,point2:s}=ie(e),o=V(),a=V(),i=ue(),r=T(()=>i.getViewProxy(t.value)),l=()=>{const g=r.value.getRenderer(),v=U(n),p=U(s);if(v){const f=Xt(v,g);f&&(o.value={x:f[0],y:f[1]})}else o.value=null;if(p){const f=Xt(p,g);f&&(a.value={x:f[0],y:f[1]})}else a.value=null},c=T(()=>{var m,y,I,S;const[g,v]=[((m=o.value)==null?void 0:m.x)??0,((y=o.value)==null?void 0:y.y)??0],[p,f]=[((I=a.value)==null?void 0:I.x)??g,((S=a.value)==null?void 0:S.y)??v];return{x:Math.min(g,p),y:Math.min(v,f),width:Math.abs(g-p),height:Math.abs(v-f)}});Ce(T(()=>r.value.getCamera().onModified))(l),N([r,n,s],l,{deep:!0,immediate:!0});const h=Rt(Sn);return Mn(h,()=>{l()}),{devicePixelRatio,first:o,second:a,rectangle:c}}}),X1=["x","y","width","height","stroke","fill"],K1=["cx","cy","stroke","r"],q1=["cx","cy","stroke","r"];function Y1(e,t,n,s,o,a){return D(),x("g",null,[u("rect",{x:e.rectangle.x,y:e.rectangle.y,width:e.rectangle.width,height:e.rectangle.height,stroke:e.color,"stroke-width":"1",fill:e.fillColor},null,8,X1),e.first?(D(),x("circle",{key:0,cx:e.first.x,cy:e.first.y,stroke:e.color,"stroke-width":"1",fill:"transparent",r:10/e.devicePixelRatio},null,8,K1)):z("",!0),e.second?(D(),x("circle",{key:1,cx:e.second.x,cy:e.second.y,stroke:e.color,"stroke-width":"1",fill:"transparent",r:10/e.devicePixelRatio},null,8,q1)):z("",!0)])}const J1=A(G1,[["render",Y1]]),Z1=at,Q1=U1,eh=J1,th=q({name:"RectangleWidget2D",emits:["placed","contextmenu"],props:{toolId:{type:String,required:!0},widgetManager:{type:Object,required:!0},viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},currentSlice:{type:Number,required:!0},isPlacing:{type:Boolean,default:!1}},components:{SVG2DComponent:eh},setup(e,{emit:t}){const{toolId:n,widgetManager:s,viewDirection:o,currentSlice:a,isPlacing:i}=ie(e),r=V(n.value),l=Z1(),c=T(()=>l.toolByID[r.value]),{currentImageID:d,currentImageMetadata:h}=le(),g=Q1.newInstance({id:r.value,store:l,isPlaced:!i.value}),v=V(null);se(()=>{v.value=s.value.addWidget(g)}),He(()=>{v.value&&(s.value.removeWidget(v.value),v.value.delete(),g.delete())}),N([i,v],([b,E])=>{b&&E&&E.setInteractionState(Yt.PlacingFirst)},{immediate:!0}),N([a,d,v],()=>{var E;const b=(E=v.value)==null?void 0:E.getWidgetState().getIsPlaced();v.value&&!b&&(v.value.resetInteractions(),v.value.setInteractionState(Yt.PlacingFirst))}),Ce(T(()=>{var b;return(b=v.value)==null?void 0:b.onPlacedEvent}))(()=>{t("placed")});let f=null;se(()=>{v.value&&(f=v.value.onRightClickEvent(b=>{const E=go(b);E&&t("contextmenu",E)}))}),Ee(()=>{f&&(f.unsubscribe(),f=null)});const m=Ge.newInstance();se(()=>{v.value&&v.value.setManipulator(m)}),ge(()=>{var b;an(m,o.value,((b=c.value)==null?void 0:b.slice)??a.value,h.value)}),N(()=>{var b;return!!v.value&&((b=c.value)==null?void 0:b.slice)===a.value},b=>{var E;(E=v.value)==null||E.setVisibility(b)},{immediate:!0}),se(()=>{v.value&&(v.value.setHandleVisibility(!1),s.value.renderWidgets())});const y=b=>{const E=V(!1),R=()=>{b.value&&(E.value=b.value.getVisible())};return Ce(T(()=>{var k;return(k=b.value)==null?void 0:k.onModified}))(()=>R()),Sa(b,()=>R()),E},I=y(T(()=>{var b;return(b=v.value)==null?void 0:b.getWidgetState().getFirstPoint()})),S=y(T(()=>{var b;return(b=v.value)==null?void 0:b.getWidgetState().getSecondPoint()}));return{tool:c,firstPoint:T(()=>I.value?c.value.firstPoint:void 0),secondPoint:T(()=>S.value?c.value.secondPoint:void 0)}}});function nh(e,t,n,s,o,a){const i=M("SVG2DComponent");return Ue((D(),Y(i,{"view-id":e.viewId,point1:e.firstPoint,point2:e.secondPoint,color:e.tool.color,"fill-color":e.tool.fillColor},null,8,["view-id","point1","point2","color","fill-color"])),[[Ht,e.currentSlice===e.tool.slice]])}const oh=A(th,[["render",nh]]),ah=at,sh=q({name:"RectangleTool",props:{viewId:{type:String,required:!0},currentSlice:{type:Number,required:!0},viewDirection:{type:String,required:!0},widgetManager:{type:Object,required:!0}},components:{RectangleWidget2D:oh},setup(e){const{viewDirection:t,currentSlice:n}=ie(e),s=ze(),o=ah(),{tools:a,activeLabel:i}=St(o),{currentImageID:r,currentImageMetadata:l}=le(),c=T(()=>s.currentTool===ce.Rectangle),d=T(()=>Ie(t.value)),h=V(null);N(h,(S,b)=>{b!=null&&o.updateTool(b,{placing:!1}),S!=null&&o.updateTool(S,{placing:!0})},{immediate:!0}),N([c,r],([S,b])=>{h.value!=null&&(o.removeTool(h.value),h.value=null),S&&b&&(h.value=o.addTool({imageID:b,placing:!0}))},{immediate:!0}),N([i,h],([S,b])=>{b!=null&&o.updateTool(b,{label:S,...S&&o.labels[S]})},{immediate:!0}),He(()=>{h.value!=null&&(o.removeTool(h.value),h.value=null)});const g=()=>{r.value&&(h.value=o.addTool({imageID:r.value,placing:!0}))},v=()=>{const{lpsOrientation:S,indexToWorld:b}=l.value,E=S[t.value],R=S[d.value],O=[0,0,0];return O[R]=n.value,pe(O,O,b),{planeNormal:E,planeOrigin:O}};N([n,h],([S,b])=>{b&&o.updateTool(b,{frameOfReference:v(),slice:S})},{immediate:!0});const p=Ve({show:!1,x:0,y:0,forToolID:""}),f=(S,b)=>{[p.x,p.y]=b,p.show=!0,p.forToolID=S},m=()=>{o.removeTool(p.forToolID)},y=S=>{if(!S.frameOfReference)return!1;const b=Ln(S.frameOfReference,l.value,{allowOutOfBoundsSlice:!0});return!!b&&b.axis===d.value};return{tools:T(()=>{const S=r.value;return a.value.filter(b=>b.imageID===S&&y(b))}),placingToolID:h,contextMenu:p,openContextMenu:f,deleteToolFromContextMenu:m,onToolPlaced:g}}});const ih={class:"overlay-no-events"},rh={class:"overlay-no-events"};function lh(e,t,n,s,o,a){const i=M("RectangleWidget2D");return D(),x("div",ih,[(D(),x("svg",rh,[(D(!0),x(ne,null,fe(e.tools,r=>(D(),Y(i,{key:r.id,"tool-id":r.id,"is-placing":r.id===e.placingToolID,"current-slice":e.currentSlice,"view-id":e.viewId,"view-direction":e.viewDirection,"widget-manager":e.widgetManager,onContextmenu:l=>e.openContextMenu(r.id,l),onPlaced:e.onToolPlaced},null,8,["tool-id","is-placing","current-slice","view-id","view-direction","widget-manager","onContextmenu","onPlaced"]))),128))])),w(Ct,{modelValue:e.contextMenu.show,"onUpdate:modelValue":t[0]||(t[0]=r=>e.contextMenu.show=r),class:"position-absolute",style:j({top:`${e.contextMenu.y}px`,left:`${e.contextMenu.x}px`}),"close-on-click":"","close-on-content-click":""},{default:L(()=>[w(zt,{density:"compact"},{default:L(()=>[w(et,{onClick:e.deleteToolFromContextMenu},{default:L(()=>[w(Re,null,{default:L(()=>[X("Delete")]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1},8,["modelValue","style"])])}const ch=A(sh,[["render",lh],["__scopeId","data-v-152d5701"]]),dh=32,ra=2,uh=4;function hh(e,t){t.classHierarchy.push("vtkContourRepresentation"),t._polyData=tt.newInstance({mtime:0}),t._pdPoints=null,t._pdLines=null,t._pipelines={lines:{source:e,mapper:Qt.newInstance(),actor:Va.newInstance({parentProp:e})}},t._pipelines.lines.actor.getProperty().setLineWidth(2),eo.connectPipeline(t._pipelines.lines),e.addActor(t._pipelines.lines.actor),e.getRepresentationStates=(a=t.inputData[0])=>a;function n(a){var f,m;const i=a.getPolyLine(),r=a.getReferencePlane(),l=a.getPolyLineLength(),c=a.getFinalized(),d=c?1:0;if(!i||!r)return;((f=t._pdPoints)==null?void 0:f.length)!==l*3&&(t._pdPoints=new Float32Array(l*3)),((m=t._pdLines)==null?void 0:m.length)!==l+1&&(t._pdLines=new Float32Array(l+1+d));let h=0,g=0;t._pdLines[g++]=l+d;const v=Ne(),p=Me();for(let y=0;y<i.length;)t._pdLines[g++]=h/3,ya(v,i[y++],i[y++]),Rn(v,r,p),t._pdPoints[h++]=p[0],t._pdPoints[h++]=p[1],t._pdPoints[h++]=p[2];c&&(t._pdLines[g]=0)}let s=ra;e.requestData=(a,i)=>{const r=e.getRepresentationStates(a[0]);n(r),t._pdPoints&&t._pdLines&&(t._polyData.getPoints().setData(t._pdPoints),t._polyData.getLines().setData(t._pdLines),t._polyData.getPoints().modified(),t._polyData.modified()),s=r.getSelected()?uh:ra,t._pipelines.lines.actor.getProperty().setLineWidth(s),t._pipelines.lines.actor.getProperty().setColor(r.getColor()),i[0]=t._polyData},e.getSelectedState=()=>t.inputData[0];const{updateActorVisibility:o}=e;e.updateActorVisibility=(a=zo.FRONT_BUFFER,i=!0,r=!0)=>{a===zo.PICKING_BUFFER?t._pipelines.lines.actor.getProperty().setLineWidth(dh):t._pipelines.lines.actor.getProperty().setLineWidth(s),o(a,i,r)}}const gh={};function Xs(e,t,n={}){const s={...gh,...n};eo.extend(e,t,s),hh(e,t)}const ph=_.newInstance(Xs,"vtkContourRepresentation"),fh={newInstance:ph,extend:Xs};var Ae=(e=>(e.Select="Select",e.Freehand="Freehand",e.Nudge="Nudge",e.PointPlacing="PointPlacing",e.Threshold="Threshold",e))(Ae||{});const Q={Idle:"Idle",Moving:"Moving",FreehandDrawing:"FreehandDrawing",Nudging:"Nudging",PointPlacing:"PointPlacing",Thresholding:"Thresholding"};function de(e){return e.altKey||e.controlKey||e.shiftKey}function Te(e,t){const n=e.manipulator.handleEvent(t,e._apiSpecificRenderWindow);return(n==null?void 0:n.length)===3?n:null}function Ks(e,t){const n=(t==null?void 0:t.degree)??2,s=(t==null?void 0:t.interPointSpacing)??.1,o=(t==null?void 0:t.closed)??!1,a=(t==null?void 0:t.clamped)??!1,i=e.length/3,r=[],l=Ne();let c=0;for(let p=0;p<e.length;p+=2){const f=[e[p],e[p+1]];r.push(f),p>0&&(c+=_a(l,f)),Ni(l,f)}o&&r.push(...r.slice(0,n+1));let d;if(a){d=[];const p=r.length;for(let f=0;f<p+n+1;f++)d.push(f)}const h=!a&&o?1-1/(i+1):1,g=(t==null?void 0:t.dt)??s/c,v=[];for(let p=0;p<1;p+=g){const f=Hi(p*h,n,r,d);v.push(f[0],f[1])}return v}function mh(e,t){const n={...e};function s(){return e.getMode()===Ae.Freehand}function o(){e.setInteractionState(Q.Idle),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent()}e.resetInteractionState=()=>{s()&&!e.isInteractionIdle()&&(t.widgetState.clearPolyLine(),o()),n.resetInteractionState()},e.handleLeftButtonPress=a=>{var l;if(((l=n.handleLeftButtonPress)==null?void 0:l.call(n,a))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||!t.manipulator||de(a))return _.VOID;if(t.widgetState.getFinalized())return _.VOID;const i=t._widgetManager.getActiveWidget();if(i&&i!==e)return _.VOID;const r=Te(t,a);return r?(e.setInteractionState(Q.FreehandDrawing),t.widgetState.clearPolyLine(),t.widgetState.add3dPointToPolyLine(r),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),_.EVENT_ABORT):_.VOID},e.handleMouseMove=a=>{var r;if(((r=n.handleMouseMove)==null?void 0:r.call(n,a))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||e.getInteractionState()!==Q.FreehandDrawing||de(a))return _.VOID;const i=Te(t,a);return i&&(t.widgetState.add3dPointToPolyLine(i),e.invokeInteractionEvent()),_.EVENT_ABORT},e.handleLeftButtonRelease=a=>{var l;if(((l=n.handleLeftButtonRelease)==null?void 0:l.call(n,a))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||e.getInteractionState()!==Q.FreehandDrawing||de(a))return _.VOID;const i=Te(t,a);if(i&&t.widgetState.add3dPointToPolyLine(i),t.widgetState.getPolyLine().length>=3*2){const c=Ks(t.widgetState.getPolyLine(),{degree:2,interPointSpacing:.01,closed:!0,clamped:!1});t.widgetState.setPolyLine(c),t.widgetState.setFinalized(!0)}return o(),_.EVENT_ABORT}}const vh=new Set([Ae.Nudge]);function yh(e,t){const n={...e};let s=[0,0],o=null;_.event(e,t,"SelectedEvent");const a=Ne();function i(l){if(!o)return;zi(a,l,s);const c=t.widgetState.getPolyLine();for(let d=0;d<c.length;d+=2)c[d]=o[d]+a[0],c[d+1]=o[d+1]+a[1];t.widgetState.modified()}function r(){e.setInteractionState(Q.Idle),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent()}e.resetInteractionState=()=>{e.getInteractionState()===Q.Moving&&r(),n.resetInteractionState()},e.handleLeftButtonPress=l=>{var d;if(((d=n.handleLeftButtonPress)==null?void 0:d.call(n,l))===_.EVENT_ABORT)return _.EVENT_ABORT;if(de(l))return _.VOID;if(t._widgetManager.getActiveWidget()!==e)return vh.has(e.getMode())||e.invokeSelectedEvent(!1),_.VOID;e.invokeSelectedEvent(!0);const c=Te(t,l);return c?(s=nt(c,t.widgetState.getReferencePlane()),o=[...t.widgetState.getPolyLine()],e.setInteractionState(Q.Moving),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),_.EVENT_ABORT):_.EVENT_ABORT},e.handleMouseMove=l=>{var d;if(((d=n.handleMouseMove)==null?void 0:d.call(n,l))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!e.isSelected()||e.getInteractionState()!==Q.Moving||de(l))return _.VOID;const c=Te(t,l);return c&&(i(nt(c,t.widgetState.getReferencePlane())),e.invokeInteractionEvent()),_.EVENT_ABORT},e.handleLeftButtonRelease=l=>{var d;if(((d=n.handleLeftButtonRelease)==null?void 0:d.call(n,l))===_.EVENT_ABORT)return _.EVENT_ABORT;if(e.getInteractionState()!==Q.Moving||de(l))return _.VOID;const c=Te(t,l);return c&&i(nt(c,t.widgetState.getReferencePlane())),r(),_.EVENT_ABORT}}function jn(e,t,n){return(e+t)%n}function wh(e,t,n){e[0]=(t[0]+n[0])/2,e[1]=(t[1]+n[1])/2}function Sh(e,t,n){const{radius:s,center:o}=t,a=s**2,i=Me(),r=[0,0,0],l=[0,0];for(let c=0;c<e.length;c+=2){wt(l,e[c],e[c+1]),Rn(l,n,r);const d=Wi(r,o);d>=a||(fa(i,r,o),ji(i,i,Math.sqrt(a/d)),Ui(r,o,i),nt(r,n,l),e[c]=l[0],e[c+1]=l[1])}}function _h(e,t,n){if(e.length<2)return;const s=t**2,o=n**2,a=Ne(),i=Ne(),r=Ne(),l=Ne();let c=0,d=!1,h=!1;do{let g=c;const v=jn(c,2,e.length);wt(a,e[c],e[c+1]),wt(i,e[v],e[v+1]);const p=Ca(a,i);if(p<s)wh(r,a,i),e.splice(v,2),e.splice(c,2),e.splice(c,0,...r);else if(p>o){const m=1/(Math.ceil(Math.sqrt(p/o))+1),y=[];for(let I=m;I<1;I+=m)Gi(l,a,i,I),y.push(...l);e.splice(v,0,...y),g=jn(c,y.length+2,e.length)}else g=jn(c,2,e.length);h=d,d=g<c,c=g}while(!h)}function Ch(e,t,n,s=1e-4,o=.1){Sh(e,t,n),_h(e,s,o)}function bh(e,t){let n=0,s=1/0;const o=Ne();for(let a=0;a<e.length;a+=2){wt(o,e[a],e[a+1]);const i=Ca(o,t);i<s&&(n=a,s=i)}return n}const Dh=.95;function Ih(e,t){const n={...e};t._radius=1;function s(){return e.getMode()===Ae.Nudge}function o(i){const r=t.widgetState.getPolyLine(),l=t.widgetState.getReferencePlane();Ch(r,{center:i,radius:t._radius},l),t.widgetState.modified()}function a(){e.getWidgetState().getCircleContext().setVisible(!1),e.setInteractionState(Q.Idle),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent()}e.resetInteractionState=()=>{s()&&!e.isInteractionIdle()&&a(),n.resetInteractionState()},e.handleLeftButtonPress=i=>{var I;if(((I=n.handleLeftButtonPress)==null?void 0:I.call(n,i))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||!e.isSelected()||!t.manipulator||de(i))return _.VOID;const r=t._widgetManager.getActiveWidget();if(r&&r!==e)return _.VOID;const l=Te(t,i);if(!l)return _.VOID;const{widgetState:c}=t,d=c.getPolyLine(),h=c.getReferencePlane(),g=bh(d,nt(l,h)),v=Xi(l,Rn([d[g],d[g+1]],h));t._radius=v*Dh;const p=t.manipulator.getNormal(),f=t._renderer.getActiveCamera().getViewUp(),m=Me();Jn(m,f,p);const y=c.getCircleContext();return y.setDirection(p),y.setUp(f),y.setRight(m),y.setOrigin(l),y.setScale3([t._radius,t._radius,1]),y.setVisible(!0),e.setInteractionState(Q.Nudging),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),_.EVENT_ABORT},e.handleMouseMove=i=>{var l;if(((l=n.handleMouseMove)==null?void 0:l.call(n,i))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||!e.isSelected()||e.getInteractionState()!==Q.Nudging||de(i))return _.VOID;const r=Te(t,i);return r&&(e.getWidgetState().getCircleContext().setOrigin(r),o(r),e.invokeInteractionEvent()),_.EVENT_ABORT},e.handleLeftButtonRelease=i=>{var l;if(((l=n.handleLeftButtonRelease)==null?void 0:l.call(n,i))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||!e.isSelected()||e.getInteractionState()!==Q.Nudging||de(i))return _.VOID;const r=Te(t,i);return r&&o(r),a(),_.EVENT_ABORT}}function Th(e,t){const n={...e};function s(){return e.getMode()===Ae.PointPlacing}function o(){t._widgetManager.releaseFocus(),e.setInteractionState(Q.Idle),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent()}function a(r){const l=t.widgetState.getPolyLine(),c=l.length-1;l[c-1]=r[0],l[c]=r[1],t.widgetState.modified()}function i(){t.widgetState.getPolyLine().splice(-2,2),t.widgetState.modified()}e.resetInteractionState=()=>{s()&&!e.isInteractionIdle()&&(t.widgetState.clearPolyLine(),o()),n.resetInteractionState()},e.handleLeftButtonPress=r=>{var h;if(((h=n.handleLeftButtonPress)==null?void 0:h.call(n,r))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||!t.manipulator||de(r))return _.VOID;if(t.widgetState.getFinalized())return _.VOID;const l=t._widgetManager.getActiveWidget();if(l&&l!==e)return _.VOID;const c=Te(t,r);if(!c)return _.VOID;const d=nt(c,t.widgetState.getReferencePlane());return e.getInteractionState()===Q.PointPlacing?(a(d),t.widgetState.add2dPointToPolyLine(d),e.invokeInteractionEvent()):(t._widgetManager.grabFocus(e),e.setInteractionState(Q.PointPlacing),t.widgetState.setFinalized(!1),t.widgetState.clearPolyLine(),t.widgetState.add2dPointToPolyLine(d),t.widgetState.add2dPointToPolyLine(d),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent()),_.EVENT_ABORT},e.handleMouseMove=r=>{var c;if(((c=n.handleMouseMove)==null?void 0:c.call(n,r))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||e.getInteractionState()!==Q.PointPlacing||de(r))return _.VOID;const l=Te(t,r);if(l){const d=nt(l,t.widgetState.getReferencePlane());a(d),e.invokeInteractionEvent()}return _.EVENT_ABORT},e.handleRightButtonPress=r=>{var l;if(((l=n.handleRightButtonPress)==null?void 0:l.call(n,r))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||e.getInteractionState()!==Q.PointPlacing||de(r))return _.VOID;if(i(),t.widgetState.getPolyLineLength()<=2)t.widgetState.clearPolyLine();else{const c=Ks(t.widgetState.getPolyLine(),{degree:2,interPointSpacing:.01,closed:!0,clamped:!1});t.widgetState.setPolyLine(c),t.widgetState.setFinalized(!0)}return o(),_.EVENT_ABORT}}const{vtkErrorMacro:xh}=_;function Lh(e,t){t.classHierarchy.push("vtkImageMarchingSquares"),e.getContourValues=()=>t.contourValues,e.setContourValues=i=>{t.contourValues=i,e.modified()};const n=[],s=[],o=[],a=Xr.newInstance();e.getPixelScalars=(i,r,l,c,d,h,g,v)=>{n[0]=l*c+r*d[0]+i,n[1]=n[0]+1,n[2]=n[0]+d[0],n[3]=n[2]+1;const p=i>=0,f=r>=0,m=i+1<d[0],y=r+1<d[1];s[0]=p&&f?v[n[0]]:0,s[1]=m&&f?v[n[1]]:0,s[2]=p&&y?v[n[2]]:0,s[3]=m&&y?v[n[3]]:0},e.getPixelPoints=(i,r,l,c,d,h)=>{o[0]=d[0]+i*h[0],o[1]=d[1]+r*h[1],o[2]=o[0]+h[0],o[3]=o[1],o[4]=o[0],o[5]=o[1]+h[1],o[6]=o[2],o[7]=o[5]},e.produceLines=(i,r,l,c,d,h,g,v,p,f,m)=>{var O;const y=[1,2,8,4],I=[];let S;e.getPixelScalars(r,l,c,d,h,g,v,p);let b=0;for(let k=0;k<4;k++)s[k]>=i&&(b|=y[k]);const E=Wo.getCase(b);if(E[0]<0)return;e.getPixelPoints(r,l,c,h,g,v);const R=g[2]+c*v[2];for(let k=0;E[k]>=0;k+=2){m.push(2);for(let H=0;H<2;H++){const J=Wo.getEdge(E[k+H]);if(S=void 0,t.mergePoints&&(S=(O=a.isInsertedEdge(n[J[0]],n[J[1]]))==null?void 0:O.value),S===void 0){const B=J[0]*2,W=o[B],te=o[B+1],be=J[1]*2,me=o[be],Xe=o[be+1];I[0]=W+.5*(me-W),I[1]=te+.5*(Xe-te),S=f.length/3,f.push(I[0],I[1],R),t.mergePoints&&a.insertEdge(n[J[0]],n[J[1]],S)}m.push(S)}}},e.requestData=(i,r)=>{const l=i[0];if(!l){xh("Invalid or missing input");return}const c=l.getOrigin(),d=l.getSpacing(),h=l.getDimensions(),g=l.getPointData().getScalars().getData(),v=[],p=[],f=h[0]*h[1];let m=Math.round(t.slice);m>=h[2]&&(m=0);for(let I=0;I<t.contourValues.length;++I){for(let S=-1;S<h[1];++S)for(let b=-1;b<h[0];++b)e.produceLines(t.contourValues[I],b,S,m,f,h,c,d,g,v,p);a.initialize()}const y=tt.newInstance();y.getPoints().setData(new Float32Array(v),3),y.getLines().setData(new Uint32Array(p)),r[0]=y}}const Rh={contourValues:[],slice:0,mergePoints:!1};function qs(e,t,n={}){Object.assign(t,Rh,n),_.obj(e,t),_.algo(e,t,1,1),_.setGet(e,t,["slice","mergePoints"]),_.algo(e,t,1,1),Lh(e,t)}const kh=_.newInstance(qs,"vtkImageMarchingSquares"),Mh={newInstance:kh,extend:qs},Ys=2,Eh=1,Ph=0;function Oh(e,t){const n=[...e];return n.splice(t,1),n}function Ah(e,t){const[n,s]=Oh(e.getDimensions(),t),o=new Uint8Array(n*s),a=Ea.newInstance({values:o,numberOfComponents:1}),i=Ma.newInstance();return i.setDimensions([n,s,1]),i.getPointData().setScalars(a),i}function Bh(e,t,n){const s=[...e];return s.splice(t,0,n),s}function fn(e,t){const n=[...e];return n.splice(t,1),n}function Vh(e,t){return _a(e,t)}function la(e,t=3){if(t>3)throw new Error("Cannot support dim > 3");const n=e.getPointData().getScalars().getData(),[s,o,a]=e.getDimensions(),i=t===3?s*o:0,r=t>=2?s:0;return{get:l=>{const c=l[0]??0,d=l[1]??0,h=l[2]??0;return n[h*i+d*r+c]},set:(l,c)=>{const d=l[0]??0,h=l[1]??0,g=l[2]??0;n[g*i+h*r+d]=c},inBounds:l=>{const c=l[0]??0,d=l[1]??0,h=l[2]??0;return c>=0&&c<s&&d>=0&&d<o&&h>=0&&h<a},fill:l=>{n.fill(l)}}}function $h(e,t,n,s,o,a,i,r=Vh){const l=la(e,3),c=la(s,2),d=fn(o,t),h=l.get(o),g=h-a,v=h+a;c.fill(Ph);const p=[d];for(;p.length;){const f=p.shift();if(!c.inBounds(f)||c.get(f)!==0||r(d,f)>i)continue;c.set(f,Eh);const m=Bh(f,t,n),y=l.get(m);if(y<g||y>v)continue;c.set(f,Ys);const[I,S]=f;for(let b=-1;b<=1;b++)for(let E=-1;E<=1;E++)(!b&&E||b&&!E)&&p.push([I+b,S+E])}}function Fh(e){const t=Mh.newInstance({mergePoints:!0});return t.setContourValues([Ys]),t.setInputData(e),t.getOutputData()}Vt(0,1,0,0,0,0,1,0,1,0,0,0,0,0,0,1),Vt(1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1),Vt(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);function Nh(e,t){t.classHierarchy.push("vtkContourLoopExtraction");const n=new Set;e.traverseLoop=(s,o,a,i,r)=>{let l=a,c=i,d=!1,h=0;for(;!d;){const{cellPointIds:g}=s.getCellPoints(l);if(!g)continue;c=g[0]!==c?g[0]:g[1],h++;const v=o*h;r.push({t:v,ptId:c});const p=s.getPointCells(c);if(p.length!==2||c===i)return c;p.length===2?(l=p[0]!==l?p[0]:p[1],n.add(l)):d=!0}return c},e.computeConvexHull=(s,o)=>{const a=s.getPoints().getData(),i=[];for(let d=0;d<a.length;d+=3)i.push([a[d],a[d+1]]);const r=Ki(i,1/0),l=new a.constructor(r.length*3),c=new Uint32Array(1+r.length+1);c[0]=r.length;for(let d=0,h=0;d<r.length;d++,h+=3){const g=r[d];l[h]=g[0],l[h+1]=g[1],l[h+2]=0,c[d+1]=d}c[c.length-1]=c[1],o.getPoints().setData(l),o.getLines().setData(c)},e.extractContours=(s,o)=>{var l;const a=[];n.clear();const i=s.getLines();o.getPoints().setData(Float32Array.from(s.getPoints().getData()));for(let c=0;c<i.getNumberOfCells();c++){if(n.has(c))continue;const{cellPointIds:d}=s.getCellPoints(c);if(!d)continue;n.add(c);const h=d[0],g=[];g.push({t:0,ptId:h});const v=e.traverseLoop(s,1,c,h,g);h!==v&&(e.traverseLoop(s,-1,c,h,g),g.sort((p,f)=>p.t<f.t?-1:1),g.length&&g[0].ptId!==((l=g.at(-1))==null?void 0:l.ptId)&&g.push({...g.at(-1)})),g.length&&a.push(g)}const r=o.getLines();if(r.resize(0),e.getMergeContours()&&a.length){let c=0,d=0;a.forEach((h,g)=>{h.length>d&&(c=g,d=h.length)}),r.insertNextCell(a[c].map(h=>h.ptId))}else a.forEach(c=>{r.insertNextCell(c.map(d=>d.ptId))})},e.requestData=(s,o)=>{const[a]=s;o[0]||(o[0]=tt.newInstance());const[i]=o;e.getConvexHull()?e.computeConvexHull(a,i):e.extractContours(a,i),i.modified()}}const Hh={mergeContours:!1,convexHull:!1};function Js(e,t,n={}){Object.assign(t,Hh,n),_.obj(e,t),_.algo(e,t,1,1),_.setGet(e,t,["mergeContours","convexHull"]),Nh(e,t)}const zh=_.newInstance(Js,"vtkContourLoopExtraction"),Wh={newInstance:zh,extend:Js};function jh(e){return Array.isArray(e)?[...e]:e.constructor.from(e)}function Uh(e,t){t.classHierarchy.push("vtkTransformPolyDataToPlane"),e.requestData=(n,s)=>{const o=e.getRefPlane()??Os(),[a]=n;s[0]||(s[0]=tt.newInstance());const[i]=s,r=Float32Array.from(a.getPoints().getData());i.getPoints().setData(r);const l=[0,0],c=[0,0,0];for(let h=0;h<r.length;h+=3)wt(l,r[h],r[h+1]),Rn(l,o,c),r[h]=c[0],r[h+1]=c[1],r[h+2]=c[2];const d=a.getLines().getData();i.getLines().setData(jh(d)),i.modified()}}const Gh={refPlane:null};function Zs(e,t,n={}){Object.assign(t,Gh,n),_.obj(e,t),_.algo(e,t,1,1),_.setGet(e,t,["refPlane"]),Uh(e,t)}const Xh=_.newInstance(Zs,"vtkTransformPolyDataToPlane"),Kh={newInstance:Xh,extend:Zs},qh="m",Yh="c",Jh=2;function Zh(){const e=Va.newInstance(),t=Qt.newInstance(),n=e.getProperty();return e.setMapper(t),{actor:e,mapper:t,property:n}}function Qh(e,t){const n={...e};t.imageData=null,t.sliceAxis=0,t.slice=0,t.loops=tt.newInstance(),t.maskBoundaryLines=tt.newInstance(),t.mergeContours=!1,t.doConvexHull=!1,t.contour=Zh(),t.contour.property.setLineWidth(Jh),t.contourLoopExtraction=Wh.newInstance(),t.transformPolyData=Kh.newInstance(),t.transformPolyData.setInputConnection(t.contourLoopExtraction.getOutputPort());function s(){t.contour.mapper.setInputData(tt.newInstance())}function o(){var y;(y=t._renderer)==null||y.addActor(t.contour.actor)}function a(){var y;(y=t._renderer)==null||y.removeActor(t.contour.actor)}function i(){const y=t.widgetState.getStore(),I=t.widgetState.getId(),S=y.toolByID[I],b=t.contourLoopExtraction.getOutputData(),E=b.getLines(),R=b.getPoints(),O=E.getData().length,k=[0,0,0];for(let H=0;H<O;){const J=E.getCell(H);H+=J.length+1;const ee=[];let{length:B}=J;J[0]===J.at(-1)&&B--;for(let W=0;W<B;W++)R.getPoint(J[W],k),ee.push(k[0],k[1]);y.addTool({...S,polyLine:ee})}}s();let r=null,l=null,c=0,d=0,h=[0,0,0],g=[0,0,0],v=[0,0];function p(){if(!r)return;t.transformPolyData.setRefPlane(t.widgetState.getReferencePlane());const y=t.transformPolyData.getOutputData();t.contour.mapper.setInputData(y),t.contour.mapper.modified()}function f(){return e.getMode()===Ae.Threshold}function m(){a(),s(),e.getWidgetState().getCircleContext().setVisible(!1),t._widgetManager.releaseFocus(),e.setInteractionState(Q.Idle),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent()}e.resetInteractionState=()=>{f()&&!e.isInteractionIdle()&&m(),n.resetInteractionState()},e.setThresholdingImageSlice=(y,I,S)=>{t.imageData=y,t.sliceAxis=I,t.slice=Math.round(S)},e.handleKeyPress=y=>{var S;if(((S=n.handleKeyPress)==null?void 0:S.call(n,y))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!f()||!t.manipulator||de(y)||t.widgetState.getFinalized()||e.getInteractionState()!==Q.Thresholding)return _.VOID;let I=!1;return y.key===qh?(t.mergeContours=!t.mergeContours,t.contourLoopExtraction.setMergeContours(t.mergeContours),I=!0):y.key===Yh&&(t.doConvexHull=!t.doConvexHull,t.contourLoopExtraction.setConvexHull(t.doConvexHull),I=!0),I?(p(),e.invokeInteractionEvent(),_.EVENT_ABORT):_.VOID},e.handleLeftButtonPress=y=>{var E;if(((E=n.handleLeftButtonPress)==null?void 0:E.call(n,y))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!f()||!t.manipulator||de(y))return _.VOID;if(!t.imageData||t.sliceAxis==null||t.slice==null)return _.VOID;if(r=t.imageData,c=t.sliceAxis,d=t.slice,l=Ah(r,c),t.widgetState.getFinalized())return _.VOID;const I=t._widgetManager.getActiveWidget();if(I&&I!==e)return _.VOID;const S=Te(t,y);if(!S)return _.VOID;o(),t.mergeContours=!1;const b=t.imageData.worldToIndex(S);return h=S,g=jo(b),v=fn(g,c),t._widgetManager.grabFocus(e),e.setInteractionState(Q.Thresholding),t.widgetState.setFinalized(!1),t.widgetState.clearPolyLine(),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),_.EVENT_ABORT},e.handleMouseMove=y=>{var S;if(((S=n.handleMouseMove)==null?void 0:S.call(n,y))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!f()||e.getInteractionState()!==Q.Thresholding||de(y))return _.VOID;if(!r)return _.VOID;const I=jo(r.worldToIndex(Te(t,y)));if(I&&r&&l){const b=fn(I,c),E=Math.abs(b[0]-v[0]),R=Math.abs(b[1]-v[1]),O=r.getDimensions(),k=fn(O,c),H=Math.sqrt(k[0]**2+O[1]**2),J=r.getPointData().getScalars().getRange(),ee=J[1]-J[0],B=Math.min(R,H)/H*ee;$h(r,c,d,l,g,B,E),t.maskBoundaryLines=Fh(l),t.maskBoundaryLines.buildLinks(),t.contourLoopExtraction.setInputData(t.maskBoundaryLines),p();const W=t.manipulator.getNormal(),te=t._renderer.getActiveCamera().getViewUp(),be=Me();Jn(be,te,W);const me=t.widgetState.getCircleContext();me.setDirection(W),me.setUp(te),me.setRight(be),me.setOrigin(h),me.setScale3([E,R,1]),me.setVisible(!0),e.invokeInteractionEvent()}return _.EVENT_ABORT},e.handleLeftButtonRelease=y=>{var I;return((I=n.handleLeftButtonRelease)==null?void 0:I.call(n,y))===_.EVENT_ABORT?_.EVENT_ABORT:!f()||e.getInteractionState()!==Q.Thresholding||de(y)?_.VOID:(i(),m(),_.EVENT_ABORT)}}function eg(e,t){t.classHierarchy.push("vtkContourWidgetProp"),t.interactionState=Q.Idle,t.mode=null,_.event(e,t,"RightClickEvent"),_.setGet(e,t,["manipulator"]),_.setGet(e,t,["mode"]),_.setGet(e,t,["interactionState"]),e.setDisplayCallback=n=>t.representations[0].setDisplayCallback(n),e.isInteractionIdle=()=>e.getInteractionState()===Q.Idle,e.resetInteractionState=()=>{e.setInteractionState(Q.Idle)},e.isSelected=()=>t.widgetState.getSelected(),e.handleRightButtonPress=n=>de(n)||t._widgetManager.getActiveWidget()!==e?_.VOID:(e.invokeRightClickEvent(n),_.EVENT_ABORT),yh(e,t),mh(e,t),Th(e,t),Ih(e,t),Qh(e,t)}function tg(e,t,n){bn.extend(e,t,n),Kr.extend(e,t,n),Aa.extend(e,t,n),qr.extend(e,t,n),Yr.extend(e,t,n)}const ng=_.newInstance(tg,"vtkCircleContextContourWidgetState");function og(e,t){t.classHierarchy.push("vtkContourWidgetState"),t._circleContextState=ng(),e.bindState(t._circleContextState,["circleContext"]),e.getCircleContext=()=>t._circleContextState;function n(){return t._store.toolByID[t.id]}e.getPolyLine=()=>{var o;return qi((o=n())==null?void 0:o.polyLine)},e.getReferencePlane=()=>{var o;return(o=n())==null?void 0:o.referencePlane},e.getPolyLineLength=()=>{var a;const o=(a=n())==null?void 0:a.polyLine;return o?o.length/2:0};const s=Ne();e.add3dPointToPolyLine=o=>{const a=e.getPolyLine(),i=e.getReferencePlane();!a||!i||(nt(o,i,s),e.add2dPointToPolyLine(s))},e.add2dPointToPolyLine=o=>{const a=e.getPolyLine();a&&(a.push(...o),e.modified())},e.clearPolyLine=()=>{const o=e.getPolyLine();o&&(o.length=0,e.modified())},e.setPolyLine=o=>{const a=n();a&&(a.polyLine=o,e.modified())},e.getColor=()=>{var a;const o=(a=n())==null?void 0:a.label;return o?w0(t._store.labels[o].color).map(i=>i/255):null}}const ag=e=>({finalized:!1,selected:!1,...e});function sg(e,t,n){if(Object.assign(t,ag(n)),bn.extend(e,t,n),Ba.extend(e,t),_.get(e,t,["id"]),_.setGet(e,t,["finalized","selected"]),_.moveToProtected(e,t,["store"]),_.get(e,t,["_store"]),!t.id)throw new Error("No ID provided!");if(!t._store)throw new Error("No store provided!");og(e,t)}const ig=_.newInstance(sg,"vtkContourWidgetState");function rg(e){return ig(e)}function lg(e,t){t.classHierarchy.push("vtkContourWidget"),e.getRepresentationsForViewType=n=>{switch(n){case Qe.DEFAULT:case Qe.GEOMETRY:case Qe.SLICE:case Qe.VOLUME:default:return[{builder:fh},{builder:Jr,labels:["circleContext"]}]}},e.setManipulator(t.manipulator||Ge.newInstance())}const cg=e=>({manipulator:null,behavior:eg,widgetState:rg(e),...e});function Qs(e,t,n={}){Object.assign(t,cg(n)),_n.extend(e,t,n),_.setGet(e,t,["manipulator"]),_.event(e,t,"finalized"),lg(e,t)}const dg=_.newInstance(Qs,"vtkContourWidget"),ug={newInstance:dg,extend:Qs},hg={[ye.Select]:Ae.Select,[ye.FreehandDraw]:Ae.Freehand,[ye.CircleNudge]:Ae.Nudge,[ye.PointPlacing]:Ae.PointPlacing,[ye.Threshold]:Ae.Threshold},gg=q({name:"ContourWidget2D",emits:["finalize","select","contextmenu"],props:{contourId:{type:String,required:!0},widgetManager:{type:Object,required:!0},viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},currentSlice:{type:Number,required:!0},drawing:{type:Boolean,default:!1},selected:{type:Boolean,default:!1},mode:{type:String,required:!0}},setup(e,{emit:t}){const{viewId:n,contourId:s,widgetManager:o,viewDirection:a,currentSlice:i,drawing:r,selected:l,mode:c}=ie(e),d=Et(),h=T(()=>d.toolByID[s.value]),{currentImageData:g,currentImageID:v,currentImageMetadata:p}=le(),f=T(()=>d.$proxies.getView(n.value)),m=ug.newInstance({id:s.value,store:d,finalized:!r.value}),y=V(null),I=T(()=>{var k;return(k=y.value)==null?void 0:k.getWidgetState()});se(()=>{y.value=o.value.addWidget(m)}),He(()=>{y.value&&(o.value.removeWidget(y.value),y.value.delete(),m.delete())}),ge(()=>{var H;const k=hg[c.value];(H=y.value)==null||H.setMode(k)}),N([i,v,y],()=>{var k;(k=y.value)==null||k.resetInteractionState()}),Ee(()=>{var k;(k=y.value)==null||k.resetInteractionState()}),Ce(T(()=>{var k;return(k=y.value)==null?void 0:k.onEndInteractionEvent}))(()=>{var k;(k=y.value)!=null&&k.getWidgetState().getFinalized()&&t("finalize")}),Ce(T(()=>{var k;return(k=y.value)==null?void 0:k.onSelectedEvent}))(k=>{t("select",k)}),ge(()=>{var k,H;(k=I.value)==null||k.setSelected(l.value),(H=f.value)==null||H.renderLater()});let E=null;se(()=>{y.value&&(E=y.value.onRightClickEvent(k=>{const H=go(k);H&&t("contextmenu",H)}))}),Ee(()=>{E&&(E.unsubscribe(),E=null)});const R=Ge.newInstance();se(()=>{var k;(k=y.value)==null||k.setManipulator(R)}),ge(()=>{an(R,a.value,i.value,p.value)}),N(()=>{var k;return!!f.value&&!!y.value&&((k=h.value)==null?void 0:k.slice)===i.value},k=>{var H;(H=y.value)==null||H.setVisibility(k)},{immediate:!0}),se(()=>{var k;y.value&&(y.value.setHandleVisibility(!1),o.value.renderWidgets(),(k=f.value)==null||k.renderLater())}),N(()=>{var k;return(k=y.value)==null?void 0:k.getWidgetState().getColor()},()=>{var k,H;(k=y.value)==null||k.getWidgetState().modified(),(H=f.value)==null||H.renderLater()});const O=T(()=>p.value.lpsOrientation[Ie(a.value)]);return ge(()=>{const k=g.value,H=O.value,J=i.value;y.value&&k&&y.value.setThresholdingImageSlice(k,H,J)}),()=>null}}),pg=new Set([ye.FreehandDraw,ye.PointPlacing,ye.Threshold]);function fg(e,t,n=1e-6){return Math.abs(e-t)<n}const mg=q({components:{ContourWidget2D:gg},props:{viewId:{type:String,required:!0},currentSlice:{type:Number,required:!0},viewDirection:{type:String,required:!0},widgetManager:{type:Object,required:!0}},setup(e){const{viewId:t,viewDirection:n,currentSlice:s}=ie(e),o=ze(),a=Et(),{currentImageID:i,currentImageMetadata:r}=le(),l=T(()=>Ie(n.value)),{mode:c,selectedContourID:d}=St(a),h=V(null),g=T(()=>o.currentTool===ce.Contour),v=T(()=>ue().viewSpecs[t.value].viewType),p=(B,W)=>{const{toolByID:te}=a;if(!(B in te))return!1;const{referencePlane:be,imageID:me}=te[B],Xe=Gu(be),Pt=Ln(Xe,r.value,{allowOutOfBoundsSlice:!0});if(!Pt)return!1;const An=(W==null?void 0:W.checkImageID)??!1,rn=(W==null?void 0:W.checkSlice)??!1,{axis:Bn,slice:ln}=Pt;return Bn===l.value&&(!An||me===i.value)&&(!rn||fg(ln,s.value))},f=T(()=>a.toolIDs.filter(B=>p(B,{checkImageID:!0,checkSlice:!0})).map(B=>a.toolByID[B]).filter(Boolean)),m=()=>{h.value=null},y=()=>{i.value&&!h.value&&(h.value=a.addTool({imageID:i.value}))},I=()=>{h.value!=null&&(a.removeTool(h.value),h.value=null)},{activeLabel:S}=St(a);N([S,h],([B,W])=>{W&&a.updateTool(W,{label:B})},{immediate:!0}),N([g,i],([B,W])=>{I(),B&&W&&y()},{immediate:!0}),N(c,B=>{I(),pg.has(B)&&y()},{immediate:!0}),He(()=>{I()});const b=B=>{B===h.value&&(m(),y())};function E(){const{lpsOrientation:B,indexToWorld:W}=r.value,te=B[l.value];return Ku(W,s.value,te)}N([s,h],([B,W])=>{W&&a.updateTool(W,{slice:B,referencePlane:E()})},{immediate:!0});const R=(B,W)=>{W?a.selectContour(B):B===d.value&&a.selectContour(null)};N([s,i],()=>{const B=d.value;B&&p(B,{checkImageID:!0,checkSlice:!0})&&a.selectContour(null)}),wa(["Delete","Backspace"],B=>{B.preventDefault(),d.value&&a.removeTool(d.value)});const O=Ve({visible:!1,x:0,y:0,id:""}),k=(B,W)=>{[O.x,O.y]=W,O.visible=!0,O.id=B},H=()=>{a.removeTool(O.id)},J=T(()=>{const{id:B}=O;if(!(B in a.toolByID))return[];const W=a.toolByID[B];return Object.entries(a.labels).map(([te,be])=>({id:te,name:be.labelName,isCurrent:W.label===te}))}),ee=B=>{a.updateTool(O.id,{label:B})};return{isToolActive:g,is2D:T(()=>v.value==="2D"),contours:f,drawingContourID:h,selectedContourID:d,toolMode:T(()=>g.value?c.value:ye.Select),contextMenu:O,contextMenuLabels:J,onContourFinalized:b,onContourSelected:R,onContextMenu:k,deleteFromContextMenu:H,setLabelFromContextMenu:ee}}});const vg=e=>(oe("data-v-f446464d"),e=e(),ae(),e),yg={key:0,class:"overlay-no-events"},wg=vg(()=>u("span",null,"Change label to...",-1));function Sg(e,t,n,s,o,a){const i=M("ContourWidget2D");return e.is2D?(D(),x("div",yg,[(D(!0),x(ne,null,fe(e.contours,r=>(D(),Y(i,{key:r.id,"view-id":e.viewId,"current-slice":e.currentSlice,"contour-id":r.id,"view-direction":e.viewDirection,"widget-manager":e.widgetManager,drawing:e.drawingContourID===r.id,mode:e.toolMode,selected:e.selectedContourID===r.id,onFinalize:l=>e.onContourFinalized(r.id),onSelect:l=>e.onContourSelected(r.id,l),onContextmenu:l=>e.onContextMenu(r.id,l)},null,8,["view-id","current-slice","contour-id","view-direction","widget-manager","drawing","mode","selected","onFinalize","onSelect","onContextmenu"]))),128)),w(Ct,{modelValue:e.contextMenu.visible,"onUpdate:modelValue":t[1]||(t[1]=r=>e.contextMenu.visible=r),style:j({position:"absolute",top:`${e.contextMenu.y}px`,left:`${e.contextMenu.x}px`}),"close-on-click":"","close-on-content-click":""},{default:L(()=>[w(zt,{dense:""},{default:L(()=>[w(et,{onClick:t[0]||(t[0]=Se(()=>{},["stop"]))},{default:L(()=>[w(Re,{class:"d-flex flex-row align-center justify-space-betwen"},{default:L(()=>[wg,w(_t,null,{default:L(()=>[X("mdi-chevron-right")]),_:1})]),_:1}),w(Ct,{"open-on-hover":"",activator:"parent",location:"end"},{default:L(()=>[w(zt,{dense:""},{default:L(()=>[(D(!0),x(ne,null,fe(e.contextMenuLabels,(r,l)=>(D(),Y(et,{key:l},{default:L(()=>[w(mr,{label:r.name,"model-value":r.isCurrent,onClick:c=>e.setLabelFromContextMenu(r.id)},null,8,["label","model-value","onClick"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),w(et,{onClick:e.deleteFromContextMenu},{default:L(()=>[w(Re,null,{default:L(()=>[X("Delete")]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1},8,["modelValue","style"])])):z("",!0)}const _g=A(mg,[["render",Sg],["__scopeId","data-v-f446464d"]]),Cg=q({name:"PaintWidget2D",props:{widgetManager:{type:Object,required:!0},viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},slice:{type:Number,required:!0}},setup(e){const{widgetManager:t,viewDirection:n,slice:s,viewId:o}=ie(e),a=dt(),i=a.getWidgetFactory(),r=ue(),l=T(()=>r.getViewProxy(o.value)),c=V(),{currentImageMetadata:d}=le(),h=T(()=>Ie(n.value)),g=T(()=>d.value.lpsOrientation[h.value]),v=m=>{const{worldToIndex:y}=d.value,I=Me();return pe(I,m,y),I};se(()=>{const m=t.value;if(c.value=m.addWidget(i),!c.value)throw new Error("[PaintWidget2D] failed to create view widget")}),ge(()=>{const m=c.value,y=d.value,I=y.lpsOrientation[h.value];m&&(m.setSlicingIndex(I),m.setIndexToWorld(y.indexToWorld),m.setWorldToIndex(y.worldToIndex))});const p=[];se(()=>{const m=c.value;p.push(m.onStartInteractionEvent(()=>{const y=m.getWidgetState(),I=v(y.getBrush().getOrigin());a.startStroke(I,g.value)}),m.onInteractionEvent(()=>{const y=m.getWidgetState(),I=v(y.getBrush().getOrigin());a.placeStrokePoint(I,g.value)}),m.onEndInteractionEvent(()=>{const y=m.getWidgetState(),I=v(y.getBrush().getOrigin());a.endStroke(I,g.value)}))}),He(()=>{for(;p.length;)p.pop().unsubscribe()});const f=Ge.newInstance();return se(()=>{c.value.setManipulator(f)}),ge(()=>{an(f,n.value,s.value,d.value)}),se(()=>{c.value.setVisibility(!1)}),qt(l.value.getInteractor().onMouseEnter(()=>{const m=c.value;m&&(a.setSliceAxis(g.value),m.setVisibility(!0))})),qt(l.value.getInteractor().onMouseLeave(()=>{const m=c.value;m&&m.setVisibility(!1)})),se(()=>{const m=t.value;m.renderWidgets(),m.grabFocus(c.value)}),Ee(()=>{t.value.removeWidget(c.value),t.value.releaseFocus()}),()=>null}}),bg=q({name:"PaintTool",props:{viewId:{type:String,required:!0},slice:{type:Number,required:!0},viewDirection:{type:String,required:!0},widgetManager:{type:Object,required:!0}},components:{PaintWidget2D:Cg},setup(){const e=dt();return{active:T(()=>e.isActive)}}});const Dg={class:"overlay-no-events"};function Ig(e,t,n,s,o,a){const i=M("PaintWidget2D");return D(),x("div",Dg,[e.active?(D(),Y(i,{key:0,slice:e.slice,"view-id":e.viewId,"view-direction":e.viewDirection,"widget-manager":e.widgetManager},null,8,["slice","view-id","view-direction","widget-manager"])):z("",!0)])}const Tg=A(bg,[["render",Ig],["__scopeId","data-v-5ff6d31b"]]);function xg(e,t){const n=ue(),s=T(()=>n.getViewProxy(e.value)),o=T(()=>{var d;const c=(d=t.baseImage)==null?void 0:d.value;return c?n.getDataRepresentationForView(c,e.value):null}),a=T(()=>{var d;return(((d=t.labelmaps)==null?void 0:d.value)??[]).map(h=>n.getDataRepresentationForView(h,e.value)).filter(Boolean)}),i=T(()=>{var c;return(((c=t.layers)==null?void 0:c.value)??[]).map(d=>n.getDataRepresentationForView(d,e.value)).filter(Boolean)}),r=T(()=>{var d;return(((d=t.models)==null?void 0:d.value)??[]).map(h=>n.getDataRepresentationForView(h,e.value)).filter(Boolean)}),l=T(()=>[o.value,...a.value,...i.value,...r.value].filter(Boolean));return N([s,l],([c,d],[,h])=>{if(!c)throw new Error("[useSceneBuilder] No view available");h&&to(d,h)||(c.removeAllRepresentations(),d.forEach(g=>{c.addRepresentation(g)}),c.getRenderer().computeVisiblePropBounds(),c.renderLater())},{immediate:!0}),{baseImageRep:o,labelmapReps:a,layerReps:i,modelReps:r}}function Lg(e,t,n,...s){const o=po();let a=!0;const i=[];s.indexOf("position")>-1&&i.push(()=>{t.value!==null&&a&&o.updateConfig(e.value,t.value,{position:n.value.getCamera().getPosition()})}),s.indexOf("viewUp")>-1&&i.push(()=>{t.value!==null&&a&&o.updateConfig(e.value,t.value,{viewUp:n.value.getCamera().getViewUp()})}),s.indexOf("focalPoint")>-1&&i.push(()=>{t.value!==null&&a&&o.updateConfig(e.value,t.value,{focalPoint:n.value.getCamera().getFocalPoint()})}),s.indexOf("directionOfProjection")>-1&&i.push(()=>{t.value!==null&&a&&o.updateConfig(e.value,t.value,{directionOfProjection:n.value.getCamera().getDirectionOfProjection()})}),s.indexOf("parallelScale")>-1&&i.push(()=>{t.value!==null&&a&&o.updateConfig(e.value,t.value,{parallelScale:n.value.getCamera().getParallelScale()})}),qt(n.value.getCamera().onModified(()=>{i.forEach(c=>c())}));function r(c){a=!1;try{c()}finally{a=!0}}function l(c){r(()=>{s.forEach(d=>{if(d==="parallelScale"&&c.parallelScale)n.value.getCamera().setParallelScale(c.parallelScale);else if(d==="position"&&c.position){const{position:h}=c;n.value.getCamera().setPosition(h[0],h[1],h[2])}else if(d==="focalPoint"&&c.focalPoint){const{focalPoint:h}=c;n.value.getCamera().setFocalPoint(h[0],h[1],h[2]),n.value.getInteractorStyle2D().setCenterOfRotation([...h]),n.value.getInteractorStyle3D().setCenterOfRotation([...h])}else if(d==="directionOfProjection"&&c.directionOfProjection){const{directionOfProjection:h}=c;n.value.getCamera().setDirectionOfProjection(h[0],h[1],h[2])}else if(d==="viewUp"&&c.viewUp){const{viewUp:h}=c;n.value.getCamera().setViewUp(h[0],h[1],h[2])}})})}return{restoreCameraConfig:l}}const Rg=q({name:"CrosshairsWidget2D",props:{widgetManager:{type:Object,required:!0},viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},slice:{type:Number,required:!0}},setup(e){const{widgetManager:t,viewDirection:n,slice:s}=ie(e),a=Kt().getWidgetFactory(),i=V(),{currentImageMetadata:r}=le();se(()=>{const c=t.value;if(i.value=c.addWidget(a),!i.value)throw new Error("[PaintWidget2D] failed to create view widget")});const l=Ge.newInstance();return se(()=>{i.value.setManipulator(l)}),ge(()=>{an(l,n.value,s.value,r.value)}),se(()=>{i.value.setVisibility(!0)}),se(()=>{t.value.renderWidgets()}),Ee(()=>{t.value.removeWidget(i.value)}),()=>null}}),kg=q({props:{position:Array,viewId:{type:String,required:!0}},setup(e){const{viewId:t,position:n}=ie(e),s=V(),o=ue(),a=T(()=>o.getViewProxy(t.value)),i=()=>{const c=a.value.getRenderer(),d=U(n);if(d){const h=Xt(d,c);h&&(s.value={x:h[0],y:h[1]})}};Ce(T(()=>a.value.getCamera().onModified))(i),ge(i);const l=Rt(Sn);return Mn(l,()=>{i()}),{devicePixelRatio,x:T(()=>{var c;return(c=s.value)==null?void 0:c.x}),y:T(()=>{var c;return(c=s.value)==null?void 0:c.y})}}});const Mg=["x1","x2","y2"],Eg=["x1","y1","x2"],Pg=["y1","x2","y2"],Og=["x1","y1","y2"];function Ag(e,t,n,s,o,a){return D(),x("g",null,[e.x!=null&&e.y!=null?(D(),x("line",{key:0,x1:e.x,y1:"0%",x2:e.x,y2:e.y-8,stroke:"yellow","stroke-width":"1"},null,8,Mg)):z("",!0),e.x!=null&&e.y!=null?(D(),x("line",{key:1,x1:e.x,y1:e.y+8,x2:e.x,y2:"100%",stroke:"yellow","stroke-width":"1"},null,8,Eg)):z("",!0),e.x!=null&&e.y!=null?(D(),x("line",{key:2,x1:"0%",y1:e.y,x2:e.x-8,y2:e.y,stroke:"yellow","stroke-width":"1"},null,8,Pg)):z("",!0),e.x!=null&&e.y!=null?(D(),x("line",{key:3,x1:e.x+8,y1:e.y,x2:"100%",y2:e.y,stroke:"yellow","stroke-width":"1"},null,8,Og)):z("",!0)])}const Bg=A(kg,[["render",Ag],["__scopeId","data-v-d7c70d6c"]]),Vg=q({name:"CrosshairsTool",props:{viewId:{type:String,required:!0},slice:{type:Number,required:!0},viewDirection:{type:String,required:!0},widgetManager:{type:Object,required:!0}},components:{CrosshairsWidget2D:Rg,CrosshairSVG2D:Bg},setup(e){const{viewDirection:t,slice:n}=ie(e),s=ze(),{position:o,imagePosition:a}=St(Kt()),{currentImageMetadata:i}=le(),r=T(()=>s.currentTool===ce.Crosshairs),l=T(()=>{const{lpsOrientation:c,dimensions:d}=i.value,h=Ie(t.value),g=c[h],v=ja(a.value[g],0,d[g]-1);return Math.round(v)===n.value});return{active:r,position:o,isVisible:l}}});const $g={key:0,class:"overlay-no-events"},Fg={class:"overlay-no-events"};function Ng(e,t,n,s,o,a){const i=M("CrosshairSVG2D"),r=M("CrosshairsWidget2D");return e.active?(D(),x("div",$g,[(D(),x("svg",Fg,[Ue(w(i,{"view-id":e.viewId,position:e.position},null,8,["view-id","position"]),[[Ht,e.isVisible]])])),w(r,{slice:e.slice,"view-id":e.viewId,"view-direction":e.viewDirection,"widget-manager":e.widgetManager},null,8,["slice","view-id","view-direction","widget-manager"])])):z("",!0)}const Hg=A(Vg,[["render",Ng],["__scopeId","data-v-8f19f7a7"]]);function zg(e,t){const n=ue(),s=V(null),o=i=>{s.value=i??null},a=T(()=>n.createOrGetViewProxy(U(e),U(t)));return N(a,(i,r)=>{r.setContainer(null),i.setContainer(s.value)}),N(s,i=>{a.value.setContainer(i),a.value.modified()}),{viewProxy:a,setContainer:o}}function Wg(e,t){Ce(T(()=>U(e).onModified))(t)}function ei(e){const t=V(!1),n=()=>{t.value=!!U(e).getContainer()};return n(),Wg(e,n),t}function ti(e,t){const n=ei(e);N(n,s=>{s&&t()},{immediate:!0})}function jg(e,t){const n=ei(e);N(n,(s,o)=>{o&&!s&&t()},{immediate:!0})}function Ug(e){const t=T(()=>Zr.newInstance({pickingEnabled:!1,useSvgLayer:!1,captureOn:Qr.MOUSE_MOVE}));return ti(e,()=>{t.value.setRenderer(e.value.getRenderer()),t.value.enablePicking()}),jg(e,()=>{t.value.disablePicking()}),N(t,(n,s)=>{n&&(n.setRenderer(e.value.getRenderer()),n.enablePicking()),s&&s.delete()}),He(()=>{t.value.delete()}),{widgetManager:t}}function ni(e){const t=st(),{currentImageMetadata:n,currentImageID:s}=le();return T(()=>{const o=t.getConfig(U(e),s.value);if(!o)return null;const{lpsOrientation:a}=n.value,i=Ie(o.axisDirection),r=[0,0,0];return r[a[i]]=o.slice,{axisName:i,axisIndex:a[i],number:o.slice,planeNormal:a[o.axisDirection],planeOrigin:r}})}function Gg(e){const t=V(null),n=()=>{var o;t.value=((o=U(e))==null?void 0:o.getContainer())??null};return Ce(T(()=>{var o;return(o=U(e))==null?void 0:o.onModified}))(n),n(),t}function Xg(e,t){const n=V([]),s=T(()=>{var r,l,c;return(c=(l=(r=U(t))==null?void 0:r.getRenderWindow())==null?void 0:l.getViews())==null?void 0:c[0]}),o=Gg(s),a=()=>{const r=U(e),l=U(t);r==null||!l||(n.value=r.map(c=>{const d=ks(c,l);return[d[0]/devicePixelRatio,d[1]/devicePixelRatio]}))},i=Ce(T(()=>{var r;return(r=U(t))==null?void 0:r.getActiveCamera().onModified}));return Yi(o,a),ge(a),i(a),a(),n}function Kg(e,t){const n=Xg(e,t);return T(()=>{var r,l;const o=n.value,a=U(t),i=(l=(r=a==null?void 0:a.getRenderWindow())==null?void 0:r.getViews())==null?void 0:l[0];if(a&&i){const[,c]=i.getViewportSize(a);return o.map(d=>[d[0],c/devicePixelRatio-d[1]])}return null})}const qg=q({props:{line:{required:!0,type:Object},clickWidth:{default:20,type:Number},outOfBounds:{default:!1,type:Boolean}},setup(){const e=V("grab"),t=V(null),n=V(0);return{onPointer:(a,i)=>{var r,l;a?(r=t.value)==null||r.setPointerCapture(i.pointerId):(l=t.value)==null||l.releasePointerCapture(i.pointerId),e.value=a?"grabbing":"grab"},onHover:a=>{n.value=a?2:0},cursor:e,grabLineEl:t,focusWidth:n}}});const Yg=["x1","y1","x2","y2","stroke-width"],Jg=["x1","y1","x2","y2","stroke-width","stroke-dasharray"],Zg=["x1","y1","x2","y2","stroke-width"],Qg=["x1","y1","x2","y2","stroke-width"];function ep(e,t,n,s,o,a){return D(),x("g",null,[u("line",{x1:e.line.startEdge[0],y1:e.line.startEdge[1],x2:e.line.startCrop[0],y2:e.line.startCrop[1],"stroke-width":2+e.focusWidth,"stroke-dasharray":"6","stroke-linecap":"square",stroke:"rgba(200, 255, 0, 0.5)"},null,8,Yg),u("line",{x1:e.line.startCrop[0],y1:e.line.startCrop[1],x2:e.line.endCrop[0],y2:e.line.endCrop[1],"stroke-width":2+e.focusWidth,"stroke-dasharray":e.outOfBounds?6:"none","stroke-linecap":"butt",stroke:"rgb(200, 255, 0)"},null,8,Jg),u("line",{x1:e.line.endCrop[0],y1:e.line.endCrop[1],x2:e.line.endEdge[0],y2:e.line.endEdge[1],"stroke-width":2+e.focusWidth,"stroke-dasharray":"6","stroke-linecap":"square",stroke:"rgba(200, 255, 0, 0.5)"},null,8,Zg),u("line",Jt({ref:"grabLineEl",class:"pointer-events-all",style:{cursor:e.cursor},onPointerenter:t[0]||(t[0]=i=>e.onHover(!0)),onPointerleave:t[1]||(t[1]=i=>e.onHover(!1)),onPointerdown:t[2]||(t[2]=i=>e.onPointer(!0,i)),onPointerup:t[3]||(t[3]=i=>e.onPointer(!1,i)),x1:e.line.startEdge[0],y1:e.line.startEdge[1],x2:e.line.endEdge[0],y2:e.line.endEdge[1],fill:"none","stroke-opacity":"0","stroke-dasharray":"none","stroke-width":Number(e.$attrs["stroke-width"]||0)+e.clickWidth||0},e.$attrs),null,16,Qg)])}const tp=A(qg,[["render",ep],["__scopeId","data-v-926e0a5c"]]);function ca(e,t,n,s){const o=ni(e);return T(()=>{const a=e.value,i=t.value,r=n.value,l=s.value,c=o.value;if(!a||!i||!c)return null;const d=c.axisName,[h]=oo.filter(S=>S!==i&&S!==d),g=r[i],v=r[h],p=l[h],f=r[d],m=c.number,y=m<f[0]||f[1]<m,I=S=>{const b=ft(),E=ft(),R=ft(),O=ft();return b[i]=g[S],E[i]=g[S],R[i]=g[S],O[i]=g[S],[b[h],O[h]]=p,[E[h],R[h]]=v,{startEdge:b,startCrop:E,endCrop:R,endEdge:O}};return{lowerLine:I(0),upperLine:I(1),outOfBounds:y}})}function da(e,t,n){const s=T(()=>{const a=e.value,{lpsOrientation:i,indexToWorld:r}=t.value;return a?[a.lowerLine.startEdge,a.lowerLine.startCrop,a.lowerLine.endCrop,a.lowerLine.endEdge,a.upperLine.startEdge,a.upperLine.startCrop,a.upperLine.endCrop,a.upperLine.endEdge].map(l=>{const c=[0,0,0];c[i.Sagittal]=l.Sagittal,c[i.Coronal]=l.Coronal,c[i.Axial]=l.Axial;const d=[0,0,0];return pe(d,c,r),d}):null}),o=Kg(s,n);return T(()=>{const a=e.value,i=o.value;return!a||!(i!=null&&i.length)?null:{lowerLine:{startEdge:i[0],startCrop:i[1],endCrop:i[2],endEdge:i[3]},upperLine:{startEdge:i[4],startCrop:i[5],endCrop:i[6],endEdge:i[7]},outOfBounds:a.outOfBounds}})}function np({mouseEventToLPSPoint:e,getCropEdgePos:t,setCropEdgePos:n}){const s=V(),o=V(),a=V(ft()),i=V(0);return{onPointerDown:(d,h,g)=>{const v=e(g);v&&(a.value=v,i.value=t(d,h),s.value=d,o.value=h)},onPointerMove:d=>{if(s.value==null||o.value==null)return;const h=s.value,g=e(d);if(!g)return;const v=g[h]-a.value[h];n(h,o.value,i.value+v)},onPointerUp:()=>{s.value=null,o.value=null}}}const op=q({props:{viewId:{required:!0,type:String}},components:{Crop2DLineHandle:tp},setup(e){const{viewId:t}=ie(e),n=ue(),s=T(()=>n.getViewProxy(t.value)),o=T(()=>{var R;return(R=s.value)==null?void 0:R.getRenderer()}),{currentImageExtent:a,currentImageID:i,currentImageMetadata:r}=le(),l=ni(t),c=T(()=>{var R;return((R=l.value)==null?void 0:R.axisName)??null}),d=Tt(),h=T(()=>{const R=i.value;return R&&R in d.croppingByImageID?d.croppingByImageID[R]:as()}),g=T(()=>oo.filter(R=>c.value&&R!==c.value)),v=T(()=>g.value[0]??null),p=T(()=>g.value[1]??null),f=ca(t,v,h,a),m=ca(t,p,h,a),y=da(f,r,o),I=da(m,r,o),{onPointerDown:S,onPointerMove:b,onPointerUp:E}=np({mouseEventToLPSPoint(R){const O=o.value;if(!O)return null;const k=l.value;if(!k)return null;const{lpsOrientation:H,worldToIndex:J}=r.value,ee=Du(R,O,k.planeOrigin,k.planeNormal);if(!ee)return null;pe(ee,ee,J);const B=ft();return B.Sagittal=ee[H.Sagittal],B.Coronal=ee[H.Coronal],B.Axial=ee[H.Axial],B},getCropEdgePos(R,O){return h.value[R][O]},setCropEdgePos(R,O,k){if(!i.value)return;const H=h.value,[J,ee]=H[R],[B,W]=a.value[R],te=[J,ee];O===0?te[0]=Math.max(B,Math.min(k,ee)):O===1&&(te[1]=Math.max(J,Math.min(k,W))),d.setCroppingForAxis(i.value,R,te)}});return{ax1:T(()=>({name:v.value,lines:y.value})),ax2:T(()=>({name:p.value,lines:I.value})),onPointerDown:S,onPointerMove:b,onPointerUp:E}}});function ap(e,t,n,s,o,a){const i=M("crop-2D-line-handle");return D(),x("g",null,[e.ax1.lines!=null?(D(),x(ne,{key:0},[w(i,{line:e.ax1.lines.lowerLine,"out-of-bounds":e.ax1.lines.outOfBounds,onPointerdown:t[0]||(t[0]=r=>e.onPointerDown(e.ax1.name,0,r)),onPointermove:e.onPointerMove,onPointerup:e.onPointerUp},null,8,["line","out-of-bounds","onPointermove","onPointerup"]),w(i,{line:e.ax1.lines.upperLine,"out-of-bounds":e.ax1.lines.outOfBounds,onPointerdown:t[1]||(t[1]=r=>e.onPointerDown(e.ax1.name,1,r)),onPointermove:e.onPointerMove,onPointerup:e.onPointerUp},null,8,["line","out-of-bounds","onPointermove","onPointerup"])],64)):z("",!0),e.ax2.lines!=null?(D(),x(ne,{key:1},[w(i,{line:e.ax2.lines.lowerLine,"out-of-bounds":e.ax2.lines.outOfBounds,onPointerdown:t[2]||(t[2]=r=>e.onPointerDown(e.ax2.name,0,r)),onPointermove:e.onPointerMove,onPointerup:e.onPointerUp},null,8,["line","out-of-bounds","onPointermove","onPointerup"]),w(i,{line:e.ax2.lines.upperLine,"out-of-bounds":e.ax2.lines.outOfBounds,onPointerdown:t[3]||(t[3]=r=>e.onPointerDown(e.ax2.name,1,r)),onPointermove:e.onPointerMove,onPointerup:e.onPointerUp},null,8,["line","out-of-bounds","onPointermove","onPointerup"])],64)):z("",!0)])}const sp=A(op,[["render",ap],["__scopeId","data-v-e3a0b15f"]]);function ip(e){return e.Sagittal[0]<=e.Sagittal[1]&&e.Coronal[0]<=e.Coronal[1]&&e.Axial[0]<=e.Axial[1]}function rp(e,t){return e.Axial[0]===t.Axial[0]&&e.Axial[1]===t.Axial[1]&&e.Sagittal[0]===t.Sagittal[0]&&e.Sagittal[1]===t.Sagittal[1]&&e.Coronal[0]===t.Coronal[0]&&e.Coronal[1]===t.Coronal[1]}const lp=q({props:{viewId:{type:String,required:!0}},setup(e){const{viewId:t}=ie(e),n=Rt(vr);if(!n)throw new Error("Crop3D component cannot access the 2D widget manager.");const s=ue(),o=T(()=>s.getViewProxy(t.value)),a=Tt(),{currentImageID:i,currentImageMetadata:r}=le(),l=T(()=>{const p=i.value;return p&&p in a.croppingByImageID?a.croppingByImageID[p]:null}),c=el.newInstance(),d=c.getWidgetState();c.setEdgeHandlesEnabled(!1),c.setFaceHandlesEnabled(!0),c.setCornerHandlesEnabled(!0);const h=V();N(n,(p,f)=>{f&&f.removeWidget(c),p&&(h.value=p.addWidget(c))}),ti(o,()=>{n.value&&(h.value=n.value.addWidget(c),h.value.getRepresentations().forEach(p=>{p.getActors().forEach(f=>{f.getProperty().setAmbient(1)})}),o.value.renderLater())}),Ee(()=>{n.value&&n.value.removeWidget(c)}),N(r,p=>{d.setWorldToIndexT(p.worldToIndex),d.setIndexToWorldT(p.indexToWorld),d.placeWidget(p.worldBounds)},{immediate:!0});const g=p=>{const{lpsOrientation:f}=r.value,m=[0,0,0,0,0,0];oo.forEach(y=>{[m[f[y]*2],m[f[y]*2+1]]=p[y]}),to(m,d.getCroppingPlanes().getPlanes())||(d.getCroppingPlanes().setPlanes(m),o.value.renderLater())};return N(l,p=>{p&&g(p)},{immediate:!0}),Ce(d.getCroppingPlanes().onModified)(()=>{const p=i.value;if(!p)return;const f=d.getCroppingPlanes().getPlanes(),{lpsOrientation:m}=r.value,y={Sagittal:je(f,"Sagittal",m),Coronal:je(f,"Coronal",m),Axial:je(f,"Axial",m)},I=l.value;I&&rp(y,I)||(ip(y)?a.setCropping(p,y):I&&g(I))}),()=>null}}),cp=q({props:{viewId:{type:String,required:!0}},components:{Crop2D:sp,Crop3D:lp},setup(e){const{viewId:t}=ie(e),{currentImageID:n}=le(),s=Tt(),o=ze(),a=T(()=>o.currentTool===ce.Crop);N(n,r=>{r&&!(r in s.croppingByImageID)&&s.resetCropping(r)},{immediate:!0});const i=T(()=>ue().viewSpecs[t.value].viewType);return{active:a,viewType:i}}});const dp={class:"overlay-no-events"};function up(e,t,n,s,o,a){const i=M("crop-2D"),r=M("crop-3D");return D(),x("svg",dp,[e.active&&e.viewType==="2D"?(D(),Y(i,{key:0,"view-id":e.viewId},null,8,["view-id"])):z("",!0),e.active&&e.viewType==="3D"?(D(),Y(r,{key:1,"view-id":e.viewId},null,8,["view-id"])):z("",!0)])}const hp=A(cp,[["render",up],["__scopeId","data-v-c08e53d9"]]),ua="ProxyManager";function gp(e=ua){return Rt(e??ua)}const ha={ArrowLeft:-1,ArrowRight:1,ArrowUp:-1,ArrowDown:1},pp=q({name:"VtkTwoView",props:{id:{type:String,required:!0},viewDirection:{type:String,required:!0},viewUp:{type:String,required:!0}},components:{SliceSlider:K0,ViewOverlayGrid:l1,WindowLevelTool:h1,SliceScrollTool:g1,PanTool:p1,ZoomTool:f1,RulerTool:H1,RectangleTool:ch,PaintTool:Tg,CrosshairsTool:Hg,CropTool:hp,ContourTool:_g},setup(e){const t=ho(),n=st(),s=po(),o=Ps(),a=dt(),{id:i,viewDirection:r,viewUp:l}=ie(e),c=V(),d=T(()=>Ie(r.value)),{currentImageData:h,currentImageID:g,currentImageMetadata:v,isImageLoading:p,currentLayers:f}=le(),m=we(),y=uo(),I=T(()=>n.getConfig(i.value,g.value)),S=T(()=>{var P;return((P=I.value)==null?void 0:P.slice)??y.slice}),b=T(()=>{var P;return((P=I.value)==null?void 0:P.min)??y.min}),E=T(()=>{var P;return((P=I.value)==null?void 0:P.max)??y.max}),R=T({get:()=>t.getConfig(i.value,g.value),set:P=>{const G=g.value;G!==null&&P!=null&&t.updateConfig(i.value,G,P)}}),O=T(()=>{var P;return(P=R.value)==null?void 0:P.width}),k=T(()=>{var P;return(P=R.value)==null?void 0:P.level}),H=T(()=>{if(g.value!==null&&g.value in m.imageIDToVolumeKey){const P=m.imageIDToVolumeKey[g.value],G=m.volumeInfo[P],he=m.volumeStudy[P],ve=m.studyInfo[he],Ke=m.studyPatient[he],$n=m.patientInfo[Ke].PatientID,dn=ve.StudyID,Fe=ve.StudyDescription,At=G.SeriesNumber,rt=G.SeriesDescription;return{patientID:$n,studyID:dn,studyDescription:Fe,seriesNumber:At,seriesDescription:rt}}return null}),J=T(()=>{const{lpsOrientation:P,dimensions:G}=v.value,he=P[d.value];return{min:0,max:G[he]-1}}),ee=P=>{g.value!==null&&n.updateConfig(i.value,g.value,{slice:P})},{viewProxy:B,setContainer:W}=zg(i,ts.Slice);Ji(()=>{B.value.getInteractorStyle2D().removeAllManipulators()}),se(()=>{W(c.value),B.value.setOrientationAxesVisibility(!1)}),Ee(()=>{W(null)}),ge(()=>{const P=v.value.lpsOrientation[d.value];B.value.setSlicingMode("IJK"[P])}),N([i,g,r],([P,G,he])=>{!G||I.value!=null||(n.updateConfig(P,G,{...J.value,axisDirection:he}),n.resetSlice(P,G))},{immediate:!0});const te=V(!1),be=P=>{if(!g.value||!te.value)return;const G=ha[P.key]??0;G&&(n.updateConfig(i.value,g.value,{slice:S.value+G}),P.stopPropagation())};Zi(Object.keys(ha),be),Mn(c,()=>B.value.resize());const me=V();Gn(Sn,me);const{widgetManager:Xe}=Ug(B);Gn(yr,Xe),N(h,P=>{if(g.value==null||R.value!=null||!P)return;const G=P.getPointData().getScalars().getRange();t.updateConfig(i.value,g.value,{min:G[0],max:G[1]}),t.resetWindowLevel(i.value,g.value)},{immediate:!0});const Pt=yn(),An=T(()=>Pt.idList.filter(P=>Pt.parentImage[P]===g.value)),rn=T(()=>f.value.map(({id:P})=>P)),{baseImageRep:Bn,labelmapReps:ln,layerReps:Vn}=xg(i,{baseImage:g,labelmaps:An,layers:rn}),{cameraDirVec:bo,cameraUpVec:Do}=d1(r,l,v),{resizeToFit:it,ignoreResizeToFitTracking:Io,resetResizeToFitTracking:vi}=z0(B.value.getCamera(),!1),To=()=>Io(()=>{const P=v.value.lpsOrientation[Ie(r.value)],G=v.value.lpsOrientation[Ie(l.value)],he=v.value.dimensions.map((ve,Ke)=>ve*v.value.spacing[Ke]);B.value.resizeToFit(P,G,he),vi()}),xo=()=>{const P=v.value.worldBounds,G=[(P[0]+P[1])/2,(P[2]+P[3])/2,(P[4]+P[5])/2];Io(()=>{B.value.updateCamera(bo.value,Do.value,G),B.value.resetCamera(P)}),To(),B.value.renderLater()};qt(B.value.onResize(()=>{it.value&&To()})),N(it,()=>{it.value&&xo()});const{restoreCameraConfig:yi}=Lg(i,g,B,"parallelScale","position","focalPoint","viewUp");N([g,bo,Do],()=>{const P=s.getConfig(i.value,g.value);P?(yi(P),B.value.getRenderer().resetCameraClippingRange(),B.value.renderLater(),it.value=!1):it.value?xo():it.value=!0},{immediate:!0,deep:!0});const{top:wi,left:Si}=c1(B);ge(()=>{if(I.value==null||R.value==null)return;const{slice:P}=I.value,{width:G,level:he}=R.value,ve=Bn.value;ve&&(ve.setSlice(P),ve.setWindowWidth(G),ve.setWindowLevel(he)),[...Vn.value,...ln.value].forEach(Ke=>{Ke.setSlice(P)}),B.value.renderLater()}),ge(()=>{const{labelmapOpacity:P}=a;ln.value.forEach(G=>{G.setOpacity(P)})});const Ot=T(()=>rn.value.map(P=>o.getConfig(i.value,P))),_i=Mt();N([i,f],()=>{f.value.forEach(({id:P},G)=>{const he=_i.layerImages[P],ve=Ot.value[G];he&&!ve&&o.resetToDefault(i.value,P,he)})},{immediate:!0});const Lo=gp(),Ro=T(()=>Ot.value.map(P=>P==null?void 0:P.colorBy)),ko=T(()=>Ot.value.map(P=>P==null?void 0:P.transferFunction)),Mo=T(()=>Ot.value.map(P=>P==null?void 0:P.opacityFunction)),Eo=T(()=>Ot.value.map(P=>P==null?void 0:P.blendConfig));return N([Vn,Ro,ko,Mo,Eo],()=>{Vn.value.map((P,G)=>[P,Ro.value[G],ko.value[G],Mo.value[G],Eo.value[G]]).forEach(([P,G,he,ve,Ke])=>{if(!G||!he||!ve||!Ke)return;const{arrayName:cn,location:$n}=G,dn=he,Fe=ve,At=Lo.getLookupTable(cn);At.setMode(tl.Preset),At.setPresetName(dn.preset),At.setDataRange(...dn.mappingRange);const rt=Lo.getPiecewiseFunction(cn);switch(rt.setMode(Fe.mode),rt.setDataRange(...Fe.mappingRange),Fe.mode){case ke.Mode.Gaussians:rt.setGaussians(Fe.gaussians);break;case ke.Mode.Points:{const Po=Iu(Fe.preset,Fe.mappingRange,Fe.shift);Po&&rt.setPoints(Po);break}case ke.Mode.Nodes:rt.setNodes(Fe.nodes);break}P.setRescaleOnColorBy(!1),P.setColorBy(cn,$n),P.setOpacity(Ke.opacity),B.value.renderLater()})},{immediate:!0,deep:!0}),{vtkContainerRef:c,toolContainer:me,viewID:i,viewProxy:B,viewAxis:d,active:!0,currentSlice:S,sliceMin:b,sliceMax:E,windowWidth:O,windowLevel:k,topLabel:wi,leftLabel:Si,isImageLoading:p,setSlice:ee,widgetManager:Xe,dicomInfo:H,enableResizeToFit(){it.value=!0},hover:te}}});const fp=e=>(oe("data-v-a549bfc1"),e=e(),ae(),e),mp={class:"vtk-gutter"},vp={class:"vtk-sub-container"},yp={class:"vtk-view",ref:"vtkContainerRef"},wp={class:"overlay-no-events tool-layer",ref:"toolContainer"},Sp={class:"annotation-cell"},_p={class:"annotation-cell"},Cp={class:"annotation-cell"},bp={key:0},Dp={class:"annotation-cell"},Ip={key:0,class:"overlay-no-events loading"},Tp=fp(()=>u("div",null,"Loading the image",-1));function xp(e,t,n,s,o,a){const i=M("slice-slider"),r=M("pan-tool"),l=M("zoom-tool"),c=M("slice-scroll-tool"),d=M("window-level-tool"),h=M("contour-tool"),g=M("ruler-tool"),v=M("rectangle-tool"),p=M("paint-tool"),f=M("crosshairs-tool"),m=M("crop-tool"),y=M("view-overlay-grid");return D(),x("div",{class:"vtk-container-wrapper",tabindex:"0",onPointerenter:t[0]||(t[0]=I=>e.hover=!0),onPointerleave:t[1]||(t[1]=I=>e.hover=!1),onFocusin:t[2]||(t[2]=I=>e.hover=!0),onFocusout:t[3]||(t[3]=I=>e.hover=!1)},[u("div",mp,[w(mt,{dark:"",icon:"",size:"medium",variant:"text",onClick:e.enableResizeToFit},{default:L(()=>[w(_t,{size:"medium",class:"py-1"},{default:L(()=>[X("mdi-camera-flip-outline")]),_:1}),w(ba,{location:"right",activator:"parent",transition:"slide-x-transition"},{default:L(()=>[X(" Reset Camera ")]),_:1})]),_:1},8,["onClick"]),w(i,{class:"slice-slider",slice:e.currentSlice,min:e.sliceMin,max:e.sliceMax,step:1,"handle-height":20,onInput:e.setSlice},null,8,["slice","min","max","onInput"])]),u("div",{class:$(["vtk-container",e.active?"active":""])},[u("div",vp,[u("div",yp,null,512)]),u("div",wp,[w(r,{"view-id":e.viewID},null,8,["view-id"]),w(l,{"view-id":e.viewID},null,8,["view-id"]),w(c,{"view-id":e.viewID},null,8,["view-id"]),w(d,{"view-id":e.viewID},null,8,["view-id"]),w(h,{"view-id":e.viewID,"widget-manager":e.widgetManager,"view-direction":e.viewDirection,"current-slice":e.currentSlice},null,8,["view-id","widget-manager","view-direction","current-slice"]),w(g,{"view-id":e.viewID,"widget-manager":e.widgetManager,"view-direction":e.viewDirection,"current-slice":e.currentSlice},null,8,["view-id","widget-manager","view-direction","current-slice"]),w(v,{"view-id":e.viewID,"widget-manager":e.widgetManager,"view-direction":e.viewDirection,"current-slice":e.currentSlice},null,8,["view-id","widget-manager","view-direction","current-slice"]),w(p,{"view-id":e.viewID,"view-direction":e.viewDirection,"widget-manager":e.widgetManager,slice:e.currentSlice},null,8,["view-id","view-direction","widget-manager","slice"]),w(f,{"view-id":e.viewID,"view-direction":e.viewDirection,"widget-manager":e.widgetManager,slice:e.currentSlice},null,8,["view-id","view-direction","widget-manager","slice"]),w(m,{"view-id":e.viewID},null,8,["view-id"])],512),w(y,{class:"overlay-no-events view-annotations"},{"top-center":L(()=>[u("div",Sp,[u("span",null,F(e.topLabel),1)])]),"middle-left":L(()=>[u("div",_p,[u("span",null,F(e.leftLabel),1)])]),"bottom-left":L(()=>[u("div",Cp,[u("div",null,"Phase: "+F(e.currentSlice+1)+"/"+F(e.sliceMax+1),1),typeof e.windowWidth=="number"&&typeof e.windowLevel=="number"?(D(),x("div",bp," W/L: "+F(e.windowWidth.toFixed(2))+" / "+F(e.windowLevel.toFixed(2)),1)):z("",!0)])]),"top-right":L(()=>[u("div",Dp,[e.dicomInfo!==null?(D(),Y(Ct,{key:0,"open-on-hover":"",location:"bottom left",left:"","nudge-left":"10",dark:"","max-width":"300px"},{activator:L(({props:I})=>[w(_t,Jt(I,{dark:"",size:"x-large",class:"pointer-events-all hover-info"}),{default:L(()=>[X(" mdi-information ")]),_:2},1040)]),default:L(()=>[w(zt,{class:"bg-grey-darken-3"},{default:L(()=>[w(et,null,{default:L(()=>[w(Re,{class:"font-weight-bold"},{default:L(()=>[X(" PATIENT / CASE ")]),_:1}),w(Fn),w(Re,null,{default:L(()=>[X(" ID: "+F(e.dicomInfo.patientID),1)]),_:1})]),_:1}),w(et,null,{default:L(()=>[w(Re,{class:"font-weight-bold"},{default:L(()=>[X(" STUDY ")]),_:1}),w(Fn),w(Re,null,{default:L(()=>[X(" ID: "+F(e.dicomInfo.studyID),1)]),_:1}),w(Re,null,{default:L(()=>[X(F(e.dicomInfo.studyDescription),1)]),_:1})]),_:1}),w(et,null,{default:L(()=>[w(Re,{class:"font-weight-bold"},{default:L(()=>[X(" SERIES ")]),_:1}),w(Fn),w(Re,null,{default:L(()=>[X(" Series #: "+F(e.dicomInfo.seriesNumber),1)]),_:1}),w(Re,null,{default:L(()=>[X(F(e.dicomInfo.seriesDescription),1)]),_:1})]),_:1})]),_:1})]),_:1})):z("",!0)])]),_:1}),w(_e,{name:"loading"},{default:L(()=>[e.isImageLoading?(D(),x("div",Ip,[Tp,u("div",null,[w(wr,{indeterminate:"",color:"blue"})])])):z("",!0)]),_:1})],2)],32)}const oi=A(pp,[["render",xp],["__scopeId","data-v-a549bfc1"]]);const Lp={components:{CheckContoursToolStrip:Hs,VtkTwoView:oi},data(){return{activeStore:Be()}},mounted(){const e=this.activeStore.sliceData[0].sliceOBJ.targetPhase;this.$refs.vtkTarget.setSlice(e)}},Rp={class:"viewers-tools-container"},kp={class:"tool-strip"};function Mp(e,t,n,s,o,a){const i=M("VtkTwoView"),r=M("CheckContoursToolStrip");return D(),x("div",Rp,[w(i,{key:"sagitalv",id:"Sagittal",viewDirection:"Posterior",viewUp:"Superior"}),u("div",kp,[w(r)]),w(i,{key:"sagitalv",id:"Coronal",viewDirection:"Right",viewUp:"Superior",ref:"vtkTarget"},null,512)])}const Ep=A(Lp,[["render",Mp],["__scopeId","data-v-c7e59f00"]]);async function Pp(e){const t=e.createReader(),n=[];let s=[];do s=await new Promise((o,a)=>{t.readEntries(o,a)}),n.push(...s);while(s.length);return n}async function Op(e){return new Promise((t,n)=>{e.file(t,n)})}async function Ap(e){const t=[...e],n=[];for(;t.length;){const s=t.shift();s.isFile?n.push(s):t.push(...await Pp(s))}return Promise.all(n.map(Op))}const Bp={name:"DragAndDrop",props:{enabled:Boolean},data(){return{dragHover:!1}},methods:{onDragOver(e){if(this.enabled){e.preventDefault();const{types:t}=e.dataTransfer;(t&&t instanceof Array?t.indexOf("Files")!==-1:"Files"in t)&&(this.dragHover=!0,this.dragTimeout!==null&&(window.clearTimeout(this.dragTimeout),this.dragTimeout=null))}},onDragLeave(){this.enabled&&(this.dragTimeout=window.setTimeout(()=>{this.dragHover=!1,this.dragTimeout=null},50))},async onDrop(e){if(this.enabled)if(this.dragHover=!1,e.dataTransfer.items){const t=[...e.dataTransfer.items].map(s=>(s.webkitGetAsEntry||s.getAsEntry).call(s)),n=await Ap(t);this.$emit("drop-files",n)}else this.$emit("drop-files",Array.from(e.dataTransfer.files))}},created(){this.dragTimeout=null}};function Vp(e,t,n,s,o,a){return D(),x("div",Jt({onDragover:t[0]||(t[0]=Se((...i)=>a.onDragOver&&a.onDragOver(...i),["prevent"])),onDragleave:t[1]||(t[1]=(...i)=>a.onDragLeave&&a.onDragLeave(...i)),onDrop:t[2]||(t[2]=Se((...i)=>a.onDrop&&a.onDrop(...i),["prevent"]))},e.$attrs),[De(e.$slots,"default",{dragHover:o.dragHover})],16)}const $p=A(Bp,[["render",Vp]]);const Fp={components:{DragAndDrop:$p,CheckContours:Ep},data(){return{showOverlay:!1,showTextOverlay:!1,isDraggingOver:!1,loadFileText:"Load Files",browseTextFile:"Browse your data to automatically add a new study.",dataStore:Tn(),patientStore:vn(),currentPatientStoreID:null}},methods:{async openFiles(e){console.log(e);const t=Array.from(e).map(us);console.log(t),this.loadFiles(t)},async loadFiles(e){const t=await p0(e);console.log(t),this.currentPatientStoreID=t[0].data[0].dataID;const s=Dn(g=>g.ok,t)[0];if(!this.dataStore.primarySelection&&s.length){const g=u0(s[0]);g&&this.dataStore.setPrimarySelection(g)}const o=we();console.log(o);const a=this.currentPatientStoreID,i=o.volumeInfo[a],r=o.volumeStudy[a],l=o.studyInfo[r],c=o.studyPatient[r],d=o.patientInfo[c],h={id:a,name:d.PatientID,lastname:d.PatientName,dob:d.PatientBirthDate,gender:d.PatientSex,scandate:l.StudyDate,scanlocation:i.SeriesDescription};this.patientStore.addPatient(h),this.openOverlay()},handleKeyDown(e){console.log(e.key),e.key===" "&&this.showOverlay()},openOverlay(){this.showOverlay&&(this.showTextOverlay=!1),this.showOverlay=!this.showOverlay,this.showOverlay&&setTimeout(()=>{this.showTextOverlay=!0},200)},openFileDialog(){this.$refs.fileInput.click()},handleFileChange(e){const t=e.target.files[0];this.openFiles(t)},handleDragEnter(e){e.preventDefault(),this.isDraggingOver=!0},handleDragOver(e){e.preventDefault(),this.isDraggingOver=!0,this.loadFileText="Drop File to Upload"},handleDragLeave(e){e.preventDefault(),this.isDraggingOver=!1,this.loadFileText="Load Files"}}},wo=e=>(oe("data-v-cda67de1"),e=e(),ae(),e),Np={style:{position:"relative"}},Hp=wo(()=>u("i",{class:"fa-solid fa-user-plus",style:{color:"#ffffff"}},null,-1)),zp=wo(()=>u("i",{class:"fa-solid fa-file-import fa-2xl",style:{color:"#ffffff"}},null,-1)),Wp=wo(()=>u("br",null,null,-1)),jp={style:{display:"none"}};function Up(e,t,n,s,o,a){const i=M("drag-and-drop"),r=M("CheckContours");return D(),x(ne,null,[u("div",Np,[u("button",{onClick:t[0]||(t[0]=(...l)=>a.openOverlay&&a.openOverlay(...l))},[X(" Add New Patient "),Hp]),w(i,{enabled:"",onDropFiles:a.openFiles,id:"app-container"},{default:L(()=>[u("div",{class:$(["overlay",{show:o.showOverlay}]),onDragover:t[8]||(t[8]=(...l)=>a.handleDragOver&&a.handleDragOver(...l))},[u("div",{class:$(["add-patient-header",{visible:o.showTextOverlay}])},[u("i",{onClick:t[1]||(t[1]=(...l)=>a.openOverlay&&a.openOverlay(...l)),onKeydown:t[2]||(t[2]=(...l)=>a.handleKeyDown&&a.handleKeyDown(...l)),class:"fa-solid fa-xmark fa-xl",style:{color:"#ffffff"}},null,32)],2),u("div",{onClick:t[4]||(t[4]=(...l)=>a.openFileDialog&&a.openFileDialog(...l)),onDragenter:t[5]||(t[5]=(...l)=>a.handleDragEnter&&a.handleDragEnter(...l)),onDragleave:t[6]||(t[6]=(...l)=>a.handleDragLeave&&a.handleDragLeave(...l)),onKeydown:t[7]||(t[7]=(...l)=>a.handleKeyDown&&a.handleKeyDown(...l)),class:$(["load-files",{visible:o.showTextOverlay}])},[u("input",{type:"file",ref:"fileInput",style:{display:"none"},onChange:t[3]||(t[3]=(...l)=>a.handleFileChange&&a.handleFileChange(...l)),"aria-labelledby":"fileInput"},null,544),zp,Wp,u("h2",null,F(o.loadFileText),1),u("h4",null,F(o.browseTextFile),1)],34)],34)]),_:1},8,["onDropFiles"])]),u("div",jp,[w(r)])],64)}const Gp=A(Fp,[["render",Up],["__scopeId","data-v-cda67de1"]]);const Xp={data(){return{searchTerm:"",patientStore:vn()}},created(){this.searchTerm=this.patientStore.searchTerm},methods:{handleInput(){this.$emit("search-term-updated",this.searchTerm)},handleSearch(){this.$emit("search-term-updated",this.searchTerm)},handleKeydown(e){e.key==="Escape"?(e.preventDefault(),this.searchTerm=""):e.key==="Backspace"&&(e.preventDefault(),this.searchTerm=this.searchTerm.slice(0,-1)),this.handleInput()}}},Kp={class:"searchbar"};function qp(e,t,n,s,o,a){return D(),x("div",Kp,[Ue(u("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=i=>o.searchTerm=i),onInput:t[1]||(t[1]=(...i)=>a.handleInput&&a.handleInput(...i)),placeholder:"Find Patient...","aria-labelledby":"findPatientSearchBox",onKeydown:t[2]||(t[2]=(...i)=>a.handleKeydown&&a.handleKeydown(...i))},null,544),[[mn,o.searchTerm]])])}const Yp=A(Xp,[["render",qp],["__scopeId","data-v-e087f75c"]]);const Jp={methods:{logOutUser(){ut().logOut()}}},Zp=e=>(oe("data-v-64763312"),e=e(),ae(),e),Qp=Zp(()=>u("i",{class:"fa-solid fa-arrow-right-from-bracket",style:{color:"#ffffff"}},null,-1));function ef(e,t,n,s,o,a){const i=M("router-link");return D(),Y(i,{to:"/login",style:{"text-decoration":"none"}},{default:L(()=>[u("button",{onClick:t[0]||(t[0]=(...r)=>a.logOutUser&&a.logOutUser(...r))},[X(" Log Out "),Qp])]),_:1})}const tf=A(Jp,[["render",ef],["__scopeId","data-v-64763312"]]);const nf={props:{message:String},methods:{closePopup(){this.$emit("closePopup")},confirm(){this.$emit("confirmDelete"),this.closePopup()},handleKeydown(){}}},of={class:"popup-box"},af={class:"popup-buttons"};function sf(e,t,n,s,o,a){return D(),x("div",{class:"popup-overlay",onClick:t[2]||(t[2]=(...i)=>a.closePopup&&a.closePopup(...i)),onKeydown:t[3]||(t[3]=(...i)=>a.handleKeydown&&a.handleKeydown(...i))},[u("div",of,[u("p",null,F(n.message),1),u("div",af,[u("button",{onClick:t[0]||(t[0]=(...i)=>a.confirm&&a.confirm(...i))},"Delete"),u("button",{onClick:t[1]||(t[1]=(...i)=>a.closePopup&&a.closePopup(...i))},"Cancel")])])],32)}const rf=A(nf,[["render",sf],["__scopeId","data-v-eece1ae8"]]);const lf={data(){return{username:null,filter:"",patients:vn().patients,patientStore:vn(),appState:ut(),removePatientTarget:""}},components:{HomeGreetings:Ic,PatientContainer:Hc,AddPatient:Gp,FindPatient:Yp,LogOut:tf,PopUpDelete:rf},mounted(){this.username=this.appState.currentUser,this.username||this.$router.push("/login"),this.$refs.background.style.backgroundImage=`url('/images/${this.timeofday.toLowerCase()}.jpg')`},methods:{handleUpdateFilter(e){this.patientStore.searchTerm=e},handleRemovePatient(e){this.removePatientTarget=e},handleDeletePatient(){this.patientStore.deletePatient(this.removePatientTarget.id),this.removePatientTarget=null}},created(){this.timeofday=this.appState.timeOfDay,this.filter=this.patientStore.searchTerm}},ai=e=>(oe("data-v-4739deef"),e=e(),ae(),e),cf={class:"container",ref:"background"},df={class:"home"},uf=ai(()=>u("br",null,null,-1)),hf={class:"user-bar"},gf=ai(()=>u("h5",{style:{color:"grey","margin-left":"90%"}},"Area 19 OCG Prototype V.0.1",-1));function pf(e,t,n,s,o,a){const i=M("PopUpDelete"),r=M("HomeGreetings"),l=M("AddPatient"),c=M("FindPatient"),d=M("LogOut"),h=M("PatientContainer");return D(),x("div",cf,[u("div",df,[o.removePatientTarget?(D(),Y(i,{key:0,message:`You are about to delete ${o.removePatientTarget.name} and all it's files. Are you sure you want to proceed?`,onClosePopup:t[0]||(t[0]=g=>o.removePatientTarget=null),onConfirmDelete:a.handleDeletePatient},null,8,["message","onConfirmDelete"])):z("",!0),w(r,{username:o.username},null,8,["username"]),uf,u("div",hf,[w(l,{onNewPatient:e.handleNewPatient},null,8,["onNewPatient"]),w(c,{onSearchTermUpdated:a.handleUpdateFilter},null,8,["onSearchTermUpdated"]),w(d,{style:{"margin-left":"auto","align-self":"center"}})]),w(h,{patients:o.patients,filter:o.patientStore.searchTerm,onRemovePatient:a.handleRemovePatient},null,8,["patients","filter","onRemovePatient"]),gf])],512)}const ff=A(lf,[["render",pf],["__scopeId","data-v-4739deef"]]),En=Z({id:"analysis",state:()=>({analysisData:{column1:{viewerData:{},studyInfo:{heartrate:{baseline:null,hv:null,bh:null},hrv:{baseline:null,hv:null,bh:null}},territoryGraph:{activeTerritory:"Territory Min",territories:[],graphs:{}}},column2:{viewerData:{},studyInfo:{heartrate:{baseline:null,hv:null,bh:null},hrv:{baseline:null,hv:null,bh:null}},territoryGraph:{activeTerritory:"Territory Min",territories:[],graphs:{}}},column3:{viewerData:{},studyInfo:{heartrate:{baseline:null,hv:null,bh:null},hrv:{baseline:null,hv:null,bh:null}},territoryGraph:{activeTerritory:"Territory Min",territories:[],graphs:{}}}}}),getters:{},actions:{generateRandomData(e){const t=[],n=Math.random();for(let s=0;s<=e;s++){const o=s*1,i=1+1*Math.sin(3.5*Math.PI*o/e)+n+(.1+Math.random()*(.8-.1));t.push({x:o,y:i})}return t},addNewTerritory(e,t,n){let s;n?s=n:s=[this.generateRandomData(15),this.generateRandomData(15),this.generateRandomData(15)],this.analysisData[e].territoryGraph.territories.push(t),this.analysisData[e].territoryGraph.graphs[t]={title:"Normalized SI (RV-LV)",data:s,visibleLines:[1,1,1],territory:t}},setActiveTerritory(e,t){this.analysisData[e].territoryGraph.activeTerritory=t},getGraphData(e){const t=this.analysisData[e].territoryGraph.activeTerritory;return this.analysisData[e].territoryGraph.graphs[t].data},getActiveTerritory(e){return this.analysisData[e].territoryGraph.activeTerritory},getLabels(e){return this.analysisData[e].territoryGraph.territories},getDummyData(){return{title:"Normalized SI (RV-LV)",data:[this.generateCurveData(150),this.generateCurveData(150),this.generateCurveData(150)],visibleLines:[1,1,1]}},generateCurveData(e){const s=[];for(let o=0;o<e;o++){const a=o/e,i=.5+.5*Math.sin(2*Math.PI*a),r=Math.random()*1,l=i+r*.5;s.push({x:a,y:l})}return s}}});const mf={props:{number:{type:Number,default:1},radius:{type:Number,default:26},fontSize:{type:Number,default:18}}};function vf(e,t,n,s,o,a){return D(),x("div",{class:"circleIcon",style:j({width:n.radius+"px",height:n.radius+"px",fontSize:n.fontSize+"px"})},F(n.number),5)}const yf=A(mf,[["render",vf],["__scopeId","data-v-02852de7"]]);const wf={components:{IconNumber:yf},data(){return{taskList:[{taskDescription:"Use the split handles to make sure the beginning and end of each breathing state is correct",showMeHow:"https://www.youtube.com/watch?v=dQw4w9WgXcQ",completeStatus:!1},{taskDescription:"Insure proper placement of Systole and Diastole labels.",showMeHow:"https://www.youtube.com/watch?v=dQw4w9WgXcQ",completeStatus:!1},{taskDescription:"Scroll through phases to check contours.",showMeHow:null,completeStatus:!1},{taskDescription:"Edit contours if required.",showMeHow:"https://www.youtube.com/watch?v=dQw4w9WgXcQ",completeStatus:!1},{taskDescription:"Move on to Analysis page.",showMeHow:"https://www.youtube.com/watch?v=dQw4w9WgXcQ",completeStatus:!1}]}}},si=e=>(oe("data-v-f5986460"),e=e(),ae(),e),Sf={class:"task-container"},_f=si(()=>u("div",{class:"title"},[u("h4",null,"Task List")],-1)),Cf={key:0},bf={class:"task"},Df={class:"number"},If={class:"task-text-container"},Tf={class:"task-text"},xf=["href"],Lf=si(()=>u("p",{class:"task-text tutorial"},"Show me how",-1)),Rf=[Lf],kf={class:"button-container"},Mf=["onClick"];function Ef(e,t,n,s,o,a){const i=M("IconNumber");return D(),x("div",Sf,[_f,(D(!0),x(ne,null,fe(o.taskList,(r,l)=>(D(),x("div",{key:l},[w(_e,null,{default:L(()=>[r.completeStatus?z("",!0):(D(),x("div",Cf,[u("div",bf,[u("div",Df,[w(i,{number:l+1,radius:22,fontSize:16},null,8,["number"])]),u("div",If,[u("p",Tf,F(r.taskDescription),1),r.showMeHow?(D(),x("a",{key:0,href:r.showMeHow,class:"tutorial"},Rf,8,xf)):z("",!0)])]),u("div",kf,[u("button",{onClick:c=>r.completeStatus=!r.completeStatus,style:j({backgroundColor:r.completeStatus?"#4CAF50":null,color:r.completeStatus?"white":null})}," Complete ",12,Mf)])]))]),_:2},1024)]))),128))])}const Pf=A(wf,[["render",Ef],["__scopeId","data-v-f5986460"]]);const Of={components:{TaskListOverlay:Pf},props:{activeComponent:{type:String,default:"analysis"}},data(){return{patient:null,patientName:null,patientLastName:null,patientBrate:null,patientage:null,patientweight:null,patientheight:null,patientgender:null,checkContours:null,activeStore:Be(),viewTasks:!1}},mounted(){const e=this.activeStore.qualityCheck.viewing;e?this.handleclick(e):this.checkContours=!1,this.patient=this.activeStore.activePatient,this.patient?(this.patientName=this.patient.name?this.patient.name.toUpperCase():"NA",this.patientLastName=this.patient.lastname?this.patient.lastname.toUpperCase():"NA",this.patientBrate=this.patient.breathingrate?this.patient.breathingrate:"NA",this.patientage=this.patient.age?this.patient.age:"NA",this.patientweight=this.patient.weight?this.patient.weight:"NA",this.patientheight=this.patient.height?this.patient.height:"NA",this.patientgender=this.patient.gender?this.patient.gender:"NA"):(this.patientName="NOT",this.patientLastName="PROVIDED",this.patientBrate="NA",this.patientage="NA",this.patientweight="NA",this.patientheight="NA",this.patientgender="NA")},methods:{handleclick(e){this.activeStore.qualityCheck.viewing=e},handleKeyDown(){},logOutUser(){ut().logOut()}}},$e=e=>(oe("data-v-2e87b85d"),e=e(),ae(),e),Af={class:"header-container"},Bf={class:"patient-info-container"},Vf={class:"patient-name"},$f=$e(()=>u("h3",{class:"label"},"PATIENT",-1)),Ff={class:"breathing-rate"},Nf=$e(()=>u("h3",{class:"label",style:{"text-align":"left"}},[X("RESTING "),u("br"),X("HEART RATE")],-1)),Hf={class:"info"},zf=$e(()=>u("h3",{class:"label"},"AGE",-1)),Wf=$e(()=>u("h3",{class:"label"},"WEIGHT",-1)),jf=$e(()=>u("h3",{class:"label"},"HEIGHT",-1)),Uf=$e(()=>u("h3",{class:"label"},"GENDER",-1)),Gf={class:"left-icons"},Xf=$e(()=>u("div",{class:"helpIcon"},[u("i",{class:"fa-regular fa-square-check fa-lg"})],-1)),Kf=$e(()=>u("h2",{class:"task-label"},"Task List",-1)),qf=$e(()=>u("div",{class:"help-container"},[u("div",{class:"helpIcon"},[u("i",{class:"fa-solid fa-circle-info fa-lg"})]),u("h2",{class:"task-label"},"About")],-1)),Yf=$e(()=>u("div",{class:"helpIcon"},[u("i",{class:"fa-solid fa-arrow-right-from-bracket fa-lg"})],-1)),Jf=$e(()=>u("h2",{class:"task-label"},"Sign Out",-1)),Zf=[Yf,Jf];function Qf(e,t,n,s,o,a){const i=M("TaskListOverlay"),r=M("router-link");return D(),x("div",Af,[u("div",Bf,[u("div",Vf,[$f,u("h3",null,F(o.patientName)+" "+F(o.patientLastName),1)]),u("div",Ff,[u("h1",null,F(o.patientBrate),1),Nf]),u("div",Hf,[u("div",null,[zf,u("h3",null,F(o.patientage),1)]),u("div",null,[Wf,u("h3",null,F(o.patientweight)+" Kg",1)]),u("div",null,[jf,u("h3",null,F(o.patientheight)+" cm",1)]),u("div",null,[Uf,u("h3",null,F(o.patientgender),1)])])]),u("div",Gf,[u("div",{class:$(["help-container",{activeIcon:o.viewTasks}]),onMousedown:t[0]||(t[0]=l=>o.viewTasks=!o.viewTasks)},[Xf,Kf,w(_e,null,{default:L(()=>[o.viewTasks?(D(),Y(i,{key:0})):z("",!0)]),_:1})],34),qf,w(r,{to:"/login",style:{"text-decoration":"none"}},{default:L(()=>[u("div",{class:"help-container",onMousedown:t[1]||(t[1]=(...l)=>a.logOutUser&&a.logOutUser(...l))},Zf,32)]),_:1})])])}const e2=A(Of,[["render",Qf],["__scopeId","data-v-2e87b85d"]]);const t2={props:{imgSource:{type:String},tag:{type:String},active:{type:Boolean}}},n2=["src"];function o2(e,t,n,s,o,a){return D(),x("div",{class:"button-container",style:j({opacity:n.active?1:null})},[u("img",{class:"icon",src:"/src/components/icons/app_icons/"+n.imgSource,alt:"",style:{color:"blue"}},null,8,n2),u("h4",{class:"button-tag",style:j({color:n.active?"#00ddffea":"white"})},F(n.tag),5)],4)}const a2=A(t2,[["render",o2],["__scopeId","data-v-6ebf2179"]]);const s2={components:{NavBarButton:a2},data(){return{appState:ut(),selectedTool:null}},created(){this.selectedTool=this.appState.currentView},methods:{selectTool(e){this.selectedTool!==e&&(this.selectedTool=e,this.appState.setView(e))},handleKeyDown(e){const n={1:"QualityCheck",2:"GraphicalAnalysis",3:"ReportMaker",Escape:"/home"}[e.key];n&&(e.key==="Escape"?this.$router.push(n):this.selectTool(n))}}},i2={class:"toolbar"},r2={class:"tools"};function l2(e,t,n,s,o,a){const i=M("NavBarButton"),r=M("router-link");return D(),x("div",i2,[u("div",r2,[w(r,{to:"/home",style:{"text-decoration":"none"},class:"normal"},{default:L(()=>[w(i,{imgSource:"Patient List.svg",tag:"Patient List"})]),_:1}),w(i,{imgSource:o.selectedTool==="QualityCheck"?"CheckContours_Active.svg":"CheckContours.svg",tag:"Quality Check",active:o.selectedTool==="QualityCheck",onClick:t[0]||(t[0]=l=>a.selectTool("QualityCheck"))},null,8,["imgSource","active"]),w(i,{imgSource:o.selectedTool==="GraphicalAnalysis"?"Analysis_Active.svg":"Analysis.svg",tag:"Analysis",active:o.selectedTool==="GraphicalAnalysis",onClick:t[1]||(t[1]=l=>a.selectTool("GraphicalAnalysis"))},null,8,["imgSource","active"]),w(i,{imgSource:o.selectedTool==="ReportMaker"?"Report_Active.svg":"Report.svg",tag:"Report",active:o.selectedTool==="ReportMaker",onClick:t[2]||(t[2]=l=>a.selectTool("ReportMaker"))},null,8,["imgSource","active"])])])}const c2=A(s2,[["render",l2],["__scopeId","data-v-d7251205"]]);const d2={name:"RangeSlider",props:{canvasWidth:{type:Number},scrollAmount:{type:Number},sliceObj:{type:Object},numImages:Number,imgWidth:Number},data(){return{isDragging:!1,startValue:0,endValue:null,startDragX:null,canvasHeight:44,scrollerHeight:8,startEndHandlersHeight:18,startEndHandlersWidth:.2,canvasCursor:"pointer"}},computed:{sliderWidth(){return this.canvasWidth-10},totalParentWidth(){return this.imgWidth*this.numImages},viewportWidth(){return this.canvasWidth/this.totalParentWidth*this.sliderWidth}},mounted(){this.drawCanvas(),this.throttledSliderMove=Qi(this.moveScale,2)},methods:{drawCurrentView(e,t){const n=e,s=Math.abs(t-e),{canvas:o}=this.$refs,a=o.getContext("2d");a.strokeStyle="#FFFFFF",a.fillStyle="#FFFFFF10";const i=this.canvasHeight-10,r=(this.canvasHeight-i)/2;a.lineWidth=2;const l=6;a.beginPath(),a.moveTo(n+l,r),a.lineTo(n+s-l,r),a.arcTo(n+s,r,n+s,r+l,l),a.lineTo(n+s,r+i-l),a.arcTo(n+s,r+i,n+s-l,r+i,l),a.lineTo(n+l,r+i),a.arcTo(n,r+i,n,r+i-l,l),a.lineTo(n,r+l),a.arcTo(n,r,n+l,r,l),a.closePath(),a.fill(),a.stroke()},drawHandle(e,t,n,s,o,a,i){const r=e,l=t+s,c=n+o;r.beginPath(),r.moveTo(t+a,n),r.lineTo(l-a,n),r.quadraticCurveTo(l,n,l,n+a),r.lineTo(l,c-a),r.quadraticCurveTo(l,c,l-a,c),r.lineTo(t+a,c),r.quadraticCurveTo(t,c,t,c-a),r.lineTo(t,n+a),r.quadraticCurveTo(t,n,t+a,n),r.closePath(),r.lineWidth=2,r.strokeStyle=i,r.stroke(),r.fillStyle=i,r.fill()},drawSegment(e,t,n){const{canvas:s}=this.$refs,o=s.getContext("2d"),a=(this.canvasHeight-this.startEndHandlersHeight)/2,i=Math.abs(t-e);this.drawHandle(o,e,a,this.startEndHandlersWidth,this.startEndHandlersHeight,1,n),o.fillStyle=n,o.fillRect(e,s.height/2-this.scrollerHeight/2,i,this.scrollerHeight),this.drawHandle(o,t,a,this.startEndHandlersWidth,this.startEndHandlersHeight,1,n)},drawTrack(){const{canvas:e}=this.$refs,t=e.getContext("2d");t.fillStyle="#3D3D3D",t.fillRect(0,e.height/2-this.scrollerHeight/2,this.sliderWidth,this.scrollerHeight)},drawCanvas(){const{canvas:e}=this.$refs,t=e.getContext("2d");e.width=this.sliderWidth,e.height=this.canvasHeight;const n=this.scrollAmount/this.totalParentWidth*this.sliderWidth,s=Math.min(Math.max(n,.5),this.sliderWidth-this.viewportWidth-.5),o=s+this.viewportWidth;this.startValue=s,this.endValue=o;const a=this.getObjLocToVal(this.sliceObj.states.FREEBREATHING.start),i=this.getObjLocToVal(this.sliceObj.states.FREEBREATHING.end),r=this.getObjLocToVal(this.sliceObj.states.HYPERVENTILATION.start),l=this.getObjLocToVal(this.sliceObj.states.HYPERVENTILATION.end),c=this.getObjLocToVal(this.sliceObj.states.BREATHHOLD.start),d=this.getObjLocToVal(this.sliceObj.states.BREATHHOLD.end);t.clearRect(0,0,e.width,e.height),this.drawTrack(),this.drawSegment(a+2,i,"#5FBBCB"),this.drawSegment(r+2.5,l,"#C24ABC"),this.drawSegment(c+2.5,d-2,"#D95476"),this.drawCurrentView(s,o)},getObjLocToVal(e){return e.XLocation/this.totalParentWidth*this.sliderWidth},handleMouseDown(e){const{canvas:t}=this.$refs,n=t.getBoundingClientRect(),s=e.clientX-n.left;this.startDragX=s,s<this.endValue&&s>this.startValue&&(this.isDragging="middle",this.canvasCursor="grab")},handledblCkick(e){const{canvas:t}=this.$refs,n=t.getBoundingClientRect(),a=(e.clientX-n.left-this.viewportWidth/2)/this.sliderWidth*this.totalParentWidth;this.throttledSliderMove(a),this.drawCanvas()},handleMouseMove(e){if(!this.isDragging)return;const{canvas:t}=this.$refs,n=t.getBoundingClientRect(),s=e.clientX-n.left,o=s-this.startDragX;if(this.endValue+o>this.sliderWidth||this.startValue+o<0)return;const a=(this.startValue+o)/this.sliderWidth*this.totalParentWidth;this.moveScale(a),this.startDragX=s},handleMouseUp(){this.isDragging&&(this.isDragging=!1,this.canvasCursor="pointer")},moveScale(e){this.$emit("move",e)}},watch:{canvasWidth(){this.drawCanvas()},scrollAmount(){this.drawCanvas()}}};function u2(e,t,n,s,o,a){return D(),x("div",{class:"range-slider",style:j({width:n.canvasWidth+"px"})},[u("canvas",{ref:"canvas",onMousedown:t[0]||(t[0]=(...i)=>a.handleMouseDown&&a.handleMouseDown(...i)),onDblclick:t[1]||(t[1]=(...i)=>a.handledblCkick&&a.handledblCkick(...i)),onMousemove:t[2]||(t[2]=(...i)=>a.handleMouseMove&&a.handleMouseMove(...i)),onMouseup:t[3]||(t[3]=(...i)=>a.handleMouseUp&&a.handleMouseUp(...i)),onMouseleave:t[4]||(t[4]=(...i)=>a.handleMouseUp&&a.handleMouseUp(...i)),onFocusout:t[5]||(t[5]=(...i)=>a.handleMouseUp&&a.handleMouseUp(...i)),style:j({cursor:o.canvasCursor})},null,36)],4)}const h2=A(d2,[["render",u2],["__scopeId","data-v-d030f916"]]);const g2={props:{hasLabel:null,imageIncluded:{type:Boolean,default:!0}},emits:["add-label","remove-label","exclude-image"],data(){return{showContextMenu:!1,showError:!1,contextMenuX:0,contextMenuY:0}},methods:{openContextMenu(e){this.showContextMenu=!0,this.contextMenuX=e.clientX,this.contextMenuY=e.clientY},closeContextMenu(){this.showContextMenu=!1,this.showError=!1},addLabel(e){this.$emit("add-label",e),this.showContextMenu=!1,setTimeout(()=>{this.closeContextMenu()},5)},removeLabel(){this.$emit("remove-label"),this.showContextMenu=!1},excludeImage(){this.$emit("exclude-image"),this.showContextMenu=!1},popError(e){this.showError=!0,this.contextMenuX=e.clientX,this.contextMenuY=e.clientY},handleKeyPress(){}}},Oe=e=>(oe("data-v-2fbde6de"),e=e(),ae(),e),p2=Oe(()=>u("div",{class:"window-level"},[u("h5",null,"Window and Level:"),u("div",{class:"preset-container"},[u("h5",{class:"preset"},"1"),u("h5",{class:"preset"},"2"),u("h5",{class:"preset"},"3"),u("h5",{class:"preset"},"4"),u("h5",{class:"preset"},"5"),u("i",{class:"fa-solid fa-plus fa-xs preset"})])],-1)),f2={class:"manipulation-options"},m2=Oe(()=>u("i",{class:"fa-solid fa-plus fa-sm",style:{color:"#ffffff"}},null,-1)),v2=Oe(()=>u("h5",null,"Add Systole Label",-1)),y2=[m2,v2],w2=Oe(()=>u("i",{class:"fa-solid fa-circle-plus fa-sm",style:{color:"#ffffff"}},null,-1)),S2=Oe(()=>u("h5",null,"Add Diastole Label",-1)),_2=[w2,S2],C2=Oe(()=>u("i",{class:"fa-regular fa-trash-can fa-sm",style:{color:"#ffffff"}},null,-1)),b2=Oe(()=>u("h5",null,"Delete Label",-1)),D2=[C2,b2],I2=Oe(()=>u("i",{class:"fa-solid fa-square-minus"},null,-1)),T2=Oe(()=>u("h5",null,"Exclude Image",-1)),x2=[I2,T2],L2=Oe(()=>u("i",{class:"fa-solid fa-square-plus"},null,-1)),R2=Oe(()=>u("h5",null,"Include Image",-1)),k2=[L2,R2],M2=Oe(()=>u("div",{class:"warning"},[u("i",{class:"fa-solid fa-triangle-exclamation",style:{color:"#ffcc00"}}),u("h5",null,"Unable to edit label! Please click within a breathing state.")],-1)),E2=[M2];function P2(e,t,n,s,o,a){return D(),x("div",{onContextmenu:t[10]||(t[10]=Se((...i)=>a.openContextMenu&&a.openContextMenu(...i),["prevent"])),onClick:t[11]||(t[11]=(...i)=>a.closeContextMenu&&a.closeContextMenu(...i)),onMousewheelPassive:t[12]||(t[12]=(...i)=>a.closeContextMenu&&a.closeContextMenu(...i)),onKeypress:t[13]||(t[13]=Se((...i)=>a.handleKeyPress&&a.handleKeyPress(...i),["prevent"]))},[De(e.$slots,"default",{},void 0,!0),w(_e,{name:"fade"},{default:L(()=>[o.showContextMenu?(D(),x("div",{key:0,class:"custom-context-menu",style:j({top:`${o.contextMenuY}px`,left:`${o.contextMenuX}px`})},[p2,u("div",f2,[u("div",{class:$(["option",{noClick:n.hasLabel||n.imageIncluded}]),onClick:t[0]||(t[0]=i=>a.addLabel("systoles")),onKeypress:t[1]||(t[1]=(...i)=>e.h&&e.h(...i))},y2,34),u("div",{class:$(["option",{noClick:n.hasLabel||n.imageIncluded}]),onClick:t[2]||(t[2]=i=>a.addLabel("diastoles")),onKeypress:t[3]||(t[3]=(...i)=>e.h&&e.h(...i))},_2,34),u("div",{class:$(["option",{noClick:!n.hasLabel}]),onClick:t[4]||(t[4]=i=>a.removeLabel()),onKeypress:t[5]||(t[5]=(...i)=>e.h&&e.h(...i))},D2,34),u("div",{class:$(["option",{noClick:n.imageIncluded||n.hasLabel}]),onClick:t[6]||(t[6]=i=>a.excludeImage()),onKeypress:t[7]||(t[7]=(...i)=>e.h&&e.h(...i))},x2,34),u("div",{class:$(["option",{noClick:!n.imageIncluded}]),onClick:t[8]||(t[8]=i=>a.excludeImage()),onKeypress:t[9]||(t[9]=(...i)=>e.h&&e.h(...i))},k2,34)])],4)):z("",!0)]),_:1}),w(_e,{name:"fade"},{default:L(()=>[o.showError?(D(),x("div",{key:0,class:"custom-context-menu",style:j({top:`${o.contextMenuY}px`,left:`${o.contextMenuX}px`})},E2,4)):z("",!0)]),_:1})],32)}const O2=A(g2,[["render",P2],["__scopeId","data-v-2fbde6de"]]);const A2={emits:["update-slice","remove-label","add-label","exclude-image","select-image"],props:{sliceID:{type:Number,required:!0},isHidden:{type:Boolean},numImages:{type:Number,required:!0},imgWidth:{type:Number,required:!0},BARHEIGHT:{type:Number,default:284},BARWIDTH:{type:Number,default:800}},components:{RightClickMenu:O2},data(){return{activeStore:Be(),viewSliceStore:st(),excludedImages:[],handlerBarWidth:3,cardiacCyclesLabelWidth:90,cardiacCyclesLabelHeight:30,handleBarGrab:{width:22,height:22},addNewLabelX:0,hasLabelOnClick:!1,includeImage:!0,canvasCursor:"default",moving:!1,movingObj:"none",movingObjs:[],barHeight:this.BARHEIGHT,startX:0,barWidth:this.BARWIDTH,mouse:{x:null,y:null}}},created(){window.addEventListener("keydown",this.keyDownHandler),this.sliceObj=this.activeStore.sliceData[this.sliceID-1].sliceOBJ},unmounted(){window.removeEventListener("keydown",this.keyDownHandler)},mounted(){this.addXLocations(),this.drawTrimmer()},watch:{barWidth(){this.drawTrimmer()},barHeight(){this.drawTrimmer()}},methods:{drawCycleLabel(e){const t=e,n=t.XLocation,s=t.id,o=this.cardiacCyclesLabelWidth,{canvas:a}=this.$refs,i=a.getContext("2d");i.fillStyle="#00000095";const r=this.barHeight-35,l=30,c=15;i.beginPath(),i.moveTo(n+c,r),i.lineTo(n+o-c,r),i.arcTo(n+o,r,n+o,r+c,c),i.lineTo(n+o,r+l-c),i.arcTo(n+o,r+l,n+o-c,r+l,c),i.lineTo(n+c,r+l),i.arcTo(n,r+l,n,r+l-c,c),i.lineTo(n,r+c),i.arcTo(n,r,n+c,r,c),i.closePath(),i.fill(),i.font="300 18px Roboto",i.textAlign="center",i.textBaseline="middle",i.fillStyle="white";const d=n+o/2,h=r+l/2;i.fillText(s,d,h);const g=2,v=3,p=2.5,f="rgba(255,255,255,0.65)";for(let m=0;m<3;m++){const y=n-10+o/2+v+m*(2*g+v),I=r+5+p+10+(2*g+p);i.beginPath(),i.arc(y,I,g,0,Math.PI*2),i.fillStyle=f,i.fill(),i.closePath()}},drawBars(e,t){const{canvas:n}=this.$refs,s=n.getContext("2d");s.fillStyle=t;const o=this.sliceObj.states[e].start.XLocation+this.handlerBarWidth,a=this.sliceObj.states[e].end.XLocation;s.beginPath(),s.moveTo(o,0),s.lineTo(a,0),s.moveTo(o,this.barHeight-1),s.lineTo(a,this.barHeight-1),s.lineWidth=1.5,s.strokeStyle=t,s.stroke()},drawTrimmer(){const{canvas:e}=this.$refs,t=e.getContext("2d"),n=this.barWidth,s=this.barHeight;e.width=n,e.height=s,t.clearRect(0,0,e.width,e.height),this.drawExludeImageOverlay(t),Object.entries(this.sliceObj.states).forEach(([o,a])=>{this.drawBars(o,a.color),a.cardiacCycles.systoles.forEach(i=>this.drawCycleLabel(i)),a.cardiacCycles.diastoles.forEach(i=>this.drawCycleLabel(i)),this.drawStartEndHandlers(a)})},drawhandle(e,t,n,s,o,a,i){const r=e;r.beginPath(),r.moveTo(t+a,n),r.lineTo(s-a,n),r.quadraticCurveTo(s,n,s,n+a),r.lineTo(s,o-a),r.quadraticCurveTo(s,o,s-a,o),r.lineTo(t+a,o),r.quadraticCurveTo(t,o,t,o-a),r.lineTo(t,n+a),r.quadraticCurveTo(t,n,t+a,n),r.closePath(),r.lineWidth=2,r.strokeStyle=i,r.stroke(),r.fillStyle=i,r.fill();const l=2.5,c=3,d=2.5,h="rgba(255,255,255,0.65)";for(let g=0;g<3;g++)for(let v=0;v<2;v++){const p=t+a+c+v*(2*l+c),f=n+a+d+10+g*(2*l+d);r.beginPath(),r.arc(p,f,l,0,Math.PI*2),r.fillStyle=h,r.fill(),r.closePath()}},drawHandleTriangle(e,t,n,s,o,a,i){const r=e;if(r.fillStyle=i,r.beginPath(),a==="left"){r.moveTo(t+s,n),r.lineTo(t,n+o),r.lineTo(t+s,n+o),r.closePath(),r.stroke(),r.fill();const l=t+s/2,c=n+o/1.6,d=Math.min(s,o)*.3,h=2;r.beginPath(),r.arc(l+d,c-d/2,h,0,Math.PI*2),r.arc(l,c+d/2,h,0,Math.PI*2),r.fillStyle="#FFFFFF85",r.fill(),r.beginPath(),r.arc(l+d,c+d/2,h,0,Math.PI*2),r.fill()}else{r.moveTo(t,n),r.lineTo(t+s,n+o),r.lineTo(t,n+o),r.closePath(),r.stroke(),r.fill();const l=t+s/5,c=n+o/1.6,d=Math.min(s,o)*.3,h=2;r.beginPath(),r.arc(l,c-d/2,h,0,Math.PI*2),r.arc(l,c+d/2,h,0,Math.PI*2),r.fillStyle="#FFFFFF85",r.fill(),r.beginPath(),r.arc(l+d,c+d/2,h,0,Math.PI*2),r.fill()}},drawStartEndHandlers(e){const t=e,{canvas:n}=this.$refs,s=n.getContext("2d"),o=5,a=this.handlerBarWidth+o,i=this.barHeight,r=0;let l=t.start.XLocation;t.start.XLocation=l;const c=t.color;s.beginPath(),s.moveTo(l+o,r),s.lineTo(l+a-o,r),s.lineTo(l+a-o,r+i),s.lineTo(l+o,r+i),s.arcTo(l,r+i,l,r+i-o,o),s.lineTo(l,r+o),s.arcTo(l,r,l+o,r,o),s.closePath(),s.fillStyle=c,s.fill(),this.drawHandleTriangle(s,l+1,this.barHeight-this.handleBarGrab.width,this.handleBarGrab.height,this.handleBarGrab.width,"right",c),l=t.end.XLocation,t.end.XLocation=l,l-=o,s.beginPath(),s.moveTo(l+o,r),s.arcTo(l+a,r,l+a,r+o,o),s.lineTo(l+a,r+i-o),s.arcTo(l+a,r+i,l+a-o,r+i,o),s.lineTo(l+o,r+i),s.closePath(),s.fillStyle=c,s.fill(),this.drawHandleTriangle(s,l-15,this.barHeight-this.handleBarGrab.width,this.handleBarGrab.height,this.handleBarGrab.width,"left",c)},findIfLabelOnClick(){const e=Math.floor(this.mouse.x/this.imgWidth)+1,t=this.findStateUserClicked();try{const{cardiacCycles:n}=this.sliceObj.states[t];let s=null,o=null;if(Object.keys(n).some(a=>(o=n[a].findIndex(i=>i.phaseLocation===e?(s=a,!0):!1),o!==-1)),o!==-1)return{state:t,foundLabel:s,foundIndex:o}}catch{return"error"}return null},drawExludeImageOverlay(e){const t=e;t.fillStyle="#44444492",t.strokeStyle="#70707092",this.sliceObj.excludedImages.forEach(n=>{const s=(n-1)*this.imgWidth;t.fillRect(s,0,this.imgWidth,this.barHeight-.5),t.strokeRect(s,0,this.imgWidth,this.barHeight-.5)})},findStateUserClicked(){let e=null;return Object.keys(this.sliceObj.states).some(t=>{const n=this.sliceObj.states[t].end.XLocation;return this.sliceObj.states[t].start.XLocation<=this.mouse.x&&this.mouse.x<=n?(e=t,!0):!1}),e},findObjonCursor(e){const t=this.sliceObj.states[e],{start:n,end:s,cardiacCycles:o}=t;if(this.checkMouseOnStart(n))return n;if(this.checkMouseOnEnd(s))return s;const a=this.checkAllLabels(o.systoles);if(a)return a;const i=this.checkAllLabels(o.diastoles);return i||null},checkMouseOnStart(e){const t=e.XLocation,n=t+this.handleBarGrab.width,s=this.barHeight-this.handleBarGrab.height,o=this.barHeight;return this.checkMouseInArea(t,n,s,o)},checkMouseOnEnd(e){const t=e.XLocation-this.handleBarGrab.width,n=t+this.handleBarGrab.width,s=this.barHeight-this.handleBarGrab.height,o=this.barHeight;return this.checkMouseInArea(t,n,s,o)},checkMouseOnLabel(e){const t=e.XLocation,n=t+this.cardiacCyclesLabelWidth,s=this.barHeight-35,o=s+this.cardiacCyclesLabelHeight;return this.checkMouseInArea(t,n,s,o)},checkAllLabels(e){return e.find(t=>this.checkMouseOnLabel(t))},checkMouseInArea(e,t,n,s){return this.mouse.x>=e&&this.mouse.x<=t&&this.mouse.y>=n&&this.mouse.y<=s},startResize(e){if(this.$refs.menu.closeContextMenu(),this.mouse.x=e.offsetX,this.mouse.y=e.offsetY,this.startX=this.mouse.x,e.ctrlKey){this.handleSelectImage(e);return}const t=this.findStateUserClicked();if(t){const n=this.findObjonCursor(t);n&&(this.moving=!0,this.movingObj=n)}},handleNotMoving(){const e=this.findStateUserClicked();this.updateCursor(),e&&(this.findObjonCursor(e)?this.updateCursor("grab"):this.updateCursor())},handleCheckUpperLowerBound(e,t,n,s,o){return e==="start"?this.sliceObj.states[t].start.XLocation+n+this.imgWidth>this.sliceObj.states[t].end.XLocation||this.sliceObj.states[t].start.XLocation+n<=s:this.sliceObj.states[t].end.XLocation+n-this.imgWidth-50<this.sliceObj.states[t].start.XLocation||this.sliceObj.states[t].end.XLocation+n>=o},mousemoving(e){if(!(e.offsetX>=this.sliceObj.states.FREEBREATHING.start.XLocation&&e.offsetX<=this.sliceObj.states.BREATHHOLD.end.XLocation+30||this.moving)){this.updateCursor();return}if(this.mouse.x=e.offsetX,this.mouse.y=e.offsetY,!this.moving){this.handleNotMoving();return}e.preventDefault();const t=e.offsetX,n=t-this.startX;if(this.movingObj.id==="end"||this.movingObj.id==="start"){const s=this.getPreviousKey(this.sliceObj.states,this.movingObj.state),o=this.getNextKey(this.sliceObj.states,this.movingObj.state),a=s?this.sliceObj.states[s].start.XLocation+this.imgWidth:0,i=o?this.sliceObj.states[o].end.XLocation-this.imgWidth:this.barWidth;if(this.handleCheckUpperLowerBound(this.movingObj.id,this.movingObj.state,n,a,i)||this.checkCollision(this.sliceObj.states[this.movingObj.state].cardiacCycles,this.movingObj,n))return;if(this.movingObj.id==="start"&&s){const r=this.sliceObj.states[s].end;if(this.checkCollision(this.sliceObj.states[s].cardiacCycles,r,n))return;r.XLocation+=n,this.movingObjs.length<2&&this.movingObjs.push(r)}else if(this.movingObj.id==="end"&&o){const r=this.sliceObj.states[o].start;if(this.checkCollision(this.sliceObj.states[o].cardiacCycles,r,n))return;r.XLocation+=n,this.movingObjs.length<2&&this.movingObjs.push(r)}this.startX=t,this.movingObj.XLocation+=n,this.movingObjs.length<2&&this.movingObjs.push(this.movingObj),requestAnimationFrame(this.drawTrimmer);return}this.movingObj.XLocation+n<=this.sliceObj.states[this.movingObj.state].start.XLocation||this.movingObj.XLocation+n>this.sliceObj.states[this.movingObj.state].end.XLocation-this.cardiacCyclesLabelWidth||(this.movingObj.XLocation+=n,this.movingObjs.length<1&&this.movingObjs.push(this.movingObj),requestAnimationFrame(this.drawTrimmer),this.startX=t)},checkCollision(e,t,n){return Object.keys(e).some(o=>e[o].some(i=>this.checkCollisionStartEnd(i,t,n)))},checkCollisionStartEnd(e,t,n){return t.id==="start"?n<0?!1:t.XLocation+n-10>=(e.phaseLocation-1)*this.imgWidth:t.id==="end"?n>0?!1:t.XLocation+n+15<=e.phaseLocation*this.imgWidth:!1},checksingleobj(e){return this.mouse.x>=e.location&&this.mouse.x<=e.location+e.width},snapObject(){if(this.movingObjs.length>1){const e=this.movingObjs[1],t=this.movingObjs[0],n=e.id==="start"?-1:1;e.phaseLocation=this.convertXLocationtoPhase(e.XLocation,e.id),e.XLocation=this.convertPhaseLocationtoX(e.phaseLocation,e.id),t.phaseLocation=e.phaseLocation+n,t.XLocation=this.convertPhaseLocationtoX(t.phaseLocation,t.id)}else{const e=this.movingObj;e.phaseLocation=this.convertXLocationtoPhase(e.XLocation,e.id),e.XLocation=this.convertPhaseLocationtoX(e.phaseLocation,e.id)}this.movingObjs=[]},endResize(){this.moving&&(this.moving=!1,this.snapObject(),this.drawTrimmer(),this.startX=this.mouse.x,this.moving=!1,this.movingObj="none",this.$emit("update-slice",this.sliceObj))},updateCursor(e="default"){this.canvasCursor=e},getNextKey(e,t){const n=Object.keys(e),s=n.indexOf(t);return s===-1||s===n.length-1?!1:n[s+1]},getPreviousKey(e,t){const n=Object.keys(e),s=n.indexOf(t);return s<=0?!1:n[s-1]},handleAddLabel(e){const t=this.findStateUserClicked(),n=e==="systoles"?"Systole":"Diastole",s=Math.floor(this.mouse.x/this.imgWidth)+1,o=this.convertPhaseLocationtoX(s),a={id:n,state:t,phaseLocation:s,XLocation:o};console.log("added"),this.activeStore.addLabel(this.sliceObj.id,t,e,a),this.drawTrimmer()},handleRemoveLabel(){const{state:e,foundLabel:t,foundIndex:n}=this.hasLabelOnClick,s=this.sliceObj.states[e].cardiacCycles[t],o=this.removeElementAtIndex(s,n);this.activeStore.deleteLabel(this.sliceObj.id,e,t,o),this.drawTrimmer()},handleRightClick(e){this.addNewLabelX=e.offsetX,this.mouse.x=this.addNewLabelX,this.hasLabelOnClick=this.findIfLabelOnClick();const t=Math.floor(this.mouse.x/this.imgWidth)+1;if(this.includeImage=this.sliceObj.excludedImages.indexOf(t)!==-1,this.hasLabelOnClick==="error"){this.$refs.menu.popError(e);return}this.$refs.menu.openContextMenu(e)},handleSelectImage(e){this.mouse.x=e.offsetX;const t=Math.floor(this.mouse.x/this.imgWidth)+1;this.hasLabelOnClick=this.findIfLabelOnClick(),!this.hasLabelOnClick&&this.activeStore.selectImage(t,this.sliceID-1)},handleExcludeImage(){const e=Math.floor(this.mouse.x/this.imgWidth)+1;this.activeStore.excludeImage(e,this.sliceID-1),this.activeStore.clearSelect(this.sliceID-1),this.drawTrimmer()},handleDblClick(){const e=Math.floor(this.mouse.x/this.imgWidth)+1;this.activeStore.sliceData[0].sliceOBJ.targetPhase=e-1,console.log(e),console.log(this.viewSliceStore.getConfig("Coronal",9)),this.viewSliceStore.updateConfig("Coronal",9,{slice:e-1})},removeElementAtIndex(e,t){if(t<0||t>=e.length)throw new Error("Index is out of range");const n=[...e];return n.splice(t,1),n},convertPhaseLocationtoX(e,t){let n;if(t==="start")n=(e-1)*this.imgWidth;else if(t==="end")n=e*this.imgWidth-this.handlerBarWidth;else{const s=(this.imgWidth-this.cardiacCyclesLabelWidth)/2;n=(e-1)*this.imgWidth+s}return n},convertXLocationtoPhase(e,t){let n;if(t==="start"){const s=e+this.imgWidth/2;n=Math.floor(s/this.imgWidth)+1}else if(t==="end"){const s=e-this.imgWidth/2;n=Math.floor(s/this.imgWidth)+1}else{const s=e+this.cardiacCyclesLabelWidth/2;n=Math.floor(s/this.imgWidth)+1}return n},addXLocation(e,t){const n=e;n.XLocation=this.convertPhaseLocationtoX(n.phaseLocation,t)},addXLocations(){Object.entries(this.sliceObj.states).forEach(([e])=>{const t=this.sliceObj.states[e];this.addXLocation(t.start,"start"),this.addXLocation(t.end,"end"),t.cardiacCycles.diastoles.forEach(n=>this.addXLocation(n)),t.cardiacCycles.systoles.forEach(n=>this.addXLocation(n))})},keyDownHandler(e){e.key==="Delete"&&this.sliceObj.selectedImages.length&&this.handleExcludeImage()}}};function B2(e,t,n,s,o,a){const i=M("RightClickMenu");return D(),x(ne,null,[u("div",{class:$([{hide:n.isHidden},"horizontal-bar"])},[u("canvas",{ref:"canvas",style:j({cursor:o.canvasCursor}),onMousedown:t[0]||(t[0]=(...r)=>a.startResize&&a.startResize(...r)),onFocusin:t[1]||(t[1]=(...r)=>a.startResize&&a.startResize(...r)),onFocusout:t[2]||(t[2]=(...r)=>a.endResize&&a.endResize(...r)),onMousemove:t[3]||(t[3]=(...r)=>a.mousemoving&&a.mousemoving(...r)),onMouseup:t[4]||(t[4]=(...r)=>a.endResize&&a.endResize(...r)),onMouseout:t[5]||(t[5]=(...r)=>a.endResize&&a.endResize(...r)),onContextmenu:t[6]||(t[6]=Se((...r)=>a.handleRightClick&&a.handleRightClick(...r),["prevent"])),onMousewheelPassive:t[7]||(t[7]=(...r)=>this.$refs.menu.closeContextMenu&&this.$refs.menu.closeContextMenu(...r)),onDblclick:t[8]||(t[8]=(...r)=>a.handleDblClick&&a.handleDblClick(...r))},null,36),(D(!0),x(ne,null,fe(e.sliceObj.excludedImages,(r,l)=>(D(),x("div",{key:l},[r?(D(),x("i",{key:0,onKeydown:t[9]||(t[9]=(...c)=>e.handleKeyPress&&e.handleKeyPress(...c)),onClick:t[10]||(t[10]=(...c)=>a.handleExcludeImage&&a.handleExcludeImage(...c)),class:"fa-regular fa-circle-xmark fa-lg",style:j({position:"absolute",top:"15px",left:r*n.imgWidth-25+"px",cursor:"pointer"})},null,36)):z("",!0)]))),128))],2),w(i,{ref:"menu","has-label":o.hasLabelOnClick,imageIncluded:o.includeImage,onAddLabel:a.handleAddLabel,onRemoveLabel:a.handleRemoveLabel,onExcludeImage:a.handleExcludeImage},null,8,["has-label","imageIncluded","onAddLabel","onRemoveLabel","onExcludeImage"])],64)}const V2=A(A2,[["render",B2],["__scopeId","data-v-b7111774"]]);const $2={props:{imageWidth:{type:Number},imageHeight:{type:Number},sliceObj:{type:Object},selectedImages:{type:Array}},data(){return{targetImages:[1,2]}}};function F2(e,t,n,s,o,a){return D(!0),x(ne,null,fe(n.selectedImages,(i,r)=>(D(),x("div",{key:r,class:"border",style:j({width:n.imageWidth-1+"px",height:n.imageHeight+"px",position:"absolute",left:(i-1)*n.imageWidth+1+"px"})},null,4))),128)}const N2=A($2,[["render",F2],["__scopeId","data-v-2a5a45d1"]]);const H2={props:{imageWidth:{type:Number},imageHeight:{type:Number},phase:{type:Number}},data(){return{targetImages:[1,2]}}};function z2(e,t,n,s,o,a){return D(),x("div",{class:"phase-border",style:j({width:n.imageWidth+"px",height:n.imageHeight-2+"px",position:"absolute",left:n.phase*n.imageWidth+1+"px",top:"1px"})},null,4)}const W2=A(H2,[["render",z2],["__scopeId","data-v-f86aacae"]]),j2={mounted(){this.drawAllContours(),this.mounted=!0},data(){return{contourStore:Et()}},props:{isHidden:{type:Boolean},numImages:{type:Number,required:!0},imgWidth:{type:Number,required:!0},imgHeight:{type:Number,required:!0},volumeKey:null,contourIDs:null},methods:{drawAllContours(){const{canvas:e}=this.$refs;e.width=this.numImages*this.imgWidth,e.height=this.imgHeight;const t=[192,192];this.contourIDs.forEach(n=>{const s=this.contourStore.toolByID[n],o=this.scaleCoordinates(t,s.polyLine,[this.imgWidth,this.imgHeight]);this.drawContours(o,s.slice)})},drawContours(e,t){const n=t*this.imgWidth,{canvas:s}=this.$refs,o=s.getContext("2d");o.strokeStyle="red";const a=.5;o.lineWidth=a,o.beginPath();const i=e[0]+n,r=e[1];o.moveTo(i,r);for(let l=2;l<e.length;l+=2){const c=e[l]+n,d=e[l+1];o.lineTo(c,d)}o.closePath(),o.stroke()},scaleCoordinates(e,t,n){if(t.length%2!==0)throw new Error("Invalid input array length. It should be even.");const[s,o]=e,[a,i]=n,r=a/s,l=i/o,c=new Array(t.length);for(let d=0;d<t.length;d+=2){const h=t[d],g=t[d+1];c[d]=h*r,c[d+1]=g*l}return c}},watch:{contourIDs:{handler(){this.mounted&&this.drawAllContours()},deep:!0}}},U2={ref:"canvas"};function G2(e,t,n,s,o,a){return D(),x("div",null,[u("canvas",U2,null,512)])}const X2=A(j2,[["render",G2]]);const K2={components:{ImageStripSlider:h2,VideoTrimmer:V2,SelectedFrame:N2,ContourOverlay:X2,CurrentPhaseFrame:W2},emits:["newstate","update-slice","remove-label","add-label","exclude-image","loaded","select-image"],props:{maxWidth:{type:Number,default:600},numImages:{type:Number,default:89},id:{type:Number},currentPhase:{type:Number},currentState:{type:String}},data(){return{activeStore:Be(),contourStore:Et(),imageWidth:150,imageHeight:286,scrollAmount:0,videoTrimWidth:null,volumeKey:null}},created(){this.videoTrimWidth=this.imageWidth*this.numImages,this.sliceInfo=Ve(this.activeStore.sliceData[this.id-1]),this.sliceObj=this.activeStore.sliceData[this.id-1].sliceOBJ,this.contours=T(()=>this.contourStore),this.contoursArray=T(()=>this.contours.value.toolIDs)},mounted(){if(this.scrollToState(this.currentState),this.volumeKey=this.activeStore.volumeKey,this.activeStore.readyToDraw){const e=this.$refs.movieStripCanvas,t=e.getContext("2d");this.imageHeightWidthRatio=250/250,this.imageHeight=this.imageWidth*this.imageHeightWidthRatio,this.$refs.videotrimmer.barHeight=this.imageHeight,e.width=this.imageWidth*100,e.height=this.imageHeight,t.putImageData(this.activeStore.readyToDraw,0,0),this.$emit("loaded")}else if(this.activeStore.scaledImageData)this.drawSingleImage(this.numImages),setTimeout(()=>{this.$emit("loaded")},500);else if(this.volumeKey)this.imageHeightWidthRatio=250/250,this.imageHeight=this.imageWidth*this.imageHeightWidthRatio,this.$refs.videotrimmer.barHeight=this.imageHeight,this.getImagesFromStore();else{const e=new Image;e.src="./images/test.png",e.onload=()=>{this.imageHeightWidthRatio=e.naturalHeight/e.naturalWidth,this.imageHeight=this.imageWidth*this.imageHeightWidthRatio,this.$refs.videotrimmer.barHeight=this.imageHeight},e.onerror=()=>{console.error("Failed to load the image.")},this.drawMovieStrip(),setTimeout(()=>{this.$emit("loaded")},400)}},methods:{async getImagesFromStore(){const t=await we().buildVolume(this.volumeKey),n=t.getPointData().getScalars().getData(),s=t.getDimensions();this.images=this.getImagesFromArray(n,s),this.activeStore.setRawImage(this.images),this.scaledImages=await this.scaleImages(this.images,s[0],s[1],this.imageWidth,this.imageHeight),this.activeStore.setScaledImage(this.scaledImages),await this.drawSingleImage(this.numImages);const o=this.$refs.movieStripCanvas,a=o.getContext("2d");this.activeStore.readyToDraw=a.getImageData(0,0,o.width,o.height),setTimeout(()=>{this.$emit("loaded")},200)},getImagesFromArray(e,t){const n=t[0]*t[1];return e.reduce((s,o,a)=>(a%n===0&&s.push(e.slice(a,a+n)),s),[])},async drawSingleImage(e){const t=this.activeStore.scaledImageData,n=this.$refs.movieStripCanvas,s=n.getContext("2d"),o=this.imageWidth,a=this.imageWidth;n.width=this.imageWidth*e,n.height=o;for(let i=0;i<e;i++){const r=new Uint8ClampedArray(this.imageWidth*o*4);t[i].forEach((d,h)=>{const g=h*4;r[g]=d,r[g+1]=d,r[g+2]=d,r[g+3]=255});const c=new ImageData(r,a,o);s.putImageData(c,i*a,0)}s.setTransform(1,0,0,1,0,0)},async scaleImages(e,t,n,s,o){const a=[];for(let i=0;i<this.numImages;i++)a.push(this.scaleImage(e[i],t,n,s,o));return a},scaleImage(e,t,n,s,o){return new Array(o*s).fill(0).map((i,r)=>{const l=Math.floor(r/s),d=r%s*(t-1)/(s-1),h=l*(n-1)/(o-1),g=Math.floor(d),v=Math.ceil(d),p=Math.floor(h),f=Math.ceil(h),m=e[p*t+g],y=e[p*t+v],I=e[f*t+g],S=e[f*t+v],b=d-g,E=h-p,R=m*(1-b)+y*b,O=I*(1-b)+S*b;return R*(1-E)+O*E})},drawMovieStrip(){const e=this.$refs.movieStripCanvas,t=e.getContext("2d"),{numImages:n}=this;e.width=this.imageWidth*n,e.height=this.imageHeight,this.videoTrimWidth=e.width,t.clearRect(0,0,e.width,e.height);const s=Array(n).fill("./images/test.png"),{imageWidth:o}=this;let a=0;const i=s.map(r=>new Promise((l,c)=>{const d=new Image;d.src=r,d.onload=()=>{l(d)},d.onerror=h=>{c(h)}}));Promise.all(i).then(r=>{r.forEach(l=>{t.drawImage(l,a,0,o,this.imageHeight),a+=o})}).catch(r=>{console.error(r)})},scrollX(e){const t="image-container",n=this.$refs[t];e.ctrlKey?n.scrollLeft+=Math.sign(e.deltaY)*this.imageWidth:(n.scrollLeft+=e.deltaY/4,n.scrollLeft+=e.deltaX/4),this.scrollAmount=n.scrollLeft,this.getScrollState()},scrollWithPhase(e){const t="image-container",n=this.$refs[t];n.scrollLeft+=e*this.imageWidth/2,this.scrollAmount=n.scrollLeft,this.getScrollState()},scrollToPhase(e){if(e>=this.numImages)return;const t=this.$refs["image-container"],n=e*this.imageWidth,s=n-t.scrollLeft;this.scrollAnimation(t,s),this.scrollAmount=n,this.getScrollState()},moveX(e){const t="image-container";this.$refs[t].scrollLeft=e,this.scrollAmount=this.$refs[t].scrollLeft,this.getScrollState()},getScrollState(){const e=["FREEBREATHING","HYPERVENTILATION","BREATHHOLD"],t=this.sliceObj,n=this.$refs["image-container"].scrollLeft;if(!(t.states[this.currentState].start.XLocation<n&&n<t.states[this.currentState].end.XLocation)){const s=e.find(o=>n<t.states[o].end.XLocation);s&&this.activeStore.setCurrentState(this.sliceInfo.id,s)}},scrollAnimation(e,t){const n=e,s=n.scrollLeft,o=300;let a;function i(r){a||(a=r);const l=r-a,c=Math.min(l/o,1);n.scrollLeft=s+t*c,c<1&&requestAnimationFrame(i)}requestAnimationFrame(i)},scrollToState(e){const t=this.$refs["image-container"],n=this.sliceObj.states[e].start.XLocation,s=n-t.scrollLeft;this.scrollAmount=n,this.scrollAnimation(t,s)},handleUpdateSlice(e){this.$emit("update-slice",e),this.$refs.sliderBar.drawCanvas()},handleRemoveLabel(e){this.$emit("remove-label",e)},handleAddLabel(e){this.$emit("add-label",e)},handleExcludeImage(e){this.$emit("exclude-image",e)},handleSelectImage(e){this.$emit("select-image",e)}},watch:{currentPhase(e){e<this.numImages&&this.scrollToPhase(Math.min(e-1,this.numImages))}}},q2={style:{position:"relative"}},Y2={style:{position:"relative"}},J2={class:"video-trimmer-container",ref:"video-trimmer-container"},Z2={ref:"contourCanvas"},Q2={ref:"movieStripCanvas"},em={key:0};function tm(e,t,n,s,o,a){const i=M("SelectedFrame"),r=M("CurrentPhaseFrame"),l=M("VideoTrimmer"),c=M("ContourOverlay"),d=M("ImageStripSlider");return D(),x(ne,null,[u("div",null,[u("div",{class:"strip",style:j({width:n.maxWidth+"px"}),ref:"image-container",onMousewheelPassive:t[0]||(t[0]=(...h)=>a.scrollX&&a.scrollX(...h))},[u("div",q2,[w(i,{imageHeight:o.imageHeight,imageWidth:o.imageWidth,"selected-images":e.sliceObj.selectedImages},null,8,["imageHeight","imageWidth","selected-images"])]),u("div",Y2,[w(r,{imageHeight:o.imageHeight,imageWidth:o.imageWidth,phase:n.currentPhase},null,8,["imageHeight","imageWidth","phase"])]),u("div",J2,[w(l,{sliceID:n.id,BARHEIGHT:o.imageHeight,BARWIDTH:o.videoTrimWidth,numImages:this.numImages,imgWidth:o.imageWidth,isHidden:!e.sliceInfo.imgBarProperties.showTrimmer,ref:"videotrimmer",onUpdateSlice:a.handleUpdateSlice,onRemoveLabel:a.handleRemoveLabel,onAddLabel:a.handleAddLabel,onExcludeImage:a.handleExcludeImage,onSelectImage:a.handleSelectImage},null,8,["sliceID","BARHEIGHT","BARWIDTH","numImages","imgWidth","isHidden","onUpdateSlice","onRemoveLabel","onAddLabel","onExcludeImage","onSelectImage"])],512),u("div",null,[u("canvas",Z2,null,512)]),u("div",{style:j({height:o.imageHeight+"px"}),ref:"moviestripcont"},[u("canvas",Q2,null,512)],4),w(_e,null,{default:L(()=>[e.sliceInfo.imgBarProperties.showContours?(D(),x("div",em,[w(c,{volumeKey:o.volumeKey,numImages:this.numImages,imgWidth:o.imageWidth,imgHeight:150,contourIDs:e.contoursArray.value},null,8,["volumeKey","numImages","imgWidth","contourIDs"])])):z("",!0)]),_:1})],36)]),w(d,{numImages:this.numImages,imgWidth:o.imageWidth,"slice-obj":e.sliceObj,canvasWidth:n.maxWidth,scrollAmount:o.scrollAmount,onUpdateDone:a.drawMovieStrip,onMove:a.moveX,ref:"sliderBar"},null,8,["numImages","imgWidth","slice-obj","canvasWidth","scrollAmount","onUpdateDone","onMove"])],64)}const nm=A(K2,[["render",tm],["__scopeId","data-v-041e2e02"]]);const om={props:{id:{type:Number},state:{type:String},isActive:{type:Boolean,default:!1}},created(){const n=Be().sliceData[this.id-1].stateButtons[this.state];this.heartrate=n.heartrate,this.duration=n.duration,this.stateColor=n.stateColor},data(){return{isHovered:!1,activeStore:Be()}},methods:{handleClick(){this.activeStore.setCurrentState(this.id,this.state),this.$emit("stateChange",this.state)}}},ii=e=>(oe("data-v-66b56157"),e=e(),ae(),e),am={class:"button-content"},sm={class:"row-container"},im={class:"row"},rm=ii(()=>u("h4",null,"HEART RATE",-1)),lm={class:"row"},cm=ii(()=>u("h4",null,"DURATION",-1));function dm(e,t,n,s,o,a){return D(),x("div",{class:$(["custom-button",{highlighted:n.isActive}]),onClick:t[0]||(t[0]=(...i)=>a.handleClick&&a.handleClick(...i)),onMouseover:t[1]||(t[1]=i=>o.isHovered=!0),onFocusin:t[2]||(t[2]=i=>o.isHovered=!0),onMouseout:t[3]||(t[3]=i=>o.isHovered=!1),onFocusout:t[4]||(t[4]=i=>o.isHovered=!1),onKeydown:t[5]||(t[5]=vt(Se((...i)=>e.handleKeyDown&&e.handleKeyDown(...i),["prevent"]),["space"]))},[u("div",am,[u("div",null,[u("h1",{style:j({color:e.stateColor})},F(n.state),5)]),u("div",sm,[u("div",im,[rm,u("h2",null,F(e.heartrate)+" BPM",1)]),u("div",lm,[cm,u("h2",null,F(e.duration)+" min",1)])])])],34)}const um=A(om,[["render",dm],["__scopeId","data-v-66b56157"]]);const hm={props:{biomarkers:{type:Array}},data(){return{active:!1,currentMarker:this.biomarkers[2]}},methods:{handleClickedOption(e){this.currentMarker=e,this.$emit("new-marker",this.biomarkers.indexOf(e)+1)}}},gm={class:"selected"},pm={key:0,class:"options"},fm=["onClick"];function mm(e,t,n,s,o,a){return D(),x("div",{class:$(["dropdown-container",{active:o.active}]),onClick:t[1]||(t[1]=i=>o.active=!o.active),onKeydown:t[2]||(t[2]=(...i)=>e.handleKeyDown&&e.handleKeyDown(...i))},[u("div",gm,[u("h5",null,F(o.currentMarker),1),u("i",{class:$(["fa-solid fa-caret-down",{flipped:o.active}])},null,2)]),w(_e,{name:"slide-fade"},{default:L(()=>[o.active?(D(),x("div",pm,[(D(!0),x(ne,null,fe(n.biomarkers,(i,r)=>(D(),x("div",{class:"option",key:r,onClick:l=>a.handleClickedOption(i),onKeydown:t[0]||(t[0]=(...l)=>e.handleKeyDown&&e.handleKeyDown(...l))},[u("h5",null,F(i),1)],40,fm))),128))])):z("",!0)]),_:1})],34)}const So=A(hm,[["render",mm],["__scopeId","data-v-4680641a"]]);const vm={props:{sliceID:{type:Number},propertyName:{type:String},iconSource:{type:String,default:"input-cursor"},iconHeight:{type:Number,default:32}},data(){return{activeStudyStore:Be(),activeIcon:""}},mounted(){this.activeStudyStore.getProperty(this.sliceID,this.propertyName)&&(this.activeIcon="_Active")},methods:{handleclick(){this.activeStudyStore.toggleProperty(this.sliceID,this.propertyName),this.activeIcon=this.activeStudyStore.getProperty(this.sliceID,this.propertyName)?"_Active":""}}},ym={class:"icon-container"},wm=["src"];function Sm(e,t,n,s,o,a){return D(),x("div",{onClick:t[2]||(t[2]=(...i)=>a.handleclick&&a.handleclick(...i)),class:$(["circle-container",{clicked:o.activeStudyStore.getProperty(n.sliceID,n.propertyName)}]),onKeydown:t[3]||(t[3]=vt(Se((...i)=>e.handleKeyDown&&e.handleKeyDown(...i),["prevent"]),["space"]))},[u("div",ym,[u("img",{src:"/src/components/icons/app_icons/"+n.iconSource+o.activeIcon+".svg",style:j({height:n.iconHeight+"px"}),alt:"Icon",onClick:t[0]||(t[0]=(...i)=>e.handleClick&&e.handleClick(...i)),onKeydown:t[1]||(t[1]=vt(Se((...i)=>e.handleKeyDown&&e.handleKeyDown(...i),["prevent"]),["space"]))},null,44,wm)])],34)}const _m=A(vm,[["render",Sm],["__scopeId","data-v-6ebbf4f2"]]);const Cm={components:{IconToggleQA:_m},props:{sliceID:{type:Number}},data(){return{active:!1}}},bm={class:"button-container"},Dm={class:"toggle-container"};function Im(e,t,n,s,o,a){const i=M("IconToggleQA");return D(),x("div",bm,[w(_e,{name:"slide-fade"},{default:L(()=>[u("div",Dm,[w(i,{sliceID:n.sliceID,propertyName:"showTrimmer",iconSource:"DisplayBreathingSplits"},null,8,["sliceID"]),w(i,{iconSource:"DisplayContours",sliceID:n.sliceID,propertyName:"showContours"},null,8,["sliceID"]),w(i,{iconSource:"DisplayInformation",sliceID:n.sliceID,propertyName:"showPatientInfo"},null,8,["sliceID"]),w(i,{iconSource:"DisplayGraph",sliceID:n.sliceID,propertyName:"showGraph"},null,8,["sliceID"])])]),_:1})])}const Tm=A(Cm,[["render",Im],["__scopeId","data-v-54445e1f"]]);const xm={components:{VtkTwoView:oi,ImageBarNew:nm,StateButtons:um,BiomarkerDropDown:So,CheckContoursButtons:Tm},props:{id:{type:String},viewDirection:{type:String},viewUp:{type:String},sliceId:{type:Number},maxWidth:{type:Number},currentSlice:{type:Number},targetValue:{type:Number}},created(){this.currentState=T(()=>this.activeStudyStore.sliceData[this.sliceId-1].stateButtons.currentState)},data(){return{activeStudyStore:Be()}},methods:{handleStateChange(e){this.$refs.imgBar.scrollToState(e)}},watch:{currentSlice(){}}},Lm={class:"viewer-container",ref:"viewerContainer"},Rm={class:"header-container"},km={class:"state-buttons"};function Mm(e,t,n,s,o,a){const i=M("BiomarkerDropDown"),r=M("CheckContoursButtons"),l=M("VtkTwoView"),c=M("ImageBarNew"),d=M("StateButtons");return D(),x("div",Lm,[u("div",Rm,[u("h5",null,"Slice "+F(n.sliceId),1),w(i,{biomarkers:["Biomarker 1","Biomarker 2","Biomarker 3","This is a long marker"]}),w(r,{sliceID:n.sliceId},null,8,["sliceID"])]),w(l,{class:"vtk-container",key:"sagitalv",id:n.id,viewDirection:n.viewDirection,viewUp:n.viewUp,ref:"vtkTarget"},null,8,["id","viewDirection","viewUp"]),w(c,{id:n.sliceId,maxWidth:n.maxWidth,currentPhase:n.currentSlice,currentState:e.currentState.value,ref:"imgBar"},null,8,["id","maxWidth","currentPhase","currentState"]),u("div",km,[w(d,{id:n.sliceId,state:"FREEBREATHING",isActive:e.currentState.value==="FREEBREATHING",onStateChange:a.handleStateChange},null,8,["id","isActive","onStateChange"]),w(d,{id:n.sliceId,state:"HYPERVENTILATION",isActive:e.currentState.value==="HYPERVENTILATION",onStateChange:a.handleStateChange},null,8,["id","isActive","onStateChange"]),w(d,{id:n.sliceId,state:"BREATHHOLD",isActive:e.currentState.value==="BREATHHOLD",onStateChange:a.handleStateChange},null,8,["id","isActive","onStateChange"])])],512)}const Em=A(xm,[["render",Mm],["__scopeId","data-v-44603194"]]);const Pm={components:{CheckContoursToolStrip:Hs,CheckContourViewer:Em},created(){[this.sliceInfo1,this.sliceInfo2]=this.activeStore.sliceData,this.sliceConfig=T(()=>this.viewSliceStore.getConfig("Coronal",9)),console.log(this.sliceConfig.value),this.currentSlice=T(()=>{var e;return((e=this.sliceConfig.value)==null?void 0:e.slice)??1}),this.sliceConfig2=T(()=>this.viewSliceStore.getConfig("Coronal2",9)),this.currentSlice2=T(()=>{var e;return((e=this.sliceConfig2.value)==null?void 0:e.slice)??1})},data(){return{activeStore:Be(),viewSliceStore:st(),viewerSize:null}},props:{width:{type:Number},height:{type:Number},targetValue:{type:Number}}},Om={class:"tool-strip",ref:"toolStrip"};function Am(e,t,n,s,o,a){const i=M("CheckContourViewer"),r=M("CheckContoursToolStrip");return D(),x("div",{class:"viewers-tools-container",style:j({maxWidth:n.width+"px",height:n.height+"px"})},[w(i,{sliceId:1,maxWidth:(n.width-110)/2,currentSlice:e.currentSlice.value,id:"Coronal",viewDirection:"Right",viewUp:"Superior"},null,8,["maxWidth","currentSlice"]),u("div",Om,[w(r)],512),w(i,{sliceId:2,maxWidth:(n.width-110)/2,currentSlice:e.currentSlice2.value,id:"Coronal2",viewDirection:"Right",viewUp:"Superior"},null,8,["maxWidth","currentSlice"])],4)}const ri=A(Pm,[["render",Am],["__scopeId","data-v-b04c369f"]]);const Bm={components:{CheckContourNew:ri},porps:{width:{type:Number},height:{type:Number}},data(){return{activeStore:Be()}},methods:{handleButtonClicked(e){this.activeButton=e},toggleComponent(e){this.currentComponent=e}}};function Vm(e,t,n,s,o,a){const i=M("CheckContourNew");return D(),Y(_e,{name:"fade"},{default:L(()=>[w(i,{width:e.width,height:e.height},null,8,["width","height"])]),_:1})}const $m=A(Bm,[["render",Vm],["__scopeId","data-v-eb716790"]]),xe=Z({id:"report-store",state:()=>({report:{reportTitle:"BE-OS CMR Report",reportLogo:null,patientName:"PATIENT NAME",patientGender:"",patientAge:"00",patientDOB:"DD-Mon-YYYY",patientID:"123 456 789",rbhNumber:"000 000 000",protocol:"OS C-",scanDate:"DD-Mon-YYYY",scanTime:"00:00",completeData:"",imageQuality:"",reader:"Reader Name, MD",verifier:"Verifier Name, MD",scannerSystem:"Philips Ingenia",fieldStrength:"1.5T",softwareVersion:"5.7.1.3",starClaimer:"*Normal values are continuously being updated, therefore, may be subject to changes",summary:"",heartRateBaseline:"00",heartRateHV:"00",heartRateBH:"00",dtheartrate:"00",dtheartrateNormalRange:">15",vascularGlobal:"00",vascularLAD:"00",vascularLCX:"00",vascularRCA:"00",normalRangeVascular:">9.1",strainLADBaseline:"00",strainLADHV:"00",strainLADBH:"00",strainLCXBaseline:"00",strainLCXHV:"00",strainLCXBH:"00",strainRCABaseline:"00",strainRCAHV:"00",strainRCABH:"00",strainGLOBALBaseline:"00",strainGLOBALHV:"00",strainGLOBALBH:"00",vascularImage:"",strainImage:"",oxygenSensitiveMap:"",strainMapImage:"",strainMapBaseline:"",strainMapHV:"",strainMapBH:"",normalRange:"<-20%"}}),getters:{reportData(){return this.report}},actions:{}});const Fm={props:{id:{type:String,required:!0},options:{type:Array,required:!0},editable:{type:Boolean,default:!0}},data(){return{selectedOption:"Select...",reportStore:xe()}},mounted(){this.reportStore.report[this.id]&&(this.selectedOption=this.reportStore.report[this.id])},methods:{onOptionSelected(e){const t=e.target.value;this.selectedOption=t,this.reportStore.report[this.id]=t}}},Nm={key:0,class:"select"},Hm=["id"],zm={value:"",disabled:"",selected:""},Wm=["value"],jm={key:1},Um={class:"selected-option"};function Gm(e,t,n,s,o,a){return n.editable?(D(),x("div",Nm,[u("select",{id:n.id,required:"",onChange:t[0]||(t[0]=i=>a.onOptionSelected(i)),"aria-labelledby":"dropDownComponentinReportElement"},[u("option",zm,F(o.selectedOption),1),(D(!0),x(ne,null,fe(n.options,(i,r)=>(D(),x("option",{key:r,value:i.value},F(i.label),9,Wm))),128))],40,Hm)])):(D(),x("div",jm,[u("h5",Um,F(o.selectedOption),1)]))}const Xm=A(Fm,[["render",Gm],["__scopeId","data-v-3d5de27a"]]);const Km={props:{id:{type:String},width:{type:Number,default:200},height:{type:Number,default:200},canvasText:{type:String,default:"Select or Drop Image"},addBar:{type:Boolean,default:!1},editable:{type:Boolean,default:!0},imgSource:{type:String,default:"left"}},data(){return{isMoving:!1,canvasX:0,canvasY:0,zoomValue:1,originalImage:!1,viewSample:!1,hovering:!1,moveMode:!1,enableMoving:!1,cStartX:null,cStartY:null,currentZoom:1,reportStore:xe()}},methods:{zoomIn(){const e=this.$refs.targetImage,t=parseFloat(e.style.transform.match(/-?\d+\.\d+/));t&&(this.currentZoom=t),this.currentZoom*=1.05,e.style.transform=`scale(${this.currentZoom})`;const n=this.reportStore.report;n[this.id].zoom=this.currentZoom},zoomOut(){const e=this.$refs.targetImage,t=parseFloat(e.style.transform.match(/-?\d+\.\d+/));t&&(this.currentZoom=t),this.currentZoom*=.95,e.style.transform=`scale(${this.currentZoom})`;const n=this.reportStore.report;n[this.id].zoom=this.currentZoom},handleMouseDown(e){this.editable&&this.enableMoving&&(this.cStartX=e.offsetX,this.cStartY=e.offsetY,this.moveMode=!0)},handleMouseUp(){this.moveMode=!1},handleMouseMove(e){if(this.moveMode){const t=e.offsetX-this.cStartX,n=e.offsetY-this.cStartY;this.cStartX=e.offsetX,this.cStartY=e.offsetY;const s=this.$refs.targetImage,o=parseFloat(s.style.left.replace("px",""))||0,a=parseFloat(s.style.top.replace("px",""))||0,i=this.reportStore.report;i[this.id].x=o+t,i[this.id].y=a+n,s.style.left=`${o+t}px`,s.style.top=`${a+n}px`}},resetImage(){this.centerImage(),this.scaleToFit()},resetProperties(){const e=this.$refs.targetImage;e.style.transform="scale(1)",e.style.left="0px",e.style.top="0px"},centerImage(){const e=this.$refs.targetImage,t=this.$refs.imageContainer.getBoundingClientRect(),n=(t.width-e.width)/2,s=(t.height-e.height)/2;e.style.left=`${n}px`,e.style.top=`${s}px`;const o=this.reportStore.report;o[this.id].x=n,o[this.id].y=s},scaleToFit(){const e=this.$refs.targetImage,n=this.$refs.imageContainer.getBoundingClientRect().width/e.width;this.currentZoom=1*n;const s=this.reportStore.report;s[this.id].zoom=this.currentZoom,e.style.transform=`scale(${this.currentZoom})`},openFilePicker(){this.$refs.imageLoaderInput.click()},uploadImage(e){const t=e.target.files[0];this.handleFileUpload(t)},handleFileUpload(e){if(this.resetProperties(),e){const t=this.$refs.targetImage,n=this.reportStore.report,s=this.id;this.currentZoom=1;const o=this.currentZoom,a=parseFloat(t.style.left.replace("px",""))||0,i=parseFloat(t.style.top.replace("px",""))||0;this.imageToBase64(e,function(r){t.src=r,n[s].img=r,n[s].x=a,n[s].y=i,n[s].zoom=o})}this.originalImage=!0},handleDragOver(e){e.preventDefault(),this.hovering=!0},handleDragLeave(e){e.preventDefault(),this.hovering=!1},handleImageDrop(e){if(!this.editable){e.preventDefault(),this.hovering=!1;return}this.hovering=!1,e.preventDefault();const t=e.dataTransfer.files[0];if(t.size>4*1024*1024){console.log("File size exceeds 4MB. Please choose a smaller file.");return}if(!["image/jpeg","image/png","image/svg"].includes(t.type)){console.log("Invalid file format. Please choose a JPEG, PNG, or GIF image.");return}this.handleFileUpload(t)},imageToBase64(e,t){const n=new FileReader;n.onload=function(s){typeof t=="function"&&t(s.target.result)},n.readAsDataURL(e)},loadImgFromStore(e){this.$refs.targetImage.src=e.img;const t=this.$refs.targetImage;t.style.transform=`scale(${e.zoom})`,this.currentZoom=e.zoom,t.style.left=`${e.x}px`,t.style.top=`${e.y}px`,this.originalImage=!0},async saveImg(){const e=this.$refs["vascular-image-div"];wn(e,{logging:!1,scale:3}).then(t=>{const n=t.toDataURL("image/png");return this.reportStore.report[this.id].final=n,n}).catch(t=>{console.error("Error capturing screenshot:",t)})}},mounted(){const e=this.$refs.imageContainer.getBoundingClientRect();this.$refs.zoomControl.style.width=`${e.width}px`,this.$refs.zoomControl.style.height=`${e.height-2}px`,this.reportStore.report[this.id].img&&this.loadImgFromStore(this.reportStore.report[this.id])},watch:{async editable(){this.moveMode&&(this.moveMode=!this.moveMode,this.handleMouseUp()),this.editable||this.saveImg()}}},sn=e=>(oe("data-v-e60c072b"),e=e(),ae(),e),qm={key:0,class:"buttons"},Ym={class:"upload-button",title:"Upload File",alt:"Upload File",style:{position:"relative"}},Jm=sn(()=>u("i",{class:"fas fa-upload fa-lg",style:{color:"#ffffff"}},null,-1)),Zm=[Jm],Qm={key:0,class:"move-button",title:"Move",alt:"Move",style:{position:"relative"}},ev=sn(()=>u("i",{class:"fas fa-arrows fa-lg",style:{color:"#ffffff"}},null,-1)),tv=[ev],nv={key:1,class:"zoom-in-button",title:"Zoom In",alt:"Zoom In",style:{position:"relative"}},ov=sn(()=>u("i",{class:"fas fa-search-plus fa-lg",style:{color:"#ffffff"}},null,-1)),av=[ov],sv={key:2,class:"zoom-out-button",title:"Zoom Out",alt:"Zoom Out",style:{position:"relative"}},iv=sn(()=>u("i",{class:"fas fa-search-minus fa-lg",style:{color:"#ffffff"}},null,-1)),rv=[iv],lv={key:3,class:"zoom-out-button",title:"Center Image",alt:"Center Image",style:{position:"relative"}},cv=sn(()=>u("i",{class:"fa-solid fa-arrows-to-circle fa-lg",style:{color:"#ffffff"}},null,-1)),dv=[cv],uv={ref:"vascular-image-div"},hv={key:0,style:{position:"relative"}},gv={class:"target-image",alt:"",ref:"targetImage"};function pv(e,t,n,s,o,a){return D(),x("div",{id:"image-container",ref:"imageContainer",class:$(["image-container",{moving:o.moveMode,hover:o.hovering&&n.editable}]),style:j({height:n.height+"pt",width:"98%"}),onDragenter:t[11]||(t[11]=(...i)=>a.handleDragOver&&a.handleDragOver(...i)),onDragover:t[12]||(t[12]=(...i)=>a.handleDragOver&&a.handleDragOver(...i)),onDrop:t[13]||(t[13]=(...i)=>a.handleImageDrop&&a.handleImageDrop(...i)),onDragleave:t[14]||(t[14]=(...i)=>a.handleDragLeave&&a.handleDragLeave(...i))},[w(_e,null,{default:L(()=>[n.editable&&!o.moveMode?(D(),x("div",qm,[u("div",Ym,[u("button",{class:"upload-buttons upload-image",onClick:t[0]||(t[0]=(...i)=>a.openFilePicker&&a.openFilePicker(...i))},Zm),u("input",{type:"file",ref:"imageLoaderInput",name:"imageLoader",style:{display:"none"},accept:"image/jpeg, image/png, image/svg",onChange:t[1]||(t[1]=(...i)=>a.uploadImage&&a.uploadImage(...i)),"aria-labelledby":"hiddenImageInputinReport",max:"4MB"},null,544)]),o.originalImage?(D(),x("div",Qm,[u("button",{class:$(["upload-buttons",{moving:o.enableMoving}]),style:{left:"50px"},onClick:t[2]||(t[2]=i=>o.enableMoving=!o.enableMoving)},tv,2)])):z("",!0),o.originalImage?(D(),x("div",nv,[u("button",{class:"upload-buttons",style:{left:"90px"},onClick:t[3]||(t[3]=(...i)=>a.zoomIn&&a.zoomIn(...i))},av)])):z("",!0),o.originalImage?(D(),x("div",sv,[u("button",{class:"upload-buttons",style:{left:"130px"},onClick:t[4]||(t[4]=(...i)=>a.zoomOut&&a.zoomOut(...i))},rv)])):z("",!0),o.originalImage?(D(),x("div",lv,[u("button",{class:"upload-buttons",style:{left:"170px",display:"flex","align-items":"center","justify-content":"center"},onClick:t[5]||(t[5]=(...i)=>a.resetImage&&a.resetImage(...i))},dv)])):z("",!0)])):z("",!0)]),_:1}),u("div",uv,[n.addBar?(D(),x("div",hv)):z("",!0),u("div",{class:"target-image-container",ref:"zoomControl",onMousedown:t[6]||(t[6]=(...i)=>a.handleMouseDown&&a.handleMouseDown(...i)),onMousemove:t[7]||(t[7]=(...i)=>a.handleMouseMove&&a.handleMouseMove(...i)),onMouseup:t[8]||(t[8]=(...i)=>a.handleMouseUp&&a.handleMouseUp(...i)),onMouseleave:t[9]||(t[9]=(...i)=>a.handleMouseUp&&a.handleMouseUp(...i)),onFocusout:t[10]||(t[10]=(...i)=>a.handleMouseUp&&a.handleMouseUp(...i))},[u("img",gv,null,512)],544)],512)],38)}const fv=A(Km,[["render",pv],["__scopeId","data-v-e60c072b"]]);const mv={props:{id:{type:String,required:!0},editable:{type:Boolean,default:!0},maxLength:{type:Number,default:5}},data(){return{editing:0,reportStore:xe()}},methods:{stopEditing(){this.reportStore.report[this.id]=this.$refs.inputField.value},updateProp(){this.reportStore.report[this.id]=this.$refs.inputField.value}},watch:{editable(){this.$refs.inputField.readOnly=!this.editable,this.reportStore.report[this.id]=this.$refs.inputField.value}},mounted(){this.editable||(this.$refs.inputField.readOnly=!0)}},vv=["value","maxlength"];function yv(e,t,n,s,o,a){return D(),x("input",{onInput:t[0]||(t[0]=(...i)=>a.updateProp&&a.updateProp(...i)),onBlur:t[1]||(t[1]=(...i)=>a.stopEditing&&a.stopEditing(...i)),value:this.reportStore.report[this.id],maxlength:n.maxLength,ref:"inputField",class:$(["input-field",{edit:n.editable}]),style:j({paddingLeft:n.editable?"5px":"0px"})},null,46,vv)}const wv=A(mv,[["render",yv],["__scopeId","data-v-cb53ec6f"]]);const Sv={props:{editable:{type:Boolean}},data(){return{selectContainer:!1,reportStore:xe(),patientConditions:{},choices:{Normal:!1,Global:!1,LAD:!1,LCX:!1,RCA:!1},cannedText:{Normal:"There is a normal response of the myocardial oxygenation to a breathing challenge, reflecting normal coronary vascular dysfunction.",Global:"There is a blunted response of the myocardial oxygenation to a breathing challenge, reflecting global coronary vascular dysfunction on a microvascular level.",LAD:"There is a blunted response of the myocardial oxygenation to a breathing challenge, reflecting coronary vascular dysfunction, predominantly in the anterior, anteroseptal, and anterolateral myocardium. This finding is consistent with significant stenosis in the proximal LAD.",LCX:"There is coronary vascular dysfunction, predominantly in the inferolateral myocardium. This finding is consistent with significant stenosis in the proximal LCX.",RCA:"There is coronary vascular dysfunction, predominantly in the inferior and inferoseptal myocardium. This finding is consistent with significant stenosis in the proximal RCA.",LADLCX:"There is coronary vascular dysfunction in the anterior, anteroseptal, anterolateral, and inferolateral myocardium. This finding is consistent with significant stenosis in the proximal LAD and LCX.",LADRCA:"There is coronary vascular dysfunction in the anterior, anteroseptal, and anterolateral, as well as inferoseptal and inferior myocardium. This finding is consistent with significant stenosis in the proximal LAD and RCA.",LCXRCA:"There is coronary vascular dysfunction in the inferolateral, inferoseptal and inferior myocardium. This finding is consistent with significant stenosis in the proximal LCX and RCA."}}},methods:{handleOptionSelect(){if(this.choices.Global)this.reportStore.report.summary=this.cannedText.Global;else{let e=Object.keys(this.choices).map(t=>this.choices[t]?t:"").join("");this.reportStore.report.summary=this.cannedText[e]}this.toggleContainer()},startHoverTimer(){this.hoverTimer=setTimeout(()=>{this.selectContainer||this.toggleContainer()},500)},clearHoverTimer(){this.hoverTimer&&(clearTimeout(this.hoverTimer),this.hoverTimer=null)},handleChoice(e){if(this.choices[e]=!this.choices[e],e==="Global")for(const t in this.choices)t!=="Normal"?this.choices[t]=this.choices[e]:this.choices[t]=!1;else if(e==="Normal")for(const t in this.choices)t!=="Normal"&&(this.choices[t]=!1);else this.choices.Global||this.choices.Normal?(this.choices.Global=!1,this.choices.Normal=!1):this.choices.LAD&&this.choices.LCX&&this.choices.RCA&&(this.choices.Global=!0)},toggleContainer(){this.clearHoverTimer(),this.selectContainer=!this.selectContainer,this.selectContainer?this.$refs.optionsContainer.style.pointerEvents="all":this.$refs.optionsContainer.style.pointerEvents="none"}}},li=e=>(oe("data-v-f2cbe13e"),e=e(),ae(),e),_v={key:0,class:"options-container",ref:"optionsContainer"},Cv={key:0,class:"container-list"},bv={class:"coronary-choices"},Dv=li(()=>u("h4",null,"Select Impacted Coronary Region(s):",-1)),Iv={class:"choices-container"},Tv=["onClick"],xv={key:0,class:"fa-solid fa-circle-check fa-sm",style:{color:"#ffffff"}},Lv={key:1,class:"fa-regular fa-circle fa-sm",style:{color:"#ffffff"}},Rv={for:"vehicle1"},kv=li(()=>u("label",null,"Add Finding",-1)),Mv=[kv];function Ev(e,t,n,s,o,a){return n.editable?(D(),x("div",_v,[w(_e,{name:"bounce"},{default:L(()=>[o.selectContainer?(D(),x("div",Cv,[u("div",bv,[Dv,u("div",Iv,[(D(!0),x(ne,null,fe(o.choices,(i,r)=>(D(),x("div",{key:r,class:"choice",onClick:l=>a.handleChoice(r)},[i?(D(),x("i",xv)):(D(),x("i",Lv)),u("label",Rv,F(r),1)],8,Tv))),128))]),u("div",{class:"choice",onClick:t[0]||(t[0]=(...i)=>a.handleOptionSelect&&a.handleOptionSelect(...i))},Mv)])])):z("",!0)]),_:1}),u("div",{class:"select-options-container",onClick:t[1]||(t[1]=(...i)=>a.toggleContainer&&a.toggleContainer(...i)),onMouseenter:t[2]||(t[2]=(...i)=>a.startHoverTimer&&a.startHoverTimer(...i)),onMouseleave:t[3]||(t[3]=(...i)=>a.clearHoverTimer&&a.clearHoverTimer(...i))},[u("i",{class:"fa-regular fa-rectangle-list",style:j({color:o.selectContainer?"white":null})},null,4)],32)],512)):z("",!0)}const Pv=A(Sv,[["render",Ev],["__scopeId","data-v-f2cbe13e"]]);const Ov={components:{SelectOptions:Pv},props:{id:{type:String,required:!0},placeholder:{type:String,default:""},editable:{type:Boolean,default:!0}},data(){return{editing:0,editedValue:null,selectContainer:!0,reportStore:xe()}},methods:{stopEditing(){this.reportStore.report[this.id]=this.$refs.inputField.value},updateProp(e){this.reportStore.report[this.id]=e.target.value},splitStringByPixelWidth(e,t,n){if(e==="")return[""];if(t<=0||n<=0)throw new Error("maxWidthInPixels and charWidthInPixels should be greater than 0");const s=e.split(" "),o=[];let a="",i=0;for(let r=0;r<s.length;r++){const l=s[r],c=l.length*n;i+c<=t?(a.length>0&&(a+=" ",i+=n),a+=l,i+=c):(o.push(a),a=l,i=c)}return a&&o.push(a),o},processSentences(e){const t=e.split(`
`),n=[];return t.forEach(s=>{const o=this.splitStringByPixelWidth(s,1090,12);n.push(...o)}),n},handleInput(){const e=this.$refs.inputField,t=this.processSentences(e.value);t.length>7&&(e.value=t.slice(0,7).join(`
`))}},mounted(){this.editable||(this.$refs.inputField.readOnly=!0),this.$refs.inputField.addEventListener("input",this.handleInput)},watch:{editable(){this.$refs.inputField.readOnly=!this.editable}}},Av={class:"textarea-container"},Bv=["value","placeholder"];function Vv(e,t,n,s,o,a){const i=M("SelectOptions");return D(),x("div",Av,[w(i,{editable:n.editable},null,8,["editable"]),u("textarea",{value:o.reportStore.report[n.id],onInput:t[0]||(t[0]=(...r)=>a.updateProp&&a.updateProp(...r)),onBlur:t[1]||(t[1]=(...r)=>a.stopEditing&&a.stopEditing(...r)),ref:"inputField",rows:"7",maxlength:"500",class:$({edit:n.editable,noedit:!n.editable}),placeholder:n.placeholder,"aria-labelledby":"textAreaInReportEditable"},null,42,Bv)])}const $v=A(Ov,[["render",Vv],["__scopeId","data-v-f1e0735e"]]);const Fv={props:{visible:{type:Array},editable:{type:Boolean},id:{type:String}},data(){return{radius:60,reportStore:xe(),colorStops:[{color:[0,0,0],minPercentage:0,maxPercentage:0},{color:[30,30,232],minPercentage:.25,maxPercentage:.5},{color:[60,224,59],minPercentage:.5,maxPercentage:.75},{color:[251,0,0],minPercentage:.75,maxPercentage:.75},{color:[255,255,255],minPercentage:1,maxPercentage:1}],hideLAD:!0,hideLCX:!0,hideRCA:!0}},mounted(){this.setColor("LAD"),this.setColor("RCA"),this.setColor("LCX")},methods:{handleClickGlobal(e){this.checkCenter(e.offsetX,e.offsetY)&&this.$emit("segment-updated",-1)},handleClickRegion(e){this.reportStore.report.coronaryTerritoryLAD="37.1%"},checkCenter(e,t){return this.distance(e,t,this.radius,this.radius)<this.radius*.25},distance(e,t,n,s){return Math.sqrt((n-e)*(n-e)+(s-t)*(s-t))},setColor(e){parseFloat(this.reportStore.report[`coronaryTerritory${e}`])>0?this.$refs[e].style.fill=this.getColorAtPercentage(this.reportStore.report[`coronaryTerritory${e}`]):this.$refs[e].style.fill="#869FD5"},handleHide(){this.hideLAD=!this.reportStore.report.coronaryTerritoryLAD>0,this.hideLAD=!this.reportStore.report.coronaryTerritoryLAD>0},getColorAtPercentage(e){if(!parseFloat(e))return"rgb(0,0,0)";const n="linear-gradient(90deg, rgba(0,0,0,1) 0%, rgba(30,30,232,1) 25%, rgba(60,224,59,1) 50%, rgba(251,0,0,1) 75%, rgba(255,255,255,1) 100%)".match(/rgba?\([\d,]+\s?,\s?[\d,]+\s?,\s?[\d,]+\s?,\s?[\d.]+\)/g);if(!n||n.length<2)throw new Error("Invalid gradient format");const o=Math.min(Math.max(parseFloat(e),0),100)/100*(n.length-1),a=Math.floor(o),i=Math.ceil(o),r=o-a,l=n[a].match(/[\d.]+/g).map(Number),c=n[i].match(/[\d.]+/g).map(Number);return`rgb(${l.map((h,g)=>Math.round(h+r*(c[g]-h))).join(", ")})`},async saveImg(){const e=this.$refs["map-container"],t=e.getBoundingClientRect();console.log(t.width,t.height),wn(e,{logging:!1,scale:3}).then(n=>{const s=n.toDataURL("image/png");return this.reportStore.report[this.id]=s,s}).catch(n=>{console.error("Error capturing screenshot:",n)})}},computed:{colorBarStyle(){return{background:`linear-gradient(to top, ${this.colorStops.map(e=>`rgb(${e.color.join(",")}) ${e.minPercentage*100}%`).join(", ")})`}},hasValues(){const e=this.reportStore.report;return[parseFloat(e.coronaryTerritoryLAD)>0,parseFloat(e.coronaryTerritoryLCX)>0,parseFloat(e.coronaryTerritoryRCA)>0]}},watch:{"reportStore.report.coronaryTerritoryLAD":function(){this.setColor("LAD")},"reportStore.report.coronaryTerritoryLCX":function(){this.setColor("LCX")},"reportStore.report.coronaryTerritoryRCA":function(){this.setColor("RCA")},async editable(){this.editable||this.saveImg()}}},Pn=e=>(oe("data-v-78ca9a44"),e=e(),ae(),e),Nv={class:"polarMap-container",ref:"map-container"},Hv=kt('<filter id="inset-shadow" data-v-78ca9a44><feOffset dx="0" dy="0" in="SourceAlpha" result="offsetblur" data-v-78ca9a44></feOffset><feFlood flood-color="black" data-v-78ca9a44></feFlood><feComposite in2="offsetblur" operator="in" data-v-78ca9a44></feComposite><feMerge data-v-78ca9a44><feMergeNode data-v-78ca9a44></feMergeNode><feMergeNode in="SourceGraphic" data-v-78ca9a44></feMergeNode></feMerge></filter><defs data-v-78ca9a44><clipPath id="clip-path" data-v-78ca9a44><rect id="Rectangle_14969" data-name="Rectangle 14969" width="106.172" height="97.233" transform="translate(0 0)" fill="none" data-v-78ca9a44></rect></clipPath><linearGradient id="linear-gradient" x1="0.251" y1="0.188" x2="0.558" y2="0.72" gradientUnits="objectBoundingBox" data-v-78ca9a44><stop offset="0" stop-color="#e02224" data-v-78ca9a44></stop><stop offset="1" stop-color="#701112" data-v-78ca9a44></stop></linearGradient><clipPath id="clip-path-2" data-v-78ca9a44><rect id="Rectangle_14970" data-name="Rectangle 14970" width="106.924" height="71.081" transform="translate(0 0)" fill="none" data-v-78ca9a44></rect></clipPath><linearGradient id="linear-gradient-2" x1="0.105" y1="1.048" x2="0.686" y2="0.131" gradientUnits="objectBoundingBox" data-v-78ca9a44><stop offset="0" stop-color="#2bac76" data-v-78ca9a44></stop><stop offset="1" stop-color="#16563b" data-v-78ca9a44></stop></linearGradient><clipPath id="clip-path-3" data-v-78ca9a44><rect id="Rectangle_14971" data-name="Rectangle 14971" width="57.642" height="122.07" transform="translate(0 0)" fill="none" data-v-78ca9a44></rect></clipPath><linearGradient id="linear-gradient-3" x1="0.91" y1="0.531" x2="-0.193" y2="0.5" gradientUnits="objectBoundingBox" data-v-78ca9a44><stop offset="0" stop-color="#1164a3" data-v-78ca9a44></stop><stop offset="1" stop-color="#093252" data-v-78ca9a44></stop></linearGradient></defs>',2),zv={id:"Group_956","data-name":"Group 956",transform:"translate(293.5 2661.733)"},Wv={id:"Group_902","data-name":"Group 902",transform:"translate(-293.124 -2661.733)"},jv={id:"Group_226","data-name":"Group 226","clip-path":"url(#clip-path)"},Uv={id:"Path_120",ref:"LAD","data-name":"Path 120",d:"M36.459,70.606H.79A70.134,70.134,0,0,1,35.305,10.531L36.41,10A69.588,69.588,0,0,1,71.1.789c12.62,0,23.794,4.034,34.009,9.9L97.154,25.276h-.012L88.53,40.495v.013A50.5,50.5,0,0,1,95.89,46.7L84.922,58.411A18.926,18.926,0,0,0,52.164,71.019a19.139,19.139,0,0,0,5.284,13.276L46.674,96.089A36.451,36.451,0,0,1,36.459,70.606",fill:"url(#linear-gradient)",filter:"url(#inset-shadow)"},Gv=Pn(()=>u("path",{id:"Path_121","data-name":"Path 121",d:"M71.1.79c12.621,0,23.794,4.033,34.01,9.9L97.153,25.276h-.012L88.53,40.5v.012A50.5,50.5,0,0,1,95.89,46.7L84.921,58.411A18.927,18.927,0,0,0,52.163,71.02a19.143,19.143,0,0,0,5.284,13.275L46.674,96.089A36.447,36.447,0,0,1,36.458,70.606H.789A70.136,70.136,0,0,1,35.3,10.531L36.41,10A69.58,69.58,0,0,1,71.1.79m0-.79A70.657,70.657,0,0,0,36.041,9.3l-1.08.523-.031.015-.03.018A71.244,71.244,0,0,0,0,70.606v.79H35.677A37.052,37.052,0,0,0,46.113,96.645l.584.588.56-.611L58.03,84.827l.5-.545-.51-.533a17.955,17.955,0,0,1,.465-25.464,17.994,17.994,0,0,1,25.857.66l.575.627.582-.621L96.466,47.242l.518-.553-.531-.54a52.327,52.327,0,0,0-6.886-5.883l8.034-14.2h.009l.236-.412L105.8,11.067l.37-.677-.67-.385C93.779,3.272,82.526,0,71.1,0",fill:"#fff"},null,-1)),Xv={id:"Group_903","data-name":"Group 903",transform:"translate(-293.5 -2591.54)"},Kv={id:"Group_228","data-name":"Group 228","clip-path":"url(#clip-path-2)"},qv={ref:"RCA",id:"Path_122","data-name":"Path 122",d:"M105.636,61.679a74.551,74.551,0,0,1-34.823,8.49c-12.6,0-24.62-2.684-34.835-8.028A69.843,69.843,0,0,1,.911,1.531H.923C.911,1.324.911,1.118.911.911H36.1a34.593,34.593,0,0,0,1.2,9.1,34.817,34.817,0,0,0,9.244,15.753,1.98,1.98,0,0,0,.255.231l4.725-5.028L57.209,14.9a18.79,18.79,0,0,0,13.422,5.623,18.764,18.764,0,0,0,13.422-5.635l5.878,5.878,5.454,5.454a34.776,34.776,0,0,1-7.033,5.49L98.677,50.432Z",fill:"url(#linear-gradient-2)"},Yv=Pn(()=>u("path",{id:"Path_123","data-name":"Path 123",d:"M36.1.911a34.593,34.593,0,0,0,1.2,9.1,34.815,34.815,0,0,0,9.243,15.754,2.051,2.051,0,0,0,.256.23l4.724-5.028L57.208,14.9a18.8,18.8,0,0,0,13.423,5.623,18.764,18.764,0,0,0,13.421-5.635l5.879,5.879,5.453,5.453a34.778,34.778,0,0,1-7.032,5.49L98.676,50.432l6.959,11.247a74.551,74.551,0,0,1-34.823,8.49c-12.6,0-24.62-2.684-34.835-8.028A69.842,69.842,0,0,1,.911,1.531H.923C.911,1.324.911,1.118.911.911ZM37.009,0H0V.911c0,.132,0,.263,0,.395l0,.225a71.022,71.022,0,0,0,35.523,61.4c10.2,5.338,22.393,8.151,35.289,8.151a75.81,75.81,0,0,0,35.248-8.6l.863-.455-.513-.83L99.451,49.952l-9.88-17.913a35.84,35.84,0,0,0,6.461-5.174l.637-.644-.64-.641-5.454-5.454L84.7,14.248l-.65-.65-.644.655a17.781,17.781,0,0,1-12.771,5.363,17.815,17.815,0,0,1-12.774-5.352l-.666-.674-.648.691-5.684,6.061L46.767,24.7A33.914,33.914,0,0,1,38.18,9.771,33.744,33.744,0,0,1,37.009.911Z",fill:"#f0efef"},null,-1)),Jv={id:"Group_901","data-name":"Group 901",transform:"translate(-209.038 -2651.576)"},Zv={id:"Group_230","data-name":"Group 230","clip-path":"url(#clip-path-3)"},Qv={ref:"LCX",id:"Path_124","data-name":"Path 124",d:"M57.642,61.127H57.58A70.232,70.232,0,0,1,21.873,122.07l-3.932-6.875-2.262-3.951L15.542,111l-2.473-4.319c.013,0,.013-.012.026-.012L8.7,98.889l-4.574-8a34.289,34.289,0,0,0,7.06-5.382L0,74.424A18.739,18.739,0,0,0,5.478,61.176,18.768,18.768,0,0,0,.422,48.344L11.9,36.282a35.252,35.252,0,0,0-7.839-6.067L21.8,0c.284.16.556.331.841.5a70.167,70.167,0,0,1,35,60.625",fill:"url(#linear-gradient-3)"},e3=Pn(()=>u("path",{id:"Path_125","data-name":"Path 125",d:"M22.12,1.252l.06.036a70.241,70.241,0,0,1,25.035,24.9,68.842,68.842,0,0,1,9.51,34.031h-.054l0,.909a69.611,69.611,0,0,1-34.46,59.7l-3.477-6.08L16.474,110.8l-.141-.254-1.7-2.967h.021l-.767-1.359L9.495,98.437,5.366,91.215a35.148,35.148,0,0,0,6.467-5.063l.65-.647-.652-.646L1.275,74.4A19.579,19.579,0,0,0,6.389,61.176,19.642,19.642,0,0,0,1.66,48.363l10.9-11.453.6-.634-.608-.628A36.013,36.013,0,0,0,5.3,29.891ZM21.8,0,4.056,30.215a35.217,35.217,0,0,1,7.838,6.067L.421,48.344A18.765,18.765,0,0,1,5.478,61.176,18.739,18.739,0,0,1,0,74.424L11.19,85.506a34.287,34.287,0,0,1-7.059,5.383l4.573,8,4.391,7.78c-.014,0-.014.012-.026.012L15.542,111l.136.244,2.263,3.951,3.932,6.875A70.232,70.232,0,0,0,57.58,61.127h.062A70.169,70.169,0,0,0,22.639.5c-.285-.17-.556-.342-.84-.5",fill:"none",stroke:"#fff","stroke-width":"0.5"},null,-1)),t3={class:"bar-container"},n3=Pn(()=>u("div",{class:"values"},[u("h5",{class:"end"},"100.00"),u("h5",{class:"start"},"0.00")],-1));function o3(e,t,n,s,o,a){return D(),x("div",Nv,[(D(),x("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",width:"142.104",height:"141.273",viewBox:"0 0 142.104 141.273",class:"polar-map-container",style:j({width:o.radius*2+"px",height:o.radius*2+"px"})},[Hv,u("g",zv,[u("g",Wv,[u("g",jv,[u("path",Uv,null,512),Gv])]),u("g",Xv,[u("g",Kv,[u("path",qv,null,512),Yv])]),u("g",Jv,[u("g",Zv,[u("path",Qv,null,512),e3])])])],4)),u("div",{class:$(["tag LAD",{hidden:!a.hasValues[0]}])},[u("h4",null,F(o.reportStore.report.coronaryTerritoryLAD),1)],2),u("div",{class:$(["tag LCX",{hidden:!a.hasValues[1]}])},[u("h4",null,F(o.reportStore.report.coronaryTerritoryLCX),1)],2),u("div",{class:$(["tag RCA",{hidden:!a.hasValues[2]}])},[u("h4",null,F(o.reportStore.report.coronaryTerritoryRCA),1)],2),u("div",t3,[n3,u("div",{class:"color-bar",style:j(a.colorBarStyle)},null,4)])],512)}const ci=A(Fv,[["render",o3],["__scopeId","data-v-78ca9a44"]]);const a3={props:{segment:{type:String},editable:{type:Boolean}},data(){return{reportStore:xe()}},mounted(){this.segment&&this.$refs.segmentValue.focus()},methods:{updateValue(){this.reportStore.report[this.segment]=this.$refs.segmentValue.value,this.$emit("update",this.segment)},stopEditing(){this.$emit("off",this.segment)}},updated(){this.$refs.segmentValue&&this.$refs.segmentValue.focus()}},s3=e=>(oe("data-v-f84d7d65"),e=e(),ae(),e),i3={key:0},r3=s3(()=>u("p",null,"Value:",-1)),l3=["value"];function c3(e,t,n,s,o,a){return D(),Y(_e,null,{default:L(()=>[n.segment&&n.editable?(D(),x("div",i3,[u("p",null,F(n.segment.replace("AHA","Segment ")),1),r3,u("input",{type:"text",class:"input",ref:"segmentValue",value:o.reportStore.report[n.segment],maxlength:"5",onInput:t[0]||(t[0]=(...i)=>a.updateValue&&a.updateValue(...i)),onBlur:t[1]||(t[1]=(...i)=>a.stopEditing&&a.stopEditing(...i))},null,40,l3)])):z("",!0)]),_:1})}const d3=A(a3,[["render",c3],["__scopeId","data-v-f84d7d65"]]);const u3={props:{visible:{type:Array},editable:{type:Boolean},id:{type:String}},components:{SegmentInput:d3},data(){return{radius:65,reportStore:xe(),targetSegment:"",colorStops:[{color:[0,0,0],minPercentage:0,maxPercentage:0},{color:[30,30,232],minPercentage:.25,maxPercentage:.5},{color:[60,224,59],minPercentage:.5,maxPercentage:.75},{color:[251,0,0],minPercentage:.75,maxPercentage:.75},{color:[255,255,255],minPercentage:1,maxPercentage:1}],hideLAD:!0,hideLCX:!0,hideRCA:!0}},mounted(){this.setColor("AHA1"),this.setColor("AHA2"),this.setColor("AHA3"),this.setColor("AHA4"),this.setColor("AHA5"),this.setColor("AHA6"),this.setColor("AHA7"),this.setColor("AHA8"),this.setColor("AHA9"),this.setColor("AHA10"),this.setColor("AHA11"),this.setColor("AHA12")},methods:{handleClickGlobal(e){this.checkCenter(e.offsetX,e.offsetY)&&this.$emit("segment-updated",-1)},handleClickSegment(e){this.editable&&(this.targetSegment=e)},checkCenter(e,t){return this.distance(e,t,this.radius,this.radius)<this.radius*.25},distance(e,t,n,s){return Math.sqrt((n-e)*(n-e)+(s-t)*(s-t))},setColor(e){this.reportStore.report[e]?this.$refs[e].style.fill=this.getColorAtPercentage(this.reportStore.report[e]):this.$refs[e].style.fill="#869FD5"},handleSegmentUpdate(e){this.setColor(e);const t=+e.replace("AHA",""),n={LAD:[1,2,7,8],LCX:[6,5,11,12],RCA:[3,4,9,10]};for(const s in n)if(n[s].includes(t)){let o=0;n[s].forEach(a=>{o+=parseFloat(this.reportStore.report[`AHA${a}`])||0}),this.reportStore.report[`coronaryTerritory${s}`]=(o/4).toFixed(1);break}},getColorAtPercentage(e){if(!parseFloat(e))return"rgb(0,0,0)";const n="linear-gradient(90deg, rgba(0,0,0,1) 0%, rgba(30,30,232,1) 25%, rgba(60,224,59,1) 50%, rgba(251,0,0,1) 75%, rgba(255,255,255,1) 100%)".match(/rgba?\([\d,]+\s?,\s?[\d,]+\s?,\s?[\d,]+\s?,\s?[\d.]+\)/g);if(!n||n.length<2)throw new Error("Invalid gradient format");const o=Math.min(Math.max(parseFloat(e),0),100)/100*(n.length-1),a=Math.floor(o),i=Math.ceil(o),r=o-a,l=n[a].match(/[\d.]+/g).map(Number),c=n[i].match(/[\d.]+/g).map(Number);return`rgb(${l.map((h,g)=>Math.round(h+r*(c[g]-h))).join(", ")})`},async saveImg(){const e=this.$refs["map-container"];wn(e,{logging:!1,scale:3}).then(t=>{const n=t.toDataURL("image/png");return this.reportStore.report[this.id]=n,n}).catch(t=>{console.error("Error capturing screenshot:",t)})}},computed:{colorBarStyle(){return{background:`linear-gradient(to top, ${this.colorStops.map(e=>`rgb(${e.color.join(",")}) ${e.minPercentage*100}%`).join(", ")})`}},hasValues(){const e=this.reportStore.report;return[parseFloat(e.coronaryTerritoryLAD)>0,parseFloat(e.coronaryTerritoryLCX)>0,parseFloat(e.coronaryTerritoryRCA)>0]}},watch:{async editable(){this.targetSegment=null,this.editable||(this.$refs["map-container"].style.pointerEvents="none",this.saveImg()),this.editable&&(this.$refs["map-container"].style.pointerEvents="all")},"reportStore.report.AHA1":function(){this.handleSegmentUpdate("AHA1")},"reportStore.report.AHA2":function(){this.handleSegmentUpdate("AHA2")},"reportStore.report.AHA3":function(){this.handleSegmentUpdate("AHA3")},"reportStore.report.AHA4":function(){this.handleSegmentUpdate("AHA4")},"reportStore.report.AHA5":function(){this.handleSegmentUpdate("AHA5")},"reportStore.report.AHA6":function(){this.handleSegmentUpdate("AHA6")},"reportStore.report.AHA7":function(){this.handleSegmentUpdate("AHA7")},"reportStore.report.AHA8":function(){this.handleSegmentUpdate("AHA8")},"reportStore.report.AHA9":function(){this.handleSegmentUpdate("AHA9")},"reportStore.report.AHA10":function(){this.handleSegmentUpdate("AHA10")},"reportStore.report.AHA11":function(){this.handleSegmentUpdate("AHA11")},"reportStore.report.AHA12":function(){this.handleSegmentUpdate("AHA12")}}},h3=e=>(oe("data-v-fbaecaeb"),e=e(),ae(),e),g3={class:"polarMap-container",ref:"map-container"},p3=kt(`<path class="st0" d="M295.2,325.7l41.1,71.1c-0.3,0.2-0.6,0.3-0.9,0.5l-41.2-71.1l-0.1-0.2l0-0.1l-0.1-0.1c3.2-1.8,6.3-3.7,9.3-5.9\r
	c3.2-2.3,6.2-4.9,9-7.7c0,0,0,0,0,0c0.3-0.3,0.5-0.5,0.7-0.8c9.1-9.4,15.4-20.4,19-32.1c-3.7,12.3-10.2,23.2-18.9,32.2l0.5,0.5\r
	c-5.6,5.6-11.8,10.1-18.4,13.7C295.3,325.6,295.2,325.6,295.2,325.7z" data-v-fbaecaeb></path><path class="st0" d="M337.7,396c3.9-2.3,7.7-4.8,11.5-7.5c-1.8,1.3-3.6,2.6-5.5,3.8C341.8,393.6,339.8,394.8,337.7,396z" data-v-fbaecaeb></path><path class="st0" d="M394.2,340.4c0.9-1.5,1.8-3.1,2.7-4.7C396.1,337.4,395.2,338.9,394.2,340.4z" data-v-fbaecaeb></path><rect x="416.5" y="260.4" class="st0" width="0.2" height="0.1" data-v-fbaecaeb></rect><path class="st0" d="M417.5,259.9v0.2c-0.5,24.5-6.5,49-18.2,71.3c11.6-22.3,17.6-46.7,18.1-71.3h-82c0-0.1,0-0.1,0-0.2H417.5z" data-v-fbaecaeb></path><path class="st0" d="M95.8,267.7c0.2,2.3,0.4,4.6,0.6,6.8C96.2,272.3,96,270,95.8,267.7z" data-v-fbaecaeb></path><path class="st0" d="M176.8,397C176.8,397,176.9,397,176.8,397v0.2c0,0-0.1,0-0.1,0c-12.2-7-23.7-15.7-34.1-26\r
	c-27-27-42.4-61.3-46.2-96.6c3.8,35.2,19.2,69.4,46.2,96.4C153,381.4,164.6,390,176.8,397z" data-v-fbaecaeb></path><path class="st0" d="M182.6,284.6c-5.3-12.8-5.8-22.9-5.8-24.4h0.7C177.9,268.5,179.6,276.8,182.6,284.6z" data-v-fbaecaeb></path><path class="st0" d="M218.2,325.6l-18.5,32L176.9,397c0,0-0.1-0.1-0.1-0.1l41.3-71.4C218.1,325.5,218.2,325.6,218.2,325.6z" data-v-fbaecaeb></path><polyline class="st1" points="312.6,200.8 312.6,200.8 312.6,200.8 " data-v-fbaecaeb></polyline><path class="st2" d="M218.1,325.5c0,0,0.1,0,0.1,0.1l-18.5,32L177,397c0,0,0,0,0,0c0,0-0.1-0.1-0.1-0.1L218.1,325.5z" data-v-fbaecaeb></path><path class="st2" d="M335.3,397.3c-0.3,0.1-0.5,0.3-0.8,0.4l-41.1-71.1c-3.3,1.7-6.8,3.1-10.2,4.2c-8.3,3-17.3,4.6-26.6,4.6\r
	c-14,0-27.1-3.6-38.5-10l0-0.1c15.7,8.7,33.5,11.6,50.7,8.8c0,0,0,0,0.1,0c0.2,0,0.3,0,0.5-0.1c0.1,0,0.1,0,0.2,0\r
	c8.4-1.4,16.6-4.2,24.2-8.3l0,0.1l0.1,0.2l0,0.1l0.1,0.2L335.3,397.3z" data-v-fbaecaeb></path><path class="st2" d="M335.3,260.1c0-0.4,0-0.7,0.1-1.1C335.3,259.4,335.3,259.7,335.3,260.1L335.3,260.1z" data-v-fbaecaeb></path><path class="st2" d="M335.4,256.6c0,0.3,0,0.6,0,1c0-0.8,0-1.6,0-2.4C335.4,255.7,335.4,256.1,335.4,256.6z" data-v-fbaecaeb></path><path class="st2" d="M330.5,131.5l-33.2,57.3c0.2,0.1,0.4,0.3,0.6,0.4c-0.2-0.2-0.4-0.3-0.7-0.4l0.1-0.1l23.3-40.3l0.2-0.4l16.8-29\r
	l0.1-0.2l0.3-0.6c0,0,0,0,0.1,0h0l-0.3,0.6c11.3,6.7,21.9,14.9,31.7,24.7c15.7,15.7,27.5,33.8,35.3,53.1\r
	c-7.9-19.3-19.6-37.3-35.3-53c-9.8-9.7-20.4-17.9-31.8-24.6L330.5,131.5z" data-v-fbaecaeb></path><path class="st2" d="M417.4,259.9v0.2h-82c0-0.1,0-0.1,0-0.2H417.4z" data-v-fbaecaeb></path><path class="st0" d="M382.8,479.5l-2.5-4.4l-44.7-77.2l-0.3-0.5l0,0c-0.1,0-0.1,0.1-0.2,0.1c-0.2,0.1-0.3,0.2-0.5,0.3\r
	c-48.9,27.2-108.9,26.9-157.7-0.7c0,0,0,0,0,0c0,0-0.1,0-0.1,0l-0.1,0.2l-0.1,0.2l-47,81.2l-0.2,0.4l-0.2,0.3\r
	c39.3,22.5,83.2,33.7,127.2,33.7c5.5,0,10.9-0.2,16.4-0.5c0.2,0,0.3,0,0.5,0c37.7-2.5,75-13.2,108.8-32.3c0.3-0.1,0.5-0.3,0.8-0.5\r
	L382.8,479.5z M256.6,512.7c-5.5,0-11-0.2-16.5-0.5c-1.1-0.1-2.2-0.1-3.3-0.2c-36.9-3-73.2-14-106.2-33l-0.1,0.1\r
	c-0.3-0.2-0.5-0.3-0.8-0.5l46.9-81.2c23.6,13.4,50.8,21.1,79.9,21.1c28.3,0,55-7.3,78.2-20.1l47.2,81.6\r
	C345,500.8,302.2,512.7,256.6,512.7z" data-v-fbaecaeb></path><path class="st2" d="M199.2,202c-14.4,15.3-21.7,34.8-21.7,54.3c0,1.2,0,2.4,0.1,3.6v0.1h-82v-0.2h1.1v0.1h80.8\r
	C176.5,239.2,183.7,218.1,199.2,202z" data-v-fbaecaeb></path><path class="st2" d="M200,200.9c2.3-2.3,4.7-4.4,7.1-6.3c-1.1,0.9-2.2,1.8-3.2,2.8c-0.1,0-0.1,0.1-0.2,0.1c0,0-0.1,0.1-0.1,0.1\r
	c0,0-0.1,0.1-0.1,0.1c-0.1,0.1-0.1,0.1-0.2,0.2c0,0,0,0,0,0.1c-0.1,0.1-0.2,0.2-0.3,0.3c0,0-0.1,0.1-0.1,0.1\r
	c-0.1,0.1-0.3,0.3-0.4,0.4c-0.1,0.1-0.2,0.2-0.3,0.3c0,0-0.1,0-0.1,0.1l0,0c-0.5,0.5-1.1,1-1.6,1.6c-0.2,0.2-0.4,0.4-0.5,0.6\r
	c-0.3,0.3-0.6,0.6-0.9,0.9c0.3-0.3,0.6-0.6,0.9-0.9L200,200.9C200,201,200,201,200,200.9L200,200.9z" data-v-fbaecaeb></path><path class="st2" d="M214.8,189.2c0,0-0.1,0-0.1,0.1l0,0c-0.2,0.1-0.3,0.2-0.5,0.3c0.2-0.1,0.3-0.2,0.5-0.3L174,118.8c0,0,0,0,0.1,0\r
	h0c0,0,0,0,0.1,0l37.8,65.4L214.8,189.2L214.8,189.2L214.8,189.2z" data-v-fbaecaeb></path><path class="st2" d="M176.8,397l-0.1,0.2l-0.1,0.2C128.7,370,96.2,318.9,95,260.1H1.7c0.9,64.5,25.9,128.7,75,177.8\r
	c8.3,8.2,16.9,15.7,25.9,22.6c8.7,6.7,17.8,12.7,27,18l-0.2,0.4l-0.2,0.3c-9.6-5.5-19-11.7-28-18.6c-9-6.9-17.6-14.4-25.8-22.6\r
	C26.2,388.8,1.2,324.6,0.5,260.1V260h95v0.2c0,0.6,0,1.1,0,1.7c0,0.5,0,1,0,1.5c0,0.7,0.1,1.4,0.1,2.2c0,0.7,0.1,1.4,0.1,2.1\r
	c0.2,2.3,0.4,4.6,0.6,6.8c3.8,35.2,19.2,69.4,46.2,96.4C153,381.4,164.6,390,176.8,397z" data-v-fbaecaeb></path><path class="st3" d="M158.2,536.4l-0.1,0.2c0,0,0,0-0.1,0l0,0l0.1-0.1v-0.1C158.1,536.4,158.2,536.4,158.2,536.4z" data-v-fbaecaeb></path><path class="st3" d="M313.7,311.9c-5.6,5.6-11.8,10.1-18.4,13.7c0,0-0.1,0-0.1,0.1c-0.3,0.2-0.6,0.3-1,0.5c0,0,0,0,0,0\r
	c-0.3,0.1-0.5,0.3-0.8,0.4c-3.3,1.7-6.8,3.1-10.2,4.2c-4.5,1.5-9.2,2.6-13.9,3.3c-0.1,0-0.2,0-0.2,0c0,0,0,0-0.1,0\r
	c-1.3,0.2-2.5,0.3-3.8,0.4c0,0,0,0-0.1,0c-1,0.1-2.1,0.2-3.1,0.2c-1,0-2,0.1-3,0.1h-0.2c-0.3,0-0.6,0-0.9,0\r
	c-13.2,0-26.5-3.3-38.3-9.8c-6.2-3.4-12-7.7-17.2-12.9l25.1-25.1l0.1-0.1l0.6-0.6c2.9,2.9,6.2,5.3,9.7,7.2c6,3.2,12.6,4.9,19.2,5h0\r
	c0.3,0,0.5,0,0.8,0c0.3,0,0.7,0,1.1,0h0.1c6.2-0.2,12.4-1.7,18.1-4.6c3.2-1.6,6.3-3.7,9-6.3c0.2-0.2,0.5-0.4,0.7-0.6\r
	c0,0,0.1-0.1,0.2-0.1v0c0.1-0.1,0.1-0.1,0.2-0.2c0.1-0.1,0.3-0.3,0.4-0.4c0.1-0.1,0.2-0.2,0.3-0.3L313.7,311.9z" data-v-fbaecaeb></path><path class="st2" d="M295.2,325.7c0,0,0.1,0,0.1-0.1c6.6-3.6,12.8-8.1,18.4-13.7l-0.5-0.5c8.7-9,15.2-19.9,18.9-32.2\r
	c0.2-0.5,0.3-1.1,0.5-1.7c0,0,0-0.1,0-0.1c0.2-0.5,0.3-1.1,0.4-1.6c0.1-0.6,0.3-1.2,0.4-1.8c0.1-0.6,0.3-1.2,0.4-1.7\r
	c0.1-0.6,0.2-1.2,0.3-1.8c0.6-3.5,1-6.9,1.2-10.4h-0.1c0-0.4,0-0.7,0-1.1c0-0.4,0-0.8,0-1.1c0-0.1,0-0.2,0-0.3c0-0.3,0-0.7,0-1\r
	c0-0.5,0-0.9,0-1.4c0-0.2,0-0.3,0-0.5c0-0.3,0-0.6,0-0.9c0-0.3,0-0.6,0-0.8c0-0.4,0-0.8-0.1-1.2c0-0.4,0-0.9-0.1-1.3\r
	c-0.1-1.3-0.2-2.7-0.4-4c-2.1-16.7-9.5-32.8-22.1-45.6l0,0c-0.1-0.1-0.2-0.3-0.4-0.4c-4.4-4.4-9.1-8.1-14.2-11.2c0,0-0.1,0-0.1-0.1\r
	c-0.2-0.1-0.4-0.3-0.6-0.4l33.2-57.3l7.2-12.4h0c0,0,0,0-0.1,0c0,0,0,0,0,0c0,0,0,0,0,0c-0.1-0.1-0.2-0.1-0.3-0.2l-40.3,69.6l0,0.1\r
	l-0.2,0.3l-0.2,0.4l0,0l-0.1,0.1c5.4,3.2,10.4,7.1,15,11.7c0.2,0.1,0.3,0.3,0.4,0.4c0,0,0.1,0.1,0.1,0.1c0,0,0.1,0.1,0.1,0.1\r
	c0.5,0.6,1.1,1.2,1.6,1.7h-4L285,227.9c16.3,16.3,16.4,42.6,0.3,59l0,0l25.8,25.8h0.3c-5.3,5.3-11.2,9.7-17.5,13.1\r
	c-0.3,0.1-0.5,0.3-0.8,0.4l0.1,0.2l0,0.1h0l0.1,0.2l41.1,71.1l0,0.1l0,0c0.2-0.1,0.3-0.2,0.5-0.3c0.1,0,0.1-0.1,0.2-0.1\r
	c0,0,0,0,0.1,0c0.3-0.2,0.7-0.4,1-0.6c0.4-0.3,0.9-0.5,1.3-0.8c-0.4,0.3-0.9,0.5-1.3,0.7L295.2,325.7z M416.6,260.4L416.6,260.4\r
	L416.6,260.4L416.6,260.4L416.6,260.4z M418.2,260c0-1,0-2.1,0-3.1c0-59.4-32-111.2-79.7-139.3l42.9-74.2l0.3-0.4l3.6-6.3\r
	c-0.1-0.1-0.2-0.1-0.3-0.2c-0.1,0-0.2-0.1-0.2-0.1L338,117.3l-0.4,0.7l0,0.1l-0.4,0.6c0.1,0.1,0.3,0.2,0.4,0.3c0,0,0,0,0,0l0,0\r
	c0,0,0,0,0.1,0h0l0.3-0.6h0c11.5,6.8,22.2,15.1,32.1,24.9c24.5,24.5,39.5,54.9,44.9,86.6c0.4,2.2,0.7,4.4,1,6.6\r
	c0.1,1.1,0.3,2.2,0.4,3.3c0.1,0.6,0.1,1.3,0.2,1.9c0.1,0.6,0.1,1.3,0.2,1.9l0,0.4c0.1,0.7,0.1,1.4,0.2,2.2c0,0.5,0.1,0.9,0.1,1.4\r
	c0,0.6,0.1,1.2,0.1,1.8c0.2,3.5,0.2,7.1,0.2,10.6h-82c0,0.1,0,0.1,0,0.2h82c0,0.8,0,1.5-0.1,2.3c0,0.8,0,1.5-0.1,2.3\r
	c0,0.5,0,1-0.1,1.4c-0.1,2.2-0.3,4.5-0.5,6.7c-0.1,0.7-0.1,1.3-0.2,2c-0.1,0.7-0.2,1.4-0.2,2.1c-0.1,1-0.3,2-0.4,3\r
	c-0.1,0.7-0.2,1.5-0.3,2.2c0,0,0,0.1,0,0.1c-0.1,0.5-0.2,1-0.2,1.5c-0.1,0.5-0.2,1.1-0.3,1.7c-0.1,0.6-0.2,1.2-0.3,1.8\r
	c-0.1,0.7-0.3,1.5-0.4,2.2c-0.3,1.6-0.7,3.3-1.1,4.9c-0.2,0.8-0.4,1.6-0.6,2.4c-0.2,0.9-0.4,1.8-0.7,2.7c-0.2,0.7-0.4,1.4-0.6,2.1\r
	c-0.5,1.7-1,3.4-1.6,5.2c-0.2,0.7-0.4,1.3-0.6,1.9c-0.2,0.7-0.4,1.3-0.7,2c-0.1,0.3-0.2,0.6-0.3,0.9c-0.2,0.6-0.4,1.2-0.7,1.8\r
	c-0.3,0.8-0.6,1.6-0.9,2.3c-0.3,0.7-0.6,1.5-0.9,2.2c-0.2,0.5-0.4,1-0.6,1.5c-0.2,0.5-0.4,1.1-0.7,1.6c0,0,0,0,0,0.1\r
	c-0.5,1.1-1,2.2-1.5,3.3c-0.4,0.8-0.8,1.7-1.2,2.5c0,0.1-0.1,0.3-0.2,0.4c-0.3,0.7-0.7,1.4-1,2.1c0,0-0.1,0.1-0.1,0.1\r
	c-0.4,0.7-0.7,1.4-1.1,2.1c-0.8,1.5-1.6,3-2.4,4.4c-0.9,1.6-1.8,3.1-2.7,4.7c-0.5,0.8-1,1.6-1.5,2.4c-0.5,0.8-1,1.6-1.6,2.4\r
	c-0.3,0.5-0.7,1-1,1.5c-1,1.5-2.1,3-3.2,4.5c-0.2,0.3-0.5,0.7-0.8,1c-1.3,1.7-2.5,3.4-3.9,5c-0.3,0.4-0.6,0.8-1,1.2\r
	c-0.7,0.8-1.3,1.6-2,2.4s-1.4,1.6-2.1,2.4c-0.2,0.3-0.5,0.5-0.7,0.8c-0.7,0.8-1.3,1.5-2,2.2c-0.3,0.4-0.7,0.7-1,1.1\r
	c-0.2,0.2-0.4,0.4-0.5,0.6c-0.1,0.1-0.2,0.2-0.2,0.2c-0.7,0.8-1.5,1.5-2.2,2.3c0,0-0.1,0.1-0.1,0.1c-0.1,0.1-0.1,0.1-0.2,0.2\r
	c-0.7,0.7-1.5,1.5-2.2,2.2c-0.1,0.1-0.2,0.2-0.3,0.3c-0.4,0.4-0.8,0.8-1.2,1.1c0,0,0,0-0.1,0.1c-0.8,0.7-1.5,1.4-2.3,2.1\r
	c-0.7,0.6-1.4,1.2-2.1,1.9c-2.8,2.4-5.7,4.8-8.6,7c0,0,0,0-0.1,0.1c-1.4,1.1-2.9,2.2-4.4,3.2c0,0,0,0-0.1,0c-0.7,0.5-1.5,1-2.2,1.5\r
	c-0.5,0.4-1.1,0.7-1.7,1.1c-0.1,0-0.1,0.1-0.2,0.1c-0.3,0.2-0.5,0.4-0.8,0.5c-0.2,0.1-0.4,0.2-0.5,0.4c-0.2,0.1-0.3,0.2-0.5,0.3\r
	c-0.2,0.1-0.3,0.2-0.5,0.3c-0.2,0.2-0.5,0.3-0.7,0.4c0,0-0.1,0-0.1,0.1c-1.9,1.2-3.7,2.3-5.6,3.4c-0.3,0.2-0.6,0.4-1,0.6\r
	c0,0,0,0-0.1,0c-0.3,0.2-0.5,0.3-0.8,0.5l0.3,0.5l47.2,81.6l0.1,0.1l0,0c0.6-0.4,1.3-0.7,1.9-1.1c3.3-1.9,6.5-3.9,9.7-5.9\r
	c1-0.7,2.1-1.3,3.1-2c1.1-0.7,2.1-1.4,3.2-2.2c4.9-3.3,9.6-6.9,14.3-10.6c-9.6,7.5-19.8,14.4-30.5,20.5l-47.3-81.5\r
	c47.9-27.3,80.4-78.4,81.5-137.2h93.4V260H418.2z M416.7,260.4L416.7,260.4L416.7,260.4L416.7,260.4L416.7,260.4z M336.3,396.8\r
	c0.4-0.3,0.9-0.5,1.3-0.8C337.2,396.3,336.8,396.5,336.3,396.8l-41.1-71.1c0,0,0.1,0,0.1-0.1c6.6-3.6,12.8-8.1,18.4-13.7l-0.5-0.5\r
	c-5.6,5.8-12,10.7-19.1,14.5l0,0.1l0.1,0.2l41.1,71.2C335.7,397.2,336,397,336.3,396.8z M416.6,260.4L416.6,260.4L416.6,260.4\r
	L416.6,260.4L416.6,260.4z" data-v-fbaecaeb></path><g data-v-fbaecaeb><path class="st5" d="M121,169.9c2-3.1,4-6,6.2-9C125,163.8,123,166.8,121,169.9z M226.9,2.7c-1.4,0.2-2.8,0.3-4.2,0.5\r
		c2.6-0.3,5.2-0.6,7.9-0.9C229.4,2.4,228.1,2.5,226.9,2.7z M260.1,1L260.1,1c-0.5,0-0.9,0-1.3,0c0.3,0,0.5,0,0.8,0h0\r
		c0.1,0,0.3,0,0.4,0L260.1,1C260,1,260,1,260.1,1L260.1,1C260.1,1,260.1,1,260.1,1L260.1,1c0.4,0,0.7,0,1,0C260.8,1,260.4,1,260.1,1\r
		z M256.4,1c-1.4,0-2.7,0-4.1,0C253.7,1,255,1,256.4,1c0.4,0,0.8,0,1.1,0h1.2c-0.2,0-0.4,0-0.6,0C257.6,1,257,1,256.4,1z M262.7,1.1\r
		c-0.5,0-1,0-1.6,0c1.6,0,3.1,0.1,4.7,0.1C264.8,1.1,263.7,1.1,262.7,1.1z M277.4,1.9c2.8,0.2,5.5,0.5,8.3,0.8\r
		C282.9,2.4,280.2,2.1,277.4,1.9z M385.4,35.9l-0.4,0.7c-0.1,0-0.2-0.1-0.2-0.1L338,117.3c-23.9-14-51.7-22-81.4-22\r
		c-30.3,0-58.6,8.3-82.9,22.8l-47.3-81.8c0,0,0,0,0,0l47.2,81.8C126.5,146.4,95,198,95,256.9c0,1,0,1.9,0,2.9H1.7v0.2h93.7v-0.2\r
		c0-1.9,0-3.8,0-5.8c0,1.9,0,3.8,0,5.8c0,0.1,0,0.1,0,0.2h82v-0.1H96.7v-0.1h-1.1c-0.8-42.1,14.9-84.4,47.1-116.6\r
		c9.6-9.7,20.1-17.7,31.3-24.4l40.7,70.4c0,0,0.1,0,0.1-0.1l-2.9-5l-37.8-65.4c0,0,0,0-0.1,0h0l0,0c50.2-29.9,113.1-30.2,163.5-0.7\r
		l-0.4,0.6c0.1,0.1,0.3,0.2,0.4,0.3l-0.1,0.1c-0.1-0.1-0.2-0.1-0.3-0.2l-40.3,69.6c0.1,0.1,0.3,0.2,0.4,0.2l27.2-47l13.1-22.6\r
		l0.1-0.2l0.4-0.6l0-0.1l0-0.1l0.3-0.6l43-74.1l0.3-0.4l3.6-6.3l0.4-0.7C385.6,36,385.5,35.9,385.4,35.9z M173.9,118.7\r
		C173.9,118.6,173.9,118.6,173.9,118.7C174,118.7,173.9,118.7,173.9,118.7c-0.3,0.3-0.6,0.5-1,0.6\r
		C173.3,119.1,173.5,118.9,173.9,118.7z M96.2,241.3c-0.3,3.5-0.6,6.9-0.7,10.4C95.6,248.2,95.8,244.7,96.2,241.3z M105.6,200.6\r
		c-0.4,1-0.8,2.1-1.1,3.1c-0.2,0.5-0.4,1-0.6,1.6c0.6-1.8,1.3-3.5,1.9-5.3L105.6,200.6z M311.7,201.1c0,0-0.1-0.1-0.1-0.1\r
		c0,0-0.1,0-0.1-0.1c-2.1-2.1-4.3-4.1-6.6-6c-0.4-0.3-0.8-0.6-1.2-0.9c-0.4-0.3-0.8-0.6-1.2-0.9c-0.7-0.5-1.3-1-2-1.4\r
		c-1.3-0.9-2.6-1.8-4-2.6c0,0-0.1,0-0.1-0.1c-12.4-7.5-26.5-11.3-40.6-11.3c0,0,0,0,0,0h0c0,0,0,0,0,0c0,0,0,0-0.1,0\r
		c-0.1,0-0.1,0-0.2,0c-13.5,0-26.9,3.4-39,10.3c0,0,0,0-0.1,0c0,0-0.1,0-0.1,0.1c-0.2,0.1-0.3,0.2-0.5,0.3c-0.4,0.2-0.8,0.5-1.2,0.7\r
		c0,0,0,0,0,0c0,0-0.1,0-0.1,0.1l0,0c-2.3,1.4-4.5,2.9-6.6,4.6c0.9-0.7,1.9-1.4,2.9-2.1c-1.2,0.9-2.4,1.8-3.6,2.7\r
		c-0.2,0.2-0.5,0.4-0.7,0.5c-0.5,0.4-1,0.8-1.5,1.3c-0.4,0.3-0.8,0.7-1.2,1c-0.1,0-0.1,0.1-0.2,0.1c0,0-0.1,0.1-0.1,0.1\r
		c0,0-0.1,0.1-0.1,0.1c-0.1,0.1-0.1,0.1-0.2,0.2c0,0,0,0,0,0.1c-0.1,0.1-0.2,0.2-0.3,0.3c0,0-0.1,0.1-0.1,0.1\r
		c-0.1,0.1-0.3,0.3-0.4,0.4c-0.1,0.1-0.2,0.2-0.3,0.3c0,0-0.1,0-0.1,0.1l0,0c-0.5,0.5-1.1,1-1.6,1.6l0.1,0.2l0,0\r
		c-0.2,0.2-0.3,0.3-0.5,0.5c0,0,0,0,0,0c-10.9,11.2-17.8,24.8-20.8,39c-0.1,0.5-0.2,1-0.3,1.5c-0.1,0.5-0.2,1.1-0.3,1.6\r
		c0,0.1,0,0.1,0,0.2c-0.2,1-0.3,2.1-0.5,3.1c-0.2,1.3-0.3,2.7-0.4,4c0,0.3,0,0.7-0.1,1c0,0.4-0.1,0.7-0.1,1.1c0,0.1,0,0.3,0,0.4\r
		c0,0.2,0,0.4,0,0.6c0,0.2,0,0.3,0,0.5c0,0.2,0,0.3,0,0.5c0,1.7,0,3.5,0.1,5.2c0,0.1,0,0.1,0,0.2c0.2,3.4,0.5,6.7,1.1,10\r
		c0.1,0.7,0.2,1.3,0.4,2c0.1,0.7,0.3,1.3,0.4,2c0,0,0,0,0,0c0.2,0.6,0.3,1.3,0.5,1.9c0.2,0.6,0.3,1.3,0.5,2c0.2,0.7,0.4,1.3,0.6,2\r
		c0.5,1.6,1.1,3.2,1.7,4.8c0.2,0.5,0.4,1.1,0.6,1.6c1.7,4.2,3.8,8.3,6.3,12.2c0.2,0.3,0.4,0.6,0.6,1c0.2,0.3,0.4,0.6,0.6,0.9\r
		c0,0,0,0,0,0c0,0,0,0,0,0c0.1,0.1,0.2,0.3,0.3,0.4c0,0.1,0.1,0.2,0.2,0.2c0.2,0.3,0.4,0.6,0.7,0.9c1,1.4,2,2.7,3.1,4.1\r
		c0,0,0.1,0,0.1,0.1c0.9,1,1.7,2.1,2.6,3.1c0.9,1,1.8,1.9,2.7,2.8l0.1,0.1c0,0.1,0.1,0.1,0.2,0.2l0,0c0,0,0.1,0,0.1,0.1l0,0\r
		c0,0,0,0,0,0c0,0,0,0,0,0l25.8-25.8l0,0c0,0,0,0,0-0.1c-0.1-0.1-0.1-0.1-0.2-0.2c0,0,0,0,0,0l-1.1-1.2c-0.4-0.4-0.7-0.8-1-1.2\r
		c-0.3-0.3-0.6-0.7-0.8-1c0,0,0,0,0,0c0,0,0,0,0,0c0-0.1-0.1-0.1-0.1-0.2c-3.2-4.1-5.5-8.6-6.9-13.4c-0.1-0.3-0.2-0.6-0.3-1\r
		c-0.2-0.7-0.4-1.3-0.5-2c-0.1-0.3-0.2-0.7-0.2-1c-0.1-0.3-0.1-0.7-0.2-1c-0.1-0.3-0.1-0.7-0.2-1c0-0.3-0.1-0.5-0.1-0.8l-0.3-2.5\r
		c0-0.3,0-0.7-0.1-1l0-2c0-0.7,0-1.3,0-2c0-0.3,0-0.7,0.1-1c0-0.1,0-0.1,0-0.2c0-0.4,0.1-0.7,0.1-1.1c0-0.4,0.1-0.8,0.2-1.3\r
		c0-0.3,0.1-0.5,0.1-0.8c0-0.3,0.1-0.7,0.2-1c0.1-0.3,0.1-0.7,0.2-1c0.1-0.4,0.2-0.7,0.2-1.1c0.1-0.3,0.1-0.6,0.2-1\r
		c0.1-0.3,0.2-0.7,0.3-1c0.1-0.3,0.2-0.7,0.3-1c1.9-6.3,5.4-12.3,10.4-17.4l0.3-0.3l-0.1-0.2l-0.2-0.1l0,0c1.9-1.8,3.8-3.3,5.9-4.6\r
		c9.2-6,20.2-7.9,30.6-5.9c0.3,0,0.6,0.1,0.9,0.2c0,0,0.1,0,0.1,0c4.6,1,9,2.7,13.1,5.3c2.6,1.6,5.1,3.6,7.3,5.9\r
		c0.1,0.1,0.2,0.2,0.3,0.3l26.5-26.5c0,0-0.1-0.1-0.1-0.1C311.9,201.2,311.8,201.2,311.7,201.1z M200,201C200,201,200,201,200,201\r
		L200,201C200.1,201,200.1,201,200,201L200,201z M17,166.4c1.1-2.9,2.2-5.7,3.4-8.5C19.2,160.7,18,163.6,17,166.4z M5.1,208.1\r
		c-0.1,0.7-0.3,1.4-0.4,2c-0.2,1.2-0.4,2.4-0.7,3.6c-0.2,1.2-0.4,2.4-0.6,3.6c-0.2,1-0.3,2-0.5,3c-0.1,0.6-0.2,1.1-0.2,1.7\r
		c-1.7,12.6-2.5,25.2-2.4,37.9h0.1c0-1.1,0-2.3,0-3.4c0-1.1,0-2.1,0-3.2s0-2.1,0-3.1l0,0c0-2.1,0.1-4.2,0.2-6.3\r
		c0-0.8,0.1-1.6,0.1-2.5c0.1-1,0.1-2,0.2-3.1c0-0.8,0.1-1.5,0.2-2.3c0-0.3,0-0.6,0.1-0.9c0-0.4,0.1-0.7,0.1-1.1v0c0,0,0,0,0,0\r
		c0,0,0,0,0,0c0,0,0,0,0-0.1c0,0,0,0,0-0.1c0-0.3,0.1-0.6,0.1-0.9c0.1-1,0.2-2,0.3-3.1c0.1-0.9,0.2-1.8,0.3-2.8c0-0.1,0-0.3,0-0.4\r
		c0-0.1,0-0.2,0-0.3c0.2-2,0.5-4.1,0.8-6.1c0.2-1.4,0.4-2.8,0.6-4.2c0.2-1,0.3-2,0.5-2.9c0,0,0-0.1,0-0.1l0.5-3\r
		c0.2-1,0.4-2.1,0.6-3.1c0.2-0.8,0.3-1.5,0.5-2.3c0.2-1,0.4-1.9,0.6-2.9C5.9,204,5.5,206.1,5.1,208.1z" data-v-fbaecaeb></path></g>`,25),f3=kt(`<polyline class="st6" points="173.6,118.2 173.9,118.7 173.9,118.7 174,118.7 174,118.8 " data-v-fbaecaeb></polyline><line class="st6" x1="214.7" y1="189.3" x2="214.7" y2="189.2" data-v-fbaecaeb></line><polyline class="st6" points="214.7,189.3 214.7,189.4 214.9,189.7 215.1,190 " data-v-fbaecaeb></polyline><path class="st6" d="M335.4,256.6c0,0.3,0,0.6,0,1c0,0.1,0,0.2,0,0.3c0,0.4,0,0.7,0,1.1c0,0.4,0,0.7,0,1.1c-0.2,3.5-0.5,7-1.1,10.4\r
	c-0.1,0.6-0.2,1.2-0.3,1.8c-0.1,0.6-0.2,1.2-0.4,1.7c-0.1,0.6-0.3,1.2-0.4,1.8c-0.1,0.5-0.3,1.1-0.4,1.6c0,0.1,0,0.1,0,0.1\r
	c-0.2,0.6-0.3,1.1-0.5,1.7c-3.7,12.3-10.2,23.2-18.9,32.2c-5.6,5.8-12,10.7-19.1,14.5c0,0,0,0,0,0c-0.3,0.1-0.5,0.3-0.8,0.4\r
	c-1.2,0.6-2.4,1.2-3.6,1.8c-0.1,0-0.2,0.1-0.3,0.1c-0.3,0.1-0.6,0.3-1,0.4c-1.7,0.8-3.5,1.5-5.2,2.1c-8.3,3-17.3,4.6-26.6,4.6\r
	c-14,0-27.1-3.6-38.5-10c-6.3-3.5-12-7.8-17-12.8c-4.7-4.7-8.9-10-12.3-15.7c0,0,0,0,0-0.1c0,0,0,0,0,0c-6.1-10.3-10-22.1-10.8-34.7\r
	c0-0.6-0.1-1.3-0.1-1.9c0,0,0,0,0-0.1c0-0.1,0-0.1,0-0.2c0-0.4,0-0.8,0-1.3c0-0.7,0-1.3,0-2v-0.2c0-0.6,0-1.1,0-1.7\r
	c0-0.2,0-0.3,0-0.5c0-0.4,0-0.8,0-1.2c0-0.1,0-0.3,0-0.4c0-0.4,0-0.7,0.1-1.1c0-0.3,0-0.7,0.1-1c0.1-1.3,0.2-2.7,0.4-4\r
	c0.1-1,0.3-2.1,0.5-3.1c0-0.1,0-0.1,0-0.2c0.1-0.5,0.2-1.1,0.3-1.6c3-15.5,10.5-29.5,21.2-40.3c0.2-0.2,0.3-0.4,0.5-0.6\r
	c0.1,0,0.1-0.1,0.2-0.2c4.2-4.1,8.8-7.8,13.8-11c9.9-6.2,21.4-10.3,33.6-11.5h0c0.2,0,0.5,0,0.7-0.1c0.1,0,0.2,0,0.3,0\r
	c2-0.2,4-0.3,6.1-0.3c0,0,0.1,0,0.2,0c0,0,0,0,0.1,0c0,0,0,0,0,0h0c0,0,0,0,0,0c0.2,0,0.5,0,0.7,0c14.6,0,28.4,4,40.1,11\r
	c1.6,1,3.3,2,4.8,3.1c0,0,0.1,0.1,0.1,0.1c3.9,2.7,7.5,5.8,10.9,9.1c11.9,12,20,27.8,22.3,45.5c0.2,1.3,0.3,2.6,0.4,4\r
	c0,0.4,0.1,0.9,0.1,1.3c0,0.4,0,0.8,0.1,1.2c0,0.3,0,0.6,0,0.8c0,0.3,0,0.6,0,0.9c0,0.2,0,0.3,0,0.5\r
	C335.4,255.7,335.4,256.1,335.4,256.6z" data-v-fbaecaeb></path><path class="st19" d="M1.7,260H95h0.4h0.1h0.1h81.2c0,0,0,0,0,0.1c0,0,0,0.1,0,0.1" data-v-fbaecaeb></path><path class="st19" d="M182.8,285.2c1.6,3.7,3.5,7.6,6,11.6c0,0,0,0,0,0c0.6,0.9,1.2,1.9,1.8,2.8c0.2,0.3,0.4,0.6,0.6,0.9\r
	c0,0,0,0,0,0c0.1,0.1,0.2,0.3,0.3,0.4c0,0.1,0.1,0.2,0.2,0.2c0.2,0.3,0.4,0.6,0.7,0.9c2.4,3.4,5.3,6.7,8.5,10\r
	c0.1,0.1,0.2,0.2,0.3,0.3c0,0,0.1,0.1,0.1,0.1c0,0,0,0,0.1,0l0.4-0.5l25.3-25.3l0,0l0,0" data-v-fbaecaeb></path><line class="st19" x1="0.5" y1="260" x2="0.5" y2="260" data-v-fbaecaeb></line><polygon class="st2" points="311.1,312.7 309.7,312.7 309.7,311.2 " data-v-fbaecaeb></polygon><polyline class="st4" points="338.5,117.6 338.1,118.2 338.1,118.3 338.1,118.3 338.1,118.3 337.7,118.9 337.6,119.1 330.5,131.5 \r
	" data-v-fbaecaeb></polyline><line class="st4" x1="385.7" y1="36" x2="385.3" y2="36.7" data-v-fbaecaeb></line><line class="st19" x1="385.7" y1="35.4" x2="385.4" y2="35.9" data-v-fbaecaeb></line><path class="st19" d="M285.8,227.4l0.1-0.1l0.1-0.1l24.1-23.9l0.1-0.1h0l1.6-1.6l0.1-0.1l0.1-0.1l0.1-0.1c0,0,0,0,0,0\r
	c0,0,0-0.1-0.1-0.1c0,0-0.1-0.1-0.1-0.1c0,0,0,0,0,0c-0.8-0.9-3.9-4.3-10.3-9.1c0,0-0.1-0.1-0.1-0.1c-1.1-0.8-2.3-1.7-3.6-2.6" data-v-fbaecaeb></path><polyline class="st19" points="385,36.5 338.4,117.5 338,118.2 338,118.2 337.6,118.9 " data-v-fbaecaeb></polyline><polyline class="st19" points="337.5,119 324.5,141.6 320.8,148 320.6,148.4 307.5,171.1 297.3,188.8 " data-v-fbaecaeb></polyline><path class="st19" d="M286.4,286.4l25.5,25.8c0,0-8.5,9.1-17.9,13.6l88.9,153.8" data-v-fbaecaeb></path>`,15),m3={class:"tag LAD"},v3={class:"bar-container"},y3=h3(()=>u("div",{class:"values"},[u("h5",{class:"end"},"100.00"),u("h5",{class:"start"},"0.00")],-1));function w3(e,t,n,s,o,a){const i=M("SegmentInput");return D(),x("div",g3,[(D(),x("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 513.2 520","xml:space":"preserve",style:j({width:o.radius*2+"px",height:o.radius*2+"px"})},[p3,u("path",{class:$(["AHA2 segment",{clicked:o.targetSegment==="AHA2"}]),ref:"AHA2",onMousedown:t[0]||(t[0]=r=>a.handleClickSegment("AHA2")),d:`M95,256.9c0,1,0,1.9,0,2.9H1.7v0.2H0.5c0-1.1,0-2.3,0-3.4c0-4.2,0.1-8.4,0.3-12.6c0-0.8,0.1-1.6,0.1-2.5\r
	c0.1-1,0.1-2,0.2-3.1c1.8-24.5,7-48.8,15.8-72.1c1.1-2.9,2.2-5.7,3.4-8.5c0-0.1,0-0.1,0.1-0.2c0.4-0.9,0.8-1.9,1.2-2.9\r
	c2.1-4.8,4.3-9.5,6.7-14.2c1.9-3.7,3.9-7.4,6-11.1c1.5-2.7,3.2-5.4,4.8-8.1c8.1-13,17.5-25.4,28.1-37.1c1.1-1.3,2.3-2.5,3.5-3.8\r
	c1.5-1.6,3.1-3.2,4.6-4.7c7.8-7.8,16-15,24.5-21.6c8.5-6.6,17.4-12.6,26.5-18l47.2,81.8C126.5,146.4,95,198,95,256.9z`},null,34),u("path",{class:$(["AHA1 segment",{clicked:o.targetSegment==="AHA1"}]),ref:"AHA1",onMousedown:t[1]||(t[1]=r=>a.handleClickSegment("AHA1")),d:`M385.4,35.9l-0.4,0.7c-0.1,0-0.2-0.1-0.2-0.1L338,117.3c-23.9-14-51.7-22-81.4-22c-30.3,0-58.6,8.3-82.9,22.8\r
	l-47.3-81.8c20.6-12.1,42.5-21.1,65-27c0.1,0,0.2,0,0.3-0.1c0.9-0.2,1.8-0.5,2.7-0.7c1.7-0.4,3.4-0.8,5.1-1.2\r
	c0.4-0.1,0.8-0.2,1.3-0.3c0.6-0.1,1.2-0.3,1.8-0.4c1.3-0.3,2.5-0.5,3.8-0.8c1-0.2,2.1-0.4,3.1-0.6c0.5-0.1,1.1-0.2,1.7-0.3\r
	c1.1-0.2,2.2-0.4,3.3-0.6c2.8-0.5,5.6-0.9,8.4-1.3c2.6-0.3,5.2-0.6,7.9-0.9c0.3,0,0.7-0.1,1-0.1c1.2-0.1,2.5-0.2,3.7-0.3\r
	c1.3-0.1,2.6-0.2,3.9-0.3c0.3,0,0.7,0,1-0.1c1-0.1,2-0.1,3-0.2c0.3,0,0.5,0,0.8,0c1.3-0.1,2.6-0.1,3.9-0.2c1.2,0,2.5-0.1,3.7-0.1\r
	c0.2,0,0.4,0,0.6,0c1.4,0,2.7,0,4.1,0c4.2,0,8.4,0.1,12.6,0.3c1.4,0.1,2.8,0.2,4.2,0.2c1.4,0.1,2.8,0.2,4.2,0.3h0\r
	c2.8,0.2,5.5,0.5,8.3,0.8c1.4,0.2,2.8,0.3,4.2,0.5c1.4,0.2,2.8,0.4,4.2,0.6c0.9,0.1,1.7,0.3,2.6,0.4c0.8,0.1,1.6,0.3,2.5,0.4\r
	c1.2,0.2,2.4,0.4,3.6,0.6c1.3,0.2,2.5,0.5,3.8,0.7c0.9,0.2,1.7,0.3,2.6,0.5c0,0,0.1,0,0.1,0c1,0.2,2.1,0.4,3.1,0.7\r
	c0.2,0,0.4,0.1,0.6,0.1c0.9,0.2,1.9,0.4,2.8,0.6c0.4,0.1,0.9,0.2,1.3,0.3c0.8,0.2,1.6,0.4,2.5,0.6c1.2,0.3,2.4,0.6,3.5,0.9\r
	c2.7,0.7,5.4,1.5,8.1,2.3l4.1,1.3c0.8,0.3,1.7,0.5,2.5,0.8c0.8,0.3,1.7,0.6,2.5,0.9c1.7,0.6,3.3,1.2,5,1.8c0.8,0.3,1.7,0.6,2.5,0.9\r
	c0.8,0.3,1.6,0.6,2.5,1c0.7,0.3,1.4,0.5,2.1,0.8c1,0.4,1.9,0.8,2.9,1.2c0,0,0,0,0,0c3.4,1.4,6.8,3,10.2,4.5c1.1,0.5,2.3,1.1,3.4,1.6\r
	c1.1,0.6,2.2,1.1,3.4,1.7c1.1,0.6,2.2,1.1,3.3,1.7s2.2,1.2,3.3,1.8c1.1,0.6,2.2,1.2,3.3,1.8L385.4,35.9z`},null,34),u("path",{class:$(["AHA7 segment",{clicked:o.targetSegment==="AHA7"}]),ref:"AHA7",onMousedown:t[2]||(t[2]=r=>a.handleClickSegment("AHA7")),d:`M337.6,118.9l-0.1,0.1c-0.1-0.1-0.2-0.1-0.3-0.2l-40.3,69.6c-25.2-15.1-57-14.8-82.1,0.7c0,0,0,0,0,0l-2.9-5\r
	l-37.8-65.4c0,0,0,0-0.1,0h0l0,0c50.2-29.9,113.1-30.2,163.5-0.7l-0.4,0.6C337.3,118.7,337.5,118.8,337.6,118.9z`},null,34),u("path",{class:$(["AHA12 segment",{clicked:o.targetSegment==="AHA12"}]),ref:"AHA12",onMousedown:t[3]||(t[3]=r=>a.handleClickSegment("AHA12")),d:`M417.4,259.9h-82c0,0.1,0,0.1,0,0.2h-0.1c0-0.4,0-0.7,0-1.1c0-0.4,0-0.8,0-1.1c0-0.1,0-0.2,0-0.3\r
	c0-0.3,0-0.7,0-1c0-0.5,0-0.9,0-1.4c0-0.2,0-0.3,0-0.5c0-0.3,0-0.6,0-0.9c0-0.3,0-0.6,0-0.8c0-0.4,0-0.8-0.1-1.2\r
	c0-0.4,0-0.8-0.1-1.3c-0.1-1.3-0.2-2.7-0.4-4c-2.1-16.7-9.5-32.8-22.1-45.6l0,0c-0.1-0.1-0.2-0.3-0.4-0.4\r
	c-4.4-4.4-9.1-8.1-14.2-11.2c0,0-0.1,0-0.1-0.1c-0.2-0.1-0.4-0.3-0.6-0.4l33.2-57.3l7.2-12.4c11.3,6.8,22,15,31.8,24.6\r
	c15.7,15.7,27.4,33.7,35.3,53c-7.8-19.3-19.6-37.4-35.3-53.1c-9.7-9.7-20.4-17.9-31.7-24.7l0.3-0.6h0c11.5,6.8,22.2,15.1,32.1,24.9\r
	c27.1,27,42.5,61.3,46.3,96.5c0.1,0.6,0.1,1.3,0.2,1.9c0.1,0.6,0.1,1.3,0.2,1.9l0,0.4c0.1,0.7,0.1,1.4,0.2,2.2\r
	c0,0.5,0.1,0.9,0.1,1.4c0,0.6,0.1,1.2,0.1,1.8C417.4,252.8,417.5,256.4,417.4,259.9z`},null,34),u("path",{class:$(["AHA11 segment",{clicked:o.targetSegment==="AHA11"}]),ref:"AHA11",onMousedown:t[4]||(t[4]=r=>a.handleClickSegment("AHA11")),d:`M335.4,260.1c-0.2,3.5-0.6,7-1.2,10.4c-0.1,0.6-0.2,1.2-0.3,1.8c-0.1,0.6-0.2,1.2-0.4,1.7\r
	c-0.1,0.6-0.3,1.2-0.4,1.8c-0.1,0.5-0.3,1.1-0.4,1.6c0,0.1,0,0.1,0,0.1c-0.2,0.6-0.3,1.1-0.5,1.7c-3.7,12.3-10.2,23.2-18.9,32.2\r
	l0.5,0.5c-5.6,5.6-11.8,10.1-18.4,13.7c0,0-0.1,0-0.1,0.1l41.1,71.1c0.4-0.2,0.9-0.5,1.3-0.7c0,0,0,0,0.1,0c0,0,0,0,0,0\r
	c3.9-2.3,7.7-4.8,11.5-7.5c-1.8,1.3-3.6,2.6-5.5,3.8c0.2-0.1,0.4-0.2,0.5-0.4c0.3-0.2,0.5-0.3,0.8-0.5c0.1,0,0.1-0.1,0.2-0.1\r
	c0.6-0.4,1.1-0.7,1.7-1.1c0.7-0.5,1.5-1,2.2-1.5c0,0,0,0,0.1,0c1.5-1,2.9-2.1,4.4-3.2c0,0,0,0,0.1-0.1c2.9-2.2,5.8-4.6,8.6-7\r
	c0.7-0.6,1.4-1.2,2.1-1.9c0.8-0.7,1.5-1.4,2.3-2.1c0,0,0-0.1,0.1-0.1c0.4-0.4,0.8-0.7,1.2-1.1c0.1-0.1,0.2-0.2,0.3-0.3\r
	c0.7-0.7,1.5-1.4,2.2-2.2c0.1-0.1,0.1-0.1,0.2-0.2c0,0,0.1-0.1,0.1-0.1c0.7-0.7,1.5-1.5,2.2-2.3c0.1-0.1,0.2-0.2,0.2-0.2\r
	c0.2-0.2,0.4-0.4,0.5-0.6c0.3-0.4,0.7-0.7,1-1.1c0.7-0.7,1.4-1.5,2-2.2c0.2-0.3,0.5-0.5,0.7-0.8c0.7-0.8,1.4-1.6,2.1-2.4\r
	s1.3-1.6,2-2.4c0.3-0.4,0.7-0.8,1-1.2c1.3-1.7,2.6-3.3,3.9-5c0.3-0.3,0.5-0.7,0.8-1c1.1-1.5,2.2-3,3.2-4.5c0.3-0.5,0.7-1,1-1.5\r
	c0.5-0.8,1.1-1.6,1.6-2.4c0.5-0.8,1-1.6,1.5-2.4c0.9-1.5,1.8-3.1,2.7-4.7c13.2-23.5,20-49.5,20.5-75.7H335.4z M416.5,260.5\r
	L416.5,260.5l0.2-0.1v0.1H416.5z`},null,34),u("path",{class:$(["AHA10 segment",{clicked:o.targetSegment==="AHA10"}]),ref:"AHA10",onMousedown:t[5]||(t[5]=r=>a.handleClickSegment("AHA10")),d:`M334.5,397.7c-48.9,27.2-109,27-157.6-0.7l22.7-39.3l18.5-32c0,0-0.1-0.1-0.1-0.1l0.1-0.1\r
	c11.4,6.4,24.5,10,38.5,10c9.3,0,18.3-1.6,26.6-4.6c3.5-1.1,6.9-2.6,10.2-4.2L334.5,397.7z`},null,34),u("path",{class:$(["AHA9 segment",{clicked:o.targetSegment==="AHA9"}]),ref:"AHA9",onMousedown:t[6]||(t[6]=r=>a.handleClickSegment("AHA9")),d:`M176.8,396.9c0,0,0.1,0,0.1,0.1l0,0.1C176.9,397,176.8,397,176.8,396.9c-12.2-6.9-23.8-15.5-34.2-26\r
	c-27-27-42.4-61.2-46.2-96.4c-0.2-2.3-0.4-4.5-0.6-6.8c0-0.7-0.1-1.4-0.1-2.1c0-0.7-0.1-1.4-0.1-2.2c0-0.5,0-1,0-1.5\r
	c0-0.6,0-1.1,0-1.7h81.3c0,1.5,0.5,11.6,5.8,24.4c0,0.1,0.1,0.3,0.1,0.4c0,0.1,0,0.1,0.1,0.2c3.9,9.9,9.8,19.2,17.8,27.2\r
	c0.1,0.1,0.3,0.2,0.4,0.4c5.2,5.1,10.9,9.3,17.1,12.7L176.8,396.9z`},null,34),u("path",{class:$(["AHA3 segment",{clicked:o.targetSegment==="AHA3"}]),ref:"AHA3",onMousedown:t[7]||(t[7]=r=>a.handleClickSegment("AHA3")),d:`M176.6,397.3l-47,81.2c-9.3-5.3-18.3-11.3-27-18c-9-6.9-17.6-14.4-25.9-22.6c-49.1-49.1-74.1-113.3-75-177.8\r
	H95C96.2,318.9,128.7,370,176.6,397.3z`},null,34),u("path",{class:$(["AHA4 segment",{clicked:o.targetSegment==="AHA4"}]),ref:"AHA4",onMousedown:t[8]||(t[8]=r=>a.handleClickSegment("AHA4")),d:`M382,479.9c-37.1,20.9-79.8,32.8-125.4,32.8c-5.5,0-11-0.2-16.5-0.5c-1.1-0.1-2.2-0.1-3.3-0.2\r
	c-36.9-3-73.2-14-106.2-33l-0.1,0.1c-0.3-0.2-0.5-0.3-0.8-0.5l46.9-81.2c23.6,13.4,50.8,21.1,79.9,21.1c28.3,0,55-7.3,78.2-20.1\r
	L382,479.9z`},null,34),u("path",{class:$(["AHA5 segment",{clicked:o.targetSegment==="AHA5"}]),ref:"AHA5",onMousedown:t[9]||(t[9]=r=>a.handleClickSegment("AHA5")),d:`M511.6,260.1v0.4c-0.8,64.5-25.7,128.8-74.9,178c-6.2,6.1-12.6,11.9-19.2,17.3c-0.9,0.8-1.9,1.5-2.8,2.3\r
	c-0.1,0.1-0.2,0.1-0.3,0.2c-9.6,7.5-19.8,14.4-30.5,20.5l-47.3-81.5c47.9-27.3,80.4-78.4,81.5-137.2H511.6z`},null,34),u("path",{class:$(["AHA6 segment",{clicked:o.targetSegment==="AHA6"}]),ref:"AHA6",onMousedown:t[10]||(t[10]=r=>a.handleClickSegment("AHA6")),d:`M418.2,260c0-1,0-2.1,0-3.1c0-59.4-32-111.2-79.7-139.3L381.7,43l3.6-6.3c18.3,10.7,35.5,24,51.3,39.7\r
	c50.8,50.7,75.7,117.3,75,183.6H418.2z`},null,34),u("path",{class:$(["AHA8 segment",{clicked:o.targetSegment==="AHA8"}]),ref:"AHA8",onMousedown:t[11]||(t[11]=r=>a.handleClickSegment("AHA8")),d:`M214.7,189.3c-2.3,1.4-4.5,2.9-6.6,4.6c-0.3,0.2-0.6,0.4-0.9,0.7c0,0,0,0,0,0c-2.5,2-4.9,4-7.1,6.3l0,0\r
	c0,0,0,0,0,0l0,0c-0.3,0.3-0.6,0.6-0.9,0.9c-15.4,16.1-22.6,37.2-21.7,57.9H96.7v-0.1h-1.1c-0.8-42.1,14.9-84.4,47.1-116.6\r
	c9.6-9.7,20.1-17.7,31.3-24.4L214.7,189.3c-0.2,0.1-0.3,0.2-0.5,0.3C214.3,189.5,214.5,189.4,214.7,189.3L214.7,189.3z`},null,34),f3],4)),u("div",m3,[w(i,{segment:o.targetSegment,editable:n.editable,onUpdate:a.handleSegmentUpdate,onOff:t[12]||(t[12]=r=>{o.targetSegment=""})},null,8,["segment","editable","onUpdate"])]),u("div",v3,[y3,u("div",{class:"color-bar",style:j(a.colorBarStyle)},null,4)])],512)}const S3=A(u3,[["render",w3],["__scopeId","data-v-fbaecaeb"]]);const _3={props:{editable:{type:Boolean},id:{type:String},bindValue:{type:String}},data(){return{selectedDate:"",reportStore:xe()}},mounted(){if(this.reportStore.report[this.id]){const e=this.reportStore.report[this.id];this.selectedDate=this.formatDateToInput(e)||null}},methods:{updateProp(e){this.reportStore.report[this.id]=this.formattedDate,this.bindValue&&(this.reportStore.report[this.bindValue]=this.calculateAge(this.selectedDate)||0)},calculateAge(e){const t=new Date,n=new Date(e);if(isNaN(n))return;let s=t.getFullYear()-n.getFullYear();const o=t.getMonth()-n.getMonth();return(o<0||o===0&&t.getDate()<n.getDate())&&(s-=1),s},formatDateToInput(e){const t={JAN:"01",FEB:"02",MAR:"03",APR:"04",MAY:"05",JUN:"06",JUL:"07",AUG:"08",SEP:"09",OCT:"10",NOV:"11",DEC:"12"},n=e.split("-");if(n.length!==3)return null;const s=n[0],o=t[n[1]],a=n[2];return!s||!o||!a?null:`${a}-${o}-${s}`}},computed:{formattedDate(){if(this.selectedDate){const e=this.selectedDate.split("-"),t=e[0],n=e[1];return`${e[2]}-${["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"][parseInt(n)-1]}-${t}`}return"DD-Mon-YYYY"}}},C3={key:1,class:"date"};function b3(e,t,n,s,o,a){return n.editable?Ue((D(),x("input",{key:0,onInput:t[0]||(t[0]=(...i)=>a.updateProp&&a.updateProp(...i)),type:"date",name:"dateofbirth",id:"dateofbirth",class:"date-picker","onUpdate:modelValue":t[1]||(t[1]=i=>o.selectedDate=i)},null,544)),[[mn,o.selectedDate]]):(D(),x("p",C3,F(a.formattedDate),1))}const D3=A(_3,[["render",b3],["__scopeId","data-v-8ee2f6fd"]]);const I3={data(){return{active:!1,addingNew:!1,reportStore:xe()}},mounted(){this.loadArray()},props:{id:{type:String},editable:{type:Boolean}},methods:{handleClickedOption(e){this.currentMarker=e,this.reportStore.report[this.id]=e,this.active=!1},handleToggleContainer(){this.active=!this.active,this.addingNew=!1},handleAddNew(e){this.addingNew=!this.addingNew,setTimeout(()=>{this.$refs.newInput.focus()},100),e.preventDefault()},addNew(){const e=this.$refs.newInput.value;e&&(this.reportStore.report.readers.push(e),this.reportStore.report[this.id]=e,this.active=!1,this.addingNew=!1,this.saveArray())},handleKeyDown(e){e.key==="Enter"&&this.addNew()},loadArray(){const e=localStorage.getItem("readers");e&&(this.reportStore.report.readers=JSON.parse(e))},saveArray(){const e=this.reportStore.report.readers;localStorage.setItem("readers",JSON.stringify(e))}}},di=e=>(oe("data-v-a213a69e"),e=e(),ae(),e),T3={key:0,class:"options"},x3=["onClick"],L3={class:"option-text"},R3={class:"option add-new"},k3=di(()=>u("i",{class:"fa-solid fa-plus"},null,-1)),M3=di(()=>u("h5",null,"Add New",-1)),E3=[k3,M3],P3={class:"new-reader"},O3={key:1,class:"no-edit"};function A3(e,t,n,s,o,a){return n.editable?(D(),x("div",{key:0,class:$(["dropdown-container",{active:o.active}]),onKeydown:t[5]||(t[5]=(...i)=>a.handleKeyDown&&a.handleKeyDown(...i))},[u("div",{class:"selected",onClick:t[0]||(t[0]=(...i)=>a.handleToggleContainer&&a.handleToggleContainer(...i))},[u("h5",null,F(o.reportStore.report[n.id]),1),u("i",{class:$(["fa-solid fa-caret-down",{flipped:o.active}])},null,2)]),w(_e,{name:"slide-fade"},{default:L(()=>[o.active?(D(),x("div",T3,[(D(!0),x(ne,null,fe(o.reportStore.report.readers,(i,r)=>(D(),x("div",{class:"option",key:r,onClick:l=>a.handleClickedOption(i),onKeydown:t[1]||(t[1]=(...l)=>a.handleKeyDown&&a.handleKeyDown(...l))},[u("h5",L3,F(i),1)],40,x3))),128)),u("div",R3,[Ue(u("div",{class:"add-new-placeholder",onClick:t[2]||(t[2]=(...i)=>a.handleAddNew&&a.handleAddNew(...i))},E3,512),[[Ht,!o.addingNew]]),Ue(u("div",P3,[u("input",{type:"text",ref:"newInput",class:"new-reader-input",onKeydown:t[3]||(t[3]=Se((...i)=>a.handleKeyDown&&a.handleKeyDown(...i),["stop"])),maxlength:"25"},null,544),u("i",{class:"fa-solid fa-circle-plus add-button",onClick:t[4]||(t[4]=(...i)=>a.addNew&&a.addNew(...i))})],512),[[Ht,o.addingNew]])])])):z("",!0)]),_:1})],34)):(D(),x("h5",O3,F(o.reportStore.report[n.id]),1))}const B3=A(I3,[["render",A3],["__scopeId","data-v-a213a69e"]]);const V3={props:{dragging:{type:Boolean}},data(){return{hovering:!1,reportStore:xe()}},methods:{handleDragOver(e){e.preventDefault(),this.hovering=!0},handleDragLeave(e){e.preventDefault(),this.hovering=!1},async handleImageDrop(e){this.hovering=!1,e.preventDefault();const t=e.dataTransfer.files[0];(await this.parseExcelFile(t)).forEach(s=>{const o=`AHA${s.Segment}`,a=s.Value;this.reportStore.report[o]=a})},parseExcelFile(e){const t=require("xlsx");return new Promise((n,s)=>{const o=new FileReader;o.onload=a=>{const i=a.target.result,r=t.read(i,{type:"array"}),l=r.SheetNames[0],c=r.Sheets[l],d=t.utils.sheet_to_row_object_array(c);n(d)},o.onerror=a=>{s(a)},o.readAsArrayBuffer(e)})}}},ui=e=>(oe("data-v-220edba0"),e=e(),ae(),e),$3={class:"upload-text"},F3=ui(()=>u("h4",{style:{width:"180px","text-align":"center"}}," Drop Excel File Here to Update Values ",-1)),N3=ui(()=>u("i",{class:"fa-solid fa-file-arrow-down fa-2xl"},null,-1));function H3(e,t,n,s,o,a){return D(),x("div",{class:$(["container",{hover:o.hovering,hidden:!n.dragging}]),onDragenter:t[1]||(t[1]=(...i)=>a.handleDragOver&&a.handleDragOver(...i)),onDragover:t[2]||(t[2]=(...i)=>a.handleDragOver&&a.handleDragOver(...i)),onDragleave:t[3]||(t[3]=(...i)=>a.handleDragLeave&&a.handleDragLeave(...i)),onDrop:t[4]||(t[4]=(...i)=>a.handleImageDrop&&a.handleImageDrop(...i))},[u("div",$3,[F3,N3,u("input",{type:"file",ref:"imageLoaderInput",name:"imageLoader",style:{display:"none"},accept:"image/jpeg, image/png, image/svg",onChange:t[0]||(t[0]=(...i)=>e.uploadImage&&e.uploadImage(...i)),"aria-labelledby":"hiddenImageInputinReport",max:"4MB"},null,544)])],34)}const z3=A(V3,[["render",H3],["__scopeId","data-v-220edba0"]]);const W3={components:{ReportDropDown:Xm,ReportImageContainer:fv,ReportTextBox:wv,ReportTextBoxMultiple:$v,PolarMap:ci,PolarMapSegments:S3,DataSelect:D3,ReaderDropDown:B3,ExcelLoad:z3},props:{editable:{type:Boolean,required:!0,default:!0},dragging:{type:Boolean}},data(){return{genderOptions:[{value:"Female",label:"Female"},{value:"Male",label:"Male"},{value:"Other",label:"Other"}],completeDataOptions:[{value:"Yes",label:"Yes"},{value:"No",label:"No"}],imageQualityOptions:[{value:"Excellent",label:"Excellent"},{value:"Good",label:"Good"},{value:"Impaired but Diagnostic",label:"Impaired but Diagnostic"},{value:"Non-Diagnostic",label:"Non-Diagnostic"}],reportStore:xe(),OS_REPORT_VALUES:null}},created(){this.OS_REPORT_VALUES=this.reportStore.reportData},methods:{onOptionSelected(e,t){this.OS_REPORT_VALUES[e]=t},downloadReport(){this.buildPDF()},buildPDF(){const e=this.OS_REPORT_VALUES,t=er("p","pt",[612,792]);t.addFont("./fonts/Roboto-Light.ttf","Roboto","normal"),t.addFont("./fonts/arial_italic.ttf","Arial","normal"),t.addFont("./fonts/arial_greek.ttf","ArialGreek","normal"),t.setFont("helvetica","bold"),t.setFontSize(22),t.text(e.reportTitle,42,45),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Patient",42,78),t.addImage(this.$refs.reportLogo.src,"PNG",450,10,112.5,65.27),t.setFontSize(17),t.setTextColor("#229ED7"),t.text(e.patientName,42,97),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Gender:",43,114),t.setFontSize(10),t.setTextColor("#000917"),t.text(e.patientGender,81,114),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Age:",164,114),t.setFontSize(10),t.setTextColor("#000917"),t.text(e.patientAge,187,114),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("DOB:",269,114),t.setFontSize(10),t.setTextColor("#000917"),t.text(e.patientDOB,294,114),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Patient ID:",410,114),t.setFontSize(10),t.setTextColor("#000917"),t.text(e.patientID,460,114),t.setLineWidth(.1),t.line(577,120,35,122),t.setFontSize(11),t.setTextColor("#5E5D6C"),t.text("Exam",42,148),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Protocol:",42,162),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.protocol,42,175),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Scan Date:",42,189),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.scanDate,42,202),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Time:",42,216),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.scanTime,42,229),t.setFontSize(11),t.setTextColor("#5E5D6C"),t.text("Scan",42,293),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Complete Data:",42,307),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.completeData,42,320),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Image Quality:",42,334),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.imageQuality,42,347),t.setFontSize(11),t.setTextColor("#5E5D6C"),t.text("Readers",42,383),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Reader 1:",42,397),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.reader,42,410),e.verifier&&(t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Reader 2:",42,424),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.verifier,42,437)),t.setFontSize(11),t.setTextColor("#5E5D6C"),t.text("Scanner",42,473),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("System:",42,487),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.scannerSystem,42,500),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Field Strength:",42,514),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.fieldStrength,42,527),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Software Version:",42,541),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.softwareVersion,42,554),t.setTextColor("#5E5D6C"),t.setFont("helvetica","normal"),t.setFont("Arial"),t.text("For research use only.",42,760),t.setFont("helvetica","bold"),t.setFontSize(12),t.setTextColor("#5E5D6C"),t.text("SUMMARY",170,148),t.setFillColor("#f8f8f8"),t.setDrawColor(255,255,255),t.roundedRect(166,155,425,110,10,10,"FD"),t.setFontSize(9),t.setTextColor("#000917"),this.processSentences(e.summary,t,176,172),t.setFillColor("#f8f8f8"),t.setDrawColor(255,255,255),t.roundedRect(166,270,425,500,10,10,"FD"),t.setFillColor("#e0e0e0"),t.setDrawColor("#e0e0e0"),t.roundedRect(176,295,200,85,5,5,"FD"),t.roundedRect(381,295,200,85,5,5,"FD"),t.setFontSize(12),t.text("VASCULAR FUNCTION",180,290),t.text("HEART RATE RESPONSE",385,290),t.setFontSize(8),t.setTextColor("#5E5D6C"),t.text("B-MORE",185,310),t.setTextColor("#000917"),t.setFontSize(9),t.text("Global",185,325),t.text("LAD",185,340),t.text("LCX",185,355),t.text("RCA",185,370),t.text(e.vascularGlobal,230,325),t.text("*Normal Range: ",285,325),t.text(e.normalRangeVascular,285,337),t.text(e.coronaryTerritoryLAD,230,340),t.text(e.coronaryTerritoryLCX,230,355),t.text(e.coronaryTerritoryRCA,230,370),t.setFontSize(8),t.setTextColor("#5E5D6C"),t.text("STATE",390,310),t.text("VALUE",500,310),t.setFontSize(9),t.setTextColor("#000917"),t.text("BASELINE",390,325),t.text("HYPERVENTILATION",390,340),t.text("BREATH HOLD @ 30S",390,355),t.setFont("helvetica","normal"),t.setFont("ArialGreek"),t.text("",390,370),t.setFont("helvetica","bold"),t.text("HR",400,370),t.text(e.heartRateBaseline,501,325),t.text(e.heartRateHV,501,340),t.text(e.heartRateBH,501,355),t.text(e.dtheartrate,501,370),t.setFontSize(12),t.setTextColor("#000917"),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.setFont("helvetica","normal"),t.setFont("Arial"),t.text("Vasoconstriction Map",180,590),t.text("Coronary Vasocapacity Map (B-MORE)",385,590),t.setFont("helvetica","bold"),t.addImage(e.vascularImage.final,"PNG",176,390,200,187.5),t.addImage(e.strainImage.final,"PNG",381,390,200,187.5),t.addImage(e.oxygenSensitiveMap,"PNG",220.13,620,120,98.255),t.addImage(e.strainMapImage,"PNG",425.13,620,120,104.7),t.setFontSize(9),t.setTextColor("#000917"),t.text("B-MORE Coronary Territories",420,740),t.text("B-MORE Segment Map",225,740);const n=new Date().toLocaleDateString("en-US");t.save(`Area19_Report_${e.patientName}_${n}.pdf`)},getTextWidth(e){const t=document.createElement("span");t.style.font="12px Arial",t.style.position="absolute",t.style.visibility="hidden",t.textContent=e,document.body.appendChild(t);const{width:n}=t.getBoundingClientRect();return document.body.removeChild(t),n},splitStringByPixelWidth(e,t,n){if(e==="")return[""];if(t<=0||n<=0)throw new Error("maxWidthInPixels and charWidthInPixels should be greater than 0");const s=e.split(" "),o=[];let a="",i=0;for(let r=0;r<s.length;r++){const l=s[r],c=l.length*n;c<=t&&(i+c<=t?(a.length>0&&(a+=" ",i+=n),a+=l,i+=c):(o.push(a),a=l,i=c))}return a&&o.push(a),o},processSentences(e,t,n,s){const o=e.split(`
`),a=[];o.forEach(i=>{const r=this.splitStringByPixelWidth(i,1090,12);a.push(...r)}),a.forEach((i,r)=>{r<7&&t.text(i,n,s+14*r)})},processSentencesOLD(e,t,n,s,o){function a(d){const h=document.createElement("span");h.style.font="10px Arial",h.style.position="absolute",h.style.visibility="hidden",h.textContent=d,document.body.appendChild(h);const{width:g}=h.getBoundingClientRect();return document.body.removeChild(h),g}let i=e.trim().split(new RegExp("(?<=[.!?])|\\n"));i=i.map(d=>d.replace(/\n/g,""));function r(d,h){const g=d.split(" "),v=[];let p=g[0];for(let f=1;f<g.length;f++){const m=`${p} ${g[f]}`;a(m)<=h?p=m:(v.push(p),p=g[f])}return v.push(p),v}let l=0,c=o;i.forEach(d=>{a(d)>t?r(d,t).forEach(g=>{l>0&&(c+=14),n.text(g,s,c),l++}):(l>0&&(c+=14),n.text(d,s,c),l++)})}}},K=e=>(oe("data-v-5cd08170"),e=e(),ae(),e),j3={id:"report-element",class:"report-element"},U3={class:"title-logo-container"},G3=K(()=>u("div",{class:"reportLogo"},null,-1)),X3={class:"patient-name-container"},K3=K(()=>u("h5",null,"Patient",-1)),q3={class:"patient-info-row"},Y3={id:"gender",style:{display:"flex",gap:"5px"}},J3=K(()=>u("h5",null,"Gender:",-1)),Z3={style:{display:"flex",gap:"5px","align-items":"center"}},Q3=K(()=>u("h5",null," DOB: ",-1)),ey={class:"main-container"},ty={class:"left-column"},ny={class:"left-column-container"},oy=K(()=>u("h4",{class:"mb"},"Exam",-1)),ay={class:"small-container"},sy=K(()=>u("h5",null,"Protocol:",-1)),iy={class:"small-container"},ry=K(()=>u("h5",null,"Scan Date:",-1)),ly={class:"small-container"},cy=K(()=>u("h5",null,"Time:",-1)),dy=K(()=>u("br",null,null,-1)),uy={class:"left-column-container"},hy=K(()=>u("h4",{class:"mb"},"Scan",-1)),gy={class:"small-container"},py=K(()=>u("h5",null,"Complete Data:",-1)),fy={class:"small-container"},my=K(()=>u("h5",null,"Image Quality:",-1)),vy={class:"left-column-container"},yy=K(()=>u("h4",{class:"mb"},"Readers",-1)),wy={class:"small-container"},Sy=K(()=>u("h5",null,"Reader 1:",-1)),_y={class:"small-container"},Cy=K(()=>u("h5",null,"Reader 2:",-1)),by={class:"left-column-container"},Dy=K(()=>u("h4",{class:"mb"},"Scanner",-1)),Iy={class:"small-container"},Ty=K(()=>u("h5",null,"System:",-1)),xy={class:"small-container"},Ly=K(()=>u("h5",null,"Field Strength:",-1)),Ry={class:"small-container"},ky=K(()=>u("h5",null,"Software Version:",-1)),My=K(()=>u("div",{class:"Scanner"},null,-1)),Ey=K(()=>u("div",{style:{position:"absolute",bottom:"5px"}},[u("h5",{style:{"font-style":"italic"}},"For research use only.")],-1)),Py={class:"right-column"},Oy=K(()=>u("h4",null,"SUMMARY",-1)),Ay={class:"detailed-report"},By={class:"vascular-strain-vals-container"},Vy={class:"vascular-strain-vals-column"},$y=K(()=>u("h4",{style:{"margin-left":"2%","margin-bottom":"1%"}}," VASCULAR FUNCTION ",-1)),Fy={class:"vals-container"},Ny=K(()=>u("h6",{style:{"margin-left":"10pt","margin-top":"10pt"}},"B-MORE",-1)),Hy={class:"values-BMORE"},zy={class:"values-BMORE-row",style:{position:"relative"}},Wy=K(()=>u("h5",null,"Global",-1)),jy={style:{position:"absolute",width:"150px",right:"0px"}},Uy={style:{"margin-left":"25px"}},Gy={class:"values-BMORE-row"},Xy=K(()=>u("h5",null,"LAD",-1)),Ky={class:"values-BMORE-row"},qy=K(()=>u("h5",null,"LCX",-1)),Yy={class:"values-BMORE-row"},Jy=K(()=>u("h5",null,"RCA",-1)),Zy=K(()=>u("h5",{style:{"margin-left":"5px","font-style":"italic"}}," Vasoconstriction Map ",-1)),Qy={class:"vascular-strain-vals-column"},e5=K(()=>u("h4",{style:{"margin-left":"2%","margin-bottom":"1%"}}," HEART RATE RESPONSE ",-1)),t5={class:"vals-container"},n5={class:"values-strain"},o5=K(()=>u("div",{class:"strain-containter"},[u("h6",null,"STATE"),u("h5",null,"BASELINE"),u("h5",null,"HYPERVENTILATION"),u("h5",{style:{width:"140px"}},"BREATH HOLD @ 30S"),u("h5",null," HR")],-1)),a5={class:"strain-containter"},s5=K(()=>u("h6",null,"VALUE",-1)),i5=K(()=>u("h5",{style:{"margin-left":"5px","font-style":"italic"}}," Coronary Vasocapacity Map (B-MORE) ",-1)),r5={class:"polar-maps"},l5={class:"segmental-map"},c5=K(()=>u("h5",{style:{"font-weight":"bold"}},"B-MORE Segment Map",-1)),d5={class:"segmental-map"},u5=K(()=>u("h5",{style:{"font-weight":"bold"}},"B-MORE Coronary Territories",-1));function h5(e,t,n,s,o,a){const i=M("ReportTextBox"),r=M("ReportDropDown"),l=M("DataSelect"),c=M("ReaderDropDown"),d=M("ReportTextBoxMultiple"),h=M("ExcelLoad"),g=M("ReportImageContainer"),v=M("PolarMapSegments"),p=M("PolarMap");return D(),x("div",j3,[u("div",U3,[w(i,{id:"reportTitle",editable:!1,propValue:o.OS_REPORT_VALUES.reportTitle,"max-length":25,style:{width:"500px",color:"#000000","font-weight":"bold","font-size":"30px",height:"40px"}},null,8,["propValue"]),G3]),u("div",X3,[K3,w(i,{id:"patientName",editable:n.editable,propValue:o.OS_REPORT_VALUES.patientName,"max-length":30,style:{width:"500px",color:"#229ed7","font-weight":"500","font-size":"25px",height:"35px"}},null,8,["editable","propValue"])]),u("div",q3,[u("div",Y3,[J3,w(r,{editable:n.editable,id:"patientGender",options:o.genderOptions,onOptionSelected:a.onOptionSelected},null,8,["editable","options","onOptionSelected"])]),u("div",null,[u("h5",null,[X(" Age: "),w(i,{id:"patientAge",editable:n.editable,propValue:o.OS_REPORT_VALUES.patientAge},null,8,["editable","propValue"])])]),u("div",Z3,[Q3,w(l,{editable:n.editable,id:"patientDOB","bind-value":"patientAge"},null,8,["editable"])]),u("div",null,[u("h5",null,[X(" Patient ID: "),w(i,{id:"patientID",editable:n.editable,propValue:o.OS_REPORT_VALUES.patientID,style:{width:"110px"},"max-length":15},null,8,["editable","propValue"])])])]),u("div",ey,[u("div",ty,[u("div",ny,[oy,u("div",ay,[sy,w(i,{id:"protocol",editable:n.editable,propValue:o.OS_REPORT_VALUES.protocol,style:{width:"110px"},"max-length":15},null,8,["editable","propValue"])]),u("div",iy,[ry,w(l,{editable:n.editable,id:"scanDate",style:{"margin-bottom":"5px"}},null,8,["editable"])]),u("div",ly,[cy,w(i,{id:"scanTime",editable:n.editable,propValue:o.OS_REPORT_VALUES.scanTime,style:{width:"110px"},"max-length":15},null,8,["editable","propValue"])]),dy]),u("div",uy,[hy,u("div",gy,[py,w(r,{id:"completeData",editable:n.editable,options:o.completeDataOptions,onOptionSelected:a.onOptionSelected},null,8,["editable","options","onOptionSelected"])]),u("div",fy,[my,w(r,{id:"imageQuality",editable:n.editable,options:o.imageQualityOptions,onOptionSelected:a.onOptionSelected},null,8,["editable","options","onOptionSelected"])])]),u("div",vy,[yy,u("div",wy,[Sy,w(c,{id:"reader",editable:n.editable},null,8,["editable"])]),u("div",_y,[Cy,w(c,{id:"verifier",editable:n.editable},null,8,["editable"])])]),u("div",by,[Dy,u("div",Iy,[Ty,w(i,{id:"scannerSystem",editable:n.editable,propValue:o.OS_REPORT_VALUES.scannerSystem,style:{width:"150px"},"max-length":20},null,8,["editable","propValue"])]),u("div",xy,[Ly,w(i,{id:"fieldStrength",editable:n.editable,propValue:o.OS_REPORT_VALUES.fieldStrength,style:{width:"100px"},"max-length":15},null,8,["editable","propValue"])]),u("div",Ry,[ky,w(i,{id:"softwareVersion",editable:n.editable,propValue:o.OS_REPORT_VALUES.softwareVersion,style:{width:"100px"},"max-length":15},null,8,["editable","propValue"])])]),My,Ey]),u("div",Py,[u("div",null,[Oy,w(d,{id:"summary",editable:n.editable,placeholder:"Type summary here or click icon to auto-fill..."},null,8,["editable"])]),u("div",Ay,[u("div",By,[u("div",Vy,[$y,u("div",Fy,[w(h,{dragging:n.dragging},null,8,["dragging"]),Ny,u("div",Hy,[u("div",zy,[Wy,w(i,{id:"vascularGlobal",editable:n.editable},null,8,["editable"]),u("div",jy,[u("h5",Uy,[X(" *Normal Range: "),w(i,{id:"normalRangeVascular",editable:n.editable},null,8,["editable"])])])]),u("div",Gy,[Xy,w(i,{id:"coronaryTerritoryLAD",editable:n.editable},null,8,["editable"])]),u("div",Ky,[qy,w(i,{id:"coronaryTerritoryLCX",editable:n.editable},null,8,["editable"])]),u("div",Yy,[Jy,w(i,{id:"coronaryTerritoryRCA",editable:n.editable},null,8,["editable"])])])]),w(g,{id:"vascularImage",ref:"vascularImage",editable:n.editable,"add-bar":!0},null,8,["editable"]),Zy]),u("div",Qy,[e5,u("div",t5,[u("div",n5,[o5,u("div",a5,[s5,w(i,{id:"heartRateBaseline",editable:n.editable},null,8,["editable"]),w(i,{id:"heartRateHV",editable:n.editable},null,8,["editable"]),w(i,{id:"heartRateBH",editable:n.editable},null,8,["editable"]),w(i,{id:"dtheartrate",editable:n.editable},null,8,["editable"])])])]),w(g,{id:"strainImage",ref:"strainImage",editable:n.editable,"add-bar":!1},null,8,["editable"]),i5])]),u("div",r5,[u("div",l5,[w(v,{visible:[1,1,1],id:"oxygenSensitiveMap",editable:n.editable},null,8,["editable"]),c5]),u("div",d5,[w(p,{visible:[1,1,1],id:"strainMapImage",editable:n.editable},null,8,["editable"]),u5])])])])])])}const g5=A(W3,[["render",h5],["__scopeId","data-v-5cd08170"]]);const p5={components:{ReportHtml:g5},props:{width:{type:Number},height:{type:Number}},methods:{printReport(){this.$refs.editablereport.buildPDF()},handleEdit(){this.edit=!this.edit},handleSave(){this.edit?(this.showPopup=!0,setTimeout(()=>{this.showPopup=!1},3e3)):this.$refs.editablereport.downloadReport()},handleDragOver(e){e.preventDefault(),this.dragging=!0},handleDragLeave(e){e.preventDefault();const t=this.$refs.allreport.getBoundingClientRect(),n=t.x,s=n+t.width,o=t.y,a=o+t.height,i=e.x,r=e.y;(i>s||i<n||r<o||r>a)&&(this.dragging=!1)}},data(){return{edit:!0,showPopup:!1,key:null,dragging:!1}}},_o=e=>(oe("data-v-5a50d59b"),e=e(),ae(),e),f5={class:"toolbar-report-container"},m5={class:"toolbar"},v5=_o(()=>u("h1",null,"Edit",-1)),y5=[v5],w5={style:{position:"relative"}},S5=_o(()=>u("h1",null,"Save",-1)),_5=[S5],C5=_o(()=>u("h5",null,"Please stop editing first.",-1)),b5=[C5];function D5(e,t,n,s,o,a){const i=M("ReportHtml");return D(),x("div",{class:"reportcontainermain",style:j({width:n.width+"px",height:n.height+"px"})},[u("div",f5,[u("div",{class:"reporthere",ref:"allreport",style:j({height:n.height-15+"px"})},[(D(),Y(i,{ref:"editablereport",editable:o.edit,key:o.key,dragging:o.dragging&&o.edit,onDragenter:a.handleDragOver,onDragover:a.handleDragOver,onDrop:t[0]||(t[0]=r=>o.dragging=!1),onDragleave:a.handleDragLeave},null,8,["editable","dragging","onDragenter","onDragover","onDragleave"]))],4),u("div",m5,[u("button",{class:$(["tool",{clicked:o.edit}]),onClick:t[1]||(t[1]=(...r)=>a.handleEdit&&a.handleEdit(...r))},y5,2),u("div",w5,[o.edit?z("",!0):(D(),x("button",{key:0,class:"tool",onClick:t[2]||(t[2]=(...r)=>a.handleSave&&a.handleSave(...r))},_5)),u("div",{class:$(["popup",{show:o.showPopup}])},b5,2)])])])],4)}const I5=A(p5,[["render",D5],["__scopeId","data-v-5a50d59b"]]);const T5={props:{id:{type:Number},textOpacity:{type:Number,default:1}},created(){this.analysisStore=En(),this.labels=this.analysisStore.getLabels(`column${this.id}`),this.active=this.analysisStore.getActiveTerritory(`column${this.id}`)},methods:{scrollX(e){const t="biomarkerContainer";this.$refs[t].scrollLeft+=e.deltaY/5},scrollXAmount(e){const t="biomarkerContainer";this.$refs[t].scrollTo({left:e,behavior:"smooth"})},handleClick(e,t){this.active=t;const n=e.target.getBoundingClientRect().x,s=this.$refs.biomarkerContainer.getBoundingClientRect().x;this.analysisStore.setActiveTerritory(`column${this.id}`,t),this.scrollXAmount(n-s+this.$refs.biomarkerContainer.scrollLeft)}},data(){return{active:null,labels:null,scrollAmount:0}}},x5=["onClick"];function L5(e,t,n,s,o,a){return D(),x("div",{class:"biomarker-container",ref:"biomarkerContainer",onMousewheel:t[1]||(t[1]=(...i)=>a.scrollX&&a.scrollX(...i))},[(D(!0),x(ne,null,fe(o.labels,(i,r)=>(D(),x("h4",{key:r,onKeydown:t[0]||(t[0]=vt(Se((...l)=>e.handleKeyDown&&e.handleKeyDown(...l),["prevent"]),["space"])),class:$({active:o.active===i}),onClick:l=>a.handleClick(l,i)},F(i),43,x5))),128))],544)}const R5=A(T5,[["render",L5],["__scopeId","data-v-369952f7"]]);const k5={props:{visible:{type:Array},editable:{type:Boolean},id:{type:String}},components:{},data(){return{radius:80,reportStore:xe(),targetSegment:"",colorStops:[{color:[0,0,0],minPercentage:0,maxPercentage:0},{color:[30,30,232],minPercentage:.25,maxPercentage:.5},{color:[60,224,59],minPercentage:.5,maxPercentage:.75},{color:[251,0,0],minPercentage:.75,maxPercentage:.75},{color:[255,255,255],minPercentage:1,maxPercentage:1}],hideLAD:!0,hideLCX:!0,hideRCA:!0}},mounted(){},methods:{handleClickGlobal(e){this.checkCenter(e.offsetX,e.offsetY)&&this.$emit("segment-updated",-1)},handleClickSegment(e){this.editable&&(this.targetSegment=e)},checkCenter(e,t){return this.distance(e,t,this.radius,this.radius)<this.radius*.25},distance(e,t,n,s){return Math.sqrt((n-e)*(n-e)+(s-t)*(s-t))},setColor(e){this.reportStore.report[e]?this.$refs[e].style.fill=this.getColorAtPercentage(this.reportStore.report[e]):this.$refs[e].style.fill="#869FD5"},handleSegmentUpdate(e){this.setColor(e);const t=+e.replace("AHA",""),n={LAD:[1,2,7,8],LCX:[6,5,11,12],RCA:[3,4,9,10]};for(const s in n)if(n[s].includes(t)){let o=0;n[s].forEach(a=>{o+=parseFloat(this.reportStore.report[`AHA${a}`])||0}),this.reportStore.report[`coronaryTerritory${s}`]=(o/4).toFixed(1);break}},getColorAtPercentage(e){if(!parseFloat(e))return"rgb(0,0,0)";const n="linear-gradient(90deg, rgba(0,0,0,1) 0%, rgba(30,30,232,1) 25%, rgba(60,224,59,1) 50%, rgba(251,0,0,1) 75%, rgba(255,255,255,1) 100%)".match(/rgba?\([\d,]+\s?,\s?[\d,]+\s?,\s?[\d,]+\s?,\s?[\d.]+\)/g);if(!n||n.length<2)throw new Error("Invalid gradient format");const o=Math.min(Math.max(parseFloat(e),0),100)/100*(n.length-1),a=Math.floor(o),i=Math.ceil(o),r=o-a,l=n[a].match(/[\d.]+/g).map(Number),c=n[i].match(/[\d.]+/g).map(Number);return`rgb(${l.map((h,g)=>Math.round(h+r*(c[g]-h))).join(", ")})`},async saveImg(){const e=this.$refs["map-container"];wn(e,{logging:!1,scale:3}).then(t=>{const n=t.toDataURL("image/png");return this.reportStore.report[this.id]=n,n}).catch(t=>{console.error("Error capturing screenshot:",t)})}},computed:{colorBarStyle(){return{background:`linear-gradient(to top, ${this.colorStops.map(e=>`rgb(${e.color.join(",")}) ${e.minPercentage*100}%`).join(", ")})`}},hasValues(){const e=this.reportStore.report;return[parseFloat(e.coronaryTerritoryLAD)>0,parseFloat(e.coronaryTerritoryLCX)>0,parseFloat(e.coronaryTerritoryRCA)>0]}},watch:{async editable(){this.targetSegment=null,this.editable||(this.$refs["map-container"].style.pointerEvents="none",this.saveImg()),this.editable&&(this.$refs["map-container"].style.pointerEvents="all")},"reportStore.report.AHA1":function(){this.handleSegmentUpdate("AHA1")},"reportStore.report.AHA2":function(){this.handleSegmentUpdate("AHA2")},"reportStore.report.AHA3":function(){this.handleSegmentUpdate("AHA3")},"reportStore.report.AHA4":function(){this.handleSegmentUpdate("AHA4")},"reportStore.report.AHA5":function(){this.handleSegmentUpdate("AHA5")},"reportStore.report.AHA6":function(){this.handleSegmentUpdate("AHA6")},"reportStore.report.AHA7":function(){this.handleSegmentUpdate("AHA7")},"reportStore.report.AHA8":function(){this.handleSegmentUpdate("AHA8")},"reportStore.report.AHA9":function(){this.handleSegmentUpdate("AHA9")},"reportStore.report.AHA10":function(){this.handleSegmentUpdate("AHA10")},"reportStore.report.AHA11":function(){this.handleSegmentUpdate("AHA11")},"reportStore.report.AHA12":function(){this.handleSegmentUpdate("AHA12")}}},M5={class:"polarMap-container",ref:"map-container"},E5=kt(`<polyline class="st0" points="282.2,404.5 282.2,404.5 282.2,404.4 " data-v-ea321697></polyline><path class="st1" d="M378.2,347.8c-2,7.6-5.1,14.7-9,21.1l71.8,40.9c7.3-12.4,13-26,16.8-40.6c11-42,4.4-84.4-15.2-119.5l0,0\r
	l-70.8,41.4C380.6,308,383.4,328,378.2,347.8C378.2,347.8,378.2,347.8,378.2,347.8" data-v-ea321697></path><path class="st1" d="M303.7,407l0.1,31.9l0.2,50.7c-14.1,0.2-28.4-1.5-42.7-5.3c-42-11-75.7-37.6-96.6-72l70.8-41.4\r
	c10.3,16,26.4,28.2,46.3,33.4c0.2,0,0.4,0.1,0.5,0.1C289.4,406.4,296.6,407.1,303.7,407z" data-v-ea321697></path><polyline class="st2" points="322.3,251.6 322.2,251.6 322.3,251.6 " data-v-ea321697></polyline><path class="st2" d="M303.9,489.4c56.3-0.6,108.6-31,137-79.6l-71.9-40.9c-13.9,22.9-38.7,37.2-65.6,37.8L303.9,489.4z" data-v-ea321697></path><path class="st2" d="M442.6,249.9l-70.8,41.4c-9.9-18.9-27.3-33.7-49.4-39.7c-0.2,0-0.4-0.1-0.5-0.2c-6.3-1.7-12.6-2.5-18.9-2.6\r
	l-0.4-81.4c13.3,0,26.9,1.8,40.4,5.3C387,184.4,422,213.1,442.6,249.9z" data-v-ea321697></path><path class="st1" d="M523.5,456.8l-82.6-47c-28.4,48.6-80.7,79-137,79.6l0.4,95l0,0C394.6,583.7,478.4,534.9,523.5,456.8" data-v-ea321697></path><path class="st2" d="M231.9,290.9c-2.8,5.3-5,10.9-6.6,16.9c0,0,0,0,0,0l0,0c-5.9,22.4-1.5,45,10.1,63l-70.8,41.4\r
	c-21.9-36-29.8-80.6-18.3-124.6c3.5-13.2,8.5-25.6,14.8-37L231.9,290.9z" data-v-ea321697></path><path class="st2" d="M82.6,460.2l82-47.9c20.9,34.4,54.7,61,96.6,72c14.3,3.8,28.6,5.4,42.7,5.3l0.4,95l0,0\r
	c-22.2,0.2-44.8-2.5-67.3-8.4C169.8,558.5,115.8,515.5,82.6,460.2L82.6,460.2" data-v-ea321697></path><path class="st1" d="M302.9,248.9c-29.6-0.5-57.2,15.8-71,42l-70.8-40.3c28.3-51.3,82.8-83.4,141.4-83.2L302.9,248.9z" data-v-ea321697></path><path class="st2" d="M524.6,201.9l-82,47.9c19.6,35.1,26.3,77.5,15.2,119.5c-3.8,14.6-9.5,28.2-16.8,40.6l82.6,47l0,0\r
	c11.3-19.4,20.1-40.7,26.1-63.5C567.4,326.1,556.5,258,524.6,201.9l0.2-0.1" data-v-ea321697></path><path class="st1" d="M82.6,460.2c-34.2-57-46.3-127.2-28.1-196.6c5.6-21.4,13.8-41.5,24.1-59.9l82.6,47l0,0\r
	c-6.3,11.4-11.3,23.8-14.8,37c-11.6,44-3.7,88.6,18.3,124.6L82.6,460.2" data-v-ea321697></path><g data-v-ea321697><g data-v-ea321697><path class="st1" d="M524.6,201.9l-82,47.9C422,213,387,184.3,342.9,172.8c-13.5-3.5-27-5.3-40.4-5.3l-0.4-95l0,0\r
			c21.4,0,43.2,2.7,64.9,8.4C436.5,99.1,491.7,144.1,524.6,201.9l0.2-0.1" data-v-ea321697></path></g></g><g data-v-ea321697><g data-v-ea321697><path class="st2" d="M302.1,72.4l0.4,95c-58.6-0.2-113.1,31.8-141.4,83.2l-82.6-47l0,0C123.6,122.8,209.6,72.4,302.1,72.4" data-v-ea321697></path></g></g><line class="st3" x1="291.5" y1="369.3" x2="282.3" y2="404.5" data-v-ea321697></line><line class="st3" x1="225.3" y1="307.9" x2="261.7" y2="317.6" data-v-ea321697></line><line class="st3" x1="312.6" y1="287.9" x2="322.3" y2="251.7" data-v-ea321697></line><line class="st3" x1="342.8" y1="338.8" x2="378.2" y2="347.9" data-v-ea321697></line><circle class="st3" cx="302" cy="328" r="78.8" data-v-ea321697></circle><circle class="st3" cx="302.2" cy="328.3" r="161.6" data-v-ea321697></circle><circle class="st3" cx="302" cy="328" r="256.1" data-v-ea321697></circle><line class="st1" x1="78.5" y1="203.6" x2="231.9" y2="290.9" data-v-ea321697></line><line class="st3" x1="78.5" y1="203.6" x2="232.6" y2="291.5" data-v-ea321697></line><line class="st3" x1="302.1" y1="72.4" x2="302.9" y2="248.9" data-v-ea321697></line><line class="st3" x1="524.9" y1="201.8" x2="371.7" y2="291.3" data-v-ea321697></line><line class="st3" x1="523.6" y1="456.8" x2="369.2" y2="368.9" data-v-ea321697></line><line class="st3" x1="304.6" y1="584.5" x2="303.7" y2="407" data-v-ea321697></line><line class="st3" x1="82.6" y1="460.3" x2="236.2" y2="370.6" data-v-ea321697></line><circle class="st3" cx="301.7" cy="328.6" r="41.2" data-v-ea321697></circle><path class="st4" d="M149.3,215.8c-2.4-1.7-4.8-3.5-7.1-5.4c-0.3-0.6-0.7-1.1-1-1.7l3.7-2.4C146.8,209.3,148.2,212.5,149.3,215.8z" data-v-ea321697></path><path class="st4" d="M164.7,65.1c-2,2.1-4,4.1-6.2,6c-0.5-3-0.9-6-1.1-9.2l7-0.3C164.6,62.7,164.6,63.8,164.7,65.1z" data-v-ea321697></path><path class="st4" d="M149.3,215.8c-2.4-1.7-4.8-3.5-7.1-5.4c-0.3-0.6-0.7-1.1-1-1.7l3.7-2.4C146.8,209.3,148.2,212.5,149.3,215.8z" data-v-ea321697></path><path class="st4" d="M164.7,65.1c-2,2.1-4,4.1-6.2,6c-0.5-3-0.9-6-1.1-9.2l7-0.3C164.6,62.7,164.6,63.8,164.7,65.1z" data-v-ea321697></path><path class="st4" d="M142.2,210.4c2.3,1.9,4.7,3.7,7.1,5.4c1,2.9,1.6,6,2,9c1.5,12.9-1.3,25.7-5.6,37.8c-2.8,7.4-5.9,14.5-7.9,22.1\r
	c-1.1,4.2-2.3,9.4-3.1,13.7c-2.1,12.3-3.1,24.8-3.1,37.3c0,6.2,0.1,12.5,0.7,18.8l-1,0.1c-1.9-20.4-1.6-41.1,2-61.2\r
	c0.8-4.5,1.9-9.5,3.2-13.9c1.6-6.1,4.2-11.9,6.2-17.8c4.7-14.3,7.6-30.4,2.4-44.9C144.4,214.5,143.4,212.4,142.2,210.4z" data-v-ea321697></path><path class="st4" d="M450.2,220.4c-9.3,3.7-19,6.5-28.9,8.2l-0.2-1c23.3-5.1,48.7-15.3,62.9-35.5c14.8-21.3,6.6-47.6-6-67.8\r
	c-15.1-25.2-41.2-41.7-69.1-49.4c-47.3-13.3-98.4-7.7-146.8-3.4c-7.6,0.5-15.6,1.3-23.3,0.7c-21.7-1-43.8-9.2-59.5-24.7\r
	c-1.4,2-2.9,3.9-4.4,5.8c-3.1,4.1-6.4,8-10,11.7c-0.1-1.2-0.2-2.4-0.2-3.5l-7,0.3c0.2,3.2,0.6,6.2,1.1,9.2\r
	c-8.2,7.6-17.2,14.4-26.1,20.7c-18.9,13.9-32.6,25.5-25.6,50.6c7.4,29.3,26,57.3,51.9,73.3c42.2,24.3,85,52,113.2,92.7\r
	c5.2,7.8,9.8,16,13.2,24.8l-0.9,0.4c-3.6-8.6-8.3-16.6-13.7-24.2c-29.7-40.8-74.1-67.1-117.5-91c-1.2-0.8-2.5-1.6-3.7-2.5\r
	c-1.1-3.3-2.6-6.5-4.4-9.4l-3.7,2.4c0.4,0.5,0.7,1.1,1,1.7C119.8,192,103.8,165.2,98,137c-4.5-24.8,11.2-38.9,29.1-52.5\r
	c14.9-11.1,28.6-22.3,39.5-37.5c10.8-14.5,20.1-30.6,27.7-47.1l10.7,4.9c-4.9,9.9-10.2,19.4-16.1,28.6c10.9,13.1,27.2,20.7,44,23.4\r
	c16.3,2.8,41.5-0.2,58.2-0.8c78.8-4.6,179.1,2.8,203.6,93.6C503,184.8,481.1,208.2,450.2,220.4z" data-v-ea321697></path><path class="st4" d="M164.7,65.1c0.9,10.8,3.7,27.2,12.8,31.9c9.8,4.7,20.3,7.5,30.5,11.6c21,8.4,45.7,19.4,53.2,42.7\r
	c5.2,15.8,10.2,33.2,5.8,49.7c-0.6,2-1.3,4-2.1,6l-0.9-0.4c5.6-13.7,2.8-28.9-1.3-42.6c-1.8-5.9-3.8-11.9-6.4-17.4\r
	c-5.7-11-16.2-18.3-27-24c-7.3-3.8-15-6.8-22.9-9.6c-10.3-3.8-21.3-6.4-31.4-10.9c-10.2-5-13.5-17.2-15.7-27.3\r
	c-0.2-1.2-0.5-2.5-0.7-3.7C160.7,69.1,162.8,67.1,164.7,65.1z" data-v-ea321697></path><path class="st4" d="M510.5,386.7c14.9,17,39.1,24.7,60.8,17.4c8.5-4.2,11.5-15.6,13.5-24.2c2.8-13.6,3-27.5,2.2-41.3\r
	c-4.5-64.4-29.7-127.2-68.5-178.5c-22.3-29.3-49.7-54.7-80.7-74.7c0,0,3.2-4.8,3.2-4.8c78.4,51.4,131.3,137.9,145.7,230.1\r
	c3.3,23,4.9,46.7,0.2,69.7c-2.3,9.5-6.1,22.8-16.6,26c-17.2,4.8-35.9,1.1-50.1-9.5c-3.8-2.8-7.3-5.9-10.3-9.5\r
	C509.8,387.3,510.5,386.7,510.5,386.7L510.5,386.7z" data-v-ea321697></path><path class="st4" d="M482.3,522.1c-13.4,42.9-74.3,67.5-114.9,75.4c-11.8,2.1-24.2,3.8-36.3,2c-1.8-0.4-3-1.5-3.5-3.3\r
	c-6,10.3-15.6,18.2-26.5,23c-52.4,22.9-145.7-4.8-183.4-46.1c-32.1-34.4-54.3-77.3-68-122.1c-2.4-8.3-4.4-16.7-5.4-25.3\r
	c-2.2-3.8-4.1-7.8-5.7-11.7c-2.7-6.8-4.5-14.2-5-21.7c-0.2-6.7-0.9-13.5-1.7-20.1c-2.2-16.5-5.4-32.8-9-49.1\r
	c-5.2-23.7-11.2-47.4-17.7-70.8l20.2-5C33,285.1,39.8,323,43.5,361.5c0.3,4.4,0.8,9.7,0.9,14c0.3,4.9,0.3,10.4,0.2,15.4\r
	c-0.6,33.4,31,75,67.6,65.7c11.7-3,21.6-10.8,29.8-19.5l0.8,0.6c-7.9,9.6-17.5,18.2-29.5,22.2c-24.4,8.1-48-5.7-63-25.2\r
	c13,46.3,33.1,91.4,64.8,127.9c27.5,33.5,70.5,49.9,112.1,57.7c31.1,5,71.8,5.6,93.6-20.9c21.3-30.3,25.5-81,8.1-113.9\r
	c-8.7-16.7-24.5-28.3-43.8-28.5c-6.1-0.1-12.3,0.8-18.3,2.3l-0.3-1c12-3.4,25.2-3.9,37,0.8c11.8,4.7,21.2,14.3,27.2,25.3\r
	c16.8,31.9,14.9,72.2,0.1,104.7c1.4-0.8,2.6-0.1,4,0c3.8,0.4,7.5,0.4,11.4,0.3c40.8-2.5,113.6-27.7,128.1-69.7\r
	c3.9-11.8,2.3-24.6-2.9-35.8c-5.2-11.8-12.6-22.5-21.2-32.1c-4.3-4.8-9-9.4-13.7-14c-6.9-7-14.8-13.8-19.2-22.9\r
	c-1.4-3.1-2.2-6.5-2.2-9.9l1,0c0.4,6.5,4.1,12.1,8.5,16.8c4.4,4.7,9.4,9,14.4,13.3c15.1,12.8,29.7,27.8,38.4,46\r
	C484.1,493.8,486.5,508.3,482.3,522.1z" data-v-ea321697></path>`,38),P5=[E5];function O5(e,t,n,s,o,a){return D(),x("div",M5,[(D(),x("svg",{version:"1.1",id:"Layer_1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 612 629.2",style:j([{"enable-background":"new 0 0 612 629.2"},{width:o.radius*2+"px",height:o.radius*2+"px"}]),"xml:space":"preserve"},P5,4))],512)}const A5=A(k5,[["render",O5],["__scopeId","data-v-ea321697"]]);const B5={props:{datasets:{type:Array,required:!0},width:{type:Number,default:400},height:{type:Number,default:220},yAxisLabel:{type:String,default:"Normalized SI (RV-LV)"},visible:{type:Array}},mounted(){this.width<0||this.drawChart()},watch:{datasets:"drawChart",width:"drawChart",visible:{handler:"drawChart",deep:!0}},methods:{drawChart(){Bo(this.$refs.chart).selectAll("svg").remove();const e=this.divideYValuesBy2(this.datasets),t=["#ef00af","#f0ca07","#00efef"],n=Bo(this.$refs.chart).append("svg").attr("width",this.width).attr("height",this.height),s={top:20,right:20,bottom:30,left:50},o=this.width-s.left-s.right,a=this.height-s.top-s.bottom,i=tr(this.datasets.flat(),p=>p.x),r=Vo().domain([0,$o(this.datasets.flat(),p=>p.x)]).range([0,o]),l=Vo().domain([0,$o(this.datasets.flat(),p=>p.y)+.1]).range([a,0]),c=nr().x(p=>r(p.x)).y(p=>l(p.y)),d=n.append("g").attr("transform",`translate(${s.left},${s.top})`);n.append("defs").append("filter").attr("id","lineGlow").attr("x","-50%").attr("y","-50%").attr("width","200%").attr("height","200%").append("feGaussianBlur").attr("in","SourceGraphic").attr("stdDeviation","10");const g=d.append("g").attr("filter","url(#lineGlow)");e.forEach((p,f)=>{this.visible[f]>.2&&g.append("path").datum(p).attr("fill","none").attr("stroke",t[f]).attr("stroke-width",1.2).attr("d",c)}),d.append("text").attr("x",10).attr("y",-5).attr("fill","white").attr("font-size","12px").text("Systole"),d.append("line").attr("x1",r(i)).attr("x2",r(i)).attr("y1",-20).attr("y2",a).attr("stroke","white").attr("stroke-width",1);const v=n.append("defs").append("linearGradient").attr("id","midpointGradient").attr("x1","0%").attr("x2","100%").attr("y1","0%").attr("y2","0%");v.append("stop").attr("offset","0%").attr("stop-color","rgba(38, 151, 192, 0.25)").attr("stop-opacity",1),v.append("stop").attr("offset","100%").attr("stop-color","rgba(38, 151, 192, 0.25)").attr("stop-opacity",0),n.insert("rect",":first-child").attr("x",r(i)+50).attr("y",0).attr("width",o-r(i)).attr("height",a+20).style("fill","url(#midpointGradient)"),d.append("text").attr("x",r(i)+10).attr("y",-5).attr("fill","white").attr("font-size","12px").text("Diastole"),d.append("g").attr("transform",`translate(0,${a})`).call(or(r).ticks(4).tickSize(0)).selectAll("text").attr("font-size","12px"),n.append("text").attr("x",-s.top-a/2).attr("y",20).attr("font-size","12px").attr("fill","white").attr("text-anchor","middle").attr("transform","rotate(-90)").text(this.yAxisLabel),d.append("g").call(ar(l).ticks(6).tickSize(0)).selectAll("text").attr("font-size","12px"),this.datasets.forEach((p,f)=>{this.visible[f]>.2&&d.append("path").datum(p).attr("fill","none").attr("stroke",t[f]).attr("stroke-width",2).attr("d",c)}),n.selectAll(".domain").style("display","none")},divideYValuesBy2(e){const t=[];return e.forEach(n=>{const s=n.map(o=>({x:o.x,y:o.y/2.5}));t.push(s)}),t}}},V5={ref:"chart"};function $5(e,t,n,s,o,a){return D(),x("div",V5,null,512)}const F5=A(B5,[["render",$5],["__scopeId","data-v-9aecc786"]]);const N5={components:{GraphTerritories:R5,AnalysisGraph:F5,AnalysisPolarMap:A5,BiomarkerDropDown:So,PolarMap:ci},props:{sliceID:{type:Number,required:!0},width:{type:Number},height:{type:Number}},data(){return{loaded:!0,analysisStore:En(),itemHeight:380,dataHeight:120,resizing:!1,startY:null,polarMapWidth:null,visible:[.7,.7,.7],marker:3}},methods:{handleSegmentUpdate(e){e===-1?this.visible=[1,1,1]:this.visible[e]=!this.visible[e],console.log(this.visible)},generateRandomData(e){const t=[];for(let n=0;n<=e;n++){const s=n*1,o=Math.random();t.push({x:s,y:o})}return t},handleToggleMarker(e){this.showComponent[e]=!0},handleNewMarker(e){this.marker=e},handleBeginResize(e){this.resizing=!0,this.startY=e.clientY},handleResizeData(e){if(this.resizing){const t=this.startY-e.clientY;this.dataHeight-=t,this.startY=e.clientY}},handleStopResize(){this.resizing=!1,this.startY=null}}},hi=e=>(oe("data-v-ec1d20de"),e=e(),ae(),e),H5={class:"header-container"},z5=hi(()=>u("br",null,null,-1)),W5={class:"tempCont"},j5=["src"],U5=kt('<h2 data-v-ec1d20de>DATA</h2><div class="row header" data-v-ec1d20de><br data-v-ec1d20de><h3 data-v-ec1d20de>Baseline</h3><h3 data-v-ec1d20de>HV</h3><h3 data-v-ec1d20de>BH@30S</h3></div><div class="row" data-v-ec1d20de><h3 data-v-ec1d20de>Heart Rate</h3><h3 data-v-ec1d20de>Average: 67</h3><h3 data-v-ec1d20de>Max: 82</h3><h3 data-v-ec1d20de>Min: 62</h3></div><div class="row" data-v-ec1d20de><h3 data-v-ec1d20de>HRV</h3><h3 data-v-ec1d20de>Average: 50%</h3><h3 data-v-ec1d20de>Min: 49%</h3><h3 data-v-ec1d20de>Max: 52%</h3></div><br data-v-ec1d20de><div class="row header" data-v-ec1d20de><br data-v-ec1d20de><h3 data-v-ec1d20de>Baseline</h3><h3 data-v-ec1d20de>HV</h3><h3 data-v-ec1d20de>BH@30S</h3></div><div class="row" data-v-ec1d20de><h3 data-v-ec1d20de>Heart Rate</h3><h3 data-v-ec1d20de>Average: 67</h3><h3 data-v-ec1d20de>Max: 82</h3><h3 data-v-ec1d20de>Min: 62</h3></div><div class="row" data-v-ec1d20de><h3 data-v-ec1d20de>HRV</h3><h3 data-v-ec1d20de>Average: 50%</h3><h3 data-v-ec1d20de>Min: 49%</h3><h3 data-v-ec1d20de>Max: 52%</h3></div>',8),G5=[U5],X5={class:"analysis"},K5=hi(()=>u("h2",null,"ANALYSIS",-1)),q5={class:"content"};function Y5(e,t,n,s,o,a){const i=M("BiomarkerDropDown"),r=M("GraphTerritories"),l=M("AnalysisPolarMap"),c=M("AnalysisGraph");return D(),x("div",{class:"column-container",ref:"columnContainer",style:j({maxWidth:n.width+"px"})},[u("div",H5,[u("h5",null,"Slice "+F(n.sliceID),1),w(i,{onNewMarker:a.handleNewMarker,biomarkers:["Intensity Series Normalized","Intensity Ventricle Normalized ","B-MORE"]},null,8,["onNewMarker"]),z5]),u("div",W5,[u("img",{class:"viewer",src:`/src/components/mock_presentation/biomarker${o.marker}.png`,alt:""},null,8,j5)]),u("div",{class:"lower-container",onMousemove:t[4]||(t[4]=(...d)=>a.handleResizeData&&a.handleResizeData(...d)),onMouseup:t[5]||(t[5]=(...d)=>a.handleStopResize&&a.handleStopResize(...d)),onMouseleave:t[6]||(t[6]=(...d)=>a.handleStopResize&&a.handleStopResize(...d)),onFocusout:t[7]||(t[7]=(...d)=>a.handleStopResize&&a.handleStopResize(...d)),style:j({cursor:o.resizing?"row-resize":"default"})},[u("div",{class:"data-container",style:j({height:o.dataHeight+"px"}),ref:"dataContainer"},G5,4),u("div",{class:"modify-size",onMousemove:t[3]||(t[3]=(...d)=>a.handleResizeData&&a.handleResizeData(...d))},[u("i",{class:"fa-solid fa-ellipsis fa-lg graber",onMousedown:t[0]||(t[0]=(...d)=>a.handleBeginResize&&a.handleBeginResize(...d)),onMousemove:t[1]||(t[1]=(...d)=>a.handleResizeData&&a.handleResizeData(...d)),onMouseup:t[2]||(t[2]=(...d)=>a.handleStopResize&&a.handleStopResize(...d))},null,32)],32),u("div",X5,[K5,w(r,{id:n.sliceID},null,8,["id"]),u("div",q5,[w(l,{visible:o.visible,onSegmentUpdated:a.handleSegmentUpdate,ref:"polarMap"},null,8,["visible","onSegmentUpdated"]),w(c,{datasets:o.analysisStore.getGraphData(`column${n.sliceID}`),visible:o.visible,width:n.width-200},null,8,["datasets","visible","width"])])])],36)],4)}const J5=A(N5,[["render",Y5],["__scopeId","data-v-ec1d20de"]]);const Z5={components:{BiomarkerDropDown:So},props:{sliceID:{type:Number,required:!0},width:{type:Number},height:{type:Number}},data(){return{loaded:!0,analysisStore:En(),itemHeight:380,visible:[.7,.7,.7],marker:3}},methods:{handleSegmentUpdate(e){e===-1?this.visible=[1,1,1]:this.visible[e]=!this.visible[e],console.log(this.visible)},generateRandomData(e){const t=[];for(let n=0;n<=e;n++){const s=n*1,o=Math.random();t.push({x:s,y:o})}return t},handleToggleMarker(e){this.showComponent[e]=!0},handleNewMarker(e){this.marker=e,console.log(this.marker)}}},Co=e=>(oe("data-v-f59c1f02"),e=e(),ae(),e),Q5={class:"header-container"},e4=Co(()=>u("br",null,null,-1)),t4={class:"tempCont"},n4=["src"],o4={class:"biomarker-container"},a4=Co(()=>u("div",{class:"biomarker-header-container"},[u("h2",null,"IMAGES"),u("div",{class:"options"},[u("h5",null,"All"),u("h5",null,"Biomarkers"),u("h5",null,"LGE")])],-1)),s4={class:"images-container"},i4=["src"],r4=Co(()=>u("h5",null,"Series Descriptions",-1));function l4(e,t,n,s,o,a){const i=M("BiomarkerDropDown");return D(),x("div",{class:"column-container",ref:"columnContainer",style:j({maxWidth:n.width+"px"})},[u("div",Q5,[u("h5",null,"Slice "+F(n.sliceID),1),w(i,{onNewMarker:a.handleNewMarker,biomarkers:["Intensity Series Normalized","Intensity Ventricle Normalized ","B-MORE"]},null,8,["onNewMarker"]),e4]),u("div",t4,[u("img",{class:"viewer",src:`/src/components/mock_presentation/biomarker${o.marker}.png`,alt:""},null,8,n4)]),u("div",o4,[a4,u("div",s4,[(D(),x(ne,null,fe(25,r=>u("div",{class:"image-container",key:r},[u("img",{src:`/src/components/mock_presentation/biomarker${o.marker}.png`,alt:""},null,8,i4),r4])),64))])])],4)}const c4=A(Z5,[["render",l4],["__scopeId","data-v-f59c1f02"]]);const d4={props:{sliceID:{type:Number,required:!0},width:{type:Number},height:{type:Number}},data(){return{sliceNum:1}}},On=e=>(oe("data-v-3329f038"),e=e(),ae(),e),u4=On(()=>u("div",{class:"cardiac-nav-container"},[u("h4",null,"Ask Troy For Cardiac Icon")],-1)),h4={class:"slice-nav"},g4=On(()=>u("h4",{class:"slice-num"},"Slice",-1)),p4={class:"num-container"},f4={class:"slice-num"},m4=On(()=>u("i",{class:"fa-solid fa-play fa-sm",style:{transform:"rotate(270deg)"}},null,-1)),v4=[m4],y4=On(()=>u("i",{class:"fa-solid fa-play fa-sm",style:{transform:"rotate(90deg)"}},null,-1)),w4=[y4],S4=kt('<div class="data-container" data-v-3329f038><div class="row header" data-v-3329f038><br data-v-3329f038><h3 data-v-3329f038>Heart Rate</h3><h3 data-v-3329f038>HRV</h3></div><div class="row" data-v-3329f038><h3 style="text-align:left;" data-v-3329f038>Baseline</h3><h3 data-v-3329f038>Average: 67</h3><h3 data-v-3329f038>Max: 82</h3></div><div class="row" data-v-3329f038><h3 style="text-align:left;" data-v-3329f038>HV</h3><h3 data-v-3329f038>Average: 50%</h3><h3 data-v-3329f038>Min: 49%</h3></div><div class="row" data-v-3329f038><h3 style="text-align:left;" data-v-3329f038>BH@30S</h3><h3 data-v-3329f038>Average: 50%</h3><h3 data-v-3329f038>Min: 49%</h3></div></div><div class="summary-findings-container" data-v-3329f038><div class="summary-header" data-v-3329f038><h3 data-v-3329f038>SUMMARY FINDINGS</h3></div><textarea class="summary-area" aria-label="summary" id="" cols="30" rows="10" data-v-3329f038></textarea><button class="add-to-report" data-v-3329f038>Add to Report</button></div>',2);function _4(e,t,n,s,o,a){return D(),x("div",{class:"column-container",ref:"columnContainer",style:j({maxWidth:n.width+"px",minWidth:n.width+"px"})},[u4,u("div",h4,[g4,u("div",p4,[u("h4",f4,F(o.sliceNum),1),u("div",{class:"arrow-up",onMousedown:t[0]||(t[0]=i=>o.sliceNum++)},v4,32),u("div",{class:"arrow-down",onMousedown:t[1]||(t[1]=i=>o.sliceNum--)},w4,32)])]),S4],4)}const C4=A(d4,[["render",_4],["__scopeId","data-v-3329f038"]]);const b4={components:{AnalysisColumn:J5,AnalysisSliceControl:C4,AnalysisColumnViewer:c4},props:{width:{type:Number},height:{type:Number}},methods:{setColumnWidth(){this.width>1300?this.columnWidth=(this.width-10)/3:this.columnWidth=(this.width-10)/2}},created(){this.setColumnWidth()},watch:{width(){this.setColumnWidth()}}};function D4(e,t,n,s,o,a){const i=M("AnalysisColumn"),r=M("AnalysisColumnViewer"),l=M("AnalysisSliceControl");return D(),x("div",{class:"biomarkerviewer",style:j({width:n.width+"px",height:n.height+"px"})},[w(i,{sliceID:1,width:510}),w(i,{sliceID:2,width:510}),n.width>1300?(D(),Y(r,{key:0,sliceID:3,width:510})):z("",!0),w(l,{sliceID:2,width:285})],4)}const I4=A(b4,[["render",D4],["__scopeId","data-v-e70e6157"]]);const T4={components:{PatientHeaderInfo:e2,AnalysisNavigationBar:c2,CheckContourNew:ri,QualityCheck:$m,ReportMaker:I5,GraphicalAnalysis:I4},data(){return{appState:ut(),container:"container"}},methods:{handleResize(){const e=this.$refs.navigationBar.getBoundingClientRect().width,t=this.$refs.header.getBoundingClientRect().height;this.mainWidth=window.innerWidth-e-10,this.mainHeight=window.innerHeight-t-25,this.appState.setAnalysisSreenDims(this.mainWidth,this.mainHeight)}},created(){this.timeofday=this.appState.timeOfDay;const e=En();["Territory Min","Territory Absolute Velocity","Territory Median","Sector Median","Sector Max","Sector Min"].forEach(n=>{e.addNewTerritory("column1",n),e.addNewTerritory("column2",n),e.addNewTerritory("column3",n)})},mounted(){window.addEventListener("resize",this.handleResize),this.$refs.background.style.backgroundImage=`url('/images/${this.timeofday.toLowerCase()}.jpg')`,this.handleResize(),this.analysisScreenDims=Ve(this.appState.analysisScreenDims)},beforeUnmount(){window.removeEventListener("resize",this.handleResize)}},gi=e=>(oe("data-v-2ac9a1ba"),e=e(),ae(),e),x4=gi(()=>u("div",{class:"mobile-overlay"},[u("div",{class:"warning"},[u("h2",null,[X(" It appears that you are trying to use our app on a screen size of less than 1350 px wide. "),u("br"),X(" Currently our app is limited to larger devices. Please try on a larger laptop. ")])])],-1)),L4={class:"body"},R4={class:"navigationBar",ref:"navigationBar"},k4={class:"header-main"},M4={class:"header",ref:"header"},E4=gi(()=>u("h5",{style:{"margin-left":"auto",color:"grey"}}," Area 19 OCG Prototype V.0.1 ",-1));function P4(e,t,n,s,o,a){const i=M("AnalysisNavigationBar"),r=M("PatientHeaderInfo");return D(),x(ne,null,[x4,u("div",{class:$(o.container),ref:"background"},[u("div",L4,[u("div",R4,[w(i)],512),u("div",k4,[u("div",M4,[w(r)],512),u("div",{class:"main",ref:"mainContainer",style:j({width:e.mainWidth,height:e.mainHeight})},[w(_e,{name:"fade"},{default:L(()=>[(D(),Y(sr(o.appState.currentView),{ref:"mainAnalysisComponent",width:o.appState.analysisScreenDims.width,height:o.appState.analysisScreenDims.height},null,8,["width","height"]))]),_:1})],4),E4])])],2)],64)}const O4=A(T4,[["render",P4],["__scopeId","data-v-2ac9a1ba"]]),A4=[{path:"/",redirect:"/login"},{path:"/login",name:"Login",component:_c},{path:"/home",name:"Home",component:ff},{path:"/analysis",name:"Analysis",component:O4}],B4=ir({history:rr(),routes:A4});ac();Qt.setResolveCoincidentTopologyToPolygonOffset();Qt.setResolveCoincidentTopologyPolygonOffsetParameters(-3,-3);Qt.setResolveCoincidentTopologyLineOffsetParameters(-3,-3);$a.setResolveCoincidentTopologyToPolygonOffset();$a.setResolveCoincidentTopologyPolygonOffsetParameters(1,1);Dl(qn);const pi=nl.newInstance({proxyConfiguration:Hl}),fi=new Fa;fi.initialize();const mi=lr();mi.use(nc({proxies:new oc(pi),dicomIO:fi}));const ht=cr(sl);ic(ht);ht.provide("ProxyManager",pi);ht.use(mi);ht.use(dr);ht.use(Sr);ht.use(ur,{smallLaptop:1200,mediumLaptop:1300,largerLaptop:1400,xLargeLaptop:1600,desktop:1900,_4K:2500});ht.use(B4).mount("#app");
//# sourceMappingURL=index-43baa076.js.map
