import{g as U0,_ as $a,a as b,b as G0,c as An,d as Zn,e as B0,f as Ui,h as _0,i as j0,j as W0,k as W,l as ne,D as $0,m as Ae,n as za,o as ba,t as he,p as Ee,q as _t,r as I,s as mf,u as ns,v as z0,w as kf,x as Hn,y as rs,z as b0,A as Q,B as H0,C as Kn,E as at,F as mr,G as K0,H as Te,I as It,J as kr,K as ri,L as wr,M as P0,N as X0,O as We,P as co,Q as Oa,R as go,S as we,T as Y0,U as A0,V as Z0,W as Gi,X as q0,Y as ai,Z as Et,$ as Ge,a0 as J0,a1 as Ff,a2 as Q0,a3 as Nf,a4 as Uf,a5 as I0,a6 as Gf,a7 as jn,a8 as el,a9 as as,aa as tl,ab as is,ac as os,ad as nl,ae as rl,af as ss,ag as ii,ah as al,ai as il,aj as ol,ak as sl,al as ul}from"./vendor-0d601a45.js";function us(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function fl(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?us(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):us(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var St=U0(),Bf={vtkObject:function(){return null}};function ct(t){if(t==null||t.isA)return t;if(!t.vtkClass)return St.console&&St.console.error&&St.console.error("Invalid VTK object"),null;var e=Bf[t.vtkClass];if(!e)return St.console&&St.console.error&&St.console.error("No vtk class found for Object of type ".concat(t.vtkClass)),null;var r=fl({},t);Object.keys(r).forEach(function(a){r[a]&&$a(r[a])==="object"&&r[a].vtkClass&&(r[a]=ct(r[a]))});var n=e(r);return n&&n.modified&&n.modified(),n}function cl(t,e){Bf[t]=e}ct.register=cl;function gl(t){var e=vl();return function(){var n=Ui(t),a;if(e){var i=Ui(this).constructor;a=Reflect.construct(n,arguments,i)}else a=n.apply(this,arguments);return j0(this,a)}}function vl(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var oi=function(t){G0(r,t);var e=gl(r);function r(){return An(this,r),e.apply(this,arguments)}return Zn(r,[{key:"push",value:function(){for(var a=0;a<arguments.length;a++)this.includes(arguments[a])||B0(Ui(r.prototype),"push",this).call(this,arguments[a]);return this.length}}]),r}(_0(Array));function fs(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function wa(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?fs(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):fs(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var Bi=0,pl=Symbol("void");function ll(){return Bi}var _f={};function vn(){}var hl=["log","debug","info","warn","error","time","timeEnd","group","groupEnd"];hl.forEach(function(t){_f[t]=vn});St.console=console.hasOwnProperty("log")?console:_f;var it={debug:vn,error:St.console.error||vn,info:St.console.info||vn,log:St.console.log||vn,warn:St.console.warn||vn};function yl(t,e){it[t]&&(it[t]=e||vn)}function Tl(){it.log.apply(it,arguments)}function Cl(){it.info.apply(it,arguments)}function dn(){it.debug.apply(it,arguments)}function ae(){it.error.apply(it,arguments)}function qn(){it.warn.apply(it,arguments)}var cs={};function Sl(t){cs[t]||(it.error(t),cs[t]=!0)}var nt=Object.create(null);nt.Float32Array=Float32Array;nt.Float64Array=Float64Array;nt.Uint8Array=Uint8Array;nt.Int8Array=Int8Array;nt.Uint16Array=Uint16Array;nt.Int16Array=Int16Array;nt.Uint32Array=Uint32Array;nt.Int32Array=Int32Array;nt.Uint8ClampedArray=Uint8ClampedArray;try{nt.BigInt64Array=BigInt64Array,nt.BigUint64Array=BigUint64Array}catch{}function Ha(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return W0(nt[t]||Float64Array,r)}function vo(t){for(var e,r=arguments.length,n=new Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];return(e=nt[t]||Float64Array).from.apply(e,n)}function po(t){return t.charAt(0).toUpperCase()+t.slice(1)}function Ne(t){return po(t[0]==="_"?t.slice(1):t)}function dl(t){return t.charAt(0).toLowerCase()+t.slice(1)}function Ol(t){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1e3,n=["TB","GB","MB","KB"],a=Number(t),i="B";a>r;)a/=r,i=n.pop();return"".concat(a.toFixed(e)," ").concat(i)}function wl(t){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:" ",r=[],n=t;n>1e3;)r.push("000".concat(n%1e3).slice(-3)),n=Math.floor(n/1e3);return n>0&&r.push(n),r.reverse(),r.join(e)}function jf(t){Object.keys(t).forEach(function(e){Array.isArray(t[e])&&(t[e]=[].concat(t[e]))})}function xl(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}return!1}function Ml(t,e){return Object.keys(t).find(function(r){return t[r]===e})}function Wf(t){return t&&t.isA?t.getState():t}function $f(t){setTimeout(t,0)}function Dl(t,e){var r=performance.now();t.finally(function(){var n=performance.now()-r;e(n)})}function _e(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};jf(e);var r=[];if(Number.isInteger(e.mtime)||(e.mtime=++Bi),!("classHierarchy"in e))e.classHierarchy=new oi("vtkObject");else if(!(e.classHierarchy instanceof oi)){for(var n=new oi,a=0;a<e.classHierarchy.length;a++)n.push(e.classHierarchy[a]);e.classHierarchy=n}function i(s){r[s]=null}function o(s){function f(){i(s)}return Object.freeze({unsubscribe:f})}return t.isDeleted=function(){return!!e.deleted},t.modified=function(s){if(e.deleted){ae("instance deleted - cannot call any method");return}s&&s<t.getMTime()||(e.mtime=++Bi,r.forEach(function(f){return f&&f(t)}))},t.onModified=function(s){if(e.deleted)return ae("instance deleted - cannot call any method"),null;var f=r.length;return r.push(s),o(f)},t.getMTime=function(){return e.mtime},t.isA=function(s){for(var f=e.classHierarchy.length;f--;)if(e.classHierarchy[f]===s)return!0;return!1},t.getClassName=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.classHierarchy[e.classHierarchy.length-1-s]},t.set=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,u=!1;return Object.keys(s).forEach(function(v){var g=c?null:t["set".concat(po(v))];g&&Array.isArray(s[v])&&g.length>1?u=g.apply(void 0,W(s[v]))||u:g?u=g(s[v])||u:(["mtime"].indexOf(v)===-1&&!f&&qn("Warning: Set value to model directly ".concat(v,", ").concat(s[v])),u=e[v]!==s[v]||u,e[v]=s[v])}),u},t.get=function(){for(var s=arguments.length,f=new Array(s),c=0;c<s;c++)f[c]=arguments[c];if(!f.length)return e;var u={};return f.forEach(function(v){u[v]=e[v]}),u},t.getReferenceByName=function(s){return e[s]},t.delete=function(){Object.keys(e).forEach(function(s){return delete e[s]}),r.forEach(function(s,f){return i(f)}),e.deleted=!0},t.getState=function(){if(e.deleted)return null;var s=wa(wa({},e),{},{vtkClass:t.getClassName()});Object.keys(s).forEach(function(c){s[c]===null||s[c]===void 0||c[0]==="_"?delete s[c]:s[c].isA?s[c]=s[c].getState():Array.isArray(s[c])&&(s[c]=s[c].map(Wf))});var f={};return Object.keys(s).sort().forEach(function(c){f[c]=s[c]}),f.mtime&&delete f.mtime,f},t.shallowCopy=function(s){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(s.getClassName()!==t.getClassName())throw new Error("Cannot ShallowCopy ".concat(s.getClassName()," into ").concat(t.getClassName()));var c=s.get(),u=Object.keys(e).sort(),v=Object.keys(c).sort();v.forEach(function(g){var p=u.indexOf(g);p===-1?f&&dn("add ".concat(g," in shallowCopy")):u.splice(p,1),e[g]=c[g]}),u.length&&f&&dn("Untouched keys: ".concat(u.join(", "))),t.modified()},t.toJSON=function(){return t.getState()},t}var El={object:function(e,r,n){return function(){return wa({},r[n.name])}}};function ot(t,e,r){r.forEach(function(n){if($a(n)==="object"){var a=El[n.type];a?t["get".concat(Ne(n.name))]=a(t,e,n):t["get".concat(Ne(n.name))]=function(){return e[n.name]}}else t["get".concat(Ne(n))]=function(){return e[n]}})}var Rl={enum:function(e,r,n){var a="_on".concat(Ne(n.name),"Changed");return function(i){if(typeof i=="string"){if(n.enum[i]!==void 0)return r[n.name]!==n.enum[i]?(r[n.name]=n.enum[i],e.modified(),!0):!1;throw ae("Set Enum with invalid argument ".concat(n,", ").concat(i)),new RangeError("Set Enum with invalid string argument")}if(typeof i=="number"){if(r[n.name]!==i){if(Object.keys(n.enum).map(function(f){return n.enum[f]}).indexOf(i)!==-1){var o,s=r[n.name];return r[n.name]=i,(o=r[a])===null||o===void 0||o.call(r,e,r,i,s),e.modified(),!0}throw ae("Set Enum outside numeric range ".concat(n,", ").concat(i)),new RangeError("Set Enum outside numeric range")}return!1}throw ae("Set Enum with invalid argument (String/Number) ".concat(n,", ").concat(i)),new TypeError("Set Enum with invalid argument (String/Number)")}},object:function(e,r,n){var a="_on".concat(Ne(n.name),"Changed");return function(i){if(!$0(r[n.name],i)){var o,s=r[n.name];return r[n.name]=i,(o=r[a])===null||o===void 0||o.call(r,e,r,i,s),e.modified(),!0}return!1}}};function gs(t){if($a(t)==="object"){var e=Rl[t.type];if(e)return function(r,n){return e(r,n,t)};throw ae("No setter for field ".concat(t)),new TypeError("No setter for field")}return function(n,a){var i="_on".concat(Ne(t),"Changed");return function(s){if(a.deleted)return ae("instance deleted - cannot call any method"),!1;if(a[t]!==s){var f,c=a[t.name];return a[t]=s,(f=a[i])===null||f===void 0||f.call(a,n,a,s,c),n.modified(),!0}return!1}}}function Ka(t,e,r){r.forEach(function(n){$a(n)==="object"?t["set".concat(Ne(n.name))]=gs(n)(t,e):t["set".concat(Ne(n))]=gs(n)(t,e)})}function ze(t,e,r){ot(t,e,r),Ka(t,e,r)}function Pa(t,e,r){r.forEach(function(n){t["get".concat(Ne(n))]=function(){return e[n]?Array.from(e[n]):e[n]},t["get".concat(Ne(n),"ByReference")]=function(){return e[n]}})}function zf(t,e,r,n){var a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;r.forEach(function(i){if(e[i]&&n&&e[i].length!==n)throw new RangeError("Invalid initial number of values for array (".concat(i,")"));var o="_on".concat(Ne(i),"Changed");t["set".concat(Ne(i))]=function(){if(e.deleted)return ae("instance deleted - cannot call any method"),!1;for(var s=arguments.length,f=new Array(s),c=0;c<s;c++)f[c]=arguments[c];var u=f,v,g=!1;if(u.length===1&&(u[0]==null||u[0].length>=0)&&(u=u[0],g=!0),u==null)v=e[i]!==u;else{if(n&&u.length!==n)if(u.length<n&&a!==void 0)for(u=Array.from(u),g=!1;u.length<n;)u.push(a);else throw new RangeError("Invalid number of values for array setter (".concat(i,")"));v=e[i]==null||e[i].length!==u.length;for(var p=0;!v&&p<u.length;++p)v=e[i][p]!==u[p];v&&g&&(u=Array.from(u))}if(v){var l,h=e[i.name];e[i]=u,(l=e[o])===null||l===void 0||l.call(e,t,e,u,h),t.modified()}return v},t["set".concat(Ne(i),"From")]=function(s){var f=e[i];s.forEach(function(c,u){f[u]=c})}})}function bf(t,e,r,n){var a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;Pa(t,e,r),zf(t,e,r,n,a)}function _r(t,e,r){for(var n=0;n<r.length;n++){var a=r[n];e[a]!==void 0&&(e["_".concat(a)]=e[a],delete e[a])}}function Hf(t,e,r,n){e.inputData?e.inputData=e.inputData.map(ct):e.inputData=[],e.inputConnection?e.inputConnection=e.inputConnection.map(ct):e.inputConnection=[],e.output?e.output=e.output.map(ct):e.output=[],e.inputArrayToProcess?e.inputArrayToProcess=e.inputArrayToProcess.map(ct):e.inputArrayToProcess=[],e.numberOfInputs=r;function a(l){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){ae("instance deleted - cannot call any method");return}if(h>=e.numberOfInputs){ae("algorithm ".concat(t.getClassName()," only has ").concat(e.numberOfInputs," input ports. To add more input ports, use addInputData()"));return}(e.inputData[h]!==l||e.inputConnection[h])&&(e.inputData[h]=l,e.inputConnection[h]=null,t.modified&&t.modified())}function i(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[l]&&(e.inputData[l]=e.inputConnection[l]()),e.inputData[l]}function o(l){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){ae("instance deleted - cannot call any method");return}if(h>=e.numberOfInputs){var y="algorithm ".concat(t.getClassName()," only has ");y+="".concat(e.numberOfInputs),y+=" input ports. To add more input ports, use addInputConnection()",ae(y);return}e.inputData[h]=null,e.inputConnection[h]=l}function s(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[l]}function f(){for(var l=e.numberOfInputs;l&&!e.inputData[l-1]&&!e.inputConnection[l-1];)l--;return l===e.numberOfInputs&&e.numberOfInputs++,l}function c(l){if(e.deleted){ae("instance deleted - cannot call any method");return}o(l,f())}function u(l){if(e.deleted){ae("instance deleted - cannot call any method");return}a(l,f())}function v(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.deleted?(ae("instance deleted - cannot call any method"),null):(t.shouldUpdate()&&t.update(),e.output[l])}t.shouldUpdate=function(){for(var l=t.getMTime(),h=1/0,y=n;y--;){if(!e.output[y]||e.output[y].isDeleted())return!0;var C=e.output[y].getMTime();if(C<l)return!0;C<h&&(h=C)}for(y=e.numberOfInputs;y--;){var S,d;if((S=e.inputConnection[y])!==null&&S!==void 0&&S.filter.shouldUpdate()||((d=t.getInputData(y))===null||d===void 0?void 0:d.getMTime())>h)return!0}return!1};function g(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,h=function(){return v(l)};return h.filter=t,h}if(e.numberOfInputs){for(var p=e.numberOfInputs;p--;)e.inputData.push(null),e.inputConnection.push(null);t.setInputData=a,t.setInputConnection=o,t.addInputData=u,t.addInputConnection=c,t.getInputData=i,t.getInputConnection=s}n&&(t.getOutputData=v,t.getOutputPort=g),t.update=function(){var l=[];if(e.numberOfInputs)for(var h=0;h<e.numberOfInputs;)l[h]=t.getInputData(h),h++;t.shouldUpdate()&&t.requestData&&t.requestData(l,e.output)},t.getNumberOfInputPorts=function(){return e.numberOfInputs},t.getNumberOfOutputPorts=function(){return n||e.output.length},t.getInputArrayToProcess=function(l){var h=e.inputArrayToProcess[l],y=e.inputData[l];return h&&y?y["get".concat(h.fieldAssociation)]().getArray(h.arrayName):null},t.setInputArrayToProcess=function(l,h,y){for(var C=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"Scalars";e.inputArrayToProcess.length<l;)e.inputArrayToProcess.push(null);e.inputArrayToProcess[l]={arrayName:h,fieldAssociation:y,attributeType:C}}}var Kf=Symbol("Event abort");function xa(t,e,r){var n=[],a=t.delete,i=1;function o(c){for(var u=0;u<n.length;++u){var v=ne(n[u],1),g=v[0];if(g===c){n.splice(u,1);return}}}function s(c){function u(){o(c)}return Object.freeze({unsubscribe:u})}function f(){var c=arguments;if(e.deleted){ae("instance deleted - cannot call any method");return}for(var u=n.slice(),v=function(h){var y=ne(u[h],3),C=y[1],S=y[2];if(!C)return"continue";if(S<0)setTimeout(function(){return C.apply(t,c)},1-S);else{var d=C.apply(t,c);if(d===Kf)return"break"}},g=0;g<u.length;++g){var p=v(g);if(p!=="continue"&&p==="break")break}}t["invoke".concat(Ne(r))]=f,t["on".concat(Ne(r))]=function(c){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!c.apply)return console.error("Invalid callback for event ".concat(r)),null;if(e.deleted)return ae("instance deleted - cannot call any method"),null;var v=i++;return n.push([v,c,u]),n.sort(function(g,p){return p[2]-g[2]}),s(v)},t.delete=function(){a(),n.forEach(function(c){var u=ne(c,1),v=u[0];return o(v)})}}function ke(t,e){var r=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i={},o={};return t(o,i,a),Object.freeze(o)};return e&&ct.register(e,r),r}function $n(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return function(){for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return e.filter(function(o){return!!o}).map(function(o){return o.apply(void 0,a)})}}function Pf(t){return t&&t.isA&&t.isA("vtkObject")}function _i(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];if(Pf(t)){if(n.indexOf(t)>=0)return r;n.push(t);var a=e(t);a!==void 0&&r.push(a);var i=t.get();Object.keys(i).forEach(function(o){var s=i[o];Array.isArray(s)?s.forEach(function(f){_i(f,e,r,n)}):_i(s,e,r,n)})}return r}function Vl(t,e,r){var n=this,a,i=function(){for(var s=arguments.length,f=new Array(s),c=0;c<s;c++)f[c]=arguments[c];var u=n,v=function(){a=null,r||t.apply(u,f)},g=r&&!a;clearTimeout(a),a=setTimeout(v,e),g&&t.apply(u,f)};return i.cancel=function(){return clearTimeout(a)},i}function Ll(t,e){var r=!1,n=null;function a(){r=!1,n!==null&&(i.apply(void 0,W(n)),n=null)}function i(){for(var o=arguments.length,s=new Array(o),f=0;f<o;f++)s[f]=arguments[f];if(r){n=s;return}r=!0,t.apply(void 0,s),setTimeout(a,e)}return i}function Xf(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};e.keystore=Object.assign(e.keystore||{},r),t.setKey=function(n,a){e.keystore[n]=a},t.getKey=function(n){return e.keystore[n]},t.getAllKeys=function(){return Object.keys(e.keystore)},t.deleteKey=function(n){return delete e.keystore[n]},t.clearKeystore=function(){return t.getAllKeys().forEach(function(n){return delete e.keystore[n]})}}var ml=1,br="__root__";function lo(t,e){Xf(t,e);var r=t.delete;e.proxyId="".concat(ml++),e.ui=JSON.parse(JSON.stringify(e.ui||[])),ot(t,e,["proxyId","proxyGroup","proxyName"]),ze(t,e,["proxyManager"]);var n={},a={};function i(c,u){a[u]||(a[u]=[]);for(var v=a[u],g=0;g<c.length;g++)v.push(c[g].name),n[c[g].name]=c[g],c[g].children&&c[g].children.length&&i(c[g].children,c[g].name)}i(e.ui,br),t.updateUI=function(c){e.ui=JSON.parse(JSON.stringify(c||[])),Object.keys(n).forEach(function(u){return delete n[u]}),Object.keys(a).forEach(function(u){return delete a[u]}),i(e.ui,br),t.modified()};function o(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:br;return a[c]}t.updateProxyProperty=function(c,u){var v=n[c];v?Object.assign(v,u):n[c]=wa({},u)},t.activate=function(){if(e.proxyManager){var c="setActive".concat(Ne(t.getProxyGroup().slice(0,-1)));e.proxyManager[c]&&e.proxyManager[c](t)}},e.propertyLinkSubscribers={},t.registerPropertyLinkForGC=function(c,u){u in e.propertyLinkSubscribers||(e.propertyLinkSubscribers[u]=[]),e.propertyLinkSubscribers[u].push(c)},t.gcPropertyLinks=function(c){for(var u=e.propertyLinkSubscribers[c]||[];u.length;)u.pop().unbind(t)},e.propertyLinkMap={},t.getPropertyLink=function(c){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(e.propertyLinkMap[c])return e.propertyLinkMap[c];var v=null,g=[],p=0,l=!1;function h(O){var w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(l)return null;var M=[],x=null;for(p=g.length;p--;){var D=g[p];D.instance===O?x=D:M.push(D)}if(!x)return null;var R=x.instance["get".concat(Ne(x.propertyName))]();if(!xl(R,v)||w){for(v=R,l=!0;M.length;){var V=M.pop();V.instance.set(b({},V.propertyName,v))}l=!1}return e.propertyLinkMap[c].persistent&&(e.propertyLinkMap[c].value=R),R}function y(O,w){var M=[];for(p=g.length;p--;){var x=g[p];x.instance===O&&(x.propertyName===w||w===void 0)&&(x.subscription.unsubscribe(),M.push(p))}for(;M.length;)g.splice(M.pop(),1)}function C(O,w){var M=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,x=O.onModified(h),D=g[0];return g.push({instance:O,propertyName:w,subscription:x}),M&&(e.propertyLinkMap[c].persistent&&e.propertyLinkMap[c].value!==void 0?O.set(b({},w,e.propertyLinkMap[c].value)):D&&h(D.instance,!0)),{unsubscribe:function(){return y(O,w)}}}function S(){for(;g.length;)g.pop().subscription.unsubscribe()}var d={bind:C,unbind:y,unsubscribe:S,persistent:u};return e.propertyLinkMap[c]=d,d};function s(){for(var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:br,u=[],v=e.proxyId,g=o(c)||[],p=0;p<g.length;p++){var l=g[p],h=t["get".concat(Ne(l))],y=h?h():void 0,C={id:v,name:l,value:y},S=s(l);S.length&&(C.children=S),u.push(C)}return u}t.listPropertyNames=function(){return s().map(function(c){return c.name})},t.getPropertyByName=function(c){return s().find(function(u){return u.name===c})},t.getPropertyDomainByName=function(c){return(n[c]||{}).domain},t.getProxySection=function(){return{id:e.proxyId,name:e.proxyGroup,ui:e.ui,properties:s()}},t.delete=function(){for(var c=Object.keys(e.propertyLinkMap),u=c.length;u--;)e.propertyLinkMap[c[u]].unsubscribe();Object.keys(e.propertyLinkSubscribers).forEach(t.gcPropertyLinks),r()},t.getState=function(){return null};function f(){if(e.links)for(var c=0;c<e.links.length;c++){var u=e.links[c],v=u.link,g=u.property,p=u.persistent,l=u.updateOnBind,h=u.type;if(h==="application"){var y=e.proxyManager.getPropertyLink(v,p);t.registerPropertyLinkForGC(y,"application"),y.bind(t,g,l)}}}$f(f)}function Yf(t,e,r){for(var n=t.delete,a=[],i=Object.keys(r),o=i.length;o--;){var s=i[o],f=r[s],c=f.modelKey,u=f.property,v=f.modified,g=v===void 0?!0:v,p=Ne(u),l=Ne(s);t["get".concat(l)]=e[c]["get".concat(p)],t["set".concat(l)]=e[c]["set".concat(p)],g&&a.push(e[c].onModified(t.modified))}t.delete=function(){for(;a.length;)a.pop().unsubscribe();n()}}function kl(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};e.this=t;function a(f){for(var c=Object.keys(f),u=c.length;u--;){var v=c[u];e[v].set(f[v])}}for(var i=Object.keys(n),o=i.length,s=function(){var c=i[o];e[c]=n[c];var u=r[c];t["set".concat(Ne(c))]=function(v){if(v!==e[c]){e[c]=v;var g=u[v];a(g),t.modified()}}};o--;)s();i.length&&ot(t,e,i)}var vs=10,ps=40,ls=800;function Fl(t){var e=0,r=0,n=0,a=0;return"detail"in t&&(r=t.detail),"wheelDelta"in t&&(r=-t.wheelDelta/120),"wheelDeltaY"in t&&(r=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=r,r=0),n=e*vs,a=r*vs,"deltaY"in t&&(a=t.deltaY),"deltaX"in t&&(n=t.deltaX),(n||a)&&t.deltaMode&&(t.deltaMode===1?(n*=ps,a*=ps):(n*=ls,a*=ls)),n&&!e&&(e=n<1?-1:1),a&&!r&&(r=a<1?-1:1),{spinX:e,spinY:r,pixelX:n,pixelY:a}}var T={algo:Hf,capitalize:po,chain:$n,debounce:Vl,enumToString:Ml,event:xa,EVENT_ABORT:Kf,formatBytesToProperUnit:Ol,formatNumbersWithThousandSeparator:wl,get:ot,getArray:Pa,getCurrentGlobalMTime:ll,getStateArrayMapFunc:Wf,isVtkObject:Pf,keystore:Xf,measurePromiseExecution:Dl,moveToProtected:_r,newInstance:ke,newTypedArray:Ha,newTypedArrayFrom:vo,normalizeWheel:Fl,obj:_e,proxy:lo,proxyPropertyMapping:Yf,proxyPropertyState:kl,safeArrays:jf,set:Ka,setArray:zf,setGet:ze,setGetArray:bf,setImmediate:$f,setLoggerFunction:yl,throttle:Ll,traverseInstanceTree:_i,TYPED_ARRAYS:nt,uncapitalize:dl,VOID:pl,vtkDebugMacro:dn,vtkErrorMacro:ae,vtkInfoMacro:Cl,vtkLogMacro:Tl,vtkOnceErrorMacro:Sl,vtkWarningMacro:qn},Nl=T.vtkErrorMacro,Ul=["Build","Render"];function Gl(t,e){e.classHierarchy.push("vtkViewNode"),t.build=function(n){},t.render=function(n){},t.traverse=function(n){var a=n.getTraverseOperation(),i=t[a];if(i){i(n);return}t.apply(n,!0);for(var o=0;o<e.children.length;o++)e.children[o].traverse(n);t.apply(n,!1)},t.apply=function(n,a){var i=t[n.getOperation()];i&&i(a,n)},t.getViewNodeFor=function(n){if(e.renderable===n)return t;for(var a=0;a<e.children.length;++a){var i=e.children[a],o=i.getViewNodeFor(n);if(o)return o}},t.getFirstAncestorOfType=function(n){return e._parent?e._parent.isA(n)?e._parent:e._parent.getFirstAncestorOfType(n):null},t.addMissingNode=function(n){if(n){var a=e._renderableChildMap.get(n);if(a!==void 0)a.setVisited(!0);else{var i=t.createViewNode(n);i&&(i.setParent(t),i.setVisited(!0),e._renderableChildMap.set(n,i),e.children.push(i))}}},t.addMissingNodes=function(n){if(!(!n||!n.length))for(var a=0;a<n.length;++a){var i=n[a],o=e._renderableChildMap.get(i);if(o!==void 0)o.setVisited(!0);else{var s=t.createViewNode(i);s&&(s.setParent(t),s.setVisited(!0),e._renderableChildMap.set(i,s),e.children.push(s))}}},t.addMissingChildren=function(n){if(!(!n||!n.length))for(var a=0;a<n.length;++a){var i=n[a],o=e.children.indexOf(i);o===-1&&(i.setParent(t),e.children.push(i)),i.setVisited(!0)}},t.prepareNodes=function(){for(var n=0;n<e.children.length;++n)e.children[n].setVisited(!1)},t.setVisited=function(n){e.visited=n},t.removeUnusedNodes=function(){for(var n=null,a=0;a<e.children.length;++a){var i=e.children[a],o=i.getVisited();if(o)i.setVisited(!1);else{var s=i.getRenderable();s&&e._renderableChildMap.delete(s),n||(n=[]),n.push(i),i.delete()}}n&&(e.children=e.children.filter(function(f){return!n.includes(f)}))},t.createViewNode=function(n){if(!e.myFactory)return Nl("Cannot create view nodes without my own factory"),null;var a=e.myFactory.createNode(n);return a&&a.setRenderable(n),a};var r=t.delete;t.delete=function(){for(var n=0;n<e.children.length;n++)e.children[n].delete();r()}}var Bl={renderable:null,myFactory:null,children:[],visited:!1};function Af(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Bl,r),T.obj(t,e),T.event(t,e,"event"),e._renderableChildMap=new Map,T.get(t,e,["visited"]),T.setGet(t,e,["_parent","renderable","myFactory"]),T.getArray(t,e,["children"]),T.moveToProtected(t,e,["parent"]),Gl(t,e)}var _l=T.newInstance(Af,"vtkViewNode"),Qe={newInstance:_l,extend:Af,PASS_TYPES:Ul};function jl(t,e){e.overrides||(e.overrides={}),e.classHierarchy.push("vtkViewNodeFactory"),t.createNode=function(r){if(r.isDeleted())return null;for(var n=0,a=r.getClassName(n++),i=!1,o=Object.keys(e.overrides);a&&!i;)o.indexOf(a)!==-1?i=!0:a=r.getClassName(n++);if(!i)return null;var s=e.overrides[a]();return s.setMyFactory(t),s},t.registerOverride=function(r,n){e.overrides[r]=n}}var Wl={};function Zf(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Wl,r),T.obj(t,e),jl(t,e)}var $l=T.newInstance(Zf,"vtkViewNodeFactory"),zl={newInstance:$l,extend:Zf},qf=Object.create(null);function Ie(t,e){qf[t]=e}function bl(t,e){e.classHierarchy.push("vtkOpenGLViewNodeFactory")}var Hl={};function Jf(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Hl,r),e.overrides=qf,zl.extend(t,e,r),bl(t,e)}var Kl=T.newInstance(Jf,"vtkOpenGLViewNodeFactory"),Pl={newInstance:Kl,extend:Jf};function Xl(t,e){e.classHierarchy.push("vtkOpenGLCamera"),t.buildPass=function(r){r&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext())},t.opaquePass=function(r){if(r){var n=e._openGLRenderer.getTiledSizeAndOrigin();e.context.viewport(n.lowerLeftU,n.lowerLeftV,n.usize,n.vsize),e.context.scissor(n.lowerLeftU,n.lowerLeftV,n.usize,n.vsize)}},t.translucentPass=t.opaquePass,t.zBufferPass=t.opaquePass,t.opaqueZBufferPass=t.opaquePass,t.volumePass=t.opaquePass,t.getKeyMatrices=function(r){if(r!==e.lastRenderer||e._openGLRenderWindow.getMTime()>e.keyMatrixTime.getMTime()||t.getMTime()>e.keyMatrixTime.getMTime()||r.getMTime()>e.keyMatrixTime.getMTime()||e.renderable.getMTime()>e.keyMatrixTime.getMTime()){Ae(e.keyMatrices.wcvc,e.renderable.getViewMatrix()),za(e.keyMatrices.normalMatrix,e.keyMatrices.wcvc),ba(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),he(e.keyMatrices.wcvc,e.keyMatrices.wcvc);var n=e._openGLRenderer.getAspectRatio();Ae(e.keyMatrices.vcpc,e.renderable.getProjectionMatrix(n,-1,1)),he(e.keyMatrices.vcpc,e.keyMatrices.vcpc),Ee(e.keyMatrices.wcpc,e.keyMatrices.vcpc,e.keyMatrices.wcvc),e.keyMatrixTime.modified(),e.lastRenderer=r}return e.keyMatrices}}var Yl={context:null,lastRenderer:null,keyMatrixTime:null,keyMatrices:null};function Al(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Yl,r),Qe.extend(t,e,r),e.keyMatrixTime={},_e(e.keyMatrixTime),e.keyMatrices={normalMatrix:new Float64Array(9),vcpc:new Float64Array(16),wcvc:new Float64Array(16),wcpc:new Float64Array(16)},ze(t,e,["context","keyMatrixTime"]),Xl(t,e)}var Zl=ke(Al);Ie("vtkCamera",Zl);var ql=dn;function Jl(t,e){e.classHierarchy.push("vtkOpenGLRenderer"),t.buildPass=function(r){if(r){if(!e.renderable)return;t.updateLights(),t.prepareNodes(),t.addMissingNode(e.renderable.getActiveCamera()),t.addMissingNodes(e.renderable.getViewPropsWithNestedProps()),t.removeUnusedNodes()}},t.updateLights=function(){for(var r=0,n=e.renderable.getLightsByReference(),a=0;a<n.length;++a)n[a].getSwitch()>0&&r++;return r||(ql("No lights are on, creating one."),e.renderable.createLight()),r},t.zBufferPass=function(r){if(r){var n=0,a=e.context;e.renderable.getTransparent()||(e.context.clearColor(1,0,0,1),n|=a.COLOR_BUFFER_BIT),e.renderable.getPreserveDepthBuffer()||(a.clearDepth(1),n|=a.DEPTH_BUFFER_BIT,e.context.depthMask(!0));var i=t.getTiledSizeAndOrigin();a.enable(a.SCISSOR_TEST),a.scissor(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),a.viewport(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),a.colorMask(!0,!0,!0,!0),n&&a.clear(n),a.enable(a.DEPTH_TEST)}},t.opaqueZBufferPass=function(r){return t.zBufferPass(r)},t.cameraPass=function(r){r&&t.clear()},t.getAspectRatio=function(){var r=e._parent.getSizeByReference(),n=e.renderable.getViewportByReference();return r[0]*(n[2]-n[0])/((n[3]-n[1])*r[1])},t.getTiledSizeAndOrigin=function(){var r=e.renderable.getViewportByReference(),n=[0,0,1,1],a=r[0]-n[0],i=r[1]-n[1],o=e._parent.normalizedDisplayToDisplay(a,i),s=Math.round(o[0]),f=Math.round(o[1]),c=r[2]-n[0],u=r[3]-n[1],v=e._parent.normalizedDisplayToDisplay(c,u),g=Math.round(v[0])-s,p=Math.round(v[1])-f;return g<0&&(g=0),p<0&&(p=0),{usize:g,vsize:p,lowerLeftU:s,lowerLeftV:f}},t.clear=function(){var r=0,n=e.context;if(!e.renderable.getTransparent()){var a=e.renderable.getBackgroundByReference();e.context.clearColor(a[0],a[1],a[2],a[3]),r|=n.COLOR_BUFFER_BIT}e.renderable.getPreserveDepthBuffer()||(n.clearDepth(1),r|=n.DEPTH_BUFFER_BIT,e.context.depthMask(!0)),n.colorMask(!0,!0,!0,!0);var i=t.getTiledSizeAndOrigin();n.enable(n.SCISSOR_TEST),n.scissor(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),n.viewport(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),r&&n.clear(r),n.enable(n.DEPTH_TEST)},t.releaseGraphicsResources=function(){e.selector!==null&&e.selector.releaseGraphicsResources()},t.setOpenGLRenderWindow=function(r){e._openGLRenderWindow!==r&&(t.releaseGraphicsResources(),e._openGLRenderWindow=r,e.context=null,r&&(e.context=e._openGLRenderWindow.getContext()))}}var Ql={context:null,selector:null};function Il(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ql,r),Qe.extend(t,e,r),ot(t,e,["shaderCache"]),ze(t,e,["selector"]),_r(t,e,["openGLRenderWindow"]),Jl(t,e)}var eh=ke(Il,"vtkOpenGLRenderer");Ie("vtkRenderer",eh);function th(t,e){e.classHierarchy.push("vtkOpenGLActor"),t.buildPass=function(r){if(r){e._openGLRenderWindow=t.getFirstAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNodes(e.renderable.getTextures()),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes(),e.ogltextures=null,e.activeTextures=null;for(var n=0;n<e.children.length;n++){var a=e.children[n];a.isA("vtkOpenGLTexture")?(e.ogltextures||(e.ogltextures=[]),e.ogltextures.push(a)):e.oglmapper=a}}},t.traverseZBufferPass=function(r){!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.traverseOpaqueZBufferPass=function(r){return t.traverseOpaquePass(r)},t.traverseOpaquePass=function(r){!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.traverseTranslucentPass=function(r){!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.activateTextures=function(){if(e.ogltextures){e.activeTextures=[];for(var r=0;r<e.ogltextures.length;r++){var n=e.ogltextures[r];n.render(),n.getHandle()&&e.activeTextures.push(n)}}},t.queryPass=function(r,n){if(r){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?n.incrementOpaqueActorCount():n.incrementTranslucentActorCount()}},t.zBufferPass=function(r,n){return t.opaquePass(r,n)},t.opaqueZBufferPass=function(r,n){return t.opaquePass(r,n)},t.opaquePass=function(r,n){if(r)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(var a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()},t.translucentPass=function(r,n){if(r)e.context.depthMask(!1),t.activateTextures();else if(e.activeTextures)for(var a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()},t.getKeyMatrices=function(){return e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(e.renderable.computeMatrix(),Ae(e.keyMatrices.mcwc,e.renderable.getMatrix()),he(e.keyMatrices.mcwc,e.keyMatrices.mcwc),e.renderable.getIsIdentity()?_t(e.keyMatrices.normalMatrix):(za(e.keyMatrices.normalMatrix,e.keyMatrices.mcwc),ba(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),mf(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),e.keyMatrixTime.modified()),e.keyMatrices}}var nh={context:null,keyMatrixTime:null,keyMatrices:null,activeTextures:null};function rh(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nh,r),Qe.extend(t,e,r),e.keyMatrixTime={},_e(e.keyMatrixTime,{mtime:0}),e.keyMatrices={normalMatrix:_t(new Float64Array(9)),mcwc:I(new Float64Array(16))},ze(t,e,["context"]),ot(t,e,["activeTextures"]),th(t,e)}var ah=ke(rh);Ie("vtkActor",ah);function ih(t,e){e.classHierarchy.push("vtkOpenGLActor2D"),t.buildPass=function(r){if(r){if(!e.renderable)return;e._openGLRenderWindow=t.getFirstAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNodes(e.renderable.getTextures()),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes(),e.ogltextures=null,e.activeTextures=null;for(var n=0;n<e.children.length;n++){var a=e.children[n];a.isA("vtkOpenGLTexture")?(e.ogltextures||(e.ogltextures=[]),e.ogltextures.push(a)):e.oglmapper=a}}},t.queryPass=function(r,n){if(r){if(!e.renderable||!e.renderable.getVisibility())return;n.incrementOverlayActorCount()}},t.traverseOpaquePass=function(r){!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.traverseTranslucentPass=function(r){!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.traverseOverlayPass=function(r){!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.activateTextures=function(){if(e.ogltextures){e.activeTextures=[];for(var r=0;r<e.ogltextures.length;r++){var n=e.ogltextures[r];n.render(),n.getHandle()&&e.activeTextures.push(n)}}},t.opaquePass=function(r,n){if(r)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(var a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()},t.translucentPass=function(r,n){if(r)e.context.depthMask(!1),t.activateTextures();else if(e.activeTextures)for(var a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()},t.overlayPass=function(r,n){if(r)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(var a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()}}var oh={context:null,activeTextures:null};function sh(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,oh,r),Qe.extend(t,e,r),ze(t,e,["context"]),ot(t,e,["activeTextures"]),ih(t,e)}var uh=ke(sh);Ie("vtkActor2D",uh);var xr={ARRAY_BUFFER:0,ELEMENT_ARRAY_BUFFER:1,TEXTURE_BUFFER:2},Qf={ObjectType:xr};function hs(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function ys(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?hs(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):hs(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var ga=Qf.ObjectType,fh={};function ch(t,e){e.classHierarchy.push("vtkOpenGLBufferObject");function r(s){switch(s){case ga.ELEMENT_ARRAY_BUFFER:return e.context.ELEMENT_ARRAY_BUFFER;case ga.TEXTURE_BUFFER:if("TEXTURE_BUFFER"in e.context)return e.context.TEXTURE_BUFFER;case ga.ARRAY_BUFFER:default:return e.context.ARRAY_BUFFER}}var n=null,a=null,i=!0,o="";t.getType=function(){return n},t.setType=function(s){n=s},t.getHandle=function(){return a},t.isReady=function(){return i===!1},t.generateBuffer=function(s){var f=r(s);return a===null&&(a=e.context.createBuffer(),n=s),r(n)===f},t.upload=function(s,f){var c=t.generateBuffer(f);return c?(e.context.bindBuffer(r(n),a),e.context.bufferData(r(n),s,e.context.STATIC_DRAW),i=!1,!0):(o="Trying to upload array buffer to incompatible buffer.",!1)},t.bind=function(){return a?(e.context.bindBuffer(r(n),a),!0):!1},t.release=function(){return a?(e.context.bindBuffer(r(n),null),!0):!1},t.releaseGraphicsResources=function(){a!==null&&(e.context.bindBuffer(r(n),null),e.context.deleteBuffer(a),a=null)},t.setOpenGLRenderWindow=function(s){e._openGLRenderWindow!==s&&(t.releaseGraphicsResources(),e._openGLRenderWindow=s,e.context=null,s&&(e.context=e._openGLRenderWindow.getContext()))},t.getError=function(){return o}}var gh={objectType:ga.ARRAY_BUFFER,context:null};function If(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,gh,r),T.obj(t,e),T.get(t,e,["_openGLRenderWindow"]),T.moveToProtected(t,e,["openGLRenderWindow"]),ch(t,e)}var vh=T.newInstance(If),Tn=ys(ys({newInstance:vh,extend:If},fh),Qf),ec={FLAT:0,GOURAUD:1,PHONG:2},Je={POINTS:0,WIREFRAME:1,SURFACE:2},ph=ec,ho={Shading:ec,Representation:Je,Interpolation:ph},Ts=T.vtkErrorMacro;function lh(t,e){var r=new Float64Array(3);z0(r,e);var n=new Float64Array(16);return kf(n,Hn(),t,r),n}function hh(t,e){return t===null||e===null?!1:!(rs(t,[0,0,0])&&rs(e,[1,1,1]))}function yh(t,e){e.classHierarchy.push("vtkOpenGLCellArrayBufferObject"),t.setType(xr.ARRAY_BUFFER),t.createVBO=function(r,n,a,i){var o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;if(!r.getData()||!r.getData().length)return e.elementCount=0,0;e.blockSize=3,e.vertexOffset=0,e.normalOffset=0,e.tCoordOffset=0,e.tCoordComponents=0,e.colorComponents=0,e.colorOffset=0,e.customData=[];var s=i.points.getData(),f=null,c=null,u=null,v=i.colors?i.colors.getNumberOfComponents():0,g=i.tcoords?i.tcoords.getNumberOfComponents():0;i.normals&&(e.normalOffset=4*e.blockSize,e.blockSize+=3,f=i.normals.getData()),i.customAttributes&&i.customAttributes.forEach(function(te){te&&(e.customData.push({data:te.getData(),offset:4*e.blockSize,components:te.getNumberOfComponents(),name:te.getName()}),e.blockSize+=te.getNumberOfComponents())}),i.tcoords&&(e.tCoordOffset=4*e.blockSize,e.tCoordComponents=g,e.blockSize+=g,c=i.tcoords.getData()),i.colors?(e.colorComponents=i.colors.getNumberOfComponents(),e.colorOffset=0,u=i.colors.getData(),e.colorBO||(e.colorBO=Tn.newInstance()),e.colorBO.setOpenGLRenderWindow(e._openGLRenderWindow)):e.colorBO=null,e.stride=4*e.blockSize;var p=0,l=0,h=0,y=0,C=0,S=0,d,O={anythingToPoints:function($,z,re){for(var P=0;P<$;++P)d(z[re+P])},linesToWireframe:function($,z,re){for(var P=0;P<$-1;++P)d(z[re+P]),d(z[re+P+1])},polysToWireframe:function($,z,re){if($>2)for(var P=0;P<$;++P)d(z[re+P]),d(z[re+(P+1)%$])},stripsToWireframe:function($,z,re){if($>2){for(var P=0;P<$-1;++P)d(z[re+P]),d(z[re+P+1]);for(var Le=0;Le<$-2;Le++)d(z[re+Le]),d(z[re+Le+2])}},polysToSurface:function($,z,re){for(var P=0;P<$-2;P++)d(z[re+0]),d(z[re+P+1]),d(z[re+P+2])},stripsToSurface:function($,z,re){for(var P=0;P<$-2;P++)d(z[re+P]),d(z[re+P+1+P%2]),d(z[re+P+1+(P+1)%2])}},w={anythingToPoints:function($,z){return $},linesToWireframe:function($,z){return $>1?($-1)*2:0},polysToWireframe:function($,z){return $>2?$*2:0},stripsToWireframe:function($,z){return $>2?$*4-6:0},polysToSurface:function($,z){return $>2?($-2)*3:0},stripsToSurface:function($,z,re){return $>2?($-2)*3:0}},M=null,x=null;a===Je.POINTS||n==="verts"?(M=O.anythingToPoints,x=w.anythingToPoints):a===Je.WIREFRAME||n==="lines"?(M=O["".concat(n,"ToWireframe")],x=w["".concat(n,"ToWireframe")]):(M=O["".concat(n,"ToSurface")],x=w["".concat(n,"ToSurface")]);for(var D=r.getData(),R=D.length,V=0,E=0;E<R;)V+=x(D[E],D),E+=D[E]+1;var L=null,m=new Float32Array(V*e.blockSize);u&&(L=new Uint8Array(V*4));for(var N=0,_=0,G=0,k=0,U=0;U<3;++U){var B=i.points.getRange(U),j=B[1]-B[0];G+=j*j;var H=.5*(B[1]+B[0]);k+=H*H}var X=G>0&&(Math.abs(k)/G>1e6||Math.abs(Math.log10(G))>3||G===0&&k>1e6);if(X){for(var Y=new Float64Array(3),ee=new Float64Array(3),ce=0;ce<3;++ce){var Z=i.points.getRange(ce),Ce=Z[1]-Z[0];Y[ce]=.5*(Z[1]+Z[0]),ee[ce]=Ce>0?1/Ce:1}t.setCoordShiftAndScale(Y,ee)}else e.coordShiftAndScaleEnabled===!0&&t.setCoordShiftAndScale(null,null);if(o)if(!o.points&&!o.cells)o.points=new Int32Array(V),o.cells=new Int32Array(V);else{var q=new Int32Array(V+o.points.length);q.set(o.points),o.points=q;var De=new Int32Array(V+o.cells.length);De.set(o.cells),o.cells=De}var K=i.vertexOffset;d=function($){if(o&&(o.points[K]=$,o.cells[K]=S+i.cellOffset),++K,p=$*3,e.coordShiftAndScaleEnabled?(m[N++]=(s[p++]-e.coordShift[0])*e.coordScale[0],m[N++]=(s[p++]-e.coordShift[1])*e.coordScale[1],m[N++]=(s[p++]-e.coordShift[2])*e.coordScale[2]):(m[N++]=s[p++],m[N++]=s[p++],m[N++]=s[p++]),f!==null&&(i.haveCellNormals?l=(S+i.cellOffset)*3:l=$*3,m[N++]=f[l++],m[N++]=f[l++],m[N++]=f[l++]),e.customData.forEach(function(re){C=$*re.components;for(var P=0;P<re.components;++P)m[N++]=re.data[C++]}),c!==null){h=$*g;for(var z=0;z<g;++z)m[N++]=c[h++]}u!==null&&(i.haveCellScalars?y=(S+i.cellOffset)*v:y=$*v,L[_++]=u[y++],L[_++]=u[y++],L[_++]=u[y++],L[_++]=v===4?u[y++]:255)};for(var fe=0;fe<R;)M(D[fe],D,fe+1),fe+=D[fe]+1,S++;return e.elementCount=V,t.upload(m,xr.ARRAY_BUFFER),e.colorBO&&(e.colorBOStride=4,e.colorBO.upload(L,xr.ARRAY_BUFFER)),S},t.setCoordShiftAndScale=function(r,n){if(r!==null&&(r.constructor!==Float64Array||r.length!==3)){Ts("Wrong type for coordShift, expected vec3 or null");return}if(n!==null&&(n.constructor!==Float64Array||n.length!==3)){Ts("Wrong type for coordScale, expected vec3 or null");return}(e.coordShift===null||r===null||!ns(r,e.coordShift))&&(e.coordShift=r),(e.coordScale===null||n===null||!ns(n,e.coordScale))&&(e.coordScale=n),e.coordShiftAndScaleEnabled=hh(e.coordShift,e.coordScale),e.coordShiftAndScaleEnabled?e.inverseShiftAndScaleMatrix=lh(e.coordShift,e.coordScale):e.inverseShiftAndScaleMatrix=null}}var Th={elementCount:0,stride:0,colorBOStride:0,vertexOffset:0,normalOffset:0,tCoordOffset:0,tCoordComponents:0,colorOffset:0,colorComponents:0,tcoordBO:null,customData:[],coordShift:null,coordScale:null,coordShiftAndScaleEnabled:!1,inverseShiftAndScaleMatrix:null};function tc(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Th,r),Tn.extend(t,e,r),T.setGet(t,e,["colorBO","elementCount","stride","colorBOStride","vertexOffset","normalOffset","tCoordOffset","tCoordComponents","colorOffset","colorComponents","customData"]),T.get(t,e,["coordShift","coordScale","coordShiftAndScaleEnabled","inverseShiftAndScaleMatrix"]),yh(t,e)}var Ch=T.newInstance(tc),Sh={newInstance:Ch,extend:tc},dh=T.vtkErrorMacro;function Oh(t,e){e.classHierarchy.push("vtkShader"),t.compile=function(){var r=e.context.VERTEX_SHADER;if(!e.source||!e.source.length||e.shaderType==="Unknown")return!1;switch(e.handle!==0&&(e.context.deleteShader(e.handle),e.handle=0),e.shaderType){case"Fragment":r=e.context.FRAGMENT_SHADER;break;case"Vertex":default:r=e.context.VERTEX_SHADER;break}e.handle=e.context.createShader(r),e.context.shaderSource(e.handle,e.source),e.context.compileShader(e.handle);var n=e.context.getShaderParameter(e.handle,e.context.COMPILE_STATUS);if(!n){var a=e.context.getShaderInfoLog(e.handle);return dh("Error compiling shader '".concat(e.source,"': ").concat(a)),e.context.deleteShader(e.handle),e.handle=0,!1}return!0},t.cleanup=function(){e.shaderType==="Unknown"||e.handle===0||(e.context.deleteShader(e.handle),e.handle=0,e.dirty=!0)}}var wh={shaderType:"Unknown",source:"",error:"",handle:0,dirty:!1,context:null};function nc(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,wh,r),T.obj(t,e),T.setGet(t,e,["shaderType","source","error","handle","context"]),Oh(t,e)}var xh=T.newInstance(nc,"vtkShader"),si={newInstance:xh,extend:nc},Ot=T.vtkErrorMacro;function Mh(t,e,r,n){var a=typeof r=="string"?r:r.join(`
`),i=n===!1?e:new RegExp(e,"g"),o=t.replace(i,a);return{replace:o!==a,result:o}}function Dh(t,e){e.classHierarchy.push("vtkShaderProgram"),t.compileShader=function(){return e.vertexShader.compile()?e.fragmentShader.compile()?!t.attachShader(e.vertexShader)||!t.attachShader(e.fragmentShader)?(Ot(e.error),0):t.link()?(t.setCompiled(!0),1):(Ot("Links failed: ".concat(e.error)),0):(Ot(e.fragmentShader.getSource().split(`
`).map(function(r,n){return"".concat(n,": ").concat(r)}).join(`
`)),Ot(e.fragmentShader.getError()),0):(Ot(e.vertexShader.getSource().split(`
`).map(function(r,n){return"".concat(n,": ").concat(r)}).join(`
`)),Ot(e.vertexShader.getError()),0)},t.cleanup=function(){e.shaderType==="Unknown"||e.handle===0||(e.context.deleteShader(e.handle),e.handle=0)},t.bind=function(){return!e.linked&&!t.link()?!1:(e.context.useProgram(e.handle),t.setBound(!0),!0)},t.isBound=function(){return!!e.bound},t.release=function(){e.context.useProgram(null),t.setBound(!1)},t.setContext=function(r){e.vertexShader.setContext(r),e.fragmentShader.setContext(r),e.geometryShader.setContext(r)},t.link=function(){if(e.linked)return!0;if(e.handle===0)return e.error="Program has not been initialized, and/or does not have shaders.",!1;e.uniformLocs={},e.context.linkProgram(e.handle);var r=e.context.getProgramParameter(e.handle,e.context.LINK_STATUS);if(!r){var n=e.context.getProgramInfoLog(e.handle);return Ot("Error linking shader ".concat(n)),e.handle=0,!1}return t.setLinked(!0),e.attributeLocs={},!0},t.setUniformMatrix=function(r,n){var a=t.findUniform(r);if(a===-1)return e.error="Could not set uniform ".concat(r," . No such uniform."),!1;var i=new Float32Array(n);return e.context.uniformMatrix4fv(a,!1,i),!0},t.setUniformMatrix3x3=function(r,n){var a=t.findUniform(r);if(a===-1)return e.error="Could not set uniform ".concat(r," . No such uniform."),!1;var i=new Float32Array(n);return e.context.uniformMatrix3fv(a,!1,i),!0},t.setUniformf=function(r,n){var a=t.findUniform(r);return a===-1?(e.error="Could not set uniform ".concat(r," . No such uniform."),!1):(e.context.uniform1f(a,n),!0)},t.setUniformfv=function(r,n){var a=t.findUniform(r);return a===-1?(e.error="Could not set uniform ".concat(r," . No such uniform."),!1):(e.context.uniform1fv(a,n),!0)},t.setUniformi=function(r,n){var a=t.findUniform(r);return a===-1?(e.error="Could not set uniform ".concat(r," . No such uniform."),!1):(e.context.uniform1i(a,n),!0)},t.setUniformiv=function(r,n){var a=t.findUniform(r);return a===-1?(e.error="Could not set uniform ".concat(r," . No such uniform."),!1):(e.context.uniform1iv(a,n),!0)},t.setUniform2f=function(r,n,a){var i=t.findUniform(r);if(i===-1)return e.error="Could not set uniform ".concat(r," . No such uniform."),!1;if(a===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2f(i,n,a),!0},t.setUniform2fv=function(r,n){var a=t.findUniform(r);return a===-1?(e.error="Could not set uniform ".concat(r," . No such uniform."),!1):(e.context.uniform2fv(a,n),!0)},t.setUniform2i=function(r,n,a){var i=t.findUniform(r);if(i===-1)return e.error="Could not set uniform ".concat(r," . No such uniform."),!1;if(a===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2i(i,n,a),!0},t.setUniform2iv=function(r,n){var a=t.findUniform(r);return a===-1?(e.error="Could not set uniform ".concat(r," . No such uniform."),!1):(e.context.uniform2iv(a,n),!0)},t.setUniform3f=function(r,n,a,i){var o=t.findUniform(r);if(o===-1)return e.error="Could not set uniform ".concat(r," . No such uniform."),!1;if(i===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(o,n,a,i),!0},t.setUniform3fArray=function(r,n){var a=t.findUniform(r);if(a===-1)return e.error="Could not set uniform ".concat(r," . No such uniform."),!1;if(!Array.isArray(n)||n.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(a,n[0],n[1],n[2]),!0},t.setUniform3fv=function(r,n){var a=t.findUniform(r);return a===-1?(e.error="Could not set uniform ".concat(r," . No such uniform."),!1):(e.context.uniform3fv(a,n),!0)},t.setUniform3i=function(r){var n=t.findUniform(r);if(n===-1)return e.error="Could not set uniform ".concat(r," . No such uniform."),!1;for(var a=arguments.length,i=new Array(a>1?a-1:0),o=1;o<a;o++)i[o-1]=arguments[o];var s=i;if(s.length===1&&Array.isArray(s[0])&&(s=s[0]),s.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3i(n,s[0],s[1],s[2]),!0},t.setUniform3iv=function(r,n){var a=t.findUniform(r);return a===-1?(e.error="Could not set uniform ".concat(r," . No such uniform."),!1):(e.context.uniform3iv(a,n),!0)},t.setUniform4f=function(r){var n=t.findUniform(r);if(n===-1)return e.error="Could not set uniform ".concat(r," . No such uniform."),!1;for(var a=arguments.length,i=new Array(a>1?a-1:0),o=1;o<a;o++)i[o-1]=arguments[o];var s=i;if(s.length===1&&Array.isArray(s[0])&&(s=s[0]),s.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4f(n,s[0],s[1],s[2],s[3]),!0},t.setUniform4fv=function(r,n){var a=t.findUniform(r);return a===-1?(e.error="Could not set uniform ".concat(r," . No such uniform."),!1):(e.context.uniform4fv(a,n),!0)},t.setUniform4i=function(r){var n=t.findUniform(r);if(n===-1)return e.error="Could not set uniform ".concat(r," . No such uniform."),!1;for(var a=arguments.length,i=new Array(a>1?a-1:0),o=1;o<a;o++)i[o-1]=arguments[o];var s=i;if(s.length===1&&Array.isArray(s[0])&&(s=s[0]),s.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4i(n,s[0],s[1],s[2],s[3]),!0},t.setUniform4iv=function(r,n){var a=t.findUniform(r);return a===-1?(e.error="Could not set uniform ".concat(r," . No such uniform."),!1):(e.context.uniform4iv(a,n),!0)},t.findUniform=function(r){if(!r||!e.linked)return-1;var n=e.uniformLocs[r];return n!==void 0?n:(n=e.context.getUniformLocation(e.handle,r),n===null?(e.error="Uniform ".concat(r," not found in current shader program."),e.uniformLocs[r]=-1,-1):(e.uniformLocs[r]=n,n))},t.isUniformUsed=function(r){if(!r)return!1;var n=e.uniformLocs[r];return n!==void 0?n!==null:e.linked?(n=e.context.getUniformLocation(e.handle,r),e.uniformLocs[r]=n,n!==null):(Ot("attempt to find uniform when the shader program is not linked"),!1)},t.isAttributeUsed=function(r){if(!r)return!1;if(r in e.attributeLocs)return!0;if(!e.linked)return Ot("attempt to find uniform when the shader program is not linked"),!1;var n=e.context.getAttribLocation(e.handle,r);return n===-1?!1:(e.attributeLocs[r]=n,!0)},t.attachShader=function(r){if(r.getHandle()===0)return e.error="Shader object was not initialized, cannot attach it.",!1;if(r.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;if(e.handle===0){var n=e.context.createProgram();if(n===0)return e.error="Could not create shader program.",!1;e.handle=n,e.linked=!1}return r.getShaderType()==="Vertex"&&(e.vertexShaderHandle!==0&&e.comntext.detachShader(e.handle,e.vertexShaderHandle),e.vertexShaderHandle=r.getHandle()),r.getShaderType()==="Fragment"&&(e.fragmentShaderHandle!==0&&e.context.detachShader(e.handle,e.fragmentShaderHandle),e.fragmentShaderHandle=r.getHandle()),e.context.attachShader(e.handle,r.getHandle()),t.setLinked(!1),!0},t.detachShader=function(r){if(r.getHandle()===0)return e.error="shader object was not initialized, cannot attach it.",!1;if(r.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;switch(e.handle===0&&(e.error="This shader program has not been initialized yet."),r.getShaderType()){case"Vertex":return e.vertexShaderHandle!==r.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,r.getHandle()),e.vertexShaderHandle=0,e.linked=!1,!0);case"Fragment":return e.fragmentShaderHandle!==r.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,r.getHandle()),e.fragmentShaderHandle=0,e.linked=!1,!0);default:return!1}},t.setContext=function(r){e.context=r,e.vertexShader.setContext(r),e.fragmentShader.setContext(r),e.geometryShader.setContext(r)},t.setLastCameraMTime=function(r){e.lastCameraMTime=r}}var Eh={vertexShaderHandle:0,fragmentShaderHandle:0,geometryShaderHandle:0,vertexShader:null,fragmentShader:null,geometryShader:null,linked:!1,bound:!1,compiled:!1,error:"",handle:0,numberOfOutputs:0,attributesLocs:null,uniformLocs:null,md5Hash:0,context:null,lastCameraMTime:null};function rc(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Eh,r),e.attributesLocs={},e.uniformLocs={},e.vertexShader=si.newInstance(),e.vertexShader.setShaderType("Vertex"),e.fragmentShader=si.newInstance(),e.fragmentShader.setShaderType("Fragment"),e.geometryShader=si.newInstance(),e.geometryShader.setShaderType("Geometry"),T.obj(t,e),T.get(t,e,["lastCameraMTime"]),T.setGet(t,e,["error","handle","compiled","bound","md5Hash","vertexShader","fragmentShader","geometryShader","linked"]),Dh(t,e)}var Rh=T.newInstance(rc,"vtkShaderProgram"),F={newInstance:Rh,extend:rc,substitute:Mh};function Vh(t,e){e.classHierarchy.push("vtkOpenGLVertexArrayObject"),t.exposedMethod=function(){},t.initialize=function(){e.instancingExtension=null,e._openGLRenderWindow.getWebgl2()||(e.instancingExtension=e.context.getExtension("ANGLE_instanced_arrays")),!e.forceEmulation&&e._openGLRenderWindow&&e._openGLRenderWindow.getWebgl2()?(e.extension=null,e.supported=!0,e.handleVAO=e.context.createVertexArray()):(e.extension=e.context.getExtension("OES_vertex_array_object"),!e.forceEmulation&&e.extension?(e.supported=!0,e.handleVAO=e.extension.createVertexArrayOES()):e.supported=!1)},t.isReady=function(){return e.handleVAO!==0||e.supported===!1},t.bind=function(){if(t.isReady()||t.initialize(),t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(e.handleVAO):e.context.bindVertexArray(e.handleVAO);else if(t.isReady())for(var r=e.context,n=0;n<e.buffers.length;++n){var a=e.buffers[n];e.context.bindBuffer(r.ARRAY_BUFFER,a.buffer);for(var i=0;i<a.attributes.length;++i)for(var o=a.attributes[i],s=o.isMatrix?o.size:1,f=0;f<s;++f)r.enableVertexAttribArray(o.index+f),r.vertexAttribPointer(o.index+f,o.size,o.type,o.normalize,o.stride,o.offset+o.stride*f/o.size),o.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(o.index+f,1):r.vertexAttribDivisor(o.index+f,1))}},t.release=function(){if(t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(null):e.context.bindVertexArray(null);else if(t.isReady())for(var r=e.context,n=0;n<e.buffers.length;++n){var a=e.buffers[n];e.context.bindBuffer(r.ARRAY_BUFFER,a.buffer);for(var i=0;i<a.attributes.length;++i)for(var o=a.attributes[i],s=o.isMatrix?o.size:1,f=0;f<s;++f)r.enableVertexAttribArray(o.index+f),r.vertexAttribPointer(o.index+f,o.size,o.type,o.normalize,o.stride,o.offset+o.stride*f/o.size),o.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(o.index+f,0):r.vertexAttribDivisor(o.index+f,0)),r.disableVertexAttribArray(o.index+f)}},t.shaderProgramChanged=function(){t.release(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.handleProgram=0},t.releaseGraphicsResources=function(){t.shaderProgramChanged(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.supported=!0,e.handleProgram=0},t.addAttributeArray=function(r,n,a,i,o,s,f,c){return t.addAttributeArrayWithDivisor(r,n,a,i,o,s,f,c,0,!1)},t.addAttributeArrayWithDivisor=function(r,n,a,i,o,s,f,c,u,v){if(!r||!r.isBound()||n.getHandle()===0||n.getType()!==xr.ARRAY_BUFFER||(e.handleProgram===0&&(e.handleProgram=r.getHandle()),t.isReady()||t.initialize(),!t.isReady()||e.handleProgram!==r.getHandle()))return!1;var g=e.context,p={};if(p.name=a,p.index=g.getAttribLocation(e.handleProgram,a),p.offset=i,p.stride=o,p.type=s,p.size=f,p.normalize=c,p.isMatrix=v,p.divisor=u,p.Index===-1)return!1;if(n.bind(),g.enableVertexAttribArray(p.index),g.vertexAttribPointer(p.index,p.size,p.type,p.normalize,p.stride,p.offset),u>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(p.index,1):g.vertexAttribDivisor(p.index,1)),p.buffer=n.getHandle(),!e.supported){for(var l=!1,h=0;h<e.buffers.length;++h){var y=e.buffers[h];if(y.buffer===p.buffer){l=!0;for(var C=!1,S=0;S<y.attributes.length;++S){var d=y.attributes[S];d.name===a&&(C=!0,y.attributes[S]=p)}C||y.attributes.push(p)}}l||e.buffers.push({buffer:p.buffer,attributes:[p]})}return!0},t.addAttributeMatrixWithDivisor=function(r,n,a,i,o,s,f,c,u){var v=t.addAttributeArrayWithDivisor(r,n,a,i,o,s,f,c,u,!0);if(!v)return v;for(var g=e.context,p=g.getAttribLocation(e.handleProgram,a),l=1;l<f;l++)g.enableVertexAttribArray(p+l),g.vertexAttribPointer(p+l,f,s,c,o,i+o*l/f),u>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(p+l,1):g.vertexAttribDivisor(p+l,1));return!0},t.removeAttributeArray=function(r){if(!t.isReady()||e.handleProgram===0)return!1;if(!e.supported)for(var n=0;n<e.buffers.length;++n)for(var a=e.buffers[n],i=0;i<a.attributes.length;++i){var o=a.attributes[i];if(o.name===r)return a.attributes.splice(i,1),a.attributes.length||e.buffers.splice(n,1),!0}return!0},t.setOpenGLRenderWindow=function(r){e._openGLRenderWindow!==r&&(t.releaseGraphicsResources(),e._openGLRenderWindow=r,e.context=null,r&&(e.context=e._openGLRenderWindow.getContext()))}}var Lh={forceEmulation:!1,handleVAO:0,handleProgram:0,supported:!0,buffers:null,context:null};function ac(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Lh,r),e.buffers=[],T.obj(t,e),T.get(t,e,["supported"]),T.setGet(t,e,["forceEmulation"]),Vh(t,e)}var mh=T.newInstance(ac,"vtkOpenGLVertexArrayObject"),yo={newInstance:mh,extend:ac},Kt={Start:0,Points:0,Lines:1,Tris:2,TriStrips:3,TrisEdges:4,TriStripsEdges:5,End:6};function kh(t,e){e.classHierarchy.push("vtkOpenGLHelper"),t.setOpenGLRenderWindow=function(r){e.context=r.getContext(),e.program.setContext(e.context),e.VAO.setOpenGLRenderWindow(r),e.CABO.setOpenGLRenderWindow(r)},t.releaseGraphicsResources=function(r){e.VAO.releaseGraphicsResources(),e.CABO.releaseGraphicsResources(),e.CABO.setElementCount(0)},t.drawArrays=function(r,n,a,i){if(e.CABO.getElementCount()){var o=t.getOpenGLMode(a),s=t.haveWideLines(r,n),f=e.context,c=f.getParameter(f.DEPTH_WRITEMASK);e.pointPicking&&f.depthMask(!1);var u=o===f.LINES;u&&s?(t.updateShaders(r,n,i),f.drawArraysInstanced(o,0,e.CABO.getElementCount(),2*Math.ceil(n.getProperty().getLineWidth()))):(f.lineWidth(n.getProperty().getLineWidth()),t.updateShaders(r,n,i),f.drawArrays(o,0,e.CABO.getElementCount()),f.lineWidth(1));var v=(o===f.POINTS?1:0)||(o===f.LINES?2:3);return e.pointPicking&&f.depthMask(c),e.CABO.getElementCount()/v}return 0},t.getOpenGLMode=function(r){if(e.pointPicking)return e.context.POINTS;var n=e.primitiveType;return r===Je.POINTS||n===Kt.Points?e.context.POINTS:r===Je.WIREFRAME||n===Kt.Lines||n===Kt.TrisEdges||n===Kt.TriStripsEdges?e.context.LINES:e.context.TRIANGLES},t.haveWideLines=function(r,n){return n.getProperty().getLineWidth()>1?!(e.CABO.getOpenGLRenderWindow()&&e.CABO.getOpenGLRenderWindow().getHardwareMaximumLineWidth()>=n.getProperty().getLineWidth()):!1},t.getNeedToRebuildShaders=function(r,n,a){return!!(a.getNeedToRebuildShaders(t,r,n)||t.getProgram()===0||t.getShaderSourceTime().getMTime()<a.getMTime()||t.getShaderSourceTime().getMTime()<n.getMTime())},t.updateShaders=function(r,n,a){if(t.getNeedToRebuildShaders(r,n,a)){var i={Vertex:null,Fragment:null,Geometry:null};a.buildShaders(i,r,n);var o=e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgramArray(i.Vertex,i.Fragment,i.Geometry);o!==t.getProgram()&&(t.setProgram(o),t.getVAO().releaseGraphicsResources()),t.getShaderSourceTime().modified()}else e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgram(t.getProgram());t.getVAO().bind(),a.setMapperShaderParameters(t,r,n),a.setPropertyShaderParameters(t,r,n),a.setCameraShaderParameters(t,r,n),a.setLightingShaderParameters(t,r,n),a.invokeShaderCallbacks(t,r,n)},t.setMapperShaderParameters=function(r,n,a){if(t.haveWideLines(r,n)){t.getProgram().setUniform2f("viewportSize",a.usize,a.vsize);var i=parseFloat(n.getProperty().getLineWidth()),o=i/2;t.getProgram().setUniformf("lineWidthStepSize",i/Math.ceil(i)),t.getProgram().setUniformf("halfLineWidth",o)}e.primitiveType===Kt.Points||n.getProperty().getRepresentation()===Je.POINTS?t.getProgram().setUniformf("pointSize",n.getProperty().getPointSize()):e.pointPicking&&t.getProgram().setUniformf("pointSize",t.getPointPickingPrimitiveSize())},t.replaceShaderPositionVC=function(r,n,a){var i=r.Vertex;i=F.substitute(i,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform float pointSize;"]).result,i=F.substitute(i,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl","  gl_PointSize = pointSize;"],!1).result,t.getOpenGLMode(a.getProperty().getRepresentation())===e.context.LINES&&t.haveWideLines(n,a)&&(i=F.substitute(i,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform vec2 viewportSize;","uniform float lineWidthStepSize;","uniform float halfLineWidth;"]).result,i=F.substitute(i,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl"," if (halfLineWidth > 0.0)","   {","   float offset = float(gl_InstanceID / 2) * lineWidthStepSize - halfLineWidth;","   vec4 tmpPos = gl_Position;","   vec3 tmpPos2 = tmpPos.xyz / tmpPos.w;","   tmpPos2.x = tmpPos2.x + 2.0 * mod(float(gl_InstanceID), 2.0) * offset / viewportSize[0];","   tmpPos2.y = tmpPos2.y + 2.0 * mod(float(gl_InstanceID + 1), 2.0) * offset / viewportSize[1];","   gl_Position = vec4(tmpPos2.xyz * tmpPos.w, tmpPos.w);","   }"]).result),r.Vertex=i},t.getPointPickingPrimitiveSize=function(){return e.primitiveType===Kt.Points?2:e.primitiveType===Kt.Lines?4:6}}var Fh={context:null,program:null,shaderSourceTime:null,VAO:null,attributeUpdateTime:null,CABO:null,primitiveType:0,pointPicking:!1};function ic(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Fh,r),T.obj(t,e),e.shaderSourceTime={},T.obj(e.shaderSourceTime),e.attributeUpdateTime={},T.obj(e.attributeUpdateTime),T.setGet(t,e,["program","shaderSourceTime","VAO","attributeUpdateTime","CABO","primitiveType","pointPicking"]),e.program=F.newInstance(),e.VAO=yo.newInstance(),e.CABO=Sh.newInstance(),kh(t,e)}var Nh=T.newInstance(ic),$t={newInstance:Nh,extend:ic,primTypes:Kt};function Uh(t,e){e.classHierarchy.push("vtkAbstractMapper"),t.update=function(){t.getInputData()},t.addClippingPlane=function(r){return r.isA("vtkPlane")?e.clippingPlanes.includes(r)?!1:(e.clippingPlanes.push(r),t.modified(),!0):!1},t.getNumberOfClippingPlanes=function(){return e.clippingPlanes.length},t.removeAllClippingPlanes=function(){return e.clippingPlanes.length===0?!1:(e.clippingPlanes.length=0,t.modified(),!0)},t.removeClippingPlane=function(r){var n=e.clippingPlanes.indexOf(r);return n===-1?!1:(e.clippingPlanes.splice(n,1),t.modified(),!0)},t.getClippingPlanes=function(){return e.clippingPlanes},t.setClippingPlanes=function(r){if(r)if(!Array.isArray(r))t.addClippingPlane(r);else for(var n=r.length,a=0;a<n&&a<6;a++)t.addClippingPlane(r[a])},t.getClippingPlaneInDataCoords=function(r,n,a){var i=e.clippingPlanes,o=r;if(i){var s=i.length;if(n>=0&&n<s){var f=i[n],c=f.getNormal(),u=f.getOrigin(),v=c[0],g=c[1],p=c[2],l=-(v*u[0]+g*u[1]+p*u[2]);a[0]=v*o[0]+g*o[4]+p*o[8]+l*o[12],a[1]=v*o[1]+g*o[5]+p*o[9]+l*o[13],a[2]=v*o[2]+g*o[6]+p*o[10]+l*o[14],a[3]=v*o[3]+g*o[7]+p*o[11]+l*o[15];return}}T.vtkErrorMacro("Clipping plane index ".concat(n," is out of range."))}}var Gh={clippingPlanes:[]};function Bh(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Gh,r),T.obj(t,e),T.algo(t,e,1,0),e.clippingPlanes||(e.clippingPlanes=[]),Uh(t,e)}var To={extend:Bh},oc=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],_h=[1,0,0,0,1,0,0,0,1],Co=1e-6,So=1e-12,sc=T.vtkErrorMacro,On=T.vtkWarningMacro,uc=0,Cs=20;function jr(t){return function(){return sc("vtkMath::".concat(t," - NOT IMPLEMENTED"))}}function Mr(t,e,r,n){for(var a,i=0;i<e;i++)a=t[r*e+i],t[r*e+i]=t[n*e+i],t[n*e+i]=a}function fr(t,e,r,n){for(var a,i=0;i<e;i++)a=t[i*e+r],t[i*e+r]=t[i*e+n],t[i*e+n]=a}function xe(){for(var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,e=Array(t),r=0;r<t;++r)e[r]=0;return e}var jh=function(){return Math.PI};function de(t){return t/180*Math.PI}function Fr(t){return t*180/Math.PI}var Gt=Math.round,Nr=Math.floor,Wh=Math.ceil,$h=Math.min,zh=Math.max;function bh(t){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=1/0,a=e,i=t.length;a<i;a+=r)t[a]<n&&(n=t[a]);return n}function Hh(t){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=-1/0,a=e,i=t.length;a<i;a+=r)n<t[a]&&(n=t[a]);return n}function fc(t){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=1/0,a=-1/0,i=e,o=t.length;i<o;i+=r)t[i]<n&&(n=t[i]),a<t[i]&&(a=t[i]);return[n,a]}var Kh=jr("ceilLog2"),Ph=jr("factorial");function Zt(t){for(var e=1;e<t;)e*=2;return e}function cr(t){return t===Zt(t)}function Xh(t,e){for(var r=1,n=1;n<=e;++n)r*=(t-n+1)/n;return Math.floor(r)}function Yh(t,e){if(t<e)return 0;for(var r=xe(e),n=0;n<e;++n)r[n]=n;return r}function Ah(t,e,r){for(var n=0,a=e-1;a>=0;--a)if(r[a]<t-e+a){for(var i=r[a]+1;a<e;)r[a++]=i++;n=1;break}return n}function Zh(t){b0("".concat(t),{global:!0}),uc=t}function qh(){return uc}function Jh(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,r=e-t;return t+r*Math.random()}var Qh=jr("gaussian");function wn(t,e,r){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r}function tt(t,e,r){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r}function dt(t,e){return t[0]*=e,t[1]*=e,t[2]*=e,t}function cc(t,e){return t[0]*=e,t[1]*=e,t}function ji(t,e,r,n){return n[0]=t[0]+e[0]*r,n[1]=t[1]+e[1]*r,n[2]=t[2]+e[2]*r,n}function Ih(t,e,r,n){return n[0]=t[0]+e[0]*r,n[1]=t[1]+e[1]*r,n}function A(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ey(t,e,r){r[0]=t[0]*e[0],r[1]=t[0]*e[1],r[2]=t[0]*e[2],r[3]=t[1]*e[0],r[4]=t[1]*e[1],r[5]=t[1]*e[2],r[6]=t[2]*e[0],r[7]=t[2]*e[1],r[8]=t[2]*e[2]}function me(t,e,r){var n=t[1]*e[2]-t[2]*e[1],a=t[2]*e[0]-t[0]*e[2],i=t[0]*e[1]-t[1]*e[0];return r[0]=n,r[1]=a,r[2]=i,r}function rt(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;switch(e){case 1:return Math.abs(t);case 2:return Math.sqrt(t[0]*t[0]+t[1]*t[1]);case 3:return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);default:{for(var r=0,n=0;n<e;n++)r+=t[n]*t[n];return Math.sqrt(r)}}}function Fe(t){var e=rt(t);return e!==0&&(t[0]/=e,t[1]/=e,t[2]/=e),e}function ty(t,e,r,n){var a=t[0]*t[0],i=t[1]*t[1],o=t[2]*t[2],s=Math.sqrt(a+i+o),f,c,u;a>i&&a>o?(f=0,c=1,u=2):i>o?(f=1,c=2,u=0):(f=2,c=0,u=1);var v=t[f]/s,g=t[c]/s,p=t[u]/s,l=Math.sqrt(v*v+p*p);if(n!==0){var h=Math.sin(n),y=Math.cos(n);e&&(e[f]=(p*y-v*g*h)/l,e[c]=h*l,e[u]=(-(v*y)-g*p*h)/l),r&&(r[f]=(-(p*h)-v*g*y)/l,r[c]=y*l,r[u]=(v*h-g*p*y)/l)}else e&&(e[f]=p/l,e[c]=0,e[u]=-v/l),r&&(r[f]=-v*g/l,r[c]=l,r[u]=-g*p/l)}function ny(t,e,r){var n=A(e,e);if(n===0)return r[0]=0,r[1]=0,r[2]=0,!1;for(var a=A(t,e)/n,i=0;i<3;i++)r[i]=e[i];return dt(r,a),!0}function Wi(t,e){return t[0]*e[0]+t[1]*e[1]}function ry(t,e,r){var n=Wi(e,e);if(n===0)return r[0]=0,r[1]=0,!1;for(var a=Wi(t,e)/n,i=0;i<2;i++)r[i]=e[i];return cc(r,a),!0}function et(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])+(t[2]-e[2])*(t[2]-e[2])}function ay(t,e){var r=[0,0,0];return me(t,e,r),Math.atan2(rt(r),A(t,e))}function iy(t,e,r){var n=Math.abs(t-r);return 1/Math.sqrt(2*Math.PI*e)*Math.exp(-Math.pow(n,2)/(2*e))}function oy(t,e,r){var n=Math.abs(t-r);return Math.exp(-Math.pow(n,2)/(2*e))}function sy(t,e,r){r[0]=t[0]*e[0],r[1]=t[0]*e[1],r[2]=t[1]*e[0],r[3]=t[1]*e[1]}function gc(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function uy(t){var e=gc(t);return e!==0&&(t[0]/=e,t[1]/=e),e}function Ve(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return e.length===2?e[0][0]*e[1][1]-e[1][0]*e[0][1]:e.length===4?e[0]*e[3]-e[1]*e[2]:Number.NaN}function fy(t,e){for(var r,n,a,i=[0,0,0],o=0;o<3;o++)a=Math.abs(t[o*3]),(n=Math.abs(t[o*3+1]))>a&&(a=n),(n=Math.abs(t[o*3+2]))>a&&(a=n),i[o]=1/a;a=i[0]*Math.abs(t[0]),r=0,(n=i[1]*Math.abs(t[3]))>=a&&(a=n,r=1),(n=i[2]*Math.abs(t[6]))>=a&&(r=2),r!==0&&(Mr(t,3,r,0),i[r]=i[0]),e[0]=r,t[3]/=t[0],t[6]/=t[0],t[4]-=t[3]*t[1],t[7]-=t[6]*t[1],a=i[1]*Math.abs(t[4]),r=1,(n=i[2]*Math.abs(t[7]))>=a&&(r=2,Mr(t,3,1,2),i[2]=i[1]),e[1]=r,t[7]/=t[4],t[5]-=t[3]*t[2],t[8]-=t[6]*t[2]+t[7]*t[5],e[2]=2}function cy(t,e,r){var n=r[e[0]];r[e[0]]=r[0],r[0]=n,n=r[e[1]],r[e[1]]=r[1],r[1]=n-t[3]*r[0],n=r[e[2]],r[e[2]]=r[2],r[2]=n-t[6]*r[0]-t[7]*r[1],r[2]/=t[8],r[1]=(r[1]-t[5]*r[2])/t[4],r[0]=(r[0]-t[1]*r[1]-t[2]*r[2])/t[0]}function gy(t,e,r){var n=t[0],a=t[1],i=t[2],o=t[3],s=t[4],f=t[5],c=t[6],u=t[7],v=t[8],g=+Ve(s,u,f,v),p=-Ve(o,c,f,v),l=+Ve(o,c,s,u),h=-Ve(a,u,i,v),y=+Ve(n,c,i,v),C=-Ve(n,c,a,u),S=+Ve(a,s,i,f),d=-Ve(n,o,i,f),O=+Ve(n,o,a,s),w=n*g+a*p+i*l,M=g*e[0]+h*e[1]+S*e[2],x=p*e[0]+y*e[1]+d*e[2],D=l*e[0]+C*e[1]+O*e[2];r[0]=M/w,r[1]=x/w,r[2]=D/w}function gr(t,e,r){var n=t[0]*e[0]+t[1]*e[1]+t[2]*e[2],a=t[3]*e[0]+t[4]*e[1]+t[5]*e[2],i=t[6]*e[0]+t[7]*e[1]+t[8]*e[2];r[0]=n,r[1]=a,r[2]=i}function $i(t,e,r){for(var n=W(t),a=W(e),i=0;i<3;i++)r[i]=n[0]*a[i]+n[1]*a[i+3]+n[2]*a[i+6],r[i+3]=n[3]*a[i]+n[4]*a[i+3]+n[5]*a[i+6],r[i+6]=n[6]*a[i]+n[7]*a[i+3]+n[8]*a[i+6]}function vy(t,e,r,n,a,i,o){n!==a&&sc("Number of columns of A must match number of rows of B.");for(var s=W(t),f=W(e),c=0;c<r;c++)for(var u=0;u<i;u++){o[c*i+u]=0;for(var v=0;v<n;v++)o[c*i+u]+=s[c*n+v]*f[u+i*v]}}function zn(t,e){var r;r=t[3],e[3]=t[1],e[1]=r,r=t[6],e[6]=t[2],e[2]=r,r=t[7],e[7]=t[5],e[5]=r,e[0]=t[0],e[4]=t[4],e[8]=t[8]}function py(t,e){var r=t[0],n=t[1],a=t[2],i=t[3],o=t[4],s=t[5],f=t[6],c=t[7],u=t[8],v=+Ve(o,c,s,u),g=-Ve(i,f,s,u),p=+Ve(i,f,o,c),l=-Ve(n,c,a,u),h=+Ve(r,f,a,u),y=-Ve(r,f,n,c),C=+Ve(n,o,a,s),S=-Ve(r,i,a,s),d=+Ve(r,i,n,o),O=r*v+n*g+a*p;O===0&&On("Matrix has 0 determinant"),e[0]=v/O,e[3]=g/O,e[6]=p/O,e[1]=l/O,e[4]=h/O,e[7]=y/O,e[2]=C/O,e[5]=S/O,e[8]=d/O}function Xa(t){return t[0]*t[4]*t[8]+t[3]*t[7]*t[2]+t[6]*t[1]*t[5]-t[0]*t[7]*t[5]-t[3]*t[1]*t[8]-t[6]*t[4]*t[2]}function Ma(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Co;if(t.length!==e.length)return!1;function n(a,i){return Math.abs(a-e[i])<=r}return t.every(n)}var Wr=Ma;function vc(t){for(var e=0;e<3;e++)t[e*3]=t[e*3+1]=t[e*3+2]=0,t[e*3+e]=1}function pc(t,e){for(var r=0;r<t;r++){for(var n=0;n<t;n++)e[r*t+n]=0;e[r*t+r]=1}return e}function ly(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Co;return Wr(t,oc,e)}function hy(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Co;return Wr(t,_h,e)}function lc(t,e){var r=t[0]*t[0],n=t[0]*t[1],a=t[0]*t[2],i=t[0]*t[3],o=t[1]*t[1],s=t[2]*t[2],f=t[3]*t[3],c=t[1]*t[2],u=t[1]*t[3],v=t[2]*t[3],g=o+s+f,p=1/(r+g),l=(r-g)*p;p*=2,e[0]=o*p+l,e[3]=(c+i)*p,e[6]=(u-a)*p,e[1]=(c-i)*p,e[4]=s*p+l,e[7]=(v+n)*p,e[2]=(u+a)*p,e[5]=(v-n)*p,e[8]=f*p+l}function va(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!"".concat(t).includes("e"))return+"".concat(Math.round("".concat(t,"e+").concat(e)),"e-").concat(e);var r="".concat(t).split("e"),n="";return+r[1]+e>0&&(n="+"),+"".concat(Math.round("".concat(+r[0],"e").concat(n).concat(+r[1]+e)),"e-").concat(e)}function zi(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return e[0]=va(t[0],r),e[1]=va(t[1],r),e[2]=va(t[2],r),e}function $r(t,e,r,n){var a,i,o,s,f,c,u,v,g,p,l,h,y,C,S,d,O=xe(e),w=xe(e),M=function(R,V,E){C=R[V],y=R[E],R[V]=C-h*(y+C*p),R[E]=y+h*(C-y*p)};for(pc(e,n),f=0;f<e;f++)O[f]=r[f]=t[f+f*e],w[f]=0;for(a=0;a<Cs;a++){for(l=0,f=0;f<e-1;f++)for(s=f+1;s<e;s++)l+=Math.abs(t[f*e+s]);if(l===0)break;for(a<3?u=.2*l/(e*e):u=0,f=0;f<e-1;f++)for(s=f+1;s<e;s++)if(C=100*Math.abs(t[f*e+s]),a>3&&Math.abs(r[f])+C===Math.abs(r[f])&&Math.abs(r[s])+C===Math.abs(r[s]))t[f*e+s]=0;else if(Math.abs(t[f*e+s])>u){for(y=r[s]-r[f],Math.abs(y)+C===Math.abs(y)?g=t[f*e+s]/y:(v=.5*y/t[f*e+s],g=1/(Math.abs(v)+Math.sqrt(1+v*v)),v<0&&(g=-g)),S=1/Math.sqrt(1+g*g),h=g*S,p=h/(1+S),y=g*t[f*e+s],w[f]-=y,w[s]+=y,r[f]-=y,r[s]+=y,t[f*e+s]=0,i=0;i<=f-1;i++)M(t,i*e+f,i*e+s);for(i=f+1;i<=s-1;i++)M(t,f*e+i,i*e+s);for(i=s+1;i<e;i++)M(t,f*e+i,s*e+i);for(i=0;i<e;i++)M(n,i*e+f,i*e+s)}for(f=0;f<e;f++)O[f]+=w[f],r[f]=O[f],w[f]=0}if(a>=Cs)return On("vtkMath::Jacobi: Error extracting eigenfunctions"),0;for(i=0;i<e-1;i++){for(o=i,d=r[o],a=i+1;a<e;a++)(r[a]>=d||Math.abs(r[a]-d)<So)&&(o=a,d=r[o]);o!==i&&(r[o]=r[i],r[i]=d,fr(n,e,i,o))}var x=(e>>1)+(e&1);for(c=0,a=0;a<e*e;a++)n[a]>=0&&c++;if(c<x)for(a=0;a<e;a++)n[a*e+i]*=-1;return 1}function hc(t,e){var r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];r[0]=t[0]+t[4]+t[8],r[5]=t[0]-t[4]-t[8],r[10]=-t[0]+t[4]-t[8],r[15]=-t[0]-t[4]+t[8],r[1]=r[4]=t[7]-t[5],r[2]=r[8]=t[2]-t[6],r[3]=r[12]=t[3]-t[1],r[6]=r[9]=t[3]+t[1],r[7]=r[13]=t[2]+t[6],r[11]=r[14]=t[7]+t[5];var n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a=[0,0,0,0],i=[].concat(r);$r(i,4,a,n),e[0]=n[0],e[1]=n[4],e[2]=n[8],e[3]=n[12]}function yy(t,e,r){var n=t[0]*e[0],a=t[0]*e[1],i=t[0]*e[2],o=t[0]*e[3],s=t[1]*e[0],f=t[1]*e[1],c=t[1]*e[2],u=t[1]*e[3],v=t[2]*e[0],g=t[2]*e[1],p=t[2]*e[2],l=t[2]*e[3],h=t[3]*e[0],y=t[3]*e[1],C=t[3]*e[2],S=t[3]*e[3];r[0]=n-f-p-S,r[1]=a+s+l-C,r[2]=i-u+v+y,r[3]=o+c-g+h}function yc(t,e){for(var r=0;r<9;r++)e[r]=t[r];for(var n=xe(3),a=xe(3),i,o=0;o<3;o++){var s=Math.abs(e[o*3]),f=Math.abs(e[o*3+1]),c=Math.abs(e[o*3+2]);i=f>s?f:s,i=c>i?c:i,n[o]=1,i!==0&&(n[o]/=i)}var u=Math.abs(e[0])*n[0],v=Math.abs(e[3])*n[1],g=Math.abs(e[6])*n[2];a[0]=0,i=u,v>=i&&(i=v,a[0]=1),g>=i&&(a[0]=2),a[0]!==0&&(fr(e,3,a[0],0),n[a[0]]=n[0]);var p=Math.abs(e[4])*n[1],l=Math.abs(e[7])*n[2];a[1]=1,i=p,l>=i&&(a[1]=2,fr(e,3,1,2)),a[2]=2;var h=0;if(Xa(e)<0){h=1;for(var y=0;y<9;y++)e[y]=-e[y]}var C=xe(4);if(hc(e,C),lc(C,e),h)for(var S=0;S<9;S++)e[S]=-e[S];a[1]!==1&&fr(e,3,a[1],1),a[0]!==0&&fr(e,3,a[0],0)}function Tc(t,e,r){var n,a,i,o,s,f,c=W(t);if($r(c,3,e,r),e[0]===e[1]&&e[0]===e[2]){vc(r);return}for(zn(r,r),n=0;n<3;n++)if(e[(n+1)%3]===e[(n+2)%3]){for(f=Math.abs(r[n*3]),o=0,a=1;a<3;a++)f<(s=Math.abs(r[n*3+a]))&&(f=s,o=a);o!==n&&(s=e[o],e[o]=e[n],e[n]=s,Mr(r,3,n,o)),r[o*3+o]<0&&(r[o*3]=-r[o*3],r[o*3+1]=-r[o*3+1],r[o*3+2]=-r[o*3+2]),a=(o+1)%3,i=(o+2)%3,r[a*3]=0,r[a*3+1]=0,r[a*3+2]=0,r[a*3+a]=1;var u=me([r[o*3],r[o*3+1],r[o*3+2]],[r[a*3],r[a*3+1],r[a*3+2]],[]);Fe(u);for(var v=me(u,[r[o*3],r[o*3+1],r[o*3+2]],[]),g=0;g<3;g++)r[i*3+g]=u[g],r[a*3+g]=v[g];zn(r,r);return}for(f=Math.abs(r[0]),o=0,n=1;n<3;n++)f<(s=Math.abs(r[n*3]))&&(f=s,o=n);if(o!==0){var p=e[o];e[o]=e[0],e[0]=p,Mr(r,3,o,0)}if(Math.abs(r[4])<Math.abs(r[7])){var l=e[2];e[2]=e[1],e[1]=l,Mr(r,3,1,2)}for(n=0;n<2;n++)r[n*3+n]<0&&(r[n*3]=-r[n*3],r[n*3+1]=-r[n*3+1],r[n*3+2]=-r[n*3+2]);Xa(r)<0&&(r[6]=-r[6],r[7]=-r[7],r[8]=-r[8]),zn(r,r)}function Ty(t,e,r,n){var a,i=W(t),o=Xa(i);if(o<0)for(a=0;a<9;a++)i[a]=-i[a];yc(i,e),zn(i,i),$i(i,e,n),Tc(n,r,n),$i(e,n,e),zn(n,n),o<0&&(r[0]=-r[0],r[1]=-r[1],r[2]=-r[2])}function Oo(t,e,r){var n,a,i,o,s=0,f,c,u,v=xe(r);for(n=0;n<r;n++){for(o=0,a=0;a<r;a++)(u=Math.abs(t[n*r+a]))>o&&(o=u);if(o===0)return On("Unable to factor linear system"),0;v[n]=1/o}for(a=0;a<r;a++){for(n=0;n<a;n++){for(f=t[n*r+a],i=0;i<n;i++)f-=t[n*r+i]*t[i*r+a];t[n*r+a]=f}for(o=0,n=a;n<r;n++){for(f=t[n*r+a],i=0;i<a;i++)f-=t[n*r+i]*t[i*r+a];t[n*r+a]=f,(c=v[n]*Math.abs(f))>=o&&(o=c,s=n)}if(a!==s){for(i=0;i<r;i++)c=t[s*r+i],t[s*r+i]=t[a*r+i],t[a*r+i]=c;v[s]=v[a]}if(e[a]=s,Math.abs(t[a*r+a])<=So)return On("Unable to factor linear system"),0;if(a!==r-1)for(c=1/t[a*r+a],n=a+1;n<r;n++)t[n*r+a]*=c}return 1}function wo(t,e,r,n){var a,i,o,s,f;for(o=-1,a=0;a<n;a++){if(s=e[a],f=r[s],r[s]=r[a],o>=0)for(i=o;i<=a-1;i++)f-=t[a*n+i]*r[i];else f!==0&&(o=a);r[a]=f}for(a=n-1;a>=0;a--){for(f=r[a],i=a+1;i<n;i++)f-=t[a*n+i]*r[i];r[a]=f/t[a*n+a]}}function Cc(t,e,r){if(r===2){var n=xe(2),a=Ve(t[0],t[1],t[2],t[3]);return a===0?0:(n[0]=(t[3]*e[0]-t[1]*e[1])/a,n[1]=(-(t[2]*e[0])+t[0]*e[1])/a,e[0]=n[0],e[1]=n[1],1)}if(r===1)return t[0]===0?0:(e[0]/=t[0],1);var i=xe(r);return Oo(t,i,r)===0?0:(wo(t,i,e,r),1)}function Sc(t,e,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,i=n||xe(r),o=a||xe(r);if(Oo(t,i,r)===0)return null;for(var s=0;s<r;s++){for(var f=0;f<r;f++)o[f]=0;o[s]=1,wo(t,i,o,r);for(var c=0;c<r;c++)e[c*r+s]=o[c]}return e}function Cy(t,e){for(var r=+Number.MAX_VALUE,n=-Number.MAX_VALUE,a=0;a<e;a++)for(var i=a;i<e;i++)Math.abs(t[a*e+i])>n&&(n=Math.abs(t[a*e+i]));for(var o=0;o<e;o++)Math.abs(t[o*e+o])<r&&(r=Math.abs(t[o*e+o]));return r===0?Number.MAX_VALUE:n/r}function Sy(t,e,r){return $r(t,3,e,r)}function bi(t,e,r,n){if(t<r)return On("Insufficient number of samples. Underdetermined."),0;var a,i,o,s=xe(r*r),f=xe(r),c=xe(r*r);for(o=0;o<t;o++)for(a=0;a<r;a++)for(i=a;i<r;i++)s[a*r+i]+=e[o*r+a]*e[o*r+i];for(a=0;a<r;a++)for(i=0;i<a;i++)s[a*r+i]=s[i*r+a];for($r(s,r,f,c),a=0;a<r;a++)n[a]=c[a*r+r-1];return 1}function dy(t,e,r,n,a,i){var o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!0;if(t<r||t<a)return On("Insufficient number of samples. Underdetermined."),0;var s=xe(a),f=1,c,u=0,v,g,p,l=0;if(o){for(g=0;g<a;g++)s[g]=1;for(v=0;v<t;v++)for(g=0;g<a;g++)Math.abs(n[v*a+g])>So&&(f=0,s[g]=0);if(f&&a===1)return On("Detected homogeneous system (Y=0), calling SolveHomogeneousLeastSquares()"),bi(t,e,r,i);if(f)l=1;else for(g=0;g<a;g++)s[g]&&(l=1)}l&&(c=xe(r),u=bi(t,e,r,c));var h=xe(r*r),y=xe(r*r),C=xe(r*a);for(p=0;p<t;p++)for(v=0;v<r;v++){for(g=v;g<r;g++)h[v*r+g]+=e[p*r+v]*e[p*r+g];for(g=0;g<a;g++)C[v*a+g]+=e[p*r+v]*n[p*a+g]}for(v=0;v<r;v++)for(g=0;g<v;g++)h[v*r+g]=h[g*r+v];var S=Sc(h,y,r);if(S)for(v=0;v<r;v++)for(g=0;g<a;g++)for(i[v*a+g]=0,p=0;p<r;p++)i[v*a+g]+=y[v*r+p]*C[p*a+g];if(l){for(g=0;g<a;g++)if(s[g])for(v=0;v<r;v++)i[v*a+g]=c[v*a]}return l?u&&S:S}function Oy(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,.5,1];switch(t.length){case 3:return e[0]=parseInt(t[0],16)*17/255,e[1]=parseInt(t[1],16)*17/255,e[2]=parseInt(t[2],16)*17/255,e;case 4:return e[0]=parseInt(t[1],16)*17/255,e[1]=parseInt(t[2],16)*17/255,e[2]=parseInt(t[3],16)*17/255,e;case 6:return e[0]=parseInt(t.substr(0,2),16)/255,e[1]=parseInt(t.substr(2,2),16)/255,e[2]=parseInt(t.substr(4,2),16)/255,e;case 7:return e[0]=parseInt(t.substr(1,2),16)/255,e[1]=parseInt(t.substr(3,2),16)/255,e[2]=parseInt(t.substr(5,2),16)/255,e;case 9:return e[0]=parseInt(t.substr(1,2),16)/255,e[1]=parseInt(t.substr(3,2),16)/255,e[2]=parseInt(t.substr(5,2),16)/255,e[3]=parseInt(t.substr(7,2),16)/255,e;default:return e}}function vr(t,e){var r,n,a=ne(t,3),i=a[0],o=a[1],s=a[2],f=1/3,c=1/6,u=2/3,v=i,g=i;o>v?v=o:o<g&&(g=o),s>v?v=s:s<g&&(g=s);var p=v;p>0?n=(v-g)/v:n=0,n>0?(i===v?r=c*(o-s)/(v-g):o===v?r=f+c*(s-i)/(v-g):r=u+c*(i-o)/(v-g),r<0&&(r+=1)):r=0,e[0]=r,e[1]=n,e[2]=p}function pn(t,e){var r=ne(t,3),n=r[0],a=r[1],i=r[2],o=1/3,s=1/6,f=2/3,c=5/6,u,v,g;n>s&&n<=o?(v=1,u=(o-n)/s,g=0):n>o&&n<=.5?(v=1,g=(n-o)/s,u=0):n>.5&&n<=f?(g=1,v=(f-n)/s,u=0):n>f&&n<=c?(g=1,u=(n-f)/s,v=0):n>c&&n<=1?(u=1,g=(1-n)/s,v=0):(u=1,v=n/s,g=0),u=a*u+(1-a),v=a*v+(1-a),g=a*g+(1-a),u*=i,v*=i,g*=i,e[0]=u,e[1]=v,e[2]=g}function dc(t,e){var r=ne(t,3),n=r[0],a=r[1],i=r[2],o=(n+16)/116,s=a/500+o,f=o-i/200;Math.pow(o,3)>.008856?o=Math.pow(o,3):o=(o-16/116)/7.787,Math.pow(s,3)>.008856?s=Math.pow(s,3):s=(s-16/116)/7.787,Math.pow(f,3)>.008856?f=Math.pow(f,3):f=(f-16/116)/7.787;var c=.9505,u=1,v=1.089;e[0]=c*s,e[1]=u*o,e[2]=v*f}function Oc(t,e){var r=ne(t,3),n=r[0],a=r[1],i=r[2],o=.9505,s=1,f=1.089,c=n/o,u=a/s,v=i/f;c>.008856?c=Math.pow(c,1/3):c=7.787*c+16/116,u>.008856?u=Math.pow(u,1/3):u=7.787*u+16/116,v>.008856?v=Math.pow(v,1/3):v=7.787*v+16/116,e[0]=116*u-16,e[1]=500*(c-u),e[2]=200*(u-v)}function wc(t,e){var r=ne(t,3),n=r[0],a=r[1],i=r[2],o=n*3.2406+a*-1.5372+i*-.4986,s=n*-.9689+a*1.8758+i*.0415,f=n*.0557+a*-.204+i*1.057;o>.0031308?o=1.055*Math.pow(o,1/2.4)-.055:o*=12.92,s>.0031308?s=1.055*Math.pow(s,1/2.4)-.055:s*=12.92,f>.0031308?f=1.055*Math.pow(f,1/2.4)-.055:f*=12.92;var c=o;c<s&&(c=s),c<f&&(c=f),c>1&&(o/=c,s/=c,f/=c),o<0&&(o=0),s<0&&(s=0),f<0&&(f=0),e[0]=o,e[1]=s,e[2]=f}function xc(t,e){var r=ne(t,3),n=r[0],a=r[1],i=r[2];n>.04045?n=Math.pow((n+.055)/1.055,2.4):n/=12.92,a>.04045?a=Math.pow((a+.055)/1.055,2.4):a/=12.92,i>.04045?i=Math.pow((i+.055)/1.055,2.4):i/=12.92,e[0]=n*.4124+a*.3576+i*.1805,e[1]=n*.2126+a*.7152+i*.0722,e[2]=n*.0193+a*.1192+i*.9505}function Cn(t,e){var r=[0,0,0];xc(t,r),Oc(r,e)}function Da(t,e){var r=[0,0,0];dc(t,r),wc(r,e)}function Dn(t){return t[0]=1,t[1]=-1,t[2]=1,t[3]=-1,t[4]=1,t[5]=-1,t}function pa(t){return!(t[1]-t[0]<0)}function wy(t,e,r){return r[0]=Math.min(t[0],e[0]),r[1]=Math.max(t[0],e[0]),r[2]=Math.min(t[1],e[1]),r[3]=Math.max(t[1],e[1]),r[4]=Math.min(t[2],e[2]),r[5]=Math.max(t[2],e[2]),r}function gt(t,e,r){return t<e?e:t>r?r:t}function Hi(t,e,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[0,0,0];return n[0]=gt(t[0],e[0],r[0]),n[1]=gt(t[1],e[1],r[1]),n[2]=gt(t[2],e[2],r[2]),n}function xy(t,e){var r=0;return e[0]!==e[1]&&(t<e[0]?r=e[0]:t>e[1]?r=e[1]:r=t,r=(r-e[0])/(e[1]-e[0])),r}var My=jr("GetScalarTypeFittingRange"),Dy=jr("GetAdjustedScalarRange");function Ey(t,e){if(!t||!e)return 0;for(var r=0;r<6;r+=2)if(t[r]<e[r]||t[r]>e[r+1]||t[r+1]<e[r]||t[r+1]>e[r+1])return 0;return 1}function Ry(t,e,r){if(!t||!e)return 0;for(var n=0;n<6;n+=2)if(t[n]+r[n/2]<e[n]||t[n]-r[n/2]>e[n+1]||t[n+1]+r[n/2]<e[n]||t[n+1]-r[n/2]>e[n+1])return 0;return 1}function Vy(t,e,r){if(!t||!e||!r)return 0;for(var n=0;n<3;n++)if(t[n]+r[n]<e[2*n]||t[n]-r[n]>e[2*n+1])return 0;return 1}function Ly(t,e,r,n){for(var a=xe(3),i=xe(3),o=xe(3),s=xe(3),f=xe(3),c=xe(3),u=0;u<3;++u)a[u]=t[u]-e[u],i[u]=e[u]-r[u],o[u]=r[u]-t[u],s[u]=-a[u],f[u]=-i[u],c[u]=-o[u];var v=rt(s),g=rt(f),p=rt(o),l=xe(3);me(a,i,l);for(var h=rt(l),y=v*g*p/(2*h),C=2*h*h,S=g*g*A(a,c)/C,d=p*p*A(s,i)/C,O=v*v*A(o,f)/C,w=0;w<3;++w)n[w]=S*t[w]+d*e[w]+O*r[w];return y}var my=1/0,ky=-1/0,Mc=function(e){return!Number.isFinite(e)},Fy=Number.isFinite,Ki=Number.isNaN,Ea=Ki;function xn(){return[].concat([Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE])}function Pi(t){for(var e=-1,r=-1,n=0;n<t.length;n++){var a=Math.abs(t[n]);a>e&&(r=n,e=a)}return r}function Dc(t){var e=Math.floor(t*255);return e>15?e.toString(16):"0".concat(e.toString(16))}function Ny(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#";return"".concat(e).concat(t.map(Dc).join(""))}function Hr(t){return Math.round(t*255)}function Uy(t){return t.length===3?"rgb(".concat(t.map(Hr).join(", "),")"):"rgba(".concat(Hr(t[0]||0),", ").concat(Hr(t[1]||0),", ").concat(Hr(t[2]||0),", ").concat(t[3]||0,")")}var Bt={Pi:jh,radiansFromDegrees:de,degreesFromRadians:Fr,round:Gt,floor:Nr,ceil:Wh,ceilLog2:Kh,min:$h,max:zh,arrayMin:bh,arrayMax:Hh,arrayRange:fc,isPowerOfTwo:cr,nearestPowerOfTwo:Zt,factorial:Ph,binomial:Xh,beginCombination:Yh,nextCombination:Ah,randomSeed:Zh,getSeed:qh,random:Jh,gaussian:Qh,add:wn,subtract:tt,multiplyScalar:dt,multiplyScalar2D:cc,multiplyAccumulate:ji,multiplyAccumulate2D:Ih,dot:A,outer:ey,cross:me,norm:rt,normalize:Fe,perpendiculars:ty,projectVector:ny,projectVector2D:ry,distance2BetweenPoints:et,angleBetweenVectors:ay,gaussianAmplitude:iy,gaussianWeight:oy,dot2D:Wi,outer2D:sy,norm2D:gc,normalize2D:uy,determinant2x2:Ve,LUFactor3x3:fy,LUSolve3x3:cy,linearSolve3x3:gy,multiply3x3_vect3:gr,multiply3x3_mat3:$i,multiplyMatrix:vy,transpose3x3:zn,invert3x3:py,identity3x3:vc,identity:pc,isIdentity:ly,isIdentity3x3:hy,determinant3x3:Xa,quaternionToMatrix3x3:lc,areEquals:Ma,areMatricesEqual:Wr,roundNumber:va,roundVector:zi,matrix3x3ToQuaternion:hc,multiplyQuaternion:yy,orthogonalize3x3:yc,diagonalize3x3:Tc,singularValueDecomposition3x3:Ty,solveLinearSystem:Cc,invertMatrix:Sc,luFactorLinearSystem:Oo,luSolveLinearSystem:wo,estimateMatrixCondition:Cy,jacobi:Sy,jacobiN:$r,solveHomogeneousLeastSquares:bi,solveLeastSquares:dy,hex2float:Oy,rgb2hsv:vr,hsv2rgb:pn,lab2xyz:dc,xyz2lab:Oc,xyz2rgb:wc,rgb2xyz:xc,rgb2lab:Cn,lab2rgb:Da,uninitializeBounds:Dn,areBoundsInitialized:pa,computeBoundsFromPoints:wy,clampValue:gt,clampVector:Hi,clampAndNormalizeValue:xy,getScalarTypeFittingRange:My,getAdjustedScalarRange:Dy,extentIsWithinOtherExtent:Ey,boundsIsWithinOtherBounds:Ry,pointIsWithinBounds:Vy,solve3PointCircle:Ly,inf:my,negInf:ky,isInf:Mc,isNan:Ki,isNaN:Ki,isFinite:Fy,createUninitializedBounds:xn,getMajorAxisIndex:Pi,floatToHex2:Dc,floatRGB2HexCode:Ny,float2CssRGBA:Uy};function Gy(t,e){t.getBounds=function(){return 0},t.getBounds=function(r){t.getBounds();for(var n=0;n<6;n++)r[n]=e.bounds[n]},t.getCenter=function(){t.getBounds();for(var r=0;r<3;r++)e.center[r]=(e.bounds[2*r+1]+e.bounds[2*r])/2;return e.center.slice()},t.getLength=function(){var r=0,n=0;t.getBounds();for(var a=0;a<3;a++)r=e.bounds[2*a+1]-e.bounds[2*a],n+=r*r;return Math.sqrt(n)}}var By={bounds:[1,-1,1,-1,1,-1],center:[0,0,0],viewSpecificProperties:null};function _y(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,By,r),To.extend(t,e,r),e.bounds||Dn(e.bounds),e.center||(e.center=[0,0,0]),T.setGet(t,e,["viewSpecificProperties"]),e.viewSpecificProperties||(e.viewSpecificProperties={}),Gy(t,e)}var Ec={extend:_y},jy={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Me={VOID:"",CHAR:"Int8Array",SIGNED_CHAR:"Int8Array",UNSIGNED_CHAR:"Uint8Array",SHORT:"Int16Array",UNSIGNED_SHORT:"Uint16Array",INT:"Int32Array",UNSIGNED_INT:"Uint32Array",FLOAT:"Float32Array",DOUBLE:"Float64Array"},Wy=Me.FLOAT,Rc={DefaultDataType:Wy,DataTypeByteSize:jy,VtkDataTypes:Me};function Ss(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function Ra(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Ss(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ss(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var $y=ae,zy=Rc.DefaultDataType;function Xi(t,e,r){var n=t.length,a,i,o,s;if(n===0)return{min:Number.MAX_VALUE,max:-Number.MAX_VALUE};for(a=t[e],i=a,s=e;s<n;s+=r)o=t[s],o<a?a=o:o>i&&(i=o);return{min:a,max:i}}function by(){var t=Number.MAX_VALUE,e=-Number.MAX_VALUE,r=0,n=0;return{add:function(i){t>i&&(t=i),e<i&&(e=i),r++,n+=i},get:function(){return{min:t,max:e,count:r,sum:n,mean:n/r}},getRange:function(){return{min:t,max:e}}}}function Vc(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;if(e<0&&r>1){for(var n=t.length,a=n/r,i=new Float64Array(a),o=0,s=0;o<a;++o){for(var f,c=s+r;s<c;++s)i[o]+=t[s]*t[s];f=o,i[f]=Math.pow(i[f],.5)}return Xi(i,0,1)}return Xi(t,e<0?0:e,r)}function ds(t){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=t||[];r.length<=e;)r.push(null);return r}function xo(t){return Object.prototype.toString.call(t).slice(8,-1)}function Hy(t){for(var e=t.getNumberOfComponents(),r=0,n=new Array(e),a=0;a<t.getNumberOfTuples();++a){t.getTuple(a,n);var i=rt(n,e);i>r&&(r=i)}return r}var Ky={computeRange:Vc,createRangeHelper:by,fastComputeRange:Xi,getDataType:xo,getMaxNorm:Hy};function Py(t,e){e.classHierarchy.push("vtkDataArray");function r(n){if(n<0)return!1;var a=t.getNumberOfComponents(),i=e.values.length/(a>0?a:1);if(n===i)return!0;if(n>i){var o=e.values;return e.values=Ha(e.dataType,(n+i)*a),e.values.set(o),!0}return e.size>n*a&&(e.size=n*a,t.dataChange()),!0}t.dataChange=function(){e.ranges=null,t.modified()},t.resize=function(n){r(n);var a=n*t.getNumberOfComponents();return e.size!==a?(e.size=a,t.dataChange(),!0):!1},t.initialize=function(){t.resize(0)},t.getElementComponentSize=function(){return e.values.BYTES_PER_ELEMENT},t.getComponent=function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return e.values[n*e.numberOfComponents+a]},t.setComponent=function(n,a,i){i!==e.values[n*e.numberOfComponents+a]&&(e.values[n*e.numberOfComponents+a]=i,t.dataChange())},t.getValue=function(n){var a=n/e.numberOfComponents,i=n%e.numberOfComponents;return t.getComponent(a,i)},t.setValue=function(n,a){var i=n/e.numberOfComponents,o=n%e.numberOfComponents;t.setComponent(i,o,a)},t.getData=function(){return e.size===e.values.length?e.values:e.values.subarray(0,e.size)},t.getRange=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:-1,a=n<0?e.numberOfComponents:n,i=null;return e.ranges||(e.ranges=ds(e.ranges,e.numberOfComponents)),i=e.ranges[a],i?(e.rangeTuple[0]=i.min,e.rangeTuple[1]=i.max,e.rangeTuple):(i=Vc(t.getData(),n,e.numberOfComponents),e.ranges[a]=i,e.rangeTuple[0]=i.min,e.rangeTuple[1]=i.max,e.rangeTuple)},t.setRange=function(n,a){e.ranges||(e.ranges=ds(e.ranges,e.numberOfComponents));var i={min:n.min,max:n.max};return e.ranges[a]=i,e.rangeTuple[0]=i.min,e.rangeTuple[1]=i.max,e.rangeTuple},t.setTuple=function(n,a){for(var i=n*e.numberOfComponents,o=0;o<e.numberOfComponents;o++)e.values[i+o]=a[o]},t.setTuples=function(n,a){for(var i=n*e.numberOfComponents,o=Math.min(a.length,e.size-i),s=0;s<o;)e.values[i++]=a[s++]},t.insertTuple=function(n,a){return e.size<=n*e.numberOfComponents&&(e.size=(n+1)*e.numberOfComponents,r(n+1)),t.setTuple(n,a),n},t.insertTuples=function(n,a){var i=n+a.length/e.numberOfComponents;return e.size<i*e.numberOfComponents&&(e.size=i*e.numberOfComponents,r(i)),t.setTuples(n,a),i},t.insertNextTuple=function(n){var a=e.size/e.numberOfComponents;return t.insertTuple(a,n)},t.insertNextTuples=function(n){var a=e.size/e.numberOfComponents;return t.insertTuples(a,n)},t.getTuple=function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],i=e.numberOfComponents||1,o=n*i;switch(i){case 4:a[3]=e.values[o+3];case 3:a[2]=e.values[o+2];case 2:a[1]=e.values[o+1];case 1:a[0]=e.values[o];break;default:for(var s=i-1;s>=0;--s)a[s]=e.values[o+s]}return a},t.getTuples=function(n,a){var i=(n??0)*e.numberOfComponents,o=(a??t.getNumberOfTuples())*e.numberOfComponents,s=t.getData().subarray(i,o);return s.length>0?s:null},t.getTupleLocation=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1;return n*e.numberOfComponents},t.getNumberOfComponents=function(){return e.numberOfComponents},t.getNumberOfValues=function(){return e.size},t.getNumberOfTuples=function(){return e.size/e.numberOfComponents},t.getDataType=function(){return e.dataType},t.newClone=function(){return mc({empty:!0,name:e.name,dataType:e.dataType,numberOfComponents:e.numberOfComponents})},t.getName=function(){return e.name||(t.modified(),e.name="vtkDataArray".concat(t.getMTime())),e.name},t.setData=function(n,a){e.values=n,e.size=n.length,e.dataType=xo(n),a&&(e.numberOfComponents=a),e.size%e.numberOfComponents!==0&&(e.numberOfComponents=1),t.dataChange()},t.getState=function(){if(e.deleted)return null;var n=Ra(Ra({},e),{},{vtkClass:t.getClassName()});n.values=Array.from(n.values),delete n.buffer,Object.keys(n).forEach(function(i){n[i]||delete n[i]});var a={};return Object.keys(n).sort().forEach(function(i){a[i]=n[i]}),a.mtime&&delete a.mtime,a},t.deepCopy=function(n){t.shallowCopy(n),t.setData(n.getData().slice())},t.interpolateTuple=function(n,a,i,o,s,f){var c=e.numberOfComponents||1;(c!==a.getNumberOfComponents()||c!==o.getNumberOfComponents())&&$y("numberOfComponents must match");var u=a.getTuple(i),v=o.getTuple(s),g=[];switch(g.length=c,c){case 4:g[3]=u[3]+(v[3]-u[3])*f;case 3:g[2]=u[2]+(v[2]-u[2])*f;case 2:g[1]=u[1]+(v[1]-u[1])*f;case 1:g[0]=u[0]+(v[0]-u[0])*f;break;default:for(var p=0;p<c;p++)g[p]=u[p]+(v[p]-u[p])*f}return t.insertTuple(n,g)}}var Xy={name:"",numberOfComponents:1,dataType:zy,rangeTuple:[0,0]};function Lc(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,Xy,r),!e.empty&&!e.values&&!e.size)throw new TypeError("Cannot create vtkDataArray object without: size > 0, values");if(e.values?Array.isArray(e.values)&&(e.values=vo(e.dataType,e.values)):e.values=Ha(e.dataType,e.size),e.values){var n;e.size=(n=e.size)!==null&&n!==void 0?n:e.values.length,e.dataType=xo(e.values)}_e(t,e),Ka(t,e,["name","numberOfComponents"]),Py(t,e)}var mc=ke(Lc,"vtkDataArray"),ie=Ra(Ra({newInstance:mc,extend:Lc},Ky),Rc);function Os(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function Yy(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Os(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Os(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var Yi=1e-6,kc="coincide",Fc="disjoint";function Ay(t,e,r){return t[0]*(r[0]-e[0])+t[1]*(r[1]-e[1])+t[2]*(r[2]-e[2])}function Nc(t,e,r){var n=r[0]*(t[0]-e[0])+r[1]*(t[1]-e[1])+r[2]*(t[2]-e[2]);return Math.abs(n)}function Uc(t,e,r,n){var a=[];tt(t,e,a);var i=A(r,a);n[0]=t[0]-i*r[0],n[1]=t[1]-i*r[1],n[2]=t[2]-i*r[2]}function Gc(t,e,r){var n=A(t,e),a=A(e,e);return a===0&&(a=1),r[0]=t[0]-n*e[0]/a,r[1]=t[1]-n*e[1]/a,r[2]=t[2]-n*e[2]/a,r}function Bc(t,e,r,n){var a=[];tt(t,e,a);var i=A(r,a),o=A(r,r);o!==0?(n[0]=t[0]-i*r[0]/o,n[1]=t[1]-i*r[1]/o,n[2]=t[2]-i*r[2]/o):(n[0]=t[0],n[1]=t[1],n[2]=t[2])}function _c(t,e,r,n){var a={intersection:!1,betweenPoints:!1,t:Number.MAX_VALUE,x:[]},i=[],o=[];tt(e,t,i),tt(r,t,o);var s=A(n,o),f=A(n,i),c,u;return f<0?c=-f:c=f,s<0?u=-s*Yi:u=s*Yi,c<=u||(a.t=s/f,a.x[0]=t[0]+a.t*i[0],a.x[1]=t[1]+a.t*i[1],a.x[2]=t[2]+a.t*i[2],a.intersection=!0,a.betweenPoints=a.t>=0&&a.t<=1),a}function jc(t,e,r,n){var a={intersection:!1,l0:[],l1:[],error:null},i=[];me(e,n,i);var o=i.map(function(g){return Math.abs(g)});if(o[0]+o[1]+o[2]<Yi){var s=[];return tt(t,r,s),A(e,s)===0?a.error=kc:a.error=Fc,a}var f;o[0]>o[1]&&o[0]>o[2]?f="x":o[1]>o[2]?f="y":f="z";var c=[],u=-A(e,t),v=-A(n,r);switch(f){case"x":c[0]=0,c[1]=(v*e[2]-u*n[2])/i[0],c[2]=(u*n[1]-v*e[1])/i[0];break;case"y":c[0]=(u*n[2]-v*e[2])/i[1],c[1]=0,c[2]=(v*e[0]-u*n[0])/i[1];break;case"z":c[0]=(v*e[1]-u*n[1])/i[2],c[1]=(u*n[0]-v*e[0])/i[2],c[2]=0;break}return a.l0=c,wn(c,i,a.l1),a.intersection=!0,a}var Zy={evaluate:Ay,distanceToPlane:Nc,projectPoint:Uc,projectVector:Gc,generalizedProjectPoint:Bc,intersectWithLine:_c,intersectWithPlane:jc,DISJOINT:Fc,COINCIDE:kc};function qy(t,e){e.classHierarchy.push("vtkPlane"),t.distanceToPlane=function(r){return Nc(r,e.origin,e.normal)},t.projectPoint=function(r,n){Uc(r,e.origin,e.normal,n)},t.projectVector=function(r,n){return Gc(r,e.normal,n)},t.push=function(r){if(r!==0)for(var n=0;n<3;n++)e.origin[n]+=r*e.normal[n]},t.generalizedProjectPoint=function(r,n){Bc(r,e.origin,e.normal,n)},t.evaluateFunction=function(r,n,a){return Array.isArray(r)?e.normal[0]*(r[0]-e.origin[0])+e.normal[1]*(r[1]-e.origin[1])+e.normal[2]*(r[2]-e.origin[2]):e.normal[0]*(r-e.origin[0])+e.normal[1]*(n-e.origin[1])+e.normal[2]*(a-e.origin[2])},t.evaluateGradient=function(r){var n=[e.normal[0],e.normal[1],e.normal[2]];return n},t.intersectWithLine=function(r,n){return _c(r,n,e.origin,e.normal)},t.intersectWithPlane=function(r,n){return jc(r,n,e.origin,e.normal)}}var Jy={normal:[0,0,1],origin:[0,0,0]};function Wc(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Jy,r),T.obj(t,e),T.setGetArray(t,e,["normal","origin"],3),qy(t,e)}var Qy=T.newInstance(Wc,"vtkPlane"),jt=Yy({newInstance:Qy,extend:Wc},Zy);function ws(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function Iy(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?ws(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ws(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var Ya=[Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE];function $c(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function Wt(t){return(t==null?void 0:t.length)>=6&&t[0]<=t[1]&&t[2]<=t[3]&&t[4]<=t[5]}function Mo(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Do(t){return Mo(t,Ya)}function Va(t,e,r,n){var a=ne(t,6),i=a[0],o=a[1],s=a[2],f=a[3],c=a[4],u=a[5];return t[0]=i<e?i:e,t[1]=o>e?o:e,t[2]=s<r?s:r,t[3]=f>r?f:r,t[4]=c<n?c:n,t[5]=u>n?u:n,t}function Eo(t,e){if(e.length===0)return t;if(Array.isArray(e[0]))for(var r=0;r<e.length;++r)Va.apply(void 0,[t].concat(W(e[r])));else for(var n=0;n<e.length;n+=3)Va.apply(void 0,[t].concat(W(e.slice(n,n+3))));return t}function zc(t,e,r,n,a,i,o){var s=ne(t,6),f=s[0],c=s[1],u=s[2],v=s[3],g=s[4],p=s[5];return o===void 0?(t[0]=Math.min(e[0],f),t[1]=Math.max(e[1],c),t[2]=Math.min(e[2],u),t[3]=Math.max(e[3],v),t[4]=Math.min(e[4],g),t[5]=Math.max(e[5],p)):(t[0]=Math.min(e,f),t[1]=Math.max(r,c),t[2]=Math.min(n,u),t[3]=Math.max(a,v),t[4]=Math.min(i,g),t[5]=Math.max(o,p)),t}function bc(t,e,r,n){var a=ne(t,6),i=a[0],o=a[1],s=a[2],f=a[3],c=a[4],u=a[5];return t[0]=e,t[1]=e>o?e:o,t[2]=r,t[3]=r>f?r:f,t[4]=n,t[5]=n>u?n:u,i!==e||s!==r||c!==n}function Hc(t,e,r,n){var a=ne(t,6),i=a[0],o=a[1],s=a[2],f=a[3],c=a[4],u=a[5];return t[0]=e<i?e:i,t[1]=e,t[2]=r<s?r:s,t[3]=r,t[4]=n<c?n:c,t[5]=n,o!==e||f!==r||u!==n}function Kc(t,e){return t[0]-=e,t[1]+=e,t[2]-=e,t[3]+=e,t[4]-=e,t[5]+=e,t}function Ro(t,e,r,n){return Wt(t)?(e>=0?(t[0]*=e,t[1]*=e):(t[0]=e*t[1],t[1]=e*t[0]),r>=0?(t[2]*=r,t[3]*=r):(t[2]=r*t[3],t[3]=r*t[2]),n>=0?(t[4]*=n,t[5]*=n):(t[4]=n*t[5],t[5]=n*t[4]),!0):!1}function Vo(t){return[.5*(t[0]+t[1]),.5*(t[2]+t[3]),.5*(t[4]+t[5])]}function e1(t,e,r,n){if(!Wt(t))return!1;var a=Vo(t);return t[0]-=a[0],t[1]-=a[0],t[2]-=a[1],t[3]-=a[1],t[4]-=a[2],t[5]-=a[2],Ro(t,e,r,n),t[0]+=a[0],t[1]+=a[0],t[2]+=a[1],t[3]+=a[1],t[4]+=a[2],t[5]+=a[2],!0}function Dr(t,e){return t[e*2+1]-t[e*2]}function Aa(t){return[Dr(t,0),Dr(t,1),Dr(t,2)]}function Pc(t){return t.slice(0,2)}function Xc(t){return t.slice(2,4)}function Yc(t){return t.slice(4,6)}function Ac(t){var e=Aa(t);return e[0]>e[1]?e[0]>e[2]?e[0]:e[2]:e[1]>e[2]?e[1]:e[2]}function Zc(t){if(Wt(t)){var e=Aa(t);return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}return null}function Lo(t){return[t[0],t[2],t[4]]}function mo(t){return[t[1],t[3],t[5]]}function Kr(t,e){return t<=0&&e>=0||t>=0&&e<=0}function ko(t,e){for(var r=0,n=0;n<2;n++)for(var a=2;a<4;a++)for(var i=4;i<6;i++)e[r++]=[t[n],t[a],t[i]];return e}function qc(t,e,r){return e[0]=t[0],e[1]=t[2],e[2]=t[4],r[0]=t[1],r[1]=t[3],r[2]=t[5],e}function Jc(t,e){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],n=ko(t,[]),a=0;a<n.length;++a)Q(n[a],n[a],e);return Do(r),Eo(r,n)}function Qc(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e[0]=.5*(t[1]-t[0]),e[1]=.5*(t[3]-t[2]),e[2]=.5*(t[5]-t[4]),e}function Ic(t,e,r,n){for(var a=[].concat(Ya),i=t.getData(),o=0;o<i.length;o+=3){var s=[i[o],i[o+1],i[o+2]],f=A(s,e);a[0]=Math.min(f,a[0]),a[1]=Math.max(f,a[1]);var c=A(s,r);a[2]=Math.min(c,a[2]),a[3]=Math.max(c,a[3]);var u=A(s,n);a[4]=Math.min(u,a[4]),a[5]=Math.max(u,a[5])}return a}function eg(t,e,r,n,a){for(var i=!0,o=[],s=0,f=[],c=[0,0,0],u=0,v=1,g=2,p=0;p<3;p++)e[p]<t[2*p]?(o[p]=v,c[p]=t[2*p],i=!1):e[p]>t[2*p+1]?(o[p]=u,c[p]=t[2*p+1],i=!1):o[p]=g;if(i)return n[0]=e[0],n[1]=e[1],n[2]=e[2],a[0]=0,1;for(var l=0;l<3;l++)o[l]!==g&&r[l]!==0?f[l]=(c[l]-e[l])/r[l]:f[l]=-1;for(var h=0;h<3;h++)f[s]<f[h]&&(s=h);if(f[s]>1||f[s]<0)return 0;a[0]=f[s];for(var y=0;y<3;y++)if(s!==y){if(n[y]=e[y]+f[s]*r[y],n[y]<t[2*y]||n[y]>t[2*y+1])return 0}else n[y]=c[y];return 1}function tg(t,e,r){for(var n=[],a=0,i=1,o=1,s=4;s<=5;++s){n[2]=t[s];for(var f=2;f<=3;++f){n[1]=t[f];for(var c=0;c<=1;++c)if(n[0]=t[c],a=jt.evaluate(r,e,n),o&&(i=a>=0?1:-1,o=0),a===0||i>0&&a<0||i<0&&a>0)return 1}}return 0}function ng(t,e){if(!(Wt(t)&&Wt(e)))return!1;for(var r=[0,0,0,0,0,0],n,a=0;a<3;a++)if(n=!1,e[a*2]>=t[a*2]&&e[a*2]<=t[a*2+1]?(n=!0,r[a*2]=e[a*2]):t[a*2]>=e[a*2]&&t[a*2]<=e[a*2+1]&&(n=!0,r[a*2]=t[a*2]),e[a*2+1]>=t[a*2]&&e[a*2+1]<=t[a*2+1]?(n=!0,r[a*2+1]=e[2*a+1]):t[a*2+1]>=e[a*2]&&t[a*2+1]<=e[a*2+1]&&(n=!0,r[a*2+1]=t[a*2+1]),!n)return!1;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],!0}function La(t,e){if(!(Wt(t)&&Wt(e)))return!1;for(var r=0;r<3;r++)if(!(e[r*2]>=t[r*2]&&e[r*2]<=t[r*2+1])&&!(t[r*2]>=e[r*2]&&t[r*2]<=e[r*2+1])&&!(e[r*2+1]>=t[r*2]&&e[r*2+1]<=t[r*2+1])&&!(t[r*2+1]>=e[r*2]&&t[r*2+1]<=e[r*2+1]))return!1;return!0}function ma(t,e,r,n){return!(e<t[0]||e>t[1]||r<t[2]||r>t[3]||n<t[4]||n>t[5])}function t1(t,e){return!(!La(t,e)||!ma.apply(void 0,[t].concat(W(Lo(e))))||!ma.apply(void 0,[t].concat(W(mo(e)))))}function rg(t,e,r){for(var n=[[0,1,2,3,4,5,6,7],[0,1,4,5,2,3,6,7],[0,2,4,6,1,3,5,7]],a=[0,0,0,0,0,0,0,0],i=0,o=0;o<2;o++)for(var s=2;s<4;s++)for(var f=4;f<6;f++){var c=[t[o],t[s],t[f]];a[i++]=jt.evaluate(r,e,c)}for(var u=2;u--&&!(Kr(a[n[u][0]],a[n[u][4]])&&Kr(a[n[u][1]],a[n[u][5]])&&Kr(a[n[u][2]],a[n[u][6]])&&Kr(a[n[u][3]],a[n[u][7]])););if(u<0)return!1;for(var v=Math.sign(r[u]),g=Math.abs((t[u*2+1]-t[u*2])*r[u]),p=v>0?1:0,l=0;l<4;l++)if(g!==0){var h=Math.abs(a[n[u][l]])/g;v>0&&h<p&&(p=h),v<0&&h>p&&(p=h)}var y=(1-p)*t[u*2]+p*t[u*2+1];return v>0?t[u*2]=y:t[u*2+1]=y,!0}var n1=function(){function t(e){An(this,t),this.bounds=e,this.bounds||(this.bounds=new Float64Array(Ya))}return Zn(t,[{key:"getBounds",value:function(){return this.bounds}},{key:"equals",value:function(r){return $c(this.bounds,r)}},{key:"isValid",value:function(){return Wt(this.bounds)}},{key:"setBounds",value:function(r){return Mo(this.bounds,r)}},{key:"reset",value:function(){return Do(this.bounds)}},{key:"addPoint",value:function(){for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return Va.apply(void 0,[this.bounds].concat(n))}},{key:"addPoints",value:function(r){return Eo(this.bounds,r)}},{key:"addBounds",value:function(r,n,a,i,o,s){return zc(this.bounds,r,n,a,i,o,s)}},{key:"setMinPoint",value:function(r,n,a){return bc(this.bounds,r,n,a)}},{key:"setMaxPoint",value:function(r,n,a){return Hc(this.bounds,r,n,a)}},{key:"inflate",value:function(r){return Kc(this.bounds,r)}},{key:"scale",value:function(r,n,a){return Ro(this.bounds,r,n,a)}},{key:"getCenter",value:function(){return Vo(this.bounds)}},{key:"getLength",value:function(r){return Dr(this.bounds,r)}},{key:"getLengths",value:function(){return Aa(this.bounds)}},{key:"getMaxLength",value:function(){return Ac(this.bounds)}},{key:"getDiagonalLength",value:function(){return Zc(this.bounds)}},{key:"getMinPoint",value:function(){return Lo(this.bounds)}},{key:"getMaxPoint",value:function(){return mo(this.bounds)}},{key:"getXRange",value:function(){return Pc(this.bounds)}},{key:"getYRange",value:function(){return Xc(this.bounds)}},{key:"getZRange",value:function(){return Yc(this.bounds)}},{key:"getCorners",value:function(r){return ko(this.bounds,r)}},{key:"computeCornerPoints",value:function(r,n){return qc(this.bounds,r,n)}},{key:"computeLocalBounds",value:function(r,n,a){return Ic(this.bounds,r,n,a)}},{key:"transformBounds",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Jc(this.bounds,r,n)}},{key:"computeScale3",value:function(r){return Qc(this.bounds,r)}},{key:"cutWithPlane",value:function(r,n){return rg(this.bounds,r,n)}},{key:"intersectBox",value:function(r,n,a,i){return eg(this.bounds,r,n,a,i)}},{key:"intersectPlane",value:function(r,n){return tg(this.bounds,r,n)}},{key:"intersect",value:function(r){return ng(this.bounds,r)}},{key:"intersects",value:function(r){return La(this.bounds,r)}},{key:"containsPoint",value:function(r,n,a){return ma(this.bounds,r,n,a)}},{key:"contains",value:function(r){return La(this.bounds,r)}}]),t}();function r1(t){var e=t&&t.bounds;return new n1(e)}var a1={equals:$c,isValid:Wt,setBounds:Mo,reset:Do,addPoint:Va,addPoints:Eo,addBounds:zc,setMinPoint:bc,setMaxPoint:Hc,inflate:Kc,scale:Ro,scaleAboutCenter:e1,getCenter:Vo,getLength:Dr,getLengths:Aa,getMaxLength:Ac,getDiagonalLength:Zc,getMinPoint:Lo,getMaxPoint:mo,getXRange:Pc,getYRange:Xc,getZRange:Yc,getCorners:ko,computeCornerPoints:qc,computeLocalBounds:Ic,transformBounds:Jc,computeScale3:Qc,cutWithPlane:rg,intersectBox:eg,intersectPlane:tg,intersect:ng,intersects:La,containsPoint:ma,contains:t1,INIT_BOUNDS:Ya},J=Iy({newInstance:r1},a1),xs=T.vtkErrorMacro,i1=T.vtkWarningMacro;function o1(t,e){e.classHierarchy.push("vtkFieldData");var r=t.getState;e.arrays&&(e.arrays=e.arrays.map(function(n){return{data:ct(n.data)}})),t.initialize=function(){t.initializeFields(),t.copyAllOn(),t.clearFieldFlags()},t.initializeFields=function(){e.arrays=[],e.copyFieldFlags={},t.modified()},t.copyStructure=function(n){t.initializeFields(),e.copyFieldFlags=n.getCopyFieldFlags().map(function(a){return a}),e.arrays=n.arrays().map(function(a){return{array:a}})},t.getNumberOfArrays=function(){return e.arrays.length},t.getNumberOfActiveArrays=function(){return e.arrays.length},t.addArray=function(n){var a=n.getName(),i=t.getArrayWithIndex(a),o=i.array,s=i.index;return o!=null?(e.arrays[s]={data:n},s):(e.arrays=[].concat(e.arrays,{data:n}),e.arrays.length-1)},t.removeAllArrays=function(){e.arrays=[]},t.removeArray=function(n){var a=e.arrays.findIndex(function(i){return i.data.getName()===n});return t.removeArrayByIndex(a)},t.removeArrayByIndex=function(n){return n!==-1&&n<e.arrays.length?(e.arrays.splice(n,1),!0):!1},t.getArrays=function(){return e.arrays.map(function(n){return n.data})},t.getArray=function(n){return typeof n=="number"?t.getArrayByIndex(n):t.getArrayByName(n)},t.getArrayByName=function(n){return e.arrays.reduce(function(a,i,o){return i.data.getName()===n?i.data:a},null)},t.getArrayWithIndex=function(n){var a=e.arrays.findIndex(function(i){return i.data.getName()===n});return{array:a!==-1?e.arrays[a].data:null,index:a}},t.getArrayByIndex=function(n){return n>=0&&n<e.arrays.length?e.arrays[n].data:null},t.hasArray=function(n){return t.getArrayWithIndex(n).index>=0},t.getArrayName=function(n){var a=e.arrays[n];return a?a.data.getName():""},t.getCopyFieldFlags=function(){return e.copyFieldFlags},t.getFlag=function(n){return e.copyFieldFlags[n]},t.passData=function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;n.getArrays().forEach(function(o){var s=t.getFlag(o.getName());if(s!==!1&&!(e.doCopyAllOff&&s!==!0)&&o){var f=t.getArrayByName(o.getName());if(f)if(o.getNumberOfComponents()===f.getNumberOfComponents())if(a>-1&&a<o.getNumberOfTuples()){var g=i>-1?i:a;f.insertTuple(g,o.getTuple(a))}else f.insertTuples(0,o.getTuples());else xs("Unhandled case in passData");else if(a<0||a>o.getNumberOfTuples())t.addArray(o),n.getAttributes(o).forEach(function(p){t.setAttribute(o,p)});else{var c=o.getNumberOfComponents(),u=o.getNumberOfValues(),v=i>-1?i:a;u<=v*c&&(u=(v+1)*c),f=ie.newInstance({name:o.getName(),dataType:o.getDataType(),numberOfComponents:c,values:T.newTypedArray(o.getDataType(),u),size:0}),f.insertTuple(v,o.getTuple(a)),t.addArray(f),n.getAttributes(o).forEach(function(p){t.setAttribute(f,p)})}}})},t.interpolateData=function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:-1,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5;n.getArrays().forEach(function(f){var c=t.getFlag(f.getName());if(c!==!1&&!(e.doCopyAllOff&&c!==!0)&&f){var u=t.getArrayByName(f.getName());if(u)if(f.getNumberOfComponents()===u.getNumberOfComponents())if(a>-1&&a<f.getNumberOfTuples()){var l=o>-1?o:a;u.interpolateTuple(l,f,a,f,i,s),i1("Unexpected case in interpolateData")}else u.insertTuples(f.getTuples());else xs("Unhandled case in interpolateData");else if(a<0||i<0||a>f.getNumberOfTuples())t.addArray(f),n.getAttributes(f).forEach(function(h){t.setAttribute(f,h)});else{var v=f.getNumberOfComponents(),g=f.getNumberOfValues(),p=o>-1?o:a;g<=p*v&&(g=(p+1)*v),u=ie.newInstance({name:f.getName(),dataType:f.getDataType(),numberOfComponents:v,values:T.newTypedArray(f.getDataType(),g),size:0}),u.interpolateTuple(p,f,a,f,i,s),t.addArray(u),n.getAttributes(f).forEach(function(h){t.setAttribute(u,h)})}}})},t.copyFieldOn=function(n){e.copyFieldFlags[n]=!0},t.copyFieldOff=function(n){e.copyFieldFlags[n]=!1},t.copyAllOn=function(){(!e.doCopyAllOn||e.doCopyAllOff)&&(e.doCopyAllOn=!0,e.doCopyAllOff=!1,t.modified())},t.copyAllOff=function(){(e.doCopyAllOn||!e.doCopyAllOff)&&(e.doCopyAllOn=!1,e.doCopyAllOff=!0,t.modified())},t.clearFieldFlags=function(){e.copyFieldFlags={}},t.deepCopy=function(n){e.arrays=n.getArrays().map(function(a){var i=a.newClone();return i.deepCopy(a),{data:i}})},t.copyFlags=function(n){return n.getCopyFieldFlags().map(function(a){return a})},t.reset=function(){return e.arrays.forEach(function(n){return n.data.reset()})},t.getMTime=function(){return e.arrays.reduce(function(n,a){return a.data.getMTime()>n?a.data.getMTime():n},e.mtime)},t.getNumberOfComponents=function(){return e.arrays.reduce(function(n,a){return n+a.data.getNumberOfComponents()},0)},t.getNumberOfTuples=function(){return e.arrays.length>0?e.arrays[0].getNumberOfTuples():0},t.getState=function(){var n=r();return n&&(n.arrays=e.arrays.map(function(a){return{data:a.data.getState()}})),n}}var s1={arrays:[],copyFieldFlags:[],doCopyAllOn:!0,doCopyAllOff:!1};function ag(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,s1,r),T.obj(t,e),o1(t,e)}var u1=T.newInstance(ag,"vtkFieldData"),f1={newInstance:u1,extend:ag},c1={SCALARS:0,VECTORS:1,NORMALS:2,TCOORDS:3,TENSORS:4,GLOBALIDS:5,PEDIGREEIDS:6,EDGEFLAG:7,NUM_ATTRIBUTES:8},g1={MAX:0,EXACT:1,NOLIMIT:2},v1={DUPLICATECELL:1,HIGHCONNECTIVITYCELL:2,LOWCONNECTIVITYCELL:4,REFINEDCELL:8,EXTERIORCELL:16,HIDDENCELL:32},p1={DUPLICATEPOINT:1,HIDDENPOINT:2},l1={COPYTUPLE:0,INTERPOLATE:1,PASSDATA:2,ALLCOPY:3},h1="vtkGhostType",ka={DEFAULT:0,SINGLE:1,DOUBLE:2},Fo={AttributeCopyOperations:l1,AttributeLimitTypes:g1,AttributeTypes:c1,CellGhostTypes:v1,DesiredOutputPrecision:ka,PointGhostTypes:p1,ghostArrayName:h1};function Ms(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function ig(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Ms(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ms(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var zt=Fo.AttributeTypes,rn=Fo.AttributeCopyOperations,Pr=T.vtkWarningMacro;function y1(t,e){var r=["Scalars","Vectors","Normals","TCoords","Tensors","GlobalIds","PedigreeIds"];function n(o){var s=r.find(function(f){return zt[f.toUpperCase()]===o||typeof o!="number"&&f.toLowerCase()===o.toLowerCase()});return typeof s>"u"&&(s=null),s}e.classHierarchy.push("vtkDataSetAttributes");var a=ig({},t);t.checkNumberOfComponents=function(o){return!0},t.setAttribute=function(o,s){var f=n(s);if(o&&f.toUpperCase()==="PEDIGREEIDS"&&!o.isA("vtkDataArray"))return Pr("Cannot set attribute ".concat(f,". The attribute must be a vtkDataArray.")),-1;if(o&&!t.checkNumberOfComponents(o,f))return Pr("Cannot set attribute ".concat(f,". Incorrect number of components.")),-1;var c=e["active".concat(f)];if(c>=0&&c<e.arrays.length){if(e.arrays[c]===o)return c;t.removeArrayByIndex(c)}return o?(c=t.addArray(o),e["active".concat(f)]=c):e["active".concat(f)]=-1,t.modified(),e["active".concat(f)]},t.getAttributes=function(o){return r.filter(function(s){return t["get".concat(s)]()===o})},t.setActiveAttributeByName=function(o,s){return t.setActiveAttributeByIndex(t.getArrayWithIndex(o).index,s)},t.setActiveAttributeByIndex=function(o,s){var f=n(s);if(o>=0&&o<e.arrays.length){if(f.toUpperCase()!=="PEDIGREEIDS"){var c=t.getArrayByIndex(o);if(!c.isA("vtkDataArray"))return Pr("Cannot set attribute ".concat(f,". Only vtkDataArray subclasses can be set as active attributes.")),-1;if(!t.checkNumberOfComponents(c,f))return Pr("Cannot set attribute ".concat(f,". Incorrect number of components.")),-1}return e["active".concat(f)]=o,t.modified(),o}return o===-1&&(e["active".concat(f)]=o,t.modified()),-1},t.getActiveAttribute=function(o){var s=n(o);return t["get".concat(s)]()},t.removeAllArrays=function(){r.forEach(function(o){e["active".concat(o)]=-1}),a.removeAllArrays()},t.removeArrayByIndex=function(o){return o!==-1&&r.forEach(function(s){o===e["active".concat(s)]?e["active".concat(s)]=-1:o<e["active".concat(s)]&&(e["active".concat(s)]-=1)}),a.removeArrayByIndex(o)},r.forEach(function(o){var s="active".concat(o);t["get".concat(o)]=function(){return t.getArrayByIndex(e[s])},t["set".concat(o)]=function(f){return t.setAttribute(f,o)},t["setActive".concat(o)]=function(f){return t.setActiveAttributeByIndex(t.getArrayWithIndex(f).index,o)},t["copy".concat(o,"Off")]=function(){var f=o.toUpperCase();e.copyAttributeFlags[rn.PASSDATA][zt[f]]=!1},t["copy".concat(o,"On")]=function(){var f=o.toUpperCase();e.copyAttributeFlags[rn.PASSDATA][zt[f]]=!0}}),t.initializeAttributeCopyFlags=function(){e.copyAttributeFlags=[],Object.keys(rn).filter(function(o){return o!=="ALLCOPY"}).forEach(function(o){e.copyAttributeFlags[rn[o]]=Object.keys(zt).filter(function(s){return s!=="NUM_ATTRIBUTES"}).reduce(function(s,f){return s[zt[f]]=!0,s},[])}),e.copyAttributeFlags[rn.COPYTUPLE][zt.GLOBALIDS]=!1,e.copyAttributeFlags[rn.INTERPOLATE][zt.GLOBALIDS]=!1,e.copyAttributeFlags[rn.COPYTUPLE][zt.PEDIGREEIDS]=!1},t.initialize=T.chain(t.initialize,t.initializeAttributeCopyFlags),e.dataArrays&&Object.keys(e.dataArrays).length&&Object.keys(e.dataArrays).forEach(function(o){!e.dataArrays[o].ref&&e.dataArrays[o].type==="vtkDataArray"&&t.addArray(ie.newInstance(e.dataArrays[o]))});var i=t.shallowCopy;t.shallowCopy=function(o,s){i(o,s),e.arrays=o.getArrays().map(function(f){var c=f.newClone();return c.shallowCopy(f,s),{data:c}})},t.initializeAttributeCopyFlags()}var T1={activeScalars:-1,activeVectors:-1,activeTensors:-1,activeNormals:-1,activeTCoords:-1,activeGlobalIds:-1,activePedigreeIds:-1};function og(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,T1,r),f1.extend(t,e,r),T.setGet(t,e,["activeScalars","activeNormals","activeTCoords","activeVectors","activeTensors","activeGlobalIds","activePedigreeIds"]),e.arrays||(e.arrays={}),y1(t,e)}var C1=T.newInstance(og,"vtkDataSetAttributes"),Ds=ig({newInstance:C1,extend:og},Fo),S1={UNIFORM:0,DATA_OBJECT_FIELD:0,COORDINATE:1,POINT_DATA:1,POINT:2,POINT_FIELD_DATA:2,CELL:3,CELL_FIELD_DATA:3,VERTEX:4,VERTEX_FIELD_DATA:4,EDGE:5,EDGE_FIELD_DATA:5,ROW:6,ROW_DATA:6},No={FIELD_ASSOCIATION_POINTS:0,FIELD_ASSOCIATION_CELLS:1,FIELD_ASSOCIATION_NONE:2,FIELD_ASSOCIATION_POINTS_THEN_CELLS:3,FIELD_ASSOCIATION_VERTICES:4,FIELD_ASSOCIATION_EDGES:5,FIELD_ASSOCIATION_ROWS:6,NUMBER_OF_ASSOCIATIONS:7},d1={FieldDataTypes:S1,FieldAssociations:No};function Es(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function O1(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Es(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Es(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var Ai=["pointData","cellData","fieldData"];function w1(t,e){e.classHierarchy.push("vtkDataSet"),Ai.forEach(function(n){e[n]?e[n]=ct(e[n]):e[n]=Ds.newInstance()});var r=t.shallowCopy;t.shallowCopy=function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;r(n,a),Ai.forEach(function(i){e[i]=Ds.newInstance(),e[i].shallowCopy(n.getReferenceByName(i))})}}var x1={};function sg(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,x1,r),T.obj(t,e),T.setGet(t,e,Ai),w1(t,e)}var M1=T.newInstance(sg,"vtkDataSet"),Jn=O1({newInstance:M1,extend:sg},d1),Tt={UNCHANGED:0,SINGLE_POINT:1,X_LINE:2,Y_LINE:3,Z_LINE:4,XY_PLANE:5,YZ_PLANE:6,XZ_PLANE:7,XYZ_GRID:8,EMPTY:9},ug={StructuredType:Tt};function Rs(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function D1(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Rs(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Rs(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var Lt=ug.StructuredType;function E1(t){for(var e=0,r=0;r<3;++r)t[r*2]<t[r*2+1]&&e++;return t[0]>t[1]||t[2]>t[3]||t[4]>t[5]?Lt.EMPTY:e===3?Lt.XYZ_GRID:e===2?t[0]===t[1]?Lt.YZ_PLANE:t[2]===t[3]?Lt.XZ_PLANE:Lt.XY_PLANE:e===1?t[0]<t[1]?Lt.X_LINE:t[2]<t[3]?Lt.Y_LINE:Lt.Z_LINE:Lt.SINGLE_POINT}var R1=D1({getDataDescriptionFromExtent:E1},ug),an=T.vtkErrorMacro;function V1(t,e){e.classHierarchy.push("vtkImageData"),t.setExtent=function(){if(e.deleted)return an("instance deleted - cannot call any method"),!1;for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];var i=n.length===1?n[0]:n;if(i.length!==6)return!1;var o=e.extent.some(function(s,f){return s!==i[f]});return o&&(e.extent=i.slice(),e.dataDescription=R1.getDataDescriptionFromExtent(e.extent),t.modified()),o},t.setDimensions=function(){var r,n,a;if(e.deleted){an("instance deleted - cannot call any method");return}if(arguments.length===1){var i=arguments.length<=0?void 0:arguments[0];r=i[0],n=i[1],a=i[2]}else if(arguments.length===3)r=arguments.length<=0?void 0:arguments[0],n=arguments.length<=1?void 0:arguments[1],a=arguments.length<=2?void 0:arguments[2];else{an("Bad dimension specification");return}t.setExtent(0,r-1,0,n-1,0,a-1)},t.getDimensions=function(){return[e.extent[1]-e.extent[0]+1,e.extent[3]-e.extent[2]+1,e.extent[5]-e.extent[4]+1]},t.getNumberOfCells=function(){for(var r=t.getDimensions(),n=1,a=0;a<3;a++){if(r[a]===0)return 0;r[a]>1&&(n*=r[a]-1)}return n},t.getNumberOfPoints=function(){var r=t.getDimensions();return r[0]*r[1]*r[2]},t.getPoint=function(r){var n=t.getDimensions();if(n[0]===0||n[1]===0||n[2]===0)return an("Requesting a point from an empty image."),null;var a=new Float64Array(3);switch(e.dataDescription){case Tt.EMPTY:return null;case Tt.SINGLE_POINT:break;case Tt.X_LINE:a[0]=r;break;case Tt.Y_LINE:a[1]=r;break;case Tt.Z_LINE:a[2]=r;break;case Tt.XY_PLANE:a[0]=r%n[0],a[1]=r/n[0];break;case Tt.YZ_PLANE:a[1]=r%n[1],a[2]=r/n[1];break;case Tt.XZ_PLANE:a[0]=r%n[0],a[2]=r/n[0];break;case Tt.XYZ_GRID:a[0]=r%n[0],a[1]=r/n[0]%n[1],a[2]=r/(n[0]*n[1]);break;default:an("Invalid dataDescription");break}var i=[0,0,0];return t.indexToWorld(a,i),i},t.getBounds=function(){return t.extentToBounds(t.getSpatialExtent())},t.extentToBounds=function(r){return J.transformBounds(r,e.indexToWorld)},t.getSpatialExtent=function(){return J.inflate(W(e.extent),.5)},t.computeTransforms=function(){H0(e.indexToWorld,e.origin),e.indexToWorld[0]=e.direction[0],e.indexToWorld[1]=e.direction[1],e.indexToWorld[2]=e.direction[2],e.indexToWorld[4]=e.direction[3],e.indexToWorld[5]=e.direction[4],e.indexToWorld[6]=e.direction[5],e.indexToWorld[8]=e.direction[6],e.indexToWorld[9]=e.direction[7],e.indexToWorld[10]=e.direction[8],Kn(e.indexToWorld,e.indexToWorld,e.spacing),at(e.worldToIndex,e.indexToWorld)},t.indexToWorld=function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Q(n,r,e.indexToWorld),n},t.indexToWorldVec3=t.indexToWorld,t.worldToIndex=function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Q(n,r,e.worldToIndex),n},t.worldToIndexVec3=t.worldToIndex,t.indexToWorldBounds=function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return J.transformBounds(r,e.indexToWorld,n)},t.worldToIndexBounds=function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return J.transformBounds(r,e.worldToIndex,n)},t.onModified(t.computeTransforms),t.computeTransforms(),t.getCenter=function(){return J.getCenter(t.getBounds())},t.computeHistogram=function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,a=[0,0,0,0,0,0];t.worldToIndexBounds(r,a);var i=[0,0,0],o=[0,0,0];J.computeCornerPoints(a,i,o),zi(i,i),zi(o,o);var s=t.getDimensions();Hi(i,[0,0,0],[s[0]-1,s[1]-1,s[2]-1],i),Hi(o,[0,0,0],[s[0]-1,s[1]-1,s[2]-1],o);for(var f=s[0],c=s[0]*s[1],u=t.getPointData().getScalars().getData(),v=-1/0,g=1/0,p=0,l=0,h=0,y=i[2];y<=o[2];y++)for(var C=i[1];C<=o[1];C++)for(var S=i[0]+C*f+y*c,d=i[0];d<=o[0];d++){if(!n||n([d,C,y],a)){var O=u[S];O>v&&(v=O),O<g&&(g=O),p+=O*O,l+=O,h+=1}++S}var w=h>0?l/h:0,M=h?Math.abs(p/h-w*w):0,x=Math.sqrt(M);return{minimum:g,maximum:v,average:w,variance:M,sigma:x,count:h}},t.computeIncrements=function(r){for(var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,a=[],i=n,o=0;o<3;++o)a[o]=i,i*=r[o*2+1]-r[o*2]+1;return a},t.computeOffsetIndex=function(r){var n=ne(r,3),a=n[0],i=n[1],o=n[2],s=t.getExtent(),f=t.getPointData().getScalars().getNumberOfComponents(),c=t.computeIncrements(s,f);return Math.floor((Math.round(a)-s[0])*c[0]+(Math.round(i)-s[2])*c[1]+(Math.round(o)-s[4])*c[2])},t.getOffsetIndexFromWorld=function(r){for(var n=t.getExtent(),a=t.worldToIndex(r),i=0;i<3;++i)if(a[i]<n[i*2]||a[i]>n[i*2+1])return an("GetScalarPointer: Pixel ".concat(a," is not in memory. Current extent = ").concat(n)),NaN;return t.computeOffsetIndex(a)},t.getScalarValueFromWorld=function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,a=t.getPointData().getScalars().getNumberOfComponents();if(n<0||n>=a)return an("GetScalarPointer: Scalar Component ".concat(n," is not within bounds. Current Scalar numberOfComponents: ").concat(a)),NaN;var i=t.getOffsetIndexFromWorld(r);return Number.isNaN(i)?i:t.getPointData().getScalars().getComponent(i,n)}}var L1={direction:null,indexToWorld:null,worldToIndex:null,spacing:[1,1,1],origin:[0,0,0],extent:[0,-1,0,-1,0,-1],dataDescription:Tt.EMPTY};function fg(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,L1,r),Jn.extend(t,e,r),e.direction?Array.isArray(e.direction)&&(e.direction=new Float64Array(e.direction.slice(0,9))):e.direction=_t(new Float64Array(9)),e.indexToWorld=new Float64Array(16),e.worldToIndex=new Float64Array(16),T.get(t,e,["indexToWorld","worldToIndex"]),T.setGetArray(t,e,["origin","spacing"],3),T.setGetArray(t,e,["direction"],9),T.getArray(t,e,["extent"],6),V1(t,e)}var m1=T.newInstance(fg,"vtkImageData"),Ur={newInstance:m1,extend:fg},k1={MAGNITUDE:0,COMPONENT:1,RGBCOLORS:2},Zi={LUMINANCE:1,LUMINANCE_ALPHA:2,RGB:3,RGBA:4},Za={VectorMode:k1,ScalarMappingTarget:Zi},F1={DEFAULT:0,MAP_SCALARS:1,DIRECT_SCALARS:2},cg={DEFAULT:0,USE_POINT_DATA:1,USE_CELL_DATA:2,USE_POINT_FIELD_DATA:3,USE_CELL_FIELD_DATA:4,USE_FIELD_DATA:5},N1={BY_ID:0,BY_NAME:1},tn={ColorMode:F1,GetArray:N1,ScalarMode:cg};function Vs(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function U1(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Vs(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Vs(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var Ls=Za.ScalarMappingTarget,Mt=Za.VectorMode,on=ie.VtkDataTypes,Xr=tn.ColorMode,ms=T.vtkErrorMacro;function G1(t){return t}function ks(t){return Math.floor(t*255+.5)}function B1(t,e){e.classHierarchy.push("vtkScalarsToColors"),t.setVectorModeToMagnitude=function(){return t.setVectorMode(Mt.MAGNITUDE)},t.setVectorModeToComponent=function(){return t.setVectorMode(Mt.COMPONENT)},t.setVectorModeToRGBColors=function(){return t.setVectorMode(Mt.RGBCOLORS)},t.build=function(){},t.isOpaque=function(){return!0},t.setAnnotations=function(r,n){if(!(r&&!n||!r&&n)){if(r&&n&&r.length!==n.length){ms("Values and annotations do not have the same number of tuples so ignoring");return}if(e.annotationArray=[],n&&r)for(var a=n.length,i=0;i<a;i++)e.annotationArray.push({value:r[i],annotation:String(n[i])});t.updateAnnotatedValueMap(),t.modified()}},t.setAnnotation=function(r,n){var a=t.checkForAnnotatedValue(r),i=!1;return a>=0?e.annotationArray[a].annotation!==n&&(e.annotationArray[a].annotation=n,i=!0):(e.annotationArray.push({value:r,annotation:n}),a=e.annotationArray.length-1,i=!0),i&&(t.updateAnnotatedValueMap(),t.modified()),a},t.getNumberOfAnnotatedValues=function(){return e.annotationArray.length},t.getAnnotatedValue=function(r){return r<0||r>=e.annotationArray.length?null:e.annotationArray[r].value},t.getAnnotation=function(r){return e.annotationArray[r]===void 0?null:e.annotationArray[r].annotation},t.getAnnotatedValueIndex=function(r){return e.annotationArray.length?t.checkForAnnotatedValue(r):-1},t.removeAnnotation=function(r){var n=t.checkForAnnotatedValue(r),a=n>=0;return a&&(e.annotationArray.splice(n,1),t.updateAnnotatedValueMap(),t.modified()),a},t.resetAnnotations=function(){e.annotationArray=[],e.annotatedValueMap=[],t.modified()},t.getAnnotationColor=function(r,n){if(e.indexedLookup){var a=t.getAnnotatedValueIndex(r);t.getIndexedColor(a,n)}else t.getColor(parseFloat(r),n),n[3]=1},t.checkForAnnotatedValue=function(r){return t.getAnnotatedValueIndexInternal(r)},t.getAnnotatedValueIndexInternal=function(r){if(e.annotatedValueMap[r]!==void 0){var n=e.annotationArray.length;return e.annotatedValueMap[r]%n}return-1},t.getIndexedColor=function(r,n){n[0]=0,n[1]=0,n[2]=0,n[3]=0},t.updateAnnotatedValueMap=function(){e.annotatedValueMap=[];for(var r=e.annotationArray.length,n=0;n<r;n++)e.annotatedValueMap[e.annotationArray[n].value]=n},t.mapScalars=function(r,n,a){var i=r.getNumberOfComponents(),o=null;if(n===Xr.DEFAULT&&r.getDataType()===on.UNSIGNED_CHAR||n===Xr.DIRECT_SCALARS&&r)o=t.convertToRGBA(r,i,r.getNumberOfTuples());else{var s={type:"vtkDataArray",name:"temp",numberOfComponents:4,dataType:on.UNSIGNED_CHAR},f=T.newTypedArray(s.dataType,4*r.getNumberOfTuples());s.values=f,s.size=f.length,o=ie.newInstance(s);var c=a;c<0&&i>1?t.mapVectorsThroughTable(r,o,Ls.RGBA,-1,-1):(c<0&&(c=0),c>=i&&(c=i-1),t.mapScalarsThroughTable(r,o,Ls.RGBA,c))}return o},t.mapVectorsToMagnitude=function(r,n,a){for(var i=r.getNumberOfTuples(),o=r.getNumberOfComponents(),s=n.getData(),f=r.getData(),c=0;c<i;c++){for(var u=0,v=0;v<a;v++)u+=f[c*o+v]*f[c*o+v];s[c]=Math.sqrt(u)}},t.mapVectorsThroughTable=function(r,n,a,i,o){var s=t.getVectorMode(),f=o,c=i,u=r.getNumberOfComponents();s===Mt.COMPONENT?(c===-1&&(c=t.getVectorComponent()),c<0&&(c=0),c>=u&&(c=u-1)):(f===-1&&(f=t.getVectorSize()),f<=0?(c=0,f=u):(c<0&&(c=0),c>=u&&(c=u-1),c+f>u&&(f=u-c)),s===Mt.MAGNITUDE&&(u===1||f===1)&&(s=Mt.COMPONENT));var v=0;switch(c>0&&(v=c),s){case Mt.COMPONENT:{t.mapScalarsThroughTable(r,n,a,v);break}case Mt.RGBCOLORS:break;case Mt.MAGNITUDE:default:{var g=ie.newInstance({numberOfComponents:1,values:new Float32Array(r.getNumberOfTuples())});t.mapVectorsToMagnitude(r,g,f),t.mapScalarsThroughTable(g,n,a,0);break}}},t.luminanceToRGBA=function(r,n,a,i){for(var o=i(a),s=n.getData(),f=r.getData(),c=s.length,u=0,v=1,g=0,p=u;p<c;p+=v){var l=i(s[p]);f[g*4]=l,f[g*4+1]=l,f[g*4+2]=l,f[g*4+3]=o,g++}},t.luminanceAlphaToRGBA=function(r,n,a,i){for(var o=n.getData(),s=r.getData(),f=o.length,c=0,u=2,v=0,g=c;g<f;g+=u){var p=i(o[g]);s[v]=p,s[v+1]=p,s[v+2]=p,s[v+3]=i(o[g+1])*a,v+=4}},t.rGBToRGBA=function(r,n,a,i){for(var o=ks(a),s=n.getData(),f=r.getData(),c=s.length,u=0,v=3,g=0,p=u;p<c;p+=v)f[g*4]=i(s[p]),f[g*4+1]=i(s[p+1]),f[g*4+2]=i(s[p+2]),f[g*4+3]=o,g++},t.rGBAToRGBA=function(r,n,a,i){for(var o=n.getData(),s=r.getData(),f=o.length,c=0,u=4,v=0,g=c;g<f;g+=u)s[v*4]=i(o[g]),s[v*4+1]=i(o[g+1]),s[v*4+2]=i(o[g+2]),s[v*4+3]=i(o[g+3])*a,v++},t.convertToRGBA=function(r,n,a){var i=e.alpha;if(n===4&&i>=1&&r.getDataType()===on.UNSIGNED_CHAR)return r;var o=ie.newInstance({numberOfComponents:4,empty:!0,size:4*a,dataType:on.UNSIGNED_CHAR});if(a<=0)return o;i=i>0?i:0,i=i<1?i:1;var s=G1;switch((r.getDataType()===on.FLOAT||r.getDataType()===on.DOUBLE)&&(s=ks),n){case 1:t.luminanceToRGBA(o,r,i,s);break;case 2:t.luminanceAlphaToRGBA(o,r,s);break;case 3:t.rGBToRGBA(o,r,i,s);break;case 4:t.rGBAToRGBA(o,r,i,s);break;default:return ms("Cannot convert colors"),null}return o},t.usingLogScale=function(){return!1},t.getNumberOfAvailableColors=function(){return 256*256*256},t.setRange=function(r,n){return t.setMappingRange(r,n)},t.getRange=function(){return t.getMappingRange()},t.areScalarsOpaque=function(r,n,a){if(!r)return t.isOpaque();var i=r.getNumberOfComponents();if(n===Xr.DEFAULT&&r.getDataType()===on.UNSIGNED_CHAR||n===Xr.DIRECT_SCALARS){if(i===3||i===1)return e.alpha>=1;var o=r.getRange(i-1);return o[0]===255}return!0}}var _1={alpha:1,vectorComponent:0,vectorSize:-1,vectorMode:Mt.COMPONENT,mappingRange:null,annotationArray:null,annotatedValueMap:null,indexedLookup:!1};function gg(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,_1,r),T.obj(t,e),e.mappingRange=[0,255],e.annotationArray=[],e.annotatedValueMap=[],T.setGet(t,e,["vectorSize","vectorComponent","vectorMode","alpha","indexedLookup"]),T.setArray(t,e,["mappingRange"],2),T.getArray(t,e,["mappingRange"]),B1(t,e)}var j1=T.newInstance(gg,"vtkScalarsToColors"),qa=U1({newInstance:j1,extend:gg},Za),Fs=T.vtkErrorMacro,Ns=0,Us=1,ui=2;function W1(t,e){e.classHierarchy.push("vtkLookupTable"),t.isOpaque=function(){if(e.opaqueFlagBuildTime.getMTime()<t.getMTime()){var r=!0;e.nanColor[3]<1&&(r=0),e.useBelowRangeColor&&e.belowRangeColor[3]<1&&(r=0),e.useAboveRangeColor&&e.aboveRangeColor[3]<1&&(r=0);for(var n=3;n<e.table.length&&r;n+=4)e.table[n]<255&&(r=!1);e.opaqueFlag=r,e.opaqueFlagBuildTime.modified()}return e.opaqueFlag},t.usingLogScale=function(){return!1},t.getNumberOfAvailableColors=function(){return e.table.length/4},t.linearIndexLookup=function(r,n){var a=0;return r<n.range[0]?a=n.maxIndex+Ns+1.5:r>n.range[1]?a=n.maxIndex+Us+1.5:(a=(r+n.shift)*n.scale,a=a<n.maxIndex?a:n.maxIndex),Math.floor(a)},t.linearLookup=function(r,n,a){var i=0;Ea(r)?i=Math.floor(a.maxIndex+1.5+ui):i=t.linearIndexLookup(r,a);var o=4*i;return n.slice(o,o+4)},t.indexedLookupFunction=function(r,n,a){var i=t.getAnnotatedValueIndexInternal(r);i===-1&&(i=e.numberOfColors+ui);var o=4*i;return[n[o],n[o+1],n[o+2],n[o+3]]},t.lookupShiftAndScale=function(r,n){n.shift=-r[0],n.scale=Number.MAX_VALUE,r[1]>r[0]&&(n.scale=(n.maxIndex+1)/(r[1]-r[0]))},t.mapScalarsThroughTable=function(r,n,a,i){var o=t.linearLookup;e.indexedLookup&&(o=t.indexedLookupFunction);var s=t.getMappingRange(),f={maxIndex:t.getNumberOfColors()-1,range:s,shift:0,scale:0};t.lookupShiftAndScale(s,f);var c=t.getAlpha(),u=r.getNumberOfTuples(),v=r.getNumberOfComponents(),g=n.getData(),p=r.getData();if(c>=1){if(a===Zi.RGBA)for(var l=0;l<u;l++){var h=o(p[l*v+i],e.table,f);g[l*4]=h[0],g[l*4+1]=h[1],g[l*4+2]=h[2],g[l*4+3]=h[3]}}else if(a===Zi.RGBA)for(var y=0;y<u;y++){var C=o(p[y*v+i],e.table,f);g[y*4]=C[0],g[y*4+1]=C[1],g[y*4+2]=C[2],g[y*4+3]=Math.floor(C[3]*c+.5)}},t.forceBuild=function(){var r=0,n=0,a=0,i=0,o=e.numberOfColors-1;o&&(r=(e.hueRange[1]-e.hueRange[0])/o,n=(e.saturationRange[1]-e.saturationRange[0])/o,a=(e.valueRange[1]-e.valueRange[0])/o,i=(e.alphaRange[1]-e.alphaRange[0])/o),e.table.length=4*o+16;for(var s=[],f=[],c=0;c<=o;c++)s[0]=e.hueRange[0]+c*r,s[1]=e.saturationRange[0]+c*n,s[2]=e.valueRange[0]+c*a,pn(s,f),f[3]=e.alphaRange[0]+c*i,e.table[c*4]=f[0]*255+.5,e.table[c*4+1]=f[1]*255+.5,e.table[c*4+2]=f[2]*255+.5,e.table[c*4+3]=f[3]*255+.5;t.buildSpecialColors(),e.buildTime.modified()},t.setTable=function(r){if(r.getNumberOfComponents()!==4){Fs("Expected 4 components for RGBA colors");return}if(r.getDataType()!==Me.UNSIGNED_CHAR){Fs("Expected unsigned char values for RGBA colors");return}e.numberOfColors=r.getNumberOfTuples();var n=r.getData();e.table.length=n.length;for(var a=0;a<n.length;a++)e.table[a]=n[a];t.buildSpecialColors(),e.insertTime.modified(),t.modified()},t.buildSpecialColors=function(){var r=e.numberOfColors,n=e.table,a=(r+Ns)*4;e.useBelowRangeColor||r===0?(n[a]=e.belowRangeColor[0]*255+.5,n[a+1]=e.belowRangeColor[1]*255+.5,n[a+2]=e.belowRangeColor[2]*255+.5,n[a+3]=e.belowRangeColor[3]*255+.5):(n[a]=n[0],n[a+1]=n[1],n[a+2]=n[2],n[a+3]=n[3]),a=(r+Us)*4,e.useAboveRangeColor||r===0?(n[a]=e.aboveRangeColor[0]*255+.5,n[a+1]=e.aboveRangeColor[1]*255+.5,n[a+2]=e.aboveRangeColor[2]*255+.5,n[a+3]=e.aboveRangeColor[3]*255+.5):(n[a]=n[4*(r-1)+0],n[a+1]=n[4*(r-1)+1],n[a+2]=n[4*(r-1)+2],n[a+3]=n[4*(r-1)+3]),a=(r+ui)*4,n[a]=e.nanColor[0]*255+.5,n[a+1]=e.nanColor[1]*255+.5,n[a+2]=e.nanColor[2]*255+.5,n[a+3]=e.nanColor[3]*255+.5},t.build=function(){(e.table.length<1||t.getMTime()>e.buildTime.getMTime()&&e.insertTime.getMTime()<=e.buildTime.getMTime())&&t.forceBuild()},e.table.length>0&&e.insertTime.modified()}var $1={numberOfColors:256,hueRange:[0,.66667],saturationRange:[1,1],valueRange:[1,1],alphaRange:[1,1],nanColor:[.5,0,0,1],belowRangeColor:[0,0,0,1],aboveRangeColor:[1,1,1,1],useAboveRangeColor:!1,useBelowRangeColor:!1,alpha:1};function vg(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$1,r),qa.extend(t,e,r),e.table||(e.table=[]),e.buildTime={},T.obj(e.buildTime),e.opaqueFlagBuildTime={},T.obj(e.opaqueFlagBuildTime,{mtime:0}),e.insertTime={},T.obj(e.insertTime,{mtime:0}),T.get(t,e,["buildTime"]),T.setGet(t,e,["numberOfColors","useAboveRangeColor","useBelowRangeColor"]),T.setArray(t,e,["alphaRange","hueRange","saturationRange","valueRange"],2),T.setArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"],4),T.getArray(t,e,["hueRange","saturationRange","valueRange","alphaRange","nanColor","belowRangeColor","aboveRangeColor"]),W1(t,e)}var z1=T.newInstance(vg,"vtkLookupTable"),pr={newInstance:z1,extend:vg},pg=1,Uo=0,b1=["VTK_RESOLVE_OFF","VTK_RESOLVE_POLYGON_OFFSET"];function H1(){return pg}function K1(t){pg=t}function P1(){return Uo}function Ja(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;Uo=t}function X1(){Ja(0)}function Y1(){Ja(0)}function A1(){Ja(1)}function Z1(){return b1[Uo]}var qi={getResolveCoincidentTopologyAsString:Z1,getResolveCoincidentTopologyPolygonOffsetFaces:H1,getResolveCoincidentTopology:P1,setResolveCoincidentTopology:Ja,setResolveCoincidentTopologyPolygonOffsetFaces:K1,setResolveCoincidentTopologyToDefault:X1,setResolveCoincidentTopologyToOff:Y1,setResolveCoincidentTopologyToPolygonOffset:A1};function lg(t,e,r){r.forEach(function(n){t["get".concat(n.method)]=function(){return e[n.key]},t["set".concat(n.method)]=function(a,i){e[n.key]={factor:a,offset:i}}})}var Qa=["Polygon","Line","Point"],q1={Polygon:{factor:2,offset:0},Line:{factor:1,offset:-1},Point:{factor:0,offset:-2}},ln={};lg(ln,q1,Qa.map(function(t){return{key:t,method:"ResolveCoincidentTopology".concat(t,"OffsetParameters")}}));function J1(t,e){e.resolveCoincidentTopology===void 0&&(e.resolveCoincidentTopology=!1),T.setGet(t,e,["resolveCoincidentTopology"]),e.topologyOffset={Polygon:{factor:0,offset:0},Line:{factor:0,offset:0},Point:{factor:0,offset:0}},Object.keys(qi).forEach(function(r){t[r]=qi[r]}),Object.keys(ln).forEach(function(r){t[r]=ln[r]}),lg(t,e.topologyOffset,Qa.map(function(r){return{key:r,method:"RelativeCoincidentTopology".concat(r,"OffsetParameters")}})),t.getCoincidentTopologyPolygonOffsetParameters=function(){var r=ln.getResolveCoincidentTopologyPolygonOffsetParameters(),n=t.getRelativeCoincidentTopologyPolygonOffsetParameters();return{factor:r.factor+n.factor,offset:r.offset+n.offset}},t.getCoincidentTopologyLineOffsetParameters=function(){var r=ln.getResolveCoincidentTopologyLineOffsetParameters(),n=t.getRelativeCoincidentTopologyLineOffsetParameters();return{factor:r.factor+n.factor,offset:r.offset+n.offset}},t.getCoincidentTopologyPointOffsetParameter=function(){var r=ln.getResolveCoincidentTopologyPointOffsetParameters(),n=t.getRelativeCoincidentTopologyPointOffsetParameters();return{factor:r.factor+n.factor,offset:r.offset+n.offset}}}var Qn={implementCoincidentTopologyMethods:J1,staticOffsetAPI:ln,otherStaticMethods:qi,CATEGORIES:Qa},Ze={MIN_KNOWN_PASS:0,ACTOR_PASS:0,COMPOSITE_INDEX_PASS:1,ID_LOW24:2,ID_HIGH24:3,MAX_KNOWN_PASS:3},hg={PassTypes:Ze};function Gs(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function fi(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Gs(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Gs(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var Bs=Jn.FieldAssociations,Q1=Qn.staticOffsetAPI,I1=Qn.otherStaticMethods,ci=tn.ColorMode,sn=tn.ScalarMode,gi=tn.GetArray,eT=Za.VectorMode,tT=ie.VtkDataTypes;function er(t){return function(){return T.vtkErrorMacro("vtkMapper::".concat(t," - NOT IMPLEMENTED"))}}function nT(t,e){e.classHierarchy.push("vtkMapper"),t.getBounds=function(){var r=t.getInputData();return r?(e.static||t.update(),e.bounds=r.getBounds()):e.bounds=xn(),e.bounds},t.setForceCompileOnly=function(r){e.forceCompileOnly=r},t.createDefaultLookupTable=function(){e.lookupTable=pr.newInstance()},t.getColorModeAsString=function(){return T.enumToString(ci,e.colorMode)},t.setColorModeToDefault=function(){return t.setColorMode(0)},t.setColorModeToMapScalars=function(){return t.setColorMode(1)},t.setColorModeToDirectScalars=function(){return t.setColorMode(2)},t.getScalarModeAsString=function(){return T.enumToString(sn,e.scalarMode)},t.setScalarModeToDefault=function(){return t.setScalarMode(0)},t.setScalarModeToUsePointData=function(){return t.setScalarMode(1)},t.setScalarModeToUseCellData=function(){return t.setScalarMode(2)},t.setScalarModeToUsePointFieldData=function(){return t.setScalarMode(3)},t.setScalarModeToUseCellFieldData=function(){return t.setScalarMode(4)},t.setScalarModeToUseFieldData=function(){return t.setScalarMode(5)},t.getAbstractScalars=function(r,n,a,i,o){if(!r||!e.scalarVisibility)return{scalars:null,cellFLag:!1};var s=null,f=!1;if(n===sn.DEFAULT)s=r.getPointData().getScalars(),s||(s=r.getCellData().getScalars(),f=!0);else if(n===sn.USE_POINT_DATA)s=r.getPointData().getScalars();else if(n===sn.USE_CELL_DATA)s=r.getCellData().getScalars(),f=!0;else if(n===sn.USE_POINT_FIELD_DATA){var c=r.getPointData();a===gi.BY_ID?s=c.getArrayByIndex(i):s=c.getArrayByName(o)}else if(n===sn.USE_CELL_FIELD_DATA){var u=r.getCellData();f=!0,a===gi.BY_ID?s=u.getArrayByIndex(i):s=u.getArrayByName(o)}else if(n===sn.USE_FIELD_DATA){var v=r.getFieldData();a===gi.BY_ID?s=v.getArrayByIndex(i):s=v.getArrayByName(o)}return{scalars:s,cellFlag:f}},t.mapScalars=function(r,n){var a=t.getAbstractScalars(r,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName).scalars;if(!a){e.colorCoordinates=null,e.colorTextureMap=null,e.colorMapColors=null;return}var i="".concat(t.getMTime()).concat(a.getMTime()).concat(n);if(e.colorBuildString!==i){if(e.useLookupTableScalarRange||t.getLookupTable().setRange(e.scalarRange[0],e.scalarRange[1]),t.canUseTextureMapForColoring(r))t.mapScalarsToTexture(a,n);else{e.colorCoordinates=null,e.colorTextureMap=null;var o=t.getLookupTable();o&&(o.build(),e.colorMapColors=o.mapScalars(a,e.colorMode,e.fieldDataTupleId))}e.colorBuildString="".concat(t.getMTime()).concat(a.getMTime()).concat(n)}},t.scalarToTextureCoordinate=function(r,n,a){var i=.5,o=1;return Ea(r)||(o=.49,i=(r-n)*a,i>1e3?i=1e3:i<-1e3&&(i=-1e3)),{texCoordS:i,texCoordT:o}},t.createColorTextureCoordinates=function(r,n,a,i,o,s,f,c,u){var v=(s[1]-s[0])/c,g=[];g[0]=s[0]-v,g[1]=s[1]+v;var p=1/(g[1]-g[0]),l=n.getData(),h=r.getData(),y=0,C=0;if(o<0||o>=i)for(var S=0;S<a;++S){for(var d=0,O=0;O<i;++O)d+=h[y]*h[y],y++;var w=Math.sqrt(d);u&&(w=pr.applyLogScale(w,f,s));var M=t.scalarToTextureCoordinate(w,g[0],p);l[C]=M.texCoordS,l[C+1]=M.texCoordT,C+=2}else{y+=o;for(var x=0;x<a;++x){var D=h[y];u&&(D=pr.applyLogScale(D,f,s));var R=t.scalarToTextureCoordinate(D,g[0],p);l[C]=R.texCoordS,l[C+1]=R.texCoordT,C+=2,y+=i}}},t.mapScalarsToTexture=function(r,n){var a=e.lookupTable.getRange(),i=e.lookupTable.usingLogScale();i&&pr.getLogRange(a,a);var o=e.lookupTable.getAlpha();if(e.colorMapColors=null,e.colorTextureMap==null||t.getMTime()>e.colorTextureMap.getMTime()||e.lookupTable.getMTime()>e.colorTextureMap.getMTime()||e.lookupTable.getAlpha()!==n){e.lookupTable.setAlpha(n),e.colorTextureMap=null,e.lookupTable.build();var s=e.lookupTable.getNumberOfAvailableColors();s>4094&&(s=4094),s+=2;for(var f=(a[1]-a[0])/(s-1-2),c=new Float64Array(s*2),u=0;u<s;++u)c[u]=a[0]+u*f-f,i&&(c[u]=Math.pow(10,c[u]));for(var v=0;v<s;++v)c[v+s]=NaN;e.colorTextureMap=Ur.newInstance(),e.colorTextureMap.setExtent(0,s-1,0,1,0,0);var g=ie.newInstance({numberOfComponents:1,values:c});e.colorTextureMap.getPointData().setScalars(e.lookupTable.mapScalars(g,e.colorMode,0)),e.lookupTable.setAlpha(o)}if(!e.colorCoordinates||t.getMTime()>e.colorCoordinates.getMTime()||t.getInputData(0).getMTime()>e.colorCoordinates.getMTime()||e.lookupTable.getMTime()>e.colorCoordinates.getMTime()){e.colorCoordinates=null;var p=r.getNumberOfComponents(),l=r.getNumberOfTuples();e.colorCoordinates=ie.newInstance({numberOfComponents:2,values:new Float32Array(l*2)});var h=e.lookupTable.getVectorComponent();e.lookupTable.getVectorMode()===eT.MAGNITUDE&&r.getNumberOfComponents()>1&&(h=-1),t.createColorTextureCoordinates(r,e.colorCoordinates,l,p,h,a,e.lookupTable.getRange(),e.colorTextureMap.getPointData().getScalars().getNumberOfTuples()/2-2,i)}},t.getIsOpaque=function(){var r=t.getInputData(),n=t.getAbstractScalars(r,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName),a=n.scalars;if(!e.scalarVisibility||a==null)return!0;var i=t.getLookupTable();return i?(i.build(),i.areScalarsOpaque(a,e.colorMode,-1)):!0},t.canUseTextureMapForColoring=function(r){if(!e.interpolateScalarsBeforeMapping||e.lookupTable&&e.lookupTable.getIndexedLookup())return!1;var n=t.getAbstractScalars(r,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName),a=n.scalars;return!(!a||n.cellFlag||e.colorMode===ci.DEFAULT&&a.getDataType()===tT.UNSIGNED_CHAR||e.colorMode===ci.DIRECT_SCALARS)},t.clearColorArrays=function(){e.colorMapColors=null,e.colorCoordinates=null,e.colorTextureMap=null},t.getLookupTable=function(){return e.lookupTable||t.createDefaultLookupTable(),e.lookupTable},t.getMTime=function(){var r=e.mtime;if(e.lookupTable!==null){var n=e.lookupTable.getMTime();r=n>r?n:r}return r},t.getPrimitiveCount=function(){var r=t.getInputData(),n={points:r.getPoints().getNumberOfValues()/3,verts:r.getVerts().getNumberOfValues()-r.getVerts().getNumberOfCells(),lines:r.getLines().getNumberOfValues()-2*r.getLines().getNumberOfCells(),triangles:r.getPolys().getNumberOfValues()-3*r.getPolys().getNumberOfCells()};return n},t.acquireInvertibleLookupTable=er("AcquireInvertibleLookupTable"),t.valueToColor=er("ValueToColor"),t.colorToValue=er("ColorToValue"),t.useInvertibleColorFor=er("UseInvertibleColorFor"),t.clearInvertibleColor=er("ClearInvertibleColor"),t.processSelectorPixelBuffers=function(r,n){if(!(!r||!e.selectionWebGLIdsToVTKIds||!e.populateSelectionSettings)){var a=r.getRawPixelBuffer(Ze.ID_LOW24),i=r.getRawPixelBuffer(Ze.ID_HIGH24),o=r.getCurrentPass(),s=r.getFieldAssociation(),f=null;s===Bs.FIELD_ASSOCIATION_POINTS?f=e.selectionWebGLIdsToVTKIds.points:s===Bs.FIELD_ASSOCIATION_CELLS&&(f=e.selectionWebGLIdsToVTKIds.cells),f&&n.forEach(function(c){if(o===Ze.ID_LOW24){var u=0;i&&(u+=i[c],u*=256),u+=a[c+2],u*=256,u+=a[c+1],u*=256,u+=a[c];var v=f[u],g=r.getPixelBuffer(Ze.ID_LOW24);g[c]=v&255,g[c+1]=(v&65280)>>8,g[c+2]=(v&16711680)>>16}else if(o===Ze.ID_HIGH24&&i){var p=0;p+=i[c],p*=256,p+=a[c],p*=256,p+=a[c+1],p*=256,p+=a[c+2];var l=f[p],h=r.getPixelBuffer(Ze.ID_HIGH24);h[c]=(l&4278190080)>>24}})}}}var rT={colorMapColors:null,static:!1,lookupTable:null,scalarVisibility:!0,scalarRange:[0,1],useLookupTableScalarRange:!1,colorMode:0,scalarMode:0,arrayAccessMode:1,renderTime:0,colorByArrayName:null,fieldDataTupleId:-1,populateSelectionSettings:!0,selectionWebGLIdsToVTKIds:null,interpolateScalarsBeforeMapping:!1,colorCoordinates:null,colorTextureMap:null,forceCompileOnly:0,useInvertibleColors:!1,invertibleScalars:null,customShaderAttributes:[]};function yg(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rT,r),Ec.extend(t,e,r),T.get(t,e,["colorCoordinates","colorMapColors","colorTextureMap"]),T.setGet(t,e,["colorByArrayName","arrayAccessMode","colorMode","fieldDataTupleId","interpolateScalarsBeforeMapping","lookupTable","populateSelectionSettings","renderTime","scalarMode","scalarVisibility","selectionWebGLIdsToVTKIds","static","useLookupTableScalarRange","customShaderAttributes"]),T.setGetArray(t,e,["scalarRange"],2),Qn.implementCoincidentTopologyMethods(t,e),nT(t,e)}var aT=T.newInstance(yg,"vtkMapper"),Ye=fi(fi(fi({newInstance:aT,extend:yg},Q1),I1),tn),Gr={CLAMP_TO_EDGE:0,REPEAT:1,MIRRORED_REPEAT:2},ue={NEAREST:0,LINEAR:1,NEAREST_MIPMAP_NEAREST:2,NEAREST_MIPMAP_LINEAR:3,LINEAR_MIPMAP_NEAREST:4,LINEAR_MIPMAP_LINEAR:5},Go={Wrap:Gr,Filter:ue},Tg=new Float32Array(1),iT=new Int32Array(Tg.buffer);function oT(t){Tg[0]=t;var e=iT[0],r=e>>16&32768,n=e>>12&2047,a=e>>23&255;return a<103?r:a>142?(r|=31744,r|=(a===255?0:1)&&e&8388607,r):a<113?(n|=2048,r|=(n>>114-a)+(n>>113-a&1),r):(r|=a-112<<10|n>>1,r+=n&1,r)}function sT(t){var e=(t&32768)>>15,r=(t&31744)>>10,n=t&1023;return r===0?(e?-1:1)*Math.pow(2,-14)*(n/Math.pow(2,10)):r===31?n?NaN:(e?-1:1)*(1/0):(e?-1:1)*Math.pow(2,r-15)*(1+n/Math.pow(2,10))}var Un={fromHalf:sT,toHalf:oT};function _s(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function uT(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?_s(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):_s(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var Nt=Go.Wrap,be=Go.Filter,ve=ie.VtkDataTypes,vi=dn,Rn=ae,fT=qn,cT=Un.toHalf;function gT(t,e){e.classHierarchy.push("vtkOpenGLTexture"),t.render=function(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;if(c?e._openGLRenderWindow=c:(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent()),e.context=e._openGLRenderWindow.getContext(),e.renderable.getInterpolate()?(e.generateMipmap?t.setMinificationFilter(be.LINEAR_MIPMAP_LINEAR):t.setMinificationFilter(be.LINEAR),t.setMagnificationFilter(be.LINEAR)):(t.setMinificationFilter(be.NEAREST),t.setMagnificationFilter(be.NEAREST)),e.renderable.getRepeat()&&(t.setWrapR(Nt.REPEAT),t.setWrapS(Nt.REPEAT),t.setWrapT(Nt.REPEAT)),e.renderable.getInputData()&&e.renderable.setImage(null),!e.handle||e.renderable.getMTime()>e.textureBuildTime.getMTime()){if(e.renderable.getImage()!==null&&(e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(be.LINEAR_MIPMAP_LINEAR)),e.renderable.getImage()&&e.renderable.getImageLoaded()&&(t.create2DFromImage(e.renderable.getImage()),t.activate(),t.sendParameters(),e.textureBuildTime.modified())),e.renderable.getCanvas()!==null){e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(be.LINEAR_MIPMAP_LINEAR));var u=e.renderable.getCanvas();t.create2DFromRaw(u.width,u.height,4,ve.UNSIGNED_CHAR,u,!0),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}if(e.renderable.getJsImageData()!==null){var v=e.renderable.getJsImageData();e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(be.LINEAR_MIPMAP_LINEAR)),t.create2DFromRaw(v.width,v.height,4,ve.UNSIGNED_CHAR,v.data,!0),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}var g=e.renderable.getInputData(0);if(g&&g.getPointData().getScalars()){for(var p=g.getExtent(),l=g.getPointData().getScalars(),h=[],y=0;y<e.renderable.getNumberOfInputPorts();++y){var C=e.renderable.getInputData(y),S=C?C.getPointData().getScalars().getData():null;S&&h.push(S)}e.renderable.getInterpolate()&&l.getNumberOfComponents()===4&&(e.generateMipmap=!0,t.setMinificationFilter(be.LINEAR_MIPMAP_LINEAR)),h.length%6===0?t.createCubeFromRaw(p[1]-p[0]+1,p[3]-p[2]+1,l.getNumberOfComponents(),l.getDataType(),h):t.create2DFromRaw(p[1]-p[0]+1,p[3]-p[2]+1,l.getNumberOfComponents(),l.getDataType(),l.getData()),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}}e.handle&&t.activate()},t.destroyTexture=function(){t.deactivate(),e.context&&e.handle&&e.context.deleteTexture(e.handle),e.handle=0,e.numberOfDimensions=0,e.target=0,e.components=0,e.width=0,e.height=0,e.depth=0,t.resetFormatAndType()},t.createTexture=function(){e.handle||(e.handle=e.context.createTexture(),e.target&&(e.context.bindTexture(e.target,e.handle),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.bindTexture(e.target,null)))},t.getTextureUnit=function(){return e._openGLRenderWindow?e._openGLRenderWindow.getTextureUnitForTexture(t):-1},t.activate=function(){e._openGLRenderWindow.activateTexture(t),t.bind()},t.deactivate=function(){e._openGLRenderWindow&&e._openGLRenderWindow.deactivateTexture(t)},t.releaseGraphicsResources=function(c){c&&e.handle&&(c.activateTexture(t),c.deactivateTexture(t),e.context.deleteTexture(e.handle),e.handle=0,e.numberOfDimensions=0,e.target=0,e.internalFormat=0,e.format=0,e.openGLDataType=0,e.components=0,e.width=0,e.height=0,e.depth=0),e.shaderProgram&&(e.shaderProgram.releaseGraphicsResources(c),e.shaderProgram=null)},t.bind=function(){e.context.bindTexture(e.target,e.handle),e.autoParameters&&t.getMTime()>e.sendParametersTime.getMTime()&&t.sendParameters()},t.isBound=function(){var c=!1;if(e.context&&e.handle){var u=0;switch(e.target){case e.context.TEXTURE_2D:u=e.context.TEXTURE_BINDING_2D;break;default:fT("impossible case");break}var v=e.context.getIntegerv(u);c=v===e.handle}return c},t.sendParameters=function(){e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e._openGLRenderWindow.getWebgl2()&&(e.context.texParameteri(e.target,e.context.TEXTURE_BASE_LEVEL,e.baseLevel),e.context.texParameteri(e.target,e.context.TEXTURE_MAX_LEVEL,e.maxLevel)),e.sendParametersTime.modified()},t.getInternalFormat=function(c,u){return e._forceInternalFormat||(e.internalFormat=t.getDefaultInternalFormat(c,u)),e.internalFormat||vi("Unable to find suitable internal format for T=".concat(c," NC= ").concat(u)),e.internalFormat},t.getDefaultInternalFormat=function(c,u){var v=0;return v=e._openGLRenderWindow.getDefaultTextureInternalFormat(c,u,e.oglNorm16Ext,e.useHalfFloat),v||(v||(vi("Unsupported internal texture type!"),vi("Unable to find suitable internal format for T=".concat(c," NC= ").concat(u))),v)},t.setInternalFormat=function(c){e._forceInternalFormat=!0,c!==e.internalFormat&&(e.internalFormat=c,t.modified())},t.getFormat=function(c,u){return e.format=t.getDefaultFormat(c,u),e.format},t.getDefaultFormat=function(c,u){if(e._openGLRenderWindow.getWebgl2())switch(u){case 1:return e.context.RED;case 2:return e.context.RG;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}else switch(u){case 1:return e.context.LUMINANCE;case 2:return e.context.LUMINANCE_ALPHA;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}},t.resetFormatAndType=function(){e.format=0,e.internalFormat=0,e._forceInternalFormat=!1,e.openGLDataType=0},t.getDefaultDataType=function(c){if(e._openGLRenderWindow.getWebgl2())switch(c){case ve.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case(e.oglNorm16Ext&&!e.useHalfFloat&&ve.SHORT):return e.context.SHORT;case(e.oglNorm16Ext&&!e.useHalfFloat&&ve.UNSIGNED_SHORT):return e.context.UNSIGNED_SHORT;case(e.useHalfFloat&&ve.SHORT):return e.context.HALF_FLOAT;case(e.useHalfFloat&&ve.UNSIGNED_SHORT):return e.context.HALF_FLOAT;case ve.FLOAT:case ve.VOID:default:return e.context.FLOAT}switch(c){case ve.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case ve.FLOAT:case ve.VOID:default:if(e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))return e.context.FLOAT;{var u=e.context.getExtension("OES_texture_half_float");if(u&&e.context.getExtension("OES_texture_half_float_linear"))return u.HALF_FLOAT_OES}return e.context.UNSIGNED_BYTE}},t.getOpenGLDataType=function(c){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(!e.openGLDataType||u)&&(e.openGLDataType=t.getDefaultDataType(c)),e.openGLDataType},t.getShiftAndScale=function(){var c=0,u=1;switch(e.openGLDataType){case e.context.BYTE:u=127.5,c=u-128;break;case e.context.UNSIGNED_BYTE:u=255,c=0;break;case e.context.SHORT:u=32767.5,c=u-32768;break;case e.context.UNSIGNED_SHORT:u=65536,c=0;break;case e.context.INT:u=21474836475e-1,c=u-2147483648;break;case e.context.UNSIGNED_INT:u=4294967295,c=0;break;case e.context.FLOAT:}return{shift:c,scale:u}},t.getOpenGLFilterMode=function(c){switch(c){case be.NEAREST:return e.context.NEAREST;case be.LINEAR:return e.context.LINEAR;case be.NEAREST_MIPMAP_NEAREST:return e.context.NEAREST_MIPMAP_NEAREST;case be.NEAREST_MIPMAP_LINEAR:return e.context.NEAREST_MIPMAP_LINEAR;case be.LINEAR_MIPMAP_NEAREST:return e.context.LINEAR_MIPMAP_NEAREST;case be.LINEAR_MIPMAP_LINEAR:return e.context.LINEAR_MIPMAP_LINEAR;default:return e.context.NEAREST}},t.getOpenGLWrapMode=function(c){switch(c){case Nt.CLAMP_TO_EDGE:return e.context.CLAMP_TO_EDGE;case Nt.REPEAT:return e.context.REPEAT;case Nt.MIRRORED_REPEAT:return e.context.MIRRORED_REPEAT;default:return e.context.CLAMP_TO_EDGE}};function r(c,u){var v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,g=[],p=e.width*e.height*e.components;if(v&&(p*=e.depth),c!==ve.FLOAT&&e.openGLDataType===e.context.FLOAT)for(var l=0;l<u.length;l++)if(u[l]){var h=u[l].length>p?u[l].subarray(0,p):u[l];g.push(new Float32Array(h))}else g.push(null);if(c!==ve.UNSIGNED_CHAR&&e.openGLDataType===e.context.UNSIGNED_BYTE)for(var y=0;y<u.length;y++)if(u[y]){var C=u[y].length>p?u[y].subarray(0,p):u[y];g.push(new Uint8Array(C))}else g.push(null);var S=!1;if(e._openGLRenderWindow.getWebgl2())S=e.openGLDataType===e.context.HALF_FLOAT;else{var d=e.context.getExtension("OES_texture_half_float");S=d&&e.openGLDataType===d.HALF_FLOAT_OES}if(S)for(var O=0;O<u.length;O++)if(u[O]){for(var w=new Uint16Array(p),M=u[O],x=0;x<p;x++)w[x]=cT(M[x]);g.push(w)}else g.push(null);if(g.length===0)for(var D=0;D<u.length;D++)g.push(u[D]);return g}function n(c){if(e._openGLRenderWindow.getWebgl2())return c;var u=[],v=e.width,g=e.height,p=e.components;if(c&&(!cr(v)||!cr(g)))for(var l=e.context.getExtension("OES_texture_half_float"),h=Zt(v),y=Zt(g),C=h*y*e.components,S=0;S<c.length;S++)if(c[S]!==null){var d=null,O=g/y,w=v/h,M=!1;e.openGLDataType===e.context.FLOAT?d=new Float32Array(C):l&&e.openGLDataType===l.HALF_FLOAT_OES?(d=new Uint16Array(C),M=!0):d=new Uint8Array(C);for(var x=0;x<y;x++){var D=x*h*p,R=x*O,V=Math.floor(R),E=Math.ceil(R);E>=g&&(E=g-1);var L=R-V,m=1-L;V=V*v*p,E=E*v*p;for(var N=0;N<h;N++){var _=N*p,G=N*w,k=Math.floor(G),U=Math.ceil(G);U>=v&&(U=v-1);var B=G-k;k*=p,U*=p;for(var j=0;j<p;j++)M?d[D+_+j]=Un.toHalf(Un.fromHalf(c[S][V+k+j])*m*(1-B)+Un.fromHalf(c[S][V+U+j])*m*B+Un.fromHalf(c[S][E+k+j])*L*(1-B)+Un.fromHalf(c[S][E+U+j])*L*B):d[D+_+j]=c[S][V+k+j]*m*(1-B)+c[S][V+U+j]*m*B+c[S][E+k+j]*L*(1-B)+c[S][E+U+j]*L*B}}u.push(d),e.width=h,e.height=y}else u.push(null);if(u.length===0)for(var H=0;H<c.length;H++)u.push(c[H]);return u}function a(c){if(e._openGLRenderWindow){var u;if(e.resizable||(u=e.renderable)!==null&&u!==void 0&&u.getResizable())return!1;if(e._openGLRenderWindow.getWebgl2()){var v=e._openGLRenderWindow.getGLInformations();return!(v.RENDERER.value.match(/WebKit/gi)&&navigator.platform.match(/Mac/gi)&&e.oglNorm16Ext&&(c===ve.UNSIGNED_SHORT||c===ve.SHORT))}return!1}return!1}t.create2DFromRaw=function(c,u,v,g,p){var l=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;if(t.getOpenGLDataType(g,!0),t.getInternalFormat(g,v),t.getFormat(g,v),!e.internalFormat||!e.format||!e.openGLDataType)return Rn("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=v,e.width=c,e.height=u,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();var h=[p],y=r(g,h),C=n(y);return e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,l),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),a(g)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),C[0]!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,C[0])):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,C[0]),e.generateMipmap&&e.context.generateMipmap(e.target),l&&e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,!1),t.deactivate(),!0},t.createCubeFromRaw=function(c,u,v,g,p){if(t.getOpenGLDataType(g),t.getInternalFormat(g,v),t.getFormat(g,v),!e.internalFormat||!e.format||!e.openGLDataType)return Rn("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_CUBE_MAP,e.components=v,e.width=c,e.height=u,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),e.maxLevel=p.length/6-1,t.createTexture(),t.bind();for(var l=r(g,p),h=n(l),y=[],C=e.width,S=e.height,d=0;d<h.length;d++){d%6===0&&d!==0&&(C/=2,S/=2),y[d]=Ha(g,S*C*e.components);for(var O=0;O<S;++O){var w=O*C*e.components,M=(S-O-1)*C*e.components;y[d].set(h[d].slice(M,M+C*e.components),w)}}e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),a(g)&&e.context.texStorage2D(e.target,6,e.internalFormat,e.width,e.height);for(var x=0;x<6;x++)for(var D=0,R=e.width,V=e.height;R>=1&&V>=1;){var E=null;D<=e.maxLevel&&(E=y[6*D+x]),a(g)?E!=null&&e.context.texSubImage2D(e.context.TEXTURE_CUBE_MAP_POSITIVE_X+x,D,0,0,R,V,e.format,e.openGLDataType,E):e.context.texImage2D(e.context.TEXTURE_CUBE_MAP_POSITIVE_X+x,D,e.internalFormat,R,V,0,e.format,e.openGLDataType,E),D++,R/=2,V/=2}return t.deactivate(),!0},t.createDepthFromRaw=function(c,u,v,g){return t.getOpenGLDataType(v),e.format=e.context.DEPTH_COMPONENT,e._openGLRenderWindow.getWebgl2()?v===ve.FLOAT?e.internalFormat=e.context.DEPTH_COMPONENT32F:e.internalFormat=e.context.DEPTH_COMPONENT16:e.internalFormat=e.context.DEPTH_COMPONENT,!e.internalFormat||!e.format||!e.openGLDataType?(Rn("Failed to determine texture parameters."),!1):(e.target=e.context.TEXTURE_2D,e.components=1,e.width=c,e.height=u,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),a(v)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),g!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,g)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,g),e.generateMipmap&&e.context.generateMipmap(e.target),t.deactivate(),!0)},t.create2DFromImage=function(c){if(t.getOpenGLDataType(ve.UNSIGNED_CHAR),t.getInternalFormat(ve.UNSIGNED_CHAR,4),t.getFormat(ve.UNSIGNED_CHAR,4),!e.internalFormat||!e.format||!e.openGLDataType)return Rn("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=4,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1);var u=!e._openGLRenderWindow.getWebgl2()&&(!cr(c.width)||!cr(c.height)),v=document.createElement("canvas");v.width=u?Zt(c.width):c.width,v.height=u?Zt(c.height):c.height,e.width=v.width,e.height=v.height;var g=v.getContext("2d");g.translate(0,v.height),g.scale(1,-1),g.drawImage(c,0,0,c.width,c.height,0,0,v.width,v.height);var p=v;return a(ve.UNSIGNED_CHAR)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),p!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,p)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,p),e.generateMipmap&&e.context.generateMipmap(e.target),t.deactivate(),!0};function i(c,u,v){for(var g=new Array(v),p=new Array(v),l=0;l<v;++l)g[l]=c[l],p[l]=u[l]-c[l]||1;return{scale:p,offset:g}}function o(c,u){for(var v=0;v<c.length;v++){var g=c[v],p=u[v]+g;if(g<-2048||g>2048||p<-2048||p>2048)return!1}return!0}function s(c,u,v,g){t.getOpenGLDataType(c);var p=!1;if(e._openGLRenderWindow.getWebgl2())p=e.openGLDataType===e.context.HALF_FLOAT;else{var l=e.context.getExtension("OES_texture_half_float");p=l&&e.openGLDataType===l.HALF_FLOAT_OES}var h=p&&(o(u,v)||g);e.useHalfFloat=h}function f(c,u){for(var v=c.getNumberOfComponents(),g=c.getDataType(),p=c.getData(),l=new Array(v),h=new Array(v),y=0;y<v;++y){var C=c.getRange(y),S=ne(C,2),d=S[0],O=S[1];l[y]=d,h[y]=O}var w=i(l,h,v);return s(g,w.offset,w.scale,u),e.useHalfFloat||t.getOpenGLDataType(g,!0),{numComps:v,dataType:g,data:p,scaleOffsets:w}}t.create2DFilterableFromRaw=function(c,u,v,g,p){var l=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;return t.create2DFilterableFromDataArray(c,u,ie.newInstance({numberOfComponents:v,dataType:g,values:p}),l)},t.create2DFilterableFromDataArray=function(c,u,v){var g=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,p=f(v,g),l=p.numComps,h=p.dataType,y=p.data;t.create2DFromRaw(c,u,l,h,y)},t.create3DFromRaw=function(c,u,v,g,p,l){if(t.getOpenGLDataType(p),t.getInternalFormat(p,g),t.getFormat(p,g),!e.internalFormat||!e.format||!e.openGLDataType)return Rn("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_3D,e.components=g,e.width=c,e.height=u,e.depth=v,e.numberOfDimensions=3,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();var h=[l],y=!0,C=r(p,h,y),S=n(C);return e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),a(p)?(e.context.texStorage3D(e.target,1,e.internalFormat,e.width,e.height,e.depth),S[0]!=null&&e.context.texSubImage3D(e.target,0,0,0,0,e.width,e.height,e.depth,e.format,e.openGLDataType,S[0])):e.context.texImage3D(e.target,0,e.internalFormat,e.width,e.height,e.depth,0,e.format,e.openGLDataType,S[0]),e.generateMipmap&&e.context.generateMipmap(e.target),t.deactivate(),!0},t.create3DFilterableFromRaw=function(c,u,v,g,p,l){var h=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!1;return t.create3DFilterableFromDataArray(c,u,v,ie.newInstance({numberOfComponents:g,dataType:p,values:l}),h)},t.create3DFilterableFromDataArray=function(c,u,v,g){for(var p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,l=f(g,p),h=l.numComps,y=l.dataType,C=l.data,S=l.scaleOffsets,d=c*u*v,O=[],w=[],M=0;M<h;++M)O[M]=0,w[M]=1;e.volumeInfo={scale:w,offset:O,dataComputedScale:S.scale,dataComputedOffset:S.offset,width:c,height:u,depth:v};var x=structuredClone(S);if(e._openGLRenderWindow.getWebgl2()){if(e.oglNorm16Ext&&!e.useHalfFloat&&y===ve.SHORT){for(var D=0;D<h;++D)e.volumeInfo.scale[D]=32767;return t.create3DFromRaw(c,u,v,h,y,C)}if(e.oglNorm16Ext&&!e.useHalfFloat&&y===ve.UNSIGNED_SHORT){for(var R=0;R<h;++R)e.volumeInfo.scale[R]=65535;return t.create3DFromRaw(c,u,v,h,y,C)}if(y===ve.FLOAT||e.useHalfFloat&&(y===ve.SHORT||y===ve.UNSIGNED_SHORT))return t.create3DFromRaw(c,u,v,h,y,C);if(y===ve.UNSIGNED_CHAR){for(var V=0;V<h;++V)e.volumeInfo.scale[V]=255;return t.create3DFromRaw(c,u,v,h,y,C)}var E=new Float32Array(d*h);e.volumeInfo.offset=x.offset,e.volumeInfo.scale=x.scale;for(var L=0,m=x.scale.map(function(Re){return 1/Re}),N=0;N<d;N++)for(var _=0;_<h;_++)E[L]=(C[L]-x.offset[_])*m[_],L++;return t.create3DFromRaw(c,u,v,h,ve.FLOAT,E)}var G=function(ye,le,Ke,lt,Rt){ye[le]=Ke},k=ve.UNSIGNED_CHAR;if(y===ve.UNSIGNED_CHAR)for(var U=0;U<h;++U)x.offset[U]=0,x.scale[U]=255;else e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear")?(k=ve.FLOAT,G=function(ye,le,Ke,lt,Rt){ye[le]=(Ke-lt)/Rt}):(k=ve.UNSIGNED_CHAR,G=function(ye,le,Ke,lt,Rt){ye[le]=255*(Ke-lt)/Rt});if(t.getOpenGLDataType(k),t.getInternalFormat(k,h),t.getFormat(k,h),!e.internalFormat||!e.format||!e.openGLDataType)return Rn("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=h,e.depth=1,e.numberOfDimensions=2;var B=e.context.getParameter(e.context.MAX_TEXTURE_SIZE);B>4096&&(k===ve.FLOAT||h>=3)&&(B=4096);var j=1,H=1;d>B*B&&(j=Math.ceil(Math.sqrt(d/(B*B))),H=j);var X=Math.sqrt(d)/j;X=Zt(X);var Y=Math.floor(X*j/c),ee=Math.ceil(v/Y),ce=Zt(u*ee/H);e.width=X,e.height=ce,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.volumeInfo.xreps=Y,e.volumeInfo.yreps=ee,e.volumeInfo.xstride=j,e.volumeInfo.ystride=H,e.volumeInfo.offset=x.offset,e.volumeInfo.scale=x.scale;var Z,Ce=X*ce*h;k===ve.FLOAT?Z=new Float32Array(Ce):Z=new Uint8Array(Ce);for(var q=0,De=Math.floor(c/j),K=Math.floor(u/H),fe=0;fe<ee;fe++)for(var te=Math.min(Y,v-fe*Y),$=h*(e.width-te*Math.floor(c/j)),z=0;z<K;z++){for(var re=0;re<te;re++)for(var P=h*((fe*Y+re)*c*u+H*z*c),Le=0;Le<De;Le++)for(var pe=0;pe<h;pe++)G(Z,q,C[P+j*Le*h+pe],x.offset[pe],x.scale[pe]),q++;q+=$}return e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),a(k)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),Z!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,Z)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,Z),t.deactivate(),!0},t.setOpenGLRenderWindow=function(c){e._openGLRenderWindow!==c&&(t.releaseGraphicsResources(),e._openGLRenderWindow=c,e.context=null,c&&(e.context=e._openGLRenderWindow.getContext()))},t.getMaximumTextureSize=function(c){return c&&c.isCurrent()?c.getIntegerv(c.MAX_TEXTURE_SIZE):-1}}var vT={_openGLRenderWindow:null,_forceInternalFormat:!1,context:null,handle:0,sendParametersTime:null,textureBuildTime:null,numberOfDimensions:0,target:0,format:0,openGLDataType:0,components:0,width:0,height:0,depth:0,autoParameters:!0,wrapS:Nt.CLAMP_TO_EDGE,wrapT:Nt.CLAMP_TO_EDGE,wrapR:Nt.CLAMP_TO_EDGE,minificationFilter:be.NEAREST,magnificationFilter:be.NEAREST,minLOD:-1e3,maxLOD:1e3,baseLevel:0,maxLevel:1e3,generateMipmap:!1,useHalfFloat:!0,oglNorm16Ext:null};function Cg(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,vT,r),Qe.extend(t,e,r),e.sendParametersTime={},_e(e.sendParametersTime,{mtime:0}),e.textureBuildTime={},_e(e.textureBuildTime,{mtime:0}),Ka(t,e,["format","openGLDataType"]),ze(t,e,["keyMatrixTime","minificationFilter","magnificationFilter","wrapS","wrapT","wrapR","generateMipmap","oglNorm16Ext"]),ot(t,e,["width","height","volumeInfo","components","handle","target"]),_r(t,e,["openGLRenderWindow"]),gT(t,e)}var Sg=ke(Cg,"vtkOpenGLTexture"),$e=uT({newInstance:Sg,extend:Cg},Go);Ie("vtkTexture",Sg);var pT={DISPLAY:0,WORLD:1},dg={CoordinateSystem:pT};function js(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function lT(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?js(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):js(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var Ji=dg.CoordinateSystem;function Ws(t){return function(){return T.vtkErrorMacro("vtkProp::".concat(t," - NOT IMPLEMENTED"))}}function hT(t,e){e.classHierarchy.push("vtkProp"),t.getMTime=function(){for(var r=e.mtime,n=0;n<e.textures.length;++n){var a=e.textures[n].getMTime();a>r&&(r=a)}return r},t.processSelectorPixelBuffers=function(r,n){},t.getNestedProps=function(){return null},t.getActors=function(){return[]},t.getActors2D=function(){return[]},t.getVolumes=function(){return[]},t.pick=Ws("pick"),t.hasKey=Ws("hasKey"),t.getNestedVisibility=function(){return e.visibility&&(!e._parentProp||e._parentProp.getNestedVisibility())},t.getNestedPickable=function(){return e.pickable&&(!e._parentProp||e._parentProp.getNestedPickable())},t.getNestedDragable=function(){return e.dragable&&(!e._parentProp||e._parentProp.getNestedDragable())},t.getRedrawMTime=function(){return e.mtime},t.setEstimatedRenderTime=function(r){e.estimatedRenderTime=r,e.savedEstimatedRenderTime=r},t.restoreEstimatedRenderTime=function(){e.estimatedRenderTime=e.savedEstimatedRenderTime},t.addEstimatedRenderTime=function(r){e.estimatedRenderTime+=r},t.setAllocatedRenderTime=function(r){e.allocatedRenderTime=r,e.savedEstimatedRenderTime=e.estimatedRenderTime,e.estimatedRenderTime=0},t.getSupportsSelection=function(){return!1},t.getTextures=function(){return e.textures},t.hasTexture=function(r){return e.textures.indexOf(r)!==-1},t.addTexture=function(r){r&&!t.hasTexture(r)&&(e.textures=e.textures.concat(r),t.modified())},t.removeTexture=function(r){var n=e.textures.filter(function(a){return a!==r});e.textures.length!==n.length&&(e.textures=n,t.modified())},t.removeAllTextures=function(){e.textures=[],t.modified()},t.setCoordinateSystemToWorld=function(){return t.setCoordinateSystem(Ji.WORLD)},t.setCoordinateSystemToDisplay=function(){return t.setCoordinateSystem(Ji.DISPLAY)}}var yT={allocatedRenderTime:10,coordinateSystem:Ji.WORLD,dragable:!0,estimatedRenderTime:0,paths:null,pickable:!0,renderTimeMultiplier:1,savedEstimatedRenderTime:0,textures:[],useBounds:!0,visibility:!0};function Og(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,yT,r),T.obj(t,e),T.get(t,e,["estimatedRenderTime","allocatedRenderTime"]),T.setGet(t,e,["_parentProp","coordinateSystem","dragable","pickable","renderTimeMultiplier","useBounds","visibility"]),T.moveToProtected(t,e,["parentProp"]),hT(t,e)}var TT=T.newInstance(Og,"vtkProp"),In=lT({newInstance:TT,extend:Og},dg);function $s(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function CT(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?$s(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):$s(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var lr=ho.Representation,hr=ho.Interpolation;function zs(t){return function(){return T.vtkErrorMacro("vtkProperty::".concat(t," - NOT IMPLEMENTED"))}}function ST(t,e){e.classHierarchy.push("vtkProperty"),t.setColor=function(r,n,a){Array.isArray(r)?(e.color[0]!==r[0]||e.color[1]!==r[1]||e.color[2]!==r[2])&&(e.color[0]=r[0],e.color[1]=r[1],e.color[2]=r[2],t.modified()):(e.color[0]!==r||e.color[1]!==n||e.color[2]!==a)&&(e.color[0]=r,e.color[1]=n,e.color[2]=a,t.modified()),t.setDiffuseColor(e.color),t.setAmbientColor(e.color),t.setSpecularColor(e.color)},t.computeCompositeColor=zs("ComputeCompositeColor"),t.getColor=function(){var r=0;e.ambient+e.diffuse+e.specular>0&&(r=1/(e.ambient+e.diffuse+e.specular));for(var n=0;n<3;n++)e.color[n]=r*(e.ambient*e.ambientColor[n]+e.diffuse*e.diffuseColor[n]+e.specular*e.specularColor[n]);return[].concat(e.color)},t.setSpecularPower=function(r){var n=1/Math.max(1,r);(e.roughness!==n||e.specularPower!==r)&&(e.specularPower=r,e.roughness=n,t.modified())},t.addShaderVariable=zs("AddShaderVariable"),t.setInterpolationToFlat=function(){return t.setInterpolation(hr.FLAT)},t.setInterpolationToGouraud=function(){return t.setInterpolation(hr.GOURAUD)},t.setInterpolationToPhong=function(){return t.setInterpolation(hr.PHONG)},t.getInterpolationAsString=function(){return T.enumToString(hr,e.interpolation)},t.setRepresentationToWireframe=function(){return t.setRepresentation(lr.WIREFRAME)},t.setRepresentationToSurface=function(){return t.setRepresentation(lr.SURFACE)},t.setRepresentationToPoints=function(){return t.setRepresentation(lr.POINTS)},t.getRepresentationAsString=function(){return T.enumToString(lr,e.representation)}}var dT={color:[1,1,1],ambientColor:[1,1,1],diffuseColor:[1,1,1],specularColor:[1,1,1],edgeColor:[0,0,0],ambient:0,diffuse:1,metallic:0,roughness:.6,normalStrength:1,emission:1,baseIOR:1.45,specular:0,specularPower:1,opacity:1,interpolation:hr.GOURAUD,representation:lr.SURFACE,edgeVisibility:!1,backfaceCulling:!1,frontfaceCulling:!1,pointSize:1,lineWidth:1,lighting:!0,shading:!1,materialName:null};function wg(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,dT,r),T.obj(t,e),T.setGet(t,e,["lighting","interpolation","ambient","diffuse","metallic","roughness","normalStrength","emission","baseIOR","specular","specularPower","opacity","edgeVisibility","lineWidth","pointSize","backfaceCulling","frontfaceCulling","representation","diffuseTexture","metallicTexture","roughnessTexture","normalTexture","ambientOcclusionTexture","emissionTexture"]),T.setGetArray(t,e,["ambientColor","specularColor","diffuseColor","edgeColor"],3),ST(t,e)}var OT=T.newInstance(wg,"vtkProperty"),zr=CT({newInstance:OT,extend:wg},ho),xg=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

attribute vec4 vertexMC;

// frag position in VC
//VTK::PositionVC::Dec

// optional normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// Texture coordinates
//VTK::TCoord::Dec

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

// Apple Bug
//VTK::PrimID::Dec

// picking support
//VTK::Picking::Dec

void main()
{
  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  //VTK::PrimID::Impl

  //VTK::PositionVC::Impl

  //VTK::Light::Impl

  //VTK::Picking::Impl
}
`,Mg=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the polydata mappers fragment shader

uniform int PrimitiveIDOffset;

// VC position of this fragment
//VTK::PositionVC::Dec

// optional color passed in from the vertex shader, vertexColor
//VTK::Color::Dec

// optional surface normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// Depth Peeling Support
//VTK::DepthPeeling::Dec

// clipping plane vars
//VTK::Clip::Dec

// the output of this shader
//VTK::Output::Dec

// Apple Bug
//VTK::PrimID::Dec

// handle coincident offsets
//VTK::Coincident::Dec

//VTK::ZBuffer::Dec

void main()
{
  // VC position of this fragment. This should not branch/return/discard.
  //VTK::PositionVC::Impl

  // Place any calls that require uniform flow (e.g. dFdx) here.
  //VTK::UniformFlow::Impl

  // Set gl_FragDepth here (gl_FragCoord.z by default)
  //VTK::Depth::Impl

  // Early depth peeling abort:
  //VTK::DepthPeeling::PreColor

  // Apple Bug
  //VTK::PrimID::Impl

  //VTK::Clip::Impl

  //VTK::Color::Impl

  // Generate the normal if we are not passed in one
  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Light::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }

  //VTK::DepthPeeling::Impl

  //VTK::Picking::Impl

  // handle coincident offsets
  //VTK::Coincident::Impl

  //VTK::ZBuffer::Impl

  //VTK::RenderPassFragmentShader::Impl
}
`;function wT(t,e){t.replaceShaderCoincidentOffset=function(r,n,a){var i=t.getCoincidentParameters(n,a);if(i&&(i.factor!==0||i.offset!==0)){var o=r.Fragment;o=F.substitute(o,"//VTK::Coincident::Dec",["uniform float cfactor;","uniform float coffset;"]).result,e.context.getExtension("EXT_frag_depth")&&(i.factor!==0?(o=F.substitute(o,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,o=F.substitute(o,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):o=F.substitute(o,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + 0.000016*coffset;").result),e._openGLRenderWindow.getWebgl2()&&(i.factor!==0?(o=F.substitute(o,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,o=F.substitute(o,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):o=F.substitute(o,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + 0.000016*coffset;").result),r.Fragment=o}}}function xT(t,e){t.applyShaderReplacements=function(r,n,a){var i=null;if(n&&(i=n.ShaderReplacements),i)for(var o=0;o<i.length;o++){var s=i[o];if(a&&s.replaceFirst||!a&&!s.replaceFirst){var f=s.shaderType,c=r[f],u=F.substitute(c,s.originalValue,s.replacementValue,s.replaceAll);r[f]=u.result}}},t.buildShaders=function(r,n,a){t.getReplacedShaderTemplate(r,n,a),e.lastRenderPassShaderReplacement=e.currentRenderPass?e.currentRenderPass.getShaderReplacement():null,e.lastRenderPassShaderReplacement&&e.lastRenderPassShaderReplacement(r);var i=e.renderable.getViewSpecificProperties().OpenGL;t.applyShaderReplacements(r,i,!0),t.replaceShaderValues(r,n,a),t.applyShaderReplacements(r,i)},t.getReplacedShaderTemplate=function(r,n,a){var i=e.renderable.getViewSpecificProperties().OpenGL;t.getShaderTemplate(r,n,a);var o=r.Vertex;if(i){var s=i.VertexShaderCode;s!==void 0&&s!==""&&(o=s)}r.Vertex=o;var f=r.Fragment;if(i){var c=i.FragmentShaderCode;c!==void 0&&c!==""&&(f=c)}r.Fragment=f;var u=r.Geometry;if(i){var v=i.GeometryShaderCode;v!==void 0&&(u=v)}r.Geometry=u}}var en={implementReplaceShaderCoincidentOffset:wT,implementBuildShadersWithReplacements:xT};function bs(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function Hs(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?bs(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):bs(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var pi=Jn.FieldAssociations,je=$t.primTypes,Vn=zr.Representation,Ks=zr.Shading,Yr=Ye.ScalarMode,Ps=$e.Filter,Xs=$e.Wrap,un=ae,MT={type:"StartEvent"},DT={type:"EndEvent"},ET=In.CoordinateSystem;function RT(t){var e=t.getSelector();return e?e.getCurrentPass():Ze.MIN_KNOWN_PASS-1}function VT(t,e){e.classHierarchy.push("vtkOpenGLPolyDataMapper"),t.buildPass=function(n){n&&(e.currentRenderPass=null,e.openGLActor=t.getFirstAncestorOfType("vtkOpenGLActor"),e._openGLRenderer=e.openGLActor.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()))},t.translucentPass=function(n,a){n&&(e.currentRenderPass=a,t.render())},t.zBufferPass=function(n){n&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=function(n){return t.zBufferPass(n)},t.opaquePass=function(n){n&&t.render()},t.render=function(){var n=e._openGLRenderWindow.getContext();if(e.context!==n){e.context=n;for(var a=je.Start;a<je.End;a++)e.primitives[a].setOpenGLRenderWindow(e._openGLRenderWindow)}var i=e.openGLActor.getRenderable(),o=e._openGLRenderer.getRenderable();t.renderPiece(o,i)},t.getShaderTemplate=function(n,a,i){n.Vertex=xg,n.Fragment=Mg,n.Geometry=""},t.replaceShaderColor=function(n,a,i){var o=n.Vertex,s=n.Geometry,f=n.Fragment,c=e.lastBoundBO.getReferenceByName("lastLightComplexity"),u=["uniform float ambient;","uniform float diffuse;","uniform float specular;","uniform float opacityUniform; // the fragment opacity","uniform vec3 ambientColorUniform;","uniform vec3 diffuseColorUniform;"];c&&(u=u.concat(["uniform vec3 specularColorUniform;","uniform float specularPowerUniform;"]));var v=["vec3 ambientColor;","  vec3 diffuseColor;","  float opacity;"];c&&(v=v.concat(["  vec3 specularColor;","  float specularPower;"])),v=v.concat(["  ambientColor = ambientColorUniform;","  diffuseColor = diffuseColorUniform;","  opacity = opacityUniform;"]),c&&(v=v.concat(["  specularColor = specularColorUniform;","  specularPower = specularPowerUniform;"])),e.lastBoundBO.getCABO().getColorComponents()!==0&&!e.drawingEdges&&(u=u.concat(["varying vec4 vertexColorVSOutput;"]),o=F.substitute(o,"//VTK::Color::Dec",["attribute vec4 scalarColor;","varying vec4 vertexColorVSOutput;"]).result,o=F.substitute(o,"//VTK::Color::Impl",["vertexColorVSOutput =  scalarColor;"]).result,s=F.substitute(s,"//VTK::Color::Dec",["in vec4 vertexColorVSOutput[];","out vec4 vertexColorGSOutput;"]).result,s=F.substitute(s,"//VTK::Color::Impl",["vertexColorGSOutput = vertexColorVSOutput[i];"]).result),e.lastBoundBO.getCABO().getColorComponents()!==0&&!e.drawingEdges?f=F.substitute(f,"//VTK::Color::Impl",v.concat(["  diffuseColor = vertexColorVSOutput.rgb;","  ambientColor = vertexColorVSOutput.rgb;","  opacity = opacity*vertexColorVSOutput.a;"])).result:e.renderable.getInterpolateScalarsBeforeMapping()&&e.renderable.getColorCoordinates()&&!e.drawingEdges?f=F.substitute(f,"//VTK::Color::Impl",v.concat(["  vec4 texColor = texture2D(texture1, tcoordVCVSOutput.st);","  diffuseColor = texColor.rgb;","  ambientColor = texColor.rgb;","  opacity = opacity*texColor.a;"])).result:(i.getBackfaceProperty()&&!e.drawingEdges&&(u=u.concat(["uniform float opacityUniformBF; // the fragment opacity","uniform float ambientIntensityBF; // the material ambient","uniform float diffuseIntensityBF; // the material diffuse","uniform vec3 ambientColorUniformBF; // ambient material color","uniform vec3 diffuseColorUniformBF; // diffuse material color"]),c?(u=u.concat(["uniform float specularIntensityBF; // the material specular intensity","uniform vec3 specularColorUniformBF; // intensity weighted color","uniform float specularPowerUniformBF;"]),v=v.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  specularColor = specularIntensityBF * specularColorUniformBF;","  specularPower = specularPowerUniformBF;","  opacity = opacityUniformBF; }"])):v=v.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  opacity = opacityUniformBF; }"])),e.haveCellScalars&&!e.drawingEdges&&(u=u.concat(["uniform samplerBuffer texture1;"])),f=F.substitute(f,"//VTK::Color::Impl",v).result),f=F.substitute(f,"//VTK::Color::Dec",u).result,n.Vertex=o,n.Geometry=s,n.Fragment=f},t.replaceShaderLight=function(n,a,i){var o=n.Fragment,s="",f=e.lastBoundBO.getReferenceByName("lastLightComplexity"),c=e.lastBoundBO.getReferenceByName("lastLightCount"),u=[];switch(f){case 0:o=F.substitute(o,"//VTK::Light::Impl",["  gl_FragData[0] = vec4(ambientColor * ambient + diffuseColor * diffuse, opacity);","  //VTK::Light::Impl"],!1).result;break;case 1:o=F.substitute(o,"//VTK::Light::Impl",["  float df = max(0.0, normalVCVSOutput.z);","  float sf = pow(df, specularPower);","  vec3 diffuseL = df * diffuseColor;","  vec3 specularL = sf * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"],!1).result;break;case 2:for(var v=0;v<c;++v)u=u.concat(["uniform vec3 lightColor".concat(v,";"),"uniform vec3 lightDirectionVC".concat(v,"; // normalized"),"uniform vec3 lightHalfAngleVC".concat(v,"; // normalized")]);o=F.substitute(o,"//VTK::Light::Dec",u).result,u=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  float df;"];for(var g=0;g<c;++g)u=u.concat(["  df = max(0.0, dot(normalVCVSOutput, -lightDirectionVC".concat(g,"));"),"  diffuseL += ((df".concat(s,") * lightColor").concat(g,");"),"  if (dot(normalVCVSOutput, lightDirectionVC".concat(g,") < 0.0)"),"    {","    float sf = pow( max(0.0, dot(lightHalfAngleVC".concat(g,",normalVCVSOutput)), specularPower);"),"    specularL += ((sf".concat(s,") * lightColor").concat(g,");"),"    }"]);u=u.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),o=F.substitute(o,"//VTK::Light::Impl",u,!1).result;break;case 3:for(var p=0;p<c;++p)u=u.concat(["uniform vec3 lightColor".concat(p,";"),"uniform vec3 lightDirectionVC".concat(p,"; // normalized"),"uniform vec3 lightHalfAngleVC".concat(p,"; // normalized"),"uniform vec3 lightPositionVC".concat(p,";"),"uniform vec3 lightAttenuation".concat(p,";"),"uniform float lightConeAngle".concat(p,";"),"uniform float lightExponent".concat(p,";"),"uniform int lightPositional".concat(p,";")]);o=F.substitute(o,"//VTK::Light::Dec",u).result,u=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  vec3 vertLightDirectionVC;","  float attenuation;","  float df;"];for(var l=0;l<c;++l)u=u.concat(["  attenuation = 1.0;","  if (lightPositional".concat(l," == 0)"),"    {","      vertLightDirectionVC = lightDirectionVC".concat(l,";"),"    }","  else","    {","    vertLightDirectionVC = vertexVC.xyz - lightPositionVC".concat(l,";"),"    float distanceVC = length(vertLightDirectionVC);","    vertLightDirectionVC = normalize(vertLightDirectionVC);","    attenuation = 1.0 /","      (lightAttenuation".concat(l,".x"),"       + lightAttenuation".concat(l,".y * distanceVC"),"       + lightAttenuation".concat(l,".z * distanceVC * distanceVC);"),"    // per OpenGL standard cone angle is 90 or less for a spot light","    if (lightConeAngle".concat(l," <= 90.0)"),"      {","      float coneDot = dot(vertLightDirectionVC, lightDirectionVC".concat(l,");"),"      // if inside the cone","      if (coneDot >= cos(radians(lightConeAngle".concat(l,")))"),"        {","        attenuation = attenuation * pow(coneDot, lightExponent".concat(l,");"),"        }","      else","        {","        attenuation = 0.0;","        }","      }","    }","    df = max(0.0, attenuation*dot(normalVCVSOutput, -vertLightDirectionVC));","    diffuseL += ((df".concat(s,") * lightColor").concat(l,");"),"    if (dot(normalVCVSOutput, vertLightDirectionVC) < 0.0)","      {","      float sf = attenuation*pow( max(0.0, dot(lightHalfAngleVC".concat(l,",normalVCVSOutput)), specularPower);"),"    specularL += ((sf".concat(s,") * lightColor").concat(l,");"),"    }"]);u=u.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),o=F.substitute(o,"//VTK::Light::Impl",u,!1).result;break;default:un("bad light complexity")}n.Fragment=o},t.replaceShaderNormal=function(n,a,i){var o=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(o>0){var s=n.Vertex,f=n.Geometry,c=n.Fragment;e.lastBoundBO.getCABO().getNormalOffset()?(s=F.substitute(s,"//VTK::Normal::Dec",["attribute vec3 normalMC;","uniform mat3 normalMatrix;","varying vec3 normalVCVSOutput;"]).result,s=F.substitute(s,"//VTK::Normal::Impl",["normalVCVSOutput = normalMatrix * normalMC;"]).result,f=F.substitute(f,"//VTK::Normal::Dec",["in vec3 normalVCVSOutput[];","out vec3 normalVCGSOutput;"]).result,f=F.substitute(f,"//VTK::Normal::Impl",["normalVCGSOutput = normalVCVSOutput[i];"]).result,c=F.substitute(c,"//VTK::Normal::Dec",["varying vec3 normalVCVSOutput;"]).result,c=F.substitute(c,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalVCVSOutput);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):e.haveCellNormals?(c=F.substitute(c,"//VTK::Normal::Dec",["uniform mat3 normalMatrix;","uniform samplerBuffer textureN;"]).result,c=F.substitute(c,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalMatrix *","    texelFetchBuffer(textureN, gl_PrimitiveID + PrimitiveIDOffset).xyz);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):e.lastBoundBO.getOpenGLMode(i.getProperty().getRepresentation())===e.context.LINES?(c=F.substitute(c,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,c=F.substitute(c,"//VTK::Normal::Impl",["vec3 normalVCVSOutput;","  if (abs(fdx.x) > 0.0)","    { fdx = normalize(fdx); normalVCVSOutput = normalize(cross(vec3(fdx.y, -fdx.x, 0.0), fdx)); }","  else { fdy = normalize(fdy); normalVCVSOutput = normalize(cross(vec3(fdy.y, -fdy.x, 0.0), fdy));}"]).result):(c=F.substitute(c,"//VTK::Normal::Dec",["uniform int cameraParallel;"]).result,c=F.substitute(c,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,c=F.substitute(c,"//VTK::Normal::Impl",["  fdx = normalize(fdx);","  fdy = normalize(fdy);","  vec3 normalVCVSOutput = normalize(cross(fdx,fdy));","  if (cameraParallel == 1 && normalVCVSOutput.z < 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }","  if (cameraParallel == 0 && dot(normalVCVSOutput,vertexVC.xyz) > 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }"]).result),n.Vertex=s,n.Geometry=f,n.Fragment=c}},t.replaceShaderPositionVC=function(n,a,i){e.lastBoundBO.replaceShaderPositionVC(n,a,i);var o=n.Vertex,s=n.Geometry,f=n.Fragment,c=e.lastBoundBO.getReferenceByName("lastLightComplexity");c>0?(o=F.substitute(o,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,o=F.substitute(o,"//VTK::PositionVC::Impl",["vertexVCVSOutput = MCVCMatrix * vertexMC;","  gl_Position = MCPCMatrix * vertexMC;"]).result,o=F.substitute(o,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result,s=F.substitute(s,"//VTK::PositionVC::Dec",["in vec4 vertexVCVSOutput[];","out vec4 vertexVCGSOutput;"]).result,s=F.substitute(s,"//VTK::PositionVC::Impl",["vertexVCGSOutput = vertexVCVSOutput[i];"]).result,f=F.substitute(f,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,f=F.substitute(f,"//VTK::PositionVC::Impl",["vec4 vertexVC = vertexVCVSOutput;"]).result):(o=F.substitute(o,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,o=F.substitute(o,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result),n.Vertex=o,n.Geometry=s,n.Fragment=f},t.replaceShaderTCoord=function(n,a,i){if(e.lastBoundBO.getCABO().getTCoordOffset()){var o=n.Vertex,s=n.Geometry,f=n.Fragment;if(e.drawingEdges)return;o=F.substitute(o,"//VTK::TCoord::Impl","tcoordVCVSOutput = tcoordMC;").result;var c=e.openGLActor.getActiveTextures(),u=2,v=2;if(c&&c.length>0&&(u=c[0].getComponents(),c[0].getTarget()===e.context.TEXTURE_CUBE_MAP&&(v=3)),e.renderable.getColorTextureMap()&&(u=e.renderable.getColorTextureMap().getPointData().getScalars().getNumberOfComponents(),v=2),v===2){if(o=F.substitute(o,"//VTK::TCoord::Dec","attribute vec2 tcoordMC; varying vec2 tcoordVCVSOutput;").result,s=F.substitute(s,"//VTK::TCoord::Dec",["in vec2 tcoordVCVSOutput[];","out vec2 tcoordVCGSOutput;"]).result,s=F.substitute(s,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,f=F.substitute(f,"//VTK::TCoord::Dec",["varying vec2 tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,c&&c.length>=1)switch(u){case 1:f=F.substitute(f,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:f=F.substitute(f,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:f=F.substitute(f,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}}else switch(o=F.substitute(o,"//VTK::TCoord::Dec","attribute vec3 tcoordMC; varying vec3 tcoordVCVSOutput;").result,s=F.substitute(s,"//VTK::TCoord::Dec",["in vec3 tcoordVCVSOutput[];","out vec3 tcoordVCGSOutput;"]).result,s=F.substitute(s,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,f=F.substitute(f,"//VTK::TCoord::Dec",["varying vec3 tcoordVCVSOutput;","uniform samplerCube texture1;"]).result,u){case 1:f=F.substitute(f,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:f=F.substitute(f,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:f=F.substitute(f,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}n.Vertex=o,n.Geometry=s,n.Fragment=f}},t.replaceShaderClip=function(n,a,i){var o=n.Vertex,s=n.Fragment;if(e.renderable.getNumberOfClippingPlanes()){var f=e.renderable.getNumberOfClippingPlanes();o=F.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;","uniform vec4 clipPlanes[".concat(f,"];"),"varying float clipDistancesVSOutput[".concat(f,"];")]).result,o=F.substitute(o,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < ".concat(f,"; planeNum++)"),"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,s=F.substitute(s,"//VTK::Clip::Dec",["uniform int numClipPlanes;","varying float clipDistancesVSOutput[".concat(f,"];")]).result,s=F.substitute(s,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < ".concat(f,"; planeNum++)"),"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}n.Vertex=o,n.Fragment=s},t.getCoincidentParameters=function(n,a){var i={factor:0,offset:0},o=a.getProperty();if(e.renderable.getResolveCoincidentTopology()||o.getEdgeVisibility()&&o.getRepresentation()===Vn.SURFACE){var s=e.lastBoundBO.getPrimitiveType();s===je.Points||o.getRepresentation()===Vn.POINTS?i=e.renderable.getCoincidentTopologyPointOffsetParameter():s===je.Lines||o.getRepresentation()===Vn.WIREFRAME?i=e.renderable.getCoincidentTopologyLineOffsetParameters():(s===je.Tris||s===je.TriStrips)&&(i=e.renderable.getCoincidentTopologyPolygonOffsetParameters()),(s===je.TrisEdges||s===je.TriStripsEdges)&&(i=e.renderable.getCoincidentTopologyPolygonOffsetParameters(),i.factor/=2,i.offset/=2)}var f=e._openGLRenderer.getSelector();return f&&f.getFieldAssociation()===pi.FIELD_ASSOCIATION_POINTS&&(i.offset-=2),i},t.replaceShaderPicking=function(n,a,i){var o=n.Fragment,s=n.Vertex;if(o=F.substitute(o,"//VTK::Picking::Dec",["uniform int picking;","//VTK::Picking::Dec"]).result,!!e._openGLRenderer.getSelector()){switch((e.lastSelectionState===Ze.ID_LOW24||e.lastSelectionState===Ze.ID_HIGH24)&&(s=F.substitute(s,"//VTK::Picking::Dec",[`flat out int vertexIDVSOutput;
`,`uniform int VertexIDOffset;
`]).result,s=F.substitute(s,"//VTK::Picking::Impl",`  vertexIDVSOutput = gl_VertexID + VertexIDOffset;
`).result,o=F.substitute(o,"//VTK::Picking::Dec",`flat in int vertexIDVSOutput;
`).result,o=F.substitute(o,"//VTK::Picking::Impl",["  int idx = vertexIDVSOutput;","//VTK::Picking::Impl"]).result),e.lastSelectionState){case Ze.ID_LOW24:o=F.substitute(o,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float(idx%256)/255.0, float((idx/256)%256)/255.0, float((idx/65536)%256)/255.0, 1.0);").result;break;case Ze.ID_HIGH24:o=F.substitute(o,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float(idx)/255.0, 0.0, 0.0, 1.0);").result;break;default:o=F.substitute(o,"//VTK::Picking::Dec","uniform vec3 mapperIndex;").result,o=F.substitute(o,"//VTK::Picking::Impl","  gl_FragData[0] = picking != 0 ? vec4(mapperIndex,1.0) : gl_FragData[0];").result}n.Fragment=o,n.Vertex=s}},t.replaceShaderValues=function(n,a,i){if(t.replaceShaderColor(n,a,i),t.replaceShaderNormal(n,a,i),t.replaceShaderLight(n,a,i),t.replaceShaderTCoord(n,a,i),t.replaceShaderPicking(n,a,i),t.replaceShaderClip(n,a,i),t.replaceShaderCoincidentOffset(n,a,i),t.replaceShaderPositionVC(n,a,i),e.haveSeenDepthRequest){var o=n.Fragment;o=F.substitute(o,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,o=F.substitute(o,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result,n.Fragment=o}},t.getNeedToRebuildShaders=function(n,a,i){var o=0,s=0,f=n.getPrimitiveType(),c=e.currentInput,u=!1,v=c.getPointData().getNormals(),g=c.getCellData().getNormals(),p=i.getProperty().getInterpolation()===Ks.FLAT,l=i.getProperty().getRepresentation(),h=n.getOpenGLMode(l,f);if((h===e.context.TRIANGLES||g&&!v||!p&&v||!p&&h===e.context.LINES)&&(u=!0),i.getProperty().getLighting()&&u){o=0;for(var y=a.getLightsByReference(),C=0;C<y.length;++C){var S=y[C],d=S.getSwitch();d>0&&(s++,o===0&&(o=1)),o===1&&(s>1||S.getIntensity()!==1||!S.lightTypeIsHeadLight())&&(o=2),o<3&&S.getPositional()&&(o=3)}}var O=!1,w=e.lastBoundBO.getReferenceByName("lastLightComplexity"),M=e.lastBoundBO.getReferenceByName("lastLightCount");return(w!==o||M!==s)&&(e.lastBoundBO.set({lastLightComplexity:o},!0),e.lastBoundBO.set({lastLightCount:s},!0),O=!0),(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(O=!0),e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||n.getShaderSourceTime().getMTime()<e.renderable.getMTime()||n.getShaderSourceTime().getMTime()<e.currentInput.getMTime()||n.getShaderSourceTime().getMTime()<e.selectionStateChanged.getMTime()||O?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,!0):!1},t.invokeShaderCallbacks=function(n,a,i){var o=e.renderable.getViewSpecificProperties().ShadersCallbacks;o&&o.forEach(function(s){s.callback(s.userData,n,a,i)})},t.setMapperShaderParameters=function(n,a,i){if(n.getProgram().isUniformUsed("PrimitiveIDOffset")&&n.getProgram().setUniformi("PrimitiveIDOffset",e.primitiveIDOffset),n.getProgram().isUniformUsed("VertexIDOffset")&&n.getProgram().setUniformi("VertexIDOffset",e.vertexIDOffset),n.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())){var o=e.lastBoundBO.getReferenceByName("lastLightComplexity");n.getProgram().isAttributeUsed("vertexMC")&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"vertexMC",n.getCABO().getVertexOffset(),n.getCABO().getStride(),e.context.FLOAT,3,!1)||un("Error setting vertexMC in shader VAO.")),n.getProgram().isAttributeUsed("normalMC")&&n.getCABO().getNormalOffset()&&o>0?n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"normalMC",n.getCABO().getNormalOffset(),n.getCABO().getStride(),e.context.FLOAT,3,!1)||un("Error setting normalMC in shader VAO."):n.getVAO().removeAttributeArray("normalMC"),e.renderable.getCustomShaderAttributes().forEach(function(M,x){n.getProgram().isAttributeUsed("".concat(M,"MC"))&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"".concat(M,"MC"),n.getCABO().getCustomData()[x].offset,n.getCABO().getStride(),e.context.FLOAT,n.getCABO().getCustomData()[x].components,!1)||un("Error setting ".concat(M,"MC in shader VAO.")))}),n.getProgram().isAttributeUsed("tcoordMC")&&n.getCABO().getTCoordOffset()?n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"tcoordMC",n.getCABO().getTCoordOffset(),n.getCABO().getStride(),e.context.FLOAT,n.getCABO().getTCoordComponents(),!1)||un("Error setting tcoordMC in shader VAO."):n.getVAO().removeAttributeArray("tcoordMC"),n.getProgram().isAttributeUsed("scalarColor")&&n.getCABO().getColorComponents()?n.getVAO().addAttributeArray(n.getProgram(),n.getCABO().getColorBO(),"scalarColor",n.getCABO().getColorOffset(),n.getCABO().getColorBOStride(),e.context.UNSIGNED_BYTE,4,!0)||un("Error setting scalarColor in shader VAO."):n.getVAO().removeAttributeArray("scalarColor"),n.getAttributeUpdateTime().modified()}if(e.renderable.getNumberOfClippingPlanes()){var s=e.renderable.getNumberOfClippingPlanes(),f=[],c=n.getCABO().getCoordShiftAndScaleEnabled(),u=c?n.getCABO().getInverseShiftAndScaleMatrix():null,v=u?Ae(e.tmpMat4,i.getMatrix()):i.getMatrix();u&&(he(v,v),Ee(v,v,u),he(v,v));for(var g=0;g<s;g++){var p=[];e.renderable.getClippingPlaneInDataCoords(v,g,p);for(var l=0;l<4;l++)f.push(p[l])}n.getProgram().setUniformi("numClipPlanes",s),n.getProgram().setUniform4fv("clipPlanes",f)}e.internalColorTexture&&n.getProgram().isUniformUsed("texture1")&&n.getProgram().setUniformi("texture1",e.internalColorTexture.getTextureUnit());var h=e.openGLActor.getActiveTextures();if(h)for(var y=0;y<h.length;++y){var C=h[y],S=C.getTextureUnit(),d="texture".concat(S+1);n.getProgram().isUniformUsed(d)&&n.getProgram().setUniformi(d,S)}if(e.haveSeenDepthRequest&&n.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),n.getProgram().isUniformUsed("coffset")){var O=t.getCoincidentParameters(a,i);n.getProgram().setUniformf("coffset",O.offset),n.getProgram().isUniformUsed("cfactor")&&n.getProgram().setUniformf("cfactor",O.factor)}n.setMapperShaderParameters(a,i,e._openGLRenderer.getTiledSizeAndOrigin());var w=e._openGLRenderer.getSelector();n.getProgram().setUniform3fArray("mapperIndex",w?w.getPropColorValue():[0,0,0]),n.getProgram().setUniformi("picking",w?w.getCurrentPass()+1:0)},t.setLightingShaderParameters=function(n,a,i){var o=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(!(o<2)){for(var s=n.getProgram(),f=0,c=a.getLightsByReference(),u=0;u<c.length;++u){var v=c[u],g=v.getSwitch();if(g>0){var p=v.getColorByReference(),l=v.getIntensity();e.lightColor[0]=p[0]*l,e.lightColor[1]=p[1]*l,e.lightColor[2]=p[2]*l;var h=v.getDirection(),y=a.getActiveCamera().getViewMatrix(),C=W(h);v.lightTypeIsSceneLight()&&(C[0]=y[0]*h[0]+y[1]*h[1]+y[2]*h[2],C[1]=y[4]*h[0]+y[5]*h[1]+y[6]*h[2],C[2]=y[8]*h[0]+y[9]*h[1]+y[10]*h[2],Fe(C)),e.lightDirection[0]=C[0],e.lightDirection[1]=C[1],e.lightDirection[2]=C[2],e.lightHalfAngle[0]=-e.lightDirection[0],e.lightHalfAngle[1]=-e.lightDirection[1],e.lightHalfAngle[2]=-e.lightDirection[2]+1,Fe(e.lightDirection),s.setUniform3fArray("lightColor".concat(f),e.lightColor),s.setUniform3fArray("lightDirectionVC".concat(f),e.lightDirection),s.setUniform3fArray("lightHalfAngleVC".concat(f),e.lightHalfAngle),f++}}if(!(o<3)){var S=a.getActiveCamera(),d=S.getViewMatrix();he(d,d),f=0;for(var O=0;O<c.length;++O){var w=c[O],M=w.getSwitch();if(M>0){var x=w.getTransformedPosition(),D=new Float64Array(3);Q(D,x,d),s.setUniform3fArray("lightAttenuation".concat(f),w.getAttenuationValuesByReference()),s.setUniformi("lightPositional".concat(f),w.getPositional()),s.setUniformf("lightExponent".concat(f),w.getExponent()),s.setUniformf("lightConeAngle".concat(f),w.getConeAngle()),s.setUniform3fArray("lightPositionVC".concat(f),[D[0],D[1],D[2]]),f++}}}}};function r(n,a,i){return a.identity(i),n.reduce(function(o,s,f){return f===0?s?a.copy(o,s):a.identity(o):s?a.multiply(o,o,s):o},i)}t.setCameraShaderParameters=function(n,a,i){var o=n.getProgram(),s=e.openGLCamera.getKeyMatrices(a),f=a.getActiveCamera(),c=e.openGLCamera.getKeyMatrixTime().getMTime(),u=o.getLastCameraMTime(),v=n.getCABO().getCoordShiftAndScaleEnabled(),g=v?n.getCABO().getInverseShiftAndScaleMatrix():null,p=i.getIsIdentity(),l=p?{mcwc:null,normalMatrix:null}:e.openGLActor.getKeyMatrices();if(i.getCoordinateSystem()===ET.DISPLAY){var h=e._openGLRenderer.getTiledSizeAndOrigin();I(e.tmpMat4),e.tmpMat4[0]=2/h.usize,e.tmpMat4[12]=-1,e.tmpMat4[5]=2/h.vsize,e.tmpMat4[13]=-1,Ee(e.tmpMat4,e.tmpMat4,g),o.setUniformMatrix("MCPCMatrix",e.tmpMat4)}else o.setUniformMatrix("MCPCMatrix",r([s.wcpc,l.mcwc,g],mr,e.tmpMat4));o.isUniformUsed("MCVCMatrix")&&o.setUniformMatrix("MCVCMatrix",r([s.wcvc,l.mcwc,g],mr,e.tmpMat4)),o.isUniformUsed("normalMatrix")&&o.setUniformMatrix3x3("normalMatrix",r([s.normalMatrix,l.normalMatrix],K0,e.tmpMat3)),u!==c&&(o.isUniformUsed("cameraParallel")&&o.setUniformi("cameraParallel",f.getParallelProjection()),o.setLastCameraMTime(c)),p||o.setLastCameraMTime(0)},t.setPropertyShaderParameters=function(n,a,i){var o=n.getProgram(),s=i.getProperty(),f=s.getOpacity(),c=e.drawingEdges?s.getEdgeColorByReference():s.getAmbientColorByReference(),u=e.drawingEdges?s.getEdgeColorByReference():s.getDiffuseColorByReference(),v=e.drawingEdges?1:s.getAmbient(),g=e.drawingEdges?0:s.getDiffuse(),p=e.drawingEdges?0:s.getSpecular(),l=s.getSpecularPower();o.setUniformf("opacityUniform",f),o.setUniform3fArray("ambientColorUniform",c),o.setUniform3fArray("diffuseColorUniform",u),o.setUniformf("ambient",v),o.setUniformf("diffuse",g);var h=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(!(h<1)){var y=s.getSpecularColorByReference();if(o.setUniform3fArray("specularColorUniform",y),o.setUniformf("specularPowerUniform",l),o.setUniformf("specular",p),o.isUniformUsed("ambientIntensityBF")){if(s=i.getBackfaceProperty(),f=s.getOpacity(),c=s.getAmbientColor(),v=s.getAmbient(),u=s.getDiffuseColor(),g=s.getDiffuse(),y=s.getSpecularColor(),p=s.getSpecular(),o.setUniformf("ambientIntensityBF",v),o.setUniformf("diffuseIntensityBF",g),o.setUniformf("opacityUniformBF",f),o.setUniform3fArray("ambientColorUniformBF",c),o.setUniform3fArray("diffuseColorUniformBF",u),h<1)return;o.setUniformf("specularIntensityBF",p),o.setUniform3fArray("specularColorUniformBF",y),o.setUniformf("specularPowerUniformBF",l)}}},t.updateMaximumPointCellIds=function(n,a){var i,o,s,f,c=e._openGLRenderer.getSelector();if(c){if((i=e.selectionWebGLIdsToVTKIds)!==null&&i!==void 0&&(o=i.points)!==null&&o!==void 0&&o.length){var u=e.selectionWebGLIdsToVTKIds.points.length;c.setMaximumPointId(u-1)}if((s=e.selectionWebGLIdsToVTKIds)!==null&&s!==void 0&&(f=s.cells)!==null&&f!==void 0&&f.length){var v=e.selectionWebGLIdsToVTKIds.cells.length;c.setMaximumCellId(v-1)}var g=c.getFieldAssociation();g===pi.FIELD_ASSOCIATION_POINTS&&(e.pointPicking=!0)}},t.renderPieceStart=function(n,a){e.primitiveIDOffset=0,e.vertexIDOffset=0;var i=RT(e._openGLRenderer);if(e.lastSelectionState!==i&&(e.selectionStateChanged.modified(),e.lastSelectionState=i),e._openGLRenderer.getSelector())switch(i){default:e._openGLRenderer.getSelector().renderProp(a)}t.updateBufferObjects(n,a),e.renderable.getColorTextureMap()&&e.internalColorTexture.activate(),e.lastBoundBO=null},t.renderPieceDraw=function(n,a){for(var i=a.getProperty().getRepresentation(),o=a.getProperty().getEdgeVisibility()&&i===Vn.SURFACE,s=e._openGLRenderer.getSelector(),f=s&&s.getFieldAssociation()===pi.FIELD_ASSOCIATION_POINTS&&(e.lastSelectionState===Ze.ID_LOW24||e.lastSelectionState===Ze.ID_HIGH24),c=je.Start;c<je.End;c++){e.primitives[c].setPointPicking(f);var u=e.primitives[c].getCABO();u.getElementCount()&&(e.drawingEdges=o&&(c===je.TrisEdges||c===je.TriStripsEdges),(!e.drawingEdges||!(e.renderDepth||e.lastSelectionState>=0))&&(e.lastBoundBO=e.primitives[c],e.primitiveIDOffset+=e.primitives[c].drawArrays(n,a,i,t),e.vertexIDOffset+=e.primitives[c].getCABO().getElementCount()))}},t.renderPieceFinish=function(n,a){e.LastBoundBO&&e.LastBoundBO.getVAO().release(),e.renderable.getColorTextureMap()&&e.internalColorTexture.deactivate()},t.renderPiece=function(n,a){if(t.invokeEvent(MT),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent(DT),!e.currentInput){un("No input!");return}if(!(!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues())){var i=e.context,o=a.getProperty().getBackfaceCulling(),s=a.getProperty().getFrontfaceCulling();!o&&!s?e._openGLRenderWindow.disableCullFace():s?(e._openGLRenderWindow.enableCullFace(),i.cullFace(i.FRONT)):(e._openGLRenderWindow.enableCullFace(),i.cullFace(i.BACK)),t.renderPieceStart(n,a),t.renderPieceDraw(n,a),t.renderPieceFinish(n,a)}},t.computeBounds=function(n,a){if(!t.getInput()){Dn(e.bounds);return}e.bounds=t.getInput().getBounds()},t.updateBufferObjects=function(n,a){t.getNeedToRebuildBufferObjects(n,a)&&t.buildBufferObjects(n,a)},t.getNeedToRebuildBufferObjects=function(n,a){var i=e.VBOBuildTime.getMTime();return i<t.getMTime()||i<e.renderable.getMTime()||i<a.getMTime()||i<e.currentInput.getMTime()},t.buildBufferObjects=function(n,a){var i=e.currentInput;if(i!==null){e.renderable.mapScalars(i,1);var o=e.renderable.getColorMapColors();e.haveCellScalars=!1;var s=e.renderable.getScalarMode();e.renderable.getScalarVisibility()&&(s===Yr.USE_CELL_DATA||s===Yr.USE_CELL_FIELD_DATA||s===Yr.USE_FIELD_DATA||!i.getPointData().getScalars())&&s!==Yr.USE_POINT_FIELD_DATA&&o&&(e.haveCellScalars=!0);var f=a.getProperty().getInterpolation()!==Ks.FLAT?i.getPointData().getNormals():null;f===null&&i.getCellData().getNormals()&&(e.haveCellNormals=!0,f=i.getCellData().getNormals());var c=a.getProperty().getRepresentation(),u=i.getPointData().getTCoords();if(e.openGLActor.getActiveTextures()||(u=null),e.renderable.getColorCoordinates()){u=e.renderable.getColorCoordinates(),e.internalColorTexture||(e.internalColorTexture=$e.newInstance({resizable:!0}));var v=e.internalColorTexture;v.setMinificationFilter(Ps.NEAREST),v.setMagnificationFilter(Ps.NEAREST),v.setWrapS(Xs.CLAMP_TO_EDGE),v.setWrapT(Xs.CLAMP_TO_EDGE),v.setOpenGLRenderWindow(e._openGLRenderWindow);var g=e.renderable.getColorTextureMap(),p=g.getExtent(),l=g.getPointData().getScalars();v.create2DFromRaw(p[1]-p[0]+1,p[3]-p[2]+1,l.getNumberOfComponents(),l.getDataType(),l.getData()),v.activate(),v.sendParameters(),v.deactivate()}var h="".concat(i.getMTime(),"A").concat(c,"B").concat(i.getMTime())+"C".concat(f?f.getMTime():1,"D").concat(o?o.getMTime():1)+"E".concat(a.getProperty().getEdgeVisibility())+"F".concat(u?u.getMTime():1);if(e.VBOBuildString!==h){var y=i.getPoints(),C={points:y,normals:f,tcoords:u,colors:o,cellOffset:0,vertexOffset:0,haveCellScalars:e.haveCellScalars,haveCellNormals:e.haveCellNormals,customAttributes:e.renderable.getCustomShaderAttributes().map(function(w){return i.getPointData().getArrayByName(w)})};e.renderable.getPopulateSelectionSettings()&&(e.selectionWebGLIdsToVTKIds={points:null,cells:null});for(var S=[{inRep:"verts",cells:i.getVerts()},{inRep:"lines",cells:i.getLines()},{inRep:"polys",cells:i.getPolys()},{inRep:"strips",cells:i.getStrips()},{inRep:"polys",cells:i.getPolys()},{inRep:"strips",cells:i.getStrips()}],d=a.getProperty().getEdgeVisibility()&&c===Vn.SURFACE,O=je.Start;O<je.End;O++)O!==je.TrisEdges&&O!==je.TriStripsEdges?(C.cellOffset+=e.primitives[O].getCABO().createVBO(S[O].cells,S[O].inRep,c,C,e.selectionWebGLIdsToVTKIds),C.vertexOffset+=e.primitives[O].getCABO().getElementCount()):d?e.primitives[O].getCABO().createVBO(S[O].cells,S[O].inRep,Vn.WIREFRAME,Hs(Hs({},C),{},{tcoords:null,colors:null,haveCellScalars:!1,haveCellNormals:!1})):e.primitives[O].releaseGraphicsResources();e.renderable.getPopulateSelectionSettings()&&(e.renderable.setSelectionWebGLIdsToVTKIds(e.selectionWebGLIdsToVTKIds),t.updateMaximumPointCellIds()),e.VBOBuildTime.modified(),e.VBOBuildString=h}}}}var LT={context:null,VBOBuildTime:0,VBOBuildString:null,primitives:null,primTypes:null,shaderRebuildString:null,tmpMat4:null,ambientColor:[],diffuseColor:[],specularColor:[],lightColor:[],lightHalfAngle:[],lightDirection:[],lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastSelectionState:Ze.MIN_KNOWN_PASS-1,selectionStateChanged:null,selectionWebGLIdsToVTKIds:null,pointPicking:!1};function Dg(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,LT,r),Qe.extend(t,e,r),en.implementReplaceShaderCoincidentOffset(t,e,r),en.implementBuildShadersWithReplacements(t,e,r),e.primitives=[],e.primTypes=je,e.tmpMat3=_t(new Float64Array(9)),e.tmpMat4=I(new Float64Array(16));for(var n=je.Start;n<je.End;n++)e.primitives[n]=$t.newInstance(),e.primitives[n].setPrimitiveType(n),e.primitives[n].set({lastLightComplexity:0,lastLightCount:0,lastSelectionPass:!1},!0);ze(t,e,["context"]),e.VBOBuildTime={},_e(e.VBOBuildTime,{mtime:0}),e.selectionStateChanged={},_e(e.selectionStateChanged,{mtime:0}),VT(t,e)}var Eg=ke(Dg,"vtkOpenGLPolyDataMapper"),mT={newInstance:Eg,extend:Dg};Ie("vtkMapper",Eg);var kT=tn.ColorMode,fn=tn.ScalarMode,li=tn.GetArray;function FT(t,e){e.classHierarchy.push("vtkMapper2D"),t.createDefaultLookupTable=function(){e.lookupTable=pr.newInstance()},t.getColorModeAsString=function(){return T.enumToString(kT,e.colorMode)},t.setColorModeToDefault=function(){return t.setColorMode(0)},t.setColorModeToMapScalars=function(){return t.setColorMode(1)},t.setColorModeToDirectScalars=function(){return t.setColorMode(2)},t.getScalarModeAsString=function(){return T.enumToString(fn,e.scalarMode)},t.setScalarModeToDefault=function(){return t.setScalarMode(0)},t.setScalarModeToUsePointData=function(){return t.setScalarMode(1)},t.setScalarModeToUseCellData=function(){return t.setScalarMode(2)},t.setScalarModeToUsePointFieldData=function(){return t.setScalarMode(3)},t.setScalarModeToUseCellFieldData=function(){return t.setScalarMode(4)},t.setScalarModeToUseFieldData=function(){return t.setScalarMode(5)},t.getAbstractScalars=function(r,n,a,i,o){if(!r||!e.scalarVisibility)return{scalars:null,cellFLag:!1};var s=null,f=!1;if(n===fn.DEFAULT)s=r.getPointData().getScalars(),s||(s=r.getCellData().getScalars(),f=!0);else if(n===fn.USE_POINT_DATA)s=r.getPointData().getScalars();else if(n===fn.USE_CELL_DATA)s=r.getCellData().getScalars(),f=!0;else if(n===fn.USE_POINT_FIELD_DATA){var c=r.getPointData();a===li.BY_ID?s=c.getArrayByIndex(i):s=c.getArrayByName(o)}else if(n===fn.USE_CELL_FIELD_DATA){var u=r.getCellData();f=!0,a===li.BY_ID?s=u.getArrayByIndex(i):s=u.getArrayByName(o)}else if(n===fn.USE_FIELD_DATA){var v=r.getFieldData();a===li.BY_ID?s=v.getArrayByIndex(i):s=v.getArrayByName(o)}return{scalars:s,cellFlag:f}},t.getLookupTable=function(){return e.lookupTable||t.createDefaultLookupTable(),e.lookupTable},t.getMTime=function(){var r=e.mtime;if(e.lookupTable!==null){var n=e.lookupTable.getMTime();r=n>r?n:r}return r},t.mapScalars=function(r,n){var a=t.getAbstractScalars(r,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName).scalars;if(!a){e.colorMapColors=null;return}var i="".concat(t.getMTime()).concat(a.getMTime()).concat(n);if(e.colorBuildString!==i){e.useLookupTableScalarRange||t.getLookupTable().setRange(e.scalarRange[0],e.scalarRange[1]);var o=t.getLookupTable();o&&(o.build(),e.colorMapColors=o.mapScalars(a,e.colorMode,e.fieldDataTupleId)),e.colorBuildString="".concat(t.getMTime()).concat(a.getMTime()).concat(n)}}}var NT={static:!1,lookupTable:null,scalarVisibility:!1,scalarRange:[0,1],useLookupTableScalarRange:!1,colorMode:0,scalarMode:0,arrayAccessMode:1,renderTime:0,colorByArrayName:null,transformCoordinate:null,viewSpecificProperties:null,customShaderAttributes:[]};function Rg(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,NT,r),To.extend(t,e,r),T.get(t,e,["colorMapColors"]),T.setGet(t,e,["arrayAccessMode","colorByArrayName","colorMode","lookupTable","renderTime","scalarMode","scalarVisibility","static","transformCoordinate","useLookupTableScalarRange","viewSpecificProperties","customShaderAttributes"]),T.setGetArray(t,e,["scalarRange"],2),e.viewSpecificProperties||(e.viewSpecificProperties={}),FT(t,e)}var UT=T.newInstance(Rg,"vtkMapper2D"),GT={newInstance:UT,extend:Rg},BT=T.vtkErrorMacro,_T=[1,-1,1,-1,1,-1];function jT(t,e){e.classHierarchy.push("vtkPoints"),t.getNumberOfPoints=t.getNumberOfTuples,t.setNumberOfPoints=function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;t.getNumberOfPoints()!==r&&(e.size=r*n,e.values=T.newTypedArray(e.dataType,e.size),t.setNumberOfComponents(n),t.modified())},t.setPoint=function(r){for(var n=arguments.length,a=new Array(n>1?n-1:0),i=1;i<n;i++)a[i-1]=arguments[i];t.setTuple(r,a)},t.getPoint=t.getTuple,t.insertNextPoint=function(r,n,a){return t.insertNextTuple([r,n,a])},t.getBounds=function(){if(t.getNumberOfComponents()===3){var r=t.getRange(0);e.bounds[0]=r[0],e.bounds[1]=r[1];var n=t.getRange(1);e.bounds[2]=n[0],e.bounds[3]=n[1];var a=t.getRange(2);return e.bounds[4]=a[0],e.bounds[5]=a[1],e.bounds}if(t.getNumberOfComponents()!==2)return BT(`getBounds called on an array with components of
        `.concat(t.getNumberOfComponents())),_T;var i=t.getRange(0);e.bounds[0]=i[0],e.bounds[1]=i[1];var o=t.getRange(1);return e.bounds[2]=o[0],e.bounds[3]=o[1],e.bounds[4]=0,e.bounds[5]=0,e.bounds},t.computeBounds=t.getBounds,t.setNumberOfComponents(e.numberOfComponents<2?3:e.numberOfComponents)}var WT={empty:!0,numberOfComponents:3,dataType:Me.FLOAT,bounds:[1,-1,1,-1,1,-1]};function Vg(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,WT,r),ie.extend(t,e,r),jT(t,e)}var $T=T.newInstance(Vg,"vtkPoints"),Pn={newInstance:$T,extend:Vg},zT=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyData2DFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

uniform int PrimitiveIDOffset;

// Texture coordinates
//VTK::TCoord::Dec

// Scalar coloring
//VTK::Color::Dec

// Depth Peeling
//VTK::DepthPeeling::Dec

// picking support
//VTK::Picking::Dec

// the output of this shader
//VTK::Output::Dec

// Apple Bug
//VTK::PrimID::Dec

void main()
{
  // Apple Bug
  //VTK::PrimID::Impl

  //VTK::Color::Impl
  //VTK::TCoord::Impl

  //VTK::DepthPeeling::Impl
  //VTK::Picking::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }
}
`,bT=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyData2DVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

// all variables that represent positions or directions have a suffix
// indicating the coordinate system they are in. The possible values are
// MC - Model Coordinates
// WC - WC world coordinates
// VC - View Coordinates
// DC - Display Coordinates

in vec4 vertexWC;

// frag position in VC
//VTK::PositionVC::Dec

// material property values
//VTK::Color::Dec

// Texture coordinates
//VTK::TCoord::Dec

// Apple Bug
//VTK::PrimID::Dec

uniform mat4 WCVCMatrix;  // World to view matrix

void main()
{
  // Apple Bug
  //VTK::PrimID::Impl

  gl_Position = WCVCMatrix*vertexWC;

  //VTK::TCoord::Impl

  //VTK::Color::Impl

  //VTK::PositionVC::Impl
}
`,Lg={BACKGROUND:0,FOREGROUND:1},mg={DisplayLocation:Lg},Ct=$t.primTypes,Ar=GT.ScalarMode,Zr=ae,HT={type:"StartEvent"},KT={type:"EndEvent"};function PT(t,e){e.classHierarchy.push("vtkOpenGLPolyDataMapper2D"),t.buildPass=function(n){n&&(e.openGLActor2D=t.getFirstAncestorOfType("vtkOpenGLActor2D"),e._openGLRenderer=e.openGLActor2D.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()))},t.overlayPass=function(n){n&&t.render()},t.getShaderTemplate=function(n,a,i){n.Vertex=bT,n.Fragment=zT,n.Geometry=""},t.render=function(){var n=e._openGLRenderWindow.getContext();if(e.context!==n){e.context=n;for(var a=Ct.Start;a<Ct.End;a++)e.primitives[a].setOpenGLRenderWindow(e._openGLRenderWindow)}var i=e.openGLActor2D.getRenderable(),o=e._openGLRenderer.getRenderable();t.renderPiece(o,i)},t.renderPiece=function(n,a){if(t.invokeEvent(HT),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent(KT),!e.currentInput){Zr("No input!");return}!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues()||(t.renderPieceStart(n,a),t.renderPieceDraw(n,a),t.renderPieceFinish(n,a))},t.renderPieceStart=function(n,a){if(e.primitiveIDOffset=0,e._openGLRenderer.getSelector())switch(e._openGLRenderer.getSelector().getCurrentPass()){default:e._openGLRenderer.getSelector().renderProp(a)}t.updateBufferObjects(n,a),e.lastBoundBO=null},t.getNeedToRebuildShaders=function(n,a,i){return n.getShaderSourceTime().getMTime()<e.renderable.getMTime()||n.getShaderSourceTime().getMTime()<e.currentInput.getMTime()},t.updateBufferObjects=function(n,a){t.getNeedToRebuildBufferObjects(n,a)&&t.buildBufferObjects(n,a)},t.getNeedToRebuildBufferObjects=function(n,a){var i=e.VBOBuildTime.getMTime();return!!(i<t.getMTime()||i<e._openGLRenderWindow.getMTime()||i<e.renderable.getMTime()||i<a.getMTime()||i<e.currentInput.getMTime()||e.renderable.getTransformCoordinate()&&i<n.getMTime())},t.buildBufferObjects=function(n,a){var i=e.currentInput;if(i!==null){e.renderable.mapScalars(i,a.getProperty().getOpacity());var o=e.renderable.getColorMapColors();e.haveCellScalars=!1;var s=e.renderable.getScalarMode();e.renderable.getScalarVisibility()&&(s===Ar.USE_CELL_DATA||s===Ar.USE_CELL_FIELD_DATA||s===Ar.USE_FIELD_DATA||!i.getPointData().getScalars())&&s!==Ar.USE_POINT_FIELD_DATA&&o&&(e.haveCellScalars=!0);var f=a.getProperty().getRepresentation(),c=i.getPointData().getTCoords();e.openGLActor2D.getActiveTextures()||(c=null);var u=e.renderable.getTransformCoordinate(),v=n.getRenderWindow().getViews()[0],g=v.getViewportSize(n),p="".concat(i.getMTime(),"A").concat(f,"B").concat(i.getMTime())+"C".concat(o?o.getMTime():1)+"D".concat(c?c.getMTime():1)+"E".concat(u?n.getMTime():1)+"F".concat(g);if(e.VBOBuildString!==p){var l=i.getPoints();if(u){var h=Pn.newInstance(),y=l.getNumberOfPoints();h.setNumberOfPoints(y);for(var C=[],S=0;S<y;++S){l.getPoint(S,C),u.setValue(C);var d=u.getComputedDoubleViewportValue(n);h.setPoint(S,d[0],d[1],0)}l=h}var O={points:l,tcoords:c,colors:o,cellOffset:0,haveCellScalars:e.haveCellSCalars,customAttributes:e.renderable.getCustomShaderAttributes().map(function(w){return i.getPointData().getArrayByName(w)})};O.cellOffset+=e.primitives[Ct.Points].getCABO().createVBO(i.getVerts(),"verts",f,O),O.cellOffset+=e.primitives[Ct.Lines].getCABO().createVBO(i.getLines(),"lines",f,O),O.cellOffset+=e.primitives[Ct.Tris].getCABO().createVBO(i.getPolys(),"polys",f,O),O.cellOffset+=e.primitives[Ct.TriStrips].getCABO().createVBO(i.getStrips(),"strips",f,O),e.VBOBuildTime.modified(),e.VBOBuildString=p}}},t.renderPieceDraw=function(n,a){var i=a.getProperty().getRepresentation(),o=e.context;o.depthMask(!0);for(var s=Ct.Start;s<Ct.End;s++){var f=e.primitives[s].getCABO();f.getElementCount()&&(e.lastBoundBO=e.primitives[s],e.primitiveIDOffset+=e.primitives[s].drawArrays(n,a,i,t))}},t.renderPieceFinish=function(n,a){e.lastBoundBO&&e.lastBoundBO.getVAO().release()},t.replaceShaderValues=function(n,a,i){t.replaceShaderColor(n,a,i),t.replaceShaderTCoord(n,a,i),t.replaceShaderPicking(n,a,i),t.replaceShaderPositionVC(n,a,i)},t.replaceShaderColor=function(n,a,i){var o=n.Vertex,s=n.Geometry,f=n.Fragment;e.haveCellScalars&&(f=F.substitute(f,"//VTK::Color::Dec",["uniform samplerBuffer texture1;"]).result,f=F.substitute(f,"//VTK::Color::Impl",["gl_FragData[0] = texelFetchBuffer(texture1, gl_PrimitiveID + PrimitiveIDOffset);"]).result),e.lastBoundBO.getCABO().getColorComponents()!==0?(o=F.substitute(o,"//VTK::Color::Dec",["in vec4 diffuseColor;","out vec4 fcolorVSOutput;"]).result,o=F.substitute(o,"//VTK::Color::Impl",["fcolorVSOutput = diffuseColor;"]).result,s=F.substitute(s,"//VTK::Color::Dec",[`in vec4 fcolorVSOutput[];
`,"out vec4 fcolorGSOutput;"]).result,s=F.substitute(s,"//VTK::Color::Impl",["fcolorGSOutput = fcolorVSOutput[i];"]).result,f=F.substitute(f,"//VTK::Color::Dec",["in vec4 fcolorVSOutput;"]).result,f=F.substitute(f,"//VTK::Color::Impl",["gl_FragData[0] = fcolorVSOutput;"]).result):(f=F.substitute(f,"//VTK::Color::Dec",["uniform vec4 diffuseColor;"]).result,f=F.substitute(f,"//VTK::Color::Impl",["gl_FragData[0] = diffuseColor;"]).result),n.Vertex=o,n.Geometry=s,n.Fragment=f},t.replaceShaderTCoord=function(n,a,i){if(e.lastBoundBO.getCABO().getTCoordOffset()){var o=n.Vertex,s=n.Geometry,f=n.Fragment,c=e.lastBoundBO.getCABO().getTCoordComponents();c===1?(o=F.substitute(o,"//VTK::TCoord::Dec",["in float tcoordMC;","out float tcoordVCVSOutput;"]).result,o=F.substitute(o,"//VTK::TCoord::Impl",["tcoordVCVSOutput = tcoordMC;"]).result,s=F.substitute(s,"//VTK::TCoord::Dec",[`in float tcoordVCVSOutput[];
`,"out float tcoordVCGSOutput;"]).result,s=F.substitute(s,["//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];"]).result,f=F.substitute(f,"//VTK::TCoord::Dec",["in float tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,f=F.substitute(f,"//VTK::TCoord::Impl",["gl_FragData[0] = gl_FragData[0]*texture2D(texture1, vec2(tcoordVCVSOutput,0));"]).result):c===2&&(o=F.substitute(o,"//VTK::TCoord::Dec",["in vec2 tcoordMC;","out vec2 tcoordVCVSOutput;"]).result,o=F.substitute(o,"//VTK::TCoord::Impl",["tcoordVCVSOutput = tcoordMC;"]).result,s=F.substitute(s,"//VTK::TCoord::Dec",[`in vec2 tcoordVCVSOutput[];
`,"out vec2 tcoordVCGSOutput;"]).result,s=F.substitute(s,"//VTK::TCoord::Impl",["tcoordVCGSOutput = tcoordVCVSOutput[i];"]).result,f=F.substitute(f,"//VTK::TCoord::Dec",["in vec2 tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,f=F.substitute(f,"//VTK::TCoord::Impl",["gl_FragData[0] = gl_FragData[0]*texture2D(texture1, tcoordVCVSOutput.st);"]).result),e.haveCellScalars&&(s=F.substitute(s,"//VTK::PrimID::Impl",["gl_PrimitiveID = gl_PrimitiveIDIn;"]).result),n.Vertex=o,n.Geometry=s,n.Fragment=f}},t.replaceShaderPicking=function(n,a,i){var o=n.Fragment;o=F.substitute(o,"//VTK::Picking::Dec",["uniform vec3 mapperIndex;","uniform int picking;"]).result,o=F.substitute(o,"//VTK::Picking::Impl","  gl_FragData[0] = picking != 0 ? vec4(mapperIndex,1.0) : gl_FragData[0];").result,n.Fragment=o},t.replaceShaderPositionVC=function(n,a,i){e.lastBoundBO.replaceShaderPositionVC(n,a,i)},t.invokeShaderCallbacks=function(n,a,i){var o=e.renderable.getViewSpecificProperties().ShadersCallbacks;o&&o.forEach(function(s){s.callback(s.userData,n,a,i)})},t.setMapperShaderParameters=function(n,a,i){if(n.getProgram().isUniformUsed("PrimitiveIDOffset")&&n.getProgram().setUniformi("PrimitiveIDOffset",e.primitiveIDOffset),n.getProgram().isAttributeUsed("vertexWC")&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"vertexWC",n.getCABO().getVertexOffset(),n.getCABO().getStride(),e.context.FLOAT,3,!1)||Zr("Error setting vertexWC in shader VAO.")),n.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())){e.renderable.getCustomShaderAttributes().forEach(function(g,p){n.getProgram().isAttributeUsed("".concat(g,"MC"))&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"".concat(g,"MC"),n.getCABO().getCustomData()[p].offset,n.getCABO().getStride(),e.context.FLOAT,n.getCABO().getCustomData()[p].components,!1)||Zr("Error setting ".concat(g,"MC in shader VAO.")))}),n.getProgram().isAttributeUsed("tcoordMC")&&n.getCABO().getTCoordOffset()?n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"tcoordMC",n.getCABO().getTCoordOffset(),n.getCABO().getStride(),e.context.FLOAT,n.getCABO().getTCoordComponents(),!1)||Zr("Error setting tcoordMC in shader VAO."):n.getVAO().removeAttributeArray("tcoordMC"),e.internalColorTexture&&n.getProgram().isUniformUsed("texture1")&&n.getProgram().setUniformi("texture1",e.internalColorTexture.getTextureUnit());var o=e.openGLActor2D.getActiveTextures();if(o)for(var s=0;s<o.length;++s){var f=o[s],c=f.getTextureUnit(),u="texture".concat(c+1);n.getProgram().isUniformUsed(u)&&n.getProgram().setUniformi(u,c)}n.setMapperShaderParameters(a,i,e._openGLRenderer.getTiledSizeAndOrigin());var v=e._openGLRenderer.getSelector();n.getProgram().setUniform3fArray("mapperIndex",v?v.getPropColorValue():[0,0,0]),n.getProgram().setUniformi("picking",v?v.getCurrentPass()+1:0)}},t.setPropertyShaderParameters=function(n,a,i){var o=e.renderable.getColorMapColors();if(!o||o.getNumberOfComponents()===0){var s=n.getProgram(),f=i.getProperty(),c=f.getOpacity(),u=f.getColor(),v=[u[0],u[1],u[2],c];s.setUniform4f("diffuseColor",v)}},t.setLightingShaderParameters=function(n,a,i){};function r(n,a,i){return a.identity(i),n.reduce(function(o,s,f){return f===0?s?a.copy(o,s):a.identity(o):s?a.multiply(o,o,s):o},i)}t.setCameraShaderParameters=function(n,a,i){var o=n.getProgram(),s=n.getCABO().getCoordShiftAndScaleEnabled(),f=s?n.getCABO().getInverseShiftAndScaleMatrix():null,c=a.getRenderWindow().getViews()[0],u=c.getViewportSize(a),v=a.getViewport(),g=i.getActualPositionCoordinate().getComputedDoubleViewportValue(a),p=[0,0,1,1],l=[0,0,1,1];if(l[0]=v[0]>=p[0]?v[0]:p[0],l[1]=v[1]>=p[1]?v[1]:p[1],l[2]=v[2]<=p[2]?v[2]:p[2],l[3]=v[3]<=p[3]?v[3]:p[3],!(l[0]>=l[2])&&!(l[1]>=l[3])){u[0]=Gt(u[0]*(l[2]-l[0])/(v[2]-v[0])),u[1]=Gt(u[1]*(l[3]-l[1])/(v[3]-v[1]));var h=e._openGLRenderer.getParent().getSize(),y=Gt(g[0]-(l[0]-v[0])*h[0]),C=Gt(g[1]-(l[1]-v[1])*h[1]),S=-y,d=-y+u[0],O=-C,w=-C+u[1];S===d&&(d=S+1),O===w&&(w=O+1);var M=I(new Float64Array(16));M[0]=2/(d-S),M[1*4+1]=2/(w-O),M[0*4+3]=-1*(d+S)/(d-S),M[1*4+3]=-1*(w+O)/(w-O),M[2*4+2]=0,M[2*4+3]=i.getProperty().getDisplayLocation()===Lg.FOREGROUND?-1:1,M[3*4+3]=1,he(M,M),o.setUniformMatrix("WCVCMatrix",r([M,f],mr,e.tmpMat4))}}}var XT={context:null,VBOBuildTime:0,VBOBuildString:null,primitives:null,primTypes:null,shaderRebuildString:null};function YT(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,XT,r),Qe.extend(t,e,r),en.implementReplaceShaderCoincidentOffset(t,e,r),en.implementBuildShadersWithReplacements(t,e,r),e.primitives=[],e.primTypes=Ct,e.tmpMat4=I(new Float64Array(16));for(var n=Ct.Start;n<Ct.End;n++)e.primitives[n]=$t.newInstance(),e.primitives[n].setPrimitiveType(n),e.primitives[n].set({lastLightComplexity:0,lastLightCount:0,lastSelectionPass:!1},!0);ze(t,e,["context"]),e.VBOBuildTime={},_e(e.VBOBuildTime,{mtime:0}),PT(t,e)}var AT=ke(YT,"vtkOpenGLPolyDataMapper2D");Ie("vtkMapper2D",AT);var Ys=ae;function ZT(t,e){e.classHierarchy.push("vtkOpenGLSkybox"),t.buildPass=function(r){if(r){e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow);var n=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(n.getActiveCamera())}},t.queryPass=function(r,n){if(r){if(!e.renderable||!e.renderable.getVisibility())return;n.incrementOpaqueActorCount()}},t.opaquePass=function(r,n){if(r&&!e._openGLRenderer.getSelector()){t.updateBufferObjects(),e.context.depthMask(!0),e._openGLRenderWindow.getShaderCache().readyShaderProgram(e.tris.getProgram()),e.openGLTexture.render(e._openGLRenderWindow);var a=e.openGLTexture.getTextureUnit();e.tris.getProgram().setUniformi("sbtexture",a);var i=e._openGLRenderer.getRenderable(),o=e.openGLCamera.getKeyMatrices(i),s=new Float64Array(16);if(at(s,o.wcpc),e.tris.getProgram().setUniformMatrix("IMCPCMatrix",s),e.lastFormat==="box"){var f=i.getActiveCamera().getPosition();e.tris.getProgram().setUniform3f("camPos",f[0],f[1],f[2])}e.tris.getVAO().bind(),e.context.drawArrays(e.context.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),e.openGLTexture.deactivate()}},t.updateBufferObjects=function(){if(!e.tris.getCABO().getElementCount()){for(var r=new Float32Array(12),n=0;n<4;n++)r[n*3]=n%2*2-1,r[n*3+1]=n>1?1:-1,r[n*3+2]=1;var a=ie.newInstance({numberOfComponents:3,values:r});a.setName("points");var i=new Uint16Array(8);i[0]=3,i[1]=0,i[2]=1,i[3]=3,i[4]=3,i[5]=0,i[6]=3,i[7]=2;var o=ie.newInstance({numberOfComponents:1,values:i});e.tris.getCABO().createVBO(o,"polys",Je.SURFACE,{points:a,cellOffset:0})}e.renderable.getFormat()!==e.lastFormat&&(e.lastFormat=e.renderable.getFormat(),e.lastFormat==="box"&&e.tris.setProgram(e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(`//VTK::System::Dec
             attribute vec3 vertexMC;
             uniform mat4 IMCPCMatrix;
             varying vec3 TexCoords;
             void main () {
              gl_Position = vec4(vertexMC.xyz, 1.0);
              vec4 wpos = IMCPCMatrix * gl_Position;
              TexCoords = wpos.xyz/wpos.w;
             }`,`//VTK::System::Dec
             //VTK::Output::Dec
             varying vec3 TexCoords;
             uniform samplerCube sbtexture;
             uniform vec3 camPos;
             void main () {
               // skybox looks from inside out
               // which means we have to adjust
               // our tcoords. Otherwise text would
               // be flipped
               vec3 tc = normalize(TexCoords - camPos);
               if (abs(tc.z) < max(abs(tc.x),abs(tc.y)))
               {
                 tc = vec3(1.0, 1.0, -1.0) * tc;
               }
               else
               {
                 tc = vec3(-1.0, 1.0, 1.0) * tc;
               }
               gl_FragData[0] = textureCube(sbtexture, tc);
             }`,"")),e.lastFormat==="background"&&e.tris.setProgram(e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(`//VTK::System::Dec
             attribute vec3 vertexMC;
             uniform mat4 IMCPCMatrix;
             varying vec2 TexCoords;
             void main () {
              gl_Position = vec4(vertexMC.xyz, 1.0);
              vec4 wpos = IMCPCMatrix * gl_Position;
              TexCoords = vec2(vertexMC.x, vertexMC.y)*0.5 + 0.5;
             }`,`//VTK::System::Dec
             //VTK::Output::Dec
             varying vec2 TexCoords;
             uniform sampler2D sbtexture;
             void main () {
               gl_FragData[0] = texture2D(sbtexture, TexCoords);
             }`,"")),e.tris.getShaderSourceTime().modified(),e.tris.getVAO().bind(),e.tris.getVAO().addAttributeArray(e.tris.getProgram(),e.tris.getCABO(),"vertexMC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||Ys("Error setting vertexMC in shader VAO."));var s=e.renderable.getTextures();s.length||Ys("vtkSkybox requires a texture map"),e.openGLTexture.getRenderable()!==s[0]&&(e.openGLTexture.releaseGraphicsResources(e._openGLRenderWindow),e.openGLTexture.setRenderable(s[0]))}}var qT={context:null};function JT(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,qT,r),Qe.extend(t,e,r),e.openGLTexture=$e.newInstance(),e.tris=$t.newInstance(),e.keyMatrixTime={},_e(e.keyMatrixTime,{mtime:0}),e.keyMatrices={normalMatrix:_t(new Float64Array(9)),mcwc:I(new Float64Array(16))},ze(t,e,["context"]),ot(t,e,["activeTextures"]),ZT(t,e)}var QT=ke(JT);Ie("vtkSkybox",QT);var IT=dn;function eC(t,e){e.classHierarchy.push("vtkOpenGLPixelSpaceCallbackMapper"),t.opaquePass=function(r,n){e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent();var a=e._openGLRenderer.getAspectRatio(),i=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,o=e._openGLRenderer.getTiledSizeAndOrigin(),s=null;if(e.renderable.getUseZValues()){var f=n.getZBufferTexture(),c=Math.floor(f.getWidth()),u=Math.floor(f.getHeight()),v=e._openGLRenderWindow.getContext();f.bind();var g=n.getFramebuffer();g?g.saveCurrentBindingsAndBuffers():IT("No framebuffer to save/restore");var p=v.createFramebuffer();v.bindFramebuffer(v.FRAMEBUFFER,p),v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_2D,f.getHandle(),0),v.checkFramebufferStatus(v.FRAMEBUFFER)===v.FRAMEBUFFER_COMPLETE&&(s=new Uint8Array(c*u*4),v.viewport(0,0,c,u),v.readPixels(0,0,c,u,v.RGBA,v.UNSIGNED_BYTE,s)),g&&g.restorePreviousBindingsAndBuffers(),v.deleteFramebuffer(p)}e.renderable.invokeCallback(e.renderable.getInputData(),i,a,o,s)},t.queryPass=function(r,n){r&&e.renderable.getUseZValues()&&n.requestDepth()}}var tC={};function nC(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,tC,r),Qe.extend(t,e,r),eC(t,e)}var rC=ke(nC,"vtkOpenGLPixelSpaceCallbackMapper");Ie("vtkPixelSpaceCallbackMapper",rC);function As(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function Bo(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?As(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):As(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function kg(t){var e=0;return t.filter(function(r,n){return n===e?(e+=r+1,!0):!1})}function Fg(t){for(var e=0,r=0;r<t.length;)r+=t[r]+1,e++;return e}var aC={extractCellSizes:kg,getNumberOfCells:Fg};function iC(t,e){e.classHierarchy.push("vtkCellArray");var r=Bo({},t);t.getNumberOfCells=function(n){return e.numberOfCells!==void 0&&!n||(e.cellSizes?e.numberOfCells=e.cellSizes.length:e.numberOfCells=Fg(t.getData())),e.numberOfCells},t.getCellSizes=function(n){return e.cellSizes!==void 0&&!n||(e.cellSizes=kg(t.getData())),e.cellSizes},t.resize=function(n){var a=t.getNumberOfTuples();r.resize(n);var i=t.getNumberOfTuples();i<a&&(i===0?(e.numberOfCells=0,e.cellSizes=[]):(e.numberOfCells=void 0,e.cellSizes=void 0))},t.setData=function(n){r.setData(n,1),e.numberOfCells=void 0,e.cellSizes=void 0},t.getCell=function(n){var a=n,i=e.values[a++];return e.values.subarray(a,a+i)},t.insertNextCell=function(n){var a=t.getNumberOfCells();return t.insertNextTuples([n.length].concat(W(n))),++e.numberOfCells,e.cellSizes!=null&&e.cellSizes.push(n.length),a}}function oC(t){return Bo({empty:!0,numberOfComponents:1,dataType:Me.UNSIGNED_INT},t)}function Ng(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};ie.extend(t,e,oC(r)),iC(t,e)}var sC=T.newInstance(Ng,"vtkCellArray"),Fa=Bo({newInstance:sC,extend:Ng},aC);function uC(t,e){e.classHierarchy.push("vtkCell"),t.initialize=function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(n){e.pointsIds=n;var i=e.points.getData();i.length!==3*e.pointsIds.length&&(i=T.newTypedArray(r.getDataType(),3*e.pointsIds.length));var o=r.getData();e.pointsIds.forEach(function(s,f){var c=3*s,u=3*f;i[u]=o[c],i[++u]=o[++c],i[++u]=o[++c]}),e.points.setData(i)}else{e.points=r,e.pointsIds=new Array(r.getNumberOfPoints());for(var a=r.getNumberOfPoints()-1;a>=0;--a)e.pointsIds[a]=a}},t.getBounds=function(){var r=e.points.getNumberOfPoints(),n=[];if(r){e.points.getPoint(0,n),e.bounds[0]=n[0],e.bounds[1]=n[0],e.bounds[2]=n[1],e.bounds[3]=n[1],e.bounds[4]=n[2],e.bounds[5]=n[2];for(var a=1;a<r;a++)e.points.getPoint(a,n),e.bounds[0]=n[0]<e.bounds[0]?n[0]:e.bounds[0],e.bounds[1]=n[0]>e.bounds[1]?n[0]:e.bounds[1],e.bounds[2]=n[1]<e.bounds[2]?n[1]:e.bounds[2],e.bounds[3]=n[1]>e.bounds[3]?n[1]:e.bounds[3],e.bounds[4]=n[2]<e.bounds[4]?n[2]:e.bounds[4],e.bounds[5]=n[2]>e.bounds[5]?n[2]:e.bounds[5]}else Dn(e.bounds);return e.bounds},t.getLength2=function(){t.getBounds();for(var r=0,n=0,a=0;a<3;a++)n=e.bounds[2*a+1]-e.bounds[2*a],r+=n*n;return r},t.getParametricDistance=function(r){for(var n,a=0,i=0;i<3;i++)r[i]<0?n=-r[i]:r[i]>1?n=r[i]-1:n=0,n>a&&(a=n);return a},t.getNumberOfPoints=function(){return e.points.getNumberOfPoints()},t.deepCopy=function(r){r.initialize(e.points,e.pointsIds)},t.getCellDimension=function(){},t.intersectWithLine=function(r,n,a,i,o,s,f){},t.evaluatePosition=function(r,n,a,i,o,s){T.vtkErrorMacro("vtkCell.evaluatePosition is not implemented.")}}var fC={bounds:[-1,-1,-1,-1,-1,-1],pointsIds:[]};function Ug(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,fC,r),T.obj(t,e),e.points||(e.points=Pn.newInstance()),T.get(t,e,["points","pointsIds"]),uC(t,e)}var cC=T.newInstance(Ug,"vtkCell"),Na={newInstance:cC,extend:Ug};function gC(t,e){var r=e;for(e>=t.array.length&&(r+=t.array.length);r>t.array.length;)t.array.push({ncells:0,cells:null});t.array.length=r}function vC(t,e){e.classHierarchy.push("vtkCellLinks"),t.buildLinks=function(r){var n=r.getPoints().getNumberOfPoints(),a=r.getNumberOfCells(),i=new Uint32Array(n);if(r.isA("vtkPolyData")){for(var o=0;o<a;++o){var s=r.getCellPoints(o),f=s.cellPointIds;f.forEach(function(h){t.incrementLinkCount(h)})}t.allocateLinks(n),e.maxId=n-1;for(var c=function(y){var C=r.getCellPoints(y),S=C.cellPointIds;S.forEach(function(d){t.insertCellReference(d,i[d]++,y)})},u=0;u<a;++u)c(u)}else{for(var v=0;v<a;v++){var g=Na.newInstance();g.getPointsIds().forEach(function(h){t.incrementLinkCount(h)})}t.allocateLinks(n),e.maxId=n-1;for(var p=function(y){var C=Na.newInstance();C.getPointsIds().forEach(function(S){t.insertCellReference(S,i[S]++,y)})},l=0;l<a;++l)p(l)}},t.allocate=function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.array=Array(r).fill().map(function(){return{ncells:0,cells:null}}),e.extend=n,e.maxId=-1},t.initialize=function(){e.array=null},t.getLink=function(r){return e.array[r]},t.getNcells=function(r){return e.array[r].ncells},t.getCells=function(r){return e.array[r].cells},t.insertNextPoint=function(r){e.array.push({ncells:r,cells:Array(r)}),++e.maxId},t.insertNextCellReference=function(r,n){e.array[r].cells[e.array[r].ncells++]=n},t.deletePoint=function(r){e.array[r].ncells=0,e.array[r].cells=null},t.removeCellReference=function(r,n){e.array[n].cells=e.array[n].cells.filter(function(a){return a!==r}),e.array[n].ncells=e.array[n].cells.length},t.addCellReference=function(r,n){e.array[n].cells[e.array[n].ncells++]=r},t.resizeCellList=function(r,n){e.array[r].cells.length=n},t.squeeze=function(){gC(e,e.maxId+1)},t.reset=function(){e.maxId=-1},t.deepCopy=function(r){e.array=W(r.array),e.extend=r.extend,e.maxId=r.maxId},t.incrementLinkCount=function(r){++e.array[r].ncells},t.allocateLinks=function(r){for(var n=0;n<r;++n)e.array[n].cells=new Array(e.array[n].ncells)},t.insertCellReference=function(r,n,a){e.array[r].cells[n]=a}}var pC={array:null,maxId:0,extend:0};function Gg(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,pC,r),T.obj(t,e),vC(t,e)}var lC=T.newInstance(Gg,"vtkCellLinks"),hC={newInstance:lC,extend:Gg},Oe={VTK_EMPTY_CELL:0,VTK_VERTEX:1,VTK_POLY_VERTEX:2,VTK_LINE:3,VTK_POLY_LINE:4,VTK_TRIANGLE:5,VTK_TRIANGLE_STRIP:6,VTK_POLYGON:7,VTK_PIXEL:8,VTK_QUAD:9,VTK_TETRA:10,VTK_VOXEL:11,VTK_HEXAHEDRON:12,VTK_WEDGE:13,VTK_PYRAMID:14,VTK_PENTAGONAL_PRISM:15,VTK_HEXAGONAL_PRISM:16,VTK_QUADRATIC_EDGE:21,VTK_QUADRATIC_TRIANGLE:22,VTK_QUADRATIC_QUAD:23,VTK_QUADRATIC_POLYGON:36,VTK_QUADRATIC_TETRA:24,VTK_QUADRATIC_HEXAHEDRON:25,VTK_QUADRATIC_WEDGE:26,VTK_QUADRATIC_PYRAMID:27,VTK_BIQUADRATIC_QUAD:28,VTK_TRIQUADRATIC_HEXAHEDRON:29,VTK_QUADRATIC_LINEAR_QUAD:30,VTK_QUADRATIC_LINEAR_WEDGE:31,VTK_BIQUADRATIC_QUADRATIC_WEDGE:32,VTK_BIQUADRATIC_QUADRATIC_HEXAHEDRON:33,VTK_BIQUADRATIC_TRIANGLE:34,VTK_CUBIC_LINE:35,VTK_CONVEX_POINT_SET:41,VTK_POLYHEDRON:42,VTK_PARAMETRIC_CURVE:51,VTK_PARAMETRIC_SURFACE:52,VTK_PARAMETRIC_TRI_SURFACE:53,VTK_PARAMETRIC_QUAD_SURFACE:54,VTK_PARAMETRIC_TETRA_REGION:55,VTK_PARAMETRIC_HEX_REGION:56,VTK_HIGHER_ORDER_EDGE:60,VTK_HIGHER_ORDER_TRIANGLE:61,VTK_HIGHER_ORDER_QUAD:62,VTK_HIGHER_ORDER_POLYGON:63,VTK_HIGHER_ORDER_TETRAHEDRON:64,VTK_HIGHER_ORDER_WEDGE:65,VTK_HIGHER_ORDER_PYRAMID:66,VTK_HIGHER_ORDER_HEXAHEDRON:67,VTK_LAGRANGE_CURVE:68,VTK_LAGRANGE_TRIANGLE:69,VTK_LAGRANGE_QUADRILATERAL:70,VTK_LAGRANGE_TETRAHEDRON:71,VTK_LAGRANGE_HEXAHEDRON:72,VTK_LAGRANGE_WEDGE:73,VTK_LAGRANGE_PYRAMID:74,VTK_NUMBER_OF_CELL_TYPES:75},Qi=["vtkEmptyCell","vtkVertex","vtkPolyVertex","vtkLine","vtkPolyLine","vtkTriangle","vtkTriangleStrip","vtkPolygon","vtkPixel","vtkQuad","vtkTetra","vtkVoxel","vtkHexahedron","vtkWedge","vtkPyramid","vtkPentagonalPrism","vtkHexagonalPrism","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkQuadraticEdge","vtkQuadraticTriangle","vtkQuadraticQuad","vtkQuadraticTetra","vtkQuadraticHexahedron","vtkQuadraticWedge","vtkQuadraticPyramid","vtkBiQuadraticQuad","vtkTriQuadraticHexahedron","vtkQuadraticLinearQuad","vtkQuadraticLinearWedge","vtkBiQuadraticQuadraticWedge","vtkBiQuadraticQuadraticHexahedron","vtkBiQuadraticTriangle","vtkCubicLine","vtkQuadraticPolygon","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkConvexPointSet","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkParametricCurve","vtkParametricSurface","vtkParametricTriSurface","vtkParametricQuadSurface","vtkParametricTetraRegion","vtkParametricHexRegion","UnknownClass","UnknownClass","UnknownClass","vtkHigherOrderEdge","vtkHigherOrderTriangle","vtkHigherOrderQuad","vtkHigherOrderPolygon","vtkHigherOrderTetrahedron","vtkHigherOrderWedge","vtkHigherOrderPyramid","vtkHigherOrderHexahedron"];function Zs(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function yC(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Zs(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Zs(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function TC(t){return t<Qi.length?Qi[t]:"UnknownClass"}function CC(t){return Qi.findIndex(t)}function SC(t){return t<Oe.VTK_QUADRATIC_EDGE||t===Oe.VTK_CONVEX_POINT_SET||t===Oe.VTK_POLYHEDRON}function dC(t){return t===Oe.VTK_TRIANGLE_STRIP||t===Oe.VTK_POLY_LINE||t===Oe.VTK_POLY_VERTEX}var OC={getClassNameFromTypeId:TC,getTypeIdFromClassName:CC,isLinear:SC,hasSubCells:dC};function wC(t,e){e.classHierarchy.push("vtkCellTypes"),t.allocate=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:512,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.size=r>0?r:1,e.extend=n>0?n:1,e.maxId=-1,e.typeArray=new Uint8Array(r),e.locationArray=new Uint32Array(r)},t.insertCell=function(r,n,a){e.typeArray[r]=n,e.locationArray[r]=a,r>e.maxId&&(e.maxId=r)},t.insertNextCell=function(r,n){return t.insertCell(++e.maxId,r,n),e.maxId},t.setCellTypes=function(r,n,a){e.size=r,e.typeArray=n,e.locationArray=a,e.maxId=r-1},t.getCellLocation=function(r){return e.locationArray[r]},t.deleteCell=function(r){e.typeArray[r]=Oe.VTK_EMPTY_CELL},t.getNumberOfTypes=function(){return e.maxId+1},t.isType=function(r){for(var n=t.getNumberOfTypes(),a=0;a<n;++a)if(r===t.getCellType(a))return!0;return!1},t.insertNextType=function(r){return t.insertNextCell(r,-1)},t.getCellType=function(r){return e.typeArray[r]},t.reset=function(){e.maxId=-1},t.deepCopy=function(r){t.allocate(r.getSize(),r.getExtend()),e.typeArray.set(r.getTypeArray()),e.locationArray.set(r.getLocationArray()),e.maxId=r.getMaxId()}}var xC={size:0,maxId:-1,extend:1e3};function Bg(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xC,r),T.obj(t,e),T.get(t,e,["size","maxId","extend"]),T.getArray(t,e,["typeArray","locationArray"]),wC(t,e)}var MC=T.newInstance(Bg,"vtkCellTypes"),DC=yC({newInstance:MC,extend:Bg},OC),EC={NO_INTERSECTION:0,YES_INTERSECTION:1,ON_LINE:2},_g={IntersectionState:EC};function qs(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function Js(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?qs(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):qs(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var la=_g.IntersectionState;function Wn(t,e,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,a={t:Number.MIN_VALUE,distance:0},i=[],o;i[0]=r[0]-e[0],i[1]=r[1]-e[1],i[2]=r[2]-e[2];var s=i[0]*(t[0]-e[0])+i[1]*(t[1]-e[1])+i[2]*(t[2]-e[2]),f=A(i,i),c=1e-5*s;return f!==0&&(a.t=s/f),c<0&&(c=-c),-c<f&&f<c||f<=0||a.t<0?o=e:a.t>1?o=r:(o=i,i[0]=e[0]+a.t*i[0],i[1]=e[1]+a.t*i[1],i[2]=e[2]+a.t*i[2]),n&&(n[0]=o[0],n[1]=o[1],n[2]=o[2]),a.distance=et(o,t),a}function jg(t,e,r,n,a,i){var o=[],s=[],f=[];a[0]=0,i[0]=0,tt(e,t,o),tt(n,r,s),tt(r,t,f);var c=[A(o,o),-A(o,s),-A(o,s),A(s,s)],u=[];if(u[0]=A(o,f),u[1]=-A(s,f),Cc(c,u,2)===0){for(var v=Number.MAX_VALUE,g=[t,e,r,n],p=[r,r,t,t],l=[n,n,e,e],h=[i[0],i[0],a[0],a[0]],y=[a[0],a[0],i[0],i[0]],C,S=0;S<4;S++)C=Wn(g[S],p[S],l[S]),C.distance<v&&(v=C.distance,h[S]=C.t,y[S]=S%2);return la.ON_LINE}return a[0]=u[0],i[0]=u[1],a[0]>=0&&a[0]<=1&&i[0]>=0&&i[0]<=1?la.YES_INTERSECTION:la.NO_INTERSECTION}var RC={distanceToLine:Wn,intersection:jg};function VC(t,e){e.classHierarchy.push("vtkLine");function r(n){return n>=0&&n<=1}t.getCellDimension=function(){return 1},t.intersectWithLine=function(n,a,i,o,s){var f={intersect:0,t:Number.MAX_VALUE,subId:0,betweenPoints:null};s[1]=0,s[2]=0;var c=[],u=[],v=[];e.points.getPoint(0,u),e.points.getPoint(1,v);var g=[],p=[],l=jg(n,a,u,v,g,p);if(f.t=g[0],f.betweenPoints=r(f.t),s[0]=p[0],l===la.YES_INTERSECTION){for(var h=0;h<3;h++)o[h]=u[h]+s[0]*(v[h]-u[h]),c[h]=n[h]+f.t*(a[h]-n[h]);if(et(o,c)<=i*i)return f.intersect=1,f}else{var y;if(f.t<0)return y=Wn(n,u,v,o),y.distance<=i*i&&(f.t=0,f.intersect=1,f.betweenPoints=!0),f;if(f.t>1)return y=Wn(a,u,v,o),y.distance<=i*i&&(f.t=1,f.intersect=1,f.betweenPoints=!0),f;if(s[0]<0)return s[0]=0,y=Wn(u,n,a,o),f.t=y.t,y.distance<=i*i&&(f.intersect=1),f;if(s[0]>1)return s[0]=1,y=Wn(v,n,a,o),f.t=y.t,y.distance<=i*i&&(f.intersect=1),f}return f},t.evaluateLocation=function(n,a,i){var o=[],s=[];e.points.getPoint(0,o),e.points.getPoint(1,s);for(var f=0;f<3;f++)a[f]=o[f]+n[0]*(s[f]-o[f]);i[0]=1-n[0],i[1]=n[0]}}var LC={};function Wg(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,LC,r),Na.extend(t,e,r),VC(t,e)}var mC=T.newInstance(Wg,"vtkLine"),ft=Js(Js({newInstance:mC,extend:Wg},RC),_g);function kC(t,e){e.classHierarchy.push("vtkPointSet"),e.points?e.points=ct(e.points):e.points=Pn.newInstance(),t.getNumberOfPoints=function(){return e.points.getNumberOfPoints()},t.getBounds=function(){return e.points.getBounds()},t.computeBounds=function(){t.getBounds()};var r=t.shallowCopy;t.shallowCopy=function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;r(n,a),e.points=Pn.newInstance(),e.points.shallowCopy(n.getPoints())}}var FC={};function $g(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,FC,r),Jn.extend(t,e,r),T.setGet(t,e,["points"]),kC(t,e)}var NC=T.newInstance($g,"vtkPointSet"),UC={newInstance:NC,extend:$g};function Qs(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function GC(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Qs(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Qs(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function _o(t,e,r,n){var a=r[0]-e[0],i=r[1]-e[1],o=r[2]-e[2],s=t[0]-e[0],f=t[1]-e[1],c=t[2]-e[2];n[0]=i*c-o*f,n[1]=o*s-a*c,n[2]=a*f-i*s}function Ua(t,e,r,n){_o(t,e,r,n);var a=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);a!==0&&(n[0]/=a,n[1]/=a,n[2]/=a)}function BC(t,e,r,n,a,i){var o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:1e-6,s=!1,f=[],c=[],u=[],v=[],g=[];Ua(t,e,r,v),Ua(n,a,i,g);var p=-A(v,t),l=-A(g,n),h=[A(g,t)+l,A(g,e)+l,A(g,r)+l];if(h[0]*h[1]>o&&h[0]*h[2]>o)return{intersect:!1,coplanar:s,pt1:f,pt2:c,surfaceId:u};var y=[A(v,n)+p,A(v,a)+p,A(v,i)+p];if(y[0]*y[1]>o&&y[0]*y[2]>o)return{intersect:!1,coplanar:s,pt1:f,pt2:c,surfaceId:u};if(Math.abs(v[0]-g[0])<1e-9&&Math.abs(v[1]-g[1])<1e-9&&Math.abs(v[2]-g[2])<1e-9&&Math.abs(p-l)<1e-9)return s=!0,{intersect:!1,coplanar:s,pt1:f,pt2:c,surfaceId:u};var C=[t,e,r],S=[n,a,i],d=A(v,g),O=(p-l*d)/(d*d-1),w=(l-p*d)/(d*d-1),M=[O*v[0]+w*g[0],O*v[1]+w*g[1],O*v[2]+w*g[2]],x=me(v,g,[]);Fe(x);for(var D=0,R=0,V=[],E=[],L=50,m=50,N=0;N<3;N++){var _=N,G=(N+1)%3,k=jt.intersectWithLine(C[_],C[G],n,g);k.intersection&&k.t>0-o&&k.t<1+o&&(k.t<1+o&&k.t>1-o&&(L=D),V[D++]=A(k.x,x)-A(M,x));var U=jt.intersectWithLine(S[_],S[G],t,v);U.intersection&&U.t>0-o&&U.t<1+o&&(U.t<1+o&&U.t>1-o&&(m=R),E[R++]=A(U.x,x)-A(M,x))}if(D>2){D--;var B=V[2];V[2]=V[L],V[L]=B}if(R>2){R--;var j=E[2];E[2]=E[m],E[m]=j}if(D!==2||R!==2)return{intersect:!1,coplanar:s,pt1:f,pt2:c,surfaceId:u};if(Number.isNaN(V[0])||Number.isNaN(V[1])||Number.isNaN(E[0])||Number.isNaN(E[1]))return{intersect:!1,coplanar:s,pt1:f,pt2:c,surfaceId:u};if(V[0]>V[1]){var H=V[1];V[1]=V[0],V[0]=H}if(E[0]>E[1]){var X=E[1];E[1]=E[0],E[0]=X}var Y,ee;return V[1]<E[0]||E[1]<V[0]?{intersect:!1,coplanar:s,pt1:f,pt2:c,surfaceId:u}:(V[0]<E[0]?V[1]<E[1]?(u[0]=2,u[1]=1,Y=E[0],ee=V[1]):(u[0]=2,u[1]=2,Y=E[0],ee=E[1]):V[1]<E[1]?(u[0]=1,u[1]=1,Y=V[0],ee=V[1]):(u[0]=1,u[1]=2,Y=V[0],ee=E[1]),ji(M,x,Y,f),ji(M,x,ee,c),{intersect:!0,coplanar:s,pt1:f,pt2:c,surfaceId:u})}var _C={computeNormalDirection:_o,computeNormal:Ua,intersectWithTriangle:BC};function jC(t,e){e.classHierarchy.push("vtkTriangle"),t.getCellDimension=function(){return 2},t.intersectWithLine=function(r,n,a,i,o){var s={subId:0,t:Number.MAX_VALUE,intersect:0,betweenPoints:!1};o[2]=0;var f=[],c=a*a,u=[],v=[],g=[];e.points.getPoint(0,u),e.points.getPoint(1,v),e.points.getPoint(2,g);var p=[],l=[];if(Ua(u,v,g,p),p[0]!==0||p[1]!==0||p[2]!==0){var h=jt.intersectWithLine(r,n,u,p);if(s.betweenPoints=h.betweenPoints,s.t=h.t,i[0]=h.x[0],i[1]=h.x[1],i[2]=h.x[2],!h.intersection)return o[0]=0,o[1]=0,s.intersect=0,s;var y=t.evaluatePosition(i,f,o,l);if(y.evaluation>=0)return y.dist2<=c?(s.intersect=1,s):(s.intersect=y.evaluation,s)}var C=et(u,v),S=et(v,g),d=et(g,u);e.line||(e.line=ft.newInstance()),C>S&&C>d?(e.line.getPoints().setPoint(0,u),e.line.getPoints().setPoint(1,v)):S>d&&S>C?(e.line.getPoints().setPoint(0,v),e.line.getPoints().setPoint(1,g)):(e.line.getPoints().setPoint(0,g),e.line.getPoints().setPoint(1,u));var O=e.line.intersectWithLine(r,n,a,i,o);if(s.betweenPoints=O.betweenPoints,s.t=O.t,O.intersect){for(var w=[],M=[],x=[],D=0;D<3;D++)w[D]=u[D]-g[D],M[D]=v[D]-g[D],x[D]=i[D]-g[D];return o[0]=A(x,w)/d,o[1]=A(x,M)/S,s.intersect=1,s}return o[0]=0,o[1]=0,s.intersect=0,s},t.evaluatePosition=function(r,n,a,i){var o={subId:0,dist2:0,evaluation:-1},s,f,c=[],u=[],v=[],g=[],p,l=[],h=[],y=[],C=0,S=0,d=[],O,w,M,x=[],D=[],R=[],V=[];o.subId=0,a[2]=0,e.points.getPoint(1,c),e.points.getPoint(2,u),e.points.getPoint(0,v),_o(c,u,v,g),jt.generalizedProjectPoint(r,c,g,V);var E=0;for(s=0;s<3;s++)g[s]<0?p=-g[s]:p=g[s],p>E&&(E=p,S=s);for(f=0,s=0;s<3;s++)s!==S&&(d[f++]=s);for(s=0;s<2;s++)l[s]=V[d[s]]-v[d[s]],h[s]=c[d[s]]-v[d[s]],y[s]=u[d[s]]-v[d[s]];if(C=Ve(h,y),C===0)return a[0]=0,a[1]=0,o.evaluation=-1,o;if(a[0]=Ve(l,y)/C,a[1]=Ve(h,l)/C,i[0]=1-(a[0]+a[1]),i[1]=a[0],i[2]=a[1],i[0]>=0&&i[0]<=1&&i[1]>=0&&i[1]<=1&&i[2]>=0&&i[2]<=1)n&&(o.dist2=et(V,r),n[0]=V[0],n[1]=V[1],n[2]=V[2]),o.evaluation=1;else{var L;if(n){if(i[1]<0&&i[2]<0)for(O=et(r,v),w=ft.distanceToLine(r,c,v,L,D),M=ft.distanceToLine(r,v,u,L,R),O<w?(o.dist2=O,x=v):(o.dist2=w,x=D),M<o.dist2&&(o.dist2=M,x=R),s=0;s<3;s++)n[s]=x[s];else if(i[2]<0&&i[0]<0)for(O=et(r,c),w=ft.distanceToLine(r,c,v,L,D),M=ft.distanceToLine(r,c,u,L,R),O<w?(o.dist2=O,x=c):(o.dist2=w,x=D),M<o.dist2&&(o.dist2=M,x=R),s=0;s<3;s++)n[s]=x[s];else if(i[1]<0&&i[0]<0)for(O=et(r,u),w=ft.distanceToLine(r,u,v,L,D),M=ft.distanceToLine(r,c,u,L,R),O<w?(o.dist2=O,x=u):(o.dist2=w,x=D),M<o.dist2&&(o.dist2=M,x=R),s=0;s<3;s++)n[s]=x[s];else if(i[0]<0){var m=ft.distanceToLine(r,c,u,n);o.dist2=m.distance}else if(i[1]<0){var N=ft.distanceToLine(r,u,v,n);o.dist2=N.distance}else if(i[2]<0){var _=ft.distanceToLine(r,c,v,n);o.dist2=_.distance}}o.evaluation=0}return o},t.evaluateLocation=function(r,n,a){var i=[],o=[],s=[];e.points.getPoint(0,i),e.points.getPoint(1,o),e.points.getPoint(2,s);for(var f=1-r[0]-r[1],c=0;c<3;c++)n[c]=i[c]*f+o[c]*r[0]+s[c]*r[1];a[0]=f,a[1]=r[0],a[2]=r[1]},t.getParametricDistance=function(r){var n,a=0,i=[];i[0]=r[0],i[1]=r[1],i[2]=1-r[0]-r[1];for(var o=0;o<3;o++)i[o]<0?n=-i[o]:i[o]>1?n=i[o]-1:n=0,n>a&&(a=n);return a}}var WC={};function zg(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,WC,r),Na.extend(t,e,r),jC(t,e)}var $C=T.newInstance(zg,"vtkTriangle"),zC=GC({newInstance:$C,extend:zg},_C),Er=["verts","lines","polys","strips"],tr,Is=T.vtkWarningMacro,bC=(tr={},b(tr,Oe.VTK_LINE,ft),b(tr,Oe.VTK_POLY_LINE,ft),b(tr,Oe.VTK_TRIANGLE,zC),tr);function HC(t,e){e.classHierarchy.push("vtkPolyData");function r(a){return a.replace(/(?:^\w|[A-Z]|\b\w)/g,function(i){return i.toUpperCase()}).replace(/\s+/g,"")}Er.forEach(function(a){t["getNumberOf".concat(r(a))]=function(){return e[a].getNumberOfCells()},e[a]?e[a]=ct(e[a]):e[a]=Fa.newInstance()}),t.getNumberOfCells=function(){return Er.reduce(function(a,i){return a+e[i].getNumberOfCells()},0)};var n=t.shallowCopy;t.shallowCopy=function(a){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;n(a,i),Er.forEach(function(o){e[o]=Fa.newInstance(),e[o].shallowCopy(a.getReferenceByName(o))})},t.buildCells=function(){var a=t.getNumberOfVerts(),i=t.getNumberOfLines(),o=t.getNumberOfPolys(),s=t.getNumberOfStrips(),f=a+i+o+s,c=new Uint8Array(f),u=c,v=new Uint32Array(f),g=v;if(a){var p=0;e.verts.getCellSizes().forEach(function(C,S){g[S]=p,u[S]=C>1?Oe.VTK_POLY_VERTEX:Oe.VTK_VERTEX,p+=C+1}),g=g.subarray(a),u=u.subarray(a)}if(i){var l=0;e.lines.getCellSizes().forEach(function(C,S){g[S]=l,u[S]=C>2?Oe.VTK_POLY_LINE:Oe.VTK_LINE,C===1&&Is("Building VTK_LINE ",S," with only one point, but VTK_LINE needs at least two points. Check the input."),l+=C+1}),g=g.subarray(i),u=u.subarray(i)}if(o){var h=0;e.polys.getCellSizes().forEach(function(C,S){switch(g[S]=h,C){case 3:u[S]=Oe.VTK_TRIANGLE;break;case 4:u[S]=Oe.VTK_QUAD;break;default:u[S]=Oe.VTK_POLYGON;break}C<3&&Is("Building VTK_TRIANGLE ",S," with less than three points, but VTK_TRIANGLE needs at least three points. Check the input."),h+=C+1}),g+=g.subarray(o),u+=u.subarray(o)}if(s){var y=0;u.fill(Oe.VTK_TRIANGLE_STRIP,0,s),e.strips.getCellSizes().forEach(function(C,S){g[S]=y,y+=C+1})}e.cells=DC.newInstance(),e.cells.setCellTypes(f,c,v)},t.buildLinks=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;e.cells===void 0&&t.buildCells(),e.links=hC.newInstance(),a>0?e.links.allocate(a):e.links.allocate(t.getPoints().getNumberOfPoints()),e.links.buildLinks(t)},t.getCellType=function(a){return e.cells.getCellType(a)},t.getCellPoints=function(a){var i=t.getCellType(a),o=null;switch(i){case Oe.VTK_VERTEX:case Oe.VTK_POLY_VERTEX:o=e.verts;break;case Oe.VTK_LINE:case Oe.VTK_POLY_LINE:o=e.lines;break;case Oe.VTK_TRIANGLE:case Oe.VTK_QUAD:case Oe.VTK_POLYGON:o=e.polys;break;case Oe.VTK_TRIANGLE_STRIP:o=e.strips;break;default:return o=null,{type:0,cellPointIds:null}}var s=e.cells.getCellLocation(a),f=o.getCell(s);return{cellType:i,cellPointIds:f}},t.getPointCells=function(a){return e.links.getCells(a)},t.getCellEdgeNeighbors=function(a,i,o){var s=e.links.getLink(i),f=e.links.getLink(o);return s.cells.filter(function(c){return c!==a&&f.cells.indexOf(c)!==-1})},t.getCell=function(a){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,o=t.getCellPoints(a),s=i||bC[o.cellType].newInstance();return s.initialize(t.getPoints(),o.cellPointIds),s}}var KC={};function bg(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,KC,r),UC.extend(t,e,r),T.get(t,e,["cells","links"]),T.setGet(t,e,["verts","lines","polys","strips"]),HC(t,e)}var PC=T.newInstance(bg,"vtkPolyData"),vt={newInstance:PC,extend:bg},XC=T.vtkErrorMacro,YC=function(){function t(){An(this,t),this.segmentMapping={},this.segments=[null],this.faces=[]}return Zn(t,[{key:"addSegment",value:function(r){var n=r[0],a=r[r.length-1];if(!(n===a||r.length<2)){var i=this.segmentMapping[n],o=this.segmentMapping[a];if(i!==void 0&&o!==void 0)if(Math.abs(i)===Math.abs(o)){var s=i<o?o:i,f=this.segments[s];if(i>0)for(var c=1;c<r.length-1;c++)f.push(r[c]);else for(var u=1;u<r.length-1;u++)f.unshift(r[r.length-1-u]);this.faces.push(f),this.segments[s]=null,this.segmentMapping[n]=void 0,this.segmentMapping[a]=void 0}else{var v=Math.abs(i),g=Math.abs(o),p=this.segments[v],l=this.segments[g];this.segments[v]=null,this.segments[g]=null,this.segmentMapping[p[0]]=void 0,this.segmentMapping[l[0]]=void 0,this.segmentMapping[p[p.length-1]]=void 0,this.segmentMapping[l[l.length-1]]=void 0,this.addSegment(r),this.addSegment(p),this.addSegment(l)}else if(i!==void 0){if(i>0){for(var h=this.segments[i],y=1;y<r.length;y++)h.push(r[y]);this.segmentMapping[a]=i}else{var C=this.segments[-i];this.segmentMapping[a]=i;for(var S=1;S<r.length;S++)C.unshift(r[S])}this.segmentMapping[n]=void 0}else if(o!==void 0){if(o>0){for(var d=this.segments[o],O=1;O<r.length;O++)d.push(r[r.length-1-O]);this.segmentMapping[n]=o}else{var w=this.segments[-o];this.segmentMapping[n]=o;for(var M=1;M<r.length;M++)w.unshift(r[r.length-M-1])}this.segmentMapping[a]=void 0}else{var x=this.segments.length;this.segments.push(r),this.segmentMapping[n]=-x,this.segmentMapping[a]=x}}}}]),t}();function AC(t,e){e.classHierarchy.push("vtkClosedPolyLineToSurfaceFilter"),t.requestData=function(r,n){var a=r[0];if(!a){XC("Invalid or missing input");return}var i=vt.newInstance();i.shallowCopy(a);for(var o=new YC,s=a.getLines().getData(),f=0;f<s.length;){for(var c=s[f++],u=[],v=0;v<c;v++)u.push(s[f+v]);o.addSegment(u),f+=c}for(var g=o.faces,p=g.length,l=0;l<g.length;l++)p+=g[l].length;var h=new Uint16Array(p);f=0;for(var y=0;y<g.length;y++){var C=g[y];h[f++]=C.length;for(var S=0;S<C.length;S++)h[f++]=C[S]}i.setPolys(Fa.newInstance({values:h,name:"faces"})),n[0]=i}}var ZC={};function Hg(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ZC,r),T.obj(t,e),T.algo(t,e,1,1),AC(t,e)}var qC=T.newInstance(Hg,"vtkClosedPolyLineToSurfaceFilter"),JC={newInstance:qC,extend:Hg},QC=function(e){return e},eu=1e-6,Kg=function(){function t(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;An(this,t),this.matrix=I(new Float64Array(16)),this.tmp=new Float64Array(3),this.angleConv=e?Y0:QC}return Zn(t,[{key:"rotateFromDirections",value:function(r,n){var a=new Float64Array(3),i=new Float64Array(3),o=new Float64Array(16);Te(a,r[0],r[1],r[2]),Te(i,n[0],n[1],n[2]),It(a,a),It(i,i);var s=kr(a,i);return s>=1?this:(ri(this.tmp,a,i),wr(this.tmp)<eu&&(ri(this.tmp,[1,0,0],r),wr(this.tmp)<eu&&ri(this.tmp,[0,1,0],r)),P0(o,Math.acos(s),this.tmp),Ee(this.matrix,this.matrix,o),this)}},{key:"rotate",value:function(r,n){return Te.apply(X0,[this.tmp].concat(W(n))),It(this.tmp,this.tmp),We(this.matrix,this.matrix,this.angleConv(r),this.tmp),this}},{key:"rotateX",value:function(r){return co(this.matrix,this.matrix,this.angleConv(r)),this}},{key:"rotateY",value:function(r){return Oa(this.matrix,this.matrix,this.angleConv(r)),this}},{key:"rotateZ",value:function(r){return go(this.matrix,this.matrix,this.angleConv(r)),this}},{key:"translate",value:function(r,n,a){return Te(this.tmp,r,n,a),we(this.matrix,this.matrix,this.tmp),this}},{key:"scale",value:function(r,n,a){return Te(this.tmp,r,n,a),Kn(this.matrix,this.matrix,this.tmp),this}},{key:"multiply",value:function(r){return Ee(this.matrix,this.matrix,r),this}},{key:"multiply3x3",value:function(r){return Ee(this.matrix,this.matrix,[r[0],r[1],r[2],0,r[3],r[4],r[5],0,r[6],r[7],r[8],0,0,0,0,1]),this}},{key:"invert",value:function(){return at(this.matrix,this.matrix),this}},{key:"identity",value:function(){return I(this.matrix),this}},{key:"apply",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;if(Wr(oc,this.matrix))return this;for(var i=a===-1?r.length:n+a*3,o=n;o<i;o+=3)Te(this.tmp,r[o],r[o+1],r[o+2]),Q(this.tmp,this.tmp,this.matrix),r[o]=this.tmp[0],r[o+1]=this.tmp[1],r[o+2]=this.tmp[2];return this}},{key:"getMatrix",value:function(){return this.matrix}},{key:"setMatrix",value:function(r){return r&&r.length===16&&Ae(this.matrix,r),this}}]),t}();function IC(){return new Kg(!0)}function eS(){return new Kg(!1)}var qe={buildFromDegree:IC,buildFromRadian:eS};function tS(t,e){e.classHierarchy.push("vtkCubeSource");function r(n,a){var i;if(!e.deleted){var o=vt.newInstance();a[0]=o;var s=6,f=24,c=T.newTypedArray(e.pointType,f*3);o.getPoints().setData(c,3);var u=T.newTypedArray(e.pointType,f*3),v=ie.newInstance({name:"Normals",values:u,numberOfComponents:3});o.getPointData().setNormals(v);var g=2;e.generate3DTextureCoordinates===!0&&(g=3);var p=T.newTypedArray(e.pointType,f*g),l=ie.newInstance({name:"TextureCoordinates",values:p,numberOfComponents:g});o.getPointData().setTCoords(l);var h=[0,0,0],y=[0,0,0],C=[0,0],S=0;h[0]=-e.xLength/2,y[0]=-1,y[1]=0,y[2]=0;for(var d=0;d<2;d++){h[1]=-e.yLength/2;for(var O=0;O<2;O++){C[1]=h[1]+.5,h[2]=-e.zLength/2;for(var w=0;w<2;w++)C[0]=(h[2]+.5)*(1-2*d),c[S*3]=h[0],c[S*3+1]=h[1],c[S*3+2]=h[2],u[S*3]=y[0],u[S*3+1]=y[1],u[S*3+2]=y[2],g===2?(p[S*g]=C[0],p[S*g+1]=C[1]):(p[S*g]=2*d-1,p[S*g+1]=2*O-1,p[S*g+2]=2*w-1),S++,h[2]+=e.zLength;h[1]+=e.yLength}h[0]+=e.xLength,y[0]+=2}h[1]=-e.yLength/2,y[1]=-1,y[0]=0,y[2]=0;for(var M=0;M<2;M++){h[0]=-e.xLength/2;for(var x=0;x<2;x++){C[0]=(h[0]+.5)*(2*M-1),h[2]=-e.zLength/2;for(var D=0;D<2;D++)C[1]=(h[2]+.5)*-1,c[S*3]=h[0],c[S*3+1]=h[1],c[S*3+2]=h[2],u[S*3]=y[0],u[S*3+1]=y[1],u[S*3+2]=y[2],g===2?(p[S*g]=C[0],p[S*g+1]=C[1]):(p[S*g]=2*x-1,p[S*g+1]=2*M-1,p[S*g+2]=2*D-1),S++,h[2]+=e.zLength;h[0]+=e.xLength}h[1]+=e.yLength,y[1]+=2}h[2]=-e.zLength/2,y[2]=-1,y[0]=0,y[1]=0;for(var R=0;R<2;R++){h[1]=-e.yLength/2;for(var V=0;V<2;V++){C[1]=h[1]+.5,h[0]=-e.xLength/2;for(var E=0;E<2;E++)C[0]=(h[0]+.5)*(2*R-1),c[S*3]=h[0],c[S*3+1]=h[1],c[S*3+2]=h[2],u[S*3]=y[0],u[S*3+1]=y[1],u[S*3+2]=y[2],g===2?(p[S*g]=C[0],p[S*g+1]=C[1]):(p[S*g]=2*E-1,p[S*g+1]=2*V-1,p[S*g+2]=2*R-1),S++,h[0]+=e.xLength;h[1]+=e.yLength}h[2]+=e.zLength,y[2]+=2}qe.buildFromDegree().rotateX(e.rotations[0]).rotateY(e.rotations[1]).rotateZ(e.rotations[2]).apply(c).apply(u),(i=qe.buildFromRadian()).translate.apply(i,W(e.center)).apply(c);var L=new Uint16Array(s*5);o.getPolys().setData(L,1);var m=0;L[m++]=4,L[m++]=0,L[m++]=1,L[m++]=3,L[m++]=2,L[m++]=4,L[m++]=4,L[m++]=6,L[m++]=7,L[m++]=5,L[m++]=4,L[m++]=8,L[m++]=10,L[m++]=11,L[m++]=9,L[m++]=4,L[m++]=12,L[m++]=13,L[m++]=15,L[m++]=14,L[m++]=4,L[m++]=16,L[m++]=18,L[m++]=19,L[m++]=17,L[m++]=4,L[m++]=20,L[m++]=21,L[m++]=23,L[m]=22}}t.setBounds=function(){var n=[];if(Array.isArray(arguments.length<=0?void 0:arguments[0]))n=arguments.length<=0?void 0:arguments[0];else for(var a=0;a<arguments.length;a++)n.push(a<0||arguments.length<=a?void 0:arguments[a]);n.length===6&&(e.xLength=n[1]-n[0],e.yLength=n[3]-n[2],e.zLength=n[5]-n[4],e.center=[(n[0]+n[1])/2,(n[2]+n[3])/2,(n[4]+n[5])/2])},t.requestData=r}var nS={xLength:1,yLength:1,zLength:1,center:[0,0,0],rotations:[0,0,0],pointType:"Float64Array",generate3DTextureCoordinates:!1};function Pg(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nS,r),T.obj(t,e),T.setGet(t,e,["xLength","yLength","zLength","generate3DTextureCoordinates"]),T.setGetArray(t,e,["center","rotations"],3),T.algo(t,e,0,1),tS(t,e)}var rS=T.newInstance(Pg,"vtkCubeSource"),Xg={newInstance:rS,extend:Pg};function tu(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function aS(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?tu(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):tu(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var nu=ae;function iS(t){var e=t.getPolys().getData(),r=t.getStrips().getData(),n={done:!1,polyIdx:0,stripIdx:0,remainingStripLength:0,next:function(){var i=null;if(n.polyIdx<e.length){var o=e[n.polyIdx],s=n.polyIdx+1,f=s+o;n.polyIdx=f,i=e.subarray(s,f)}else if(n.stripIdx<r.length){n.remainingStripLength===0&&(n.remainingStripLength=r[n.stripIdx]-2,n.stripIdx+=3);var c=n.stripIdx-2,u=n.stripIdx+1;n.stripIdx++,n.remainingStripLength--,i=r.subarray(c,u)}else if(n.done)throw new Error("Iterator is done");return n.done=n.polyIdx>=e.length&&n.stripIdx>=r.length,i}};return n}function oS(t,e){e.classHierarchy.push("vtkCutter");var r=aS({},t);t.getMTime=function(){var a=r.getMTime();return e.cutFunction&&(a=Math.max(a,e.cutFunction.getMTime())),a};function n(a,i){var o=a.getPoints(),s=o.getData(),f=o.getNumberOfPoints(),c=[],u=[],v=[];(!e.cutScalars||e.cutScalars.length<f)&&(e.cutScalars=new Float32Array(f));for(var g=0,p=0;g<s.length;)e.cutScalars[p++]=e.cutFunction.evaluateFunction(s[g++],s[g++],s[g++]);for(var l=[],h=new Array(3),y=new Array(3),C=iS(a);!C.done;){var S=C.next();if(!(S.length<=2)){for(var d=[],O=void 0,w=0;w<S.length;w++)O=S[w],d.push(e.cutScalars[O]);for(var M=d[0]>0,x=!0,D=1;D<d.length;D++){var R=d[D]>0;if(R!==M){x=!1;break}}if(!x){for(var V=[],E=0;E<S.length;E++){var L=E+1===S.length?0:E+1,m=d[E]>0,N=d[L]>0;if(N!==m){var _=E,G=L,k=d[G]-d[_];k<=0&&(_=L,G=E,k*=-1);var U=0;k!==0&&(U=(e.cutValue-d[_])/k);var B=S[_],j=S[G];h[0]=s[B*3],h[1]=s[B*3+1],h[2]=s[B*3+2],y[0]=s[j*3],y[1]=s[j*3+1],y[2]=s[j*3+2];var H=[h[0]+U*(y[0]-h[0]),h[1]+U*(y[1]-h[1]),h[2]+U*(y[2]-h[2])];V.push({pointEdge1:B,pointEdge2:j,intersectedPoint:H,newPointID:-1})}}for(var X=0;X<V.length;X++){for(var Y=V[X],ee=!1,ce=0;ce<l.length;ce++){var Z=l[ce],Ce=Y.pointEdge1===Z.pointEdge1&&Y.pointEdge2===Z.pointEdge2,q=Y.intersectedPoint[0]===Z.intersectedPoint[0]&&Y.intersectedPoint[1]===Z.intersectedPoint[1]&&Y.intersectedPoint[2]===Z.intersectedPoint[2];if(Ce||q){ee=!0,V[X].newPointID=l[ce].newPointID;break}}ee||(c.push(Y.intersectedPoint[0]),c.push(Y.intersectedPoint[1]),c.push(Y.intersectedPoint[2]),V[X].newPointID=c.length/3-1,l.push(V[X]))}var De=V.length;De===2?u.push(De,V[0].newPointID,V[1].newPointID):De>2&&(v.push(De),V.forEach(function(fe){v.push(fe.newPointID)}))}}}var K=i.getPoints();K.setData(vo(o.getDataType(),c),3),u.length!==0&&i.getLines().setData(Uint16Array.from(u)),v.length!==0&&i.getPolys().setData(Uint16Array.from(v))}t.requestData=function(a,i){var o=a[0];if(!o){nu("Invalid or missing input");return}if(!e.cutFunction){nu("Missing cut function");return}var s=vt.newInstance();n(o,s),i[0]=s}}var sS={cutFunction:null,cutScalars:null,cutValue:0};function Yg(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,sS,r),_e(t,e),Hf(t,e,1,1),ze(t,e,["cutFunction","cutValue"]),oS(t,e)}var uS=ke(Yg,"vtkCutter"),fS={newInstance:uS,extend:Yg},cS=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkImageResliceMapperVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

// all variables that represent positions or directions have a suffix
// indicating the coordinate system they are in. The possible values are
// MC - Model coordinates
// WC - World coordinates
// VC - View coordinates
// DC - Display coordinates
// TC - Texture coordinates

// frag position in VC
//VTK::PositionVC::Dec

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// camera and actor matrix values
//VTK::Camera::Dec

void main()
{
  //VTK::PositionVC::Impl

  //VTK::TCoord::Impl

  //VTK::Picking::Impl
}
`,gS=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkImageResliceMapperFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the gpu image mapper fragment shader

// VC position of this fragment
//VTK::PositionVC::Dec

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// handle coincident offsets
//VTK::Coincident::Dec

//VTK::ZBuffer::Dec

// the output of this shader
//VTK::Output::Dec

void main()
{
  // VC position of this fragment. This should not branch/return/discard.
  //VTK::PositionVC::Impl

  // Place any calls that require uniform flow (e.g. dFdx) here.
  //VTK::UniformFlow::Impl

  // Set gl_FragDepth here (gl_FragCoord.z by default)
  //VTK::Depth::Impl

  // Early depth peeling abort:
  //VTK::DepthPeeling::PreColor

  //VTK::TCoord::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }

  //VTK::DepthPeeling::Impl

  //VTK::Picking::Impl

  // handle coincident offsets
  //VTK::Coincident::Impl

  //VTK::ZBuffer::Impl

  //VTK::RenderPassFragmentShader::Impl
}
`,Ii={NEAREST:0,LINEAR:1},Ag={InterpolationType:Ii},cn=ae;function ru(t,e,r){var n=e.apply(t);if(n){var a=t.getIndependentComponents();return"".concat(t.getMTime(),"-").concat(a,"-").concat(r)}return"0"}function au(t,e,r){return e.identity(r),t.reduce(function(n,a,i){return i===0?a?e.copy(n,a):e.identity(n):a?e.multiply(n,n,a):n},r)}function vS(t,e){e.classHierarchy.push("vtkOpenGLImageResliceMapper"),t.buildPass=function(n){if(n){e.currentRenderPass=null,e._openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");var a=e._openGLRenderer.getRenderable();e._openGLCamera=e._openGLRenderer.getViewNodeFor(a.getActiveCamera()),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLTexture||(e.openGLTexture=$e.newInstance()),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.pwfTexture.setOpenGLRenderWindow(e._openGLRenderWindow)}},t.translucentPass=function(n,a){n&&(e.currentRenderPass=a,t.render())},t.zBufferPass=function(n){n&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=function(n){return t.zBufferPass(n)},t.opaquePass=function(n){n&&t.render()},t.getCoincidentParameters=function(n,a){return e.renderable.getResolveCoincidentTopology()?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null},t.render=function(){var n=e._openGLImageSlice.getRenderable(),a=e._openGLRenderer.getRenderable();t.renderPiece(a,n)},t.renderPiece=function(n,a){if(t.invokeEvent({type:"StartEvent"}),e.renderable.update(),e.currentInput=e.renderable.getInputData(),!e.currentInput){cn("No input!");return}t.updateResliceGeometry(),t.renderPieceStart(n,a),t.renderPieceDraw(n,a),t.renderPieceFinish(n,a),t.invokeEvent({type:"EndEvent"})},t.renderPieceStart=function(n,a){t.updateBufferObjects(n,a);var i=a.getProperty().getInterpolationType();i===Ag.NEAREST?(e.openGLTexture.setMinificationFilter(ue.NEAREST),e.openGLTexture.setMagnificationFilter(ue.NEAREST),e.colorTexture.setMinificationFilter(ue.NEAREST),e.colorTexture.setMagnificationFilter(ue.NEAREST),e.pwfTexture.setMinificationFilter(ue.NEAREST),e.pwfTexture.setMagnificationFilter(ue.NEAREST)):(e.openGLTexture.setMinificationFilter(ue.LINEAR),e.openGLTexture.setMagnificationFilter(ue.LINEAR),e.colorTexture.setMinificationFilter(ue.LINEAR),e.colorTexture.setMagnificationFilter(ue.LINEAR),e.pwfTexture.setMinificationFilter(ue.LINEAR),e.pwfTexture.setMagnificationFilter(ue.LINEAR)),e.lastBoundBO=null},t.renderPieceDraw=function(n,a){var i=e.context;e.openGLTexture.activate(),e.colorTexture.activate(),e.pwfTexture.activate(),t.updateShaders(e.tris,n,a),i.drawArrays(i.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),e.openGLTexture.deactivate(),e.colorTexture.deactivate(),e.pwfTexture.deactivate()},t.renderPieceFinish=function(n,a){},t.updateBufferObjects=function(n,a){t.getNeedToRebuildBufferObjects(n,a)&&t.buildBufferObjects(n,a)},t.getNeedToRebuildBufferObjects=function(n,a){return e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<a.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<a.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.currentInput.getMTime()||e.VBOBuildTime.getMTime()<e.resliceGeom.getMTime()},t.buildBufferObjects=function(n,a){var i,o=e.currentInput;if(o){var s=(i=o.getPointData())===null||i===void 0?void 0:i.getScalars();if(s){var f=s.getNumberOfComponents();if(!e._externalOpenGLTexture){var c="".concat(o.getMTime(),"A").concat(s.getMTime());if(e.openGLTextureString!==c){var u=o.getDimensions();e.openGLTexture.getOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),e.openGLTexture.releaseGraphicsResources(e._openGLRenderWindow),e.openGLTexture.resetFormatAndType(),e.openGLTexture.create3DFilterableFromDataArray(u[0],u[1],u[2],s),e.openGLTextureString=c}}var v=a.getProperty(),g=v.getIndependentComponents(),p=g?f:1,l=g?2*p:1,h=ru(v,v.getRGBTransferFunction,p);if(e.colorTextureString!==h){var y=1024,C=y*l*3,S=new Uint8Array(C),d=v.getRGBTransferFunction();if(d){for(var O=new Float32Array(y*3),w=0;w<p;w++){d=v.getRGBTransferFunction(w);var M=d.getRange();if(d.getTable(M[0],M[1],y,O,1),g)for(var x=0;x<y*3;x++)S[w*y*6+x]=255*O[x],S[w*y*6+x+y*3]=255*O[x];else for(var D=0;D<y*3;D++)S[w*y*6+D]=255*O[D]}e.colorTexture.releaseGraphicsResources(e._openGLRenderWindow),e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw(y,l,3,Me.UNSIGNED_CHAR,S)}else{for(var R=0;R<y*3;++R)S[R]=255*R/((y-1)*3),S[R+1]=255*R/((y-1)*3),S[R+2]=255*R/((y-1)*3);e.colorTexture.create2DFromRaw(y,1,3,Me.UNSIGNED_CHAR,S)}e.colorTextureString=h}var V=ru(v,v.getPiecewiseFunction,p);if(e.pwfTextureString!==V){var E=1024,L=E*l,m=new Uint8Array(L),N=v.getPiecewiseFunction();if(e.pwfTexture.releaseGraphicsResources(e._openGLRenderWindow),e.pwfTexture.resetFormatAndType(),N){for(var _=new Float32Array(L),G=new Float32Array(E),k=0;k<p;++k)if(N=v.getPiecewiseFunction(k),N===null)_.fill(1);else{var U=N.getRange();if(N.getTable(U[0],U[1],E,G,1),g)for(var B=0;B<E;B++)_[k*E*2+B]=G[B],_[k*E*2+B+E]=G[B];else for(var j=0;j<E;j++)_[k*E*2+j]=G[j]}e.pwfTexture.create2DFromRaw(E,l,1,Me.FLOAT,_)}else m.fill(255),e.pwfTexture.create2DFromRaw(E,1,1,Me.UNSIGNED_CHAR,m);e.pwfTextureString=V}var H="".concat(e.resliceGeom.getMTime(),"A").concat(e.renderable.getSlabThickness());if(!e.tris.getCABO().getElementCount()||e.VBOBuildString!==H){var X=ie.newInstance({numberOfComponents:3,values:e.resliceGeom.getPoints().getData()});X.setName("points");var Y=ie.newInstance({numberOfComponents:1,values:e.resliceGeom.getPolys().getData()}),ee={points:X,cellOffset:0};if(e.renderable.getSlabThickness()>0){var ce=e.resliceGeom.getPointData().getNormals();ce?ee.normals=ce:cn("Slab mode requested without normals")}e.tris.getCABO().createVBO(Y,"polys",Je.SURFACE,ee)}e.VBOBuildString=H,e.VBOBuildTime.modified()}}},t.updateShaders=function(n,a,i){if(e.lastBoundBO=n,t.getNeedToRebuildShaders(n,a,i)){var o={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(o,a,i);var s=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(o.Vertex,o.Fragment,o.Geometry);s!==n.getProgram()&&(n.setProgram(s),n.getVAO().releaseGraphicsResources()),n.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(n.getProgram());n.getVAO().bind(),t.setMapperShaderParameters(n,a,i),t.setCameraShaderParameters(n,a,i),t.setPropertyShaderParameters(n,a,i)},t.setMapperShaderParameters=function(n,a,i){var o=n.getProgram();if(n.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())){o.isUniformUsed("texture1")&&o.setUniformi("texture1",e.openGLTexture.getTextureUnit()),o.isAttributeUsed("vertexWC")&&(n.getVAO().addAttributeArray(o,n.getCABO(),"vertexWC",n.getCABO().getVertexOffset(),n.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||cn("Error setting vertexWC in shader VAO.")),o.isAttributeUsed("normalWC")&&(n.getVAO().addAttributeArray(o,n.getCABO(),"normalWC",n.getCABO().getNormalOffset(),n.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||cn("Error setting normalWC in shader VAO.")),o.isUniformUsed("slabThickness")&&o.setUniformf("slabThickness",e.renderable.getSlabThickness()),o.isUniformUsed("spacing")&&o.setUniform3fv("spacing",e.currentInput.getSpacing()),o.isUniformUsed("slabType")&&o.setUniformi("slabType",e.renderable.getSlabType()),o.isUniformUsed("slabType")&&o.setUniformi("slabType",e.renderable.getSlabType()),o.isUniformUsed("slabTrapezoid")&&o.setUniformi("slabTrapezoid",e.renderable.getSlabTrapezoidIntegration());var s=n.getCABO().getCoordShiftAndScaleEnabled(),f=s?n.getCABO().getInverseShiftAndScaleMatrix():null;if(o.isUniformUsed("WCTCMatrix")){var c=e.currentInput;I(e.tmpMat4);var u=c.getBounds(),v=[u[1]-u[0],u[3]-u[2],u[5]-u[4]],g=[u[0],u[2],u[4]],p=[0,0,0,1];kf(e.tmpMat4,p,g,v),at(e.tmpMat4,e.tmpMat4),f&&Ee(e.tmpMat4,e.tmpMat4,f),o.setUniformMatrix("WCTCMatrix",e.tmpMat4)}n.getAttributeUpdateTime().modified()}if(e.haveSeenDepthRequest&&n.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),n.getProgram().isUniformUsed("coffset")){var l=t.getCoincidentParameters(a,i);n.getProgram().setUniformf("coffset",l.offset),n.getProgram().isUniformUsed("cfactor")&&n.getProgram().setUniformf("cfactor",l.factor)}},t.setCameraShaderParameters=function(n,a,i){var o=e._openGLCamera.getKeyMatrices(a),s=e._openGLImageSlice.getKeyMatrices(),f=n.getCABO().getCoordShiftAndScaleEnabled(),c=f?n.getCABO().getInverseShiftAndScaleMatrix():null,u=n.getProgram();u.isUniformUsed("MCPCMatrix")&&(I(e.tmpMat4),u.setUniformMatrix("MCPCMatrix",au([o.wcpc,s.mcwc,c],mr,e.tmpMat4))),u.isUniformUsed("MCVCMatrix")&&(I(e.tmpMat4),u.setUniformMatrix("MCVCMatrix",au([o.wcvc,s.mcwc,c],mr,e.tmpMat4)))},t.setPropertyShaderParameters=function(n,a,i){var o=n.getProgram(),s=i.getProperty(),f=s.getOpacity();o.setUniformf("opacity",f);var c=e.openGLTexture.getComponents(),u=s.getIndependentComponents();if(u)for(var v=0;v<c;++v)o.setUniformf("mix".concat(v),s.getComponentWeight(v));for(var g=e.openGLTexture.getVolumeInfo(),p=0;p<c;p++){var l=s.getColorWindow(),h=s.getColorLevel(),y=u?p:0,C=s.getRGBTransferFunction(y);if(C&&s.getUseLookupTableScalarRange()){var S=C.getRange();l=S[1]-S[0],h=.5*(S[1]+S[0])}var d=g.scale[p]/l,O=(g.offset[p]-h)/l+.5;o.setUniformf("cshift".concat(p),O),o.setUniformf("cscale".concat(p),d)}var w=e.colorTexture.getTextureUnit();o.setUniformi("colorTexture1",w);for(var M=0;M<c;M++){var x=1,D=0,R=u?M:0,V=s.getPiecewiseFunction(R);if(V){var E=V.getRange(),L=E[1]-E[0],m=.5*(E[0]+E[1]);x=g.scale[M]/L,D=(g.offset[M]-m)/L+.5}o.setUniformf("pwfshift".concat(M),D),o.setUniformf("pwfscale".concat(M),x)}var N=e.pwfTexture.getTextureUnit();o.setUniformi("pwfTexture1",N),o.setUniform4fv("backgroundColor",e.renderable.getBackgroundColor())},t.getNeedToRebuildShaders=function(n,a,i){var o=e.openGLTexture.getComponents(),s=i.getProperty().getIndependentComponents(),f=e.renderable.getSlabThickness(),c=e.renderable.getSlabType(),u=e.renderable.getSlabTrapezoidIntegration(),v=!1;return(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(v=!0),v||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||n.getProgram()===0||e.lastTextureComponents!==o||e.lastIndependentComponents!==s||e.lastSlabThickness!==f||e.lastSlabType!==c||e.lastSlabTrapezoidIntegration!==u?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastTextureComponents=o,e.lastIndependentComponents=s,e.lastSlabThickness=f,e.lastSlabType=c,e.lastSlabTrapezoidIntegration=u,!0):!1},t.getShaderTemplate=function(n,a,i){n.Vertex=cS,n.Fragment=gS,n.Geometry=""},t.replaceShaderValues=function(n,a,i){if(t.replaceShaderTCoord(n,a,i),t.replaceShaderPositionVC(n,a,i),e.haveSeenDepthRequest){var o=n.Fragment;o=F.substitute(o,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,o=F.substitute(o,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result,n.Fragment=o}t.replaceShaderCoincidentOffset(n,a,i)},t.replaceShaderTCoord=function(n,a,i){var o=n.Vertex,s=n.Geometry,f=n.Fragment,c=["uniform mat4 WCTCMatrix;","out vec3 fragTexCoord;"],u=e.renderable.getSlabThickness();o=F.substitute(o,"//VTK::TCoord::Dec",c).result;var v=["fragTexCoord = (WCTCMatrix * vertexWC).xyz;"];o=F.substitute(o,"//VTK::TCoord::Impl",v).result;var g=e.openGLTexture.getComponents(),p=i.getProperty().getIndependentComponents(),l=["in vec3 fragTexCoord;","uniform highp sampler3D texture1;","uniform mat4 WCTCMatrix;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform float opacity;","uniform vec4 backgroundColor;"];if(p){for(var h=1;h<g;h++)l=l.concat(["uniform float cshift".concat(h,";"),"uniform float cscale".concat(h,";"),"uniform float pwfshift".concat(h,";"),"uniform float pwfscale".concat(h,";")]);switch(g){case 1:l=l.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:l=l.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:l=l.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:l=l.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:cn("Unsupported number of independent coordinates.")}}u>0&&(l=l.concat(["uniform vec3 spacing;","uniform float slabThickness;","uniform int slabType;","uniform int slabTrapezoid;"]),l=l.concat(["vec4 compositeValue(vec4 currVal, vec4 valToComp, int trapezoid)","{","  vec4 retVal = vec4(1.0);","  if (slabType == 0) // min","  {","    retVal = min(currVal, valToComp);","  }","  else if (slabType == 1) // max","  {","    retVal = max(currVal, valToComp);","  }","  else if (slabType == 3) // sum","  {","    retVal = currVal + (trapezoid > 0 ? 0.5 * valToComp : valToComp); ","  }","  else // mean","  {","    retVal = currVal + (trapezoid > 0 ? 0.5 * valToComp : valToComp); ","  }","  return retVal;","}"])),f=F.substitute(f,"//VTK::TCoord::Dec",l).result;var y=["if (any(greaterThan(fragTexCoord, vec3(1.0))) || any(lessThan(fragTexCoord, vec3(0.0))))","{","  // set the background color and exit","  gl_FragData[0] = backgroundColor;","  return;","}","vec4 tvalue = texture(texture1, fragTexCoord);"];if(u>0&&(y=y.concat(["// Get the first and last samples","int numSlices = 1;","vec3 normalxspacing = normalWCVSOutput * spacing * 0.5;","float distTraveled = length(normalxspacing);","int trapezoid = 0;","while (distTraveled < slabThickness * 0.5)","{","  distTraveled += length(normalxspacing);","  float fnumSlices = float(numSlices);","  if (distTraveled > slabThickness * 0.5)","  {","    // Before stepping outside the slab, sample at the boundaries","    normalxspacing = normalWCVSOutput * slabThickness * 0.5 / fnumSlices;","    trapezoid = slabTrapezoid;","  }","  vec3 fragTCoordNeg = (WCTCMatrix * vec4(vertexWCVSOutput.xyz - fnumSlices * normalxspacing, 1.0)).xyz;","  if (!any(greaterThan(fragTCoordNeg, vec3(1.0))) && !any(lessThan(fragTCoordNeg, vec3(0.0))))","  {","    vec4 newVal = texture(texture1, fragTCoordNeg);","    tvalue = compositeValue(tvalue, newVal, trapezoid);","    numSlices += 1;","  }","  vec3 fragTCoordPos = (WCTCMatrix * vec4(vertexWCVSOutput.xyz + fnumSlices * normalxspacing, 1.0)).xyz;","  if (!any(greaterThan(fragTCoordNeg, vec3(1.0))) && !any(lessThan(fragTCoordNeg, vec3(0.0))))","  {","    vec4 newVal = texture(texture1, fragTCoordPos);","    tvalue = compositeValue(tvalue, newVal, trapezoid);","    numSlices += 1;","  }","}","// Finally, if slab type is *mean*, divide the sum by the numSlices","if (slabType == 2)","{","  tvalue = tvalue / float(numSlices);","}"])),p){for(var C=["r","g","b","a"],S=0;S<g;++S)y=y.concat(["vec3 tcolor".concat(S," = mix").concat(S," * texture2D(colorTexture1, vec2(tvalue.").concat(C[S]," * cscale").concat(S," + cshift").concat(S,", height").concat(S,")).rgb;"),"float compWeight".concat(S," = mix").concat(S," * texture2D(pwfTexture1, vec2(tvalue.").concat(C[S]," * pwfscale").concat(S," + pwfshift").concat(S,", height").concat(S,")).r;")]);switch(g){case 1:y=y.concat(["gl_FragData[0] = vec4(tcolor0.rgb, compWeight0 * opacity);"]);break;case 2:y=y.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:y=y.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:y=y.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:cn("Unsupported number of independent coordinates.")}}else switch(g){case 1:y=y.concat(["// Dependent components","float intensity = tvalue.r;","vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;","float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;","gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);"]);break;case 2:y=y.concat(["float intensity = tvalue.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tvalue.g + pwfshift0);"]);break;case 3:y=y.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]);break;default:y=y.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"])}f=F.substitute(f,"//VTK::TCoord::Impl",y).result,n.Vertex=o,n.Fragment=f,n.Geometry=s},t.replaceShaderPositionVC=function(n,a,i){var o=n.Vertex,s=n.Geometry,f=n.Fragment,c=e.renderable.getSlabThickness(),u=["attribute vec4 vertexWC;"];u=u.concat(["//".concat(t.getMTime()).concat(e.resliceGeomUpdateString)]),c>0&&(u=u.concat(["attribute vec3 normalWC;","varying vec3 normalWCVSOutput;","varying vec4 vertexWCVSOutput;"])),o=F.substitute(o,"//VTK::PositionVC::Dec",u).result;var v=["gl_Position = MCPCMatrix * vertexWC;"];c>0&&(v=v.concat(["normalWCVSOutput = normalWC;","vertexWCVSOutput = vertexWC;"])),o=F.substitute(o,"//VTK::PositionVC::Impl",v).result,o=F.substitute(o,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result;var g=[];c>0&&(g=g.concat(["varying vec3 normalWCVSOutput;","varying vec4 vertexWCVSOutput;"])),f=F.substitute(f,"//VTK::PositionVC::Dec",g).result,n.Vertex=o,n.Geometry=s,n.Fragment=f};function r(n){Bt.normalize(n);for(var a=[0,0,0],i=0;i<3;++i){A0(a),a[i]=1;var o=Bt.dot(n,a);if(o<-.999||o>.999)return[!0,i]}return[!1,2]}t.updateResliceGeometry=function(){var n="",a=e.currentInput,i=a==null?void 0:a.getBounds(),o=!0,s=2;if(e.renderable.getSlicePolyData())n=n.concat("PolyData".concat(e.renderable.getSlicePolyData().getMTime()));else if(e.renderable.getSlicePlane()){n=n.concat("Plane".concat(e.renderable.getSlicePlane().getMTime())),a&&(n=n.concat("Image".concat(a.getMTime())));var f=r(e.renderable.getSlicePlane().getNormal()),c=ne(f,2);o=c[0],s=c[1]}else{var u,v=jt.newInstance();v.setNormal(0,0,1);var g=[0,1,0,1,0,1];a&&(g=i),v.setOrigin(g[0],g[2],.5*(g[5]+g[4])),e.renderable.setSlicePlane(v),n=n.concat("Plane".concat((u=e.renderable.getSlicePlane())===null||u===void 0?void 0:u.getMTime())),a&&(n=n.concat("Image".concat(a.getMTime())))}if(!e.resliceGeom||e.resliceGeomUpdateString!==n){if(e.renderable.getSlicePolyData())e.resliceGeom=e.renderable.getSlicePolyData();else if(e.renderable.getSlicePlane()){var p=a?i:[0,1,0,1,0,1];if(o){for(var M=new Float32Array(12),x=e.renderable.getSlicePlane().getOrigin(),D=[(s+1)%3,(s+2)%3].sort(),R=0,V=0;V<2;++V)for(var E=0;E<2;++E)M[R+s]=x[s],M[R+D[0]]=p[2*D[0]+E],M[R+D[1]]=p[2*D[1]+V],R+=3;var L=new Uint16Array(8);L[0]=3,L[1]=0,L[2]=1,L[3]=3,L[4]=3,L[5]=0,L[6]=3,L[7]=2;var m=e.renderable.getSlicePlane().getNormal();Bt.normalize(m);for(var N=new Float32Array(12),_=0;_<4;++_)N[3*_]=m[0],N[3*_+1]=m[1],N[3*_+2]=m[2];e.resliceGeom||(e.resliceGeom=vt.newInstance()),e.resliceGeom.getPoints().setData(M,3),e.resliceGeom.getPolys().setData(L,1);var G=ie.newInstance({numberOfComponents:3,values:N,name:"Normals"});e.resliceGeom.getPointData().setNormals(G),e.resliceGeom.modified()}else{var l=Xg.newInstance();l.setCenter(.5*(p[0]+p[1]),.5*(p[2]+p[3]),.5*(p[4]+p[5])),l.setXLength(p[1]-p[0]),l.setYLength(p[3]-p[2]),l.setZLength(p[5]-p[4]);var h=fS.newInstance();h.setInputConnection(l.getOutputPort()),h.setCutFunction(e.renderable.getSlicePlane());var y=JC.newInstance();y.setInputConnection(h.getOutputPort()),y.update(),e.resliceGeom=y.getOutputData();var C=e.renderable.getSlicePlane().getNormal(),S=e.resliceGeom.getNumberOfPoints();Bt.normalize(C);for(var d=new Float32Array(S*3),O=0;O<S;++O)d[3*O]=C[0],d[3*O+1]=C[1],d[3*O+2]=C[2];var w=ie.newInstance({numberOfComponents:3,values:d,name:"Normals"});e.resliceGeom.getPointData().setNormals(w)}}else cn("Something went wrong.","A default slice plane should have been created in the beginning of","updateResliceGeometry.");e.resliceGeomUpdateString=n}},t.setOpenGLTexture=function(n){n&&(e.openGLTexture=n,e._externalOpenGLTexture=!0)}}var pS={VBOBuildTime:{},VBOBuildString:null,haveSeenDepthRequest:!1,lastHaveSeenDepthRequest:!1,lastIndependentComponents:!1,lastTextureComponents:0,lastSlabThickness:0,lastSlabTrapezoidIntegration:0,lastSlabType:-1,openGLTexture:null,openGLTextureString:null,colorTextureString:null,pwfTextureString:null,resliceGeom:null,resliceGeomUpdateString:null,tris:null,colorTexture:null,pwfTexture:null,_externalOpenGLTexture:!1};function lS(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,pS,r),Qe.extend(t,e,r),en.implementReplaceShaderCoincidentOffset(t,e,r),en.implementBuildShadersWithReplacements(t,e,r),e.tris=$t.newInstance(),e.openGLTexture=$e.newInstance(),e.colorTexture=$e.newInstance(),e.pwfTexture=$e.newInstance(),e.VBOBuildTime={},_e(e.VBOBuildTime),e.tmpMat4=I(new Float64Array(16)),ot(t,e,["openGLTexture"]),vS(t,e)}var hS=ke(lS,"vtkOpenGLImageResliceMapper");Ie("vtkImageResliceMapper",hS);var yS={NONE:-1,I:0,J:1,K:2,X:3,Y:4,Z:5},jo={SlicingMode:yS},Ln=ae,ht=jo.SlicingMode;function iu(t,e,r){var n=e.apply(t);if(n){var a=t.getIndependentComponents();return"".concat(t.getMTime(),"-").concat(a,"-").concat(r)}return"0"}function TS(t,e){e.classHierarchy.push("vtkOpenGLImageMapper"),t.buildPass=function(r){if(r){e.currentRenderPass=null,e.openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.pwfTexture.setOpenGLRenderWindow(e._openGLRenderWindow);var n=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(n.getActiveCamera()),e.renderable.isA("vtkImageMapper")&&e.renderable.getSliceAtFocalPoint()&&e.renderable.setSliceFromCamera(n.getActiveCamera())}},t.translucentPass=function(r,n){r&&(e.currentRenderPass=n,t.render())},t.zBufferPass=function(r){r&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=function(r){return t.zBufferPass(r)},t.opaquePass=function(r){r&&t.render()},t.getCoincidentParameters=function(r,n){return e.renderable.getResolveCoincidentTopology()?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null},t.render=function(){var r=e.openGLImageSlice.getRenderable(),n=e._openGLRenderer.getRenderable();t.renderPiece(n,r)},t.getShaderTemplate=function(r,n,a){r.Vertex=xg,r.Fragment=Mg,r.Geometry=""},t.replaceShaderValues=function(r,n,a){var i=r.Vertex,o=r.Fragment;i=F.substitute(i,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,i=F.substitute(i,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result,i=F.substitute(i,"//VTK::TCoord::Impl","tcoordVCVSOutput = tcoordMC;").result,i=F.substitute(i,"//VTK::TCoord::Dec","attribute vec2 tcoordMC; varying vec2 tcoordVCVSOutput;").result;var s=e.openGLTexture.getComponents(),f=a.getProperty().getIndependentComponents(),c=["varying vec2 tcoordVCVSOutput;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;","uniform sampler2D texture1;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform float opacity;"];if(f){for(var u=1;u<s;u++)c=c.concat(["uniform float cshift".concat(u,";"),"uniform float cscale".concat(u,";"),"uniform float pwfshift".concat(u,";"),"uniform float pwfscale".concat(u,";")]);switch(s){case 1:c=c.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:c=c.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:c=c.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:c=c.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:Ln("Unsupported number of independent coordinates.")}}if(o=F.substitute(o,"//VTK::TCoord::Dec",c).result,f){for(var v=["r","g","b","a"],g=["vec4 tvalue = texture2D(texture1, tcoordVCVSOutput);"],p=0;p<s;p++)g=g.concat(["vec3 tcolor".concat(p," = mix").concat(p," * texture2D(colorTexture1, vec2(tvalue.").concat(v[p]," * cscale").concat(p," + cshift").concat(p,", height").concat(p,")).rgb;"),"float compWeight".concat(p," = mix").concat(p," * texture2D(pwfTexture1, vec2(tvalue.").concat(v[p]," * pwfscale").concat(p," + pwfshift").concat(p,", height").concat(p,")).r;")]);switch(s){case 1:g=g.concat(["gl_FragData[0] = vec4(tcolor0.rgb, opacity);"]);break;case 2:g=g.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:g=g.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:g=g.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:Ln("Unsupported number of independent coordinates.")}o=F.substitute(o,"//VTK::TCoord::Impl",g).result}else switch(s){case 1:o=F.substitute(o,"//VTK::TCoord::Impl",["float intensity = texture2D(texture1, tcoordVCVSOutput).r;","vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;","float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;","gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);"]).result;break;case 2:o=F.substitute(o,"//VTK::TCoord::Impl",["vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","float intensity = tcolor.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tcolor.g + pwfshift0);"]).result;break;case 3:o=F.substitute(o,"//VTK::TCoord::Impl",["vec4 tcolor = cscale0*texture2D(texture1, tcoordVCVSOutput.st) + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]).result;break;default:o=F.substitute(o,"//VTK::TCoord::Impl",["vec4 tcolor = cscale0*texture2D(texture1, tcoordVCVSOutput.st) + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"]).result}e.haveSeenDepthRequest&&(o=F.substitute(o,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,o=F.substitute(o,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),r.Vertex=i,r.Fragment=o,t.replaceShaderClip(r,n,a),t.replaceShaderCoincidentOffset(r,n,a)},t.replaceShaderClip=function(r,n,a){var i=r.Vertex,o=r.Fragment;if(e.renderable.getNumberOfClippingPlanes()){var s=e.renderable.getNumberOfClippingPlanes();s>6&&(ae("OpenGL has a limit of 6 clipping planes"),s=6),i=F.substitute(i,"//VTK::Clip::Dec",["uniform int numClipPlanes;","uniform vec4 clipPlanes[6];","varying float clipDistancesVSOutput[6];"]).result,i=F.substitute(i,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,o=F.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;","varying float clipDistancesVSOutput[6];"]).result,o=F.substitute(o,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}r.Vertex=i,r.Fragment=o},t.getNeedToRebuildShaders=function(r,n,a){var i=e.openGLTexture.getComponents(),o=a.getProperty().getIndependentComponents(),s=!1;return(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(s=!0),s||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||r.getProgram()===0||e.lastTextureComponents!==i||e.lastIndependentComponents!==o?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastTextureComponents=i,e.lastIndependentComponents=o,!0):!1},t.updateShaders=function(r,n,a){if(e.lastBoundBO=r,t.getNeedToRebuildShaders(r,n,a)){var i={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(i,n,a);var o=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(i.Vertex,i.Fragment,i.Geometry);o!==r.getProgram()&&(r.setProgram(o),r.getVAO().releaseGraphicsResources()),r.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(r.getProgram());r.getVAO().bind(),t.setMapperShaderParameters(r,n,a),t.setCameraShaderParameters(r,n,a),t.setPropertyShaderParameters(r,n,a)},t.setMapperShaderParameters=function(r,n,a){r.getCABO().getElementCount()&&(e.VBOBuildTime>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())&&(r.getProgram().isAttributeUsed("vertexMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"vertexMC",r.getCABO().getVertexOffset(),r.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||Ln("Error setting vertexMC in shader VAO.")),r.getProgram().isAttributeUsed("tcoordMC")&&r.getCABO().getTCoordOffset()&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"tcoordMC",r.getCABO().getTCoordOffset(),r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getTCoordComponents(),e.context.FALSE)||Ln("Error setting tcoordMC in shader VAO.")),r.getAttributeUpdateTime().modified());var i=e.openGLTexture.getTextureUnit();r.getProgram().setUniformi("texture1",i);var o=e.openGLTexture.getComponents(),s=a.getProperty().getIndependentComponents();if(s)for(var f=0;f<o;f++)r.getProgram().setUniformf("mix".concat(f),a.getProperty().getComponentWeight(f));for(var c=e.openGLTexture.getShiftAndScale(),u=0;u<o;u++){var v=a.getProperty().getColorWindow(),g=a.getProperty().getColorLevel(),p=s?u:0,l=a.getProperty().getRGBTransferFunction(p);if(l&&a.getProperty().getUseLookupTableScalarRange()){var h=l.getRange();v=h[1]-h[0],g=.5*(h[1]+h[0])}var y=c.scale/v,C=(c.shift-g)/v+.5;r.getProgram().setUniformf("cshift".concat(u),C),r.getProgram().setUniformf("cscale".concat(u),y)}for(var S=0;S<o;S++){var d=1,O=0,w=s?S:0,M=a.getProperty().getPiecewiseFunction(w);if(M){var x=M.getRange(),D=x[1]-x[0],R=.5*(x[0]+x[1]);d=c.scale/D,O=(c.shift-R)/D+.5}r.getProgram().setUniformf("pwfshift".concat(S),O),r.getProgram().setUniformf("pwfscale".concat(S),d)}if(e.haveSeenDepthRequest&&r.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),r.getProgram().isUniformUsed("coffset")){var V=t.getCoincidentParameters(n,a);r.getProgram().setUniformf("coffset",V.offset),r.getProgram().isUniformUsed("cfactor")&&r.getProgram().setUniformf("cfactor",V.factor)}var E=e.colorTexture.getTextureUnit();r.getProgram().setUniformi("colorTexture1",E);var L=e.pwfTexture.getTextureUnit();if(r.getProgram().setUniformi("pwfTexture1",L),e.renderable.getNumberOfClippingPlanes()){var m=e.renderable.getNumberOfClippingPlanes();m>6&&(ae("OpenGL has a limit of 6 clipping planes"),m=6);var N=r.getCABO().getCoordShiftAndScaleEnabled(),_=N?r.getCABO().getInverseShiftAndScaleMatrix():null,G=_?Ae(e.imagematinv,a.getMatrix()):a.getMatrix();_&&(he(G,G),Ee(G,G,_),he(G,G)),he(e.imagemat,e.currentInput.getIndexToWorld()),Ee(e.imagematinv,G,e.imagemat);for(var k=[],U=0;U<m;U++){var B=[];e.renderable.getClippingPlaneInDataCoords(e.imagematinv,U,B);for(var j=0;j<4;j++)k.push(B[j])}r.getProgram().setUniformi("numClipPlanes",m),r.getProgram().setUniform4fv("clipPlanes",k)}},t.setCameraShaderParameters=function(r,n,a){var i=r.getProgram(),o=e.openGLImageSlice.getKeyMatrices(),s=e.currentInput,f=s.getIndexToWorld();Ee(e.imagemat,o.mcwc,f);var c=e.openGLCamera.getKeyMatrices(n);if(Ee(e.imagemat,c.wcpc,e.imagemat),r.getCABO().getCoordShiftAndScaleEnabled()){var u=r.getCABO().getInverseShiftAndScaleMatrix();Ee(e.imagemat,e.imagemat,u)}i.setUniformMatrix("MCPCMatrix",e.imagemat)},t.setPropertyShaderParameters=function(r,n,a){var i=r.getProgram(),o=a.getProperty(),s=o.getOpacity();i.setUniformf("opacity",s)},t.renderPieceStart=function(r,n){t.updateBufferObjects(r,n),e.lastBoundBO=null},t.renderPieceDraw=function(r,n){var a=e.context;e.openGLTexture.activate(),e.colorTexture.activate(),e.pwfTexture.activate(),e.tris.getCABO().getElementCount()&&(t.updateShaders(e.tris,r,n),a.drawArrays(a.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release()),e.openGLTexture.deactivate(),e.colorTexture.deactivate(),e.pwfTexture.deactivate()},t.renderPieceFinish=function(r,n){},t.renderPiece=function(r,n){if(t.invokeEvent({type:"StartEvent"}),e.renderable.update(),e.currentInput=e.renderable.getCurrentImage(),t.invokeEvent({type:"EndEvent"}),!e.currentInput){Ln("No input!");return}t.renderPieceStart(r,n),t.renderPieceDraw(r,n),t.renderPieceFinish(r,n)},t.computeBounds=function(r,n){if(!t.getInput()){Dn(e.bounds);return}e.bounds=t.getInput().getBounds()},t.updateBufferObjects=function(r,n){t.getNeedToRebuildBufferObjects(r,n)&&t.buildBufferObjects(r,n)},t.getNeedToRebuildBufferObjects=function(r,n){return e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<n.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<n.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.currentInput.getMTime()},t.buildBufferObjects=function(r,n){var a=e.currentInput;if(a){var i=a.getPointData()&&a.getPointData().getScalars();if(i){var o=i.getDataType(),s=i.getNumberOfComponents(),f=n.getProperty(),c=f.getInterpolationType();c===Ii.NEAREST?(e.colorTexture.setMinificationFilter(ue.NEAREST),e.colorTexture.setMagnificationFilter(ue.NEAREST),e.pwfTexture.setMinificationFilter(ue.NEAREST),e.pwfTexture.setMagnificationFilter(ue.NEAREST)):(e.colorTexture.setMinificationFilter(ue.LINEAR),e.colorTexture.setMagnificationFilter(ue.LINEAR),e.pwfTexture.setMinificationFilter(ue.LINEAR),e.pwfTexture.setMagnificationFilter(ue.LINEAR));var u=f.getIndependentComponents(),v=u?s:1,g=u?2*v:1,p=iu(f,f.getRGBTransferFunction,v);if(e.colorTextureString!==p){var l=1024,h=l*g*3,y=new Uint8Array(h),C=f.getRGBTransferFunction();if(C){for(var S=new Float32Array(l*3),d=0;d<v;d++){C=f.getRGBTransferFunction(d);var O=C.getRange();if(C.getTable(O[0],O[1],l,S,1),u)for(var w=0;w<l*3;w++)y[d*l*6+w]=255*S[w],y[d*l*6+w+l*3]=255*S[w];else for(var M=0;M<l*3;M++)y[d*l*6+M]=255*S[M]}e.colorTexture.create2DFromRaw(l,g,3,Me.UNSIGNED_CHAR,y)}else{for(var x=0;x<l*3;++x)y[x]=255*x/((l-1)*3),y[x+1]=255*x/((l-1)*3),y[x+2]=255*x/((l-1)*3);e.colorTexture.create2DFromRaw(l,1,3,Me.UNSIGNED_CHAR,y)}e.colorTextureString=p}var D=iu(f,f.getPiecewiseFunction,v);if(e.pwfTextureString!==D){var R=1024,V=R*g,E=new Uint8Array(V),L=f.getPiecewiseFunction();if(e.pwfTexture.resetFormatAndType(),L){for(var m=new Float32Array(V),N=new Float32Array(R),_=0;_<v;++_)if(L=f.getPiecewiseFunction(_),L===null)m.fill(1);else{var G=L.getRange();if(L.getTable(G[0],G[1],R,N,1),u)for(var k=0;k<R;k++)m[_*R*2+k]=N[k],m[_*R*2+k+R]=N[k];else for(var U=0;U<R;U++)m[_*R*2+U]=N[U]}e.pwfTexture.create2DFromRaw(R,g,1,Me.FLOAT,m)}else E.fill(255),e.pwfTexture.create2DFromRaw(R,1,1,Me.UNSIGNED_CHAR,E);e.pwfTextureString=D}var B=e.renderable.getClosestIJKAxis(),j=B.ijkMode,H=e.renderable.getSlice();j!==e.renderable.getSlicingMode()&&(H=e.renderable.getSliceAtPosition(H));var X=e.renderable.isA("vtkImageArrayMapper")?e.renderable.getSubSlice():Math.round(H),Y=a.getExtent(),ee;j===ht.I&&(ee=X-Y[0]),j===ht.J&&(ee=X-Y[2]),(j===ht.K||j===ht.NONE)&&(ee=X-Y[4]);var ce="".concat(H,"A").concat(a.getMTime(),"A").concat(i.getMTime(),"B").concat(t.getMTime(),"C").concat(e.renderable.getSlicingMode(),"D").concat(n.getProperty().getInterpolationType());if(e.VBOBuildString!==ce){var Z,Ce,q=a.getDimensions();c===Ii.NEAREST?(new Set([1,3,4]).has(s)&&o===Me.UNSIGNED_CHAR&&!u&&e.openGLTexture.setGenerateMipmap(!0),e.openGLTexture.setMinificationFilter(ue.NEAREST),e.openGLTexture.setMagnificationFilter(ue.NEAREST)):(s===4&&o===Me.UNSIGNED_CHAR&&!u?(e.openGLTexture.setGenerateMipmap(!0),e.openGLTexture.setMinificationFilter(ue.LINEAR_MIPMAP_LINEAR)):e.openGLTexture.setMinificationFilter(ue.LINEAR),e.openGLTexture.setMagnificationFilter(ue.LINEAR)),e.openGLTexture.setWrapS(Gr.CLAMP_TO_EDGE),e.openGLTexture.setWrapT(Gr.CLAMP_TO_EDGE);for(var De=q[0]*q[1]*s,K=new Float32Array(12),fe=new Float32Array(8),te=0;te<4;te++)fe[te*2]=te%2?1:0,fe[te*2+1]=te>1?1:0;var $=[ht.X,ht.Y,ht.Z].includes(e.renderable.getSlicingMode())?H:X,z=a.getSpatialExtent(),re=i.getData(),P=null;if(j===ht.I){P=new re.constructor(q[2]*q[1]*s);for(var Le=0,pe=0;pe<q[2];pe++)for(var Re=0;Re<q[1];Re++){var ye=(ee+Re*q[0]+pe*q[0]*q[1])*s;Le=(pe*q[1]+Re)*s,P.set(re.subarray(ye,ye+s),Le)}q[0]=q[1],q[1]=q[2],K[0]=$,K[1]=z[2],K[2]=z[4],K[3]=$,K[4]=z[3],K[5]=z[4],K[6]=$,K[7]=z[2],K[8]=z[5],K[9]=$,K[10]=z[3],K[11]=z[5]}else if(j===ht.J){P=new re.constructor(q[2]*q[0]*s);for(var le=0,Ke=0;Ke<q[2];Ke++)for(var lt=0;lt<q[0];lt++){var Rt=(lt+ee*q[0]+Ke*q[0]*q[1])*s;le=(Ke*q[0]+lt)*s,P.set(re.subarray(Rt,Rt+s),le)}q[1]=q[2],K[0]=z[0],K[1]=$,K[2]=z[4],K[3]=z[1],K[4]=$,K[5]=z[4],K[6]=z[0],K[7]=$,K[8]=z[5],K[9]=z[1],K[10]=$,K[11]=z[5]}else j===ht.K||j===ht.NONE?(P=re.subarray(ee*De,(ee+1)*De),K[0]=z[0],K[1]=z[2],K[2]=$,K[3]=z[1],K[4]=z[2],K[5]=$,K[6]=z[0],K[7]=z[3],K[8]=$,K[9]=z[1],K[10]=z[3],K[11]=$):Ln("Reformat slicing not yet supported.");e.openGLTexture.create2DFilterableFromRaw(q[0],q[1],s,i.getDataType(),P,(Z=(Ce=e.renderable).getPreferSizeOverAccuracy)===null||Z===void 0?void 0:Z.call(Ce)),e.openGLTexture.activate(),e.openGLTexture.sendParameters(),e.openGLTexture.deactivate();var es=ie.newInstance({numberOfComponents:3,values:K});es.setName("points");var ts=ie.newInstance({numberOfComponents:2,values:fe});ts.setName("tcoords");var Vt=new Uint16Array(8);Vt[0]=3,Vt[1]=0,Vt[2]=1,Vt[3]=3,Vt[4]=3,Vt[5]=0,Vt[6]=3,Vt[7]=2;var N0=ie.newInstance({numberOfComponents:1,values:Vt});e.tris.getCABO().createVBO(N0,"polys",Je.SURFACE,{points:es,tcoords:ts,cellOffset:0}),e.VBOBuildTime.modified(),e.VBOBuildString=ce}}}}}var CS={VBOBuildTime:0,VBOBuildString:null,openGLTexture:null,tris:null,imagemat:null,imagematinv:null,colorTexture:null,pwfTexture:null,lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastTextureComponents:0};function SS(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,CS,r),Qe.extend(t,e,r),en.implementReplaceShaderCoincidentOffset(t,e,r),en.implementBuildShadersWithReplacements(t,e,r),e.tris=$t.newInstance(),e.openGLTexture=$e.newInstance({resizable:!0}),e.colorTexture=$e.newInstance({resizable:!0}),e.pwfTexture=$e.newInstance({resizable:!0}),e.imagemat=I(new Float64Array(16)),e.imagematinv=I(new Float64Array(16)),ze(t,e,[]),e.VBOBuildTime={},_e(e.VBOBuildTime),TS(t,e)}var dS=ke(SS,"vtkOpenGLImageMapper");Ie("vtkAbstractImageMapper",dS);function OS(t,e){e.classHierarchy.push("vtkOpenGLImageSlice"),t.buildPass=function(r){if(!(!e.renderable||!e.renderable.getVisibility())&&r){if(!e.renderable)return;e._openGLRenderWindow=t.getFirstAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes()}},t.traverseZBufferPass=function(r){!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children.forEach(function(n){n.traverse(r)}),t.apply(r,!1))},t.traverseOpaqueZBufferPass=function(r){return t.traverseOpaquePass(r)},t.traverseOpaquePass=function(r){!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children.forEach(function(n){n.traverse(r)}),t.apply(r,!1))},t.traverseTranslucentPass=function(r){!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children.forEach(function(n){n.traverse(r)}),t.apply(r,!1))},t.queryPass=function(r,n){if(r){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?n.incrementOpaqueActorCount():n.incrementTranslucentActorCount()}},t.zBufferPass=function(r,n){return t.opaquePass(r,n)},t.opaqueZBufferPass=function(r,n){return t.opaquePass(r,n)},t.opaquePass=function(r,n){r&&e.context.depthMask(!0)},t.translucentPass=function(r,n){e.context.depthMask(!r)},t.getKeyMatrices=function(){return e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(Ae(e.keyMatrices.mcwc,e.renderable.getMatrix()),he(e.keyMatrices.mcwc,e.keyMatrices.mcwc),e.keyMatrixTime.modified()),e.keyMatrices}}var wS={context:null,keyMatrixTime:null,keyMatrices:null};function xS(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,wS,r),Qe.extend(t,e,r),e.keyMatrixTime={},_e(e.keyMatrixTime,{mtime:0}),e.keyMatrices={mcwc:I(new Float64Array(16))},ze(t,e,["context"]),OS(t,e)}var MS=ke(xS,"vtkOpenGLImageSlice");Ie("vtkImageSlice",MS);function DS(t,e){e.classHierarchy.push("vtkOpenGLVolume"),t.buildPass=function(r){!e.renderable||!e.renderable.getVisibility()||r&&(e._openGLRenderWindow=t.getFirstAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes())},t.queryPass=function(r,n){if(r){if(!e.renderable||!e.renderable.getVisibility())return;n.incrementVolumeCount()}},t.traverseVolumePass=function(r){!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children[0].traverse(r),t.apply(r,!1))},t.volumePass=function(r){!e.renderable||!e.renderable.getVisibility()||e.context.depthMask(!r)},t.getKeyMatrices=function(){return e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(e.renderable.computeMatrix(),Ae(e.MCWCMatrix,e.renderable.getMatrix()),he(e.MCWCMatrix,e.MCWCMatrix),e.renderable.getIsIdentity()?_t(e.normalMatrix):(za(e.normalMatrix,e.MCWCMatrix),ba(e.normalMatrix,e.normalMatrix)),e.keyMatrixTime.modified()),{mcwc:e.MCWCMatrix,normalMatrix:e.normalMatrix}}}var ES={};function RS(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ES,r),Qe.extend(t,e,r),e.keyMatrixTime={},_e(e.keyMatrixTime,{mtime:0}),e.normalMatrix=new Float64Array(9),e.MCWCMatrix=new Float64Array(16),ze(t,e,["context"]),DS(t,e)}var VS=ke(RS,"vtkOpenGLVolume");Ie("vtkVolume",VS);function LS(t,e){e.classHierarchy.push("vtkFramebuffer"),t.getBothMode=function(){return e.context.FRAMEBUFFER},t.saveCurrentBindingsAndBuffers=function(r){var n=typeof r<"u"?r:t.getBothMode();t.saveCurrentBindings(n),t.saveCurrentBuffers(n)},t.saveCurrentBindings=function(r){if(!e.context){ae("you must set the OpenGLRenderWindow before calling saveCurrentBindings");return}var n=e.context;e.previousDrawBinding=n.getParameter(e.context.FRAMEBUFFER_BINDING),e.previousActiveFramebuffer=e._openGLRenderWindow.getActiveFramebuffer()},t.saveCurrentBuffers=function(r){},t.restorePreviousBindingsAndBuffers=function(r){var n=typeof r<"u"?r:t.getBothMode();t.restorePreviousBindings(n),t.restorePreviousBuffers(n)},t.restorePreviousBindings=function(r){if(!e.context){ae("you must set the OpenGLRenderWindow before calling restorePreviousBindings");return}var n=e.context;n.bindFramebuffer(n.FRAMEBUFFER,e.previousDrawBinding),e._openGLRenderWindow.setActiveFramebuffer(e.previousActiveFramebuffer)},t.restorePreviousBuffers=function(r){},t.bind=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=r;n===null&&(n=e.context.FRAMEBUFFER),e.context.bindFramebuffer(n,e.glFramebuffer);for(var a=0;a<e.colorBuffers.length;a++)e.colorBuffers[a].bind();e._openGLRenderWindow.setActiveFramebuffer(t)},t.create=function(r,n){if(!e.context){ae("you must set the OpenGLRenderWindow before calling create");return}e.glFramebuffer=e.context.createFramebuffer(),e.glFramebuffer.width=r,e.glFramebuffer.height=n},t.setColorBuffer=function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,a=e.context;if(!a){ae("you must set the OpenGLRenderWindow before calling setColorBuffer");return}var i=a.COLOR_ATTACHMENT0;if(n>0)if(e._openGLRenderWindow.getWebgl2())i+=n;else{ae("Using multiple framebuffer attachments requires WebGL 2");return}e.colorBuffers[n]=r,a.framebufferTexture2D(a.FRAMEBUFFER,i,a.TEXTURE_2D,r.getHandle(),0)},t.removeColorBuffer=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=e.context;if(!n){ae("you must set the OpenGLRenderWindow before calling removeColorBuffer");return}var a=n.COLOR_ATTACHMENT0;if(r>0)if(e._openGLRenderWindow.getWebgl2())a+=r;else{ae("Using multiple framebuffer attachments requires WebGL 2");return}n.framebufferTexture2D(n.FRAMEBUFFER,a,n.TEXTURE_2D,null,0),e.colorBuffers=e.colorBuffers.splice(r,1)},t.setDepthBuffer=function(r){if(!e.context){ae("you must set the OpenGLRenderWindow before calling setDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){var n=e.context;n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,r.getHandle(),0)}else ae("Attaching depth buffer textures to fbo requires WebGL 2")},t.removeDepthBuffer=function(){if(!e.context){ae("you must set the OpenGLRenderWindow before calling removeDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){var r=e.context;r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,null,0)}else ae("Attaching depth buffer textures to framebuffers requires WebGL 2")},t.getGLFramebuffer=function(){return e.glFramebuffer},t.setOpenGLRenderWindow=function(r){e._openGLRenderWindow!==r&&(t.releaseGraphicsResources(),e._openGLRenderWindow=r,e.context=null,r&&(e.context=e._openGLRenderWindow.getContext()))},t.releaseGraphicsResources=function(){e.glFramebuffer&&e.context.deleteFramebuffer(e.glFramebuffer)},t.getSize=function(){var r=[0,0];return e.glFramebuffer!==null&&(r[0]=e.glFramebuffer.width,r[1]=e.glFramebuffer.height),r},t.populateFramebuffer=function(){if(!e.context){ae("you must set the OpenGLRenderWindow before calling populateFrameBuffer");return}t.bind();var r=e.context,n=$e.newInstance();n.setOpenGLRenderWindow(e._openGLRenderWindow),n.setMinificationFilter(ue.LINEAR),n.setMagnificationFilter(ue.LINEAR),n.create2DFromRaw(e.glFramebuffer.width,e.glFramebuffer.height,4,Me.UNSIGNED_CHAR,null),t.setColorBuffer(n),e.depthTexture=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,e.depthTexture),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,e.glFramebuffer.width,e.glFramebuffer.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,e.depthTexture)},t.getColorTexture=function(){return e.colorBuffers[0]}}var mS={glFramebuffer:null,colorBuffers:null,depthTexture:null,previousDrawBinding:0,previousReadBinding:0,previousDrawBuffer:0,previousReadBuffer:0,previousActiveFramebuffer:null};function Zg(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,mS,r),_e(t,e),e.colorBuffers&&ae("you cannot initialize colorBuffers through the constructor. You should call setColorBuffer() instead."),e.colorBuffers=[],Pa(t,e,["colorBuffers"]),LS(t,e)}var kS=ke(Zg,"vtkFramebuffer"),Ia={newInstance:kS,extend:Zg},eo={NEAREST:0,LINEAR:1,FAST_LINEAR:2},qg={FRACTIONAL:0,PROPORTIONAL:1},Wo={InterpolationType:eo,OpacityMode:qg},Jg={COMPOSITE_BLEND:0,MAXIMUM_INTENSITY_BLEND:1,MINIMUM_INTENSITY_BLEND:2,AVERAGE_INTENSITY_BLEND:3,ADDITIVE_INTENSITY_BLEND:4,RADON_TRANSFORM_BLEND:5},FS={OFF:0,NORMALIZED:1,RAW:2},Qg={BlendMode:Jg,FilterMode:FS},NS=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

attribute vec4 vertexDC;

varying vec3 vertexVCVSOutput;
uniform mat4 PCVCMatrix;

uniform float dcxmin;
uniform float dcxmax;
uniform float dcymin;
uniform float dcymax;

void main()
{
  // dcsmall is the device coords reduced to the
  // x y area covered by the volume
  vec4 dcsmall = vec4(
    dcxmin + 0.5 * (vertexDC.x + 1.0) * (dcxmax - dcxmin),
    dcymin + 0.5 * (vertexDC.y + 1.0) * (dcymax - dcymin),
    vertexDC.z,
    vertexDC.w);
  vec4 vcpos = PCVCMatrix * dcsmall;
  vertexVCVSOutput = vcpos.xyz/vcpos.w;
  gl_Position = dcsmall;
}
`,US=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkVolumeFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the volume mappers fragment shader

// the output of this shader
//VTK::Output::Dec

varying vec3 vertexVCVSOutput;

// first declare the settings from the mapper
// that impact the code paths in here

// always set vtkNumComponents 1,2,3,4
//VTK::NumComponents

// possibly define vtkTrilinearOn
//VTK::TrilinearOn

// possibly define vtkIndependentComponents
//VTK::IndependentComponentsOn

// possibly define any "proportional" components
//VTK::vtkProportionalComponents

// Define the blend mode to use
#define vtkBlendMode //VTK::BlendMode

// Possibly define vtkImageLabelOutlineOn
//VTK::ImageLabelOutlineOn

#ifdef vtkImageLabelOutlineOn
uniform int outlineThickness;
uniform float outlineOpacity;
uniform float vpWidth;
uniform float vpHeight;
uniform float vpOffsetX;
uniform float vpOffsetY;
uniform mat4 PCWCMatrix;
uniform mat4 vWCtoIDX;
#endif

// define vtkLightComplexity
//VTK::LightComplexity
#if vtkLightComplexity > 0
uniform float vSpecularPower;
uniform float vAmbient;
uniform float vDiffuse;
uniform float vSpecular;
//VTK::Light::Dec
#endif

//VTK::VolumeShadowOn
//VTK::SurfaceShadowOn
//VTK::localAmbientOcclusionOn
//VTK::LAO::Dec
//VTK::VolumeShadow::Dec

// define vtkComputeNormalFromOpacity
//VTK::vtkComputeNormalFromOpacity

// possibly define vtkGradientOpacityOn
//VTK::GradientOpacityOn
#ifdef vtkGradientOpacityOn
uniform float goscale0;
uniform float goshift0;
uniform float gomin0;
uniform float gomax0;
#if defined(vtkIndependentComponentsOn) && (vtkNumComponents > 1)
uniform float goscale1;
uniform float goshift1;
uniform float gomin1;
uniform float gomax1;
#if vtkNumComponents >= 3
uniform float goscale2;
uniform float goshift2;
uniform float gomin2;
uniform float gomax2;
#endif
#if vtkNumComponents >= 4
uniform float goscale3;
uniform float goshift3;
uniform float gomin3;
uniform float gomax3;
#endif
#endif
#endif

// if you want to see the raw tiled
// data in webgl1 uncomment the following line
// #define debugtile

// camera values
uniform float camThick;
uniform float camNear;
uniform float camFar;
uniform int cameraParallel;

// values describing the volume geometry
uniform vec3 vOriginVC;
uniform vec3 vSpacing;
uniform ivec3 volumeDimensions; // 3d texture dimensions
uniform vec3 vPlaneNormal0;
uniform float vPlaneDistance0;
uniform vec3 vPlaneNormal1;
uniform float vPlaneDistance1;
uniform vec3 vPlaneNormal2;
uniform float vPlaneDistance2;
uniform vec3 vPlaneNormal3;
uniform float vPlaneDistance3;
uniform vec3 vPlaneNormal4;
uniform float vPlaneDistance4;
uniform vec3 vPlaneNormal5;
uniform float vPlaneDistance5;

//VTK::ClipPlane::Dec

// opacity and color textures
uniform sampler2D otexture;
uniform float oshift0;
uniform float oscale0;
uniform sampler2D ctexture;
uniform float cshift0;
uniform float cscale0;

// jitter texture
uniform sampler2D jtexture;

// some 3D texture values
uniform float sampleDistance;
uniform vec3 vVCToIJK;

// the heights defined below are the locations
// for the up to four components of the tfuns
// the tfuns have a height of 2XnumComps pixels so the
// values are computed to hit the middle of the two rows
// for that component
#ifdef vtkIndependentComponentsOn
#if vtkNumComponents == 2
uniform float mix0;
uniform float mix1;
#define height0 0.25
#define height1 0.75
#endif
#if vtkNumComponents == 3
uniform float mix0;
uniform float mix1;
uniform float mix2;
#define height0 0.17
#define height1 0.5
#define height2 0.83
#endif
#if vtkNumComponents == 4
uniform float mix0;
uniform float mix1;
uniform float mix2;
uniform float mix3;
#define height0 0.125
#define height1 0.375
#define height2 0.625
#define height3 0.875
#endif
#endif

#if vtkNumComponents >= 2
uniform float oshift1;
uniform float oscale1;
uniform float cshift1;
uniform float cscale1;
#endif
#if vtkNumComponents >= 3
uniform float oshift2;
uniform float oscale2;
uniform float cshift2;
uniform float cscale2;
#endif
#if vtkNumComponents >= 4
uniform float oshift3;
uniform float oscale3;
uniform float cshift3;
uniform float cscale3;
#endif

uniform vec4 ipScalarRangeMin;
uniform vec4 ipScalarRangeMax;

// declaration for intermixed geometry
//VTK::ZBuffer::Dec

//=======================================================================
// global and custom variables (a temporary section before photorealistics rendering module is complete)
vec3 rayDirVC;
float sampleDistanceISVS;
float sampleDistanceIS;

#define SQRT3    1.7321
#define INV4PI   0.0796
#define EPSILON  0.001
#define PI       3.1415
#define PI2      9.8696

//=======================================================================
// Webgl2 specific version of functions
#if __VERSION__ == 300

uniform highp sampler3D texture1;

vec4 getTextureValue(vec3 pos)
{
  vec4 tmp = texture(texture1, pos);
#if vtkNumComponents == 1
  tmp.a = tmp.r;
#endif
#if vtkNumComponents == 2
  tmp.a = tmp.g;
#endif
#if vtkNumComponents == 3
  tmp.a = length(tmp.rgb);
#endif
  return tmp;
}

//=======================================================================
// WebGL1 specific version of functions
#else

uniform sampler2D texture1;

uniform float texWidth;
uniform float texHeight;
uniform int xreps;
uniform int xstride;
uniform int ystride;

// if computing trilinear values from multiple z slices
#ifdef vtkTrilinearOn
vec4 getTextureValue(vec3 ijk)
{
  float zoff = 1.0/float(volumeDimensions.z);
  vec4 val1 = getOneTextureValue(ijk);
  vec4 val2 = getOneTextureValue(vec3(ijk.xy, ijk.z + zoff));

  float indexZ = float(volumeDimensions)*ijk.z;
  float zmix =  indexZ - floor(indexZ);

  return mix(val1, val2, zmix);
}

vec4 getOneTextureValue(vec3 ijk)
#else // nearest or fast linear
vec4 getTextureValue(vec3 ijk)
#endif
{
  vec3 tdims = vec3(volumeDimensions);

#ifdef debugtile
  vec2 tpos = vec2(ijk.x, ijk.y);
  vec4 tmp = texture2D(texture1, tpos);
  tmp.a = 1.0;

#else
  int z = int(ijk.z * tdims.z);
  int yz = z / xreps;
  int xz = z - yz*xreps;

  int tileWidth = volumeDimensions.x/xstride;
  int tileHeight = volumeDimensions.y/ystride;

  xz *= tileWidth;
  yz *= tileHeight;

  float ni = float(xz) + (ijk.x*float(tileWidth));
  float nj = float(yz) + (ijk.y*float(tileHeight));

  vec2 tpos = vec2(ni/texWidth, nj/texHeight);

  vec4 tmp = texture2D(texture1, tpos);

#if vtkNumComponents == 1
  tmp.a = tmp.r;
#endif
#if vtkNumComponents == 2
  tmp.g = tmp.a;
#endif
#if vtkNumComponents == 3
  tmp.a = length(tmp.rgb);
#endif
#endif

  return tmp;
}

// End of Webgl1 specific code
//=======================================================================
#endif

//=======================================================================
// transformation between VC and IS space

// convert vector position from idx to vc
#if vtkLightComplexity > 0
vec3 IStoVC(vec3 posIS){
  vec3 posVC = posIS / vVCToIJK;
  return posVC.x * vPlaneNormal0 +
         posVC.y * vPlaneNormal2 +
         posVC.z * vPlaneNormal4 +
         vOriginVC;
}

// convert vector position from vc to idx
vec3 VCtoIS(vec3 posVC){
  posVC = posVC - vOriginVC;
  posVC = vec3(
    dot(posVC, vPlaneNormal0),
    dot(posVC, vPlaneNormal2),
    dot(posVC, vPlaneNormal4));
  return posVC * vVCToIJK;
}
#endif

//Rotate vector to view coordinate
#if (vtkLightComplexity > 0) || (defined vtkGradientOpacityOn)
void rotateToViewCoord(inout vec3 dirIS){
  dirIS.xyz =
    dirIS.x * vPlaneNormal0 +
    dirIS.y * vPlaneNormal2 +
    dirIS.z * vPlaneNormal4;
}

//Rotate vector to idx coordinate
vec3 rotateToIDX(vec3 dirVC){
  vec3 dirIS;
  dirIS.xyz = vec3(
    dot(dirVC, vPlaneNormal0),
    dot(dirVC, vPlaneNormal2),
    dot(dirVC, vPlaneNormal4));
  return dirIS;
}
#endif

//=======================================================================
// Given a normal compute the gradient opacity factors
float computeGradientOpacityFactor(
  float normalMag, float goscale, float goshift, float gomin, float gomax)
{
#if defined(vtkGradientOpacityOn)
  return clamp(normalMag * goscale + goshift, gomin, gomax);
#else
  return 1.0;
#endif
}

//=======================================================================
// compute the normal and gradient magnitude for a position, uses forward difference
#if (vtkLightComplexity > 0) || (defined vtkGradientOpacityOn)
#ifdef vtkClippingPlanesOn
  void adjustClippedVoxelValues(vec3 pos, vec3 texPos[3], inout vec3 g1)
  {
    vec3 g1VC[3];
    for (int i = 0; i < 3; ++i)
    {
      g1VC[i] = IStoVC(texPos[i]);
    }
    vec3 posVC = IStoVC(pos);
    for (int i = 0; i < clip_numPlanes; ++i)
    {
      for (int j = 0; j < 3; ++j)
      {
        if(dot(vec3(vClipPlaneOrigins[i] - g1VC[j].xyz), vClipPlaneNormals[i]) > 0.0)
        {
          g1[j] = 0.0;
        }
      }
    }
  }
#endif

  #ifdef vtkComputeNormalFromOpacity
    #ifdef vtkGradientOpacityOn
      vec4 computeDensityNormal(float gradientMag, vec3 scalarInterp[2])
      {
    #else
      //if gradient opacity not on but using density gradient
      vec4 computeDensityNormal(vec3 scalarInterp[2])
      {
    #endif
        vec3 opacityG1, opacityG2;
        opacityG1.x = texture2D(otexture, vec2(scalarInterp[0].x * oscale0 + oshift0, 0.5)).r;
        opacityG1.y = texture2D(otexture, vec2(scalarInterp[0].y * oscale0 + oshift0, 0.5)).r;
        opacityG1.z = texture2D(otexture, vec2(scalarInterp[0].z * oscale0 + oshift0, 0.5)).r;
        opacityG2.x = texture2D(otexture, vec2(scalarInterp[1].x * oscale0 + oshift0, 0.5)).r;
        opacityG2.y = texture2D(otexture, vec2(scalarInterp[1].y * oscale0 + oshift0, 0.5)).r;
        opacityG2.z = texture2D(otexture, vec2(scalarInterp[1].z * oscale0 + oshift0, 0.5)).r;
    #ifdef vtkGradientOpacityOn
        float gradOpacityFactor = 1.0f;
        if (gradientMag >= 0.0){
          gradOpacityFactor = computeGradientOpacityFactor(gradientMag, goscale0, goshift0, gomin0, gomax0);
        }
        opacityG1.xyz *= gradOpacityFactor;
        opacityG2.xyz *= gradOpacityFactor;
    #endif

        vec4 opacityG = vec4(opacityG1 - opacityG2, 1.0f);
        // divide by spacing
        opacityG.xyz /= vSpacing;
        opacityG.w = length(opacityG.xyz);
        // rotate to View Coords
        rotateToViewCoord(opacityG.xyz);
        if (length(opacityG.xyz) > 0.0) {
          return vec4(normalize(opacityG.xyz),opacityG.w);
        } else {
          return vec4(0.0);
        }
      }

      vec4 computeNormalForDensity(vec3 pos, vec3 tstep, out vec3 scalarInterp[2])
      {
        vec3 xvec = vec3(tstep.x, 0.0, 0.0);
        vec3 yvec = vec3(0.0, tstep.y, 0.0);
        vec3 zvec = vec3(0.0, 0.0, tstep.z);
        vec3 texPosPVec[3];
        texPosPVec[0] = pos + xvec;
        texPosPVec[1] = pos + yvec;
        texPosPVec[2] = pos + zvec;
        vec3 texPosNVec[3];
        texPosNVec[0] = pos - xvec;
        texPosNVec[1] = pos - yvec;
        texPosNVec[2] = pos - zvec;
        vec3 g1, g2;

        scalarInterp[0].x = getTextureValue(texPosPVec[0]).a;
        scalarInterp[0].y = getTextureValue(texPosPVec[1]).a;
        scalarInterp[0].z = getTextureValue(texPosPVec[2]).a;
        scalarInterp[1].x = getTextureValue(texPosNVec[0]).a;
        scalarInterp[1].y = getTextureValue(texPosNVec[1]).a;
        scalarInterp[1].z = getTextureValue(texPosNVec[2]).a;

        #ifdef vtkClippingPlanesOn
          adjustClippedVoxelValues(pos, texPosPVec, scalarInterp[0]);
          adjustClippedVoxelValues(pos, texPosNVec, scalarInterp[1]);
        #endif
        vec4 result;
        result.x = scalarInterp[0].x - scalarInterp[1].x;
        result.y = scalarInterp[0].y - scalarInterp[1].y;
        result.z = scalarInterp[0].z - scalarInterp[1].z;
        // divide by spacing
        result.xyz /= vSpacing;
        result.w = length(result.xyz);
        // rotate to View Coords
        rotateToViewCoord(result.xyz);
        if (length(result.xyz) > 0.0) {
          return vec4(normalize(result.xyz),result.w);
        } else {
          return vec4(0.0);
        }
      }
  #endif

  vec4 computeNormal(vec3 pos, vec3 tstep)
  {
    vec3 xvec = vec3(tstep.x, 0.0, 0.0);
    vec3 yvec = vec3(0.0, tstep.y, 0.0);
    vec3 zvec = vec3(0.0, 0.0, tstep.z);
    vec3 texPosPVec[3];
    texPosPVec[0] = pos + xvec;
    texPosPVec[1] = pos + yvec;
    texPosPVec[2] = pos + zvec;
    vec3 texPosNVec[3];
    texPosNVec[0] = pos - xvec;
    texPosNVec[1] = pos - yvec;
    texPosNVec[2] = pos - zvec;
    vec3 g1, g2;
    g1.x = getTextureValue(texPosPVec[0]).a;
    g1.y = getTextureValue(texPosPVec[1]).a;
    g1.z = getTextureValue(texPosPVec[2]).a;
    g2.x = getTextureValue(texPosNVec[0]).a;
    g2.y = getTextureValue(texPosNVec[1]).a;
    g2.z = getTextureValue(texPosNVec[2]).a;
    #ifdef vtkClippingPlanesOn
      adjustClippedVoxelValues(pos, texPosPVec, g1);
      adjustClippedVoxelValues(pos, texPosNVec, g2);
    #endif
    vec4 result;
    result = vec4(g1 - g2, -1.0);
    // divide by spacing
    result.xyz /= vSpacing;
    result.w = length(result.xyz);
    if (result.w > 0.0){
      // rotate to View Coords
      rotateToViewCoord(result.xyz);
      return vec4(normalize(result.xyz),result.w);
    } else {
      return vec4(0.0);
    }
  }
#endif

#ifdef vtkImageLabelOutlineOn
vec3 fragCoordToIndexSpace(vec4 fragCoord) {
  vec4 pcPos = vec4(
    (fragCoord.x / vpWidth - vpOffsetX - 0.5) * 2.0,
    (fragCoord.y / vpHeight - vpOffsetY - 0.5) * 2.0,
    (fragCoord.z - 0.5) * 2.0,
    1.0);

  vec4 worldCoord = PCWCMatrix * pcPos;
  vec4 vertex = (worldCoord/worldCoord.w);

  vec3 index = (vWCtoIDX * vertex).xyz;

  // half voxel fix for labelmapOutline
  return (index + vec3(0.5)) / vec3(volumeDimensions);
}
#endif

//=======================================================================
// compute the normals and gradient magnitudes for a position
// for independent components
mat4 computeMat4Normal(vec3 pos, vec4 tValue, vec3 tstep)
{
  mat4 result;
  vec4 distX = getTextureValue(pos + vec3(tstep.x, 0.0, 0.0)) - tValue;
  vec4 distY = getTextureValue(pos + vec3(0.0, tstep.y, 0.0)) - tValue;
  vec4 distZ = getTextureValue(pos + vec3(0.0, 0.0, tstep.z)) - tValue;

  // divide by spacing
  distX /= vSpacing.x;
  distY /= vSpacing.y;
  distZ /= vSpacing.z;

  mat3 rot;
  rot[0] = vPlaneNormal0;
  rot[1] = vPlaneNormal2;
  rot[2] = vPlaneNormal4;

#if !defined(vtkComponent0Proportional)
  result[0].xyz = vec3(distX.r, distY.r, distZ.r);
  result[0].a = length(result[0].xyz);
  result[0].xyz *= rot;
  if (result[0].w > 0.0)
  {
    result[0].xyz /= result[0].w;
  }
#endif

// optionally compute the 2nd component
#if vtkNumComponents >= 2 && !defined(vtkComponent1Proportional)
  result[1].xyz = vec3(distX.g, distY.g, distZ.g);
  result[1].a = length(result[1].xyz);
  result[1].xyz *= rot;
  if (result[1].w > 0.0)
  {
    result[1].xyz /= result[1].w;
  }
#endif

// optionally compute the 3rd component
#if vtkNumComponents >= 3 && !defined(vtkComponent2Proportional)
  result[2].xyz = vec3(distX.b, distY.b, distZ.b);
  result[2].a = length(result[2].xyz);
  result[2].xyz *= rot;
  if (result[2].w > 0.0)
  {
    result[2].xyz /= result[2].w;
  }
#endif

// optionally compute the 4th component
#if vtkNumComponents >= 4 && !defined(vtkComponent3Proportional)
  result[3].xyz = vec3(distX.a, distY.a, distZ.a);
  result[3].a = length(result[3].xyz);
  result[3].xyz *= rot;
  if (result[3].w > 0.0)
  {
    result[3].xyz /= result[3].w;
  }
#endif

  return result;
}

//=======================================================================
// global shadow - secondary ray
#if defined(VolumeShadowOn) || defined(localAmbientOcclusionOn)
float random()
{
  float rand = fract(sin(dot(gl_FragCoord.xy,vec2(12.9898,78.233)))*43758.5453123);
  float jitter=texture2D(jtexture,gl_FragCoord.xy/32.).r;
  uint pcg_state = floatBitsToUint(jitter);
  uint state = pcg_state;
  pcg_state = pcg_state * uint(747796405) + uint(2891336453);
  uint word = ((state >> ((state >> uint(28)) + uint(4))) ^ state) * uint(277803737);
  return (float((((word >> uint(22)) ^ word) >> 1 ))/float(2147483647) + rand)/2.0;
}
#endif

#ifdef VolumeShadowOn
// henyey greenstein phase function
float phase_function(float cos_angle)
{
  // divide by 2.0 instead of 4pi to increase intensity
  return ((1.0-anisotropy2)/pow(1.0+anisotropy2-2.0*anisotropy*cos_angle, 1.5))/2.0;
}

// Computes the intersection between a ray and a box
struct Hit
{
  float tmin;
  float tmax;
};

struct Ray
{
  vec3 origin;
  vec3 dir;
  vec3 invDir;
};

bool BBoxIntersect(vec3 boundMin, vec3 boundMax, const Ray r, out Hit hit)
{
  vec3 tbot = r.invDir * (boundMin - r.origin);
  vec3 ttop = r.invDir * (boundMax - r.origin);
  vec3 tmin = min(ttop, tbot);
  vec3 tmax = max(ttop, tbot);
  vec2 t = max(tmin.xx, tmin.yz);
  float t0 = max(t.x, t.y);
  t = min(tmax.xx, tmax.yz);
  float t1 = min(t.x, t.y);
  hit.tmin = t0;
  hit.tmax = t1;
  return t1 > max(t0,0.0);
}

// As BBoxIntersect requires the inverse of the ray coords,
// this function is used to avoid numerical issues
void safe_0_vector(inout Ray ray)
{
  if(abs(ray.dir.x) < EPSILON) ray.dir.x = sign(ray.dir.x) * EPSILON;
  if(abs(ray.dir.y) < EPSILON) ray.dir.y = sign(ray.dir.y) * EPSILON;
  if(abs(ray.dir.z) < EPSILON) ray.dir.z = sign(ray.dir.z) * EPSILON;
}

float volume_shadow(vec3 posIS, vec3 lightDirNormIS)
{
  float shadow = 1.0;
  float opacity = 0.0;

  // modify sample distance with a random number between 1.5 and 3.0
  float sampleDistanceISVS_jitter = sampleDistanceISVS * mix(1.5, 3.0, random());
  float opacityPrev = texture2D(otexture, vec2(getTextureValue(posIS).r * oscale0 + oshift0, 0.5)).r;

  // in case the first sample near surface has a very tiled light ray, we need to offset start position
  posIS += sampleDistanceISVS_jitter * lightDirNormIS;

  // compute the start and end points for the ray
  Ray ray;
  Hit hit;
  ray.origin = posIS;
  ray.dir = lightDirNormIS;
  safe_0_vector(ray);
  ray.invDir = 1.0/ray.dir;

  if(!BBoxIntersect(vec3(0.0),vec3(1.0), ray, hit))
  {
    return 1.0;
  }
  float maxdist = hit.tmax;

  // interpolate shadow ray length between: 1 unit of sample distance in IS to SQRT3, based on globalIlluminationReach
  float maxgi = mix(sampleDistanceISVS_jitter,SQRT3,giReach);
  maxdist = min(maxdist,maxgi);
  if(maxdist < EPSILON) {
    return 1.0;
  }

  // support gradient opacity
  #ifdef vtkGradientOpacityOn
    vec4 normal;
  #endif

  float current_dist = 0.0;
  float current_step = length(sampleDistanceISVS_jitter * lightDirNormIS);
  float clamped_step = 0.0;

  vec4 scalar = vec4(0.0);
  while(current_dist < maxdist)
  {
#ifdef vtkClippingPlanesOn
    vec3 posVC = IStoVC(posIS);
    for (int i = 0; i < clip_numPlanes; ++i)
    {
      if (dot(vec3(vClipPlaneOrigins[i] - posVC), vClipPlaneNormals[i]) > 0.0)
      {
        current_dist = maxdist;
      }
    }
#endif
    scalar = getTextureValue(posIS);
    opacity = texture2D(otexture, vec2(scalar.r * oscale0 + oshift0, 0.5)).r;
    #ifdef vtkGradientOpacityOn
      normal = computeNormal(posIS, vec3(1.0/vec3(volumeDimensions)));
      opacity *= computeGradientOpacityFactor(normal.w, goscale0, goshift0, gomin0, gomax0);
    #endif
    shadow *= 1.0 - opacity;

    // optimization: early termination
    if (shadow < EPSILON){
      return 0.0;
    }

    clamped_step = min(maxdist - current_dist, current_step);
    posIS += clamped_step * lightDirNormIS;
    current_dist += current_step;
  }

  return shadow;
}

vec3 applyShadowRay(vec3 tColor, vec3 posIS, vec3 viewDirectionVC)
{
  vec3 vertLight = vec3(0.0);
  vec3 secondary_contrib = vec3(0.0);
  // here we assume only positional light, no effect of cones
  for (int i = 0; i < lightNum; i++)
  {
    #if(vtkLightComplexity==3)
      if (lightPositional[i] == 1){
        vertLight = lightPositionVC[i] - IStoVC(posIS);
      }else{
        vertLight = - lightDirectionVC[i];
      }
    #else
      vertLight = - lightDirectionVC[i];
    #endif
    // here we assume achromatic light, only intensity
    float dDotL = dot(viewDirectionVC, normalize(vertLight));
    // isotropic scatter returns 0.5 instead of 1/4pi to increase intensity
    float phase_attenuation = 0.5;
    if (abs(anisotropy) > EPSILON){
      phase_attenuation = phase_function(dDotL);
    }
    float vol_shadow = volume_shadow(posIS, normalize(rotateToIDX(vertLight)));
    secondary_contrib += tColor * vDiffuse * lightColor[i] * vol_shadow * phase_attenuation;
    secondary_contrib += tColor * vAmbient;
  }
  return secondary_contrib;
}
#endif

//=======================================================================
// local ambient occlusion
#ifdef localAmbientOcclusionOn
vec3 sample_direction_uniform(int i)
{
  float rand = random() * 0.5;
  float theta = PI2 * (kernelSample[i][0] + rand);
  float phi = acos(2.0 * (kernelSample[i][1] + rand) -1.0) / 2.5;
  return normalize(vec3(cos(theta)*sin(phi), sin(theta)*sin(phi), cos(phi)));
}

// return a matrix that transform startDir into z axis; startDir should be normalized
mat3 zBaseRotationalMatrix(vec3 startDir){
  vec3 axis = cross(startDir, vec3(0.0,0.0,1.0));
  float cosA = startDir.z;
  float k = 1.0 / (1.0 + cosA);
  mat3 matrix = mat3((axis.x * axis.x * k) + cosA, (axis.y * axis.x * k) - axis.z, (axis.z * axis.x * k) + axis.y,
              (axis.x * axis.y * k) + axis.z, (axis.y * axis.y * k) + cosA, (axis.z * axis.y * k) - axis.x,
              (axis.x * axis.z * k) - axis.y, (axis.y * axis.z * k) + axis.x, (axis.z * axis.z * k) + cosA);
  return matrix;
}

float computeLAO(vec3 posIS, float op, vec3 lightDir, vec4 normal){
  // apply LAO only at selected locations, otherwise return full brightness
  if (normal.w > 0.0 && op > 0.05){
    float total_transmittance = 0.0;
    mat3 inverseRotateBasis = inverse(zBaseRotationalMatrix(normalize(-normal.xyz)));
    vec3 currPos, randomDirStep;
    float weight, transmittance, opacity;
    for (int i = 0; i < kernelSize; i++)
    {
      randomDirStep = inverseRotateBasis * sample_direction_uniform(i) * sampleDistanceIS;
      weight = 1.0 - dot(normalize(lightDir), normalize(randomDirStep));
      currPos = posIS;
      transmittance = 1.0;
      for (int j = 0; j < kernelRadius ; j++){
        currPos += randomDirStep;
        // check if it's at clipping plane, if so return full brightness
        if (all(greaterThan(currPos, vec3(EPSILON))) && all(lessThan(currPos,vec3(1.0-EPSILON)))){
          opacity = texture2D(otexture, vec2(getTextureValue(currPos).r * oscale0 + oshift0, 0.5)).r;
          #ifdef vtkGradientOpacityOn
             opacity *= computeGradientOpacityFactor(normal.w, goscale0, goshift0, gomin0, gomax0);
          #endif
          transmittance *= 1.0 - opacity;
        }
        else{
          break;
        }
      }
      total_transmittance += transmittance / float(kernelRadius) * weight;

      // early termination if fully translucent
      if (total_transmittance > 1.0 - EPSILON){
        return 1.0;
      }
    }
    // average transmittance and reduce variance
    return clamp(total_transmittance / float(kernelSize), 0.3, 1.0);
  } else {
    return 1.0;
  }
}
#endif

//=======================================================================
// surface light contribution
#if vtkLightComplexity > 0
  void applyLighting(inout vec3 tColor, vec4 normal)
  {
    vec3 diffuse = vec3(0.0, 0.0, 0.0);
    vec3 specular = vec3(0.0, 0.0, 0.0);
    float df, sf = 0.0;
    for (int i = 0; i < lightNum; i++){
        df = abs(dot(normal.rgb, -lightDirectionVC[i]));
        diffuse += df * lightColor[i];
        sf = pow( abs(dot(lightHalfAngleVC[i],normal.rgb)), vSpecularPower);
        specular += sf * lightColor[i];
    }
    tColor.rgb = tColor.rgb*(diffuse*vDiffuse + vAmbient) + specular*vSpecular;
  }
  #ifdef SurfaceShadowOn
  #if vtkLightComplexity < 3
    vec3 applyLightingDirectional(vec3 posIS, vec4 tColor, vec4 normal)
    {
      // everything in VC
      vec3 diffuse = vec3(0.0);
      vec3 specular = vec3(0.0);
      #ifdef localAmbientOcclusionOn
        vec3 ambient = vec3(0.0);
      #endif
      vec3 vertLightDirection;
      for (int i = 0; i < lightNum; i++){
        float ndotL,vdotR;
        vertLightDirection = lightDirectionVC[i];
        ndotL = dot(normal.xyz, vertLightDirection);
        if (ndotL < 0.0 && twoSidedLighting)
        {
          ndotL = -ndotL;
        }
        if (ndotL > 0.0)
        {
          diffuse += ndotL * lightColor[i];
          //specular
          vdotR = dot(-rayDirVC, normalize(2.0 * ndotL * -normal.xyz + vertLightDirection));
          if (vdotR > 0.0)
          {
            specular += pow(vdotR, vSpecularPower) * lightColor[i];
          }
        }
        #ifdef localAmbientOcclusionOn
            ambient += computeLAO(posIS, tColor.a, vertLightDirection, normal);
        #endif
      }
      #ifdef localAmbientOcclusionOn
        return tColor.rgb * (diffuse * vDiffuse + vAmbient * ambient) + specular*vSpecular;
      #else
        return tColor.rgb * (diffuse * vDiffuse + vAmbient) + specular*vSpecular;
      #endif
    }
  #else
    vec3 applyLightingPositional(vec3 posIS, vec4 tColor, vec4 normal, vec3 posVC)
    {
      // everything in VC
      vec3 diffuse = vec3(0.0);
      vec3 specular = vec3(0.0);
      #ifdef localAmbientOcclusionOn
        vec3 ambient = vec3(0.0);
      #endif
      vec3 vertLightDirection;
      for (int i = 0; i < lightNum; i++){
        float distance,attenuation,ndotL,vdotR;
        vec3 lightDir;
        if (lightPositional[i] == 1){
          lightDir = lightDirectionVC[i];
          vertLightDirection = posVC - lightPositionVC[i];
          distance = length(vertLightDirection);
          vertLightDirection = normalize(vertLightDirection);
          attenuation = 1.0 / (lightAttenuation[i].x
                              + lightAttenuation[i].y * distance
                              + lightAttenuation[i].z * distance * distance);
          // per OpenGL standard cone angle is 90 or less for a spot light
          if (lightConeAngle[i] <= 90.0){
            float coneDot = dot(vertLightDirection, lightDir);
            if (coneDot >= cos(radians(lightConeAngle[i]))){  // if inside cone
              attenuation = attenuation * pow(coneDot, lightExponent[i]);
            }
            else {
              attenuation = 0.0;
            }
          }
          ndotL = dot(normal.xyz, vertLightDirection);
          if (ndotL < 0.0 && twoSidedLighting)
          {
            ndotL = -ndotL;
          }
          if (ndotL > 0.0)
          {
            diffuse += ndotL * attenuation * lightColor[i];
            //specular
            vdotR = dot(-rayDirVC, normalize(2.0 * ndotL * -normal.xyz + vertLightDirection));
            if (vdotR > 0.0)
            {
              specular += pow(vdotR, vSpecularPower) * attenuation * lightColor[i];
            }
          }
          #ifdef localAmbientOcclusionOn
            ambient += computeLAO(posIS, tColor.a, vertLightDirection, normal);
          #endif
        } else {
          vertLightDirection = lightDirectionVC[i];
          ndotL = dot(normal.xyz, vertLightDirection);
          if (ndotL < 0.0 && twoSidedLighting)
          {
            ndotL = -ndotL;
          }
          if (ndotL > 0.0)
          {
            diffuse += ndotL * lightColor[i];
            //specular
            vdotR = dot(-rayDirVC, normalize(2.0 * ndotL * -normal.xyz + vertLightDirection));
            if (vdotR > 0.0)
            {
              specular += pow(vdotR, vSpecularPower) * lightColor[i];
            }
          }
          #ifdef localAmbientOcclusionOn
            ambient += computeLAO(posIS, tColor.a, vertLightDirection, normal);
          #endif
        }
      }
      #ifdef localAmbientOcclusionOn
        return tColor.rgb * (diffuse * vDiffuse + vAmbient * ambient) + specular*vSpecular;
      #else
        return tColor.rgb * (diffuse * vDiffuse + vAmbient) + specular*vSpecular;
      #endif
    }
  #endif
  #endif
#endif

//=======================================================================
// Given a texture value compute the color and opacity
//
vec4 getColorForValue(vec4 tValue, vec3 posIS, vec3 tstep)
{
#ifdef vtkImageLabelOutlineOn
  vec3 centerPosIS = fragCoordToIndexSpace(gl_FragCoord); // pos in texture space
  vec4 centerValue = getTextureValue(centerPosIS);
  bool pixelOnBorder = false;
  vec4 tColor = texture2D(ctexture, vec2(centerValue.r * cscale0 + cshift0, 0.5));

  // Get alpha of segment from opacity function.
  tColor.a = texture2D(otexture, vec2(centerValue.r * oscale0 + oshift0, 0.5)).r;

  // Only perform outline check on fragments rendering voxels that aren't invisible.
  // Saves a bunch of needless checks on the background.
  // TODO define epsilon when building shader?
  if (float(tColor.a) > 0.01) {
    for (int i = -outlineThickness; i <= outlineThickness; i++) {
      for (int j = -outlineThickness; j <= outlineThickness; j++) {
        if (i == 0 || j == 0) {
          continue;
        }

        vec4 neighborPixelCoord = vec4(gl_FragCoord.x + float(i),
          gl_FragCoord.y + float(j),
          gl_FragCoord.z, gl_FragCoord.w);

        vec3 neighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);
        vec4 value = getTextureValue(neighborPosIS);

        // If any of my neighbours are not the same value as I
        // am, this means I am on the border of the segment.
        // We can break the loops
        if (any(notEqual(value, centerValue))) {
          pixelOnBorder = true;
          break;
        }
      }

      if (pixelOnBorder == true) {
        break;
      }
    }

    // If I am on the border, I am displayed at full opacity
    if (pixelOnBorder == true) {
      tColor.a = outlineOpacity;
    }
  }

#else
  // compute the normal and gradient magnitude if needed
  // We compute it as a vec4 if possible otherwise a mat4
  //
  vec4 goFactor = vec4(1.0,1.0,1.0,1.0);

  // compute the normal vectors as needed
  #if (vtkLightComplexity > 0) || defined(vtkGradientOpacityOn)
    #if defined(vtkIndependentComponentsOn) && (vtkNumComponents > 1)
      mat4 normalMat = computeMat4Normal(posIS, tValue, tstep);
      #if !defined(vtkComponent0Proportional)
        vec4 normal0 = normalMat[0];
      #endif
      #if !defined(vtkComponent1Proportional)
        vec4 normal1 = normalMat[1];
      #endif
      #if vtkNumComponents > 2
        #if !defined(vtkComponent2Proportional)
          vec4 normal2 = normalMat[2];
        #endif
        #if vtkNumComponents > 3
          #if !defined(vtkComponent3Proportional)
            vec4 normal3 = normalMat[3];
          #endif
        #endif
      #endif
    #else
      vec4 normalLight;
      #ifdef vtkComputeNormalFromOpacity
        vec3 scalarInterp[2];
        vec4 normal0 = computeNormalForDensity(posIS, tstep, scalarInterp);
        if (length(normal0)>0.0){
          #ifdef vtkGradientOpacityOn
            normalLight = computeDensityNormal(normal0.w, scalarInterp);
          #else
            normalLight = computeDensityNormal(scalarInterp);
          #endif
          if (length(normalLight) == 0.0){
            normalLight = normal0;
          }
        }
      #else
        vec4 normal0 = computeNormal(posIS, tstep);
        normalLight = normal0;
      #endif
    #endif
  #endif

  // compute gradient opacity factors as needed
  #if defined(vtkGradientOpacityOn)
    #if !defined(vtkComponent0Proportional)
      goFactor.x =
        computeGradientOpacityFactor(normal0.a, goscale0, goshift0, gomin0, gomax0);
    #endif
    #if defined(vtkIndependentComponentsOn) && (vtkNumComponents > 1)
      #if !defined(vtkComponent1Proportional)
        goFactor.y =
          computeGradientOpacityFactor(normal1.a, goscale1, goshift1, gomin1, gomax1);
      #endif
      #if vtkNumComponents > 2
        #if !defined(vtkComponent2Proportional)
          goFactor.z =
            computeGradientOpacityFactor(normal2.a, goscale2, goshift2, gomin2, gomax2);
        #endif
        #if vtkNumComponents > 3
          #if !defined(vtkComponent3Proportional)
            goFactor.w =
              computeGradientOpacityFactor(normal3.a, goscale3, goshift3, gomin3, gomax3);
          #endif
        #endif
      #endif
    #endif
  #endif

  // single component is always independent
  #if vtkNumComponents == 1
    vec4 tColor = texture2D(ctexture, vec2(tValue.r * cscale0 + cshift0, 0.5));
    tColor.a = goFactor.x*texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, 0.5)).r;
    if (tColor.a < EPSILON){
      return vec4(0.0);
    }
  #endif

  #if defined(vtkIndependentComponentsOn) && vtkNumComponents >= 2
    vec4 tColor = mix0*texture2D(ctexture, vec2(tValue.r * cscale0 + cshift0, height0));
    #if !defined(vtkComponent0Proportional)
      tColor.a = goFactor.x*mix0*texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, height0)).r;
    #else
      float pwfValue = texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, height0)).r;
      tColor *= pwfValue;
      tColor.a *= mix(pwfValue, 1.0, (1.0 - mix0));
    #endif

    vec3 tColor1 = mix1*texture2D(ctexture, vec2(tValue.g * cscale1 + cshift1, height1)).rgb;
    #if !defined(vtkComponent1Proportional)
      tColor.a += goFactor.y*mix1*texture2D(otexture, vec2(tValue.g * oscale1 + oshift1, height1)).r;
    #else
      float pwfValue = texture2D(otexture, vec2(tValue.g * oscale1 + oshift1, height1)).r;
      tColor1 *= pwfValue;
      tColor.a *= mix(pwfValue, 1.0, (1.0 - mix1));
    #endif

    #if vtkNumComponents >= 3
      vec3 tColor2 = mix2*texture2D(ctexture, vec2(tValue.b * cscale2 + cshift2, height2)).rgb;
      #if !defined(vtkComponent2Proportional)
        tColor.a += goFactor.z*mix2*texture2D(otexture, vec2(tValue.b * oscale2 + oshift2, height2)).r;
      #else
        float pwfValue = texture2D(otexture, vec2(tValue.b * oscale2 + oshift2, height2)).r;
        tColor2 *= pwfValue;
        tColor.a *= mix(pwfValue, 1.0, (1.0 - mix2));
      #endif

      #if vtkNumComponents >= 4
        vec3 tColor3 = mix3*texture2D(ctexture, vec2(tValue.a * cscale3 + cshift3, height3)).rgb;
        #if !defined(vtkComponent3Proportional)
          tColor.a += goFactor.w*mix3*texture2D(otexture, vec2(tValue.a * oscale3 + oshift3, height3)).r;
        #else
          float pwfValue = texture2D(otexture, vec2(tValue.a * oscale3 + oshift3, height3)).r;
          tColor3 *= pwfValue;
          tColor.a *= mix(pwfValue, 1.0, (1.0 - mix3));
        #endif
      #endif
    #endif
  #else // then not independent

  #if vtkNumComponents == 2
    float lum = tValue.r * cscale0 + cshift0;
    float alpha = goFactor.x*texture2D(otexture, vec2(tValue.a * oscale1 + oshift1, 0.5)).r;
    vec4 tColor = vec4(lum, lum, lum, alpha);
  #endif
  #if vtkNumComponents == 3
    vec4 tColor;
    tColor.r = tValue.r * cscale0 + cshift0;
    tColor.g = tValue.g * cscale1 + cshift1;
    tColor.b = tValue.b * cscale2 + cshift2;
    tColor.a = goFactor.x*texture2D(otexture, vec2(tValue.a * oscale0 + oshift0, 0.5)).r;
  #endif
  #if vtkNumComponents == 4
    vec4 tColor;
    tColor.r = tValue.r * cscale0 + cshift0;
    tColor.g = tValue.g * cscale1 + cshift1;
    tColor.b = tValue.b * cscale2 + cshift2;
    tColor.a = goFactor.x*texture2D(otexture, vec2(tValue.a * oscale3 + oshift3, 0.5)).r;
  #endif
  #endif // dependent

  // apply lighting if requested as appropriate
  #if vtkLightComplexity > 0
    #if !defined(vtkComponent0Proportional)
      #if vtkNumComponents == 1
        #ifdef SurfaceShadowOn
            #if vtkLightComplexity < 3
                vec3 tColorS = applyLightingDirectional(posIS, tColor, normalLight);
            #else
                vec3 tColorS = applyLightingPositional(posIS, tColor, normalLight, IStoVC(posIS));
            #endif
        #endif

        #ifdef VolumeShadowOn
          vec3 tColorVS = applyShadowRay(tColor.rgb, posIS, rayDirVC);
          #ifdef SurfaceShadowOn
            float vol_coef = volumetricScatteringBlending * (1.0 - tColor.a / 2.0) * (1.0 - atan(normalLight.w) * INV4PI);
            tColor.rgb = (1.0-vol_coef) * tColorS + vol_coef * tColorVS;
          #else
            tColor.rgb = tColorVS;
          #endif
        #else
            tColor.rgb = tColorS;
        #endif

      #else
        applyLighting(tColor.rgb, normal0);
      #endif
    #endif

    #if defined(vtkIndependentComponentsOn) && vtkNumComponents >= 2
      #if !defined(vtkComponent1Proportional)
        applyLighting(tColor1, normal1);
      #endif
    #if vtkNumComponents >= 3
      #if !defined(vtkComponent2Proportional)
        applyLighting(tColor2, normal2);
      #endif
    #if vtkNumComponents >= 4
      #if !defined(vtkComponent3Proportional)
        applyLighting(tColor3, normal3);
      #endif
    #endif
    #endif
    #endif
  #endif

// perform final independent blend as needed
#if defined(vtkIndependentComponentsOn) && vtkNumComponents >= 2
  tColor.rgb += tColor1;
#if vtkNumComponents >= 3
  tColor.rgb += tColor2;
#if vtkNumComponents >= 4
  tColor.rgb += tColor3;
#endif
#endif
#endif

#endif
return tColor;
}

bool valueWithinScalarRange(vec4 val, vec4 min, vec4 max) {
  bool withinRange = false;
  #if vtkNumComponents == 1
    if (val.r >= min.r && val.r <= max.r) {
      withinRange = true;
    }
  #endif
  #if defined(vtkIndependentComponentsOn) && vtkNumComponents == 2
     if (val.r >= min.r && val.r <= max.r &&
        val.g >= min.g && val.g <= max.g) {
      withinRange = true;
    }
  #endif
  #if defined(vtkIndependentComponentsOn) && vtkNumComponents >= 3
    if (all(greaterThanEqual(val, ipScalarRangeMin)) &&
        all(lessThanEqual(val, ipScalarRangeMax))) {
      withinRange = true;
    }
  #endif
  return withinRange;
}

//=======================================================================
// Apply the specified blend mode operation along the ray's path.
//
void applyBlend(vec3 posIS, vec3 endIS, vec3 tdims)
{
  vec3 tstep = 1.0/tdims;

  // start slightly inside and apply some jitter
  vec3 delta = endIS - posIS;
  vec3 stepIS = normalize(delta)*sampleDistanceIS;
  float raySteps = length(delta)/sampleDistanceIS;

  // avoid 0.0 jitter
  float jitter = 0.01 + 0.99*texture2D(jtexture, gl_FragCoord.xy/32.0).r;
  float stepsTraveled = jitter;

  // local vars for the loop
  vec4 color = vec4(0.0, 0.0, 0.0, 0.0);
  vec4 tValue;
  vec4 tColor;

  // if we have less than one step then pick the middle point
  // as our value
  // if (raySteps <= 1.0)
  // {
  //   posIS = (posIS + endIS)*0.5;
  // }

  // Perform initial step at the volume boundary
  // compute the scalar
  tValue = getTextureValue(posIS);

  #if vtkBlendMode == 0 // COMPOSITE_BLEND
    // now map through opacity and color
    tColor = getColorForValue(tValue, posIS, tstep);

    // handle very thin volumes
    if (raySteps <= 1.0)
    {
      tColor.a = 1.0 - pow(1.0 - tColor.a, raySteps);
      gl_FragData[0] = tColor;
      return;
    }

    tColor.a = 1.0 - pow(1.0 - tColor.a, jitter);
    color = vec4(tColor.rgb*tColor.a, tColor.a);
    posIS += (jitter*stepIS);

    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar
      tValue = getTextureValue(posIS);

      // now map through opacity and color
      tColor = getColorForValue(tValue, posIS, tstep);

      float mix = (1.0 - color.a);

      // this line should not be needed but nvidia seems to not handle
      // the break correctly on windows/chrome 58 angle
      //mix = mix * sign(max(raySteps - stepsTraveled - 1.0, 0.0));

      color = color + vec4(tColor.rgb*tColor.a, tColor.a)*mix;
      stepsTraveled++;
      posIS += stepIS;
      if (color.a > 0.99) { color.a = 1.0; break; }
    }

    if (color.a < 0.99 && (raySteps - stepsTraveled) > 0.0)
    {
      posIS = endIS;

      // compute the scalar
      tValue = getTextureValue(posIS);

      // now map through opacity and color
      tColor = getColorForValue(tValue, posIS, tstep);
      tColor.a = 1.0 - pow(1.0 - tColor.a, raySteps - stepsTraveled);

      float mix = (1.0 - color.a);
      color = color + vec4(tColor.rgb*tColor.a, tColor.a)*mix;
    }

    gl_FragData[0] = vec4(color.rgb/color.a, color.a);
  #endif
  #if vtkBlendMode == 1 || vtkBlendMode == 2
    // MAXIMUM_INTENSITY_BLEND || MINIMUM_INTENSITY_BLEND
    // Find maximum/minimum intensity along the ray.

    // Define the operation we will use (min or max)
    #if vtkBlendMode == 1
    #define OP max
    #else
    #define OP min
    #endif

    // If the clipping range is shorter than the sample distance
    // we can skip the sampling loop along the ray.
    if (raySteps <= 1.0)
    {
      gl_FragData[0] = getColorForValue(tValue, posIS, tstep);
      return;
    }

    vec4 value = tValue;
    posIS += (jitter*stepIS);

    // Sample along the ray until MaximumSamplesValue,
    // ending slightly inside the total distance
    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar
      tValue = getTextureValue(posIS);

      // Update the maximum value if necessary
      value = OP(tValue, value);

      // Otherwise, continue along the ray
      stepsTraveled++;
      posIS += stepIS;
    }

    // Perform the last step along the ray using the
    // residual distance
    posIS = endIS;
    tValue = getTextureValue(posIS);
    value = OP(tValue, value);

    // Now map through opacity and color
    gl_FragData[0] = getColorForValue(value, posIS, tstep);
  #endif
  #if vtkBlendMode == 3 || vtkBlendMode == 4 //AVERAGE_INTENSITY_BLEND || ADDITIVE_BLEND
    vec4 sum = vec4(0.);

    if (valueWithinScalarRange(tValue, ipScalarRangeMin, ipScalarRangeMax)) {
      sum += tValue;
    }

    if (raySteps <= 1.0) {
      gl_FragData[0] = getColorForValue(sum, posIS, tstep);
      return;
    }

    posIS += (jitter*stepIS);

    // Sample along the ray until MaximumSamplesValue,
    // ending slightly inside the total distance
    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar
      tValue = getTextureValue(posIS);

      // One can control the scalar range by setting the AverageIPScalarRange to disregard scalar values, not in the range of interest, from the average computation.
      // Notes:
      // - We are comparing all values in the texture to see if any of them
      //   are outside of the scalar range. In the future we might want to allow
      //   scalar ranges for each component.
      if (valueWithinScalarRange(tValue, ipScalarRangeMin, ipScalarRangeMax)) {
        // Sum the values across each step in the path
        sum += tValue;
      }
      stepsTraveled++;
      posIS += stepIS;
    }

    // Perform the last step along the ray using the
    // residual distance
    posIS = endIS;

    // compute the scalar
    tValue = getTextureValue(posIS);

    // One can control the scalar range by setting the IPScalarRange to disregard scalar values, not in the range of interest, from the average computation
    if (valueWithinScalarRange(tValue, ipScalarRangeMin, ipScalarRangeMax)) {
      sum += tValue;

      stepsTraveled++;
    }

    #if vtkBlendMode == 3 // Average
      sum /= vec4(stepsTraveled, stepsTraveled, stepsTraveled, 1.0);
    #endif

    gl_FragData[0] = getColorForValue(sum, posIS, tstep);
  #endif
  #if vtkBlendMode == 5 // RADON
    float normalizedRayIntensity = 1.0;

    // handle very thin volumes
    if (raySteps <= 1.0)
    {
      tValue = getTextureValue(posIS);
      normalizedRayIntensity = normalizedRayIntensity - sampleDistance*texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, 0.5)).r;
      gl_FragData[0] = texture2D(ctexture, vec2(normalizedRayIntensity, 0.5));
      return;
    }

    posIS += (jitter*stepIS);

    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar value
      tValue = getTextureValue(posIS);

      // Convert scalar value to normalizedRayIntensity coefficient and accumulate normalizedRayIntensity
      normalizedRayIntensity = normalizedRayIntensity - sampleDistance*texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, 0.5)).r;

      posIS += stepIS;
      stepsTraveled++;
    }

    // map normalizedRayIntensity to color
    gl_FragData[0] = texture2D(ctexture, vec2(normalizedRayIntensity , 0.5));

  #endif
}

//=======================================================================
// Compute a new start and end point for a given ray based
// on the provided bounded clipping plane (aka a rectangle)
void getRayPointIntersectionBounds(
  vec3 rayPos, vec3 rayDir,
  vec3 planeDir, float planeDist,
  inout vec2 tbounds, vec3 vPlaneX, vec3 vPlaneY,
  float vSize1, float vSize2)
{
  float result = dot(rayDir, planeDir);
  if (abs(result) < 1e-6)
  {
    return;
  }
  result = -1.0 * (dot(rayPos, planeDir) + planeDist) / result;
  vec3 xposVC = rayPos + rayDir*result;
  vec3 vxpos = xposVC - vOriginVC;
  vec2 vpos = vec2(
    dot(vxpos, vPlaneX),
    dot(vxpos, vPlaneY));

  // on some apple nvidia systems this does not work
  // if (vpos.x < 0.0 || vpos.x > vSize1 ||
  //     vpos.y < 0.0 || vpos.y > vSize2)
  // even just
  // if (vpos.x < 0.0 || vpos.y < 0.0)
  // fails
  // so instead we compute a value that represents in and out
  //and then compute the return using this value
  float xcheck = max(0.0, vpos.x * (vpos.x - vSize1)); //  0 means in bounds
  float check = sign(max(xcheck, vpos.y * (vpos.y - vSize2))); //  0 means in bounds, 1 = out

  tbounds = mix(
   vec2(min(tbounds.x, result), max(tbounds.y, result)), // in value
   tbounds, // out value
   check);  // 0 in 1 out
}

//=======================================================================
// given a
// - ray direction (rayDir)
// - starting point (vertexVCVSOutput)
// - bounding planes of the volume
// - optionally depth buffer values
// - far clipping plane
// compute the start/end distances of the ray we need to cast
vec2 computeRayDistances(vec3 rayDir, vec3 tdims)
{
  vec2 dists = vec2(100.0*camFar, -1.0);

  vec3 vSize = vSpacing*tdims;

  // all this is in View Coordinates
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal0, vPlaneDistance0, dists, vPlaneNormal2, vPlaneNormal4,
    vSize.y, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal1, vPlaneDistance1, dists, vPlaneNormal2, vPlaneNormal4,
    vSize.y, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal2, vPlaneDistance2, dists, vPlaneNormal0, vPlaneNormal4,
    vSize.x, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal3, vPlaneDistance3, dists, vPlaneNormal0, vPlaneNormal4,
    vSize.x, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal4, vPlaneDistance4, dists, vPlaneNormal0, vPlaneNormal2,
    vSize.x, vSize.y);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal5, vPlaneDistance5, dists, vPlaneNormal0, vPlaneNormal2,
    vSize.x, vSize.y);

  //VTK::ClipPlane::Impl

  // do not go behind front clipping plane
  dists.x = max(0.0,dists.x);

  // do not go PAST far clipping plane
  float farDist = -camThick/rayDir.z;
  dists.y = min(farDist,dists.y);

  // Do not go past the zbuffer value if set
  // This is used for intermixing opaque geometry
  //VTK::ZBuffer::Impl

  return dists;
}

//=======================================================================
// Compute the index space starting position (pos) and end
// position
//
void computeIndexSpaceValues(out vec3 pos, out vec3 endPos, vec3 rayDir, vec2 dists)
{
  // compute starting and ending values in volume space
  pos = vertexVCVSOutput + dists.x*rayDir;
  pos = pos - vOriginVC;
  // convert to volume basis and origin
  pos = vec3(
    dot(pos, vPlaneNormal0),
    dot(pos, vPlaneNormal2),
    dot(pos, vPlaneNormal4));

  endPos = vertexVCVSOutput + dists.y*rayDir;
  endPos = endPos - vOriginVC;
  endPos = vec3(
    dot(endPos, vPlaneNormal0),
    dot(endPos, vPlaneNormal2),
    dot(endPos, vPlaneNormal4));

  float delta = length(endPos - pos);

  pos *= vVCToIJK;
  endPos *= vVCToIJK;

  float delta2 = length(endPos - pos);
  sampleDistanceIS = sampleDistance*delta2/delta;
  #ifdef VolumeShadowOn
    sampleDistanceISVS = sampleDistanceIS * volumeShadowSamplingDistFactor;
  #endif
}

void main()
{

  if (cameraParallel == 1)
  {
    // Camera is parallel, so the rayDir is just the direction of the camera.
    rayDirVC = vec3(0.0, 0.0, -1.0);
  } else {
    // camera is at 0,0,0 so rayDir for perspective is just the vc coord
    rayDirVC = normalize(vertexVCVSOutput);
  }

  vec3 tdims = vec3(volumeDimensions);

  // compute the start and end points for the ray
  vec2 rayStartEndDistancesVC = computeRayDistances(rayDirVC, tdims);

  // do we need to composite? aka does the ray have any length
  // If not, bail out early
  if (rayStartEndDistancesVC.y <= rayStartEndDistancesVC.x)
  {
    discard;
  }

  // IS = Index Space
  vec3 posIS;
  vec3 endIS;
  computeIndexSpaceValues(posIS, endIS, rayDirVC, rayStartEndDistancesVC);

  // Perform the blending operation along the ray
  applyBlend(posIS, endIS, tdims);
}
`;function ou(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function GS(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?ou(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ou(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var BS=qn,hi=ae;function _S(t,e){if(t.length!==e.length)return!1;for(var r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}function jS(t,e){e.classHierarchy.push("vtkOpenGLVolumeMapper"),t.buildPass=function(){e.zBufferTexture=null},t.zBufferPass=function(r,n){if(r){var a=n.getZBufferTexture();a!==e.zBufferTexture&&(e.zBufferTexture=a)}},t.opaqueZBufferPass=function(r,n){return t.zBufferPass(r,n)},t.volumePass=function(r,n){if(r){e._openGLRenderWindow=t.getFirstAncestorOfType("vtkOpenGLRenderWindow"),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow),e.jitterTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.scalarTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.opacityTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLVolume=t.getFirstAncestorOfType("vtkOpenGLVolume");var a=e.openGLVolume.getRenderable();e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");var i=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(i.getActiveCamera()),t.renderPiece(i,a)}},t.buildShaders=function(r,n,a){t.getShaderTemplate(r,n,a),t.replaceShaderValues(r,n,a)},t.getShaderTemplate=function(r,n,a){r.Vertex=NS,r.Fragment=US,r.Geometry=""},t.replaceShaderValues=function(r,n,a){var i=r.Fragment,o=a.getProperty().getInterpolationType();o===eo.LINEAR&&(i=F.substitute(i,"//VTK::TrilinearOn","#define vtkTrilinearOn").result);var s=a.getProperty().getUseLabelOutline();s===!0&&(i=F.substitute(i,"//VTK::ImageLabelOutlineOn","#define vtkImageLabelOutlineOn").result);var f=e.scalarTexture.getComponents();i=F.substitute(i,"//VTK::NumComponents","#define vtkNumComponents ".concat(f)).result;var c=a.getProperty().getIndependentComponents();if(c){i=F.substitute(i,"//VTK::IndependentComponentsOn","#define vtkIndependentComponentsOn").result;for(var u=[],v=0;v<f;v++)a.getProperty().getOpacityMode(v)===qg.PROPORTIONAL&&u.push("#define vtkComponent".concat(v,"Proportional"));u.length>0&&(i=F.substitute(i,"//VTK::vtkProportionalComponents",u.join(`
`)).result)}var g=e.currentInput.getSpatialExtent(),p=e.currentInput.getSpacing(),l=new Float64Array(3);Te(l,(g[1]-g[0])*p[0],(g[3]-g[2])*p[1],(g[5]-g[4])*p[2]);var h=wr(l)/e.renderable.getSampleDistance();i=F.substitute(i,"//VTK::MaximumSamplesValue","".concat(Math.ceil(h))).result,i=F.substitute(i,"//VTK::LightComplexity","#define vtkLightComplexity ".concat(e.lastLightComplexity)).result,e.lastLightComplexity>0&&(e.renderable.getVolumetricScatteringBlending()>0&&(i=F.substitute(i,"//VTK::VolumeShadowOn","#define VolumeShadowOn").result),e.renderable.getVolumetricScatteringBlending()<1&&(i=F.substitute(i,"//VTK::SurfaceShadowOn","#define SurfaceShadowOn").result),e.renderable.getLocalAmbientOcclusion()&&a.getProperty().getAmbient()>0&&(i=F.substitute(i,"//VTK::localAmbientOcclusionOn","#define localAmbientOcclusionOn").result)),e.gopacity=a.getProperty().getUseGradientOpacity(0);for(var y=1;c&&!e.gopacity&&y<f;++y)a.getProperty().getUseGradientOpacity(y)&&(e.gopacity=!0);e.gopacity&&(i=F.substitute(i,"//VTK::GradientOpacityOn","#define vtkGradientOpacityOn").result),e.renderable.getComputeNormalFromOpacity()&&(i=F.substitute(i,"//VTK::vtkComputeNormalFromOpacity","#define vtkComputeNormalFromOpacity").result),e.zBufferTexture!==null&&(i=F.substitute(i,"//VTK::ZBuffer::Dec",["uniform sampler2D zBufferTexture;","uniform float vpWidth;","uniform float vpHeight;"]).result,i=F.substitute(i,"//VTK::ZBuffer::Impl",["vec4 depthVec = texture2D(zBufferTexture, vec2(gl_FragCoord.x / vpWidth, gl_FragCoord.y/vpHeight));","float zdepth = (depthVec.r*256.0 + depthVec.g)/257.0;","zdepth = zdepth * 2.0 - 1.0;","if (cameraParallel == 0) {","zdepth = -2.0 * camFar * camNear / (zdepth*(camFar-camNear)-(camFar+camNear)) - camNear;}","else {",`zdepth = (zdepth + 1.0) * 0.5 * (camFar - camNear);}
`,"zdepth = -zdepth/rayDir.z;","dists.y = min(zdepth,dists.y);"]).result),i=F.substitute(i,"//VTK::BlendMode","".concat(e.renderable.getBlendMode())).result,r.Fragment=i,t.replaceShaderLight(r,n,a),t.replaceShaderClippingPlane(r,n,a)},t.replaceShaderLight=function(r,n,a){if(e.lastLightComplexity!==0){var i=r.Fragment,o=0;n.getLights().forEach(function(s){s.getSwitch()&&(o+=1)}),i=F.substitute(i,"//VTK::Light::Dec",["uniform int lightNum;","uniform bool twoSidedLighting;","uniform vec3 lightColor[".concat(o,"];"),"uniform vec3 lightDirectionVC[".concat(o,"]; // normalized"),"uniform vec3 lightHalfAngleVC[".concat(o,"];"),"//VTK::Light::Dec"],!1).result,e.lastLightComplexity===3&&(i=F.substitute(i,"//VTK::Light::Dec",["uniform vec3 lightPositionVC[".concat(o,"];"),"uniform vec3 lightAttenuation[".concat(o,"];"),"uniform float lightConeAngle[".concat(o,"];"),"uniform float lightExponent[".concat(o,"];"),"uniform int lightPositional[".concat(o,"];")],!1).result),e.renderable.getVolumetricScatteringBlending()>0&&(i=F.substitute(i,"//VTK::VolumeShadow::Dec",["uniform float volumetricScatteringBlending;","uniform float giReach;","uniform float volumeShadowSamplingDistFactor;","uniform float anisotropy;","uniform float anisotropy2;"],!1).result),e.renderable.getLocalAmbientOcclusion()&&a.getProperty().getAmbient()>0&&(i=F.substitute(i,"//VTK::LAO::Dec",["uniform int kernelRadius;","uniform vec2 kernelSample[".concat(e.renderable.getLAOKernelRadius(),"];"),"uniform int kernelSize;"],!1).result),r.Fragment=i}},t.replaceShaderClippingPlane=function(r,n,a){var i=r.Fragment;if(e.renderable.getClippingPlanes().length>0){var o=e.renderable.getClippingPlanes().length;i=F.substitute(i,"//VTK::ClipPlane::Dec",["uniform vec3 vClipPlaneNormals[6];","uniform float vClipPlaneDistances[6];","uniform vec3 vClipPlaneOrigins[6];","uniform int clip_numPlanes;","//VTK::ClipPlane::Dec","#define vtkClippingPlanesOn"],!1).result,i=F.substitute(i,"//VTK::ClipPlane::Impl",["for(int i = 0; i < ".concat(o,"; i++) {"),"  float rayDirRatio = dot(rayDir, vClipPlaneNormals[i]);","  float equationResult = dot(vertexVCVSOutput, vClipPlaneNormals[i]) + vClipPlaneDistances[i];","  if (rayDirRatio == 0.0)","  {","    if (equationResult < 0.0) dists.x = dists.y;","    continue;","  }","  float result = -1.0 * equationResult / rayDirRatio;","  if (rayDirRatio < 0.0) dists.y = min(dists.y, result);","  else dists.x = max(dists.x, result);","}","//VTK::ClipPlane::Impl"],!1).result}r.Fragment=i},t.getNeedToRebuildShaders=function(r,n,a){var i=0;a.getProperty().getShade()&&e.renderable.getBlendMode()===Jg.COMPOSITE_BLEND&&(i=0,e.numberOfLights=0,n.getLights().forEach(function(C){var S=C.getSwitch();S>0&&(e.numberOfLights++,i===0&&(i=1)),i===1&&(e.numberOfLights>1||C.getIntensity()!==1||!C.lightTypeIsHeadLight())&&(i=2),i<3&&C.getPositional()&&(i=3)}));var o=!1;e.lastLightComplexity!==i&&(e.lastLightComplexity=i,o=!0);var s=e.scalarTexture.getComponents(),f=a.getProperty().getIndependentComponents(),c=!1,u=[];if(f){for(var v=0;v<s;v++)u.push(a.getProperty().getOpacityMode(v));u.length>0&&(c=!0)}var g=e.currentInput.getSpatialExtent(),p=e.currentInput.getSpacing(),l=new Float64Array(3);Te(l,(g[1]-g[0])*p[0],(g[3]-g[2])*p[1],(g[5]-g[4])*p[2]);var h=wr(l)/e.renderable.getSampleDistance(),y={interpolationType:a.getProperty().getInterpolationType(),useLabelOutline:a.getProperty().getUseLabelOutline(),numComp:s,usesProportionalComponents:c,iComps:f,maxSamples:h,useGradientOpacity:a.getProperty().getUseGradientOpacity(0),blendMode:e.renderable.getBlendMode(),proportionalComponents:u};return!e.previousState||e.previousState.interpolationType!==y.interpolationType||e.previousState.useLabelOutline!==y.useLabelOutline||e.previousState.numComp!==y.numComp||e.previousState.usesProportionalComponents!==y.usesProportionalComponents||e.previousState.iComps!==y.iComps||e.previousState.maxSamples!==y.maxSamples||e.previousState.useGradientOpacity!==y.useGradientOpacity||e.previousState.blendMode!==y.blendMode||!_S(e.previousState.proportionalComponents,y.proportionalComponents)?(e.previousState=GS({},y),!0):r.getProgram()===0||o||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||!!e.lastZBufferTexture!=!!e.zBufferTexture||r.getShaderSourceTime().getMTime()<t.getMTime()||r.getShaderSourceTime().getMTime()<e.renderable.getMTime()?(e.lastZBufferTexture=e.zBufferTexture,!0):!1},t.updateShaders=function(r,n,a){if(e.lastBoundBO=r,t.getNeedToRebuildShaders(r,n,a)){var i={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(i,n,a);var o=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(i.Vertex,i.Fragment,i.Geometry);o!==r.getProgram()&&(r.setProgram(o),r.getVAO().releaseGraphicsResources()),r.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(r.getProgram());r.getVAO().bind(),t.setMapperShaderParameters(r,n,a),t.setCameraShaderParameters(r,n,a),t.setPropertyShaderParameters(r,n,a),t.getClippingPlaneShaderParameters(r,n,a)},t.setMapperShaderParameters=function(r,n,a){var i=r.getProgram();r.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())&&(i.isAttributeUsed("vertexDC")&&(r.getVAO().addAttributeArray(i,r.getCABO(),"vertexDC",r.getCABO().getVertexOffset(),r.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||hi("Error setting vertexDC in shader VAO.")),r.getAttributeUpdateTime().modified()),i.setUniformi("texture1",e.scalarTexture.getTextureUnit()),i.setUniformf("sampleDistance",e.renderable.getSampleDistance());for(var o=e.scalarTexture.getVolumeInfo(),s=e.renderable.getIpScalarRange(),f=[],c=[],u=0;u<4;u++)f[u]=s[0]*o.dataComputedScale[u]+o.dataComputedOffset[u],c[u]=s[1]*o.dataComputedScale[u]+o.dataComputedOffset[u],f[u]=(f[u]-o.offset[u])/o.scale[u],c[u]=(c[u]-o.offset[u])/o.scale[u];if(i.setUniform4f("ipScalarRangeMin",f[0],f[1],f[2],f[3]),i.setUniform4f("ipScalarRangeMax",c[0],c[1],c[2],c[3]),e.zBufferTexture!==null){i.setUniformi("zBufferTexture",e.zBufferTexture.getTextureUnit());var v=e._useSmallViewport?[e._smallViewportWidth,e._smallViewportHeight]:e._openGLRenderWindow.getFramebufferSize();i.setUniformf("vpWidth",v[0]),i.setUniformf("vpHeight",v[1])}},t.setCameraShaderParameters=function(r,n,a){var i=e.openGLCamera.getKeyMatrices(n),o=e.openGLVolume.getKeyMatrices();Ee(e.modelToView,i.wcvc,o.mcwc);var s=r.getProgram(),f=e.openGLCamera.getRenderable(),c=f.getClippingRange();s.setUniformf("camThick",c[1]-c[0]),s.setUniformf("camNear",c[0]),s.setUniformf("camFar",c[1]);for(var u=e.currentInput.getBounds(),v=e.currentInput.getDimensions(),g=new Float64Array(3),p=new Float64Array(3),l=1,h=-1,y=1,C=-1,S=0;S<8;++S){if(Te(g,u[S%2],u[2+Math.floor(S/2)%2],u[4+Math.floor(S/4)]),Q(g,g,e.modelToView),!f.getParallelProjection()){It(p,g);var d=-c[0]/g[2];Z0(g,p,d)}Q(g,g,i.vcpc),l=Math.min(g[0],l),h=Math.max(g[0],h),y=Math.min(g[1],y),C=Math.max(g[1],C)}s.setUniformf("dcxmin",l),s.setUniformf("dcxmax",h),s.setUniformf("dcymin",y),s.setUniformf("dcymax",C),s.isUniformUsed("cameraParallel")&&s.setUniformi("cameraParallel",f.getParallelProjection());var O=e.currentInput.getSpatialExtent(),w=e.currentInput.getSpacing(),M=new Float64Array(3);Te(M,(O[1]-O[0])*w[0],(O[3]-O[2])*w[1],(O[5]-O[4])*w[2]),s.setUniform3f("vSpacing",w[0],w[1],w[2]),Te(g,O[0],O[2],O[4]),e.currentInput.indexToWorldVec3(g,g),Q(g,g,e.modelToView),s.setUniform3f("vOriginVC",g[0],g[1],g[2]);var x=e.currentInput.getIndexToWorld();Ee(e.idxToView,e.modelToView,x),Gi(e.idxNormalMatrix,i.normalMatrix,o.normalMatrix),Gi(e.idxNormalMatrix,e.idxNormalMatrix,e.currentInput.getDirectionByReference());var D=wr(M)/e.renderable.getSampleDistance();D>e.renderable.getMaximumSamplesPerRay()&&BS("The number of steps required ".concat(Math.ceil(D),` is larger than the
        specified maximum number of steps `).concat(e.renderable.getMaximumSamplesPerRay(),`.
        Please either change the
        volumeMapper sampleDistance or its maximum number of samples.`));var R=new Float64Array(3);if(Te(R,1,1,1),q0(R,R,M),s.setUniform3f("vVCToIJK",R[0],R[1],R[2]),s.setUniform3i("volumeDimensions",v[0],v[1],v[2]),!e._openGLRenderWindow.getWebgl2()){var V=e.scalarTexture.getVolumeInfo();s.setUniformf("texWidth",e.scalarTexture.getWidth()),s.setUniformf("texHeight",e.scalarTexture.getHeight()),s.setUniformi("xreps",V.xreps),s.setUniformi("xstride",V.xstride),s.setUniformi("ystride",V.ystride)}for(var E=new Float64Array(3),L=new Float64Array(3),m=0;m<6;++m){switch(m){case 1:Te(E,-1,0,0),Te(L,O[0],O[2],O[4]);break;case 2:Te(E,0,1,0),Te(L,O[1],O[3],O[5]);break;case 3:Te(E,0,-1,0),Te(L,O[0],O[2],O[4]);break;case 4:Te(E,0,0,1),Te(L,O[1],O[3],O[5]);break;case 5:Te(E,0,0,-1),Te(L,O[0],O[2],O[4]);break;case 0:default:Te(E,1,0,0),Te(L,O[1],O[3],O[5]);break}ai(E,E,e.idxNormalMatrix),Q(L,L,e.idxToView);var N=-1*kr(L,E);s.setUniform3f("vPlaneNormal".concat(m),E[0],E[1],E[2]),s.setUniformf("vPlaneDistance".concat(m),N)}if(a.getProperty().getUseLabelOutline()){var _=e.currentInput,G=_.getWorldToIndex();s.setUniformMatrix("vWCtoIDX",G);var k=n.getActiveCamera(),U=k.getClippingRange(),B=ne(U,2),j=B[0],H=B[1],X=k.getDistance();k.setClippingRange(X,X+.1);var Y=e.openGLCamera.getKeyMatrices(n);at(e.projectionToWorld,Y.wcpc),k.setClippingRange(j,H),e.openGLCamera.getKeyMatrices(n),s.setUniformMatrix("PCWCMatrix",e.projectionToWorld);var ee=t.getRenderTargetSize();s.setUniformf("vpWidth",ee[0]),s.setUniformf("vpHeight",ee[1]);var ce=t.getRenderTargetOffset();s.setUniformf("vpOffsetX",ce[0]/ee[0]),s.setUniformf("vpOffsetY",ce[1]/ee[1])}if(at(e.projectionToView,i.vcpc),s.setUniformMatrix("PCVCMatrix",e.projectionToView),e.lastLightComplexity!==0){var Z=0,Ce=[],q=[],De=[];if(n.getLights().forEach(function(pe){var Re=pe.getSwitch();if(Re>0){var ye=pe.getColor(),le=pe.getIntensity();Ce[0+Z*3]=ye[0]*le,Ce[1+Z*3]=ye[1]*le,Ce[2+Z*3]=ye[2]*le;var Ke=pe.getDirection();Te(E,Ke[0],Ke[1],Ke[2]),ai(E,E,i.normalMatrix),It(E,E),q[0+Z*3]=E[0],q[1+Z*3]=E[1],q[2+Z*3]=E[2],De[0+Z*3]=-.5*E[0],De[1+Z*3]=-.5*E[1],De[2+Z*3]=-.5*(E[2]-1),Z++}}),s.setUniformi("twoSidedLighting",n.getTwoSidedLighting()),s.setUniformi("lightNum",Z),s.setUniform3fv("lightColor",Ce),s.setUniform3fv("lightDirectionVC",q),s.setUniform3fv("lightHalfAngleVC",De),e.lastLightComplexity===3){Z=0;var K=[],fe=[],te=[],$=[],z=[];n.getLights().forEach(function(pe){var Re=pe.getSwitch();if(Re>0){var ye=pe.getAttenuationValues();fe[0+Z*3]=ye[0],fe[1+Z*3]=ye[1],fe[2+Z*3]=ye[2],$[Z]=pe.getExponent(),te[Z]=pe.getConeAngle(),z[Z]=pe.getPositional();var le=pe.getTransformedPosition();Q(le,le,e.modelToView),K[0+Z*3]=le[0],K[1+Z*3]=le[1],K[2+Z*3]=le[2],Z+=1}}),s.setUniform3fv("lightPositionVC",K),s.setUniform3fv("lightAttenuation",fe),s.setUniformfv("lightConeAngle",te),s.setUniformfv("lightExponent",$),s.setUniformiv("lightPositional",z)}if(e.renderable.getVolumetricScatteringBlending()>0&&(s.setUniformf("giReach",e.renderable.getGlobalIlluminationReach()),s.setUniformf("volumetricScatteringBlending",e.renderable.getVolumetricScatteringBlending()),s.setUniformf("volumeShadowSamplingDistFactor",e.renderable.getVolumeShadowSamplingDistFactor()),s.setUniformf("anisotropy",e.renderable.getAnisotropy()),s.setUniformf("anisotropy2",Math.pow(e.renderable.getAnisotropy(),2))),e.renderable.getLocalAmbientOcclusion()&&a.getProperty().getAmbient()>0){var re=e.renderable.getLAOKernelSize();s.setUniformi("kernelSize",re);for(var P=[],Le=0;Le<re;Le++)P[Le*2]=Math.random()*.5,P[Le*2+1]=Math.random()*.5;s.setUniform2fv("kernelSample",P),s.setUniformi("kernelRadius",e.renderable.getLAOKernelRadius())}}},t.setPropertyShaderParameters=function(r,n,a){var i=r.getProgram();i.setUniformi("ctexture",e.colorTexture.getTextureUnit()),i.setUniformi("otexture",e.opacityTexture.getTextureUnit()),i.setUniformi("jtexture",e.jitterTexture.getTextureUnit());var o=e.scalarTexture.getVolumeInfo(),s=a.getProperty(),f=e.scalarTexture.getComponents(),c=a.getProperty().getIndependentComponents();if(c&&f>=2)for(var u=0;u<f;u++)i.setUniformf("mix".concat(u),a.getProperty().getComponentWeight(u));for(var v=0;v<f;v++){var g=c?v:0,p=o.scale[v],l=s.getScalarOpacity(g),h=l.getRange(),y=p/(h[1]-h[0]),C=(o.offset[v]-h[0])/(h[1]-h[0]);i.setUniformf("oshift".concat(v),C),i.setUniformf("oscale".concat(v),y);var S=s.getRGBTransferFunction(g),d=S.getRange(),O=(o.offset[v]-d[0])/(d[1]-d[0]),w=p/(d[1]-d[0]);i.setUniformf("cshift".concat(v),O),i.setUniformf("cscale".concat(v),w)}if(e.gopacity)if(c)for(var M=0;M<f;++M){var x=o.scale[M],D=s.getUseGradientOpacity(M);if(D){var R=s.getGradientOpacityMinimumOpacity(M),V=s.getGradientOpacityMaximumOpacity(M);i.setUniformf("gomin".concat(M),R),i.setUniformf("gomax".concat(M),V);var E=[s.getGradientOpacityMinimumValue(M),s.getGradientOpacityMaximumValue(M)];i.setUniformf("goscale".concat(M),x*(V-R)/(E[1]-E[0])),i.setUniformf("goshift".concat(M),-E[0]*(V-R)/(E[1]-E[0])+R)}else i.setUniformf("gomin".concat(M),1),i.setUniformf("gomax".concat(M),1),i.setUniformf("goscale".concat(M),0),i.setUniformf("goshift".concat(M),1)}else{var L=o.scale[f-1],m=s.getGradientOpacityMinimumOpacity(0),N=s.getGradientOpacityMaximumOpacity(0);i.setUniformf("gomin0",m),i.setUniformf("gomax0",N);var _=[s.getGradientOpacityMinimumValue(0),s.getGradientOpacityMaximumValue(0)];i.setUniformf("goscale0",L*(N-m)/(_[1]-_[0])),i.setUniformf("goshift0",-_[0]*(N-m)/(_[1]-_[0])+m)}var G=a.getProperty().getUseLabelOutline();if(G===!0){var k=a.getProperty().getLabelOutlineThickness(),U=a.getProperty().getLabelOutlineOpacity();i.setUniformi("outlineThickness",k),i.setUniformf("outlineOpacity",U)}e.lastLightComplexity>0&&(i.setUniformf("vAmbient",s.getAmbient()),i.setUniformf("vDiffuse",s.getDiffuse()),i.setUniformf("vSpecular",s.getSpecular()),i.setUniformf("vSpecularPower",s.getSpecularPower()))},t.getClippingPlaneShaderParameters=function(r,n,a){if(e.renderable.getClippingPlanes().length>0){for(var i=e.openGLCamera.getKeyMatrices(n),o=[],s=[],f=[],c=e.renderable.getClippingPlanes(),u=c.length,v=0;v<u;++v){var g=c[v].getNormal(),p=c[v].getOrigin();ai(g,g,i.normalMatrix),Q(p,p,i.wcvc);var l=-1*kr(p,g);o.push(g[0]),o.push(g[1]),o.push(g[2]),s.push(l),f.push(p[0]),f.push(p[1]),f.push(p[2])}var h=r.getProgram();h.setUniform3fv("vClipPlaneNormals",o),h.setUniformfv("vClipPlaneDistances",s),h.setUniform3fv("vClipPlaneOrigins",f),h.setUniformi("clip_numPlanes",u)}},t.delete=$n(function(){e._animationRateSubscription&&(e._animationRateSubscription.unsubscribe(),e._animationRateSubscription=null)},t.delete),t.getRenderTargetSize=function(){if(e._useSmallViewport)return[e._smallViewportWidth,e._smallViewportHeight];var r=e._openGLRenderer.getTiledSizeAndOrigin(),n=r.usize,a=r.vsize;return[n,a]},t.getRenderTargetOffset=function(){var r=e._openGLRenderer.getTiledSizeAndOrigin(),n=r.lowerLeftU,a=r.lowerLeftV;return[n,a]},t.renderPieceStart=function(r,n){var a=r.getVTKWindow().getInteractor();if(e._useSmallViewport=!1,a.isAnimating()&&e._lastScale>1.5&&(e._useSmallViewport=!0),e._animationRateSubscription||(e._animationRateSubscription=a.onAnimationFrameRateUpdate(function(){if(e.renderable.getAutoAdjustSampleDistances()){var c=a.getRecentAnimationFrameRate(),u=a.getDesiredUpdateRate()/c;(u>1.15||u<.85)&&(e._lastScale*=u),e._lastScale>400&&(e._lastScale=400),e._lastScale<1.5&&(e._lastScale=1.5)}else e._lastScale=e.renderable.getImageSampleDistance()*e.renderable.getImageSampleDistance();var v=e._openGLRenderWindow.getFramebufferSize();e._smallViewportWidth=Math.ceil(v[0]/Math.sqrt(e._lastScale)),e._smallViewportHeight=Math.ceil(v[1]/Math.sqrt(e._lastScale))})),e._useSmallViewport){var i=e._openGLRenderWindow.getFramebufferSize();if(e._smallViewportHeight>i[1]&&(e._smallViewportHeight=i[1]),e._smallViewportWidth>i[0]&&(e._smallViewportWidth=i[0]),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.getGLFramebuffer()===null)e.framebuffer.create(i[0],i[1]),e.framebuffer.populateFramebuffer();else{var o=e.framebuffer.getSize();(o[0]!==i[0]||o[1]!==i[1])&&(e.framebuffer.create(i[0],i[1]),e.framebuffer.populateFramebuffer())}e.framebuffer.bind();var s=e.context;s.clearColor(0,0,0,0),s.colorMask(!0,!0,!0,!0),s.clear(s.COLOR_BUFFER_BIT),s.viewport(0,0,e._smallViewportWidth,e._smallViewportHeight),e.fvp=[e._smallViewportWidth/i[0],e._smallViewportHeight/i[1]]}e.context.disable(e.context.DEPTH_TEST),t.updateBufferObjects(r,n);var f=n.getProperty().getInterpolationType();f===eo.NEAREST?(e.scalarTexture.setMinificationFilter(ue.NEAREST),e.scalarTexture.setMagnificationFilter(ue.NEAREST)):(e.scalarTexture.setMinificationFilter(ue.LINEAR),e.scalarTexture.setMagnificationFilter(ue.LINEAR)),e.lastBoundBO=null,e.zBufferTexture!==null&&e.zBufferTexture.activate()},t.renderPieceDraw=function(r,n){var a=e.context;e.scalarTexture.activate(),e.opacityTexture.activate(),e.colorTexture.activate(),e.jitterTexture.activate(),t.updateShaders(e.tris,r,n),a.drawArrays(a.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),e.scalarTexture.deactivate(),e.colorTexture.deactivate(),e.opacityTexture.deactivate(),e.jitterTexture.deactivate()},t.renderPieceFinish=function(r,n){if(e.zBufferTexture!==null&&e.zBufferTexture.deactivate(),e._useSmallViewport){if(e.framebuffer.restorePreviousBindingsAndBuffers(),e.copyShader===null){e.copyShader=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","uniform vec2 tfactor;","varying vec2 tcoord;","void main() { tcoord = vec2(vertexDC.x*0.5 + 0.5, vertexDC.y*0.5 + 0.5) * tfactor; gl_Position = vertexDC; }"].join(`
`),["//VTK::System::Dec","//VTK::Output::Dec","uniform sampler2D texture1;","varying vec2 tcoord;","void main() { gl_FragData[0] = texture2D(texture1,tcoord); }"].join(`
`),"");var a=e.copyShader;e.copyVAO=yo.newInstance(),e.copyVAO.setOpenGLRenderWindow(e._openGLRenderWindow),e.tris.getCABO().bind(),e.copyVAO.addAttributeArray(a,e.tris.getCABO(),"vertexDC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||hi("Error setting vertexDC in copy shader VAO.")}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(e.copyShader);var i=e._openGLRenderWindow.getFramebufferSize();e.context.viewport(0,0,i[0],i[1]);var o=e.framebuffer.getColorTexture();o.activate(),e.copyShader.setUniformi("texture",o.getTextureUnit()),e.copyShader.setUniform2f("tfactor",e.fvp[0],e.fvp[1]);var s=e.context;s.blendFuncSeparate(s.ONE,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA),e.context.drawArrays(e.context.TRIANGLES,0,e.tris.getCABO().getElementCount()),o.deactivate(),s.blendFuncSeparate(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA)}},t.renderPiece=function(r,n){if(t.invokeEvent({type:"StartEvent"}),e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent({type:"EndEvent"}),!e.currentInput){hi("No input!");return}t.renderPieceStart(r,n),t.renderPieceDraw(r,n),t.renderPieceFinish(r,n)},t.computeBounds=function(r,n){if(!t.getInput()){Dn(e.Bounds);return}e.bounds=t.getInput().getBounds()},t.updateBufferObjects=function(r,n){t.getNeedToRebuildBufferObjects(r,n)&&t.buildBufferObjects(r,n)},t.getNeedToRebuildBufferObjects=function(r,n){return e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<n.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<n.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.currentInput.getMTime()},t.buildBufferObjects=function(r,n){var a=e.currentInput;if(a){var i=a.getPointData()&&a.getPointData().getScalars();if(i){var o=n.getProperty();if(!e.jitterTexture.getHandle()){for(var s=new Uint8Array(1024),f=0;f<32*32;++f)s[f]=255*Math.random();e.jitterTexture.setMinificationFilter(ue.LINEAR),e.jitterTexture.setMagnificationFilter(ue.LINEAR),e.jitterTexture.create2DFromRaw(32,32,1,Me.UNSIGNED_CHAR,s)}var c=i.getNumberOfComponents(),u=o.getIndependentComponents(),v=u?c:1,g="".concat(o.getMTime());if(e.opacityTextureString!==g){for(var p=1024,l=p*2*v,h=new Float32Array(l),y=new Float32Array(p),C=0;C<v;++C){var S=o.getScalarOpacity(C),d=e.renderable.getSampleDistance()/o.getScalarOpacityUnitDistance(C),O=S.getRange();S.getTable(O[0],O[1],p,y,1);for(var w=0;w<p;++w)h[C*p*2+w]=1-Math.pow(1-y[w],d),h[C*p*2+w+p]=h[C*p*2+w]}if(e.opacityTexture.releaseGraphicsResources(e._openGLRenderWindow),e.opacityTexture.setMinificationFilter(ue.LINEAR),e.opacityTexture.setMagnificationFilter(ue.LINEAR),e._openGLRenderWindow.getWebgl2()||e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))e.opacityTexture.create2DFromRaw(p,2*v,1,Me.FLOAT,h);else{for(var M=new Uint8Array(l),x=0;x<l;++x)M[x]=255*h[x];e.opacityTexture.create2DFromRaw(p,2*v,1,Me.UNSIGNED_CHAR,M)}e.opacityTextureString=g}if(g="".concat(o.getMTime()),e.colorTextureString!==g){for(var D=1024,R=D*2*v*3,V=new Uint8Array(R),E=new Float32Array(D*3),L=0;L<v;++L){var m=o.getRGBTransferFunction(L),N=m.getRange();m.getTable(N[0],N[1],D,E,1);for(var _=0;_<D*3;++_)V[L*D*6+_]=255*E[_],V[L*D*6+_+D*3]=255*E[_]}e.colorTexture.releaseGraphicsResources(e._openGLRenderWindow),e.colorTexture.setMinificationFilter(ue.LINEAR),e.colorTexture.setMagnificationFilter(ue.LINEAR),e.colorTexture.create2DFromRaw(D,2*v,3,Me.UNSIGNED_CHAR,V),e.colorTextureString=g}if(g="".concat(a.getMTime()),e.scalarTextureString!==g){var G=a.getDimensions();e.scalarTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),e.scalarTexture.releaseGraphicsResources(e._openGLRenderWindow),e.scalarTexture.resetFormatAndType(),e.scalarTexture.create3DFilterableFromDataArray(G[0],G[1],G[2],i,e.renderable.getPreferSizeOverAccuracy()),e.scalarTextureString=g}if(!e.tris.getCABO().getElementCount()){for(var k=new Float32Array(12),U=0;U<4;U++)k[U*3]=U%2*2-1,k[U*3+1]=U>1?1:-1,k[U*3+2]=-1;var B=new Uint16Array(8);B[0]=3,B[1]=0,B[2]=1,B[3]=3,B[4]=3,B[5]=0,B[6]=3,B[7]=2;var j=ie.newInstance({numberOfComponents:3,values:k});j.setName("points");var H=ie.newInstance({numberOfComponents:1,values:B});e.tris.getCABO().createVBO(H,"polys",Je.SURFACE,{points:j,cellOffset:0})}e.VBOBuildTime.modified()}}}}var WS={context:null,VBOBuildTime:null,scalarTexture:null,scalarTextureString:null,opacityTexture:null,opacityTextureString:null,colorTexture:null,colorTextureString:null,jitterTexture:null,tris:null,framebuffer:null,copyShader:null,copyVAO:null,lastXYF:1,targetXYF:1,zBufferTexture:null,lastZBufferTexture:null,lastLightComplexity:0,fullViewportTime:1,idxToView:null,idxNormalMatrix:null,modelToView:null,projectionToView:null,avgWindowArea:0,avgFrameTime:0};function $S(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,WS,r),Qe.extend(t,e,r),e.VBOBuildTime={},_e(e.VBOBuildTime,{mtime:0}),e.tris=$t.newInstance(),e.scalarTexture=$e.newInstance(),e.opacityTexture=$e.newInstance(),e.colorTexture=$e.newInstance(),e.jitterTexture=$e.newInstance(),e.jitterTexture.setWrapS(Gr.REPEAT),e.jitterTexture.setWrapT(Gr.REPEAT),e.framebuffer=Ia.newInstance(),e.idxToView=I(new Float64Array(16)),e.idxNormalMatrix=_t(new Float64Array(9)),e.modelToView=I(new Float64Array(16)),e.projectionToView=I(new Float64Array(16)),e.projectionToWorld=I(new Float64Array(16)),e._lastScale=1,ze(t,e,["context"]),jS(t,e)}var zS=ke($S,"vtkOpenGLVolumeMapper");Ie("vtkVolumeMapper",zS);var bS=Jn.FieldAssociations;function HS(t,e){e.classHierarchy.push("vtkHardwareSelector"),t.getSourceDataAsync=function(){var r=Et(Ge.mark(function n(a,i,o,s,f){return Ge.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:case"end":return u.stop()}},n)}));return function(n,a,i,o,s){return r.apply(this,arguments)}}(),t.selectAsync=function(){var r=Et(Ge.mark(function n(a,i,o,s,f){var c;return Ge.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,t.getSourceDataAsync(a,i,o,s,f);case 2:if(c=v.sent,!c){v.next=5;break}return v.abrupt("return",c.generateSelection(i,o,s,f));case 5:return v.abrupt("return",[]);case 6:case"end":return v.stop()}},n)}));return function(n,a,i,o,s){return r.apply(this,arguments)}}()}var KS={fieldAssociation:bS.FIELD_ASSOCIATION_CELLS,captureZValues:!1};function Ig(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,KS,r),T.obj(t,e),T.setGet(t,e,["fieldAssociation","captureZValues"]),HS(t,e)}var PS=T.newInstance(Ig,"vtkHardwareSelector"),XS={newInstance:PS,extend:Ig},YS={GLOBALIDS:0,PEDIGREEIDS:1,VALUES:2,INDICES:3,FRUSTUM:4,LOCATIONS:5,THRESHOLDS:6,BLOCKS:7,QUERY:8},AS={CELL:0,POINT:1,FIELD:2,VERTEX:3,EDGE:4,ROW:5},ZS={SelectionContent:YS,SelectionField:AS};function su(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function qS(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?su(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):su(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function JS(t,e){e.classHierarchy.push("vtkSelectionNode"),t.getBounds=function(){return e.points.getBounds()}}var QS={contentType:-1,fieldType:-1,properties:null,selectionList:[]};function ev(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,QS,r),T.obj(t,e),e.properties={},T.setGet(t,e,["contentType","fieldType","properties","selectionList"]),JS(t,e)}var IS=T.newInstance(ev,"vtkSelectionNode"),$o=qS({newInstance:IS,extend:ev},ZS);function uu(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function ed(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?uu(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):uu(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var Ue=hg.PassTypes,td=$o.SelectionContent,fu=$o.SelectionField,Rr=Jn.FieldAssociations,tv=T.vtkErrorMacro,Jt=1;function nv(t){return"".concat(t.propID," ").concat(t.compositeID)}function rv(t,e,r,n){if(!r)return 0;var a=(e*(n[2]-n[0]+1)+t)*4;return r[a+3]}function Ut(t,e,r,n){if(!r)return 0;var a=(e*(n[2]-n[0]+1)+t)*4,i=r[a],o=r[a+1],s=r[a+2];return(s*256+o)*256+i}function av(t,e){var r=e;return r<<=24,r|=t,r}function Gn(t,e,r,n){var a=r<0?0:r;if(a===0){if(n[0]=e[0],n[1]=e[1],e[0]<t.area[0]||e[0]>t.area[2]||e[1]<t.area[1]||e[1]>t.area[3])return null;var i=[e[0]-t.area[0],e[1]-t.area[1]],o=Ut(i[0],i[1],t.pixBuffer[Ue.ACTOR_PASS],t.area);if(o<=0||o-Jt>=t.props.length)return null;var s={};s.valid=!0,s.propID=o-Jt,s.prop=t.props[s.propID];var f=Ut(i[0],i[1],t.pixBuffer[Ue.COMPOSITE_INDEX_PASS],t.area);if((f<0||f>16777215)&&(f=0),s.compositeID=f-Jt,t.captureZValues){var c=(i[1]*(t.area[2]-t.area[0]+1)+i[0])*4;s.zValue=(256*t.zBuffer[c]+t.zBuffer[c+1])/65535,s.displayPosition=e}if(t.pixBuffer[Ue.ID_LOW24]&&rv(i[0],i[1],t.pixBuffer[Ue.ID_LOW24],t.area)===0)return s;var u=Ut(i[0],i[1],t.pixBuffer[Ue.ID_LOW24],t.area),v=Ut(i[0],i[1],t.pixBuffer[Ue.ID_HIGH24],t.area);return s.attributeID=av(u,v),s}var g=[e[0],e[1]],p=[0,0],l=Gn(t,e,0,n);if(l&&l.valid)return l;for(var h=1;h<a;++h){for(var y=g[1]>h?g[1]-h:0;y<=g[1]+h;++y)if(p[1]=y,g[0]>=h&&(p[0]=g[0]-h,l=Gn(t,p,0,n),l&&l.valid)||(p[0]=g[0]+h,l=Gn(t,p,0,n),l&&l.valid))return l;for(var C=g[0]>=h?g[0]-(h-1):0;C<=g[0]+(h-1);++C)if(p[0]=C,g[1]>=h&&(p[1]=g[1]-h,l=Gn(t,p,0,n),l&&l.valid)||(p[1]=g[1]+h,l=Gn(t,p,0,n),l&&l.valid))return l}return n[0]=e[0],n[1]=e[1],null}function iv(t,e,r,n,a){var i=[],o=0;return e.forEach(function(s,f){var c=$o.newInstance();switch(c.setContentType(td.INDICES),t){case Rr.FIELD_ASSOCIATION_CELLS:c.setFieldType(fu.CELL);break;case Rr.FIELD_ASSOCIATION_POINTS:c.setFieldType(fu.POINT);break;default:tv("Unknown field association")}c.getProperties().propID=s.info.propID,c.getProperties().prop=s.info.prop,c.getProperties().compositeID=s.info.compositeID,c.getProperties().attributeID=s.info.attributeID,c.getProperties().pixelCount=s.pixelCount,r&&(c.getProperties().displayPosition=[s.info.displayPosition[0],s.info.displayPosition[1],s.info.zValue],c.getProperties().worldPosition=a.displayToWorld(s.info.displayPosition[0],s.info.displayPosition[1],s.info.zValue,n)),c.setSelectionList(s.attributeIDs),i[o]=c,o++}),i}function nd(t,e,r,n,a){for(var i=Math.floor(e),o=Math.floor(r),s=Math.floor(n),f=Math.floor(a),c=new Map,u=[0,0],v=o;v<=f;v++)for(var g=i;g<=s;g++){var p=[g,v],l=Gn(t,p,0,u);if(l&&l.valid){var h=nv(l);if(!c.has(h))c.set(h,{info:l,pixelCount:1,attributeIDs:[l.attributeID]});else{var y=c.get(h);y.pixelCount++,t.captureZValues&&l.zValue<y.info.zValue&&(y.info=l),y.attributeIDs.indexOf(l.attributeID)===-1&&y.attributeIDs.push(l.attributeID)}}}return iv(t.fieldAssociation,c,t.captureZValues,t.renderer,t.openGLRenderWindow)}function rd(t,e){e.classHierarchy.push("vtkOpenGLHardwareSelector"),t.releasePixBuffers=function(){e.rawPixBuffer=[],e.pixBuffer=[],e.zBuffer=null},t.beginSelection=function(){e._openGLRenderer=e._openGLRenderWindow.getViewNodeFor(e._renderer),e.maxAttributeId=0;var n=e._openGLRenderWindow.getSize();if(!e.framebuffer)e.framebuffer=Ia.newInstance(),e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.create(n[0],n[1]),e.framebuffer.populateFramebuffer();else{e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.saveCurrentBindingsAndBuffers();var a=e.framebuffer.getSize();a[0]!==n[0]||a[1]!==n[1]?(e.framebuffer.create(n[0],n[1]),e.framebuffer.populateFramebuffer()):e.framebuffer.bind()}if(e._openGLRenderer.clear(),e._openGLRenderer.setSelector(t),e.hitProps={},e.propPixels={},e.props=[],t.releasePixBuffers(),e.fieldAssociation===Rr.FIELD_ASSOCIATION_POINTS){var i=e._openGLRenderWindow.getContext(),o=i.isEnabled(i.BLEND);i.disable(i.BLEND),e._openGLRenderWindow.traverseAllPasses(),o&&i.enable(i.BLEND)}},t.endSelection=function(){e.hitProps={},e._openGLRenderer.setSelector(null),e.framebuffer.restorePreviousBindingsAndBuffers()},t.preCapturePass=function(){var n=e._openGLRenderWindow.getContext();e.originalBlending=n.isEnabled(n.BLEND),n.disable(n.BLEND)},t.postCapturePass=function(){var n=e._openGLRenderWindow.getContext();e.originalBlending&&n.enable(n.BLEND)},t.select=function(){var n=null;return t.captureBuffers()&&(n=t.generateSelection(e.area[0],e.area[1],e.area[2],e.area[3]),t.releasePixBuffers()),n},t.getSourceDataAsync=function(){var n=Et(Ge.mark(function a(i,o,s,f,c){var u,v;return Ge.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(e._renderer=i,o===void 0?(u=e._openGLRenderWindow.getSize(),t.setArea(0,0,u[0]-1,u[1]-1)):t.setArea(o,s,f,c),t.captureBuffers()){p.next=4;break}return p.abrupt("return",!1);case 4:return v={area:W(e.area),pixBuffer:W(e.pixBuffer),captureZValues:e.captureZValues,zBuffer:e.zBuffer,props:W(e.props),fieldAssociation:e.fieldAssociation,renderer:i,openGLRenderWindow:e._openGLRenderWindow},v.generateSelection=function(){for(var l=arguments.length,h=new Array(l),y=0;y<l;y++)h[y]=arguments[y];return nd.apply(void 0,[v].concat(h))},p.abrupt("return",v);case 7:case"end":return p.stop()}},a)}));return function(a,i,o,s,f){return n.apply(this,arguments)}}(),t.captureBuffers=function(){if(!e._renderer||!e._openGLRenderWindow)return tv("Renderer and view must be set before calling Select."),!1;e._openGLRenderer=e._openGLRenderWindow.getViewNodeFor(e._renderer),e._openGLRenderWindow.getRenderable().preRender(),t.invokeEvent({type:"StartEvent"}),e.originalBackground=e._renderer.getBackgroundByReference(),e._renderer.setBackground(0,0,0,0);var n=e._openGLRenderWindow.getRenderPasses();for(t.beginSelection(),e.currentPass=Ue.MIN_KNOWN_PASS;e.currentPass<=Ue.MAX_KNOWN_PASS;e.currentPass++)t.passRequired(e.currentPass)&&(t.preCapturePass(e.currentPass),e.captureZValues&&e.currentPass===Ue.ACTOR_PASS&&typeof n[0].requestDepth=="function"&&typeof n[0].getFramebuffer=="function"&&n[0].requestDepth(),e._openGLRenderWindow.traverseAllPasses(),t.postCapturePass(e.currentPass),t.savePixelBuffer(e.currentPass),t.processPixelBuffers());return t.endSelection(),e._renderer.setBackground(e.originalBackground),t.invokeEvent({type:"EndEvent"}),!0},t.processPixelBuffers=function(){e.props.forEach(function(n,a){t.isPropHit(a)&&n.processSelectorPixelBuffers(t,e.propPixels[a])})},t.passRequired=function(n){if(n===Ue.ID_HIGH24){if(e.fieldAssociation===Rr.FIELD_ASSOCIATION_POINTS)return e.maximumPointId>16777215;if(e.fieldAssociation===Rr.FIELD_ASSOCIATION_CELLS)return e.maximumCellId>16777215}return!0},t.savePixelBuffer=function(n){if(e.pixBuffer[n]=e._openGLRenderWindow.getPixelData(e.area[0],e.area[1],e.area[2],e.area[3]),!e.rawPixBuffer[n]){var a=(e.area[2]-e.area[0]+1)*(e.area[3]-e.area[1]+1)*4;e.rawPixBuffer[n]=new Uint8Array(a),e.rawPixBuffer[n].set(e.pixBuffer[n])}if(n===Ue.ACTOR_PASS){if(e.captureZValues){var i=e._openGLRenderWindow.getRenderPasses();if(typeof i[0].requestDepth=="function"&&typeof i[0].getFramebuffer=="function"){var o=i[0].getFramebuffer();o.saveCurrentBindingsAndBuffers(),o.bind(),e.zBuffer=e._openGLRenderWindow.getPixelData(e.area[0],e.area[1],e.area[2],e.area[3]),o.restorePreviousBindingsAndBuffers()}}t.buildPropHitList(e.rawPixBuffer[n])}},t.buildPropHitList=function(n){for(var a=0,i=0;i<=e.area[3]-e.area[1];i++)for(var o=0;o<=e.area[2]-e.area[0];o++){var s=Ut(o,i,n,e.area);s>0&&(s--,s in e.hitProps||(e.hitProps[s]=!0,e.propPixels[s]=[]),e.propPixels[s].push(a*4)),++a}},t.renderProp=function(n){e.currentPass===Ue.ACTOR_PASS&&(t.setPropColorValueFromInt(e.props.length+Jt),e.props.push(n))},t.renderCompositeIndex=function(n){e.currentPass===Ue.COMPOSITE_INDEX_PASS&&t.setPropColorValueFromInt(n+Jt)},t.renderAttributeId=function(n){n<0||(e.maxAttributeId=n>e.maxAttributeId?n:e.maxAttributeId)},t.passTypeToString=function(n){return T.enumToString(Ue,n)},t.isPropHit=function(n){return!!e.hitProps[n]},t.setPropColorValueFromInt=function(n){e.propColorValue[0]=n%256/255,e.propColorValue[1]=Math.floor(n/256)%256/255,e.propColorValue[2]=Math.floor(n/65536)%256/255},t.getPixelInformation=function(n,a,i){var o=a<0?0:a;if(o===0){if(i[0]=n[0],i[1]=n[1],n[0]<e.area[0]||n[0]>e.area[2]||n[1]<e.area[1]||n[1]>e.area[3])return null;var s=[n[0]-e.area[0],n[1]-e.area[1]],f=Ut(s[0],s[1],e.pixBuffer[Ue.ACTOR_PASS],e.area);if(f<=0||f-Jt>=e.props.length)return null;var c={};c.valid=!0,c.propID=f-Jt,c.prop=e.props[c.propID];var u=Ut(s[0],s[1],e.pixBuffer[Ue.COMPOSITE_INDEX_PASS],e.area);if((u<0||u>16777215)&&(u=0),c.compositeID=u-Jt,e.captureZValues){var v=(s[1]*(e.area[2]-e.area[0]+1)+s[0])*4;c.zValue=(256*e.zBuffer[v]+e.zBuffer[v+1])/65535,c.displayPosition=n}if(e.pixBuffer[Ue.ID_LOW24]&&rv(s[0],s[1],e.pixBuffer[Ue.ID_LOW24],e.area)===0)return c;var g=Ut(s[0],s[1],e.pixBuffer[Ue.ID_LOW24],e.area),p=Ut(s[0],s[1],e.pixBuffer[Ue.ID_HIGH24],e.area);return c.attributeID=av(g,p),c}var l=[n[0],n[1]],h=[0,0],y=t.getPixelInformation(n,0,i);if(y&&y.valid)return y;for(var C=1;C<o;++C){for(var S=l[1]>C?l[1]-C:0;S<=l[1]+C;++S)if(h[1]=S,l[0]>=C&&(h[0]=l[0]-C,y=t.getPixelInformation(h,0,i),y&&y.valid)||(h[0]=l[0]+C,y=t.getPixelInformation(h,0,i),y&&y.valid))return y;for(var d=l[0]>=C?l[0]-(C-1):0;d<=l[0]+(C-1);++d)if(h[0]=d,l[1]>=C&&(h[1]=l[1]-C,y=t.getPixelInformation(h,0,i),y&&y.valid)||(h[1]=l[1]+C,y=t.getPixelInformation(h,0,i),y&&y.valid))return y}return i[0]=n[0],i[1]=n[1],null},t.generateSelection=function(n,a,i,o){for(var s=Math.floor(n),f=Math.floor(a),c=Math.floor(i),u=Math.floor(o),v=new Map,g=[0,0],p=f;p<=u;p++)for(var l=s;l<=c;l++){var h=[l,p],y=t.getPixelInformation(h,0,g);if(y&&y.valid){var C=nv(y);if(!v.has(C))v.set(C,{info:y,pixelCount:1,attributeIDs:[y.attributeID]});else{var S=v.get(C);S.pixelCount++,e.captureZValues&&y.zValue<S.info.zValue&&(S.info=y),S.attributeIDs.indexOf(y.attributeID)===-1&&S.attributeIDs.push(y.attributeID)}}}return iv(e.fieldAssociation,v,e.captureZValues,e._renderer,e._openGLRenderWindow)},t.getRawPixelBuffer=function(n){return e.rawPixBuffer[n]},t.getPixelBuffer=function(n){return e.pixBuffer[n]},t.attach=function(n,a){e._openGLRenderWindow=n,e._renderer=a};var r=t.setArea;t.setArea=function(){return r.apply(void 0,arguments)?(e.area[0]=Math.floor(e.area[0]),e.area[1]=Math.floor(e.area[1]),e.area[2]=Math.floor(e.area[2]),e.area[3]=Math.floor(e.area[3]),!0):!1}}var ad={area:void 0,currentPass:-1,propColorValue:null,props:null,maximumPointId:0,maximumCellId:0,idOffset:1};function ov(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ad,r),XS.extend(t,e,r),e.propColorValue=[0,0,0],e.props=[],e.area||(e.area=[0,0,0,0]),T.setGetArray(t,e,["area"],4),T.setGet(t,e,["_renderer","currentPass","_openGLRenderWindow","maximumPointId","maximumCellId"]),T.setGetArray(t,e,["propColorValue"],3),T.moveToProtected(t,e,["renderer","openGLRenderWindow"]),T.event(t,e,"event"),rd(t,e)}var id=T.newInstance(ov,"vtkOpenGLHardwareSelector"),zo=ed({newInstance:id,extend:ov},hg);function cu(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function od(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?cu(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):cu(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var nr=ae,sd=zr.Representation,qr=Tn.ObjectType,ud=zo.PassTypes,fd={type:"StartEvent"},cd={type:"EndEvent"};function gd(t,e){e.classHierarchy.push("vtkOpenGLGlyph3DMapper");var r=od({},t);t.renderPiece=function(n,a){if(t.invokeEvent(fd),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(1),t.invokeEvent(cd),!e.currentInput){nr("No input!");return}if(!(!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues())){var i=e.context;e._openGLRenderWindow.getWebgl2()?(e.hardwareSupport=!0,e.extension=null):e.extension||(e.extension=e.context.getExtension("ANGLE_instanced_arrays"),e.hardwareSupport=!!e.extension);var o=a.getProperty().getBackfaceCulling(),s=a.getProperty().getFrontfaceCulling();!o&&!s?e._openGLRenderWindow.disableCullFace():s?(e._openGLRenderWindow.enableCullFace(),i.cullFace(i.FRONT)):(e._openGLRenderWindow.enableCullFace(),i.cullFace(i.BACK)),t.renderPieceStart(n,a),t.renderPieceDraw(n,a),t.renderPieceFinish(n,a)}},t.multiply4x4WithOffset=function(n,a,i,o){var s=a[0],f=a[1],c=a[2],u=a[3],v=a[4],g=a[5],p=a[6],l=a[7],h=a[8],y=a[9],C=a[10],S=a[11],d=a[12],O=a[13],w=a[14],M=a[15],x=i[o],D=i[o+1],R=i[o+2],V=i[o+3];n[0]=x*s+D*v+R*h+V*d,n[1]=x*f+D*g+R*y+V*O,n[2]=x*c+D*p+R*C+V*w,n[3]=x*u+D*l+R*S+V*M,x=i[o+4],D=i[o+5],R=i[o+6],V=i[o+7],n[4]=x*s+D*v+R*h+V*d,n[5]=x*f+D*g+R*y+V*O,n[6]=x*c+D*p+R*C+V*w,n[7]=x*u+D*l+R*S+V*M,x=i[o+8],D=i[o+9],R=i[o+10],V=i[o+11],n[8]=x*s+D*v+R*h+V*d,n[9]=x*f+D*g+R*y+V*O,n[10]=x*c+D*p+R*C+V*w,n[11]=x*u+D*l+R*S+V*M,x=i[o+12],D=i[o+13],R=i[o+14],V=i[o+15],n[12]=x*s+D*v+R*h+V*d,n[13]=x*f+D*g+R*y+V*O,n[14]=x*c+D*p+R*C+V*w,n[15]=x*u+D*l+R*S+V*M},t.replaceShaderNormal=function(n,a,i){if(e.hardwareSupport){var o=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(o>0){var s=n.Vertex;e.lastBoundBO.getCABO().getNormalOffset()&&(s=F.substitute(s,"//VTK::Normal::Dec",["attribute vec3 normalMC;","attribute mat3 gNormal;","uniform mat3 normalMatrix;","varying vec3 normalVCVSOutput;"]).result,s=F.substitute(s,"//VTK::Normal::Impl",["normalVCVSOutput = normalMatrix * gNormal * normalMC;"]).result),n.Vertex=s}}r.replaceShaderNormal(n,a,i)},t.replaceShaderColor=function(n,a,i){if(e.hardwareSupport&&e.renderable.getColorArray()){var o=n.Vertex,s=n.Geometry,f=n.Fragment,c=e.lastBoundBO.getReferenceByName("lastLightComplexity"),u=["uniform float ambient;","uniform float diffuse;","uniform float specular;","uniform float opacityUniform; // the fragment opacity"];c&&(u=u.concat(["uniform vec3 specularColorUniform;","uniform float specularPowerUniform;"]));var v=["vec3 ambientColor;","  vec3 diffuseColor;","  float opacity;"];c&&(v=v.concat(["  vec3 specularColor;","  float specularPower;"])),v=v.concat(["  opacity = opacityUniform;"]),c&&(v=v.concat(["  specularColor = specularColorUniform;","  specularPower = specularPowerUniform;"])),e.drawingEdges||(u=u.concat(["varying vec4 vertexColorVSOutput;"]),o=F.substitute(o,"//VTK::Color::Dec",["attribute vec4 gColor;","varying vec4 vertexColorVSOutput;"]).result,o=F.substitute(o,"//VTK::Color::Impl",["vertexColorVSOutput = gColor;"]).result,s=F.substitute(s,"//VTK::Color::Dec",["in vec4 vertexColorVSOutput[];","out vec4 vertexColorGSOutput;"]).result,s=F.substitute(s,"//VTK::Color::Impl",["vertexColorGSOutput = vertexColorVSOutput[i];"]).result,v=v.concat(["  diffuseColor = vertexColorVSOutput.rgb;","  ambientColor = vertexColorVSOutput.rgb;","  opacity = opacity*vertexColorVSOutput.a;"])),f=F.substitute(f,"//VTK::Color::Impl",v).result,f=F.substitute(f,"//VTK::Color::Dec",u).result,n.Vertex=o,n.Geometry=s,n.Fragment=f}r.replaceShaderColor(n,a,i)},t.replaceShaderPositionVC=function(n,a,i){if(e.hardwareSupport){var o=n.Vertex,s=e.lastBoundBO.getReferenceByName("lastLightComplexity");s>0?(o=F.substitute(o,"//VTK::PositionVC::Impl",["vec4 gVertexMC = gMatrix * vertexMC;","vertexVCVSOutput = MCVCMatrix * gVertexMC;","  gl_Position = MCPCMatrix * gVertexMC;"]).result,o=F.substitute(o,"//VTK::Camera::Dec",["attribute mat4 gMatrix;","uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result):(o=F.substitute(o,"//VTK::Camera::Dec",["attribute mat4 gMatrix;","uniform mat4 MCPCMatrix;"]).result,o=F.substitute(o,"//VTK::PositionVC::Impl",["vec4 gVertexMC = gMatrix * vertexMC;","  gl_Position = MCPCMatrix * gVertexMC;"]).result),n.Vertex=o}r.replaceShaderPositionVC(n,a,i)},t.replaceShaderPicking=function(n,a,i){if(e.hardwareSupport){var o=n.Fragment,s=n.Vertex;s=F.substitute(s,"//VTK::Picking::Dec",["attribute vec3 mapperIndexVS;","varying vec3 mapperIndexVSOutput;"]).result,s=F.substitute(s,"//VTK::Picking::Impl","  mapperIndexVSOutput = mapperIndexVS;").result,n.Vertex=s,o=F.substitute(o,"//VTK::Picking::Dec",["varying vec3 mapperIndexVSOutput;","uniform vec3 mapperIndex;","uniform int picking;"]).result,o=F.substitute(o,"//VTK::Picking::Impl",["  vec4 pickColor = picking == 2 ? vec4(mapperIndexVSOutput,1.0) : vec4(mapperIndex,1.0);","  gl_FragData[0] = picking != 0 ? pickColor : gl_FragData[0];"]).result,n.Fragment=o}else r.replaceShaderPicking(n,a,i)},t.updateGlyphShaderParameters=function(n,a,i,o,s,f,c,u){var v=i.getProgram();if(n){var g=e.normalMatrix,p=f,l=c*9,h=e.tmpMat3,y=g[0],C=g[1],S=g[2],d=g[3],O=g[4],w=g[5],M=g[6],x=g[7],D=g[8],R=p[l],V=p[l+1],E=p[l+2],L=p[l+3],m=p[l+4],N=p[l+5],_=p[l+6],G=p[l+7],k=p[l+8];h[0]=R*y+V*d+E*M,h[1]=R*C+V*O+E*x,h[2]=R*S+V*w+E*D,h[3]=L*y+m*d+N*M,h[4]=L*C+m*O+N*x,h[5]=L*S+m*w+N*D,h[6]=_*y+G*d+k*M,h[7]=_*C+G*O+k*x,h[8]=_*S+G*w+k*D,v.setUniformMatrix3x3("normalMatrix",e.tmpMat3)}if(t.multiply4x4WithOffset(e.tmpMat4,e.mcpcMatrix,s,c*16),v.setUniformMatrix("MCPCMatrix",e.tmpMat4),a&&(t.multiply4x4WithOffset(e.tmpMat4,e.mcvcMatrix,s,c*16),v.setUniformMatrix("MCVCMatrix",e.tmpMat4)),o){var U=o.getData();e.tmpColor[0]=U[c*4]/255,e.tmpColor[1]=U[c*4+1]/255,e.tmpColor[2]=U[c*4+2]/255,v.setUniform3fArray("ambientColorUniform",e.tmpColor),v.setUniform3fArray("diffuseColorUniform",e.tmpColor)}u&&v.setUniform3fArray("mapperIndex",u.getPropColorValue())},t.renderPieceDraw=function(n,a){var i=a.getProperty().getRepresentation(),o=e.context,s=a.getProperty().getEdgeVisibility()&&i===sd.SURFACE,f=e.openGLCamera.getKeyMatrices(n),c=e.openGLActor.getKeyMatrices();Gi(e.normalMatrix,f.normalMatrix,c.normalMatrix),Ee(e.mcpcMatrix,f.wcpc,c.mcwc),Ee(e.mcvcMatrix,f.wcvc,c.mcwc);var u=e.renderable.getMatrixArray(),v=e.renderable.getNormalArray(),g=e.renderable.getColorArray(),p=u.length/16,l=!1;e._openGLRenderer.getSelector()&&e._openGLRenderer.getSelector().getCurrentPass()===ud.COMPOSITE_INDEX_PASS&&(l=!0);for(var h=e.primTypes.Start;h<e.primTypes.End;h++){var y=e.primitives[h].getCABO();if(y.getElementCount()){e.drawingEdges=s&&(h===e.primTypes.TrisEdges||h===e.primTypes.TriStripsEdges),e.lastBoundBO=e.primitives[h],e.primitives[h].updateShaders(n,a,t);var C=e.primitives[h].getProgram(),S=e.primitives[h].getOpenGLMode(i),d=C.isUniformUsed("normalMatrix"),O=C.isUniformUsed("MCVCMatrix");if(e.hardwareSupport)e.extension?e.extension.drawArraysInstancedANGLE(S,0,y.getElementCount(),p):o.drawArraysInstanced(S,0,y.getElementCount(),p);else for(var w=0;w<p;++w)l&&e._openGLRenderer.getSelector().renderCompositeIndex(w),t.updateGlyphShaderParameters(d,O,e.primitives[h],g,u,v,w,l?e._openGLRenderer.getSelector():null),o.drawArrays(S,0,y.getElementCount())}}},t.setMapperShaderParameters=function(n,a,i){if(n.getCABO().getElementCount()&&(e.glyphBOBuildTime.getMTime()>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())){n.getProgram().isAttributeUsed("gMatrix")?n.getVAO().addAttributeMatrixWithDivisor(n.getProgram(),e.matrixBuffer,"gMatrix",0,64,e.context.FLOAT,4,!1,1)||nr("Error setting gMatrix in shader VAO."):n.getVAO().removeAttributeArray("gMatrix"),n.getProgram().isAttributeUsed("gNormal")?n.getVAO().addAttributeMatrixWithDivisor(n.getProgram(),e.normalBuffer,"gNormal",0,36,e.context.FLOAT,3,!1,1)||nr("Error setting gNormal in shader VAO."):n.getVAO().removeAttributeArray("gNormal"),n.getProgram().isAttributeUsed("gColor")?n.getVAO().addAttributeArrayWithDivisor(n.getProgram(),e.colorBuffer,"gColor",0,4,e.context.UNSIGNED_BYTE,4,!0,1,!1)||nr("Error setting gColor in shader VAO."):n.getVAO().removeAttributeArray("gColor"),n.getProgram().isAttributeUsed("mapperIndexVS")?n.getVAO().addAttributeArrayWithDivisor(n.getProgram(),e.pickBuffer,"mapperIndexVS",0,4,e.context.UNSIGNED_BYTE,4,!0,1,!1)||nr("Error setting mapperIndexVS in shader VAO."):n.getVAO().removeAttributeArray("mapperIndexVS"),r.setMapperShaderParameters(n,a,i),n.getAttributeUpdateTime().modified();return}r.setMapperShaderParameters(n,a,i)},t.getNeedToRebuildBufferObjects=function(n,a){e.renderable.buildArrays();var i=e.VBOBuildTime.getMTime();return i<e.renderable.getBuildTime().getMTime()?!0:r.getNeedToRebuildBufferObjects(n,a)},t.getNeedToRebuildShaders=function(n,a,i){return!!(r.getNeedToRebuildShaders(n,a,i)||n.getShaderSourceTime().getMTime()<e.renderable.getMTime()||n.getShaderSourceTime().getMTime()<e.currentInput.getMTime())},t.buildBufferObjects=function(n,a){if(e.hardwareSupport){var i=e.renderable.getMatrixArray(),o=e.renderable.getNormalArray(),s=e.renderable.getColorArray();if(e.matrixBuffer||(e.matrixBuffer=Tn.newInstance(),e.matrixBuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.normalBuffer=Tn.newInstance(),e.normalBuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.colorBuffer=Tn.newInstance(),e.colorBuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.pickBuffer=Tn.newInstance(),e.pickBuffer.setOpenGLRenderWindow(e._openGLRenderWindow)),e.renderable.getBuildTime().getMTime()>e.glyphBOBuildTime.getMTime()){e.matrixBuffer.upload(i,qr.ARRAY_BUFFER),e.normalBuffer.upload(o,qr.ARRAY_BUFFER),s?e.colorBuffer.upload(s.getData(),qr.ARRAY_BUFFER):e.colorBuffer.releaseGraphicsResources();for(var f=i.length/16,c=new Uint8Array(4*f),u=0;u<f;++u){var v=u+1,g=u*4;c[g]=v%256,v-=c[g],v/=256,c[g+1]=v%256,v-=c[g+1],v/=256,c[g+2]=v%256,c[g+3]=255}e.pickBuffer.upload(c,qr.ARRAY_BUFFER),e.glyphBOBuildTime.modified()}}return r.buildBufferObjects(n,a)}}var vd={normalMatrix:null,mcpcMatrix:null,mcwcMatrix:null};function pd(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,vd,r),mT.extend(t,e,r),e.tmpMat3=_t(new Float64Array(9)),e.normalMatrix=_t(new Float64Array(9)),e.mcpcMatrix=I(new Float64Array(16)),e.mcvcMatrix=I(new Float64Array(16)),e.tmpColor=[],e.glyphBOBuildTime={},_e(e.glyphBOBuildTime,{mtime:0}),gd(t,e)}var ld=ke(pd,"vtkOpenGLGlyph3DMapper");Ie("vtkGlyph3DMapper",ld);function gu(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function Jr(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?gu(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):gu(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var hd=T.vtkErrorMacro;function yd(t,e){function r(a){if(a){e.proxyIdMapping[a.getProxyId()]=a;var i=a.getProxyGroup();e.proxyByGroup[i]||(e.proxyByGroup[i]=[]),e.proxyByGroup[i].indexOf(a)===-1&&e.proxyByGroup[i].push(a),a.setProxyManager(t),T.setImmediate(function(){t.invokeProxyRegistrationChange({action:"register",proxyId:a.getProxyId(),proxyName:a.getProxyName(),proxyGroup:a.getProxyGroup(),proxy:a})})}}function n(a){var i=a.getProxyId?a.getProxyId():a,o=e.proxyIdMapping[i];return Object.keys(e.proxyByGroup).forEach(function(s){var f=e.proxyByGroup[s],c=f.indexOf(o);c!==-1&&f.splice(c,1)}),delete e.proxyIdMapping[i],o.gcPropertyLinks("application"),o.gcPropertyLinks("source"),o.setProxyManager(null),t.invokeProxyRegistrationChange({action:"unregister",proxyId:i,proxyName:o.getProxyName(),proxyGroup:o.getProxyGroup(),proxy:o}),o}t.setActiveSource=function(a){e.activeSource!==a&&(e.activeSourceSubscription&&(e.activeSourceSubscription.unsubscribe(),e.activeSourceSubscription=null),e.activeSource=a,a&&(e.activeSourceSubscription=a.onModified(t.modified)),t.modified(),t.invokeActiveSourceChange(a))},t.setActiveView=function(a){e.activeView!==a&&(e.activeViewSubscription&&(e.activeViewSubscription.unsubscribe(),e.activeViewSubscription=null),e.activeView=a,a&&(e.activeViewSubscription=a.onModified(t.modified)),t.modified(),t.invokeActiveViewChange(a))},t.getProxyById=function(a){return e.proxyIdMapping[a]},t.getProxyGroups=function(){return Object.keys(e.proxyByGroup)},t.getProxyInGroup=function(a){return[].concat(e.proxyByGroup[a]||[])},t.getSources=function(){return[].concat(e.proxyByGroup.Sources||[])},t.getRepresentations=function(){return[].concat(e.proxyByGroup.Representations||[])},t.getViews=function(){return[].concat(e.proxyByGroup.Views||[])},t.createProxy=function(a,i,o){var s=e.proxyConfiguration.definitions;if(!s[a]||!s[a][i])return null;var f=s[a][i],c=Jr(Jr({},f.options),o),u=f.class.newInstance(Jr(Jr({},c),{},{proxyGroup:a,proxyName:i,proxyManager:t}));if(f.proxyProps){var v={};Object.keys(f.proxyProps).forEach(function(g){var p=f.proxyProps[g];v[g]=t.createProxy(p.group,p.name,p.options)}),u.set(v)}return f.props&&u.set(f.props),r(u),c.activateOnCreate&&u.activate(),u},t.getRepresentation=function(a,i){var o=a||t.getActiveSource(),s=i||t.getActiveView();if(!o||!s||!o.getType())return null;var f=o.getProxyId(),c=s.getProxyId(),u=e.sv2rMapping[f];u||(u={},e.sv2rMapping[f]=u);var v=u[c];if(!v){var g=s.getProxyName(),p=o.getType(),l=e.proxyConfiguration.representations[g][p];if(!l)return hd("No definition for representation of ".concat(p," in view ").concat(g)),null;v=t.createProxy("Representations",l.name,l.options),e.r2svMapping[v.getProxyId()]={sourceId:f,viewId:c},u[c]=v,v.setInput(o),s.addRepresentation(v)}return v},t.deleteProxy=function(a){var i=a.getProxyGroup().toLowerCase();if(i==="views")a.getRepresentations().forEach(function(v){t.deleteProxy(v)}),a.setContainer(null),n(a),t.getActiveView()===a&&t.setActiveView(t.getViews()[0]);else if(i==="representations"){var o=e.r2svMapping[a.getProxyId()],s=o.sourceId,f=o.viewId,c=t.getProxyById(f);c.removeRepresentation(a),delete e.r2svMapping[a.getProxyId()],delete e.sv2rMapping[s][f],n(a)}else if(i==="sources"){var u=e.sv2rMapping[a.getProxyId()];Object.keys(u).forEach(function(v){t.deleteProxy(u[v])}),n(a),t.getActiveSource()===a&&t.setActiveSource(t.getSources()[0])}else n(a);a.delete()}}var Qr=T.vtkErrorMacro;function Td(t,e){e.classHierarchy.push("vtkPiecewiseFunction"),t.getSize=function(){return e.nodes.length},t.getType=function(){var r,n=0,a=0;e.nodes.length>0&&(n=e.nodes[0].y);for(var i=1;i<e.nodes.length;i++){if(r=e.nodes[i].y,r!==n)if(r>n)switch(a){case 0:case 1:a=1;break;case 2:default:a=3;break}else switch(a){case 0:case 2:a=2;break;case 1:default:a=3;break}if(n=r,a===3)break}switch(a){case 0:return"Constant";case 1:return"NonDecreasing";case 2:return"NonIncreasing";case 3:default:return"Varied"}},t.getDataPointer=function(){var r=e.nodes.length;if(e.function=null,r>0){e.function=[];for(var n=0;n<r;n++)e.function[2*n]=e.nodes[n].x,e.function[2*n+1]=e.nodes[n].y}return e.function},t.getFirstNonZeroValue=function(){if(e.nodes.length===0)return 0;for(var r=1,n=0,a=0;a<e.nodes.length;a++)if(e.nodes[a].y!==0){r=0;break}return r?n=Number.MAX_VALUE:a>0?n=e.nodes[a-1].x:e.clamping?n=-Number.MAX_VALUE:n=e.nodes[0].x,n},t.getNodeValue=function(r,n){var a=e.nodes.length;return r<0||r>=a?(Qr("Index out of range!"),-1):(n[0]=e.nodes[r].x,n[1]=e.nodes[r].y,n[2]=e.nodes[r].midpoint,n[3]=e.nodes[r].sharpness,1)},t.setNodeValue=function(r,n){var a=e.nodes.length;if(r<0||r>=a)return Qr("Index out of range!"),-1;var i=e.nodes[r].x;return e.nodes[r].x=n[0],e.nodes[r].y=n[1],e.nodes[r].midpoint=n[2],e.nodes[r].sharpness=n[3],i!==n[0]?t.sortAndUpdateRange():t.modified(),1},t.addPoint=function(r,n){return t.addPointLong(r,n,.5,0)},t.addPointLong=function(r,n,a,i){if(a<0||a>1)return Qr("Midpoint outside range [0.0, 1.0]"),-1;if(i<0||i>1)return Qr("Sharpness outside range [0.0, 1.0]"),-1;e.allowDuplicateScalars||t.removePoint(r);var o={x:r,y:n,midpoint:a,sharpness:i};e.nodes.push(o),t.sortAndUpdateRange();var s;for(s=0;s<e.nodes.length&&e.nodes[s].x!==r;s++);return s<e.nodes.length?s:-1},t.setNodes=function(r){e.nodes!==r&&(e.nodes=r,t.sortAndUpdateRange())},t.sortAndUpdateRange=function(){e.nodes.sort(function(n,a){return n.x-a.x});var r=t.updateRange();r||t.modified()},t.updateRange=function(){var r=e.range.slice(),n=e.nodes.length;return n?(e.range[0]=e.nodes[0].x,e.range[1]=e.nodes[n-1].x):(e.range[0]=0,e.range[1]=0),r[0]===e.range[0]&&r[1]===e.range[1]?!1:(t.modified(),!0)},t.removePoint=function(r){var n;for(n=0;n<e.nodes.length&&e.nodes[n].x!==r;n++);if(n>=e.nodes.length)return-1;var a=n,i=!1;return e.nodes.splice(n,1),(n===0||n===e.nodes.length)&&(i=t.updateRange()),i||t.modified(),a},t.removeAllPoints=function(){e.nodes=[],t.sortAndUpdateRange()},t.addSegment=function(r,n,a,i){t.sortAndUpdateRange();for(var o=0;o<e.nodes.length;)e.nodes[o].x>=r&&e.nodes[o].x<=a?e.nodes.splice(o,1):o++;t.addPoint(r,n,.5,0),t.addPoint(a,i,.5,0)},t.getValue=function(r){var n=[];return t.getTable(r,r,1,n),n[0]},t.adjustRange=function(r){if(r.length<2)return 0;var n=t.getRange();n[0]<r[0]?t.addPoint(r[0],t.getValue(r[0])):t.addPoint(r[0],t.getValue(n[0])),n[1]>r[1]?t.addPoint(r[1],t.getValue(r[1])):t.addPoint(r[1],t.getValue(n[1])),t.sortAndUpdateRange();for(var a=0;a<e.nodes.length;)e.nodes[a].x>=r[0]&&e.nodes[a].x<=r[1]?e.nodes.splice(a,1):++a;return t.sortAndUpdateRange(),1},t.estimateMinNumberOfSamples=function(r,n){var a=t.findMinimumXDistance();return Math.ceil((n-r)/a)},t.findMinimumXDistance=function(){var r=e.nodes.length;if(r<2)return-1;for(var n=e.nodes[1].x-e.nodes[0].x,a=0;a<r-1;a++){var i=e.nodes[a+1].x-e.nodes[a].x;i<n&&(n=i)}return n},t.getTable=function(r,n,a,i){var o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,s,f=0,c=e.nodes.length,u=0;c!==0&&(u=e.nodes[c-1].y);var v=0,g=0,p=0,l=0,h=0,y=0,C=0;for(s=0;s<a;s++){var S=o*s;for(a>1?v=r+s/(a-1)*(n-r):v=.5*(r+n);f<c&&v>e.nodes[f].x;)f++,f<c&&(g=e.nodes[f-1].x,p=e.nodes[f].x,l=e.nodes[f-1].y,h=e.nodes[f].y,y=e.nodes[f-1].midpoint,C=e.nodes[f-1].sharpness,y<1e-5&&(y=1e-5),y>.99999&&(y=.99999));if(f>=c)i[S]=e.clamping?u:0;else if(f===0)i[S]=e.clamping?e.nodes[0].y:0;else{var d=(v-g)/(p-g);if(d<y?d=.5*d/y:d=.5+.5*(d-y)/(1-y),C>.99)if(d<.5){i[S]=l;continue}else{i[S]=h;continue}if(C<.01){i[S]=(1-d)*l+d*h;continue}d<.5?d=.5*Math.pow(d*2,1+10*C):d>.5&&(d=1-.5*Math.pow((1-d)*2,1+10*C));var O=d*d,w=O*d,M=2*w-3*O+1,x=-2*w+3*O,D=w-2*O+d,R=w-O,V=h-l,E=(1-C)*V;i[S]=M*l+x*h+D*E+R*E;var L=l<h?l:h,m=l>h?l:h;i[S]=i[S]<L?L:i[S],i[S]=i[S]>m?m:i[S]}}}}var Cd={range:[0,0],clamping:!0,allowDuplicateScalars:!1};function sv(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Cd,r),T.obj(t,e),e.nodes=[],T.setGet(t,e,["allowDuplicateScalars","clamping"]),T.setArray(t,e,["range"],2),T.getArray(t,e,["range"]),Td(t,e)}var Sd=T.newInstance(sv,"vtkPiecewiseFunction"),Ga={newInstance:Sd,extend:sv};function dd(t,e){var r=e===void 0?null:e,n=/(['"])__worker_loader_strict__(['"])/g,a=[],i=t.toString();return i=i.replace(n,"$1use strict$2"),a.push("("+i+")()"),r&&a.push("//# sourceMappingURL="+r+`
`),a}function Od(t,e){var r=dd(t,e),n=new Blob(r,{type:"application/javascript"});return URL.createObjectURL(n)}function wd(t,e){var r;return function(a){return r=r||Od(t,e),new Worker(r,a)}}var xd=wd(function(){(function(){"__worker_loader_strict__";var t={exports:{}},e=function(){function x(D,R){for(var V=0;V<R.length;V++){var E=R[V];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(D,E.key,E)}}return function(D,R,V){return R&&x(D.prototype,R),V&&x(D,V),D}}();function r(x,D){if(!(x instanceof D))throw new TypeError("Cannot call a class as a function")}var n=function(){function x(){r(this,x),Object.defineProperty(this,"__listeners",{value:{},enumerable:!1,writable:!1})}return e(x,[{key:"emit",value:function(R){if(!this.__listeners[R])return this;for(var V=arguments.length,E=Array(V>1?V-1:0),L=1;L<V;L++)E[L-1]=arguments[L];var m=!0,N=!1,_=void 0;try{for(var G=this.__listeners[R][Symbol.iterator](),k;!(m=(k=G.next()).done);m=!0){var U=k.value;U.apply(void 0,E)}}catch(B){N=!0,_=B}finally{try{!m&&G.return&&G.return()}finally{if(N)throw _}}return this}},{key:"once",value:function(R,V){var E=this,L=function m(){E.off(R,m),V.apply(void 0,arguments)};return this.on(R,L)}},{key:"on",value:function(R,V){return this.__listeners[R]||(this.__listeners[R]=[]),this.__listeners[R].push(V),this}},{key:"off",value:function(R,V){return V?this.__listeners[R]=this.__listeners[R].filter(function(E){return E!==V}):this.__listeners[R]=[],this}}]),x}(),a=n,i=function(){function x(D,R){for(var V=0;V<R.length;V++){var E=R[V];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(D,E.key,E)}}return function(D,R,V){return R&&x(D.prototype,R),V&&x(D,V),D}}(),o=function x(D,R,V){D===null&&(D=Function.prototype);var E=Object.getOwnPropertyDescriptor(D,R);if(E===void 0){var L=Object.getPrototypeOf(D);return L===null?void 0:x(L,R,V)}else{if("value"in E)return E.value;var m=E.get;return m===void 0?void 0:m.call(V)}},s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(x){return typeof x}:function(x){return x&&typeof Symbol=="function"&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x};function f(x){if(Array.isArray(x)){for(var D=0,R=Array(x.length);D<x.length;D++)R[D]=x[D];return R}else return Array.from(x)}function c(x,D){if(!(x instanceof D))throw new TypeError("Cannot call a class as a function")}function u(x,D){if(!x)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D&&(typeof D=="object"||typeof D=="function")?D:x}function v(x,D){if(typeof D!="function"&&D!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof D);x.prototype=Object.create(D&&D.prototype,{constructor:{value:x,enumerable:!1,writable:!0,configurable:!0}}),D&&(Object.setPrototypeOf?Object.setPrototypeOf(x,D):x.__proto__=D)}function g(x,D,R){return D in x?Object.defineProperty(x,D,{value:R,enumerable:!0,configurable:!0,writable:!0}):x[D]=R,x}var p=a,l=0,h=1,y=0,C=1,S="main",d=function(D){return(typeof D>"u"?"undefined":s(D))==="object"&&D!==null&&typeof D.then=="function"&&typeof D.catch=="function"};function O(x){var D=g({},S,x),R=self.postMessage.bind(self),V=new(function(_){v(G,_);function G(){return c(this,G),u(this,(G.__proto__||Object.getPrototypeOf(G)).apply(this,arguments))}return i(G,[{key:"emit",value:function(U){for(var B=arguments.length,j=Array(B>1?B-1:0),H=1;H<B;H++)j[H-1]=arguments[H];return j.length==1&&j[0]instanceof w?R({eventName:U,args:j},j[0].transferable):R({eventName:U,args:j}),this}},{key:"emitLocally",value:function(U){for(var B,j=arguments.length,H=Array(j>1?j-1:0),X=1;X<j;X++)H[X-1]=arguments[X];(B=o(G.prototype.__proto__||Object.getPrototypeOf(G.prototype),"emit",this)).call.apply(B,[this,U].concat(H))}},{key:"operation",value:function(U,B){return D[U]=B,this}}]),G}(p)),E=function(G,k,U){var B=function(Y){Y&&Y instanceof w?m(G,C,Y.payload,Y.transferable):m(G,C,Y)},j=function(Y){m(G,y,{message:Y.message,stack:Y.stack})};try{var H=L(G,k,U);d(H)?H.then(B).catch(j):B(H)}catch(X){j(X)}},L=function(G,k,U){var B=D[U||S];if(!B)throw new Error("Not found handler for this request");return B(k,N.bind(null,G))},m=function(G,k,U){var B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];R([l,G,k,U],B)},N=function(G,k,U){if(!k)throw new Error("eventName is required");if(typeof k!="string")throw new Error("eventName should be string");R([h,G,k,U])};return self.addEventListener("message",function(_){var G=_.data;Array.isArray(G)?E.apply(void 0,f(G)):G&&G.eventName&&V.emitLocally.apply(V,[G.eventName].concat(f(G.args)))}),V}var w=function x(D,R){c(this,x),this.payload=D,this.transferable=R};t.exports=O,t.exports.TransferableResponse=w;var M=t.exports;M(function(x,D){var R=x.array,V=x.min,E=x.max,L=x.component||0,m=x.numberOfComponents||1,N=x.numberOfBins,_=E-V,G=new Float32Array(N);G.fill(0);for(var k=R.length,U=L;U<k;U+=m){var B=Math.floor((N-1)*(Number(R[U])-V)/_);G[B]+=1}return Promise.resolve(new M.TransferableResponse(G,[G.buffer]))})})()},null);function vu(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function Bn(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?vu(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):vu(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var Ba=.001,yi={adjustPosition:"-webkit-grab",adjustHeight:"row-resize",adjustBias:"crosshair",adjustWidth:"col-resize",adjustZoom:"col-resize"},He=[],Ti={adjustPosition:function(e,r,n){var a=n.originalXY,i=n.gaussian,o=n.originalGaussian,s=o.position-a[0];return i.position=e+s,!0},adjustHeight:function(e,r,n){var a=n.model,i=n.gaussian;return i.height=1-r,i.height=Math.min(1,Math.max(a.gaussianMinimumHeight,i.height)),!0},adjustBias:function(e,r,n){var a=n.originalXY,i=n.gaussian,o=n.originalGaussian;return i.xBias=o.xBias-(a[0]-e)/i.height,i.yBias=o.yBias+4*(a[1]-r)/i.height,i.xBias=Math.max(-1,Math.min(1,i.xBias)),i.yBias=Math.max(0,Math.min(2,i.yBias)),!0},adjustWidth:function(e,r,n){var a=n.originalXY,i=n.gaussian,o=n.originalGaussian,s=n.gaussianSide;return i.width=s<0?o.width-(a[0]-e):o.width+(a[0]-e),i.width<Ba&&(i.width=Ba),!0},adjustZoom:function(e,r,n){var a=n.rangeZoom,i=n.publicAPI,o=a[1]-a[0],s=(e-a[0])/o,f=Math.abs(s-a[0]),c=Math.abs(s-a[1]),u=Math.abs(s-.5*(a[0]+a[1]));if(u<Math.min(f,c)){var v=o*.5;a[0]=Math.min(Math.max(s-v,0),a[1]-.1),a[1]=Math.max(Math.min(s+v,1),a[0]+.1)}else f<c?a[0]=Math.min(Math.max(s,0),a[1]-.1):a[1]=Math.max(Math.min(s,1),a[0]+.1);return i.invokeZoomChange(a),!1}};function hn(t){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:256,r=[];r.length<e;)r.push(0);for(var n=t.length;n--;)for(var a=t[n],i=a.position,o=a.height,s=a.width,f=a.xBias,c=a.yBias,u=0;u<e;u++){var v=u/(e-1);if(v>i+s||v<i-s){r[u]<0&&(r[u]=0);continue}var g=s<Ba?Ba:s,p=0;f===0||v===i+f?p=v:v>i+f?g===f?p=i:p=i+(v-i-f)*(g/(g-f)):-g===f?p=i:p=i-(v-i-f)*(g/(g+f));var l=(p-i)/g,h=Math.exp(-(4*l*l)),y=1-l*l,C=1,S=void 0;c<1?S=c*y+(1-c)*h:S=(2-c)*y+(c-1)*C;var d=o*S;d>r[u]&&(r[u]=d)}return r}function Md(t,e,r,n){for(var a=hn(t,e),i=[],o=(r[1]-r[0])/(a.length-1),s=.5,f=0,c=0;c<a.length;c++){var u=r[0]+o*c,v=a[c];i.push({x:u,y:v,midpoint:s,sharpness:f})}n.setNodes(i)}function _n(t,e,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{lineWidth:1,strokeStyle:"#000"},a=e[3],i=e[2]/(r.length-1),o=!!n.fillStyle,s=a+e[1];t.lineWidth=n.lineWidth,t.strokeStyle=n.strokeStyle,t.beginPath(),t.moveTo(e[0],e[1]+e[3]);for(var f=0;f<r.length;f++)t.lineTo(e[0]+f*i,Math.max(e[1],s-r[f]*a));if(o){if(t.fillStyle=n.fillStyle,t.lineTo(e[0]+e[2],e[1]+e[3]),n.clip){t.clip();return}t.fill()}t.stroke()}function Dd(t,e,r,n){var a=n||document.createElement("canvas");a.setAttribute("width",e),a.setAttribute("height",256);for(var i=a.getContext("2d"),o=t.getUint8Table(r[0],r[1],e,4),s=i.getImageData(0,0,e,256),f=0;f<256;f++)s.data.set(o,f*4*e);for(var c=256*e*4,u=e*4,v=3;v<c;v+=4)s.data[v]=255-Math.floor(v/u);return i.putImageData(s,0,0),a}function Ed(t,e,r){var n=r||document.createElement("canvas");n.setAttribute("width",e),n.setAttribute("height",256);var a=n.getContext("2d");return a.drawImage(t,0,0,t.width,t.height,0,0,e,256),n}function Pt(t,e,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[0,1];return[n[0]+(t-r[0])/r[2]*(n[1]-n[0]),(e-r[1])/r[3]]}function yr(t,e){var r=e.map(function(a){return Math.abs(a.position-t)}),n=Math.min.apply(Math,W(r));return r.indexOf(n)}function kt(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function(r){var n=r.offsetX,a=r.offsetY;e&&r.preventDefault(),t(n,a)}}function Rd(){for(var t=He.length,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return He.push({callbacks:r,timeout:0,deltaT:200,count:0,ready:!1}),t}function Vd(){He.filter(function(t){return t.ready}).forEach(function(t){t.callbacks.forEach(function(e){e.touches===t.touches&&e.clicks===t.count&&e.action.apply(e,W(t.singleTouche))}),t.ts=0,t.count=0,t.touches=0,t.ready=!1})}function Ir(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;return function(a){var i=a.target.getBoundingClientRect(),o=Array.prototype.map.call(a.touches,function(f){return[f.pageX-i.left,f.pageY-i.top]}),s=o.reduce(function(f,c){return[f[0]+c[0],f[1]+c[1]]},[0,0]).map(function(f){return f/a.touches.length});a.type==="touchstart"?(clearTimeout(He[t].timeout),He[t].ts=a.timeStamp,He[t].singleTouche=s,He[t].touches=a.touches.length):a.type==="touchmove"?(He[t].ts=0,He[t].count=0,He[t].ready=!1):a.type==="touchend"&&(a.timeStamp-He[t].ts<He[t].deltaT?(He[t].count+=1,He[t].ready=!0,n&&a.preventDefault(),He[t].timeout=setTimeout(Vd,He[t].deltaT)):He[t].ready=!1),a.touches.length===r&&(e.apply(void 0,W(s)),n&&a.preventDefault())}}function to(t,e,r){return function(n){return t()?e(n):r(n)}}function rr(t,e){if(!e)return t;var r=t.length-1,n=e.map(function(a){return Math.round(a*r)});return t.slice(n[0],n[1]+1)}function Ld(t,e){return e?(t-e[0])/(e[1]-e[0]):t}var md={applyGaussianToPiecewiseFunction:Md,computeOpacities:hn,createListener:kt,drawChart:_n,findGaussian:yr,listenerSelector:to,normalizeCoordinates:Pt};function kd(t,e){e.classHierarchy.push("vtkPiecewiseGaussianWidget"),e.canvas||(e.canvas=document.createElement("canvas")),t.setContainer=function(a){e.container&&e.container!==a&&e.container.removeChild(e.canvas),e.container!==a&&(e.container=a,e.container&&e.container.appendChild(e.canvas),t.modified())},t.setGaussians=function(a){e.gaussians!==a&&(e.gaussians=a,e.opacities=hn(e.gaussians,e.piecewiseSize),t.invokeOpacityChange(t),t.modified())},t.addGaussian=function(a,i,o,s,f){var c=e.gaussians.length;return e.gaussians.push({position:a,height:i,width:o,xBias:s,yBias:f}),e.opacities=hn(e.gaussians,e.piecewiseSize),t.invokeOpacityChange(t),t.modified(),c},t.removeGaussian=function(a){e.gaussians.splice(a,1),e.opacities=hn(e.gaussians,e.piecewiseSize),t.invokeOpacityChange(t),t.modified()},t.setSize=function(a,i){e.canvas.setAttribute("width",a),e.canvas.setAttribute("height",i),(e.size[0]!==a||e.size[1]!==i)&&(e.size=[a,i],e.colorCanvasMTime=0,t.modified())},t.updateStyle=function(a){e.style=Bn(Bn({},e.style),a),t.modified()},t.setDataArray=function(a){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=i.numberOfBinToConsiders,s=o===void 0?1:o,f=i.numberOfBinsToSkip,c=f===void 0?1:f,u=i.numberOfComponents,v=u===void 0?1:u,g=i.component,p=g===void 0?0:g;e.histogram=null,e.histogramArray=a,e.dataRange=fc(a,p,v);var l=ne(e.dataRange,2),h=l[0],y=l[1],C=4,S=Math.floor(a.length/C)||1;S+=S%v;for(var d=0,O=[],w=[];d<a.length;){var M=new xd;w.push(M);var x=new J0(M),D=d,R=Math.min(d+S,a.length-1),V=new a.constructor(a.slice(D,R+1));O.push(x.postMessage({array:V,component:p,numberOfComponents:v,min:h,max:y,numberOfBins:e.numberOfBins},[V.buffer])),d+=S}Promise.all(O).then(function(E){w.forEach(function(U){return U.terminate()}),e.histogram=new Float32Array(e.numberOfBins),e.histogram.fill(0),E.forEach(function(U){for(var B=0,j=U.length;B<j;++B)e.histogram[B]+=U[B]});var L=Math.min(s,e.histogram.length-c),m=Array.from(e.histogram);m.sort(function(U,B){return Number(U)-Number(B)});for(var N=0;N<c;N++)m.pop();for(;m.length>L;)m.shift();for(var _=m.reduce(function(U,B){return U+B},0)/L,G=0,k=e.histogram.length;G<k;++G)e.histogram[G]/=_;t.modified(),setTimeout(t.render,0)}),t.modified()},t.onClick=function(a,i){var o=Pt(a,i,e.graphArea,e.enableRangeZoom?e.rangeZoom:null),s=ne(o,2),f=s[0],c=s[1];if(f<0&&e.style.iconSize>1){for(var u=e.style.iconSize+e.style.padding,v=u,g=0;i>v;)g+=1,v+=u;switch(g){case 0:{var p=t.addGaussian(0,1,.1,0,0),l=e.gaussians[p],h=Bn({},l),y=Ti.adjustPosition;e.activeGaussian=p,e.selectedGaussian=p,T.setImmediate(function(){t.onDown(a,i),e.dragAction={originalXY:[0,0],action:y,gaussian:l,originalGaussian:h}});break}case 1:{e.selectedGaussian!==-1&&t.removeGaussian(e.selectedGaussian);break}default:e.selectedGaussian=-1,e.dragAction=null}}else if(f<0||f>1||c<0||c>1)e.selectedGaussian=-1,e.dragAction=null;else{var C=yr(f,e.gaussians);C!==e.selectedGaussian&&(e.selectedGaussian=C,t.modified())}return!0},t.onHover=function(a,i){var o=20/e.canvas.height,s=Pt(a,i,e.graphArea,e.enableRangeZoom?e.rangeZoom:null),f=ne(s,2),c=f[0],u=f[1],v=Pt(a,i,e.graphArea),g=ne(v,1),p=g[0],l=c<0?e.selectedGaussian:yr(c,e.gaussians);e.canvas.style.cursor="default";var h=e.gaussians[l];if(e.enableRangeZoom&&p>=0&&i<e.graphArea[1]-6){var y=(e.rangeZoom[1]-e.rangeZoom[0])/3;p<e.rangeZoom[0]+y||p>e.rangeZoom[1]-y?e.canvas.style.cursor=yi.adjustZoom:e.canvas.style.cursor=yi.adjustPosition,e.dragAction={rangeZoom:e.rangeZoom,action:Ti.adjustZoom}}else if(h&&p>=0){var C=1-u,S=null;C>h.height+o?S="adjustPosition":C>h.height-o?Math.abs(c-h.position)<o?S="adjustHeight":S="adjustPosition":C>h.height*.5+o?S="adjustPosition":C>h.height*.5-o?Math.abs(c-h.position)<o?S="adjustBias":S="adjustPosition":C>o?S="adjustPosition":S="adjustWidth",e.canvas.style.cursor=yi[S];var d=Ti[S],O=Bn({},h);e.dragAction={originalXY:[c,u],action:d,gaussian:h,originalGaussian:O}}return l!==e.activeGaussian&&(e.activeGaussian=l,t.modified()),!0},t.onDown=function(a,i){e.mouseIsDown||t.invokeAnimation(!0),e.mouseIsDown=!0;var o=Pt(a,i,e.graphArea,e.enableRangeZoom?e.rangeZoom:null)[0],s=yr(o,e.gaussians);e.gaussianSide=0;var f=e.gaussians[s];return f&&(e.gaussianSide=f.position-o),s!==e.selectedGaussian&&o>0&&(e.selectedGaussian=s,t.modified()),!0},t.onDrag=function(a,i){if(e.dragAction){var o=Pt(a,i,e.graphArea,e.enableRangeZoom?e.rangeZoom:null),s=ne(o,2),f=s[0],c=s[1],u=e.dragAction.action;u(f,c,Bn({gaussianSide:e.gaussianSide,model:e,publicAPI:t},e.dragAction))&&(e.opacities=hn(e.gaussians,e.piecewiseSize),t.invokeOpacityChange(t,!0)),t.modified()}return!0},t.onUp=function(a,i){return e.mouseIsDown&&t.invokeAnimation(!1),e.mouseIsDown=!1,!0},t.onLeave=function(a,i){return t.onUp(a,i),e.canvas.style.cursor="default",e.activeGaussian=-1,t.modified(),!0},t.onAddGaussian=function(a,i){var o=Pt(a,i,e.graphArea,e.enableRangeZoom?e.rangeZoom:null),s=ne(o,2),f=s[0],c=s[1];return f>=0&&t.addGaussian(f,1-c,.1,0,0),!0},t.onRemoveGaussian=function(a,i){var o=Pt(a,i,e.graphArea,e.enableRangeZoom?e.rangeZoom:null)[0],s=yr(o,e.gaussians);return o>=0&&s!==-1&&t.removeGaussian(s),!0},t.bindMouseListeners=function(){if(!e.listeners){var a=function(){return!!e.mouseIsDown},i=Rd({clicks:1,touches:1,action:t.onClick},{clicks:2,touches:1,action:t.onAddGaussian},{clicks:2,touches:2,action:t.onRemoveGaussian});e.listeners={mousemove:to(a,kt(t.onDrag),kt(t.onHover)),dblclick:kt(t.onAddGaussian),contextmenu:kt(t.onRemoveGaussian),click:kt(t.onClick),mouseup:kt(t.onUp),mousedown:kt(t.onDown),mouseout:kt(t.onLeave),touchstart:Ir(i,T.chain(t.onHover,t.onDown)),touchmove:to(a,Ir(i,t.onDrag),Ir(i,t.onHover)),touchend:Ir(i,t.onUp,0)},Object.keys(e.listeners).forEach(function(o){e.canvas.addEventListener(o,e.listeners[o],!1)})}},t.unbindMouseListeners=function(){e.listeners&&(Object.keys(e.listeners).forEach(function(a){e.canvas.removeEventListener(a,e.listeners[a])}),delete e.listeners)},t.render=function(){var a=e.canvas.getContext("2d");a.imageSmoothingEnabled=!0;var i=ne(e.size,2),o=i[0],s=i[1],f=e.style.padding,c=[Math.floor(e.style.iconSize+f),Math.floor(f),Math.ceil(o-2*f-e.style.iconSize),Math.ceil(s-2*f)],u=e.style.zoomControlHeight;if(e.enableRangeZoom&&(c[1]+=Math.floor(u),c[3]-=Math.floor(u)),e.graphArea=c,a.clearRect(0,0,o,s),a.lineJoin="round",a.fillStyle=e.style.backgroundColor,a.fillRect.apply(a,c),e.style.iconSize>1){var v=Math.round(e.style.iconSize/2-e.style.strokeWidth),g=Math.round(v+f+e.style.strokeWidth);a.beginPath(),a.lineWidth=e.style.buttonStrokeWidth,a.strokeStyle=e.style.buttonStrokeColor,a.arc(g-f/2,g,v,0,2*Math.PI,!1),a.fillStyle=e.style.buttonFillColor,a.fill(),a.stroke(),a.moveTo(g-v+e.style.strokeWidth+2-f/2,g),a.lineTo(g+v-e.style.strokeWidth-2-f/2,g),a.stroke(),a.moveTo(g-f/2,g-v+e.style.strokeWidth+2),a.lineTo(g-f/2,g+v-e.style.strokeWidth-2),a.stroke(),e.selectedGaussian===-1?(a.fillStyle=e.style.buttonDisableFillColor,a.lineWidth=e.style.buttonDisableStrokeWidth,a.strokeStyle=e.style.buttonDisableStrokeColor):(a.fillStyle=e.style.buttonFillColor,a.lineWidth=e.style.buttonStrokeWidth,a.strokeStyle=e.style.buttonStrokeColor),a.beginPath(),a.arc(g-f/2,g+f/2+e.style.iconSize,v,0,2*Math.PI,!1),a.fill(),a.stroke(),a.moveTo(g-v+e.style.strokeWidth+2-f/2,g+f/2+e.style.iconSize),a.lineTo(g+v-e.style.strokeWidth-2-f/2,g+f/2+e.style.iconSize),a.stroke()}if(e.histogram&&_n(a,c,rr(e.histogram,e.rangeZoom),{lineWidth:1,strokeStyle:e.style.histogramColor,fillStyle:e.style.histogramColor}),_n(a,c,rr(e.opacities,e.enableRangeZoom&&e.rangeZoom),{lineWidth:e.style.strokeWidth,strokeStyle:e.style.strokeColor}),e.colorTransferFunction&&e.colorTransferFunction.getSize()){var p=e.dataRange||e.colorTransferFunction.getMappingRange();(!e.colorCanvas||e.colorCanvasMTime!==e.colorTransferFunction.getMTime())&&(e.colorCanvasMTime=e.colorTransferFunction.getMTime(),e.colorCanvas=Dd(e.colorTransferFunction,c[2],p,e.colorCanvas)),a.save(),_n(a,c,rr(e.opacities,e.enableRangeZoom&&e.rangeZoom),{lineWidth:1,strokeStyle:"rgba(0,0,0,0)",fillStyle:"rgba(0,0,0,1)",clip:!0}),e.enableRangeZoom?a.drawImage(e.colorCanvas,e.rangeZoom[0]*c[2],0,c[2],c[3],c[0],c[1],c[2]/(e.rangeZoom[1]-e.rangeZoom[0]),c[3]):a.drawImage(e.colorCanvas,c[0],c[1]),a.restore()}else e.backgroundImage&&(e.colorCanvas=Ed(e.backgroundImage,c[2],e.colorCanvas),a.save(),_n(a,c,rr(e.opacities,e.enableRangeZoom&&e.rangeZoom),{lineWidth:1,strokeStyle:"rgba(0,0,0,0)",fillStyle:"rgba(0,0,0,1)",clip:!0}),a.drawImage(e.colorCanvas,c[0],c[1]),a.restore());e.enableRangeZoom&&(a.fillStyle=e.style.zoomControlColor,a.beginPath(),a.rect(c[0]+e.rangeZoom[0]*c[2],0,(e.rangeZoom[1]-e.rangeZoom[0])*c[2],u),a.fill());var l=e.gaussians[e.activeGaussian]||e.gaussians[e.selectedGaussian];if(l){var h=hn([l],c[2]);_n(a,c,rr(h,e.enableRangeZoom&&e.rangeZoom),{lineWidth:e.style.activeStrokeWidth,strokeStyle:e.style.activeColor});var y=c[0]+Ld(l.position,e.enableRangeZoom&&e.rangeZoom)*c[2],C=c[1]+(1-l.height)*c[3],S=c[1]+(1-.5*l.height)*c[3],d=c[1]+c[3],O=l.width*c[2];e.enableRangeZoom&&(O/=e.rangeZoom[1]-e.rangeZoom[0]),a.lineWidth=e.style.handleWidth,a.strokeStyle=e.style.handleColor,a.fillStyle=e.style.backgroundColor,a.beginPath(),a.moveTo(y,c[1]+(1-l.height)*c[3]),a.lineTo(y,c[1]+c[3]),a.stroke(),a.beginPath(),a.arc(y,C,6,0,2*Math.PI),a.fill(),a.stroke();var w=Math.min(O*.1,l.height*c[3]*.2);a.beginPath(),a.rect(y-w,S-w,w*2,w*2),a.fill(),a.stroke(),a.beginPath();var M=O*.8;a.rect(y-M,d-5,2*M,10),a.fill(),a.stroke()}},t.getOpacityNodes=function(a){for(var i=a||e.dataRange,o=(i[1]-i[0])/(e.opacities.length-1),s=[],f=.5,c=0,u=0;u<e.opacities.length;u++){var v=i[0]+o*u,g=e.opacities[u];s.push({x:v,y:g,midpoint:f,sharpness:c})}return s},t.applyOpacity=function(a,i){var o=t.getOpacityNodes(i);a.setNodes(o)},t.getOpacityRange=function(a){for(var i=a||e.dataRange,o=(i[1]-i[0])/(e.opacities.length-1),s=e.opacities.length-1,f=0,c=0;c<e.opacities.length;c++)e.opacities[c]>0&&(s=Math.min(s,c)),e.opacities[c]>0&&(f=Math.max(f,c));return[i[0]+s*o,i[0]+f*o]};var r=t.setEnableRangeZoom;t.setEnableRangeZoom=function(a){var i=r(a);return i&&(e.colorCanvasMTime=0,e.rangeZoom=[0,1]),i};var n=t.setRangeZoom;t.setRangeZoom=function(){var a=n.apply(void 0,arguments);return a&&(e.colorCanvasMTime=0),a},t.onModified(function(){return t.render()}),t.setSize.apply(t,W(e.size))}var Fd={histogram:[],numberOfBins:256,histogramArray:null,dataRange:[0,1],gaussians:[],opacities:[],size:[600,300],piecewiseSize:256,colorCanvasMTime:0,gaussianMinimumHeight:.05,style:{backgroundColor:"rgba(255, 255, 255, 1)",histogramColor:"rgba(200, 200, 200, 0.5)",strokeColor:"rgb(0, 0, 0)",activeColor:"rgb(0, 0, 150)",buttonDisableFillColor:"rgba(255, 255, 255, 0.5)",buttonDisableStrokeColor:"rgba(0, 0, 0, 0.5)",buttonStrokeColor:"rgba(0, 0, 0, 1)",buttonFillColor:"rgba(255, 255, 255, 1)",handleColor:"rgb(0, 150, 0)",strokeWidth:2,activeStrokeWidth:3,buttonStrokeWidth:1.5,handleWidth:3,iconSize:20,padding:10,zoomControlHeight:10,zoomControlColor:"#999"},activeGaussian:-1,selectedGaussian:-1,enableRangeZoom:!0,rangeZoom:[0,1]};function uv(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Fd,r),T.obj(t,e),T.setGet(t,e,["piecewiseSize","numberOfBins","colorTransferFunction","backgroundImage","enableRangeZoom","gaussianMinimumHeight"]),T.setGetArray(t,e,["rangeZoom"],2),T.get(t,e,["size","canvas","gaussians"]),T.event(t,e,"opacityChange"),T.event(t,e,"animation"),T.event(t,e,"zoomChange"),kd(t,e)}var Nd=T.newInstance(uv,"vtkPiecewiseGaussianWidget"),Ud=Bn({newInstance:Nd,extend:uv},md),Gd={Gaussians:[{position:.5,height:1,width:.5,xBias:.5,yBias:.5}],Points:[[0,0],[1,1]],Nodes:[{x:0,y:0,midpoint:.5,sharpness:0},{x:1,y:1,midpoint:.5,sharpness:0}]},Bd={Gaussians:0,Points:1,Nodes:2},fv={Defaults:Gd,Mode:Bd};function pu(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function no(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?pu(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):pu(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var Vr=fv.Mode,Sn=fv.Defaults;function _d(t,e,r){var n=e[1]-e[0],a=t.map(function(i){var o=ne(i,2),s=o[0],f=o[1];return[s*n+e[0],f]});r.removeAllPoints(),a.forEach(function(i){var o=ne(i,2),s=o[0],f=o[1];return r.addPoint(s,f)})}function jd(t,e,r){var n=e[1]-e[0],a=t.map(function(i){return no(no({},i),{},{x:i.x*n+e[0]})});r.setNodes(a)}function lu(t){return t.map(function(e){return no({},e)})}function Wd(t,e){e.classHierarchy.push("vtkPiecewiseFunctionProxy"),e.piecewiseFunction=e.piecewiseFunction||Ga.newInstance(),t.setGaussians=function(r){e.gaussians=lu(r||[]),e.gaussians.length===0&&(e.gaussians=lu(Sn.Gaussians)),t.applyMode()},t.setPoints=function(r){e.points=(r||[]).slice(),e.points.length===0&&(e.points=Sn.Points.slice()),t.applyMode()},t.setNodes=function(r){e.nodes=(r||[]).slice(),e.nodes.length===0&&(e.nodes=Sn.Nodes.slice()),t.applyMode()},t.setMode=function(r){e.mode!==r&&(e.mode=r,t.applyMode())},t.applyMode=function(){switch(e.mode){case Vr.Gaussians:Ud.applyGaussianToPiecewiseFunction(e.gaussians,255,e.dataRange,e.piecewiseFunction),t.modified();break;case Vr.Points:_d(e.points,e.dataRange,e.piecewiseFunction),t.modified();break;case Vr.Nodes:jd(e.nodes,e.dataRange,e.piecewiseFunction),t.modified();break}},t.getLookupTableProxy=function(){return e.proxyManager.getLookupTable(e.arrayName)},t.setDataRange=function(r,n){(e.dataRange[0]!==r||e.dataRange[1]!==n)&&(e.dataRange[0]=r,e.dataRange[1]=n,t.applyMode())},t.applyMode()}var $d={mode:Vr.Gaussians,gaussians:Sn.Gaussians,points:Sn.Points,nodes:Sn.Nodes,arrayName:"No array associated",arrayLocation:"pointData",dataRange:[0,1]};function cv(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$d,r),T.obj(t,e),T.setGet(t,e,["arrayName"]),T.get(t,e,["piecewiseFunction","gaussians","nodes","points","mode","dataRange"]),Wd(t,e),T.proxy(t,e)}var zd=T.newInstance(cv,"vtkPiecewiseFunctionProxy"),Ci={newInstance:zd,extend:cv,Mode:Vr,Defaults:Sn};function hu(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function yu(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?hu(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):hu(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Tu(t){var e={};return t.listPropertyNames().forEach(function(r){e[r]=t.getPropertyByName(r).value}),e}function bd(t,e){t.loadState=function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise(function(a,i){var o={},s={},f={},c=n.datasetHandler||ct,u=[];r.sources.forEach(function(v){var g=v.id,p=v.group,l=v.name,h=v.props;u.push(Promise.resolve(c(h.dataset)).then(function(y){if(y){var C=t.createProxy(p,l);return C.setName(h.name),C.setInputData(y,h.type),o[g]=C,C}return null}))}),Promise.all(u).then(function(){var v=t.getViews();r.views.forEach(function(p){var l=p.id,h=p.group,y=p.name,C=p.props,S=p.camera,d=null;r.options.recycleViews&&(d=v.find(function(O){return O.getProxyGroup()===h&&O.getProxyName()===y&&O.getName()===C.name})),d?d.setDisableAnimation(!0):d=t.createProxy(h,y,{disableAnimation:!0}),d.set(C,!0),o[l]=d,f[l]=S});function g(p){!o[p]||!f[p]||o[p].resetOrientation().then(function(){o[p].getCamera().set(f[p]),o[p].getRenderer().updateLightsGeometryToFollowCamera(),o[p].renderLater()})}r.representations.forEach(function(p){var l=p.source,h=p.view,y=p.props,C=t.getRepresentation(o[l],o[h]);C.set(y,!0),g(h)}),Object.keys(r.fields).forEach(function(p){var l=r.fields[p],h=l.lookupTable,y=l.piecewiseFunction,C=t.getLookupTable(p,h);C.setPresetName(h.presetName),C.setDataRange.apply(C,W(h.dataRange));var S=t.getPiecewiseFunction(p,y);switch(y.mode){case Ci.Mode.Gaussians:S.setGaussians(y.gaussians);break;case Ci.Mode.Points:S.setPoints(y.points);break;case Ci.Mode.Nodes:S.setNodes(y.nodes);break}S.setMode(y.mode),S.setDataRange.apply(S,W(y.dataRange))}),Object.keys(f).forEach(g),Object.keys(o).forEach(function(p){var l=o[p].getProxyId();s[p]=l}),r.views.forEach(function(p){var l=p.id;o[l].setDisableAnimation(!1)}),a(yu(yu({},r.userData),{},{$oldToNewIdMapping:s}))}).catch(i)})},t.saveState=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise(function(a,i){var o=t.getSources(),s=t.getViews(),f=r.datasetHandler||function(g){return g.getState()};delete r.datasetHandler;var c=[],u=new Set,v={userData:n,options:r,sources:[],views:[],representations:[],fields:{}};o.forEach(function(g){var p=Promise.resolve(f(g.getDataset(),g));c.push(p),v.sources.push({id:g.getProxyId(),group:g.getProxyGroup(),name:g.getProxyName(),props:{name:g.getName(),type:g.getType(),dataset:p}})}),s.forEach(function(g){var p=g.getCamera().get("position","viewUp","focalPoint");v.views.push({id:g.getProxyId(),group:g.getProxyGroup(),name:g.getProxyName(),props:Object.assign(Tu(g),g.get("axis","orientation","viewUp")),camera:p});var l=g.getRepresentations();l.forEach(function(h){v.representations.push({source:h.getInput().getProxyId(),view:g.getProxyId(),props:Tu(h)}),u.add(h.getColorBy()[0])})}),u.forEach(function(g){v.fields[g]={lookupTable:t.getLookupTable(g).get("mode","presetName","rgbPoints","hsvPoints","nodes","arrayName","arrayLocation","dataRange"),piecewiseFunction:t.getPiecewiseFunction(g).get("mode","gaussians","points","nodes","arrayName","arrayLocation","dataRange")}}),Promise.all(c).then(function(){for(var g=function(h){v.sources[h].props.dataset.then(function(y){v.sources[h].props.dataset=y})},p=0;p<v.sources.length;p++)g(p);a(v)}).catch(i)})}}function Hd(t,e){t.create3DView=function(n){return t.createProxy("Views","View3D",n)},t.create2DView=function(n){return t.createProxy("Views","View2D",n)},t.render=function(n){var a=n||t.getActiveView();a&&a.renderLater()},t.renderAllViews=function(){for(var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,a=t.getViews(),i=0;i<a.length;i++)a[i].render(n)},t.setAnimationOnAllViews=function(){for(var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,a=t.getViews().filter(function(o){return!n||o.getContainer()}),i=0;i<a.length;i++)a[i].setAnimation(n,t)};function r(){e.animating=!1;for(var n=t.getViews(),a=0;a<n.length;a++)n[a].setAnimation(!1,t)}t.autoAnimateViews=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:250;if(!e.animating){e.animating=!0;for(var a=t.getViews().filter(function(o){return o.getContainer()}),i=0;i<a.length;i++)a[i].setAnimation(!0,t);e.clearAnimations=T.debounce(r,n)}e.clearAnimations()},t.resizeAllViews=function(){for(var n=t.getViews(),a=0;a<n.length;a++)n[a].resize()},t.resetCamera=function(n){var a=n||t.getActiveView();a&&a.resetCamera&&a.resetCamera()},t.createRepresentationInAllViews=function(n){for(var a=t.getViews(),i=0;i<a.length;i++)t.getRepresentation(n,a[i])},t.resetCameraInAllViews=function(){for(var n=t.getViews(),a=0;a<n.length;a++)n[a].resetCamera()}}function Cu(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function Su(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Cu(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Cu(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Kd(t,e){t.getSections=function(){var r=[],n=t.getActiveSource();if(!n)return[];var a=t.getActiveView();if(n){var i=n.getProxySection();i.ui.length&&r.push(Object.assign(i,{collapsed:e.collapseState[i.name]}))}if(n&&a){var o=t.getRepresentation(n,a);if(o){var s=o.getProxySection();s.ui.length&&r.push(Object.assign(s,{collapsed:e.collapseState[s.name]}))}}if(a){var f=a.getProxySection();f.ui.length&&r.push(Object.assign(f,{collapsed:e.collapseState[f.name]}))}return r},t.updateCollapseState=function(r,n){e.collapseState[r]=n,t.modified()},t.applyChanges=function(r){for(var n={},a=Object.keys(r),i=a.length;i--;){var o=a[i],s=o.split(":"),f=ne(s,2),c=f[0],u=f[1];if(n[c]||(n[c]={}),r[o]==="__command_execute__"){var v=t.getProxyById(c);v&&v[u]()}else n[c][u]=r[o]}var g=Object.keys(n);for(i=g.length;i--;){var p=g[i],l=t.getProxyById(p);l&&l.set(n[p])}t.modified(),t.renderAllViews()},t.getLookupTable=function(r,n){return e.lookupTables[r]||(e.lookupTables[r]=t.createProxy("Proxy","LookupTable",Su({arrayName:r},n))),e.lookupTables[r]},t.getPiecewiseFunction=function(r,n){return e.piecewiseFunctions[r]||(e.piecewiseFunctions[r]=t.createProxy("Proxy","PiecewiseFunction",Su({arrayName:r},n))),e.piecewiseFunctions[r]},t.rescaleTransferFunctionToDataRange=function(r,n){var a=t.getLookupTable(r),i=t.getPiecewiseFunction(r);a.setDataRange(n[0],n[1]),i.setDataRange(n[0],n[1])}}function gv(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,{proxyIdMapping:{},proxyByGroup:{},proxyConfiguration:{},sv2rMapping:{},r2svMapping:{},collapseState:{},lookupTables:{},piecewiseFunctions:{},animating:!1},r),T.obj(t,e),T.setGet(t,e,["proxyConfiguration","activeSource","activeView"]),T.event(t,e,"ActiveSourceChange"),T.event(t,e,"ActiveViewChange"),T.event(t,e,"ProxyRegistrationChange"),yd(t,e),bd(t),Hd(t,e),Kd(t,e),T.proxy(t,e),e.classHierarchy.push("vtkProxyManager")}var Pd=T.newInstance(gv,"vtkProxyManager"),lL={newInstance:Pd,extend:gv};function Xd(t,e){e.classHierarchy.push("vtkAbstractImageMapper"),t.getIsOpaque=function(){return!0},t.getCurrentImage=function(){return null}}var Yd={slice:0,customDisplayExtent:[0,0,0,0,0,0],useCustomExtents:!1,backgroundColor:[0,0,0,1]};function Ad(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Yd,r),Ec.extend(t,e,r),T.setGet(t,e,["slice","useCustomExtents"]),T.setGetArray(t,e,["customDisplayExtent"],6),T.setGetArray(t,e,["backgroundColor"],4),Xd(t,e)}var Zd={extend:Ad};function vv(t,e,r){var n=r.getCurrentImage(),a=n.getExtent(),i=[a[0],a[2],a[4]],o=r.getClosestIJKAxis(),s=o.ijkMode,f=r.isA("vtkImageArrayMapper")?r.getSubSlice():r.getSlice();s!==r.getSlicingMode()&&(f=r.getSliceAtPosition(f)),i[s]+=f;var c=[0,0,0];n.indexToWorld(i,c),i[s]+=1;var u=[0,0,0];n.indexToWorld(i,u),u[0]-=c[0],u[1]-=c[1],u[2]-=c[2],It(u,u);var v=jt.intersectWithLine(t,e,c,u);if(v.intersection){var g=v.x,p=[0,0,0];return n.worldToIndex(g,p),{t:v.t,absoluteIJK:p}}return null}function qd(t,e,r){var n=vv(t,e,r);if(n){var a=r.getCurrentImage(),i=a.getExtent(),o=[Math.round(n.absoluteIJK[0]),Math.round(n.absoluteIJK[1]),Math.round(n.absoluteIJK[2])];return o[0]<i[0]||o[0]>i[1]||o[1]<i[2]||o[1]>i[3]||o[2]<i[4]||o[2]>i[5]?null:{t:n.t,ijk:o}}return null}function Jd(t,e,r){var n=vv(t,e,r);if(n){var a=r.getCurrentImage(),i=a.getExtent(),o=n.absoluteIJK,s=[Math.floor(o[0]),Math.floor(o[1]),Math.floor(o[2])];if(s[0]<i[0]||s[0]>i[1]-1||s[1]<i[2]||s[1]>i[3]-1||s[2]<i[4]||s[2]>(i[5]?i[5]-1:i[5]))return null;var f=[o[0]-s[0],o[1]-s[1],o[2]-s[2]];return{t:n.t,ijk:s,pCoords:f}}return null}function du(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function Si(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?du(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):du(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var Qd=Qn.staticOffsetAPI,Id=Qn.otherStaticMethods,eO=T.vtkWarningMacro,ge=jo.SlicingMode;function tO(t,e){e.classHierarchy.push("vtkImageMapper"),t.getSliceAtPosition=function(n){var a=t.getCurrentImage(),i;if(n.length===3)i=n;else if(Number.isFinite(n)){var o=a.getBounds();switch(e.slicingMode){case ge.X:i=[n,(o[3]+o[2])/2,(o[5]+o[4])/2];break;case ge.Y:i=[(o[1]+o[0])/2,n,(o[5]+o[4])/2];break;case ge.Z:i=[(o[1]+o[0])/2,(o[3]+o[2])/2,n];break}}var s=[0,0,0];a.worldToIndex(i,s);var f=a.getExtent(),c=t.getClosestIJKAxis(),u=c.ijkMode,v=0;switch(u){case ge.I:v=gt(s[0],f[0],f[1]);break;case ge.J:v=gt(s[1],f[2],f[3]);break;case ge.K:v=gt(s[2],f[4],f[5]);break;default:return 0}return v},t.setSliceFromCamera=function(n){var a=n.getFocalPoint();switch(e.slicingMode){case ge.I:case ge.J:case ge.K:{var i=t.getSliceAtPosition(a);t.setSlice(i)}break;case ge.X:t.setSlice(a[0]);break;case ge.Y:t.setSlice(a[1]);break;case ge.Z:t.setSlice(a[2]);break}},t.setXSlice=function(n){t.setSlicingMode(ge.X),t.setSlice(n)},t.setYSlice=function(n){t.setSlicingMode(ge.Y),t.setSlice(n)},t.setZSlice=function(n){t.setSlicingMode(ge.Z),t.setSlice(n)},t.setISlice=function(n){t.setSlicingMode(ge.I),t.setSlice(n)},t.setJSlice=function(n){t.setSlicingMode(ge.J),t.setSlice(n)},t.setKSlice=function(n){t.setSlicingMode(ge.K),t.setSlice(n)},t.getSlicingModeNormal=function(){var n=[0,0,0],a=t.getCurrentImage().getDirection();switch(e.slicingMode){case ge.X:n[0]=1;break;case ge.Y:n[1]=1;break;case ge.Z:n[2]=1;break;case ge.I:gr(a,[1,0,0],n);break;case ge.J:gr(a,[0,1,0],n);break;case ge.K:gr(a,[0,0,1],n);break}return n};function r(){var n;switch(e.slicingMode){case ge.X:n=[1,0,0];break;case ge.Y:n=[0,1,0];break;case ge.Z:n=[0,0,1];break;default:e.closestIJKAxis={ijkMode:e.slicingMode,flip:!1};return}var a=[0,0,0],i=t.getCurrentImage().getDirection();gr(i,n,a);for(var o=0,s=-1,f=!1,c=0;c<a.length;++c){var u=Math.abs(a[c]);u>o&&(o=u,f=a[c]<0,s=c)}if(o!==1){var v="IJKXYZ"[e.slicingMode],g="IJKXYZ"[s];eO("Unaccurate slicing along ".concat(v," axis which ")+"is not aligned with any IJK axis of the image data. "+"Using ".concat(g," axis  as a fallback (").concat(o,"% aligned). ")+"Necessitates slice reformat that is not yet implemented.  You can switch the slicing mode on your mapper to do IJK slicing instead.")}e.closestIJKAxis={ijkMode:s,flip:f}}t.setSlicingMode=function(n){e.slicingMode!==n&&(e.slicingMode=n,t.getCurrentImage()&&r(),t.modified())},t.getClosestIJKAxis=function(){return(e.closestIJKAxis===void 0||e.closestIJKAxis.ijkMode===ge.NONE)&&t.getCurrentImage()&&r(),e.closestIJKAxis},t.getBounds=function(){var n=t.getCurrentImage();if(!n)return xn();if(!e.useCustomExtents)return n.getBounds();var a=e.customDisplayExtent.slice(),i=t.getClosestIJKAxis(),o=i.ijkMode,s=e.slice;switch(o!==e.slicingMode&&(s=t.getSliceAtPosition(e.slice)),o){case ge.I:a[0]=s,a[1]=s;break;case ge.J:a[2]=s,a[3]=s;break;case ge.K:a[4]=s,a[5]=s;break}return n.extentToBounds(a)},t.getBoundsForSlice=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.slice,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=t.getCurrentImage();if(!i)return xn();var o=i.getSpatialExtent(),s=t.getClosestIJKAxis(),f=s.ijkMode,c=n;switch(f!==e.slicingMode&&(c=t.getSliceAtPosition(n)),f){case ge.I:o[0]=c-a,o[1]=c+a;break;case ge.J:o[2]=c-a,o[3]=c+a;break;case ge.K:o[4]=c-a,o[5]=c+a;break}return i.extentToBounds(o)},t.intersectWithLineForPointPicking=function(n,a){return qd(n,a,t)},t.intersectWithLineForCellPicking=function(n,a){return Jd(n,a,t)},t.getCurrentImage=function(){return t.getInputData()}}var nO={slicingMode:ge.NONE,closestIJKAxis:{ijkMode:ge.NONE,flip:!1},renderToRectangle:!1,sliceAtFocalPoint:!1,preferSizeOverAccuracy:!1};function pv(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nO,r),Zd.extend(t,e,r),T.get(t,e,["slicingMode"]),T.setGet(t,e,["closestIJKAxis","renderToRectangle","sliceAtFocalPoint","preferSizeOverAccuracy"]),Qn.implementCoincidentTopologyMethods(t,e),tO(t,e)}var rO=T.newInstance(pv,"vtkImageMapper"),Be=Si(Si(Si({newInstance:rO,extend:pv},Qd),Id),jo),ro=T.vtkErrorMacro,aO={Unknown:0,Scalar:1,RGB:2,RGBA:3,Offset:4,Vector:5,Point:6,CovariantVector:7,SymmetricSecondRankTensor:8,DiffusionTensor3D:9,Complex:10,FixedArray:11,Array:12,Matrix:13,VariableLengthVector:14,VariableSizeMatrix:15},oe={Unknown:"Unknown",Scalar:"Scalar",RGB:"RGB",RGBA:"RGBA",Offset:"Offset",Vector:"Vector",Point:"Point",CovariantVector:"CovariantVector",SymmetricSecondRankTensor:"SymmetricSecondRankTensor",DiffusionTensor3D:"DiffusionTensor3D",Complex:"Complex",FixedArray:"FixedArray",Array:"Array",Matrix:"Matrix",VariableLengthVector:"VariableLengthVector",VariableSizeMatrix:"VariableSizeMatrix"},ao=new Map([["Uint8Array","uint8"],["Int8Array","int8"],["Uint16Array","uint16"],["Int16Array","int16"],["Uint32Array","uint32"],["Int32Array","int32"],["Float32Array","float32"],["Float64Array","float64"]]),Ou=new Map([["uint8","Uint8Array"],["int8","Int8Array"],["uint16","Uint16Array"],["int16","Int16Array"],["uint32","Uint32Array"],["int32","Int32Array"],["float32","Float32Array"],["float64","Float64Array"]]);function iO(t){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r={origin:[0,0,0],spacing:[1,1,1]},n=[1,1,1],a=[1,0,0,0,1,0,0,0,1],i=t.direction.data===void 0,o=i?oe:aO,s=0;s<t.imageType.dimension;++s){r.origin[s]=t.origin[s],r.spacing[s]=t.spacing[s],n[s]=t.size[s];for(var f=0;f<t.imageType.dimension;++f)i?a[f+s*3]=t.direction[s+f*t.imageType.dimension]:a[f+s*3]=t.direction.data[s+f*t.imageType.dimension]}var c=Ur.newInstance(r),u=ie.newInstance({name:e.scalarArrayName||"Scalars",values:t.data,numberOfComponents:t.imageType.components});switch(c.setDirection(a),c.setDimensions.apply(c,n),c.getPointData().setScalars(u),i?o[t.imageType.pixelType]:t.imageType.pixelType){case o.Scalar:break;case o.RGB:break;case o.RGBA:break;case o.Offset:break;case o.Vector:t.imageType.dimension===3&&t.imageType.components===3&&c.getPointData().setVectors(u);break;case o.Point:break;case o.CovariantVector:t.imageType.dimension===3&&t.imageType.components===3&&c.getPointData().setVectors(u);break;case o.SymmetricSecondRankTensor:t.imageType.dimension===3&&t.imageType.components===6&&c.getPointData().setTensors(u);break;case o.DiffusionTensor3D:t.imageType.dimension===3&&t.imageType.components===6&&c.getPointData().setTensors(u);break;case o.Complex:break;case o.FixedArray:break;case o.Array:break;case o.Matrix:break;case o.VariableLengthVector:break;case o.VariableSizeMatrix:break;default:return ro("Cannot handle unexpected itk-wasm pixel type ".concat(t.imageType.pixelType)),null}return c}function oO(t){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=3,n={imageType:{dimension:r,pixelType:oe.Scalar,componentType:"",components:1},name:"vtkImageData",origin:t.getOrigin(),spacing:t.getSpacing(),direction:new Float64Array(9),size:t.getDimensions()},a=t.getDirection(),i=0;i<r;++i)for(var o=0;o<r;++o)n.direction[i+o*r]=a[o+i*r];var s=t.getPointData(),f;return s.getTensors()!==null?(n.imageType.pixelType=oe.DiffusionTensor3D,f=s.getTensors()):s.getVectors()!=null?(n.imageType.pixelType=oe.Vector,f=s.getVectors()):f=s.getScalars(),n.imageType.componentType=ao.get(f.getDataType()),e?n.data=f.getData().slice(0):n.data=f.getData(),n}function sO(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=[];t.pointData.length&&r.push({data:{vtkClass:"vtkDataArray",name:e.pointDataName||"PointData",numberOfComponents:t.polyDataType.pointPixelComponents,size:t.pointData.length,dataType:Ou.get(t.polyDataType.pointPixelComponentType),buffer:t.pointData.buffer,values:t.pointData}});var n=[];t.cellData.length&&n.push({data:{vtkClass:"vtkDataArray",name:e.cellDataName||"CellData",numberOfComponents:t.polyDataType.pointPixelComponents,size:t.cellData.length,dataType:Ou.get(t.polyDataType.pointPixelComponentType),buffer:t.cellData.buffer,values:t.cellData}});var a={points:{vtkClass:"vtkPoints",name:"_points",numberOfComponents:3,size:t.numberOfPoints,dataType:"Float32Array",buffer:t.points.buffer,values:t.points},verts:{vtkClass:"vtkCellArray",name:"_verts",numberOfComponents:1,size:t.verticesBufferSize,dataType:"Uint32Array",buffer:t.vertices.buffer,values:t.vertices},lines:{vtkClass:"vtkCellArray",name:"_lines",numberOfComponents:1,size:t.linesBufferSize,dataType:"Uint32Array",buffer:t.lines.buffer,values:t.lines},polys:{vtkClass:"vtkCellArray",name:"_polys",numberOfComponents:1,size:t.polygonsBufferSize,dataType:"Uint32Array",buffer:t.polygons.buffer,values:t.polygons},strips:{vtkClass:"vtkCellArray",name:"_strips",numberOfComponents:1,size:t.triangleStripsBufferSize,dataType:"Uint32Array",buffer:t.triangleStrips.buffer,values:t.triangleStrips},pointData:{vtkClass:"vtkDataSetAttributes",activeGlobalIds:-1,activeNormals:-1,activePedigreeIds:-1,activeScalars:-1,activeTCoords:-1,activeTensors:-1,activeVectors:-1,copyFieldFlags:[],doCopyAllOff:!1,doCopyAllOn:!0,arrays:r},cellData:{vtkClass:"vtkDataSetAttributes",activeGlobalIds:-1,activeNormals:-1,activePedigreeIds:-1,activeScalars:-1,activeTCoords:-1,activeTensors:-1,activeVectors:-1,copyFieldFlags:[],doCopyAllOff:!1,doCopyAllOn:!0,arrays:n}},i=vt.newInstance(a),o=i.getPointData(),s=i.getCellData();if(t.pointData.length)switch(oe[t.polyDataType.pointPixelType]){case oe.Scalar:o.setScalars(o.getArrayByIndex(0));break;case oe.RGB:break;case oe.RGBA:break;case oe.Offset:break;case oe.Vector:t.polyDataType.pointPixelComponents===3&&o.setVectors(o.getArrayByIndex(0));break;case oe.Point:break;case oe.CovariantVector:t.polyDataType.pointPixelComponents===3&&o.setVectors(o.getArrayByIndex(0));break;case oe.SymmetricSecondRankTensor:t.polyDataType.pointPixelComponents===6&&o.setTensors(o.getArrayByIndex(0));break;case oe.DiffusionTensor3D:t.polyDataType.pointPixelComponents===6&&o.setTensors(o.getArrayByIndex(0));break;case oe.Complex:break;case oe.FixedArray:break;case oe.Array:break;case oe.Matrix:break;case oe.VariableLengthVector:break;case oe.VariableSizeMatrix:break;default:return ro("Cannot handle unexpected itk-wasm pixel type ".concat(t.polyDataType.pointPixelType)),null}if(t.cellData.length)switch(oe[t.polyDataType.cellPixelType]){case oe.Scalar:s.setScalars(s.getArrayByIndex(0));break;case oe.RGB:break;case oe.RGBA:break;case oe.Offset:break;case oe.Vector:t.polyDataType.pointPixelComponents===3&&s.setVectors(s.getArrayByIndex(0));break;case oe.Point:break;case oe.CovariantVector:t.polyDataType.pointPixelComponents===3&&s.setVectors(s.getArrayByIndex(0));break;case oe.SymmetricSecondRankTensor:t.polyDataType.pointPixelComponents===6&&s.setTensors(s.getArrayByIndex(0));break;case oe.DiffusionTensor3D:t.polyDataType.pointPixelComponents===6&&s.setTensors(s.getArrayByIndex(0));break;case oe.Complex:break;case oe.FixedArray:break;case oe.Array:break;case oe.Matrix:break;case oe.VariableLengthVector:break;case oe.VariableSizeMatrix:break;default:return ro("Cannot handle unexpected itk-wasm pixel type ".concat(t.polyDataType.pointPixelType)),null}return i}function uO(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r={polyDataType:{pointPixelComponentType:"float32",pointPixelComponents:1,pointPixelType:"Scalar",cellPixelComponentType:"float32",cellPixelComponents:1,cellPixelType:"Scalar"},numberOfPoints:t.getNumberOfPoints(),points:t.getPoints().getData(),verticesBufferSize:t.getVerts().getNumberOfValues(),vertices:t.getVerts().getData(),linesBufferSize:t.getLines().getNumberOfValues(),lines:t.getLines().getData(),polygonsBufferSize:t.getPolys().getNumberOfValues(),polygons:t.getPolys().getData(),triangleStripsBufferSize:t.getStrips().getNumberOfValues(),triangleStrips:t.getStrips().getData(),numberOfPointPixels:0,pointData:new Float32Array,numberOfCellPixels:0,cellData:new Float32Array},n=t.getPointData();if(n.getNumberOfArrays()){var a=e.pointDataName?n.getArrayByName(e.pointDataName):n.getArrayByIndex(0);r.numberOfPointPixels=a.getNumberOfTuples(),r.pointData=a.getData(),r.polyDataType.pointPixelComponentType=ao.get(a.getDataType()),r.polyDataType.cellPixelComponentType=r.polyDataType.pointPixelComponentType,r.polyDataType.pointPixelComponents=a.getNumberOfComponents(),r.polyDataType.cellPixelComponents=r.polyDataType.pointPixelComponents,n.getTensors()===a?r.polyDataType.pointPixelType=oe.SymmetricSecondRankTensor:n.getVectors()===a&&(r.polyDataType.pointPixelType=oe.Vector),r.polyDataType.cellPixelType=r.polyDataType.pointPixelType}var i=t.getCellData();if(i.getNumberOfArrays()){var o=e.cellDataName?n.getArrayByName(e.cellDataName):n.getArrayByIndex(0);r.numberOfCellPixels=o.getNumberOfTuples(),r.cellData=o.getData(),r.polyDataType.cellPixelComponentType=ao.get(o.getDataType()),r.polyDataType.cellPixelComponents=o.getNumberOfComponents(),i.getTensors()===o?r.polyDataType.cellPixelType=oe.SymmetricSecondRankTensor:i.getVectors()===o?r.polyDataType.cellPixelType=oe.Vector:r.polyDataType.cellPixelType=oe.Scalar}return r}var fO={convertItkToVtkImage:iO,convertVtkToItkImage:oO,convertItkToVtkPolyData:sO,convertVtkToItkPolyData:uO},cO=fO.convertItkToVtkImage,Lr=null,lv=function(e){return e};function gO(t){var e=t.lastIndexOf("."),r=e>-1?t.substring(0,e):t;return"Scalars ".concat(r)}function vO(t){Lr=t,Lr.length===4&&(Lr=function(){for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return t.apply(void 0,[null].concat(n))},lv=function(r){var n=r.webWorker,a=r.image;return n.terminate(),a})}function pO(t,e){e.classHierarchy.push("vtkITKImageReader"),t.parseAsArrayBuffer=function(r){return!r||r===e.rawDataBuffer?Promise.resolve():(e.rawDataBuffer=r,Lr(r,e.fileName).then(lv).then(function(n){var a=cO(n,{scalarArrayName:e.arrayName||gO(e.fileName)});e.output[0]=a,t.modified()}))},t.requestData=function(r,n){t.parseAsArrayBuffer(e.rawDataBuffer,e.fileName)}}var lO={fileName:"",arrayName:null};function hv(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,lO,r),T.obj(t,e),T.algo(t,e,0,1),T.setGet(t,e,["fileName","arrayName"]),pO(t,e),Lr||console.error(`
      // Dependency needs to be added inside your project
      import readImageArrayBuffer from 'itk/readImageArrayBuffer';
      vtkITKImageReader.setReadImageArrayBufferFromITK(readImageArrayBuffer);
      `)}var hO=T.newInstance(hv,"vtkITKImageReader"),hL={newInstance:hO,extend:hv,setReadImageArrayBufferFromITK:vO};const yO=[];var Xn=Object.create(null);yO.filter(function(t){return t.RGBPoints}).filter(function(t){return t.ColorSpace!=="CIELAB"}).forEach(function(t){Xn[t.Name]=t});var Yn=Object.keys(Xn);Yn.sort();function TO(t){return Xn[t]}function CO(t){!t.RGBPoints||t.ColorSpace==="CIELAB"||(Xn[t.Name]||(Yn.push(t.Name),Yn.sort()),Xn[t.Name]=t)}function SO(t){var e=Yn.indexOf(t);e>-1&&Yn.splice(e,1),delete Xn[t]}var dO={addPreset:CO,removePresetByName:SO,getPresetByName:TO,rgbPresetNames:Yn},OO={RGB:0,HSV:1,LAB:2,DIVERGING:3},wO={LINEAR:0,LOG10:1},bo={ColorSpace:OO,Scale:wO};function wu(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function xO(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?wu(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):wu(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var yt=bo.ColorSpace,yv=bo.Scale,ea=qa.ScalarMappingTarget,MO=T.vtkDebugMacro,mt=T.vtkErrorMacro,DO=T.vtkWarningMacro;function xu(t,e){var r=t[0],n=t[1],a=t[2],i=Math.sqrt(r*r+n*n+a*a),o=i>.001?Math.acos(r/i):0,s=o>.001?Math.atan2(a,n):0;e[0]=i,e[1]=o,e[2]=s}function EO(t,e){var r=t[0],n=t[1],a=t[2];e[0]=r*Math.cos(n),e[1]=r*Math.sin(n)*Math.cos(a),e[2]=r*Math.sin(n)*Math.sin(a)}function Mu(t,e){if(t[0]>=e-.1)return t[2];var r=t[1]*Math.sqrt(e*e-t[0]*t[0])/(t[0]*Math.sin(t[1]));return t[2]>-.3*Math.PI?t[2]+r:t[2]-r}function RO(t,e){var r=t-e;for(r<0&&(r=-r);r>=2*Math.PI;)r-=2*Math.PI;return r>Math.PI&&(r=2*Math.PI-r),r}function Du(t,e,r,n){var a=[],i=[];Cn(e,a),Cn(r,i);var o=[],s=[];xu(a,o),xu(i,s);var f=t;if(o[1]>.05&&s[1]>.05&&RO(o[2],s[2])>.33*Math.PI){var c=Math.max(o[0],s[0]);c=Math.max(88,c),t<.5?(s[0]=c,s[1]=0,s[2]=0,f*=2):(o[0]=c,o[1]=0,o[2]=0,f=2*f-1)}o[1]<.05&&s[1]>.05?o[2]=Mu(s,o[0]):s[1]<.05&&o[1]>.05&&(s[2]=Mu(o,s[0]));var u=[];u[0]=(1-f)*o[0]+f*s[0],u[1]=(1-f)*o[1]+f*s[1],u[2]=(1-f)*o[2]+f*s[2];var v=[];EO(u,v),Da(v,n)}function VO(t,e){e.classHierarchy.push("vtkColorTransferFunction"),t.getSize=function(){return e.nodes.length},t.addRGBPoint=function(r,n,a,i){return t.addRGBPointLong(r,n,a,i,.5,0)},t.addRGBPointLong=function(r,n,a,i){var o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0;if(o<0||o>1)return mt("Midpoint outside range [0.0, 1.0]"),-1;if(s<0||s>1)return mt("Sharpness outside range [0.0, 1.0]"),-1;e.allowDuplicateScalars||t.removePoint(r);var f={x:r,r:n,g:a,b:i,midpoint:o,sharpness:s};e.nodes.push(f),t.sortAndUpdateRange();for(var c=0;c<e.nodes.length&&e.nodes[c].x!==r;c++);return c<e.nodes.length?c:-1},t.addHSVPoint=function(r,n,a,i){return t.addHSVPointLong(r,n,a,i,.5,0)},t.addHSVPointLong=function(r,n,a,i){var o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0,f=[],c=[n,a,i];return pn(c,f),t.addRGBPoint(r,f[0],f[1],f[2],o,s)},t.setNodes=function(r){if(e.nodes!==r){var n=JSON.stringify(e.nodes);e.nodes=r;var a=JSON.stringify(e.nodes);if(t.sortAndUpdateRange()||n!==a)return t.modified(),!0}return!1},t.sortAndUpdateRange=function(){var r=JSON.stringify(e.nodes);e.nodes.sort(function(i,o){return i.x-o.x});var n=JSON.stringify(e.nodes),a=t.updateRange();return!a&&r!==n?(t.modified(),!0):a},t.updateRange=function(){var r=[2];r[0]=e.mappingRange[0],r[1]=e.mappingRange[1];var n=e.nodes.length;return n?(e.mappingRange[0]=e.nodes[0].x,e.mappingRange[1]=e.nodes[n-1].x):(e.mappingRange[0]=0,e.mappingRange[1]=0),r[0]===e.mappingRange[0]&&r[1]===e.mappingRange[1]?!1:(t.modified(),!0)},t.removePoint=function(r){for(var n=0;n<e.nodes.length&&e.nodes[n].x!==r;n++);var a=n;if(n>=e.nodes.length)return-1;var i=!1;return e.nodes.splice(n,1),(n===0||n===e.nodes.length)&&(i=t.updateRange()),i||t.modified(),a},t.movePoint=function(r,n){if(r!==n){t.removePoint(n);for(var a=0;a<e.nodes.length;a++)if(e.nodes[a].x===r){e.nodes[a].x=n,t.sortAndUpdateRange();break}}},t.removeAllPoints=function(){e.nodes=[],t.sortAndUpdateRange()},t.addRGBSegment=function(r,n,a,i,o,s,f,c){t.sortAndUpdateRange();for(var u=0;u<e.nodes.length;)e.nodes[u].x>=r&&e.nodes[u].x<=o?e.nodes.splice(u,1):u++;t.addRGBPointLong(r,n,a,i,.5,0),t.addRGBPointLong(o,s,f,c,.5,0),t.modified()},t.addHSVSegment=function(r,n,a,i,o,s,f,c){var u=[n,a,i],v=[s,f,c],g=[],p=[];pn(u,g),pn(v,p),t.addRGBSegment(r,g[0],g[1],g[2],o,p[0],p[1],p[2])},t.mapValue=function(r){var n=[];return t.getColor(r,n),[Math.floor(255*n[0]+.5),Math.floor(255*n[1]+.5),Math.floor(255*n[2]+.5),255]},t.getColor=function(r,n){if(e.indexedLookup){var a=t.getSize(),i=t.getAnnotatedValueIndexInternal(r);if(i<0||a===0)t.getNanColor(n);else{var o=[];t.getNodeValue(i%a,o),n[0]=o.r,n[1]=o.g,n[2]=o.b}return}t.getTable(r,r,1,n)},t.getRedValue=function(r){var n=[];return t.getColor(r,n),n[0]},t.getGreenValue=function(r){var n=[];return t.getColor(r,n),n[1]},t.getBlueValue=function(r){var n=[];return t.getColor(r,n),n[2]},t.getTable=function(r,n,a,i){var o=Number(r),s=Number(n);if(Ea(o)||Ea(s)){for(var f=0;f<a;f++)i[f*3+0]=e.nanColor[0],i[f*3+1]=e.nanColor[1],i[f*3+2]=e.nanColor[2];return}var c=0,u=e.nodes.length,v=0,g=0,p=0;u!==0&&(v=e.nodes[u-1].r,g=e.nodes[u-1].g,p=e.nodes[u-1].b);var l=0,h=0,y=0,C=[0,0,0],S=[0,0,0],d=0,O=0,w=[],M=e.scale===yv.LOG10;M&&(M=e.mappingRange[0]>0);var x=0,D=0,R=0;M&&(x=Math.log10(o),D=Math.log10(s));for(var V=0;V<a;V++){var E=3*V;if(a>1?M?(R=x+V/(a-1)*(D-x),l=Math.pow(10,R)):l=o+V/(a-1)*(s-o):M?(R=.5*(x+D),l=Math.pow(10,R)):l=.5*(o+s),e.discretize){var L=e.mappingRange;if(l>=L[0]&&l<=L[1]){var m=e.numberOfValues,N=L[1]-L[0];if(m<=1)l=L[0]+N/2;else{var _=(l-L[0])/N,G=Nr(m*_);l=L[0]+G/(m-1)*N}}}for(;c<u&&l>e.nodes[c].x;)c++,c<u&&(h=e.nodes[c-1].x,y=e.nodes[c].x,M&&(h=Math.log10(h),y=Math.log10(y)),C[0]=e.nodes[c-1].r,S[0]=e.nodes[c].r,C[1]=e.nodes[c-1].g,S[1]=e.nodes[c].g,C[2]=e.nodes[c-1].b,S[2]=e.nodes[c].b,d=e.nodes[c-1].midpoint,O=e.nodes[c-1].sharpness,d<1e-5&&(d=1e-5),d>.99999&&(d=.99999));if(l>e.mappingRange[1])i[E]=0,i[E+1]=0,i[E+2]=0,e.clamping&&(t.getUseAboveRangeColor()?(i[E]=e.aboveRangeColor[0],i[E+1]=e.aboveRangeColor[1],i[E+2]=e.aboveRangeColor[2]):(i[E]=v,i[E+1]=g,i[E+2]=p));else if(l<e.mappingRange[0]||Mc(l)&&l<0)i[E]=0,i[E+1]=0,i[E+2]=0,e.clamping&&(t.getUseBelowRangeColor()?(i[E]=e.belowRangeColor[0],i[E+1]=e.belowRangeColor[1],i[E+2]=e.belowRangeColor[2]):u>0&&(i[E]=e.nodes[0].r,i[E+1]=e.nodes[0].g,i[E+2]=e.nodes[0].b));else if(c===0&&(Math.abs(l-o)<1e-6||e.discretize))u>0?(i[E]=e.nodes[0].r,i[E+1]=e.nodes[0].g,i[E+2]=e.nodes[0].b):(i[E]=0,i[E+1]=0,i[E+2]=0);else{var k=0;if(M?k=(R-h)/(y-h):k=(l-h)/(y-h),k<d?k=.5*k/d:k=.5+.5*(k-d)/(1-d),O>.99)if(k<.5){i[E]=C[0],i[E+1]=C[1],i[E+2]=C[2];continue}else{i[E]=S[0],i[E+1]=S[1],i[E+2]=S[2];continue}if(O<.01){if(e.colorSpace===yt.RGB)i[E]=(1-k)*C[0]+k*S[0],i[E+1]=(1-k)*C[1]+k*S[1],i[E+2]=(1-k)*C[2]+k*S[2];else if(e.colorSpace===yt.HSV){var U=[],B=[];vr(C,U),vr(S,B),e.hSVWrap&&(U[0]-B[0]>.5||B[0]-U[0]>.5)&&(U[0]>B[0]?U[0]-=1:B[0]-=1);var j=[];j[0]=(1-k)*U[0]+k*B[0],j[0]<0&&(j[0]+=1),j[1]=(1-k)*U[1]+k*B[1],j[2]=(1-k)*U[2]+k*B[2],pn(j,w),i[E]=w[0],i[E+1]=w[1],i[E+2]=w[2]}else if(e.colorSpace===yt.LAB){var H=[],X=[];Cn(C,H),Cn(S,X);var Y=[];Y[0]=(1-k)*H[0]+k*X[0],Y[1]=(1-k)*H[1]+k*X[1],Y[2]=(1-k)*H[2]+k*X[2],Da(Y,w),i[E]=w[0],i[E+1]=w[1],i[E+2]=w[2]}else e.colorSpace===yt.DIVERGING?(Du(k,C,S,w),i[E]=w[0],i[E+1]=w[1],i[E+2]=w[2]):mt("ColorSpace set to invalid value.",e.colorSpace);continue}k<.5?k=.5*Math.pow(k*2,1+10*O):k>.5&&(k=1-.5*Math.pow((1-k)*2,1+10*O));var ee=k*k,ce=ee*k,Z=2*ce-3*ee+1,Ce=-2*ce+3*ee,q=ce-2*ee+k,De=ce-ee,K=void 0,fe=void 0;if(e.colorSpace===yt.RGB)for(var te=0;te<3;te++)K=S[te]-C[te],fe=(1-O)*K,i[E+te]=Z*C[te]+Ce*S[te]+q*fe+De*fe;else if(e.colorSpace===yt.HSV){var $=[],z=[];vr(C,$),vr(S,z),e.hSVWrap&&($[0]-z[0]>.5||z[0]-$[0]>.5)&&($[0]>z[0]?$[0]-=1:z[0]-=1);for(var re=[],P=0;P<3;P++)K=z[P]-$[P],fe=(1-O)*K,re[P]=Z*$[P]+Ce*z[P]+q*fe+De*fe,P===0&&re[P]<0&&(re[P]+=1);pn(re,w),i[E]=w[0],i[E+1]=w[1],i[E+2]=w[2]}else if(e.colorSpace===yt.LAB){var Le=[],pe=[];Cn(C,Le),Cn(S,pe);for(var Re=[],ye=0;ye<3;ye++)K=pe[ye]-Le[ye],fe=(1-O)*K,Re[ye]=Z*Le[ye]+Ce*pe[ye]+q*fe+De*fe;Da(Re,w),i[E]=w[0],i[E+1]=w[1],i[E+2]=w[2]}else e.colorSpace===yt.DIVERGING?(Du(k,C,S,w),i[E]=w[0],i[E+1]=w[1],i[E+2]=w[2]):mt("ColorSpace set to invalid value.");for(var le=0;le<3;le++)i[E+le]=i[E+le]<0?0:i[E+le],i[E+le]=i[E+le]>1?1:i[E+le]}}},t.getUint8Table=function(r,n,a){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(t.getMTime()<=e.buildTime&&e.tableSize===a&&e.tableWithAlpha!==i)return e.table;if(e.nodes.length===0)return mt("Attempting to lookup a value with no points in the function"),e.table;var o=i?4:3;(e.tableSize!==a||e.tableWithAlpha!==i)&&(e.table=new Uint8Array(a*o),e.tableSize=a,e.tableWithAlpha=i);var s=[];t.getTable(r,n,a,s);for(var f=0;f<a;f++)e.table[f*o+0]=Math.floor(s[f*3+0]*255+.5),e.table[f*o+1]=Math.floor(s[f*3+1]*255+.5),e.table[f*o+2]=Math.floor(s[f*3+2]*255+.5),i&&(e.table[f*o+3]=255);return e.buildTime.modified(),e.table},t.buildFunctionFromArray=function(r){t.removeAllPoints();for(var n=r.getNumberOfComponents(),a=0;a<r.getNumberOfTuples();a++)switch(n){case 3:{e.nodes.push({x:a,r:r.getComponent(a,0),g:r.getComponent(a,1),b:r.getComponent(a,2),midpoint:.5,sharpness:0});break}case 4:{e.nodes.push({x:r.getComponent(a,0),r:r.getComponent(a,1),g:r.getComponent(a,2),b:r.getComponent(a,3),midpoint:.5,sharpness:0});break}case 5:{e.nodes.push({x:a,r:r.getComponent(a,0),g:r.getComponent(a,1),b:r.getComponent(a,2),midpoint:r.getComponent(a,4),sharpness:r.getComponent(a,5)});break}case 6:{e.nodes.push({x:r.getComponent(a,0),r:r.getComponent(a,1),g:r.getComponent(a,2),b:r.getComponent(a,3),midpoint:r.getComponent(a,4),sharpness:r.getComponent(a,5)});break}}t.sortAndUpdateRange()},t.buildFunctionFromTable=function(r,n,a,i){var o=0;t.removeAllPoints(),a>1&&(o=(n-r)/(a-1));for(var s=0;s<a;s++){var f={x:r+o*s,r:i[s*3],g:i[s*3+1],b:i[s*3+2],sharpness:0,midpoint:.5};e.nodes.push(f)}t.sortAndUpdateRange()},t.getNodeValue=function(r,n){return r<0||r>=e.nodes.length?(mt("Index out of range!"),-1):(n[0]=e.nodes[r].x,n[1]=e.nodes[r].r,n[2]=e.nodes[r].g,n[3]=e.nodes[r].b,n[4]=e.nodes[r].midpoint,n[5]=e.nodes[r].sharpness,1)},t.setNodeValue=function(r,n){if(r<0||r>=e.nodes.length)return mt("Index out of range!"),-1;var a=e.nodes[r].x;return e.nodes[r].x=n[0],e.nodes[r].r=n[1],e.nodes[r].g=n[2],e.nodes[r].b=n[3],e.nodes[r].midpoint=n[4],e.nodes[r].sharpness=n[5],a!==n[0]?t.sortAndUpdateRange():t.modified(),1},t.getNumberOfAvailableColors=function(){return e.indexedLookup&&t.getSize()?t.getSize():e.tableSize?e.tableSize:16777216},t.getIndexedColor=function(r,n){var a=t.getSize();if(a>0&&r>=0){var i=[];t.getNodeValue(r%a,i);for(var o=0;o<3;++o)n[o]=i[o+1];n[3]=1;return}t.getNanColor(n),n[3]=1},t.fillFromDataPointer=function(r,n){if(!(r<=0||!n)){t.removeAllPoints();for(var a=0;a<r;a++)t.addRGBPoint(n[a*4],n[a*4+1],n[a*4+2],n[a*4+3])}},t.setMappingRange=function(r,n){var a=[r,n],i=t.getRange();if(!(i[1]===a[1]&&i[0]===a[0])){if(a[1]===a[0]){mt("attempt to set zero width color range");return}for(var o=(a[1]-a[0])/(i[1]-i[0]),s=a[0]-i[0]*o,f=0;f<e.nodes.length;++f)e.nodes[f].x=e.nodes[f].x*o+s;e.mappingRange[0]=a[0],e.mappingRange[1]=a[1],t.modified()}},t.adjustRange=function(r){var n=t.getRange(),a=[];n[0]<r[0]?(t.getColor(r[0],a),t.addRGBPoint(r[0],a[0],a[1],a[2])):(t.getColor(n[0],a),t.addRGBPoint(r[0],a[0],a[1],a[2])),n[1]>r[1]?(t.getColor(r[1],a),t.addRGBPoint(r[1],a[0],a[1],a[2])):(t.getColor(n[1],a),t.addRGBPoint(r[1],a[0],a[1],a[2])),t.sortAndUpdateRange();for(var i=0;i<e.nodes.length;)e.nodes[i].x>=r[0]&&e.nodes[i].x<=r[1]?e.nodes.splice(i,1):++i;return 1},t.estimateMinNumberOfSamples=function(r,n){var a=t.findMinimumXDistance();return Math.ceil((n-r)/a)},t.findMinimumXDistance=function(){if(e.nodes.length<2)return-1;for(var r=Number.MAX_VALUE,n=0;n<e.nodes.length-1;n++){var a=e.nodes[n+1].x-e.nodes[n].x;a<r&&(r=a)}return r},t.mapScalarsThroughTable=function(r,n,a,i){if(t.getSize()===0){MO("Transfer Function Has No Points!");return}e.indexedLookup?t.mapDataIndexed(r,n,a,i):t.mapData(r,n,a,i)},t.mapData=function(r,n,a,i){if(t.getSize()===0){DO("Transfer Function Has No Points!");return}var o=Math.floor(t.getAlpha()*255+.5),s=r.getNumberOfTuples(),f=r.getNumberOfComponents(),c=n.getData(),u=r.getData(),v=[];if(a===ea.RGBA)for(var g=0;g<s;g++){var p=u[g*f+i];t.getColor(p,v),c[g*4]=Math.floor(v[0]*255+.5),c[g*4+1]=Math.floor(v[1]*255+.5),c[g*4+2]=Math.floor(v[2]*255+.5),c[g*4+3]=o}if(a===ea.RGB)for(var l=0;l<s;l++){var h=u[l*f+i];t.getColor(h,v),c[l*3]=Math.floor(v[0]*255+.5),c[l*3+1]=Math.floor(v[1]*255+.5),c[l*3+2]=Math.floor(v[2]*255+.5)}if(a===ea.LUMINANCE)for(var y=0;y<s;y++){var C=u[y*f+i];t.getColor(C,v),c[y]=Math.floor(v[0]*76.5+v[1]*150.45+v[2]*28.05+.5)}if(a===ea.LUMINANCE_ALPHA)for(var S=0;S<s;S++){var d=u[S*f+i];t.getColor(d,v),c[S*2]=Math.floor(v[0]*76.5+v[1]*150.45+v[2]*28.05+.5),c[S*2+1]=o}},t.applyColorMap=function(r){var n=JSON.stringify(e.colorSpace);r.ColorSpace&&(e.colorSpace=yt[r.ColorSpace.toUpperCase()],e.colorSpace===void 0&&(mt("ColorSpace ".concat(r.ColorSpace," not supported, using RGB instead")),e.colorSpace=yt.RGB));var a=n!==JSON.stringify(e.colorSpace),i=a||JSON.stringify(e.nanColor);if(r.NanColor)for(e.nanColor=[].concat(r.NanColor);e.nanColor.length<4;)e.nanColor.push(1);a=a||i!==JSON.stringify(e.nanColor);var o=a||JSON.stringify(e.nodes);if(r.RGBPoints){var s=r.RGBPoints.length;e.nodes=[];for(var f=.5,c=0,u=0;u<s;u+=4)e.nodes.push({x:r.RGBPoints[u],r:r.RGBPoints[u+1],g:r.RGBPoints[u+2],b:r.RGBPoints[u+3],midpoint:f,sharpness:c})}var v=t.sortAndUpdateRange(),g=!v&&(a||o!==JSON.stringify(e.nodes));return g&&t.modified(),v||g}}var LO={clamping:!0,colorSpace:yt.RGB,hSVWrap:!0,scale:yv.LINEAR,nanColor:null,belowRangeColor:null,aboveRangeColor:null,useAboveRangeColor:!1,useBelowRangeColor:!1,allowDuplicateScalars:!1,table:null,tableSize:0,buildTime:null,nodes:null,discretize:!1,numberOfValues:256};function Tv(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,LO,r),qa.extend(t,e,r),e.table=[],e.nodes=[],e.nanColor=[.5,0,0,1],e.belowRangeColor=[0,0,0,1],e.aboveRangeColor=[1,1,1,1],e.buildTime={},T.obj(e.buildTime),T.get(t,e,["buildTime","mappingRange"]),T.setGet(t,e,["useAboveRangeColor","useBelowRangeColor","colorSpace","discretize","numberOfValues"]),T.setArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"],4),T.getArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"]),VO(t,e)}var mO=T.newInstance(Tv,"vtkColorTransferFunction"),Cv=xO({newInstance:mO,extend:Tv},bo),kO={Preset:0,RGBPoints:1,HSVPoints:2,Nodes:3},FO={Preset:"Cool to Warm",RGBPoints:[[0,0,0,0],[1,1,1,1]],HSVPoints:[[0,0,0,0],[1,0,0,1]],Nodes:[{x:0,r:0,g:0,b:0,midpoint:.5,sharpness:0},{x:1,r:1,g:1,b:1,midpoint:.5,sharpness:0}]},Sv={Defaults:FO,Mode:kO},yn=Sv.Mode,Qt=Sv.Defaults;function NO(t,e){e.classHierarchy.push("vtkLookupTableProxy"),e.lookupTable=e.lookupTable||Cv.newInstance(),e.lookupTable.setVectorModeToMagnitude(),t.setPresetName=function(r){e.presetName!==r&&(e.presetName=r,e.mode=yn.Preset,t.applyMode())},t.setRGBPoints=function(r){e.rgbPoints!==r&&(e.rgbPoints=(r||Qt.RGBPoints).slice(),t.applyMode())},t.setHSVPoints=function(r){e.hsvPoints!==r&&(e.hsvPoints=(r||Qt.HSVPoints).slice(),t.applyMode())},t.setNodes=function(r){e.nodes!==r&&(e.nodes=(r||Qt.Nodes).slice(),t.applyMode())},t.setMode=function(r){e.mode!==r&&(e.mode=r,t.applyMode())},t.applyMode=function(){switch(e.mode){case yn.Preset:{var r=dO.getPresetByName(e.presetName);r&&e.lookupTable.applyColorMap(r)}break;case yn.RGBPoints:e.lookupTable.removeAllPoints(),e.rgbPoints.forEach(function(n){var a;return(a=e.lookupTable).addRGBPointLong.apply(a,W(n))});break;case yn.HSVPoints:e.lookupTable.removeAllPoints(),e.hsvPoints.forEach(function(n){var a;return(a=e.lookupTable).addHSVPointLong.apply(a,W(n))});break;case yn.Nodes:e.lookupTable.setNodes(e.nodes);break}e.lookupTable.setMappingRange(e.dataRange[0],e.dataRange[1]),e.lookupTable.updateRange(),t.modified()},t.setDataRange=function(r,n){(e.dataRange[0]!==r||e.dataRange[1]!==n)&&(e.dataRange[0]=r,e.dataRange[1]=n,e.lookupTable.setMappingRange(e.dataRange[0],e.dataRange[1]),e.lookupTable.updateRange(),t.applyMode())},t.applyMode()}var UO={mode:yn.Preset,presetName:Qt.Preset,rgbPoints:Qt.RGBPoints,hsvPoints:Qt.HSVPoints,nodes:Qt.Nodes,arrayName:"No array associated",arrayLocation:"pointData",dataRange:[0,1]};function dv(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,UO,r),T.obj(t,e),T.setGet(t,e,["arrayName"]),T.get(t,e,["mode","lookupTable","presetName","rgbPoints","hsvPoints","nodes","dataRange"]),NO(t,e),T.proxy(t,e)}var GO=T.newInstance(dv,"vtkLookupTableProxy"),yL={newInstance:GO,extend:dv,Mode:yn,Defaults:Qt};function BO(t,e){e.classHierarchy.push("vtkSourceProxy"),t.setInputProxy=function(r){e.inputSubscription&&(e.inputSubscription(),e.inputSubscription=null),e.inputProxy=r,e.inputProxy&&(e.inputSubscription=r.onModified(t.update,-1).unsubscribe),t.update()},t.setInputData=function(r,n){e.dataset!==r&&(e.dataset=r,e.type=n||r.getClassName(),t.modified(),t.invokeDatasetChange())},t.setInputAlgorithm=function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;e.type=n,e.algo!==r&&(e.algo=r,e.algoSubscription&&(e.algoSubscription(),e.algoSubscription=null),r&&a&&(e.algoSubscription=r.onModified(function(){t.update()},-1).unsubscribe,t.update()))},t.update=function(){e.algo&&e.inputProxy&&e.algo.setInputData(e.inputProxy.getDataset()),e.updateDomain&&e.inputProxy&&e.updateDomain(t,e.inputProxy.getDataset()),e.algo&&t.setInputData(e.algo.getOutputData(),e.type)},t.getUpdate=function(){return e.algo.getMTime()>e.dataset.getMTime()},t.delete=T.chain(function(){e.algoSubscription&&(e.algoSubscription(),e.algoSubscription=null),e.inputSubscription&&(e.inputSubscription(),e.inputSubscription=null)},t.delete),e.inputProxy&&(e.inputSubscription=e.inputProxy.onModified(function(){t.update()},-1).unsubscribe),e.algoFactory&&t.setInputAlgorithm(e.algoFactory.newInstance(),null,e.autoUpdate),t.update()}var _O={name:"Default source"};function Ov(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,_O,r),T.obj(t,e),T.get(t,e,["name","type","dataset","algo","inputProxy"]),T.set(t,e,["name"]),T.event(t,e,"DatasetChange"),T.proxy(t,e),BO(t,e),e.proxyPropertyMapping&&T.proxyPropertyMapping(t,e,e.proxyPropertyMapping)}var jO=T.newInstance(Ov,"vtkSourceProxy"),TL={newInstance:jO,extend:Ov},Eu=T.vtkErrorMacro;function WO(t,e){e.classHierarchy.push("vtkImageCropFilter"),t.reset=function(){var r=t.getInputData();r&&t.setCroppingPlanes.apply(t,W(r.getExtent()))},t.requestData=function(r,n){var a=r[0];if(!a){Eu("Invalid or missing input");return}var i=a.getPointData().getScalars();if(!i){Eu("No scalars from input");return}var o=a.getExtent(),s=e.croppingPlanes&&e.croppingPlanes.length===6?o.map(function(m,N){return N%2===0?Math.max(m,Math.round(e.croppingPlanes[N])):Math.min(m,Math.round(e.croppingPlanes[N]))}):o.slice();if(s[0]===o[0]&&s[1]===o[1]&&s[2]===o[2]&&s[3]===o[3]&&s[4]===o[4]&&s[5]===o[5]){var f=Ur.newInstance();f.shallowCopy(a),n[0]=f;return}for(var c=0;c<3;++c)if(s[c*2]>s[c*2+1]){var u=[s[c*2+1],s[c*2]];s[c*2]=u[0],s[c*2+1]=u[1]}for(var v=0;v<6;v+=2)s[v]=Math.max(s[v],o[v]),s[v+1]=Math.min(s[v+1],o[v+1]);for(var g=i.getNumberOfComponents(),p=(s[1]-s[0]+1)*(s[3]-s[2]+1)*(s[5]-s[4]+1)*g,l=i.getData(),h=a.getDimensions(),y=g*h[0],C=g*h[0]*h[1],S=(s[0]-o[0])*g,d=(s[1]-s[0]+1)*g,O=new l.constructor(p),w=0,M=s[4];M<=s[5];++M)for(var x=s[2];x<=s[3];++x){var D=S+(x-o[2])*y+(M-o[4])*C,R=D+d,V=l.subarray(D,R);O.set(V,w),w+=V.length}var E=Ur.newInstance({extent:s,origin:a.getOrigin(),direction:a.getDirection(),spacing:a.getSpacing()}),L=ie.newInstance({name:i.getName(),numberOfComponents:g,values:O});E.getPointData().setScalars(L),n[0]=E},t.isResetAvailable=function(){if(e.croppingPlanes==null||e.croppingPlanes.length===0)return!1;var r=t.getInputData();if(r){var n=r.getExtent(),a=n.find(function(i,o){return Math.abs(e.croppingPlanes[o]-i)>Number.EPSILON});return a!==void 0}return!1}}var $O={};function wv(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$O,r),T.obj(t,e),T.algo(t,e,1,1),T.setGetArray(t,e,["croppingPlanes"],6),WO(t,e)}var zO=T.newInstance(wv,"vtkImageCropFilter"),bO={newInstance:zO,extend:wv};function HO(t,e){e.classHierarchy.push("vtkProp3D"),t.addPosition=function(n){e.position=e.position.map(function(a,i){return a+n[i]}),t.modified()},t.getOrientationWXYZ=function(){var n=Hn();Ff(n,e.rotation);var a=new Float64Array(3),i=Q0(a,n);return[Fr(i),a[0],a[1],a[2]]},t.rotateX=function(n){n!==0&&(co(e.rotation,e.rotation,de(n)),t.modified())},t.rotateY=function(n){n!==0&&(Oa(e.rotation,e.rotation,de(n)),t.modified())},t.rotateZ=function(n){n!==0&&(go(e.rotation,e.rotation,de(n)),t.modified())},t.rotateWXYZ=function(n,a,i,o){if(!(n===0||a===0&&i===0&&o===0)){var s=de(n),f=Hn();Nf(f,[a,i,o],s);var c=new Float64Array(16);Uf(c,f),Ee(e.rotation,e.rotation,c),t.modified()}},t.setOrientation=function(n,a,i){return n===e.orientation[0]&&a===e.orientation[1]&&i===e.orientation[2]?!1:(e.orientation=[n,a,i],I(e.rotation),t.rotateZ(i),t.rotateX(n),t.rotateY(a),t.modified(),!0)},t.setUserMatrix=function(n){return Wr(e.userMatrix,n)?!1:(Ae(e.userMatrix,n),t.modified(),!0)},t.getMatrix=function(){return t.computeMatrix(),e.matrix},t.computeMatrix=function(){if(t.getMTime()>e.matrixMTime.getMTime()){I(e.matrix),e.userMatrix&&Ee(e.matrix,e.matrix,e.userMatrix),we(e.matrix,e.matrix,e.origin),we(e.matrix,e.matrix,e.position),Ee(e.matrix,e.matrix,e.rotation),Kn(e.matrix,e.matrix,e.scale),we(e.matrix,e.matrix,[-e.origin[0],-e.origin[1],-e.origin[2]]),he(e.matrix,e.matrix),e.isIdentity=!0;for(var n=0;n<4;++n)for(var a=0;a<4;++a)(n===a?1:0)!==e.matrix[n+a*4]&&(e.isIdentity=!1);e.matrixMTime.modified()}},t.getCenter=function(){return J.getCenter(e.bounds)},t.getLength=function(){return J.getLength(e.bounds)},t.getXRange=function(){return J.getXRange(e.bounds)},t.getYRange=function(){return J.getYRange(e.bounds)},t.getZRange=function(){return J.getZRange(e.bounds)},t.getUserMatrix=function(){return e.userMatrix};function r(){t.computeMatrix()}t.onModified(r)}var KO={origin:[0,0,0],position:[0,0,0],orientation:[0,0,0],rotation:null,scale:[1,1,1],bounds:[1,-1,1,-1,1,-1],userMatrix:null,userMatrixMTime:null,cachedProp3D:null,isIdentity:!0,matrixMTime:null};function xv(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,KO,r),In.extend(t,e,r),e.matrixMTime={},T.obj(e.matrixMTime),T.get(t,e,["bounds","isIdentity"]),T.getArray(t,e,["orientation"]),T.setGetArray(t,e,["origin","position","scale"],3),e.matrix=I(new Float64Array(16)),e.rotation=I(new Float64Array(16)),e.userMatrix=I(new Float64Array(16)),e.transform=null,HO(t,e)}var PO=T.newInstance(xv,"vtkProp3D"),Ho={newInstance:PO,extend:xv},ha=Ag.InterpolationType,Ru=T.vtkErrorMacro,ya=4;function XO(t,e){e.classHierarchy.push("vtkImageProperty"),t.getMTime=function(){for(var r=e.mtime,n,a=0;a<ya;a++)e.componentData[a].rGBTransferFunction&&(n=e.componentData[a].rGBTransferFunction.getMTime(),r=r>n?r:n),e.componentData[a].piecewiseFunction&&(n=e.componentData[a].piecewiseFunction.getMTime(),r=r>n?r:n);return r},t.setRGBTransferFunction=function(r,n){var a=r,i=n;return Number.isInteger(r)||(i=r,a=0),e.componentData[a].rGBTransferFunction!==i?(e.componentData[a].rGBTransferFunction=i,t.modified(),!0):!1},t.getRGBTransferFunction=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[r].rGBTransferFunction},t.setPiecewiseFunction=function(r,n){var a=r,i=n;return Number.isInteger(r)||(i=r,a=0),e.componentData[a].piecewiseFunction!==i?(e.componentData[a].piecewiseFunction=i,t.modified(),!0):!1},t.getPiecewiseFunction=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[r].piecewiseFunction},t.setScalarOpacity=function(r,n){var a=r,i=n;return Number.isInteger(r)||(i=r,a=0),t.setPiecewiseFunction(a,i)},t.getScalarOpacity=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return t.getPiecewiseFunction(r)},t.setComponentWeight=function(r,n){if(r<0||r>=ya)return Ru("Invalid index"),!1;var a=Math.min(1,Math.max(0,n));return e.componentData[r].componentWeight!==a?(e.componentData[r].componentWeight=a,t.modified(),!0):!1},t.getComponentWeight=function(r){return r<0||r>=ya?(Ru("Invalid index"),0):e.componentData[r].componentWeight},t.setInterpolationTypeToNearest=function(){return t.setInterpolationType(ha.NEAREST)},t.setInterpolationTypeToLinear=function(){return t.setInterpolationType(ha.LINEAR)},t.getInterpolationTypeAsString=function(){return T.enumToString(ha,e.interpolationType)}}var YO={independentComponents:!1,interpolationType:ha.LINEAR,colorWindow:255,colorLevel:127.5,ambient:1,diffuse:0,opacity:1,useLookupTableScalarRange:!1};function Mv(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,YO,r),T.obj(t,e),!e.componentData){e.componentData=[];for(var n=0;n<ya;n++)e.componentData.push({rGBTransferFunction:null,piecewiseFunction:null,componentWeight:1})}T.setGet(t,e,["independentComponents","interpolationType","colorWindow","colorLevel","ambient","diffuse","opacity","useLookupTableScalarRange"]),XO(t,e)}var AO=T.newInstance(Mv,"vtkImageProperty"),ZO={newInstance:AO,extend:Mv},qO=T.vtkDebugMacro;function JO(t,e){e.classHierarchy.push("vtkImageSlice"),t.getActors=function(){return t},t.getImages=function(){return t},t.getIsOpaque=function(){if(e.forceOpaque)return!0;if(e.forceTranslucent)return!1;e.property||t.getProperty();var r=e.property.getOpacity()>=1;return r=r&&(!e.mapper||e.mapper.getIsOpaque()),r},t.hasTranslucentPolygonalGeometry=function(){return!1},t.makeProperty=ZO.newInstance,t.getProperty=function(){return e.property===null&&(e.property=t.makeProperty()),e.property},t.getBounds=function(){if(e.mapper===null)return e.bounds;var r=e.mapper.getBounds();if(!r||r.length!==6)return r;if(r[0]>r[1])return e.mapperBounds=r.concat(),e.bounds=[1,-1,1,-1,1,-1],e.boundsMTime.modified(),r;var n=function(o){return o[0].map(function(s,f){return o.map(function(c){return c[f]})})};if(!e.mapperBounds||!n([r,e.mapperBounds]).reduce(function(i,o){return i&&o[0]===o[1]},!0)||t.getMTime()>e.boundsMTime.getMTime()){qO("Recomputing bounds..."),e.mapperBounds=r.map(function(i){return i}),t.computeMatrix();var a=new Float64Array(16);he(a,e.matrix),J.transformBounds(r,a,e.bounds),e.boundsMTime.modified()}return e.bounds},t.getBoundsForSlice=function(r,n){var a=e.mapper.getBoundsForSlice(r,n);if(!J.isValid(a))return a;t.computeMatrix();var i=new Float64Array(16);he(i,e.matrix);var o=J.transformBounds(a,i);return o},t.getMinXBound=function(){return t.getBounds()[0]},t.getMaxXBound=function(){return t.getBounds()[1]},t.getMinYBound=function(){return t.getBounds()[2]},t.getMaxYBound=function(){return t.getBounds()[3]},t.getMinZBound=function(){return t.getBounds()[4]},t.getMaxZBound=function(){return t.getBounds()[5]},t.getMTime=function(){var r=e.mtime;if(e.property!==null){var n=e.property.getMTime();r=n>r?n:r}return r},t.getRedrawMTime=function(){var r=e.mtime;if(e.mapper!==null){var n=e.mapper.getMTime();r=n>r?n:r,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),n=e.mapper.getInput().getMTime(),r=n>r?n:r)}if(e.property!==null){var a=e.property.getMTime();r=a>r?a:r,e.property.getRGBTransferFunction()!==null&&(a=e.property.getRGBTransferFunction().getMTime(),r=a>r?a:r)}return r},t.getSupportsSelection=function(){return e.mapper?e.mapper.getSupportsSelection():!1}}var QO={mapper:null,property:null,bounds:W(J.INIT_BOUNDS)};function Dv(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,QO,r),Ho.extend(t,e,r),e.boundsMTime={},T.obj(e.boundsMTime),T.set(t,e,["property"]),T.setGet(t,e,["mapper"]),T.getArray(t,e,["bounds"],6),JO(t,e)}var IO=T.newInstance(Dv,"vtkImageSlice"),Ta={newInstance:IO,extend:Dv};function Vu(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function ew(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Vu(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Vu(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var Tr=Wo.InterpolationType,tw=Wo.OpacityMode,di=T.vtkErrorMacro,Ca=4;function nw(t,e){e.classHierarchy.push("vtkVolumeProperty"),t.getMTime=function(){for(var a=e.mtime,i,o=0;o<Ca;o++)e.componentData[o].colorChannels===1?e.componentData[o].grayTransferFunction&&(i=e.componentData[o].grayTransferFunction.getMTime(),a=a>i?a:i):e.componentData[o].colorChannels===3&&e.componentData[o].rGBTransferFunction&&(i=e.componentData[o].rGBTransferFunction.getMTime(),a=a>i?a:i),e.componentData[o].scalarOpacity&&(i=e.componentData[o].scalarOpacity.getMTime(),a=a>i?a:i),e.componentData[o].gradientOpacity&&(e.componentData[o].disableGradientOpacity||(i=e.componentData[o].gradientOpacity.getMTime(),a=a>i?a:i));return a},t.getColorChannels=function(a){return a<0||a>3?(di("Bad index - must be between 0 and 3"),0):e.componentData[a].colorChannels},t.setGrayTransferFunction=function(a,i){var o=!1;return e.componentData[a].grayTransferFunction!==i&&(e.componentData[a].grayTransferFunction=i,o=!0),e.componentData[a].colorChannels!==1&&(e.componentData[a].colorChannels=1,o=!0),o&&t.modified(),o},t.getGrayTransferFunction=function(a){return e.componentData[a].grayTransferFunction===null&&(e.componentData[a].grayTransferFunction=Ga.newInstance(),e.componentData[a].grayTransferFunction.addPoint(0,0),e.componentData[a].grayTransferFunction.addPoint(1024,1),e.componentData[a].colorChannels!==1&&(e.componentData[a].colorChannels=1),t.modified()),e.componentData[a].grayTransferFunction},t.setRGBTransferFunction=function(a,i){var o=!1;return e.componentData[a].rGBTransferFunction!==i&&(e.componentData[a].rGBTransferFunction=i,o=!0),e.componentData[a].colorChannels!==3&&(e.componentData[a].colorChannels=3,o=!0),o&&t.modified(),o},t.getRGBTransferFunction=function(a){return e.componentData[a].rGBTransferFunction===null&&(e.componentData[a].rGBTransferFunction=Cv.newInstance(),e.componentData[a].rGBTransferFunction.addRGBPoint(0,0,0,0),e.componentData[a].rGBTransferFunction.addRGBPoint(1024,1,1,1),e.componentData[a].colorChannels!==3&&(e.componentData[a].colorChannels=3),t.modified()),e.componentData[a].rGBTransferFunction},t.setScalarOpacity=function(a,i){return e.componentData[a].scalarOpacity!==i?(e.componentData[a].scalarOpacity=i,t.modified(),!0):!1},t.getScalarOpacity=function(a){return e.componentData[a].scalarOpacity===null&&(e.componentData[a].scalarOpacity=Ga.newInstance(),e.componentData[a].scalarOpacity.addPoint(0,1),e.componentData[a].scalarOpacity.addPoint(1024,1),t.modified()),e.componentData[a].scalarOpacity},t.setComponentWeight=function(a,i){if(a<0||a>=Ca)return di("Invalid index"),!1;var o=Math.min(1,Math.max(0,i));return e.componentData[a].componentWeight!==o?(e.componentData[a].componentWeight=o,t.modified(),!0):!1},t.getComponentWeight=function(a){return a<0||a>=Ca?(di("Invalid index"),0):e.componentData[a].componentWeight},t.setInterpolationTypeToNearest=function(){return t.setInterpolationType(Tr.NEAREST)},t.setInterpolationTypeToLinear=function(){return t.setInterpolationType(Tr.LINEAR)},t.setInterpolationTypeToFastLinear=function(){return t.setInterpolationType(Tr.FAST_LINEAR)},t.getInterpolationTypeAsString=function(){return T.enumToString(Tr,e.interpolationType)};var r=["useGradientOpacity","scalarOpacityUnitDistance","gradientOpacityMinimumValue","gradientOpacityMinimumOpacity","gradientOpacityMaximumValue","gradientOpacityMaximumOpacity","opacityMode"];r.forEach(function(a){var i=T.capitalize(a);t["set".concat(i)]=function(o,s){return e.componentData[o]["".concat(a)]!==s?(e.componentData[o]["".concat(a)]=s,t.modified(),!0):!1}});var n=["useGradientOpacity","scalarOpacityUnitDistance","gradientOpacityMinimumValue","gradientOpacityMinimumOpacity","gradientOpacityMaximumValue","gradientOpacityMaximumOpacity","opacityMode"];n.forEach(function(a){var i=T.capitalize(a);t["get".concat(i)]=function(o){return e.componentData[o]["".concat(a)]}})}var rw={independentComponents:!0,interpolationType:Tr.FAST_LINEAR,shade:!1,ambient:.1,diffuse:.7,specular:.2,specularPower:10,useLabelOutline:!1,labelOutlineThickness:1,labelOutlineOpacity:1};function Ev(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,rw,r),T.obj(t,e),!e.componentData){e.componentData=[];for(var n=0;n<Ca;++n)e.componentData.push({colorChannels:1,grayTransferFunction:null,rGBTransferFunction:null,scalarOpacity:null,scalarOpacityUnitDistance:1,opacityMode:tw.FRACTIONAL,gradientOpacityMinimumValue:0,gradientOpacityMinimumOpacity:0,gradientOpacityMaximumValue:1,gradientOpacityMaximumOpacity:1,useGradientOpacity:!1,componentWeight:1})}T.setGet(t,e,["independentComponents","interpolationType","shade","ambient","diffuse","specular","specularPower","useLabelOutline","labelOutlineThickness","labelOutlineOpacity"]),nw(t,e)}var aw=T.newInstance(Ev,"vtkVolumeProperty"),iw=ew({newInstance:aw,extend:Ev},Wo),ow=T.vtkDebugMacro;function sw(t,e){e.classHierarchy.push("vtkVolume"),t.getVolumes=function(){return t},t.makeProperty=iw.newInstance,t.getProperty=function(){return e.property===null&&(e.property=t.makeProperty()),e.property},t.getBounds=function(){if(e.mapper===null)return e.bounds;var r=e.mapper.getBounds();if(!r||r.length!==6)return r;if(r[0]>r[1])return e.mapperBounds=r.concat(),e.bounds=[1,-1,1,-1,1,-1],e.boundsMTime.modified(),r;var n=function(s){return s[0].map(function(f,c){return s.map(function(u){return u[c]})})};if(!e.mapperBounds||!n([r,e.mapperBounds]).reduce(function(o,s){return o&&s[0]===s[1]},!0)||t.getMTime()>e.boundsMTime.getMTime()){ow("Recomputing bounds..."),e.mapperBounds=r.map(function(o){return o});var a=[];J.getCorners(r,a),t.computeMatrix();var i=new Float64Array(16);he(i,e.matrix),a.forEach(function(o){return Q(o,o,i)}),e.bounds[0]=e.bounds[2]=e.bounds[4]=Number.MAX_VALUE,e.bounds[1]=e.bounds[3]=e.bounds[5]=-Number.MAX_VALUE,e.bounds=e.bounds.map(function(o,s){return s%2===0?a.reduce(function(f,c){return f>c[s/2]?c[s/2]:f},o):a.reduce(function(f,c){return f<c[(s-1)/2]?c[(s-1)/2]:f},o)}),e.boundsMTime.modified()}return e.bounds},t.getMTime=function(){var r=e.mtime;if(e.property!==null){var n=e.property.getMTime();r=n>r?n:r}return r},t.getRedrawMTime=function(){var r=e.mtime;if(e.mapper!==null){var n=e.mapper.getMTime();r=n>r?n:r,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),n=e.mapper.getInput().getMTime(),r=n>r?n:r)}return r}}var uw={mapper:null,property:null,bounds:[1,-1,1,-1,1,-1]};function Rv(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,uw,r),Ho.extend(t,e,r),e.boundsMTime={},T.obj(e.boundsMTime),T.set(t,e,["property"]),T.setGet(t,e,["mapper"]),T.getArray(t,e,["bounds"],6),sw(t,e)}var fw=T.newInstance(Rv,"vtkVolume"),cw={newInstance:fw,extend:Rv};function Lu(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function Vv(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Lu(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Lu(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var Xt=Qg.BlendMode,Cr=Qg.FilterMode;function gw(t,e,r,n,a){var i=null;return a?(i=a,i.removeAllPoints()):i=Ga.newInstance(),i.addPointLong(-1024,0,1,1),i.addPoint(t,e),i.addPoint(r,n),i}var vw={createRadonTransferFunction:gw};function pw(t,e){e.classHierarchy.push("vtkVolumeMapper");var r=Vv({},t);t.getBounds=function(){var n=t.getInputData();return n?(e.static||t.update(),e.bounds=n.getBounds()):e.bounds=xn(),e.bounds},t.update=function(){t.getInputData()},t.setBlendModeToComposite=function(){t.setBlendMode(Xt.COMPOSITE_BLEND)},t.setBlendModeToMaximumIntensity=function(){t.setBlendMode(Xt.MAXIMUM_INTENSITY_BLEND)},t.setBlendModeToMinimumIntensity=function(){t.setBlendMode(Xt.MINIMUM_INTENSITY_BLEND)},t.setBlendModeToAverageIntensity=function(){t.setBlendMode(Xt.AVERAGE_INTENSITY_BLEND)},t.setBlendModeToAdditiveIntensity=function(){t.setBlendMode(Xt.ADDITIVE_INTENSITY_BLEND)},t.setBlendModeToRadonTransform=function(){t.setBlendMode(Xt.RADON_TRANSFORM_BLEND)},t.getBlendModeAsString=function(){return T.enumToString(Xt,e.blendMode)},t.setAverageIPScalarRange=function(n,a){console.warn("setAverageIPScalarRange is deprecated use setIpScalarRange"),t.setIpScalarRange(n,a)},t.getFilterModeAsString=function(){return T.enumToString(Cr,e.filterMode)},t.setFilterModeToOff=function(){t.setFilterMode(Cr.OFF)},t.setFilterModeToNormalized=function(){t.setFilterMode(Cr.NORMALIZED)},t.setFilterModeToRaw=function(){t.setFilterMode(Cr.RAW)},t.setGlobalIlluminationReach=function(n){return r.setGlobalIlluminationReach(gt(n,0,1))},t.setVolumetricScatteringBlending=function(n){return r.setVolumetricScatteringBlending(gt(n,0,1))},t.setVolumeShadowSamplingDistFactor=function(n){return r.setVolumeShadowSamplingDistFactor(n>=1?n:1)},t.setAnisotropy=function(n){return r.setAnisotropy(gt(n,-.99,.99))},t.setLAOKernelSize=function(n){return r.setLAOKernelSize(Nr(gt(n,1,32)))},t.setLAOKernelRadius=function(n){return r.setLAOKernelRadius(n>=1?n:1)}}var lw={bounds:[1,-1,1,-1,1,-1],sampleDistance:1,imageSampleDistance:1,maximumSamplesPerRay:1e3,autoAdjustSampleDistances:!0,blendMode:Xt.COMPOSITE_BLEND,ipScalarRange:[-1e6,1e6],filterMode:Cr.OFF,preferSizeOverAccuracy:!1,computeNormalFromOpacity:!1,volumetricScatteringBlending:0,globalIlluminationReach:0,volumeShadowSamplingDistFactor:5,anisotropy:0,localAmbientOcclusion:!1,LAOKernelSize:15,LAOKernelRadius:7};function Lv(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,lw,r),To.extend(t,e,r),T.setGet(t,e,["sampleDistance","imageSampleDistance","maximumSamplesPerRay","autoAdjustSampleDistances","blendMode","filterMode","preferSizeOverAccuracy","computeNormalFromOpacity","volumetricScatteringBlending","globalIlluminationReach","volumeShadowSamplingDistFactor","anisotropy","localAmbientOcclusion","LAOKernelSize","LAOKernelRadius"]),T.setGetArray(t,e,["ipScalarRange"],2),T.event(t,e,"lightingActivated"),pw(t,e)}var hw=T.newInstance(Lv,"vtkVolumeMapper"),yw=Vv({newInstance:hw,extend:Lv},vw);function Tw(t,e){e.classHierarchy.push("vtkAbstractRepresentationProxy");function r(){if(e.input)for(var o=0;o<e.sourceDependencies.length;++o)e.sourceDependencies[o].setInputData(e.input.getDataset())}t.setInput=function(o){if(e.sourceSubscription&&(e.sourceSubscription.unsubscribe(),e.sourceSubscription=null),t.gcPropertyLinks("source"),e.input=o,t.updateColorByDomain(),e.input&&(r(),e.sourceSubscription=e.input.onDatasetChange(r)),e.links)for(var s=0;s<e.links.length;s++){var f=e.links[s],c=f.link,u=f.property,v=f.persistent,g=f.updateOnBind,p=f.type;if(p===void 0||p==="source"){var l=o.getPropertyLink(c,v);t.registerPropertyLinkForGC(l,"source"),l.bind(t,u,g)}}},t.getInputDataSet=function(){return e.input?e.input.getDataset():null},t.getDataArray=function(o,s){var f=t.getColorBy(),c=ne(f,2),u=c[0],v=c[1],g=t.getInputDataSet(),p=g?g.getReferenceByName(s||v):null,l=p?p.getArrayByName(o||u):null;return l},t.getLookupTableProxy=function(o){var s=o||t.getColorBy()[0];return s?e.proxyManager.getLookupTable(s):null},t.setLookupTableProxy=function(){},t.getPiecewiseFunctionProxy=function(o){var s=o||t.getColorBy()[0];return s?e.proxyManager.getPiecewiseFunction(s):null},t.setPiecewiseFunctionProxy=function(){},t.rescaleTransferFunctionToDataRange=function(o,s){var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1,c=t.getDataArray(o,s),u=c.getRange(f);e.proxyManager.rescaleTransferFunctionToDataRange(o,u)},t.isVisible=function(){return e.actors.length?e.actors[0].getVisibility():e.volumes.length?e.volumes[0].getVisibility():!1},t.setVisibility=function(o){for(var s=0,f=e.actors.length;f--;)s+=e.actors[f].setVisibility(o);for(f=e.volumes.length;f--;)s+=e.volumes[f].setVisibility(o);s&&t.modified()},t.setColorBy=function(o,s){var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1,c=Ye.ColorMode.DEFAULT,u=Ye.ScalarMode.DEFAULT,v=o,g=t.getDataArray(o,s),p=!!g,l=o?t.getLookupTableProxy(o).getLookupTable():null;l&&(f===-1?l.setVectorModeToMagnitude():(l.setVectorModeToComponent(),l.setVectorComponent(f))),p&&(c=Ye.ColorMode.MAP_SCALARS,u=s==="pointData"?Ye.ScalarMode.USE_POINT_FIELD_DATA:Ye.ScalarMode.USE_CELL_FIELD_DATA,e.mapper.setLookupTable&&e.mapper.setLookupTable(l),e.rescaleOnColorBy&&t.rescaleTransferFunctionToDataRange(o,s,f)),e.mapper.set({colorByArrayName:v,colorMode:c,scalarMode:u,scalarVisibility:p},!0)},t.getColorBy=function(){if(!e.mapper.getColorByArrayName){var o=t.getInputDataSet();return o.getPointData().getScalars()?[o.getPointData().getScalars().getName(),"pointData",-1]:o.getCellData().getScalars()?[o.getCellData().getScalars().getName(),"cellData",-1]:o.getPointData().getNumberOfArrays()?[o.getPointData().getArrayByIndex(0).getName(),"pointData",-1]:o.getCellData().getNumberOfArrays()?[o.getCellData().getArrayByIndex(0).getName(),"cellData",-1]:[]}var s=[],f=e.mapper.get("colorByArrayName","colorMode","scalarMode","scalarVisibility"),c=f.colorByArrayName,u=f.colorMode,v=f.scalarMode,g=f.scalarVisibility;if(g&&c&&(s.push(c),s.push(v===Ye.ScalarMode.USE_POINT_FIELD_DATA?"pointData":"cellData")),u===Ye.ColorMode.MAP_SCALARS&&c){var p=t.getLookupTableProxy(c).getLookupTable(),l=p.getVectorMode()===qa.VectorMode.MAGNITUDE?-1:p.getVectorComponent();s.push(l)}return s},t.listDataArrays=function(){var o=[];if(!e.input)return o;for(var s=t.getInputDataSet(),f=s.getPointData(),c=f.getNumberOfArrays(),u=0;u<c;u++){var v=f.getArrayByIndex(u);o.push({name:v.getName(),location:"pointData",numberOfComponents:v.getNumberOfComponents(),dataRange:v.getRange()})}var g=s.getCellData();c=g.getNumberOfArrays();for(var p=0;p<c;p++){var l=g.getArrayByIndex(p);o.push({name:l.getName(),location:"cellData",numberOfComponents:l.getNumberOfComponents(),dataRange:l.getRange()})}return o},t.updateColorByDomain=function(){t.updateProxyProperty("colorBy",{domain:{arrays:t.listDataArrays(),solidColor:!e.disableSolidColor}})},t.delete=$n(function(){e.sourceSubscription&&(e.sourceSubscription.unsubscribe(),e.sourceSubscription=null)},t.delete);var n=[],a=W(J.INIT_BOUNDS);function i(o){o&&(J.addBounds(a,o.getBounds()),n.push(o))}t.getNestedProps=function(){return n},t.getBounds=function(){return e.boundMTime<e.mtime&&(e.boundMTime=e.mtime,J.reset(a),n.length=0,e.actors.forEach(i),e.volumes.forEach(i)),a}}var Cw={boundMTime:0,actors:[],volumes:[],sourceDependencies:[],rescaleOnColorBy:!0};function Sw(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Cw,r),In.extend(t,e,r),ze(t,e,["rescaleOnColorBy"]),ot(t,e,["input","mapper","actors","volumes"]),Tw(t,e),lo(t,e)}var Ko={extend:Sw};function dw(t,e){return t+e}function ta(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return e.reduce(dw,0)/e.length}function Ow(t,e,r,n){var a=e.getRange(),i=t.getSpacing(),o=t.getBounds(),s=r.mapperX.getClosestIJKAxis(),f=s.ijkMode,c=r.mapperY.getClosestIJKAxis(),u=c.ijkMode,v=r.mapperZ.getClosestIJKAxis(),g=v.ijkMode,p={xSlice:{domain:{min:o[0],max:o[1],step:i[f]}},ySlice:{domain:{min:o[2],max:o[3],step:i[u]}},zSlice:{domain:{min:o[4],max:o[5],step:i[g]}},windowWidth:{domain:{min:0,max:a[1]-a[0],step:"any"}},windowLevel:{domain:{min:a[0],max:a[1],step:"any"}}};return n("xSlice",p.xSlice),n("ySlice",p.ySlice),n("zSlice",p.zSlice),n("windowWidth",p.windowWidth),n("windowLevel",p.windowLevel),{xSlice:ta(p.xSlice.domain.min,p.xSlice.domain.max),ySlice:ta(p.ySlice.domain.min,p.ySlice.domain.max),zSlice:ta(p.zSlice.domain.min,p.zSlice.domain.max),windowWidth:p.windowWidth.domain.max,windowLevel:Math.floor(ta(p.windowLevel.domain.min,p.windowLevel.domain.max))}}function mv(t,e,r){r.mapper;var n=r.property;n.setInterpolationTypeToLinear();for(var a=e.getNumberOfComponents(),i=J.getDiagonalLength(t.getBounds())/Math.max.apply(Math,W(t.getDimensions())),o=0;o<a;o++){n.setScalarOpacityUnitDistance(o,i);var s=e.getRange(o);n.setGradientOpacityMinimumValue(o,0),n.setGradientOpacityMaximumValue(o,(s[1]-s[0])*.05),n.setShade(!0),n.setUseGradientOpacity(o,!0),n.setGradientOpacityMinimumOpacity(o,0),n.setGradientOpacityMaximumOpacity(o,1)}n.setAmbient(.2),n.setDiffuse(.7),n.setSpecular(.3),n.setSpecularPower(8)}function ww(t,e){e.classHierarchy.push("vtkVolumeRepresentationProxy"),e.mapper=yw.newInstance(),e.volume=cw.newInstance(),e.property=e.volume.getProperty(),e.cropFilter=bO.newInstance(),e.mapper.setInputConnection(e.cropFilter.getOutputPort()),e.sourceDependencies.push(e.cropFilter),e.mapperX=Be.newInstance({slicingMode:Be.SlicingMode.X}),e.actorX=Ta.newInstance({visibility:!1}),e.propertySlices=e.actorX.getProperty(),e.mapperY=Be.newInstance({slicingMode:Be.SlicingMode.Y}),e.actorY=Ta.newInstance({visibility:!1,property:e.propertySlices}),e.mapperZ=Be.newInstance({slicingMode:Be.SlicingMode.Z}),e.actorZ=Ta.newInstance({visibility:!1,property:e.propertySlices}),e.mapperX.setInputConnection(e.cropFilter.getOutputPort()),e.mapperY.setInputConnection(e.cropFilter.getOutputPort()),e.mapperZ.setInputConnection(e.cropFilter.getOutputPort()),e.volume.setMapper(e.mapper),e.volumes.push(e.volume),e.actorX.setMapper(e.mapperX),e.actors.push(e.actorX),e.actorY.setMapper(e.mapperY),e.actors.push(e.actorY),e.actorZ.setMapper(e.mapperZ),e.actors.push(e.actorZ);function r(a){var i=t.getColorBy(),o=ne(i,2),s=o[0],f=o[1];t.rescaleTransferFunctionToDataRange(s,f);var c=t.getLookupTableProxy(s),u=t.getPiecewiseFunctionProxy(s);e.property.setRGBTransferFunction(0,c.getLookupTable()),e.property.setScalarOpacity(0,u.getPiecewiseFunction()),mv(a,t.getDataArray(),e),(e.sampleDistance<0||e.sampleDistance>1)&&t.setSampleDistance(),(e.edgeGradient<0||e.edgeGradient>1)&&t.setEdgeGradient();var v=Ow(a,t.getDataArray(),e,t.updateProxyProperty);t.set(v);var g=a.getDimensions().reduce(function(p,l){return p+(l>1?1:0)},0);g===2&&t.setIs2DVolume(!0)}e.sourceDependencies.push({setInputData:r}),t.setIs2DVolume=function(a){e.is2DVolume=a,a&&(t.getVisibility()&&t.setSliceVisibility(!0),e.volume.setVisibility(!1))},t.isVisible=function(){return e.volume.getVisibility()},t.setVisibility=function(a){a?e.is2DVolume?t.setSliceVisibility(!0):e.volume.setVisibility(!0):(e.volume.setVisibility(!1),t.setSliceVisibility(!1))},t.getVisibility=function(){return e.volume.getVisibility()||t.getSliceVisibility()},t.isVisible=t.getVisibility,t.setSliceVisibility=function(a){if(a&&e.is2DVolume){var i=t.getInputDataSet().getDimensions().indexOf(1);e.actors[i]&&e.actors[i].setVisibility(!0)}else e.actors.forEach(function(o){return o.setVisibility(a)})},t.getSliceVisibility=function(){return e.actorX.getVisibility()||e.actorY.getVisibility()||e.actorZ.getVisibility()},t.setSampleDistance=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:.4;if(e.sampleDistance!==a){e.sampleDistance=a;var i=t.getInputDataSet(),o=.7*Math.sqrt(i.getSpacing().map(function(s){return s*s}).reduce(function(s,f){return s+f},0));e.mapper.setSampleDistance(o*Math.pow(2,a*3-1.5)),t.modified()}},t.setEdgeGradient=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:.2;if(e.edgeGradient!==a){e.edgeGradient=a;var i=t.getDataArray(),o=i.getNumberOfComponents();if(a===0)for(var s=0;s<o;s++)e.volume.getProperty().setUseGradientOpacity(s,!1);else for(var f=0;f<o;f++){var c=i.getRange(f);e.volume.getProperty().setUseGradientOpacity(f,!0);var u=Math.max(0,a-.3)/.7;u>0?e.volume.getProperty().setGradientOpacityMinimumValue(f,Math.exp(Math.log((c[1]-c[0])*.2)*u*u)):e.volume.getProperty().setGradientOpacityMinimumValue(f,0),e.volume.getProperty().setGradientOpacityMaximumValue(f,Math.exp(Math.log((c[1]-c[0])*1)*a*a))}t.modified()}};var n=t.setColorBy;t.setColorBy=function(a,i){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;n(a,i,o);var s=t.getLookupTableProxy(a),f=t.getPiecewiseFunctionProxy(a);e.property.setRGBTransferFunction(0,s.getLookupTable()),e.property.setScalarOpacity(0,f.getPiecewiseFunction())}}var xw={sampleDistance:-1,edgeGradient:-1,disableSolidColor:!0,is2DVolume:!1};function kv(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xw,r),Ko.extend(t,e,r),T.get(t,e,["sampleDistance","edgeGradient","cropFilter","is2DVolume"]),ww(t,e),T.proxyPropertyMapping(t,e,{xSlice:{modelKey:"mapperX",property:"slice"},ySlice:{modelKey:"mapperY",property:"slice"},zSlice:{modelKey:"mapperZ",property:"slice"},volumeVisibility:{modelKey:"volume",property:"visibility"},xSliceVisibility:{modelKey:"actorX",property:"visibility"},ySliceVisibility:{modelKey:"actorY",property:"visibility"},zSliceVisibility:{modelKey:"actorZ",property:"visibility"},windowWidth:{modelKey:"propertySlices",property:"colorWindow"},windowLevel:{modelKey:"propertySlices",property:"colorLevel"},useShadow:{modelKey:"property",property:"shade"},croppingPlanes:{modelKey:"cropFilter",property:"croppingPlanes"}})}var Mw=T.newInstance(kv,"vtkVolumeRepresentationProxy"),CL={newInstance:Mw,extend:kv,updateConfiguration:mv};function mu(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function Dw(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?mu(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):mu(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var Ew=T.vtkDebugMacro;function Rw(t,e){e.classHierarchy.push("vtkActor");var r=Dw({},t);t.getActors=function(){return[t]},t.getIsOpaque=function(){if(e.forceOpaque)return!0;if(e.forceTranslucent)return!1;e.property||t.getProperty();var n=e.property.getOpacity()>=1;return n=n&&(!e.texture||!e.texture.isTranslucent()),n=n&&(!e.mapper||e.mapper.getIsOpaque()),n},t.hasTranslucentPolygonalGeometry=function(){return e.mapper===null?!1:(e.property===null&&t.setProperty(t.makeProperty()),!t.getIsOpaque())},t.makeProperty=zr.newInstance,t.getProperty=function(){return e.property===null&&(e.property=t.makeProperty()),e.property},t.getBounds=function(){if(e.mapper===null)return e.bounds;var n=e.mapper.getBounds();if(!n||n.length!==6)return n;if(n[0]>n[1])return e.mapperBounds=n.concat(),e.bounds=[1,-1,1,-1,1,-1],e.boundsMTime.modified(),n;if(!e.mapperBounds||n[0]!==e.mapperBounds[0]||n[1]!==e.mapperBounds[1]||n[2]!==e.mapperBounds[2]||n[3]!==e.mapperBounds[3]||n[4]!==e.mapperBounds[4]||n[5]!==e.mapperBounds[5]||t.getMTime()>e.boundsMTime.getMTime()){Ew("Recomputing bounds..."),e.mapperBounds=n.concat();var a=[];J.getCorners(n,a),t.computeMatrix();var i=new Float64Array(16);he(i,e.matrix),a.forEach(function(o){return Q(o,o,i)}),e.bounds[0]=e.bounds[2]=e.bounds[4]=Number.MAX_VALUE,e.bounds[1]=e.bounds[3]=e.bounds[5]=-Number.MAX_VALUE,e.bounds=e.bounds.map(function(o,s){return s%2===0?a.reduce(function(f,c){return f>c[s/2]?c[s/2]:f},o):a.reduce(function(f,c){return f<c[(s-1)/2]?c[(s-1)/2]:f},o)}),e.boundsMTime.modified()}return e.bounds},t.getMTime=function(){var n=r.getMTime();if(e.property!==null){var a=e.property.getMTime();n=a>n?a:n}if(e.backfaceProperty!==null){var i=e.backfaceProperty.getMTime();n=i>n?i:n}return n},t.getRedrawMTime=function(){var n=e.mtime;if(e.mapper!==null){var a=e.mapper.getMTime();n=a>n?a:n,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),a=e.mapper.getInput().getMTime(),n=a>n?a:n)}return n},t.getSupportsSelection=function(){return e.mapper?e.mapper.getSupportsSelection():!1},t.processSelectorPixelBuffers=function(n,a){e.mapper&&e.mapper.processSelectorPixelBuffers&&e.mapper.processSelectorPixelBuffers(n,a)}}var Vw={mapper:null,property:null,backfaceProperty:null,forceOpaque:!1,forceTranslucent:!1,bounds:[1,-1,1,-1,1,-1]};function Fv(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Vw,r),Ho.extend(t,e,r),e.boundsMTime={},T.obj(e.boundsMTime),T.set(t,e,["property"]),T.setGet(t,e,["backfaceProperty","forceOpaque","forceTranslucent","mapper"]),Rw(t,e)}var Lw=T.newInstance(Fv,"vtkActor"),En={newInstance:Lw,extend:Fv},mw={representation:{"Surface with edges":{property:{edgeVisibility:!0,representation:2}},Surface:{property:{edgeVisibility:!1,representation:2}},Wireframe:{property:{edgeVisibility:!1,representation:1}},Points:{property:{edgeVisibility:!1,representation:0}}}},kw={representation:"Surface"};function Fw(t,e){e.classHierarchy.push("vtkGeometryRepresentationProxy"),e.mapper=Ye.newInstance({interpolateScalarsBeforeMapping:!0,useLookupTableScalarRange:!0,scalarVisibility:!1}),e.actor=En.newInstance(),e.property=e.actor.getProperty(),e.sourceDependencies.push(e.mapper),e.actor.setMapper(e.mapper),e.actors.push(e.actor)}var Nw={representation:"Surface"};function Nv(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Nw,r),Ko.extend(t,e,r),Fw(t,e),T.proxyPropertyState(t,e,mw,kw),T.proxyPropertyMapping(t,e,{opacity:{modelKey:"property",property:"opacity"},visibility:{modelKey:"actor",property:"visibility"},color:{modelKey:"property",property:"diffuseColor"},interpolateScalarsBeforeMapping:{modelKey:"mapper",property:"interpolateScalarsBeforeMapping"},pointSize:{modelKey:"property",property:"pointSize"},useShadow:{modelKey:"property",property:"lighting"},useBounds:{modelKey:"actor",property:"useBounds"}})}var Uw=T.newInstance(Nv,"vtkGeometryRepresentationProxy"),SL={newInstance:Uw,extend:Nv};function ku(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function Gw(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?ku(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ku(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Bw(t,e){e.classHierarchy.push("vtkTexture"),t.imageLoaded=function(){e.image.removeEventListener("load",t.imageLoaded),e.imageLoaded=!0,t.modified()},t.setJsImageData=function(r){e.jsImageData!==r&&(r!==null&&(t.setInputData(null),t.setInputConnection(null),e.image=null,e.canvas=null),e.jsImageData=r,e.imageLoaded=!0,t.modified())},t.setCanvas=function(r){e.canvas!==r&&(r!==null&&(t.setInputData(null),t.setInputConnection(null),e.image=null,e.jsImageData=null),e.canvas=r,t.modified())},t.setImage=function(r){e.image!==r&&(r!==null&&(t.setInputData(null),t.setInputConnection(null),e.canvas=null,e.jsImageData=null),e.image=r,e.imageLoaded=!1,r.complete?t.imageLoaded():r.addEventListener("load",t.imageLoaded),t.modified())},t.getDimensionality=function(){var r=0,n=0,a=1;if(t.getInputData()){var i=t.getInputData();r=i.getDimensions()[0],n=i.getDimensions()[1],a=i.getDimensions()[2]}e.jsImageData&&(r=e.jsImageData.width,n=e.jsImageData.height),e.canvas&&(r=e.canvas.width,n=e.canvas.height),e.image&&(r=e.image.width,n=e.image.height);var o=(r>1)+(n>1)+(a>1);return o},t.getInputAsJsImageData=function(){if(!e.imageLoaded||t.getInputData())return null;if(e.jsImageData)return e.jsImageData();if(e.canvas){var r=e.canvas.getContext("2d"),n=r.getImageData(0,0,e.canvas.width,e.canvas.height);return n}if(e.image){var a=document.createElement("canvas");a.width=e.image.width,a.height=e.image.height;var i=a.getContext("2d");i.translate(0,a.height),i.scale(1,-1),i.drawImage(e.image,0,0,e.image.width,e.image.height);var o=i.getImageData(0,0,a.width,a.height);return o}return null}}var _w=function(e,r,n,a){for(var i=[1,2,1],o=4,s=i,f=o,c=e.length/(r*n),u=r,v=n,g=e,p=[g],l=0;l<a;l++){var h=W(g);u/=2,v/=2,g=new Uint8ClampedArray(u*v*c);for(var y=c*u,C=0,S=0;S<g.length;S+=c){S%y===0&&(C+=2*c*u);for(var d=0;d<c;d++){var O=h[C+d];O+=h[C+c+d],O+=h[C-2*y+d],O+=h[C-2*y+c+d],O/=4,g[S+d]=O}C+=2*c}for(var w=W(g),M=0;M<g.length;M+=c)for(var x=0;x<c;x++){for(var D=-(s.length-1)/2,R=f,V=0,E=0;E<s.length;E++){var L=M+x+D*c,m=L%y-(M+x)%y;m>c&&(L+=y),m<-c&&(L-=y),w[L]?V+=w[L]*s[E]:R-=s[E],D+=1}g[M+x]=V/R}w=W(g);for(var N=0;N<g.length;N+=c)for(var _=0;_<c;_++){for(var G=-(s.length-1)/2,k=f,U=0,B=0;B<s.length;B++){var j=N+_+G*y;w[j]?U+=w[j]*s[B]:k-=s[B],G+=1}g[N+_]=U/k}p.push(g)}return p},jw={image:null,canvas:null,jsImageData:null,imageLoaded:!1,repeat:!1,interpolate:!1,edgeClamp:!1,mipLevel:0,resizable:!1};function Uv(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jw,r),T.obj(t,e),T.algo(t,e,6,0),T.get(t,e,["canvas","image","jsImageData","imageLoaded","resizable"]),T.setGet(t,e,["repeat","edgeClamp","interpolate","mipLevel"]),Bw(t,e)}var Ww=T.newInstance(Uv,"vtkTexture"),$w={generateMipmaps:_w},zw=Gw({newInstance:Ww,extend:Uv},$w);function Gv(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0,0],r=ne(e,4),n=r[0],a=r[1],i=r[2],o=r[3],s=t.getContext("2d"),f=s.getImageData(n,a,i||t.width,o||t.height),c=Ur.newInstance({type:"vtkImageData"});c.setOrigin(0,0,0),c.setSpacing(1,1,1),c.setExtent(0,(i||t.width)-1,0,(o||t.height)-1,0,0);var u=ie.newInstance({numberOfComponents:4,values:new Uint8Array(f.data.buffer)});return u.setName("scalars"),c.getPointData().setScalars(u),c}function bw(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{flipX:!1,flipY:!1,rotate:0},r=document.createElement("canvas");r.width=t.width,r.height=t.height;var n=r.getContext("2d"),a=e.flipX,i=e.flipY,o=e.rotate;return n.translate(r.width/2,r.height/2),n.scale(a?-1:1,i?-1:1),n.rotate(o*Math.PI/180),n.drawImage(t,-t.width/2,-t.height/2),Gv(r)}var Hw={canvasToImageData:Gv,imageToImageData:bw},Bv={default:{defaultStyle:{fontStyle:"bold",fontFamily:"Arial",fontColor:"black",fontSizeScale:function(e){return e/2},faceColor:"white",edgeThickness:.1,edgeColor:"black",resolution:400},xMinusFaceProperty:{text:"X-",faceColor:"yellow"},xPlusFaceProperty:{text:"X+",faceColor:"yellow"},yMinusFaceProperty:{text:"Y-",faceColor:"red"},yPlusFaceProperty:{text:"Y+",faceColor:"red"},zMinusFaceProperty:{text:"Z-",faceColor:"#008000"},zPlusFaceProperty:{text:"Z+",faceColor:"#008000"}},lps:{xMinusFaceProperty:{text:"R",faceRotation:-90},xPlusFaceProperty:{text:"L",faceRotation:90},yMinusFaceProperty:{text:"A",faceRotation:0},yPlusFaceProperty:{text:"P",faceRotation:180},zMinusFaceProperty:{text:"I",faceRotation:180},zPlusFaceProperty:{text:"S",faceRotation:0}}};function _v(t,e){e.set(t)}function Kw(t,e){return _v(Bv[t],e)}function Pw(t,e){Bv[t]=e}var Sr={applyDefinitions:_v,applyPreset:Kw,registerStylePreset:Pw};function Fu(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function wt(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Fu(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Fu(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var Xw={xPlus:0,xMinus:1,yPlus:2,yMinus:3,zPlus:4,zMinus:5};function Yw(t,e){e.classHierarchy.push("vtkAnnotatedCubeActor"),e.xPlusFaceProperty=wt({},e.xPlusFaceProperty),e.xMinusFaceProperty=wt({},e.xMinusFaceProperty),e.yPlusFaceProperty=wt({},e.yPlusFaceProperty),e.yMinusFaceProperty=wt({},e.yMinusFaceProperty),e.zPlusFaceProperty=wt({},e.zPlusFaceProperty),e.zMinusFaceProperty=wt({},e.zMinusFaceProperty);var r=null,n=document.createElement("canvas"),a=Ye.newInstance(),i=zw.newInstance();i.setInterpolate(!0);function o(f){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;c&&Object.assign(e["".concat(f,"FaceProperty")],c);var u=wt(wt({},e.defaultStyle),e["".concat(f,"FaceProperty")]);n.width=u.resolution,n.height=u.resolution;var v=n.getContext("2d");v.fillStyle=u.faceColor,v.fillRect(0,0,n.width,n.height),u.edgeThickness>0&&(v.strokeStyle=u.edgeColor,v.lineWidth=u.edgeThickness*n.width,v.strokeRect(0,0,n.width,n.height)),v.save(),v.translate(0,n.height),v.scale(1,-1),v.translate(n.width/2,n.height/2),v.rotate(-Math.PI*(u.faceRotation/180));var g=u.fontSizeScale(u.resolution);v.fillStyle=u.fontColor,v.textAlign="center",v.textBaseline="middle",v.font="".concat(u.fontStyle," ").concat(g,'px "').concat(u.fontFamily,'"'),v.fillText(u.text,0,0),v.restore();var p=Hw.canvasToImageData(n);i.setInputData(p,Xw[f]),t.modified()}function s(){r=Xg.newInstance({generate3DTextureCoordinates:!0}),a.setInputConnection(r.getOutputPort()),o("xPlus"),o("xMinus"),o("yPlus"),o("yMinus"),o("zPlus"),o("zMinus")}t.setDefaultStyle=function(f){e.defaultStyle=wt(wt({},e.defaultStyle),f),s()},t.setXPlusFaceProperty=function(f){return o("xPlus",f)},t.setXMinusFaceProperty=function(f){return o("xMinus",f)},t.setYPlusFaceProperty=function(f){return o("yPlus",f)},t.setYMinusFaceProperty=function(f){return o("yMinus",f)},t.setZPlusFaceProperty=function(f){return o("zPlus",f)},t.setZMinusFaceProperty=function(f){return o("zMinus",f)},s(),a.setInputConnection(r.getOutputPort()),t.setMapper(a),t.addTexture(i)}var Aw={defaultStyle:{text:"",faceColor:"white",faceRotation:0,fontFamily:"Arial",fontColor:"black",fontStyle:"normal",fontSizeScale:function(e){return e/1.8},edgeThickness:.1,edgeColor:"black",resolution:200}};function jv(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Aw,r),En.extend(t,e,r),T.get(t,e,["defaultStyle","xPlusFaceProperty","xMinusFaceProperty","yPlusFaceProperty","yMinusFaceProperty","zPlusFaceProperty","zMinusFaceProperty"]),Yw(t,e)}var Zw=T.newInstance(jv,"vtkAnnotatedCubeActor"),qw={newInstance:Zw,extend:jv,Presets:Sr},Jw=T.vtkErrorMacro;function Qw(t,e){var r=0;return t.map(function(n,a){return a===r?(r+=n+1,n):n+e})}function na(t,e,r,n){t.set(Qw(e,r),n)}function Iw(t,e){e.classHierarchy.push("vtkAppendPolyData"),t.requestData=function(r,n){var a=t.getNumberOfInputPorts();if(!a){Jw("No input specified.");return}if(a===1){n[0]=r[0];return}for(var i=vt.newInstance(),o=0,s=0,f=1,c=1,u=0,v=0,g=0,p=0,l=!0,h=!0,y=!0,C=0;C<a;C++){var S=r[C];if(S){var d=S.getPoints().getNumberOfPoints();o+=d,u+=S.getVerts().getNumberOfValues(),v+=S.getLines().getNumberOfValues(),g+=S.getStrips().getNumberOfValues(),p+=S.getPolys().getNumberOfValues(),d&&(c&&(c=0,s=S.getPoints().getDataType()),f=S.getPoints().getDataType(),s=s>f?s:f);var O=S.getPointData();O?(l=l&&O.getNormals()!==null,h=h&&O.getTCoords()!==null,y=y&&O.getScalars()!==null):(l=!1,h=!1,y=!1)}}e.outputPointsPrecision===ka.SINGLE?s=Me.FLOAT:e.outputPointsPrecision===ka.DOUBLE&&(s=Me.DOUBLE);var w=Pn.newInstance({dataType:s});w.setNumberOfPoints(o);var M=w.getData(),x=new Uint32Array(u),D=new Uint32Array(v),R=new Uint32Array(g),V=new Uint32Array(p),E=null,L=null,m=null,N=r[a-1];if(l){var _=N.getPointData().getNormals();E=ie.newInstance({numberOfComponents:3,numberOfTuples:o,size:3*o,dataType:_.getDataType(),name:_.getName()})}if(h){var G=N.getPointData().getTCoords();L=ie.newInstance({numberOfComponents:2,numberOfTuples:o,size:2*o,dataType:G.getDataType(),name:G.getName()})}if(y){var k=N.getPointData().getScalars();m=ie.newInstance({numberOfComponents:k.getNumberOfComponents(),numberOfTuples:o,size:o*k.getNumberOfComponents(),dataType:k.getDataType(),name:k.getName()})}o=0,u=0,v=0,g=0,p=0;for(var U=0;U<a;U++){var B=r[U];M.set(B.getPoints().getData(),o*3),na(x,B.getVerts().getData(),o,u),u+=B.getVerts().getNumberOfValues(),na(D,B.getLines().getData(),o,v),v+=B.getLines().getNumberOfValues(),na(R,B.getStrips().getData(),o,g),g+=B.getStrips().getNumberOfValues(),na(V,B.getPolys().getData(),o,p),p+=B.getPolys().getNumberOfValues();var j=B.getPointData();if(l){var H=j.getNormals();E.getData().set(H.getData(),o*3)}if(h){var X=j.getTCoords();L.getData().set(X.getData(),o*2)}if(y){var Y=j.getScalars();m.getData().set(Y.getData(),o*m.getNumberOfComponents())}o+=B.getPoints().getNumberOfPoints()}i.setPoints(w),i.getVerts().setData(x),i.getLines().setData(D),i.getStrips().setData(R),i.getPolys().setData(V),E&&i.getPointData().setNormals(E),L&&i.getPointData().setTCoords(L),m&&i.getPointData().setScalars(m),n[0]=i}}var ex={outputPointsPrecision:ka.DEFAULT};function Wv(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ex,r),T.setGet(t,e,["outputPointsPrecision"]),T.obj(t,e),T.algo(t,e,1,1),Iw(t,e)}var tx=T.newInstance(Wv,"vtkAppendPolyData"),$v={newInstance:tx,extend:Wv};function nx(t,e){e.classHierarchy.push("vtkConeSource");function r(n,a){var i;if(!e.deleted){var o=a[0],s=2*Math.PI/e.resolution,f=-e.height/2,c=e.resolution+1,u=4*e.resolution+1+e.resolution,v=0,g=T.newTypedArray(e.pointType,c*3),p=0,l=new Uint32Array(u);g[0]=e.height/2,g[1]=0,g[2]=0,e.capping&&(l[p++]=e.resolution);for(var h=0;h<e.resolution;h++)v++,g[v*3+0]=f,g[v*3+1]=e.radius*Math.cos(h*s),g[v*3+2]=e.radius*Math.sin(h*s),e.capping&&(l[e.resolution-p+++1]=v);for(var y=0;y<e.resolution;y++)l[p++]=3,l[p++]=0,l[p++]=y+1,l[p++]=y+2>e.resolution?1:y+2;(i=qe.buildFromRadian()).translate.apply(i,W(e.center)).rotateFromDirections([1,0,0],e.direction).apply(g),o=vt.newInstance(),o.getPoints().setData(g,3),o.getPolys().setData(l,1),a[0]=o}}t.requestData=r}var rx={height:1,radius:.5,resolution:6,center:[0,0,0],direction:[1,0,0],capping:!0,pointType:"Float64Array"};function zv(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rx,r),T.obj(t,e),T.setGet(t,e,["height","radius","resolution","capping"]),T.setGetArray(t,e,["center","direction"],3),T.algo(t,e,0,1),nx(t,e)}var ax=T.newInstance(zv,"vtkConeSource"),ix={newInstance:ax,extend:zv};function ox(t,e){e.classHierarchy.push("vtkCylinderSource");function r(n,a){var i,o;if(!e.deleted){var s=a[0],f=2*Math.PI/e.resolution,c=2*e.resolution,u=5*e.resolution;e.capping&&(c=4*e.resolution,u=7*e.resolution+2);for(var v=T.newTypedArray(e.pointType,c*3),g=0,p=new Uint32Array(u),l=new Float32Array(c*3),h=ie.newInstance({numberOfComponents:3,values:l,name:"Normals"}),y=new Float32Array(c*2),C=ie.newInstance({numberOfComponents:2,values:y,name:"TCoords"}),S=[0,0,0],d=[0,0,0],O=[0,0,0],w=[0,0,0],M=[0,0],x=[0,0],D=e.otherRadius==null?e.radius:e.otherRadius,R=0;R<e.resolution;R++){S[0]=Math.cos(R*f+e.initAngle),d[0]=S[0],O[0]=e.radius*S[0]+e.center[0],w[0]=O[0],M[0]=Math.abs(2*R/e.resolution-1),x[0]=M[0],O[1]=.5*e.height+e.center[1],w[1]=-.5*e.height+e.center[1],M[1]=0,x[1]=1,S[2]=-Math.sin(R*f+e.initAngle),d[2]=S[2],O[2]=D*S[2]+e.center[2],w[2]=O[2];for(var V=2*R,E=0;E<3;E++)l[V*3+E]=S[E],l[(V+1)*3+E]=d[E],v[V*3+E]=O[E],v[(V+1)*3+E]=w[E],E<2&&(y[V*2+E]=M[E],y[(V+1)*2+E]=x[E])}for(var L=0;L<e.resolution;L++){p[g++]=4,p[g++]=2*L,p[g++]=2*L+1;var m=(2*L+3)%(2*e.resolution);p[g++]=m,p[g++]=m-1}if(e.capping){for(var N=0;N<e.resolution;N++){O[0]=e.radius*Math.cos(N*f+e.initAngle),w[0]=O[0],M[0]=O[0],x[0]=O[0],O[0]+=e.center[0],w[0]+=e.center[0],S[1]=1,d[1]=-1,O[1]=.5*e.height+e.center[1],w[1]=-.5*e.height+e.center[1],O[2]=-D*Math.sin(N*f+e.initAngle),w[2]=O[2],M[1]=O[2],x[1]=O[2],O[2]+=e.center[2],w[2]+=e.center[2];for(var _=2*e.resolution+N,G=3*e.resolution+e.resolution-N-1,k=0;k<3;k++)l[3*_+k]=S[k],l[3*G+k]=d[k],v[3*_+k]=O[k],v[3*G+k]=w[k],k<2&&(y[2*_+k]=M[k],y[2*G+k]=x[k])}p[g++]=e.resolution;for(var U=0;U<e.resolution;U++)p[g++]=2*e.resolution+U;p[g++]=e.resolution;for(var B=0;B<e.resolution;B++)p[g++]=3*e.resolution+B}(i=(o=qe.buildFromRadian()).translate.apply(o,W(e.center)).rotateFromDirections([0,1,0],e.direction)).translate.apply(i,W(e.center.map(function(j){return j*-1}))).apply(v),s=vt.newInstance(),s.getPoints().setData(v,3),s.getPolys().setData(p,1),s.getPointData().setNormals(h),s.getPointData().setTCoords(C),a[0]=s}}t.requestData=r}var sx={height:1,initAngle:0,radius:1,resolution:6,center:[0,0,0],direction:[0,1,0],capping:!0,pointType:"Float64Array"};function bv(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,sx,r),T.obj(t,e),T.setGet(t,e,["height","initAngle","otherRadius","radius","resolution","capping"]),T.setGetArray(t,e,["center","direction"],3),T.algo(t,e,0,1),ox(t,e)}var ux=T.newInstance(bv,"vtkCylinderSource"),fx={newInstance:ux,extend:bv};function cx(t,e){e.classHierarchy.push("vtkArrowSource");function r(n,a){if(!e.deleted){var i=fx.newInstance({capping:!0});i.setResolution(e.shaftResolution),i.setRadius(e.shaftRadius),i.setHeight(1-e.tipLength),i.setCenter(0,(1-e.tipLength)*.5,0);var o=i.getOutputData(),s=o.getPoints().getData(),f=o.getPointData().getNormals().getData();qe.buildFromDegree().rotateZ(-90).apply(s).apply(f);var c=ix.newInstance();c.setResolution(e.tipResolution),c.setHeight(e.tipLength),c.setRadius(e.tipRadius);var u=c.getOutputData(),v=u.getPoints().getData();qe.buildFromRadian().translate(1-e.tipLength*.5,0,0).apply(v);var g=$v.newInstance();g.setInputData(o),g.addInputData(u);var p=g.getOutputData(),l=p.getPoints().getData();qe.buildFromRadian().translate(-.5+e.tipLength*.5,0,0).apply(l),e.invert?(qe.buildFromRadian().rotateFromDirections([1,0,0],e.direction).scale(-1,-1,-1).apply(l),a[0]=p):(qe.buildFromRadian().rotateFromDirections([1,0,0],e.direction).scale(1,1,1).apply(l),a[0]=g.getOutputData())}}t.requestData=r}var gx={tipResolution:6,tipRadius:.1,tipLength:.35,shaftResolution:6,shaftRadius:.03,invert:!1,direction:[1,0,0],pointType:"Float64Array"};function Hv(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,gx,r),T.obj(t,e),T.setGet(t,e,["tipResolution","tipRadius","tipLength","shaftResolution","shaftRadius","invert"]),T.setGetArray(t,e,["direction"],3),T.algo(t,e,0,1),cx(t,e)}var vx=T.newInstance(Hv,"vtkArrowSource"),Oi={newInstance:vx,extend:Hv};function Nu(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function wi(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Nu(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Nu(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function xi(t){var e,r=t.getPoints().getBounds(),n=[-(r[0]+r[1])*.5,-(r[2]+r[3])*.5,-(r[4]+r[5])*.5];(e=qe.buildFromDegree()).translate.apply(e,n).apply(t.getPoints().getData())}function Mi(t,e){var r,n=t.getPoints().getBounds(),a=[0,0,0];a[e]=-n[e*2],(r=qe.buildFromDegree()).translate.apply(r,a).apply(t.getPoints().getData())}function Di(t,e,r,n){for(var a=t.getPoints().getData().length,i=new Uint8Array(a),o=0;o<a;)i[o++]=e,i[o++]=r,i[o++]=n;t.getPointData().setScalars(ie.newInstance({name:"color",numberOfComponents:3,values:i}))}function px(t,e){e.classHierarchy.push("vtkAxesActor");var r=Ye.newInstance();t.setMapper(r),t.update=function(){var f=Oi.newInstance(wi({direction:[1,0,0]},e.config)).getOutputData();e.config.recenter?xi(f):Mi(f,0),Di.apply(void 0,[f].concat(W(e.xAxisColor)));var c=Oi.newInstance(wi({direction:[0,1,0]},e.config)).getOutputData();e.config.recenter?xi(c):Mi(c,1),Di.apply(void 0,[c].concat(W(e.yAxisColor)));var u=Oi.newInstance(wi({direction:[0,0,1]},e.config)).getOutputData();e.config.recenter?xi(u):Mi(u,2),Di.apply(void 0,[u].concat(W(e.zAxisColor)));var v=$v.newInstance();v.setInputData(f),v.addInputData(c),v.addInputData(u),r.setInputConnection(v.getOutputPort())},t.update();var n=T.debounce(t.update,0),a=t.setConfig,i=t.setXAxisColor,o=t.setYAxisColor,s=t.setZAxisColor;t.setConfig=function(f){return a(f)?(n(),!0):!1},t.setXAxisColor=function(f){return i(f)?(n(),!0):!1},t.setYAxisColor=function(f){return o(f)?(n(),!0):!1},t.setZAxisColor=function(f){return s(f)?(n(),!0):!1}}var lx={config:{recenter:!0,tipResolution:60,tipRadius:.1,tipLength:.2,shaftResolution:60,shaftRadius:.03,invert:!1},xAxisColor:[255,0,0],yAxisColor:[255,255,0],zAxisColor:[0,128,0]};function Kv(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,lx,r),En.extend(t,e,r),T.setGet(t,e,["config"]),T.setGetArray(t,e,["xAxisColor","yAxisColor","zAxisColor"],3,255),px(t,e)}var hx=T.newInstance(Kv,"vtkAxesActor"),yx={newInstance:hx,extend:Kv};function Tx(t,e){e===void 0&&(e={});var r=e.insertAt;if(!(!t||typeof document>"u")){var n=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css",r==="top"&&n.firstChild?n.insertBefore(a,n.firstChild):n.appendChild(a),a.styleSheet?a.styleSheet.cssText=t:a.appendChild(document.createTextNode(t))}}var Cx=`.CornerAnnotation-module_container__2mZcn {
  display: flex;
  align-items: stretch;
  justify-content: space-between;
  flex-direction: column;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
  z-index: 100;
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

.CornerAnnotation-module_row__23t97 {
  flex: 1;
  display: flex;
  justify-content: space-between;
  flex-direction: row;
}

.CornerAnnotation-module_topRow__1OP5f {
  align-items: flex-start;
}

.CornerAnnotation-module_middleRow__1xYK_ {
  align-items: center;
}

.CornerAnnotation-module_bottomRow__1V34_ {
  align-items: flex-end;
}

.CornerAnnotation-module_item__BavOy {
  flex: 1;
  padding: 5px;
}

.CornerAnnotation-module_east__xyYFe {
  text-align: right;
}

.CornerAnnotation-module_west__3DsS- {
  text-align: left;
}

.CornerAnnotation-module_north__2jPzf {
  text-align: center;
}

.CornerAnnotation-module_south__FZyGo {
  text-align: center;
}

.CornerAnnotation-module_northEast__-GjXi {
}

.CornerAnnotation-module_northWest__23pUR {
}

.CornerAnnotation-module_southEast__tmLmN {
}

.CornerAnnotation-module_southWest__FLNPM {
}

`,ut={container:"CornerAnnotation-module_container__2mZcn",row:"CornerAnnotation-module_row__23t97",topRow:"CornerAnnotation-module_topRow__1OP5f CornerAnnotation-module_row__23t97",middleRow:"CornerAnnotation-module_middleRow__1xYK_ CornerAnnotation-module_row__23t97",bottomRow:"CornerAnnotation-module_bottomRow__1V34_ CornerAnnotation-module_row__23t97",item:"CornerAnnotation-module_item__BavOy",east:"CornerAnnotation-module_east__xyYFe CornerAnnotation-module_item__BavOy",west:"CornerAnnotation-module_west__3DsS- CornerAnnotation-module_item__BavOy",north:"CornerAnnotation-module_north__2jPzf CornerAnnotation-module_item__BavOy",south:"CornerAnnotation-module_south__FZyGo CornerAnnotation-module_item__BavOy",northEast:"CornerAnnotation-module_northEast__-GjXi CornerAnnotation-module_east__xyYFe CornerAnnotation-module_item__BavOy",northWest:"CornerAnnotation-module_northWest__23pUR CornerAnnotation-module_west__3DsS- CornerAnnotation-module_item__BavOy",southEast:"CornerAnnotation-module_southEast__tmLmN CornerAnnotation-module_east__xyYFe CornerAnnotation-module_item__BavOy",southWest:"CornerAnnotation-module_southWest__FLNPM CornerAnnotation-module_west__3DsS- CornerAnnotation-module_item__BavOy"};Tx(Cx);function Sx(){}var dx={nw:"northWestContainer",n:"northContainer",ne:"northEastContainer",w:"westContainer",e:"eastContainer",sw:"southWestContainer",s:"southContainer",se:"southEastContainer"};function Ox(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"${".concat(t,"}");return t.split(".").reduce(function(n,a){return n[a]!==void 0?n[a]:r},e)}function wx(t,e,r){return t.replace(/\${([^{]+)}/g,function(n){var a=n.substr(2,n.length-3).trim();return Ox(a,e,r)})}function xx(t,e){e.classHierarchy.push("vtkCornerAnnotation"),e.templates||(e.templates={}),e.metadata||(e.metadata={}),e.annotationContainer=document.createElement("div"),e.annotationContainer.setAttribute("class",ut.container),e.annotationContainer.innerHTML=`
    <div class="`.concat(ut.topRow,`">
      <div class="js-nw `).concat(ut.northWest,`"></div>
      <div class="js-n `).concat(ut.north,`"></div>
      <div class="js-ne `).concat(ut.northEast,`"></div>
    </div>
    <div class="`).concat(ut.middleRow,`">
      <div class="js-w `).concat(ut.west,`"></div>
      <div class="js-e `).concat(ut.east,`"></div>
    </div>
    <div class="`).concat(ut.bottomRow,`">
      <div class="js-sw `).concat(ut.southWest,`"></div>
      <div class="js-s `).concat(ut.south,`"></div>
      <div class="js-se `).concat(ut.southEast,`"></div>
    </div>`),e.northWestContainer=e.annotationContainer.querySelector(".js-nw"),e.northContainer=e.annotationContainer.querySelector(".js-n"),e.northEastContainer=e.annotationContainer.querySelector(".js-ne"),e.westContainer=e.annotationContainer.querySelector(".js-w"),e.eastContainer=e.annotationContainer.querySelector(".js-e"),e.southWestContainer=e.annotationContainer.querySelector(".js-sw"),e.southContainer=e.annotationContainer.querySelector(".js-s"),e.southEastContainer=e.annotationContainer.querySelector(".js-se");function r(){for(var n=Object.keys(e.templates),a=n.length;a--;){var i=e[dx[n[a]]],o=e.templates[n[a]];i&&o&&(i.innerHTML=o(e.metadata))}}t.setContainer=function(n){e.container&&e.container!==n&&e.container.removeChild(e.annotationContainer),e.container!==n&&(e.container=n,e.container&&(e.container.appendChild(e.annotationContainer),t.resize()),t.modified())},t.resize=Sx,t.updateTemplates=function(n){e.templates=Object.assign(e.templates,n),r(),t.modified()},t.updateMetadata=function(n){e.metadata=Object.assign(e.metadata,n),r(),t.modified()}}var Mx={templates:null,metadata:null};function Pv(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Mx,r),T.obj(t,e),T.get(t,e,["annotationContainer","northWestContainer","northContainer","northEastContainer","westContainer","eastContainer","southWestContainer","southContainer","southEastContainer","metadata"]),xx(t,e)}var Dx=T.newInstance(Pv,"vtkCornerAnnotation"),Uu={newInstance:Dx,extend:Pv,applyTemplate:wx},Po={Unknown:0,LeftController:1,RightController:2},Xo={Unknown:0,Trigger:1,TrackPad:2,Grip:3,Thumbstick:4,A:5,B:6,ApplicationMenu:7},Ex={Unknown:0,TouchpadX:1,TouchpadY:2,ThumbstickX:3,ThumbstickY:4},Yo={Device:Po,Input:Xo,Axis:Ex};function Gu(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function Se(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Gu(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Gu(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var ra=Yo.Device,gn=Yo.Input,aa=T.vtkWarningMacro,ia=T.vtkErrorMacro,Rx=T.normalizeWheel,Vx=T.vtkOnceErrorMacro,mn=new MouseEvent(""),Ei={"xr-standard":[gn.Trigger,gn.Grip,gn.TrackPad,gn.Thumbstick,gn.A,gn.B]},Ao=["StartAnimation","Animation","EndAnimation","PointerEnter","PointerLeave","MouseEnter","MouseLeave","StartMouseMove","MouseMove","EndMouseMove","LeftButtonPress","LeftButtonRelease","MiddleButtonPress","MiddleButtonRelease","RightButtonPress","RightButtonRelease","KeyPress","KeyDown","KeyUp","StartMouseWheel","MouseWheel","EndMouseWheel","StartPinch","Pinch","EndPinch","StartPan","Pan","EndPan","StartRotate","Rotate","EndRotate","Button3D","Move3D","StartPointerLock","EndPointerLock","StartInteraction","Interaction","EndInteraction","AnimationFrameRateUpdate"];function ar(t){t.cancelable&&t.preventDefault()}function oa(t){var e=Object.create(null);return t.forEach(function(r){var n=r.pointerId,a=r.position;e[n]=a}),e}function Lx(t,e){e.classHierarchy.push("vtkRenderWindowInteractor");var r=new Set,n=new Map,a=1;t.start=function(){!e.initialized&&(t.initialize(),!e.initialized)||t.startEventLoop()},t.setRenderWindow=function(g){ia("you want to call setView(view) instead of setRenderWindow on a vtk.js interactor")},t.setInteractorStyle=function(g){e.interactorStyle!==g&&(e.interactorStyle!=null&&e.interactorStyle.setInteractor(null),e.interactorStyle=g,e.interactorStyle!=null&&e.interactorStyle.getInteractor()!==t&&e.interactorStyle.setInteractor(t))},t.initialize=function(){e.initialized=!0,t.enable(),t.render()},t.enable=function(){return t.setEnabled(!0)},t.disable=function(){return t.setEnabled(!1)},t.startEventLoop=function(){return aa("empty event loop")};function i(g,p){e._forcedRenderer||(e.currentRenderer=t.findPokedRenderer(g,p))}t.getCurrentRenderer=function(){return e.currentRenderer||i(0,0),e.currentRenderer};function o(g){var p=e._view.getCanvas(),l=p.getBoundingClientRect(),h=p.width/l.width,y=p.height/l.height,C={x:h*(g.clientX-l.left),y:y*(l.height-g.clientY+l.top),z:0};return(n.size<=1||!e.currentRenderer)&&i(C.x,C.y),C}function s(g){return{controlKey:g.ctrlKey,altKey:g.altKey,shiftKey:g.shiftKey}}function f(g){var p=s(g),l=Se({key:g.key,keyCode:g.charCode},p);return l}function c(g){return g.pointerType||""}t.bindEvents=function(g){e.container=g,g.addEventListener("contextmenu",ar),g.addEventListener("wheel",t.handleWheel),g.addEventListener("DOMMouseScroll",t.handleWheel),g.addEventListener("pointerenter",t.handlePointerEnter),g.addEventListener("pointerleave",t.handlePointerLeave),g.addEventListener("pointermove",t.handlePointerMove,{passive:!1}),g.addEventListener("pointerdown",t.handlePointerDown,{passive:!1}),g.addEventListener("pointerup",t.handlePointerUp),g.addEventListener("pointercancel",t.handlePointerCancel),document.addEventListener("keypress",t.handleKeyPress),document.addEventListener("keydown",t.handleKeyDown),document.addEventListener("keyup",t.handleKeyUp),document.addEventListener("pointerlockchange",t.handlePointerLockChange),g.style.touchAction="none",g.style.userSelect="none",g.style.webkitTapHighlightColor="rgba(0,0,0,0)"},t.unbindEvents=function(){var g=e.container;g.removeEventListener("contextmenu",ar),g.removeEventListener("wheel",t.handleWheel),g.removeEventListener("DOMMouseScroll",t.handleWheel),g.removeEventListener("pointerenter",t.handlePointerEnter),g.removeEventListener("pointerleave",t.handlePointerLeave),g.removeEventListener("pointermove",t.handlePointerMove,{passive:!1}),g.removeEventListener("pointerdown",t.handlePointerDown,{passive:!1}),g.removeEventListener("pointerup",t.handlePointerUp),g.removeEventListener("pointercancel",t.handlePointerCancel),document.removeEventListener("keypress",t.handleKeyPress),document.removeEventListener("keydown",t.handleKeyDown),document.removeEventListener("keyup",t.handleKeyUp),document.removeEventListener("pointerlockchange",t.handlePointerLockChange),e.container=null,n.clear()},t.handleKeyPress=function(g){var p=f(g);t.keyPressEvent(p)},t.handleKeyDown=function(g){var p=f(g);t.keyDownEvent(p)},t.handleKeyUp=function(g){var p=f(g);t.keyUpEvent(p)},t.handlePointerEnter=function(g){var p=Se(Se({},s(g)),{},{position:o(g),deviceType:c(g)});t.pointerEnterEvent(p),p.deviceType==="mouse"&&t.mouseEnterEvent(p)},t.handlePointerLeave=function(g){var p=Se(Se({},s(g)),{},{position:o(g),deviceType:c(g)});t.pointerLeaveEvent(p),p.deviceType==="mouse"&&t.mouseLeaveEvent(p)},t.handlePointerDown=function(g){if(!(g.button>2||t.isPointerLocked()))switch(e.preventDefaultOnPointerDown&&ar(g),g.target.hasPointerCapture(g.pointerId)&&g.target.releasePointerCapture(g.pointerId),e.container.setPointerCapture(g.pointerId),n.has(g.pointerId)&&aa("[RenderWindowInteractor] duplicate pointerId detected"),n.set(g.pointerId,{pointerId:g.pointerId,position:o(g)}),g.pointerType){case"pen":case"touch":t.handleTouchStart(g);break;case"mouse":default:t.handleMouseDown(g);break}},t.handlePointerUp=function(g){if(n.has(g.pointerId))switch(e.preventDefaultOnPointerUp&&ar(g),n.delete(g.pointerId),e.container.releasePointerCapture(g.pointerId),g.pointerType){case"pen":case"touch":t.handleTouchEnd(g);break;case"mouse":default:t.handleMouseUp(g);break}},t.handlePointerCancel=function(g){if(n.has(g.pointerId))switch(n.delete(g.pointerId),g.pointerType){case"pen":case"touch":t.handleTouchEnd(g);break;case"mouse":default:t.handleMouseUp(g);break}},t.handlePointerMove=function(g){if(n.has(g.pointerId)){var p=n.get(g.pointerId);p.position=o(g)}switch(g.pointerType){case"pen":case"touch":t.handleTouchMove(g);break;case"mouse":default:t.handleMouseMove(g);break}},t.handleMouseDown=function(g){var p=Se(Se({},s(g)),{},{position:o(g),deviceType:c(g)});switch(g.button){case 0:t.leftButtonPressEvent(p);break;case 1:t.middleButtonPressEvent(p);break;case 2:t.rightButtonPressEvent(p);break;default:ia("Unknown mouse button pressed: ".concat(g.button));break}},t.requestPointerLock=function(){e.container&&e.container.requestPointerLock()},t.exitPointerLock=function(){return document.exitPointerLock()},t.isPointerLocked=function(){return!!e.container&&document.pointerLockElement===e.container},t.handlePointerLockChange=function(){t.isPointerLocked()?t.startPointerLockEvent():t.endPointerLockEvent()};function u(){e._view&&e.enabled&&e.enableRender&&(e.inRender=!0,e._view.traverseAllPasses(),e.inRender=!1),t.invokeRenderEvent()}t.requestAnimation=function(g){if(g===void 0){ia("undefined requester, can not start animating");return}if(r.has(g)){aa("requester is already registered for animating");return}r.add(g),!e.animationRequest&&r.size===1&&!e.xrAnimation&&(e._animationStartTime=Date.now(),e._animationFrameCount=0,e.animationRequest=requestAnimationFrame(t.handleAnimation),t.startAnimationEvent())},t.extendAnimation=function(g){var p=Date.now()+g;e._animationExtendedEnd=Math.max(e._animationExtendedEnd,p),!e.animationRequest&&r.size===0&&!e.xrAnimation&&(e._animationStartTime=Date.now(),e._animationFrameCount=0,e.animationRequest=requestAnimationFrame(t.handleAnimation),t.startAnimationEvent())},t.isAnimating=function(){return e.xrAnimation||e.animationRequest!==null},t.cancelAnimation=function(g){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!r.has(g)){if(!p){var l=g&&g.getClassName?g.getClassName():g;aa("".concat(l," did not request an animation"))}return}r.delete(g),e.animationRequest&&r.size===0&&Date.now()>e._animationExtendedEnd&&(cancelAnimationFrame(e.animationRequest),e.animationRequest=null,t.endAnimationEvent(),t.render())},t.switchToXRAnimation=function(){e.animationRequest&&(cancelAnimationFrame(e.animationRequest),e.animationRequest=null),e.xrAnimation=!0},t.returnFromXRAnimation=function(){e.xrAnimation=!1,r.size!==0&&(e.recentAnimationFrameRate=10,e.animationRequest=requestAnimationFrame(t.handleAnimation))},t.updateXRGamepads=function(g,p,l){g.inputSources.forEach(function(h){var y=h.gripSpace==null?null:p.getPose(h.gripSpace,l),C=h.gamepad,S=h.handedness;if(C){C.index in e.lastGamepadValues||(e.lastGamepadValues[C.index]={left:{buttons:{}},right:{buttons:{}},none:{buttons:{}}});for(var d=0;d<C.buttons.length;++d)d in e.lastGamepadValues[C.index][S].buttons||(e.lastGamepadValues[C.index][S].buttons[d]=!1),e.lastGamepadValues[C.index][S].buttons[d]!==C.buttons[d].pressed&&y!=null&&(t.button3DEvent({gamepad:C,position:y.transform.position,orientation:y.transform.orientation,pressed:C.buttons[d].pressed,device:h.handedness==="left"?ra.LeftController:ra.RightController,input:Ei[C.mapping]&&Ei[C.mapping][d]?Ei[C.mapping][d]:gn.Trigger}),e.lastGamepadValues[C.index][S].buttons[d]=C.buttons[d].pressed),e.lastGamepadValues[C.index][S].buttons[d]&&y!=null&&t.move3DEvent({gamepad:C,position:y.transform.position,orientation:y.transform.orientation,device:h.handedness==="left"?ra.LeftController:ra.RightController})}})},t.handleMouseMove=function(g){var p=Se(Se({},s(g)),{},{position:o(g),deviceType:c(g)});e.moveTimeoutID===0?t.startMouseMoveEvent(p):(t.mouseMoveEvent(p),clearTimeout(e.moveTimeoutID)),e.moveTimeoutID=setTimeout(function(){t.endMouseMoveEvent(),e.moveTimeoutID=0},200)},t.handleAnimation=function(){var g=Date.now();e._animationFrameCount++,g-e._animationStartTime>1e3&&e._animationFrameCount>1&&(e.recentAnimationFrameRate=1e3*(e._animationFrameCount-1)/(g-e._animationStartTime),e.lastFrameTime=1/e.recentAnimationFrameRate,t.animationFrameRateUpdateEvent(),e._animationStartTime=g,e._animationFrameCount=1),t.animationEvent(),u(),r.size>0||Date.now()<e._animationExtendedEnd?e.animationRequest=requestAnimationFrame(t.handleAnimation):(cancelAnimationFrame(e.animationRequest),e.animationRequest=null,t.endAnimationEvent(),t.render())},t.handleWheel=function(g){ar(g);var p=Se(Se(Se({},Rx(g)),s(g)),{},{position:o(g),deviceType:c(g)});e.wheelTimeoutID===0&&(Math.abs(p.spinY)>=.3?a=Math.abs(p.spinY):a=1),p.spinY/=a,e.wheelTimeoutID===0?(t.startMouseWheelEvent(p),t.mouseWheelEvent(p)):(t.mouseWheelEvent(p),clearTimeout(e.wheelTimeoutID)),e.mouseScrollDebounceByPass?(t.extendAnimation(600),t.endMouseWheelEvent(),e.wheelTimeoutID=0):e.wheelTimeoutID=setTimeout(function(){t.extendAnimation(600),t.endMouseWheelEvent(),e.wheelTimeoutID=0},200)},t.handleMouseUp=function(g){var p=Se(Se({},s(g)),{},{position:o(g),deviceType:c(g)});switch(g.button){case 0:t.leftButtonReleaseEvent(p);break;case 1:t.middleButtonReleaseEvent(p);break;case 2:t.rightButtonReleaseEvent(p);break;default:ia("Unknown mouse button released: ".concat(g.button));break}},t.handleTouchStart=function(g){var p=W(n.values());if(e.recognizeGestures&&p.length>1){var l=oa(n);if(p.length===2){var h=Se(Se({},s(mn)),{},{position:p[0].position,deviceType:c(g)});t.leftButtonReleaseEvent(h)}t.recognizeGesture("TouchStart",l)}else if(p.length===1){var y=Se(Se({},s(mn)),{},{position:o(g),deviceType:c(g)});t.leftButtonPressEvent(y)}},t.handleTouchMove=function(g){var p=W(n.values());if(e.recognizeGestures&&p.length>1){var l=oa(n);t.recognizeGesture("TouchMove",l)}else if(p.length===1){var h=Se(Se({},s(mn)),{},{position:p[0].position,deviceType:c(g)});t.mouseMoveEvent(h)}},t.handleTouchEnd=function(g){var p=W(n.values());if(e.recognizeGestures)if(p.length===0){var l=Se(Se({},s(mn)),{},{position:o(g),deviceType:c(g)});t.leftButtonReleaseEvent(l)}else if(p.length===1){var h=oa(n);t.recognizeGesture("TouchEnd",h);var y=Se(Se({},s(mn)),{},{position:p[0].position,deviceType:c(g)});t.leftButtonPressEvent(y)}else{var C=oa(n);t.recognizeGesture("TouchMove",C)}else if(p.length===1){var S=Se(Se({},s(mn)),{},{position:p[0].position,deviceType:c(g)});t.leftButtonReleaseEvent(S)}},t.setView=function(g){e._view!==g&&(e._view=g,e._view.getRenderable().setInteractor(t),t.modified())},t.getFirstRenderer=function(){var g,p,l;return(g=e._view)===null||g===void 0||(p=g.getRenderable())===null||p===void 0||(l=p.getRenderersByReference())===null||l===void 0?void 0:l[0]},t.findPokedRenderer=function(){var g,p,l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!e._view)return null;var y=(g=e._view)===null||g===void 0||(p=g.getRenderable())===null||p===void 0?void 0:p.getRenderers();if(!y||y.length===0)return null;y.sort(function(M,x){return M.getLayer()-x.getLayer()});for(var C=null,S=null,d=null,O=y.length;O--;){var w=y[O];if(e._view.isInViewport(l,h,w)&&w.getInteractive()){d=w;break}C===null&&w.getInteractive()&&(C=w),S===null&&e._view.isInViewport(l,h,w)&&(S=w)}return d===null&&(d=C),d===null&&(d=S),d==null&&(d=y[0]),d},t.render=function(){!t.isAnimating()&&!e.inRender&&u()},Ao.forEach(function(g){var p=g.charAt(0).toLowerCase()+g.slice(1);t["".concat(p,"Event")]=function(l){if(e.enabled){var h=t.getCurrentRenderer();if(!h){Vx(`
          Can not forward events without a current renderer on the interactor.
        `);return}var y=Se({type:g,pokedRenderer:e.currentRenderer,firstRenderer:t.getFirstRenderer()},l);t["invoke".concat(g)](y)}}}),t.recognizeGesture=function(g,p){if(!(Object.keys(p).length>2)){if(e.startingEventPositions||(e.startingEventPositions={}),g==="TouchStart"){Object.keys(p).forEach(function(k){e.startingEventPositions[k]=p[k]}),e.currentGesture="Start";return}if(g==="TouchEnd"){e.currentGesture==="Pinch"&&(t.render(),t.endPinchEvent()),e.currentGesture==="Rotate"&&(t.render(),t.endRotateEvent()),e.currentGesture==="Pan"&&(t.render(),t.endPanEvent()),e.currentGesture="Start",e.startingEventPositions={};return}var l=0,h=[],y=[];Object.keys(p).forEach(function(k){h[l]=p[k],y[l]=e.startingEventPositions[k],l++});var C=Math.sqrt((y[0].x-y[1].x)*(y[0].x-y[1].x)+(y[0].y-y[1].y)*(y[0].y-y[1].y)),S=Math.sqrt((h[0].x-h[1].x)*(h[0].x-h[1].x)+(h[0].y-h[1].y)*(h[0].y-h[1].y)),d=Fr(Math.atan2(y[1].y-y[0].y,y[1].x-y[0].x)),O=Fr(Math.atan2(h[1].y-h[0].y,h[1].x-h[0].x)),w=O-d;O=O+180>=360?O-180:O+180,d=d+180>=360?d-180:d+180,Math.abs(O-d)<Math.abs(w)&&(w=O-d);var M=[];if(M[0]=(h[0].x-y[0].x+h[1].x-y[1].x)/2,M[1]=(h[0].y-y[0].y+h[1].y-y[1].y)/2,g==="TouchMove")if(e.currentGesture==="Start"){var x=.01*Math.sqrt(e.container.clientWidth*e.container.clientWidth+e.container.clientHeight*e.container.clientHeight);x<15&&(x=15);var D=Math.abs(S-C),R=S*3.1415926*Math.abs(w)/360,V=Math.sqrt(M[0]*M[0]+M[1]*M[1]);if(D>x&&D>R&&D>V){e.currentGesture="Pinch";var E={scale:1,touches:p};t.startPinchEvent(E)}else if(R>x&&R>V){e.currentGesture="Rotate";var L={rotation:0,touches:p};t.startRotateEvent(L)}else if(V>x){e.currentGesture="Pan";var m={translation:[0,0],touches:p};t.startPanEvent(m)}}else{if(e.currentGesture==="Rotate"){var N={rotation:w,touches:p};t.rotateEvent(N)}if(e.currentGesture==="Pinch"){var _={scale:S/C,touches:p};t.pinchEvent(_)}if(e.currentGesture==="Pan"){var G={translation:M,touches:p};t.panEvent(G)}}}},t.handleVisibilityChange=function(){e._animationStartTime=Date.now(),e._animationFrameCount=0},t.setCurrentRenderer=function(g){e._forcedRenderer=!!g,e.currentRenderer=g};var v=t.delete;t.delete=function(){for(;r.size;)t.cancelAnimation(r.values().next().value);typeof document.hidden<"u"&&document.removeEventListener("visibilitychange",t.handleVisibilityChange),e.container&&t.unbindEvents(),v()},typeof document.hidden<"u"&&document.addEventListener("visibilitychange",t.handleVisibilityChange,!1)}var mx={renderWindow:null,interactorStyle:null,picker:null,pickingManager:null,initialized:!1,enabled:!1,enableRender:!0,currentRenderer:null,lightFollowCamera:!0,desiredUpdateRate:30,stillUpdateRate:2,container:null,recognizeGestures:!0,currentGesture:"Start",animationRequest:null,lastFrameTime:.1,recentAnimationFrameRate:10,wheelTimeoutID:0,moveTimeoutID:0,lastGamepadValues:{},preventDefaultOnPointerDown:!1,preventDefaultOnPointerUp:!1,mouseScrollDebounceByPass:!1};function Xv(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,mx,r),T.obj(t,e),e._animationExtendedEnd=0,T.event(t,e,"RenderEvent"),Ao.forEach(function(n){return T.event(t,e,n)}),T.get(t,e,["initialized","container","interactorStyle","lastFrameTime","recentAnimationFrameRate","_view"]),T.setGet(t,e,["lightFollowCamera","enabled","enableRender","recognizeGestures","desiredUpdateRate","stillUpdateRate","picker","preventDefaultOnPointerDown","preventDefaultOnPointerUp","mouseScrollDebounceByPass"]),T.moveToProtected(t,e,["view"]),Lx(t,e)}var kx=T.newInstance(Xv,"vtkRenderWindowInteractor"),Yv=Se({newInstance:kx,extend:Xv,handledEvents:Ao},Yo);function Bu(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function Av(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Bu(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Bu(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var Fx=T.vtkErrorMacro,Nx=T.VOID;function Ux(t,e,r,n){var a=t.getRenderWindow().getViews()[0];return a.worldToDisplay(e,r,n,t)}function Gx(t,e,r,n){var a=t.getRenderWindow().getViews()[0];return a.displayToWorld(e,r,n,t)}var Bx={computeWorldToDisplay:Ux,computeDisplayToWorld:Gx};function _x(t,e){e.classHierarchy.push("vtkInteractorObserver");var r=Av({},t);function n(){for(;e.subscribedEvents.length;)e.subscribedEvents.pop().unsubscribe()}function a(){Yv.handledEvents.forEach(function(i){t["handle".concat(i)]&&e.subscribedEvents.push(e._interactor["on".concat(i)](function(o){return e.processEvents?t["handle".concat(i)](o):Nx},e.priority))})}t.setInteractor=function(i){i!==e._interactor&&(n(),e._interactor=i,i&&e.enabled&&a(),t.modified())},t.setEnabled=function(i){i!==e.enabled&&(n(),i&&(e._interactor?a():Fx(`
          The interactor must be set before subscribing to events
        `)),e.enabled=i,t.modified())},t.computeDisplayToWorld=function(i,o,s,f){return i?e._interactor.getView().displayToWorld(o,s,f,i):null},t.computeWorldToDisplay=function(i,o,s,f){return i?e._interactor.getView().worldToDisplay(o,s,f,i):null},t.setPriority=function(i){var o=r.setPriority(i);o&&e._interactor&&(n(),a())}}var jx={enabled:!0,priority:0,processEvents:!0,subscribedEvents:[]};function Zv(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jx,r),T.obj(t,e),T.event(t,e,"InteractionEvent"),T.event(t,e,"StartInteractionEvent"),T.event(t,e,"EndInteractionEvent"),T.get(t,e,["_interactor","enabled"]),T.setGet(t,e,["priority","processEvents"]),T.moveToProtected(t,e,["interactor"]),_x(t,e)}var Wx=T.newInstance(Zv,"vtkInteractorObserver"),qv=Av({newInstance:Wx,extend:Zv},Bx),io={IS_START:0,IS_NONE:0,IS_ROTATE:1,IS_PAN:2,IS_SPIN:3,IS_DOLLY:4,IS_CAMERA_POSE:11,IS_WINDOW_LEVEL:1024,IS_SLICE:1025},ei={States:io};function _u(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function $x(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?_u(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):_u(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var Dt=ei.States,Ri={Rotate:Dt.IS_ROTATE,Pan:Dt.IS_PAN,Spin:Dt.IS_SPIN,Dolly:Dt.IS_DOLLY,CameraPose:Dt.IS_CAMERA_POSE,WindowLevel:Dt.IS_WINDOW_LEVEL,Slice:Dt.IS_SLICE};function zx(t,e){e.classHierarchy.push("vtkInteractorStyle"),Object.keys(Ri).forEach(function(r){T.event(t,e,"Start".concat(r,"Event")),t["start".concat(r)]=function(){e.state===Dt.IS_NONE&&(e.state=Ri[r],e._interactor.requestAnimation(t),t.invokeStartInteractionEvent({type:"StartInteractionEvent"}),t["invokeStart".concat(r,"Event")]({type:"Start".concat(r,"Event")}))},T.event(t,e,"End".concat(r,"Event")),t["end".concat(r)]=function(){e.state===Ri[r]&&(e.state=Dt.IS_NONE,e._interactor.cancelAnimation(t),t.invokeEndInteractionEvent({type:"EndInteractionEvent"}),t["invokeEnd".concat(r,"Event")]({type:"End".concat(r,"Event")}),e._interactor.render())}}),t.handleKeyPress=function(r){var n=e._interactor,a=null;switch(r.key){case"r":case"R":r.pokedRenderer.resetCamera(),n.render();break;case"w":case"W":a=r.pokedRenderer.getActors(),a.forEach(function(i){var o=i.getProperty();o.setRepresentationToWireframe&&o.setRepresentationToWireframe()}),n.render();break;case"s":case"S":a=r.pokedRenderer.getActors(),a.forEach(function(i){var o=i.getProperty();o.setRepresentationToSurface&&o.setRepresentationToSurface()}),n.render();break;case"v":case"V":a=r.pokedRenderer.getActors(),a.forEach(function(i){var o=i.getProperty();o.setRepresentationToPoints&&o.setRepresentationToPoints()}),n.render();break}}}var bx={state:Dt.IS_NONE,handleObservers:1,autoAdjustCameraClippingRange:1};function Jv(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,bx,r),qv.extend(t,e,r),zx(t,e)}var Hx=T.newInstance(Jv,"vtkInteractorStyle"),Qv=$x({newInstance:Hx,extend:Jv},ei);function ju(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function Kx(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?ju(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ju(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var Vi=T.vtkDebugMacro,Px=Qv.States,ir={type:"StartInteractionEvent"},bt={type:"InteractionEvent"},or={type:"EndInteractionEvent"};function oo(t,e,r,n,a,i){var o=t.getActiveCamera(),s=o.getFocalPoint();s=e.getInteractorStyle().computeWorldToDisplay(t,s[0],s[1],s[2]);var f=s[2],c=e.getInteractorStyle().computeDisplayToWorld(t,r,n,f),u=e.getInteractorStyle().computeDisplayToWorld(t,a,i,f),v=[u[0]-c[0],u[1]-c[1],u[2]-c[2]];s=o.getFocalPoint();var g=o.getPosition();o.setFocalPoint(v[0]+s[0],v[1]+s[1],v[2]+s[2]),o.setPosition(v[0]+g[0],v[1]+g[1],v[2]+g[2])}function Xx(t,e,r,n){var a=r.getActiveCamera();if(a.getParallelProjection()){var i=n.getView(),o=i.getViewportSize(r),s=r.getViewport(),f=i.getSize(),c=o[0],u=o[1],v=c/2,g=u/2,p=e.x-s[0]*f[0],l=e.y-s[1]*f[1];oo(r,n,v,g,p,l),a.setParallelScale(a.getParallelScale()/t),oo(r,n,p,l,v,g)}else{var h=a.getFocalPoint(),y=a.getViewPlaneNormal();h=n.getInteractorStyle().computeWorldToDisplay(r,h[0],h[1],h[2]);var C=n.getInteractorStyle().computeDisplayToWorld(r,e.x,e.y,h[2]);a.setFocalPoint(C[0],C[1],C[2]),a.dolly(t),r.resetCameraClippingRange();var S=a.getPosition();h=a.getFocalPoint();var d=[0,0,0],O=y[0]*(h[0]-S[0])+y[1]*(h[1]-S[1])+y[2]*(h[2]-S[2]);O/=Math.pow(y[0],2)+Math.pow(y[1],2)+Math.pow(y[2],2),d[0]=S[0]+y[0]*O,d[1]=S[1]+y[1]*O,d[2]=S[2]+y[2]*O,a.setFocalPoint(d[0],d[1],d[2]),r.resetCameraClippingRange()}}function Yx(t,e,r){if(!Number.isNaN(r)){var n=e.getActiveCamera();n.getParallelProjection()?n.setParallelScale(n.getParallelScale()/r):(n.dolly(r),e.resetCameraClippingRange()),t.getLightFollowCamera()&&e.updateLightsGeometryToFollowCamera()}}var Ax={dollyToPosition:Xx,translateCamera:oo,dollyByFactor:Yx};function Zx(t,e){e.classHierarchy.push("vtkInteractorStyleManipulator"),e.mouseManipulators=[],e.keyboardManipulators=[],e.vrManipulators=[],e.gestureManipulators=[],e.currentManipulator=null,e.currentWheelManipulator=null,e.centerOfRotation=[0,0,0],e.rotationFactor=1,t.removeAllManipulators=function(){t.removeAllMouseManipulators(),t.removeAllKeyboardManipulators(),t.removeAllVRManipulators(),t.removeAllGestureManipulators()},t.removeAllMouseManipulators=function(){e.mouseManipulators=[]},t.removeAllKeyboardManipulators=function(){e.keyboardManipulators=[]},t.removeAllVRManipulators=function(){e.vrManipulators=[]},t.removeAllGestureManipulators=function(){e.gestureManipulators=[]};var r=function(i,o){var s=o.indexOf(i);return s===-1?!1:(o.splice(s,1),t.modified(),!0)};t.removeMouseManipulator=function(a){return r(a,e.mouseManipulators)},t.removeKeyboardManipulator=function(a){return r(a,e.keyboardManipulators)},t.removeVRManipulator=function(a){return r(a,e.vrManipulators)},t.removeGestureManipulator=function(a){return r(a,e.gestureManipulators)};var n=function(i,o){var s=o.indexOf(i);return s!==-1?!1:(o.push(i),t.modified(),!0)};t.addMouseManipulator=function(a){return n(a,e.mouseManipulators)},t.addKeyboardManipulator=function(a){return n(a,e.keyboardManipulators)},t.addVRManipulator=function(a){return n(a,e.vrManipulators)},t.addGestureManipulator=function(a){return n(a,e.gestureManipulators)},t.getNumberOfMouseManipulators=function(){return e.mouseManipulators.length},t.getNumberOfKeyboardManipulators=function(){return e.keyboardManipulators.length},t.getNumberOfVRManipulators=function(){return e.vrManipulators.length},t.getNumberOfGestureManipulators=function(){return e.gestureManipulators.length},t.resetCurrentManipulator=function(){e.currentManipulator=null,e.currentWheelManipulator=null},t.handleLeftButtonPress=function(a){e.previousPosition=a.position,t.onButtonDown(1,a)},t.handleMiddleButtonPress=function(a){e.previousPosition=a.position,t.onButtonDown(2,a)},t.handleRightButtonPress=function(a){e.previousPosition=a.position,t.onButtonDown(3,a)},t.handleButton3D=function(a){a&&(e.currentManipulator=t.findVRManipulator(a.device,a.input,a.pressed),e.currentManipulator?(e.currentManipulator.onButton3D(t,a.pokedRenderer,e.state,a.device,a.input,a.pressed),a.pressed?t.startCameraPose():t.endCameraPose()):Vi("No manipulator found"))},t.handleMove3D=function(a){e.currentManipulator&&e.state===Px.IS_CAMERA_POSE&&e.currentManipulator.onMove3D(t,a.pokedRenderer,e.state,a)},t.onButtonDown=function(a,i){e.currentManipulator||(e.currentManipulator=t.findMouseManipulator(a,i.shiftKey,i.controlKey,i.altKey),e.currentManipulator?(e.currentManipulator.setCenter&&e.currentManipulator.setCenter(e.centerOfRotation),e.currentManipulator.setRotationFactor&&e.currentManipulator.setRotationFactor(e.rotationFactor),e.currentManipulator.startInteraction(),e.currentManipulator.onButtonDown(e._interactor,i.pokedRenderer,i.position),e._interactor.requestAnimation(t.onButtonDown),t.invokeStartInteractionEvent(ir)):Vi("No manipulator found"))},t.findMouseManipulator=function(a,i,o,s){for(var f=null,c=e.mouseManipulators.length;c--;){var u=e.mouseManipulators[c];u&&u.getButton()===a&&u.getShift()===i&&u.getControl()===o&&u.getAlt()===s&&u.isDragEnabled()&&(f=u)}return f},t.findVRManipulator=function(a,i){for(var o=null,s=e.vrManipulators.length;s--;){var f=e.vrManipulators[s];f&&f.getDevice()===a&&f.getInput()===i&&(o=f)}return o},t.handleLeftButtonRelease=function(){t.onButtonUp(1)},t.handleMiddleButtonRelease=function(){t.onButtonUp(2)},t.handleRightButtonRelease=function(){t.onButtonUp(3)},t.onButtonUp=function(a){e.currentManipulator&&e.currentManipulator.getButton&&e.currentManipulator.getButton()===a&&(e.currentManipulator.onButtonUp(e._interactor),e.currentManipulator.endInteraction(),e.currentManipulator=null,e._interactor.cancelAnimation(t.onButtonDown),t.invokeEndInteractionEvent(or))},t.handleStartMouseWheel=function(a){if(!e.currentWheelManipulator){for(var i=null,o=e.mouseManipulators.length;o--;){var s=e.mouseManipulators[o];s&&s.isScrollEnabled()&&s.getShift()===a.shiftKey&&s.getControl()===a.controlKey&&s.getAlt()===a.altKey&&(i=s)}i?(e.currentWheelManipulator=i,e.currentWheelManipulator.onStartScroll(e._interactor,a.pokedRenderer,a.spinY),e.currentWheelManipulator.startInteraction(),e._interactor.requestAnimation(t.handleStartMouseWheel),t.invokeStartInteractionEvent(ir)):Vi("No manipulator found")}},t.handleEndMouseWheel=function(){e.currentWheelManipulator&&e.currentWheelManipulator.onEndScroll&&(e.currentWheelManipulator.onEndScroll(e._interactor),e.currentWheelManipulator.endInteraction(),e.currentWheelManipulator=null,e._interactor.cancelAnimation(t.handleStartMouseWheel),t.invokeEndInteractionEvent(or))},t.handleMouseWheel=function(a){e.currentWheelManipulator&&e.currentWheelManipulator.onScroll&&(e.currentWheelManipulator.onScroll(e._interactor,a.pokedRenderer,a.spinY,e.cachedMousePosition),t.invokeInteractionEvent(bt))},t.handleMouseMove=function(a){e.cachedMousePosition=a.position,e.currentManipulator&&e.currentManipulator.onMouseMove&&(e.currentManipulator.onMouseMove(e._interactor,a.pokedRenderer,a.position),t.invokeInteractionEvent(bt))},t.handleKeyPress=function(a){e.keyboardManipulators.filter(function(i){return i.onKeyPress}).forEach(function(i){i.onKeyPress(e._interactor,a.pokedRenderer,a.key),t.invokeInteractionEvent(bt)})},t.handleKeyDown=function(a){e.keyboardManipulators.filter(function(i){return i.onKeyDown}).forEach(function(i){i.onKeyDown(e._interactor,a.pokedRenderer,a.key),t.invokeInteractionEvent(bt)})},t.handleKeyUp=function(a){e.keyboardManipulators.filter(function(i){return i.onKeyUp}).forEach(function(i){i.onKeyUp(e._interactor,a.pokedRenderer,a.key),t.invokeInteractionEvent(bt)})},t.handleStartPinch=function(a){t.startDolly();for(var i=e.gestureManipulators.length;i--;){var o=e.gestureManipulators[i];o&&o.isPinchEnabled()&&(o.onStartPinch(e._interactor,a.scale),o.startInteraction())}e._interactor.requestAnimation(t.handleStartPinch),t.invokeStartInteractionEvent(ir)},t.handleEndPinch=function(){t.endDolly();for(var a=e.gestureManipulators.length;a--;){var i=e.gestureManipulators[a];i&&i.isPinchEnabled()&&(i.onEndPinch(e._interactor),i.endInteraction())}e._interactor.cancelAnimation(t.handleStartPinch),t.invokeEndInteractionEvent(or)},t.handleStartRotate=function(a){t.startRotate();for(var i=e.gestureManipulators.length;i--;){var o=e.gestureManipulators[i];o&&o.isRotateEnabled()&&(o.onStartRotate(e._interactor,a.rotation),o.startInteraction())}e._interactor.requestAnimation(t.handleStartRotate),t.invokeStartInteractionEvent(ir)},t.handleEndRotate=function(){t.endRotate();for(var a=e.gestureManipulators.length;a--;){var i=e.gestureManipulators[a];i&&i.isRotateEnabled()&&(i.onEndRotate(e._interactor),i.endInteraction())}e._interactor.cancelAnimation(t.handleStartRotate),t.invokeEndInteractionEvent(or)},t.handleStartPan=function(a){t.startPan();for(var i=e.gestureManipulators.length;i--;){var o=e.gestureManipulators[i];o&&o.isPanEnabled()&&(o.onStartPan(e._interactor,a.translation),o.startInteraction())}e._interactor.requestAnimation(t.handleStartPan),t.invokeStartInteractionEvent(ir)},t.handleEndPan=function(){t.endPan();for(var a=e.gestureManipulators.length;a--;){var i=e.gestureManipulators[a];i&&i.isPanEnabled()&&(i.onEndPan(e._interactor),i.endInteraction())}e._interactor.cancelAnimation(t.handleStartPan),t.invokeEndInteractionEvent(or)},t.handlePinch=function(a){for(var i=e.gestureManipulators.length,o=0;i--;){var s=e.gestureManipulators[i];s&&s.isPinchEnabled()&&(s.onPinch(e._interactor,a.pokedRenderer,a.scale),o++)}o&&t.invokeInteractionEvent(bt)},t.handlePan=function(a){for(var i=e.gestureManipulators.length,o=0;i--;){var s=e.gestureManipulators[i];s&&s.isPanEnabled()&&(s.onPan(e._interactor,a.pokedRenderer,a.translation),o++)}o&&t.invokeInteractionEvent(bt)},t.handleRotate=function(a){for(var i=e.gestureManipulators.length,o=0;i--;){var s=e.gestureManipulators[i];s&&s.isRotateEnabled()&&(s.onRotate(e._interactor,a.pokedRenderer,a.rotation),o++)}o&&t.invokeInteractionEvent(bt)}}var qx={cachedMousePosition:null,currentManipulator:null,currentWheelManipulator:null,centerOfRotation:[0,0,0],rotationFactor:1};function Iv(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,qx,r),Qv.extend(t,e,r),T.setGet(t,e,["rotationFactor"]),T.get(t,e,["mouseManipulators","keyboardManipulators","vrManipulators","gestureManipulators"]),T.setGetArray(t,e,["centerOfRotation"],3),Zx(t,e)}var Jx=T.newInstance(Iv,"vtkInteractorStyleManipulator"),Br=Kx({newInstance:Jx,extend:Iv},Ax),Qx="WebGL",_a=Object.create(null);function ep(t,e){_a[t]=e}function Ix(){return Object.keys(_a)}function tp(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return _a[t]&&_a[t](e)}function eM(t,e){e.classHierarchy.push("vtkRenderWindow"),t.addRenderer=function(r){t.hasRenderer(r)||(r.setRenderWindow(t),e.renderers.push(r),t.modified())},t.removeRenderer=function(r){e.renderers=e.renderers.filter(function(n){return n!==r}),t.modified()},t.hasRenderer=function(r){return e.renderers.indexOf(r)!==-1},t.newAPISpecificView=function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return tp(r||e.defaultViewAPI,n)},t.addView=function(r){t.hasView(r)||(r.setRenderable(t),e._views.push(r),t.modified())},t.removeView=function(r){e._views=e._views.filter(function(n){return n!==r}),t.modified()},t.hasView=function(r){return e._views.indexOf(r)!==-1},t.preRender=function(){e.renderers.forEach(function(r){r.isActiveCameraCreated()||r.resetCamera()})},t.render=function(){t.preRender(),e.interactor?e.interactor.render():e._views.forEach(function(r){return r.traverseAllPasses()})},t.getStatistics=function(){var r={propCount:0,invisiblePropCount:0};return e.renderers.forEach(function(n){var a=n.getViewProps();a.forEach(function(i){if(i.getVisibility()){r.propCount+=1;var o=i.getMapper&&i.getMapper();if(o&&o.getPrimitiveCount){var s=o.getPrimitiveCount();Object.keys(s).forEach(function(f){r[f]||(r[f]=0),r[f]+=s[f]})}}else r.invisiblePropCount+=1})}),r.str=Object.keys(r).map(function(n){return"".concat(n,": ").concat(r[n])}).join(`
`),r},t.captureImages=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return T.setImmediate(t.render),e._views.map(function(a){return a.captureNextImage?a.captureNextImage(r,n):void 0}).filter(function(a){return!!a})}}var tM={defaultViewAPI:Qx,renderers:[],views:[],interactor:null,neverRendered:!0,numberOfLayers:1};function np(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,tM,r),T.obj(t,e),T.setGet(t,e,["interactor","numberOfLayers","_views","defaultViewAPI"]),T.get(t,e,["neverRendered"]),T.getArray(t,e,["renderers"]),T.moveToProtected(t,e,["views"]),T.event(t,e,"completion"),eM(t,e)}var nM=T.newInstance(np,"vtkRenderWindow"),rM={newInstance:nM,extend:np,registerViewConstructor:ep,listViewAPIs:Ix,newAPISpecificView:tp};function aM(t,e){e.classHierarchy.push("vtkRenderPass"),t.getOperation=function(){return e.currentOperation},t.setCurrentOperation=function(r){e.currentOperation=r,e.currentTraverseOperation="traverse".concat(T.capitalize(e.currentOperation))},t.getTraverseOperation=function(){return e.currentTraverseOperation},t.traverse=function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;e.deleted||(e._currentParent=n,e.preDelegateOperations.forEach(function(a){t.setCurrentOperation(a),r.traverse(t)}),e.delegates.forEach(function(a){a.traverse(r,t)}),e.postDelegateOperations.forEach(function(a){t.setCurrentOperation(a),r.traverse(t)}))}}var iM={delegates:[],currentOperation:null,preDelegateOperations:[],postDelegateOperations:[],currentParent:null};function rp(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,iM,r),T.obj(t,e),T.get(t,e,["currentOperation"]),T.setGet(t,e,["delegates","_currentParent","preDelegateOperations","postDelegateOperations"]),T.moveToProtected(t,e,["currentParent"]),aM(t,e)}var oM=T.newInstance(rp,"vtkRenderPass"),Zo={newInstance:oM,extend:rp},sM=zr.Representation,Wu=T.vtkErrorMacro;function uM(t){var e=F.substitute(t.Fragment,"//VTK::RenderPassFragmentShader::Impl",`
      float weight = gl_FragData[0].a * pow(max(1.1 - gl_FragCoord.z, 0.0), 2.0);
      gl_FragData[0] = vec4(gl_FragData[0].rgb*weight, gl_FragData[0].a);
      gl_FragData[1].r = weight;
    `,!1);t.Fragment=e.result}var fM=`//VTK::System::Dec

in vec2 tcoord;

uniform sampler2D translucentRTexture;
uniform sampler2D translucentRGBATexture;

// the output of this shader
//VTK::Output::Dec

void main()
{
  vec4 t1Color = texture(translucentRGBATexture, tcoord);
  float t2Color = texture(translucentRTexture, tcoord).r;
  gl_FragData[0] = vec4(t1Color.rgb/max(t2Color,0.01), 1.0 - t1Color.a);
}
`;function cM(t,e){e.classHierarchy.push("vtkOpenGLOrderIndependentTranslucentPass"),t.createVertexBuffer=function(){var r=new Float32Array([-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1]),n=new Float32Array([0,0,1,0,0,1,1,1]),a=new Uint16Array([4,0,1,3,2]),i=ie.newInstance({numberOfComponents:3,values:r});i.setName("points");var o=ie.newInstance({numberOfComponents:2,values:n});o.setName("tcoords");var s=ie.newInstance({numberOfComponents:1,values:a});e.tris.getCABO().createVBO(s,"polys",sM.SURFACE,{points:i,tcoords:o,cellOffset:0}),e.VBOBuildTime.modified()},t.createFramebuffer=function(r){var n,a=r.getSize(),i=r.getContext();e.framebuffer=Ia.newInstance(),e.framebuffer.setOpenGLRenderWindow(r),(n=e.framebuffer).create.apply(n,W(a)),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.bind(),e.translucentRGBATexture=$e.newInstance(),e.translucentRGBATexture.setInternalFormat(i.RGBA16F),e.translucentRGBATexture.setFormat(i.RGBA),e.translucentRGBATexture.setOpenGLDataType(i.HALF_FLOAT),e.translucentRGBATexture.setOpenGLRenderWindow(r),e.translucentRGBATexture.create2DFromRaw(a[0],a[1],4,"Float32Array",null),e.translucentRTexture=$e.newInstance(),e.translucentRTexture.setInternalFormat(i.R16F),e.translucentRTexture.setFormat(i.RED),e.translucentRTexture.setOpenGLDataType(i.HALF_FLOAT),e.translucentRTexture.setOpenGLRenderWindow(r),e.translucentRTexture.create2DFromRaw(a[0],a[1],1,"Float32Array",null),e.translucentZTexture=$e.newInstance(),e.translucentZTexture.setOpenGLRenderWindow(r),e.translucentZTexture.createDepthFromRaw(a[0],a[1],"Float32Array",null),e.framebuffer.setColorBuffer(e.translucentRGBATexture,0),e.framebuffer.setColorBuffer(e.translucentRTexture,1),e.framebuffer.setDepthBuffer(e.translucentZTexture)},t.createCopyShader=function(r){e.copyShader=r.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","attribute vec2 tcoordTC;","varying vec2 tcoord;","void main() { tcoord = tcoordTC; gl_Position = vertexDC; }"].join(`
`),fM,"")},t.createVBO=function(r){var n=r.getContext();e.tris.setOpenGLRenderWindow(r),t.createVertexBuffer();var a=e.copyShader;e.tris.getCABO().bind(),e.copyVAO.addAttributeArray(a,e.tris.getCABO(),"vertexDC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),n.FLOAT,3,n.FALSE)||Wu("Error setting vertexDC in copy shader VAO."),e.copyVAO.addAttributeArray(a,e.tris.getCABO(),"tcoordTC",e.tris.getCABO().getTCoordOffset(),e.tris.getCABO().getStride(),n.FLOAT,2,n.FALSE)||Wu("Error setting vertexDC in copy shader VAO.")},t.traverse=function(r,n,a){if(!e.deleted){var i=r.getSize(),o=r.getContext();if(e._supported=!1,n.getSelector()||!o||!r.getWebgl2()||!o.getExtension("EXT_color_buffer_half_float")&&!o.getExtension("EXT_color_buffer_float")){t.setCurrentOperation("translucentPass"),n.traverse(t);return}if(e._supported=!0,e.framebuffer===null)t.createFramebuffer(r);else{var s=e.framebuffer.getSize();s===null||s[0]!==i[0]||s[1]!==i[1]?(e.framebuffer.releaseGraphicsResources(),e.translucentRGBATexture.releaseGraphicsResources(r),e.translucentRTexture.releaseGraphicsResources(r),e.translucentZTexture.releaseGraphicsResources(r),t.createFramebuffer(r)):(e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.bind())}o.drawBuffers([o.COLOR_ATTACHMENT0]),o.clearBufferfv(o.COLOR,0,[0,0,0,0]),o.clearBufferfv(o.DEPTH,0,[1]),o.colorMask(!1,!1,!1,!1),a.getOpaqueActorCount()>0&&(a.setCurrentOperation("opaqueZBufferPass"),n.traverse(a)),o.colorMask(!0,!0,!0,!0),o.drawBuffers([o.COLOR_ATTACHMENT0,o.COLOR_ATTACHMENT1]),o.viewport(0,0,i[0],i[1]),o.scissor(0,0,i[0],i[1]),o.clearBufferfv(o.COLOR,0,[0,0,0,1]),o.clearBufferfv(o.COLOR,1,[0,0,0,0]),o.enable(o.DEPTH_TEST),o.enable(o.BLEND),o.blendFuncSeparate(o.ONE,o.ONE,o.ZERO,o.ONE_MINUS_SRC_ALPHA),t.setCurrentOperation("translucentPass"),n.traverse(t),o.drawBuffers([o.NONE]),e.framebuffer.restorePreviousBindingsAndBuffers(),e.copyShader===null?t.createCopyShader(r):r.getShaderCache().readyShaderProgram(e.copyShader),e.copyVAO||(e.copyVAO=yo.newInstance(),e.copyVAO.setOpenGLRenderWindow(r)),e.copyVAO.bind(),e.VBOBuildTime.getMTime()<t.getMTime()&&t.createVBO(r),o.blendFuncSeparate(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA),o.depthMask(!1),o.depthFunc(o.ALWAYS),o.viewport(0,0,i[0],i[1]),o.scissor(0,0,i[0],i[1]),e.translucentRGBATexture.activate(),e.copyShader.setUniformi("translucentRGBATexture",e.translucentRGBATexture.getTextureUnit()),e.translucentRTexture.activate(),e.copyShader.setUniformi("translucentRTexture",e.translucentRTexture.getTextureUnit()),o.drawArrays(o.TRIANGLES,0,e.tris.getCABO().getElementCount()),o.depthMask(!0),o.depthFunc(o.LEQUAL),e.translucentRGBATexture.deactivate(),e.translucentRTexture.deactivate()}},t.getShaderReplacement=function(){return e._supported?uM:null},t.releaseGraphicsResources=function(r){e.framebuffer&&(e.framebuffer.releaseGraphicsResources(r),e.framebuffer=null),e.translucentRGBATexture&&(e.translucentRGBATexture.releaseGraphicsResources(r),e.translucentRGBATexture=null),e.translucentRTexture&&(e.translucentRTexture.releaseGraphicsResources(r),e.translucentRTexture=null),e.translucentZTexture&&(e.translucentZTexture.releaseGraphicsResources(r),e.translucentZTexture=null),e.copyVAO&&(e.copyVAO.releaseGraphicsResources(r),e.copyVAO=null),e.copyShader&&(e.copyShader.releaseGraphicsResources(r),e.copyShader=null),e.tris&&(e.tris.releaseGraphicsResources(r),e.tris=null),t.modified()}}var gM={framebuffer:null,copyShader:null,tris:null};function ap(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,gM,r),Zo.extend(t,e,r),e.VBOBuildTime={},T.obj(e.VBOBuildTime,{mtime:0}),e.tris=$t.newInstance(),T.get(t,e,["framebuffer"]),cM(t,e)}var vM=T.newInstance(ap,"vtkOpenGLOrderIndependentTranslucentPass"),pM={newInstance:vM,extend:ap};function lM(t,e){e.classHierarchy.push("vtkForwardPass"),t.traverse=function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(!e.deleted){e._currentParent=n,t.setCurrentOperation("buildPass"),r.traverse(t);for(var a=r.getRenderable().getNumberOfLayers(),i=r.getChildren(),o=0;o<a;o++)for(var s=0;s<i.length;s++){var f=i[s],c=r.getRenderable().getRenderers()[s];if(c.getDraw()&&c.getLayer()===o){if(e.opaqueActorCount=0,e.translucentActorCount=0,e.volumeCount=0,e.overlayActorCount=0,t.setCurrentOperation("queryPass"),f.traverse(t),(e.opaqueActorCount>0||e.translucentActorCount>0)&&e.volumeCount>0||e.depthRequested){var u=r.getFramebufferSize();e.framebuffer===null&&(e.framebuffer=Ia.newInstance()),e.framebuffer.setOpenGLRenderWindow(r),e.framebuffer.saveCurrentBindingsAndBuffers();var v=e.framebuffer.getSize();(v===null||v[0]!==u[0]||v[1]!==u[1])&&(e.framebuffer.create(u[0],u[1]),e.framebuffer.populateFramebuffer()),e.framebuffer.bind(),t.setCurrentOperation("zBufferPass"),f.traverse(t),e.framebuffer.restorePreviousBindingsAndBuffers(),e.depthRequested=!1}t.setCurrentOperation("cameraPass"),f.traverse(t),e.opaqueActorCount>0&&(t.setCurrentOperation("opaquePass"),f.traverse(t)),e.translucentActorCount>0&&(e.translucentPass||(e.translucentPass=pM.newInstance()),e.translucentPass.traverse(r,f,t)),e.volumeCount>0&&(t.setCurrentOperation("volumePass"),f.traverse(t)),e.overlayActorCount>0&&(t.setCurrentOperation("overlayPass"),f.traverse(t))}}}},t.getZBufferTexture=function(){return e.framebuffer?e.framebuffer.getColorTexture():null},t.requestDepth=function(){e.depthRequested=!0},t.incrementOpaqueActorCount=function(){return e.opaqueActorCount++},t.incrementTranslucentActorCount=function(){return e.translucentActorCount++},t.incrementVolumeCount=function(){return e.volumeCount++},t.incrementOverlayActorCount=function(){return e.overlayActorCount++}}var hM={opaqueActorCount:0,translucentActorCount:0,volumeCount:0,overlayActorCount:0,framebuffer:null,depthRequested:!1};function ip(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,hM,r),Zo.extend(t,e,r),T.get(t,e,["framebuffer","opaqueActorCount","translucentActorCount","volumeCount"]),lM(t,e)}var yM=T.newInstance(ip,"vtkForwardPass"),TM={newInstance:yM,extend:ip},CM=["lastShaderBound","context","_openGLRenderWindow"];function SM(t,e){e.classHierarchy.push("vtkShaderCache"),t.replaceShaderValues=function(r,n,a){var i=n;a.length>0&&(i=F.substitute(i,"VSOut","GSOut").result);var o=e._openGLRenderWindow.getWebgl2(),s=`
`,f=`#version 100
`;o?f=`#version 300 es
#define attribute in
#define textureCube texture
#define texture2D texture
#define textureCubeLod textureLod
#define texture2DLod textureLod
`:(e.context.getExtension("OES_standard_derivatives"),e.context.getExtension("EXT_frag_depth")&&(s=`#extension GL_EXT_frag_depth : enable
`),e.context.getExtension("EXT_shader_texture_lod")&&(s+=`#extension GL_EXT_shader_texture_lod : enable
#define textureCubeLod textureCubeLodEXT
#define texture2DLod texture2DLodEXT`)),i=F.substitute(i,"//VTK::System::Dec",["".concat(f,`
`),o?"":`#extension GL_OES_standard_derivatives : enable
`,s,"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;var c=F.substitute(r,"//VTK::System::Dec",["".concat(f,`
`),"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;if(o){c=F.substitute(c,"varying","out").result,i=F.substitute(i,"varying","in").result;for(var u="",v=0;i.includes("gl_FragData[".concat(v,"]"));)i=F.substitute(i,"gl_FragData\\[".concat(v,"\\]"),"fragOutput".concat(v)).result,u+="layout(location = ".concat(v,") out vec4 fragOutput").concat(v,`;
`),v++;i=F.substitute(i,"//VTK::Output::Dec",u).result}var g=F.substitute(a,"//VTK::System::Dec",f).result;return{VSSource:c,FSSource:i,GSSource:g}},t.readyShaderProgramArray=function(r,n,a){var i=t.replaceShaderValues(r,n,a),o=t.getShaderProgram(i.VSSource,i.FSSource,i.GSSource);return t.readyShaderProgram(o)},t.readyShaderProgram=function(r){return!r||!r.getCompiled()&&!r.compileShader()||!t.bindShader(r)?null:r},t.getShaderProgram=function(r,n,a){var i="".concat(r).concat(n).concat(a),o=I0.hash(i);if(!(o in e.shaderPrograms)){var s=F.newInstance();return s.setContext(e.context),s.getVertexShader().setSource(r),s.getFragmentShader().setSource(n),a&&s.getGeometryShader().setSource(a),s.setMd5Hash(o),e.shaderPrograms[o]=s,s}return e.shaderPrograms[o]},t.releaseGraphicsResources=function(r){t.releaseCurrentShader(),Object.keys(e.shaderPrograms).map(function(n){return e.shaderPrograms[n]}).forEach(function(n){return n.releaseGraphicsResources(r)})},t.releaseGraphicsResources=function(){e.astShaderBound&&(e.lastShaderBound.release(),e.lastShaderBound=null)},t.bindShader=function(r){return e.lastShaderBound===r||(e.lastShaderBound&&e.lastShaderBound.release(),r.bind(),e.lastShaderBound=r),1}}var dM={lastShaderBound:null,shaderPrograms:null,context:null};function op(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,dM,r),e.shaderPrograms={},T.obj(t,e),T.setGet(t,e,CM),T.moveToProtected(t,e,["openGLRenderWindow"]),SM(t,e)}var OM=T.newInstance(op,"vtkShaderCache"),wM={newInstance:OM,extend:op},xM=T.vtkErrorMacro;function MM(t,e){e.classHierarchy.push("vtkOpenGLTextureUnitManager"),t.deleteTable=function(){for(var r=0;r<e.numberOfTextureUnits;++r)e.textureUnits[r]===!0&&xM("some texture units  were not properly released");e.textureUnits=[],e.numberOfTextureUnits=0},t.setContext=function(r){if(e.context!==r){if(e.context!==0&&t.deleteTable(),e.context=r,e.context){e.numberOfTextureUnits=r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS);for(var n=0;n<e.numberOfTextureUnits;++n)e.textureUnits[n]=!1}t.modified()}},t.allocate=function(){for(var r=0;r<e.numberOfTextureUnits;r++)if(!t.isAllocated(r))return e.textureUnits[r]=!0,r;return-1},t.allocateUnit=function(r){return t.isAllocated(r)?-1:(e.textureUnits[r]=!0,r)},t.isAllocated=function(r){return e.textureUnits[r]},t.free=function(r){e.textureUnits[r]=!1}}var DM={context:null,numberOfTextureUnits:0,textureUnits:0};function sp(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,DM,r),T.obj(t,e),e.textureUnits=[],T.get(t,e,["numberOfTextureUnits"]),T.setGet(t,e,["context"]),MM(t,e)}var EM=T.newInstance(sp,"vtkOpenGLTextureUnitManager"),RM={newInstance:EM,extend:sp};function VM(t,e){e.classHierarchy.push("vtkRenderWindowViewNode"),t.getViewNodeFactory=function(){return null},t.getAspectRatio=function(){return e.size[0]/e.size[1]},t.getAspectRatioForRenderer=function(r){var n=r.getViewportByReference();return e.size[0]*(n[2]-n[0])/((n[3]-n[1])*e.size[1])},t.isInViewport=function(r,n,a){var i=a.getViewportByReference(),o=t.getFramebufferSize();return i[0]*o[0]<=r&&i[2]*o[0]>=r&&i[1]*o[1]<=n&&i[3]*o[1]>=n},t.getViewportSize=function(r){var n=r.getViewportByReference(),a=t.getFramebufferSize();return[(n[2]-n[0])*a[0],(n[3]-n[1])*a[1]]},t.getViewportCenter=function(r){var n=t.getViewportSize(r);return[n[0]*.5,n[1]*.5]},t.displayToNormalizedDisplay=function(r,n,a){var i=t.getFramebufferSize();return[r/i[0],n/i[1],a]},t.normalizedDisplayToDisplay=function(r,n,a){var i=t.getFramebufferSize();return[r*i[0],n*i[1],a]},t.worldToView=function(r,n,a,i){return i.worldToView(r,n,a)},t.viewToWorld=function(r,n,a,i){return i.viewToWorld(r,n,a)},t.worldToDisplay=function(r,n,a,i){var o=i.worldToView(r,n,a),s=t.getViewportSize(i),f=i.viewToProjection(o[0],o[1],o[2],s[0]/s[1]),c=i.projectionToNormalizedDisplay(f[0],f[1],f[2]);return t.normalizedDisplayToDisplay(c[0],c[1],c[2])},t.displayToWorld=function(r,n,a,i){var o=t.displayToNormalizedDisplay(r,n,a),s=i.normalizedDisplayToProjection(o[0],o[1],o[2]),f=t.getViewportSize(i),c=i.projectionToView(s[0],s[1],s[2],f[0]/f[1]);return i.viewToWorld(c[0],c[1],c[2])},t.normalizedDisplayToViewport=function(r,n,a,i){var o=i.getViewportByReference();o=t.normalizedDisplayToDisplay(o[0],o[1],0);var s=t.normalizedDisplayToDisplay(r,n,a);return[s[0]-o[0]-.5,s[1]-o[1]-.5,a]},t.viewportToNormalizedViewport=function(r,n,a,i){var o=t.getViewportSize(i);return o&&o[0]!==0&&o[1]!==0?[r/(o[0]-1),n/(o[1]-1),a]:[r,n,a]},t.normalizedViewportToViewport=function(r,n,a,i){var o=t.getViewportSize(i);return[r*(o[0]-1),n*(o[1]-1),a]},t.displayToLocalDisplay=function(r,n,a){var i=t.getFramebufferSize();return[r,i[1]-n-1,a]},t.viewportToNormalizedDisplay=function(r,n,a,i){var o=i.getViewportByReference();o=t.normalizedDisplayToDisplay(o[0],o[1],0);var s=r+o[0]+.5,f=n+o[1]+.5;return t.displayToNormalizedDisplay(s,f,a)},t.getComputedDevicePixelRatio=function(){return e.size[0]/t.getContainerSize()[0]},t.getContainerSize=function(){T.vtkErrorMacro("not implemented")},t.getPixelData=function(r,n,a,i){T.vtkErrorMacro("not implemented")},t.createSelector=function(){T.vtkErrorMacro("not implemented")}}var LM={size:void 0,selector:void 0};function up(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,LM,r),e.size||(e.size=[300,300]),T.getArray(t,e,["size"],2),T.get(t,e,["selector"]),Qe.extend(t,e,r),VM(t,e)}var mM=T.newInstance(up,"vtkRenderWindowViewNode"),kM={newInstance:mM,extend:up},FM={HmdVR:0,MobileAR:1,LookingGlassVR:2},NM={XrSessionTypes:FM},fp="__getUnderlyingContext";function UM(){var t=new Map,e={apply:function(i,o,s){return t.has(s[0])?t.get(s[0]):i.apply(o,s)}};function r(a){return{apply:function(o,s,f){return t.set(a,f[0]),o.apply(s,f)}}}var n=Object.create(null);return n.getParameter=function(a,i,o,s){return new Proxy(s.bind(a),e)},n.depthMask=function(a,i,o,s){return new Proxy(s.bind(a),r(a.DEPTH_WRITEMASK))},{get:function(i,o,s){if(o===fp)return function(){return i};var f=Reflect.get(i,o,i);f instanceof Function&&(f=f.bind(i));var c=n[o];return c?c(i,o,s,f):f}}}var $u=T.vtkDebugMacro,zu=T.vtkErrorMacro,kn=NM.XrSessionTypes,GM={position:"absolute",top:0,left:0,width:"100%",height:"100%"},Fn={vr:{rescaleFactor:1,translateZ:-.7},ar:{rescaleFactor:.25,translateZ:-.5}};function Pe(t,e,r){var n=t.createFramebuffer(),a=t.createTexture();t.bindTexture(t.TEXTURE_2D,a),t.texImage2D(t.TEXTURE_2D,0,e,2,2,0,e,r,null),t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,a,0);var i=t.checkFramebufferStatus(t.FRAMEBUFFER);return t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null),i===t.FRAMEBUFFER_COMPLETE}var ja=0,cp=[];function BM(){ja++,cp.forEach(function(t){return t(ja)})}function _M(){ja--,cp.forEach(function(t){return t(ja)})}function bu(t){t.preventDefault()}function jM(t,e){e.classHierarchy.push("vtkOpenGLRenderWindow");var r=UM();t.getViewNodeFactory=function(){return e.myFactory},e.canvas.addEventListener("webglcontextlost",bu,!1),e.canvas.addEventListener("webglcontextrestored",t.restoreContext,!1);var n=navigator.xr!==void 0&&navigator.xr.isSessionSupported("immersive-vr"),a=[0,0];function i(){e.renderable&&(e.size[0]!==a[0]||e.size[1]!==a[1])&&(a[0]=e.size[0],a[1]=e.size[1],e.canvas.setAttribute("width",e.size[0]),e.canvas.setAttribute("height",e.size[1])),e.viewStream&&e.viewStream.setSize(e.size[0],e.size[1]),e.canvas.style.display=e.useOffScreen?"none":"block",e.el&&(e.el.style.cursor=e.cursorVisibility?e.cursor:"none"),e.containerSize=null}t.onModified(i),t.buildPass=function(u){if(u){if(!e.renderable)return;t.prepareNodes(),t.addMissingNodes(e.renderable.getRenderersByReference()),t.removeUnusedNodes(),t.initialize(),e.children.forEach(function(v){v.setOpenGLRenderWindow(t)})}},t.initialize=function(){if(!e.initialized){e.context=t.get3DContext(),e.textureUnitManager=RM.newInstance(),e.textureUnitManager.setContext(e.context),e.shaderCache.setContext(e.context);var u=e.context;u.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA),u.depthFunc(u.LEQUAL),u.enable(u.BLEND),e.initialized=!0}},t.makeCurrent=function(){e.context.makeCurrent()},t.setContainer=function(u){e.el&&e.el!==u&&(e.canvas.parentNode!==e.el&&zu("Error: canvas parent node does not match container"),e.el.removeChild(e.canvas),e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)),e.el!==u&&(e.el=u,e.el&&(e.el.appendChild(e.canvas),e.useBackgroundImage&&e.el.appendChild(e.bgImage)),t.modified())},t.getContainer=function(){return e.el},t.getContainerSize=function(){if(!e.containerSize&&e.el){var u=e.el.getBoundingClientRect(),v=u.width,g=u.height;e.containerSize=[v,g]}return e.containerSize||e.size},t.getFramebufferSize=function(){return e.activeFramebuffer?e.activeFramebuffer.getSize():e.size},t.getPixelData=function(u,v,g,p){var l=new Uint8Array((g-u+1)*(p-v+1)*4);return e.context.readPixels(u,v,g-u+1,p-v+1,e.context.RGBA,e.context.UNSIGNED_BYTE,l),l},t.get3DContext=function(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{preserveDrawingBuffer:!1,depth:!0,alpha:!0,powerPreference:"high-performance"},v=null;n&&t.invokeHaveVRDisplay();var g=typeof WebGL2RenderingContext<"u";return e.webgl2=!1,e.defaultToWebgl2&&g&&(v=e.canvas.getContext("webgl2",u),v&&(e.webgl2=!0,$u("using webgl2"))),v||($u("using webgl1"),v=e.canvas.getContext("webgl",u)||e.canvas.getContext("experimental-webgl",u)),new Proxy(v,r)},t.startXR=function(u){if(navigator.xr===void 0)throw new Error("WebXR is not available");e.xrSessionType=u!==void 0?u:kn.HmdVR;var v=u===kn.MobileAR,g=v?"immersive-ar":"immersive-vr";if(!navigator.xr.isSessionSupported(g))throw v?new Error("Device does not support AR session"):new Error("VR display is not available");if(e.xrSession===null)navigator.xr.requestSession(g).then(t.enterXR,function(){throw new Error("Failed to create XR session!")});else throw new Error("XR Session already exists!")},t.enterXR=function(){var u=Et(Ge.mark(function v(g){var p,l;return Ge.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(e.xrSession=g,e.oldCanvasSize=e.size.slice(),e.xrSession===null){y.next=15;break}return p=t.get3DContext(),y.next=6,p.makeXRCompatible();case 6:l=new global.XRWebGLLayer(e.xrSession,p[fp]()),t.setSize(l.framebufferWidth,l.framebufferHeight),e.xrSession.updateRenderState({baseLayer:l}),e.xrSession.requestReferenceSpace("local").then(function(C){e.xrReferenceSpace=C}),t.resetXRScene(),e.renderable.getInteractor().switchToXRAnimation(),e.xrSceneFrame=e.xrSession.requestAnimationFrame(t.xrRender),y.next=16;break;case 15:throw new Error("Failed to enter VR with a null xrSession.");case 16:case"end":return y.stop()}},v)}));return function(v){return u.apply(this,arguments)}}(),t.resetXRScene=function(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Fn.vr.rescaleFactor,v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Fn.vr.translateZ,g=u,p=v,l=e.xrSessionType===kn.MobileAR;l&&g===Fn.vr.rescaleFactor&&(g=Fn.ar.rescaleFactor),l&&p===Fn.vr.translateZ&&(p=Fn.ar.translateZ);var h=e.renderable.getRenderers()[0];h.resetCamera();var y=h.getActiveCamera(),C=y.getPhysicalScale(),S=y.getPhysicalTranslation();C/=g,p*=C,S[2]+=p,y.setPhysicalScale(C),y.setPhysicalTranslation(S),y.setClippingRange(.1*C,100*C)},t.stopXR=Et(Ge.mark(function u(){var v,g;return Ge.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(navigator.xr!==void 0){l.next=2;break}return l.abrupt("return");case 2:if(e.xrSession===null){l.next=10;break}return e.xrSession.cancelAnimationFrame(e.xrSceneFrame),e.renderable.getInteractor().returnFromXRAnimation(),v=t.get3DContext(),v.bindFramebuffer(v.FRAMEBUFFER,null),l.next=9,e.xrSession.end().catch(function(h){if(!(h instanceof DOMException))throw h});case 9:e.xrSession=null;case 10:e.oldCanvasSize!==void 0&&t.setSize.apply(t,W(e.oldCanvasSize)),g=e.renderable.getRenderers()[0],g.getActiveCamera().setProjectionMatrix(null),g.resetCamera(),g.setViewport(0,0,1,1),t.traverseAllPasses();case 16:case"end":return l.stop()}},u)})),t.xrRender=function(){var u=Et(Ge.mark(function v(g,p){var l,h,y,C,S;return Ge.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:l=p.session,e.renderable.getInteractor().updateXRGamepads(l,p,e.xrReferenceSpace),e.xrSceneFrame=e.xrSession.requestAnimationFrame(t.xrRender),h=p.getViewerPose(e.xrReferenceSpace),h&&(y=t.get3DContext(),e.xrSessionType===kn.MobileAR&&e.oldCanvasSize!==void 0&&(y.canvas.width=e.oldCanvasSize[0],y.canvas.height=e.oldCanvasSize[1]),C=l.renderState.baseLayer,y.bindFramebuffer(y.FRAMEBUFFER,C.framebuffer),y.clear(y.COLOR_BUFFER_BIT),y.clear(y.DEPTH_BUFFER_BIT),t.setSize(C.framebufferWidth,C.framebufferHeight),S=e.renderable.getRenderers()[0],h.views.forEach(function(w,M){var x=C.getViewport(w);if(e.xrSessionType===kn.HmdVR)if(w.eye==="left")S.setViewport(0,0,.5,1);else if(w.eye==="right")S.setViewport(.5,0,1,1);else return;else if(e.xrSessionType===kn.LookingGlassVR){var D=x.x/C.framebufferWidth,R=x.y/C.framebufferHeight,V=(x.x+x.width)/C.framebufferWidth,E=(x.y+x.height)/C.framebufferHeight;S.setViewport(D,R,V,E)}else S.setViewport(0,0,1,1);S.getActiveCamera().computeViewParametersFromPhysicalMatrix(w.transform.inverse.matrix),S.getActiveCamera().setProjectionMatrix(w.projectionMatrix),t.traverseAllPasses()}),y.scissor(0,0,C.framebufferWidth,C.framebufferHeight),y.disable(y.SCISSOR_TEST));case 5:case"end":return O.stop()}},v)}));return function(v,g){return u.apply(this,arguments)}}(),t.restoreContext=function(){var u=Zo.newInstance();u.setCurrentOperation("Release"),u.traverse(t,null)},t.activateTexture=function(u){var v=e._textureResourceIds.get(u);if(v!==void 0){e.context.activeTexture(e.context.TEXTURE0+v);return}var g=t.getTextureUnitManager().allocate();if(g<0){zu("Hardware does not support the number of textures defined.");return}e._textureResourceIds.set(u,g),e.context.activeTexture(e.context.TEXTURE0+g)},t.deactivateTexture=function(u){var v=e._textureResourceIds.get(u);v!==void 0&&(t.getTextureUnitManager().free(v),e._textureResourceIds.delete(u))},t.getTextureUnitForTexture=function(u){var v=e._textureResourceIds.get(u);return v!==void 0?v:-1},t.getDefaultTextureInternalFormat=function(u,v){var g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,p=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(e.webgl2)switch(u){case Me.UNSIGNED_CHAR:switch(v){case 1:return e.context.R8;case 2:return e.context.RG8;case 3:return e.context.RGB8;case 4:default:return e.context.RGBA8}case(g&&!p&&Me.UNSIGNED_SHORT):switch(v){case 1:return g.R16_EXT;case 2:return g.RG16_EXT;case 3:return g.RGB16_EXT;case 4:default:return g.RGBA16_EXT}case(g&&!p&&Me.SHORT):switch(v){case 1:return g.R16_SNORM_EXT;case 2:return g.RG16_SNORM_EXT;case 3:return g.RGB16_SNORM_EXT;case 4:default:return g.RGBA16_SNORM_EXT}case Me.FLOAT:default:switch(v){case 1:return e.context.R16F;case 2:return e.context.RG16F;case 3:return e.context.RGB16F;case 4:default:return e.context.RGBA16F}}switch(v){case 1:return e.context.LUMINANCE;case 2:return e.context.LUMINANCE_ALPHA;case 3:return e.context.RGB;case 4:default:return e.context.RGBA}},t.setBackgroundImage=function(u){e.bgImage.src=u.src},t.setUseBackgroundImage=function(u){e.useBackgroundImage=u,e.useBackgroundImage&&!e.el.contains(e.bgImage)?e.el.appendChild(e.bgImage):!e.useBackgroundImage&&e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)};function o(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.imageFormat,v=document.createElement("canvas"),g=v.getContext("2d");v.width=e.canvas.width,v.height=e.canvas.height,g.drawImage(e.canvas,0,0);var p=e.canvas.getBoundingClientRect(),l=e.renderable,h=l.getRenderers();h.forEach(function(C){var S=C.getViewProps();S.forEach(function(d){if(d.getContainer)for(var O=d.getContainer(),w=O.getElementsByTagName("canvas"),M=0;M<w.length;M++){var x=w[M],D=x.getBoundingClientRect(),R=D.x-p.x,V=D.y-p.y;g.drawImage(x,R,V)}})});var y=v.toDataURL(u);v.remove(),t.invokeImageReady(y)}t.captureNextImage=function(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},g=v.resetCamera,p=g===void 0?!1:g,l=v.size,h=l===void 0?null:l,y=v.scale,C=y===void 0?1:y;if(e.deleted)return null;e.imageFormat=u;var S=e.notifyStartCaptureImage;return e.notifyStartCaptureImage=!0,e._screenshot={size:h||C!==1?h||e.size.map(function(d){return d*C}):null},new Promise(function(d,O){var w=t.onImageReady(function(M){if(e._screenshot.size===null)e.notifyStartCaptureImage=S,w.unsubscribe(),e._screenshot.placeHolder&&(e.size=e._screenshot.originalSize,t.modified(),e._screenshot.cameras&&e._screenshot.cameras.forEach(function(R){var V=R.restoreParamsFn,E=R.arg;return V(E)}),t.traverseAllPasses(),e.el.removeChild(e._screenshot.placeHolder),e._screenshot.placeHolder.remove(),e._screenshot=null),d(M);else{var x=document.createElement("img");if(x.style=GM,x.src=M,e._screenshot.placeHolder=e.el.appendChild(x),e.canvas.style.display="none",e._screenshot.originalSize=e.size,e.size=e._screenshot.size,e._screenshot.size=null,t.modified(),p){var D=p!==!0;e._screenshot.cameras=e.renderable.getRenderers().map(function(R){var V=R.getActiveCamera(),E=V.get("focalPoint","position","parallelScale");return{resetCameraArgs:D?{renderer:R}:void 0,resetCameraFn:D?p:R.resetCamera,restoreParamsFn:V.set,arg:JSON.parse(JSON.stringify(E))}}),e._screenshot.cameras.forEach(function(R){var V=R.resetCameraFn,E=R.resetCameraArgs;return V(E)})}t.traverseAllPasses()}})})};var s;t.getHardwareMaximumLineWidth=function(){if(s!=null)return s;var u=t.get3DContext(),v=u.getParameter(u.ALIASED_LINE_WIDTH_RANGE);return s=v[1],v[1]},t.getGLInformations=function(){for(var u=t.get3DContext(),v=u.getExtension("OES_texture_float"),g=u.getExtension("OES_texture_half_float"),p=u.getExtension("WEBGL_debug_renderer_info"),l=u.getExtension("WEBGL_draw_buffers"),h=u.getExtension("EXT_texture_filter_anisotropic")||u.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),y=[["Max Vertex Attributes","MAX_VERTEX_ATTRIBS",u.getParameter(u.MAX_VERTEX_ATTRIBS)],["Max Varying Vectors","MAX_VARYING_VECTORS",u.getParameter(u.MAX_VARYING_VECTORS)],["Max Vertex Uniform Vectors","MAX_VERTEX_UNIFORM_VECTORS",u.getParameter(u.MAX_VERTEX_UNIFORM_VECTORS)],["Max Fragment Uniform Vectors","MAX_FRAGMENT_UNIFORM_VECTORS",u.getParameter(u.MAX_FRAGMENT_UNIFORM_VECTORS)],["Max Fragment Texture Image Units","MAX_TEXTURE_IMAGE_UNITS",u.getParameter(u.MAX_TEXTURE_IMAGE_UNITS)],["Max Vertex Texture Image Units","MAX_VERTEX_TEXTURE_IMAGE_UNITS",u.getParameter(u.MAX_VERTEX_TEXTURE_IMAGE_UNITS)],["Max Combined Texture Image Units","MAX_COMBINED_TEXTURE_IMAGE_UNITS",u.getParameter(u.MAX_COMBINED_TEXTURE_IMAGE_UNITS)],["Max 2D Texture Size","MAX_TEXTURE_SIZE",u.getParameter(u.MAX_TEXTURE_SIZE)],["Max Cube Texture Size","MAX_CUBE_MAP_TEXTURE_SIZE",u.getParameter(u.MAX_CUBE_MAP_TEXTURE_SIZE)],["Max Texture Anisotropy","MAX_TEXTURE_MAX_ANISOTROPY_EXT",h&&u.getParameter(h.MAX_TEXTURE_MAX_ANISOTROPY_EXT)],["Point Size Range","ALIASED_POINT_SIZE_RANGE",u.getParameter(u.ALIASED_POINT_SIZE_RANGE).join(" - ")],["Line Width Range","ALIASED_LINE_WIDTH_RANGE",u.getParameter(u.ALIASED_LINE_WIDTH_RANGE).join(" - ")],["Max Viewport Dimensions","MAX_VIEWPORT_DIMS",u.getParameter(u.MAX_VIEWPORT_DIMS).join(" - ")],["Max Renderbuffer Size","MAX_RENDERBUFFER_SIZE",u.getParameter(u.MAX_RENDERBUFFER_SIZE)],["Framebuffer Red Bits","RED_BITS",u.getParameter(u.RED_BITS)],["Framebuffer Green Bits","GREEN_BITS",u.getParameter(u.GREEN_BITS)],["Framebuffer Blue Bits","BLUE_BITS",u.getParameter(u.BLUE_BITS)],["Framebuffer Alpha Bits","ALPHA_BITS",u.getParameter(u.ALPHA_BITS)],["Framebuffer Depth Bits","DEPTH_BITS",u.getParameter(u.DEPTH_BITS)],["Framebuffer Stencil Bits","STENCIL_BITS",u.getParameter(u.STENCIL_BITS)],["Framebuffer Subpixel Bits","SUBPIXEL_BITS",u.getParameter(u.SUBPIXEL_BITS)],["MSAA Samples","SAMPLES",u.getParameter(u.SAMPLES)],["MSAA Sample Buffers","SAMPLE_BUFFERS",u.getParameter(u.SAMPLE_BUFFERS)],["Supported Formats for UByte Render Targets     ","UNSIGNED_BYTE RENDER TARGET FORMATS",[v&&Pe(u,u.RGBA,u.UNSIGNED_BYTE)?"RGBA":"",v&&Pe(u,u.RGB,u.UNSIGNED_BYTE)?"RGB":"",v&&Pe(u,u.LUMINANCE,u.UNSIGNED_BYTE)?"LUMINANCE":"",v&&Pe(u,u.ALPHA,u.UNSIGNED_BYTE)?"ALPHA":"",v&&Pe(u,u.LUMINANCE_ALPHA,u.UNSIGNED_BYTE)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Half Float Render Targets","HALF FLOAT RENDER TARGET FORMATS",[g&&Pe(u,u.RGBA,g.HALF_FLOAT_OES)?"RGBA":"",g&&Pe(u,u.RGB,g.HALF_FLOAT_OES)?"RGB":"",g&&Pe(u,u.LUMINANCE,g.HALF_FLOAT_OES)?"LUMINANCE":"",g&&Pe(u,u.ALPHA,g.HALF_FLOAT_OES)?"ALPHA":"",g&&Pe(u,u.LUMINANCE_ALPHA,g.HALF_FLOAT_OES)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Full Float Render Targets","FLOAT RENDER TARGET FORMATS",[v&&Pe(u,u.RGBA,u.FLOAT)?"RGBA":"",v&&Pe(u,u.RGB,u.FLOAT)?"RGB":"",v&&Pe(u,u.LUMINANCE,u.FLOAT)?"LUMINANCE":"",v&&Pe(u,u.ALPHA,u.FLOAT)?"ALPHA":"",v&&Pe(u,u.LUMINANCE_ALPHA,u.FLOAT)?"LUMINANCE_ALPHA":""].join(" ")],["Max Multiple Render Targets Buffers","MAX_DRAW_BUFFERS_WEBGL",l?u.getParameter(l.MAX_DRAW_BUFFERS_WEBGL):0],["High Float Precision in Vertex Shader","HIGH_FLOAT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Vertex Shader","MEDIUM_FLOAT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Vertex Shader","LOW_FLOAT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Float Precision in Fragment Shader","HIGH_FLOAT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Fragment Shader","MEDIUM_FLOAT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Fragment Shader","LOW_FLOAT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Int Precision in Vertex Shader","HIGH_INT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Vertex Shader","MEDIUM_INT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Vertex Shader","LOW_INT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_INT).rangeMax,"</sup>)"].join("")],["High Int Precision in Fragment Shader","HIGH_INT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Fragment Shader","MEDIUM_INT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Fragment Shader","LOW_INT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_INT).rangeMax,"</sup>)"].join("")],["Supported Extensions","EXTENSIONS",u.getSupportedExtensions().join("<br/>					    ")],["WebGL Renderer","RENDERER",u.getParameter(u.RENDERER)],["WebGL Vendor","VENDOR",u.getParameter(u.VENDOR)],["WebGL Version","VERSION",u.getParameter(u.VERSION)],["Shading Language Version","SHADING_LANGUAGE_VERSION",u.getParameter(u.SHADING_LANGUAGE_VERSION)],["Unmasked Renderer","UNMASKED_RENDERER",p&&u.getParameter(p.UNMASKED_RENDERER_WEBGL)],["Unmasked Vendor","UNMASKED_VENDOR",p&&u.getParameter(p.UNMASKED_VENDOR_WEBGL)],["WebGL Version","WEBGL_VERSION",e.webgl2?2:1]],C={};y.length;){var S=y.pop(),d=ne(S,3),O=d[0],w=d[1],M=d[2];w&&(C[w]={label:O,value:M})}return C},t.traverseAllPasses=function(){if(e.renderPasses)for(var u=0;u<e.renderPasses.length;++u)e.renderPasses[u].traverse(t,null);e.notifyStartCaptureImage&&o()},t.disableCullFace=function(){e.cullFaceEnabled&&(e.context.disable(e.context.CULL_FACE),e.cullFaceEnabled=!1)},t.enableCullFace=function(){e.cullFaceEnabled||(e.context.enable(e.context.CULL_FACE),e.cullFaceEnabled=!0)},t.setViewStream=function(u){if(e.viewStream===u)return!1;if(e.subscription&&(e.subscription.unsubscribe(),e.subscription=null),e.viewStream=u,e.viewStream){var v=e.renderable.getRenderers()[0];v.getBackgroundByReference()[3]=0,t.setUseBackgroundImage(!0),e.subscription=e.viewStream.onImageReady(function(g){return t.setBackgroundImage(g.image)}),e.viewStream.setSize(e.size[0],e.size[1]),e.viewStream.invalidateCache(),e.viewStream.render(),t.modified()}return!0},t.createSelector=function(){var u=zo.newInstance();return u.setOpenGLRenderWindow(t),u};function f(){e.canvas.removeEventListener("webglcontextlost",bu),e.canvas.removeEventListener("webglcontextrestored",t.restoreContext)}t.delete=T.chain(f,t.delete,t.setViewStream,_M),t.setActiveFramebuffer=function(u){e.activeFramebuffer=u};var c=t.setSize;t.setSize=function(u,v){var g=c(u,v);return g&&t.invokeWindowResizeEvent({width:u,height:v}),g}}var WM={cullFaceEnabled:!1,shaderCache:null,initialized:!1,context:null,canvas:null,cursorVisibility:!0,cursor:"pointer",textureUnitManager:null,textureResourceIds:null,containerSize:null,renderPasses:[],notifyStartCaptureImage:!1,webgl2:!1,defaultToWebgl2:!0,activeFramebuffer:null,xrSession:null,xrReferenceSpace:null,xrSupported:!0,imageFormat:"image/png",useOffScreen:!1,useBackgroundImage:!1};function $M(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,WM,r),kM.extend(t,e,r),e.canvas=document.createElement("canvas"),e.canvas.style.width="100%",BM(),e.selector||(e.selector=zo.newInstance(),e.selector.setOpenGLRenderWindow(t)),e.bgImage=new Image,e.bgImage.style.position="absolute",e.bgImage.style.left="0",e.bgImage.style.top="0",e.bgImage.style.width="100%",e.bgImage.style.height="100%",e.bgImage.style.zIndex="-1",e._textureResourceIds=new Map,e.myFactory=Pl.newInstance(),e.myFactory.registerOverride("vtkRenderWindow",gp),e.shaderCache=wM.newInstance(),e.shaderCache.setOpenGLRenderWindow(t),e.renderPasses[0]=TM.newInstance(),T.event(t,e,"imageReady"),T.event(t,e,"haveVRDisplay"),T.get(t,e,["shaderCache","textureUnitManager","webgl2","vrDisplay","useBackgroundImage","xrSupported","activeFramebuffer"]),T.setGet(t,e,["initialized","context","canvas","renderPasses","notifyStartCaptureImage","defaultToWebgl2","cursor","useOffScreen"]),T.setGetArray(t,e,["size"],2),T.event(t,e,"windowResizeEvent"),jM(t,e)}var gp=T.newInstance($M,"vtkOpenGLRenderWindow");ep("WebGL",gp);var sa=T.vtkDebugMacro;function zM(t,e){e.classHierarchy.push("vtkCamera");var r=new Float64Array(3),n=new Float64Array([0,0,-1]),a=new Float64Array([0,1,0]),i=I(new Float64Array(16)),o=I(new Float64Array(16)),s=new Float64Array(3),f=new Float64Array(3),c=new Float64Array(3),u=I(new Float64Array(16)),v=I(new Float64Array(16)),g=new Float64Array(3),p=new Float64Array(3);function l(){e.viewPlaneNormal[0]=-e.directionOfProjection[0],e.viewPlaneNormal[1]=-e.directionOfProjection[1],e.viewPlaneNormal[2]=-e.directionOfProjection[2]}t.orthogonalizeViewUp=function(){var h=t.getViewMatrix();e.viewUp[0]=h[4],e.viewUp[1]=h[5],e.viewUp[2]=h[6],t.modified()},t.setPosition=function(h,y,C){h===e.position[0]&&y===e.position[1]&&C===e.position[2]||(e.position[0]=h,e.position[1]=y,e.position[2]=C,t.computeDistance(),t.modified())},t.setFocalPoint=function(h,y,C){h===e.focalPoint[0]&&y===e.focalPoint[1]&&C===e.focalPoint[2]||(e.focalPoint[0]=h,e.focalPoint[1]=y,e.focalPoint[2]=C,t.computeDistance(),t.modified())},t.setDistance=function(h){if(e.distance!==h){e.distance=h,e.distance<1e-20&&(e.distance=1e-20,sa("Distance is set to minimum."));var y=e.directionOfProjection;e.focalPoint[0]=e.position[0]+y[0]*e.distance,e.focalPoint[1]=e.position[1]+y[1]*e.distance,e.focalPoint[2]=e.position[2]+y[2]*e.distance,t.modified()}},t.computeDistance=function(){var h=e.focalPoint[0]-e.position[0],y=e.focalPoint[1]-e.position[1],C=e.focalPoint[2]-e.position[2];if(e.distance=Math.sqrt(h*h+y*y+C*C),e.distance<1e-20){e.distance=1e-20,sa("Distance is set to minimum.");var S=e.directionOfProjection;e.focalPoint[0]=e.position[0]+S[0]*e.distance,e.focalPoint[1]=e.position[1]+S[1]*e.distance,e.focalPoint[2]=e.position[2]+S[2]*e.distance}e.directionOfProjection[0]=h/e.distance,e.directionOfProjection[1]=y/e.distance,e.directionOfProjection[2]=C/e.distance,l()},t.dolly=function(h){if(!(h<=0)){var y=e.distance/h;t.setPosition(e.focalPoint[0]-y*e.directionOfProjection[0],e.focalPoint[1]-y*e.directionOfProjection[1],e.focalPoint[2]-y*e.directionOfProjection[2])}},t.roll=function(h){var y=e.position,C=e.focalPoint,S=e.viewUp,d=new Float64Array([S[0],S[1],S[2],0]);I(u);var O=new Float64Array([C[0]-y[0],C[1]-y[1],C[2]-y[2]]);We(u,u,de(h),O),jn(d,d,u),e.viewUp[0]=d[0],e.viewUp[1]=d[1],e.viewUp[2]=d[2],t.modified()},t.azimuth=function(h){var y=e.focalPoint;I(v),we(v,v,y),We(v,v,de(h),e.viewUp),we(v,v,[-y[0],-y[1],-y[2]]),Q(g,e.position,v),t.setPosition(g[0],g[1],g[2])},t.yaw=function(h){var y=e.position;I(v),we(v,v,y),We(v,v,de(h),e.viewUp),we(v,v,[-y[0],-y[1],-y[2]]),Q(p,e.focalPoint,v),t.setFocalPoint(p[0],p[1],p[2])},t.elevation=function(h){var y=e.focalPoint,C=t.getViewMatrix(),S=[-C[0],-C[1],-C[2]];I(v),we(v,v,y),We(v,v,de(h),S),we(v,v,[-y[0],-y[1],-y[2]]),Q(g,e.position,v),t.setPosition(g[0],g[1],g[2])},t.pitch=function(h){var y=e.position,C=t.getViewMatrix(),S=[C[0],C[1],C[2]];I(v),we(v,v,y),We(v,v,de(h),S),we(v,v,[-y[0],-y[1],-y[2]]),Q(p,e.focalPoint,v),t.setFocalPoint.apply(t,W(p))},t.zoom=function(h){h<=0||(e.parallelProjection?e.parallelScale/=h:e.viewAngle/=h,t.modified())},t.translate=function(h,y,C){var S=[h,y,C];wn(e.position,S,e.position),wn(e.focalPoint,S,e.focalPoint),t.computeDistance(),t.modified()},t.applyTransform=function(h){var y=[].concat(W(e.viewUp),[1]),C=[],S=[],d=[];y[0]+=e.position[0],y[1]+=e.position[1],y[2]+=e.position[2],jn(C,[].concat(W(e.position),[1]),h),jn(S,[].concat(W(e.focalPoint),[1]),h),jn(d,y,h),d[0]-=C[0],d[1]-=C[1],d[2]-=C[2],t.setPosition.apply(t,W(C.slice(0,3))),t.setFocalPoint.apply(t,W(S.slice(0,3))),t.setViewUp.apply(t,W(d.slice(0,3)))},t.getThickness=function(){return e.clippingRange[1]-e.clippingRange[0]},t.setThickness=function(h){var y=h;y<1e-20&&(y=1e-20,sa("Thickness is set to minimum.")),t.setClippingRange(e.clippingRange[0],e.clippingRange[0]+y)},t.setThicknessFromFocalPoint=function(h){var y=h;y<1e-20&&(y=1e-20,sa("Thickness is set to minimum.")),t.setClippingRange(e.distance-y/2,e.distance+y/2)},t.setRoll=function(h){},t.getRoll=function(){},t.setObliqueAngles=function(h,y){},t.getOrientation=function(){},t.getOrientationWXYZ=function(){},t.getFrustumPlanes=function(h){},t.getCameraLightTransformMatrix=function(h){return Ae(h,e.cameraLightTransform),h},t.computeCameraLightTransform=function(){Ae(i,t.getViewMatrix()),at(i,i),el(o,[e.distance,e.distance,e.distance]),Ee(i,i,o),I(e.cameraLightTransform),we(e.cameraLightTransform,i,[0,0,-1])},t.deepCopy=function(h){},t.physicalOrientationToWorldDirection=function(h){var y=as(h[0],h[1],h[2],h[3]),C=Hn(),S=as(0,0,1,0);return tl(C,y),is(S,y,S),is(S,S,C),[S[0],S[1],S[2]]},t.getPhysicalToWorldMatrix=function(h){t.getWorldToPhysicalMatrix(h),at(h,h)},t.getWorldToPhysicalMatrix=function(h){I(h);var y=[3];me(e.physicalViewNorth,e.physicalViewUp,y),h[0]=y[0],h[1]=y[1],h[2]=y[2],h[4]=e.physicalViewUp[0],h[5]=e.physicalViewUp[1],h[6]=e.physicalViewUp[2],h[8]=-e.physicalViewNorth[0],h[9]=-e.physicalViewNorth[1],h[10]=-e.physicalViewNorth[2],he(h,h),Te(s,1/e.physicalScale,1/e.physicalScale,1/e.physicalScale),Kn(h,h,s),we(h,h,e.physicalTranslation)},t.computeViewParametersFromViewMatrix=function(h){at(i,h),Q(s,r,i),t.computeDistance();var y=e.distance;t.setPosition(s[0],s[1],s[2]),Q(f,n,i),os(f,f,s),It(f,f),t.setDirectionOfProjection(f[0],f[1],f[2]),Q(c,a,i),os(c,c,s),It(c,c),t.setViewUp(c[0],c[1],c[2]),t.setDistance(y)},t.computeViewParametersFromPhysicalMatrix=function(h){t.getWorldToPhysicalMatrix(i),Ee(i,h,i),t.computeViewParametersFromViewMatrix(i)},t.setViewMatrix=function(h){e.viewMatrix=h,e.viewMatrix&&(Ae(i,e.viewMatrix),t.computeViewParametersFromViewMatrix(i),he(e.viewMatrix,e.viewMatrix))},t.getViewMatrix=function(){if(e.viewMatrix)return e.viewMatrix;nl(i,e.position,e.focalPoint,e.viewUp),he(i,i);var h=new Float64Array(16);return Ae(h,i),h},t.setProjectionMatrix=function(h){e.projectionMatrix=h},t.getProjectionMatrix=function(h,y,C){var S=new Float64Array(16);if(I(S),e.projectionMatrix){var d=1/e.physicalScale;return Te(s,d,d,d),Ae(S,e.projectionMatrix),Kn(S,S,s),he(S,S),S}I(i);var O=e.clippingRange[1]-e.clippingRange[0],w=[e.clippingRange[0]+(y+1)*O/2,e.clippingRange[0]+(C+1)*O/2];if(e.parallelProjection){var M=e.parallelScale*h,x=e.parallelScale,D=(e.windowCenter[0]-1)*M,R=(e.windowCenter[0]+1)*M,V=(e.windowCenter[1]-1)*x,E=(e.windowCenter[1]+1)*x;rl(i,D,R,V,E,w[0],w[1]),he(i,i)}else{if(e.useOffAxisProjection)throw new Error("Off-Axis projection is not supported at this time");var L=Math.tan(de(e.viewAngle)/2),m,N;e.useHorizontalViewAngle===!0?(m=e.clippingRange[0]*L,N=e.clippingRange[0]*L/h):(m=e.clippingRange[0]*L*h,N=e.clippingRange[0]*L);var _=(e.windowCenter[0]-1)*m,G=(e.windowCenter[0]+1)*m,k=(e.windowCenter[1]-1)*N,U=(e.windowCenter[1]+1)*N,B=w[0],j=w[1];i[0]=2*B/(G-_),i[5]=2*B/(U-k),i[2]=(_+G)/(G-_),i[6]=(k+U)/(U-k),i[10]=-(B+j)/(j-B),i[14]=-1,i[11]=-2*B*j/(j-B),i[15]=0}return Ae(S,i),S},t.getCompositeProjectionMatrix=function(h,y,C){var S=t.getViewMatrix(),d=t.getProjectionMatrix(h,y,C);return Ee(d,S,d),d},t.setDirectionOfProjection=function(h,y,C){if(!(e.directionOfProjection[0]===h&&e.directionOfProjection[1]===y&&e.directionOfProjection[2]===C)){e.directionOfProjection[0]=h,e.directionOfProjection[1]=y,e.directionOfProjection[2]=C;var S=e.directionOfProjection;e.focalPoint[0]=e.position[0]+S[0]*e.distance,e.focalPoint[1]=e.position[1]+S[1]*e.distance,e.focalPoint[2]=e.position[2]+S[2]*e.distance,l()}},t.setDeviceAngles=function(h,y,C,S){var d=[3];me(e.physicalViewNorth,e.physicalViewUp,d);var O=I(new Float64Array(16));We(O,O,de(h),e.physicalViewUp),We(O,O,de(y),d),We(O,O,de(C),e.physicalViewNorth),We(O,O,de(-S),e.physicalViewUp);var w=new Float64Array([-e.physicalViewUp[0],-e.physicalViewUp[1],-e.physicalViewUp[2]]),M=new Float64Array(e.physicalViewNorth);Q(w,w,O),Q(M,M,O),t.setDirectionOfProjection(w[0],w[1],w[2]),t.setViewUp(M[0],M[1],M[2]),t.modified()},t.setOrientationWXYZ=function(h,y,C,S){var d=I(new Float64Array(16));if(h!==0&&(y!==0||C!==0||S!==0)){var O=de(h),w=Hn();Nf(w,[y,C,S],O),Uf(d,w)}var M=new Float64Array(3);Q(M,[0,0,-1],d);var x=new Float64Array(3);Q(x,[0,1,0],d),t.setDirectionOfProjection.apply(t,W(M)),t.setViewUp.apply(t,W(x)),t.modified()},t.computeClippingRange=function(h){var y=null,C=null;y=e.viewPlaneNormal,C=e.position;for(var S=-y[0],d=-y[1],O=-y[2],w=-(S*C[0]+d*C[1]+O*C[2]),M=[S*h[0]+d*h[2]+O*h[4]+w,1e-18],x=0;x<2;x++)for(var D=0;D<2;D++)for(var R=0;R<2;R++){var V=S*h[R]+d*h[2+D]+O*h[4+x]+w;M[0]=V<M[0]?V:M[0],M[1]=V>M[1]?V:M[1]}return M}}var bM={position:[0,0,1],focalPoint:[0,0,0],viewUp:[0,1,0],directionOfProjection:[0,0,-1],parallelProjection:!1,useHorizontalViewAngle:!1,viewAngle:30,parallelScale:1,clippingRange:[.01,1000.01],windowCenter:[0,0],viewPlaneNormal:[0,0,1],useOffAxisProjection:!1,screenBottomLeft:[-.5,-.5,-.5],screenBottomRight:[.5,-.5,-.5],screenTopRight:[.5,.5,-.5],freezeFocalPoint:!1,projectionMatrix:null,viewMatrix:null,cameraLightTransform:Gf(),physicalTranslation:[0,0,0],physicalScale:1,physicalViewUp:[0,1,0],physicalViewNorth:[0,0,-1]};function vp(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,bM,r),T.obj(t,e),T.get(t,e,["distance"]),T.setGet(t,e,["parallelProjection","useHorizontalViewAngle","viewAngle","parallelScale","useOffAxisProjection","freezeFocalPoint","physicalScale"]),T.getArray(t,e,["directionOfProjection","viewPlaneNormal","position","focalPoint"]),T.setGetArray(t,e,["clippingRange","windowCenter"],2),T.setGetArray(t,e,["viewUp","screenBottomLeft","screenBottomRight","screenTopRight","physicalTranslation","physicalViewUp","physicalViewNorth"],3),zM(t,e)}var HM=T.newInstance(vp,"vtkCamera"),KM={newInstance:HM,extend:vp},PM=["HeadLight","CameraLight","SceneLight"];function XM(t,e){e.classHierarchy.push("vtkLight");var r=new Float64Array(3);t.getTransformedPosition=function(){return e.transformMatrix?Q(r,e.position,e.transformMatrix):Te(r,e.position[0],e.position[1],e.position[2]),r},t.getTransformedFocalPoint=function(){return e.transformMatrix?Q(r,e.focalPoint,e.transformMatrix):Te(r,e.focalPoint[0],e.focalPoint[1],e.focalPoint[2]),r},t.getDirection=function(){return e.directionMTime<e.mtime&&(ss(e.direction,e.focalPoint,e.position),Fe(e.direction),e.directionMTime=e.mtime),e.direction},t.setDirection=function(n){var a=new Float64Array(3);ss(a,e.position,n),e.focalPoint=a},t.setDirectionAngle=function(n,a){var i=de(n),o=de(a);t.setPosition(Math.cos(i)*Math.sin(o),Math.sin(i),Math.cos(i)*Math.cos(o)),t.setFocalPoint(0,0,0),t.setPositional(0)},t.setLightTypeToHeadLight=function(){t.setLightType("HeadLight")},t.setLightTypeToCameraLight=function(){t.setLightType("CameraLight")},t.setLightTypeToSceneLight=function(){t.setTransformMatrix(null),t.setLightType("SceneLight")},t.lightTypeIsHeadLight=function(){return e.lightType==="HeadLight"},t.lightTypeIsSceneLight=function(){return e.lightType==="SceneLight"},t.lightTypeIsCameraLight=function(){return e.lightType==="CameraLight"}}var YM={switch:!0,intensity:1,color:[1,1,1],position:[0,0,1],focalPoint:[0,0,0],positional:!1,exponent:1,coneAngle:30,coneFalloff:5,attenuationValues:[1,0,0],transformMatrix:null,lightType:"SceneLight",shadowAttenuation:1,direction:[0,0,0],directionMTime:0};function pp(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,YM,r),T.obj(t,e),T.setGet(t,e,["intensity","switch","positional","exponent","coneAngle","coneFalloff","transformMatrix","lightType","shadowAttenuation","attenuationValues"]),T.setGetArray(t,e,["color","position","focalPoint","attenuationValues"],3),XM(t,e)}var AM=T.newInstance(pp,"vtkLight"),ZM={newInstance:AM,extend:pp,LIGHT_TYPES:PM},Sa=T.vtkErrorMacro;function qM(t){return function(){return Sa("vtkViewport::".concat(t," - NOT IMPLEMENTED"))}}function JM(t,e){e.classHierarchy.push("vtkViewport"),t.getViewProps=function(){return e.props},t.hasViewProp=function(n){return e.props.includes(n)},t.addViewProp=function(n){n&&!t.hasViewProp(n)&&e.props.push(n)},t.removeViewProp=function(n){var a=e.props.filter(function(i){return i!==n});e.props.length!==a.length&&(e.props=a)},t.removeAllViewProps=function(){e.props=[]};function r(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];a.push(n);var i=n.getNestedProps();if(i&&i.length)for(var o=0;o<i.length;o++)r(i[o],a);return a}t.getViewPropsWithNestedProps=function(){for(var n=[],a=0;a<e.props.length;a++)r(e.props[a],n);return n},t.addActor2D=t.addViewProp,t.removeActor2D=function(n){t.removeViewProp(n)},t.getActors2D=function(){return e.actors2D=[],e.props.forEach(function(n){e.actors2D=e.actors2D.concat(n.getActors2D())}),e.actors2D},t.displayToView=function(){return Sa("call displayToView on your view instead")},t.viewToDisplay=function(){return Sa("callviewtodisplay on your view instead")},t.getSize=function(){return Sa("call getSize on your View instead")},t.normalizedDisplayToProjection=function(n,a,i){var o=t.normalizedDisplayToNormalizedViewport(n,a,i);return t.normalizedViewportToProjection(o[0],o[1],o[2])},t.normalizedDisplayToNormalizedViewport=function(n,a,i){var o=[e.viewport[2]-e.viewport[0],e.viewport[3]-e.viewport[1]];return[(n-e.viewport[0])/o[0],(a-e.viewport[1])/o[1],i]},t.normalizedViewportToProjection=function(n,a,i){return[n*2-1,a*2-1,i*2-1]},t.projectionToNormalizedDisplay=function(n,a,i){var o=t.projectionToNormalizedViewport(n,a,i);return t.normalizedViewportToNormalizedDisplay(o[0],o[1],o[2])},t.normalizedViewportToNormalizedDisplay=function(n,a,i){var o=[e.viewport[2]-e.viewport[0],e.viewport[3]-e.viewport[1]];return[n*o[0]+e.viewport[0],a*o[1]+e.viewport[1],i]},t.projectionToNormalizedViewport=function(n,a,i){return[(n+1)*.5,(a+1)*.5,(i+1)*.5]},t.PickPropFrom=qM("PickPropFrom")}var QM={background:[0,0,0],background2:[.2,.2,.2],gradientBackground:!1,viewport:[0,0,1,1],aspect:[1,1],pixelAspect:[1,1],props:[],actors2D:[]};function lp(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,QM,r),T.obj(t,e),T.event(t,e,"event"),T.setGetArray(t,e,["viewport"],4),T.setGetArray(t,e,["background","background2"],3),JM(t,e)}var IM=T.newInstance(lp,"vtkViewport"),e2={newInstance:IM,extend:lp},sr=dn,Yt=ae,t2=qn;function Hu(t){return function(){return Yt("vtkRenderer::".concat(t," - NOT IMPLEMENTED"))}}function n2(t,e){e.classHierarchy.push("vtkRenderer");var r={type:"ComputeVisiblePropBoundsEvent",renderer:t},n={type:"ResetCameraClippingRangeEvent",renderer:t},a={type:"ResetCameraEvent",renderer:t};t.updateCamera=function(){return e.activeCamera||(sr("No cameras are on, creating one."),t.getActiveCameraAndResetIfCreated()),e.activeCamera.render(t),!0},t.updateLightsGeometryToFollowCamera=function(){var i=t.getActiveCameraAndResetIfCreated();e.lights.forEach(function(o){o.lightTypeIsSceneLight()||(o.lightTypeIsHeadLight()?(o.setPositionFrom(i.getPositionByReference()),o.setFocalPointFrom(i.getFocalPointByReference()),o.modified(i.getMTime())):o.lightTypeIsCameraLight()?o.setTransformMatrix(i.getCameraLightTransformMatrix(Gf())):Yt("light has unknown light type",o.get()))})},t.updateLightGeometry=function(){return e.lightFollowCamera?t.updateLightsGeometryToFollowCamera():!0},t.allocateTime=Hu("allocateTime"),t.updateGeometry=Hu("updateGeometry"),t.getVTKWindow=function(){return e._renderWindow},t.setLayer=function(i){sr(t.getClassName(),t,"setting Layer to ",i),e.layer!==i&&(e.layer=i,t.modified()),t.setPreserveColorBuffer(!!i)},t.setActiveCamera=function(i){return e.activeCamera===i?!1:(e.activeCamera=i,t.modified(),t.invokeEvent({type:"ActiveCameraEvent",camera:i}),!0)},t.makeCamera=function(){var i=KM.newInstance();return t.invokeEvent({type:"CreateCameraEvent",camera:i}),i},t.getActiveCamera=function(){return e.activeCamera||(e.activeCamera=t.makeCamera()),e.activeCamera},t.getActiveCameraAndResetIfCreated=function(){return e.activeCamera||(t.getActiveCamera(),t.resetCamera()),e.activeCamera},t.getActors=function(){return e.actors=[],e.props.forEach(function(i){e.actors=e.actors.concat(i.getActors())}),e.actors},t.addActor=t.addViewProp,t.removeActor=function(i){e.actors=e.actors.filter(function(o){return o!==i}),t.removeViewProp(i),t.modified()},t.removeAllActors=function(){var i=t.getActors();i.forEach(function(o){t.removeViewProp(o)}),e.actors=[],t.modified()},t.getVolumes=function(){return e.volumes=[],e.props.forEach(function(i){e.volumes=e.volumes.concat(i.getVolumes())}),e.volumes},t.addVolume=t.addViewProp,t.removeVolume=function(i){e.volumes=e.volumes.filter(function(o){return o!==i}),t.removeViewProp(i),t.modified()},t.removeAllVolumes=function(){var i=t.getVolumes();i.forEach(function(o){t.removeViewProp(o)}),e.volumes=[],t.modified()},t.hasLight=function(i){return e.lights.includes(i)},t.addLight=function(i){i&&!t.hasLight(i)&&(e.lights.push(i),t.modified())},t.removeLight=function(i){e.lights=e.lights.filter(function(o){return o!==i}),t.modified()},t.removeAllLights=function(){e.lights=[],t.modified()},t.setLightCollection=function(i){e.lights=i,t.modified()},t.makeLight=ZM.newInstance,t.createLight=function(){e.automaticLightCreation&&(e._createdLight&&(t.removeLight(e._createdLight),e._createdLight.delete(),e._createdLight=null),e._createdLight=t.makeLight(),t.addLight(e._createdLight),e._createdLight.setLightTypeToHeadLight(),e._createdLight.setPosition(t.getActiveCamera().getPosition()),e._createdLight.setFocalPoint(t.getActiveCamera().getFocalPoint()))},t.normalizedDisplayToWorld=function(i,o,s,f){var c=t.normalizedDisplayToProjection(i,o,s);return c=t.projectionToView(c[0],c[1],c[2],f),t.viewToWorld(c[0],c[1],c[2])},t.worldToNormalizedDisplay=function(i,o,s,f){var c=t.worldToView(i,o,s);return c=t.viewToProjection(c[0],c[1],c[2],f),t.projectionToNormalizedDisplay(c[0],c[1],c[2])},t.viewToWorld=function(i,o,s){if(e.activeCamera===null)return Yt("ViewToWorld: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];var f=e.activeCamera.getViewMatrix();at(f,f),he(f,f);var c=new Float64Array([i,o,s]);return Q(c,c,f),c},t.projectionToView=function(i,o,s,f){if(e.activeCamera===null)return Yt("ProjectionToView: no active camera, cannot compute projection to view, returning 0,0,0"),[0,0,0];var c=e.activeCamera.getProjectionMatrix(f,-1,1);at(c,c),he(c,c);var u=new Float64Array([i,o,s]);return Q(u,u,c),u},t.worldToView=function(i,o,s){if(e.activeCamera===null)return Yt("WorldToView: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];var f=e.activeCamera.getViewMatrix();he(f,f);var c=new Float64Array([i,o,s]);return Q(c,c,f),c},t.viewToProjection=function(i,o,s,f){if(e.activeCamera===null)return Yt("ViewToProjection: no active camera, cannot compute view to projection, returning 0,0,0"),[0,0,0];var c=e.activeCamera.getProjectionMatrix(f,-1,1);he(c,c);var u=new Float64Array([i,o,s]);return Q(u,u,c),u},t.computeVisiblePropBounds=function(){e.allBounds[0]=J.INIT_BOUNDS[0],e.allBounds[1]=J.INIT_BOUNDS[1],e.allBounds[2]=J.INIT_BOUNDS[2],e.allBounds[3]=J.INIT_BOUNDS[3],e.allBounds[4]=J.INIT_BOUNDS[4],e.allBounds[5]=J.INIT_BOUNDS[5];var i=!0;t.invokeEvent(r);for(var o=0;o<e.props.length;++o){var s=e.props[o];if(s.getVisibility()&&s.getUseBounds()){var f=s.getBounds();f&&pa(f)&&(i=!1,f[0]<e.allBounds[0]&&(e.allBounds[0]=f[0]),f[1]>e.allBounds[1]&&(e.allBounds[1]=f[1]),f[2]<e.allBounds[2]&&(e.allBounds[2]=f[2]),f[3]>e.allBounds[3]&&(e.allBounds[3]=f[3]),f[4]<e.allBounds[4]&&(e.allBounds[4]=f[4]),f[5]>e.allBounds[5]&&(e.allBounds[5]=f[5]))}}return i&&(Dn(e.allBounds),sr("Can't compute bounds, no 3D props are visible")),e.allBounds},t.resetCamera=function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,o=i||t.computeVisiblePropBounds(),s=[0,0,0];if(!pa(o))return sr("Cannot reset camera!"),!1;var f=null;if(t.getActiveCamera())f=e.activeCamera.getViewPlaneNormal();else return Yt("Trying to reset non-existent camera"),!1;e.activeCamera.setViewAngle(30),s[0]=(o[0]+o[1])/2,s[1]=(o[2]+o[3])/2,s[2]=(o[4]+o[5])/2;var c=o[1]-o[0],u=o[3]-o[2],v=o[5]-o[4];c*=c,u*=u,v*=v;var g=c+u+v;g=g===0?1:g,g=Math.sqrt(g)*.5;var p=de(e.activeCamera.getViewAngle()),l=g,h=g/Math.sin(p*.5),y=e.activeCamera.getViewUp();return Math.abs(A(y,f))>.999&&(t2("Resetting view-up since view plane normal is parallel"),e.activeCamera.setViewUp(-y[2],y[0],y[1])),e.activeCamera.setFocalPoint(s[0],s[1],s[2]),e.activeCamera.setPosition(s[0]+h*f[0],s[1]+h*f[1],s[2]+h*f[2]),t.resetCameraClippingRange(o),e.activeCamera.setParallelScale(l),e.activeCamera.setPhysicalScale(g),e.activeCamera.setPhysicalTranslation(-s[0],-s[1],-s[2]),t.invokeEvent(a),!0},t.resetCameraClippingRange=function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,o=i||t.computeVisiblePropBounds();if(!pa(o))return sr("Cannot reset camera clipping range!"),!1;if(t.getActiveCameraAndResetIfCreated(),!e.activeCamera)return Yt("Trying to reset clipping range of non-existent camera"),!1;var s=e.activeCamera.computeClippingRange(o),f=0;if(e.activeCamera.getParallelProjection())f=.2*e.activeCamera.getParallelScale();else{var c=de(e.activeCamera.getViewAngle());f=.2*Math.tan(c/2)*s[1]}return s[1]-s[0]<f&&(f=f-s[1]+s[0],s[1]+=f/2,s[0]-=f/2),s[0]<0&&(s[0]=0),s[0]=.99*s[0]-(s[1]-s[0])*e.clippingRangeExpansion,s[1]=1.01*s[1]+(s[1]-s[0])*e.clippingRangeExpansion,s[0]=s[0]>=s[1]?.01*s[1]:s[0],e.nearClippingPlaneTolerance||(e.nearClippingPlaneTolerance=.01),s[0]<e.nearClippingPlaneTolerance*s[1]&&(s[0]=e.nearClippingPlaneTolerance*s[1]),e.activeCamera.setClippingRange(s[0],s[1]),t.invokeEvent(n),!1},t.setRenderWindow=function(i){i!==e._renderWindow&&(e._vtkWindow=i,e._renderWindow=i)},t.visibleActorCount=function(){return e.props.filter(function(i){return i.getVisibility()}).length},t.visibleVolumeCount=t.visibleActorCount,t.getMTime=function(){var i=e.mtime,o=e.activeCamera?e.activeCamera.getMTime():0;o>i&&(i=o);var s=e._createdLight?e._createdLight.getMTime():0;return s>i&&(i=s),i},t.getTransparent=function(){return!!e.preserveColorBuffer},t.isActiveCameraCreated=function(){return!!e.activeCamera}}var r2={pickedProp:null,activeCamera:null,allBounds:[],ambient:[1,1,1],allocatedRenderTime:100,timeFactor:1,automaticLightCreation:!0,twoSidedLighting:!0,lastRenderTimeInSeconds:-1,renderWindow:null,lights:[],actors:[],volumes:[],lightFollowCamera:!0,numberOfPropsRendered:0,propArray:null,pathArray:null,layer:0,preserveColorBuffer:!1,preserveDepthBuffer:!1,computeVisiblePropBounds:xn(),interactive:!0,nearClippingPlaneTolerance:0,clippingRangeExpansion:.05,erase:!0,draw:!0,useShadows:!1,useDepthPeeling:!1,occlusionRatio:0,maximumNumberOfPeels:4,selector:null,delegate:null,texturedBackground:!1,backgroundTexture:null,environmentTexture:null,environmentTextureDiffuseStrength:1,environmentTextureSpecularStrength:1,useEnvironmentTextureAsBackground:!1,pass:0};function hp(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};for(Object.assign(e,r2,r),e2.extend(t,e,r),e.background||(e.background=[0,0,0,1]);e.background.length<3;)e.background.push(0);e.background.length===3&&e.background.push(1),ot(t,e,["_renderWindow","allocatedRenderTime","timeFactor","lastRenderTimeInSeconds","numberOfPropsRendered","lastRenderingUsedDepthPeeling","selector"]),ze(t,e,["twoSidedLighting","lightFollowCamera","automaticLightCreation","erase","draw","nearClippingPlaneTolerance","clippingRangeExpansion","backingStore","interactive","layer","preserveColorBuffer","preserveDepthBuffer","useDepthPeeling","occlusionRatio","maximumNumberOfPeels","delegate","backgroundTexture","texturedBackground","environmentTexture","environmentTextureDiffuseStrength","environmentTextureSpecularStrength","useEnvironmentTextureAsBackground","useShadows","pass"]),Pa(t,e,["actors","volumes","lights"]),bf(t,e,["background"],4,1),_r(t,e,["renderWindow"]),n2(t,e)}var a2=ke(hp,"vtkRenderer"),yp={newInstance:a2,extend:hp},i2={TOP_LEFT:"TOP_LEFT",TOP_RIGHT:"TOP_RIGHT",BOTTOM_LEFT:"BOTTOM_LEFT",BOTTOM_RIGHT:"BOTTOM_RIGHT"},qo={Corners:i2};function Ku(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function Tp(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Ku(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ku(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var Li=T.vtkErrorMacro,ua=qo.Corners;function o2(t,e){e.classHierarchy.push("vtkOrientationMarkerWidget");var r=Tp({},t),n=[],a=yp.newInstance(),i=new ResizeObserver(function(g){t.updateViewport()}),o=null,s=null,f=null,c=null,u=null;function v(){e._interactor.isAnimating()||t.updateMarkerOrientation()}e._onParentRendererChanged=function(){return t.updateViewport()},t.computeViewport=function(){var g=e.parentRenderer||e._interactor.getCurrentRenderer(),p=g.getViewport(),l=ne(p,4),h=l[0],y=l[1],C=l[2],S=l[3],d=e._interactor.getView(),O=d.getSize(),w=d.getViewportSize(g),M=ne(w,2),x=M[0],D=M[1],R=Math.min(x,D),V=e.viewportSize*R;V=Math.max(Math.min(e.minPixelSize,R),Math.min(e.maxPixelSize,V));var E=V/O[0],L=V/O[1];switch(e.viewportCorner){case ua.TOP_LEFT:return[h,S-L,h+E,S];case ua.TOP_RIGHT:return[C-E,S-L,C,S];case ua.BOTTOM_LEFT:return[h,y,h+E,y+L];case ua.BOTTOM_RIGHT:return[C-E,y,C,y+L];default:return Li("Invalid widget corner"),null}},t.updateViewport=function(){e.enabled&&(a.setViewport.apply(a,W(t.computeViewport())),e._interactor.render())},t.updateMarkerOrientation=function(){var g=e.parentRenderer||e._interactor.getCurrentRenderer(),p=g.getActiveCamera();if(p){var l=p.getReferenceByName("position"),h=p.getReferenceByName("focalPoint"),y=p.getReferenceByName("viewUp");if(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||n[3]!==h[0]||n[4]!==h[1]||n[5]!==h[2]||n[6]!==y[0]||n[7]!==y[1]||n[8]!==y[2]){n[0]=l[0],n[1]=l[1],n[2]=l[2],n[3]=h[0],n[4]=h[1],n[5]=h[2],n[6]=y[0],n[7]=y[1],n[8]=y[2];var C=a.getActiveCamera();C.setPosition(l[0],l[1],l[2]),C.setFocalPoint(h[0],h[1],h[2]),C.setViewUp(y[0],y[1],y[2]),a.resetCamera()}}},t.setEnabled=function(g){if(g){if(e.enabled)return;if(!e.actor){Li("Must set actor before enabling orientation marker.");return}if(!e._interactor){Li("Must set interactor before enabling orientation marker.");return}var p=e.parentRenderer||e._interactor.getCurrentRenderer(),l=p.getRenderWindow();l.addRenderer(a),l.getNumberOfLayers()<2&&l.setNumberOfLayers(2),a.setLayer(l.getNumberOfLayers()-1),a.setInteractive(!1),a.addViewProp(e.actor),e.actor.setVisibility(!0),o=p.onEvent(function(S){S.type==="ActiveCameraEvent"&&(s&&s.unsubscribe(),s=S.camera.onModified(v))}),s=p.getActiveCamera().onModified(v),f=e._interactor.onAnimation(t.updateMarkerOrientation),c=e._interactor.onEndAnimation(t.updateMarkerOrientation),i.observe(e._interactor.getView().getCanvas()),t.updateViewport(),t.updateMarkerOrientation(),e.enabled=!0}else{var h,y;if(!e.enabled)return;e.enabled=!1,i.disconnect(),o.unsubscribe(),o=null,s.unsubscribe(),s=null,f.unsubscribe(),f=null,c.unsubscribe(),c=null,e.actor.setVisibility(!1),a.removeViewProp(e.actor);var C=(h=e._interactor)===null||h===void 0||(y=h.findPokedRenderer())===null||y===void 0?void 0:y.getRenderWindow();C&&C.removeRenderer(a)}t.modified()},t.setViewportCorner=function(g){g!==e.viewportCorner&&(e.viewportCorner=g,t.updateViewport())},t.setViewportSize=function(g){var p=Math.min(1,Math.max(0,g));p!==e.viewportSize&&(e.viewportSize=p,t.updateViewport())},t.setActor=function(g){var p=e.enabled;t.setEnabled(!1),e.actor=g,t.setEnabled(p)},t.getRenderer=function(){return a},t.delete=function(){r.delete(),u&&(u.unsubscribe(),u=null),o&&(o.unsubscribe(),o=null),s&&(s.unsubscribe(),s=null),f&&(f.unsubscribe(),f=null),c&&(c.unsubscribe(),c=null),i.disconnect()},u=t.onModified(t.updateViewport)}var s2={viewportCorner:qo.Corners.BOTTOM_LEFT,viewportSize:.2,minPixelSize:50,maxPixelSize:200,parentRenderer:null};function Cp(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,s2,r),T.obj(t,e),T.get(t,e,["enabled","viewportCorner","viewportSize"]),T.setGet(t,e,["_interactor","minPixelSize","maxPixelSize","parentRenderer"]),T.get(t,e,["actor"]),T.moveToProtected(t,e,["interactor"]),o2(t,e)}var u2=T.newInstance(Cp,"vtkOrientationMarkerWidget"),Pu=Tp({newInstance:u2,extend:Cp},qo);function f2(t,e){e.classHierarchy.push("vtkCompositeCameraManipulator"),t.computeDisplayCenter=function(r,n){var a=r.computeWorldToDisplay(n,e.center[0],e.center[1],e.center[2]);e.displayCenter[0]=a[0],e.displayCenter[1]=a[1]}}var c2={center:[0,0,0],rotationFactor:1,displayCenter:[0,0]};function g2(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,c2,r),T.setGet(t,e,["rotationFactor"]),T.setGetArray(t,e,["displayCenter"],2),T.setGetArray(t,e,["center"],3),f2(t,e)}var pt={extend:g2};function v2(t,e){e.classHierarchy.push("vtkCompositeGestureManipulator"),t.startInteraction=function(){},t.endInteraction=function(){},t.onStartPinch=function(r,n){},t.onStartRotate=function(r,n){},t.onStartPan=function(r,n){},t.onPinch=function(r,n,a){},t.onRotate=function(r,n,a){},t.onPan=function(r,n,a){},t.onEndPinch=function(r){},t.onEndRotate=function(r){},t.onEndPan=function(r){},t.isPinchEnabled=function(){return e.pinchEnabled},t.isPanEnabled=function(){return e.panEnabled},t.isRotateEnabled=function(){return e.rotateEnabled}}var p2={pinchEnabled:!0,panEnabled:!0,rotateEnabled:!0};function l2(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,p2,r),T.set(t,e,["pinchEnabled","panEnabled","rotateEnabled"]),T.setGet(t,e,["interactorStyle"]),v2(t,e)}var Sp={extend:l2};function h2(t,e){e.classHierarchy.push("vtkCompositeKeyboardManipulator"),t.onKeyPress=function(r,n,a){},t.onKeyDown=function(r,n,a){},t.onKeyUp=function(r,n,a){}}var y2={};function T2(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,y2,r),h2(t,e)}var dp={extend:T2};function C2(t,e){e.classHierarchy.push("vtkCompositeMouseManipulator"),t.startInteraction=function(){},t.endInteraction=function(){},t.onButtonDown=function(r,n,a){},t.onButtonUp=function(r){},t.onMouseMove=function(r,n,a){},t.onStartScroll=function(r,n,a){},t.onScroll=function(r,n,a){},t.onEndScroll=function(r){},t.isDragEnabled=function(){return e.dragEnabled},t.isScrollEnabled=function(){return e.scrollEnabled}}var S2={button:1,shift:!1,control:!1,alt:!1,dragEnabled:!0,scrollEnabled:!1};function d2(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,S2,r),T.setGet(t,e,["button","shift","control","alt"]),T.set(t,e,["dragEnabled","scrollEnabled"]),C2(t,e)}var st={extend:d2};function O2(t,e){e.classHierarchy.push("vtkCompositeVRManipulator"),t.onButton3D=function(r,n,a,i,o,s){},t.onMove3D=function(r,n,a,i,o,s){}}var w2={};function x2(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,w2,r),T.setGet(t,e,["device","input"]),O2(t,e)}var Op={extend:x2,Device:Po,Input:Xo};function M2(t,e){e.classHierarchy.push("vtkGestureCameraManipulator"),t.onStartPinch=function(r,n){e.previousScale=n},t.onStartRotate=function(r,n){e.previousRotation=n},t.onStartPan=function(r,n){e.previousTranslation=n},t.onPinch=function(r,n,a){Br.dollyByFactor(r,n,a/e.previousScale),e.previousScale=a},t.onPan=function(r,n,a){var i=n.getActiveCamera(),o=r.getInteractorStyle(),s=i.getFocalPoint();s=o.computeWorldToDisplay(n,s[0],s[1],s[2]);var f=s[2],c=a,u=e.previousTranslation,v=o.computeDisplayToWorld(n,s[0]+c[0]-u[0],s[1]+c[1]-u[1],f),g=o.computeDisplayToWorld(n,s[0],s[1],f),p=[];p[0]=g[0]-v[0],p[1]=g[1]-v[1],p[2]=g[2]-v[2],s=i.getFocalPoint();var l=i.getPosition();i.setFocalPoint(p[0]+s[0],p[1]+s[1],p[2]+s[2]),i.setPosition(p[0]+l[0],p[1]+l[1],p[2]+l[2]),r.getLightFollowCamera()&&n.updateLightsGeometryToFollowCamera(),i.orthogonalizeViewUp(),e.previousTranslation=a},t.onRotate=function(r,n,a){var i=n.getActiveCamera();i.roll(a-e.previousRotation),i.orthogonalizeViewUp(),e.previousRotation=a}}var D2={};function wp(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,D2,r),T.obj(t,e),Sp.extend(t,e,r),pt.extend(t,e,r),M2(t,e)}var E2=T.newInstance(wp,"vtkGestureCameraManipulator"),R2={newInstance:E2,extend:wp},V2=T.vtkErrorMacro,Xu="vtkKeyboardCameraManipulator";function L2(t,e){e.classHierarchy.push("vtkKeyboardCameraManipulator");var r={keysDown:[],direction:[0,0,0],skipUpdateDirection:!1,animationSub:null,cameraModifiedSub:null};t.inMotion=function(){return r.animationSub!==null},t.resetMovementSpeed=function(){var n=e.renderer,a=n.computeVisiblePropBounds(),i=500;e.movementSpeed=J.getMaxLength(a)/i},t.startMovement=function(){if(t.inMotion()){V2("Camera is already in motion!");return}e.movementSpeed===null&&t.resetMovementSpeed();var n=e.interactor,a=e.renderer,i=function(){r.keysDown.length!==0&&(r.skipUpdateDirection=!0,t.moveCamera(a.getActiveCamera(),r.direction,e.movementSpeed),a.resetCameraClippingRange(),n.getLightFollowCamera()&&a.updateLightsGeometryToFollowCamera(),r.skipUpdateDirection=!1)};t.calculateCurrentDirection();var o=a.getActiveCamera();r.cameraModifiedSub=o.onModified(t.calculateCurrentDirection),n.requestAnimation(Xu),r.animationSub=n.onAnimation(function(){return i()})},t.endMovement=function(){r.animationSub&&(r.animationSub.unsubscribe(),r.animationSub=null),e._interactor.cancelAnimation(Xu),r.cameraModifiedSub&&(r.cameraModifiedSub.unsubscribe(),r.cameraModifiedSub=null)},t.calculateCurrentDirection=function(){if(!r.skipUpdateDirection){r.direction=[0,0,0];var n=e.renderer;if(n){var a=n.getActiveCamera();if(a&&r.keysDown.length!==0){var i=r.keysDown.map(function(s){return t.getDirectionFromKey(s,a)});if(i=i.filter(function(s){return s}),i.length!==0){var o=i.reduce(function(s,f){return wn(s,f,f),f});Fe(o),r.direction=o}}}}},t.getDirectionFromKey=function(n,a){var i;if(e.moveForwardKeys.includes(n))i=a.getDirectionOfProjection();else if(e.moveLeftKeys.includes(n)){var o=a.getDirectionOfProjection();i=[0,0,0],me(a.getViewUp(),o,i)}else if(e.moveBackwardKeys.includes(n))i=a.getDirectionOfProjection().map(function(f){return-f});else if(e.moveRightKeys.includes(n)){var s=a.getDirectionOfProjection();i=[0,0,0],me(s,a.getViewUp(),i)}else if(e.moveUpKeys.includes(n))i=a.getViewUp();else if(e.moveDownKeys.includes(n))i=a.getViewUp().map(function(f){return-f});else return;return Fe(i),i},t.moveCamera=function(n,a,i){var o=n.getPosition(),s=n.getFocalPoint();n.setFocalPoint(s[0]+a[0]*i,s[1]+a[1]*i,s[2]+a[2]*i),n.setPosition(o[0]+a[0]*i,o[1]+a[1]*i,o[2]+a[2]*i)},t.onKeyPress=function(n,a,i){},t.onKeyDown=function(n,a,i){r.keysDown.includes(i)||(r.keysDown.push(i),t.calculateCurrentDirection()),t.inMotion()||(Object.assign(e,{interactor:n,renderer:a}),t.startMovement())},t.onKeyUp=function(n,a,i){r.keysDown=r.keysDown.filter(function(o){return o.toUpperCase()!==i.toUpperCase()}),t.calculateCurrentDirection(),r.keysDown.length===0&&t.endMovement()}}var m2={movementSpeed:null,moveForwardKeys:["w","W","ArrowUp"],moveLeftKeys:["a","A","ArrowLeft"],moveBackwardKeys:["s","S","ArrowDown"],moveRightKeys:["d","D","ArrowRight"],moveUpKeys:[" "],moveDownKeys:["Shift"],interactor:null,renderer:null};function xp(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,m2,r),T.obj(t,e),dp.extend(t,e,r),T.setGet(t,e,["movementSpeed","moveForwardKeys","moveLeftKeys","moveBackwardKeys","moveRightKeys","moveUpKeys","moveDownKeys","interactor","renderer"]),L2(t,e)}var k2=T.newInstance(xp,"vtkKeyboardCameraManipulator"),F2={newInstance:k2,extend:xp};function Yu(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function fa(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Yu(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Yu(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var N2=[-2,-1,-2,-1],U2={position:"absolute",zIndex:1,border:"2px solid #F44336",backgroundColor:"rgba(0, 0, 0, 0.1)",borderRadius:"4px",boxSizing:"border-box"};function G2(t,e){Object.keys(e).forEach(function(r){t.style[r]=e[r]})}function B2(t,e){e.classHierarchy.push("vtkMouseBoxSelectionManipulator");var r=null,n=null,a=null,i=null,o=null,s=!1;function f(){return!a||!i?N2:[Math.min(a.x,i.x),Math.max(a.x,i.x),Math.min(a.y,i.y),Math.max(a.y,i.y)]}function c(){if(!(!r||!n)){var u=r.getSize(),v=ne(u,2),g=v[0],p=v[1],l=n.getBoundingClientRect(),h=l.width,y=l.height,C=f(),S=ne(C,4),d=S[0],O=S[1],w=S[2],M=S[3];o.style.left="".concat(h*d/g,"px"),o.style.top="".concat(y-y*M/p,"px"),o.style.width="".concat(h*(O-d)/g,"px"),o.style.height="".concat(y*(M-w)/p,"px")}}t.onButtonDown=function(u,v,g){if(a=g,e.renderSelection){var p;r||(r=u.getView()),!n&&(p=r)!==null&&p!==void 0&&p.getContainer&&(n=r.getContainer()),n||(n=e.container),o||(o=document.createElement("div"),G2(o,e.selectionStyle)),c(),n&&!s&&(s=!0,n.appendChild(o))}},t.onMouseMove=function(u,v,g){a&&g&&(i=g,t.invokeBoxSelectInput({view:r,container:n,selection:f()}),e.renderSelection&&c())},t.onButtonUp=function(u,v){!a||!i&&!e.boxChangeOnClick||(i||(i=a),t.invokeBoxSelectChange({view:r,container:n,selection:f()}),s&&(o.parentElement.removeChild(o),s=!1),r=null,n=null,a=null,i=null)}}function _2(t){return fa(fa({boxChangeOnClick:!1,renderSelection:!0},t),{},{selectionStyle:fa(fa({},U2),t.selectionStyle)})}function Mp(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,_2(r)),_e(t,e),st.extend(t,e,r),xa(t,e,"BoxSelectChange"),xa(t,e,"BoxSelectInput"),ze(t,e,["renderSelection","boxChangeOnClick","selectionStyle","container"]),B2(t,e)}var j2=ke(Mp,"vtkMouseBoxSelectionManipulator"),W2={newInstance:j2,extend:Mp};function $2(t,e){e.classHierarchy.push("vtkMouseCameraAxisRotateManipulator");var r=new Float64Array(3),n=new Float64Array(3),a=new Float64Array(3),i=new Float64Array(3),o=new Float64Array(16),s=new Float64Array(16),f=new Float64Array(3),c=new Float64Array(3),u=new Float64Array(3);t.onButtonDown=function(v,g,p){e.previousPosition=p},t.onMouseMove=function(v,g,p){if(p){var l=g.getActiveCamera(),h=l.getPosition(),y=l.getFocalPoint(),C=l.getViewUp(),S=l.getDirectionOfProjection();ii(r,S),I(o),I(s);var d=e.center,O=e.rotationFactor,w=e.rotationAxis;ii(u,w);var M=e.previousPosition.x-p.x,x=e.previousPosition.y-p.y,D=v.getView().getViewportSize(g),R=de(360*M/D[0]*O);We(s,s,R,w),me(S,C,f);var V=de(-360*x/D[1]*O),E=Math.acos(kr(r,w)),L=Math.acos(kr(r,u)),m=E<=L,N=Math.min(E,L);e.useHalfAxis&&!m?V=Math.PI/2-E:m&&N+V<0?V=-N:!m&&E+V>Math.PI&&(V=N),We(s,s,V,f),we(o,o,d),Ee(o,o,s),ii(c,d),we(o,o,c),Q(n,h,o),Q(a,y,o),Q(i,C,s),l.setPosition(n[0],n[1],n[2]),l.setFocalPoint(a[0],a[1],a[2]),l.setViewUp(i),g.resetCameraClippingRange(),v.getLightFollowCamera()&&g.updateLightsGeometryToFollowCamera(),e.previousPosition=p}}}var z2={rotationAxis:[0,0,1],useHalfAxis:!0};function Dp(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,z2,r),T.obj(t,e),T.setGet(t,e,["rotationAxis","useHalfAxis"]),st.extend(t,e,r),pt.extend(t,e,r),$2(t,e)}var b2=T.newInstance(Dp,"vtkMouseCameraAxisRotateManipulator"),H2={newInstance:b2,extend:Dp};function K2(t,e){e.classHierarchy.push("vtkMouseCameraSliceManipulator"),t.onButtonDown=function(r,n,a){e.previousPosition=a},t.onMouseMove=function(r,n,a){if(a){var i=a.y-e.previousPosition.y,o=n.getActiveCamera(),s=o.getClippingRange(),f=o.getDistance(),c=0;if(o.getParallelProjection())c=2*o.getParallelScale();else{var u=de(o.getViewAngle());c=2*f*Math.tan(.5*u)}var v=r.getView().getViewportSize(n),g=i*c/v[1];f+=g,f<s[0]&&(f=s[0]+c*.001),f>s[1]&&(f=s[1]-c*.001),o.setDistance(f),e.previousPosition=a}},t.onScroll=function(r,n,a){if(a){var i=1-a;i*=25;var o=n.getActiveCamera(),s=o.getClippingRange(),f=o.getDistance();f+=i,f<s[0]&&(f=s[0]),f>s[1]&&(f=s[1]),o.setDistance(f)}}}var P2={};function Ep(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,P2,r),T.obj(t,e),pt.extend(t,e,r),st.extend(t,e,r),K2(t,e)}var X2=T.newInstance(Ep,"vtkMouseCameraSliceManipulator"),Y2={newInstance:X2,extend:Ep};function A2(t,e){e.classHierarchy.push("vtkAbstractPicker"),t.initialize=function(){e.renderer=null,e.selectionPoint[0]=0,e.selectionPoint[1]=0,e.selectionPoint[2]=0,e.pickPosition[0]=0,e.pickPosition[1]=0,e.pickPosition[2]=0},t.initializePickList=function(){e.pickList=[]},t.addPickList=function(r){e.pickList.push(r)},t.deletePickList=function(r){var n=e.pickList.indexOf(r);n!==-1&&e.pickList.splice(n,1)}}var Z2={renderer:null,selectionPoint:[0,0,0],pickPosition:[0,0,0],pickFromList:0,pickList:[]};function Rp(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Z2,r),T.obj(t,e),T.get(t,e,["renderer"]),T.getArray(t,e,["selectionPoint","pickPosition"]),T.setGet(t,e,["pickFromList","pickList"]),A2(t,e)}var q2=T.newInstance(Rp,"vtkAbstractPicker"),J2={newInstance:q2,extend:Rp};function Au(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function Q2(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Au(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Au(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var I2=T.vtkErrorMacro,Zu=T.vtkWarningMacro;function eD(t,e){e.classHierarchy.push("vtkPicker");var r=Q2({},t);function n(){r.initialize(),e.actors=[],e.pickedPositions=[],e.mapperPosition[0]=0,e.mapperPosition[1]=0,e.mapperPosition[2]=0,e.mapper=null,e.dataSet=null,e.globalTMin=Number.MAX_VALUE}t.intersectWithLine=function(a,i,o,s){if(!s)return Number.MAX_VALUE;for(var f=s.getCenter(),c=[],u=0;u<3;u++)c[u]=i[u]-a[u];var v=A(c,c);if(v===0)return 2;var g=(c[0]*(f[0]-a[0])+c[1]*(f[1]-a[1])+c[2]*(f[2]-a[2]))/v;return g},t.pick=function(a,i){a.length!==3&&Zu("vtkPicker::pick: selectionPt needs three components");var o=a[0],s=a[1],f=a[2],c=[],u=[],v=[],g=[],p=[],l=[],h=[],y,C,S=[],d=[],O=[],w=[],M,x,D=[],R=[],V=0,E=[],L=!1,m=new Float64Array(4),N=new Float64Array(4),_=J.newInstance(),G=[],k=[],U=i.getRenderWindow().getViews()[0];if(n(),e.renderer=i,e.selectionPoint[0]=o,e.selectionPoint[1]=s,e.selectionPoint[2]=f,!i){I2("Picker::Pick Must specify renderer");return}var B=i.getActiveCamera();c=B.getPosition(),u=B.getFocalPoint();var j=U.getViewportSize(i),H=j[0]/j[1];v=i.worldToNormalizedDisplay(u[0],u[1],u[2],H),v=U.normalizedDisplayToDisplay(v[0],v[1],v[2]),f=v[2];var X=U.displayToNormalizedDisplay(o,s,f);g=i.normalizedDisplayToWorld(X[0],X[1],X[2],H);for(var Y=0;Y<3;Y++)e.pickPosition[Y]=g[Y];for(var ee=0;ee<3;ee++)p[ee]=e.pickPosition[ee]-c[ee];for(var ce=0;ce<3;ce++)l[ce]=u[ce]-c[ce];Fe(l);var Z=A(l,p);if(Z===0){Zu("Picker::Pick Cannot process points");return}if(h=B.getClippingRange(),B.getParallelProjection()){y=h[0]-Z,C=h[1]-Z;for(var Ce=0;Ce<3;Ce++)S[Ce]=e.pickPosition[Ce]+y*l[Ce],d[Ce]=e.pickPosition[Ce]+C*l[Ce]}else{y=h[0]/Z,C=h[1]/Z;for(var q=0;q<3;q++)S[q]=c[q]+y*p[q],d[q]=c[q]+C*p[q]}S[3]=1,d[3]=1,O=i.getViewport(),i.getRenderWindow()&&(w=i.getRenderWindow().getViews()[0].getSize()),M=w[0]*O[0],x=w[1]*O[1];var De=U.displayToNormalizedDisplay(M,x,f);D=i.normalizedDisplayToWorld(De[0],De[1],De[2],H),M=w[0]*O[2],x=w[1]*O[3];var K=U.displayToNormalizedDisplay(M,x,f);R=i.normalizedDisplayToWorld(K[0],K[1],K[2],H);for(var fe=0;fe<3;fe++)V+=(R[fe]-D[fe])*(R[fe]-D[fe]);V=Math.sqrt(V)*e.tolerance,e.pickFromList?E=e.pickList:E=i.getActors();var te=[];E.forEach(function($){var z=$.getMapper();if(L=$.getNestedPickable()&&$.getNestedVisibility(),$.getProperty().getOpacity()<=0&&(L=!1),L){e.transformMatrix=$.getMatrix().slice(0),he(e.transformMatrix,e.transformMatrix),at(e.transformMatrix,e.transformMatrix);var re=[e.transformMatrix[0],e.transformMatrix[1],e.transformMatrix[2]],P=[e.transformMatrix[4],e.transformMatrix[5],e.transformMatrix[6]],Le=[e.transformMatrix[8],e.transformMatrix[9],e.transformMatrix[10]];te[0]=rt(re),te[1]=rt(P),te[2]=rt(Le),jn(m,S,e.transformMatrix),jn(N,d,e.transformMatrix),m[0]/=m[3],m[1]/=m[3],m[2]/=m[3],N[0]/=N[3],N[1]/=N[3],N[2]/=N[3];for(var pe=0;pe<3;pe++)p[pe]=N[pe]-m[pe];if(z?(_.setBounds(z.getBounds()),_.inflate(V)):_.reset(),_.intersectBox(m,p,k,G)&&(G[0]=t.intersectWithLine(m,N,V*.333*(te[0]+te[1]+te[2]),z),G[0]<Number.MAX_VALUE)){var Re=[];Re[0]=(1-G[0])*S[0]+G[0]*d[0],Re[1]=(1-G[0])*S[1]+G[0]*d[1],Re[2]=(1-G[0])*S[2]+G[0]*d[2];for(var ye=-1,le=0;le<e.actors.length;le++)if(e.actors[le]===$){ye=le;break}if(ye===-1)e.actors.push($),e.pickedPositions.push(Re);else{var Ke=e.pickedPositions[ye],lt=et(S,Ke),Rt=et(S,Re);Rt<lt&&(e.pickedPositions[ye]=Re)}}}return t.invokePickChange(e.pickedPositions),1})}}var tD={tolerance:.025,mapperPosition:[0,0,0],mapper:null,dataSet:null,actors:[],pickedPositions:[],transformMatrix:null,globalTMin:Number.MAX_VALUE};function Vp(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,tD,r),J2.extend(t,e,r),T.setGet(t,e,["tolerance"]),T.setGetArray(t,e,["mapperPosition"],3),T.get(t,e,["mapper","dataSet","actors","pickedPositions"]),T.event(t,e,"pickChange"),eD(t,e)}var nD=T.newInstance(Vp,"vtkPicker"),rD={newInstance:nD,extend:Vp},aD=T.vtkErrorMacro;function iD(t,e){e.classHierarchy.push("vtkPointPicker"),t.intersectWithLine=function(r,n,a,i){var o=Number.MAX_VALUE;if(i.isA("vtkImageMapper")||i.isA("vtkImageArrayMapper")){var s=i.intersectWithLineForPointPicking(r,n);s&&(o=s.t,e.pointIJK=s.ijk)}else i.isA("vtkMapper")&&(o=t.intersectActorWithLine(r,n,a,i));return o},t.intersectActorWithLine=function(r,n,a,i){var o=i.getInputData(),s=0,f=o.getPoints().getNumberOfPoints();if(f<=s)return 2;for(var c=[],u=0;u<3;u++)c[u]=n[u]-r[u];var v=A(c,c);if(v===0)return aD("Cannot process points"),2;var g,p=-1,l=Number.MAX_VALUE,h=Number.MAX_VALUE,y=[],C=[],S=o.getPoints();if(e.useCells)for(var d=o.getPolys().getData(),O=d[0],w=o.getPolys().getNumberOfCells(),M=0;M<w;M++)for(var x=M*O+1,D=x+O,R=x;R<D;R++){var V=d[R];if(S.getPoint(V,C),g=(c[0]*(C[0]-r[0])+c[1]*(C[1]-r[1])+c[2]*(C[2]-r[2]))/v,g>=0&&g<=1&&g<=l+e.tolerance){for(var E=0,L=0;L<3;L++){y[L]=r[L]+g*c[L];var m=Math.abs(C[L]-y[L]);m>E&&(E=m)}E<=a&&E<h&&(p=s,h=E,l=g)}}else for(s=0;s<f;s++)if(S.getPoint(s,C),g=(c[0]*(C[0]-r[0])+c[1]*(C[1]-r[1])+c[2]*(C[2]-r[2]))/v,g>=0&&g<=1&&g<=l+e.tolerance){for(var N=0,_=0;_<3;_++){y[_]=r[_]+g*c[_];var G=Math.abs(C[_]-y[_]);G>N&&(N=G)}N<=a&&N<h&&(p=s,h=N,l=g)}return e.pointId=p,l}}var oD={pointId:-1,pointIJK:[],useCells:!1};function Lp(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,oD,r),rD.extend(t,e,r),T.getArray(t,e,["pointIJK"]),T.get(t,e,["pointId"]),T.setGet(t,e,["useCells"]),iD(t,e)}var sD=T.newInstance(Lp,"vtkPointPicker"),uD={newInstance:sD,extend:Lp};function fD(t,e){e.classHierarchy.push("vtkSphereSource"),t.requestData=function(r,n){if(!e.deleted){var a=n[0],i=a?a.getPoints().getDataType():e.pointType;a=vt.newInstance();var o=0,s=e.thetaResolution,f=e.startTheta<e.endTheta?e.startTheta:e.endTheta;f*=Math.PI/180;var c=e.endTheta>e.startTheta?e.endTheta:e.startTheta;c*=Math.PI/180;var u=e.startPhi<e.endPhi?e.startPhi:e.endPhi;u*=Math.PI/180;var v=e.endPhi>e.startPhi?e.endPhi:e.startPhi;v*=Math.PI/180,Math.abs(f-c)<2*Math.PI&&++s;var g=(c-f)/e.thetaResolution,p=e.startPhi<=0?1:0,l=e.phiResolution+(e.endPhi>=180?-1:0),h=e.phiResolution*s+2,y=e.phiResolution*2*e.thetaResolution,C=0,S=T.newTypedArray(i,h*3),d=new Float32Array(h*3),O=0,w=new Uint32Array(y*5);e.startPhi<=0&&(S[C*3+0]=e.center[0],S[C*3+1]=e.center[1],S[C*3+2]=e.center[2]+e.radius,d[C*3+0]=0,d[C*3+1]=0,d[C*3+2]=1,C++,o++),e.endPhi>=180&&(S[C*3+0]=e.center[0],S[C*3+1]=e.center[1],S[C*3+2]=e.center[2]-e.radius,d[C*3+0]=0,d[C*3+1]=0,d[C*3+2]=-1,C++,o++);for(var M=e.phiResolution-o,x=(v-u)/(e.phiResolution-1),D=0;D<s;D++)for(var R=f+D*g,V=p;V<l;V++){var E=u+V*x,L=e.radius*Math.sin(E);d[C*3+0]=L*Math.cos(R),d[C*3+1]=L*Math.sin(R),d[C*3+2]=e.radius*Math.cos(E),S[C*3+0]=d[C*3+0]+e.center[0],S[C*3+1]=d[C*3+1]+e.center[1],S[C*3+2]=d[C*3+2]+e.center[2];var m=Math.sqrt(d[C*3+0]*d[C*3+0]+d[C*3+1]*d[C*3+1]+d[C*3+2]*d[C*3+2]);m=m===0?1:m,d[C*3+0]/=m,d[C*3+1]/=m,d[C*3+2]/=m,C++}var N=M*s;if(Math.abs(f-c)<2*Math.PI&&--s,e.startPhi<=0)for(var _=0;_<s;_++)w[O++]=3,w[O++]=M*_+o,w[O++]=M*(_+1)%N+o,w[O++]=0;if(e.endPhi>=180)for(var G=M-1+o,k=0;k<s;k++)w[O++]=3,w[O++]=M*k+G,w[O++]=o-1,w[O++]=M*(k+1)%N+G;for(var U=0;U<s;U++)for(var B=0;B<M-1;B++){var j=M*U+B+o,H=j+1,X=(M*(U+1)+B)%N+o+1;e.latLongTessellation?(w[O++]=4,w[O++]=j,w[O++]=H,w[O++]=X,w[O++]=X-1):(w[O++]=3,w[O++]=j,w[O++]=H,w[O++]=X,w[O++]=3,w[O++]=j,w[O++]=X,w[O++]=X-1)}S=S.subarray(0,C*3),a.getPoints().setData(S,3),d=d.subarray(0,C*3);var Y=ie.newInstance({name:"Normals",values:d,numberOfComponents:3});a.getPointData().setNormals(Y),w=w.subarray(0,O),a.getPolys().setData(w,1),n[0]=a}}}var cD={radius:.5,latLongTessellation:!1,thetaResolution:8,startTheta:0,endTheta:360,phiResolution:8,startPhi:0,endPhi:180,center:[0,0,0],pointType:"Float64Array"};function mp(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,cD,r),T.obj(t,e),T.setGet(t,e,["radius","latLongTessellation","thetaResolution","startTheta","endTheta","phiResolution","startPhi","endPhi"]),T.setGetArray(t,e,["center"],3),T.algo(t,e,0,1),fD(t,e)}var gD=T.newInstance(mp,"vtkSphereSource"),kp={newInstance:gD,extend:mp},Ht=ei.States;function vD(t,e){e.classHierarchy.push("vtkMouseCameraUnicamRotateManipulator"),e.picker=uD.newInstance(),e.downPoint=[0,0,0],e.isDot=!1,e.state=Ht.IS_NONE;var r=kp.newInstance();r.setThetaResolution(6),r.setPhiResolution(6);var n=Ye.newInstance();n.setInputConnection(r.getOutputPort()),e.focusSphere=En.newInstance(),e.focusSphere.setMapper(n),e.focusSphere.getProperty().setColor(.89,.66,.41),e.focusSphere.getProperty().setAmbient(1),e.focusSphere.getProperty().setDiffuse(0),e.focusSphere.getProperty().setRepresentationToWireframe();var a=function(l){if(l){if(e.useWorldUpVec){var h=l.findPokedRenderer().getActiveCamera();Ma(e.worldUpVec,h.getViewPlaneNormal())||h.setViewUp(e.worldUpVec)}l.render()}},i=function(l,h){var y=h.findPokedRenderer(),C=h.getView().getViewportSize(y),S=ne(C,2),d=S[0],O=S[1],w=-1+2*l.x/d,M=-1+2*l.y/O;return{x:w,y:M}},o=function(l,h,y,C,S,d,O,w){var M=l.getPosition(),x=l.getFocalPoint(),D=l.getViewUp();M[3]=1,x[3]=1,D[3]=0;var R=I(new Float64Array(16));we(R,R,[h,y,C]),We(R,R,w,[S,d,O]),we(R,R,[-h,-y,-C]);var V=[],E=[];Q(V,M,R),Q(E,x,R),I(R),We(R,R,w,[S,d,O]);var L=[];Q(L,D,R),l.setPosition.apply(l,V),l.setFocalPoint.apply(l,E),l.setViewUp.apply(l,L)},s=function(l,h){var y,C=l.findPokedRenderer(),S=i(h,l),d=i(e.previousPosition,l),O=e.focusSphere.getPosition(),w=(y=l.getView()).worldToDisplay.apply(y,W(O).concat([C]));w=i({x:O[0],y:O[1]},l),w=[w.x,w.y,O[2]];var M=Math.pow(1+Math.abs(w[0]),2),x=[d.x,0,0],D=[S.x,0,0],R=Math.pow(x[0],2),V=Math.pow(D[0],2),E=R>M?0:Math.sqrt(M-R),L=V>M?0:Math.sqrt(M-V),m=[x[0],0,E];Fe(m);var N=[D[0],0,L];Fe(N);var _=A(m,N);if(Math.abs(_)>1e-4){var G=-2*Math.acos(gt(_,-1,1))*Math.sign(S.x-d.x)*t.getRotationFactor(),k=C.getActiveCamera(),U=e.useWorldUpVec?e.worldUpVec:k.getViewUp();Fe(U),o.apply(void 0,[k].concat(W(O),W(U),[G]));var B=[],j=k.getPosition();tt(j,h,B);var H=(S.y-d.y)*t.getRotationFactor();Fe(B);var X=k.getViewPlaneNormal(),Y=k.getViewUp(),ee=[];if(me(Y,X,ee),Fe(ee),e.useWorldUpVec){var ce=.99;A(U,X)>ce&&H<0&&(H=0),A(U,X)<-ce&&H>0&&(H=0)}o.apply(void 0,[k].concat(W(O),ee,[H])),e.useWorldUpVec&&!Ma(U,k.getViewPlaneNormal())&&k.setViewUp.apply(k,W(U)),e.previousPosition=h,C.resetCameraClippingRange(),a(l)}},f=function(l){var h,y=l.findPokedRenderer();(h=e.focusSphere).setPosition.apply(h,W(e.downPoint));var C=y.getActiveCamera(),S=C.getPosition(),d=[];tt(e.downPoint,S,d),C.getParallelProjection()&&dt(d,C.getParallelScale());var O=C.getDirectionOfProjection();Fe(O);var w=.02*A(O,d)*e.focusSphereRadiusFactor;e.focusSphere.setScale(w,w,w)},c=function(l){f(l),l.findPokedRenderer().addActor(e.focusSphere),e.isDot=!0},u=function(l){l.findPokedRenderer().removeActor(e.focusSphere),e.isDot=!1},v=function(l,h){var y=l.findPokedRenderer();e.picker.pick([h.x,h.y,h.z],y);var C=e.picker.getPickedPositions();if(C.length===0)return e.picker.getPickPosition();var S=y.getActiveCamera().getPosition();return C.sort(function(d,O){return et(d,S)-et(O,S)}),C[0]},g=function(l,h){var y=l.findPokedRenderer(),C=null;if(e.useHardwareSelector){var S=l.getView().getSelector();S.setCaptureZValues(!0),S.setFieldAssociation(No.FIELD_ASSOCIATION_POINTS),S.attach(l.getView(),y),S.setArea(h.x,h.y,h.x,h.y),C=S.select()}return C&&C.length!==0?Array.from(C[0].getProperties().worldPosition):v(l,h)};t.onButtonDown=function(p,l,h){e.buttonPressed=!0,e.startPosition=h,e.previousPosition=h;var y=i(h,p),C=.1;if(Math.abs(y.x)>1-C||Math.abs(y.y)>1-C){e.state=Ht.IS_ROTATE,c(p);return}e.downPoint=g(p,h),e.isDot?e.state=Ht.IS_ROTATE:(e.state=Ht.IS_NONE,e.displayFocusSphereOnButtonDown&&c(p))},t.onMouseMove=function(p,l,h){e.buttonPressed&&(e.state=Ht.IS_ROTATE,s(p,h),e.previousPosition=h)},t.onButtonUp=function(p){var l=p.findPokedRenderer();e.buttonPressed=!1,!(e.state===Ht.IS_ROTATE&&!e.isDot)&&(e.state===Ht.IS_ROTATE?u(p):e.state===Ht.IS_NONE&&c(p),l.resetCameraClippingRange(),a(p))},t.getFocusSphereColor=function(){e.focusSphere.getProperty().getColor()},t.setFocusSphereColor=function(p,l,h){e.focusSphere.getProperty().setColor(p,l,h)}}var pD={focusSphereRadiusFactor:1,displayFocusSphereOnButtonDown:!0,useHardwareSelector:!0,useWorldUpVec:!0,worldUpVec:[0,0,1]};function Fp(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,pD,r),T.obj(t,e),pt.extend(t,e,r),st.extend(t,e,r),T.setGet(t,e,["focusSphereRadiusFactor","displayFocusSphereOnButtonDown","useHardwareSelector","useWorldUpVec"]),T.get(t,e,["state"]),T.getArray(t,e,["downPoint"],3),T.setGetArray(t,e,["worldUpVec"],3),vD(t,e)}var lD=T.newInstance(Fp,"vtkMouseCameraUnicamRotateManipulator"),Np={newInstance:lD,extend:Fp},xt=ei.States;function hD(t,e){e.classHierarchy.push("vtkMouseCameraUnicamManipulator"),e.state=xt.IS_NONE,e.rotateManipulator=Np.newInstance({button:e.button,shift:e.shift,control:e.control,alt:e.alt,dragEnabled:e.dragEnabled,scrollEnabled:e.scrollEnabled,displayFocusSphereOnButtonDown:!1});var r=function(f,c){var u=c.findPokedRenderer(),v=c.getView().getViewportSize(u),g=ne(v,2),p=g[0],l=g[1],h=-1+2*f.x/p,y=-1+2*f.y/l;return{x:h,y}},n=function(f,c){var u=c.findPokedRenderer().getActiveCamera(),v=u.getPosition(),g=[0,0,0];tt(f,v,g),u.getParallelProjection()&&dt(g,u.getParallelScale());var p=u.getViewPlaneNormal();Fe(p);var l=A(g,p),h=de(u.getViewAngle()),y=c.findPokedRenderer(),C=c.getView().getViewportSize(y),S=ne(C,2),d=S[0],O=S[1],w=d/O*(2*l*Math.tan(h/2)/2),M=2*l*Math.tan(h/2)/2,x=u.getViewUp(),D=[];return me(x,p,D),me(p,D,x),Fe(D),Fe(x),dt(D,w),dt(x,M),{rightV:D,upV:x}},a=function(f,c){var u=r(c,f),v=r(e.previousPosition,f),g={x:u.x-v.x,y:u.y-v.y};e.previousPosition=c;var p=Date.now()/1e3-e.time;e.dist+=Math.sqrt(Math.pow(g.x,2)+Math.pow(g.y,2));var l={x:c.x-e.startPosition.x,y:c.y-e.startPosition.y},h=Math.sqrt(Math.pow(l.x,2)+Math.pow(l.y,2));Math.abs(l.y)/h>.9&&p>.05?e.state=xt.IS_DOLLY:(p>=.1||e.dist>=.03)&&(Math.abs(l.x)/h>.6?e.state=xt.IS_PAN:e.state=xt.IS_DOLLY)},i=function(f,c){var u=f.findPokedRenderer(),v=r(c,f),g=r(e.previousPosition,f),p={x:v.x-g.x,y:v.y-g.y},l=u.getActiveCamera();e.previousPosition=c;for(var h=n(e.downPoint,f),y=h.rightV,C=h.upV,S=[],d=0;d<3;d++)S[d]=p.x*y[d]+p.y*C[d];l.translate.apply(l,S),u.resetCameraClippingRange(),f.render()},o=function(f,c){var u=f.findPokedRenderer(),v=r(c,f),g=r(e.previousPosition,f),p={x:v.x-g.x,y:v.y-g.y},l=u.getActiveCamera(),h=l.getPosition();if(l.getParallelProjection())l.zoom(1-p.y);else{var y=[];tt(e.downPoint,h,y),dt(y,p.y*-4),l.translate.apply(l,y)}var C=n(e.downPoint,f),S=C.rightV;dt(S,p.x),l.translate.apply(l,W(S)),u.resetCameraClippingRange(),f.render()};t.onButtonDown=function(s,f,c){e.buttonPressed=!0,e.startPosition=c,e.previousPosition=c,e.time=Date.now()/1e3,e.dist=0,e.rotateManipulator.onButtonDown(s,f,c),e.downPoint=e.rotateManipulator.getDownPoint()},t.onMouseMove=function(s,f,c){if(e.buttonPressed){if(e.rotateManipulator.getState()===xt.IS_ROTATE)e.rotateManipulator.onMouseMove(s,f,c);else switch(e.state){case xt.IS_NONE:a(s,c);break;case xt.IS_PAN:i(s,c);break;case xt.IS_DOLLY:o(s,c);break}e.previousPosition=c}},t.onButtonUp=function(s){e.buttonPressed=!1,e.state===xt.IS_NONE&&e.rotateManipulator.onButtonUp(s),e.state=xt.IS_NONE},t.getUseWorldUpVec=function(){return e.rotateManipulator.getUseWorldUpVec()},t.setUseWorldUpVec=function(s){e.rotateManipulator.setUseWorldUpVec(s)},t.getWorldUpVec=function(){return e.rotateManipulator.getWorldUpVec()},t.setWorldUpVec=function(s,f,c){e.rotateManipulator.setWorldUpVec(s,f,c)},t.getUseHardwareSelector=function(){return e.rotateManipulator.getUseHardwareSelector()},t.setUseHardwareSelector=function(s){e.rotateManipulator.setUseHardwareSelector(s)},t.getFocusSphereColor=function(){e.rotateManipulator.getFocusSphereColor()},t.setFocusSphereColor=function(s,f,c){e.rotateManipulator.setFocusSphereColor(s,f,c)},t.getFocusSphereRadiusFactor=function(){return e.rotateManipulator.getFocusSphereRadiusFactor()},t.setFocusSphereRadiusFactor=function(s){e.rotateManipulator.setFocusSphereRadiusFactor(s)}}var yD={};function Up(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,yD,r),T.obj(t,e),pt.extend(t,e,r),st.extend(t,e,r),hD(t,e)}var TD=T.newInstance(Up,"vtkMouseCameraUnicamManipulator"),CD={newInstance:TD,extend:Up},SD="vtkMouseCameraTrackballFirstPersonManipulator";function dD(t,e){e.classHierarchy.push("vtkMouseCameraTrackballFirstPersonManipulator");var r={interactor:null,renderer:null,previousPosition:null};t.onButtonDown=function(n,a,i){r.previousPosition=i,e.usePointerLock&&!n.isPointerLocked()&&(Object.assign(r,{interactor:n,renderer:a}),n.requestPointerLock(),t.startPointerLockInteraction())},t.startPointerLockInteraction=function(){var n=r.interactor;document.addEventListener("mousemove",t.onPointerLockMove);var a=null,i=function(){document.removeEventListener("mousemove",t.onPointerLockMove),a.unsubscribe()};a=n.onEndPointerLock(i)},t.onPointerLockMove=function(n){var a=e.sensitivity,i=-1*n.movementX*a,o=-1*n.movementY*a;t.moveCamera(i,o)},t.onMouseMove=function(n,a,i){if(i){var o=r.previousPosition,s=e.sensitivity,f=(o.x-i.x)*s,c=(i.y-o.y)*s;Object.assign(r,{interactor:n,renderer:a}),t.moveCamera(f,c),r.previousPosition=i}},t.moveCamera=function(n,a){var i=r.renderer,o=r.interactor,s=i.getActiveCamera(),f=e.numAnimationSteps,c=n/f,u=a/f,v=performance.now().toString(),g="".concat(SD,".").concat(v),p=0,l=null,h=function(){if(s.yaw(c),s.pitch(u),s.orthogonalizeViewUp(),p+=1,p===f){l.unsubscribe(),i.resetCameraClippingRange(),o.getLightFollowCamera()&&i.updateLightsGeometryToFollowCamera();var C=function(){r.interactor.cancelAnimation(g)};setTimeout(C,0)}};o.requestAnimation(g),l=o.onAnimation(function(){return h()})}}var OD={numAnimationSteps:5,sensitivity:.05,usePointerLock:!0};function Gp(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,OD,r),T.obj(t,e),pt.extend(t,e,r),st.extend(t,e,r),T.setGet(t,e,["numAnimationSteps","sensitivity","usePointerLock"]),dD(t,e)}var wD=T.newInstance(Gp,"vtkMouseCameraTrackballFirstPersonManipulator"),xD={newInstance:wD,extend:Gp};function MD(t,e){e.classHierarchy.push("vtkMouseCameraTrackballRotateManipulator");var r=new Float64Array(3),n=new Float64Array(3),a=new Float64Array(3),i=new Float64Array(16),o=new Float64Array(3),s=new Float64Array(3),f=new Float64Array(3);t.onButtonDown=function(c,u,v){e.previousPosition=v},t.onMouseMove=function(c,u,v){if(v){var g=u.getActiveCamera(),p=g.getPosition(),l=g.getFocalPoint();I(i);var h=e.center,y=e.rotationFactor;e.useFocalPointAsCenterOfRotation&&(h[0]=l[0],h[1]=l[1],h[2]=l[2]);var C=e.previousPosition.x-v.x,S=e.previousPosition.y-v.y,d=c.getView().getViewportSize(u),O=g.getViewUp();if(e.useWorldUpVec){var w=new Float64Array(3);al(w,e.worldUpVec),dt(w,A(p,e.worldUpVec)/A(e.worldUpVec,e.worldUpVec)),wn(h,w,w),we(i,i,w),We(i,i,de(360*C/d[0]*y),e.worldUpVec),w[0]=-w[0],w[1]=-w[1],w[2]=-w[2],we(i,i,w),we(i,i,h)}else we(i,i,h),We(i,i,de(360*C/d[0]*y),O);me(g.getDirectionOfProjection(),O,o),We(i,i,de(-360*S/d[1]*y),o),s[0]=-h[0],s[1]=-h[1],s[2]=-h[2],we(i,i,s),Q(r,p,i),Q(n,l,i),f[0]=O[0]+p[0],f[1]=O[1]+p[1],f[2]=O[2]+p[2],Q(a,f,i),g.setPosition(r[0],r[1],r[2]),g.setFocalPoint(n[0],n[1],n[2]),g.setViewUp(a[0]-r[0],a[1]-r[1],a[2]-r[2]),g.orthogonalizeViewUp(),u.resetCameraClippingRange(),c.getLightFollowCamera()&&u.updateLightsGeometryToFollowCamera(),e.previousPosition=v}}}var DD={useWorldUpVec:!1,worldUpVec:[0,1,0],useFocalPointAsCenterOfRotation:!1};function Bp(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,DD,r),T.obj(t,e),st.extend(t,e,r),pt.extend(t,e,r),T.setGet(t,e,["useWorldUpVec"]),T.setGetArray(t,e,["worldUpVec"],3),T.setGet(t,e,["useFocalPointAsCenterOfRotation"]),MD(t,e)}var ED=T.newInstance(Bp,"vtkMouseCameraTrackballRotateManipulator"),_p={newInstance:ED,extend:Bp};function RD(t,e){e.classHierarchy.push("vtkMouseCameraTrackballRollManipulator");var r=new Float64Array(3),n=new Float64Array(3),a=new Float64Array(3),i=new Float64Array(16),o=new Float64Array(3),s=new Float64Array(3),f=new Float64Array(3);t.onButtonDown=function(c,u,v){e.previousPosition=v},t.onMouseMove=function(c,u,v){if(v){var g=u.getActiveCamera(),p=g.getPosition(),l=g.getFocalPoint(),h=g.getViewUp();r[0]=l[0]-p[0],r[1]=l[1]-p[1],r[2]=l[2]-p[2],t.computeDisplayCenter(c.getInteractorStyle(),u);var y=e.previousPosition.x-e.displayCenter[0],C=v.x-e.displayCenter[0],S=e.previousPosition.y-e.displayCenter[1],d=v.y-e.displayCenter[1];if(!(C===0&&d===0||y===0&&S===0)){var O=Fr((y*d-S*C)/(Math.sqrt(y*y+S*S)*Math.sqrt(C*C+d*d))),w=e.center;I(i),a[0]=-w[0],a[1]=-w[1],a[2]=-w[2],we(i,i,w),We(i,i,de(O),r),we(i,i,a),Q(o,p,i),Q(s,l,i),n[0]=h[0]+p[0],n[1]=h[1]+p[1],n[2]=h[2]+p[2],Q(f,n,i),g.setPosition(o[0],o[1],o[2]),g.setFocalPoint(s[0],s[1],s[2]),g.setViewUp(f[0]-o[0],f[1]-o[1],f[2]-o[2]),g.orthogonalizeViewUp(),u.resetCameraClippingRange(),c.getLightFollowCamera()&&u.updateLightsGeometryToFollowCamera(),e.previousPosition=v}}}}var VD={};function jp(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,VD,r),T.obj(t,e),pt.extend(t,e,r),st.extend(t,e,r),RD(t,e)}var LD=T.newInstance(jp,"vtkMouseCameraTrackballRollManipulator"),Wp={newInstance:LD,extend:jp};function mD(t,e){return t<e?e:t}function qu(t){return t*t}function kD(t,e){e.classHierarchy.push("vtkMouseCameraTrackballMultiRotateManipulator");var r=_p.newInstance(),n=Wp.newInstance(),a=null;t.onButtonDown=function(i,o,s){var f=i.getView().getViewportSize(o),c=[.5*f[0],.5*f[1]],u=.9*mD(c[0],c[1]),v=qu(c[0]-s.x)+qu(c[1]-s.y);u*u>v?a=r:a=n,a.setButton(t.getButton()),a.setShift(t.getShift()),a.setControl(t.getControl()),a.setCenter(t.getCenter()),a.onButtonDown(i,s)},t.onButtonUp=function(i){a&&a.onButtonUp(i)},t.onMouseMove=function(i,o,s){a&&a.onMouseMove(i,o,s)}}var FD={};function $p(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,FD,r),T.obj(t,e),st.extend(t,e,r),pt.extend(t,e,r),kD(t,e)}var ND=T.newInstance($p,"vtkMouseCameraTrackballMultiRotateManipulator"),UD={newInstance:ND,extend:$p};function GD(t,e){e.classHierarchy.push("vtkMouseCameraTrackballPanManipulator"),t.onButtonDown=function(r,n,a){e.previousPosition=a},t.onMouseMove=function(r,n,a){if(a){var i=a,o=e.previousPosition;e.previousPosition=a;var s=n.getActiveCamera(),f=s.getPosition(),c=s.getFocalPoint();if(s.getParallelProjection()){s.orthogonalizeViewUp();var u=s.getViewUp(),v=s.getViewPlaneNormal(),g=[0,0,0];me(v,u,g);var p=r.getView().getViewportSize(n)[1],l=(i.x-o.x)/p,h=(o.y-i.y)/p,y=s.getParallelScale();l*=y*2,h*=y*2;var C=g[0]*l+u[0]*h;f[0]+=C,c[0]+=C,C=g[1]*l+u[1]*h,f[1]+=C,c[1]+=C,C=g[2]*l+u[2]*h,f[2]+=C,c[2]+=C,s.setPosition(f[0],f[1],f[2]),s.setFocalPoint(c[0],c[1],c[2])}else{var S=e.center,d=r.getInteractorStyle(),O=d.computeWorldToDisplay(n,S[0],S[1],S[2])[2],w=d.computeDisplayToWorld(n,i.x,i.y,O),M=d.computeDisplayToWorld(n,o.x,o.y,O),x=[f[0]+(M[0]-w[0]),f[1]+(M[1]-w[1]),f[2]+(M[2]-w[2])],D=[c[0]+(M[0]-w[0]),c[1]+(M[1]-w[1]),c[2]+(M[2]-w[2])];s.setPosition(x[0],x[1],x[2]),s.setFocalPoint(D[0],D[1],D[2])}n.resetCameraClippingRange(),r.getLightFollowCamera()&&n.updateLightsGeometryToFollowCamera()}}}var BD={};function zp(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,BD,r),T.obj(t,e),pt.extend(t,e,r),st.extend(t,e,r),GD(t,e)}var _D=T.newInstance(zp,"vtkMouseCameraTrackballPanManipulator"),jD={newInstance:_D,extend:zp};function WD(t,e){e.classHierarchy.push("vtkMouseCameraTrackballZoomManipulator"),t.onButtonDown=function(r,n,a){e.previousPosition=a;var i=r.getView().getViewportSize(n),o=n.getActiveCamera(),s=e.flipDirection?-1:1;if(o.getParallelProjection())e.zoomScale=1.5/i[1]*s;else{var f=o.getClippingRange();e.zoomScale=1.5*(f[1]/i[1])*s}},t.onMouseMove=function(r,n,a){if(a){var i=e.previousPosition.y-a.y,o=n.getActiveCamera();if(o.getParallelProjection()){var s=i*e.zoomScale;o.setParallelScale((1-s)*o.getParallelScale())}else{var f=o.getPosition(),c=o.getFocalPoint(),u=o.getDirectionOfProjection(),v=i*e.zoomScale,g=v*u[0];f[0]+=g,c[0]+=g,g=v*u[1],f[1]+=g,c[1]+=g,g=v*u[2],f[2]+=g,c[2]+=g,o.getFreezeFocalPoint()||o.setFocalPoint(c[0],c[1],c[2]),o.setPosition(f[0],f[1],f[2]),n.resetCameraClippingRange()}r.getLightFollowCamera()&&n.updateLightsGeometryToFollowCamera(),e.previousPosition=a}},t.onScroll=function(r,n,a){if(a){var i=n.getActiveCamera(),o=1-a/10;i.getParallelProjection()?i.setParallelScale(i.getParallelScale()/o):(i.dolly(o),n.resetCameraClippingRange()),r.getLightFollowCamera()&&n.updateLightsGeometryToFollowCamera()}}}var $D={zoomScale:0,flipDirection:!1};function bp(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$D,r),T.obj(t,e),st.extend(t,e,r),pt.extend(t,e,r),T.setGet(t,e,["flipDirection"]),WD(t,e)}var zD=T.newInstance(bp,"vtkMouseCameraTrackballZoomManipulator"),Hp={newInstance:zD,extend:bp};function bD(t,e){e.classHierarchy.push("vtkMouseCameraTrackballZoomToMouseManipulator");var r=t.onButtonDown;t.onButtonDown=function(n,a,i){r(n,a,i),e.zoomPosition=i},t.onMouseMove=function(n,a,i){if(i){var o=e.previousPosition.y-i.y,s=o*e.zoomScale;Br.dollyToPosition(1-s,e.zoomPosition,a,n),n.getLightFollowCamera()&&a.updateLightsGeometryToFollowCamera(),e.previousPosition=i}},t.onScroll=function(n,a,i,o){if(!(!i||!o)){var s=1-i*.1;Br.dollyToPosition(s,o,a,n),n.getLightFollowCamera()&&a.updateLightsGeometryToFollowCamera()}}}var HD={zoomPosition:null};function Kp(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,HD,r),Hp.extend(t,e,r),bD(t,e)}var KD=T.newInstance(Kp,"vtkMouseCameraTrackballZoomToMouseManipulator"),PD={newInstance:KD,extend:Kp};function XD(t,e){e.classHierarchy.push("vtkMouseRangeManipulator");var r=new Map;function n(i,o){return o*((i.max-i.min)/(i.step+1))}function a(i,o){var s=i.getValue(),f=i.exponentialScroll?Math.pow(i.scale,Math.log2(Math.abs(e.interactionNetDelta)+2)):i.scale;f=Math.abs(f)*Math.sign(i.scale);var c=o*f+r.get(i),u=Math.floor(Math.abs(c/i.step)),v=s+i.step*u*Math.sign(c);v=Math.max(v,i.min),v=Math.min(v,i.max),v!==s?(i.setValue(v),r.set(i,0)):v===i.min&&c<0||v===i.max&&c>0?r.set(i,0):r.set(i,c)}t.setHorizontalListener=function(i,o,s,f,c){var u=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1,v=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!1,g=Number.isFinite(f)?function(){return f}:f;e.horizontalListener={min:i,max:o,step:s,getValue:g,setValue:c,scale:u,exponentialScroll:v},r.set(e.horizontalListener,0),t.modified()},t.setVerticalListener=function(i,o,s,f,c){var u=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1,v=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!1,g=Number.isFinite(f)?function(){return f}:f;e.verticalListener={min:i,max:o,step:s,getValue:g,setValue:c,scale:u,exponentialScroll:v},r.set(e.verticalListener,0),t.modified()},t.setScrollListener=function(i,o,s,f,c){var u=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1,v=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!1;s<0&&qn("Value of step cannot be negative. If you want to invert the scrolling direction, use a negative scale value instead.");var g=Math.abs(s),p=Number.isFinite(f)?function(){return f}:f;e.scrollListener={min:i,max:o,step:g,getValue:p,setValue:c,scale:u,exponentialScroll:v},r.set(e.scrollListener,0),t.modified()},t.removeHorizontalListener=function(){e.horizontalListener&&(r.delete(e.horizontalListener),delete e.horizontalListener,t.modified())},t.removeVerticalListener=function(){e.verticalListener&&(r.delete(e.verticalListener),delete e.verticalListener,t.modified())},t.removeScrollListener=function(){e.scrollListener&&(r.delete(e.scrollListener),delete e.scrollListener,t.modified())},t.removeAllListeners=function(){t.removeHorizontalListener(),t.removeVerticalListener(),t.removeScrollListener()},t.onButtonDown=function(i,o,s){e.previousPosition=s,e.interactionNetDelta=0;var f=i.getView(),c=f.getContainerSize()[0]/f.getSize()[0],u=f.getViewportSize(o);e.containerSize=u.map(function(v){return v*c})},t.onButtonUp=function(i){i.exitPointerLock()},t.startPointerLockEvent=function(i,o){var s=function(v){t.onPointerLockMove(i,o,v)};document.addEventListener("mousemove",s);var f=null,c=function(){var v;document.removeEventListener("mousemove",s),(v=f)===null||v===void 0||v.unsubscribe()};f=i==null?void 0:i.onEndPointerLock(c)},t.onPointerLockMove=function(i,o,s){i.isPointerLocked()&&e.previousPosition!=null&&(e.previousPosition.x+=s.movementX,e.previousPosition.y+=s.movementY,t.onMouseMove(i,o,e.previousPosition))},t.onMouseMove=function(i,o,s){if(!(!e.verticalListener&&!e.horizontalListener)&&(e.usePointerLock&&!i.isPointerLocked()&&(i.requestPointerLock(),t.startPointerLockEvent(i,o)),!!s)){if(e.horizontalListener){var f=(s.x-e.previousPosition.x)/e.containerSize[0],c=n(e.horizontalListener,f);e.interactionNetDelta+=c,a(e.horizontalListener,c)}if(e.verticalListener){var u=(s.y-e.previousPosition.y)/e.containerSize[1],v=n(e.verticalListener,u);e.interactionNetDelta+=v,a(e.verticalListener,v)}e.previousPosition=s}},t.onScroll=function(i,o,s){!e.scrollListener||!s||(e.interactionNetDelta+=s*e.scrollListener.step,a(e.scrollListener,s*e.scrollListener.step))},t.onStartScroll=function(){e.interactionNetDelta=0}}var YD={horizontalListener:null,verticalListener:null,scrollListener:null};function Pp(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,YD,r),T.obj(t,e),st.extend(t,e,r),T.setGet(t,e,["usePointerLock"]),XD(t,e)}var AD=T.newInstance(Pp,"vtkMouseRangeManipulator"),Xp={newInstance:AD,extend:Pp};function ZD(t,e){e.classHierarchy.push("vtkVRButtonPanManipulator"),t.onButton3D=function(r,n,a,i,o,s){s?r.startCameraPose():a===io.IS_CAMERA_POSE&&r.endCameraPose()},t.onMove3D=function(r,n,a,i){if(a===io.IS_CAMERA_POSE){var o=n.getActiveCamera(),s=o.getPhysicalTranslation(),f=i.gamepad.axes[1],c=f*.05*o.getPhysicalScale(),u=o.physicalOrientationToWorldDirection(i.orientation);o.setPhysicalTranslation(s[0]+u[0]*c,s[1]+u[1]*c,s[2]+u[2]*c)}}}var qD={device:Po.RightController,input:Xo.TrackPad};function Yp(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,qD,r),T.obj(t,e),Op.extend(t,e,r),ZD(t,e)}var JD=T.newInstance(Yp,"vtkVRButtonPanManipulator"),QD={newInstance:JD,extend:Yp},Xe={vtkCompositeCameraManipulator:pt,vtkCompositeGestureManipulator:Sp,vtkCompositeKeyboardManipulator:dp,vtkCompositeMouseManipulator:st,vtkCompositeVRManipulator:Op,vtkGestureCameraManipulator:R2,vtkKeyboardCameraManipulator:F2,vtkMouseBoxSelectorManipulator:W2,vtkMouseCameraAxisRotateManipulator:H2,vtkMouseCameraSliceManipulator:Y2,vtkMouseCameraUnicamManipulator:CD,vtkMouseCameraUnicamRotateManipulator:Np,vtkMouseCameraTrackballFirstPersonManipulator:xD,vtkMouseCameraTrackballMultiRotateManipulator:UD,vtkMouseCameraTrackballPanManipulator:jD,vtkMouseCameraTrackballRollManipulator:Wp,vtkMouseCameraTrackballRotateManipulator:_p,vtkMouseCameraTrackballZoomManipulator:Hp,vtkMouseCameraTrackballZoomToMouseManipulator:PD,vtkMouseRangeManipulator:Xp,vtkVRButtonPanManipulator:QD},Ap={slice:Xe.vtkMouseCameraSliceManipulator,multiRotate:Xe.vtkMouseCameraTrackballMultiRotateManipulator,pan:Xe.vtkMouseCameraTrackballPanManipulator,roll:Xe.vtkMouseCameraTrackballRollManipulator,rotate:Xe.vtkMouseCameraTrackballRotateManipulator,axisRotate:Xe.vtkMouseCameraAxisRotateManipulator,zoom:Xe.vtkMouseCameraTrackballZoomManipulator,zoomToMouse:Xe.vtkMouseCameraTrackballZoomToMouseManipulator,range:Xe.vtkMouseRangeManipulator,vrPan:Xe.vtkVRButtonPanManipulator,gestureCamera:Xe.vtkGestureCameraManipulator,movement:Xe.vtkKeyboardCameraManipulator,freeLook:Xe.vtkMouseCameraTrackballFirstPersonManipulator,unicam:Xe.vtkMouseCameraUnicamManipulator,unicamRotate:Xe.vtkMouseCameraUnicamRotateManipulator},Zp={"3D":[{type:"rotate"},{type:"pan",options:{shift:!0}},{type:"zoom",options:{control:!0}},{type:"zoom",options:{alt:!0}},{type:"zoom",options:{dragEnabled:!1,scrollEnabled:!0}},{type:"zoom",options:{button:3}},{type:"roll",options:{shift:!0,control:!0}},{type:"roll",options:{shift:!0,alt:!0}},{type:"roll",options:{shift:!0,button:3}},{type:"vrPan"},{type:"gestureCamera"}],"2D":[{type:"pan",options:{shift:!0}},{type:"zoom",options:{control:!0}},{type:"zoom",options:{alt:!0}},{type:"zoom",options:{button:3}},{type:"roll",options:{shift:!0,alt:!0}},{type:"roll",options:{shift:!0,button:3}},{type:"roll",options:{shift:!0}},{type:"vrPan"},{type:"gestureCamera"}],FirstPerson:[{type:"movement"},{type:"freeLook"}],Unicam:[{type:"unicam"}],zRotateTop:[{type:"pan",options:{shift:!0}},{type:"axisRotate",options:{rotationAxis:[0,0,1],useHalfAxis:!0}},{type:"zoom",options:{control:!0}},{type:"zoom",options:{alt:!0}},{type:"zoom",options:{dragEnabled:!1,scrollEnabled:!0}},{type:"zoom",options:{button:3}}],zRotateAll:[{type:"pan",options:{shift:!0}},{type:"axisRotate",options:{rotationAxis:[0,0,1],useHalfAxis:!1}},{type:"zoom",options:{control:!0}},{type:"zoom",options:{alt:!0}},{type:"zoom",options:{dragEnabled:!1,scrollEnabled:!0}},{type:"zoom",options:{button:3}}]};function qp(t,e){e.removeAllManipulators();for(var r=0;r<t.length;r++){var n=t[r],a=Ap[n.type].newInstance(n.options);a.isA("vtkCompositeVRManipulator")?e.addVRManipulator(a):a.isA("vtkCompositeGestureManipulator")?e.addGestureManipulator(a):a.isA("vtkCompositeKeyboardManipulator")?e.addKeyboardManipulator(a):e.addMouseManipulator(a)}return!0}function ID(t,e){return qp(Zp[t],e)}function eE(t,e){Ap[t]=e}function tE(t,e){Zp[t]=e}var Nn={applyDefinitions:qp,applyPreset:ID,registerManipulatorType:eE,registerStylePreset:tE},nE=["format"],ur=1e-6;function rE(t,e){e.classHierarchy.push("vtkViewProxy");function r(){var n=e.renderer.getBackground(),a=ne(n,3),i=a[0],o=a[1],s=a[2];e.cornerAnnotation.getAnnotationContainer().style.color=i+o+s>1.5?"black":"white"}e.renderWindow=rM.newInstance(),e.renderer=yp.newInstance({background:[0,0,0]}),e.renderWindow.addRenderer(e.renderer),e._openGLRenderWindow=e.renderWindow.newAPISpecificView(),e.renderWindow.addView(e._openGLRenderWindow),e.interactor=Yv.newInstance(),e.interactor.setView(e._openGLRenderWindow),e.interactorStyle3D=Br.newInstance(),e.interactorStyle2D=Br.newInstance(),e._resetCamera=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return e.renderer.resetCamera(n)},Nn.applyPreset("3D",e.interactorStyle3D),Nn.applyPreset("2D",e.interactorStyle2D),e.cornerAnnotation=Uu.newInstance(),e.interactor.setInteractorStyle(e.useParallelRendering?e.interactorStyle2D:e.interactorStyle3D),e.camera=e.renderer.getActiveCamera(),e.camera.setParallelProjection(!!e.useParallelRendering),e.orientationAxesArrow=yx.newInstance(),e.orientationAxesCube=qw.newInstance(),Sr.applyPreset("default",e.orientationAxesCube),Sr.applyPreset("lps",e.orientationAxesCube),e.orientationAxesMap={arrow:e.orientationAxesArrow,cube:e.orientationAxesCube},e.orientationWidget=Pu.newInstance({actor:e.orientationAxesArrow,interactor:e.renderWindow.getInteractor()}),e.orientationWidget.setEnabled(!0),e.orientationWidget.setViewportCorner(Pu.Corners.BOTTOM_LEFT),e.orientationWidget.setViewportSize(.1),t.setPresetToInteractor3D=function(n){return Array.isArray(n)?Nn.applyDefinitions(n,e.interactorStyle3D):Nn.applyPreset(n,e.interactorStyle3D)},t.setPresetToInteractor2D=function(n){return Array.isArray(n)?Nn.applyDefinitions(n,e.interactorStyle2D):Nn.applyPreset(n,e.interactorStyle2D)},t.setOrientationAxesType=function(n){var a=e.orientationAxesMap[n];a&&(e.orientationAxesType=n,e.orientationWidget.setActor(a),t.renderLater())},t.registerOrientationAxis=function(n,a){e.orientationAxesMap[n]=a},t.unregisterOrientationAxis=function(n){delete e.orientationAxesMap[n]},t.listOrientationAxis=function(){return Object.keys(e.orientationAxesMap)},t.setPresetToOrientationAxes=function(n){var a=!1;return typeof n=="string"?(e.presetToOrientationAxes!==n&&(e.presetToOrientationAxes=n,a=Sr.applyPreset(n,e.orientationAxesCube),t.modified()),a):(e.presetToOrientationAxes="Custom",a=Sr.applyDefinitions(n,e.orientationAxesCube),t.modified(),a)},t.setContainer=function(n){var a=e.orientationWidget.getEnabled();e.container&&(e.orientationWidget.setEnabled(!1),e.interactor.unbindEvents(e.container),e._openGLRenderWindow.setContainer(null),e.cornerAnnotation.setContainer(null)),e.container=n,n&&(e._openGLRenderWindow.setContainer(n),e.cornerAnnotation.setContainer(n),e.interactor.initialize(),e.interactor.bindEvents(n),e.orientationWidget.setEnabled(a))},t.resize=function(){if(e.container){var n=e.container.getBoundingClientRect();if(n.width===n.height&&n.width===0)return;var a=window.devicePixelRatio||1,i=Math.max(10,Math.floor(a*n.width)),o=Math.max(10,Math.floor(a*n.height));e._openGLRenderWindow.setSize(i,o),t.invokeResize({width:i,height:o}),t.renderLater()}},t.renderLater=function(){t.render(!1)},t.render=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;e.representations.length>0&&e.resetCameraOnFirstRender&&(e.resetCameraOnFirstRender=!1,t.resetCamera()),e.orientationWidget.updateMarkerOrientation(),e.renderer.resetCameraClippingRange(),n?e.renderWindow.render():setTimeout(e.renderWindow.render,0)},t.addRepresentation=function(n){n&&e.representations.indexOf(n)===-1&&(e.representations.push(n),e.renderer.addViewProp(n))},t.removeRepresentation=function(n){n&&(e.representations.indexOf(n)!==-1&&(e.representations=e.representations.filter(function(a){return a!==n}),e.renderer.removeViewProp(n)),e.representations.length===0&&(e.resetCameraOnFirstRender=!0))},t.setCameraParameters=function(n){var a=n.position,i=n.focalPoint,o=n.bounds,s=n.parallelScale,f=n.viewAngle;if(a!=null){var c;(c=e.camera).setPosition.apply(c,W(a))}if(i!=null){var u;(u=e.camera).setFocalPoint.apply(u,W(i))}o!=null?e.renderer.resetCameraClippingRange(o):e.renderer.resetCameraClippingRange(),s!=null&&e.camera.setParallelScale(s),f!=null&&e.camera.setViewAngle(f)},t.resetCamera=function(){e._resetCamera(),e.interactorStyle2D.setCenterOfRotation(e.camera.getFocalPoint()),e.interactorStyle3D.setCenterOfRotation(e.camera.getFocalPoint()),t.renderLater()},t.captureImage=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=n.format,i=a===void 0?"image/png":a,o=il(n,nE);return e.renderWindow.captureImages(i,o)[0]},t.openCaptureImage=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"_blank",a=new Image;return t.captureImage().then(function(i){a.src=i;var o=window.open("",n);o.document.write(a.outerHTML),o.document.title="vtk.js Image Capture",window.focus()})},t.setCornerAnnotation=function(n,a){e.cornerAnnotation.updateTemplates(b({},n,function(i){return Uu.applyTemplate(a,i)}))},t.setCornerAnnotations=function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;a?Object.keys(n).forEach(function(i){t.setCornerAnnotation(i,n[i])}):e.cornerAnnotation.updateTemplates(n)},t.updateCornerAnnotation=function(n){return e.cornerAnnotation.updateMetadata(n)},t.setAnnotationOpacity=function(n){e.annotationOpacity!==Number(n)&&(e.annotationOpacity=Number(n),e.cornerAnnotation.getAnnotationContainer().style.opacity=n,t.modified())},t.setBackground=$n(e.renderer.setBackground,r),t.getBackground=e.renderer.getBackground,t.setAnimation=function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t;if(!(e.disableAnimation&&n))if(n)e.renderWindow.getInteractor().requestAnimation(a);else{var i=a===t||"".concat(a).indexOf("ViewProxy.moveCamera.")===0;e.renderWindow.getInteractor().cancelAnimation(a,i)}},t.updateOrientation=function(n,a,i){var o,s,f,c,u,v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if(n===void 0)return Promise.resolve();var g=e.camera.getPosition(),p=e.camera.getViewUp(),l=e.camera.getFocalPoint();e.axis=n,e.orientation=a,e.viewUp=i;var h=e.camera.getFocalPoint();h[e.axis]+=e.orientation,(o=e.camera).setPosition.apply(o,W(h)),(s=e.camera).setViewUp.apply(s,W(i)),e.renderer.resetCamera();var y=e.camera.getFocalPoint(),C=e.camera.getPosition(),S=e.camera.getViewUp();return(f=e.camera).setFocalPoint.apply(f,W(l)),(c=e.camera).setPosition.apply(c,W(g)),(u=e.camera).setViewUp.apply(u,W(p)),t.moveCamera(y,C,S,v)},t.moveCamera=function(n,a,i){var o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,s=e.camera.getFocalPoint(),f=e.camera.getPosition(),c=e.camera.getViewUp(),u=[{focalPoint:n,position:a,viewUp:i}];if(o){var v=[(s[0]-n[0])/o,(s[1]-n[1])/o,(s[2]-n[2])/o],g=[(f[0]-a[0])/o,(f[1]-a[1])/o,(f[2]-a[2])/o],p=[(c[0]-i[0])/o,(c[1]-i[1])/o,(c[2]-i[2])/o],l=v[0]||v[1]||v[2]||g[0]||g[1]||g[2]||p[0]||p[1]||p[2],h=v.map(function(D){return Math.abs(D)<ur?0:1}).reduce(function(D,R){return D+R},0),y=g.map(function(D){return Math.abs(D)<ur?0:1}).reduce(function(D,R){return D+R},0),C=p.map(function(D){return Math.abs(D)<ur?0:1}).reduce(function(D,R){return D+R},0),S=C===1&&y===0&&h===0;if(l)if(S)for(var d=s.map(function(D,R){return Math.abs(f[R]-D)<ur?R:null}).filter(function(D){return D!==null}),O=d.find(function(D){return Math.abs(p[D])<ur}),w=0;w<o;w++){var M=[i[0]+(w+1)*p[0],i[1]+(w+1)*p[1],i[2]+(w+1)*p[2]];M[O]=Math.sin(Math.PI*w/(o-1)),u.push({focalPoint:n,position:a,viewUp:M})}else for(var x=0;x<o;x++)u.push({focalPoint:[n[0]+(x+1)*v[0],n[1]+(x+1)*v[1],n[2]+(x+1)*v[2]],position:[a[0]+(x+1)*g[0],a[1]+(x+1)*g[1],a[2]+(x+1)*g[2]],viewUp:[i[0]+(x+1)*p[0],i[1]+(x+1)*p[1],i[2]+(x+1)*p[2]]})}return u.length===1?(e.camera.set(u.pop()),e.renderer.resetCameraClippingRange(),e.interactor.getLightFollowCamera()&&e.renderer.updateLightsGeometryToFollowCamera(),Promise.resolve()):new Promise(function(D,R){var V=performance.now().toString(),E="ViewProxy.moveCamera.".concat(V);t.setAnimation(!0,E);var L=null,m=function(){if(u.length){var _,G,k,U=u.pop(),B=U.focalPoint,j=U.position,H=U.viewUp;(_=e.camera).setFocalPoint.apply(_,W(B)),(G=e.camera).setPosition.apply(G,W(j)),(k=e.camera).setViewUp.apply(k,W(H)),e.renderer.resetCameraClippingRange(),e.interactor.getLightFollowCamera()&&e.renderer.updateLightsGeometryToFollowCamera()}else clearInterval(L),t.setAnimation(!1,E),D()};L=setInterval(m,1)})},t.resetOrientation=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return t.updateOrientation(e.axis,e.orientation,e.viewUp,n)},t.rotate=function(n){var a,i=e.camera.get("viewUp","focalPoint","position"),o=i.viewUp,s=i.focalPoint,f=i.position,c=[s[0]-f[0],s[1]-f[1],s[2]-f[2]];qe.buildFromDegree().rotate(Number.isNaN(n)?90:n,c).apply(o),(a=e.camera).setViewUp.apply(a,W(o)),e.camera.modified(),e.orientationWidget.updateMarkerOrientation(),e.renderWindow.render()},t.focusTo=$n(e.camera.setFocalPoint,e.interactorStyle2D.setCenterOfRotation,e.interactorStyle3D.setCenterOfRotation),t.delete=$n(function(){t.setContainer(null),e.orientationWidget.setEnabled(!1),e.orientationWidget.delete(),e.orientationAxesArrow.delete(),e.orientationAxesCube.delete(),e.interactorStyle2D.delete(),e.interactorStyle3D.delete(),e.cornerAnnotation.delete(),e.interactor.delete(),e.renderer.delete(),e._openGLRenderWindow.delete(),e.renderWindow.delete()},t.delete),t.resetOrientation(),r()}var aE={representations:[],sectionName:"view",annotationOpacity:1,resetCameraOnFirstRender:!0,presetToOrientationAxes:"lps",orientationAxesType:"arrow",disableAnimation:!1,axis:1,orientation:0,viewUp:[0,0,1]};function Jp(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,aE,r),_e(t,e),ze(t,e,["name","disableAnimation"]),ot(t,e,["annotationOpacity","camera","container","cornerAnnotation","interactor","interactorStyle2D","interactorStyle3D","_openGLRenderWindow","orientationAxesType","presetToOrientationAxes","renderer","renderWindow","representations","useParallelRendering"]),_r(t,e,["openGLRenderWindow"]),xa(t,e,"Resize"),rE(t,e),lo(t,e),Yf(t,e,{orientationAxesVisibility:{modelKey:"orientationWidget",property:"enabled"},orientationAxesCorner:{modelKey:"orientationWidget",property:"viewportCorner"},orientationAxesSize:{modelKey:"orientationWidget",property:"viewportSize"},cameraViewUp:{modelKey:"camera",property:"viewUp",modified:!1},cameraPosition:{modelKey:"camera",property:"position",modified:!1},cameraFocalPoint:{modelKey:"camera",property:"focalPoint",modified:!1}})}var iE=ke(Jp,"vtkViewProxy"),oE={newInstance:iE,extend:Jp},Ju=512;function Qp(t){return Array.isArray(t)?t.map(Qp).join(", "):Number.isInteger(t)?t:Number.isFinite(t)?Math.abs(t)<.01?"0":t.toFixed(2):t}function sE(t){var e,r;if(!t.getVisibility()||!t.getUseBounds())return[];var n=t.getBounds(),a=null,i=t==null||(e=t.getMapper)===null||e===void 0?void 0:e.call(t),o=i==null||(r=i.getBounds)===null||r===void 0?void 0:r.call(i);if(J.isValid(o)&&t.getMatrix){var s;if(n=o,a=t.getMatrix().slice(),he(a,a),i.isA("vtkImageMapper")&&(s=i.getInputData())!==null&&s!==void 0&&s.isA("vtkImageData")){t.computeMatrix();var f=i.getInputData();n=f.getSpatialExtent();var c=f.getIndexToWorld();ol(a,a,c)}}var u=[];return J.getCorners(n,u),a&&u.forEach(function(v){return Q(v,v,a)}),u}function uE(t,e){e.classHierarchy.push("vtkView2DProxy"),t.updateWidthHeightAnnotation=function(){var c=e.cornerAnnotation.getMetadata(),u=c.ijkOrientation,v=c.dimensions;if(u&&v){var g=v;v.length>3&&(g=v.split(",").map(Number));var p=e.camera.getDirectionOfProjection(),l=e.camera.getViewUp(),h=[0,0,0];me(p,l,h);var y=Pi(h),C=Pi(l),S=g["IJK".indexOf(u[y])],d=g["IJK".indexOf(u[C])];t.updateCornerAnnotation({sliceWidth:S,sliceHeight:d})}};var r=t.updateOrientation;t.updateOrientation=function(c,u,v){for(var g=r(c,u,v),p=e.representations.length;p--;){var l=e.representations[p],h="XYZ"[c];l.setSlicingMode&&l.setSlicingMode(h)}return t.updateCornerAnnotation({axis:"XYZ"[c]}),g};var n=t.addRepresentation;t.addRepresentation=function(c){n(c),c.setSlicingMode&&(c.setSlicingMode("XYZ"[e.axis]),t.bindRepresentationToManipulator(c))};var a=t.removeRepresentation;t.removeRepresentation=function(c){if(a(c),c===e.sliceRepresentation){t.bindRepresentationToManipulator(null);for(var u=e.representations.length;u--;)t.bindRepresentationToManipulator(e.representations[u])&&(u=0)}};var i=e._resetCamera;e._resetCamera=function(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,u=i(c);if(!e.fitProps||!e.useParallelRendering||!u)return u;var v=[];c?J.getCorners(c,v):t.getRepresentations().forEach(function(L){return[L.getActors(),L.getVolumes()].flat().forEach(function(m){return v.push.apply(v,W(sE(m)))})});var g=J.reset([]),p=e.camera.getViewMatrix();he(p,p);for(var l=0;l<v.length;++l){var h=v[l];Q(h,h,p),J.addPoint.apply(J,[g].concat(W(h)))}var y=J.getCenter(g),C=[y[0],y[1],g[5]+1],S=new Float64Array(16),d=new Float64Array(3),O=new Float64Array(3);at(S,p),Q(d,y,S),Q(O,C,S);var w=e.renderer.getRenderWindow().getViews()[0],M=w.getViewportSize(e.renderer),x=M[0]/M[1],D=J.getLength(g,0),R=J.getLength(g,1),V=.5*Math.max(R,D/x);if(V<=0)return u;var E=J.transformBounds(g,S);return t.setCameraParameters({position:O,focalPoint:d,bounds:E,parallelScale:V}),!0},e.rangeManipulator=Xp.newInstance({button:1,scrollEnabled:!0}),e.interactorStyle2D.addMouseManipulator(e.rangeManipulator);function o(c){t.updateCornerAnnotation({windowWidth:c}),e.sliceRepresentation&&e.sliceRepresentation.setWindowWidth&&e.sliceRepresentation.setWindowWidth(c)}function s(c){t.updateCornerAnnotation({windowLevel:c}),e.sliceRepresentation&&e.sliceRepresentation.setWindowLevel&&e.sliceRepresentation.setWindowLevel(c)}function f(c){var u=Number(c),v=Number.isInteger(u)?c:u.toFixed(2),g={slice:v};if(e.sliceRepresentation&&e.sliceRepresentation.setSlice&&e.sliceRepresentation.setSlice(u),e.sliceRepresentation&&e.sliceRepresentation.getAnnotations){var p=e.sliceRepresentation.getAnnotations();Object.keys(p).forEach(function(l){g[l]=Qp(p[l])})}t.updateCornerAnnotation(g)}t.bindRepresentationToManipulator=function(c){var u=0;for(e.rangeManipulator.removeAllListeners(),e.sliceRepresentation=c;e.sliceRepresentationSubscriptions.length;)e.sliceRepresentationSubscriptions.pop().unsubscribe();if(c){if(e.sliceRepresentationSubscriptions.push(e.camera.onModified(t.updateWidthHeightAnnotation)),c.getWindowWidth){var v=function(){return o(c.getWindowWidth())},g=c.getPropertyDomainByName("windowWidth"),p=g.min,l=g.max,h=g.step;(!h||h==="any")&&(h=1/Ju),e.rangeManipulator.setVerticalListener(p,l,h,c.getWindowWidth,o),e.sliceRepresentationSubscriptions.push(c.onModified(v)),v(),u++}if(c.getWindowLevel){var y=function(){return s(c.getWindowLevel())},C=c.getPropertyDomainByName("windowLevel"),S=C.min,d=C.max,O=C.step;(!O||O==="any")&&(O=1/Ju),e.rangeManipulator.setHorizontalListener(S,d,O,c.getWindowLevel,s),e.sliceRepresentationSubscriptions.push(c.onModified(y)),y(),u++}var w=c.getPropertyDomainByName("slice");if(c.getSlice&&w){var M=function(){return f(c.getSlice())};e.rangeManipulator.setScrollListener(w.min,w.max,w.step,c.getSlice,f),e.sliceRepresentationSubscriptions.push(c.onModified(M)),M(),u++}}return u}}var fE={axis:2,orientation:-1,viewUp:[0,1,0],useParallelRendering:!0,sliceRepresentationSubscriptions:[],fitProps:!1};function Ip(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,fE,r),oE.extend(t,e,r),T.get(t,e,["axis"]),T.setGet(t,e,["fitProps"]),uE(t,e)}var cE=T.newInstance(Ip,"vtkView2DProxy"),dL={newInstance:cE,extend:Ip};function Qu(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function gE(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Qu(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Qu(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function vE(t,e){return t+e}function qt(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return e.reduce(vE,0)/e.length}function Iu(t,e,r,n){var a=e.getRange(),i=t.getSpacing(),o=t.getBounds(),s=t.getExtent(),f,c,u,v,g=r.mapper.getSlicingMode(),p="IJKXYZ"[g];switch(g){case Be.SlicingMode.I:case Be.SlicingMode.J:case Be.SlicingMode.K:v="IJK".indexOf(p),f=s[v*2],c=s[v*2+1],u=1;break;case Be.SlicingMode.X:case Be.SlicingMode.Y:case Be.SlicingMode.Z:{v="XYZ".indexOf(p),f=o[v*2],c=o[v*2+1];var l=r.mapper.getClosestIJKAxis(),h=l.ijkMode;u=i[h]}break}var y={slice:{domain:{min:f,max:c,step:u}},windowWidth:{domain:{min:0,max:a[1]-a[0],step:"any"}},windowLevel:{domain:{min:a[0],max:a[1],step:"any"}}};return n("slice",y.slice),n("windowWidth",y.windowWidth),n("windowLevel",y.windowLevel),{slice:qt(y.slice.domain.min,y.slice.domain.max),windowWidth:y.windowWidth.domain.max,windowLevel:Math.floor(qt(y.windowLevel.domain.min,y.windowLevel.domain.max))}}function pE(t,e){e.classHierarchy.push("vtkSliceRepresentationProxy"),e.mapper=Be.newInstance(),e.actor=Ta.newInstance(),e.property=e.actor.getProperty(),e.actor.setMapper(e.mapper),e.actors.push(e.actor);function r(i){var o=Iu(i,t.getDataArray(),e,t.updateProxyProperty);t.set(o);var s=i.getBounds(),f=i.getExtent();switch(e.mapper.getSlicingMode()){case Be.SlicingMode.I:t.setSlice(Math.floor(qt(f[0],f[1])));break;case Be.SlicingMode.J:t.setSlice(Math.floor(qt(f[2],f[3])));break;case Be.SlicingMode.K:t.setSlice(Math.floor(qt(f[4],f[5])));break;case Be.SlicingMode.X:t.setSlice(qt(s[0],s[1]));break;case Be.SlicingMode.Y:t.setSlice(qt(s[2],s[3]));break;case Be.SlicingMode.Z:t.setSlice(qt(s[4],s[5]));break}}e.sourceDependencies.push(e.mapper),e.sourceDependencies.push({setInputData:r});function n(i){e.mapper.setSlicingMode(Be.SlicingMode[i]);var o="".concat(i.toLowerCase(),"Slice");if(o in e&&e[o]!==void 0&&e.mapper.setSlice(e[o]),e.input){var s=Iu(t.getInputDataSet(),t.getDataArray(),e,t.updateProxyProperty);t.set(s)}t.modified()}t.setSlicingMode=function(i){return i&&e.slicingMode!==i?(e.slicingMode=i,n(i),!0):!1},t.getSliceIndex=function(){return"XYZ".indexOf(e.slicingMode)!==-1?e.mapper.getSliceAtPosition(e.mapper.getSlice()):e.mapper.getSlice()},t.getAnnotations=function(){var i={},o=t.getSliceIndex(),s=e.mapper.getBoundsForSlice(),f=e.mapper.getSlicingModeNormal(),c=e.mapper.getClosestIJKAxis(),u=c.ijkMode,v=[(s[0]+s[1])*.5,(s[2]+s[3])*.5,(s[4]+s[5])*.5],g=0;s[1]-s[0]<Number.EPSILON&&(g=s[0]),s[3]-s[2]<Number.EPSILON&&(g=s[2]),s[5]-s[4]<Number.EPSILON&&(g=s[4]);var p=e.mapper.getInputData();if(p){i.sliceSpacing=p.getSpacing()[u],i.dimensions=p.getDimensions(),i.sliceCount=p.getDimensions()[u];for(var l=[],h=0;h<3;h++){var y=[0,0,0,0,0,0];y[h*2+1]=1;var C=p.extentToBounds(y);C[1]-C[0]>Number.EPSILON&&(l[0]="IJK"[h]),C[3]-C[2]>Number.EPSILON&&(l[1]="IJK"[h]),C[5]-C[4]>Number.EPSILON&&(l[2]="IJK"[h])}i.ijkOrientation=l.join("")}return gE({ijkMode:u,sliceBounds:s,sliceIndex:o,sliceNormal:f,sliceOrigin:v,slicePosition:g},i)};var a=t.setColorBy;t.setColorBy=function(i,o){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;if(i===null)e.property.setRGBTransferFunction(null),e.property.setPiecewiseFunction(null);else{a(i,o,s);var f=t.getLookupTableProxy(i),c=t.getPiecewiseFunctionProxy(i);e.property.setRGBTransferFunction(f.getLookupTable()),e.property.setPiecewiseFunction(c.getPiecewiseFunction())}},n(e.slicingMode||"X")}var lE={};function e0(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,lE,r),Ko.extend(t,e,r),T.get(t,e,["slicingMode"]),pE(t,e),T.proxyPropertyMapping(t,e,{visibility:{modelKey:"actor",property:"visibility"},windowWidth:{modelKey:"property",property:"colorWindow"},windowLevel:{modelKey:"property",property:"colorLevel"},interpolationType:{modelKey:"property",property:"interpolationType"},slice:{modelKey:"mapper",property:"slice"}})}var hE=T.newInstance(e0,"vtkSliceRepresentationProxy"),OL={newInstance:hE,extend:e0},dr={DEFAULT:0,GEOMETRY:1,SLICE:2,VOLUME:3,YZ_PLANE:4,XZ_PLANE:5,XY_PLANE:6},Wa={PICKING_BUFFER:0,FRONT_BUFFER:1},yE={MOUSE_MOVE:0,MOUSE_RELEASE:1},ti={ViewTypes:dr,RenderingTypes:Wa,CaptureOn:yE},so=.5;function TE(t,e){e.classHierarchy.push("vtkAbstractWidget"),e.actorToRepresentationMap=new WeakMap,t.getBounds=e.widgetState.getBounds,t.getNestedProps=function(){return e.representations},t.activateHandle=function(r){var n=r.selectedState,a=r.representation;e.widgetState.activateOnly(n),e.activeState=n,n&&n.updateManipulator&&n.updateManipulator(),t.invokeActivateHandle({selectedState:n,representation:a}),t.updateCursor&&t.updateCursor()},t.deactivateAllHandles=function(){e.widgetState.deactivate()},t.hasActor=function(r){return e.actorToRepresentationMap.has(r)},t.grabFocus=function(){e.hasFocus=!0},t.loseFocus=function(){e.hasFocus=!1},t.hasFocus=function(){return e.hasFocus},t.placeWidget=function(r){return e.widgetState.placeWidget(r)},t.getPlaceFactor=function(){return e.widgetState.getPlaceFactor()},t.setPlaceFactor=function(r){return e.widgetState.setPlaceFactor(r)},t.getRepresentationFromActor=function(r){return e.actorToRepresentationMap.get(r)},t.updateRepresentationForRender=function(){for(var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Wa.FRONT_BUFFER,n=0;n<e.representations.length;n++){var a=e.representations[n];a.updateActorVisibility(r,e.contextVisibility,e.handleVisibility)}},t.getViewWidgets=function(){return e._factory.getViewWidgets()},t.setPriority(so)}var CE={contextVisibility:!0,handleVisibility:!0,hasFocus:!1};function t0(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,CE,r),In.extend(t,e,r),qv.extend(t,e,r),T.setGet(t,e,["contextVisibility","handleVisibility","_widgetManager"]),T.get(t,e,["representations","widgetState","activeState"]),T.moveToProtected(t,e,["widgetManager"]),T.event(t,e,"ActivateHandle"),TE(t,e)}var SE=T.newInstance(t0,"vtkAbstractWidget"),dE={newInstance:SE,extend:t0},Jo=ti.ViewTypes,ef=ti.RenderingTypes,da=ti.CaptureOn,OE=T.vtkErrorMacro,tf=T.vtkWarningMacro,wE=1;function n0(t){var e=t.getActiveCamera(),r=t.getRenderWindow(),n=r.getInteractor(),a=n.getView();return{renderer:t,renderWindow:r,interactor:n,apiSpecificRenderWindow:a,camera:e}}function ni(t,e){var r=e.dispHeightFactor,n=e.cameraPosition,a=e.cameraDir,i=e.isParallel,o=e.rendererPixelDims,s=1;if(i)s=r;else{var f=W(t);Bt.subtract(f,n,f),s=Bt.dot(f,a)*r}var c=o[1];return s/c}function xE(t,e){e.viewId||(e.viewId="view-".concat(wE++)),e.classHierarchy.push("vtkWidgetManager");var r=new WeakMap,n=[];function a(d){for(var O=d.getRepresentations(),w=0;w<O.length;w++)for(var M=O[w],x={widget:d,representation:M},D=M.getActors(),R=0;R<D.length;R++){var V=D[R];r.set(V,x)}}function i(d){return d&&(d.isA("vtkAbstractWidget")?d:d.getWidgetForView({viewId:e.viewId}))}function o(){var d=e._apiSpecificRenderWindow,O=e._camera,w=e._renderer;if(w&&d&&O){var M=d.getSize(),x=ne(M,2),D=x[0],R=x[1],V=w.getViewport(),E=ne(V,4),L=E[0],m=E[1],N=E[2],_=E[3],G=d.getComputedDevicePixelRatio(),k=[D*(N-L)/G,R*(_-m)/G],U=O.getPosition(),B=O.getDirectionOfProjection(),j=O.getParallelProjection(),H=j?2*O.getParallelScale():2*Math.tan(Bt.radiansFromDegrees(O.getViewAngle())/2);e.widgets.forEach(function(X){X.getNestedProps().forEach(function(Y){Y.getScaleInPixels()&&Y.setDisplayScaleParams({dispHeightFactor:H,cameraPosition:U,cameraDir:B,isParallel:j,rendererPixelDims:k})})})}}e._lastPointerEvent={callData:null,fromTouchEvent:!1};function s(d,O,w){return f.apply(this,arguments)}function f(){return f=Et(Ge.mark(function d(O,w,M){var x,D,R,V,E,L,m,N,_,G;return Ge.wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return m=function(j){w&&e._interactor.invokeLeftButtonRelease(O),j.activateHandle({selectedState:V,representation:E}),w&&e._interactor.invokeLeftButtonPress(O)},x=O.position,U.next=4,t.getSelectedDataForXY(x.x,x.y);case 4:if(D=U.sent,R=D.requestCount,V=D.selectedState,E=D.representation,L=D.widget,!(R||M!==e._currentUpdateSelectionCallID)){U.next=11;break}return U.abrupt("return");case 11:if(e._apiSpecificRenderWindow.setCursor(L?"pointer":"default"),e.activeWidget=null,N=!1,e.widgetInFocus===L&&L.hasFocus())m(L),e.activeWidget=L,N=!0;else for(_=0;_<e.widgets.length;_++)G=e.widgets[_],G===L&&G.getNestedPickable()?(m(G),e.activeWidget=G,N=!0):(N||(N=!!G.getActiveState()),G.deactivateAllHandles());N&&e._interactor.render();case 16:case"end":return U.stop()}},d)})),f.apply(this,arguments)}var c=function(){var d=Et(Ge.mark(function O(w){var M,x,D=arguments;return Ge.wrap(function(V){for(;;)switch(V.prev=V.next){case 0:if(M=D.length>1&&D[1]!==void 0?D[1]:!1,!(w&&(e.selectDuringAnimation||!e.isAnimating)&&e.pickingEnabled&&w.pokedRenderer===e._renderer)){V.next=6;break}return x=Symbol("UpdateSelection"),e._currentUpdateSelectionCallID=x,V.next=6,s(w,M,x);case 6:case"end":return V.stop()}},O)}));return function(w){return d.apply(this,arguments)}}();function u(d){d.updateRepresentationForRender(e.renderingType)}function v(){e.renderingType=ef.PICKING_BUFFER,e.widgets.forEach(u)}function g(){e.renderingType=ef.FRONT_BUFFER,e.widgets.forEach(u)}function p(d,O,w,M){return l.apply(this,arguments)}function l(){return l=Et(Ge.mark(function d(O,w,M,x){return Ge.wrap(function(R){for(;;)switch(R.prev=R.next){case 0:if(!e._captureInProgress){R.next=2;break}return R.abrupt("return");case 2:return e._captureInProgress=!0,v(),e._capturedBuffers=null,R.next=7,e._selector.getSourceDataAsync(e._renderer,O,w,M,x);case 7:e._capturedBuffers=R.sent,e.previousSelectedData=null,e._captureInProgress=!1;case 10:case"end":return R.stop()}},d)})),l.apply(this,arguments)}t.enablePicking=function(){e.pickingEnabled=!0,t.renderWidgets()},t.renderWidgets=function(){if(e.pickingEnabled&&e.captureOn===da.MOUSE_RELEASE){var d=e._apiSpecificRenderWindow.getSize(),O=ne(d,2),w=O[0],M=O[1];p(0,0,w,M)}g(),t.modified()},t.disablePicking=function(){e.pickingEnabled=!1},t.setRenderer=function(d){var O=n0(d);for(Object.assign(e,O),T.moveToProtected({},e,Object.keys(O));n.length;)n.pop().unsubscribe();e._selector=e._apiSpecificRenderWindow.createSelector(),e._selector.setFieldAssociation(No.FIELD_ASSOCIATION_POINTS),n.push(e._selector.onEvent(function(w){w.type==="EndEvent"&&g()})),n.push(e._apiSpecificRenderWindow.onWindowResizeEvent(o)),n.push(e._camera.onModified(o)),o(),n.push(e._interactor.onStartAnimation(function(){e.isAnimating=!0})),n.push(e._interactor.onAnimation(function(){var w;e.selectDuringAnimation&&!((w=e.widgetInFocus)!==null&&w!==void 0&&w.hasFocus())&&c(e._lastPointerEvent.callData,e._lastPointerEvent.fromTouchEvent)})),n.push(e._interactor.onEndAnimation(function(){e.isAnimating=!1,t.renderWidgets()})),n.push(e._interactor.onMouseMove(function(w){e._lastPointerEvent.callData=w,e._lastPointerEvent.fromTouchEvent=!1},so+1)),n.push(e._interactor.onMouseMove(function(w){var M=!(e.selectDuringAnimation&&e.isAnimating);return M&&c(w),T.VOID})),n.push(e._interactor.onPointerLeave(function(){e._lastPointerEvent.callData=null,e._lastPointerEvent.fromTouchEvent=!1})),n.push(e._interactor.onLeftButtonPress(function(w){var M=w.deviceType,x=M==="touch"||M==="pen";e._lastPointerEvent.callData=w,e._lastPointerEvent.fromTouchEvent=x;var D=!(e.selectDuringAnimation&&e.isAnimating);return x&&D&&c(w,x),T.VOID},so/2)),t.modified(),e.pickingEnabled&&t.enablePicking()};function h(d){d.setWidgetManager(t),a(d),o(),e._renderer.addActor(d)}t.addWidget=function(d,O,w){if(!e._renderer)return OE("Widget manager MUST BE link to a view before registering widgets"),null;var M=e.viewId,x=e._renderer,D=d.getWidgetForView({viewId:M,renderer:x,viewType:O||Jo.DEFAULT,initialValues:w});return D!=null&&e.widgets.indexOf(D)===-1&&(e.widgets.push(D),h(D),t.modified()),D};function y(d){e._renderer.removeActor(d),d.delete()}function C(){e._renderer.getRenderWindow().getInteractor().render(),t.renderWidgets()}t.removeWidgets=function(){e.widgets.forEach(y),e.widgets=[],e.widgetInFocus=null,C()},t.removeWidget=function(d){var O=i(d),w=e.widgets.indexOf(O);if(w!==-1){e.widgets.splice(w,1);var M=e.widgetInFocus===O;M&&t.releaseFocus(),y(O),C()}},t.getSelectedDataForXY=function(){var d=Et(Ge.mark(function O(w,M){var x;return Ge.wrap(function(R){for(;;)switch(R.prev=R.next){case 0:if(e.selections=null,!e.pickingEnabled){R.next=12;break}if(!(!e._capturedBuffers||e.captureOn===da.MOUSE_MOVE)){R.next=7;break}return R.next=5,p(w,M,w,M);case 5:R.next=11;break;case 7:if(x=e._capturedBuffers.area,!(w<x[0]||w>x[2]||M<x[1]||M>x[3])){R.next=11;break}return R.next=11,p(w,M,w,M);case 11:e.selections=e._capturedBuffers.generateSelection(w,M,w,M);case 12:return R.abrupt("return",t.getSelectedData());case 13:case"end":return R.stop()}},O)}));return function(O,w){return d.apply(this,arguments)}}(),t.updateSelectionFromXY=function(d,O){tf("updateSelectionFromXY is deprecated, please use getSelectedDataForXY"),e.pickingEnabled&&e.captureOn===da.MOUSE_MOVE&&p(d,O,d,O)},t.updateSelectionFromMouseEvent=function(d){tf("updateSelectionFromMouseEvent is deprecated, please use getSelectedDataForXY");var O=d.pageX,w=d.pageY,M=e._apiSpecificRenderWindow.getCanvas().getBoundingClientRect(),x=M.top,D=M.left,R=M.height,V=O-D,E=R-(w-x);t.updateSelectionFromXY(V,E)},t.getSelectedData=function(){if(!e.selections||!e.selections.length)return e.previousSelectedData=null,{};var d=e.selections[0].getProperties(),O=d.propID,w=d.compositeID,M=d.prop,x=e.selections[0].getProperties(),D=x.widget,R=x.representation;if(e.previousSelectedData&&e.previousSelectedData.prop===M&&e.previousSelectedData.widget===D&&e.previousSelectedData.compositeID===w)return e.previousSelectedData.requestCount++,e.previousSelectedData;if(r.has(M)){var V=r.get(M);D=V.widget,R=V.representation}if(D&&R){var E=R.getSelectedState(M,w);return e.previousSelectedData={requestCount:0,propID:O,compositeID:w,prop:M,widget:D,representation:R,selectedState:E},e.previousSelectedData}return e.previousSelectedData=null,{}},t.grabFocus=function(d){var O=i(d);e.widgetInFocus&&e.widgetInFocus!==O&&e.widgetInFocus.loseFocus(),e.widgetInFocus=O,e.widgetInFocus&&e.widgetInFocus.grabFocus()},t.releaseFocus=function(){return t.grabFocus(null)};var S=t.delete;t.delete=function(){for(;n.length;)n.pop().unsubscribe();S()}}var ME={viewId:null,widgets:[],activeWidget:null,renderer:null,viewType:Jo.DEFAULT,isAnimating:!1,pickingEnabled:!0,selections:null,previousSelectedData:null,widgetInFocus:null,captureOn:da.MOUSE_MOVE,selectDuringAnimation:!0};function r0(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ME,r),T.obj(t,e),T.setGet(t,e,["captureOn","selectDuringAnimation",{type:"enum",name:"viewType",enum:Jo}]),T.get(t,e,["selections","widgets","viewId","pickingEnabled","activeWidget"]),xE(t,e)}var DE=T.newInstance(r0,"vtkWidgetManager"),wL={newInstance:DE,extend:r0,Constants:ti,getPixelWorldHeightAtCoord:ni};function nf(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function rf(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?nf(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):nf(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function EE(){}function RE(t,e){e.classHierarchy.push("vtkAbstractWidgetFactory");var r={};t.getWidgetForView=function(a){var i=a.viewId,o=a.renderer,s=a.viewType,f=a.initialValues;if(!r[i]){if(!o)return null;var c=n0(o),u=c.interactor,v=c.apiSpecificRenderWindow,g=c.camera,p={},l={};T.obj(l,p),Object.assign(l,{onWidgetChange:t.onWidgetChange}),Object.assign(p,{widgetState:e.widgetState,manipulator:e.manipulator,viewType:s,renderer:o,camera:g,apiSpecificRenderWindow:v,factory:t}),T.moveToProtected(l,p,["renderer","camera","apiSpecificRenderWindow","factory"]),T.get(l,p,["viewType"]),T.safeArrays(p),dE.extend(l,p,f);var h=f;p.representations=t.getRepresentationsForViewType(s).map(function(C){var S=C.builder,d=C.labels,O=C.initialValues;return S.newInstance(rf(rf({_parentProp:l,labels:d},O),h))}),p.representations.forEach(function(C){C.setInputData(p.widgetState),C.getActors().forEach(function(S){p.actorToRepresentationMap.set(S,C)})}),e.behavior(l,p),["coincidentTopologyParameters"].concat(W(e.methodsToLink||[])).forEach(function(C){var S,d="set".concat(T.capitalize(C)),O="get".concat(T.capitalize(C)),w=(S={},b(S,C,[]),b(S,d,[]),b(S,O,[]),S);p.representations.forEach(function(M){M[C]&&w[C].push(M[C]),M[d]&&w[d].push(M[d]),M[O]&&w[O].push(M[O])}),Object.keys(w).forEach(function(M){var x=w[M];x.length===1?l[M]=x[0]:x.length>1&&(l[M]=T.chain.apply(T,W(x)))})}),l.delete=T.chain(function(){delete r[i]},l.delete),l.setInteractor(u);var y=Object.freeze(l);return r[i]=y,y}return r[i]},t.getViewIds=function(){return Object.keys(r)},t.getViewWidgets=function(){return Object.values(r)},t.setVisibility=function(a){for(var i=Object.keys(r),o=0;o<i.length;o++)r[i[o]].setVisibility(a)},t.setPickable=function(a){for(var i=Object.keys(r),o=0;o<i.length;o++)r[i[o]].setPickable(a)},t.setDragable=function(a){for(var i=Object.keys(r),o=0;o<i.length;o++)r[i[o]].setDragable(a)},t.setContextVisibility=function(a){for(var i=Object.keys(r),o=0;o<i.length;o++)r[i[o]].setContextVisibility(a)},t.setHandleVisibility=function(a){for(var i=Object.keys(r),o=0;o<i.length;o++)r[i[o]].setHandleVisibility(a)},t.placeWidget=function(a){return e.widgetState.placeWidget(a)},t.getPlaceFactor=function(){return e.widgetState.getPlaceFactor()},t.setPlaceFactor=function(a){return e.widgetState.setPlaceFactor(a)};var n=EE;t.delete=T.chain(t.delete,function(){return n()}),e.widgetState&&(n=e.widgetState.onModified(function(){return t.invokeWidgetChange(e.widgetState)}).unsubscribe)}function a0(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,r),T.obj(t,e),T.get(t,e,["widgetState"]),T.event(t,e,"WidgetChange"),RE(t,e)}var VE=T.newInstance(a0,"vtkAbstractWidget"),LE={newInstance:VE,extend:a0};function mE(t,e){e.classHierarchy.push("vtkAbstractManipulator"),t.getOrigin=function(r){return e.userOrigin?e.userOrigin:e.useCameraFocalPoint?r.pokedRenderer.getActiveCamera().getFocalPoint():e.handleOrigin?e.handleOrigin:e.widgetOrigin?e.widgetOrigin:[0,0,0]},t.getNormal=function(r){return e.userNormal?e.userNormal:e.useCameraNormal?r.pokedRenderer.getActiveCamera().getDirectionOfProjection():e.handleNormal?e.handleNormal:e.widgetNormal?e.widgetNormal:[0,0,1]}}var kE={useCameraFocalPoint:!1,useCameraNormal:!1};function i0(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,kE,r),T.obj(t,e),T.setGet(t,e,["useCameraFocalPoint","useCameraNormal"]),T.setGetArray(t,e,["userOrigin","handleOrigin","widgetOrigin","userNormal","handleNormal","widgetNormal"],3),mE(t,e)}var FE=T.newInstance(i0,"vtkAbstractManipulator"),o0={extend:i0,newInstance:FE};function af(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function NE(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?af(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):af(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function s0(t,e,r,n,a,i){var o=i.displayToWorld(t,e,0,a),s=i.displayToWorld(t,e,1,a);return jt.intersectWithLine(o,s,r,n).x}function UE(t,e){e.classHierarchy.push("vtkPlaneManipulator"),t.handleEvent=function(r,n){return s0(r.position.x,r.position.y,t.getOrigin(r),t.getNormal(r),r.pokedRenderer,n)}}function GE(t){return NE({},t)}function u0(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};o0.extend(t,e,GE(r)),UE(t,e)}var BE=T.newInstance(u0,"vtkPlaneManipulator"),of={intersectDisplayWithPlane:s0,extend:u0,newInstance:BE},f0={DISPLAY:0,NORMALIZED_DISPLAY:1,VIEWPORT:2,NORMALIZED_VIEWPORT:3,PROJECTION:4,VIEW:5,WORLD:6},c0={Coordinate:f0};function sf(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function _E(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?sf(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):sf(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var se=c0.Coordinate,ca=T.vtkErrorMacro;function jE(t,e){e.classHierarchy.push("vtkCoordinate"),t.setValue=function(){if(e.deleted)return ca("instance deleted - cannot call any method"),!1;for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];var i=n;if(i.length===1&&Array.isArray(i[0])&&(i=i[0]),i.length===2)return t.setValue(i[0],i[1],0),!0;if(i.length!==3)throw new RangeError("Invalid number of values for array setter");var o=!1;return e.value.forEach(function(s,f){if(s!==i[f]){if(o)return;o=!0}}),o&&(e.value=[].concat(i),t.modified()),!0},t.setCoordinateSystemToDisplay=function(){t.setCoordinateSystem(se.DISPLAY)},t.setCoordinateSystemToNormalizedDisplay=function(){t.setCoordinateSystem(se.NORMALIZED_DISPLAY)},t.setCoordinateSystemToViewport=function(){t.setCoordinateSystem(se.VIEWPORT)},t.setCoordinateSystemToNormalizedViewport=function(){t.setCoordinateSystem(se.NORMALIZED_VIEWPORT)},t.setCoordinateSystemToProjection=function(){t.setCoordinateSystem(se.PROJECTION)},t.setCoordinateSystemToView=function(){t.setCoordinateSystem(se.VIEW)},t.setCoordinateSystemToWorld=function(){t.setCoordinateSystem(se.WORLD)},t.getCoordinateSystemAsString=function(){return T.enumToString(se,e.coordinateSystem)},t.getComputedWorldValue=function(r){var n=e.computedWorldValue;if(e.computing)return n;e.computing=1,n[0]=e.value[0],n[1]=e.value[1],n[2]=e.value[2];var a=r;if(e.renderer&&(a=e.renderer),!a){if(e.coordinateSystem===se.WORLD){if(e.referenceCoordinate){var i=e.referenceCoordinate.getComputedWorldValue(a);n[0]+=i[0],n[1]+=i[1],n[2]+=i[2]}e.computing=0}else ca("Attempt to compute world coordinates from another coordinate system without a renderer");return n}var o=null;if(a&&a.getRenderWindow().getViews())o=a.getRenderWindow().getViews()[0];else return e.computedWorldValue;var s=o.getViewportSize(a),f=s[0]/s[1];if(e.referenceCoordinate&&e.coordinateSystem!==se.WORLD){var c=e.referenceCoordinate.getComputedDoubleDisplayValue(a),u=[c[0],c[1],0];switch(e.coordinateSystem){case se.NORMALIZED_DISPLAY:u=o.displayToNormalizedDisplay(u[0],u[1],u[2]);break;case se.VIEWPORT:u=o.displayToNormalizedDisplay(u[0],u[1],u[2]),u=o.normalizedDisplayToViewport(u[0],u[1],u[2],a);break;case se.NORMALIZED_VIEWPORT:u=o.displayToNormalizedDisplay(u[0],u[1],u[2]),u=o.normalizedDisplayToViewport(u[0],u[1],u[2],a),u=o.viewportToNormalizedViewport(u[0],u[1],u[2],a);break;case se.PROJECTION:u=o.displayToNormalizedDisplay(u[0],u[1],u[2]),u=o.normalizedDisplayToViewport(u[0],u[1],u[2],a),u=o.viewportToNormalizedViewport(u[0],u[1],u[2],a),u=a.normalizedViewportToProjection(u[0],u[1],u[2]);break;case se.VIEW:u=o.displayToNormalizedDisplay(u[0],u[1],u[2]),u=o.normalizedDisplayToViewport(u[0],u[1],u[2],a),u=o.viewportToNormalizedViewport(u[0],u[1],u[2],a),u=a.normalizedViewportToProjection(u[0],u[1],u[2]),u=a.projectionToView(u[0],u[1],u[2],f);break}n[0]+=u[0],n[1]+=u[1],n[2]+=u[2]}switch(e.coordinateSystem){case se.DISPLAY:n=o.displayToNormalizedDisplay(n[0],n[1],n[2]),n=o.normalizedDisplayToViewport(n[0],n[1],n[2],a),n=o.viewportToNormalizedViewport(n[0],n[1],n[2],a),n=a.normalizedViewportToProjection(n[0],n[1],n[2]),n=a.projectionToView(n[0],n[1],n[2],f),n=a.viewToWorld(n[0],n[1],n[2]);break;case se.NORMALIZED_DISPLAY:n=o.normalizedDisplayToViewport(n[0],n[1],n[2],a),n=o.viewportToNormalizedViewport(n[0],n[1],n[2],a),n=a.normalizedViewportToProjection(n[0],n[1],n[2]),n=a.projectionToView(n[0],n[1],n[2],f),n=a.viewToWorld(n[0],n[1],n[2]);break;case se.VIEWPORT:n=o.viewportToNormalizedViewport(n[0],n[1],n[2],a),n=a.normalizedViewportToProjection(n[0],n[1],n[2]),n=a.projectionToView(n[0],n[1],n[2],f),n=a.viewToWorld(n[0],n[1],n[2]);break;case se.NORMALIZED_VIEWPORT:n=a.normalizedViewportToProjection(n[0],n[1],n[2]),n=a.projectionToView(n[0],n[1],n[2],f),n=a.viewToWorld(n[0],n[1],n[2]);break;case se.PROJECTION:n=a.projectionToView(n[0],n[1],n[2],f),n=a.viewToWorld(n[0],n[1],n[2]);break;case se.VIEW:n=a.viewToWorld(n[0],n[1],n[2]);break}if(e.referenceCoordinate&&e.coordinateSystem===se.WORLD){var v=t.getComputedWorldValue(a);n[0]+=v[0],n[1]+=v[1],n[2]+=v[2]}return e.computing=0,e.computedWorldValue=n.slice(0),n},t.getComputedViewportValue=function(r){var n=t.getComputedDoubleViewportValue(r);return[Gt(n[0]),Gt(n[1])]},t.getComputedDisplayValue=function(r){var n=t.getComputedDoubleDisplayValue(r);return[Nr(n[0]),Nr(n[1])]},t.getComputedLocalDisplayValue=function(r){var n=r;e.renderer&&(n=e.renderer);var a=t.getComputedDisplayValue(n);if(!n)return ca("Attempt to convert to local display coordinates without a renderer"),a;var i=null;if(n&&n.getRenderWindow().getViews())i=n.getRenderWindow().getViews()[0];else return a;return a=i.displayToLocalDisplay(a[0],a[1],a[2]),[Gt(a[0]),Gt(a[1])]},t.getComputedDoubleViewportValue=function(r){var n=r;e.renderer&&(n=e.renderer);var a=t.getComputedDoubleDisplayValue(n);if(!n)return a;var i=null;if(n&&n.getRenderWindow().getViews())i=n.getRenderWindow().getViews()[0];else return a;return a=i.displayToNormalizedDisplay(a[0],a[1],a[2]),a=i.normalizedDisplayToViewport(a[0],a[1],a[2],n),[a[0],a[1]]},t.getComputedDoubleDisplayValue=function(r){if(e.computing)return e.computedDoubleDisplayValue;e.computing=1;var n=e.value.slice(0),a=r;if(e.renderer&&(a=e.renderer),!a){if(e.coordinateSystem===se.DISPLAY){if(e.computedDoubleDisplayValue[0]=n[0],e.computedDoubleDisplayValue[1]=n[1],e.referenceCoordinate){var i=e.referenceCoordinate.getComputedDoubleDisplayValue();e.computedDoubleDisplayValue[0]+=i[0],e.computedDoubleDisplayValue[1]+=i[1]}}else e.computedDoubleDisplayValue[0]=Number.MAX_VALUE,e.computedDoubleDisplayValue[1]=Number.MAX_VALUE,ca("Request for coordinate transformation without required viewport");return e.computedDoubleDisplayValue}var o=null;if(a&&a.getRenderWindow().getViews())o=a.getRenderWindow().getViews()[0];else return n;var s=o.getViewportSize(a),f=s[0]/s[1];switch(e.coordinateSystem){case se.WORLD:{if(e.referenceCoordinate){var c=e.referenceCoordinate.getComputedWorldValue(a);n[0]+=c[0],n[1]+=c[1],n[2]+=c[2]}n=a.worldToView(n[0],n[1],n[2]),n=a.viewToProjection(n[0],n[1],n[2],f),n=a.projectionToNormalizedViewport(n[0],n[1],n[2]),n=o.normalizedViewportToViewport(n[0],n[1],n[2],a),n=o.viewportToNormalizedDisplay(n[0],n[1],n[2],a),n=o.normalizedDisplayToDisplay(n[0],n[1],n[2]);break}case se.VIEW:{n=a.viewToProjection(n[0],n[1],n[2],f),n=a.projectionToNormalizedViewport(n[0],n[1],n[2]),n=o.normalizedViewportToViewport(n[0],n[1],n[2],a),n=o.viewportToNormalizedDisplay(n[0],n[1],n[2],a),n=o.normalizedDisplayToDisplay(n[0],n[1],n[2]);break}case se.PROJECTION:{n=a.projectionToNormalizedViewport(n[0],n[1],n[2]),n=o.normalizedViewportToViewport(n[0],n[1],n[2],a),n=o.viewportToNormalizedDisplay(n[0],n[1],n[2],a),n=o.normalizedDisplayToDisplay(n[0],n[1],n[2]);break}case se.NORMALIZED_VIEWPORT:{if(n=o.normalizedViewportToViewport(n[0],n[1],n[2],a),e.referenceCoordinate){var u=e.referenceCoordinate.getComputedDoubleViewportValue(a);n[0]+=u[0],n[1]+=u[1]}n=o.viewportToNormalizedDisplay(n[0],n[1],n[2],a),n=o.normalizedDisplayToDisplay(n[0],n[1],n[2]);break}case se.VIEWPORT:{if(e.referenceCoordinate){var v=e.referenceCoordinate.getComputedDoubleViewportValue(a);n[0]+=v[0],n[1]+=v[1]}n=o.viewportToNormalizedDisplay(n[0],n[1],n[2],a),n=o.normalizedDisplayToDisplay(n[0],n[1],n[2]);break}case se.NORMALIZED_DISPLAY:n=o.normalizedDisplayToDisplay(n[0],n[1],n[2]);break;case se.USERDEFINED:n=e.value.slice(0);break}if(e.referenceCoordinate&&(e.coordinateSystem===se.DISPLAY||e.coordinateSystem===se.NORMALIZED_DISPLAY)){var g=e.referenceCoordinate.getComputedDoubleDisplayValue(a);n[0]+=g[0],n[1]+=g[1]}return e.computedDoubleDisplayValue[0]=n[0],e.computedDoubleDisplayValue[1]=n[1],e.computing=0,e.computedDoubleDisplayValue},t.getComputedValue=function(r){var n=r;switch(e.renderer&&(n=e.renderer),e.coordinateSystem){case se.WORLD:return t.getComputedWorldValue(n);case se.VIEW:case se.NORMALIZED_VIEWPORT:case se.VIEWPORT:{var a=t.getComputedViewportValue(n);e.computedWorldValue[0]=a[0],e.computedWorldValue[1]=a[1];break}case se.NORMALIZED_DISPLAY:case se.DISPLAY:{var i=e.getComputedDisplayValue(n);e.computedWorldValue[0]=i[0],e.computedWorldValue[1]=i[1];break}}return e.computedWorldValue}}var WE={coordinateSystem:se.WORLD,value:[0,0,0],renderer:null,referenceCoordinate:null,computing:0,computedWorldValue:[0,0,0],computedDoubleDisplayValue:[0,0]};function g0(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,WE,r),T.obj(t,e),T.set(t,e,["property"]),T.get(t,e,["value"]),T.setGet(t,e,["coordinateSystem","referenceCoordinate","renderer"]),T.getArray(t,e,["value"],3),jE(t,e)}var $E=T.newInstance(g0,"vtkCoordinate"),uf=_E({newInstance:$E,extend:g0},c0);function ff(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function zE(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?ff(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ff(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var uo=mg.DisplayLocation;function bE(t,e){e.classHierarchy.push("vtkProperty2D"),t.setDisplayLocationToBackground=function(){return t.setDisplayLocation(uo.BACKGROUND)},t.setDisplayLocationToForeground=function(){return t.setDisplayLocation(uo.FOREGROUND)},t.setRepresentationToWireframe=function(){return t.setRepresentation(Je.WIREFRAME)},t.setRepresentationToSurface=function(){return t.setRepresentation(Je.SURFACE)},t.setRepresentationToPoints=function(){return t.setRepresentation(Je.POINTS)},t.getRepresentationAsString=function(){return T.enumToString(Je,e.representation)}}var HE={color:[1,1,1],opacity:1,pointSize:1,lineWidth:1,representation:Je.SURFACE,displayLocation:uo.FOREGROUND};function v0(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,HE,r),T.obj(t,e),T.setGet(t,e,["opacity","lineWidth","pointSize","displayLocation","representation"]),T.setGetArray(t,e,["color"],3),bE(t,e)}var KE=T.newInstance(v0,"vtkProperty2D"),PE=zE({newInstance:KE,extend:v0},mg);function XE(t,e){e.classHierarchy.push("vtkActor2D"),t.getActors2D=function(){return t},t.getIsOpaque=function(){e.property||t.getProperty();var r=e.property.getOpacity()>=1;return r=r&&(!e.texture||!e.texture.isTranslucent()),r},t.hasTranslucentPolygonalGeometry=function(){return e.mapper===null?!1:(e.property===null&&t.setProperty(t.makeProperty()),!t.getIsOpaque())},t.makeProperty=PE.newInstance,t.getProperty=function(){return e.property===null&&(e.property=t.makeProperty()),e.property},t.setDisplayPosition=function(r,n){e.positionCoordinate.setCoordinateSystem(f0.DISPLAY),e.positionCoordinate.setValue(r,n,0)},t.setWidth=function(r){var n=e.position2Coordinate.getValue();e.position2Coordinate.setCoordinateSystemToNormalizedViewport(),e.position2Coordinate.setValue(r,n[1])},t.setHeight=function(r){var n=e.position2Coordinate.getValue();e.position2Coordinate.setCoordinateSystemToNormalizedViewport(),e.position2Coordinate.setValue(n[0],r)},t.getWidth=function(){return e.position2Coordinate.getValue()[0]},t.getHeight=function(){return e.position2Coordinate.getValue()[1]},t.getMTime=function(){var r=e.mtime;if(e.property!==null){var n=e.property.getMTime();r=n>r?n:r}return r=e.positionCoordinate.getMTime()>r?e.positionCoordinate.getMTime():r,r=e.positionCoordinate2.getMTime()>r?e.positionCoordinate2.getMTime():r,r},t.getRedrawMTime=function(){var r=e.mtime;if(e.mapper!==null){var n=e.mapper.getMTime();r=n>r?n:r,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),n=e.mapper.getInput().getMTime(),r=n>r?n:r)}return r},t.getBounds=function(){return typeof t.getMapper().getBounds=="function"?(e.useBounds=!0,t.getMapper().getBounds()):(e.useBounds=!1,[])},t.getActualPositionCoordinate=function(){return e.positionCoordinate},t.getActualPositionCoordinate2=function(){return e.positionCoordinate2}}var YE={mapper:null,property:null,layerNumber:0,positionCoordinate:null,positionCoordinate2:null};function p0(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,YE,r),In.extend(t,e,r),e.positionCoordinate=uf.newInstance(),e.positionCoordinate.setCoordinateSystemToViewport(),e.positionCoordinate2=uf.newInstance(),e.positionCoordinate2.setCoordinateSystemToNormalizedViewport(),e.positionCoordinate2.setValue(.5,.5),e.positionCoordinate2.setReferenceCoordinate(e.positionCoordinate),T.set(t,e,["property"]),T.setGet(t,e,["mapper"]),XE(t,e)}var AE=T.newInstance(p0,"vtkActor2D"),xL={newInstance:AE,extend:p0},Mn={HANDLE:0,CONTEXT:1};function cf(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function ZE(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?cf(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):cf(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var qE=T.vtkErrorMacro,JE=T.vtkWarningMacro,QE=["active","inactive","static"];function gf(t,e){t&&t.setResolveCoincidentTopologyToPolygonOffset&&(t.setResolveCoincidentTopologyToPolygonOffset(),Qa.forEach(function(r){if(e[r]){var n="setRelativeCoincidentTopology".concat(r,"OffsetParameters");if(t[n]){var a=e[r],i=a.factor,o=a.offset;t[n](i,o)}}}))}function IE(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];var a={active:{},inactive:{},static:{}};return QE.forEach(function(i){var o=a[i];t.forEach(function(s){o[s]||(o[s]={}),r.filter(function(f){return f&&f[i]&&f[i][s]}).forEach(function(f){return Object.assign(o[s],f[i][s])})})}),a}function eR(t,e,r){r?Object.keys(t).forEach(function(n){var a=t[n].actor===r?e.active[n]:e.inactive[n];a&&t[n].actor.getProperty().set(a)}):(Object.keys(e.static).forEach(function(n){t[n]&&t[n].actor.getProperty().set(e.static[n])}),Object.keys(e.inactive).forEach(function(n){t[n]&&t[n].actor.getProperty().set(e.inactive[n])}))}function tR(t){var e=t.source;t.filter&&(e.isA("vtkDataSet")?t.filter.setInputData(e):t.filter.setInputConnection(e.getOutputPort()),e=t.filter),e&&(e.isA("vtkDataSet")?t.mapper.setInputData(e):t.mapper.setInputConnection(e.getOutputPort())),t.glyph&&t.mapper.setInputConnection(t.glyph.getOutputPort(),1),t.actor.setMapper(t.mapper)}function nn(t,e,r,n,a){var i,o=((i=t["get".concat(T.capitalize(e))])===null||i===void 0?void 0:i.call(t))||t.getPointData().getArrayByName(e);if(!o||n!==void 0&&o.getDataType()!==n||a!==void 0&&o.getNumberOfComponents()!==a){var s=ie,f=n,c=a;if(e==="points"){var u;s=Pn,f=(u=f)!==null&&u!==void 0?u:"Float32Array",c=a??3}else if(Er.includes(e)){var v;s=Fa,f=(v=f)!==null&&v!==void 0?v:"Uint16Array",c=a??1}else{var g;f=(g=f)!==null&&g!==void 0?g:"Float32Array",c=a??1}o=s.newInstance({name:e,dataType:f,numberOfComponents:c,size:c*r,empty:r===0}),e==="points"||Er.includes(e)?t["set".concat(T.capitalize(e))](o):t.getPointData().addArray(o)}else o.getNumberOfTuples()!==r&&o.resize(r);return o}function nR(t,e){e.classHierarchy.push("vtkWidgetRepresentation");var r={mtimes:{},states:[]};e._onCoincidentTopologyParametersChanged=function(){t.getActors().forEach(function(n){gf(n.getMapper(),e.coincidentTopologyParameters)})},t.getActors=function(){return e.actors},t.getNestedProps=t.getActors,t.setLabels=function(){for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];a.length===1?e.labels=[].concat(a[0]):e.labels=a,t.modified()},t.getRepresentationStates=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.inputData[0];return r.mtimes.representation===t.getMTime()&&r.mtimes.input===n.getMTime()||(r.mtimes.representation=t.getMTime(),r.mtimes.input=n.getMTime(),r.states=[],e.labels.forEach(function(a){r.states=r.states.concat(n.getStatesWithLabel(a)||[])})),r.states},t.getSelectedState=function(n,a){var i=t.getRepresentationStates();return a<i.length?i[a]:(qE("Representation ".concat(t.getClassName()," should implement getSelectedState(prop, compositeID) method.")),null)},t.updateActorVisibility=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Wa.FRONT_BUFFER,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,o=!0;switch(e.behavior){case Mn.HANDLE:o=n===Wa.PICKING_BUFFER||i;break;case Mn.CONTEXT:o=a;break;default:o=!0;break}for(var s=o,f=0;f<e.actors.length;f++)e.visibilityFlagArray?e.actors[f].setVisibility(s&&e.visibilityFlagArray[f]):e.actors[f].setVisibility(s);if(e.alwaysVisibleActors)for(var c=0;c<e.alwaysVisibleActors.length;c++)e.alwaysVisibleActors[c].setVisibility(!0)},e.actors.push=function(){JE("You should use publicAPI.addActor() to initialize the actor properly");for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];a.forEach(function(o){return t.addActor(o)})},t.addActor=function(n){gf(n.getMapper(),e.coincidentTopologyParameters),Array.prototype.push.apply(e.actors,[n])},t.setLabels(e.labels)}function rR(t){return ZE({activeScaleFactor:1.2,activeColor:1,useActiveColor:!0,actors:[],labels:[],behavior:Mn.CONTEXT,coincidentTopologyParameters:{Point:{factor:-1,offset:-1},Line:{factor:-1,offset:-1},Polygon:{factor:-1,offset:-1}},scaleInPixels:!1,displayScaleParams:{dispHeightFactor:1,cameraPosition:[0,0,0],cameraDir:[1,0,0],isParallel:!1,rendererPixelDims:[1,1]},_internalArrays:{}},t)}function aR(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};In.extend(t,e,rR(r)),T.algo(t,e,1,1),T.get(t,e,["labels","displayScaleParams","coincidentTopologyParameters"]),T.set(t,e,[{type:"object",name:"displayScaleParams"},{type:"object",name:"coincidentTopologyParameters"}]),T.setGet(t,e,["scaleInPixels","activeScaleFactor","activeColor","useActiveColor"]),nR(t,e)}var Qo={extend:aR,mergeStyles:IE,applyStyles:eR,connectPipeline:tR};function vf(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function pf(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?vf(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):vf(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function iR(t,e){e.classHierarchy.push("vtkContextRepresentation")}var oR={behavior:Mn.CONTEXT,pickable:!1,dragable:!0};function sR(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=pf(pf({},oR),r);Qo.extend(t,e,n),iR(t,e)}var l0={extend:sR},mi="default";function lf(t,e){var r=t.indexOf(e);r!==-1&&t.splice(r,1)}function uR(t,e){e.classHierarchy.push("vtkWidgetState");var r=[];e.labels={},e.nestedStates=[],t.bindState=function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[mi];if(e.nestedStates.push(n),r.push(n.onModified(t.modified)),Array.isArray(a)&&a.length)for(var i=0;i<a.length;i++){var o=a[i];e.labels[o]||(e.labels[o]=[]),e.labels[o].push(n)}else{var s=Array.isArray(a)?mi:a||mi;e.labels[s]||(e.labels[s]=[]),e.labels[s].push(n)}},t.unbindState=function(n){for(;r.length;)r.pop().unsubscribe();lf(e.nestedStates,n);for(var a=0;a<e.nestedStates.length;a++)r.push(e.nestedStates[a].onModified(t.modified));Object.keys(e.labels).forEach(function(i){var o=e.labels[i];lf(o,n)})},t.unbindAll=function(){for(;r.length;)r.pop().unsubscribe();e.nestedStates=[]},t.activate=function(){return t.setActive(!0)},t.deactivate=function(n){n!==t&&t.setActive(!1);for(var a=0;a<e.nestedStates.length;a++)e.nestedStates[a].deactivate(n)},t.activateOnly=function(n){n&&n.setActive(!0),t.deactivate(n)},t.getStatesWithLabel=function(n){return e.labels[n]},t.getAllNestedStates=function(){return e.nestedStates},t.delete=T.chain(t.unbindAll,t.delete)}var fR={active:!1};function cR(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,fR,r),T.obj(t,e),T.setGet(t,e,["active"]),uR(t,e)}var h0={extend:cR};function gR(t,e){var r=[],n=W(J.INIT_BOUNDS);t.containsPoint=function(a,i,o){return Array.isArray(a)?J.containsPoint(n,a[0],a[1],a[2]):J.containsPoint(n,a,i,o)},t.placeWidget=function(a){e.bounds=[];for(var i=[(a[0]+a[1])/2,(a[2]+a[3])/2,(a[4]+a[5])/2],o=0;o<6;o++){var s=i[Math.floor(o/2)];r[o]=a[o],e.bounds[o]=(a[o]-s)*e.placeFactor+s}J.setBounds(n,e.bounds),t.invokeBoundsChange(e.bounds),t.modified()},t.setPlaceFactor=function(a){if(e.placeFactor!==a){e.placeFactor=a,e.bounds=[];for(var i=[(r[0]+r[1])/2,(r[2]+r[3])/2,(r[4]+r[5])/2],o=0;o<6;o++){var s=i[Math.floor(o/2)];e.bounds[o]=(r[o]-s)*e.placeFactor+s}J.setBounds(n,e.bounds),t.invokeBoundsChange(e.bounds),t.modified()}}}var vR={bounds:[-1,1,-1,1,-1,1],placeFactor:1};function pR(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,vR,r),T.setGetArray(t,e,["bounds"],6),T.get(t,e,["placeFactor"]),T.event(t,e,"BoundsChange"),e.bounds=e.bounds.slice(),gR(t,e)}var y0={extend:pR},lR={color:.5};function hR(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,lR,r),T.setGet(t,e,["color"])}var yR={extend:hR},TR={color3:[255,255,255],opacity:255};function CR(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,TR,r),T.setGetArray(t,e,["color3"],3,255),T.setGet(t,e,["opacity"])}var SR={extend:CR};function dR(t,e){t.translate=function(r,n,a){var i=t.getCornerByReference(),o=ne(i,3),s=o[0],f=o[1],c=o[2];t.setCorner(s+r,f+n,c+a)}}var OR={corner:[0,0,0]};function wR(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,OR,r),T.setGetArray(t,e,["corner"],3),dR(t)}var xR={extend:wR};function MR(t,e){var r=e.angleUnit==="degree"?qe.buildFromDegree():qe.buildFromRadian();t.rotateFromDirections=function(n,a){r.identity().rotateFromDirections(n,a).apply(e.direction),t.modified()},t.rotate=function(n,a){r.identity().rotate(n,a).apply(e.direction)},t.rotateX=function(n){r.identity().rotateX(n).apply(e.direction)},t.rotateY=function(n){r.identity().rotateY(n).apply(e.direction)},t.rotateZ=function(n){r.identity().rotateZ(n).apply(e.direction)}}var DR={direction:[1,0,0]};function ER(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,DR,r),T.setGetArray(t,e,["direction"],3),MR(t,e)}var RR={extend:ER};function VR(t,e){t.updateManipulator=function(){if(e.manipulator){var r=e.origin,n=e.normal,a=e.direction,i=e.manipulator,o=i.setHandleOrigin,s=i.setHandleCenter,f=i.setHandleNormal,c=i.setHandleDirection;r&&o?o(r):r&&s&&s(r),a&&c?c(a):a&&!n&&f?f(a):n&&c&&c(n)}}}var LR={manipulator:null};function mR(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,LR,r),T.setGet(t,e,["manipulator"]),VR(t,e)}var kR={extend:mR},FR={name:""};function NR(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,FR,r),T.setGet(t,e,["name"])}var UR={extend:NR};function ki(t,e){return t.length===3&&e.length===3&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function GR(t,e,r,n){return ki(t,n.o)&&ki(e,n.p1)&&ki(r,n.p2)}function BR(t,e){var r={o:[],p1:[],p2:[]};t.normalize=function(){Fe(e.up),Fe(e.right),Fe(e.direction),t.modified()},t.updateFromOriginRightUp=function(n,a,i){GR(n,a,i,r)||(r.o=n.slice(),r.p1=a.slice(),r.p2=i.slice(),e.up=[i[0]-n[0],i[1]-n[1],i[2]-n[2]],e.right=[a[0]-n[0],a[1]-n[1],a[2]-n[2]],me(e.up,e.right,e.direction),me(e.direction,e.up,e.right),t.normalize(),t.modified())}}var _R={up:[0,1,0],right:[1,0,0],direction:[0,0,1]};function jR(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,_R,r),T.setGetArray(t,e,["up","right","direction"],3),BR(t,e)}var WR={extend:jR};function hf(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function $R(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?hf(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):hf(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function zR(t,e){var r=$R({},t);t.translate=function(n,a,i){var o=t.getOriginByReference(),s=ne(o,3),f=s[0],c=s[1],u=s[2];t.setOrigin(f+n,c+a,u+i)},t.getOrigin=function(n){var a=r.getOrigin();if(!e.offset)return a;if(!n)return Bt.add(a,e.offset,a);var i=ni(a,n),o=n.rendererPixelDims,s=Math.min(o[0],o[1]);return Bt.multiplyAccumulate(a,e.offset,s*i,a)}}var bR={origin:null,offset:null};function HR(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,bR,r),T.setGetArray(t,e,["origin","offset"],3),zR(t,e)}var KR={extend:HR},PR={scale1:.5};function XR(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,PR,r),T.setGet(t,e,["scale1"])}var YR={extend:XR},AR={scale3:[1,1,1]};function ZR(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,AR,r),T.setGetArray(t,e,["scale3"],3)}var qR={extend:ZR},JR={text:"DefaultText"};function QR(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,JR,r),T.setGet(t,e,["text"])}var IR={extend:QR},eV={visible:!0};function tV(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,eV,r),T.setGet(t,e,["visible"]),t.isVisible=t.getVisible}var nV={extend:tV},rV={shape:""};function aV(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rV,r),T.setGet(t,e,["shape"])}var iV={extend:aV};function yf(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function Tf(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?yf(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):yf(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var oV=T.vtkErrorMacro,sV={bounds:y0,color:yR,color3:SR,corner:xR,direction:RR,manipulator:kR,name:UR,orientation:WR,origin:KR,scale1:YR,scale3:qR,text:IR,visible:nV,shape:iV};function Fi(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;a||h0.extend(r,n,e);for(var i=0;i<t.length;i++){var o=sV[t[i]];o?o.extend(r,n,e):oV("Invalid mixin name:",t[i])}return T.safeArrays(n),Object.freeze(r)}var uV=function(){function t(){An(this,t),this.publicAPI={},this.model={},h0.extend(this.publicAPI,this.model),y0.extend(this.publicAPI,this.model)}return Zn(t,[{key:"addDynamicMixinState",value:function(r){var n=this,a=r.labels,i=r.mixins,o=r.name,s=r.initialValues,f="".concat(o,"List");return this.model[f]=[],this.publicAPI["add".concat(T.capitalize(o))]=function(c){var u=Fi(i,Tf(Tf({},s),c));return n.publicAPI.bindState(u,a),n.model[f].push(u),n.publicAPI.modified(),u},this.publicAPI["remove".concat(T.capitalize(o))]=function(c){var u=n.model[f].indexOf(c);u===-1&&c<n.model[f].length&&(u=c);var v=n.model[f][u];v&&n.publicAPI.unbindState(v),n.model[f].splice(u,1),n.publicAPI.modified()},this.publicAPI["get".concat(T.capitalize(o),"List")]=function(){return n.model[f].slice()},this.publicAPI["clear".concat(T.capitalize(o),"List")]=function(){for(;n.model[f].length;){var c=n.model[f].pop();c&&n.publicAPI.unbindState(c)}n.publicAPI.modified()},this}},{key:"addStateFromMixin",value:function(r){var n=r.labels,a=r.mixins,i=r.name,o=r.initialValues,s=Fi(a,o);return this.model[i]=s,this.publicAPI.bindState(s,n),T.setGet(this.publicAPI,this.model,[i]),this}},{key:"addStateFromInstance",value:function(r){var n=r.labels,a=r.name,i=r.instance;return this.model[a]=i,this.publicAPI.bindState(i,n),T.setGet(this.publicAPI,this.model,[a]),this}},{key:"addField",value:function(r){var n=r.name,a=r.initialValue;return Array.isArray(a)?T.setGetArray(this.publicAPI,this.model,[n],a.length):T.setGet(this.publicAPI,this.model,[n]),this.model[n]=a,this}},{key:"build",value:function(){for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return Fi(n,{},this.publicAPI,this.model,!0)}}]),t}();function fV(){return new uV}var Cf={createBuilder:fV},T0={DIRECTION:0,ROTATION:1,MATRIX:2},cV={SCALE_BY_CONSTANT:0,SCALE_BY_MAGNITUDE:1,SCALE_BY_COMPONENTS:2},Io={OrientationModes:T0,ScaleModes:cV};function Sf(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function gV(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Sf(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Sf(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var At=Io.OrientationModes,Ft=Io.ScaleModes,vV=T.vtkErrorMacro;function pV(t,e){e.classHierarchy.push("vtkGlyph3DMapper"),t.getOrientationModeAsString=function(){return T.enumToString(At,e.orientationMode)},t.setOrientationModeToDirection=function(){return t.setOrientationMode(At.DIRECTION)},t.setOrientationModeToRotation=function(){return t.setOrientationMode(At.ROTATION)},t.setOrientationModeToMatrix=function(){return t.setOrientationMode(At.MATRIX)},t.getOrientationArrayData=function(){var r=t.getInputData(0);return!r||!r.getPointData()?null:e.orientationArray?r.getPointData().getArray(e.orientationArray):r.getPointData().getVectors()},t.getScaleModeAsString=function(){return T.enumToString(Ft,e.scaleMode)},t.setScaleModeToScaleByMagnitude=function(){return t.setScaleMode(Ft.SCALE_BY_MAGNITUDE)},t.setScaleModeToScaleByComponents=function(){return t.setScaleMode(Ft.SCALE_BY_COMPONENTS)},t.setScaleModeToScaleByConstant=function(){return t.setScaleMode(Ft.SCALE_BY_CONSTANT)},t.getScaleArrayData=function(){var r=t.getInputData(0);return!r||!r.getPointData()?null:e.scaleArray?r.getPointData().getArray(e.scaleArray):r.getPointData().getScalars()},t.getBounds=function(){var r=t.getInputData(0),n=t.getInputData(1);return!r||!n?xn():(t.buildArrays(),e.bounds)},t.buildArrays=function(){var r=t.getInputData(0),n=t.getInputData(1);if(e.buildTime.getMTime()<n.getMTime()||e.buildTime.getMTime()<r.getMTime()||e.buildTime.getMTime()<t.getMTime()){var a=r.getPoints().getData(),i=t.getScaleArrayData(),o=null,s=0;i&&(o=i.getData(),s=i.getNumberOfComponents()),e.scaling&&i&&e.scaleMode===Ft.SCALE_BY_COMPONENTS&&i.getNumberOfComponents()!==3&&(vV("Cannot scale by components since scale array does not have 3 components."),i=null);var f=n.getBounds(),c=[];J.getCorners(f,c),e.bounds[0]=J.INIT_BOUNDS[0],e.bounds[1]=J.INIT_BOUNDS[1],e.bounds[2]=J.INIT_BOUNDS[2],e.bounds[3]=J.INIT_BOUNDS[3],e.bounds[4]=J.INIT_BOUNDS[4],e.bounds[5]=J.INIT_BOUNDS[5];var u=new Float64Array(3),v=t.getOrientationArrayData(),g=I(new Float64Array(16)),p=[],l=[],h=a.length/3;e.matrixArray=new Float32Array(16*h);var y=e.matrixArray.buffer;e.normalArray=new Float32Array(9*h);for(var C=e.normalArray.buffer,S=[],d=0;d<h;++d){var O=new Float32Array(y,d*64,16);if(p[0]=a[d*3],p[1]=a[d*3+1],p[2]=a[d*3+2],we(O,g,p),v){var w=[];switch(v.getTuple(d,w),e.orientationMode){case At.MATRIX:{var M=[].concat(W(w.slice(0,3)),[0],W(w.slice(3,6)),[0],W(w.slice(6,9)),[0,0,0,0,1]);Ee(O,O,M);break}case At.ROTATION:go(O,O,w[2]),co(O,O,w[0]),Oa(O,O,w[1]);break;case At.DIRECTION:if(w[1]===0&&w[2]===0)w[0]<0&&Oa(O,O,3.1415926);else{var x=rt(w),D=[];D[0]=(w[0]+x)/2,D[1]=w[1]/2,D[2]=w[2]/2,We(O,O,3.1415926,D)}break}}if(e.scaling){if(l[0]=e.scaleFactor,l[1]=e.scaleFactor,l[2]=e.scaleFactor,i)switch(e.scaleMode){case Ft.SCALE_BY_MAGNITUDE:for(var R=0;R<s;++R)S[R]=o[d*s+R];l[0]*=rt(S,s),l[1]=l[0],l[2]=l[0];break;case Ft.SCALE_BY_COMPONENTS:for(var V=0;V<s;++V)S[V]=o[d*s+V];l[0]*=S[0],l[1]*=S[1],l[2]*=S[2];break;case Ft.SCALE_BY_CONSTANT:}l[0]===0&&(l[0]=1e-10),l[1]===0&&(l[1]=1e-10),l[2]===0&&(l[2]=1e-10),Kn(O,O,l)}for(var E=0;E<8;++E)Q(u,c[E],O),u[0]<e.bounds[0]&&(e.bounds[0]=u[0]),u[1]<e.bounds[2]&&(e.bounds[2]=u[1]),u[2]<e.bounds[4]&&(e.bounds[4]=u[2]),u[0]>e.bounds[1]&&(e.bounds[1]=u[0]),u[1]>e.bounds[3]&&(e.bounds[3]=u[1]),u[2]>e.bounds[5]&&(e.bounds[5]=u[2]);var L=new Float32Array(C,d*36,9);za(L,O),ba(L,L),mf(L,L)}var m=t.getAbstractScalars(r,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName).scalars;e.useLookupTableScalarRange||t.getLookupTable().setRange(e.scalarRange[0],e.scalarRange[1]),e.colorArray=null;var N=t.getLookupTable();N&&m&&(N.build(),e.colorArray=N.mapScalars(m,e.colorMode,0)),e.buildTime.modified()}},t.getPrimitiveCount=function(){var r=t.getInputData(1),n=t.getInputData().getPoints().getNumberOfValues()/3,a={points:n*r.getPoints().getNumberOfValues()/3,verts:n*(r.getVerts().getNumberOfValues()-r.getVerts().getNumberOfCells()),lines:n*(r.getLines().getNumberOfValues()-2*r.getLines().getNumberOfCells()),triangles:n*(r.getPolys().getNumberOfValues()-3*r.getLines().getNumberOfCells())};return a}}var lV={orient:!0,orientationMode:At.DIRECTION,orientationArray:null,scaling:!0,scaleFactor:1,scaleMode:Ft.SCALE_BY_MAGNITUDE,scaleArray:null,matrixArray:null,normalArray:null,colorArray:null};function C0(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,lV,r),Ye.extend(t,e,r),T.algo(t,e,2,0),e.buildTime={},T.obj(e.buildTime,{mtime:0}),e.boundsTime={},T.obj(e.boundsTime,{mtime:0}),T.setGet(t,e,["orient","orientationMode","orientationArray","scaleArray","scaleFactor","scaleMode","scaling"]),T.get(t,e,["colorArray","matrixArray","normalArray","buildTime"]),pV(t,e)}var hV=T.newInstance(C0,"vtkGlyph3DMapper"),S0=gV({newInstance:hV,extend:C0},Io);function df(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function Of(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?df(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):df(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function yV(t,e){e.classHierarchy.push("vtkHandleRepresentation")}var TV={behavior:Mn.HANDLE,pickable:!0,dragable:!0,scaleInPixels:!0};function CV(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=Of(Of({},TV),r);Qo.extend(t,e,n),yV(t,e)}var SV={extend:CV};function wf(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function Or(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?wf(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):wf(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function d0(t,e){return function(r,n){for(var a=nn(r,"points",n.length).getData(),i=0,o=0;o<n.length;++o){var s=n[o].getOrigin(e.scaleInPixels&&e.displayScaleParams);a[i++]=s[0],a[i++]=s[1],a[i++]=s[2]}}}function dV(t,e){return function(r,n){nn(r,"points",0)}}function OV(t,e){return function(r,n){e._pipeline.mapper.setColorByArrayName("color");for(var a=nn(r,"color",n.length,"Uint8Array",4),i=a.getData(),o=0,s=0;s<n.length;++s){var f=n[s].getColor3();n[s].getActive()&&e.useActiveColor&&(f=e.activeColor),i[o++]=f[0],i[o++]=f[1],i[o++]=f[2],i[o++]=n[s].getOpacity()}a.dataChange()}}function wV(t,e){return function(r,n){e._pipeline.mapper.setColorByArrayName("color");for(var a=nn(r,"color",n.length).getData(),i=0;i<n.length;++i){var o=n[i].getColor();n[i].getActive()&&e.useActiveColor&&(o=e.activeColor),a[i]=o}}}function xV(t,e){return function(r,n){e._pipeline.mapper.setColorByArrayName(null)}}function MV(t,e){return function(r,n){e._pipeline.mapper.setScaleArray("scale"),e._pipeline.mapper.setScaleFactor(1),e._pipeline.mapper.setScaling(!0),e._pipeline.mapper.setScaleMode(S0.ScaleModes.SCALE_BY_COMPONENTS);for(var a=nn(r,"scale",n.length,"Float32Array",3).getData(),i=0,o=0;o<n.length;++o){var s,f,c=n[o],u=c.getActive()?e.activeScaleFactor:1;t.getScaleInPixels()&&(u*=ni(c.getOrigin(),e.displayScaleParams));var v=(s=(f=c.getScale3)===null||f===void 0?void 0:f.call(c))!==null&&s!==void 0?s:e.defaultScale;a[i++]=u*v[0],a[i++]=u*v[1],a[i++]=u*v[2]}}}function DV(t,e){return function(r,n){e._pipeline.mapper.setScaleArray("scale"),e._pipeline.mapper.setScaleFactor(1),e._pipeline.mapper.setScaling(!0);for(var a=nn(r,"scale",n.length).getData(),i=0;i<n.length;++i){var o,s,f=n[i],c=f.getActive()?e.activeScaleFactor:1;t.getScaleInPixels()&&(c*=ni(f.getOrigin(),e.displayScaleParams));var u=(o=(s=f.getScale1)===null||s===void 0?void 0:s.call(f))!==null&&o!==void 0?o:e.defaultScale;a[i]=c*u}}}function EV(t,e){return function(r,n){e._pipeline.mapper.setScaleArray(null),e._pipeline.mapper.setScaleFactor(e.defaultScale),e._pipeline.mapper.setScaling(e.defaultScale!==1)}}function RV(t,e){return function(r,n){e._pipeline.mapper.setOrientationArray("orientation"),e._pipeline.mapper.setOrientationMode(T0.MATRIX);for(var a=nn(r,"orientation",n.length,"Float32Array",9).getData(),i=0;i<n.length;++i){var o=n[i],s=o.getRight?o.getRight():[1,0,0],f=o.getUp?o.getUp():[0,1,0],c=o.getDirection?o.getDirection():[0,0,1];a.set(s,9*i),a.set(f,9*i+3),a.set(c,9*i+6)}}}function VV(t,e){return function(r,n){e._pipeline.mapper.setOrientationArray(null)}}function LV(t,e){e.classHierarchy.push("vtkGlyphRepresentation");var r=Or({},t),n=vt.newInstance({mtime:0});function a(i){for(var o=arguments.length,s=new Array(o>1?o-1:0),f=1;f<o;f++)s[f-1]=arguments[f];return s.every(function(c){var u,v;return((u=i[0])===null||u===void 0||(v=u["get".concat(T.capitalize(c))])===null||v===void 0?void 0:v.call(u))!=null})}t.getRepresentationStates=function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.inputData[0];return r.getRepresentationStates(i).filter(function(o){var s,f,c;return((s=o.getOrigin)===null||s===void 0?void 0:s.call(o))&&((f=(c=o.isVisible)===null||c===void 0?void 0:c.call(o))!==null&&f!==void 0?f:!0)})},t.getMixins=function(i){var o={};return a(i,"origin")?o.position=e.applyMixin.origin:o.position=e.applyMixin.noPosition,a(i,"color3")?o.color=e.applyMixin.color3:a(i,"color")?o.color=e.applyMixin.color:o.color=e.applyMixin.noColor,a(i,"scale3")?o.scale=e.applyMixin.scale3:a(i,"scale1")?o.scale=e.applyMixin.scale1:o.scale=e.applyMixin.noScale,a(i,"direction")?o.orientation=e.applyMixin.direction:o.orientation=e.applyMixin.noOrientation,o},t.requestData=function(i,o){var s=t.getRepresentationStates(i[0]);o[0]=n;var f=t.getMixins(s);Object.values(f).forEach(function(c){return c(n,s)}),n.getPoints().modified(),n.modified()},Qo.connectPipeline(e._pipeline),t.addActor(e._pipeline.actor)}function xf(t,e,r){var n,a,i,o,s,f,c,u,v,g,p,l,h,y,C,S,d,O,w,M,x,D,R,V,E,L,m,N;return Or(Or({defaultScale:1},r),{},{_pipeline:Or({source:(n=(a=r._pipeline)===null||a===void 0?void 0:a.source)!==null&&n!==void 0?n:t,glyph:(i=(o=r._pipeline)===null||o===void 0?void 0:o.glyph)!==null&&i!==void 0?i:kp.newInstance({phiResolution:8,thetaResolution:8}),mapper:(s=(f=r._pipeline)===null||f===void 0?void 0:f.mapper)!==null&&s!==void 0?s:S0.newInstance({scalarMode:cg.USE_POINT_FIELD_DATA}),actor:(c=(u=r._pipeline)===null||u===void 0?void 0:u.actor)!==null&&c!==void 0?c:En.newInstance({parentProp:t})},r._pipeline),applyMixin:Or({origin:(v=(g=r.applyMixin)===null||g===void 0?void 0:g.origin)!==null&&v!==void 0?v:d0(t,e),noPosition:(p=(l=r.applyMixin)===null||l===void 0?void 0:l.noPosition)!==null&&p!==void 0?p:dV(),color3:(h=(y=r.applyMixin)===null||y===void 0?void 0:y.color3)!==null&&h!==void 0?h:OV(t,e),color:(C=(S=r.applyMixin)===null||S===void 0?void 0:S.color)!==null&&C!==void 0?C:wV(t,e),noColor:(d=(O=r.applyMixin)===null||O===void 0?void 0:O.noColor)!==null&&d!==void 0?d:xV(t,e),scale3:(w=(M=r.applyMixin)===null||M===void 0?void 0:M.scale3)!==null&&w!==void 0?w:MV(t,e),scale1:(x=(D=r.applyMixin)===null||D===void 0?void 0:D.scale1)!==null&&x!==void 0?x:DV(t,e),noScale:(R=(V=r.applyMixin)===null||V===void 0?void 0:V.noScale)!==null&&R!==void 0?R:EV(t,e),direction:(E=(L=r.applyMixin)===null||L===void 0?void 0:L.direction)!==null&&E!==void 0?E:RV(t,e),noOrientation:(m=(N=r.applyMixin)===null||N===void 0?void 0:N.noOrientation)!==null&&m!==void 0?m:VV(t,e)},r.applyMixin)})}function O0(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};r.behavior===Mn.CONTEXT?l0.extend(t,e,xf(t,e,r)):SV.extend(t,e,xf(t,e,r)),T.setGet(t,e._pipeline,["defaultScale"]),T.get(t,e._pipeline,["glyph","mapper","actor"]),T.setGet(t,e.applyMixin,Object.keys(e.applyMixin)),LV(t,e)}var mV=T.newInstance(O0,"vtkGlyphRepresentation"),w0={newInstance:mV,extend:O0};function kV(t,e){e.classHierarchy.push("vtkPixelSpaceCallbackMapper"),e.callback||(e.callback=function(){}),t.invokeCallback=function(r,n,a,i,o){if(e.callback){var s=n.getCompositeProjectionMatrix(a,-1,1);he(s,s);for(var f=r.getPoints(),c=new Float64Array(3),u=i.usize,v=i.vsize,g=u/2,p=v/2,l=[],h=0;h<f.getNumberOfPoints();h+=1){var y=f.getPoint(h);Q(c,y,s);var C=[c[0]*g+g,c[1]*p+p,c[2],0];if(o){var S=Math.floor(C[1])*u+Math.floor(C[0]),d=S*4,O=o[d]/255,w=o[d+1]/255,M=(O*256+w)/257;C[3]=M*2-1}l.push(C)}e.callback(l,n,a,o,[u,v])}}}var FV={callback:null,useZValues:!1};function x0(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,FV,r),Ye.extend(t,e,r),T.setGet(t,e,["callback","useZValues"]),kV(t,e)}var NV=T.newInstance(x0,"vtkPixelSpaceCallbackMapper"),UV={newInstance:NV,extend:x0};function GV(t,e){e.classHierarchy.push("vtkSphereHandleRepresentation"),e.displayMapper=UV.newInstance(),e.displayActor=En.newInstance({parentProp:t}),e.displayActor.setMapper(e.displayMapper),e.displayMapper.setInputConnection(t.getOutputPort()),t.addActor(e.displayActor),e.alwaysVisibleActors=[e.displayActor],t.getGlyphResolution=function(){return e._pipeline.glyph.getPhiResolution()},t.setGlyphResolution=function(n){return e._pipeline.glyph.setPhiResolution(n)||e._pipeline.glyph.setThetaResolution(n)};function r(n){if(e.displayCallback){for(var a=[],i=t.getRepresentationStates(),o=0;o<i.length;o++)i[o].getActive()&&a.push(n[o]);if(a.length){e.displayCallback(a);return}}e.displayCallback()}t.setDisplayCallback=function(n){e.displayCallback=n,e.displayMapper.setCallback(n?r:null)}}function M0(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};w0.extend(t,e,r),GV(t,e)}var BV=T.newInstance(M0,"vtkSphereHandleRepresentation"),_V={newInstance:BV,extend:M0};function Mf(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function jV(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Mf(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Mf(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function WV(t,e){e.classHierarchy.push("vtkCircleSource");function r(n,a){var i,o;if(!e.deleted){var s=a[0],f=T.newTypedArray(e.pointType,e.resolution*3),c=new Uint32Array(e.resolution+2);c[0]=e.resolution+1;for(var u=2*Math.PI/e.resolution,v=0;v<e.resolution;v++){var g=e.center[0],p=e.radius*Math.cos(v*u)+e.center[1],l=e.radius*Math.sin(v*u)+e.center[2];f.set([g,p,l],v*3),c[v+1]=v}c[c.length-1]=c[1],s=vt.newInstance(),s.getPoints().setData(f,3),e.lines&&s.getLines().setData(c,1),e.face&&s.getPolys().setData(c,1),(i=(o=qe.buildFromRadian()).translate.apply(o,W(e.center)).rotateFromDirections([1,0,0],e.direction)).translate.apply(i,W(dt(W(e.center),-1))).apply(f),a[0]=s}}t.requestData=r}function $V(t){return jV({face:!0,center:[0,0,0],lines:!1,direction:[1,0,0],pointType:"Float64Array",radius:1,resolution:6},t)}function D0(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$V(r)),T.obj(t,e),T.setGet(t,e,["radius","resolution","lines","face"]),T.setGetArray(t,e,["center","direction"],3),T.algo(t,e,0,1),WV(t,e)}var zV=T.newInstance(D0,"vtkCircleSource"),bV={newInstance:zV,extend:D0};function Df(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function Ni(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Df(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Df(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function HV(t,e){e.classHierarchy.push("vtkCircleContextRepresentation"),e._pipeline.actor.getProperty().setOpacity(.2),e._pipeline.mapper.setResolveCoincidentTopology(!0),e._pipeline.mapper.setRelativeCoincidentTopologyPolygonOffsetParameters(-1,-1),t.setGlyphResolution=T.chain(t.setGlyphResolution,e._pipeline.glyph.setResolution),t.setDrawBorder=T.chain(t.setDrawBorder,function(r){return e._pipeline.glyph.setLines(r)}),t.setDrawFace=T.chain(t.setDrawFace,function(r){return e._pipeline.glyph.setFace(r)}),t.setOpacity=function(r){e._pipeline.actor.getProperty().setOpacity(r)}}function KV(t){var e,r,n,a,i;return Ni(Ni({behavior:Mn.CONTEXT,glyphResolution:32,drawBorder:!1,drawFace:!0},t),{},{_pipeline:Ni({glyph:(e=t==null||(r=t.pipeline)===null||r===void 0?void 0:r.glyph)!==null&&e!==void 0?e:bV.newInstance({resolution:(n=t.glyphResolution)!==null&&n!==void 0?n:32,radius:1,lines:(a=t.drawBorder)!==null&&a!==void 0?a:!1,face:(i=t.drawFace)!==null&&i!==void 0?i:!0,direction:[0,0,1]})},t==null?void 0:t.pipeline)})}function E0(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};w0.extend(t,e,KV(r)),T.setGet(t,e,["glyphResolution","drawFace","drawBorder"]),T.get(t,e._pipeline,["glyph","mapper","actor"]),HV(t,e)}var PV=T.newInstance(E0,"vtkCircleContextRepresentation"),ML={newInstance:PV,extend:E0},XV=function(){function t(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;An(this,t),this.oriented=e,this.edgeMap=new Map}return Zn(t,[{key:"initialize",value:function(){this.edgeMap.clear()}},{key:"computeEdgeKey",value:function(r,n){return this.oriented||r<n?.5*(r*n)*(r*n+1)+n:.5*(n*r)*(n*r+1)+r}},{key:"insertUniqueEdge",value:function(r,n,a){var i=this.computeEdgeKey(r,n),o=this.edgeMap.get(i);return o||(o={key:i,edgeId:this.edgeMap.size,value:a},this.edgeMap.set(i,o)),o}},{key:"insertEdge",value:function(r,n,a){var i=this.computeEdgeKey(r,n),o={key:i,edgeId:this.edgeMap.size,value:a};return this.edgeMap.set(i,o),o}},{key:"isInsertedEdge",value:function(r,n){var a=this.computeEdgeKey(r,n);return this.edgeMap.get(a)}}],[{key:"getEdgePointIds",value:function(r){var n=.5*(-1+Math.sqrt(8*r.key+1)),a=r.key-.5*(n+1)*n,i=n-a;return[a,i]}}]),t}();function YV(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return new XV(t.oriented)}var DL={newInstance:YV},AV=[[-1,-1,-1,-1,-1],[0,3,-1,-1,-1],[1,0,-1,-1,-1],[1,3,-1,-1,-1],[2,1,-1,-1,-1],[0,3,2,1,-1],[2,0,-1,-1,-1],[2,3,-1,-1,-1],[3,2,-1,-1,-1],[0,2,-1,-1,-1],[1,0,3,2,-1],[1,2,-1,-1,-1],[3,1,-1,-1,-1],[0,1,-1,-1,-1],[3,0,-1,-1,-1],[-1,-1,-1,-1,-1]],ZV=[[0,1],[1,3],[2,3],[0,2]];function qV(t){return AV[t]}function JV(t){return ZV[t]}var EL={getCase:qV,getEdge:JV};function Ef(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function QV(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Ef(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ef(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function R0(t,e,r,n,a,i){var o=i.displayToWorld(t,e,0,a),s=i.displayToWorld(t,e,1,a),f=[0,0,0];tt(s,o,f);var c=[0,0,0];me(n,f,c),me(c,f,c);var u=A([o[0]-r[0],o[1]-r[1],o[2]-r[2]],c),v=A(c,n),g=n.slice();return dt(g,u/v),wn(r,g,g),g}function IV(t,e){e.classHierarchy.push("vtkLineManipulator"),t.handleEvent=function(r,n){return R0(r.position.x,r.position.y,t.getOrigin(r),t.getNormal(r),r.pokedRenderer,n)}}function eL(t){return QV({},t)}function V0(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};o0.extend(t,e,eL(r)),IV(t,e)}var tL=T.newInstance(V0,"vtkLineManipulator"),nL={projectDisplayToLine:R0,extend:V0,newInstance:tL},rL=T.vtkErrorMacro,Rf=[2,0,1,2,0,2,2,0,4,2,1,3,2,1,5,2,2,3,2,2,6,2,3,7,2,4,5,2,4,6,2,5,7,2,6,7];function aL(t,e){var r;e.classHierarchy.push("vtkCroppingOutlineRepresentation"),e.internalPolyData=vt.newInstance({mtime:0}),nn(e.internalPolyData,"lines",Rf.length).getData().set(Rf);var n=d0(t,e);e.mapper=Ye.newInstance({scalarVisibility:!1}),e.actor=En.newInstance({parentProp:t}),(r=e.actor.getProperty()).setEdgeColor.apply(r,W(e.edgeColor)),e.mapper.setInputConnection(t.getOutputPort()),e.actor.setMapper(e.mapper),t.addActor(e.actor),t.requestData=function(a,i){var o=t.getRepresentationStates(a[0]).filter(function(s){return s.getOrigin&&s.getOrigin()});o.length===8?(n(e.internalPolyData,o),e.internalPolyData.getPoints().modified(),e.internalPolyData.modified(),i[0]=e.internalPolyData):rL("CroppingOutlineRepresentation did not get 8 states")}}var iL={edgeColor:[1,1,1]};function L0(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,iL,r),l0.extend(t,e,r),T.setGetArray(t,e,["edgeColor"],3),T.get(t,e,["mapper","actor"]),aL(t,e)}var oL=T.newInstance(L0,"vtkCroppingOutlineRepresentation"),sL={newInstance:oL,extend:L0},bn=["-","=","+"];function fo(t,e){var r=new Float64Array(3);return Q(r,t,e),r}function Vf(t,e){var r=sl(),n=Hn();return Ff(n,e),ul(r,t,n),r}function m0(t){var e=t.split("").map(function(o){return bn.indexOf(o)-1}),r=ne(e,3),n=r[0],a=r[1],i=r[2];return n*a*i!==0?"corners":n*a!==0||a*i!==0||i*n!==0?"edges":"faces"}function uL(t,e){e._isDragging=!1,t.setDisplayCallback=function(r){return e.representations[0].setDisplayCallback(r)},t.handleLeftButtonPress=function(){return!e.activeState||!e.activeState.getActive()||!e.pickable?T.VOID:(e.dragable&&(e._isDragging=!0,e._apiSpecificRenderWindow.setCursor("grabbing"),e._interactor.requestAnimation(t)),T.EVENT_ABORT)},t.handleMouseMove=function(r){return e._isDragging?t.handleEvent(r):T.VOID},t.handleLeftButtonRelease=function(){return!e.activeState||!e.activeState.getActive()||!e.pickable?T.VOID:(e._isDragging&&(e._isDragging=!1,e._interactor.cancelAnimation(t),e.widgetState.deactivate()),T.EVENT_ABORT)},t.handleEvent=function(r){if(e.pickable&&e.activeState&&e.activeState.getActive()){var n=e.activeState.getManipulator();if(n){var a=e.activeState.getName(),i=m0(a),o=a.split("").map(function(S){return bn.indexOf(S)}),s=e.widgetState.getCroppingPlanes().getPlanes(),f=e.widgetState.getIndexToWorldT(),c=[];if(i==="corners"&&(c=n.handleEvent(r,e._apiSpecificRenderWindow)),i==="faces"){var u=[1-o[0],1-o[1],1-o[2]],v=[(s[0]+s[1])/2,(s[2]+s[3])/2,(s[4]+s[5])/2];n.setHandleOrigin(fo(v,f)),n.setHandleNormal(Vf(u,f)),c=n.handleEvent(r,e._apiSpecificRenderWindow)}if(i==="edges"){var g=o.map(function(S){return S===1?S:0});n.setHandleNormal(Vf(g,f)),c=n.handleEvent(r,e._apiSpecificRenderWindow)}if(c.length){for(var p,l,h=e.widgetState.getWorldToIndexT(),y=fo(c,h),C=0;C<3;C++)o[C]===0?s[C*2]=y[C]:o[C]===2&&(s[C*2+1]=y[C]);return(p=e.activeState).setOrigin.apply(p,W(c)),(l=e.widgetState.getCroppingPlanes()).setPlanes.apply(l,W(s)),T.EVENT_ABORT}}}return T.VOID},e._camera=e._renderer.getActiveCamera(),e.classHierarchy.push("vtkImageCroppingWidgetProp")}function fL(){var t=Cf.createBuilder();t.addField({name:"indexToWorldT",initialValue:Array(16).fill(0)}).addField({name:"worldToIndexT",initialValue:Array(16).fill(0)});var e=Cf.createBuilder().addField({name:"planes",initialValue:[0,1,0,1,0,1]}).build();t.addStateFromInstance({labels:["croppingPlanes"],name:"croppingPlanes",instance:e});for(var r=-1;r<2;r++)for(var n=-1;n<2;n++)for(var a=-1;a<2;a++)if(r!==0||n!==0||a!==0){var i=bn[r+1]+bn[n+1]+bn[a+1],o=m0(i);t.addStateFromMixin({labels:["handles",i,o],mixins:["name","origin","color","scale1","visible","manipulator"],name:i,initialValues:{scale1:30,origin:[r,n,a],visible:!0,name:i}})}return t.build()}function Lf(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function k0(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Lf(Object(r),!0).forEach(function(n){b(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Lf(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function cL(t,e){e.classHierarchy.push("vtkImageCroppingWidget");var r=k0({},t),n=null;function a(i,o){e.widgetState.getStatesWithLabel(i).forEach(function(s){s.setVisible(o)})}t.setFaceHandlesEnabled=function(i){return a("faces",i)},t.setEdgeHandlesEnabled=function(i){return a("edges",i)},t.setCornerHandlesEnabled=function(i){return a("corners",i)},t.copyImageDataDescription=function(i){var o,s;(o=e.widgetState).setIndexToWorldT.apply(o,W(i.getIndexToWorld())),(s=e.widgetState).setWorldToIndexT.apply(s,W(i.getWorldToIndex()));var f=i.getDimensions(),c=e.widgetState.getCroppingPlanes();c.setPlanes([0,f[0],0,f[1],0,f[2]]),t.modified()},t.updateHandles=function(){for(var i=e.widgetState.getCroppingPlanes().getPlanes(),o=[(i[0]+i[1])/2,(i[2]+i[3])/2,(i[4]+i[5])/2],s=[i[0],o[0],i[1]],f=[i[2],o[1],i[3]],c=[i[4],o[2],i[5]],u=e.widgetState.getIndexToWorldT(),v=function(w){return bn[w]},g=0;g<3;g++)for(var p=0;p<3;p++)for(var l=0;l<3;l++)if(g!==1||p!==1||l!==1){var h=[g,p,l].map(v).join(""),y=fo([s[g],f[p],c[l]],u),C=e.widgetState.getStatesWithLabel(h),S=ne(C,1),d=S[0];d.setOrigin.apply(d,W(y))}},t.delete=T.chain(t.delete,function(){n&&n.unsubscribe()}),e.methodsToLink=["scaleInPixels"],t.getRepresentationsForViewType=function(i){switch(i){case dr.DEFAULT:case dr.GEOMETRY:case dr.SLICE:case dr.VOLUME:default:return[{builder:_V,labels:["handles"]},{builder:sL,labels:["corners"]}]}},n=e.widgetState.getCroppingPlanes().onModified(t.updateHandles),t.setCornerManipulator=function(i){r.setCornerManipulator(i),e.widgetState.getStatesWithLabel("corners").forEach(function(o){return o.setManipulator(i)})},t.setEdgeManipulator=function(i){r.setEdgeManipulator(i),e.widgetState.getStatesWithLabel("edges").forEach(function(o){return o.setManipulator(i)})},t.setFaceManipulator=function(i){r.setFaceManipulator(i),e.widgetState.getStatesWithLabel("faces").forEach(function(o){return o.setManipulator(i)})},t.setCornerManipulator(of.newInstance({useCameraNormal:!0})),t.setEdgeManipulator(of.newInstance()),t.setFaceManipulator(nL.newInstance())}var gL=function(e){return k0({behavior:uL,widgetState:fL()},e)};function F0(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,gL(r)),LE.extend(t,e,r),T.setGet(t,e,["cornerManipulator","edgeManipulator","faceManipulator"]),cL(t,e)}var vL=T.newInstance(F0,"vtkImageCroppingWidget"),RL={newInstance:vL,extend:F0};export{ML as $,jt as A,s0 as B,f0 as C,Lg as D,dO as E,et as F,Xp as G,jD as H,Ag as I,PD as J,h0 as K,nV as L,YR as M,y0 as N,_V as O,Ye as P,En as Q,Je as R,Wa as S,DL as T,EL as U,dr as V,zi as W,qR as X,WR as Y,KR as Z,Kc as _,hL as a,wL as a0,yE as a1,RL as a2,yn as a3,Be as a4,lL as a5,oE as b,dL as c,OL as d,Cv as e,Ga as f,yL as g,Ci as h,TL as i,CL as j,SL as k,l0 as l,T as m,vt as n,GT as o,uf as p,xL as q,Qo as r,Cf as s,LE as t,of as u,ct as v,fO as w,Ur as x,ie as y,J as z};
//# sourceMappingURL=vtk.js-bd03a6e8.js.map
