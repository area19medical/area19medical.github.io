import{aw as X,aK as I,b0 as Y,b1 as O,b2 as ii,b3 as Ro,b4 as Ye,b5 as ya,b6 as wa,b7 as Sa,b8 as si,af as ai,A as pe,b9 as te,ba as _a,bb as Ca,aN as ba,az as B,as as F,bc as Ta,aL as D,bd as h,be as U,bf as H,aU as nt,bg as An,bh as N,bi as ot,bj as ue,bk as oe,bl as ie,bm as R,aO as se,bn as Re,aD as v,bo as Qe,bp as C,bq as ri,ak as Le,a6 as pt,ao as x,br as Tt,bs as li,bt as Ia,bu as xa,bv as Ra,bw as Da,bx as Ea,an as je,aI as La,aB as j,u as at,by as Ot,H as ci,bz as Ae,bA as mt,E as Pa,n as Oa,Y as Va,I as ka,B as Ma,aj as Do,bB as Ce,aE as Gt,aq as ae,aQ as ne,aC as Fn,aA as It,bC as z,ap as fe,bD as ee,bE as lt,bF as Wn,bG as Fe,aH as Pe,aF as Ba,K as zn,ay as jn,bH as ui,aY as Bt,bI as di,bJ as Aa,bK as Fa,bL as Na,bM as hi,bN as $a,V as Ua,bO as Ha,bP as Wa,bQ as za,bR as ja,aG as Ga,bS as Xa,aZ as qa,bT as Ka,aS as De,bU as Ya,aM as Qa,aT as gi,bV as fi,bW as Za,bX as Ja,bY as er,bZ as tr,b_ as nr,b$ as or,c0 as ir}from"./vendor-1cfc01b0.js";import{_ as A,E as Gn,V as vt,a as pi,b as ft,c as cn,d as Vt,e as Eo,f as Nn,g as mi,h as vi,i as Xt,u as yi,j as yt,k as Lo,l as sr,m as ar,n as rr,o as lr,p as wi,q as Si,r as ht,s as Po,T as gn,t as At,v as Je,w as xe,x as cr,y as ur,z as dr,A as Pn,B as hr,C as gr}from"./vuetify-ca35aafb.js";import{v as fr,a as _i,m as _,b as pr,c as mr,d as vr,I as yr,e as wr,f as Sr,g as _r,h as Ee,i as Cr,j as br,k as Tr,l as Ir,n as et,o as xr,p as Rr,C as Dr,q as Er,D as Lr,R as Pr,r as Xn,s as Ci,t as fn,u as Ge,w as un,x as bi,y as Ti,z as Or,A as Vr,V as Ze,B as kr,E as pn,_ as Mr,F as Ii,G as xi,H as Br,J as Ar,K as mn,L as Ri,M as Fr,N as Di,O as Nr,P as qt,Q as Ei,S as Oo,T as $r,U as Vo,W as ko,X as Ur,Y as Hr,Z as Wr,$ as zr,a0 as jr,a1 as Gr,a2 as Xr,a3 as qr,a4 as Li,a5 as Kr}from"./vtk.js-2d3e2a46.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();const Yr=X({name:"App",components:{}});function Qr(e,t,n,s,o,i){const a=O("router-view");return I(),Y(a)}const Zr=A(Yr,[["render",Qr]]);function Jr(e){const t=e.split(/\/+/g);return t.splice(-1,1),t.join("/")}function el(e){return e.split(/\/+/g).at(-1)??e}function wt(e){return e.replace(/\/+/g,"/").replace(/\/$/,"")}function St(...e){return wt(e.join("/"))}function $n(e){return e.replace(/\//g,"_")}function Mo(e){return new File([e],$n(e.name))}class Pi{constructor(){this.webWorker=null,this.initializeCheck=null}async runTask(t,n,s,o){return ii(this.webWorker,t,n,o,s,St("/","/itk/pipelines"),St("/","/itk/pipeline.worker.js"))}async initialize(){return this.initializeCheck||(this.initializeCheck=new Promise((t,n)=>{this.runTask("dicom",[],[],[]).then(s=>{s.webWorker?this.webWorker=s.webWorker:n(new Error("Could not initialize webworker"))}).then(async()=>{try{await Ro(this.webWorker,new File([],""),null)}catch{}t()}).catch(n)})),this.initializeCheck}async categorizeFiles(t){await this.initialize();const n=await Promise.all(t.map(async(l,c)=>{const u=await l.arrayBuffer();return{type:Ye.BinaryFile,data:{path:c.toString(),data:new Uint8Array(u)}}})),s=["--action","categorize","--memory-io","0","--files",...n.map(l=>l.data.path)],o=[{type:Ye.TextStream}],i=await this.runTask("dicom",s,n,o),a=JSON.parse(i.outputs[0].data.data);return Object.fromEntries(Object.entries(a).map(([l,c])=>[l,c.map(u=>t[parseInt(u,10)])]))}async readTags(t,n){const s=n.map(a=>a.tag),i=(await Ro(this.webWorker,Mo(t),s)).tags;return n.reduce((a,r)=>{const{tag:l,name:c}=r;return i.has(l)?{...a,[c]:i.get(l)}:a},{})}async getVolumeSlice(t,n=!1){await this.initialize();const s=await t.arrayBuffer(),o=[{type:Ye.BinaryFile,data:{path:$n(t.name),data:new Uint8Array(s)}}],i=["--action","getSliceImage","--thumbnail",n.toString(),"--file",$n(t.name),"--memory-io","0"],a=[{type:Ye.Image}];return(await this.runTask("dicom",i,o,a)).outputs[0].data}async resample(t,n){await this.initialize();const{size:s,spacing:o,origin:i,direction:a}=t,r=["--action","resample","0","--size",s.join(","),"--spacing",o.join(","),"--origin",i.join(","),"--direction",a.join(","),"--memory-io","0"],l=[{type:Ye.Image,data:n}],c=[{type:Ye.Image}];return(await this.runTask("dicom",r,l,c)).outputs[0].data}async buildImage(t){return await this.initialize(),(await ya(t.map(s=>Mo(s)))).image}}const Ft={vti:"application/vnd.unknown.vti",vtp:"application/vnd.unknown.vtp",stl:"model/stl",dcm:"application/dicom",zip:"application/zip",json:"application/json",gipl:"application/vnd.unknown.gipl","gipl.gz":"application/vnd.unknown.gipl",hdf5:"application/x-hdf5",jpg:"image/jpeg",jpeg:"image/jpeg",lsm:"application/vnd.unknown.lsm",mnc:"application/vnd.unknown.minc","mnc.gz":"application/vnd.unknown.minc",mnc2:"application/vnd.unknown.minc",mgh:"application/vnd.unknown.mgh",mgz:"application/vnd.unknown.mgh","mgh.gz":"application/vnd.unknown.mgh",mha:"application/vnd.unknown.metaimage",mhd:"application/vnd.unknown.metaimage",mrc:"application/vnd.unknown.mrc",nia:"application/vnd.unknown.nifti-1",nii:"application/vnd.unknown.nifti-1","nii.gz":"application/vnd.unknown.nifti-1",hdr:"application/vnd.unknown.nifti-1",nrrd:"application/vnd.unknown.nrrd",nhdr:"application/vnd.unknown.nrrd",png:"image/png",pic:"application/vnd.unknown.biorad",tif:"image/tiff",tiff:"image/tiff",vtk:"application/vnd.unknown.vtk",isq:"application/vnd.unknown.scanco",fdf:"application/vnd.unknown.fdf"},Bo=new Set(Object.keys(Ft)),Ao=new Set(Object.values(Ft)),Oi=new Set(["application/zip"]),Fo=[{mime:"application/dicom",skip:128,header:Array.from("DICM").map(e=>e.charCodeAt(0))}],tl=512;function nl(e,t){if(t.length>e.length)return!1;for(let n=0;n<t.length;n+=1)if(t[n]!==e[n])return!1;return!0}async function ol(e){return new Promise(t=>{const n=e.slice(0,tl),s=new FileReader;s.onload=()=>{const o=new Uint8Array(s.result);for(let i=0;i<Fo.length;i+=1){const{mime:a,header:r,skip:l=0}=Fo[i];if(nl(o.slice(l),r)){t(a);return}}t(null)},s.readAsArrayBuffer(n)})}async function Vi(e){const t=e.type.toLowerCase();if(Ao.has(t))return t;if(Bo.has(t))return Ft[t];const n=[...Bo].find(o=>e.name.toLowerCase().endsWith(`.${o}`));if(n)return Ft[n];const s=await ol(e);return s&&Ao.has(s)?s:null}async function il(e){const t=await Vi(e)??"";return new File([e],e.name,{type:t.toLowerCase()})}async function sl(e,t){return new Promise(n=>{const s=new globalThis.FileReader;if(s.onload=()=>n(s.result),t==="ArrayBuffer")s.readAsArrayBuffer(e);else if(t==="Text")s.readAsText(e);else throw new TypeError(`readAs${t} is not a function`)})}async function al(e){return sl(e,"ArrayBuffer")}const Un=new Map;function ki(e){return e}function Mi(){let e=null,t=null;const n=i=>{e&&e(i)},s=i=>{t&&t(i)};return{promise:new Promise((i,a)=>{e=i,t=a}),resolve:n,reject:s}}function Nt(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}function Bi(e,t,n){return Math.min(n,Math.max(t,e))}function No(e,...t){return t.reduce((n,s)=>({...n,[s]:e[s]}),{})}function vn(e,t){const n=[[],[]];return t.forEach(s=>{const o=e(s)?0:1;n[o].push(s)}),n}const rl=(e,t,n)=>(e in t||(t[e]=n),t[e]);function qn(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function ll(e,t=Gn){const n=Math.round(e);return Math.abs(n-e)<=t?n:e}function cl(e){return e instanceof Error?e:new Error(JSON.stringify(e))}function ul(e){if(!e)return"#ffffff";const t=document.createElement("canvas").getContext("2d");if(!t)throw new Error("Could not create canvas context");return t.fillStyle=e,t.fillStyle}class Ai{constructor(t){this.msgID=0,this.worker=t,this.waiting={},this.worker.onmessage=this.handleMessage.bind(this)}postMessage(t,n=[]){const s={id:this.msgID,message:t},o=Mi();return this.waiting[s.id]=o,this.worker.postMessage(s,n),this.msgID+=1,o.promise}handleMessage(t){const{id:n,error:s,message:o}=t.data;if(n in this.waiting){const i=this.waiting[n];delete this.waiting[n],s?i.reject(new Error(s)):i.resolve(o)}}}const Kn=e=>async t=>{const s=await new Ai(new Worker(new URL("/assets/async.reader.worker-f0ea3ad1.js",self.location),{type:"module"})).postMessage({file:t,readerName:e});if(s.status==="success")return fr(s.obj);throw s.error},dl=e=>async t=>{const s=await new Ai(new Worker(new URL("/assets/async.writer.worker-42a67950.js",self.location),{type:"module"})).postMessage({obj:t.getState(),writerName:e});if(s.status==="success")return s.data;throw s.error},hl=Kn("stl"),Fi=Kn("vti"),gl=Kn("vtp"),fl=dl("vti"),pl=Array.from(new Set(Array.from(wa.keys()).map(e=>Ft[e.toLowerCase()])));_i.setReadImageArrayBufferFromITK(Sa);async function ml(e){const t=await al(e),n=_i.newInstance();n.setFileName(e.name);try{await n.parseAsArrayBuffer(t)}catch{throw new Error("Failed to parse file")}return n.getOutputData()}function vl(e){e.set("application/vnd.unknown.vti",Fi),e.set("application/vnd.unknown.vtp",gl),e.set("model/stl",hl),pl.forEach(t=>{e.set(t,ml)})}function Ni(e,t){const n=_.debounce(t.renderWindow.render,5);e.resize=()=>{if(t.container){const a=t.container.getBoundingClientRect();if(a.width===a.height&&a.width===0)return;const r=window.devicePixelRatio||1,l=Math.max(10,Math.floor(r*a.width)),c=Math.max(10,Math.floor(r*a.height));t.renderWindow.getViews()[0].setSize(l,c),e.invokeResize({width:l,height:c}),e.render(!0)}},e.render=(a=!0)=>{t.orientationWidget.updateMarkerOrientation(),a?t.renderWindow.render():n()};let s=null;e.renderLater=()=>{s==null&&(s=setTimeout(()=>{e.render(),s=null},0))},e.removeAllRepresentations=()=>{t.representations.forEach(a=>t.renderer.removeViewProp(a)),t.representations.length=0},e.updateCamera=(a,r,l)=>{const c=si(l);ai(c,c,a),t.camera.setFocalPoint(...l),t.camera.setPosition(...c),t.camera.setDirectionOfProjection(...a),t.camera.setViewUp(...r)};const{setContainer:o}=e;e.setContainer=a=>{o(a),t.cornerAnnotation.setContainer(null)};const{resetCamera:i}=e;e.resetCamera=(...a)=>{i(a),t.renderer.updateLightsGeometryToFollowCamera()}}function yl(e,t){t.classHierarchy.push("vtkLPSView3DProxy"),Ni(e,t)}function $i(e,t,n={}){Object.assign(t,n),pr.extend(e,t,n),yl(e,t)}const wl=_.newInstance($i,"vtkLPSView3DProxy"),Sl={newInstance:wl,extend:$i};function _l(e,t){t.classHierarchy.push("vtkLPSView2DProxy");const n={...e};Ni(e,t),e.bindRepresentationToManipulator=()=>{},e.resetCamera=(s=null)=>{t.renderer.resetCamera(s)},e.addRepresentation=s=>{s&&(t.representations.indexOf(s)===-1&&(t.representations.push(s),t.renderer.addViewProp(s)),s.setSlicingMode&&t.slicingMode&&s.setSlicingMode(t.slicingMode))},e.setSlicingMode=s=>{if(t.axis="IJK".indexOf(s),n.setSlicingMode(s)&&s){let o=t.representations.length;for(;o--;){const i=t.representations[o];i.setSlicingMode&&i.setSlicingMode(s)}}},e.resizeToFit=(s,o,i)=>{const[a,r]=t.renderWindow.getViews()[0].getSize();let l,c;s===0&&o===1?[,c,l]=i:s===0&&o===2?[,l,c]=i:s===1&&o===0?[c,,l]=i:s===1&&o===2?[l,,c]=i:s===2&&o===0?[c,l]=i:s===2&&o===1&&([l,c]=i);const u=a/r,d=l/c;let g=0;u>=d?g=c/2:g=l/2/u,t.camera.setParallelScale(g)}}const Cl={slicingMode:null};function Ui(e,t,n={}){Object.assign(t,n,Cl),_.setGet(e,t,["slicingMode"]),mr.extend(e,t,n),_l(e,t)}const bl=_.newInstance(Ui,"vtkLPSView2DProxy"),Tl={newInstance:bl,extend:Ui},Il={X:"I",Y:"J",Z:"K",I:"I",J:"J",K:"K"};function xl(e,t){t.classHierarchy.push("vtkIJKSliceRepresentationProxy");const n={...e};e.setSlicingMode=s=>n.setSlicingMode(Il[s])}const Rl={};function Hi(e,t,n={}){Object.assign(t,Rl,n),vr.extend(e,t),_.proxyPropertyMapping(e,t,{opacity:{modelKey:"property",property:"opacity"}}),xl(e,t)}const Dl=_.newInstance(Hi,"vtkIJKSliceRepresentationProxy"),Wi={newInstance:Dl,extend:Hi},{InterpolationType:El}=yr;function Ll(e,t){t.classHierarchy.push("vtkLabelMapSliceRepProxy");let n=null;t.property.setUseLookupTableScalarRange(!0),t.property.setInterpolationType(El.NEAREST),t.mapper.setRelativeCoincidentTopologyPolygonOffsetParameters(-2,-2);let s=null;function o(a){const r=a.getColorMap();if(r===s)return;s=r;const l=wr.newInstance(),c=Sr.newInstance();Object.keys(r).forEach(u=>{const d=Number(u);l.addRGBPoint(d,...r[u].slice(0,3).map(g=>g/255)),c.addPoint(d,r[u][3]/255)}),t.property.setRGBTransferFunction(l),t.property.setScalarOpacity(c)}function i(a){n&&(n.unsubscribe(),n=null),a&&(n=a.onModified(()=>o(a)),o(a))}e.setColorBy=()=>{},e.delete=_.chain(e.delete,()=>{n&&(n.unsubscribe(),n=null)}),t.sourceDependencies.push({setInputData:i})}const Pl={};function zi(e,t,n={}){Object.assign(t,Pl,n),Wi.extend(e,t),Ll(e,t)}const Ol=_.newInstance(zi,"vtkLabelMapSliceRepProxy"),Vl={newInstance:Ol,extend:zi};function Ke(e,t=[],n=[],s={},o={}){return{class:e,options:{links:n,ui:t,...s},props:o}}function $o(e,t=[],n={}){return Ke(e,[],[],t,n)}const kl={definitions:{Proxy:{LookupTable:Ke(_r,[],[],{presetName:"Default (Cool to Warm)"}),PiecewiseFunction:Ke(Ee)},Sources:{TrivialProducer:Ke(Cr)},Representations:{ImageSlice:Ke(Wi),LabelMapSlice:Ke(Vl),Volume:Ke(br),Geometry:Ke(Tr)},Views:{View3D:$o(Sl),View2D:$o(Tl)}},representations:{View3D:{vtkImageData:{name:"Volume"},vtkPolyData:{name:"Geometry"}},View2D:{vtkImageData:{name:"ImageSlice"},vtkLabelMap:{name:"LabelMapSlice"}}}};function Ml({stencil:e,location:t,slicingIndex:n,indexToWorld:s}){const[o,i]=e.size,a=Math.floor((o-1)/2),r=Math.floor((i-1)/2),l=o+1,c=i+1,u=[],d=[],g={},y=(p,m)=>{const w=`${p},${m}`;if(w in g)return g[w];const T=[...t].map(P=>Math.round(P));n===0?(T[1]+=p-a-.5,T[2]+=m-r-.5):n===1?(T[0]+=p-a-.5,T[2]+=m-r-.5):n===2&&(T[0]+=p-a-.5,T[1]+=m-r-.5);const S=[];pe(S,T,s),u.push(S);const b=u.length-1;return g[w]=b,b},f=(p,m)=>p<0||p>=o||m<0||m>=i?0:e.pixels[m*o+p]||0;for(let p=0;p<c;p++)for(let m=0;m<l;m++){const w=f(m,p)+f(m-1,p)+f(m,p-1)+f(m-1,p-1);if(w>0&&w<4){const T=y(m,p);if(f(m,p)!==f(m,p-1)){const S=y(m+1,p);d.push([T,S])}if(f(m,p)!==f(m-1,p)){const S=y(m,p+1);d.push([T,S])}}}return{points:new Float32Array(u.flat()),lines:new Uint16Array(d.map(([p,m])=>[2,p,m]).flat())}}function Bl(e,t){t.classHierarchy.push("vtkPaintBrushContextRepresentation"),t.internalPolyData=et.newInstance({mtime:0}),t.internalArrays={points:t.internalPolyData.getPoints(),lines:t.internalPolyData.getLines()},t.pipelines={brush:{source:e,mapper:xr.newInstance({transformCoordinate:Rr.newInstance({coordinateSystem:Dr.WORLD})}),actor:Er.newInstance({pickable:!1,parentProp:e})}};const n=t.pipelines.brush.actor.getProperty();n.setLineWidth(2),n.setColor([1,0,0]),n.setDisplayLocation(Lr.FOREGROUND),n.setRepresentation(Pr.SURFACE),Xn.connectPipeline(t.pipelines.brush),e.addActor(t.pipelines.brush.actor),e.requestData=(s,o)=>{const i=s[0],a=i.getStencil(),r=i.getBrush(),{indexToWorld:l,worldToIndex:c}=t;if(a&&r.getOrigin()){const u=[];pe(u,r.getOrigin(),c);const d=Ml({stencil:a,location:u,slicingIndex:t.slicingIndex,indexToWorld:l}),{points:g,lines:y}=t.internalArrays;g.setData(d.points),y.setData(d.lines),t.internalPolyData.modified()}o[0]=t.internalPolyData}}const Al={defaultScale:1,drawBorder:!1,drawFace:!0,worldToIndex:null,indexToWorld:null,slicingIndex:0};function ji(e,t,n={}){Object.assign(t,Al,n),Ir.extend(e,t,n),_.setGet(e,t,["slicingIndex","indexToWorld","worldToIndex"]),_.get(e,t,["mapper","actor"]),Bl(e,t)}const Fl=_.newInstance(ji,"vtkPaintBrushContextRepresentation"),Nl={newInstance:Fl,extend:ji};function On(e){return e.altKey||e.controlKey||e.shiftKey}function $l(e,t){t.classHierarchy.push("vtkPaintWidgetProp"),_.setGet(e,t,["manipulator"]);let n=!1;e.handleLeftButtonPress=s=>{if(!t.manipulator||On(s))return _.VOID;const o=t.manipulator.handleEvent(s,t._apiSpecificRenderWindow);return o?(t.widgetState.getBrush().setOrigin(...o),n=!0,e.invokeStartInteractionEvent(),_.EVENT_ABORT):_.VOID},e.handleMouseMove=s=>{if(On(s))return _.VOID;const o=t.manipulator.handleEvent(s,t._apiSpecificRenderWindow);return o?(t.widgetState.getBrush().setOrigin(...o),n&&e.invokeInteractionEvent(),_.EVENT_ABORT):_.VOID},e.handleLeftButtonRelease=s=>!n||On(s)?_.VOID:(n=!1,e.invokeEndInteractionEvent(),_.EVENT_ABORT),e.handleMouseWheel=()=>n?_.EVENT_ABORT:_.VOID,e.grabFocus=()=>{t.hasFocus||(t.hasFocus=!0,t._interactor.requestAnimation(e))},e.loseFocus=()=>{t.hasFocus&&t._interactor.cancelAnimation(e),t.hasFocus=!1}}function Ul(){return Ci.createBuilder().addStateFromMixin({labels:["brush"],name:"brush",mixins:["origin","scale1","visible","color"],initialValues:{scale1:1,origin:null,visible:!0}}).addField({name:"stencil",initialValue:null}).build()}function Hl(e,t){t.classHierarchy.push("vtkPaintWidget"),t.methodsToLink=["slicingIndex","indexToWorld","worldToIndex"],e.getRepresentationsForViewType=()=>[{builder:Nl,labels:["brush"]}],t.manipulator=Ge.newInstance()}const Wl={};function Gi(e,t,n={}){Object.assign(t,Wl,n),fn.extend(e,t,{...n,behavior:$l,widgetState:Ul()}),_.get(e,t,["manipulator"]),Hl(e,t)}const zl=_.newInstance(Gi,"vtkPaintWidget"),jl={newInstance:zl,extend:Gi};function Gl(e,t){const n=new Uint8Array(e*t),s=(m,w)=>{n[m+w*e]=1},o=(m,w,T)=>{const S=T*e+m,b=S+(w-m+1);n.fill(1,S,b)};let i=0,a=0,r=e-1,l=t-1,c=r,u=l;const d=u&1;let g=4*(1-c)*u*u,y=4*(d+1)*c*c,f=g+y+d*c*c,p=0;a+=Math.floor((u+1)/2),l=a-d,c*=8*c,u*=8*u;do o(i,r,a),o(i,r,l),p=2*f,p<=y&&(a++,l--,y+=c,f+=y),(p>=g||2*f>y)&&(i++,r--,g+=u,f+=g);while(i<=r);for(;a-l<t;)s(i-1,a),s(r+1,a++),s(i-1,l),s(r+1,l--);return n}class Xl{constructor(){this.size=1,this.scale=[1,1],this.recomputeStencil()}setSize(t){this.size=Math.max(0,t),this.recomputeStencil()}setScale(t){this.scale=t,this.recomputeStencil()}recomputeStencil(){const t=[Math.ceil(this.size*this.scale[0]),Math.ceil(this.size*this.scale[1])];this.cachedStencil={size:t,pixels:Gl(t[0],t[1])}}getStencil(){return this.cachedStencil}}let ql=class{constructor(){this.factory=jl.newInstance(),this.brush=new Xl,this.brushValue=1}updateWidgetStencil(){const t=this.brush.getStencil();this.factory.getWidgetState().setStencil(t)}setBrushSize(t){this.brush.setSize(t),this.updateWidgetStencil()}setBrushScale(t){this.brush.setScale(t),this.updateWidgetStencil()}setBrushValue(t){this.brushValue=t}paintLabelmap(t,n,s,o){const i=this.brush.getStencil(),a=[...s.map(E=>Math.round(E))],r=a[n];a.splice(n,1);let l=[...a];o&&(l=[...o.map(E=>Math.round(E))],l.splice(n,1));const c=t.getPointData().getScalars().getData(),u=t.getDimensions(),d=u[0],g=u[0]*u[1],y=E=>E[0]>=0&&E[1]>=0&&E[2]>=0&&E[0]<u[0]&&E[1]<u[1]&&E[2]<u[2],{pixels:f,size:p}=i,m=Math.floor((p[0]-1)/2),w=Math.floor((p[1]-1)/2),T=[...a],S=[...l],b=[0,0,0],P=[0,0];for(let E=0;E<p[1];E++){const k=E-w,L=E*p[0];for(let $=0;$<p[0];$++){const K=$-m,Z=L+$;if(f[Z]){T[0]=a[0]+K,T[1]=a[1]+k,S[0]=l[0]+K,S[1]=l[1]+k;const M=S[0]-T[0],W=S[1]-T[1];let J=Math.abs(Math.abs(M)>Math.abs(W)?M:W);const _e=M/J,me=W/J;for([P[0],P[1]]=T;J-->=0;){if(P.splice(n,0,r),b[0]=Math.round(P[0]),b[1]=Math.round(P[1]),b[2]=Math.round(P[2]),y(b)){const Xe=b[0]+b[1]*d+b[2]*g;c[Xe]=this.brushValue}P.splice(n,1),P[0]+=_e,P[1]+=me}}}}t.modified()}};function Kl({paint:e,proxies:t,dicomIO:n}={}){const s={$paint:e??new ql,$proxies:t,$dicomIO:n??new Pi};return()=>s}var Xi=(e=>(e.Volume="View3D",e.Slice="View2D",e))(Xi||{});class Yl{constructor(t){this.viewProxies=new Map,this.dataProxies=new Map,this.proxyManager=t}delete(){const t=n=>this.proxyManager.deleteProxy(n);this.viewProxies.forEach(t),this.dataProxies.forEach(t)}createView(t,n){if(this.viewProxies.has(t))throw new Error("Cannot create a view with the same ID");const s=this.proxyManager.createProxy("Views",n,{name:n});return this.viewProxies.set(t,s),s}getView(t){return this.viewProxies.get(t)}removeView(t){const n=this.viewProxies.get(t);n&&(this.proxyManager.deleteProxy(n),this.viewProxies.delete(t))}addData(t,n){if(this.dataProxies.has(t))return;const s=this.proxyManager.createProxy("Sources","TrivialProducer");s.setInputData(n),this.dataProxies.set(t,s)}getData(t){return this.dataProxies.get(t)??null}updateData(t,n){const s=this.dataProxies.get(t);s&&s.setInputData(n)}deleteData(t){const n=this.dataProxies.get(t);if(this.dataProxies.delete(t),n)this.proxyManager.deleteProxy(n);else throw new Error("Did not find proxy for ID")}getDataRepresentationForView(t,n){const s=this.dataProxies.get(t),o=this.viewProxies.get(n);return!s||!o?null:this.proxyManager.getRepresentation(s,o)}}function Ql(){const{exitPointerLock:e}=document;document.exitPointerLock=()=>{try{e==null||e.call(document)}catch{}}}const{VITE_SENTRY_DSN:qi}={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},Ki="error-reporting-off",Zl=!!qi,Jl=e=>{localStorage.getItem(Ki)!=="true"&&Zl&&_a({app:e,dsn:qi,integrations:[new Ca],tracesSampleRate:.1,replaysSessionSampleRate:.1,replaysOnErrorSampleRate:1})},ec=()=>{Ta(200)};te("error-reporting",()=>{const e=ba(Ki,"false"),t=B(e.value==="true");return F(t,()=>{e.value=String(t.value),t.value&&ec()}),{disableReporting:t}});const Uo=[{username:"Mitchel",password:"12345"},{username:"Glisant",password:"12345"},{username:"admin",password:"admin123"}];const tc={data(){return{timeofday:"Day",container:"container",invalidLogin:!1,loaded:!1}},created(){this.timeofday=this.getTimeOfDay(),this.container=`${this.container} ${this.timeofday.toLowerCase()}`,window.localStorage.setItem("userLoggedIn","GUEST USER")},mounted(){setTimeout(()=>{this.loaded=!0},100)},methods:{getTimeOfDay(){const e=new Date().getHours();return e>=5&&e<12?"Morning":e>=12&&e<18?"Afternoon":e>=18&&e<23?"Evening":"Day"},login(e){e.preventDefault(),Uo.find(n=>n.username===this.username&&n.password===this.password)?(window.localStorage.setItem("userLoggedIn",this.username),this.$router.push("/home")):(this.invalidLogin=!0,setTimeout(()=>{this.invalidLogin=!1},2e3))},signup(e){e.preventDefault();const t={username:this.username,password:this.password};Uo.push(t),this.$router.push("/home")},handleFocus(){this.invalidLogin=!1}}},Kt=e=>(oe("data-v-3dc8a6ef"),e=e(),ie(),e),nc=Kt(()=>h("h4",null,"Sign into your account",-1)),oc={for:"username"},ic=Kt(()=>h("p",null,"Username not found",-1)),sc=[ic],ac={for:"password"},rc=Kt(()=>h("p",null,"Invalid Password",-1)),lc=[rc],cc=Kt(()=>h("button",{type:"submit",style:{"align-self":"center"}},"Log In",-1)),uc=Kt(()=>h("h4",{style:{"margin-top":"40px"}},"Don't have an account?",-1));function dc(e,t,n,s,o,i){return I(),D("div",{class:N(o.container)},[h("div",{class:N(["login-form",{loaded:o.loaded}])},[h("h2",null,"Good "+U(o.timeofday),1),nc,h("form",{onSubmit:t[5]||(t[5]=(...a)=>i.login&&i.login(...a))},[h("label",oc,[H("User name "),nt(h("input",{type:"text",id:"username","onUpdate:modelValue":t[0]||(t[0]=a=>e.username=a),onFocusin:t[1]||(t[1]=(...a)=>i.handleFocus&&i.handleFocus(...a)),required:""},null,544),[[An,e.username]])]),h("div",{class:N(["invalidLogin",{view:o.invalidLogin}])},sc,2),h("label",ac,[H("Password "),nt(h("input",{type:"password",id:"password","onUpdate:modelValue":t[2]||(t[2]=a=>e.password=a),required:""},null,512),[[An,e.password]])]),h("div",{class:N(["invalidLogin",{view:o.invalidLogin}])},lc,2),cc,uc,h("h4",{onClick:t[3]||(t[3]=(...a)=>i.signup&&i.signup(...a)),onKeydown:t[4]||(t[4]=ot(ue((...a)=>e.handleKeyDown&&e.handleKeyDown(...a),["prevent"]),["space"])),style:{color:"#0085ff"},class:"sign-up-b"}," Try as Guest ",32)],32)],2)],2)}const hc=A(tc,[["render",dc],["__scopeId","data-v-3dc8a6ef"]]);const gc={props:{username:String},methods:{getTimeOfDay(){const e=new Date().getHours();return e>=5&&e<12?"Morning":e>=12&&e<18?"Afternoon":e>=18&&e<23?"Evening":"Night"}},data(){return{timeofday:"Day"}},created(){this.timeofday=this.getTimeOfDay()}},fc={class:"greeting"};function pc(e,t,n,s,o,i){return I(),D("div",fc,[h("h2",null,"Good "+U(o.timeofday)+",",1),h("h1",null,U(n.username),1)])}const mc=A(gc,[["render",pc],["__scopeId","data-v-91098397"]]);const vc={emits:["removePatient"],props:{patient:Object},methods:{updatepatient(e){window.localStorage.setItem("currentPatient",JSON.stringify(e))},handleMouseOver(){this.isHovered=!0,this.$refs.patientElement.focus()},handleMouseOut(){this.patient&&(this.isHovered=!1,this.$refs.patientElement.blur())},handleKeyDown(e){e.key==="Delete"&&this.$emit("removePatient",this.patient)}},data(){return{isHovered:!1,currentPatient:""}}};function yc(e,t,n,s,o,i){const a=O("router-link");return I(),Y(a,{to:"/analysis",style:{"text-decoration":"none"}},{default:R(()=>[h("div",{class:"patient",tabindex:"-1",onMouseover:t[0]||(t[0]=(...r)=>i.handleMouseOver&&i.handleMouseOver(...r)),onFocusin:t[1]||(t[1]=(...r)=>i.handleMouseOver&&i.handleMouseOver(...r)),onClick:t[2]||(t[2]=r=>i.updatepatient(n.patient)),onKeydown:t[3]||(t[3]=(...r)=>i.handleKeyDown&&i.handleKeyDown(...r)),onMouseout:t[4]||(t[4]=(...r)=>i.handleMouseOut&&i.handleMouseOut(...r)),onFocusout:t[5]||(t[5]=(...r)=>i.handleMouseOut&&i.handleMouseOut(...r)),ref:"patientElement"},[h("h3",{class:N({hovered:o.isHovered})},U(n.patient.name),3),h("h3",{class:N({hovered:o.isHovered})},U(n.patient.lastname),3),h("h3",{class:N({hovered:o.isHovered})},U(n.patient.dob),3),h("h3",{class:N({hovered:o.isHovered})},U(n.patient.gender),3),h("h3",{class:N({hovered:o.isHovered})},U(n.patient.scandate),3),h("h3",{class:N({hovered:o.isHovered})},U(n.patient.scanlocation),3)],544)]),_:1})}const wc=A(vc,[["render",yc],["__scopeId","data-v-59020a19"]]);const Sc={},_c={class:"loading-container"},Cc=h("div",{class:"loading-spinner"},null,-1),bc=h("p",{class:"loading-text"},"Loading...",-1),Tc=[Cc,bc];function Ic(e,t){return I(),D("div",_c,Tc)}const Yi=A(Sc,[["render",Ic]]);const xc={emits:["removePatient"],props:{patients:{type:Array},filter:{type:String,default:""}},data(){return{loaded:!1}},computed:{filteredPatients(){const e=this.filter.toLowerCase().replace(/\s/g,"");return e===""?this.patients:this.patients.filter(t=>t.name.toLowerCase().includes(e)||t.lastname.toLowerCase().includes(e)||t.scanlocation.toLowerCase().includes(e))}},methods:{handleRemovePatient(e){this.$emit("removePatient",e)}},components:{PatientElement:wc,LoadingScreen:Yi},mounted(){setTimeout(()=>{this.loaded=!0},600)}},Rc=e=>(oe("data-v-93ac9fd2"),e=e(),ie(),e),Dc=Rc(()=>h("div",{class:"patient-header"},[h("h3",null,"Last Name"),h("h3",null,"First Name"),h("h3",null,"Date of Birth"),h("h3",null,"Gender"),h("h3",null,"Scan Date"),h("h3",null,"Scan Location")],-1)),Ec={key:0,class:"patient-container"},Lc={key:1};function Pc(e,t,n,s,o,i){const a=O("PatientElement"),r=O("LoadingScreen");return I(),D(se,null,[Dc,o.loaded?(I(),D("div",Ec,[(I(!0),D(se,null,Re(i.filteredPatients,l=>(I(),D("div",{key:l.id},[v(a,{patient:l,onRemovePatient:i.handleRemovePatient},null,8,["patient","onRemovePatient"])]))),128))])):(I(),D("div",Lc,[v(r)]))],64)}const Oc=A(xc,[["render",Pc],["__scopeId","data-v-93ac9fd2"]]),Ho=0,_t=te("id",()=>{let e=Ho;return{nextId(){return String(++e)},reset(){e=Ho}}}),Yn=["Sagittal","Coronal","Axial"];function gt(){return{Sagittal:0,Coronal:0,Axial:0}}function Qi(){return{Sagittal:[0,0],Coronal:[0,0],Axial:[0,0]}}function He(e,t,n){const s=2*n[t];return e.slice(s,s+2)}function be(e){switch(e){case"Superior":case"Inferior":return"Axial";case"Left":case"Right":return"Sagittal";case"Posterior":case"Anterior":return"Coronal";default:throw new Error(`Invalid LPS direction: ${e}`)}}const Zi=()=>({Left:Qe(1,0,0),Right:Qe(-1,0,0),Posterior:Qe(0,1,0),Anterior:Qe(0,-1,0),Superior:Qe(0,0,1),Inferior:Qe(0,0,-1),Sagittal:0,Coronal:1,Axial:2});function Ji(e){const t=[0,1,2],n=[0,1,2],s=Zi();for(let o=0;o<3;o++){let i=0,a=[0,0],r=[0,0];t.forEach((f,p)=>{n.forEach((m,w)=>{const T=e[f*3+m];Math.abs(T)>Math.abs(i)&&(i=T,a=[f,m],r=[p,w])})});const[l,c]=a,u=e.slice(l*3,(l+1)*3),d=Math.sign(i),g=u.map(f=>f*d),y=u.map(f=>f*-d);c===0?(s.Left=g,s.Right=y,s.Sagittal=l):c===1?(s.Posterior=g,s.Anterior=y,s.Coronal=l):c===2&&(s.Superior=g,s.Inferior=y,s.Axial=l),t.splice(r[0],1),n.splice(r[1],1)}return s}var ce=(e=>(e.WindowLevel="WindowLevel",e.Pan="Pan",e.Zoom="Zoom",e.Ruler="Ruler",e.Paint="Paint",e.Rectangle="Rectangle",e.Crosshairs="Crosshairs",e.Crop="Crop",e.Contour="Contour",e))(ce||{}),Ie=(e=>(e.V="V",e.H="H",e))(Ie||{}),yn=(e=>(e.DICOM="dicom",e.IMAGE="image",e))(yn||{});const Vc=C.nativeEnum(yn),kc=C.union([C.literal("Left"),C.literal("Right"),C.literal("Posterior"),C.literal("Anterior"),C.literal("Superior"),C.literal("Inferior")]),Mc=C.object({id:C.string(),path:C.string(),type:Vc}),Bc=C.object({archiveSrc:C.object({path:C.string()}).optional(),uriSrc:C.object({uri:C.string(),name:C.string()}).optional()}),es=Bc.extend({parent:C.lazy(()=>es.optional())}),Ac=C.nativeEnum(Ie),ts=C.lazy(()=>C.object({name:C.string().optional(),direction:Ac,items:C.array(C.union([ts,C.string()]))})),Ue=C.tuple([C.number(),C.number(),C.number()]),Fc=C.object({width:C.number(),level:C.number(),min:C.number(),max:C.number()}),Nc=C.object({slice:C.number(),min:C.number(),max:C.number(),axisDirection:kc}),$c=C.object({parallelScale:C.number().optional(),position:Ue.optional(),focalPoint:Ue.optional(),directionOfProjection:Ue.optional(),viewUp:Ue.optional()}),Qn=C.object({arrayName:C.string(),location:C.string()}),Uc=C.object({position:C.number(),height:C.number(),width:C.number(),xBias:C.number(),yBias:C.number()}),Hc=C.object({x:C.number(),y:C.number(),midpoint:C.number(),sharpness:C.number()}),Wc=C.object({mode:C.literal(Ee.Mode.Gaussians),gaussians:Uc.array(),mappingRange:C.tuple([C.number(),C.number()])}),zc=C.object({mode:C.literal(Ee.Mode.Points),preset:C.string(),shift:C.number(),mappingRange:C.tuple([C.number(),C.number()])}),jc=C.object({mode:C.literal(Ee.Mode.Nodes),nodes:Hc.array(),mappingRange:C.tuple([C.number(),C.number()])}),Zn=C.union([Wc,zc,jc]),Jn=C.object({preset:C.string(),mappingRange:C.tuple([C.number(),C.number()])});C.object({colorBy:Qn,transferFunction:Jn,opacityFunction:Zn});const Gc=C.object({enabled:C.boolean(),lightFollowsCamera:C.boolean(),volumeQuality:C.number(),useVolumetricScatteringBlending:C.boolean(),volumetricScatteringBlending:C.number(),useLocalAmbientOcclusion:C.boolean(),laoKernelSize:C.number(),laoKernelRadius:C.number(),ambient:C.number(),diffuse:C.number(),specular:C.number()}),Xc=C.object({colorBy:Qn,transferFunction:Jn,opacityFunction:Zn,cvr:Gc}),qc=C.object({opacity:C.number()}),Kc=C.object({colorBy:Qn,transferFunction:Jn,opacityFunction:Zn,blendConfig:qc}),Yc=C.object({window:Fc.optional(),slice:Nc.optional(),layers:Kc.optional(),camera:$c.optional(),volumeColorConfig:Xc.optional()}),Qc=C.union([C.literal("2D"),C.literal("3D")]),Zc=C.object({id:C.string(),type:Qc,props:C.record(C.any()),config:C.record(Yc)}),Jc=C.object({id:C.string(),parent:C.string(),path:C.string()});C.union([C.literal("Axial"),C.literal("Sagittal"),C.literal("Coronal")]);const eu=C.object({planeOrigin:Ue,planeNormal:Ue}),tu=C.object({imageID:C.string(),frameOfReference:eu,slice:C.number(),id:C.string(),name:C.string(),color:C.string(),label:C.string().optional(),labelName:C.string().optional()}),ns=e=>C.object({tools:C.array(e),labels:C.record(e.partial())}),os=tu.extend({firstPoint:Ue,secondPoint:Ue}),nu=ns(os),ou=os.extend({id:C.string(),fillColor:C.string().optional()}),iu=ns(ou),su=C.object({position:Ue}),au=C.nativeEnum(ce),ru=C.object({activeLabelmapID:C.string().nullable(),brushSize:C.number(),brushValue:C.number(),labelmapOpacity:C.number()}),lu=C.object({Sagittal:C.tuple([C.number(),C.number()]),Coronal:C.tuple([C.number(),C.number()]),Axial:C.tuple([C.number(),C.number()])}),cu=C.record(lu),uu=C.object({rulers:nu.optional(),rectangles:iu.optional(),crosshairs:su,paint:ru,crop:cu,current:au}),du=C.object({selectionKey:C.string(),sourceSelectionKeys:C.string().array()}).array(),hu=C.object({version:C.string(),datasets:Mc.array(),remoteFiles:C.record(es.array()),labelMaps:Jc.array(),tools:uu,views:Zc.array(),primarySelection:C.string().optional(),layout:ts,parentToLayers:du}),is=e=>({fileSrc:{file:e,fileType:e.type}});function ss(e){return!!e.uriSrc||!!e.parent&&ss(e.parent)}function as(e){const t={...e};return delete t.fileSrc,t.parent&&(t.parent=as(t.parent)),t}const rt=te("files",{state:()=>({byDataID:{}}),getters:{getDataSources:e=>t=>e.byDataID[t]??[],getFiles:e=>t=>(e.byDataID[t]??[]).map(n=>n.fileSrc.file)},actions:{remove(e){e in this.byDataID&&delete this.byDataID[e]},add(e,t){this.byDataID[e]=t}}});async function rs(e,t,n){const s=rt(),{zip:o}=e,{manifest:{datasets:i,remoteFiles:a}}=e;t.forEach(r=>{const l=s.getDataSources(r);if(!l.length)throw new Error(`No files for dataID: ${r}`);const[c,u]=vn(ss,l);a[r]=c.map(as);const d=`data/${r}/`;u.forEach(g=>{const{file:y}=g.fileSrc,f=`${d}/${y.name}`;o.file(f,y)}),i.push({id:r,path:d,type:n})})}const ls=()=>({name:"(none)",orientation:ri(),lpsOrientation:Zi(),spacing:Qe(1,1,1),origin:Le(),dimensions:Qe(1,1,1),worldBounds:[0,1,0,1,0,1],worldToIndex:pt(),indexToWorld:pt()}),Oe=te("images",{state:()=>({idList:[],dataIndex:Object.create(null),metadata:Object.create(null)}),actions:{addVTKImageData(e,t){const n=_t().nextId();return this.idList.push(n),this.dataIndex[n]=t,this.$proxies.addData(n,t),this.metadata[n]={...ls(),name:e},this.updateData(n,t),n},updateData(e,t){if(e in this.metadata){const n={name:this.metadata[e].name,dimensions:t.getDimensions(),spacing:t.getSpacing(),origin:t.getOrigin(),orientation:t.getDirection(),lpsOrientation:Ji(t.getDirection()),worldBounds:t.getBounds(),worldToIndex:t.getWorldToIndex(),indexToWorld:t.getIndexToWorld()};this.metadata[e]=n}this.$proxies.updateData(e,t),this.dataIndex[e]=t},deleteData(e){e in this.dataIndex&&(delete this.dataIndex[e],delete this.metadata[e],Nt(this.idList,e))},async serialize(e){const t=rt(),n=this.idList.filter(s=>s in t.byDataID);await rs(e,n,yn.IMAGE)}}}),gu="Anonymous",fu="ANONYMOUS";function pu(e,t){return`${e}!!${t}`}const mu=(e,t)=>e.readTags(t,[{name:"PatientName",tag:"0010|0010",strconv:!0},{name:"PatientID",tag:"0010|0020",strconv:!0},{name:"PatientBirthDate",tag:"0010|0030"},{name:"PatientSex",tag:"0010|0040"},{name:"StudyInstanceUID",tag:"0020|000d"},{name:"StudyDate",tag:"0008|0020"},{name:"StudyTime",tag:"0008|0030"},{name:"StudyID",tag:"0020|0010",strconv:!0},{name:"AccessionNumber",tag:"0008|0050"},{name:"StudyDescription",tag:"0008|1030",strconv:!0},{name:"Modality",tag:"0008|0060"},{name:"SeriesInstanceUID",tag:"0020|000e"},{name:"SeriesNumber",tag:"0020|0011"},{name:"SeriesDescription",tag:"0008|103e",strconv:!0}]),we=te("dicom",{state:()=>({sliceData:{},volumeToImageID:{},imageIDToVolumeKey:{},patientInfo:{},patientStudies:{},studyInfo:{},studyVolumes:{},volumeInfo:{},volumeStudy:{},studyPatient:{},needsRebuild:{}}),actions:{async importFiles(e){if(!e.length)return[];const t=this.$dicomIO,n=new Map(e.map(a=>[a.fileSrc.file,a])),s=[...n.keys()],o=await t.categorizeFiles(s),i=rt();return Object.entries(o).forEach(([a,r])=>{const l=r.map(c=>{const u=n.get(c);if(!u)throw new Error("Did not match File with source DataSource");return u});i.add(a,l)}),await Promise.all(Object.entries(o).map(async([a,r])=>{if(!(a in this.volumeInfo)){const l=await mu(t,r[0]),c={PatientID:l.PatientID||fu,PatientName:l.PatientName||gu,PatientBirthDate:l.PatientBirthDate||"",PatientSex:l.PatientSex||""},u=No(l,"StudyID","StudyInstanceUID","StudyDate","StudyTime","AccessionNumber","StudyDescription"),d={...No(l,"Modality","SeriesInstanceUID","SeriesNumber","SeriesDescription"),NumberOfSlices:r.length,VolumeID:a};this._updateDatabase(c,u,d)}a in this.volumeToImageID&&(this.needsRebuild[a]=!0)})),Object.keys(o)},_updateDatabase(e,t,n){const s=e.PatientID,o=t.StudyInstanceUID,i=n.VolumeID;s in this.patientInfo||(this.patientInfo[s]=e,this.patientStudies[s]=[]),o in this.studyInfo||(this.studyInfo[o]=t,this.studyVolumes[o]=[],this.studyPatient[o]=s,this.patientStudies[s].push(o)),i in this.volumeInfo||(this.volumeInfo[i]=n,this.volumeStudy[i]=o,this.sliceData[i]={},this.studyVolumes[o].push(i))},deleteVolume(e){const t=Oe();if(e in this.volumeInfo){const n=this.volumeStudy[e];if(delete this.volumeInfo[e],delete this.sliceData[e],delete this.volumeStudy[e],e in this.volumeToImageID){const s=this.volumeToImageID[e];t.deleteData(s),delete this.volumeToImageID[e],delete this.imageIDToVolumeKey[s]}Nt(this.studyVolumes[n],e),this.studyVolumes[n].length===0&&this.deleteStudy(n)}},deleteStudy(e){if(e in this.studyInfo){const t=this.studyPatient[e];delete this.studyInfo[e],delete this.studyPatient[e],[...this.studyVolumes[e]].forEach(n=>this.deleteVolume(n)),delete this.studyVolumes[e],Nt(this.patientStudies[t],e),this.patientStudies[t].length===0&&this.deletePatient(t)}},deletePatient(e){e in this.patientInfo&&(delete this.patientInfo[e],[...this.patientStudies[e]].forEach(t=>this.deleteStudy(t)),delete this.patientStudies[e])},async serialize(e){const t=Object.keys(this.volumeInfo);await rs(e,t,yn.DICOM)},async deserialize(e){return this.importFiles(e).then(t=>{if(t.length!==1)throw new Error("Invalid state file.");return t[0]})},async getVolumeSlice(e,t,n=!1){const s=this.$dicomIO,o=rt(),i=pu(t,n);if(e in this.sliceData&&i in this.sliceData[e])return this.sliceData[e][i];if(!(e in this.volumeInfo))throw new Error(`Cannot find given volume key: ${e}`);const r=this.volumeInfo[e].NumberOfSlices;if(t<1||t>r)throw new Error(`Slice ${t} is out of bounds`);const l=o.getFiles(e);if(!l)throw new Error(`No files found for volume key: ${e}`);const c=l[t-1],u=await s.getVolumeSlice(c,n);return this.sliceData[e][i]=u,u},async getVolumeThumbnail(e){const{NumberOfSlices:t}=this.volumeInfo[e],n=Math.ceil(t/2);return this.getVolumeSlice(e,n,!0)},async buildVolume(e,t=!1){const n=Oe(),s=this.$dicomIO;if(!(t||this.needsRebuild[e])&&this.volumeToImageID[e]){const c=this.volumeToImageID[e];return n.dataIndex[c]}const a=rt().getFiles(e);if(!a)throw new Error("No files for volume key");const r=un.convertItkToVtkImage(await s.buildImage(a)),l=this.volumeToImageID[e];if(l)n.updateData(l,r);else{const c=this.volumeInfo[e].SeriesInstanceUID,u=n.addVTKImageData(c,r);this.imageIDToVolumeKey[u]=e,this.volumeToImageID[e]=u}return delete this.needsRebuild[e],r}}}),cs=te("models",{state:()=>({idList:[],dataIndex:{},metadata:{}}),actions:{addVTKPolyData(e,t){const n=_t().nextId();return this.idList.push(n),this.dataIndex[n]=t,this.$proxies.addData(n,t),n}}}),vu=te("message",{state:()=>({_nextID:1,byID:{},msgList:[]}),getters:{messages(){return this.msgList.map(e=>this.byID[e])},importantMessages(){return this.messages.filter(e=>e.type!==3)}},actions:{addError(e,t){return t instanceof Error?this._addMessage({type:0,title:e},{details:String(t),persist:!1}):this._addMessage({type:0,title:e},t)},addWarning(e,t){return this._addMessage({type:1,title:e},t)},addInfo(e,t){return this._addMessage({type:2,title:e},t)},addSuccess(e,t){return this._addMessage({type:3,title:e},t)},clearOne(e){e in this.byID&&(Nt(this.msgList,e),delete this.byID[e])},clearAll(){this.byID={},this.msgList=[]},_addMessage(e,t){const n=String(this._nextID++),s={persist:!1,...typeof t=="string"?{details:t}:t};return this.byID[n]={...e,options:s,id:n},this.msgList.push(n),n}}});async function eo(e,t){try{return await t()}catch(n){n instanceof Error&&vu().addError(e,{details:`${n}. More details can be found in the developer's console.`}),console.error(n)}}const $t=e=>({type:"dicom",volumeKey:e}),Ut=e=>({type:"image",dataID:e}),us=e=>{if(e.type==="image")return e.dataID;if(e.type==="dicom")return we().volumeToImageID[e.volumeKey];const t=e;throw new Error(`invalid selection type ${t}`)},yu=async e=>{const t=Oe(),n=we();return e.type==="dicom"?(await eo("Failed to build volume",()=>n.buildVolume(e.volumeKey)),t.dataIndex[us(e)]):t.dataIndex[e.dataID]},ds=e=>we().imageIDToVolumeKey[e]??e,hs=e=>we().volumeToImageID[e]??e;function wu(e,t){return e.type==="dicom"&&t.type==="dicom"?e.volumeKey===t.volumeKey:e.type==="image"&&t.type==="image"?e.dataID===t.dataID:!1}const Yt=te("dataset",()=>{const e=Oe(),t=cs(),n=we(),s=rt(),o=B(null),i=x(()=>{if(o.value)return us(o.value)}),a=x(()=>{const{dataIndex:d}=e;return i.value&&d[i.value]||null}),r=x(()=>[...e.idList,...t.idList]);function l(d){return this.$proxies.getData(d)}function c(d){o.value=d,d!==null&&d.type==="dicom"&&eo("Failed to build volume",()=>n.buildVolume(d.volumeKey))}async function u(d){if(await n.serialize(d),await e.serialize(d),o.value!==null){let g=null;o.value.type==="dicom"?g=o.value.volumeKey:g=o.value.dataID;const{manifest:y}=d;y.primarySelection=g}}return e.$onAction(({name:d,args:g,after:y})=>{d==="deleteData"&&y(()=>{const[f]=g,p=o.value;(p==null?void 0:p.type)==="image"&&p.dataID===f&&(o.value=null),s.remove(f)})}),n.$onAction(({name:d,args:g,after:y})=>{d==="deleteVolume"&&y(()=>{const[f]=g,p=o.value;(p==null?void 0:p.type)==="dicom"&&f===p.volumeKey&&(o.value=null),s.remove(f)})}),{primarySelection:o,primaryDataset:a,allDataIDs:r,getDataProxyByID:l,setPrimarySelection:c,serialize:u}});function Su(e,t,n){return{message:e,inputDataStackTrace:[t],cause:n}}const Vn=Symbol("DoneSentinel");class wn{constructor(t){this.handlers=Array.from(t??[])}async execute(t,n){return this.startExecutionContext(t,n)}async startExecutionContext(t,n){const s=[...this.handlers],o=[],i=Mi(),a=(g,y)=>{y?i.reject(y):i.resolve(g)},r=async(g,y)=>{let f=!1,p;const m=y>=s.length,w={done:S=>{if(f)throw new Error("done() called twice!");return f=!0,p=S,Vn},execute:async(S,b)=>{const P=this.execute(S,b??n);return o.push(P),P},extra:n};let T;m&&(T=Vn);try{if(m)T=Vn;else{const S=s[y];T=await S(g,w)}}catch(S){const b=S instanceof Error?S:new Error(S?String(S):"Unknown error occurred");a(void 0,b);return}if(f||m){a(p);return}r(T,y+1)},l={ok:!0,data:[],errors:[]};try{await r(t,0);const g=await i.promise;g!=null&&l.data.push(g)}catch(g){const y=g instanceof Error?g.message:String(g);l.ok=!1,l.errors.push(Su(y,t,g))}const c=await Promise.all(o),[u,d]=vn(g=>g.ok,c);return d.length>0&&(l.ok=!1),u.forEach(g=>{l.data.push(...g.data)}),d.forEach(g=>{const{errors:y}=g;y.forEach(f=>{f.inputDataStackTrace.push(t)}),l.errors.push(...y)}),l}}const _u=(e,{extra:t,done:n})=>{const{fileSrc:s}=e;return t!=null&&t.dicomDataSources&&(s==null?void 0:s.fileType)==="application/dicom"?(t.dicomDataSources.push(e),n()):e},Cu={testURL:e=>{const{protocol:t}=new Tt(e,window.location.href);return t==="http:"||t==="https:"},fetchURL:async(e,t={})=>{var c;const{progress:n}=t,s=await fetch(e);if(s.status!==200)throw new Error(`Fetching resource failed (HTTP code ${s.status})`);if(!n)return s.blob();const o=Number(s.headers.get("content-length"))??-1;if(o<0)return n(1/0),s.blob();const i=(c=s.body)==null?void 0:c.getReader();if(!i)return null;const a=new Uint8Array(o);let r=0,l=!1;do{const u=await i.read();l=u.done,u.value&&!l&&(a.set(u.value,r),r+=u.value.length,n(r/o))}while(!l);return new Blob([a])}},to=[Cu];function bu(e){return!!to.find(t=>t.testURL(e))}async function Tu(e,t,n){const s=to.find(a=>a.testURL(e));if(!s)throw new Error(`Cannot find a handler for URL: ${e}`);const o=n==null?void 0:n.cache;if(o!=null&&o.has(e))return o.get(e);const i=s.fetchURL(e,n).then(a=>{if(!a)throw new Error(`Failed to download ${e}`);return new File([a],t)});return i.catch(()=>{o==null||o.delete(e)}),o==null||o.set(e,i),i}async function Iu(e,t){const n=to.find(a=>a.testURL(e));if(!n)throw new Error(`Cannot find a handler for URL: ${e}`);const s=await n.fetchURL(e,t);if(!s)throw new Error(`Failed to download ${e}`);const o=await s.arrayBuffer(),i=new TextDecoder;return JSON.parse(i.decode(new Uint8Array(o)))}const gs=async(e,{execute:t,done:n,extra:s})=>{const{fileSrc:o,uriSrc:i}=e;if(!o&&i&&bu(i.uri))try{const a=await Tu(i.uri,i.name,{cache:s==null?void 0:s.fetchFileCache});return t({...e,fileSrc:{file:a,fileType:""}}),n()}catch(a){throw new Error(`Could not download URL ${i.uri}`,{cause:a instanceof Error?a:void 0})}return e};async function no(e){const t=await li.loadAsync(e),n=[],s=[];return t.forEach((o,i)=>{if(!i.dir){const a=el(i.name),r=Jr(i.name),l=t.file(i.name);l&&(n.push(l.async("blob").then(c=>new File([c],a))),s.push(r))}}),Promise.all(n).then(o=>o.map((i,a)=>({file:i,archivePath:s[a]})))}function fs(e){return!!e.fileSrc&&Oi.has(e.fileSrc.fileType)}const xu=async(e,{execute:t,done:n})=>fs(e)?((await no(e.fileSrc.file)).forEach(o=>{t({fileSrc:{file:o.file,fileType:""},archiveSrc:{path:`${o.archivePath}/${o.file.name}`},parent:e})}),n()):e;async function Ru(e,t){let n=t==null?void 0:t.get(e);return n||(n=no(e).then(s=>s.reduce((o,i)=>{const a=St(i.archivePath,i.file.name);return Object.assign(o,{[a]:i.file})},{})),t&&t.set(e,n),n)}const ps=async(e,{extra:t,execute:n,done:s})=>{const{fileSrc:o,archiveSrc:i,parent:a}=e,{archiveCache:r}=t??{};if(!o&&i&&a){if(!(a!=null&&a.fileSrc))throw new Error("Cannot extract an archive target with an unresolved parent");if(!fs(a))throw new Error("Parent is not a supported archive file");const l=await Ru(a.fileSrc.file,r),c=wt(i.path),u=l[c];if(!u)throw new Error(`Failed to find archive member ${c}`);return n({...e,fileSrc:{file:u,fileType:""}}),s()}return e},Du=e=>new Tt(e).protocol==="s3:";function Eu(e,t){return`https://${e}.s3.amazonaws.com/${t}`}async function Lu(e,t,n=()=>{}){const s=new Ia({region:"us-east-1",signer:{sign:async i=>i}}),o=async i=>{const a=new xa({Bucket:e,Prefix:t,ContinuationToken:i,MaxKeys:1e3});let r;try{r=await s.send(a)}catch(l){throw console.error(l),l}if(!r.Contents)throw new Error("S3 returned no objects");r.Contents.forEach(l=>{if(!l.Key)return;const c=l.Key,u=Eu(e,l.Key);n(c,u)}),r.IsTruncated&&r.NextContinuationToken&&await o(r.NextContinuationToken)};await o()}const Pu=e=>{const{hostname:t,pathname:n}=new Tt(e),s=n.replace(/^\//,"");return[t,s]},Ou=async(e,t=()=>{})=>{const[n,s]=Pu(e);await Lu(n,s,t)},Vu=async(e,{execute:t,done:n})=>{const{uriSrc:s}=e;if(s&&Du(s.uri))try{return await Ou(s.uri,(o,i)=>{t({uriSrc:{uri:i,name:o},parent:e})}),n()}catch(o){throw new Error(`Could not download S3 URI ${s.uri}`,{cause:o instanceof Error?o:void 0})}return e},ku=e=>new Tt(e).protocol==="gs:",Mu=e=>{const{hostname:t,pathname:n}=new Tt(e),s=n.replace(/^\//,"");return[t,s]},Bu=e=>`https://storage.googleapis.com/storage/v1/b/${e}/o`;async function Au(e,t,n=()=>{}){const s=[],o=async i=>{const a=new Tt(Bu(e));a.searchParams.append("prefix",t),a.searchParams.append("maxResults","1000"),i&&a.searchParams.append("pageToken",i);const r=await Iu(a.toString());if(r.kind!=="storage#objects")throw new Error("GCS did not return a list of objects!");s.push(...r.items),r.items.forEach(l=>n(l)),r.nextPageToken&&await o(r.nextPageToken)};return await o(),s}const Fu=async(e,t=()=>{})=>{const[n,s]=Mu(e);return Au(n,s,t)},Nu=async(e,{execute:t,done:n})=>{const{uriSrc:s}=e;if(s&&ku(s.uri))try{return await Fu(s.uri,o=>{t({uriSrc:{uri:o.mediaLink,name:o.name},parent:e})}),n()}catch(o){throw new Error(`Could not download GCS URI ${s.uri}`,{cause:o instanceof Error?o:void 0})}return e},$u=async(e,{done:t})=>{if(!e.fileSrc)return e;const{fileSrc:n}=e;if(!Un.has(n.fileType))return e;const o=await Un.get(n.fileType)(n.file),i=rt();if(o.isA("vtkImageData")){const a=Oe().addVTKImageData(n.file.name,o);return i.add(a,[e]),t({dataID:a,dataSource:e,dataType:"image"})}if(o.isA("vtkPolyData")){const a=cs().addVTKPolyData(n.file.name,o);return i.add(a,[e]),t({dataID:a,dataSource:e,dataType:"model"})}throw new Error("Data reader did not produce a valid dataset")},Uu=C.object({url:C.string(),name:C.optional(C.string())}),Hu=C.object({resources:C.array(Uu)});async function Wu(e){const t=new TextDecoder,n=await e.arrayBuffer(),s=t.decode(new Uint8Array(n));return Hu.parse(JSON.parse(s))}const zu=async(e,{done:t,execute:n})=>{const{fileSrc:s}=e;if((s==null?void 0:s.fileType)==="application/json"){const o=[];try{(await Wu(s.file)).resources.forEach(a=>{o.push({uriSrc:{uri:a.url,name:a.name??new URL(a.url).pathname},parent:e})})}catch{return e}return o.forEach(i=>{n(i)}),t()}return e};function ju(e,t){t.classHierarchy.push("vtkLabelMap"),t.colorMap===null&&(t.colorMap={0:[0,0,0,0],1:[0,0,0,255]})}const Gu={colorMap:null};function ms(e,t,n={}){Object.assign(t,Gu,n),bi.extend(e,t,n),_.setGet(e,t,["colorMap"]),ju(e,t)}const Xu=_.newInstance(ms,"vtkLabelMap"),vs={newInstance:Xu,extend:ms},le={Coronal:"Coronal",Sagittal:"Sagittal",Axial:"Axial",Three:"3D"},ys={[le.Coronal]:{viewType:"2D",props:{viewDirection:"Right",viewUp:"Superior"}},[le.Sagittal]:{viewType:"2D",props:{viewDirection:"Posterior",viewUp:"Superior"}},[le.Axial]:{viewType:"2D",props:{viewDirection:"Superior",viewUp:"Anterior"}},[le.Three]:{viewType:"3D",props:{viewDirection:"Posterior",viewUp:"Superior"}}},qu=ys[le.Axial];[{name:"Axial Only",direction:Ie.H,items:[le.Axial]},{name:"Axial Primary",direction:Ie.V,items:[le.Axial,{direction:Ie.H,items:[le.Three,le.Coronal,le.Sagittal]}]},{name:"3D Primary",direction:Ie.V,items:[le.Three,{direction:Ie.H,items:[le.Coronal,le.Sagittal,le.Axial]}]},{name:"Quad View",direction:Ie.H,items:[{direction:Ie.V,items:[le.Coronal,le.Three]},{direction:Ie.V,items:[le.Sagittal,le.Axial]}]},{name:"3D Only",direction:Ie.H,items:[le.Three]}].reduce((e,t)=>({...e,[t.name]:t}),{});const kt={0:[0,0,0,0],1:[153,153,0,255],2:[76,76,0,255],3:[255,255,0,255],4:[0,76,0,255],5:[0,153,0,255],6:[0,255,0,255],7:[76,0,0,255],8:[153,0,0,255],9:[255,0,0,255],10:[0,76,76,255],11:[0,153,153,255],12:[0,255,255,255],13:[0,0,76,255],14:[0,0,153,255]},Ku=["#58f24c","#8de4d3","#f0a4b1","#a3c9fe","#c8f251","#fea53b"],Yu={red:{color:"red"},green:{color:"#00ff00"},white:{color:"#ffffff"}},Qu={artifact:{color:"#888888",fillColor:"#ffbf0040"},innocuous:{color:"#00ff00",fillColor:"#00ff0020"},lesion:{color:"red",fillColor:"transparent"}},Wo={CT:"CT-AAA",MR:"CT-Coronary-Arteries-2",US:"US-Fetal"},Zu=Uint8Array;function Ju(e){const t=new Zu(e.getNumberOfPoints()),n=vs.newInstance(e.get("spacing","origin","direction"));return n.getPointData().setScalars(Ti.newInstance({numberOfComponents:1,values:t})),n.setDimensions(e.getDimensions()),n.computeTransforms(),n.setColorMap(kt),n}function ed(e){const t=vs.newInstance(e.get("spacing","origin","direction","indexToWorld","worldToIndex","dataDescription","pointData"));return t.setDimensions(e.getDimensions()),t.computeTransforms(),t.setColorMap(kt),t}const hn=te("labelmap",{state:()=>({idList:[],labelmaps:Object.create(null),parentImage:Object.create(null)}),actions:{newLabelmapFromImage(e){const n=Oe().dataIndex[e];if(!n)return null;const s=_t().nextId(),o=Ju(n);return this.idList.push(s),this.parentImage[s]=e,this.labelmaps[s]=o,this.$proxies.addData(s,o),s},async serialize(e){const{labelMaps:t}=e.manifest,{zip:n}=e;await Promise.all(Object.entries(this.labelmaps).map(async([s,o])=>{const i=`labels/${s}.vti`,a=ds(this.parentImage[s]);t.push({id:s,parent:a,path:i});const r=await fl(o);n.file(i,r)}))},async deserialize(e,t,n){const{labelMaps:s}=e,o={};return s.forEach(async i=>{const[a]=t.filter(d=>St(d.archivePath,d.file.name)===wt(i.path)).map(d=>d.file);i.parent=n[i.parent];const{parent:r}=i,l=_t().nextId();o[i.id]=l;const c=await Fi(a),u=ed(c);this.idList.push(l),this.parentImage[l]=hs(r),this.labelmaps[l]=u,this.$proxies.addData(l,u)}),o}}});async function td(e,t,n,s=[{type:Ye.Image}]){const o=navigator.hardwareConcurrency?navigator.hardwareConcurrency:6,i=n[0],a=Math.min(parseInt(o/2,10),Math.max(i.size[i.size.length-1],1),4),r=a.toString(),l=[...Array(a).keys()].map(y=>{const f=[...[...Array(n.length).keys()].map(m=>m.toString()),"0",...t,"--max-total-splits",r,"--split",y.toString(),"--number-of-splits",r,"--memory-io"],p=n.map(m=>({type:Ye.Image,data:Ra(m)}));return[e,f,s,p,St("/","/itk/pipelines"),St("/","/itk/pipeline.worker.js")]}),c=new Da(o,ii),u=await c.runTasks(l).promise;c.terminateWorkers();const g=u.filter(y=>y.returnValue===0).map(({outputs:y})=>y[0].data);return Ea(g)}const nd=["size","direction","origin","spacing"];function od(e,t){return nd.map(s=>qn(e[s],t[s])).every(s=>s)}async function id(e,t){if(od(e,t))return t;const{size:n,spacing:s,origin:o,direction:i}=e,a=["--size",n.join(","),"--spacing",s.join(","),"--origin",o.join(","),"--direction",i.join(",")];return td("resample",a,[t])}const ws=e=>{throw new Error(`Unknown DataSelection: ${e}`)},sd=e=>e.type==="dicom"?e.volumeKey:e.type==="image"?e.dataID:ws(e),Pt=e=>{const t=sd(e);return`${e.type}::${t}`},kn=e=>{const[t,n]=e.split("::");return t==="dicom"?$t(n):t==="image"?Ut(n):ws(t)},xt=te("layer",()=>{const e=B({}),t=B({});async function n(g,y){if(!g)throw new Error("Tried to addLayer without parent data selection");const f=Pt(g),p=`${f}::${Pt(y)}`;this.parentToLayers[f]=[...this.parentToLayers[f]??[],{selection:y,id:p}];const[m,w]=await Promise.all([g,y].map(yu));if(!Or.intersects(m.getBounds(),w.getBounds()))throw this.deleteLayer(g,y),new Error("Image bounds do not intersect, so no overlap in physical space");const T=await id(un.convertVtkToItkImage(m),un.convertVtkToItkImage(w)),S=un.convertItkToVtkImage(T);this.$proxies.addData(p,S),this.layerImages[p]=S}async function s(g,y){return eo("Failed to build layer",()=>this._addLayer(g,y))}function o(g,y){if(!g)throw new Error("Tried to deleteLayer without parent data selection");const f=Pt(g),p=this.parentToLayers[f]??[],m=p.find(({selection:w})=>wu(w,y));m&&(this.parentToLayers[f]=p.filter(w=>w!==m),delete this.layerImages[m.id],this.$proxies.getData(m.id)&&this.$proxies.deleteData(m.id))}function i(g){if(!g)return[];const y=Pt(g);return e.value[y]??[]}const a=g=>Object.values(e.value).flat().flat().find(({id:y})=>y===g),r=g=>{const y=xt();y.getLayers(g).forEach(({selection:f})=>y.deleteLayer(g,f)),Object.keys(y.parentToLayers).map(f=>kn(f)).forEach(f=>y.deleteLayer(f,g))};Oe().$onAction(({name:g,args:y})=>{if(g!=="deleteData")return;const[f]=y,p=Ut(f);r(p)}),we().$onAction(({name:g,args:y})=>{if(g!=="deleteVolume")return;const[f]=y,p=$t(f);r(p)});function u(g){g.manifest.parentToLayers=Object.entries(this.parentToLayers).map(([y,f])=>({selectionKey:y,sourceSelectionKeys:f.map(({selection:p})=>Pt(p))}))}function d(g,y){const f=m=>{if(m.type==="dicom")return $t(y[m.volumeKey]);if(m.type==="image")return Ut(y[m.dataID]);const w=m;throw new Error(`invalid selection type ${w}`)},{parentToLayers:p}=g;p.forEach(({selectionKey:m,sourceSelectionKeys:w})=>{const T=f(kn(m));w.forEach(S=>{const b=f(kn(S));this.addLayer(T,b)})})}return{parentToLayers:e,layerImages:t,_addLayer:n,addLayer:s,deleteLayer:o,getLayers:i,getLayer:a,serialize:u,deserialize:d}});function Ss(e){const t=Oe();if(e&&e in t.metadata){const{lpsOrientation:n}=t.metadata[e],s=t.dataIndex[e];if(s){const o=s.getSpatialExtent();return{Sagittal:He(o,"Sagittal",n),Coronal:He(o,"Coronal",n),Axial:He(o,"Axial",n)}}}return Qi()}function re(){const e=Yt(),t=we(),n=Oe(),s=xt(),o=x(()=>{const{primarySelection:u}=e,{volumeToImageID:d}=t;return(u==null?void 0:u.type)==="image"?u.dataID:(u==null?void 0:u.type)==="dicom"&&d[u.volumeKey]||null}),i=x(()=>{const{metadata:u}=n,d=o.value;return d?u[d]:ls()}),a=x(()=>{if(o.value)return n.dataIndex[o.value]}),r=x(()=>Ss(o.value)),l=x(()=>!!e.primarySelection&&!e.primaryDataset),c=x(()=>s.getLayers(e.primarySelection).filter(({id:u})=>u in s.layerImages));return{currentImageData:a,currentImageID:o,currentImageMetadata:i,currentImageExtent:r,isImageLoading:l,currentLayers:c}}function Mn(e,t){return[Math.max(t[0],Math.min(t[1],e[0])),Math.max(t[0],Math.min(t[1],e[1]))]}function dt(e,t,n,s){const{indexToWorld:o,orientation:i,lpsOrientation:a}=t,r=[0,0,0],l=a[n];r[l]=e[n][s],pe(r,r,o);const c=-(s*2-1),u=[...i.slice(l*3,l*3+3).map(d=>d*c)];return Vr.newInstance({origin:r,normal:u})}const Ct=te("crop",()=>{const e=Oe(),t=je({croppingByImageID:{}}),n=c=>x(()=>{const u=j(c);if(u&&u in t.croppingByImageID&&u in e.metadata){const d=t.croppingByImageID[u],g=e.metadata[u];return[dt(d,g,"Sagittal",0),dt(d,g,"Sagittal",1),dt(d,g,"Coronal",0),dt(d,g,"Coronal",1),dt(d,g,"Axial",0),dt(d,g,"Axial",1)]}return null}),s=(c,u)=>{const d=Ss(c);return{Sagittal:Mn(u.Sagittal,d.Sagittal),Coronal:Mn(u.Coronal,d.Coronal),Axial:Mn(u.Axial,d.Axial)}},o=(c,u)=>{t.croppingByImageID[c]=s(c,u)},i=(c,u,d)=>{c in t.croppingByImageID&&o(c,{...t.croppingByImageID[c],[u]:d})},a=c=>{const u=e.dataIndex[c];if(!u)return;const{lpsOrientation:d}=e.metadata[c],g=u.getSpatialExtent();o(c,{Sagittal:He(g,"Sagittal",d),Coronal:He(g,"Coronal",d),Axial:He(g,"Axial",d)})};function r(c){const{tools:u}=c.manifest;u.crop=t.croppingByImageID}function l(c,u){const d=c.tools.crop;Object.entries(d).forEach(([g,y])=>{const f=u[g];o(f,y)})}return{croppingByImageID:La(t.croppingByImageID),getComputedVTKPlanes:n,setCropping:o,setCroppingForAxis:i,resetCropping:a,serialize:r,deserialize:l}});function ad(){return Ci.createBuilder().addField({name:"placed",initialValue:!1}).addField({name:"indexToWorld",initialValue:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}).addField({name:"worldToIndex",initialValue:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}).addStateFromMixin({labels:["handle"],mixins:["origin","bounds"],name:"handle",initialValues:{origin:null}}).build()}function rd(e,t){return t.map((n,s)=>Math.max(e[s*2],Math.min(e[s*2+1],n)))}function ld(e,t){t.classHierarchy.push("vtkCrosshairsWidgetProp");let n=!1;_.setGet(e,t,["manipulator"]);function s(o){return o.altKey||o.controlKey||o.shiftKey}e.handleLeftButtonPress=o=>!t.pickable||s(o)?_.VOID:(t.widgetState.setPlaced(!0),n=!0,t._interactor.requestAnimation(e),t._apiSpecificRenderWindow.setCursor("crosshairs"),e.invokeStartInteractionEvent(),e.handleMouseMove(o),_.EVENT_ABORT),e.handleMouseMove=o=>{if((!t.widgetState.getPlaced()||n)&&t.pickable&&t.manipulator&&!s(o)){const i=t.manipulator.handleEvent(o,t._apiSpecificRenderWindow),a=t.widgetState.getHandle(),r=t.widgetState.getWorldToIndex(),l=t.widgetState.getIndexToWorld();if(r.length&&l.length){const c=Le(),u=Le(),d=a.getBounds();pe(c,i,r);const g=rd(d,c);return pe(u,g,l),a.setOrigin(u),e.invokeInteractionEvent(),_.EVENT_ABORT}}return _.VOID},e.handleLeftButtonRelease=()=>{n&&t.pickable&&(t._interactor.cancelAnimation(e),t._apiSpecificRenderWindow.setCursor("default"),e.invokeEndInteractionEvent()),n=!1},e.grabFocus=()=>{},e.loseFocus=()=>{}}function cd(e,t){t.classHierarchy.push("vtkCrosshairsWidget"),t.behavior=ld,t.widgetState=ad(),e.getRepresentationsForViewType=n=>{switch(n){case Ze.DEFAULT:case Ze.GEOMETRY:case Ze.SLICE:case Ze.VOLUME:default:return[]}},t.widgetState.onBoundsChange(n=>{const s=[(n[0]+n[1])*.5,(n[2]+n[3])*.5,(n[4]+n[5])*.5];t.widgetState.getHandle().setOrigin(s)}),t.manipulator=Ge.newInstance()}const ud={};function _s(e,t,n={}){Object.assign(t,ud,n),fn.extend(e,t,n),_.setGet(e,t,["manipulator"]),cd(e,t)}const dd=_.newInstance(_s,"vtkCrosshairsWidget"),hd={newInstance:dd,extend:_s};function bt(e,t,n,s){t in e||(e[t]={}),e[t][n]={...e[t][n],...s}}function Qt(e,t){Object.keys(e).forEach(n=>{delete e[n][t]})}function Zt(e,t,n){var s;return t==null||n==null?null:(s=e[t])==null?void 0:s[n]}const gd=(e,t,n)=>{const s=e.manifest.datasets.map(i=>i.id),{views:o}=e.manifest;o.forEach(i=>{s.forEach(a=>{var c;const{config:r}=i,l=(c=t[i.id])==null?void 0:c[a];if(l!==void 0){const u=rl(a,r,{});u[n]=l}})})},Jt=(e,t)=>n=>{gd(n,e,t)},oo=()=>({slice:0,min:0,max:1,axisDirection:"Inferior"}),Rt=te("viewSlice",()=>{const e=je({}),t=(l,c)=>Zt(e,l,c),n=(l,c,u)=>{const d={...oo(),...t(l,c),...u};d.slice=Bi(d.slice,d.min,d.max),bt(e,l,c,d)},s=(l,c)=>{const u=t(l,c);u&&n(l,c,{slice:Math.ceil((u.min+u.max)/2)})},o=l=>{delete e[l]},i=(l,c)=>{var u;c?(u=e[c])==null||delete u[l]:Qt(e,l)},a=Jt(e,"slice");return{configs:e,getConfig:t,updateConfig:n,resetSlice:s,removeView:o,removeData:i,serialize:a,deserialize:(l,c)=>{Object.entries(c).forEach(([u,d])=>{d.slice&&n(l,u,d.slice)})}}}),Cs=()=>({width:1,level:.5,min:0,max:1}),io=te("windowing",()=>{const e=je({}),t=B(!0),n=d=>{t.value=d},s=(d,g)=>Zt(e,d,g),o=(d,g)=>{var f;if(!t.value)return;const y=(f=e[d])==null?void 0:f[g];y&&Object.keys(e).filter(p=>p!==d).forEach(p=>{bt(e,p,g,y)})},i=(d,g,y)=>{var f;bt(e,d,g,{...Cs(),...(f=e[d])==null?void 0:f[g],...y}),t.value&&o(d,g)},a=(d,g)=>{var m;const y=(m=e[d])==null?void 0:m[g];if(y==null)return;const f=y.max-y.min,p=(y.max+y.min)/2;i(d,g,{width:f,level:p})},r=d=>{delete e[d]},l=(d,g)=>{var y;g?(y=e[g])==null||delete y[d]:Qt(e,d)},c=Jt(e,"window");return{configs:e,getConfig:s,setSyncAcrossViews:n,updateConfig:i,resetWindowLevel:a,removeView:r,removeData:l,serialize:c,deserialize:(d,g)=>{Object.entries(g).forEach(([y,f])=>{f.window&&i(d,y,f.window)})}}});function bs(e,t){var s,o;const n=(o=(s=t.getRenderWindow())==null?void 0:s.getViews())==null?void 0:o[0];if(n){const[i,a,r]=e;return n.worldToDisplay(i,a,r,t)}return null}function fd(e,t){const n=t.getCanvas();if(!n)return null;const s=n.getBoundingClientRect(),o=n.width/s.width,i=n.height/s.height;return[o*(e.clientX-s.left),i*(s.height-e.clientY+s.top)]}function pd(e,t,n,s){var a;const o=(a=t.getRenderWindow())==null?void 0:a.getViews()[0];if(!o)return null;const i=fd(e,o);return i?kr(i[0],i[1],n,s,t,o):null}function Ht(e,t){var o,i;const n=bs(e,t),s=(i=(o=t.getRenderWindow())==null?void 0:o.getViews())==null?void 0:i[0];if(n&&s){const[,a]=s.getViewportSize(t);return[n[0]/devicePixelRatio,(a-n[1])/devicePixelRatio]}return null}function so(e){var o,i,a;const{pokedRenderer:t}=e,n=(i=(o=t==null?void 0:t.getRenderWindow())==null?void 0:o.getViews())==null?void 0:i[0],s=(a=n==null?void 0:n.getContainer())==null?void 0:a.getBoundingClientRect();return!("position"in e)||!s?null:[s.left+e.position.x/devicePixelRatio,s.top+s.height-e.position.y/devicePixelRatio]}function md(e,t,n){const s=pn.getPresetByName(e);if(s.OpacityPoints){const o=s.OpacityPoints,i=[];for(let c=0;c<o.length;c+=2)i.push([o[c],o[c+1]]);const[a,r]=t,l=r-a;return i.map(([c,u])=>[(c-a)/l+n,u])}return null}function Ts(e){return pn.getPresetByName(e).OpacityPoints?{mode:Ee.Mode.Points,preset:e,shift:0}:{mode:Ee.Mode.Gaussians,gaussians:JSON.parse(JSON.stringify(Ee.Defaults.Gaussians))}}function Is(e){const t=pn.getPresetByName(e);if(!t)return null;const{AbsoluteRange:n,RGBPoints:s}=t;if(n&&s){let o=1/0,i=-1/0;for(let a=0;a<s.length;a+=4)o=Math.min(o,s[a]),i=Math.max(i,s[a]);return[o,i]}return null}const vd=[{Name:"CT-AAA",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,143.556,0,166.222,.686275,214.389,.696078,419.736,.833333,3071,.803922],RGBPoints:[-3024,0,0,0,143.556,.615686,.356863,.184314,166.222,.882353,.603922,.290196,214.389,1,1,1,419.736,1,.937033,.954531,3071,.827451,.658824,1],EffectiveRange:[143.556,419.736]},{Name:"CT-AAA2",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,129.542,0,145.244,.166667,157.02,.5,169.918,.627451,395.575,.8125,1578.73,.8125,3071,.8125],RGBPoints:[-3024,0,0,0,129.542,.54902,.25098,.14902,145.244,.6,.627451,.843137,157.02,.890196,.47451,.6,169.918,.992157,.870588,.392157,395.575,1,.886275,.658824,1578.73,1,.829256,.957922,3071,.827451,.658824,1],EffectiveRange:[0,1600]},{Name:"CT-Bone",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-16.4458,0,641.385,.715686,3071,.705882],RGBPoints:[-3024,0,0,0,-16.4458,.729412,.254902,.301961,641.385,.905882,.815686,.552941,3071,1,1,1],EffectiveRange:[-16.4458,641.385]},{Name:"CT-Bones",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-1e3,0,152.19,0,278.93,.190476,952,.2],RGBPoints:[-1e3,.3,.3,1,-488,.3,1,.3,463.28,1,0,0,659.15,1,.912535,.0374849,953,1,.3,.3],EffectiveRange:[152.19,952]},{Name:"CT-Cardiac",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-77.6875,0,94.9518,.285714,179.052,.553571,260.439,.848214,3071,.875],RGBPoints:[-3024,0,0,0,-77.6875,.54902,.25098,.14902,94.9518,.882353,.603922,.290196,179.052,1,.937033,.954531,260.439,.615686,0,0,3071,.827451,.658824,1],EffectiveRange:[-77.6875,260.439]},{Name:"CT-Cardiac2",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,42.8964,0,163.488,.428571,277.642,.776786,1587,.754902,3071,.754902],RGBPoints:[-3024,0,0,0,42.8964,.54902,.25098,.14902,163.488,.917647,.639216,.0588235,277.642,1,.878431,.623529,1587,1,1,1,3071,.827451,.658824,1],EffectiveRange:[42.8964,1587]},{Name:"CT-Cardiac3",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-86.9767,0,45.3791,.169643,139.919,.589286,347.907,.607143,1224.16,.607143,3071,.616071],RGBPoints:[-3024,0,0,0,-86.9767,0,.25098,1,45.3791,1,0,0,139.919,1,.894893,.894893,347.907,1,1,.25098,1224.16,1,1,1,3071,.827451,.658824,1],EffectiveRange:[-86.9767,1224.16]},{Name:"CT-Chest-Contrast-Enhanced",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,67.0106,0,251.105,.446429,439.291,.625,3071,.616071],RGBPoints:[-3024,0,0,0,67.0106,.54902,.25098,.14902,251.105,.882353,.603922,.290196,439.291,1,.937033,.954531,3071,.827451,.658824,1],EffectiveRange:[67.0106,439.291]},{Name:"CT-Chest-Vessels",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-1278.35,0,22.8277,.428571,439.291,.625,3071,.616071],RGBPoints:[-3024,0,0,0,-1278.35,.54902,.25098,.14902,22.8277,.882353,.603922,.290196,439.291,1,.937033,.954531,3071,.827451,.658824,1],EffectiveRange:[-1278.35,439.291]},{Name:"CT-Coronary-Arteries",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,136.47,0,159.215,.258929,318.43,.571429,478.693,.776786,3661,1],RGBPoints:[-2048,0,0,0,136.47,0,0,0,159.215,.159804,.159804,.159804,318.43,.764706,.764706,.764706,478.693,1,1,1,3661,1,1,1],EffectiveRange:[136.47,478.693]},{Name:"CT-Coronary-Arteries-2",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,142.677,0,145.016,.116071,192.174,.5625,217.24,.776786,384.347,.830357,3661,.830357],RGBPoints:[-2048,0,0,0,142.677,0,0,0,145.016,.615686,0,.0156863,192.174,.909804,.454902,0,217.24,.972549,.807843,.611765,384.347,.909804,.909804,1,3661,1,1,1],EffectiveRange:[142.677,384.347]},{Name:"CT-Coronary-Arteries-3",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,128.643,0,129.982,.0982143,173.636,.669643,255.884,.857143,584.878,.866071,3661,1],RGBPoints:[-2048,0,0,0,128.643,0,0,0,129.982,.615686,0,.0156863,173.636,.909804,.454902,0,255.884,.886275,.886275,.886275,584.878,.968627,.968627,.968627,3661,1,1,1],EffectiveRange:[128.643,584.878]},{Name:"CT-Cropped-Volume-Bone",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,-451,0,-450,1,1050,1,3661,1],RGBPoints:[-2048,0,0,0,-451,0,0,0,-450,.0556356,.0556356,.0556356,1050,1,1,1,3661,1,1,1],EffectiveRange:[-451,1050]},{Name:"CT-Fat",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-1e3,0,-100,0,-99,.15,-60,.15,-59,0,101.2,0,952,0],RGBPoints:[-1e3,.3,.3,1,-497.5,.3,1,.3,-99,0,0,1,-76.946,0,1,0,-65.481,.835431,.888889,.0165387,83.89,1,0,0,463.28,1,0,0,659.15,1,.912535,.0374849,2952,1,.300267,.299886],EffectiveRange:[-100,101.2]},{Name:"CT-Liver-Vasculature",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,149.113,0,157.884,.482143,339.96,.660714,388.526,.830357,1197.95,.839286,3661,.848214],RGBPoints:[-2048,0,0,0,149.113,0,0,0,157.884,.501961,.25098,0,339.96,.695386,.59603,.36886,388.526,.854902,.85098,.827451,1197.95,1,1,1,3661,1,1,1],EffectiveRange:[149.113,1197.95]},{Name:"CT-Lung",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-1e3,0,-600,0,-599,.15,-400,.15,-399,0,2952,0],RGBPoints:[-1e3,.3,.3,1,-600,0,0,1,-530,.134704,.781726,.0724558,-460,.929244,1,.109473,-400,.888889,.254949,.0240258,2952,1,.3,.3],EffectiveRange:[-600,-399]},{Name:"CT-MIP",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-637.62,0,700,1,3071,1],RGBPoints:[-3024,0,0,0,-637.62,1,1,1,700,1,1,1,3071,1,1,1],EffectiveRange:[-637.62,700]},{Name:"CT-Muscle",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-155.407,0,217.641,.676471,419.736,.833333,3071,.803922],RGBPoints:[-3024,0,0,0,-155.407,.54902,.25098,.14902,217.641,.882353,.603922,.290196,419.736,1,.937033,.954531,3071,.827451,.658824,1],EffectiveRange:[-155.407,419.736]},{Name:"CT-Pulmonary-Arteries",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,-568.625,0,-364.081,.0714286,-244.813,.401786,18.2775,.607143,447.798,.830357,3592.73,.839286],RGBPoints:[-2048,0,0,0,-568.625,0,0,0,-364.081,.396078,.301961,.180392,-244.813,.611765,.352941,.0705882,18.2775,.843137,.0156863,.156863,447.798,.752941,.752941,.752941,3592.73,1,1,1],EffectiveRange:[-568.625,447.798]},{Name:"CT-Soft-Tissue",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,-167.01,0,-160,1,240,1,3661,1],RGBPoints:[-2048,0,0,0,-167.01,0,0,0,-160,.0556356,.0556356,.0556356,240,1,1,1,3661,1,1,1],EffectiveRange:[-167.01,240]},{Name:"CT-Air",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,.705882,-900,.715686,-500,0,3071,0],RGBPoints:[-3024,1,1,1,-900,.2,1,1,-500,.3,.3,1,3071,0,0,0],EffectiveRange:[-1200,-200]},{Name:"CT-X-ray",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-200,0,1500,.05,3071,.05],RGBPoints:[-3024,1,1,1,3071,1,1,1],EffectiveRange:[-250,1550]},{Name:"MR-Angio",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,151.354,0,158.279,.4375,190.112,.580357,200.873,.732143,3661,.741071],RGBPoints:[-2048,0,0,0,151.354,0,0,0,158.279,.74902,.376471,0,190.112,1,.866667,.733333,200.873,.937255,.937255,.937255,3661,1,1,1],EffectiveRange:[151.354,200.873]},{Name:"MR-Default",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[0,0,20,0,40,.15,120,.3,220,.375,1024,.5],RGBPoints:[0,0,0,0,20,.168627,0,0,40,.403922,.145098,.0784314,120,.780392,.607843,.380392,220,.847059,.835294,.788235,1024,1,1,1],EffectiveRange:[0,220]},{Name:"MR-MIP",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[0,0,98.3725,0,416.637,1,2800,1],RGBPoints:[0,1,1,1,98.3725,1,1,1,416.637,1,1,1,2800,1,1,1],EffectiveRange:[0,416.637]},{Name:"MR-T2-Brain",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[0,0,36.05,0,218.302,.171429,412.406,1,641,1],RGBPoints:[0,0,0,0,98.7223,.956863,.839216,.192157,412.406,0,.592157,.807843,641,1,1,1],EffectiveRange:[0,412.406]},{Name:"DTI-FA-Brain",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[0,0,0,0,.3501,.0158,.49379,.7619,.6419,1,.992,1,.995,0,.995,0],RGBPoints:[0,1,0,0,0,1,0,0,.24974,.4941,1,0,.49949,0,.9882,1,.7492,.51764,0,1,.995,1,0,0,.995,1,0,0],EffectiveRange:[0,1]},{Name:"US-Fetal",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-10,0,0,0,270,.8],RGBPoints:[-10,.325,.153,.153,74,.474,.392,.302,136,.718,.51,.443,270,.76,.44,.53],EffectiveRange:[-10,270]},{ColorSpace:"Lab",Name:"2hot",RGBPoints:[-1,.0416667,0,0,-.873016,.208333,0,0,-.746032,.375,0,0,-.619048,.541667,0,0,-.492063,.708333,0,0,-.365079,.854137,0,0,-.238095,.937488,.039062,0,-.111111,1,.208333,0,.015873,1,.375,0,.142857,1,.541667,0,.269841,1,.708333,0,.396825,1,.858805,.03125,.52381,1,.947392,.15625,.650794,1,1,.3125,.777778,1,1,.5625,.904762,1,1,.8125,1,1,1,1]}];function yd(e){for(let t=0;t<e.length;t+=1)pn.addPreset(e[t])}yd(vd);const wd=[{group:"CT",presets:["CT-AAA","CT-AAA2","CT-Bone","CT-Bones","CT-Cardiac","CT-Cardiac2","CT-Cardiac3","CT-Chest-Contrast-Enhanced","CT-Chest-Vessels","CT-Coronary-Arteries","CT-Coronary-Arteries-2","CT-Coronary-Arteries-3","CT-Cropped-Volume-Bone","CT-Fat","CT-Liver-Vasculature","CT-Lung","CT-MIP","CT-Muscle","CT-Pulmonary-Arteries","CT-Soft-Tissue","CT-Air","CT-X-ray"]},{group:"MR",presets:["MR-Default","MR-Angio","MR-MIP","MR-T2-Brain"]},{group:"DTI",presets:["DTI-FA-Brain"]},{group:"US",presets:["US-Fetal"]}],Hn="CT-AAA";wd.flatMap(e=>e.presets);const Sd={PT:"2hot"};function _d(e){const n=xt().getLayer(e);if(n&&n.selection.type==="dicom"){const s=we(),{Modality:o=void 0}=s.volumeInfo[n.selection.volumeKey];return o&&Sd[o]||Hn}return Hn}const zo=()=>({colorBy:{arrayName:"",location:"pointData"},transferFunction:{preset:"",mappingRange:[0,1]},opacityFunction:{mode:Ee.Mode.Gaussians,gaussians:[],mappingRange:[0,1]},blendConfig:{opacity:.6}}),xs=te("layerColoring",()=>{const e=je({}),t=(f,p)=>Zt(e,f,p),n=(f,p,m)=>{const w={...zo(),...t(f,p),...m};bt(e,f,p,w)},s=(f,p=ki)=>(m,w,T)=>{const S=t(m,w)??zo(),b=p({...S[f],...T});n(m,w,{[f]:b})},o=s("colorBy"),i=s("transferFunction"),a=s("opacityFunction"),r=s("blendConfig"),l=(f,p,m)=>{const T=xt().layerImages[p];if(!T)return;const S=T.getPointData().getScalars().getRange(),b=Is(m);i(f,p,{preset:m,mappingRange:b||S});const E=Ts(m);E.mappingRange=S,a(f,p,E)},c=(f,p,m)=>{const w=m.getPointData().getScalars();o(f,p,{arrayName:w.getName()+p,location:"pointData"}),l(f,p,_d(p))},u=f=>{delete e[f]},d=(f,p)=>{var m;p?(m=e[p])==null||delete m[f]:Qt(e,f)},g=Jt(e,"layers");return{configs:e,getConfig:t,updateConfig:n,updateColorBy:o,updateColorTransferFunction:i,updateOpacityFunction:a,updateBlendConfig:r,resetToDefault:c,setColorPreset:l,removeView:u,removeData:d,serialize:g,deserialize:(f,p)=>{Object.entries(p).forEach(([m,w])=>{w.layers&&n(f,m,w.layers)})}}}),ao=te("viewCamera",()=>{const e=je({}),t=(r,l)=>Zt(e,r,l),n=(r,l,c)=>{const u={...t(r,l),...c};bt(e,r,l,u)},s=r=>{delete e[r]},o=(r,l)=>{var c;l?(c=e[l])==null||delete c[r]:Qt(e,r)},i=Jt(e,"camera");return{configs:e,getConfig:t,updateConfig:n,removeView:s,removeData:o,serialize:i,deserialize:(r,l)=>{Object.entries(l).forEach(([c,u])=>{u.camera&&n(r,c,u.camera)})}}}),Cd=.2,bd=.7,Td=.3;function Id(e){const t=we();if(e in t.imageIDToVolumeKey){const n=t.imageIDToVolumeKey[e],{Modality:s}=t.volumeInfo[n];if(s in Wo)return Wo[s]}return Hn}const jo=()=>({colorBy:{arrayName:"",location:"pointData"},transferFunction:{preset:"",mappingRange:[0,1]},opacityFunction:{mode:Ee.Mode.Gaussians,gaussians:[],mappingRange:[0,1]},cvr:{enabled:!0,lightFollowsCamera:!0,volumeQuality:2,useVolumetricScatteringBlending:!0,volumetricScatteringBlending:.5,useLocalAmbientOcclusion:!0,laoKernelRadius:5,laoKernelSize:15,ambient:Cd,diffuse:bd,specular:Td}}),xd=te("volumeColoring",()=>{const e=je({}),t=(f,p)=>Zt(e,f,p),n=(f,p,m)=>{const w={...jo(),...t(f,p),...m};bt(e,f,p,w)},s=(f,p=ki)=>(m,w,T)=>{const S=t(m,w)??jo(),b=p({...S[f],...T});n(m,w,{[f]:b})},o=s("colorBy"),i=s("transferFunction"),a=s("opacityFunction"),r=s("cvr"),l=(f,p,m)=>{const T=Oe().dataIndex[p];if(!T)return;const S=T.getPointData().getScalars().getRange(),b=Is(m);i(f,p,{preset:m,mappingRange:b||S});const E=Ts(m);E.mappingRange=S,a(f,p,E)},c=(f,p,m)=>{const w=m.getPointData().getScalars();o(f,p,{arrayName:w.getName(),location:"pointData"}),l(f,p,Id(p))},u=f=>{delete e[f]},d=(f,p)=>{var m;p?(m=e[p])==null||delete m[f]:Qt(e,f)},g=Jt(e,"volumeColorConfig");return{configs:e,getConfig:t,updateConfig:n,updateColorBy:o,updateColorTransferFunction:i,updateOpacityFunction:a,updateCVRParameters:r,resetToDefaultColoring:c,setColorPreset:l,removeView:u,removeData:d,serialize:g,deserialize:(f,p)=>{Object.entries(p).forEach(([m,w])=>{w.volumeColorConfig&&n(f,m,w.volumeColorConfig)})}}}),Go=te("viewConfig",()=>{const e=Rt(),t=io(),n=xs(),s=ao(),o=xd(),i=u=>{e.removeView(u),t.removeView(u),n.removeView(u),s.removeView(u),o.removeView(u)},a=(u,d)=>{e.removeData(u,d),t.removeData(u,d),n.removeData(u,d),s.removeData(u,d),o.removeData(u,d)},r=u=>{e.serialize(u),t.serialize(u),n.serialize(u),s.serialize(u),o.serialize(u)},l=(u,d,g)=>{const y={};Object.entries(d).forEach(([f,p])=>{const m=g[f];y[m]=p}),e.deserialize(u,y),t.deserialize(u,y),n.deserialize(u,y),s.deserialize(u,y),o.deserialize(u,y)};return Oe().$onAction(({name:u,args:d})=>{if(u==="deleteData"){const[g]=d;a(g)}}),{removeView:i,removeData:a,serialize:r,deserialize:l}}),he=te("view",{state:()=>({layout:{direction:Ie.V,items:[]},viewSpecs:structuredClone(ys)}),getters:{viewIDs(e){return Object.keys(e.viewSpecs)},getViewProxy(){return e=>this.$proxies.getView(e)},getDataRepresentationForView(){return(e,t)=>this.$proxies.getDataRepresentationForView(e,t)}},actions:{createOrGetViewProxy(e,t){return this.$proxies.getView(e)??this.$proxies.createView(e,t)},addView(e){e in this.viewSpecs||(this.viewSpecs[e]=structuredClone(qu))},removeView(e){e in this.viewSpecs&&(delete this.viewSpecs[e],this.$proxies.removeView(e))},setLayout(e){this.layout=e;const t=[e];for(;t.length;)t.shift().items.forEach(s=>{typeof s=="string"?this.addView(s):t.push(s)})},serialize(e){const t=Go(),{manifest:n}=e,{views:s}=n;n.layout=this.layout,Object.entries(this.viewSpecs).forEach(([o,i])=>{const a=i.viewType,{props:r}=i,c={id:o,type:a,props:r,config:{}};s.push(c)}),t.serialize(e)},deserialize(e,t){const n=Go();e.forEach(s=>{const o=s.id,i={viewType:s.type,props:s.props};this.viewSpecs[o]=i;const{config:a}=s;n.deserialize(o,a,t)})}}}),Wt=te("crosshairs",()=>{const e=hd.newInstance(),t=e.getWidgetState(),n=t.getHandle(),s=B(!1),{currentImageID:o,currentImageMetadata:i}=re(),a=B([0,0,0]),r=x(()=>{const w=Le();return pe(w,a.value,i.value.worldToIndex),w}),l=Rt(),c=he(),u=x(()=>{const w=j(o);return w?c.viewIDs.filter(T=>!!l.getConfig(T,w)):[]});function d(){return e}function g(w){a.value=w}F(r,w=>{if(s.value){const T=j(o),{lpsOrientation:S}=j(i);if(!T)return;u.value.forEach(b=>{const P=l.getConfig(b,T),E=be(P.axisDirection),k=S[E],L=Math.round(w[k]);l.updateConfig(b,T,{slice:L})})}}),F(i,w=>{t.setIndexToWorld(w.indexToWorld),t.setWorldToIndex(w.worldToIndex);const[T,S,b]=w.dimensions,P=[0,T-1,0,S-1,0,b-1];n.setBounds(Mr(P,.5))},{immediate:!0}),n.onModified(()=>{const w=n.getOrigin();w&&(a.value=w)});function y(){return t.setPlaced(!1),s.value=!0,!0}function f(){s.value=!1}function p(w){const{crosshairs:T}=w.manifest.tools;T.position=a.value}function m(w){const{crosshairs:T}=w.tools;a.value=T.position}return{getWidgetFactory:d,setPosition:g,position:a,imagePosition:r,activateTool:y,deactivateTool:f,serialize:p,deserialize:m}}),Rd=4,Dd=1,ct=te("paint",()=>{const e=B(null),t=B(Rd),n=B(Dd),s=B([]),o=B(1),i=B(!1),{currentImageID:a}=re();function r(){return this.$paint.factory}const l=x(()=>e.value?hn().labelmaps[e.value]??null:null);function c(E){if(!E){e.value=null;return}const k=hn(),L=Object.entries(k.parentImage).find(([,$])=>E===$);L?[e.value]=L:e.value=k.newLabelmapFromImage(E)}function u(E){t.value=Math.round(E),this.$paint.setBrushSize(E)}function d(E){n.value=E,this.$paint.setBrushValue(E)}function g(E){o.value=Math.min(1,Math.max(0,E))}function y(E){if(!l.value)return;const k=s.value.length-1;if(k>=0){const L=s.value[k],$=k>=1?s.value[k-1]:void 0;this.$paint.paintLabelmap(l.value,E,L,$)}}function f(E){if(!l.value)return;const k=l.value.getSpacing();k.splice(E,1);const L=[1/k[0],1/k[1]];this.$paint.setBrushScale(L)}function p(E,k){s.value=[si(E)],y.call(this,k)}function m(E,k){s.value.push(E),y.call(this,k)}function w(E,k){s.value.push(E),y.call(this,k)}function T(){const E=a.value;return E?(c(E),this.$paint.setBrushSize(this.brushSize),i.value=!0,!0):!1}function S(){e.value=null,i.value=!1}function b(E){const{paint:k}=E.manifest.tools;k.activeLabelmapID=e.value,k.brushSize=t.value,k.brushValue=n.value,k.labelmapOpacity=o.value}function P(E,k){const{paint:L}=E.tools;this.setBrushSize(L.brushSize),this.setBrushValue(L.brushValue),this.setLabelmapOpacity(L.labelmapOpacity),i.value=E.tools.current===ce.Paint,L.activeLabelmapID!==null&&(e.value=k[L.activeLabelmapID])}return F(a,E=>{i.value&&c(E)}),{activeLabelmapID:e,brushSize:t,brushValue:n,strokePoints:s,labelmapOpacity:o,isActive:i,getWidgetFactory:r,activateTool:T,deactivateTool:S,selectOrCreateLabelmap:c,setBrushSize:u,setBrushValue:d,setLabelmapOpacity:g,setSliceAxis:f,startStroke:p,placeStrokePoint:m,endStroke:w,serialize:b,deserialize:P}}),Xo=Le();function Sn(e,t,n){const s=(n==null?void 0:n.epsilon)??Gn,o=(n==null?void 0:n.allowNonIntegralSlice)??!1,i=(n==null?void 0:n.allowOutOfBoundsSlice)??!1,{planeNormal:a,planeOrigin:r}=e,{dimensions:l,lpsOrientation:c,worldToIndex:u}=t;let d=null;const{Left:g,Right:y,Posterior:f,Anterior:p,Superior:m,Inferior:w}=c;if(at(g,a)||at(y,a)?d="Sagittal":at(f,a)||at(p,a)?d="Coronal":(at(m,a)||at(w,a))&&(d="Axial"),!d)return null;pe(Xo,r,u);const T=c[d],S=ll(Xo[T],s);return!o&&!Number.isInteger(S)||!i&&(S<0||S>=l[T])?null:{axis:d,slice:S}}const Ed={labelName:"New Label"},Ld=e=>{const t=B({}),n=B(),s=d=>{n.value=d},o=(d={})=>{const g=_t().nextId();return t.value[g]={...Ed,...e,...d},s(g),g},i=d=>{if(!(d in t.value))throw new Error("Label does not exist");if(delete t.value[d],t.value={...t.value},d===n.value){const g=Object.keys(t.value);g.length!==0?s(g[0]):s("")}},a=(d,g)=>{if(!(d in t.value))throw new Error("Label does not exist");t.value={...t.value,[d]:{...t.value[d],...g}}},r=B(!0),l=()=>{r.value&&(t.value={}),r.value=!1},c=(d,g=!0)=>{g&&l();const{labelName:y}=d,f=Object.entries(t.value).find(([,{labelName:p}])=>p===y);if(f){const[p]=f;return a(p,d),p}return o(d)};return{labels:t,activeLabel:n,setActiveLabel:s,addLabel:o,deleteLabel:i,updateLabel:a,mergeLabel:c,mergeLabels:(d,g=!0)=>{Object.entries(d??{}).forEach(([y,f])=>c({...f,labelName:y},g))}}},Pd=()=>({frameOfReference:{planeOrigin:[0,0,0],planeNormal:[1,0,0]},slice:-1,imageID:"",placing:!1,color:Ku[0],name:"baseAnnotationTool"}),ro=({toolDefaults:e,initialLabels:t,newLabelDefault:n})=>{const s=B([]),o=B(Object.create(null)),i=x(()=>{const m=o.value;return s.value.map(w=>m[w])}),a=Ld(n);a.mergeLabels(t,!1);function r(m){if(!m)return{labelName:""};const w=a.labels.value[m];return w||{labelName:""}}function l(m){const w=_t().nextId();if(w in o.value)throw new Error("Cannot add tool with conflicting ID");return o.value[w]={...Pd(),...e(),label:a.activeLabel.value,...m,...r(m.label),id:w},s.value.push(w),w}function c(m){m in o.value&&(Nt(s.value,m),delete o.value[m])}function u(m,w){m in o.value&&(o.value[m]={...o.value[m],...w,id:m})}F(a.labels,()=>{s.value.forEach(m=>{const w=o.value[m],T=r(w.label);u(m,{...w,...T})})});function d(m){const w=o.value[m],{currentImageID:T,currentImageMetadata:S}=re(),b=T.value;if(!b||w.imageID!==b)return;const P=Sn(w.frameOfReference,S.value);if(!P)return;const E=he(),k=E.viewIDs.filter($=>{const Z=E.viewSpecs[$].props.viewDirection;return Z&&be(Z)===P.axis}),L=Rt();k.forEach($=>{L.updateConfig($,b,{slice:w.slice})})}const g=()=>!0,y=()=>{},f=()=>({tools:s.value.map(w=>o.value[w]).filter(w=>!w.placing).map(({imageID:w,...T})=>({imageID:ds(w),...T})),labels:a.labels.value});function p(m,w){const T=Object.fromEntries(Object.entries((m==null?void 0:m.labels)??{}).map(([S,b])=>{const P=a.mergeLabel(b);return[S,P]}));m==null||m.tools.map(({imageID:S,label:b,...P})=>({...P,imageID:hs(w[S]),label:b&&T[b]||""})).forEach(S=>l.call(this,S))}return{...a,toolIDs:s,toolByID:o,tools:i,addTool:l,removeTool:c,updateTool:u,jumpToTool:d,activateTool:g,deactivateTool:y,serialize:f,deserialize:p}},Od=()=>({firstPoint:[0,0,0],secondPoint:[0,0,0],id:"",name:"Ruler"}),Vd={color:"#ffffff"},We=te("ruler",()=>{const{toolIDs:e,toolByID:t,tools:n,addTool:s,updateTool:o,removeTool:i,jumpToTool:a,serialize:r,deserialize:l,activateTool:c,deactivateTool:u,...d}=ro({toolDefaults:Od,initialLabels:Yu,newLabelDefault:Vd}),g=x(()=>{const p=t.value;return e.value.reduce((m,w)=>{const{firstPoint:T,secondPoint:S}=p[w];return Object.assign(m,{[w]:Math.sqrt(Ii(T,S))})},{})});function y(p){p.manifest.tools.rulers=r()}function f(p,m){l.call(this,p.tools.rulers,m)}return{...d,rulerIDs:e,rulerByID:t,rulers:n,lengthByID:g,addRuler:s,updateRuler:o,removeRuler:i,jumpToRuler:a,serialize:y,deserialize:f,activateTool:c,deactivateTool:u}}),kd=()=>({firstPoint:[0,0,0],secondPoint:[0,0,0],id:"",name:"Rectangle",fillColor:"transparent"}),Md={color:"#ffffff",fillColor:"transparent"},ze=te("rectangles",()=>{const{serialize:e,deserialize:t,...n}=ro({toolDefaults:kd,initialLabels:Qu,newLabelDefault:Md});function s(i){i.manifest.tools.rectangles=e()}function o(i,a){t.call(this,i.tools.rectangles,a)}return{...n,serialize:s,deserialize:o}});function Rs(){return{t:pt(),_tInv:null}}const Mt=Le(),qo=ri();function _n(e,t,n){const s=n??Le();return ci(Mt,e[0],e[1],0),pe(s,Mt,t.t),s}function Ds(e){const t=pt();return Pa(t,e),t}function Bd(e){return e._tInv=e._tInv??Ds(e.t),e._tInv}function tt(e,t,n){const s=n??Ae(),o=Bd(t);return pe(Mt,e,o),mt(s,Mt[0],Mt[1]),s}function Ad(e){const t=[0,0,0];pe(t,t,e.t);const n=[0,0,1];return Oa(qo,e.t),Va(n,n,qo),ka(n,n),{planeNormal:n,planeOrigin:t}}const Fd={0:Ot(0,1,0,0,0,0,1,0,1,0,0,0,0,0,0,1),1:Ot(1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1),2:pt()};function Nd(e,t,n){const s=pt();return Ma(s,[0,0,t]),Do(s,Fd[n],s),Do(s,e,s),{t:s,_tInv:Ds(s)}}var ye=(e=>(e.Select="Select",e.FreehandDraw="FreehandDraw",e.CircleNudge="CircleNudge",e.PointPlacing="PointPlacing",e.Threshold="Threshold",e))(ye||{});const $d=()=>({id:"",name:"Contour",polyLine:[],referencePlane:Rs()}),Cn=te("contour",()=>{const e=B(),t=B("FreehandDraw"),{serialize:n,deserialize:s,...o}=ro({toolDefaults:$d,initialLabels:{"Default label":{color:"#ff0000"}},newLabelDefault:{color:"#ff0000"}});function i(l){e.value=l}function a(l){return e.value===l&&(e.value=null),o.removeTool(l)}function r(l){t.value=l}return{...o,removeTool:a,serialize:()=>{},deserialize:()=>{},selectedContourID:e,mode:t,selectContour:i,setMode:r}});function Es(e){return e===ce.Ruler?We():e===ce.Rectangle?ze():e===ce.Paint?ct():e===ce.Crosshairs?Wt():e===ce.Contour?Cn():null}function Ud(e){const t=Es(e);return t?t.activateTool():!0}function Hd(e){const t=Es(e);t&&t.deactivateTool()}const ke=te("tool",{state:()=>({currentTool:ce.WindowLevel}),actions:{setCurrentTool(e){Ud(e)&&(Hd(this.currentTool),this.currentTool=e)},serialize(e){const{tools:t}=e.manifest,n=We(),s=ze(),o=Wt(),i=ct(),a=Ct();n.serialize(e),s.serialize(e),o.serialize(e),i.serialize(e),a.serialize(e),t.current=this.currentTool},deserialize(e,t,n){const{tools:s}=e,o=We(),i=ze(),a=Wt(),r=ct(),l=Ct();o.deserialize(e,n),i.deserialize(e,n),a.deserialize(e),r.deserialize(e,t),l.deserialize(e,n),this.currentTool=s.current}}}),Ls="manifest.json";async function Wd(e){const t=await il(e);return Oi.has(t.type)?(await li.loadAsync(t)).file(Ls)!==null:!1}const lo=(e,{done:t})=>t({dataSource:e}),bn=async e=>{let t=e;const{fileSrc:n}=t;if(n&&n.fileType===""){const s=await Vi(n.file);s&&(t={...t,fileSrc:{...n,fileType:s}})}return t},zd=async(e,{extra:t,done:n})=>{const{uriSrc:s}=e;if(s){const o=await new wn([gs,bn,lo]).execute(e,t);if(!o.ok)throw o.errors[0].cause;return n({dataSource:o.data[0].dataSource})}return e},jd=async(e,{execute:t})=>{const{fileSrc:n,parent:s}=e;if(!n&&s){const o=await t(s);if(!o.ok)throw new Error("Could not process parent",{cause:cl(o.errors[0].cause)});return{...e,parent:o.data[0].dataSource}}return e},Gd=async(e,{extra:t,done:n})=>{if(e.archiveSrc){const o=await new wn([ps,bn,lo]).execute(e,t);if(!o.ok)throw o.errors[0].cause;return n({dataSource:o.data[0].dataSource})}return e};function Xd(e,t,n){const s=n.filter(i=>wt(i.archivePath)===wt(e.path)).map(i=>is(i.file)),o=t.remoteFiles[e.id]??[];return[...s,...o]}async function qd(e,t,{extra:n,execute:s}){const o=new Map,i=t.map(c=>({...c,archivePath:wt(c.archivePath)})),{datasets:a}=e,r={},l=new wn([bn,zd,jd,Gd,lo]);return await Promise.all(a.map(async c=>{let u=Xd(c,e,i);u=await Promise.all(u.map(async y=>{const f=await l.execute(y,{...n,archiveCache:o});if(!f.ok)throw f.errors[0].cause;return f.data[0].dataSource}));const d=[],g=await Promise.all(u.map(y=>s(y,{...n,archiveCache:o,dicomDataSources:d})));if(d.length){const y=we(),f=await y.importFiles(d);if(f.length!==1)throw new Error("Obtained more than one volume from DICOM import");const[p]=f;await y.buildVolume(p),r[c.id]=p}else if(g.length===1){if(!g[0].ok)throw g[0].errors[0].cause;const[y]=g;if(y.data.length!==1)throw new Error("Import encountered multiple volumes for a single dataset");const{dataID:f}=y.data[0];if(!f)throw new Error("Failed to import dataset");r[c.id]=f}else throw new Error("Could not load any data from the session")})),r}const Kd=async(e,{done:t,extra:n,execute:s})=>{const{fileSrc:o}=e;if(o&&await Wd(o.file)){const i=await no(o.file),[a,r]=vn(d=>d.file.name===Ls,i);if(a.length!==1)throw new Error("State file does not have exactly 1 manifest");const l=hu.parse(JSON.parse(await a[0].file.text()));he().setLayout(l.layout);const c=await qd(l,r,{extra:n,execute:s,done:t});if(l.primarySelection!==void 0){const d=c[l.primarySelection];let g;d in we().volumeInfo?g=$t(d):g=Ut(d),Yt().setPrimarySelection(g)}he().deserialize(l.views,c);const u=await hn().deserialize(l,r,c);return ke().deserialize(l,u,c),xt().deserialize(l,c),t()}return e},Ps=C.string(),co=C.object({color:Ps}),Yd=co,Qd=C.intersection(co,C.object({fillColor:Ps})),Zd=C.object({labels:C.record(co).or(C.null()).optional(),rulerLabels:C.record(Yd).or(C.null()).optional(),rectangleLabels:C.record(Qd).or(C.null()).optional()}),Jd=async e=>{const t=new TextDecoder,n=await e.arrayBuffer(),s=t.decode(new Uint8Array(n));return Zd.parse(JSON.parse(s))},eh=e=>{const t=n=>n===void 0?e.labels:n;We().mergeLabels(t(e.rulerLabels)),ze().mergeLabels(t(e.rectangleLabels))},th=async(e,{done:t})=>{const{fileSrc:n}=e;if((n==null?void 0:n.fileType)==="application/json"){try{const s=await Jd(n.file);eh(s)}catch{return e}return t()}return e};function nh(e){if(e.data.length===0)return null;const{dataID:t,dataType:n}=e.data[0];return t?n==="dicom"?$t(t):n==="image"?Ut(t):null:null}function oh(e){const t=String(e);return!t||t==="[object Object]"?"Unknown error. More details in the dev console.":t}const ih=()=>{throw new Error("Failed to handle resource")};async function sh(e){const t=[bn,th,Kd,zu,Nu,Vu,gs,ps,xu,_u,$u,ih],n={fetchFileCache:new Map,dicomDataSources:[]},s=new wn(t),o=await Promise.all(e.map(r=>s.execute(r,n)));if(!n.dicomDataSources.length)return o;const i={dicomSrc:{sources:n.dicomDataSources}},a={ok:!0,data:[],errors:[]};try{const r=await we().importFiles(n.dicomDataSources);a.data.push(...r.map(l=>({dataID:l,dataType:"dicom",dataSource:i})))}catch(r){a.ok=!1,a.errors.push({message:oh(r),cause:r,inputDataStackTrace:[i]})}return[...o.filter(r=>r.data.length),a]}const ah={name:"ToolButton",props:{icon:{type:String,required:!0},name:{type:String,required:!0},size:{type:[Number,String],default:40},buttonClass:[String,Array,Object],tooltipLocation:{type:String,default:"right"}},computed:{sizeV(){return Number(this.size)},iconSize(){return Math.floor(.6*this.sizeV)},classV(){const e=this.buttonClass;return typeof e=="string"?e:Array.isArray(e)?e.join(" "):e&&Object.keys(e).length?Object.keys(this.buttonClass).filter(t=>this.buttonClass[t]).join(" "):""}}};function rh(e,t,n,s,o,i){return I(),Y(ft,Gt({variant:"text",rounded:0,dark:"",height:i.sizeV,width:i.sizeV,"min-width":i.sizeV,"max-width":i.sizeV,class:i.classV},e.$attrs),{default:R(()=>[v(vt,{size:i.iconSize},{default:R(()=>[H(U(n.icon),1)]),_:1},8,["size"]),v(pi,{location:n.tooltipLocation,activator:"parent",transition:"slide-x-transition"},{default:R(()=>[h("span",null,U(n.name),1)]),_:1},8,["location"]),Ce(e.$slots,"default")]),_:3},16,["height","width","min-width","max-width","class"])}const $e=A(ah,[["render",rh]]),Os=Symbol("ItemGroup"),Vs=X({props:{modelValue:null,mandatory:Boolean,equalsTest:Function},setup(e,{emit:t,slots:n}){const{modelValue:s,mandatory:o,equalsTest:i}=ae(e),a=B();return F(s,c=>{c!==a.value&&(a.value=c)}),ne(()=>{a.value=s.value}),Fn(Os,{selectItem:c=>{o.value&&!c||(a.value=c,t("update:modelValue",a.value))},isSelected:c=>a.value==null?!1:i.value?i.value(c,a.value):c===a.value}),()=>{var c;return(c=n.default)==null?void 0:c.call(n)}}}),ks=X({props:{value:{type:null,required:!0}},setup(e,{slots:t}){const{value:n}=ae(e),s=It(Os);if(!s)throw new Error("GroupableItem needs ItemGroup!");const o=()=>{s.selectItem(n.value)},i=()=>{s&&s.selectItem(s.isSelected(n.value)?void 0:n.value)};return()=>{var a;return(a=t.default)==null?void 0:a.call(t,{active:s.isSelected(n.value),select:o,toggle:i})}}});function Ms(e){return`#${e.map(n=>`0${n.toString(16)}`.slice(-2)).join("")}`}function lh(e){const t=e.startsWith("#")?e.substring(1):e,n=[0,0,0,255],s=Math.min(4,t.length/2);for(let o=0;o<s;o++)n[o]=Number.parseInt(t.substring(2*o,2*o+2),16);return n}function ch(e,t=5){const n={},s=[],o=Object.entries(e);for(;o.length;){const[i,a]=o.shift(),r=Ms(a).toUpperCase();n[r]=Number(i);let l=s[s.length-1];(!l||l.length===t)&&(l=[],s.push(l)),l.push(r)}return{hexToValue:n,swatches:s}}const uh=X({name:"PaintControls",setup(){const e=ct(),{hexToValue:t,swatches:n}=ch(kt,3),s=x(()=>{const c=e.brushValue;return c in kt?Ms(kt[c]):null}),o=c=>{const u=`${c}FF`.toUpperCase();u in t&&e.setBrushValue(t[u])},i=x(()=>e.brushSize),a=c=>{e.setBrushSize(Number(c))},r=x(()=>e.labelmapOpacity);return{brushSize:i,setBrushSize:a,swatches:n,brushColor:s,setBrushColor:o,opacity:r,setOpacity:c=>{e.setLabelmapOpacity(Number(c))}}}});function dh(e,t,n,s,o,i){return I(),Y(Xt,{width:"350px"},{default:R(()=>[v(vi,null,{default:R(()=>[v(cn,{"no-gutters":"",align:"center"},{default:R(()=>[v(Vt,null,{default:R(()=>[v(Eo,{"model-value":e.brushSize,"onUpdate:modelValue":e.setBrushSize,density:"compact","hide-details":"",label:"Size",min:"1",max:"50"},{append:R(()=>[v(Nn,{"model-value":e.brushSize,onInput:e.setBrushSize,variant:"underlined",class:"mt-n1 pt-0",style:{width:"40px"},"hide-details":"",type:"number",min:"1",max:"50"},null,8,["model-value","onInput"])]),_:1},8,["model-value","onUpdate:modelValue"])]),_:1})]),_:1}),v(cn,{"no-gutters":"",align:"center"},{default:R(()=>[v(Vt,null,{default:R(()=>[v(Eo,{"model-value":e.opacity,"onUpdate:modelValue":e.setOpacity,density:"compact","hide-details":"",label:"Opacity",min:"0",max:"1",step:"0.01"},{append:R(()=>[v(Nn,{"model-value":e.opacity,onInput:e.setOpacity,variant:"underlined",class:"mt-n1 pt-0",style:{width:"40px"},"hide-details":"",type:"number",min:"0",max:"1",step:"0.1"},null,8,["model-value","onInput"])]),_:1},8,["model-value","onUpdate:modelValue"])]),_:1})]),_:1}),v(cn,{"no-gutters":"",align:"center"},{default:R(()=>[v(Vt,null,{default:R(()=>[v(mi,{"hide-canvas":"","hide-inputs":"","hide-mode-switch":"","hide-sliders":"","show-swatches":"",elevation:"0",swatches:e.swatches,"model-value":e.brushColor,"onUpdate:modelValue":e.setBrushColor},null,8,["swatches","model-value","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})}const Bs=A(uh,[["render",dh],["__scopeId","data-v-6027fe65"]]),hh=X({name:"MenuToolButton",props:{icon:{type:String,required:!0},name:{type:String,required:!0},size:{type:[Number,String],default:40},active:Boolean,disabled:Boolean,mobileOnlyMenu:Boolean},components:{ToolButton:$e},setup(e){const t=yi(),n=x(()=>!t.mobile.value),s=B(!1),o=x(()=>!e.mobileOnlyMenu||t.mobile.value);F(s,a=>{s.value=a&&o.value});const i=x(()=>e.active);return F(i,a=>{a||(s.value=!1)}),{showLeft:n,menuOn:s,enableMenu:o}}});const gh={class:"menu-content elevation-24"};function fh(e,t,n,s,o,i){const a=O("tool-button");return I(),Y(yt,{"no-click-animation":"","close-on-content-click":!1,modelValue:e.menuOn,"onUpdate:modelValue":t[1]||(t[1]=r=>e.menuOn=r),location:e.showLeft?"left":"right",class:"overflow-auto"},{activator:R(({props:r})=>[v(a,Gt({icon:e.icon,name:e.name,buttonClass:["tool-btn",e.active?"tool-btn-selected":""],disabled:e.disabled,size:e.size,onClick:t[0]||(t[0]=l=>e.$emit("click"))},r),{default:R(()=>[e.active&&e.enableMenu?(I(),Y(vt,{key:0,class:N([e.showLeft?"menu-more-left":"menu-more-right"]),size:"18"},{default:R(()=>[H(U(e.showLeft?"mdi-menu-left":"mdi-menu-right"),1)]),_:1},8,["class"])):z("",!0)]),_:2},1040,["icon","name","buttonClass","disabled","size"])]),default:R(()=>[h("div",gh,[Ce(e.$slots,"default",{},void 0,!0)])]),_:3},8,["modelValue","location"])}const As=A(hh,[["render",fh],["__scopeId","data-v-b1e30b7b"]]),ph=X({components:{ToolButton:$e},setup(){const{currentImageID:e}=re(),t=Ct();return{resetCrop:()=>{const s=e.value;s&&t.resetCropping(s)}}}});function mh(e,t,n,s,o,i){const a=O("tool-button");return I(),Y(Xt,{dark:""},{default:R(()=>[v(a,{size:"40",icon:"mdi-restore",name:"Reset Crop",onClick:e.resetCrop},null,8,["onClick"])]),_:1})}const Fs=A(ph,[["render",mh]]),vh={class:"d-flex flex-row"},yh={class:"flex-grow-1 d-flex flex-column justify-space-between mr-4"},wh=X({__name:"LabelEditor",props:{label:null,labelsStore:null},emits:["close"],setup(e,{emit:t}){const n=e,s=x(()=>n.labelsStore.labels[n.label]),o=B(s.value.labelName);F(o,r=>{n.labelsStore.updateLabel(n.label,{labelName:r})});const i=B(ul(s.value.color));F(i,r=>{n.labelsStore.updateLabel(n.label,{color:r})});const a=()=>{t("close"),n.labelsStore.deleteLabel(n.label)};return(r,l)=>(I(),Y(Xt,null,{default:R(()=>[v(sr,{class:"d-flex flex-row align-center"},{default:R(()=>[H(" Edit Label "),v(Lo),v(ft,{variant:"text",density:"compact",icon:"mdi-close",onClick:l[0]||(l[0]=c=>r.$emit("close"))})]),_:1}),v(rr,null,{default:R(()=>[h("div",vh,[h("div",yh,[h("div",null,[v(Nn,{modelValue:o.value,"onUpdate:modelValue":l[1]||(l[1]=c=>o.value=c),onKeydown:l[2]||(l[2]=ot(ue(c=>r.$emit("close"),["stop"]),["enter"])),label:"Name",class:"flex-grow-0"},null,8,["modelValue"])]),v(ar,{class:"mb-2 px-0"},{default:R(()=>[v(ft,{color:"secondary",variant:"elevated",onClick:l[3]||(l[3]=c=>r.$emit("close"))},{default:R(()=>[H(" Done ")]),_:1}),v(Lo),v(ft,{color:"red",variant:"tonal",onClick:a},{default:R(()=>[H(" Delete label ")]),_:1})]),_:1})]),v(mi,{modelValue:i.value,"onUpdate:modelValue":l[4]||(l[4]=c=>i.value=c),mode:"rgb",label:"Color"},null,8,["modelValue"])])]),_:1})]),_:1}))}}),Sh={class:"dot-container mr-3"},_h={class:"overflow-hidden"},Ch=X({__name:"LabelControls",props:{labelsStore:null},setup(e){const t=e,n=x(()=>Object.entries(t.labelsStore.labels)),s=x(()=>n.value.findIndex(([c])=>c===t.labelsStore.activeLabel)),o=B(void 0),i=()=>{o.value=t.labelsStore.addLabel()},a=B(!1);fe(()=>{a.value=!!o.value});const r=yi(),l=x(()=>r.mobile.value);return(c,u)=>(I(),D(se,null,[v(Xt,{class:"pt-2"},{default:R(()=>[v(wi,null,{default:R(()=>[H("Labels")]),_:1}),v(vi,null,{default:R(()=>[v(Si,{"model-value":j(s),"selected-class":"card-active",mandatory:""},{default:R(()=>[v(cn,{dense:""},{default:R(()=>[(I(!0),D(se,null,Re(j(n),([d,{labelName:g,color:y}])=>(I(),Y(Vt,{cols:"6",key:d},{default:R(()=>[v(ht,null,{default:R(({selectedClass:f,toggle:p})=>[v(Po,{variant:"tonal",class:N(["w-100 d-flex",f]),onClick:()=>{p(),e.labelsStore.setActiveLabel(d)}},{default:R(()=>[h("div",Sh,[h("div",{class:"color-dot",style:ee({background:y})},null,4)]),h("span",_h,U(g),1),v(ft,{icon:"mdi-pencil",density:"compact",class:"ml-auto",variant:"plain",onClick:ue(()=>{o.value=d,a.value=!0},["stop"])},null,8,["onClick"])]),_:2},1032,["class","onClick"])]),_:2},1024)]),_:2},1024))),128)),v(Vt,{cols:"6"},{default:R(()=>[v(Po,{variant:"outlined",class:"w-100",onClick:i},{default:R(()=>[v(vt,{class:"mr-2"},{default:R(()=>[H("mdi-plus")]),_:1}),H(" Add Label ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])]),_:1})]),_:1}),v(lr,{modelValue:a.value,"onUpdate:modelValue":u[1]||(u[1]=d=>a.value=d),width:j(l)?"100%":"50%"},{default:R(()=>[o.value?(I(),Y(wh,{key:0,onClose:u[0]||(u[0]=d=>o.value=void 0),label:o.value,labelsStore:e.labelsStore},null,8,["label","labelsStore"])):z("",!0)]),_:1},8,["modelValue","width"])],64))}});const uo=A(Ch,[["__scopeId","data-v-3ba66c80"]]),Ns=X({__name:"RulerControls",setup(e){const t=We();return(n,s)=>(I(),Y(uo,{"labels-store":j(t)},null,8,["labels-store"]))}}),$s=X({__name:"RectangleControls",setup(e){const t=ze();return(n,s)=>(I(),Y(uo,{"labels-store":j(t)},null,8,["labels-store"]))}}),Us=X({__name:"ContourControls",setup(e){const t=Cn(),{mode:n}=lt(t);function s(o){t.setMode(o)}return(o,i)=>(I(),Y(Xt,{dark:""},{default:R(()=>[v(wi,{class:"my-1"},{default:R(()=>[H("Tools")]),_:1}),v(Si,{mandatory:"","selected-class":"tool-btn-selected","model-value":j(n),"onUpdate:modelValue":s},{default:R(()=>[v(ht,{value:j(ye).Select},{default:R(({selectedClass:a,toggle:r})=>[v($e,{size:"40",icon:"mdi-cursor-default",name:"Select",buttonClass:a||"",onClick:r},null,8,["buttonClass","onClick"])]),_:1},8,["value"]),v(ht,{value:j(ye).FreehandDraw},{default:R(({selectedClass:a,toggle:r})=>[v($e,{size:"40",icon:"mdi-draw",name:"Freehand",buttonClass:a||"",onClick:r},null,8,["buttonClass","onClick"])]),_:1},8,["value"]),v(ht,{value:j(ye).PointPlacing},{default:R(({selectedClass:a,toggle:r})=>[v($e,{size:"40",icon:"mdi-vector-polyline",name:"Point Placing",buttonClass:a||"",onClick:r},null,8,["buttonClass","onClick"])]),_:1},8,["value"]),v(ht,{value:j(ye).Threshold},{default:R(({selectedClass:a,toggle:r})=>[v($e,{size:"40",icon:"mdi-math-integral",name:"Threshold",buttonClass:a||"",onClick:r},null,8,["buttonClass","onClick"])]),_:1},8,["value"]),v(ht,{value:j(ye).CircleNudge},{default:R(({selectedClass:a,toggle:r})=>[v($e,{size:"40",icon:"mdi-circle-multiple-outline",name:"Nudge",buttonClass:a||"",onClick:r},null,8,["buttonClass","onClick"])]),_:1},8,["value"])]),_:1},8,["model-value"]),v(uo,{"labels-store":j(t)},null,8,["labels-store"])]),_:1}))}});const bh=X({components:{ToolButton:$e,MenuToolButton:As,ItemGroup:Vs,GroupableItem:ks,PaintControls:Bs,CropControls:Fs,RulerControls:Ns,RectangleControls:$s,ContourControls:Us},setup(){const e=Yt(),t=ke();console.log(lt(t));const n=x(()=>!e.primaryDataset),s=x(()=>t.currentTool),o=ze(),i=We(),a=B(!1),r=B(!1);return Wn("Escape",()=>{a.value=!1,r.value=!1}),{currentTool:s,setCurrentTool:t.setCurrentTool,noCurrentImage:n,Tools:ce,paintMenu:a,cropMenu:r,rectangleStore:o,rulerStore:i}}});function Th(e,t,n,s,o,i){const a=O("tool-button"),r=O("groupable-item"),l=O("paint-controls"),c=O("menu-tool-button"),u=O("rectangle-controls"),d=O("ruler-controls"),g=O("contour-controls"),y=O("crop-controls"),f=O("item-group");return I(),Y(f,{mandatory:"","model-value":e.currentTool,"onUpdate:modelValue":t[0]||(t[0]=p=>e.setCurrentTool(p))},{default:R(()=>[v(r,{value:e.Tools.WindowLevel},{default:R(({active:p,toggle:m})=>[v(a,{icon:"mdi-circle-half-full",name:"Window & Level",buttonClass:["tool-btn",p?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),v(r,{value:e.Tools.Pan},{default:R(({active:p,toggle:m})=>[v(a,{icon:"mdi-cursor-move",name:"Pan",buttonClass:["tool-btn",p?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),v(r,{value:e.Tools.Zoom},{default:R(({active:p,toggle:m})=>[v(a,{icon:"mdi-magnify-plus-outline",name:"Zoom",buttonClass:["tool-btn",p?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),v(r,{value:e.Tools.Crosshairs},{default:R(({active:p,toggle:m})=>[v(a,{icon:"mdi-crosshairs",name:"Crosshairs",buttonClass:["tool-btn",p?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),v(r,{value:e.Tools.Paint},{default:R(({active:p,toggle:m})=>[v(c,{icon:"mdi-brush",name:"Paint",active:p,disabled:e.noCurrentImage,onClick:m},{default:R(()=>[v(l)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),v(r,{value:e.Tools.Rectangle},{default:R(({active:p,toggle:m})=>[v(c,{icon:"mdi-vector-square",name:"Rectangle",mobileOnlyMenu:!0,active:p,disabled:e.noCurrentImage,onClick:m},{default:R(()=>[v(u)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),v(r,{value:e.Tools.Ruler},{default:R(({active:p,toggle:m})=>[v(c,{icon:"mdi-ruler",name:"Ruler",mobileOnlyMenu:!0,active:p,disabled:e.noCurrentImage,onClick:m},{default:R(()=>[v(d)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),v(r,{value:e.Tools.Contour},{default:R(({active:p,toggle:m})=>[v(c,{icon:"mdi-shape-circle-plus",name:"Contour",active:p,disabled:e.noCurrentImage,onClick:m},{default:R(()=>[v(g)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),v(r,{value:e.Tools.Crop},{default:R(({active:p,toggle:m})=>[v(c,{icon:"mdi-crop",name:"Crop",active:p,disabled:e.noCurrentImage,onClick:m},{default:R(()=>[v(y)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"])]),_:1},8,["model-value"])}const Ih=A(bh,[["render",Th],["__scopeId","data-v-63968322"]]);function zt(e){Fe(()=>e.unsubscribe())}function xh(e,t=!1){const n=B(t);let s=!0;const o={position:[0,0,0],parallelScale:0};zt(e.onModified(()=>{if(s&&n.value){const r=e.getPosition(),l=e.getParallelScale();(!at(r,o.position)||l!==o.parallelScale)&&(n.value=!1)}}));function i(r){if(s){s=!1;try{r()}finally{s=!0}}}function a(){o.position=e.getPosition(),o.parallelScale=e.getParallelScale()}return{resizeToFit:n,ignoreResizeToFitTracking:i,resetResizeToFitTracking:a}}function Rh(e){if(!e||e==="none")return 0;const t=e.match(/matrix(?:3d)?\((.+)\)/)[1].split(",").map(s=>Number(s));return e.includes("3d")?t[13]:t[5]}const Dh={props:{slice:{type:Number,default:0},min:{type:Number,required:!0},max:{type:Number,required:!0},step:{type:Number,required:!0},handleHeight:{type:Number,default:20}},data(){return{maxHandlePos:0,dragging:!1,initialHandlePos:0,initialMousePosY:0,yOffset:0}},computed:{handlePosition(){const e=this.max-this.min<=0?1:this.max-this.min,t=this.maxHandlePos*((this.slice-this.min)/e);return this.dragging?this.draggingHandlePos:t},draggingHandlePos(){return Math.min(Math.max(0,this.initialHandlePos+this.yOffset),this.maxHandlePos)}},mounted(){this.updateMaxHandlePos(),this.resizeObserver=new ResizeObserver(e=>{e.length===1&&this.updateMaxHandlePos()}),this.resizeObserver.observe(this.$refs.handleContainer)},beforeUnmount(){this.resizeObserver.disconnect()},methods:{updateMaxHandlePos(){this.maxHandlePos=this.$refs.handleContainer.clientHeight-this.handleHeight},onDragStart(e){if(e.preventDefault(),this.dragging=!0,this.initialMousePosY=e.pageY,e.target===this.$refs.handle){const t=window.getComputedStyle(this.$refs.handle);this.initialHandlePos=Rh(t.transform)}else{const{y:t}=this.$refs.handleContainer.getBoundingClientRect();this.initialHandlePos=Math.max(0,Math.min(this.maxHandlePos,e.pageY-t-this.handleHeight/2));const n=this.getNearestSlice(this.initialHandlePos);this.$emit("input",n)}this.yOffset=0,this.$refs.handleContainer.setPointerCapture(e.pointerId)},onDragMove(e){if(!this.$refs.handleContainer.hasPointerCapture(e.pointerId))return;e.preventDefault(),this.yOffset=e.pageY-this.initialMousePosY;const t=this.getNearestSlice(this.handlePosition);this.$emit("input",t)},onDragEnd(e){if(!this.$refs.handleContainer.hasPointerCapture(e.pointerId))return;e.preventDefault(),this.$refs.handleContainer.releasePointerCapture(e.pointerId),this.dragging=!1;const t=this.getNearestSlice(this.handlePosition);this.$emit("input",t)},getNearestSlice(e){const n=e/this.maxHandlePos*(this.max-this.min)+this.min;return Math.round(n/this.step)*this.step}}},Eh=e=>(oe("data-v-45b64a9f"),e=e(),ie(),e),Lh=Eh(()=>h("div",{class:"slice-slider-track"},null,-1));function Ph(e,t,n,s,o,i){return I(),D("div",{class:"slice-slider",ref:"handleContainer",onPointerdown:t[0]||(t[0]=(...a)=>i.onDragStart&&i.onDragStart(...a)),onPointermove:t[1]||(t[1]=(...a)=>i.onDragMove&&i.onDragMove(...a)),onPointerup:t[2]||(t[2]=(...a)=>i.onDragEnd&&i.onDragEnd(...a)),onPointercancel:t[3]||(t[3]=(...a)=>i.onDragEnd&&i.onDragEnd(...a)),onContextmenu:t[4]||(t[4]=a=>a.preventDefault())},[Lh,h("div",{class:"slice-slider-handle",ref:"handle",style:ee({height:`${n.handleHeight}px`,transform:`translate3d(0, ${i.handlePosition}px, 0)`})},null,4)],544)}const Oh=A(Dh,[["render",Ph],["__scopeId","data-v-45b64a9f"]]),Vh="_gridRoot_102tk_2",kh="_row_102tk_9",Mh="_cell_102tk_16",Bh="_top_102tk_20",Ah="_left_102tk_21",Fh="_center_102tk_25",Nh="_middle_102tk_26",$h="_bottom_102tk_30",Uh="_right_102tk_31",Hh={gridRoot:Vh,row:kh,cell:Mh,top:Bh,left:Ah,center:Fh,middle:Nh,bottom:$h,right:Uh},Wh={};function zh(e,t){return I(),D("div",{class:N(e.$style.gridRoot)},[h("div",{class:N([e.$style.top,e.$style.row])},[h("div",{class:N([e.$style.left,e.$style.cell])},[Ce(e.$slots,"top-left")],2),h("div",{class:N([e.$style.center,e.$style.cell])},[Ce(e.$slots,"top-center")],2),h("div",{class:N([e.$style.right,e.$style.cell])},[Ce(e.$slots,"top-right")],2)],2),h("div",{class:N([e.$style.middle,e.$style.row])},[h("div",{class:N([e.$style.left,e.$style.cell])},[Ce(e.$slots,"middle-left")],2),h("div",{class:N([e.$style.center,e.$style.cell])},[Ce(e.$slots,"middle-center")],2),h("div",{class:N([e.$style.right,e.$style.cell])},[Ce(e.$slots,"middle-right")],2)],2),h("div",{class:N([e.$style.bottom,e.$style.row])},[h("div",{class:N([e.$style.left,e.$style.cell])},[Ce(e.$slots,"bottom-left")],2),h("div",{class:N([e.$style.center,e.$style.cell])},[Ce(e.$slots,"bottom-center")],2),h("div",{class:N([e.$style.right,e.$style.cell])},[Ce(e.$slots,"bottom-right")],2)],2)],2)}const jh={$style:Hh},Gh=A(Wh,[["render",zh],["__cssModules",jh]]);function Tn(e,t){const n=new ResizeObserver(s=>{s.length===1&&t(s[0])});return F(e,(s,o)=>{o&&n.unobserve(o),s&&n.observe(s)},{immediate:!0}),Pe(()=>{const s=j(e);s&&n.unobserve(s)}),n}function Se(e){return n=>{let s=null;const o=()=>{s==null||s.unsubscribe(),s=null};Fe(o),Ba(e)?fe(()=>{o(),e.value&&(s=e.value(n))}):e&&(s=e(n))}}function rn(e){return e.map((t,n)=>({value:t,axis:n})).filter(({value:t})=>Math.abs(t)>Gn).sort((t,n)=>Math.abs(n.value)-Math.abs(t.value)).map(({value:t,axis:n})=>(Math.sign(t)===1?"LPS":"RAI")[n]).join("")}function Xh(e){const t=x(()=>e.value.getCamera()),n=B(""),s=B(""),o=B(""),i=B("");function a(){const l=t.value.getViewUp(),c=t.value.getDirectionOfProjection(),u=[0,0,0];zn(u,c,l);const d=l.map(y=>y*-1),g=u.map(y=>y*-1);n.value=rn(l),i.value=rn(u),o.value=rn(d),s.value=rn(g)}return Se(x(()=>t.value.onModified))(a),a(),{top:n,right:i,bottom:o,left:s}}function qh(e,t,n){const s=x(()=>n.value.orientation),o=x(()=>Ji(s.value)),i=x(()=>o.value[j(e)]),a=x(()=>o.value[j(t)]);return{cameraDirVec:i,cameraUpVec:a}}function ln(e,t){return Math.min(t-e,1)/256}const Kh=X({name:"WindowLevelTool",props:{viewId:{type:String,required:!0}},setup(e){const{viewId:t}=ae(e),n=io(),s=he(),{currentImageID:o}=re(),i=x(()=>s.getViewProxy(t.value)),a=Cs(),r=x(()=>n.getConfig(t.value,o.value)),l=x(()=>({min:1e-12,max:r.value!=null?r.value.max-r.value.min:a.max,step:r.value!=null?ln(r.value.min,r.value.max):ln(a.min,a.max)})),c=x(()=>({min:r.value!=null?r.value.min:a.min,max:r.value!=null?r.value.max:a.max,step:r.value!=null?ln(r.value.min,r.value.max):ln(a.min,a.max)})),u=x(()=>r.value!=null?r.value.width:a.width),d=x(()=>r.value!=null?r.value.level:a.level),g=xi.newInstance({button:1,scrollEnabled:!1});F(i,(f,p)=>{p&&p.getInteractorStyle2D().removeMouseManipulator(g),f&&i.value.getInteractorStyle2D().addMouseManipulator(g)},{immediate:!0}),Pe(()=>{i.value.isDeleted()||i.value.getInteractorStyle2D().removeMouseManipulator(g)});function y(){g.removeAllListeners();const f=l.value,p=c.value;g.setVerticalListener(f.min,f.max,f.step,()=>u.value,m=>{o.value!=null&&n.updateConfig(t.value,o.value,{width:m})}),g.setHorizontalListener(p.min,p.max,p.step,()=>d.value,m=>{o.value!=null&&n.updateConfig(t.value,o.value,{level:m})})}return F(()=>JSON.stringify({w:l.value,l:c.value}),y,{immediate:!0}),()=>null}});function Yh(e){const t=ke();return x(()=>t.currentTool===ce.WindowLevel).value?jn(Kh,e):[]}const Qh=X({name:"SliceScrollTool",props:{viewId:{type:String,required:!0}},setup(e){const{viewId:t}=ae(e),n=Rt(),s=he(),{currentImageID:o}=re(),i=x(()=>s.getViewProxy(t.value)),a=oo(),r=x(()=>n.getConfig(t.value,o.value)),l=x(()=>({min:r.value!=null?r.value.min:a.min,max:r.value!=null?r.value.max:a.max,step:1,default:r.value!=null?r.value.slice:a.slice})),c=B(0),u=xi.newInstance({button:-1,scrollEnabled:!0});F(i,(g,y)=>{y&&y.getInteractorStyle2D().removeMouseManipulator(u),g&&i.value.getInteractorStyle2D().addMouseManipulator(u)},{immediate:!0}),Pe(()=>{i.value.isDeleted()||i.value.getInteractorStyle2D().removeMouseManipulator(u)});function d(){u.removeAllListeners();const g=l.value;u.setScrollListener(g.min,g.max,g.step,()=>c.value,y=>{o.value!==null&&n.updateConfig(t.value,o.value,{slice:y})})}return F(l,g=>{c.value=g.default,d()},{immediate:!0}),()=>null}}),Hs=X({name:"MouseManipulatorTool",props:{name:String,viewId:{type:String,required:!0},manipulatorClass:{type:Object,required:!0},options:{type:Array,default:()=>[]}},setup(e){const{viewId:t,options:n}=ae(e),s=he(),o=x(()=>s.getViewProxy(t.value)),i=x(()=>o.value.isA("vtkView2DProxy")?o.value.getInteractorStyle2D():o.value.getInteractorStyle3D()),a=[];function r(l,c,u){l!==null&&(u.forEach(d=>l.removeMouseManipulator(d)),c.forEach(d=>l.addMouseManipulator(d)))}return F(n,l=>{for(;a.length>l.length;){const u=a.pop();i.value.removeMouseManipulator(u),u.delete()}const c=Array.from(a);for(let u=a.length;u<l.length;++u)a.push(e.manipulatorClass.newInstance(l[u]));l.forEach((u,d)=>{"button"in u&&a[d].setButton(u.button),a[d].setShift(!!u.shift),a[d].setControl(!!u.control)}),r(i.value,a,c)},{immediate:!0}),F(i,(l,c)=>{a.forEach(u=>{c&&c.removeMouseManipulator(u),l&&l.addMouseManipulator(u)})},{immediate:!0}),Pe(()=>{o.value.isDeleted()||a.forEach(l=>i.value.removeMouseManipulator(l))}),()=>null}});function Zh(e){const t=ke(),n=[];return n.push({button:2}),n.push({button:1,shift:!0}),t.currentTool===ce.Pan&&n.push({button:1}),jn(Hs,{...e,name:"PanTool",manipulatorClass:Br,options:n})}function Jh(e){const t=ke(),n=[];return n.push({button:3,flipDirection:!0}),n.push({button:1,control:!0,flipDirection:!0}),t.currentTool===ce.Zoom&&n.push({button:1,flipDirection:!0}),jn(Hs,{...e,name:"ZoomTool",manipulatorClass:Ar,options:n})}var jt=(e=>(e.PlacingFirst="PlacingFirst",e.PlacingSecond="PlacingSecond",e.Select="Select",e.Dragging="Dragging",e))(jt||{});function Ko(e){return e.altKey||e.controlKey||e.shiftKey}function eg(e,t){t.classHierarchy.push("vtkRulerWidgetProp"),t.interactionState="Select";let n=null;_.setGet(e,t,["interactionState"]),_.setGet(e,t,["manipulator"]),_.event(e,t,"RightClickEvent"),_.event(e,t,"PlacedEvent"),e.deactivateAllHandles=()=>{t.widgetState.deactivate(),t.activeState=null},e.setFirstPoint=o=>{t.widgetState.getFirstPoint().setOrigin(o)},e.setSecondPoint=o=>{t.widgetState.getSecondPoint().setOrigin(o)};const s=e.setInteractionState;e.setInteractionState=o=>{const i=s(o);return i&&o==="PlacingFirst"&&(t.widgetState.setIsPlaced(!1),t.widgetState.getFirstPoint().setVisible(!1),t.widgetState.getSecondPoint().setVisible(!1)),i},e.resetInteractions=()=>{t._interactor.cancelAnimation(e,!0)},e.handleLeftButtonPress=o=>{var l;if(!t.manipulator||Ko(o))return _.VOID;const i=t._widgetManager.getActiveWidget();if(i&&i!==e)return _.VOID;const a=t.manipulator.handleEvent(o,t._apiSpecificRenderWindow);if(!a.length)return _.VOID;const r=e.getInteractionState();return r==="PlacingFirst"?(e.setFirstPoint(a),e.setSecondPoint(a),t.widgetState.getFirstPoint().setVisible(!0),t.widgetState.getSecondPoint().setVisible(!0),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),e.setInteractionState("PlacingSecond"),_.EVENT_ABORT):r==="PlacingSecond"?(e.setSecondPoint(a),t.widgetState.setIsPlaced(!0),e.setInteractionState("Select"),e.invokeEndInteractionEvent(),e.invokePlacedEvent(),t._interactor.cancelAnimation(e),_.EVENT_ABORT):(l=t.activeState)!=null&&l.getActive()&&t.pickable?(n=t.activeState,e.setInteractionState("Dragging"),t._apiSpecificRenderWindow.setCursor("grabbing"),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),_.EVENT_ABORT):_.VOID},e.handleMouseMove=o=>{const i=t.manipulator.handleEvent(o,t._apiSpecificRenderWindow);return i.length?e.getInteractionState()==="PlacingSecond"?(t.widgetState.getSecondPoint().setOrigin(i),t.widgetState.getSecondPoint().setVisible(!0),e.invokeInteractionEvent(),_.EVENT_ABORT):e.getInteractionState()==="Dragging"&&n?(n.setOrigin(i),e.invokeInteractionEvent(),_.EVENT_ABORT):_.VOID:_.VOID},e.handleLeftButtonRelease=o=>{if(n){const i=t.manipulator.handleEvent(o,t._apiSpecificRenderWindow);i.length&&n.setOrigin(i),n=null,e.setInteractionState("Select"),t._apiSpecificRenderWindow.setCursor("pointer"),t.widgetState.deactivate(),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent(),t._widgetManager.enablePicking()}},e.handleRightButtonPress=o=>Ko(o)||e.getInteractionState()!=="Select"||!t.activeState?_.VOID:(e.invokeRightClickEvent(o),_.EVENT_ABORT),e.grabFocus=()=>{throw new Error("grabFocus is not implemented")},e.loseFocus=()=>{throw new Error("loseFocus is not implemented")}}const tg=20;function ng(e,t,n,s){let o=n();const i=t.$subscribe(()=>{const r=n();(s?s(o,r):o!==r)&&(o=r,e.modified())}),a=e.delete;e.delete=()=>{i(),a()}}function og(e,t,{id:n,store:s,key:o,visible:i=!0}){Object.assign(t,{id:n,_store:s,key:o}),mn.extend(e,t,{}),Ri.extend(e,t,{visible:i}),Fr.extend(e,t,{scale1:tg});const a=()=>t._store.rulerByID[t.id],r=l=>t._store.updateRuler(t.id,l);e.getOrigin=()=>{var l;return(l=a())==null?void 0:l[t.key]},e.setOrigin=l=>{r({[t.key]:l}),e.modified()},ng(e,t._store,()=>{var l;return(l=a())==null?void 0:l[t.key]})}const Yo=_.newInstance(og,"vtkRulerWidgetStatePoint"),Ws="points";function Qo(e,t,n){let s=t.onModified(n);const o=e.delete;e.delete=()=>{s.unsubscribe(),s=null,o()}}function ig(e,t){const n=Yo({id:t.id,store:t._store,key:"firstPoint",visible:!0}),s=Yo({id:t.id,store:t._store,key:"secondPoint",visible:!0});Qo(e,n,()=>e.modified()),Qo(e,s,()=>e.modified()),t.labels={[Ws]:[n,s]},e.getFirstPoint=()=>n,e.getSecondPoint=()=>s}const sg=e=>({isPlaced:!1,...e});function ag(e,t,n){Object.assign(t,sg(n)),mn.extend(e,t,n),Di.extend(e,t),_.get(e,t,["id"]),_.setGet(e,t,["isPlaced"]),_.moveToProtected(e,t,["store"]),ig(e,t)}const rg=_.newInstance(ag,"vtkRulerWidgetState");function lg(e,t){t.classHierarchy.push("vtkRulerWidget"),e.getRepresentationsForViewType=()=>[{builder:Nr,labels:[Ws],initialValues:{scaleInPixels:!0}}],e.getLength=()=>{const n=t.widgetState.getFirstPoint().getOrigin(),s=t.widgetState.getSecondPoint().getOrigin();return!n||!s?0:Math.sqrt(Ii(n,s))},t.manipulator=Ge.newInstance()}const cg={};function zs(e,t,n={}){Object.assign(t,cg,n),fn.extend(e,t,{...n,behavior:eg,widgetState:rg(n)}),_.get(e,t,["manipulator"]),lg(e,t)}const ug=_.newInstance(zs,"vtkRulerWidget"),js={newInstance:ug,extend:zs};function en(e,t,n,s){const{lpsOrientation:o}=s,i=o[be(t)],a=o[t],r=[0,0,0];r[i]=n,pe(r,r,s.indexToWorld),e.setUserNormal(a),e.setUserOrigin(r)}const dg=X({props:{point1:Array,point2:Array,color:String,length:Number,viewId:{type:String,required:!0},textOffset:{type:Number,default:8},textSize:{type:Number,default:14}},setup(e){const{viewId:t,point1:n,point2:s,textOffset:o,length:i}=ae(e),a=B(),r=B(),l=he(),c=x(()=>l.getViewProxy(t.value)),u=()=>{const f=c.value.getRenderer(),p=j(n),m=j(s);if(p){const w=Ht(p,f);w&&(a.value={x:w[0],y:w[1]})}else a.value=null;if(m){const w=Ht(m,f);w&&(r.value={x:w[0],y:w[1]})}else r.value=null};Se(x(()=>c.value.getCamera().onModified))(u),F([c,n,s],u,{deep:!0,immediate:!0});const g=x(()=>{const f=j(a),p=j(r),m=o.value;return!f||!p?null:p.x>f.x?{dx:m,dy:-m,anchor:"start"}:{dx:-m,dy:-m,anchor:"end"}}),y=It(gn);return Tn(y,()=>{u()}),{devicePixelRatio,textdx:x(()=>{var f;return((f=g.value)==null?void 0:f.dx)??0}),textdy:x(()=>{var f;return((f=g.value)==null?void 0:f.dy)??0}),anchor:x(()=>{var f;return((f=g.value)==null?void 0:f.anchor)??"start"}),first:a,second:r,rulerLength:x(()=>{var f;return((f=i==null?void 0:i.value)==null?void 0:f.toFixed(2))??""})}}});const hg=["x1","y1","x2","y2","stroke"],gg=["cx","cy","stroke","r"],fg=["cx","cy","stroke","r"],pg=["x","y","dx","dy","text-anchor","font-size"];function mg(e,t,n,s,o,i){return I(),D("g",null,[e.first&&e.second?(I(),D("line",{key:0,x1:e.first.x,y1:e.first.y,x2:e.second.x,y2:e.second.y,stroke:e.color,"stroke-width":"1"},null,8,hg)):z("",!0),e.first?(I(),D("circle",{key:1,cx:e.first.x,cy:e.first.y,stroke:e.color,"stroke-width":"1",fill:"transparent",r:10/e.devicePixelRatio},null,8,gg)):z("",!0),e.second?(I(),D("circle",{key:2,cx:e.second.x,cy:e.second.y,stroke:e.color,"stroke-width":"1",fill:"transparent",r:10/e.devicePixelRatio,class:"handle"},null,8,fg)):z("",!0),e.second?(I(),D("text",{key:3,x:e.second.x,y:e.second.y,dx:e.textdx,dy:e.textdy,"text-anchor":e.anchor,"stroke-width":"0.75",stroke:"black",fill:"white","font-size":`${e.textSize}px`,"font-weight":"bold"},U(e.rulerLength),9,pg)):z("",!0)])}const vg=A(dg,[["render",mg],["__scopeId","data-v-85f6f954"]]),yg=X({name:"RulerWidget2D",emits:["placed","contextmenu"],props:{rulerId:{type:String,required:!0},widgetManager:{type:Object,required:!0},viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},currentSlice:{type:Number,required:!0},isPlacing:{type:Boolean,default:!1}},components:{RulerSVG2D:vg},setup(e,{emit:t}){const{rulerId:n,widgetManager:s,viewDirection:o,currentSlice:i,isPlacing:a}=ae(e),r=We(),l=x(()=>r.rulerByID[n.value]),{currentImageID:c,currentImageMetadata:u}=re(),d=js.newInstance({id:n.value,store:r,isPlaced:!a.value}),g=B(null);ne(()=>{g.value=s.value.addWidget(d)}),Fe(()=>{g.value&&(s.value.removeWidget(g.value),g.value.delete(),d.delete())}),F([a,g],([S,b])=>{S&&b&&b.setInteractionState(jt.PlacingFirst)},{immediate:!0}),F([i,c,g],()=>{var b;const S=(b=g.value)==null?void 0:b.getWidgetState().getIsPlaced();g.value&&!S&&(g.value.resetInteractions(),g.value.setInteractionState(jt.PlacingFirst))}),Se(x(()=>{var S;return(S=g.value)==null?void 0:S.onPlacedEvent}))(()=>{t("placed")});let f=null;ne(()=>{g.value&&(f=g.value.onRightClickEvent(S=>{const b=so(S);b&&t("contextmenu",b)}))}),Pe(()=>{f&&(f.unsubscribe(),f=null)});const p=Ge.newInstance();ne(()=>{g.value&&g.value.setManipulator(p)}),fe(()=>{var S;en(p,o.value,((S=l.value)==null?void 0:S.slice)??i.value,u.value)}),F(()=>{var S;return!!g.value&&((S=l.value)==null?void 0:S.slice)===i.value},S=>{var b;(b=g.value)==null||b.setVisibility(S)},{immediate:!0}),ne(()=>{g.value&&(g.value.setHandleVisibility(!1),s.value.renderWidgets())});const m=S=>{const b=B(!1),P=()=>{S.value&&(b.value=S.value.getVisible())};return Se(x(()=>{var k;return(k=S.value)==null?void 0:k.onModified}))(()=>P()),ui(S,()=>P()),b},w=m(x(()=>{var S;return(S=g.value)==null?void 0:S.getWidgetState().getFirstPoint()})),T=m(x(()=>{var S;return(S=g.value)==null?void 0:S.getWidgetState().getSecondPoint()}));return{ruler:l,firstPoint:x(()=>w.value?l.value.firstPoint:void 0),secondPoint:x(()=>T.value?l.value.secondPoint:void 0),length:x(()=>r.lengthByID[l.value.id])}}});function wg(e,t,n,s,o,i){const a=O("RulerSVG2D");return nt((I(),Y(a,{"view-id":e.viewId,point1:e.firstPoint,point2:e.secondPoint,color:e.ruler.color,length:e.length},null,8,["view-id","point1","point2","color","length"])),[[Bt,e.currentSlice===e.ruler.slice]])}const Sg=A(yg,[["render",wg]]),_g=X({name:"RulerTool",props:{viewId:{type:String,required:!0},currentSlice:{type:Number,required:!0},viewDirection:{type:String,required:!0},widgetManager:{type:Object,required:!0}},components:{RulerWidget2D:Sg},setup(e){const{viewDirection:t,currentSlice:n}=ae(e),s=ke(),o=We(),{rulers:i,activeLabel:a}=lt(o),{currentImageID:r,currentImageMetadata:l}=re(),c=x(()=>s.currentTool===ce.Ruler),u=x(()=>be(t.value)),d=B(null);F(d,(S,b)=>{b!=null&&o.updateRuler(b,{placing:!1}),S!=null&&o.updateRuler(S,{placing:!0})},{immediate:!0}),F([c,r],([S,b])=>{d.value!=null&&(o.removeRuler(d.value),d.value=null),S&&b&&(d.value=o.addRuler({imageID:b,placing:!0}))},{immediate:!0}),F([a,d],([S,b])=>{b!=null&&o.updateRuler(b,{label:S,...S&&o.labels[S]})},{immediate:!0}),Fe(()=>{d.value!=null&&(o.removeRuler(d.value),d.value=null)});const g=()=>{r.value&&(d.value=o.addRuler({imageID:r.value,placing:!0}))},y=()=>{const{lpsOrientation:S,indexToWorld:b}=l.value,P=S[t.value],E=S[u.value],k=[0,0,0];return k[E]=n.value,pe(k,k,b),{planeNormal:P,planeOrigin:k}};F([n,d],([S,b])=>{b&&o.updateRuler(b,{frameOfReference:y(),slice:S})},{immediate:!0});const f=je({show:!1,x:0,y:0,forRulerID:""}),p=(S,b)=>{[f.x,f.y]=b,f.show=!0,f.forRulerID=S},m=()=>{o.removeRuler(f.forRulerID)},w=S=>{if(!S.frameOfReference)return!1;const b=Sn(S.frameOfReference,l.value,{allowOutOfBoundsSlice:!0});return!!b&&b.axis===u.value};return{rulers:x(()=>{const{lengthByID:S}=o,b=r.value;return i.value.filter(E=>E.imageID===b&&w(E)).map(E=>({...E,length:S[E.id]}))}),placingRulerID:d,contextMenu:f,openContextMenu:p,deleteRulerFromContextMenu:m,onRulerPlaced:g}}});const Cg={class:"overlay-no-events"},bg={class:"overlay-no-events"};function Tg(e,t,n,s,o,i){const a=O("RulerWidget2D");return I(),D("div",Cg,[(I(),D("svg",bg,[(I(!0),D(se,null,Re(e.rulers,r=>(I(),Y(a,{key:r.id,"ruler-id":r.id,"is-placing":r.id===e.placingRulerID,"current-slice":e.currentSlice,"view-id":e.viewId,"view-direction":e.viewDirection,"widget-manager":e.widgetManager,onContextmenu:l=>e.openContextMenu(r.id,l),onPlaced:e.onRulerPlaced},null,8,["ruler-id","is-placing","current-slice","view-id","view-direction","widget-manager","onContextmenu","onPlaced"]))),128))])),v(yt,{modelValue:e.contextMenu.show,"onUpdate:modelValue":t[0]||(t[0]=r=>e.contextMenu.show=r),class:"position-absolute",style:ee({top:`${e.contextMenu.y}px`,left:`${e.contextMenu.x}px`}),"close-on-click":"","close-on-content-click":""},{default:R(()=>[v(At,{density:"compact"},{default:R(()=>[v(Je,{onClick:e.deleteRulerFromContextMenu},{default:R(()=>[v(xe,null,{default:R(()=>[H("Delete")]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1},8,["modelValue","style"])])}const Ig=A(_g,[["render",Tg],["__scopeId","data-v-6e6ae374"]]);function xg(e,t){t.classHierarchy.push("vtkRectangleWidget")}const Rg={};function Gs(e,t,n={}){Object.assign(t,Rg,n);const{store:s,...o}=n,i={...s,rulerByID:s.toolByID,updateRuler:s.updateTool};js.extend(e,t,{store:i,...o}),xg(e,t)}const Dg=_.newInstance(Gs,"vtkRectangleWidget"),Eg={newInstance:Dg,extend:Gs},Lg=X({props:{point1:Array,point2:Array,color:String,fillColor:String,viewId:{type:String,required:!0}},setup(e){const{viewId:t,point1:n,point2:s}=ae(e),o=B(),i=B(),a=he(),r=x(()=>a.getViewProxy(t.value)),l=()=>{const g=r.value.getRenderer(),y=j(n),f=j(s);if(y){const p=Ht(y,g);p&&(o.value={x:p[0],y:p[1]})}else o.value=null;if(f){const p=Ht(f,g);p&&(i.value={x:p[0],y:p[1]})}else i.value=null},c=x(()=>{var m,w,T,S;const[g,y]=[((m=o.value)==null?void 0:m.x)??0,((w=o.value)==null?void 0:w.y)??0],[f,p]=[((T=i.value)==null?void 0:T.x)??g,((S=i.value)==null?void 0:S.y)??y];return{x:Math.min(g,f),y:Math.min(y,p),width:Math.abs(g-f),height:Math.abs(y-p)}});Se(x(()=>r.value.getCamera().onModified))(l),F([r,n,s],l,{deep:!0,immediate:!0});const d=It(gn);return Tn(d,()=>{l()}),{devicePixelRatio,first:o,second:i,rectangle:c}}}),Pg=["x","y","width","height","stroke","fill"],Og=["cx","cy","stroke","r"],Vg=["cx","cy","stroke","r"];function kg(e,t,n,s,o,i){return I(),D("g",null,[h("rect",{x:e.rectangle.x,y:e.rectangle.y,width:e.rectangle.width,height:e.rectangle.height,stroke:e.color,"stroke-width":"1",fill:e.fillColor},null,8,Pg),e.first?(I(),D("circle",{key:0,cx:e.first.x,cy:e.first.y,stroke:e.color,"stroke-width":"1",fill:"transparent",r:10/e.devicePixelRatio},null,8,Og)):z("",!0),e.second?(I(),D("circle",{key:1,cx:e.second.x,cy:e.second.y,stroke:e.color,"stroke-width":"1",fill:"transparent",r:10/e.devicePixelRatio},null,8,Vg)):z("",!0)])}const Mg=A(Lg,[["render",kg]]),Bg=ze,Ag=Eg,Fg=Mg,Ng=X({name:"RectangleWidget2D",emits:["placed","contextmenu"],props:{toolId:{type:String,required:!0},widgetManager:{type:Object,required:!0},viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},currentSlice:{type:Number,required:!0},isPlacing:{type:Boolean,default:!1}},components:{SVG2DComponent:Fg},setup(e,{emit:t}){const{toolId:n,widgetManager:s,viewDirection:o,currentSlice:i,isPlacing:a}=ae(e),r=B(n.value),l=Bg(),c=x(()=>l.toolByID[r.value]),{currentImageID:u,currentImageMetadata:d}=re(),g=Ag.newInstance({id:r.value,store:l,isPlaced:!a.value}),y=B(null);ne(()=>{y.value=s.value.addWidget(g)}),Fe(()=>{y.value&&(s.value.removeWidget(y.value),y.value.delete(),g.delete())}),F([a,y],([b,P])=>{b&&P&&P.setInteractionState(jt.PlacingFirst)},{immediate:!0}),F([i,u,y],()=>{var P;const b=(P=y.value)==null?void 0:P.getWidgetState().getIsPlaced();y.value&&!b&&(y.value.resetInteractions(),y.value.setInteractionState(jt.PlacingFirst))}),Se(x(()=>{var b;return(b=y.value)==null?void 0:b.onPlacedEvent}))(()=>{t("placed")});let p=null;ne(()=>{y.value&&(p=y.value.onRightClickEvent(b=>{const P=so(b);P&&t("contextmenu",P)}))}),Pe(()=>{p&&(p.unsubscribe(),p=null)});const m=Ge.newInstance();ne(()=>{y.value&&y.value.setManipulator(m)}),fe(()=>{var b;en(m,o.value,((b=c.value)==null?void 0:b.slice)??i.value,d.value)}),F(()=>{var b;return!!y.value&&((b=c.value)==null?void 0:b.slice)===i.value},b=>{var P;(P=y.value)==null||P.setVisibility(b)},{immediate:!0}),ne(()=>{y.value&&(y.value.setHandleVisibility(!1),s.value.renderWidgets())});const w=b=>{const P=B(!1),E=()=>{b.value&&(P.value=b.value.getVisible())};return Se(x(()=>{var L;return(L=b.value)==null?void 0:L.onModified}))(()=>E()),ui(b,()=>E()),P},T=w(x(()=>{var b;return(b=y.value)==null?void 0:b.getWidgetState().getFirstPoint()})),S=w(x(()=>{var b;return(b=y.value)==null?void 0:b.getWidgetState().getSecondPoint()}));return{tool:c,firstPoint:x(()=>T.value?c.value.firstPoint:void 0),secondPoint:x(()=>S.value?c.value.secondPoint:void 0)}}});function $g(e,t,n,s,o,i){const a=O("SVG2DComponent");return nt((I(),Y(a,{"view-id":e.viewId,point1:e.firstPoint,point2:e.secondPoint,color:e.tool.color,"fill-color":e.tool.fillColor},null,8,["view-id","point1","point2","color","fill-color"])),[[Bt,e.currentSlice===e.tool.slice]])}const Ug=A(Ng,[["render",$g]]),Hg=ze,Wg=X({name:"RectangleTool",props:{viewId:{type:String,required:!0},currentSlice:{type:Number,required:!0},viewDirection:{type:String,required:!0},widgetManager:{type:Object,required:!0}},components:{RectangleWidget2D:Ug},setup(e){const{viewDirection:t,currentSlice:n}=ae(e),s=ke(),o=Hg(),{tools:i,activeLabel:a}=lt(o),{currentImageID:r,currentImageMetadata:l}=re(),c=x(()=>s.currentTool===ce.Rectangle),u=x(()=>be(t.value)),d=B(null);F(d,(S,b)=>{b!=null&&o.updateTool(b,{placing:!1}),S!=null&&o.updateTool(S,{placing:!0})},{immediate:!0}),F([c,r],([S,b])=>{d.value!=null&&(o.removeTool(d.value),d.value=null),S&&b&&(d.value=o.addTool({imageID:b,placing:!0}))},{immediate:!0}),F([a,d],([S,b])=>{b!=null&&o.updateTool(b,{label:S,...S&&o.labels[S]})},{immediate:!0}),Fe(()=>{d.value!=null&&(o.removeTool(d.value),d.value=null)});const g=()=>{r.value&&(d.value=o.addTool({imageID:r.value,placing:!0}))},y=()=>{const{lpsOrientation:S,indexToWorld:b}=l.value,P=S[t.value],E=S[u.value],k=[0,0,0];return k[E]=n.value,pe(k,k,b),{planeNormal:P,planeOrigin:k}};F([n,d],([S,b])=>{b&&o.updateTool(b,{frameOfReference:y(),slice:S})},{immediate:!0});const f=je({show:!1,x:0,y:0,forToolID:""}),p=(S,b)=>{[f.x,f.y]=b,f.show=!0,f.forToolID=S},m=()=>{o.removeTool(f.forToolID)},w=S=>{if(!S.frameOfReference)return!1;const b=Sn(S.frameOfReference,l.value,{allowOutOfBoundsSlice:!0});return!!b&&b.axis===u.value};return{tools:x(()=>{const S=r.value;return i.value.filter(b=>b.imageID===S&&w(b))}),placingToolID:d,contextMenu:f,openContextMenu:p,deleteToolFromContextMenu:m,onToolPlaced:g}}});const zg={class:"overlay-no-events"},jg={class:"overlay-no-events"};function Gg(e,t,n,s,o,i){const a=O("RectangleWidget2D");return I(),D("div",zg,[(I(),D("svg",jg,[(I(!0),D(se,null,Re(e.tools,r=>(I(),Y(a,{key:r.id,"tool-id":r.id,"is-placing":r.id===e.placingToolID,"current-slice":e.currentSlice,"view-id":e.viewId,"view-direction":e.viewDirection,"widget-manager":e.widgetManager,onContextmenu:l=>e.openContextMenu(r.id,l),onPlaced:e.onToolPlaced},null,8,["tool-id","is-placing","current-slice","view-id","view-direction","widget-manager","onContextmenu","onPlaced"]))),128))])),v(yt,{modelValue:e.contextMenu.show,"onUpdate:modelValue":t[0]||(t[0]=r=>e.contextMenu.show=r),class:"position-absolute",style:ee({top:`${e.contextMenu.y}px`,left:`${e.contextMenu.x}px`}),"close-on-click":"","close-on-content-click":""},{default:R(()=>[v(At,{density:"compact"},{default:R(()=>[v(Je,{onClick:e.deleteToolFromContextMenu},{default:R(()=>[v(xe,null,{default:R(()=>[H("Delete")]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1},8,["modelValue","style"])])}const Xg=A(Wg,[["render",Gg],["__scopeId","data-v-152d5701"]]),qg=32,Zo=2,Kg=4;function Yg(e,t){t.classHierarchy.push("vtkContourRepresentation"),t._polyData=et.newInstance({mtime:0}),t._pdPoints=null,t._pdLines=null,t._pipelines={lines:{source:e,mapper:qt.newInstance(),actor:Ei.newInstance({parentProp:e})}},t._pipelines.lines.actor.getProperty().setLineWidth(2),Xn.connectPipeline(t._pipelines.lines),e.addActor(t._pipelines.lines.actor),e.getRepresentationStates=(i=t.inputData[0])=>i;function n(i){var p,m;const a=i.getPolyLine(),r=i.getReferencePlane(),l=i.getPolyLineLength(),c=i.getFinalized(),u=c?1:0;if(!a||!r)return;((p=t._pdPoints)==null?void 0:p.length)!==l*3&&(t._pdPoints=new Float32Array(l*3)),((m=t._pdLines)==null?void 0:m.length)!==l+1&&(t._pdLines=new Float32Array(l+1+u));let d=0,g=0;t._pdLines[g++]=l+u;const y=Ae(),f=Le();for(let w=0;w<a.length;)t._pdLines[g++]=d/3,ci(y,a[w++],a[w++]),_n(y,r,f),t._pdPoints[d++]=f[0],t._pdPoints[d++]=f[1],t._pdPoints[d++]=f[2];c&&(t._pdLines[g]=0)}let s=Zo;e.requestData=(i,a)=>{const r=e.getRepresentationStates(i[0]);n(r),t._pdPoints&&t._pdLines&&(t._polyData.getPoints().setData(t._pdPoints),t._polyData.getLines().setData(t._pdLines),t._polyData.getPoints().modified(),t._polyData.modified()),s=r.getSelected()?Kg:Zo,t._pipelines.lines.actor.getProperty().setLineWidth(s),t._pipelines.lines.actor.getProperty().setColor(r.getColor()),a[0]=t._polyData},e.getSelectedState=()=>t.inputData[0];const{updateActorVisibility:o}=e;e.updateActorVisibility=(i=Oo.FRONT_BUFFER,a=!0,r=!0)=>{i===Oo.PICKING_BUFFER?t._pipelines.lines.actor.getProperty().setLineWidth(qg):t._pipelines.lines.actor.getProperty().setLineWidth(s),o(i,a,r)}}const Qg={};function Xs(e,t,n={}){const s={...Qg,...n};Xn.extend(e,t,s),Yg(e,t)}const Zg=_.newInstance(Xs,"vtkContourRepresentation"),Jg={newInstance:Zg,extend:Xs};var Ve=(e=>(e.Select="Select",e.Freehand="Freehand",e.Nudge="Nudge",e.PointPlacing="PointPlacing",e.Threshold="Threshold",e))(Ve||{});const Q={Idle:"Idle",Moving:"Moving",FreehandDrawing:"FreehandDrawing",Nudging:"Nudging",PointPlacing:"PointPlacing",Thresholding:"Thresholding"};function de(e){return e.altKey||e.controlKey||e.shiftKey}function Te(e,t){const n=e.manipulator.handleEvent(t,e._apiSpecificRenderWindow);return(n==null?void 0:n.length)===3?n:null}function qs(e,t){const n=(t==null?void 0:t.degree)??2,s=(t==null?void 0:t.interPointSpacing)??.1,o=(t==null?void 0:t.closed)??!1,i=(t==null?void 0:t.clamped)??!1,a=e.length/3,r=[],l=Ae();let c=0;for(let f=0;f<e.length;f+=2){const p=[e[f],e[f+1]];r.push(p),f>0&&(c+=di(l,p)),Aa(l,p)}o&&r.push(...r.slice(0,n+1));let u;if(i){u=[];const f=r.length;for(let p=0;p<f+n+1;p++)u.push(p)}const d=!i&&o?1-1/(a+1):1,g=(t==null?void 0:t.dt)??s/c,y=[];for(let f=0;f<1;f+=g){const p=Fa(f*d,n,r,u);y.push(p[0],p[1])}return y}function ef(e,t){const n={...e};function s(){return e.getMode()===Ve.Freehand}function o(){e.setInteractionState(Q.Idle),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent()}e.resetInteractionState=()=>{s()&&!e.isInteractionIdle()&&(t.widgetState.clearPolyLine(),o()),n.resetInteractionState()},e.handleLeftButtonPress=i=>{var l;if(((l=n.handleLeftButtonPress)==null?void 0:l.call(n,i))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||!t.manipulator||de(i))return _.VOID;if(t.widgetState.getFinalized())return _.VOID;const a=t._widgetManager.getActiveWidget();if(a&&a!==e)return _.VOID;const r=Te(t,i);return r?(e.setInteractionState(Q.FreehandDrawing),t.widgetState.clearPolyLine(),t.widgetState.add3dPointToPolyLine(r),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),_.EVENT_ABORT):_.VOID},e.handleMouseMove=i=>{var r;if(((r=n.handleMouseMove)==null?void 0:r.call(n,i))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||e.getInteractionState()!==Q.FreehandDrawing||de(i))return _.VOID;const a=Te(t,i);return a&&(t.widgetState.add3dPointToPolyLine(a),e.invokeInteractionEvent()),_.EVENT_ABORT},e.handleLeftButtonRelease=i=>{var l;if(((l=n.handleLeftButtonRelease)==null?void 0:l.call(n,i))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||e.getInteractionState()!==Q.FreehandDrawing||de(i))return _.VOID;const a=Te(t,i);if(a&&t.widgetState.add3dPointToPolyLine(a),t.widgetState.getPolyLine().length>=3*2){const c=qs(t.widgetState.getPolyLine(),{degree:2,interPointSpacing:.01,closed:!0,clamped:!1});t.widgetState.setPolyLine(c),t.widgetState.setFinalized(!0)}return o(),_.EVENT_ABORT}}const tf=new Set([Ve.Nudge]);function nf(e,t){const n={...e};let s=[0,0],o=null;_.event(e,t,"SelectedEvent");const i=Ae();function a(l){if(!o)return;Na(i,l,s);const c=t.widgetState.getPolyLine();for(let u=0;u<c.length;u+=2)c[u]=o[u]+i[0],c[u+1]=o[u+1]+i[1];t.widgetState.modified()}function r(){e.setInteractionState(Q.Idle),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent()}e.resetInteractionState=()=>{e.getInteractionState()===Q.Moving&&r(),n.resetInteractionState()},e.handleLeftButtonPress=l=>{var u;if(((u=n.handleLeftButtonPress)==null?void 0:u.call(n,l))===_.EVENT_ABORT)return _.EVENT_ABORT;if(de(l))return _.VOID;if(t._widgetManager.getActiveWidget()!==e)return tf.has(e.getMode())||e.invokeSelectedEvent(!1),_.VOID;e.invokeSelectedEvent(!0);const c=Te(t,l);return c?(s=tt(c,t.widgetState.getReferencePlane()),o=[...t.widgetState.getPolyLine()],e.setInteractionState(Q.Moving),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),_.EVENT_ABORT):_.EVENT_ABORT},e.handleMouseMove=l=>{var u;if(((u=n.handleMouseMove)==null?void 0:u.call(n,l))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!e.isSelected()||e.getInteractionState()!==Q.Moving||de(l))return _.VOID;const c=Te(t,l);return c&&(a(tt(c,t.widgetState.getReferencePlane())),e.invokeInteractionEvent()),_.EVENT_ABORT},e.handleLeftButtonRelease=l=>{var u;if(((u=n.handleLeftButtonRelease)==null?void 0:u.call(n,l))===_.EVENT_ABORT)return _.EVENT_ABORT;if(e.getInteractionState()!==Q.Moving||de(l))return _.VOID;const c=Te(t,l);return c&&a(tt(c,t.widgetState.getReferencePlane())),r(),_.EVENT_ABORT}}function Bn(e,t,n){return(e+t)%n}function of(e,t,n){e[0]=(t[0]+n[0])/2,e[1]=(t[1]+n[1])/2}function sf(e,t,n){const{radius:s,center:o}=t,i=s**2,a=Le(),r=[0,0,0],l=[0,0];for(let c=0;c<e.length;c+=2){mt(l,e[c],e[c+1]),_n(l,n,r);const u=$a(r,o);u>=i||(ai(a,r,o),Ua(a,a,Math.sqrt(i/u)),Ha(r,o,a),tt(r,n,l),e[c]=l[0],e[c+1]=l[1])}}function af(e,t,n){if(e.length<2)return;const s=t**2,o=n**2,i=Ae(),a=Ae(),r=Ae(),l=Ae();let c=0,u=!1,d=!1;do{let g=c;const y=Bn(c,2,e.length);mt(i,e[c],e[c+1]),mt(a,e[y],e[y+1]);const f=hi(i,a);if(f<s)of(r,i,a),e.splice(y,2),e.splice(c,2),e.splice(c,0,...r);else if(f>o){const m=1/(Math.ceil(Math.sqrt(f/o))+1),w=[];for(let T=m;T<1;T+=m)Wa(l,i,a,T),w.push(...l);e.splice(y,0,...w),g=Bn(c,w.length+2,e.length)}else g=Bn(c,2,e.length);d=u,u=g<c,c=g}while(!d)}function rf(e,t,n,s=1e-4,o=.1){sf(e,t,n),af(e,s,o)}function lf(e,t){let n=0,s=1/0;const o=Ae();for(let i=0;i<e.length;i+=2){mt(o,e[i],e[i+1]);const a=hi(o,t);a<s&&(n=i,s=a)}return n}const cf=.95;function uf(e,t){const n={...e};t._radius=1;function s(){return e.getMode()===Ve.Nudge}function o(a){const r=t.widgetState.getPolyLine(),l=t.widgetState.getReferencePlane();rf(r,{center:a,radius:t._radius},l),t.widgetState.modified()}function i(){e.getWidgetState().getCircleContext().setVisible(!1),e.setInteractionState(Q.Idle),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent()}e.resetInteractionState=()=>{s()&&!e.isInteractionIdle()&&i(),n.resetInteractionState()},e.handleLeftButtonPress=a=>{var T;if(((T=n.handleLeftButtonPress)==null?void 0:T.call(n,a))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||!e.isSelected()||!t.manipulator||de(a))return _.VOID;const r=t._widgetManager.getActiveWidget();if(r&&r!==e)return _.VOID;const l=Te(t,a);if(!l)return _.VOID;const{widgetState:c}=t,u=c.getPolyLine(),d=c.getReferencePlane(),g=lf(u,tt(l,d)),y=za(l,_n([u[g],u[g+1]],d));t._radius=y*cf;const f=t.manipulator.getNormal(),p=t._renderer.getActiveCamera().getViewUp(),m=Le();zn(m,p,f);const w=c.getCircleContext();return w.setDirection(f),w.setUp(p),w.setRight(m),w.setOrigin(l),w.setScale3([t._radius,t._radius,1]),w.setVisible(!0),e.setInteractionState(Q.Nudging),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),_.EVENT_ABORT},e.handleMouseMove=a=>{var l;if(((l=n.handleMouseMove)==null?void 0:l.call(n,a))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||!e.isSelected()||e.getInteractionState()!==Q.Nudging||de(a))return _.VOID;const r=Te(t,a);return r&&(e.getWidgetState().getCircleContext().setOrigin(r),o(r),e.invokeInteractionEvent()),_.EVENT_ABORT},e.handleLeftButtonRelease=a=>{var l;if(((l=n.handleLeftButtonRelease)==null?void 0:l.call(n,a))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||!e.isSelected()||e.getInteractionState()!==Q.Nudging||de(a))return _.VOID;const r=Te(t,a);return r&&o(r),i(),_.EVENT_ABORT}}function df(e,t){const n={...e};function s(){return e.getMode()===Ve.PointPlacing}function o(){t._widgetManager.releaseFocus(),e.setInteractionState(Q.Idle),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent()}function i(r){const l=t.widgetState.getPolyLine(),c=l.length-1;l[c-1]=r[0],l[c]=r[1],t.widgetState.modified()}function a(){t.widgetState.getPolyLine().splice(-2,2),t.widgetState.modified()}e.resetInteractionState=()=>{s()&&!e.isInteractionIdle()&&(t.widgetState.clearPolyLine(),o()),n.resetInteractionState()},e.handleLeftButtonPress=r=>{var d;if(((d=n.handleLeftButtonPress)==null?void 0:d.call(n,r))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||!t.manipulator||de(r))return _.VOID;if(t.widgetState.getFinalized())return _.VOID;const l=t._widgetManager.getActiveWidget();if(l&&l!==e)return _.VOID;const c=Te(t,r);if(!c)return _.VOID;const u=tt(c,t.widgetState.getReferencePlane());return e.getInteractionState()===Q.PointPlacing?(i(u),t.widgetState.add2dPointToPolyLine(u),e.invokeInteractionEvent()):(t._widgetManager.grabFocus(e),e.setInteractionState(Q.PointPlacing),t.widgetState.setFinalized(!1),t.widgetState.clearPolyLine(),t.widgetState.add2dPointToPolyLine(u),t.widgetState.add2dPointToPolyLine(u),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent()),_.EVENT_ABORT},e.handleMouseMove=r=>{var c;if(((c=n.handleMouseMove)==null?void 0:c.call(n,r))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||e.getInteractionState()!==Q.PointPlacing||de(r))return _.VOID;const l=Te(t,r);if(l){const u=tt(l,t.widgetState.getReferencePlane());i(u),e.invokeInteractionEvent()}return _.EVENT_ABORT},e.handleRightButtonPress=r=>{var l;if(((l=n.handleRightButtonPress)==null?void 0:l.call(n,r))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||e.getInteractionState()!==Q.PointPlacing||de(r))return _.VOID;if(a(),t.widgetState.getPolyLineLength()<=2)t.widgetState.clearPolyLine();else{const c=qs(t.widgetState.getPolyLine(),{degree:2,interPointSpacing:.01,closed:!0,clamped:!1});t.widgetState.setPolyLine(c),t.widgetState.setFinalized(!0)}return o(),_.EVENT_ABORT}}const{vtkErrorMacro:hf}=_;function gf(e,t){t.classHierarchy.push("vtkImageMarchingSquares"),e.getContourValues=()=>t.contourValues,e.setContourValues=a=>{t.contourValues=a,e.modified()};const n=[],s=[],o=[],i=$r.newInstance();e.getPixelScalars=(a,r,l,c,u,d,g,y)=>{n[0]=l*c+r*u[0]+a,n[1]=n[0]+1,n[2]=n[0]+u[0],n[3]=n[2]+1;const f=a>=0,p=r>=0,m=a+1<u[0],w=r+1<u[1];s[0]=f&&p?y[n[0]]:0,s[1]=m&&p?y[n[1]]:0,s[2]=f&&w?y[n[2]]:0,s[3]=m&&w?y[n[3]]:0},e.getPixelPoints=(a,r,l,c,u,d)=>{o[0]=u[0]+a*d[0],o[1]=u[1]+r*d[1],o[2]=o[0]+d[0],o[3]=o[1],o[4]=o[0],o[5]=o[1]+d[1],o[6]=o[2],o[7]=o[5]},e.produceLines=(a,r,l,c,u,d,g,y,f,p,m)=>{var k;const w=[1,2,8,4],T=[];let S;e.getPixelScalars(r,l,c,u,d,g,y,f);let b=0;for(let L=0;L<4;L++)s[L]>=a&&(b|=w[L]);const P=Vo.getCase(b);if(P[0]<0)return;e.getPixelPoints(r,l,c,d,g,y);const E=g[2]+c*y[2];for(let L=0;P[L]>=0;L+=2){m.push(2);for(let $=0;$<2;$++){const K=Vo.getEdge(P[L+$]);if(S=void 0,t.mergePoints&&(S=(k=i.isInsertedEdge(n[K[0]],n[K[1]]))==null?void 0:k.value),S===void 0){const M=K[0]*2,W=o[M],J=o[M+1],_e=K[1]*2,me=o[_e],Xe=o[_e+1];T[0]=W+.5*(me-W),T[1]=J+.5*(Xe-J),S=p.length/3,p.push(T[0],T[1],E),t.mergePoints&&i.insertEdge(n[K[0]],n[K[1]],S)}m.push(S)}}},e.requestData=(a,r)=>{const l=a[0];if(!l){hf("Invalid or missing input");return}const c=l.getOrigin(),u=l.getSpacing(),d=l.getDimensions(),g=l.getPointData().getScalars().getData(),y=[],f=[],p=d[0]*d[1];let m=Math.round(t.slice);m>=d[2]&&(m=0);for(let T=0;T<t.contourValues.length;++T){for(let S=-1;S<d[1];++S)for(let b=-1;b<d[0];++b)e.produceLines(t.contourValues[T],b,S,m,p,d,c,u,g,y,f);i.initialize()}const w=et.newInstance();w.getPoints().setData(new Float32Array(y),3),w.getLines().setData(new Uint32Array(f)),r[0]=w}}const ff={contourValues:[],slice:0,mergePoints:!1};function Ks(e,t,n={}){Object.assign(t,ff,n),_.obj(e,t),_.algo(e,t,1,1),_.setGet(e,t,["slice","mergePoints"]),_.algo(e,t,1,1),gf(e,t)}const pf=_.newInstance(Ks,"vtkImageMarchingSquares"),mf={newInstance:pf,extend:Ks},Ys=2,vf=1,yf=0;function wf(e,t){const n=[...e];return n.splice(t,1),n}function Sf(e,t){const[n,s]=wf(e.getDimensions(),t),o=new Uint8Array(n*s),i=Ti.newInstance({values:o,numberOfComponents:1}),a=bi.newInstance();return a.setDimensions([n,s,1]),a.getPointData().setScalars(i),a}function _f(e,t,n){const s=[...e];return s.splice(t,0,n),s}function dn(e,t){const n=[...e];return n.splice(t,1),n}function Cf(e,t){return di(e,t)}function Jo(e,t=3){if(t>3)throw new Error("Cannot support dim > 3");const n=e.getPointData().getScalars().getData(),[s,o,i]=e.getDimensions(),a=t===3?s*o:0,r=t>=2?s:0;return{get:l=>{const c=l[0]??0,u=l[1]??0,d=l[2]??0;return n[d*a+u*r+c]},set:(l,c)=>{const u=l[0]??0,d=l[1]??0,g=l[2]??0;n[g*a+d*r+u]=c},inBounds:l=>{const c=l[0]??0,u=l[1]??0,d=l[2]??0;return c>=0&&c<s&&u>=0&&u<o&&d>=0&&d<i},fill:l=>{n.fill(l)}}}function bf(e,t,n,s,o,i,a,r=Cf){const l=Jo(e,3),c=Jo(s,2),u=dn(o,t),d=l.get(o),g=d-i,y=d+i;c.fill(yf);const f=[u];for(;f.length;){const p=f.shift();if(!c.inBounds(p)||c.get(p)!==0||r(u,p)>a)continue;c.set(p,vf);const m=_f(p,t,n),w=l.get(m);if(w<g||w>y)continue;c.set(p,Ys);const[T,S]=p;for(let b=-1;b<=1;b++)for(let P=-1;P<=1;P++)(!b&&P||b&&!P)&&f.push([T+b,S+P])}}function Tf(e){const t=mf.newInstance({mergePoints:!0});return t.setContourValues([Ys]),t.setInputData(e),t.getOutputData()}Ot(0,1,0,0,0,0,1,0,1,0,0,0,0,0,0,1),Ot(1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1),Ot(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);function If(e,t){t.classHierarchy.push("vtkContourLoopExtraction");const n=new Set;e.traverseLoop=(s,o,i,a,r)=>{let l=i,c=a,u=!1,d=0;for(;!u;){const{cellPointIds:g}=s.getCellPoints(l);if(!g)continue;c=g[0]!==c?g[0]:g[1],d++;const y=o*d;r.push({t:y,ptId:c});const f=s.getPointCells(c);if(f.length!==2||c===a)return c;f.length===2?(l=f[0]!==l?f[0]:f[1],n.add(l)):u=!0}return c},e.computeConvexHull=(s,o)=>{const i=s.getPoints().getData(),a=[];for(let u=0;u<i.length;u+=3)a.push([i[u],i[u+1]]);const r=ja(a,1/0),l=new i.constructor(r.length*3),c=new Uint32Array(1+r.length+1);c[0]=r.length;for(let u=0,d=0;u<r.length;u++,d+=3){const g=r[u];l[d]=g[0],l[d+1]=g[1],l[d+2]=0,c[u+1]=u}c[c.length-1]=c[1],o.getPoints().setData(l),o.getLines().setData(c)},e.extractContours=(s,o)=>{var l;const i=[];n.clear();const a=s.getLines();o.getPoints().setData(Float32Array.from(s.getPoints().getData()));for(let c=0;c<a.getNumberOfCells();c++){if(n.has(c))continue;const{cellPointIds:u}=s.getCellPoints(c);if(!u)continue;n.add(c);const d=u[0],g=[];g.push({t:0,ptId:d});const y=e.traverseLoop(s,1,c,d,g);d!==y&&(e.traverseLoop(s,-1,c,d,g),g.sort((f,p)=>f.t<p.t?-1:1),g.length&&g[0].ptId!==((l=g.at(-1))==null?void 0:l.ptId)&&g.push({...g.at(-1)})),g.length&&i.push(g)}const r=o.getLines();if(r.resize(0),e.getMergeContours()&&i.length){let c=0,u=0;i.forEach((d,g)=>{d.length>u&&(c=g,u=d.length)}),r.insertNextCell(i[c].map(d=>d.ptId))}else i.forEach(c=>{r.insertNextCell(c.map(u=>u.ptId))})},e.requestData=(s,o)=>{const[i]=s;o[0]||(o[0]=et.newInstance());const[a]=o;e.getConvexHull()?e.computeConvexHull(i,a):e.extractContours(i,a),a.modified()}}const xf={mergeContours:!1,convexHull:!1};function Qs(e,t,n={}){Object.assign(t,xf,n),_.obj(e,t),_.algo(e,t,1,1),_.setGet(e,t,["mergeContours","convexHull"]),If(e,t)}const Rf=_.newInstance(Qs,"vtkContourLoopExtraction"),Df={newInstance:Rf,extend:Qs};function Ef(e){return Array.isArray(e)?[...e]:e.constructor.from(e)}function Lf(e,t){t.classHierarchy.push("vtkTransformPolyDataToPlane"),e.requestData=(n,s)=>{const o=e.getRefPlane()??Rs(),[i]=n;s[0]||(s[0]=et.newInstance());const[a]=s,r=Float32Array.from(i.getPoints().getData());a.getPoints().setData(r);const l=[0,0],c=[0,0,0];for(let d=0;d<r.length;d+=3)mt(l,r[d],r[d+1]),_n(l,o,c),r[d]=c[0],r[d+1]=c[1],r[d+2]=c[2];const u=i.getLines().getData();a.getLines().setData(Ef(u)),a.modified()}}const Pf={refPlane:null};function Zs(e,t,n={}){Object.assign(t,Pf,n),_.obj(e,t),_.algo(e,t,1,1),_.setGet(e,t,["refPlane"]),Lf(e,t)}const Of=_.newInstance(Zs,"vtkTransformPolyDataToPlane"),Vf={newInstance:Of,extend:Zs},kf="m",Mf="c",Bf=2;function Af(){const e=Ei.newInstance(),t=qt.newInstance(),n=e.getProperty();return e.setMapper(t),{actor:e,mapper:t,property:n}}function Ff(e,t){const n={...e};t.imageData=null,t.sliceAxis=0,t.slice=0,t.loops=et.newInstance(),t.maskBoundaryLines=et.newInstance(),t.mergeContours=!1,t.doConvexHull=!1,t.contour=Af(),t.contour.property.setLineWidth(Bf),t.contourLoopExtraction=Df.newInstance(),t.transformPolyData=Vf.newInstance(),t.transformPolyData.setInputConnection(t.contourLoopExtraction.getOutputPort());function s(){t.contour.mapper.setInputData(et.newInstance())}function o(){var w;(w=t._renderer)==null||w.addActor(t.contour.actor)}function i(){var w;(w=t._renderer)==null||w.removeActor(t.contour.actor)}function a(){const w=t.widgetState.getStore(),T=t.widgetState.getId(),S=w.toolByID[T],b=t.contourLoopExtraction.getOutputData(),P=b.getLines(),E=b.getPoints(),k=P.getData().length,L=[0,0,0];for(let $=0;$<k;){const K=P.getCell($);$+=K.length+1;const Z=[];let{length:M}=K;K[0]===K.at(-1)&&M--;for(let W=0;W<M;W++)E.getPoint(K[W],L),Z.push(L[0],L[1]);w.addTool({...S,polyLine:Z})}}s();let r=null,l=null,c=0,u=0,d=[0,0,0],g=[0,0,0],y=[0,0];function f(){if(!r)return;t.transformPolyData.setRefPlane(t.widgetState.getReferencePlane());const w=t.transformPolyData.getOutputData();t.contour.mapper.setInputData(w),t.contour.mapper.modified()}function p(){return e.getMode()===Ve.Threshold}function m(){i(),s(),e.getWidgetState().getCircleContext().setVisible(!1),t._widgetManager.releaseFocus(),e.setInteractionState(Q.Idle),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent()}e.resetInteractionState=()=>{p()&&!e.isInteractionIdle()&&m(),n.resetInteractionState()},e.setThresholdingImageSlice=(w,T,S)=>{t.imageData=w,t.sliceAxis=T,t.slice=Math.round(S)},e.handleKeyPress=w=>{var S;if(((S=n.handleKeyPress)==null?void 0:S.call(n,w))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!p()||!t.manipulator||de(w)||t.widgetState.getFinalized()||e.getInteractionState()!==Q.Thresholding)return _.VOID;let T=!1;return w.key===kf?(t.mergeContours=!t.mergeContours,t.contourLoopExtraction.setMergeContours(t.mergeContours),T=!0):w.key===Mf&&(t.doConvexHull=!t.doConvexHull,t.contourLoopExtraction.setConvexHull(t.doConvexHull),T=!0),T?(f(),e.invokeInteractionEvent(),_.EVENT_ABORT):_.VOID},e.handleLeftButtonPress=w=>{var P;if(((P=n.handleLeftButtonPress)==null?void 0:P.call(n,w))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!p()||!t.manipulator||de(w))return _.VOID;if(!t.imageData||t.sliceAxis==null||t.slice==null)return _.VOID;if(r=t.imageData,c=t.sliceAxis,u=t.slice,l=Sf(r,c),t.widgetState.getFinalized())return _.VOID;const T=t._widgetManager.getActiveWidget();if(T&&T!==e)return _.VOID;const S=Te(t,w);if(!S)return _.VOID;o(),t.mergeContours=!1;const b=t.imageData.worldToIndex(S);return d=S,g=ko(b),y=dn(g,c),t._widgetManager.grabFocus(e),e.setInteractionState(Q.Thresholding),t.widgetState.setFinalized(!1),t.widgetState.clearPolyLine(),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),_.EVENT_ABORT},e.handleMouseMove=w=>{var S;if(((S=n.handleMouseMove)==null?void 0:S.call(n,w))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!p()||e.getInteractionState()!==Q.Thresholding||de(w))return _.VOID;if(!r)return _.VOID;const T=ko(r.worldToIndex(Te(t,w)));if(T&&r&&l){const b=dn(T,c),P=Math.abs(b[0]-y[0]),E=Math.abs(b[1]-y[1]),k=r.getDimensions(),L=dn(k,c),$=Math.sqrt(L[0]**2+k[1]**2),K=r.getPointData().getScalars().getRange(),Z=K[1]-K[0],M=Math.min(E,$)/$*Z;bf(r,c,u,l,g,M,P),t.maskBoundaryLines=Tf(l),t.maskBoundaryLines.buildLinks(),t.contourLoopExtraction.setInputData(t.maskBoundaryLines),f();const W=t.manipulator.getNormal(),J=t._renderer.getActiveCamera().getViewUp(),_e=Le();zn(_e,J,W);const me=t.widgetState.getCircleContext();me.setDirection(W),me.setUp(J),me.setRight(_e),me.setOrigin(d),me.setScale3([P,E,1]),me.setVisible(!0),e.invokeInteractionEvent()}return _.EVENT_ABORT},e.handleLeftButtonRelease=w=>{var T;return((T=n.handleLeftButtonRelease)==null?void 0:T.call(n,w))===_.EVENT_ABORT?_.EVENT_ABORT:!p()||e.getInteractionState()!==Q.Thresholding||de(w)?_.VOID:(a(),m(),_.EVENT_ABORT)}}function Nf(e,t){t.classHierarchy.push("vtkContourWidgetProp"),t.interactionState=Q.Idle,t.mode=null,_.event(e,t,"RightClickEvent"),_.setGet(e,t,["manipulator"]),_.setGet(e,t,["mode"]),_.setGet(e,t,["interactionState"]),e.setDisplayCallback=n=>t.representations[0].setDisplayCallback(n),e.isInteractionIdle=()=>e.getInteractionState()===Q.Idle,e.resetInteractionState=()=>{e.setInteractionState(Q.Idle)},e.isSelected=()=>t.widgetState.getSelected(),e.handleRightButtonPress=n=>de(n)||t._widgetManager.getActiveWidget()!==e?_.VOID:(e.invokeRightClickEvent(n),_.EVENT_ABORT),nf(e,t),ef(e,t),df(e,t),uf(e,t),Ff(e,t)}function $f(e,t,n){mn.extend(e,t,n),Ur.extend(e,t,n),Ri.extend(e,t,n),Hr.extend(e,t,n),Wr.extend(e,t,n)}const Uf=_.newInstance($f,"vtkCircleContextContourWidgetState");function Hf(e,t){t.classHierarchy.push("vtkContourWidgetState"),t._circleContextState=Uf(),e.bindState(t._circleContextState,["circleContext"]),e.getCircleContext=()=>t._circleContextState;function n(){return t._store.toolByID[t.id]}e.getPolyLine=()=>{var o;return Ga((o=n())==null?void 0:o.polyLine)},e.getReferencePlane=()=>{var o;return(o=n())==null?void 0:o.referencePlane},e.getPolyLineLength=()=>{var i;const o=(i=n())==null?void 0:i.polyLine;return o?o.length/2:0};const s=Ae();e.add3dPointToPolyLine=o=>{const i=e.getPolyLine(),a=e.getReferencePlane();!i||!a||(tt(o,a,s),e.add2dPointToPolyLine(s))},e.add2dPointToPolyLine=o=>{const i=e.getPolyLine();i&&(i.push(...o),e.modified())},e.clearPolyLine=()=>{const o=e.getPolyLine();o&&(o.length=0,e.modified())},e.setPolyLine=o=>{const i=n();i&&(i.polyLine=o,e.modified())},e.getColor=()=>{var i;const o=(i=n())==null?void 0:i.label;return o?lh(t._store.labels[o].color).map(a=>a/255):null}}const Wf=e=>({finalized:!1,selected:!1,...e});function zf(e,t,n){if(Object.assign(t,Wf(n)),mn.extend(e,t,n),Di.extend(e,t),_.get(e,t,["id"]),_.setGet(e,t,["finalized","selected"]),_.moveToProtected(e,t,["store"]),_.get(e,t,["_store"]),!t.id)throw new Error("No ID provided!");if(!t._store)throw new Error("No store provided!");Hf(e,t)}const jf=_.newInstance(zf,"vtkContourWidgetState");function Gf(e){return jf(e)}function Xf(e,t){t.classHierarchy.push("vtkContourWidget"),e.getRepresentationsForViewType=n=>{switch(n){case Ze.DEFAULT:case Ze.GEOMETRY:case Ze.SLICE:case Ze.VOLUME:default:return[{builder:Jg},{builder:zr,labels:["circleContext"]}]}},e.setManipulator(t.manipulator||Ge.newInstance())}const qf=e=>({manipulator:null,behavior:Nf,widgetState:Gf(e),...e});function Js(e,t,n={}){Object.assign(t,qf(n)),fn.extend(e,t,n),_.setGet(e,t,["manipulator"]),_.event(e,t,"finalized"),Xf(e,t)}const Kf=_.newInstance(Js,"vtkContourWidget"),Yf={newInstance:Kf,extend:Js},Qf={[ye.Select]:Ve.Select,[ye.FreehandDraw]:Ve.Freehand,[ye.CircleNudge]:Ve.Nudge,[ye.PointPlacing]:Ve.PointPlacing,[ye.Threshold]:Ve.Threshold},Zf=X({name:"ContourWidget2D",emits:["finalize","select","contextmenu"],props:{contourId:{type:String,required:!0},widgetManager:{type:Object,required:!0},viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},currentSlice:{type:Number,required:!0},drawing:{type:Boolean,default:!1},selected:{type:Boolean,default:!1},mode:{type:String,required:!0}},setup(e,{emit:t}){const{viewId:n,contourId:s,widgetManager:o,viewDirection:i,currentSlice:a,drawing:r,selected:l,mode:c}=ae(e),u=Cn(),d=x(()=>u.toolByID[s.value]),{currentImageData:g,currentImageID:y,currentImageMetadata:f}=re(),p=x(()=>u.$proxies.getView(n.value)),m=Yf.newInstance({id:s.value,store:u,finalized:!r.value}),w=B(null),T=x(()=>{var L;return(L=w.value)==null?void 0:L.getWidgetState()});ne(()=>{w.value=o.value.addWidget(m)}),Fe(()=>{w.value&&(o.value.removeWidget(w.value),w.value.delete(),m.delete())}),fe(()=>{var $;const L=Qf[c.value];($=w.value)==null||$.setMode(L)}),F([a,y,w],()=>{var L;(L=w.value)==null||L.resetInteractionState()}),Pe(()=>{var L;(L=w.value)==null||L.resetInteractionState()}),Se(x(()=>{var L;return(L=w.value)==null?void 0:L.onEndInteractionEvent}))(()=>{var L;(L=w.value)!=null&&L.getWidgetState().getFinalized()&&t("finalize")}),Se(x(()=>{var L;return(L=w.value)==null?void 0:L.onSelectedEvent}))(L=>{t("select",L)}),fe(()=>{var L,$;(L=T.value)==null||L.setSelected(l.value),($=p.value)==null||$.renderLater()});let P=null;ne(()=>{w.value&&(P=w.value.onRightClickEvent(L=>{const $=so(L);$&&t("contextmenu",$)}))}),Pe(()=>{P&&(P.unsubscribe(),P=null)});const E=Ge.newInstance();ne(()=>{var L;(L=w.value)==null||L.setManipulator(E)}),fe(()=>{en(E,i.value,a.value,f.value)}),F(()=>{var L;return!!p.value&&!!w.value&&((L=d.value)==null?void 0:L.slice)===a.value},L=>{var $;($=w.value)==null||$.setVisibility(L)},{immediate:!0}),ne(()=>{var L;w.value&&(w.value.setHandleVisibility(!1),o.value.renderWidgets(),(L=p.value)==null||L.renderLater())}),F(()=>{var L;return(L=w.value)==null?void 0:L.getWidgetState().getColor()},()=>{var L,$;(L=w.value)==null||L.getWidgetState().modified(),($=p.value)==null||$.renderLater()});const k=x(()=>f.value.lpsOrientation[be(i.value)]);return fe(()=>{const L=g.value,$=k.value,K=a.value;w.value&&L&&w.value.setThresholdingImageSlice(L,$,K)}),()=>null}}),Jf=new Set([ye.FreehandDraw,ye.PointPlacing,ye.Threshold]);function ep(e,t,n=1e-6){return Math.abs(e-t)<n}const tp=X({components:{ContourWidget2D:Zf},props:{viewId:{type:String,required:!0},currentSlice:{type:Number,required:!0},viewDirection:{type:String,required:!0},widgetManager:{type:Object,required:!0}},setup(e){const{viewId:t,viewDirection:n,currentSlice:s}=ae(e),o=ke(),i=Cn(),{currentImageID:a,currentImageMetadata:r}=re(),l=x(()=>be(n.value)),{mode:c,selectedContourID:u}=lt(i),d=B(null),g=x(()=>o.currentTool===ce.Contour),y=x(()=>he().viewSpecs[t.value].viewType),f=(M,W)=>{const{toolByID:J}=i;if(!(M in J))return!1;const{referencePlane:_e,imageID:me}=J[M],Xe=Ad(_e),Dt=Sn(Xe,r.value,{allowOutOfBoundsSlice:!0});if(!Dt)return!1;const Rn=(W==null?void 0:W.checkImageID)??!1,nn=(W==null?void 0:W.checkSlice)??!1,{axis:Dn,slice:on}=Dt;return Dn===l.value&&(!Rn||me===a.value)&&(!nn||ep(on,s.value))},p=x(()=>i.toolIDs.filter(M=>f(M,{checkImageID:!0})).map(M=>i.toolByID[M]).filter(Boolean)),m=()=>{d.value=null},w=()=>{a.value&&!d.value&&(d.value=i.addTool({imageID:a.value}))},T=()=>{d.value!=null&&(i.removeTool(d.value),d.value=null)},{activeLabel:S}=lt(i);F([S,d],([M,W])=>{W&&i.updateTool(W,{label:M})},{immediate:!0}),F([g,a],([M,W])=>{T(),M&&W&&w()},{immediate:!0}),F(c,M=>{T(),Jf.has(M)&&w()},{immediate:!0}),Fe(()=>{T()});const b=M=>{M===d.value&&(m(),w())};function P(){const{lpsOrientation:M,indexToWorld:W}=r.value,J=M[l.value];return Nd(W,s.value,J)}F([s,d],([M,W])=>{W&&i.updateTool(W,{slice:M,referencePlane:P()})},{immediate:!0});const E=(M,W)=>{W?i.selectContour(M):M===u.value&&i.selectContour(null)};F([s,a],()=>{const M=u.value;M&&f(M,{checkImageID:!0,checkSlice:!0})&&i.selectContour(null)}),Wn(["Delete","Backspace"],M=>{M.preventDefault(),u.value&&i.removeTool(u.value)});const k=je({visible:!1,x:0,y:0,id:""}),L=(M,W)=>{[k.x,k.y]=W,k.visible=!0,k.id=M},$=()=>{i.removeTool(k.id)},K=x(()=>{const{id:M}=k;if(!(M in i.toolByID))return[];const W=i.toolByID[M];return Object.entries(i.labels).map(([J,_e])=>({id:J,name:_e.labelName,isCurrent:W.label===J}))}),Z=M=>{i.updateTool(k.id,{label:M})};return{isToolActive:g,is2D:x(()=>y.value==="2D"),contours:p,drawingContourID:d,selectedContourID:u,toolMode:x(()=>g.value?c.value:ye.Select),contextMenu:k,contextMenuLabels:K,onContourFinalized:b,onContourSelected:E,onContextMenu:L,deleteFromContextMenu:$,setLabelFromContextMenu:Z}}});const np=e=>(oe("data-v-f660d016"),e=e(),ie(),e),op={key:0,class:"overlay-no-events"},ip=np(()=>h("span",null,"Change label to...",-1));function sp(e,t,n,s,o,i){const a=O("ContourWidget2D");return e.is2D?(I(),D("div",op,[(I(!0),D(se,null,Re(e.contours,r=>(I(),Y(a,{key:r.id,"view-id":e.viewId,"current-slice":e.currentSlice,"contour-id":r.id,"view-direction":e.viewDirection,"widget-manager":e.widgetManager,drawing:e.drawingContourID===r.id,mode:e.toolMode,selected:e.selectedContourID===r.id,onFinalize:l=>e.onContourFinalized(r.id),onSelect:l=>e.onContourSelected(r.id,l),onContextmenu:l=>e.onContextMenu(r.id,l)},null,8,["view-id","current-slice","contour-id","view-direction","widget-manager","drawing","mode","selected","onFinalize","onSelect","onContextmenu"]))),128)),v(yt,{modelValue:e.contextMenu.visible,"onUpdate:modelValue":t[1]||(t[1]=r=>e.contextMenu.visible=r),style:ee({position:"absolute",top:`${e.contextMenu.y}px`,left:`${e.contextMenu.x}px`}),"close-on-click":"","close-on-content-click":""},{default:R(()=>[v(At,{dense:""},{default:R(()=>[v(Je,{onClick:t[0]||(t[0]=ue(()=>{},["stop"]))},{default:R(()=>[v(xe,{class:"d-flex flex-row align-center justify-space-betwen"},{default:R(()=>[ip,v(vt,null,{default:R(()=>[H("mdi-chevron-right")]),_:1})]),_:1}),v(yt,{"open-on-hover":"",activator:"parent",location:"end"},{default:R(()=>[v(At,{dense:""},{default:R(()=>[(I(!0),D(se,null,Re(e.contextMenuLabels,(r,l)=>(I(),Y(Je,{key:l},{default:R(()=>[v(cr,{label:r.name,"model-value":r.isCurrent,onClick:c=>e.setLabelFromContextMenu(r.id)},null,8,["label","model-value","onClick"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),v(Je,{onClick:e.deleteFromContextMenu},{default:R(()=>[v(xe,null,{default:R(()=>[H("Delete")]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1},8,["modelValue","style"])])):z("",!0)}const ap=A(tp,[["render",sp],["__scopeId","data-v-f660d016"]]),rp=X({name:"PaintWidget2D",props:{widgetManager:{type:Object,required:!0},viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},slice:{type:Number,required:!0}},setup(e){const{widgetManager:t,viewDirection:n,slice:s,viewId:o}=ae(e),i=ct(),a=i.getWidgetFactory(),r=he(),l=x(()=>r.getViewProxy(o.value)),c=B(),{currentImageMetadata:u}=re(),d=x(()=>be(n.value)),g=x(()=>u.value.lpsOrientation[d.value]),y=m=>{const{worldToIndex:w}=u.value,T=Le();return pe(T,m,w),T};ne(()=>{const m=t.value;if(c.value=m.addWidget(a),!c.value)throw new Error("[PaintWidget2D] failed to create view widget")}),fe(()=>{const m=c.value,w=u.value,T=w.lpsOrientation[d.value];m&&(m.setSlicingIndex(T),m.setIndexToWorld(w.indexToWorld),m.setWorldToIndex(w.worldToIndex))});const f=[];ne(()=>{const m=c.value;f.push(m.onStartInteractionEvent(()=>{const w=m.getWidgetState(),T=y(w.getBrush().getOrigin());i.startStroke(T,g.value)}),m.onInteractionEvent(()=>{const w=m.getWidgetState(),T=y(w.getBrush().getOrigin());i.placeStrokePoint(T,g.value)}),m.onEndInteractionEvent(()=>{const w=m.getWidgetState(),T=y(w.getBrush().getOrigin());i.endStroke(T,g.value)}))}),Fe(()=>{for(;f.length;)f.pop().unsubscribe()});const p=Ge.newInstance();return ne(()=>{c.value.setManipulator(p)}),fe(()=>{en(p,n.value,s.value,u.value)}),ne(()=>{c.value.setVisibility(!1)}),zt(l.value.getInteractor().onMouseEnter(()=>{const m=c.value;m&&(i.setSliceAxis(g.value),m.setVisibility(!0))})),zt(l.value.getInteractor().onMouseLeave(()=>{const m=c.value;m&&m.setVisibility(!1)})),ne(()=>{const m=t.value;m.renderWidgets(),m.grabFocus(c.value)}),Pe(()=>{t.value.removeWidget(c.value),t.value.releaseFocus()}),()=>null}}),lp=X({name:"PaintTool",props:{viewId:{type:String,required:!0},slice:{type:Number,required:!0},viewDirection:{type:String,required:!0},widgetManager:{type:Object,required:!0}},components:{PaintWidget2D:rp},setup(){const e=ct();return{active:x(()=>e.isActive)}}});const cp={class:"overlay-no-events"};function up(e,t,n,s,o,i){const a=O("PaintWidget2D");return I(),D("div",cp,[e.active?(I(),Y(a,{key:0,slice:e.slice,"view-id":e.viewId,"view-direction":e.viewDirection,"widget-manager":e.widgetManager},null,8,["slice","view-id","view-direction","widget-manager"])):z("",!0)])}const dp=A(lp,[["render",up],["__scopeId","data-v-5ff6d31b"]]);function hp(e,t){const n=he(),s=x(()=>n.getViewProxy(e.value)),o=x(()=>{var u;const c=(u=t.baseImage)==null?void 0:u.value;return c?n.getDataRepresentationForView(c,e.value):null}),i=x(()=>{var u;return(((u=t.labelmaps)==null?void 0:u.value)??[]).map(d=>n.getDataRepresentationForView(d,e.value)).filter(Boolean)}),a=x(()=>{var c;return(((c=t.layers)==null?void 0:c.value)??[]).map(u=>n.getDataRepresentationForView(u,e.value)).filter(Boolean)}),r=x(()=>{var u;return(((u=t.models)==null?void 0:u.value)??[]).map(d=>n.getDataRepresentationForView(d,e.value)).filter(Boolean)}),l=x(()=>[o.value,...i.value,...a.value,...r.value].filter(Boolean));return F([s,l],([c,u],[,d])=>{if(!c)throw new Error("[useSceneBuilder] No view available");d&&qn(u,d)||(c.removeAllRepresentations(),u.forEach(g=>{c.addRepresentation(g)}),c.getRenderer().computeVisiblePropBounds(),c.renderLater())},{immediate:!0}),{baseImageRep:o,labelmapReps:i,layerReps:a,modelReps:r}}function gp(e,t,n,...s){const o=ao();let i=!0;const a=[];s.indexOf("position")>-1&&a.push(()=>{t.value!==null&&i&&o.updateConfig(e.value,t.value,{position:n.value.getCamera().getPosition()})}),s.indexOf("viewUp")>-1&&a.push(()=>{t.value!==null&&i&&o.updateConfig(e.value,t.value,{viewUp:n.value.getCamera().getViewUp()})}),s.indexOf("focalPoint")>-1&&a.push(()=>{t.value!==null&&i&&o.updateConfig(e.value,t.value,{focalPoint:n.value.getCamera().getFocalPoint()})}),s.indexOf("directionOfProjection")>-1&&a.push(()=>{t.value!==null&&i&&o.updateConfig(e.value,t.value,{directionOfProjection:n.value.getCamera().getDirectionOfProjection()})}),s.indexOf("parallelScale")>-1&&a.push(()=>{t.value!==null&&i&&o.updateConfig(e.value,t.value,{parallelScale:n.value.getCamera().getParallelScale()})}),zt(n.value.getCamera().onModified(()=>{a.forEach(c=>c())}));function r(c){i=!1;try{c()}finally{i=!0}}function l(c){r(()=>{s.forEach(u=>{if(u==="parallelScale"&&c.parallelScale)n.value.getCamera().setParallelScale(c.parallelScale);else if(u==="position"&&c.position){const{position:d}=c;n.value.getCamera().setPosition(d[0],d[1],d[2])}else if(u==="focalPoint"&&c.focalPoint){const{focalPoint:d}=c;n.value.getCamera().setFocalPoint(d[0],d[1],d[2]),n.value.getInteractorStyle2D().setCenterOfRotation([...d]),n.value.getInteractorStyle3D().setCenterOfRotation([...d])}else if(u==="directionOfProjection"&&c.directionOfProjection){const{directionOfProjection:d}=c;n.value.getCamera().setDirectionOfProjection(d[0],d[1],d[2])}else if(u==="viewUp"&&c.viewUp){const{viewUp:d}=c;n.value.getCamera().setViewUp(d[0],d[1],d[2])}})})}return{restoreCameraConfig:l}}const fp=X({name:"CrosshairsWidget2D",props:{widgetManager:{type:Object,required:!0},viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},slice:{type:Number,required:!0}},setup(e){const{widgetManager:t,viewDirection:n,slice:s}=ae(e),i=Wt().getWidgetFactory(),a=B(),{currentImageMetadata:r}=re();ne(()=>{const c=t.value;if(a.value=c.addWidget(i),!a.value)throw new Error("[PaintWidget2D] failed to create view widget")});const l=Ge.newInstance();return ne(()=>{a.value.setManipulator(l)}),fe(()=>{en(l,n.value,s.value,r.value)}),ne(()=>{a.value.setVisibility(!0)}),ne(()=>{t.value.renderWidgets()}),Pe(()=>{t.value.removeWidget(a.value)}),()=>null}}),pp=X({props:{position:Array,viewId:{type:String,required:!0}},setup(e){const{viewId:t,position:n}=ae(e),s=B(),o=he(),i=x(()=>o.getViewProxy(t.value)),a=()=>{const c=i.value.getRenderer(),u=j(n);if(u){const d=Ht(u,c);d&&(s.value={x:d[0],y:d[1]})}};Se(x(()=>i.value.getCamera().onModified))(a),fe(a);const l=It(gn);return Tn(l,()=>{a()}),{devicePixelRatio,x:x(()=>{var c;return(c=s.value)==null?void 0:c.x}),y:x(()=>{var c;return(c=s.value)==null?void 0:c.y})}}});const mp=["x1","x2","y2"],vp=["x1","y1","x2"],yp=["y1","x2","y2"],wp=["x1","y1","y2"];function Sp(e,t,n,s,o,i){return I(),D("g",null,[e.x!=null&&e.y!=null?(I(),D("line",{key:0,x1:e.x,y1:"0%",x2:e.x,y2:e.y-8,stroke:"yellow","stroke-width":"1"},null,8,mp)):z("",!0),e.x!=null&&e.y!=null?(I(),D("line",{key:1,x1:e.x,y1:e.y+8,x2:e.x,y2:"100%",stroke:"yellow","stroke-width":"1"},null,8,vp)):z("",!0),e.x!=null&&e.y!=null?(I(),D("line",{key:2,x1:"0%",y1:e.y,x2:e.x-8,y2:e.y,stroke:"yellow","stroke-width":"1"},null,8,yp)):z("",!0),e.x!=null&&e.y!=null?(I(),D("line",{key:3,x1:e.x+8,y1:e.y,x2:"100%",y2:e.y,stroke:"yellow","stroke-width":"1"},null,8,wp)):z("",!0)])}const _p=A(pp,[["render",Sp],["__scopeId","data-v-d7c70d6c"]]),Cp=X({name:"CrosshairsTool",props:{viewId:{type:String,required:!0},slice:{type:Number,required:!0},viewDirection:{type:String,required:!0},widgetManager:{type:Object,required:!0}},components:{CrosshairsWidget2D:fp,CrosshairSVG2D:_p},setup(e){const{viewDirection:t,slice:n}=ae(e),s=ke(),{position:o,imagePosition:i}=lt(Wt()),{currentImageMetadata:a}=re(),r=x(()=>s.currentTool===ce.Crosshairs),l=x(()=>{const{lpsOrientation:c,dimensions:u}=a.value,d=be(t.value),g=c[d],y=Bi(i.value[g],0,u[g]-1);return Math.round(y)===n.value});return{active:r,position:o,isVisible:l}}});const bp={key:0,class:"overlay-no-events"},Tp={class:"overlay-no-events"};function Ip(e,t,n,s,o,i){const a=O("CrosshairSVG2D"),r=O("CrosshairsWidget2D");return e.active?(I(),D("div",bp,[(I(),D("svg",Tp,[nt(v(a,{"view-id":e.viewId,position:e.position},null,8,["view-id","position"]),[[Bt,e.isVisible]])])),v(r,{slice:e.slice,"view-id":e.viewId,"view-direction":e.viewDirection,"widget-manager":e.widgetManager},null,8,["slice","view-id","view-direction","widget-manager"])])):z("",!0)}const xp=A(Cp,[["render",Ip],["__scopeId","data-v-8f19f7a7"]]);function Rp(e,t){const n=he(),s=B(null),o=a=>{s.value=a??null},i=x(()=>n.createOrGetViewProxy(j(e),j(t)));return F(i,(a,r)=>{r.setContainer(null),a.setContainer(s.value)}),F(s,a=>{i.value.setContainer(a),i.value.modified()}),{viewProxy:i,setContainer:o}}function Dp(e,t){Se(x(()=>j(e).onModified))(t)}function ea(e){const t=B(!1),n=()=>{t.value=!!j(e).getContainer()};return n(),Dp(e,n),t}function ta(e,t){const n=ea(e);F(n,s=>{s&&t()},{immediate:!0})}function Ep(e,t){const n=ea(e);F(n,(s,o)=>{o&&!s&&t()},{immediate:!0})}function Lp(e){const t=x(()=>jr.newInstance({pickingEnabled:!1,useSvgLayer:!1,captureOn:Gr.MOUSE_MOVE}));return ta(e,()=>{t.value.setRenderer(e.value.getRenderer()),t.value.enablePicking()}),Ep(e,()=>{t.value.disablePicking()}),F(t,(n,s)=>{n&&(n.setRenderer(e.value.getRenderer()),n.enablePicking()),s&&s.delete()}),Fe(()=>{t.value.delete()}),{widgetManager:t}}function na(e){const t=Rt(),{currentImageMetadata:n,currentImageID:s}=re();return x(()=>{const o=t.getConfig(j(e),s.value);if(!o)return null;const{lpsOrientation:i}=n.value,a=be(o.axisDirection),r=[0,0,0];return r[i[a]]=o.slice,{axisName:a,axisIndex:i[a],number:o.slice,planeNormal:i[o.axisDirection],planeOrigin:r}})}function Pp(e){const t=B(null),n=()=>{var o;t.value=((o=j(e))==null?void 0:o.getContainer())??null};return Se(x(()=>{var o;return(o=j(e))==null?void 0:o.onModified}))(n),n(),t}function Op(e,t){const n=B([]),s=x(()=>{var r,l,c;return(c=(l=(r=j(t))==null?void 0:r.getRenderWindow())==null?void 0:l.getViews())==null?void 0:c[0]}),o=Pp(s),i=()=>{const r=j(e),l=j(t);r==null||!l||(n.value=r.map(c=>{const u=bs(c,l);return[u[0]/devicePixelRatio,u[1]/devicePixelRatio]}))},a=Se(x(()=>{var r;return(r=j(t))==null?void 0:r.getActiveCamera().onModified}));return Xa(o,i),fe(i),a(i),i(),n}function Vp(e,t){const n=Op(e,t);return x(()=>{var r,l;const o=n.value,i=j(t),a=(l=(r=i==null?void 0:i.getRenderWindow())==null?void 0:r.getViews())==null?void 0:l[0];if(i&&a){const[,c]=a.getViewportSize(i);return o.map(u=>[u[0],c/devicePixelRatio-u[1]])}return null})}const kp=X({props:{line:{required:!0,type:Object},clickWidth:{default:20,type:Number},outOfBounds:{default:!1,type:Boolean}},setup(){const e=B("grab"),t=B(null),n=B(0);return{onPointer:(i,a)=>{var r,l;i?(r=t.value)==null||r.setPointerCapture(a.pointerId):(l=t.value)==null||l.releasePointerCapture(a.pointerId),e.value=i?"grabbing":"grab"},onHover:i=>{n.value=i?2:0},cursor:e,grabLineEl:t,focusWidth:n}}});const Mp=["x1","y1","x2","y2","stroke-width"],Bp=["x1","y1","x2","y2","stroke-width","stroke-dasharray"],Ap=["x1","y1","x2","y2","stroke-width"],Fp=["x1","y1","x2","y2","stroke-width"];function Np(e,t,n,s,o,i){return I(),D("g",null,[h("line",{x1:e.line.startEdge[0],y1:e.line.startEdge[1],x2:e.line.startCrop[0],y2:e.line.startCrop[1],"stroke-width":2+e.focusWidth,"stroke-dasharray":"6","stroke-linecap":"square",stroke:"rgba(200, 255, 0, 0.5)"},null,8,Mp),h("line",{x1:e.line.startCrop[0],y1:e.line.startCrop[1],x2:e.line.endCrop[0],y2:e.line.endCrop[1],"stroke-width":2+e.focusWidth,"stroke-dasharray":e.outOfBounds?6:"none","stroke-linecap":"butt",stroke:"rgb(200, 255, 0)"},null,8,Bp),h("line",{x1:e.line.endCrop[0],y1:e.line.endCrop[1],x2:e.line.endEdge[0],y2:e.line.endEdge[1],"stroke-width":2+e.focusWidth,"stroke-dasharray":"6","stroke-linecap":"square",stroke:"rgba(200, 255, 0, 0.5)"},null,8,Ap),h("line",Gt({ref:"grabLineEl",class:"pointer-events-all",style:{cursor:e.cursor},onPointerenter:t[0]||(t[0]=a=>e.onHover(!0)),onPointerleave:t[1]||(t[1]=a=>e.onHover(!1)),onPointerdown:t[2]||(t[2]=a=>e.onPointer(!0,a)),onPointerup:t[3]||(t[3]=a=>e.onPointer(!1,a)),x1:e.line.startEdge[0],y1:e.line.startEdge[1],x2:e.line.endEdge[0],y2:e.line.endEdge[1],fill:"none","stroke-opacity":"0","stroke-dasharray":"none","stroke-width":Number(e.$attrs["stroke-width"]||0)+e.clickWidth||0},e.$attrs),null,16,Fp)])}const $p=A(kp,[["render",Np],["__scopeId","data-v-926e0a5c"]]);function ei(e,t,n,s){const o=na(e);return x(()=>{const i=e.value,a=t.value,r=n.value,l=s.value,c=o.value;if(!i||!a||!c)return null;const u=c.axisName,[d]=Yn.filter(S=>S!==a&&S!==u),g=r[a],y=r[d],f=l[d],p=r[u],m=c.number,w=m<p[0]||p[1]<m,T=S=>{const b=gt(),P=gt(),E=gt(),k=gt();return b[a]=g[S],P[a]=g[S],E[a]=g[S],k[a]=g[S],[b[d],k[d]]=f,[P[d],E[d]]=y,{startEdge:b,startCrop:P,endCrop:E,endEdge:k}};return{lowerLine:T(0),upperLine:T(1),outOfBounds:w}})}function ti(e,t,n){const s=x(()=>{const i=e.value,{lpsOrientation:a,indexToWorld:r}=t.value;return i?[i.lowerLine.startEdge,i.lowerLine.startCrop,i.lowerLine.endCrop,i.lowerLine.endEdge,i.upperLine.startEdge,i.upperLine.startCrop,i.upperLine.endCrop,i.upperLine.endEdge].map(l=>{const c=[0,0,0];c[a.Sagittal]=l.Sagittal,c[a.Coronal]=l.Coronal,c[a.Axial]=l.Axial;const u=[0,0,0];return pe(u,c,r),u}):null}),o=Vp(s,n);return x(()=>{const i=e.value,a=o.value;return!i||!(a!=null&&a.length)?null:{lowerLine:{startEdge:a[0],startCrop:a[1],endCrop:a[2],endEdge:a[3]},upperLine:{startEdge:a[4],startCrop:a[5],endCrop:a[6],endEdge:a[7]},outOfBounds:i.outOfBounds}})}function Up({mouseEventToLPSPoint:e,getCropEdgePos:t,setCropEdgePos:n}){const s=B(),o=B(),i=B(gt()),a=B(0);return{onPointerDown:(u,d,g)=>{const y=e(g);y&&(i.value=y,a.value=t(u,d),s.value=u,o.value=d)},onPointerMove:u=>{if(s.value==null||o.value==null)return;const d=s.value,g=e(u);if(!g)return;const y=g[d]-i.value[d];n(d,o.value,a.value+y)},onPointerUp:()=>{s.value=null,o.value=null}}}const Hp=X({props:{viewId:{required:!0,type:String}},components:{Crop2DLineHandle:$p},setup(e){const{viewId:t}=ae(e),n=he(),s=x(()=>n.getViewProxy(t.value)),o=x(()=>{var E;return(E=s.value)==null?void 0:E.getRenderer()}),{currentImageExtent:i,currentImageID:a,currentImageMetadata:r}=re(),l=na(t),c=x(()=>{var E;return((E=l.value)==null?void 0:E.axisName)??null}),u=Ct(),d=x(()=>{const E=a.value;return E&&E in u.croppingByImageID?u.croppingByImageID[E]:Qi()}),g=x(()=>Yn.filter(E=>c.value&&E!==c.value)),y=x(()=>g.value[0]??null),f=x(()=>g.value[1]??null),p=ei(t,y,d,i),m=ei(t,f,d,i),w=ti(p,r,o),T=ti(m,r,o),{onPointerDown:S,onPointerMove:b,onPointerUp:P}=Up({mouseEventToLPSPoint(E){const k=o.value;if(!k)return null;const L=l.value;if(!L)return null;const{lpsOrientation:$,worldToIndex:K}=r.value,Z=pd(E,k,L.planeOrigin,L.planeNormal);if(!Z)return null;pe(Z,Z,K);const M=gt();return M.Sagittal=Z[$.Sagittal],M.Coronal=Z[$.Coronal],M.Axial=Z[$.Axial],M},getCropEdgePos(E,k){return d.value[E][k]},setCropEdgePos(E,k,L){if(!a.value)return;const $=d.value,[K,Z]=$[E],[M,W]=i.value[E],J=[K,Z];k===0?J[0]=Math.max(M,Math.min(L,Z)):k===1&&(J[1]=Math.max(K,Math.min(L,W))),u.setCroppingForAxis(a.value,E,J)}});return{ax1:x(()=>({name:y.value,lines:w.value})),ax2:x(()=>({name:f.value,lines:T.value})),onPointerDown:S,onPointerMove:b,onPointerUp:P}}});function Wp(e,t,n,s,o,i){const a=O("crop-2D-line-handle");return I(),D("g",null,[e.ax1.lines!=null?(I(),D(se,{key:0},[v(a,{line:e.ax1.lines.lowerLine,"out-of-bounds":e.ax1.lines.outOfBounds,onPointerdown:t[0]||(t[0]=r=>e.onPointerDown(e.ax1.name,0,r)),onPointermove:e.onPointerMove,onPointerup:e.onPointerUp},null,8,["line","out-of-bounds","onPointermove","onPointerup"]),v(a,{line:e.ax1.lines.upperLine,"out-of-bounds":e.ax1.lines.outOfBounds,onPointerdown:t[1]||(t[1]=r=>e.onPointerDown(e.ax1.name,1,r)),onPointermove:e.onPointerMove,onPointerup:e.onPointerUp},null,8,["line","out-of-bounds","onPointermove","onPointerup"])],64)):z("",!0),e.ax2.lines!=null?(I(),D(se,{key:1},[v(a,{line:e.ax2.lines.lowerLine,"out-of-bounds":e.ax2.lines.outOfBounds,onPointerdown:t[2]||(t[2]=r=>e.onPointerDown(e.ax2.name,0,r)),onPointermove:e.onPointerMove,onPointerup:e.onPointerUp},null,8,["line","out-of-bounds","onPointermove","onPointerup"]),v(a,{line:e.ax2.lines.upperLine,"out-of-bounds":e.ax2.lines.outOfBounds,onPointerdown:t[3]||(t[3]=r=>e.onPointerDown(e.ax2.name,1,r)),onPointermove:e.onPointerMove,onPointerup:e.onPointerUp},null,8,["line","out-of-bounds","onPointermove","onPointerup"])],64)):z("",!0)])}const zp=A(Hp,[["render",Wp],["__scopeId","data-v-e3a0b15f"]]);function jp(e){return e.Sagittal[0]<=e.Sagittal[1]&&e.Coronal[0]<=e.Coronal[1]&&e.Axial[0]<=e.Axial[1]}function Gp(e,t){return e.Axial[0]===t.Axial[0]&&e.Axial[1]===t.Axial[1]&&e.Sagittal[0]===t.Sagittal[0]&&e.Sagittal[1]===t.Sagittal[1]&&e.Coronal[0]===t.Coronal[0]&&e.Coronal[1]===t.Coronal[1]}const Xp=X({props:{viewId:{type:String,required:!0}},setup(e){const{viewId:t}=ae(e),n=It(ur);if(!n)throw new Error("Crop3D component cannot access the 2D widget manager.");const s=he(),o=x(()=>s.getViewProxy(t.value)),i=Ct(),{currentImageID:a,currentImageMetadata:r}=re(),l=x(()=>{const f=a.value;return f&&f in i.croppingByImageID?i.croppingByImageID[f]:null}),c=Xr.newInstance(),u=c.getWidgetState();c.setEdgeHandlesEnabled(!1),c.setFaceHandlesEnabled(!0),c.setCornerHandlesEnabled(!0);const d=B();F(n,(f,p)=>{p&&p.removeWidget(c),f&&(d.value=f.addWidget(c))}),ta(o,()=>{n.value&&(d.value=n.value.addWidget(c),d.value.getRepresentations().forEach(f=>{f.getActors().forEach(p=>{p.getProperty().setAmbient(1)})}),o.value.renderLater())}),Pe(()=>{n.value&&n.value.removeWidget(c)}),F(r,f=>{u.setWorldToIndexT(f.worldToIndex),u.setIndexToWorldT(f.indexToWorld),u.placeWidget(f.worldBounds)},{immediate:!0});const g=f=>{const{lpsOrientation:p}=r.value,m=[0,0,0,0,0,0];Yn.forEach(w=>{[m[p[w]*2],m[p[w]*2+1]]=f[w]}),qn(m,u.getCroppingPlanes().getPlanes())||(u.getCroppingPlanes().setPlanes(m),o.value.renderLater())};return F(l,f=>{f&&g(f)},{immediate:!0}),Se(u.getCroppingPlanes().onModified)(()=>{const f=a.value;if(!f)return;const p=u.getCroppingPlanes().getPlanes(),{lpsOrientation:m}=r.value,w={Sagittal:He(p,"Sagittal",m),Coronal:He(p,"Coronal",m),Axial:He(p,"Axial",m)},T=l.value;T&&Gp(w,T)||(jp(w)?i.setCropping(f,w):T&&g(T))}),()=>null}}),qp=X({props:{viewId:{type:String,required:!0}},components:{Crop2D:zp,Crop3D:Xp},setup(e){const{viewId:t}=ae(e),{currentImageID:n}=re(),s=Ct(),o=ke(),i=x(()=>o.currentTool===ce.Crop);F(n,r=>{r&&!(r in s.croppingByImageID)&&s.resetCropping(r)},{immediate:!0});const a=x(()=>he().viewSpecs[t.value].viewType);return{active:i,viewType:a}}});const Kp={class:"overlay-no-events"};function Yp(e,t,n,s,o,i){const a=O("crop-2D"),r=O("crop-3D");return I(),D("svg",Kp,[e.active&&e.viewType==="2D"?(I(),Y(a,{key:0,"view-id":e.viewId},null,8,["view-id"])):z("",!0),e.active&&e.viewType==="3D"?(I(),Y(r,{key:1,"view-id":e.viewId},null,8,["view-id"])):z("",!0)])}const Qp=A(qp,[["render",Yp],["__scopeId","data-v-c08e53d9"]]),ni="ProxyManager";function Zp(e=ni){return It(e??ni)}const oi={ArrowLeft:-1,ArrowRight:1,ArrowUp:-1,ArrowDown:1},Jp=X({name:"VtkTwoView",props:{id:{type:String,required:!0},viewDirection:{type:String,required:!0},viewUp:{type:String,required:!0}},components:{SliceSlider:Oh,ViewOverlayGrid:Gh,WindowLevelTool:Yh,SliceScrollTool:Qh,PanTool:Zh,ZoomTool:Jh,RulerTool:Ig,RectangleTool:Xg,PaintTool:dp,CrosshairsTool:xp,CropTool:Qp,ContourTool:ap},setup(e){const t=io(),n=Rt(),s=ao(),o=xs(),i=ct(),{id:a,viewDirection:r,viewUp:l}=ae(e),c=B(),u=x(()=>be(r.value)),{currentImageData:d,currentImageID:g,currentImageMetadata:y,isImageLoading:f,currentLayers:p}=re(),m=we(),w=oo(),T=x(()=>n.getConfig(a.value,g.value)),S=x(()=>{var V;return((V=T.value)==null?void 0:V.slice)??w.slice}),b=x(()=>{var V;return((V=T.value)==null?void 0:V.min)??w.min}),P=x(()=>{var V;return((V=T.value)==null?void 0:V.max)??w.max}),E=x({get:()=>t.getConfig(a.value,g.value),set:V=>{const G=g.value;G!==null&&V!=null&&t.updateConfig(a.value,G,V)}}),k=x(()=>{var V;return(V=E.value)==null?void 0:V.width}),L=x(()=>{var V;return(V=E.value)==null?void 0:V.level}),$=x(()=>{if(g.value!==null&&g.value in m.imageIDToVolumeKey){const V=m.imageIDToVolumeKey[g.value],G=m.volumeInfo[V],ge=m.volumeStudy[V],ve=m.studyInfo[ge],qe=m.studyPatient[ge],Ln=m.patientInfo[qe].PatientID,an=ve.StudyID,Be=ve.StudyDescription,Lt=G.SeriesNumber,st=G.SeriesDescription;return{patientID:Ln,studyID:an,studyDescription:Be,seriesNumber:Lt,seriesDescription:st}}return null}),K=x(()=>{const{lpsOrientation:V,dimensions:G}=y.value,ge=V[u.value];return{min:0,max:G[ge]-1}}),Z=V=>{g.value!==null&&n.updateConfig(a.value,g.value,{slice:V})},{viewProxy:M,setContainer:W}=Rp(a,Xi.Slice);qa(()=>{M.value.getInteractorStyle2D().removeAllManipulators()}),ne(()=>{W(c.value),M.value.setOrientationAxesVisibility(!1)}),Pe(()=>{W(null)}),fe(()=>{const V=y.value.lpsOrientation[u.value];M.value.setSlicingMode("IJK"[V])}),F([a,g,r],([V,G,ge])=>{!G||T.value!=null||(n.updateConfig(V,G,{...K.value,axisDirection:ge}),n.resetSlice(V,G))},{immediate:!0});const J=B(!1),_e=V=>{if(!g.value||!J.value)return;const G=oi[V.key]??0;G&&(n.updateConfig(a.value,g.value,{slice:S.value+G}),V.stopPropagation())};Ka(Object.keys(oi),_e),Tn(c,()=>M.value.resize());const me=B();Fn(gn,me);const{widgetManager:Xe}=Lp(M);Fn(dr,Xe),F(d,V=>{if(g.value==null||E.value!=null||!V)return;const G=V.getPointData().getScalars().getRange();t.updateConfig(a.value,g.value,{min:G[0],max:G[1]}),t.resetWindowLevel(a.value,g.value)},{immediate:!0});const Dt=hn(),Rn=x(()=>Dt.idList.filter(V=>Dt.parentImage[V]===g.value)),nn=x(()=>p.value.map(({id:V})=>V)),{baseImageRep:Dn,labelmapReps:on,layerReps:En}=hp(a,{baseImage:g,labelmaps:Rn,layers:nn}),{cameraDirVec:mo,cameraUpVec:vo}=qh(r,l,y),{resizeToFit:it,ignoreResizeToFitTracking:yo,resetResizeToFitTracking:ga}=xh(M.value.getCamera(),!1),wo=()=>yo(()=>{const V=y.value.lpsOrientation[be(r.value)],G=y.value.lpsOrientation[be(l.value)],ge=y.value.dimensions.map((ve,qe)=>ve*y.value.spacing[qe]);M.value.resizeToFit(V,G,ge),ga()}),So=()=>{const V=y.value.worldBounds,G=[(V[0]+V[1])/2,(V[2]+V[3])/2,(V[4]+V[5])/2];yo(()=>{M.value.updateCamera(mo.value,vo.value,G),M.value.resetCamera(V)}),wo(),M.value.renderLater()};zt(M.value.onResize(()=>{it.value&&wo()})),F(it,()=>{it.value&&So()});const{restoreCameraConfig:fa}=gp(a,g,M,"parallelScale","position","focalPoint","viewUp");F([g,mo,vo],()=>{const V=s.getConfig(a.value,g.value);V?(fa(V),M.value.getRenderer().resetCameraClippingRange(),M.value.renderLater(),it.value=!1):it.value?So():it.value=!0},{immediate:!0,deep:!0});const{top:pa,left:ma}=Xh(M);fe(()=>{if(T.value==null||E.value==null)return;const{slice:V}=T.value,{width:G,level:ge}=E.value,ve=Dn.value;ve&&(ve.setSlice(V),ve.setWindowWidth(G),ve.setWindowLevel(ge)),[...En.value,...on.value].forEach(qe=>{qe.setSlice(V)}),M.value.renderLater()}),fe(()=>{const{labelmapOpacity:V}=i;on.value.forEach(G=>{G.setOpacity(V)})});const Et=x(()=>nn.value.map(V=>o.getConfig(a.value,V))),va=xt();F([a,p],()=>{p.value.forEach(({id:V},G)=>{const ge=va.layerImages[V],ve=Et.value[G];ge&&!ve&&o.resetToDefault(a.value,V,ge)})},{immediate:!0});const _o=Zp(),Co=x(()=>Et.value.map(V=>V==null?void 0:V.colorBy)),bo=x(()=>Et.value.map(V=>V==null?void 0:V.transferFunction)),To=x(()=>Et.value.map(V=>V==null?void 0:V.opacityFunction)),Io=x(()=>Et.value.map(V=>V==null?void 0:V.blendConfig));return F([En,Co,bo,To,Io],()=>{En.value.map((V,G)=>[V,Co.value[G],bo.value[G],To.value[G],Io.value[G]]).forEach(([V,G,ge,ve,qe])=>{if(!G||!ge||!ve||!qe)return;const{arrayName:sn,location:Ln}=G,an=ge,Be=ve,Lt=_o.getLookupTable(sn);Lt.setMode(qr.Preset),Lt.setPresetName(an.preset),Lt.setDataRange(...an.mappingRange);const st=_o.getPiecewiseFunction(sn);switch(st.setMode(Be.mode),st.setDataRange(...Be.mappingRange),Be.mode){case Ee.Mode.Gaussians:st.setGaussians(Be.gaussians);break;case Ee.Mode.Points:{const xo=md(Be.preset,Be.mappingRange,Be.shift);xo&&st.setPoints(xo);break}case Ee.Mode.Nodes:st.setNodes(Be.nodes);break}V.setRescaleOnColorBy(!1),V.setColorBy(sn,Ln),V.setOpacity(qe.opacity),M.value.renderLater()})},{immediate:!0,deep:!0}),{vtkContainerRef:c,toolContainer:me,viewID:a,viewProxy:M,viewAxis:u,active:!0,currentSlice:S,sliceMin:b,sliceMax:P,windowWidth:k,windowLevel:L,topLabel:pa,leftLabel:ma,isImageLoading:f,setSlice:Z,widgetManager:Xe,dicomInfo:$,enableResizeToFit(){it.value=!0},hover:J}}});const em=e=>(oe("data-v-f1605346"),e=e(),ie(),e),tm={class:"vtk-gutter"},nm={class:"vtk-sub-container"},om={class:"vtk-view",ref:"vtkContainerRef"},im={class:"overlay-no-events tool-layer",ref:"toolContainer"},sm={class:"annotation-cell"},am={class:"annotation-cell"},rm={class:"annotation-cell"},lm={key:0},cm={class:"annotation-cell"},um={key:0,class:"overlay-no-events loading"},dm=em(()=>h("div",null,"Loading the image",-1));function hm(e,t,n,s,o,i){const a=O("slice-slider"),r=O("pan-tool"),l=O("zoom-tool"),c=O("slice-scroll-tool"),u=O("window-level-tool"),d=O("contour-tool"),g=O("ruler-tool"),y=O("rectangle-tool"),f=O("paint-tool"),p=O("crosshairs-tool"),m=O("crop-tool"),w=O("view-overlay-grid");return I(),D("div",{class:"vtk-container-wrapper",tabindex:"0",onPointerenter:t[0]||(t[0]=T=>e.hover=!0),onPointerleave:t[1]||(t[1]=T=>e.hover=!1),onFocusin:t[2]||(t[2]=T=>e.hover=!0),onFocusout:t[3]||(t[3]=T=>e.hover=!1)},[h("div",tm,[v(ft,{dark:"",icon:"",size:"medium",variant:"text",onClick:e.enableResizeToFit},{default:R(()=>[v(vt,{size:"medium",class:"py-1"},{default:R(()=>[H("mdi-camera-flip-outline")]),_:1}),v(pi,{location:"right",activator:"parent",transition:"slide-x-transition"},{default:R(()=>[H(" Reset Camera ")]),_:1})]),_:1},8,["onClick"]),v(a,{class:"slice-slider",slice:e.currentSlice,min:e.sliceMin,max:e.sliceMax,step:1,"handle-height":20,onInput:e.setSlice},null,8,["slice","min","max","onInput"])]),h("div",{class:N(["vtk-container",e.active?"active":""])},[h("div",nm,[h("div",om,null,512)]),h("div",im,[v(r,{"view-id":e.viewID},null,8,["view-id"]),v(l,{"view-id":e.viewID},null,8,["view-id"]),v(c,{"view-id":e.viewID},null,8,["view-id"]),v(u,{"view-id":e.viewID},null,8,["view-id"]),v(d,{"view-id":e.viewID,"widget-manager":e.widgetManager,"view-direction":e.viewDirection,"current-slice":e.currentSlice},null,8,["view-id","widget-manager","view-direction","current-slice"]),v(g,{"view-id":e.viewID,"widget-manager":e.widgetManager,"view-direction":e.viewDirection,"current-slice":e.currentSlice},null,8,["view-id","widget-manager","view-direction","current-slice"]),v(y,{"view-id":e.viewID,"widget-manager":e.widgetManager,"view-direction":e.viewDirection,"current-slice":e.currentSlice},null,8,["view-id","widget-manager","view-direction","current-slice"]),v(f,{"view-id":e.viewID,"view-direction":e.viewDirection,"widget-manager":e.widgetManager,slice:e.currentSlice},null,8,["view-id","view-direction","widget-manager","slice"]),v(p,{"view-id":e.viewID,"view-direction":e.viewDirection,"widget-manager":e.widgetManager,slice:e.currentSlice},null,8,["view-id","view-direction","widget-manager","slice"]),v(m,{"view-id":e.viewID},null,8,["view-id"])],512),v(w,{class:"overlay-no-events view-annotations"},{"top-center":R(()=>[h("div",sm,[h("span",null,U(e.topLabel),1)])]),"middle-left":R(()=>[h("div",am,[h("span",null,U(e.leftLabel),1)])]),"bottom-left":R(()=>[h("div",rm,[h("div",null,"Slice: "+U(e.currentSlice+1)+"/"+U(e.sliceMax+1),1),typeof e.windowWidth=="number"&&typeof e.windowLevel=="number"?(I(),D("div",lm," W/L: "+U(e.windowWidth.toFixed(2))+" / "+U(e.windowLevel.toFixed(2)),1)):z("",!0)])]),"top-right":R(()=>[h("div",cm,[e.dicomInfo!==null?(I(),Y(yt,{key:0,"open-on-hover":"",location:"bottom left",left:"","nudge-left":"10",dark:"","max-width":"300px"},{activator:R(({props:T})=>[v(vt,Gt(T,{dark:"",size:"x-large",class:"pointer-events-all hover-info"}),{default:R(()=>[H(" mdi-information ")]),_:2},1040)]),default:R(()=>[v(At,{class:"bg-grey-darken-3"},{default:R(()=>[v(Je,null,{default:R(()=>[v(xe,{class:"font-weight-bold"},{default:R(()=>[H(" PATIENT / CASE ")]),_:1}),v(Pn),v(xe,null,{default:R(()=>[H(" ID: "+U(e.dicomInfo.patientID),1)]),_:1})]),_:1}),v(Je,null,{default:R(()=>[v(xe,{class:"font-weight-bold"},{default:R(()=>[H(" STUDY ")]),_:1}),v(Pn),v(xe,null,{default:R(()=>[H(" ID: "+U(e.dicomInfo.studyID),1)]),_:1}),v(xe,null,{default:R(()=>[H(U(e.dicomInfo.studyDescription),1)]),_:1})]),_:1}),v(Je,null,{default:R(()=>[v(xe,{class:"font-weight-bold"},{default:R(()=>[H(" SERIES ")]),_:1}),v(Pn),v(xe,null,{default:R(()=>[H(" Series #: "+U(e.dicomInfo.seriesNumber),1)]),_:1}),v(xe,null,{default:R(()=>[H(U(e.dicomInfo.seriesDescription),1)]),_:1})]),_:1})]),_:1})]),_:1})):z("",!0)])]),_:1}),v(De,{name:"loading"},{default:R(()=>[e.isImageLoading?(I(),D("div",um,[dm,h("div",null,[v(hr,{indeterminate:"",color:"blue"})])])):z("",!0)]),_:1})],2)],32)}const oa=A(Jp,[["render",hm],["__scopeId","data-v-f1605346"]]);const gm={components:{CheckContoursToolStrip:Ih,VtkTwoView:oa}},fm={class:"viewers-tools-container"},pm={class:"tool-strip"};function mm(e,t,n,s,o,i){const a=O("VtkTwoView"),r=O("CheckContoursToolStrip");return I(),D("div",fm,[v(a,{key:"sagitalv",id:"Sagittal",viewDirection:"Posterior",viewUp:"Superior"}),h("div",pm,[v(r)]),v(a,{key:"sagitalv",id:"Coronal",viewDirection:"Right",viewUp:"Superior"})])}const ia=A(gm,[["render",mm],["__scopeId","data-v-2880b87f"]]);async function vm(e){const t=e.createReader(),n=[];let s=[];do s=await new Promise((o,i)=>{t.readEntries(o,i)}),n.push(...s);while(s.length);return n}async function ym(e){return new Promise((t,n)=>{e.file(t,n)})}async function wm(e){const t=[...e],n=[];for(;t.length;){const s=t.shift();s.isFile?n.push(s):t.push(...await vm(s))}return Promise.all(n.map(ym))}const Sm={name:"DragAndDrop",props:{enabled:Boolean},data(){return{dragHover:!1}},methods:{onDragOver(e){if(this.enabled){e.preventDefault();const{types:t}=e.dataTransfer;(t&&t instanceof Array?t.indexOf("Files")!==-1:"Files"in t)&&(this.dragHover=!0,this.dragTimeout!==null&&(window.clearTimeout(this.dragTimeout),this.dragTimeout=null))}},onDragLeave(){this.enabled&&(this.dragTimeout=window.setTimeout(()=>{this.dragHover=!1,this.dragTimeout=null},50))},async onDrop(e){if(this.enabled)if(this.dragHover=!1,e.dataTransfer.items){const t=[...e.dataTransfer.items].map(s=>(s.webkitGetAsEntry||s.getAsEntry).call(s)),n=await wm(t);this.$emit("drop-files",n)}else this.$emit("drop-files",Array.from(e.dataTransfer.files))}},created(){this.dragTimeout=null}};function _m(e,t,n,s,o,i){return I(),D("div",Gt({onDragover:t[0]||(t[0]=ue((...a)=>i.onDragOver&&i.onDragOver(...a),["prevent"])),onDragleave:t[1]||(t[1]=(...a)=>i.onDragLeave&&i.onDragLeave(...a)),onDrop:t[2]||(t[2]=ue((...a)=>i.onDrop&&i.onDrop(...a),["prevent"]))},e.$attrs),[Ce(e.$slots,"default",{dragHover:o.dragHover})],16)}const Cm=A(Sm,[["render",_m]]);const bm={components:{DragAndDrop:Cm,CheckContours:ia},data(){return{showOverlay:!1,showTextOverlay:!1,isDraggingOver:!1,loadFileText:"Load Files",browseTextFile:"Browse your data to automatically add a new study.",dataStore:Yt(),currentPatientStoreID:null}},methods:{async openFiles(e){const t=Array.from(e).map(is);this.loadFiles(t)},async loadFiles(e){const t=await sh(e);this.currentPatientStoreID=t[0].data[0].dataID;const s=vn(g=>g.ok,t)[0];if(!this.dataStore.primarySelection&&s.length){const g=nh(s[0]);g&&this.dataStore.setPrimarySelection(g)}const o=we(),i=this.currentPatientStoreID;window.sessionStorage.setItem("target-volume-key",i);const a=o.volumeInfo[i],r=o.volumeStudy[i],l=o.studyInfo[r],c=o.studyPatient[r],u=o.patientInfo[c],d={id:1,name:u.PatientID,lastname:u.PatientName,dob:u.PatientBirthDate,gender:u.PatientSex,scandate:l.StudyDate,scanlocation:a.SeriesDescription};this.$emit("new-patient",d),this.openOverlay()},handleKeyDown(e){console.log(e.key),e.key===" "&&this.showOverlay()},openOverlay(){this.showOverlay&&(this.showTextOverlay=!1),this.showOverlay=!this.showOverlay,this.showOverlay&&setTimeout(()=>{this.showTextOverlay=!0},200)},openFileDialog(){this.$refs.fileInput.click()},handleFileChange(e){const t=e.target.files[0];this.openFiles(t)},handleDragEnter(e){e.preventDefault(),this.isDraggingOver=!0},handleDragOver(e){e.preventDefault(),this.isDraggingOver=!0,this.loadFileText="Drop File to Upload"},handleDragLeave(e){e.preventDefault(),this.isDraggingOver=!1,this.loadFileText="Load Files"}}},ho=e=>(oe("data-v-407c19f9"),e=e(),ie(),e),Tm={style:{position:"relative"}},Im=ho(()=>h("i",{class:"fa-solid fa-user-plus",style:{color:"#ffffff"}},null,-1)),xm=ho(()=>h("i",{class:"fa-solid fa-file-import fa-2xl",style:{color:"#ffffff"}},null,-1)),Rm=ho(()=>h("br",null,null,-1)),Dm={style:{display:"none"}};function Em(e,t,n,s,o,i){const a=O("drag-and-drop"),r=O("CheckContours");return I(),D(se,null,[h("div",Tm,[h("button",{onClick:t[0]||(t[0]=(...l)=>i.openOverlay&&i.openOverlay(...l))},[H(" Add New Patient "),Im]),v(a,{enabled:"",onDropFiles:i.openFiles,id:"app-container"},{default:R(()=>[h("div",{class:N(["overlay",{show:o.showOverlay}]),onDragover:t[8]||(t[8]=(...l)=>i.handleDragOver&&i.handleDragOver(...l))},[h("div",{class:N(["add-patient-header",{visible:o.showTextOverlay}])},[h("i",{onClick:t[1]||(t[1]=(...l)=>i.openOverlay&&i.openOverlay(...l)),onKeydown:t[2]||(t[2]=(...l)=>i.handleKeyDown&&i.handleKeyDown(...l)),class:"fa-solid fa-xmark fa-xl",style:{color:"#ffffff"}},null,32)],2),h("div",{onClick:t[4]||(t[4]=(...l)=>i.openFileDialog&&i.openFileDialog(...l)),onDragenter:t[5]||(t[5]=(...l)=>i.handleDragEnter&&i.handleDragEnter(...l)),onDragleave:t[6]||(t[6]=(...l)=>i.handleDragLeave&&i.handleDragLeave(...l)),onKeydown:t[7]||(t[7]=(...l)=>i.handleKeyDown&&i.handleKeyDown(...l)),class:N(["load-files",{visible:o.showTextOverlay}])},[h("input",{type:"file",ref:"fileInput",style:{display:"none"},onChange:t[3]||(t[3]=(...l)=>i.handleFileChange&&i.handleFileChange(...l)),"aria-labelledby":"fileInput"},null,544),xm,Rm,h("h2",null,U(o.loadFileText),1),h("h4",null,U(o.browseTextFile),1)],34)],34)]),_:1},8,["onDropFiles"])]),h("div",Dm,[v(r)])],64)}const Lm=A(bm,[["render",Em],["__scopeId","data-v-407c19f9"]]);const Pm={data(){return{searchTerm:""}},methods:{handleInput(){this.$emit("search-term-updated",this.searchTerm)},handleSearch(){this.$emit("search-term-updated",this.searchTerm)},handleKeydown(e){e.key==="Escape"?(e.preventDefault(),this.searchTerm=""):e.key==="Backspace"&&(e.preventDefault(),this.searchTerm=this.searchTerm.slice(0,-1)),this.handleInput()}}},Om={class:"searchbar"};function Vm(e,t,n,s,o,i){return I(),D("div",Om,[nt(h("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=a=>o.searchTerm=a),onInput:t[1]||(t[1]=(...a)=>i.handleInput&&i.handleInput(...a)),placeholder:"Find Patient...","aria-labelledby":"findPatientSearchBox",onKeydown:t[2]||(t[2]=(...a)=>i.handleKeydown&&i.handleKeydown(...a))},null,544),[[An,o.searchTerm]])])}const km=A(Pm,[["render",Vm],["__scopeId","data-v-65339542"]]);const Mm={methods:{logOutUser(){window.localStorage.clear(),window.sessionStorage.clear(),window.localStorage.setItem("userLoggedIn","GUEST USER")}}},Bm=e=>(oe("data-v-3e27debf"),e=e(),ie(),e),Am=Bm(()=>h("i",{class:"fa-solid fa-arrow-right-from-bracket",style:{color:"#ffffff"}},null,-1));function Fm(e,t,n,s,o,i){const a=O("router-link");return I(),Y(a,{to:"/login",style:{"text-decoration":"none"}},{default:R(()=>[h("button",{onClick:t[0]||(t[0]=(...r)=>i.logOutUser&&i.logOutUser(...r))},[H(" Log Out "),Am])]),_:1})}const Nm=A(Mm,[["render",Fm],["__scopeId","data-v-3e27debf"]]);const $m={props:{message:String},methods:{closePopup(){this.$emit("closePopup")},confirm(){this.$emit("confirmDelete"),this.closePopup()},handleKeydown(){}}},Um={class:"popup-box"},Hm={class:"popup-buttons"};function Wm(e,t,n,s,o,i){return I(),D("div",{class:"popup-overlay",onClick:t[2]||(t[2]=(...a)=>i.closePopup&&i.closePopup(...a)),onKeydown:t[3]||(t[3]=(...a)=>i.handleKeydown&&i.handleKeydown(...a))},[h("div",Um,[h("p",null,U(n.message),1),h("div",Hm,[h("button",{onClick:t[0]||(t[0]=(...a)=>i.confirm&&i.confirm(...a))},"Delete"),h("button",{onClick:t[1]||(t[1]=(...a)=>i.closePopup&&i.closePopup(...a))},"Cancel")])])],32)}const zm=A($m,[["render",Wm],["__scopeId","data-v-eece1ae8"]]);const jm={data(){return{username:"GUEST USER",filter:"",container:"container",patients:[{id:111,name:"SAMPLE",lastname:"SAMPLE",dob:"01/02/1982",breathingrate:"60",age:"32",weight:65,height:175,gender:"Male",scandate:"01/02/2023",scanlocation:"Area 19 Office"}],removePatientTarget:""}},components:{HomeGreetings:mc,PatientContainer:Oc,AddPatient:Lm,FindPatient:km,LogOut:Nm,PopUpDelete:zm},mounted(){this.username=window.localStorage.getItem("userLoggedIn"),window.localStorage.setItem("currentView","QualityCheck")},methods:{updatefilter(e){this.filter=e},handleRemovePatient(e){this.removePatientTarget=e},handleDeletePatient(){this.removePatientById(this.removePatientTarget.id),this.removePatientTarget=null},removePatientById(e){const t=this.patients.findIndex(n=>n.id===e);t!==-1&&this.patients.splice(t,1)},getTimeOfDay(){const e=new Date().getHours();return e>=5&&e<12?"Morning":e>=12&&e<18?"Afternoon":e>=18&&e<23?"Evening":"Day"},handleNewPatient(e){this.patients.push(e)}},created(){this.timeofday=this.getTimeOfDay(),this.container=`${this.container} ${this.timeofday.toLowerCase()}`}},sa=e=>(oe("data-v-a347b694"),e=e(),ie(),e),Gm={class:"home"},Xm=sa(()=>h("br",null,null,-1)),qm={class:"user-bar"},Km=sa(()=>h("h5",{style:{color:"grey","margin-left":"90%"}},"Area 19 OCG Prototype V.0.1",-1));function Ym(e,t,n,s,o,i){const a=O("PopUpDelete"),r=O("HomeGreetings"),l=O("AddPatient"),c=O("FindPatient"),u=O("LogOut"),d=O("PatientContainer");return I(),D("div",{class:N(o.container)},[h("div",Gm,[o.removePatientTarget?(I(),Y(a,{key:0,message:`You are about to delete ${o.removePatientTarget.name} and all it's files. Are you sure you want to proceed?`,onClosePopup:t[0]||(t[0]=g=>o.removePatientTarget=null),onConfirmDelete:i.handleDeletePatient},null,8,["message","onConfirmDelete"])):z("",!0),v(r,{username:o.username},null,8,["username"]),Xm,h("div",qm,[v(l,{onNewPatient:i.handleNewPatient},null,8,["onNewPatient"]),v(c,{onSearchTermUpdated:i.updatefilter},null,8,["onSearchTermUpdated"]),v(u,{style:{"margin-left":"auto","align-self":"center"}})]),v(d,{patients:o.patients,filter:o.filter,onRemovePatient:i.handleRemovePatient},null,8,["patients","filter","onRemovePatient"]),Km])],2)}const Qm=A(jm,[["render",Ym],["__scopeId","data-v-a347b694"]]),Zm=X({components:{ToolButton:$e,MenuToolButton:As,ItemGroup:Vs,GroupableItem:ks,PaintControls:Bs,CropControls:Fs,RulerControls:Ns,RectangleControls:$s,ContourControls:Us},setup(){const e=Yt(),t=ke(),n=x(()=>!e.primaryDataset),s=x(()=>t.currentTool),o=ze(),i=We(),a=B(!1),r=B(!1);return Wn("Escape",()=>{a.value=!1,r.value=!1}),{currentTool:s,setCurrentTool:t.setCurrentTool,noCurrentImage:n,Tools:ce,paintMenu:a,cropMenu:r,rectangleStore:o,rulerStore:i}}});const go=e=>(oe("data-v-001108e5"),e=e(),ie(),e),Jm=go(()=>h("div",{class:"my-1 tool-separator"},null,-1)),ev=go(()=>h("div",{class:"my-1 tool-separator"},null,-1)),tv=go(()=>h("div",{class:"my-1 tool-separator"},null,-1));function nv(e,t,n,s,o,i){const a=O("tool-button"),r=O("groupable-item"),l=O("paint-controls"),c=O("menu-tool-button"),u=O("rectangle-controls"),d=O("ruler-controls"),g=O("contour-controls"),y=O("crop-controls"),f=O("item-group");return I(),Y(f,{mandatory:"","model-value":e.currentTool,"onUpdate:modelValue":t[0]||(t[0]=p=>e.setCurrentTool(p))},{default:R(()=>[Jm,v(r,{value:e.Tools.WindowLevel},{default:R(({active:p,toggle:m})=>[v(a,{icon:"mdi-circle-half-full",name:"Window & Level",buttonClass:["tool-btn",p?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),v(r,{value:e.Tools.Pan},{default:R(({active:p,toggle:m})=>[v(a,{icon:"mdi-cursor-move",name:"Pan",buttonClass:["tool-btn",p?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),v(r,{value:e.Tools.Zoom},{default:R(({active:p,toggle:m})=>[v(a,{icon:"mdi-magnify-plus-outline",name:"Zoom",buttonClass:["tool-btn",p?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),v(r,{value:e.Tools.Crosshairs},{default:R(({active:p,toggle:m})=>[v(a,{icon:"mdi-crosshairs",name:"Crosshairs",buttonClass:["tool-btn",p?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),ev,v(r,{value:e.Tools.Paint},{default:R(({active:p,toggle:m})=>[v(c,{icon:"mdi-brush",name:"Paint",active:p,disabled:e.noCurrentImage,onClick:m},{default:R(()=>[v(l)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),v(r,{value:e.Tools.Rectangle},{default:R(({active:p,toggle:m})=>[v(c,{icon:"mdi-vector-square",name:"Rectangle",mobileOnlyMenu:!0,active:p,disabled:e.noCurrentImage,onClick:m},{default:R(()=>[v(u)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),v(r,{value:e.Tools.Ruler},{default:R(({active:p,toggle:m})=>[v(c,{icon:"mdi-ruler",name:"Ruler",mobileOnlyMenu:!0,active:p,disabled:e.noCurrentImage,onClick:m},{default:R(()=>[v(d)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),v(r,{value:e.Tools.Contour},{default:R(({active:p,toggle:m})=>[v(c,{icon:"mdi-shape-circle-plus",name:"Contour","mobile-only-menu":"",active:p,disabled:e.noCurrentImage,onClick:m},{default:R(()=>[v(g)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),tv,v(r,{value:e.Tools.Crop},{default:R(({active:p,toggle:m})=>[v(c,{icon:"mdi-crop",name:"Crop",active:p,disabled:e.noCurrentImage,onClick:m},{default:R(()=>[v(y)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"])]),_:1},8,["model-value"])}const ov=A(Zm,[["render",nv],["__scopeId","data-v-001108e5"]]);const iv={props:{number:{type:Number,default:1},radius:{type:Number,default:26},fontSize:{type:Number,default:18}}};function sv(e,t,n,s,o,i){return I(),D("div",{class:"circleIcon",style:ee({width:n.radius+"px",height:n.radius+"px",fontSize:n.fontSize+"px"})},U(n.number),5)}const aa=A(iv,[["render",sv],["__scopeId","data-v-22b182c8"]]);const av={components:{IconNumber:aa},data(){return{taskList:[{taskDescription:"Use the split handles to make sure the beginning and end of each breathing state is correct",showMeHow:"https://www.youtube.com/watch?v=dQw4w9WgXcQ",completeStatus:!1},{taskDescription:"Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.",showMeHow:"https://www.youtube.com/watch?v=dQw4w9WgXcQ",completeStatus:!1},{taskDescription:"This task is simple and does not have a show me how.",showMeHow:null,completeStatus:!1},{taskDescription:"Use the split handles to make sure the beginning and end of each breathing state is correct",showMeHow:"https://www.youtube.com/watch?v=dQw4w9WgXcQ",completeStatus:!1},{taskDescription:"This is a very short task",showMeHow:"https://www.youtube.com/watch?v=dQw4w9WgXcQ",completeStatus:!1},{taskDescription:"Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut",showMeHow:"https://www.youtube.com/watch?v=dQw4w9WgXcQ",completeStatus:!1}]}}},ra=e=>(oe("data-v-026e2f43"),e=e(),ie(),e),rv={class:"task-container"},lv=ra(()=>h("div",{class:"title"},[h("h4",null,"Task List")],-1)),cv={key:0},uv={class:"task"},dv={class:"number"},hv={class:"task-text-container"},gv={class:"task-text"},fv=["href"],pv=ra(()=>h("p",{class:"task-text tutorial"},"Show me how",-1)),mv=[pv],vv={class:"button-container"},yv=["onClick"];function wv(e,t,n,s,o,i){const a=O("IconNumber");return I(),D("div",rv,[lv,(I(!0),D(se,null,Re(o.taskList,(r,l)=>(I(),D("div",{key:l},[v(De,null,{default:R(()=>[r.completeStatus?z("",!0):(I(),D("div",cv,[h("div",uv,[h("div",dv,[v(a,{number:l+1,radius:22,fontSize:16},null,8,["number"])]),h("div",hv,[h("p",gv,U(r.taskDescription),1),r.showMeHow?(I(),D("a",{key:0,href:r.showMeHow,class:"tutorial"},mv,8,fv)):z("",!0)])]),h("div",vv,[h("button",{onClick:c=>r.completeStatus=!r.completeStatus,style:ee({backgroundColor:r.completeStatus?"#4CAF50":null,color:r.completeStatus?"white":null})}," Complete ",12,yv)])]))]),_:2},1024)]))),128))])}const Sv=A(av,[["render",wv],["__scopeId","data-v-026e2f43"]]);const _v={components:{ToolStrip:ov,IconNumber:aa,TaskListOverlay:Sv},props:{activeComponent:{type:String,default:"analysis"}},data(){return{patient:null,patientName:null,patientLastName:null,patientBrate:null,patientage:null,patientweight:null,patientheight:null,patientgender:null,checkContours:null,viewTasks:!1}},mounted(){const e=window.sessionStorage.getItem("currentQaView");e?this.handleclick(e):this.checkContours=!1,this.patient=JSON.parse(window.localStorage.getItem("currentPatient")),this.patientName=this.patient.name.toUpperCase(),this.patientLastName=this.patient.lastname.toUpperCase(),this.patientBrate=this.patient.breathingrate,this.patientage=this.patient.age,this.patientweight=this.patient.weight,this.patientheight=this.patient.height,this.patientgender=this.patient.gender},methods:{handleclick(e){e==="CheckBreathingSplits"?this.checkContours=!1:this.checkContours=!0,window.sessionStorage.setItem("currentQaView",e),this.$emit("updatequalitycheck",this.checkContours)},handleKeyDown(){}}},Ne=e=>(oe("data-v-f7dd5cb7"),e=e(),ie(),e),Cv={class:"header-container"},bv={class:"patient-info-container"},Tv={class:"patient-name"},Iv=Ne(()=>h("h3",{class:"label"},"PATIENT",-1)),xv={class:"breathing-rate"},Rv=Ne(()=>h("h3",{class:"label",style:{"text-align":"left"}},[H("RESTING "),h("br"),H("HEART RATE")],-1)),Dv={class:"info"},Ev=Ne(()=>h("h3",{class:"label"},"AGE",-1)),Lv=Ne(()=>h("h3",{class:"label"},"WEIGHT",-1)),Pv=Ne(()=>h("h3",{class:"label"},"HEIGHT",-1)),Ov=Ne(()=>h("h3",{class:"label"},"GENDER",-1)),Vv={key:0,class:"tools"},kv={key:1,class:"quality-screen-toggle"},Mv=Ne(()=>h("h2",null,"CHECK BREATHING SPLITS",-1)),Bv=Ne(()=>h("h2",null,"CHECK CONTOURS",-1)),Av={class:"help-container"},Fv=Ne(()=>h("i",{class:"fa-solid fa-question fa-sm"},null,-1)),Nv=[Fv],$v=Ne(()=>h("h2",{class:"task-label"},"TASK",-1));function Uv(e,t,n,s,o,i){const a=O("ToolStrip"),r=O("IconNumber"),l=O("TaskListOverlay");return I(),D("div",Cv,[h("div",bv,[h("div",Tv,[Iv,h("h3",null,U(o.patientName)+" "+U(o.patientLastName),1)]),h("div",xv,[h("h1",null,U(o.patientBrate),1),Rv]),h("div",Dv,[h("div",null,[Ev,h("h3",null,U(o.patientage),1)]),h("div",null,[Lv,h("h3",null,U(o.patientweight)+" Kg",1)]),h("div",null,[Pv,h("h3",null,U(o.patientheight)+" cm",1)]),h("div",null,[Ov,h("h3",null,U(o.patientgender),1)])])]),n.activeComponent=="GraphicalAnalysis"?(I(),D("div",Vv,[v(a)])):z("",!0),n.activeComponent=="QualityCheck"?(I(),D("div",kv,[h("div",{class:N(["toggleQaContainer",{clicked:o.checkContours==!1}]),onClick:t[0]||(t[0]=c=>i.handleclick("CheckBreathingSplits")),onKeydown:t[1]||(t[1]=ot(ue((...c)=>i.handleKeyDown&&i.handleKeyDown(...c),["prevent"]),["space"]))},[v(r),Mv],34),h("div",{class:N(["toggleQaContainer",{clicked:o.checkContours}]),onClick:t[2]||(t[2]=c=>i.handleclick("CheckContours")),onKeydown:t[3]||(t[3]=ot(ue((...c)=>i.handleKeyDown&&i.handleKeyDown(...c),["prevent"]),["space"]))},[v(r,{number:2}),Bv],34)])):z("",!0),h("div",Av,[h("div",{class:N(["helpIcon",{activeIcon:o.viewTasks}]),onClick:t[4]||(t[4]=c=>o.viewTasks=!o.viewTasks),onKeydown:t[5]||(t[5]=(...c)=>i.handleKeyDown&&i.handleKeyDown(...c))},Nv,34),$v,v(De,null,{default:R(()=>[o.viewTasks?(I(),Y(l,{key:0})):z("",!0)]),_:1})])])}const Hv=A(_v,[["render",Uv],["__scopeId","data-v-f7dd5cb7"]]);const Wv={data(){return{selectedTool:"QualityCheck"}},methods:{selectTool(e){this.selectedTool!==e&&(this.selectedTool=e,this.$emit("tool-selected",e))},handleKeyDown(e){console.log(e),e.key==="1"?this.selectTool("QualityCheck"):e.key==="2"?this.selectTool("GraphicalAnalysis"):this.selectTool("ReportMaker")}},mounted(){this.selectedTool=window.localStorage.getItem("currentView")}},In=e=>(oe("data-v-46cbd000"),e=e(),ie(),e),zv={class:"toolbar"},jv={class:"tools"},Gv={class:"tool"},Xv={key:0,class:"fa-solid fa-people-arrows fa-xl"},qv={key:1,class:"fa-solid fa-people-arrows fa-lg"},Kv=In(()=>h("h4",{class:"section-tag"},"Patient List",-1)),Yv={key:0,class:"fa-solid fa-file-circle-check fa-xl"},Qv={key:1,class:"fa-solid fa-file-circle-check fa-lg"},Zv=In(()=>h("h4",{class:"section-tag"},"Quality Check",-1)),Jv={key:0,class:"fa-sharp fa-solid fa-microscope fa-xl"},e0={key:1,class:"fa-sharp fa-solid fa-microscope fa-lg"},t0=In(()=>h("h4",{class:"section-tag"},"Analysis",-1)),n0={key:0,class:"fa-regular fa-file-pdf fa-xl"},o0={key:1,class:"fa-regular fa-file-pdf fa-lg"},i0=In(()=>h("h4",{class:"section-tag"},"Report",-1));function s0(e,t,n,s,o,i){const a=O("router-link");return I(),D("div",zv,[h("div",jv,[v(a,{to:"/home",style:{"text-decoration":"none"},class:"normal"},{default:R(()=>[h("div",Gv,[e.$matches.mediumLaptop.min?(I(),D("i",Xv)):(I(),D("i",qv)),Kv])]),_:1}),h("div",{class:N(["tool",{active:o.selectedTool==="QualityCheck"}]),onClick:t[0]||(t[0]=r=>i.selectTool("QualityCheck")),onKeydown:t[1]||(t[1]=ue((...r)=>i.handleKeyDown&&i.handleKeyDown(...r),["prevent"]))},[e.$matches.mediumLaptop.min?(I(),D("i",Yv)):(I(),D("i",Qv)),Zv],34),h("div",{class:N(["tool",{active:o.selectedTool==="GraphicalAnalysis"}]),onClick:t[2]||(t[2]=r=>i.selectTool("GraphicalAnalysis")),onKeydown:t[3]||(t[3]=ue((...r)=>i.handleKeyDown&&i.handleKeyDown(...r),["prevent"]))},[e.$matches.mediumLaptop.min?(I(),D("i",Jv)):(I(),D("i",e0)),t0],34),h("div",{class:N(["tool",{active:o.selectedTool==="ReportMaker"}]),onClick:t[4]||(t[4]=r=>i.selectTool("ReportMaker")),onKeydown:t[5]||(t[5]=ue((...r)=>i.handleKeyDown&&i.handleKeyDown(...r),["prevent"]))},[e.$matches.mediumLaptop.min?(I(),D("i",n0)):(I(),D("i",o0)),i0],34)])])}const a0=A(Wv,[["render",s0],["__scopeId","data-v-46cbd000"]]);const r0={props:{heartrate:{type:Number,required:!0},duration:{type:String,required:!0},state:{type:String,required:!0},isActive:{type:Boolean,required:!0},stateColor:{type:String,required:!1,default:"#66C9DA"}},data(){return{isHovered:!1}},methods:{handleClick(){this.$emit("state-change",this.state)}}},la=e=>(oe("data-v-258e6b3d"),e=e(),ie(),e),l0={class:"button-content"},c0={style:{display:"flex","justify-content":"space-between"}},u0=la(()=>h("h4",null,"HEART RATE",-1)),d0=la(()=>h("h4",null,"DURATION",-1));function h0(e,t,n,s,o,i){return I(),D("div",{class:N({"custom-button":!0,highlighted:n.isActive}),onClick:t[0]||(t[0]=(...a)=>i.handleClick&&i.handleClick(...a)),onMouseover:t[1]||(t[1]=a=>o.isHovered=!0),onFocusin:t[2]||(t[2]=a=>o.isHovered=!0),onMouseout:t[3]||(t[3]=a=>o.isHovered=!1),onFocusout:t[4]||(t[4]=a=>o.isHovered=!1),onKeydown:t[5]||(t[5]=ot(ue((...a)=>e.handleKeyDown&&e.handleKeyDown(...a),["prevent"]),["space"]))},[h("div",l0,[h("div",null,[h("h1",{style:ee({color:n.stateColor})},U(n.state),5)]),h("div",c0,[h("div",null,[h("h2",null,U(n.heartrate)+" BPM",1),u0]),h("div",null,[h("h2",null,U(n.duration),1),d0])])])],34)}const g0=A(r0,[["render",h0],["__scopeId","data-v-258e6b3d"]]),f0={name:"PatientInfoHUD",mounted(){const{canvas:e}=this.$refs;e.width=this.numImages*this.imgWidth,e.height=this.imgHeight,this.addPhaseId(),this.addHRInfo(),this.addTimeInfo()},data(){return{paddingX:15}},props:{isHidden:{type:Boolean},numImages:{type:Number,required:!0},imgWidth:{type:Number,required:!0},imgHeight:{type:Number,required:!0}},methods:{addPhaseId(){const{canvas:e}=this.$refs,t=e.getContext("2d");t.font="500 12px Roboto",t.textAlign="left",t.textBaseline="middle",t.fillStyle="white";const{numImages:n}=this,s=this.paddingX,o=15;for(let i=0;i<n;i++)t.fillText(`Phase ${i+1}`,s+this.imgWidth*i,o)},addHRInfo(){const{canvas:e}=this.$refs,t=e.getContext("2d");t.font="500 12px Roboto",t.textAlign="left",t.textBaseline="middle",t.fillStyle="white";const{numImages:n}=this,s=this.paddingX,o=30;for(let i=0;i<n;i++)t.fillText(`HR ${this.getRandomInt(106,30)}`,s+this.imgWidth*i,o)},addTimeInfo(){const{canvas:e}=this.$refs,t=e.getContext("2d");t.font="500 12px Roboto",t.textAlign="left",t.textBaseline="middle",t.fillStyle="white";const{numImages:n}=this,s=this.paddingX,o=45;for(let i=0;i<n;i++)t.fillText(`Time ${i}s`,s+this.imgWidth*i,o)},getRandomInt(e,t){return t+Math.floor(Math.random()*(e-t))}}},p0={ref:"canvas"};function m0(e,t,n,s,o,i){return I(),D("div",null,[h("canvas",p0,null,512)])}const v0=A(f0,[["render",m0]]);const y0={name:"RangeSlider",props:{maxExpand:{type:Number,default:10},minExpand:{type:Number,default:3},canvasWidth:{type:Number},sliceObj:{type:Object},numImages:Number,imgWidth:Number},data(){return{canvasHeight:44,thumbRadius:3,isDragging:!1,startThumbX:0,endThumbX:0,minValue:0,maxValue:100,startValue:0,startValueParent:0,endValue:null,startDragX:null,scrollerHeight:8,startEndHandlersHeight:20,startEndHandlersWidth:2,canvasCursor:"pointer"}},mounted(){this.endValue=1/(this.imgWidth*this.numImages/(this.canvasWidth-8)/100),console.log(`IMAGE STRIP WIDTH: ${this.canvasWidth}`),this.drawCanvas(),this.throttledSliderMove=Ya(this.moveScale,5)},methods:{drawCurrentView(e,t){const n=e,s=Math.abs(t-e),{canvas:o}=this.$refs,i=o.getContext("2d");i.strokeStyle="#FFFFFF",i.fillStyle="#FFFFFF05";const a=35,r=(this.canvasHeight-a)/2;i.lineWidth=2;const l=6;i.beginPath(),i.moveTo(n+l,r),i.lineTo(n+s-l,r),i.arcTo(n+s,r,n+s,r+l,l),i.lineTo(n+s,r+a-l),i.arcTo(n+s,r+a,n+s-l,r+a,l),i.lineTo(n+l,r+a),i.arcTo(n,r+a,n,r+a-l,l),i.lineTo(n,r+l),i.arcTo(n,r,n+l,r,l),i.closePath(),i.fill(),i.stroke()},drawHandle(e,t,n,s,o,i,a){const r=e,l=t+s,c=n+o;r.beginPath(),r.moveTo(t+i,n),r.lineTo(l-i,n),r.quadraticCurveTo(l,n,l,n+i),r.lineTo(l,c-i),r.quadraticCurveTo(l,c,l-i,c),r.lineTo(t+i,c),r.quadraticCurveTo(t,c,t,c-i),r.lineTo(t,n+i),r.quadraticCurveTo(t,n,t+i,n),r.closePath(),r.lineWidth=2,r.strokeStyle=a,r.stroke(),r.fillStyle=a,r.fill()},drawSegment(e,t,n){const{canvas:s}=this.$refs,o=s.getContext("2d"),i=(this.canvasHeight-this.startEndHandlersHeight)/2,a=Math.abs(t-e);this.drawHandle(o,e,i,this.startEndHandlersWidth,this.startEndHandlersHeight,1,n),o.fillStyle=n,o.fillRect(e,s.height/2-this.scrollerHeight/2,a,this.scrollerHeight),this.drawHandle(o,t,i,this.startEndHandlersWidth,this.startEndHandlersHeight,1,n)},drawTrack(){const{canvas:e}=this.$refs,t=e.getContext("2d");t.fillStyle="#3D3D3D",t.fillRect(0,e.height/2-this.scrollerHeight/2,e.width,this.scrollerHeight)},drawCanvas(){const{canvas:e}=this.$refs,t=e.getContext("2d");e.width=this.canvasWidth-8,e.height=this.canvasHeight;const n=this.getValueToXPosition(this.startValue),s=this.getValueToXPosition(this.endValue),o=this.getObjLocToVal(this.sliceObj.states.FREEBREATHING.start),i=this.getObjLocToVal(this.sliceObj.states.FREEBREATHING.end),a=this.getObjLocToVal(this.sliceObj.states.HYPERVENTILATION.start),r=this.getObjLocToVal(this.sliceObj.states.HYPERVENTILATION.end),l=this.getObjLocToVal(this.sliceObj.states.BREATHHOLD.start),c=this.getObjLocToVal(this.sliceObj.states.BREATHHOLD.end);t.clearRect(0,0,e.width,e.height),this.drawTrack(),this.drawSegment(o,i-1,"#5FBBCB"),this.drawSegment(a+3,r-1,"#C24ABC"),this.drawSegment(l+3,c,"#D95476"),this.drawCurrentView(n,s)},getObjLocToVal(e){const t=e.XLocation/(this.imgWidth*this.numImages);return this.getValueToXPosition(t*100)},getValueToXPosition(e){const t=this.maxValue-this.minValue,n=this.canvasWidth-8-this.thumbRadius*2;return(e-this.minValue)*n/t+this.thumbRadius},getXPositionToValue(e){const t=this.maxValue-this.minValue,n=this.canvasWidth-8-this.thumbRadius*2;return(e-this.thumbRadius)*t/n+this.minValue},handleMouseDown(e){const{canvas:t}=this.$refs,n=t.getBoundingClientRect(),s=e.clientX-n.left,o=this.getValueToXPosition(this.startValue),i=this.getValueToXPosition(this.endValue);this.startDragX=s,s<i&&s>o&&(this.isDragging="middle",this.canvasCursor="grab")},handledblCkick(e){const{canvas:t}=this.$refs,n=t.getBoundingClientRect(),s=e.clientX-n.left,o=Math.abs(this.startValue-this.endValue),i=Math.min(Math.max(this.getXPositionToValue(s)-o/2,0),this.maxValue-o);this.startValue=i,this.endValue=this.startValue+o,this.throttledSliderMove(this.startValue),this.drawCanvas()},handleMouseMove(e){if(!this.isDragging)return;const{canvas:t}=this.$refs,n=t.getBoundingClientRect(),s=e.clientX-n.left,o=this.getXPositionToValue(s),i=o-this.getXPositionToValue(this.startDragX);this.endValue+i>this.maxValue||this.startValue+i<this.minValue||(this.startValue+=i,this.endValue+=i,this.throttledSliderMove(this.startValue),this.drawCanvas(),this.startDragX=this.getValueToXPosition(o))},handleMouseUp(){this.isDragging&&(this.isDragging=!1,this.canvasCursor="pointer")},moveScale(e){this.$emit("move",e)},updatePosition(e){const t=e-this.startValue;this.startValue=e,this.endValue+=t,this.drawCanvas()}},watch:{canvasWidth(){this.drawCanvas()}}};function w0(e,t,n,s,o,i){return I(),D("div",{class:"range-slider",style:ee({width:n.canvasWidth+"px"})},[h("canvas",{ref:"canvas",onMousedown:t[0]||(t[0]=(...a)=>i.handleMouseDown&&i.handleMouseDown(...a)),onDblclick:t[1]||(t[1]=(...a)=>i.handledblCkick&&i.handledblCkick(...a)),onMousemove:t[2]||(t[2]=(...a)=>i.handleMouseMove&&i.handleMouseMove(...a)),onMouseup:t[3]||(t[3]=(...a)=>i.handleMouseUp&&i.handleMouseUp(...a)),onMouseleave:t[4]||(t[4]=(...a)=>i.handleMouseUp&&i.handleMouseUp(...a)),onFocusout:t[5]||(t[5]=(...a)=>i.handleMouseUp&&i.handleMouseUp(...a)),style:ee({cursor:o.canvasCursor})},null,36)],4)}const S0=A(y0,[["render",w0],["__scopeId","data-v-71938751"]]);const _0={props:{hasLabel:null,imageIncluded:{type:Boolean,default:!0}},emits:["add-label","remove-label","exclude-image"],data(){return{showContextMenu:!1,showError:!1,contextMenuX:0,contextMenuY:0}},methods:{openContextMenu(e){this.showContextMenu=!0,this.contextMenuX=e.clientX,this.contextMenuY=e.clientY},closeContextMenu(){this.showContextMenu=!1,this.showError=!1},addLabel(e){this.$emit("add-label",e),this.showContextMenu=!1,setTimeout(()=>{this.closeContextMenu()},5)},removeLabel(){this.$emit("remove-label"),this.showContextMenu=!1},excludeImage(){this.$emit("exclude-image"),this.showContextMenu=!1},popError(e){this.showError=!0,this.contextMenuX=e.clientX,this.contextMenuY=e.clientY},handleKeyPress(){}}},Me=e=>(oe("data-v-53ca90a5"),e=e(),ie(),e),C0=Me(()=>h("i",{class:"fa-solid fa-plus fa-sm",style:{color:"#ffffff"}},null,-1)),b0=Me(()=>h("h5",null,"Add Systole Label",-1)),T0=[C0,b0],I0=Me(()=>h("i",{class:"fa-solid fa-circle-plus fa-sm",style:{color:"#ffffff"}},null,-1)),x0=Me(()=>h("h5",null,"Add Diastole Label",-1)),R0=[I0,x0],D0=Me(()=>h("i",{class:"fa-regular fa-trash-can fa-sm",style:{color:"#ffffff"}},null,-1)),E0=Me(()=>h("h5",null,"Delete Label",-1)),L0=[D0,E0],P0=Me(()=>h("i",{class:"fa-solid fa-square-minus"},null,-1)),O0=Me(()=>h("h5",null,"Exclude Image",-1)),V0=[P0,O0],k0=Me(()=>h("i",{class:"fa-solid fa-square-plus"},null,-1)),M0=Me(()=>h("h5",null,"Include Image",-1)),B0=[k0,M0],A0=Me(()=>h("div",{class:"warning"},[h("i",{class:"fa-solid fa-triangle-exclamation",style:{color:"#ffcc00"}}),h("h5",null,"Unable to edit label! Please click within a breathing state.")],-1)),F0=[A0];function N0(e,t,n,s,o,i){return I(),D("div",{onContextmenu:t[10]||(t[10]=ue((...a)=>i.openContextMenu&&i.openContextMenu(...a),["prevent"])),onClick:t[11]||(t[11]=(...a)=>i.closeContextMenu&&i.closeContextMenu(...a)),onMousewheelPassive:t[12]||(t[12]=(...a)=>i.closeContextMenu&&i.closeContextMenu(...a)),onKeypress:t[13]||(t[13]=ue((...a)=>i.handleKeyPress&&i.handleKeyPress(...a),["prevent"]))},[Ce(e.$slots,"default",{},void 0,!0),v(De,{name:"fade"},{default:R(()=>[o.showContextMenu?(I(),D("div",{key:0,class:"custom-context-menu",style:ee({top:`${o.contextMenuY}px`,left:`${o.contextMenuX}px`})},[h("div",{class:N(["option",{noClick:n.hasLabel||n.imageIncluded}]),onClick:t[0]||(t[0]=a=>i.addLabel("systoles")),onKeypress:t[1]||(t[1]=(...a)=>e.h&&e.h(...a))},T0,34),h("div",{class:N(["option",{noClick:n.hasLabel||n.imageIncluded}]),onClick:t[2]||(t[2]=a=>i.addLabel("diastoles")),onKeypress:t[3]||(t[3]=(...a)=>e.h&&e.h(...a))},R0,34),h("div",{class:N(["option",{noClick:!n.hasLabel}]),onClick:t[4]||(t[4]=a=>i.removeLabel()),onKeypress:t[5]||(t[5]=(...a)=>e.h&&e.h(...a))},L0,34),h("div",{class:N(["option",{noClick:n.imageIncluded||n.hasLabel}]),onClick:t[6]||(t[6]=a=>i.excludeImage()),onKeypress:t[7]||(t[7]=(...a)=>e.h&&e.h(...a))},V0,34),h("div",{class:N(["option",{noClick:!n.imageIncluded}]),onClick:t[8]||(t[8]=a=>i.excludeImage()),onKeypress:t[9]||(t[9]=(...a)=>e.h&&e.h(...a))},B0,34)],4)):z("",!0)]),_:1}),v(De,{name:"fade"},{default:R(()=>[o.showError?(I(),D("div",{key:0,class:"custom-context-menu",style:ee({top:`${o.contextMenuY}px`,left:`${o.contextMenuX}px`})},F0,4)):z("",!0)]),_:1})],32)}const $0=A(_0,[["render",N0],["__scopeId","data-v-53ca90a5"]]);const U0={emits:["update-slice","remove-label","add-label","exclude-image"],props:{isHidden:{type:Boolean},numImages:{type:Number,required:!0},imgWidth:{type:Number,required:!0},sliceObj:{type:Object,required:!0},BARHEIGHT:{type:Number,default:284},BARWIDTH:{type:Number,default:800}},components:{AddCardiacCycle:$0},data(){return{handlerBarWidth:3,cardiacCyclesLabelWidth:110,handleBarGrab:{width:22,height:22},addNewLabelX:0,hasLabelOnClick:!1,includeImage:!0,canvasCursor:"default",moving:!1,movingObj:"none",movingObjs:[],barHeight:this.BARHEIGHT,startX:0,barWidth:this.BARWIDTH,mouse:{x:null,y:null}}},mounted(){this.addXLocations(),this.drawTrimmer()},watch:{barWidth(){this.drawTrimmer()},barHeight(){this.drawTrimmer()}},methods:{drawCycleLabel(e){const t=e,n=t.XLocation,s=t.id,o=this.cardiacCyclesLabelWidth,{canvas:i}=this.$refs,a=i.getContext("2d");a.fillStyle="#00000095";const r=8,l=35,c=15;a.beginPath(),a.moveTo(n+c,r),a.lineTo(n+o-c,r),a.arcTo(n+o,r,n+o,r+c,c),a.lineTo(n+o,r+l-c),a.arcTo(n+o,r+l,n+o-c,r+l,c),a.lineTo(n+c,r+l),a.arcTo(n,r+l,n,r+l-c,c),a.lineTo(n,r+c),a.arcTo(n,r,n+c,r,c),a.closePath(),a.fill(),a.font="300 18px Roboto",a.textAlign="center",a.textBaseline="middle",a.fillStyle="white";const u=n+o/2,d=r+l/2;a.fillText(s,u,d);const g=2,y=3,f=2.5,p="rgba(255,255,255,0.65)";for(let m=0;m<3;m++){const w=n-10+o/2+y+m*(2*g+y),T=18+f+10+(2*g+f);a.beginPath(),a.arc(w,T,g,0,Math.PI*2),a.fillStyle=p,a.fill(),a.closePath()}},drawBars(e,t){const{canvas:n}=this.$refs,s=n.getContext("2d");s.fillStyle=t;const o=this.sliceObj.states[e].start.XLocation+this.handlerBarWidth,i=this.sliceObj.states[e].end.XLocation;s.beginPath(),s.moveTo(o,0),s.lineTo(i,0),s.moveTo(o,this.barHeight-.5),s.lineTo(i,this.barHeight-.5),s.lineWidth=1.5,s.strokeStyle=t,s.stroke()},drawTrimmer(){const{canvas:e}=this.$refs,t=e.getContext("2d"),n=this.barWidth,s=this.barHeight;e.width=n,e.height=s,t.clearRect(0,0,e.width,e.height),this.drawExludeImageOverlay(t),Object.entries(this.sliceObj.states).forEach(([o,i])=>{this.drawBars(o,i.color),i.cardiacCycles.systoles.forEach(a=>this.drawCycleLabel(a)),i.cardiacCycles.diastoles.forEach(a=>this.drawCycleLabel(a)),this.drawStartEndHandlers(i)})},drawhandle(e,t,n,s,o,i,a){const r=e;r.beginPath(),r.moveTo(t+i,n),r.lineTo(s-i,n),r.quadraticCurveTo(s,n,s,n+i),r.lineTo(s,o-i),r.quadraticCurveTo(s,o,s-i,o),r.lineTo(t+i,o),r.quadraticCurveTo(t,o,t,o-i),r.lineTo(t,n+i),r.quadraticCurveTo(t,n,t+i,n),r.closePath(),r.lineWidth=2,r.strokeStyle=a,r.stroke(),r.fillStyle=a,r.fill();const l=2.5,c=3,u=2.5,d="rgba(255,255,255,0.65)";for(let g=0;g<3;g++)for(let y=0;y<2;y++){const f=t+i+c+y*(2*l+c),p=n+i+u+10+g*(2*l+u);r.beginPath(),r.arc(f,p,l,0,Math.PI*2),r.fillStyle=d,r.fill(),r.closePath()}},drawHandleTriangle(e,t,n,s,o,i,a){const r=e;if(r.fillStyle=a,r.beginPath(),i==="left"){r.moveTo(t+s,n),r.lineTo(t,n+o),r.lineTo(t+s,n+o),r.closePath(),r.stroke(),r.fill();const l=t+s/2,c=n+o/1.6,u=Math.min(s,o)*.3,d=2;r.beginPath(),r.arc(l+u,c-u/2,d,0,Math.PI*2),r.arc(l,c+u/2,d,0,Math.PI*2),r.fillStyle="#FFFFFF85",r.fill(),r.beginPath(),r.arc(l+u,c+u/2,d,0,Math.PI*2),r.fill()}else{r.moveTo(t,n),r.lineTo(t+s,n+o),r.lineTo(t,n+o),r.closePath(),r.stroke(),r.fill();const l=t+s/5,c=n+o/1.6,u=Math.min(s,o)*.3,d=2;r.beginPath(),r.arc(l,c-u/2,d,0,Math.PI*2),r.arc(l,c+u/2,d,0,Math.PI*2),r.fillStyle="#FFFFFF85",r.fill(),r.beginPath(),r.arc(l+u,c+u/2,d,0,Math.PI*2),r.fill()}},drawStartEndHandlers(e){const t=e,{canvas:n}=this.$refs,s=n.getContext("2d"),o=5,i=this.handlerBarWidth+o,a=this.barHeight,r=0;let l=t.start.XLocation;t.start.XLocation=l;const c=t.color;s.beginPath(),s.moveTo(l+o,r),s.lineTo(l+i-o,r),s.lineTo(l+i-o,r+a),s.lineTo(l+o,r+a),s.arcTo(l,r+a,l,r+a-o,o),s.lineTo(l,r+o),s.arcTo(l,r,l+o,r,o),s.closePath(),s.fillStyle=c,s.fill(),this.drawHandleTriangle(s,l+1,this.barHeight-this.handleBarGrab.width,this.handleBarGrab.height,this.handleBarGrab.width,"right",c),l=t.end.XLocation,t.end.XLocation=l,l-=o,s.beginPath(),s.moveTo(l+o,r),s.arcTo(l+i,r,l+i,r+o,o),s.lineTo(l+i,r+a-o),s.arcTo(l+i,r+a,l+i-o,r+a,o),s.lineTo(l+o,r+a),s.closePath(),s.fillStyle=c,s.fill(),this.drawHandleTriangle(s,l-15,this.barHeight-this.handleBarGrab.width,this.handleBarGrab.height,this.handleBarGrab.width,"left",c)},findIfLabelOnClick(){const e=Math.floor(this.addNewLabelX/this.imgWidth)+1,t=this.findStateUserClicked();try{const{cardiacCycles:n}=this.sliceObj.states[t];let s=null,o=null;if(Object.keys(n).some(i=>(o=n[i].findIndex(a=>a.phaseLocation===e?(s=i,!0):!1),o!==-1)),o!==-1)return{state:t,foundLabel:s,foundIndex:o}}catch{return"error"}return null},drawExludeImageOverlay(e){const t=e;t.fillStyle="#44444492",t.strokeStyle="#70707092",this.sliceObj.excludedImages.forEach(n=>{const s=(n-1)*this.imgWidth;t.fillRect(s,0,this.imgWidth,this.barHeight-.5),t.strokeRect(s,0,this.imgWidth,this.barHeight-.5)})},findStateUserClicked(){let e=null;return Object.keys(this.sliceObj.states).some(t=>{const n=this.sliceObj.states[t].end.XLocation;return this.sliceObj.states[t].start.XLocation<=this.mouse.x&&this.mouse.x<=n?(e=t,!0):!1}),e},findObjonCursor(e){const t=this.sliceObj.states[e],{start:n,end:s,cardiacCycles:o}=t;if(this.checkMouseOnStart(n))return n;if(this.checkMouseOnEnd(s))return s;const i=this.checkAllLabels(o.systoles);if(i)return i;const a=this.checkAllLabels(o.diastoles);return a||null},checkMouseOnStart(e){const t=e.XLocation,n=t+this.handleBarGrab.width,s=this.barHeight-this.handleBarGrab.height,o=this.barHeight;return this.checkMouseInArea(t,n,s,o)},checkMouseOnEnd(e){const t=e.XLocation-this.handleBarGrab.width,n=t+this.handleBarGrab.width,s=this.barHeight-this.handleBarGrab.height,o=this.barHeight;return this.checkMouseInArea(t,n,s,o)},checkMouseOnLabel(e){const t=e.XLocation,n=t+this.cardiacCyclesLabelWidth,s=8,o=40;return this.checkMouseInArea(t,n,s,o)},checkAllLabels(e){return e.find(t=>this.checkMouseOnLabel(t))},checkMouseInArea(e,t,n,s){return this.mouse.x>=e&&this.mouse.x<=t&&this.mouse.y>=n&&this.mouse.y<=s},startResize(e){this.$refs.menu.closeContextMenu(),this.mouse.x=e.offsetX,this.mouse.y=e.offsetY,this.startX=this.mouse.x;const t=this.findStateUserClicked();if(t){const n=this.findObjonCursor(t);n&&(this.moving=!0,this.movingObj=n)}},handleNotMoving(){const e=this.findStateUserClicked();this.updateCursor(),e&&(this.findObjonCursor(e)?this.updateCursor("grab"):this.updateCursor())},handleCheckUpperLowerBound(e,t,n,s,o){return e==="start"?this.sliceObj.states[t].start.XLocation+n+this.imgWidth>this.sliceObj.states[t].end.XLocation||this.sliceObj.states[t].start.XLocation+n<=s:this.sliceObj.states[t].end.XLocation+n-this.imgWidth-50<this.sliceObj.states[t].start.XLocation||this.sliceObj.states[t].end.XLocation+n>=o},mousemoving(e){if(!(e.offsetX>=this.sliceObj.states.FREEBREATHING.start.XLocation&&e.offsetX<=this.sliceObj.states.BREATHHOLD.end.XLocation+30||this.moving)){this.updateCursor();return}if(this.mouse.x=e.offsetX,this.mouse.y=e.offsetY,!this.moving){this.handleNotMoving();return}e.preventDefault();const t=e.offsetX,n=t-this.startX;if(this.movingObj.id==="end"||this.movingObj.id==="start"){const s=this.getPreviousKey(this.sliceObj.states,this.movingObj.state),o=this.getNextKey(this.sliceObj.states,this.movingObj.state),i=s?this.sliceObj.states[s].start.XLocation+this.imgWidth:0,a=o?this.sliceObj.states[o].end.XLocation-this.imgWidth:this.barWidth;if(this.handleCheckUpperLowerBound(this.movingObj.id,this.movingObj.state,n,i,a)||this.checkCollision(this.sliceObj.states[this.movingObj.state].cardiacCycles,this.movingObj,n))return;if(this.movingObj.id==="start"&&s){const r=this.sliceObj.states[s].end;if(this.checkCollision(this.sliceObj.states[s].cardiacCycles,r,n))return;r.XLocation+=n,this.movingObjs.push(r)}else if(this.movingObj.id==="end"&&o){const r=this.sliceObj.states[o].start;if(this.checkCollision(this.sliceObj.states[o].cardiacCycles,r,n))return;r.XLocation+=n,this.movingObjs.push(r)}this.startX=t,this.movingObj.XLocation+=n,this.movingObjs.push(this.movingObj),requestAnimationFrame(this.drawTrimmer);return}this.movingObj.XLocation+n<=this.sliceObj.states[this.movingObj.state].start.XLocation||this.movingObj.XLocation+n>this.sliceObj.states[this.movingObj.state].end.XLocation-this.cardiacCyclesLabelWidth||(this.movingObj.XLocation+=n,this.movingObjs.push(this.movingObj),requestAnimationFrame(this.drawTrimmer),this.startX=t)},checkCollision(e,t,n){return Object.keys(e).some(o=>e[o].some(a=>this.checkCollisionStartEnd(a,t,n)))},checkCollisionStartEnd(e,t,n){return t.id==="start"?n<0?!1:t.XLocation+n-10>=(e.phaseLocation-1)*this.imgWidth:t.id==="end"?n>0?!1:t.XLocation+n+15<=e.phaseLocation*this.imgWidth:!1},checksingleobj(e){return this.mouse.x>=e.location&&this.mouse.x<=e.location+e.width},snapObject(){this.movingObjs.forEach(e=>{const t=e;t.phaseLocation=this.convertXLocationtoPhase(t.XLocation,t.id),t.XLocation=this.convertPhaseLocationtoX(t.phaseLocation,t.id)}),this.movingObjs=[]},endResize(){this.moving&&(this.moving=!1,this.snapObject(),this.drawTrimmer(),this.startX=this.mouse.x,this.moving=!1,this.movingObj="none",this.$emit("update-slice",this.sliceObj))},updateCursor(e="default"){this.canvasCursor=e},getNextKey(e,t){const n=Object.keys(e),s=n.indexOf(t);return s===-1||s===n.length-1?!1:n[s+1]},getPreviousKey(e,t){const n=Object.keys(e),s=n.indexOf(t);return s<=0?!1:n[s-1]},handleAddLabel(e){const t=this.findStateUserClicked(),n=e==="systoles"?"Systole":"Diastole",s=Math.floor(this.mouse.x/this.imgWidth)+1,o=this.convertPhaseLocationtoX(s),i={id:n,state:t,phaseLocation:s,XLocation:o};this.$emit("add-label",{id:this.sliceObj.id,target:e,state:t,newLabel:i}),this.drawTrimmer()},handleRightClick(e){this.addNewLabelX=e.offsetX,this.mouse.x=this.addNewLabelX,this.hasLabelOnClick=this.findIfLabelOnClick();const t=Math.floor(this.mouse.x/this.imgWidth)+1;if(this.includeImage=this.sliceObj.excludedImages.indexOf(t)!==-1,this.hasLabelOnClick==="error"){this.$refs.menu.popError(e);return}this.$refs.menu.openContextMenu(e)},handleRemoveLabel(){const{state:e,foundLabel:t,foundIndex:n}=this.hasLabelOnClick,s=this.sliceObj.states[e].cardiacCycles[t],o=this.removeElementAtIndex(s,n);this.$emit("remove-label",{id:this.sliceObj.id,state:e,cycle:t,newArray:o}),this.drawTrimmer()},handleExcludeImage(){const e=Math.floor(this.mouse.x/this.imgWidth)+1;this.$emit("exclude-image",e),this.drawTrimmer()},removeElementAtIndex(e,t){if(t<0||t>=e.length)throw new Error("Index is out of range");const n=[...e];return n.splice(t,1),n},convertPhaseLocationtoX(e,t){let n;if(t==="start")n=(e-1)*this.imgWidth;else if(t==="end")n=e*this.imgWidth-this.handlerBarWidth;else{const s=(this.imgWidth-this.cardiacCyclesLabelWidth)/2;n=(e-1)*this.imgWidth+s}return n},convertXLocationtoPhase(e,t){let n;if(t==="start"){const s=e+this.imgWidth/2;n=Math.floor(s/this.imgWidth)+1}else if(t==="end"){const s=e-this.imgWidth/2;n=Math.floor(s/this.imgWidth)+1}else{const s=e+this.cardiacCyclesLabelWidth/2;n=Math.floor(s/this.imgWidth)+1}return n},addXLocation(e,t){const n=e;n.XLocation=this.convertPhaseLocationtoX(n.phaseLocation,t)},addXLocations(){Object.entries(this.sliceObj.states).forEach(([e])=>{const t=this.sliceObj.states[e];this.addXLocation(t.start,"start"),this.addXLocation(t.end,"end"),t.cardiacCycles.diastoles.forEach(n=>this.addXLocation(n)),t.cardiacCycles.systoles.forEach(n=>this.addXLocation(n))})}}};function H0(e,t,n,s,o,i){const a=O("AddCardiacCycle");return I(),D(se,null,[h("div",{class:N([{hide:n.isHidden},"horizontal-bar"])},[h("canvas",{ref:"canvas",style:ee({cursor:o.canvasCursor}),onMousedown:t[0]||(t[0]=(...r)=>i.startResize&&i.startResize(...r)),onFocusin:t[1]||(t[1]=(...r)=>i.startResize&&i.startResize(...r)),onFocusout:t[2]||(t[2]=(...r)=>i.endResize&&i.endResize(...r)),onMousemove:t[3]||(t[3]=(...r)=>i.mousemoving&&i.mousemoving(...r)),onMouseup:t[4]||(t[4]=(...r)=>i.endResize&&i.endResize(...r)),onMouseout:t[5]||(t[5]=(...r)=>i.endResize&&i.endResize(...r)),onContextmenu:t[6]||(t[6]=ue((...r)=>i.handleRightClick&&i.handleRightClick(...r),["prevent"])),onMousewheelPassive:t[7]||(t[7]=(...r)=>this.$refs.menu.closeContextMenu&&this.$refs.menu.closeContextMenu(...r))},null,36)],2),v(a,{ref:"menu","has-label":o.hasLabelOnClick,imageIncluded:o.includeImage,onAddLabel:i.handleAddLabel,onRemoveLabel:i.handleRemoveLabel,onExcludeImage:i.handleExcludeImage},null,8,["has-label","imageIncluded","onAddLabel","onRemoveLabel","onExcludeImage"])],64)}const W0=A(U0,[["render",H0],["__scopeId","data-v-4462453f"]]);const z0={name:"PatientInfoHUD",mounted(){const{canvas:e}=this.$refs;e.width=this.numImages*this.imgWidth,e.height=this.imgHeight+10,this.drawSquareWithTriangleAndNumber(this.imgWidth-15,14,5,15,1,"left"),this.drawSquareWithTriangleAndNumber(4*this.imgWidth,14,5,15,10,"right")},data(){return{paddingX:15}},props:{isHidden:{type:Boolean},numImages:{type:Number,required:!0},imgWidth:{type:Number,required:!0},imgHeight:{type:Number,required:!0}},methods:{addLocation(){const{canvas:e}=this.$refs,t=e.getContext("2d");t.fillStyle="white",t.fillRect(this.imgWidth,e.height-20,15,15)},drawSquareWithTriangleAndNumber(e,t,n,s,o,i){const{canvas:a}=this.$refs,r=a.height-20,l=a.getContext("2d");l.beginPath(),l.moveTo(e,r),l.lineTo(e+t,r),l.quadraticCurveTo(e+t,r,e+t,r+n),l.lineTo(e+t,r+t-n),l.quadraticCurveTo(e+t,r+t,e+t-n,r+t),l.lineTo(e+n,r+t),l.quadraticCurveTo(e,r+t,e,r+t-n),l.lineTo(e,r+n),l.closePath(),l.fillStyle="white",l.fill(),i==="left"?(l.beginPath(),l.moveTo(e+t,r),l.lineTo(e+t,r-s),l.lineTo(e,r),l.closePath(),l.fillStyle="white",l.fill()):(l.beginPath(),l.moveTo(e,r-s),l.lineTo(e+t,r),l.lineTo(e+t-t,r),l.closePath(),l.fillStyle="white",l.fill()),l.fillStyle="black",l.font="500 11px Roboto",l.textAlign="center",l.textBaseline="middle",l.fillText(o.toString(),e+t/2,r+t/2)},getRandomInt(e,t){return t+Math.floor(Math.random()*(e-t))}}},j0={ref:"canvas",class:"location-labels"};function G0(e,t,n,s,o,i){return I(),D("div",null,[h("canvas",j0,null,512)])}const X0=A(z0,[["render",G0],["__scopeId","data-v-73752235"]]);const q0={components:{ImageStripSlider:S0,VideoTrimmer:W0,ImageBarImageInfo:v0,CBSLocationLabels:X0},emits:["newstate","update-slice","remove-label","add-label"],props:{currentState:{type:String,default:"FREEBREATHING"},maxWidth:{type:Number,default:1560},isHidden:{type:Boolean,default:!0},hideinfo:{type:Boolean,required:!0,default:!0},numImages:{type:Number,default:100},id:{type:String},sliceObj:{type:Object,required:!0}},data(){return{imageWidth:286,requestId:null,videTrimWidth:null,imageHeight:286,imageRatio:0,originalImageWidth:0,imageHeightWidthRatio:0,heightHere:286,viewState:"FREEBREATHING",volumeKey:null,images:null}},mounted(){if(this.volumeKey=window.sessionStorage.getItem("target-volume-key"),this.volumeKey)this.getImagesFromStore();else{const e=new Image;e.src="./images/test.png",e.onload=()=>{this.imageHeightWidthRatio=e.naturalHeight/e.naturalWidth,this.imageHeight=this.imageWidth*this.imageHeightWidthRatio,this.$refs.videotrimmer.barHeight=this.imageHeight},e.onerror=()=>{console.error("Failed to load the image.")},this.drawMovieStrip(),setTimeout(()=>{this.$emit("loaded")},400)}},created(){this.videTrimWidth=this.imageWidth*this.numImages},methods:{async getImagesFromStore(){const t=await we().buildVolume(this.volumeKey),n=t.getPointData().getScalars().getData(),s=t.getDimensions();this.images=this.getImagesFromArray(n,s),this.scaledImages=await this.scaleImages(this.images,s[0],s[1],this.imageWidth,this.imageHeight),this.drawSingleImage(this.numImages),setTimeout(()=>{this.$emit("loaded")},200)},getImagesFromArray(e,t){const n=t[0]*t[1];return e.reduce((s,o,i)=>(i%n===0&&s.push(e.slice(i,i+n)),s),[])},drawSingleImage(e){const t=this.scaledImages,n=this.$refs.movieStripCanvas,s=n.getContext("2d"),o=this.imageWidth,i=this.imageWidth;n.width=this.imageWidth*e,n.height=o;for(let a=0;a<e;a++){const r=new Uint8ClampedArray(this.imageWidth*o*4);t[a].forEach((u,d)=>{const g=d*4;r[g]=u,r[g+1]=u,r[g+2]=u,r[g+3]=255});const c=new ImageData(r,i,o);s.putImageData(c,a*i,0)}s.setTransform(1,0,0,1,0,0)},async scaleImages(e,t,n,s,o){const i=[];for(let a=0;a<this.numImages;a++)i.push(this.scaleImage(e[a],t,n,s,o));return console.log("ended images"),i},scaleImage(e,t,n,s,o){return new Array(o*s).fill(0).map((a,r)=>{const l=Math.floor(r/s),u=r%s*(t-1)/(s-1),d=l*(n-1)/(o-1),g=Math.floor(u),y=Math.ceil(u),f=Math.floor(d),p=Math.ceil(d),m=e[f*t+g],w=e[f*t+y],T=e[p*t+g],S=e[p*t+y],b=u-g,P=d-f,E=m*(1-b)+w*b,k=T*(1-b)+S*b;return E*(1-P)+k*P})},drawMovieStrip(){const e=this.$refs.movieStripCanvas,t=e.getContext("2d"),{numImages:n}=this;e.width=this.imageWidth*n,e.height=this.imageHeight,this.videTrimWidth=e.width,t.clearRect(0,0,e.width,e.height);const s=Array(n).fill("./images/test.png"),{imageWidth:o}=this;let i=0;const a=s.map(r=>new Promise((l,c)=>{const u=new Image;u.src=r,u.onload=()=>{l(u)},u.onerror=d=>{c(d)}}));Promise.all(a).then(r=>{r.forEach(l=>{t.drawImage(l,i,0,o,this.imageHeight),i+=o})}).catch(r=>{console.error(r)})},scrollX(e){const t="image-container",n=this.$refs[t];e.ctrlKey?n.scrollLeft+=Math.sign(e.deltaY)*this.imageWidth:(n.scrollLeft+=e.deltaY/4,n.scrollLeft+=e.deltaX/4),this.$refs.sliderBar.updatePosition(100*n.scrollLeft/n.scrollWidth),this.getScrollState()},moveX(e){const t="image-container";this.$refs[t].scrollLeft=this.$refs[t].scrollWidth*(e/100),this.getScrollState()},getScrollState(){const e=["FREEBREATHING","HYPERVENTILATION","BREATHHOLD"],t=this.sliceObj,n=this.$refs["image-container"].scrollLeft;if(!(t.states[this.viewState].start.XLocation<n&&n<t.states[this.viewState].end.XLocation)){const s=e.find(o=>n<t.states[o].end.XLocation);s&&(this.viewState=s,this.$emit("newstate",this.viewState))}},scrollAnimation(e,t){const n=e,s=n.scrollLeft,o=300;let i;function a(r){i||(i=r);const l=r-i,c=Math.min(l/o,1);n.scrollLeft=s+t*c,c<1&&requestAnimationFrame(a)}requestAnimationFrame(a)},scrollToState(e){const t=this.$refs["image-container"],n=this.sliceObj.states[e].start.XLocation,s=n-t.scrollLeft;this.scrollAnimation(t,s),this.$refs.sliderBar.updatePosition(100*n/t.scrollWidth)},handleUpdateSlice(e){this.$emit("update-slice",e),this.$refs.sliderBar.drawCanvas()},handleRemoveLabel(e){this.$emit("remove-label",e)},handleAddLabel(e){this.$emit("add-label",e)},handleExcludeImage(e){this.$emit("exclude-image",e)}}},K0={style:{height:"300px"}},Y0={class:"video-trimmer-container",ref:"video-trimmer-container"},Q0={style:{height:"295px"},ref:"moviestripcont"},Z0={ref:"movieStripCanvas"},J0={key:0};function e1(e,t,n,s,o,i){const a=O("VideoTrimmer"),r=O("ImageBarImageInfo"),l=O("CBSLocationLabels"),c=O("ImageStripSlider");return I(),D(se,null,[h("div",K0,[h("div",{class:"strip",style:ee({width:n.maxWidth+"px"}),ref:"image-container",onMousewheelPassive:t[0]||(t[0]=(...u)=>i.scrollX&&i.scrollX(...u))},[h("div",Y0,[v(a,{"slice-obj":n.sliceObj,BARHEIGHT:o.imageHeight,BARWIDTH:o.videTrimWidth,numImages:this.numImages,imgWidth:o.imageWidth,isHidden:!n.isHidden,ref:"videotrimmer",onUpdateSlice:i.handleUpdateSlice,onRemoveLabel:i.handleRemoveLabel,onAddLabel:i.handleAddLabel,onExcludeImage:i.handleExcludeImage},null,8,["slice-obj","BARHEIGHT","BARWIDTH","numImages","imgWidth","isHidden","onUpdateSlice","onRemoveLabel","onAddLabel","onExcludeImage"])],512),h("div",Q0,[h("canvas",Z0,null,512)],512),v(De,null,{default:R(()=>[n.hideinfo?(I(),D("div",J0,[v(r,{numImages:this.numImages,imgWidth:o.imageWidth,imgHeight:o.heightHere},null,8,["numImages","imgWidth","imgHeight"])])):z("",!0)]),_:1}),v(l,{numImages:this.numImages,imgWidth:o.imageWidth,imgHeight:o.heightHere},null,8,["numImages","imgWidth","imgHeight"])],36)]),v(c,{numImages:this.numImages,imgWidth:o.imageWidth,"slice-obj":n.sliceObj,canvasWidth:n.maxWidth,onUpdateDone:i.drawMovieStrip,onMove:i.moveX,ref:"sliderBar"},null,8,["numImages","imgWidth","slice-obj","canvasWidth","onUpdateDone","onMove"])],64)}const t1=A(q0,[["render",e1],["__scopeId","data-v-aab861a9"]]);const n1={props:{iconSource:{type:String,default:"input-cursor"},id:{type:Number},status:{type:Boolean,default:!0},iconHeight:{type:Number,default:30}},methods:{handleclick(){this.$emit("toggleVisibility",this.status)}}},o1=["src"];function i1(e,t,n,s,o,i){return I(),D("div",{onClick:t[0]||(t[0]=(...a)=>i.handleclick&&i.handleclick(...a)),class:N(["circle2",{clicked:n.status}]),onKeydown:t[1]||(t[1]=ot(ue((...a)=>e.handleKeyDown&&e.handleKeyDown(...a),["prevent"]),["space"]))},[h("div",{class:N([{clicked:n.status},"icon-container"])},[h("img",{src:"/icons/"+n.iconSource+".svg",style:ee({height:n.iconHeight+"px"}),alt:"Icon"},null,12,o1)],2)],34)}const s1=A(n1,[["render",i1],["__scopeId","data-v-2d9b6532"]]);const a1={props:{givenWidth:{type:Number},givenHeight:{type:Number},count:{type:Number,default:1},flexDirection:{type:String,default:"column"},radius:{type:Number,default:5}}};function r1(e,t,n,s,o,i){return I(),D("div",{class:"cards",style:ee({flexDirection:n.flexDirection})},[(I(!0),D(se,null,Re(n.count,a=>(I(),D("div",{key:a,class:"card is-loading",style:ee({width:n.givenWidth+"px",height:n.givenHeight+"px",borderRadius:n.radius+"px"})},null,4))),128))],4)}const l1=A(a1,[["render",r1]]);const c1={props:{allowedWidth:{type:Number}},components:{SquareLoader:l1}},fo=e=>(oe("data-v-752d42a4"),e=e(),ie(),e),u1={class:"slice"},d1={class:"state-control"},h1=fo(()=>h("br",null,null,-1)),g1=fo(()=>h("br",null,null,-1)),f1={style:{overflow:"hidden"}},p1=fo(()=>h("br",null,null,-1));function m1(e,t,n,s,o,i){const a=O("SquareLoader");return I(),D("div",u1,[h("div",d1,[v(a,{"given-width":100,givenHeight:35}),h1,v(a,{"given-width":45,givenHeight:45,count:3,flexDirection:"row",radius:50}),g1,v(a,{"given-width":180,givenHeight:65,count:3})]),h("div",f1,[v(a,{"given-width":284,givenHeight:250,count:Math.floor((n.allowedWidth-250)/284),flexDirection:"row"},null,8,["count"]),p1,v(a,{"given-width":n.allowedWidth-270,givenHeight:44},null,8,["given-width"])])])}const v1=A(c1,[["render",m1],["__scopeId","data-v-752d42a4"]]);const y1={props:{show:{type:Boolean,default:!0}},data(){return{showText:!1}},watch:{show(){this.show?setTimeout(()=>{this.showText=!0},230):this.showText=!1}},mounted(){this.showText=this.show}},w1=Qa('<div class="info-row"><h4 class="title">AN <span class="value">1254639784233</span></h4></div><div class="info-row"><h4 class="title">DOB <span class="value">09/08/1984</span></h4></div><div class="info-row"><h4 class="title">HR <span class="value">106 </span></h4></div><div class="info-row"><h4 class="title">FOV <span class="value">270 x 360 192x256</span></h4></div><div class="info-row"><h4 class="title">Zoom Scale <span class="value">1.5px/1.1mm </span></h4></div><div class="info-row"><h4 class="title"> Pixel Scale <span class="value">f12d1_v200In </span></h4></div><div class="info-row"><h4 class="title"> VENC <span class="value"> 150.0 THROUGH PLANE</span></h4></div><div class="group-info"><div class="info-row-columns"><div class="sub-info"><h4 class="title">STH</h4><h4 class="value">150.0</h4></div><div class="sub-info"><h4 class="title">SL</h4><h4 class="value">150.0</h4></div></div><div class="info-row-columns"><div class="sub-info"><h4 class="title">TR</h4><h4 class="value">150.0</h4></div><div class="sub-info"><h4 class="title">TI</h4><h4 class="value">150.0</h4></div></div><div class="info-row-columns"><div class="sub-info"><h4 class="title">TE</h4><h4 class="value">150.0</h4></div><div class="sub-info"><h4 class="title">TT</h4><h4 class="value">150.0</h4></div></div></div><div class="scanner-info"><h4>SIEMENS AVANTO</h4></div><div class="scanner-info"><h4>1600-01-01 7/4</h4></div>',10),S1=[w1];function _1(e,t,n,s,o,i){return I(),D("div",{class:N(["study-info",{active:n.show,shown:o.showText}])},S1,2)}const C1=A(y1,[["render",_1]]);const b1={components:{StateButtons:g0,ImageBar:t1,IconToggleQA:s1,SkeletonLoaderCBS:v1,StudyInfoCBS:C1},props:{sliceInfo:{type:Object}},data(){return{stateButtons:this.sliceInfo.stateButtons,allowedWidth:null,allowedWidthImageBar:null,loading:!0}},methods:{handleStateChange(e){const t=e.replace(/\s/g,"");this.$emit("state-change",t),this.$refs.imgBar.scrollToState(t)},handleNewState(e){this.$emit("state-change",e)},handleUpdateSlice(e){this.$emit("update-slice",e)},handleRemoveLabel(e){this.$emit("remove-label",e)},handleAddLabel(e){this.$emit("add-label",e)},handleExcludeImage(e){this.$emit("exclude-image",e,this.sliceInfo.sliceOBJ.id)},handleResize(){this.allowedWidth=window.innerWidth-100,this.allowedWidth>2e3&&(this.allowedWidth=2e3),this.allowedWidthImageBar=this.allowedWidth-270,this.sliceInfo.imgBarProperties.showSliderInfo&&(this.allowedWidthImageBar-=160)},handleSliderClick(){this.$emit("toggle-show-slider",this.sliceInfo.id),this.resizeImgBar()},resizeImgBar(){let e=this.allowedWidthImageBar,t=null;this.sliceInfo.imgBarProperties.showSliderInfo?t=this.allowedWidthImageBar-135:t=this.allowedWidthImageBar+135;const n=300,s=(e-t)*(n/1e3);if(this.sliceInfo.imgBarProperties.showSliderInfo){const o=setInterval(()=>{e>t?(e-=s,this.allowedWidthImageBar=e):clearInterval(o)},n/10)}else{const o=setInterval(()=>{e<t?(e-=s,this.allowedWidthImageBar=e):clearInterval(o)},n/10)}},handleKeyDown(){}},created(){window.addEventListener("resize",this.handleResize),this.handleResize()}},T1=e=>(oe("data-v-d0ac3710"),e=e(),ie(),e),I1={class:"state-control"},x1={class:"slice-name-container"},R1={class:"slice-name"},D1=T1(()=>h("i",{class:"fa fa-info-circle fa-lg","aria-hidden":"true"},null,-1)),E1=[D1],L1={class:"toggle-icons-container"},P1={class:"state-buttons"},O1={class:"movie-strip"};function V1(e,t,n,s,o,i){const a=O("SkeletonLoaderCBS"),r=O("IconToggleQA"),l=O("StateButtons"),c=O("StudyInfoCBS"),u=O("ImageBar");return I(),D(se,null,[nt(v(a,{allowedWidth:o.allowedWidth},null,8,["allowedWidth"]),[[Bt,o.loading]]),v(De,{name:"slide-fade"},{default:R(()=>[nt(h("div",{class:"slice",style:ee({width:o.allowedWidth+"px"})},[h("div",I1,[h("div",x1,[h("h1",R1,U(n.sliceInfo.name),1),h("div",{class:N(["show-patient-info",{active:n.sliceInfo.imgBarProperties.showSliderInfo}]),onClick:t[0]||(t[0]=(...d)=>i.handleSliderClick&&i.handleSliderClick(...d)),onKeydown:t[1]||(t[1]=(...d)=>i.handleKeyDown&&i.handleKeyDown(...d))},E1,34)]),h("div",L1,[v(r,{id:n.sliceInfo.id,onToggleVisibility:t[2]||(t[2]=d=>e.$emit("toggle-trimmer",n.sliceInfo.id)),iconSource:"adjust-trim",status:n.sliceInfo.imgBarProperties.showTrimmer},null,8,["id","status"]),v(r,{id:n.sliceInfo.id,onToggleVisibility:t[3]||(t[3]=d=>e.$emit("toggle-patient-info",n.sliceInfo.id)),iconSource:"hide-bottom",status:n.sliceInfo.imgBarProperties.showPatientInfo},null,8,["id","status"]),v(r,{id:n.sliceInfo.id,status:n.sliceInfo.imgBarProperties.showGraph,iconSource:"show-contours",onToggleVisibility:t[4]||(t[4]=d=>e.$emit("toggle-graph",n.sliceInfo.id))},null,8,["id","status"])]),h("div",P1,[v(l,{id:n.sliceInfo.id,heartrate:o.stateButtons.FREEBREATHING.heartrate,duration:o.stateButtons.FREEBREATHING.duration,state:"FREE BREATHING","is-active":o.stateButtons.currentState==="FREEBREATHING",onStateChange:i.handleStateChange},null,8,["id","heartrate","duration","is-active","onStateChange"]),v(l,{id:n.sliceInfo.id,heartrate:o.stateButtons.HYPERVENTILATION.heartrate,duration:o.stateButtons.HYPERVENTILATION.duration,state:"HYPERVENTILATION","is-active":o.stateButtons.currentState==="HYPERVENTILATION",stateColor:o.stateButtons.HYPERVENTILATION.stateColor,onStateChange:i.handleStateChange},null,8,["id","heartrate","duration","is-active","stateColor","onStateChange"]),v(l,{id:n.sliceInfo.id,heartrate:o.stateButtons.BREATHHOLD.heartrate,duration:o.stateButtons.BREATHHOLD.duration,state:"BREATHHOLD","is-active":o.stateButtons.currentState==="BREATHHOLD",stateColor:o.stateButtons.BREATHHOLD.stateColor,onStateChange:i.handleStateChange},null,8,["id","heartrate","duration","is-active","stateColor","onStateChange"])])]),v(c,{show:n.sliceInfo.imgBarProperties.showSliderInfo},null,8,["show"]),h("div",O1,[v(u,{id:n.sliceInfo.sliceOBJ.id,isHidden:n.sliceInfo.imgBarProperties.showTrimmer,hideinfo:n.sliceInfo.imgBarProperties.showPatientInfo,"slice-obj":n.sliceInfo.sliceOBJ,currentState:o.stateButtons.currentState,maxWidth:o.allowedWidthImageBar,ref:"imgBar",onNewstate:i.handleNewState,onUpdateSlice:i.handleUpdateSlice,onRemoveLabel:i.handleRemoveLabel,onAddLabel:i.handleAddLabel,onExcludeImage:i.handleExcludeImage,onLoaded:t[5]||(t[5]=d=>o.loading=!1)},null,8,["id","isHidden","hideinfo","slice-obj","currentState","maxWidth","onNewstate","onUpdateSlice","onRemoveLabel","onAddLabel","onExcludeImage"])])],4),[[Bt,!o.loading]])]),_:1})],64)}const k1=A(b1,[["render",V1],["__scopeId","data-v-d0ac3710"]]);const M1={components:{BreathingSplitRow:k1},data(){return{caseObj:{slice1:{id:"slice1",excludedImages:[],states:{FREEBREATHING:{color:"#79CFDE",start:{id:"start",state:"FREEBREATHING",phaseLocation:1},end:{id:"end",state:"FREEBREATHING",phaseLocation:4},cardiacCycles:{systoles:[{id:"Systole",state:"FREEBREATHING",phaseLocation:1},{id:"Systole",state:"FREEBREATHING",phaseLocation:2}],diastoles:[{id:"Diastole",state:"FREEBREATHING",phaseLocation:3}]}},HYPERVENTILATION:{color:"#C24ABC",start:{id:"start",state:"HYPERVENTILATION",phaseLocation:5},end:{id:"end",state:"HYPERVENTILATION",phaseLocation:20},cardiacCycles:{systoles:[{id:"Systole",state:"HYPERVENTILATION",phaseLocation:5}],diastoles:[{id:"Diastole",state:"HYPERVENTILATION",phaseLocation:6}]}},BREATHHOLD:{color:"#d95476",start:{id:"start",state:"BREATHHOLD",phaseLocation:21},end:{id:"end",state:"BREATHHOLD",phaseLocation:100},cardiacCycles:{systoles:[{id:"Systole",state:"BREATHHOLD",phaseLocation:25}],diastoles:[{id:"Diastole",state:"BREATHHOLD",phaseLocation:28}]}}}},slice2:{id:"slice2",excludedImages:[],states:{FREEBREATHING:{color:"#79CFDE",start:{id:"start",state:"FREEBREATHING",phaseLocation:1},end:{id:"end",state:"FREEBREATHING",phaseLocation:10},cardiacCycles:{systoles:[{id:"Systole",state:"FREEBREATHING",phaseLocation:3}],diastoles:[{id:"Diastole",state:"FREEBREATHING",phaseLocation:5}]}},HYPERVENTILATION:{color:"#C24ABC",start:{id:"start",state:"HYPERVENTILATION",phaseLocation:11},end:{id:"end",state:"HYPERVENTILATION",phaseLocation:30},cardiacCycles:{systoles:[{id:"Systole",state:"HYPERVENTILATION",phaseLocation:12}],diastoles:[{id:"Diastole",state:"HYPERVENTILATION",phaseLocation:20}]}},BREATHHOLD:{color:"#d95476",start:{id:"start",state:"BREATHHOLD",phaseLocation:31},end:{id:"end",state:"BREATHHOLD",phaseLocation:80},cardiacCycles:{systoles:[{id:"Systole",state:"BREATHHOLD",phaseLocation:35}],diastoles:[{id:"Diastole",state:"BREATHHOLD",phaseLocation:60}]}}}}},sliceInfo1:{name:"SLICE 1",id:1,sliceOBJ:null,stateButtons:{currentState:"FREEBREATHING",FREEBREATHING:{state:"FREEBREATHING",heartrate:80,duration:"01:32",stateColor:"#E242E6"},HYPERVENTILATION:{state:"HYPERVENTILATION",heartrate:120,duration:"02:32",stateColor:"#E242E6"},BREATHHOLD:{state:"BREATHHOLD",heartrate:70,duration:"00:32",stateColor:"#D95476"}},imgBarProperties:{showTrimmer:!0,showPatientInfo:!0,showGraph:!1,showSliderInfo:!1}},sliceInfo2:{name:"SLICE 2",id:2,sliceOBJ:null,stateButtons:{currentState:"FREEBREATHING",FREEBREATHING:{state:"FREEBREATHING",heartrate:50,duration:"01:32",stateColor:"#E242E6"},HYPERVENTILATION:{state:"HYPERVENTILATION",heartrate:60,duration:"01:32",stateColor:"#E242E6"},BREATHHOLD:{state:"BREATHHOLD",heartrate:125,duration:"01:32",stateColor:"#D95476"}},imgBarProperties:{showTrimmer:!0,showPatientInfo:!0,showGraph:!1,showSliderInfo:!1}}}},methods:{handleUpdateSlice(e){const t=e.id;this.caseObj[t]=e},handleRemoveLabel(e){this.caseObj[e.id].states[e.state].cardiacCycles[e.cycle]=e.newArray},handleAddLabel(e){this.caseObj[e.id].states[e.state].cardiacCycles[e.target].push(e.newLabel)},handleExcludeImage(e,t){const n=this.caseObj[t].excludedImages.indexOf(e);n!==-1?delete this.caseObj[t].excludedImages[n]:this.caseObj[t].excludedImages.push(e)}},created(){this.sliceInfo1.sliceOBJ=this.caseObj.slice1,this.sliceInfo2.sliceOBJ=this.caseObj.slice2}},B1={class:"slices-containers"};function A1(e,t,n,s,o,i){const a=O("BreathingSplitRow");return I(),D("div",B1,[v(a,{"slice-info":o.sliceInfo1,onToggleTrimmer:t[0]||(t[0]=r=>o.sliceInfo1.imgBarProperties.showTrimmer=!o.sliceInfo1.imgBarProperties.showTrimmer),onTogglePatientInfo:t[1]||(t[1]=r=>o.sliceInfo1.imgBarProperties.showPatientInfo=!o.sliceInfo1.imgBarProperties.showPatientInfo),onToggleGraph:t[2]||(t[2]=r=>o.sliceInfo1.imgBarProperties.showGraph=!o.sliceInfo1.imgBarProperties.showGraph),onToggleShowSlider:t[3]||(t[3]=r=>o.sliceInfo1.imgBarProperties.showSliderInfo=!o.sliceInfo1.imgBarProperties.showSliderInfo),onStateChange:t[4]||(t[4]=r=>o.sliceInfo1.stateButtons.currentState=r),onUpdateSlice:i.handleUpdateSlice,onRemoveLabel:i.handleRemoveLabel,onAddLabel:i.handleAddLabel,onExcludeImage:i.handleExcludeImage},null,8,["slice-info","onUpdateSlice","onRemoveLabel","onAddLabel","onExcludeImage"]),v(a,{"slice-info":o.sliceInfo2,onToggleTrimmer:t[5]||(t[5]=r=>o.sliceInfo2.imgBarProperties.showTrimmer=!o.sliceInfo2.imgBarProperties.showTrimmer),onTogglePatientInfo:t[6]||(t[6]=r=>o.sliceInfo2.imgBarProperties.showPatientInfo=!o.sliceInfo2.imgBarProperties.showPatientInfo),onToggleGraph:t[7]||(t[7]=r=>o.sliceInfo2.imgBarProperties.showGraph=!o.sliceInfo2.imgBarProperties.showGraph),onToggleShowSlider:t[8]||(t[8]=r=>o.sliceInfo2.imgBarProperties.showSliderInfo=!o.sliceInfo2.imgBarProperties.showSliderInfo),onStateChange:t[9]||(t[9]=r=>o.sliceInfo2.stateButtons.currentState=r),onUpdateSlice:i.handleUpdateSlice,onRemoveLabel:i.handleRemoveLabel,onAddLabel:i.handleAddLabel,onExcludeImage:i.handleExcludeImage},null,8,["slice-info","onUpdateSlice","onRemoveLabel","onAddLabel","onExcludeImage"])])}const F1=A(M1,[["render",A1],["__scopeId","data-v-c7290f6c"]]);const N1={components:{CheckBreathingSplits:F1,CheckContours:ia,LoadingScreen:Yi},data(){return{currentComponent:"CheckBreathingSplits"}},methods:{handleButtonClicked(e){this.activeButton=e},toggleComponent(e){this.currentComponent=e}},mounted(){const e=window.sessionStorage.getItem("currentQaView");e?this.currentComponent=e:this.currentComponent="CheckBreathingSplits"}},$1={class:"qualitycontainer"};function U1(e,t,n,s,o,i){return I(),D("div",$1,[h("div",{class:N([{loaded:1},"comp-container"])},[v(De,{name:"fade"},{default:R(()=>[(I(),Y(gi(o.currentComponent)))]),_:1})])])}const H1=A(N1,[["render",U1],["__scopeId","data-v-25c3d57c"]]);const W1={props:{editable:{type:Boolean}},data(){return{imageSource:null,hovering:!1}},methods:{openImageDialog(){this.$refs.imageInput.click()},handleImageChange(e){this.uploadImage(e.target.files[0])},handleImageDrop(e){e.preventDefault();const t=e.dataTransfer.files[0];this.uploadImage(t)},handleDragOver(e){e.preventDefault(),this.hovering=!0},handleDragLeave(){this.hovering=!1},uploadImage(e){if(e){const t=new FileReader;t.onloadend=()=>{this.imageSource=t.result},t.readAsDataURL(e)}}}},z1=["src"];function j1(e,t,n,s,o,i){return I(),D("div",{class:"logo-holder",onClick:t[2]||(t[2]=(...a)=>i.openImageDialog&&i.openImageDialog(...a)),onDragenter:t[3]||(t[3]=(...a)=>i.handleDragOver&&i.handleDragOver(...a)),onDragover:t[4]||(t[4]=(...a)=>i.handleDragOver&&i.handleDragOver(...a)),onDrop:t[5]||(t[5]=(...a)=>i.handleImageDrop&&i.handleImageDrop(...a)),onDragleave:t[6]||(t[6]=(...a)=>i.handleDragLeave&&i.handleDragLeave(...a)),ref:"logoContainer",onKeydown:t[7]||(t[7]=ot(ue((...a)=>e.handleKeyDown&&e.handleKeyDown(...a),["prevent"]),["space"]))},[o.imageSource?(I(),D("img",{key:0,src:o.imageSource,alt:"Uploaded Logo",style:{cursor:"pointer"}},null,8,z1)):z("",!0),n.editable&&!o.imageSource?(I(),D("div",{key:1,class:N(["place-holder",{hover:o.hovering}])},[h("h4",{onDragover:t[0]||(t[0]=(...a)=>i.handleDragOver&&i.handleDragOver(...a))},"Click or Drop Logo",32)],2)):z("",!0),h("input",{ref:"imageInput",type:"file",style:{display:"none"},accept:"image/*",onChange:t[1]||(t[1]=(...a)=>i.handleImageChange&&i.handleImageChange(...a)),"aria-labelledby":"logoImageInput"},null,544)],544)}const G1=A(W1,[["render",j1],["__scopeId","data-v-bca1a7a6"]]);const X1={props:{id:{type:String,required:!0},options:{type:Array,required:!0},editable:{type:Boolean,default:!0}},data(){return{selectedOption:"Select..."}},methods:{onOptionSelected(e){const t=e.target.value;this.selectedOption=t,this.$emit("option-selected",this.id,t)}}},q1=e=>(oe("data-v-6a5101fe"),e=e(),ie(),e),K1={key:0,class:"select"},Y1=["id"],Q1=q1(()=>h("option",{value:"",disabled:"",selected:""},"Select...",-1)),Z1=["value"],J1={key:1,class:"selected-option"};function ey(e,t,n,s,o,i){return n.editable?(I(),D("div",K1,[h("select",{id:n.id,required:"",onChange:t[0]||(t[0]=a=>i.onOptionSelected(a)),"aria-labelledby":"dropDownComponentinReportElement"},[Q1,(I(!0),D(se,null,Re(n.options,(a,r)=>(I(),D("option",{key:r,value:a.value},U(a.label),9,Z1))),128))],40,Y1)])):(I(),D("h5",J1,U(o.selectedOption),1))}const ty=A(X1,[["render",ey],["__scopeId","data-v-6a5101fe"]]);const ny={props:{id:{type:String},width:{type:Number,default:200},height:{type:Number,default:250},canvasText:{type:String,default:"Select or Drop Image"},addBar:{type:String,default:null},editable:{type:Boolean,default:!0}},data(){return{moveMode:!1,isMoving:!1,cStartX:null,cStartY:null,canvasX:0,canvasY:0,zoomValue:1,defaultZoomValue:1,originalImage:null,hovering:!1}},methods:{setupCanvas(){const{canvas:e}=this.$refs,t=e.getContext("2d");e.width=this.width*(1/.75),e.height=this.height,t.fillStyle="rgba(0, 0, 0, 0.3)",t.fillRect(0,0,e.width,e.height),t.fillStyle="white",t.font="20px Arial",t.textAlign="center",t.textBaseline="middle",this.wrapText(t,this.canvasText,e.width/2,e.height/2,150)},wrapText(e,t,n,s,o){let i=s;const a=t.split(" ");let r="";const l=e.measureText("M").width*1.2;for(let c=0;c<a.length;c++){const u=`${r+a[c]} `;e.measureText(u).width>o&&c>0?(e.fillText(r,n,i),r=`${a[c]} `,i+=l):r=u}e.fillText(r,n,i)},drawImage(){const{canvas:e}=this.$refs,t=e.getContext("2d");t.clearRect(0,0,e.width,e.height),t.drawImage(this.originalImage,0,0)},openFilePicker(){this.$refs.imageLoaderInput.click()},uploadImage(e){const t=e.target.files[0],{canvas:n}=this.$refs;if(t){const s=new FileReader;s.onload=o=>{this.originalImage=new Image,this.originalImage.onload=()=>{n.width=this.originalImage.width+10,n.height=this.originalImage.height+10,this.drawImage()},this.originalImage.src=o.target.result,this.updateImageZoom(),this.resetImagePositionAndZoom()},s.readAsDataURL(t)}},uploadImageDrop(e){const{canvas:t}=this.$refs;if(e){const n=new FileReader;n.onload=s=>{this.originalImage=new Image,this.originalImage.onload=()=>{t.width=this.originalImage.width+10,t.height=this.originalImage.height+10,this.drawImage()},this.originalImage.src=s.target.result,this.updateImageZoom(),this.resetImagePositionAndZoom()},n.readAsDataURL(e)}},handleImageDrop(e){e.preventDefault();const t=e.dataTransfer.files[0];this.uploadImageDrop(t),this.hovering=!1},handleDragOver(e){e.preventDefault(),this.hovering=!0},handleDragLeave(){this.hovering=!1},toggleMoveMode(){this.originalImage&&(this.moveMode=!this.moveMode)},handleMouseDown(e){this.moveMode&&(this.isMoving=!0,this.cStartX=e.clientX,this.cStartY=e.clientY)},handleMouseMove(e){if(!(!this.moveMode||!this.isMoving)){if(this.cStartX!==void 0&&this.cStartY!==void 0){const t=e.clientX-this.cStartX,n=e.clientY-this.cStartY;this.canvasX+=t,this.canvasY+=n,this.$refs.canvas.style.transform=`translate(${this.canvasX}px, ${this.canvasY}px)`,this.cStartX=e.clientX,this.cStartY=e.clientY}}},handleMouseUp(){this.isMoving=!1,this.cStartX=void 0,this.cStartY=void 0},zoomIn(){this.zoomValue+=.025,this.updateImageZoom()},zoomOut(){this.zoomValue-=.025,this.updateImageZoom()},resetImagePositionAndZoom(){this.moveMode=!1,this.zoomValue=this.defaultZoomValue,this.updateImageZoom()},updateImageZoom(){if(this.originalImage){const e=this.$refs.zoomControl;e.style.transform=`scale(${this.zoomValue})`,e.style.transformOrigin="0 0"}},async captureScreenshot(){const e=this.$refs["vascular-image-div"];fi(e,{logging:!1,scale:3}).then(t=>{const n=t.toDataURL("image/png");this.$emit("screenshot-captured",this.id,n)}).catch(t=>{console.error("Error capturing screenshot:",t)})}},mounted(){if(this.setupCanvas(),this.addBar){const e=new Image;e.src=this.addBar,e.onload=()=>{this.$refs.barGraphLegend.src=e.src}}},watch:{editable(){this.moveMode&&(this.moveMode=!this.moveMode,this.handleMouseUp())}}},xn=e=>(oe("data-v-3e2c92d2"),e=e(),ie(),e),oy={key:0,class:"buttons"},iy={class:"upload-button",title:"Upload File",alt:"Upload File",style:{position:"relative"}},sy=xn(()=>h("i",{class:"fas fa-upload fa-lg",style:{color:"#ffffff"}},null,-1)),ay=[sy],ry={key:0,class:"move-button",title:"Move",alt:"Move",style:{position:"relative"}},ly=xn(()=>h("i",{class:"fas fa-arrows fa-lg",style:{color:"#ffffff"}},null,-1)),cy=[ly],uy={key:1,class:"zoom-in-button",title:"Zoom In",alt:"Zoom In",style:{position:"relative"}},dy=xn(()=>h("i",{class:"fas fa-search-plus fa-lg",style:{color:"#ffffff"}},null,-1)),hy=[dy],gy={key:2,class:"zoom-out-button",title:"Zoom Out",alt:"Zoom Out",style:{position:"relative"}},fy=xn(()=>h("i",{class:"fas fa-search-minus fa-lg",style:{color:"#ffffff"}},null,-1)),py=[fy],my={ref:"vascular-image-div"},vy={key:0,style:{position:"relative"}},yy={style:{"user-select":"none","-webkit-user-drag":"none"},id:"bar-graph-legend-os",ref:"barGraphLegend",alt:"Image Not Loaded"};function wy(e,t,n,s,o,i){return I(),D("div",{id:"image-container",class:N({moving:o.moveMode,hover:o.hovering}),style:ee({height:n.height+"px",width:n.width+"pt"}),onDragenter:t[8]||(t[8]=(...a)=>i.handleDragOver&&i.handleDragOver(...a)),onDragover:t[9]||(t[9]=(...a)=>i.handleDragOver&&i.handleDragOver(...a)),onDrop:t[10]||(t[10]=(...a)=>i.handleImageDrop&&i.handleImageDrop(...a)),onDragleave:t[11]||(t[11]=(...a)=>i.handleDragLeave&&i.handleDragLeave(...a))},[n.editable?(I(),D("div",oy,[h("div",iy,[h("button",{class:"upload-buttons upload-image",onClick:t[0]||(t[0]=(...a)=>i.openFilePicker&&i.openFilePicker(...a))},ay),h("input",{type:"file",ref:"imageLoaderInput",name:"imageLoader",style:{display:"none"},accept:"image/*",onChange:t[1]||(t[1]=(...a)=>i.uploadImage&&i.uploadImage(...a)),"aria-labelledby":"hiddenImageInputinReport"},null,544)]),o.originalImage?(I(),D("div",ry,[h("button",{class:N(["upload-buttons",{moving:o.moveMode}]),style:{left:"50px"},onClick:t[2]||(t[2]=(...a)=>i.toggleMoveMode&&i.toggleMoveMode(...a))},cy,2)])):z("",!0),o.originalImage?(I(),D("div",uy,[h("button",{class:"upload-buttons",style:{left:"90px"},onClick:t[3]||(t[3]=(...a)=>i.zoomIn&&i.zoomIn(...a))},hy)])):z("",!0),o.originalImage?(I(),D("div",gy,[h("button",{class:"upload-buttons",style:{left:"130px"},onClick:t[4]||(t[4]=(...a)=>i.zoomOut&&i.zoomOut(...a))},py)])):z("",!0)])):z("",!0),h("div",my,[n.addBar?(I(),D("div",vy,[h("img",yy,null,512)])):z("",!0),h("div",{style:ee({height:n.height+"px",width:n.width+"pt"}),ref:"zoomControl"},[h("canvas",{ref:"canvas",id:"vascular-image",onMousedown:t[5]||(t[5]=(...a)=>i.handleMouseDown&&i.handleMouseDown(...a)),onMousemove:t[6]||(t[6]=(...a)=>i.handleMouseMove&&i.handleMouseMove(...a)),onMouseup:t[7]||(t[7]=(...a)=>i.handleMouseUp&&i.handleMouseUp(...a))},null,544)],4)],512)],38)}const Sy=A(ny,[["render",wy],["__scopeId","data-v-3e2c92d2"]]);const _y={props:{id:{type:String,required:!1},values:{type:Array,required:!0}},data(){return{outerradius:85/2-1,LAD:null,LCX:null,RCA:null}},watch:{values(){this.setValues(),this.createChart()}},mounted(){this.setValues(),this.createChart()},methods:{setValues(){[this.LAD,this.LCX,this.RCA]=this.values},createChart(){const e=this.$refs.chartCanvas,t=e.getContext("2d");e.width=85,e.height=85;const n=e.width/2,s=e.height/2,o=this.outerradius,i=o/4;t.clearRect(0,0,e.width,e.height);const a=this.getColors([this.RCA,this.LAD,this.LCX]),r=[1,1,1],l=r.reduce((u,d)=>u+d,0);let c=0;r.forEach((u,d)=>{const g=u/l*Math.PI*2,y=c+g;t.beginPath(),t.moveTo(n+o*Math.cos(c),s+o*Math.sin(c)),t.arc(n,s,o,c,y),t.arc(n,s,i,y,c,!0),t.closePath(),t.fillStyle=a[d],t.fill(),t.lineWidth=.5,t.strokeStyle="black",t.stroke(),c=y}),t.beginPath(),t.arc(n,s,o,0,Math.PI*2),t.strokeStyle="#00000",t.lineWidth=0,t.stroke(),t.beginPath(),t.arc(n,s,i,0,Math.PI*2),t.strokeStyle="#00000",t.lineWidth=0,t.stroke()},numberToColorGradient(e){let t=e;t=t.toString().replace(/%/g,"");const n=[{color:[1,25,242],minPercentage:0,maxPercentage:.23},{color:[0,227,252],minPercentage:.23,maxPercentage:.45},{color:[44,246,91],minPercentage:.45,maxPercentage:.6},{color:[252,208,13],minPercentage:.6,maxPercentage:.75},{color:[255,16,1],minPercentage:.75,maxPercentage:1}];t=Math.min(Math.max(Number(t),-20),20);const s=(t+20)/40;let o,i;for(let u=0;u<n.length;u++)if(s>=n[u].minPercentage&&s<=n[u].maxPercentage){o=n[u],i=n[u+1];break}i||(o=n[n.length-2],i=n[n.length-1]);const a=(s-o.minPercentage)/(i.maxPercentage-o.minPercentage),r=Math.round(o.color[0]+a*(i.color[0]-o.color[0])),l=Math.round(o.color[1]+a*(i.color[1]-o.color[1])),c=Math.round(o.color[2]+a*(i.color[2]-o.color[2]));return`rgb(${r}, ${l}, ${c})`},getColors(e){return[this.numberToColorGradient(e[0]),this.numberToColorGradient(e[1]),this.numberToColorGradient(e[2])]}}},Cy={style:{position:"relative"}},by={ref:"chartCanvas"},Ty={style:{position:"absolute",color:"rgb(255, 255, 255)",top:"10px",left:"14px",width:"38px",height:"20px","text-align":"center"}},Iy={style:{position:"absolute",color:"rgb(255, 255, 255)",top:"55px",left:"12px",width:"38px",height:"20px","text-align":"center"}},xy={style:{position:"absolute",color:"rgb(255, 255, 255)",top:"32px",left:"52px",width:"35px",height:"20px","text-align":"center"}};function Ry(e,t,n,s,o,i){return I(),D("div",Cy,[h("canvas",by,null,512),h("div",Ty,[h("h5",null,U(o.LAD),1)]),h("div",Iy,[h("h5",null,U(o.RCA),1)]),h("div",xy,[h("h5",null,U(o.LCX),1)])])}const Dy=A(_y,[["render",Ry],["__scopeId","data-v-4c39254e"]]);const Ey={props:{id:{type:String,required:!0},propValue:{type:String,required:!0,default:"00"},editable:{type:Boolean,default:!0}},data(){return{editing:0,editedValue:this.propValue}},methods:{stopEditing(){this.$emit("updateValue",this.id,this.editedValue)},updateProp(e){this.editedValue=e.target.value}},watch:{editable(){this.$refs.inputField.readOnly=!this.editable}},mounted(){this.editable||(this.$refs.inputField.readOnly=!0)}},Ly=["value"];function Py(e,t,n,s,o,i){return I(),D("input",{value:n.propValue,onInput:t[0]||(t[0]=(...a)=>i.updateProp&&i.updateProp(...a)),onBlur:t[1]||(t[1]=(...a)=>i.stopEditing&&i.stopEditing(...a)),ref:"inputField",class:N({edit:n.editable})},null,42,Ly)}const Oy=A(Ey,[["render",Py],["__scopeId","data-v-e918b819"]]);const Vy={props:{id:{type:String,required:!0},propValue:{type:String,required:!0,default:"00"},placeholder:{type:String,default:""},editable:{type:Boolean,default:!0}},data(){return{editing:0,editedValue:this.propValue}},methods:{stopEditing(){this.$emit("updateValue",this.id,this.editedValue)},updateProp(e){this.editedValue=e.target.value}},mounted(){this.editable||(this.$refs.inputField.readOnly=!0)},watch:{editable(){this.$refs.inputField.readOnly=!this.editable}}},ky=["value","placeholder"];function My(e,t,n,s,o,i){return I(),D("textarea",{value:n.propValue,onInput:t[0]||(t[0]=(...a)=>i.updateProp&&i.updateProp(...a)),onBlur:t[1]||(t[1]=(...a)=>i.stopEditing&&i.stopEditing(...a)),ref:"inputField",class:N({edit:n.editable,noedit:!n.editable}),placeholder:n.placeholder,"aria-labelledby":"textAreaInReportEditable"},null,42,ky)}const By=A(Vy,[["render",My],["__scopeId","data-v-ab34c9dc"]]);const Ay={components:{ReportLogoHolder:G1,ReportDropDown:ty,ReportImageContainer:Sy,ReportStrainMaps:Dy,ReportTextBox:Oy,ReportTextBoxMultiple:By},props:{editable:{type:Boolean,required:!0,default:!0}},data(){return{genderOptions:[{value:"Female",label:"Female"},{value:"Male",label:"Male"},{value:"Other",label:"Other"}],completeDataOptions:[{value:"Yes",label:"Yes"},{value:"No",label:"No"}],imageQualityOptions:[{value:"Excellent",label:"Excellent"},{value:"Good",label:"Good"},{value:"OK",label:"OK"},{value:"Bad",label:"Bad"}],OS_REPORT_VALUES:{reportTitle:"BE-OS CMR Report",reportLogo:null,patientName:"PATIENT NAME",patientGender:"",patientAge:"00",patientDOB:"DD-Mon-YYYY",patientID:"123 456 789",rbhNumber:"000 000 000",protocol:"OS C-",scanDate:"DD-Mon-YYYY",scanTime:"00:00",completeData:"",imageQuality:"",reader:"Reader Name, MD",verifier:"Verifier Name, MD",scannerSystem:"Philips Ingenia",fieldStrength:"1.5T",softwareVersion:"5.7.1.3",starClaimer:"*Normal values are continuously being updated, therefore, may be subject to changes",summary:"",heartRateBaseline:"00",heartRateHV:"00",heartRateBH:"00",dtheartrate:"00",dtheartrateNormalRange:">15",vascularGlobal:"00",vascularLAD:"00",vascularLCX:"00",vascularRCA:"00",normalRangeVascular:">9.1",strainLADBaseline:"00",strainLADHV:"00",strainLADBH:"00",strainLCXBaseline:"00",strainLCXHV:"00",strainLCXBH:"00",strainRCABaseline:"00",strainRCAHV:"00",strainRCABH:"00",strainGLOBALBaseline:"00",strainGLOBALHV:"00",strainGLOBALBH:"00",vascularImage:"",strainImage:"",oxygenSensitiveMap:"",strainMapImage:"",strainMapBaseline:"",strainMapHV:"",strainMapBH:"",normalRange:"<-20%"}}},methods:{onOptionSelected(e,t){this.OS_REPORT_VALUES[e]=t},handleLogoUpdate(e){this.OS_REPORT_VALUES.reportLogo=e},handleUpdateValues(e,t){this.OS_REPORT_VALUES[e]=t},downloadReport(){this.buildPDF()},async getImage(e){await this.$refs[e].captureScreenshot()},async getImages(){await this.getImage("strainImage"),await this.getImage("vascularImage"),await this.getImage("oxygenSensitiveMap"),await this.captureScreenshot("strainMapImage","territorymapimg"),await this.captureScreenshot("reportLogo","reportLogo")},async captureScreenshot(e,t){const n=this.$refs[t];fi(n,{logging:!1,scale:3}).then(s=>{const o=s.toDataURL("image/png");this.handleImageScreenshot(e,o)}).catch(s=>{console.error("Error capturing screenshot:",s)})},handleImageScreenshot(e,t){this.OS_REPORT_VALUES[e]=t},buildPDF(){const e=this.OS_REPORT_VALUES;window.jsPDF=window.jspdf.jsPDF;const t=Za("p","pt",[612,792]);t.addFont("/fonts/Roboto-Light.ttf","Roboto","normal"),t.addFont("/fonts/arial_italic.ttf","Arial","normal"),t.addFont("/fonts/arial_greek.ttf","ArialGreek","normal"),t.setFont("helvetica","bold"),t.setFontSize(22),t.text(e.reportTitle,42,60),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Patient",42,80),e.reportLogo!=null&&t.addImage(e.reportLogo,"PNG",413,25,150,52.5),t.setFontSize(15),t.setTextColor("#229ED7"),t.text(e.patientName,42,97),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Gender:",43,114),t.setFontSize(10),t.setTextColor("#000917"),t.text(e.patientGender,81,114),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Age:",164,114),t.setFontSize(10),t.setTextColor("#000917"),t.text(e.patientAge,187,114),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("DOB:",269,114),t.setFontSize(10),t.setTextColor("#000917"),t.text(e.patientDOB,294,114),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Patient ID:",410,114),t.setFontSize(10),t.setTextColor("#000917"),t.text(e.patientID,460,114),t.setLineWidth(.1),t.line(577,120,35,122),t.setFontSize(10),t.setTextColor("#5E5D6C"),t.text("Exam",42,148),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("RBH number:",42,162),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.rbhNumber,42,175),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Protocol:",42,189),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.protocol,42,202),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Date:",42,216),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.scanDate,42,229),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Time:",42,243),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.scanTime,42,256),t.setFontSize(10),t.setTextColor("#5E5D6C"),t.text("Scan",42,293),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Complete Data:",42,307),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.completeData,42,320),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Image Quality:",42,334),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.imageQuality,42,347),t.setFontSize(10),t.setTextColor("#5E5D6C"),t.text("Analytical Team",42,383),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Reader:",42,397),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.reader,42,410),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Verified By:",42,424),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.verifier,42,437),t.setFontSize(10),t.setTextColor("#5E5D6C"),t.text("Scanner",42,473),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("System:",42,487),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.scannerSystem,42,500),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Field Strength:",42,514),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.fieldStrength,42,527),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Software Version:",42,541),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.softwareVersion,42,554),t.setTextColor("#5E5D6C"),t.setFont("helvetica","normal"),t.setFont("Arial"),this.processSentences(e.starClaimer,120,t,42,594),t.text("For research use only.",42,760),t.setFont("helvetica","bold"),t.setFontSize(12),t.setTextColor("#5E5D6C"),t.text("SUMMARY",170,148),t.setFillColor("#f8f8f8"),t.setDrawColor(255,255,255),t.roundedRect(166,155,425,110,10,10,"FD"),t.setFontSize(9),t.setTextColor("#000917"),this.processSentences(e.summary,380,t,178,170),t.setFillColor("#f8f8f8"),t.setDrawColor(255,255,255),t.roundedRect(166,270,425,500,10,10,"FD"),t.setFillColor("#e0e0e0"),t.setDrawColor(255,255,255),t.roundedRect(176,275,405,55,5,5,"FD"),t.setFontSize(10),t.setTextColor("#000917"),t.text("Heart Rate",186,305),t.text("Normal Range",186,320),t.text(e.heartRateBaseline,286,305),t.text(e.heartRateHV,379,305),t.text(e.heartRateBH,440,305),t.text(e.dtheartrate,520,305),t.text(e.dtheartrateNormalRange,520,320),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("BASELINE",286,290),t.text("HV",379,290),t.text("BH @ 30 SEC",440,290),t.setFont("helvetica","normal"),t.setFont("ArialGreek"),t.text("Δ",520,290),t.setFont("helvetica","bold"),t.text("HR",530,290),t.setFillColor("#e0e0e0"),t.setDrawColor(255,255,255),t.roundedRect(176,350,200,75,5,5,"FD"),t.roundedRect(381,350,200,75,5,5,"FD"),t.setFontSize(12),t.text("VASCULAR",180,345),t.text("STRAIN",385,345),t.setFontSize(8),t.text("B-MORE",185,365),t.setTextColor("#000917"),t.setFontSize(9),t.text("Global",185,380),t.text("LAD",185,392),t.text("LCX",185,404),t.text("RCA",185,415),t.text(e.vascularGlobal,230,380),t.text("*Normal Range: ",260,380),t.text(e.normalRangeVascular,330,380),t.text(e.vascularLAD,230,392),t.text(e.vascularLCX,230,404),t.text(e.vascularRCA,230,415),t.setFontSize(8),t.setTextColor("#5E5D6C"),t.text("B-MORE",390,365),t.text("BASELINE",435,365),t.text("HV",485,365),t.text("BH @ 30 SEC",522,365),t.setFontSize(9),t.setTextColor("#000917"),t.text("Global",390,380),t.text("LAD",390,392),t.text("LCX",390,404),t.text("RCA",390,415),t.text(e.strainGLOBALBaseline,435,380),t.text(e.strainGLOBALHV,485,380),t.text(e.strainGLOBALBH,523,380),t.text(e.strainLADBaseline,435,392),t.text(e.strainLADHV,485,392),t.text(e.strainLADBH,523,392),t.text(e.strainLCXBaseline,435,404),t.text(e.strainLCXHV,485,404),t.text(e.strainLCXBH,523,404),t.text(e.strainRCABaseline,435,415),t.text(e.strainRCAHV,485,415),t.text(e.strainRCABH,523,415),t.roundedRect(176,430,200,187.5,0,0,"FD"),t.roundedRect(381,430,200,187.5,0,0,"FD"),t.setFontSize(12),t.setTextColor("#000917"),t.text("Oxygen Sensitive Map",210,635),t.text("STRAIN MAPS",382,635),t.setFontSize(8),t.setTextColor("#5E5D6C"),t.text("BASELINE",390,753),t.text("HYPER-",467,748),t.text("VENTILATION",455,758),t.text("BREATH-",535,743),t.text("HOLD",540,753),t.text("(30 sec)",537,763),t.setFillColor("#e0e0e0"),t.setDrawColor(255,255,255),t.roundedRect(375,715,75,25,7,7,"FD"),t.setFontSize(9),t.setTextColor("#000917"),t.text("Normal Range: ",380,724.5),t.text(e.normalRange,380,734.5),t.addImage(e.strainImage,"PNG",381,430,200,187.5),t.addImage(e.vascularImage,"PNG",176,430,200,187.5),t.addImage(e.oxygenSensitiveMap,"PNG",201,650,150,112.5),t.addImage(e.strainMapImage,"PNG",376,645,210,70);const n=new Date().toLocaleDateString("en-US");t.save(`Area19_Report_${e.patientName}_${n}.pdf`)},processSentences(e,t,n,s,o){function i(u){const d=document.createElement("span");d.style.font="10px Arial",d.style.position="absolute",d.style.visibility="hidden",d.textContent=u,document.body.appendChild(d);const{width:g}=d.getBoundingClientRect();return document.body.removeChild(d),g}let a=e.trim().split(new RegExp("(?<=[.!?])|\\n"));a=a.map(u=>u.replace(/\n/g,""));function r(u,d){const g=u.split(" "),y=[];let f=g[0];for(let p=1;p<g.length;p++){const m=`${f} ${g[p]}`;i(m)<=d?f=m:(y.push(f),f=g[p])}return y.push(f),y}let l=0,c=o;a.forEach(u=>{i(u)>t?r(u,t).forEach(g=>{l>0&&(c+=14),n.text(g,s,c),l++}):(l>0&&(c+=14),n.text(u,s,c),l++)})}},watch:{OS_REPORT_VALUES:{handler(){window.localStorage.setItem("reportValues",JSON.stringify(this.OS_REPORT_VALUES))},deep:!0},editable(){this.editable||this.getImages()}}},q=e=>(oe("data-v-d503f07e"),e=e(),ie(),e),Fy={class:"print-area"},Ny={id:"report-element",class:"report-element"},$y={class:"row1"},Uy={ref:"reportLogo"},Hy={class:"row2"},Wy=q(()=>h("h5",null,"Patient",-1)),zy={class:"row3",style:{"border-bottom":"1px solid black"}},jy={id:"gender",style:{display:"flex",gap:"5px"}},Gy=q(()=>h("h5",null,"Gender:",-1)),Xy={class:"below"},qy={class:"left-column"},Ky={class:"Exam"},Yy=q(()=>h("h4",{style:{"margin-bottom":"5px"}},"Exam",-1)),Qy=q(()=>h("h5",{style:{height:"15px"}},"RBH number:",-1)),Zy=q(()=>h("h5",{style:{height:"15px"}},"Protocol:",-1)),Jy=q(()=>h("h5",{style:{height:"15px"}},"Date:",-1)),ew=q(()=>h("h5",{style:{height:"15px"}},"Time:",-1)),tw={class:"Scan"},nw=q(()=>h("h4",{style:{"margin-bottom":"5px"}},"Scan",-1)),ow=q(()=>h("h5",null,"Complete Data:",-1)),iw=q(()=>h("h5",null,"Image Quality:",-1)),sw={class:"Technologist"},aw=q(()=>h("h4",{style:{"margin-bottom":"10px"}},"Analytical Team",-1)),rw=q(()=>h("h5",{style:{height:"15px"}},"Reader:",-1)),lw=q(()=>h("h5",{style:{height:"15px"}},"Verified by:",-1)),cw={class:"Scanner"},uw=q(()=>h("h4",{style:{"margin-bottom":"10px"}},"Scanner",-1)),dw=q(()=>h("h5",{style:{height:"15px"}},"System:",-1)),hw=q(()=>h("h5",{style:{height:"15px"}},"Field Strength:",-1)),gw=q(()=>h("h5",{style:{height:"15px"}},"Software Version:",-1)),fw={class:"Scanner"},pw=q(()=>h("div",null,[h("h5",{style:{width:"150px","font-style":"italic"}}," For research use only. ")],-1)),mw={class:"right-column"},vw={class:"summary"},yw=q(()=>h("h4",{style:{height:"15px"}},"SUMMARY",-1)),ww={class:"detailed-report"},Sw={class:"overview"},_w=q(()=>h("div",{class:"labels"},[h("br"),h("h5",{style:{width:"120px"}},"Heart Rate"),h("h5",{style:{width:"120px"}},"Normal Range")],-1)),Cw={class:"baselinevals"},bw=q(()=>h("h5",{style:{color:"#5e5d6c"}},"BASELINE",-1)),Tw={class:"hyperventvals"},Iw=q(()=>h("h5",{style:{color:"#5e5d6c"}},"HV",-1)),xw={class:"BHvals"},Rw=q(()=>h("h5",{style:{color:"#5e5d6c",width:"90px"}},"BH @ 30 SEC",-1)),Dw={class:"baselinevals"},Ew=q(()=>h("h5",{style:{color:"#5e5d6c"}},"Δ HR",-1)),Lw={class:"overview_middle"},Pw={class:"col"},Ow=q(()=>h("h4",null,"VASCULAR",-1)),Vw={class:"vals"},kw={class:"valuesOCG",style:{"padding-left":"10px","padding-top":"10px"}},Mw=q(()=>h("h6",{style:{"margin-bottom":"10px","padding-left":"5px"}}," B-MORE ",-1)),Bw={style:{display:"flex",position:"relative"}},Aw={style:{position:"absolute",left:"80px",width:"190px"}},Fw={style:{"margin-left":"25px"}},Nw={class:"col",style:{"margin-left":"2%"}},$w=q(()=>h("h4",null,"STRAIN",-1)),Uw={class:"vals"},Hw={class:"valuesSTRAIN"},Ww=q(()=>h("div",{class:"strain-containter"},[h("h6",null,"B-MORE"),h("h5",null,"Global"),h("h5",null,"LAD"),h("h5",null,"LCX"),h("h5",null,"RCA")],-1)),zw={class:"strain-containter"},jw=q(()=>h("h6",null,"BASELINE",-1)),Gw={class:"strain-containter"},Xw=q(()=>h("h6",{style:{"padding-left":"8%"}},"HV",-1)),qw={class:"strain-containter"},Kw=q(()=>h("h6",null,"BH @ 30 SEC",-1)),Yw={class:"overview_graphs"},Qw={style:{display:"flex","flex-direction":"column","align-items":"center",width:"278px"}},Zw=q(()=>h("h4",{style:{color:"black"}},"Oxygen Sensitive Map",-1)),Jw={class:"strainmaps"},eS=q(()=>h("h4",{style:{color:"black"}},"STRAIN MAPS",-1)),tS={class:"territorymaps",ref:"territorymapimg"},nS={style:{"margin-right":"auto","background-color":"#8f8f8f3b",width:"90px",padding:"2px","padding-left":"5px","border-radius":"10px"}},oS=q(()=>h("div",{class:"mapnames"},[h("h5",null,"BASELINE"),h("h5",null,"HYPER-VENTILATION"),h("h5",null,[H(" BREATH-HOLD "),h("br"),H(" (30 sec) ")])],-1));function iS(e,t,n,s,o,i){const a=O("ReportTextBox"),r=O("ReportLogoHolder"),l=O("ReportDropDown"),c=O("ReportTextBoxMultiple"),u=O("ReportImageContainer"),d=O("ReportStrainMaps");return I(),D("div",Fy,[h("div",Ny,[h("div",$y,[v(a,{id:"reportTitle",editable:n.editable,propValue:o.OS_REPORT_VALUES.reportTitle,onUpdateValue:i.handleUpdateValues,style:{width:"450px",color:"#000000","font-weight":"bold","font-size":"30px",height:"40px",padding:"0%"}},null,8,["editable","propValue","onUpdateValue"]),h("div",Uy,[v(r,{editable:n.editable,onImageUpdated:i.handleLogoUpdate},null,8,["editable","onImageUpdated"])],512)]),h("div",Hy,[Wy,v(a,{id:"patientName",editable:n.editable,propValue:o.OS_REPORT_VALUES.patientName,onUpdateValue:i.handleUpdateValues,style:{width:"650px",color:"#229ed7","font-weight":"500","font-size":"30px",height:"35px",padding:"0%"}},null,8,["editable","propValue","onUpdateValue"])]),h("div",zy,[h("div",jy,[Gy,v(l,{editable:n.editable,id:"patientGender",options:o.genderOptions,onOptionSelected:i.onOptionSelected},null,8,["editable","options","onOptionSelected"])]),h("div",null,[h("h5",null,[H(" Age: "),v(a,{id:"patientAge",editable:n.editable,propValue:o.OS_REPORT_VALUES.patientAge,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"])])]),h("div",null,[h("h5",null,[H(" DOB: "),v(a,{id:"patientDOB",editable:n.editable,propValue:o.OS_REPORT_VALUES.patientDOB,onUpdateValue:i.handleUpdateValues,style:{width:"120px"}},null,8,["editable","propValue","onUpdateValue"])])]),h("div",null,[h("h5",null,[H(" Patient ID: "),v(a,{id:"patientID",editable:n.editable,propValue:o.OS_REPORT_VALUES.patientID,onUpdateValue:i.handleUpdateValues,style:{width:"110px"}},null,8,["editable","propValue","onUpdateValue"])])])]),h("div",Xy,[h("div",qy,[h("div",Ky,[Yy,Qy,v(a,{id:"rbhNumber",editable:n.editable,propValue:o.OS_REPORT_VALUES.rbhNumber,onUpdateValue:i.handleUpdateValues,style:{width:"110px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"]),Zy,v(a,{id:"protocol",editable:n.editable,propValue:o.OS_REPORT_VALUES.protocol,onUpdateValue:i.handleUpdateValues,style:{width:"110px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"]),Jy,v(a,{id:"scanDate",editable:n.editable,propValue:o.OS_REPORT_VALUES.scanDate,onUpdateValue:i.handleUpdateValues,style:{width:"110px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"]),ew,v(a,{id:"scanTime",editable:n.editable,propValue:o.OS_REPORT_VALUES.scanTime,onUpdateValue:i.handleUpdateValues,style:{width:"110px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"])]),h("div",tw,[nw,ow,v(l,{id:"completeData",editable:n.editable,options:o.completeDataOptions,onOptionSelected:i.onOptionSelected},null,8,["editable","options","onOptionSelected"]),iw,v(l,{id:"imageQuality",editable:n.editable,options:o.imageQualityOptions,onOptionSelected:i.onOptionSelected},null,8,["editable","options","onOptionSelected"])]),h("div",sw,[aw,rw,v(a,{id:"reader",editable:n.editable,propValue:o.OS_REPORT_VALUES.reader,onUpdateValue:i.handleUpdateValues,style:{width:"150px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"]),lw,v(a,{id:"verifier",editable:n.editable,propValue:o.OS_REPORT_VALUES.verifier,onUpdateValue:i.handleUpdateValues,style:{width:"150px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"])]),h("div",cw,[uw,dw,v(a,{id:"scannerSystem",editable:n.editable,propValue:o.OS_REPORT_VALUES.scannerSystem,onUpdateValue:i.handleUpdateValues,style:{width:"150px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"]),hw,v(a,{id:"fieldStrength",editable:n.editable,propValue:o.OS_REPORT_VALUES.fieldStrength,onUpdateValue:i.handleUpdateValues,style:{width:"100px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"]),gw,v(a,{id:"softwareVersion",editable:n.editable,propValue:o.OS_REPORT_VALUES.softwareVersion,onUpdateValue:i.handleUpdateValues,style:{width:"100px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"])]),h("div",fw,[v(c,{id:"starClaimer",editable:n.editable,propValue:o.OS_REPORT_VALUES.starClaimer,onUpdateValue:i.handleUpdateValues,style:{width:"170px",height:"120px",padding:"0px","padding-top":"5px","font-style":"italic"}},null,8,["editable","propValue","onUpdateValue"])]),pw]),h("div",mw,[h("div",vw,[yw,v(c,{id:"summary",editable:n.editable,propValue:o.OS_REPORT_VALUES.summary,placeholder:"Type Summary Here...",onUpdateValue:i.handleUpdateValues,style:{width:"100%",padding:"10px 10px",height:"190px","font-size":"14px",color:"black","background-color":"#f8f8f8"}},null,8,["editable","propValue","onUpdateValue"])]),h("div",ww,[h("div",Sw,[_w,h("div",Cw,[bw,v(a,{id:"heartRateBaseline",editable:n.editable,propValue:o.OS_REPORT_VALUES.heartRateBaseline,onUpdateValue:i.handleUpdateValues,style:{width:"60px","padding-left":"0px","font-size":"14px"}},null,8,["editable","propValue","onUpdateValue"])]),h("div",Tw,[Iw,v(a,{id:"heartRateHV",editable:n.editable,propValue:o.OS_REPORT_VALUES.heartRateHV,onUpdateValue:i.handleUpdateValues,style:{width:"60px","padding-left":"0px","font-size":"14px"}},null,8,["editable","propValue","onUpdateValue"])]),h("div",xw,[Rw,v(a,{id:"heartRateBH",editable:n.editable,propValue:o.OS_REPORT_VALUES.heartRateBH,onUpdateValue:i.handleUpdateValues,style:{width:"60px","padding-left":"0px","font-size":"14px"}},null,8,["editable","propValue","onUpdateValue"])]),h("div",Dw,[Ew,v(a,{id:"dtheartrate",editable:n.editable,propValue:o.OS_REPORT_VALUES.dtheartrate,onUpdateValue:i.handleUpdateValues,style:{width:"60px","padding-left":"0px","font-size":"14px"}},null,8,["editable","propValue","onUpdateValue"]),v(a,{id:"dtheartrateNormalRange",editable:n.editable,propValue:o.OS_REPORT_VALUES.dtheartrateNormalRange,onUpdateValue:i.handleUpdateValues,style:{width:"60px","padding-left":"0px","font-size":"14px"}},null,8,["editable","propValue","onUpdateValue"])])]),h("div",Lw,[h("div",Pw,[Ow,h("div",Vw,[h("div",kw,[Mw,h("div",Bw,[h("h5",null,[H(" Global "),v(a,{id:"vascularGlobal",editable:n.editable,propValue:o.OS_REPORT_VALUES.vascularGlobal,onUpdateValue:i.handleUpdateValues,style:{"margin-left":"12px","padding-left":"4%"}},null,8,["editable","propValue","onUpdateValue"])]),h("div",Aw,[h("h5",Fw,[H(" *Normal Range: "),v(a,{id:"normalRangeVascular",editable:n.editable,propValue:o.OS_REPORT_VALUES.normalRangeVascular,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"])])])]),h("h5",null,[H(" LAD "),v(a,{id:"vascularLAD",editable:n.editable,propValue:o.OS_REPORT_VALUES.vascularLAD,onUpdateValue:i.handleUpdateValues,style:{"margin-left":"24.5px"}},null,8,["editable","propValue","onUpdateValue"])]),h("h5",null,[H(" LCX "),v(a,{id:"vascularLCX",editable:n.editable,propValue:o.OS_REPORT_VALUES.vascularLCX,onUpdateValue:i.handleUpdateValues,style:{"margin-left":"25.5px"}},null,8,["editable","propValue","onUpdateValue"])]),h("h5",null,[H(" RCA "),v(a,{id:"vascularRCA",editable:n.editable,propValue:o.OS_REPORT_VALUES.vascularRCA,onUpdateValue:i.handleUpdateValues,style:{"margin-left":"23px"}},null,8,["editable","propValue","onUpdateValue"])])])]),v(u,{id:"vascularImage",ref:"vascularImage",editable:n.editable,"add-bar":"./images/bar.png",onScreenshotCaptured:i.handleImageScreenshot},null,8,["editable","add-bar","onScreenshotCaptured"])]),h("div",Nw,[$w,h("div",Uw,[h("div",Hw,[Ww,h("div",zw,[jw,v(a,{id:"strainGLOBALBaseline",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainGLOBALBaseline,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),v(a,{id:"strainLADBaseline",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainLADBaseline,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),v(a,{id:"strainLCXBaseline",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainLCXBaseline,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),v(a,{id:"strainRCABaseline",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainRCABaseline,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"])]),h("div",Gw,[Xw,v(a,{id:"strainGLOBALHV",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainGLOBALHV,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),v(a,{id:"strainLADHV",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainLADHV,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),v(a,{id:"strainLCXHV",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainLCXHV,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),v(a,{id:"strainRCAHV",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainRCAHV,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"])]),h("div",qw,[Kw,v(a,{id:"strainGLOBALBH",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainGLOBALBH,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),v(a,{id:"strainLADBH",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainLADBH,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),v(a,{id:"strainLCXBH",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainLCXBH,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),v(a,{id:"strainRCABH",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainRCABH,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"])])])]),v(u,{id:"strainImage",ref:"strainImage",editable:n.editable,onScreenshotCaptured:i.handleImageScreenshot},null,8,["editable","onScreenshotCaptured"])])]),h("div",Yw,[h("div",Qw,[Zw,v(u,{id:"oxygenSensitiveMap",ref:"oxygenSensitiveMap",editable:n.editable,width:150,height:150,canvasText:"Upload OS-Map",onScreenshotCaptured:i.handleImageScreenshot},null,8,["editable","onScreenshotCaptured"])]),h("div",Jw,[eS,h("div",tS,[v(d,{id:"strainMapBaseline",values:[o.OS_REPORT_VALUES.strainLADBaseline,o.OS_REPORT_VALUES.strainLCXBaseline,o.OS_REPORT_VALUES.strainRCABaseline]},null,8,["values"]),v(d,{id:"strainMapHV",values:[o.OS_REPORT_VALUES.strainLADHV,o.OS_REPORT_VALUES.strainLCXHV,o.OS_REPORT_VALUES.strainRCAHV]},null,8,["values"]),v(d,{id:"strainMapBH",values:[o.OS_REPORT_VALUES.strainLADBH,o.OS_REPORT_VALUES.strainLCXBH,o.OS_REPORT_VALUES.strainRCABH]},null,8,["values"])],512),h("div",null,[h("p",nS,[H(" Normal Range: "),v(a,{id:"normalRange",editable:n.editable,propValue:o.OS_REPORT_VALUES.normalRange,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"])])]),oS])])])])])])])}const sS=A(Ay,[["render",iS],["__scopeId","data-v-d503f07e"]]);const aS={components:{Report:sS},methods:{printReport(){this.$refs.editablereport.buildPDF()},handleEdit(){this.edit=!this.edit},handleSave(){this.edit?(this.showPopup=!0,setTimeout(()=>{this.showPopup=!1},3e3)):this.$refs.editablereport.downloadReport()}},data(){return{edit:!0,showPopup:!1}}},tn=e=>(oe("data-v-d6cad36d"),e=e(),ie(),e),rS={class:"reportcontainermain"},lS={class:"reporthere"},cS={class:"toolbar"},uS=tn(()=>h("h1",null,"Edit",-1)),dS=[uS],hS=tn(()=>h("button",{class:"tool"},[h("h1",null,"Share")],-1)),gS=tn(()=>h("h1",null,"Print",-1)),fS=[gS],pS={style:{position:"relative"}},mS=tn(()=>h("h1",null,"Save",-1)),vS=[mS],yS=tn(()=>h("h5",null,"Please stop editing first.",-1)),wS=[yS];function SS(e,t,n,s,o,i){const a=O("Report");return I(),D("div",rS,[h("div",lS,[v(a,{ref:"editablereport",editable:o.edit},null,8,["editable"])]),h("div",cS,[h("button",{class:N(["tool",{clicked:o.edit}]),onClick:t[0]||(t[0]=(...r)=>i.handleEdit&&i.handleEdit(...r))},dS,2),hS,h("button",{class:"tool",onClick:t[1]||(t[1]=(...r)=>i.printReport&&i.printReport(...r))},fS),h("div",pS,[h("button",{class:"tool",onClick:t[2]||(t[2]=(...r)=>i.handleSave&&i.handleSave(...r))},vS),h("div",{class:N(["popup",{show:o.showPopup}])},wS,2)])])])}const _S=A(aS,[["render",SS],["__scopeId","data-v-d6cad36d"]]);const CS={props:{dataToGraph:{type:Array}},watch:{dataToGraph:{deep:!0,handler(){this.drawLines()}}},data(){return{canvasId:"myCanvas",minX:0,minY:0,maxX:15,maxY:1,unitsPerTickX:5,unitsPerTickY:.25,title:"Normalized SI (RV-LV)",padding:15,tickSize:.1,axisColor:"white",pointRadius:1,font:"10pt Arial",fontHeight:10,rangeX:null,rangeY:null,numXTicks:null,numYTicks:null,x:null,y:null,width:null,height:null,scaleX:null,scaleY:null,context:null,data:null}},methods:{drawSysDias(e,t){const n=e;n.save(),n.translate(this.x,this.y+this.height),n.font="12px Arial",n.fillStyle="white",n.fillText("Systole",0*this.scaleX,0-(this.height+this.padding));const s=n.createLinearGradient(t*this.scaleX,0,this.maxX*this.scaleX-50,0);s.addColorStop(0,"rgba(38, 151, 192, 0.25)"),s.addColorStop(1,"#686F7100"),n.fillStyle=s,n.fillRect(t*this.scaleX,0,this.maxX*this.scaleX,0-(this.height+2*this.padding)),n.strokeStyle="white",n.lineWidth=1,n.beginPath(),n.moveTo(t*this.scaleX,0),n.lineTo(t*this.scaleX,0-(this.height+2*this.padding)),n.stroke(),n.fillStyle="white",n.fillText("Diastole",t*this.scaleX+5,0-(this.height+this.padding)),n.restore()},getLongestValueWidth(e){let t=0;const n=e;n.font=this.font;for(let s=0;s<=this.numYTicks;s++){const o=this.maxY-s*this.unitsPerTickY;t=Math.max(t,n.measureText(o).width)}return t},drawXAxis(e){const t=e;t.save(),t.beginPath(),t.moveTo(this.x,this.y+this.height),t.strokeStyle=this.axisColor,t.lineWidth=1,t.stroke(),t.font=this.font,t.fillStyle="white",t.textAlign="center",t.textBaseline="middle";for(let n=-1;n<this.numXTicks;n++){const s=Math.round((n+1)*this.maxX/this.numXTicks);t.save(),t.translate((n+1)*this.width/this.numXTicks+this.x,this.y+this.height+this.padding),t.fillText(s,0,0),t.restore()}t.restore()},drawYAxis(e){const t=e;t.save(),t.save(),t.beginPath(),t.moveTo(this.x,this.y),t.strokeStyle=this.axisColor,t.stroke(),t.restore(),t.font=this.font,t.fillStyle="white",t.textAlign="right",t.textBaseline="middle";for(let n=0;n<=this.numYTicks;n++){const s=this.maxY-n*this.maxY/this.numYTicks;t.save(),t.translate(this.x-this.padding+5,n*this.height/this.numYTicks+this.y),t.fillText(s,0,0),t.restore()}t.restore()},drawLine(e,t,n,s){const o=e;o.save(),this.transformContext(o),o.lineWidth=s,o.strokeStyle=n,o.fillStyle=n,o.shadowBlur=10,o.shadowColor=n,o.beginPath(),o.moveTo(t[0].x*this.scaleX,t[0].y*this.scaleY);for(let i=0;i<t.length;i++){const a=t[i];o.lineTo(a.x*this.scaleX,a.y*this.scaleY),o.stroke(),o.closePath(),o.beginPath(),o.arc(a.x*this.scaleX,a.y*this.scaleY,this.pointRadius,0,2*Math.PI,!1),o.fill(),o.closePath(),o.beginPath(),o.moveTo(a.x*this.scaleX,a.y*this.scaleY)}o.restore()},transformContext(e){e.translate(this.x,this.y+this.height),e.scale(1,-1)},generateRandomData(e){const t=[];for(let n=0;n<=e;n++){const s=n*1,o=Math.random();t.push({x:s,y:o})}return t},drawLines(){const{context:e}=this;e.clearRect(0+this.padding,this.y-2*this.padding,this.width+4*this.padding,this.height+4*this.padding);const t=["#a2191a","#105a93","#1f7c55"];for(let n=0;n<this.dataToGraph.length;n++)this.dataToGraph[n]===1&&this.drawLine(e,this.data[n],t[n],2);this.drawSysDias(e,7.5),this.drawXAxis(e),this.drawYAxis(e)}},mounted(){const{canvas:e}=this.$refs,t=e.getContext("2d");this.x=this.getLongestValueWidth(t)+this.padding*2+25,this.context=t,this.y=this.padding*2,this.width=e.width-this.x-this.padding*2,this.height=e.height-this.y-this.padding-this.fontHeight,this.rangeX=this.maxX-this.minY,this.scaleX=this.width/this.rangeX,this.rangeY=this.maxY-this.minY,this.scaleY=this.height/this.rangeY,this.numXTicks=Math.round(this.rangeX/this.unitsPerTickX),this.numYTicks=Math.round(this.rangeY/this.unitsPerTickY),this.drawXAxis(t),this.drawYAxis(t),t.save(),t.translate(10,this.height/1.5),t.rotate(270*Math.PI/180),t.font="12px Arial",t.fillStyle="white",t.textAlign="center",t.textBaseline="middle",t.fillText(this.title,0,0),t.restore(),this.drawSysDias(t,7.5);const n=[this.generateRandomData(15),this.generateRandomData(15),this.generateRandomData(15)];this.data=n,this.drawLines()}},bS={ref:"canvas",width:"411",height:"206",style:{}};function TS(e,t,n,s,o,i){return I(),D("div",null,[h("canvas",bS,null,512)])}const IS=A(CS,[["render",TS],["__scopeId","data-v-01332437"]]),xS={props:{id:{type:Number,required:!0}},data(){return{sectionOpacities:[.7,.7,.7],hoveredSection:-1,outerradius:60}},mounted(){this.createChart()},methods:{createChart(){const e=this.$refs.chartCanvas,t=e.getContext("2d"),n=e.width/2-85,s=e.height/2,o=this.outerradius,i=o/3;t.clearRect(0,0,e.width,e.height),e.addEventListener("click",this.handleChartClick),e.addEventListener("mousemove",this.handleChartHover),e.addEventListener("mouseleave",this.handleChartLeave),e.addEventListener("dblclick",this.handleChartDoubleClick);const a=["#a2191a","#105a93","#1f7c55"],r=[1,1,1],l=r.reduce((u,d)=>u+d,0);let c=0;r.forEach((u,d)=>{const g=u/l*Math.PI*2,y=c+g;t.beginPath(),t.moveTo(n+o*Math.cos(c),s+o*Math.sin(c)),t.arc(n,s,o,c,y),t.arc(n,s,i,y,c,!0),t.closePath();const f=this.hoveredSection===d?this.sectionOpacities[d]+.3:this.sectionOpacities[d];t.globalAlpha=f,t.fillStyle=a[d],t.fill(),t.globalAlpha=1,t.strokeStyle="#ffffff",t.lineWidth=2,t.stroke(),c=y}),t.beginPath(),t.arc(n,s,o,0,Math.PI*2),t.strokeStyle="#ffffff",t.lineWidth=1,t.stroke(),t.beginPath(),t.arc(n,s,i,0,Math.PI*2),t.strokeStyle="#ffffff",t.lineWidth=1,t.stroke()},handleChartClick(e){const t=this.$refs.chartCanvas,n=t.getBoundingClientRect(),s=e.clientX-n.left,o=e.clientY-n.top,i=t.width/2-85,a=t.height/2,r=this.outerradius,l=r/3,c=Math.sqrt((s-i)**2+(o-a)**2);if(c<l)this.sectionOpacities=[.7,.7,.7];else{if(c>=r)return;{const u=Math.atan2(o-a,s-i),d=u>=0?u:u+Math.PI*2,g=Math.floor(d/(Math.PI*2)*3);this.sectionOpacities[g]=this.sectionOpacities[g]===.7?.2:.7}}this.createChart(),this.$emit("segment-updated",this.id,this.sectionOpacities)},handleChartDoubleClick(e){const t=this.$refs.chartCanvas,n=t.getBoundingClientRect(),s=e.clientX-n.left,o=e.clientY-n.top,i=t.width/2-85,a=t.height/2,r=this.outerradius,l=r/3,c=Math.sqrt((s-i)**2+(o-a)**2);if(c<l)this.sectionOpacities=[.7,.7,.7];else{if(c>=r)return;{const u=Math.atan2(o-a,s-i),d=u>=0?u:u+Math.PI*2,g=Math.floor(d/(Math.PI*2)*3);this.sectionOpacities=[.2,.2,.2],this.sectionOpacities[g]=.7}}this.createChart(),this.$emit("segment-updated",this.id,this.sectionOpacities)},handleChartHover(e){const t=this.$refs.chartCanvas,n=t.getBoundingClientRect(),s=e.clientX-n.left,o=e.clientY-n.top,i=t.width/2-85,a=t.height/2,r=this.outerradius,l=r/3,c=Math.sqrt((s-i)**2+(o-a)**2);if(c<l)this.hoveredSection=-1;else if(c>=r){this.handleChartLeave();return}else{const u=Math.atan2(o-a,s-i),d=u>=0?u:u+Math.PI*2,g=Math.floor(d/(Math.PI*2)*3);this.hoveredSection=g}this.createChart()},handleChartLeave(){this.hoveredSection=-1,this.createChart()}}},RS={ref:"chartCanvas"};function DS(e,t,n,s,o,i){return I(),D("div",null,[h("canvas",RS,null,512)])}const ES=A(xS,[["render",DS]]);const LS={props:{label:{type:String,default:"Territory Min"},textOpacity:{type:Number,default:1}},updated(){},data(){return{setTextOpacity:this.textOpacity}},methods:{handleMouseEnter(){this.setTextOpacity+=.3},handleMouseLeave(){this.setTextOpacity-=.3},handleClick(){this.$emit("biomarker-click",this.label)}}};function PS(e,t,n,s,o,i){return I(),D("div",null,[h("h4",{onMouseenter:t[0]||(t[0]=(...a)=>i.handleMouseEnter&&i.handleMouseEnter(...a)),onFocusin:t[1]||(t[1]=(...a)=>i.handleMouseEnter&&i.handleMouseEnter(...a)),onMouseleave:t[2]||(t[2]=(...a)=>i.handleMouseLeave&&i.handleMouseLeave(...a)),onFocusout:t[3]||(t[3]=(...a)=>i.handleMouseLeave&&i.handleMouseLeave(...a)),onClick:t[4]||(t[4]=(...a)=>i.handleClick&&i.handleClick(...a)),style:ee({opacity:o.setTextOpacity}),onKeydown:t[5]||(t[5]=ot(ue((...a)=>e.handleKeyDown&&e.handleKeyDown(...a),["prevent"]),["space"]))},U(n.label),37)])}const OS=A(LS,[["render",PS],["__scopeId","data-v-65722d25"]]);const VS={components:{SimpleGraph:IS,TerritoriesSegments:ES,GraphTerritories:OS},data(){return{canGraph:[{id:1,allowed:[1,1,1]},{id:2,allowed:[1,1,1]},{id:3,allowed:[1,1,1]}],itemHeight:510,showComponent:[1,1,1],territoryGraphs:[{id:1,title:"Territory Min",opacity:.3},{id:2,title:"Territory Absolute Velocity",opacity:.3},{id:3,title:"Territory Median",opacity:.3},{id:4,title:"Sector Median",opacity:.3},{id:5,title:"Sector Max",opacity:.3},{id:6,title:"Sector Min",opacity:.3}]}},methods:{handleSegmentUpdate(e,t){for(let n=0;n<3;n++)this.canGraph[e-1].allowed[n]=t[n]>.5},scrollX(e,t){const n=`scrollContainer${t}`;this.$refs[n].scrollLeft+=e.deltaY/10},handleToggleMarker(e){console.log(e),this.showComponent[e]=!1,this.showComponent[e]=!0}}},po=e=>(oe("data-v-e71c7254"),e=e(),ie(),e),kS={class:"biomarkerviewer"},MS={class:"biomarkercomponent"},BS={class:"graphs"},AS=po(()=>h("div",{class:"headertitle"},[h("h2",null,"ANALYSIS")],-1)),FS={class:"content"},NS={class:"left"},$S={class:"right"},US={key:0},HS={class:"biomarkercomponent"},WS={class:"graphs"},zS=po(()=>h("h2",null,"ANALYSIS",-1)),jS={class:"content"},GS={class:"left"},XS={class:"right"},qS={key:0},KS={class:"biomarkercomponent"},YS={class:"graphs"},QS=po(()=>h("h2",null,"ANALYSIS",-1)),ZS={class:"content"},JS={class:"left"},e_={class:"right"},t_={key:0};function n_(e,t,n,s,o,i){const a=O("ScreenTemp"),r=O("GraphTerritories"),l=O("TerritoriesSegments"),c=O("SimpleGraph");return I(),D("div",kS,[h("div",MS,[h("div",{class:"screen1",style:ee({height:o.itemHeight+"px"})},[v(a)],4),h("div",BS,[AS,h("div",{class:"territoryGraphs",ref:"scrollContainer0",onMousewheel:t[1]||(t[1]=u=>i.scrollX(u,0))},[(I(!0),D(se,null,Re(o.territoryGraphs,u=>(I(),D("div",{key:u.id},[v(r,{id:u.id,label:u.title,textOpacity:u.opacity,onBiomarkerClick:t[0]||(t[0]=d=>i.handleToggleMarker(0))},null,8,["id","label","textOpacity"])]))),128))],544),h("div",FS,[h("div",NS,[v(l,{id:1,onSegmentUpdated:i.handleSegmentUpdate},null,8,["onSegmentUpdated"])]),h("div",$S,[v(De,{name:"fade"},{default:R(()=>[o.showComponent[0]?(I(),D("div",US,[v(c,{dataToGraph:o.canGraph[0].allowed},null,8,["dataToGraph"])])):z("",!0)]),_:1})])])])]),h("div",HS,[h("div",{class:"screen1",style:ee({height:o.itemHeight+"px"})},[v(a)],4),h("div",WS,[zS,h("div",{class:"territoryGraphs",ref:"scrollContainer1",onMousewheel:t[3]||(t[3]=u=>i.scrollX(u,1))},[(I(!0),D(se,null,Re(o.territoryGraphs,u=>(I(),D("div",{key:u.id},[v(r,{id:u.id,label:u.title,textOpacity:u.opacity,onBiomarkerClick:t[2]||(t[2]=d=>i.handleToggleMarker(1))},null,8,["id","label","textOpacity"])]))),128))],544),h("div",jS,[h("div",GS,[v(l,{id:2,onSegmentUpdated:i.handleSegmentUpdate},null,8,["onSegmentUpdated"])]),h("div",XS,[v(De,{name:"fade"},{default:R(()=>[o.showComponent[1]?(I(),D("div",qS,[v(c,{dataToGraph:o.canGraph[1].allowed},null,8,["dataToGraph"])])):z("",!0)]),_:1})])])])]),h("div",KS,[h("div",{class:"screen1",style:ee({height:o.itemHeight+"px"})},[v(a)],4),h("div",YS,[QS,h("div",{class:"territoryGraphs",ref:"scrollContainer2",onMousewheel:t[5]||(t[5]=u=>i.scrollX(u,2))},[(I(!0),D(se,null,Re(o.territoryGraphs,u=>(I(),D("div",{key:u.id},[v(r,{label:u.title,textOpacity:u.opacity,onBiomarkerClick:t[4]||(t[4]=d=>i.handleToggleMarker(2))},null,8,["label","textOpacity"])]))),128))],544),h("div",ZS,[h("div",JS,[v(l,{id:3,onSegmentUpdated:i.handleSegmentUpdate},null,8,["onSegmentUpdated"])]),h("div",e_,[v(De,{name:"fade"},{default:R(()=>[o.showComponent[2]?(I(),D("div",t_,[v(c,{dataToGraph:o.canGraph[2].allowed},null,8,["dataToGraph"])])):z("",!0)]),_:1})])])])])])}const o_=A(VS,[["render",n_],["__scopeId","data-v-e71c7254"]]);const i_={components:{PatientHeaderInfo:Hv,AnalysisNavigationBar:a0,VtkTwoView:oa,QualityCheck:H1,ReportMaker:_S,GraphicalAnalysis:o_},data(){return{container:"container",currentComponent:"QualityCheck"}},methods:{getTimeOfDay(){const e=new Date().getHours();return e>=5&&e<12?"Morning":e>=12&&e<18?"Afternoon":e>=18&&e<23?"Evening":"Day"},handleToolSelected(e){e==="ReportMaker"?this.currentComponent="ReportMaker":e==="QualityCheck"?this.currentComponent="QualityCheck":e==="GraphicalAnalysis"&&(this.currentComponent="GraphicalAnalysis"),window.localStorage.setItem("currentView",this.currentComponent)},handleUpdateQualityCheck(e){e?this.$refs.mainAnalysisComponent.toggleComponent("CheckContours"):this.$refs.mainAnalysisComponent.toggleComponent("CheckBreathingSplits")}},created(){this.timeofday=this.getTimeOfDay(),this.container=`${this.container} ${this.timeofday.toLowerCase()}`},mounted(){this.currentComponent=window.localStorage.getItem("currentView")}},ca=e=>(oe("data-v-4b2d42a2"),e=e(),ie(),e),s_=ca(()=>h("div",{class:"mobile-overlay"},[h("div",{class:"warning"},[h("h2",null,[H(" It appears that you are trying to use our app on a screen size of less than 1200 px wide. "),h("br"),H(" Currently our app is limited to larger devices. Please try on a larger laptop. ")])])],-1)),a_={class:"body"},r_={class:"navigationBar"},l_={class:"header-main"},c_={class:"header"},u_={class:"main"},d_=ca(()=>h("h5",{style:{"margin-left":"auto",color:"grey"}}," Area 19 OCG Prototype V.0.1 ",-1));function h_(e,t,n,s,o,i){const a=O("AnalysisNavigationBar"),r=O("PatientHeaderInfo");return I(),D(se,null,[s_,h("div",{class:N(o.container)},[h("div",a_,[h("div",r_,[v(a,{onToolSelected:i.handleToolSelected},null,8,["onToolSelected"])]),h("div",l_,[h("div",c_,[v(r,{activeComponent:o.currentComponent,onUpdatequalitycheck:i.handleUpdateQualityCheck},null,8,["activeComponent","onUpdatequalitycheck"])]),h("div",u_,[v(De,{name:"fade"},{default:R(()=>[(I(),Y(gi(o.currentComponent),{ref:"mainAnalysisComponent"},null,512))]),_:1})]),d_])])],2)],64)}const g_=A(i_,[["render",h_],["__scopeId","data-v-4b2d42a2"]]),f_=[{path:"/",redirect:"/login"},{path:"/login",name:"Login",component:hc},{path:"/home",name:"Home",component:Qm},{path:"/analysis",name:"Analysis",component:g_}],p_=Ja({history:er(),routes:f_});Ql();qt.setResolveCoincidentTopologyToPolygonOffset();qt.setResolveCoincidentTopologyPolygonOffsetParameters(-3,-3);qt.setResolveCoincidentTopologyLineOffsetParameters(-3,-3);Li.setResolveCoincidentTopologyToPolygonOffset();Li.setResolveCoincidentTopologyPolygonOffsetParameters(1,1);vl(Un);const ua=Kr.newInstance({proxyConfiguration:kl}),da=new Pi;da.initialize();const ha=tr();ha.use(Kl({proxies:new Yl(ua),dicomIO:da}));const ut=nr(Zr);Jl(ut);ut.provide("ProxyManager",ua);ut.use(ha);ut.use(or);ut.use(gr);ut.use(ir,{smallLaptop:1200,mediumLaptop:1300,largerLaptop:1400,xLargeLaptop:1600,desktop:1900,_4K:2500});ut.use(p_).mount("#app");
//# sourceMappingURL=index-1f4aa1e2.js.map
