{"version":3,"file":"index-fe362582.js","sources":["../../src/components/App.vue","../../src/components/App.vue","../../src/utils/path.ts","../../src/io/dicom.ts","../../src/io/mimeTypes.ts","../../src/io/magic.ts","../../src/io/io.ts","../../src/io/index.ts","../../src/utils/index.ts","../../src/utils/promise-worker.ts","../../src/io/vtk/async.ts","../../src/io/readers.ts","../../src/vtk/LPSView3DProxy/index.js","../../src/vtk/LPSView2DProxy/index.js","../../src/vtk/IJKSliceRepresentationProxy/index.js","../../src/vtk/LabelMapSliceRepProxy/index.js","../../src/vtk/proxy.js","../../src/vtk/PaintBrushContextRepresentation/index.js","../../src/vtk/PaintWidget/behavior.ts","../../src/vtk/PaintWidget/state.ts","../../src/vtk/PaintWidget/index.js","../../src/core/tools/paint/ellipse-brush.ts","../../src/core/tools/paint/index.ts","../../src/core/provider.ts","../../src/core/proxies.ts","../../src/utils/hacks.ts","../../src/utils/errorReporting.ts","../../src/views/UserLogin.vue","../../src/components/HomeGreetings.vue","../../src/components/PatientElement.vue","../../src/components/LoadingScreen.vue","../../src/components/PatientContainer.vue","../../src/store/id.ts","../../src/utils/lps.ts","../../src/store/tools/types.ts","../../src/types/layout.ts","../../src/io/state-file/schema.ts","../../src/io/import/dataSource.ts","../../src/store/datasets-files.ts","../../src/io/state-file/utils.ts","../../src/store/datasets-images.ts","../../src/store/datasets-dicom.ts","../../src/store/datasets-models.ts","../../src/store/messages.ts","../../src/composables/useErrorMessage.ts","../../src/store/datasets.ts","../../src/core/pipeline.ts","../../src/io/import/processors/handleDicomFile.ts","../../src/utils/fetch.ts","../../src/io/import/processors/downloadUrl.ts","../../src/io/zip.ts","../../src/io/import/common.ts","../../src/io/import/processors/extractArchive.ts","../../src/io/import/processors/extractArchiveTarget.ts","../../src/io/amazonS3.ts","../../src/io/import/processors/handleAmazonS3.ts","../../src/io/googleCloudStorage.ts","../../src/io/import/processors/handleGoogleCloudStorage.ts","../../src/io/import/processors/importSingleFile.ts","../../src/io/manifest.ts","../../src/io/import/processors/remoteManifest.ts","../../src/vtk/LabelMap/index.js","../../src/config.ts","../../src/store/datasets-labelmaps.ts","../../src/io/resample/itkWasmUtils.js","../../src/io/resample/resample.ts","../../src/store/datasets-layers.ts","../../src/composables/useCurrentImage.ts","../../src/store/tools/crop.ts","../../src/vtk/CrosshairsWidget/state.ts","../../src/vtk/CrosshairsWidget/behavior.ts","../../src/vtk/CrosshairsWidget/index.js","../../src/utils/doubleKeyRecord.ts","../../src/store/view-configs/common.ts","../../src/store/view-configs/slicing.ts","../../src/store/view-configs/windowing.ts","../../src/utils/vtk-helpers.ts","../../src/vtk/ColorMaps.ts","../../src/store/view-configs/layers.ts","../../src/store/view-configs/camera.ts","../../src/store/view-configs/volume-coloring.ts","../../src/store/view-configs.ts","../../src/store/views.ts","../../src/store/tools/crosshairs.ts","../../src/store/tools/paint.ts","../../src/utils/frameOfReference.ts","../../src/store/tools/useLabels.ts","../../src/store/tools/useAnnotationTool.ts","../../src/store/tools/rulers.ts","../../src/store/tools/rectangles.ts","../../src/core/contours/referencePlane.ts","../../src/store/tools/contours.ts","../../src/store/tools/index.ts","../../src/io/state-file/index.ts","../../src/io/import/processors/doneWithDataSource.ts","../../src/io/import/processors/updateFileMimeType.ts","../../src/io/import/processors/restoreStateFile.ts","../../src/io/import/processors/handleConfig.ts","../../src/io/import/importDataSources.ts","../../src/components/ToolButton.vue","../../src/components/ItemGroup.vue","../../src/components/GroupableItem.vue","../../src/utils/color.ts","../../src/components/PaintControls.vue","../../src/components/PaintControls.vue","../../src/components/MenuToolButton.vue","../../src/components/MenuToolButton.vue","../../src/components/tools/crop/CropControls.vue","../../src/components/tools/crop/CropControls.vue","../../src/components/LabelEditor.vue","../../src/components/LabelControls.vue","../../src/components/RulerControls.vue","../../src/components/RectangleControls.vue","../../src/components/tools/contour/ContourControls.vue","../../src/components/CheckContoursToolStrip.vue","../../src/components/CheckContoursToolStrip.vue","../../src/composables/manageVTKSubscription.ts","../../src/composables/useResizeToFit.ts","../../src/components/SliceSlider.vue","../../src/components/ViewOverlayGrid.vue","../../src/composables/useResizeObserver.ts","../../src/composables/useVTKCallback.ts","../../src/composables/useOrientationLabels.ts","../../src/composables/useCameraOrientation.ts","../../src/components/tools/WindowLevelTool.vue","../../src/components/tools/SliceScrollTool.vue","../../src/components/tools/MouseManipulatorTool.vue","../../src/components/tools/PanTool.vue","../../src/components/tools/ZoomTool.vue","../../src/vtk/RulerWidget/behavior.ts","../../src/vtk/RulerWidget/pointState.js","../../src/vtk/RulerWidget/state.ts","../../src/vtk/RulerWidget/index.js","../../src/utils/manipulators.ts","../../src/components/tools/ruler/RulerSVG2D.vue","../../src/components/tools/ruler/RulerSVG2D.vue","../../src/components/tools/ruler/RulerWidget2D.vue","../../src/components/tools/ruler/RulerWidget2D.vue","../../src/components/tools/RulerTool.vue","../../src/components/tools/RulerTool.vue","../../src/vtk/RectangleWidget/index.js","../../src/components/tools/rectangle/RectangleSVG2D.vue","../../src/components/tools/rectangle/RectangleSVG2D.vue","../../src/components/tools/rectangle/RectangleWidget2D.vue","../../src/components/tools/rectangle/RectangleWidget2D.vue","../../src/components/tools/RectangleTool.vue","../../src/components/tools/RectangleTool.vue","../../src/vtk/ContourWidget/representation.js","../../src/vtk/ContourWidget/behavior/common.ts","../../src/vtk/ContourWidget/interpolation.ts","../../src/vtk/ContourWidget/behavior/freehand.ts","../../src/vtk/ContourWidget/behavior/select.ts","../../src/core/contours/nudge.ts","../../src/vtk/ContourWidget/behavior/nudge.ts","../../src/vtk/ContourWidget/behavior/pointPlacing.ts","../../src/vtk/ImageMarchingSquares/index.js","../../src/core/contours/threshold.ts","../../src/vtk/ContourLoopExtraction/index.ts","../../src/vtk/TransformPolyDataToPlane/index.ts","../../src/vtk/ContourWidget/behavior/threshold.ts","../../src/vtk/ContourWidget/behavior.ts","../../src/vtk/ContourWidget/state.js","../../src/vtk/ContourWidget/index.js","../../src/components/tools/contour/ContourWidget2D.vue","../../src/components/tools/ContourTool.vue","../../src/components/tools/ContourTool.vue","../../src/components/tools/paint/PaintWidget2D.vue","../../src/components/tools/PaintTool.vue","../../src/components/tools/PaintTool.vue","../../src/composables/useSceneBuilder.ts","../../src/composables/usePersistCameraConfig.ts","../../src/components/tools/crosshairs/CrosshairsWidget2D.vue","../../src/components/tools/crosshairs/CrosshairSVG2D.vue","../../src/components/tools/crosshairs/CrosshairSVG2D.vue","../../src/components/tools/CrosshairsTool.vue","../../src/components/tools/CrosshairsTool.vue","../../src/composables/useViewProxy.ts","../../src/composables/useWidgetManager.ts","../../src/composables/useCurrentSlice.ts","../../src/composables/useVTKWorldToDisplay.ts","../../src/components/tools/crop/Crop2DLineHandle.vue","../../src/components/tools/crop/Crop2DLineHandle.vue","../../src/components/tools/crop/Crop2D.vue","../../src/components/tools/crop/Crop2D.vue","../../src/components/tools/crop/Crop3D.vue","../../src/components/tools/CropTool.vue","../../src/components/tools/CropTool.vue","../../src/composables/proxyManager.ts","../../src/components/VtkTwoView.vue","../../src/components/VtkTwoView.vue","../../src/components/CheckContours.vue","../../src/components/DragAndDrop.vue","../../src/utils/loggers.ts","../../src/composables/useGlobalErrorHook.ts","../../src/composables/onProxyManagerEvent.ts","../../src/composables/useWebGLWatchdog.ts","../../src/composables/useToast.js","../../src/composables/useAppLoadingNotifications.ts","../../src/composables/useKeyboardShortcuts.ts","../../src/components/HandleUpload.vue","../../src/components/AddPatient.vue","../../src/components/FindPatient.vue","../../src/components/LogOut.vue","../../src/views/HomeMain.vue","../../src/components/ToolStrip.vue","../../src/components/ToolStrip.vue","../../src/components/IconNumber.vue","../../src/components/PatientHeaderInfo.vue","../../src/components/AnalysisNavigationBar.vue","../../src/components/StateButtons.vue","../../src/components/ImageBarImageInfo.vue","../../src/components/ImageStripSlider.vue","../../src/components/AddCardiacCycle.vue","../../src/components/VideoTrimmer.vue","../../src/components/ImageBar.vue","../../src/components/IconToggleQA.vue","../../src/components/SquareLoader.vue","../../src/components/SkeletonLoaderCBS.vue","../../src/components/BreathingSplitRow.vue","../../src/components/CheckBreathingSplits.vue","../../src/views/QualityCheck.vue","../../src/components/ReportLogoHolder.vue","../../src/components/ReportDropDown.vue","../../src/components/ReportImageContainer.vue","../../src/components/ReportStrainMaps.vue","../../src/components/ReportTextBox.vue","../../src/components/ReportTextBoxMultiple.vue","../../src/components/ReportHtml.vue","../../src/views/ReportMaker.vue","../../src/components/SimpleGraph.vue","../../src/components/TerritoriesSegments.vue","../../src/components/GraphTerritories.vue","../../src/views/GraphicalAnalysis.vue","../../src/views/MainAnalysis.vue","../../src/router/index.js","../../src/main.js"],"sourcesContent":["<template>\n  <router-view></router-view>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue';\n\n/* These are the components: */\n\nexport default defineComponent({\n  name: 'App',\n  components: {},\n});\n</script>\n","<template>\n  <router-view></router-view>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue';\n\n/* These are the components: */\n\nexport default defineComponent({\n  name: 'App',\n  components: {},\n});\n</script>\n","/**\n * Returns the parent directory of a path.\n * @param path\n * @returns\n */\nexport function dirname(path: string) {\n  const p = path.split(/\\/+/g);\n  p.splice(-1, 1);\n  return p.join('/');\n}\n\n/**\n * Returns the base name of a path.\n * @param path\n * @returns\n */\nexport function basename(path: string) {\n  return path.split(/\\/+/g).at(-1) ?? path;\n}\n\n/**\n * Normalizes a string.\n *\n * \"a//b\" and \"a/b/\" become \"a/b\".\n * @param path\n * @returns\n */\nexport function normalize(path: string) {\n  return path.replace(/\\/+/g, '/').replace(/\\/$/, '');\n}\n\n/**\n * Joins path segments with / and normalizes the result.\n * @param segments\n */\nexport function join(...segments: string[]) {\n  return normalize(segments.join('/'));\n}\n","import { join } from '@/src/utils/path';\nimport {\n  runPipeline,\n  TextStream,\n  InterfaceTypes,\n  readDICOMTags,\n  readImageDICOMFileSeries,\n  Image,\n} from 'itk-wasm';\n\nexport interface TagSpec {\n  name: string;\n  tag: string;\n}\n\nexport type SpatialParameters = Pick<\n  Image,\n  'size' | 'spacing' | 'origin' | 'direction'\n>;\n\n// volume ID => file names\nexport type VolumesToFileNamesMap = Record<string, string[]>;\n\n// volume ID => files\nexport type VolumesToFilesMap = Record<string, File[]>;\n\n/**\n * Filenames must be sanitized prior to being passed into itk-wasm.\n *\n * In particular, forward slashes cause FS errors in itk-wasm.\n * @param name\n * @returns\n */\nfunction sanitizeFileName(name: string) {\n  return name.replace(/\\//g, '_');\n}\n\n/**\n * Returns a new File instance with a sanitized name.\n * @param file\n */\nfunction sanitizeFile(file: File) {\n  return new File([file], sanitizeFileName(file.name));\n}\n\nexport class DICOMIO {\n  private webWorker: any;\n  private initializeCheck: Promise<void> | null;\n\n  constructor() {\n    this.webWorker = null;\n    this.initializeCheck = null;\n  }\n\n  private async runTask(\n    module: string,\n    args: any[],\n    inputs: any[],\n    outputs: any[]\n  ) {\n    return runPipeline(\n      this.webWorker,\n      module,\n      args,\n      outputs,\n      inputs,\n      join(import.meta.env.BASE_URL, '/itk/pipelines'),\n      join(import.meta.env.BASE_URL, '/itk/pipeline.worker.js')\n    );\n  }\n\n  /**\n   * Helper that initializes the webworker.\n   *\n   * @async\n   * @throws Error initialization failed\n   */\n  async initialize() {\n    if (!this.initializeCheck) {\n      this.initializeCheck = new Promise<void>((resolve, reject) => {\n        this.runTask('dicom', [], [], [])\n          .then((result) => {\n            if (result.webWorker) {\n              this.webWorker = result.webWorker;\n            } else {\n              reject(new Error('Could not initialize webworker'));\n            }\n          })\n          .then(async () => {\n            // preload read-dicom-tags pipeline\n            try {\n              await readDICOMTags(this.webWorker, new File([], ''), null);\n            } catch {\n              // ignore\n            }\n            resolve();\n          })\n          .catch(reject);\n      });\n    }\n\n    return this.initializeCheck;\n  }\n\n  /**\n   * Categorize files\n   * @async\n   * @param {File[]} files\n   * @returns volumeID => file names mapping\n   */\n  async categorizeFiles(files: File[]): Promise<VolumesToFilesMap> {\n    await this.initialize();\n\n    const inputs = await Promise.all(\n      files.map(async (file, index) => {\n        const buffer = await file.arrayBuffer();\n        return {\n          type: InterfaceTypes.BinaryFile,\n          data: {\n            path: index.toString(), // make each file name unique\n            data: new Uint8Array(buffer),\n          },\n        };\n      })\n    );\n\n    const args = [\n      '--action',\n      'categorize',\n      '--memory-io',\n      '0',\n      '--files',\n      ...inputs.map((fd) => fd.data.path),\n    ];\n\n    const outputs = [{ type: InterfaceTypes.TextStream }];\n\n    const result = await this.runTask('dicom', args, inputs, outputs);\n\n    // File names are indexes into input files array\n    const volumeToFileIndexes = JSON.parse(\n      (result.outputs[0].data as TextStream).data\n    ) as VolumesToFileNamesMap;\n\n    const volumeToFiles = Object.fromEntries(\n      Object.entries(volumeToFileIndexes).map(([volumeKey, fileIndexes]) => [\n        volumeKey,\n        // file indexes to Files\n        fileIndexes.map((fileIndex) => files[parseInt(fileIndex, 10)]),\n      ])\n    );\n\n    return volumeToFiles;\n  }\n\n  /**\n   * Reads a list of tags out from a given file.\n   *\n   * @param {File} file\n   * @param {[]Tag} tags\n   */\n  async readTags<T extends TagSpec[]>(\n    file: File,\n    tags: T\n  ): Promise<Record<T[number]['name'], string>> {\n    const tagsArgs = tags.map((t) => t.tag);\n\n    const result = await readDICOMTags(\n      this.webWorker,\n      sanitizeFile(file),\n      tagsArgs\n    );\n    const tagValues = result.tags;\n\n    return tags.reduce((info, t) => {\n      const { tag, name } = t;\n      if (tagValues.has(tag)) {\n        return { ...info, [name]: tagValues.get(tag) };\n      }\n      return info;\n    }, {} as Record<T[number]['name'], string>);\n  }\n\n  /**\n   * Retrieves a slice of a volume.\n   * @async\n   * @param {File} file containing the slice\n   * @param {Boolean} asThumbnail cast image to unsigned char. Defaults to false.\n   * @returns ItkImage\n   */\n  async getVolumeSlice(file: File, asThumbnail: boolean = false) {\n    await this.initialize();\n\n    const buffer = await file.arrayBuffer();\n\n    const inputs = [\n      {\n        type: InterfaceTypes.BinaryFile,\n        data: {\n          path: sanitizeFileName(file.name),\n          data: new Uint8Array(buffer),\n        },\n      },\n    ];\n\n    const args = [\n      '--action',\n      'getSliceImage',\n      '--thumbnail',\n      asThumbnail.toString(),\n      '--file',\n      sanitizeFileName(file.name),\n      '--memory-io',\n      '0',\n    ];\n\n    const outputs = [{ type: InterfaceTypes.Image }];\n\n    const result = await this.runTask('dicom', args, inputs, outputs);\n\n    return result.outputs[0].data as Image;\n  }\n\n  async resample(fixed: SpatialParameters, moving: Image) {\n    await this.initialize();\n\n    const { size, spacing, origin, direction } = fixed;\n    const args = [\n      '--action',\n      'resample',\n      '0', // space for input image\n\n      '--size',\n      size.join(','),\n      '--spacing',\n      spacing.join(','),\n      '--origin',\n      origin.join(','),\n      '--direction',\n      direction.join(','),\n\n      '--memory-io',\n      '0',\n    ];\n\n    const inputs = [{ type: InterfaceTypes.Image, data: moving }];\n    const outputs = [{ type: InterfaceTypes.Image }];\n\n    const result = await this.runTask('dicom', args, inputs, outputs);\n    const image = result.outputs[0].data as Image;\n    return image;\n  }\n\n  /**\n   * Builds a volume for a set of files.\n   * @async\n   * @param {File[]} seriesFiles the set of files to build volume from\n   * @returns ItkImage\n   */\n  async buildImage(seriesFiles: File[]) {\n    await this.initialize();\n\n    const result = await readImageDICOMFileSeries(\n      seriesFiles.map((file) => sanitizeFile(file))\n    );\n\n    return result.image;\n  }\n}\n","/**\n * application/vnd.unknown is used as a collective namespace for the purpose\n * of this application only.\n */\nexport const FILE_EXT_TO_MIME: Record<string, string> = {\n  vti: 'application/vnd.unknown.vti',\n  vtp: 'application/vnd.unknown.vtp',\n\n  stl: 'model/stl',\n\n  dcm: 'application/dicom',\n\n  zip: 'application/zip',\n\n  json: 'application/json',\n\n  // itk-wasm supported formats (from extensionToImageIO)\n\n  gipl: 'application/vnd.unknown.gipl',\n  'gipl.gz': 'application/vnd.unknown.gipl',\n\n  hdf5: 'application/x-hdf5',\n\n  jpg: 'image/jpeg',\n  jpeg: 'image/jpeg',\n\n  lsm: 'application/vnd.unknown.lsm',\n\n  mnc: 'application/vnd.unknown.minc',\n  'mnc.gz': 'application/vnd.unknown.minc',\n  mnc2: 'application/vnd.unknown.minc',\n\n  mgh: 'application/vnd.unknown.mgh',\n  mgz: 'application/vnd.unknown.mgh',\n  'mgh.gz': 'application/vnd.unknown.mgh',\n\n  mha: 'application/vnd.unknown.metaimage',\n  mhd: 'application/vnd.unknown.metaimage',\n\n  mrc: 'application/vnd.unknown.mrc',\n\n  nia: 'application/vnd.unknown.nifti-1',\n  nii: 'application/vnd.unknown.nifti-1',\n  'nii.gz': 'application/vnd.unknown.nifti-1',\n  hdr: 'application/vnd.unknown.nifti-1',\n\n  nrrd: 'application/vnd.unknown.nrrd',\n  nhdr: 'application/vnd.unknown.nrrd',\n\n  png: 'image/png',\n\n  pic: 'application/vnd.unknown.biorad',\n\n  tif: 'image/tiff',\n  tiff: 'image/tiff',\n\n  vtk: 'application/vnd.unknown.vtk',\n\n  isq: 'application/vnd.unknown.scanco',\n\n  fdf: 'application/vnd.unknown.fdf',\n};\n\nexport const FILE_EXTENSIONS = new Set(Object.keys(FILE_EXT_TO_MIME));\nexport const MIME_TYPES = new Set(Object.values(FILE_EXT_TO_MIME));\n\n/**\n * Supported archives\n */\nexport const ARCHIVE_FILE_TYPES = new Set(['application/zip']);\n","import { Maybe } from '../types';\n\ninterface MagicDatabase {\n  mime: string;\n  header: number[];\n  skip?: number;\n}\n\n/**\n * file magic database\n * Used to handle certain cases where files have no extension\n */\nconst FILE_MAGIC_DB: MagicDatabase[] = [\n  {\n    mime: 'application/dicom',\n    skip: 128,\n    header: Array.from('DICM').map((c) => c.charCodeAt(0)),\n  },\n];\n\n// How much data to read when extracting file magic.\n// This should be generous enough for most files.\nconst HEAD_CHUNK = 512;\n\nfunction prefixEquals(target: Uint8Array, prefix: number[] | Uint8Array) {\n  if (prefix.length > target.length) {\n    return false;\n  }\n  for (let i = 0; i < prefix.length; i += 1) {\n    if (prefix[i] !== target[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\nexport async function getFileMimeFromMagic(file: File): Promise<Maybe<string>> {\n  return new Promise((resolve) => {\n    const head = file.slice(0, HEAD_CHUNK);\n    const reader = new FileReader();\n    reader.onload = () => {\n      const chunk = new Uint8Array(reader.result! as ArrayBuffer);\n      for (let i = 0; i < FILE_MAGIC_DB.length; i += 1) {\n        const { mime, header, skip = 0 } = FILE_MAGIC_DB[i];\n        if (prefixEquals(chunk.slice(skip), header)) {\n          resolve(mime);\n          return;\n        }\n      }\n      resolve(null);\n    };\n    reader.readAsArrayBuffer(head);\n  });\n}\n","import { FILE_EXTENSIONS, FILE_EXT_TO_MIME, MIME_TYPES } from './mimeTypes';\nimport { Maybe } from '../types';\nimport { getFileMimeFromMagic } from './magic';\n\n/**\n * Determines the file's mime type.\n *\n * Returns the file's mime type for supported mime types.\n */\nexport async function getFileMimeType(file: File): Promise<Maybe<string>> {\n  const fileType = file.type.toLowerCase();\n  if (MIME_TYPES.has(fileType)) {\n    return fileType;\n  }\n\n  if (FILE_EXTENSIONS.has(fileType)) {\n    return FILE_EXT_TO_MIME[fileType];\n  }\n\n  const supportedExt = [...FILE_EXTENSIONS].find((ext) =>\n    file.name.toLowerCase().endsWith(`.${ext}`)\n  );\n  if (supportedExt) {\n    return FILE_EXT_TO_MIME[supportedExt];\n  }\n\n  const mimeFromMagic = await getFileMimeFromMagic(file);\n  if (mimeFromMagic && MIME_TYPES.has(mimeFromMagic)) {\n    return mimeFromMagic;\n  }\n\n  return null;\n}\n\n/**\n * Retypes a given File.\n *\n * Handy for when a file object has no type given.\n * Type is inferred from extension or magic.\n *\n * If type is not supported, file.type will be \"\".\n * @param file\n */\nexport async function retypeFile(file: File): Promise<File> {\n  const type = (await getFileMimeType(file)) ?? '';\n  return new File([file], file.name, { type: type.toLowerCase() });\n}\n\nexport type ReadAsType = 'ArrayBuffer' | 'Text';\n\nasync function readFileAs<T extends ArrayBuffer | string>(\n  file: File,\n  type: ReadAsType\n): Promise<T> {\n  return new Promise((resolve) => {\n    const fio = new globalThis.FileReader();\n    fio.onload = () => resolve(fio.result as T);\n    if (type === 'ArrayBuffer') {\n      fio.readAsArrayBuffer(file);\n    } else if (type === 'Text') {\n      fio.readAsText(file);\n    } else {\n      throw new TypeError(`readAs${type} is not a function`);\n    }\n  });\n}\n\n/**\n * Reads a file and returns an ArrayBuffer\n * @async\n * @param {File} file\n */\nexport async function readFileAsArrayBuffer(file: File) {\n  return readFileAs<ArrayBuffer>(file, 'ArrayBuffer');\n}\n\n/**\n * Reads a file and returns UTF-8 text\n * @async\n * @param {File} file\n */\nexport async function readFileAsUTF8Text(file: File) {\n  return readFileAs<string>(file, 'Text');\n}\n","import type { vtkObject } from '@kitware/vtk.js/interfaces';\n\nexport * from './io';\n\nexport type ReaderType = (file: File) => vtkObject | Promise<vtkObject>;\nexport type FileReaderMap = Map<string, ReaderType>;\n\n/**\n * A map of the currently registered file readers.\n *\n * Maps mime type to reader.\n */\nexport const FILE_READERS: FileReaderMap = new Map();\n","import { URL } from 'whatwg-url';\nimport { TypedArray } from 'itk-wasm';\nimport { EPSILON } from '../constants';\nimport { Maybe } from '../types';\n\nexport function identity<T>(arg: T) {\n  return arg;\n}\n\n/**\n * Percent is in [0, 1]. If it's Infinity, then the progress is indeterminate.\n */\nexport type ProgressCallback = (percent: number) => void;\n\nexport async function fetchFileWithProgress(\n  url: string,\n  name: string,\n  progress: ProgressCallback,\n  options: RequestInit | undefined\n): Promise<File | null> {\n  const response = await fetch(url, options);\n  const contentLength = Number(response.headers.get('content-length')) || 0;\n\n  if (contentLength <= 0) {\n    progress(Infinity);\n\n    const blob = await response.blob();\n    return new File([blob], name);\n  }\n\n  const reader = response.body?.getReader();\n  if (!reader) {\n    return null;\n  }\n\n  const bytes = new Uint8Array(contentLength);\n  let recv = 0;\n  let done = false;\n  do {\n    // eslint-disable-next-line no-await-in-loop\n    const readData = await reader.read();\n    done = readData.done;\n    if (readData.value && !done) {\n      bytes.set(readData.value, recv);\n      recv += readData.value.length;\n      progress(recv / contentLength);\n    }\n  } while (!done);\n\n  return new File([bytes], name);\n}\n\nexport const isFulfilled = <T>(\n  input: PromiseSettledResult<T>\n): input is PromiseFulfilledResult<T> => input.status === 'fulfilled';\n\ntype PromiseResolveFunction<T> = (value: T) => void;\ntype PromiseRejectFunction = (reason?: Error) => void;\nexport interface Deferred<T> {\n  promise: Promise<T>;\n  resolve: PromiseResolveFunction<T>;\n  reject: PromiseRejectFunction;\n}\n\nexport function defer<T>(): Deferred<T> {\n  let innerResolve: PromiseResolveFunction<T> | null = null;\n  let innerReject: PromiseRejectFunction | null = null;\n\n  const resolve = (value: T) => {\n    if (innerResolve) innerResolve(value);\n  };\n  const reject = (reason?: Error) => {\n    if (innerReject) innerReject(reason);\n  };\n\n  const promise = new Promise<T>((res, rej) => {\n    innerResolve = res;\n    innerReject = rej;\n  });\n\n  return { promise, resolve, reject };\n}\n\nexport function removeFromArray<T>(arr: Array<T>, el: T) {\n  const idx = arr.indexOf(el);\n  if (idx > -1) {\n    arr.splice(idx, 1);\n  }\n}\n\nexport function clampValue(value: number, min: number, max: number) {\n  return Math.min(max, Math.max(min, value));\n}\n\nexport function pick<T, K extends keyof T>(obj: T, ...keys: K[]): Pick<T, K> {\n  return keys.reduce((o, k) => ({ ...o, [k]: obj[k] }), {} as Pick<T, K>);\n}\n\nexport const pluck =\n  <T, K extends keyof T>(key: K) =>\n  (obj: T): T[K] =>\n    obj[key];\n\n/**\n * Takes a predicate and a list of values and returns a a tuple (2-item array),\n *  with each item containing the subset of the list that matches the predicate\n *  and the complement of the predicate respectively\n *\n * @sig (T -> Boolean, T[]) -> [T[], T[]]\n *\n * @param {Function} predicate A predicate to determine which side the element belongs to.\n * @param {Array} arr The list to partition\n *\n * Inspired by the Ramda function of the same name\n * @see https://ramdajs.com/docs/#partition\n *\n * @example\n *\n *     const isNegative: (n: number) => boolean = n => n < 0\n *     const numbers = [1, 2, -4, -7, 4, 22]\n *     partition(isNegative, numbers)\n *     // => [ [-4, -7], [1, 2, 4, 22] ]\n *\n * Source https://gist.github.com/zachlysobey/71ac85046d0d533287ed85e1caa64660\n */\nexport function partition<T>(\n  predicate: (val: T) => boolean,\n  arr: Array<T>\n): [Array<T>, Array<T>] {\n  const partitioned: [Array<T>, Array<T>] = [[], []];\n  arr.forEach((val: T) => {\n    const partitionIndex: 0 | 1 = predicate(val) ? 0 : 1;\n    partitioned[partitionIndex].push(val);\n  });\n  return partitioned;\n}\n\nexport const chunk = <T>(arr: T[], size: number) =>\n  Array.from({ length: Math.ceil(arr.length / size) }, (_: any, i: number) =>\n    arr.slice(i * size, i * size + size)\n  );\n\nexport function plural(n: number, word: string, pluralWord?: string) {\n  return n > 1 ? pluralWord ?? `${word}s` : word;\n}\n\nexport const ensureDefault = <T>(\n  key: string,\n  records: Record<string, T>,\n  default_: T\n) => {\n  if (!(key in records)) {\n    // eslint-disable-next-line no-param-reassign\n    records[key] = default_;\n  }\n\n  return records[key];\n};\n\ntype ArrayLike<T> = T extends unknown[] ? T : T extends TypedArray ? T : never;\nexport function arrayEquals<T>(a: ArrayLike<T>, b: ArrayLike<T>) {\n  if (a.length !== b.length) return false;\n  for (let i = 0; i < a.length; i++) {\n    if (a[i] !== b[i]) return false;\n  }\n  return true;\n}\n\ntype ComparatorFunction<T> = (a: T, b: T) => boolean;\nexport function arrayEqualsWithComparator<T>(\n  a: T[],\n  b: T[],\n  cmp: ComparatorFunction<T>\n) {\n  if (a.length !== b.length) return false;\n  for (let i = 0; i < a.length; i++) {\n    if (!cmp(a[i], b[i])) return false;\n  }\n  return true;\n}\n\n/**\n * Wraps non-arrays in an array.\n * @param maybeArray\n */\nexport function wrapInArray<T>(maybeArray: T | T[]): T[] {\n  return Array.isArray(maybeArray) ? maybeArray : [maybeArray];\n}\n\n/**\n * Extracts the basename from a URL.\n */\nexport function getURLBasename(url: string) {\n  return new URL(url, window.location.href).pathname.split('/').at(-1) ?? '';\n}\n\n// from https://stackoverflow.com/a/18650828\nexport function formatBytes(bytes: number, decimals = 2) {\n  if (!+bytes) return '0 Bytes';\n\n  const k = 1024;\n  const dm = decimals < 0 ? 0 : decimals;\n  const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\n\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n\n  return `${parseFloat((bytes / k ** i).toFixed(dm))} ${sizes[i]}`;\n}\n\nexport function roundIfCloseToInteger(value: number, eps = EPSILON) {\n  const rounded = Math.round(value);\n  if (Math.abs(rounded - value) <= eps) {\n    return rounded;\n  }\n  return value;\n}\n\nexport function hasKey<O extends Object>(\n  obj: O,\n  key: PropertyKey\n): key is keyof O {\n  return key in obj;\n}\n\nexport function remapKeys<O extends Object, K extends keyof O>(\n  obj: O,\n  keyMap: Record<K, K>\n) {\n  return Object.fromEntries(\n    Object.entries(obj).map(([key, value]) => {\n      if (hasKey(keyMap, key)) return [keyMap[key], value];\n      throw new Error(`Key ${key} not found in keyMap`);\n    })\n  );\n}\n\n// return object without the given keys\nexport const omit = <T extends Record<string, unknown>, K extends keyof T>(\n  obj: T,\n  keys: K[] | K\n) =>\n  Object.fromEntries(\n    Object.entries(obj).filter(([key]) => !wrapInArray(keys).includes(key as K))\n  ) as Omit<T, K>;\n\nexport function ensureError(e: unknown) {\n  return e instanceof Error ? e : new Error(JSON.stringify(e));\n}\n\n// remove undefined properties\nexport function cleanUndefined(obj: Object) {\n  return Object.entries(obj).reduce(\n    (cleaned, [key, value]) =>\n      value === undefined ? cleaned : { ...cleaned, [key]: value },\n    {}\n  );\n}\n\n// converts named colors (red, antiquewhite, etc) to hex\nexport function standardizeColor(color: Maybe<string>) {\n  if (!color) return '#ffffff';\n  const ctx = document.createElement('canvas').getContext('2d');\n  if (!ctx) throw new Error('Could not create canvas context');\n  ctx.fillStyle = color;\n  return ctx.fillStyle;\n}\n","/* eslint-disable */\nimport { defer, Deferred } from './index';\n\n// to be used to instantiate a worker\nexport default class PromiseWorker {\n  private msgID: number;\n  private worker: Worker;\n  private waiting: Record<string, Deferred<any>>;\n\n  constructor(worker: Worker) {\n    this.msgID = 0;\n    this.worker = worker;\n    this.waiting = {};\n\n    this.worker.onmessage = this.handleMessage.bind(this);\n  }\n\n  postMessage(message: any, transferables: any[] = []) {\n    const wrappedMsg = {\n      id: this.msgID,\n      message,\n    };\n\n    const deferred = defer();\n    this.waiting[wrappedMsg.id] = deferred;\n\n    this.worker.postMessage(wrappedMsg, transferables);\n\n    this.msgID += 1;\n    return deferred.promise;\n  }\n\n  handleMessage(ev: any) {\n    const { id, error, message } = ev.data;\n    if (id in this.waiting) {\n      const deferred = this.waiting[id];\n      delete this.waiting[id];\n      if (error) {\n        deferred.reject(new Error(error));\n      } else {\n        deferred.resolve(message);\n      }\n    }\n  }\n}\n","import vtk from '@kitware/vtk.js/vtk';\n\nimport PromiseWorker from '@/src/utils/promise-worker';\nimport vtkDataSet from '@kitware/vtk.js/Common/DataModel/DataSet';\nimport { vtkObject } from '@kitware/vtk.js/interfaces';\nimport { StateObject } from './common';\n\ninterface SuccessReadResult {\n  status: 'success';\n  obj: StateObject;\n}\n\ninterface FailResult {\n  status: 'fail';\n  error: Error;\n}\n\ntype ReadResult = SuccessReadResult | FailResult;\n\nexport const runAsyncVTKReader = (readerName: string) => async (file: File) => {\n  const worker = new PromiseWorker(\n    new Worker(new URL('./async.reader.worker.ts', import.meta.url), {\n      type: 'module',\n    })\n  );\n  const data = (await worker.postMessage({\n    file,\n    readerName,\n  })) as ReadResult;\n  if (data.status === 'success') {\n    return vtk(data.obj) as vtkObject;\n  }\n  throw data.error;\n};\n\ninterface SuccessWriteResult {\n  status: 'success';\n  data: string;\n}\ntype WriteResult = SuccessWriteResult | FailResult;\n\nexport const runAsyncVTKWriter =\n  (writerName: string) => async (dataSet: vtkDataSet) => {\n    const worker = new PromiseWorker(\n      new Worker(new URL('./async.writer.worker.ts', import.meta.url), {\n        type: 'module',\n      })\n    );\n    const result = (await worker.postMessage({\n      obj: dataSet.getState(),\n      writerName,\n    })) as WriteResult;\n    if (result.status === 'success') {\n      return result.data;\n    }\n    throw result.error;\n  };\n\nexport const stlReader = runAsyncVTKReader('stl');\nexport const vtiReader = runAsyncVTKReader('vti');\nexport const vtpReader = runAsyncVTKReader('vtp');\nexport const vtiWriter = runAsyncVTKWriter('vti');\n","import vtkITKImageReader from '@kitware/vtk.js/IO/Misc/ITKImageReader';\nimport { readImageArrayBuffer, extensionToImageIO } from 'itk-wasm';\nimport { FileReaderMap } from '.';\n\nimport { readFileAsArrayBuffer } from './io';\nimport { stlReader, vtiReader, vtpReader } from './vtk/async';\nimport { FILE_EXT_TO_MIME } from './mimeTypes';\n\nexport const ITK_IMAGE_MIME_TYPES = Array.from(\n  new Set(\n    Array.from(extensionToImageIO.keys()).map(\n      (ext) => FILE_EXT_TO_MIME[ext.toLowerCase()]\n    )\n  )\n);\n\nvtkITKImageReader.setReadImageArrayBufferFromITK(readImageArrayBuffer);\n\nasync function itkReader(file: File) {\n  const fileBuffer = await readFileAsArrayBuffer(file);\n\n  const reader = vtkITKImageReader.newInstance();\n  reader.setFileName(file.name);\n  try {\n    await reader.parseAsArrayBuffer(fileBuffer);\n  } catch (e) {\n    // itkreader doesn't give us a meaningful error\n    throw new Error('Failed to parse file');\n  }\n\n  return reader.getOutputData();\n}\n\n/**\n * Resets the file reader map to the default values.\n */\nexport function registerAllReaders(readerMap: FileReaderMap) {\n  readerMap.set('application/vnd.unknown.vti', vtiReader);\n  readerMap.set('application/vnd.unknown.vtp', vtpReader);\n  readerMap.set('model/stl', stlReader);\n\n  ITK_IMAGE_MIME_TYPES.forEach((mime) => {\n    readerMap.set(mime, itkReader);\n  });\n}\n","import { vec3 } from 'gl-matrix';\nimport macro from '@kitware/vtk.js/macro';\nimport vtkViewProxy from '@kitware/vtk.js/Proxy/Core/ViewProxy';\n\nexport function commonViewCustomizations(publicAPI, model) {\n  const delayedRender = macro.debounce(model.renderWindow.render, 5);\n\n  // override resize to avoid flickering from rendering later\n  publicAPI.resize = () => {\n    if (model.container) {\n      const dims = model.container.getBoundingClientRect();\n      if (dims.width === dims.height && dims.width === 0) {\n        return;\n      }\n      const devicePixelRatio = window.devicePixelRatio || 1;\n      const width = Math.max(10, Math.floor(devicePixelRatio * dims.width));\n      const height = Math.max(10, Math.floor(devicePixelRatio * dims.height));\n      model.renderWindow.getViews()[0].setSize(width, height);\n      publicAPI.invokeResize({ width, height });\n      publicAPI.render(true);\n    }\n  };\n\n  // override render to not reset camera\n  publicAPI.render = (blocking = true) => {\n    model.orientationWidget.updateMarkerOrientation();\n    if (blocking) {\n      model.renderWindow.render();\n    } else {\n      delayedRender();\n    }\n  };\n\n  // provide a renderLater impl that schedules for the next js task\n  let timeout = null;\n  publicAPI.renderLater = () => {\n    if (timeout != null) return;\n    timeout = setTimeout(() => {\n      publicAPI.render();\n      timeout = null;\n    }, 0);\n  };\n\n  // add helper function\n  publicAPI.removeAllRepresentations = () => {\n    model.representations.forEach((rep) => model.renderer.removeViewProp(rep));\n    model.representations.length = 0;\n  };\n\n  publicAPI.updateCamera = (directionOfProjection, viewUp, focalPoint) => {\n    const position = vec3.clone(focalPoint);\n    vec3.sub(position, position, directionOfProjection);\n    model.camera.setFocalPoint(...focalPoint);\n    model.camera.setPosition(...position);\n    model.camera.setDirectionOfProjection(...directionOfProjection);\n    model.camera.setViewUp(...viewUp);\n  };\n\n  // disable the built-in corner annotations\n  const { setContainer } = publicAPI;\n  publicAPI.setContainer = (el) => {\n    setContainer(el);\n    model.cornerAnnotation.setContainer(null);\n  };\n\n  const { resetCamera } = publicAPI;\n  publicAPI.resetCamera = (...args) => {\n    resetCamera(args);\n    model.renderer.updateLightsGeometryToFollowCamera();\n  };\n}\n\nfunction vtkLPSView3DProxy(publicAPI, model) {\n  model.classHierarchy.push('vtkLPSView3DProxy');\n  commonViewCustomizations(publicAPI, model);\n}\n\nexport function extend(publicAPI, model, initialValues = {}) {\n  Object.assign(model, initialValues);\n\n  vtkViewProxy.extend(publicAPI, model, initialValues);\n\n  vtkLPSView3DProxy(publicAPI, model);\n}\n\nexport const newInstance = macro.newInstance(extend, 'vtkLPSView3DProxy');\n\nexport default { newInstance, extend };\n","import macro from '@kitware/vtk.js/macro';\nimport vtkView2DProxy from '@kitware/vtk.js/Proxy/Core/View2DProxy';\n\nimport { commonViewCustomizations } from '@/src/vtk/LPSView3DProxy';\n\nfunction vtkLPSView2DProxy(publicAPI, model) {\n  model.classHierarchy.push('vtkLPSView2DProxy');\n  const superClass = { ...publicAPI };\n\n  commonViewCustomizations(publicAPI, model);\n\n  // override; we will set the manipulator ourselves\n  publicAPI.bindRepresentationToManipulator = () => {};\n\n  // override reset camera to /just/ reset the camera\n  publicAPI.resetCamera = (boundsToUse = null) => {\n    model.renderer.resetCamera(boundsToUse);\n  };\n\n  // override addRepresentation\n  publicAPI.addRepresentation = (rep) => {\n    if (!rep) {\n      return;\n    }\n    if (model.representations.indexOf(rep) === -1) {\n      model.representations.push(rep);\n      model.renderer.addViewProp(rep);\n    }\n\n    if (rep.setSlicingMode && model.slicingMode) {\n      rep.setSlicingMode(model.slicingMode);\n    }\n  };\n\n  publicAPI.setSlicingMode = (mode) => {\n    model.axis = 'IJK'.indexOf(mode);\n    if (superClass.setSlicingMode(mode) && mode) {\n      let count = model.representations.length;\n      while (count--) {\n        const rep = model.representations[count];\n        if (rep.setSlicingMode) {\n          rep.setSlicingMode(mode);\n        }\n      }\n    }\n  };\n\n  publicAPI.resizeToFit = (lookAxis, viewUpAxis, dims) => {\n    const [w, h] = model.renderWindow.getViews()[0].getSize();\n    let bw;\n    let bh;\n    if (lookAxis === 0 && viewUpAxis === 1) {\n      [, bh, bw] = dims;\n    } else if (lookAxis === 0 && viewUpAxis === 2) {\n      [, bw, bh] = dims;\n    } else if (lookAxis === 1 && viewUpAxis === 0) {\n      [bh, , bw] = dims;\n    } else if (lookAxis === 1 && viewUpAxis === 2) {\n      [bw, , bh] = dims;\n    } else if (lookAxis === 2 && viewUpAxis === 0) {\n      [bh, bw] = dims;\n    } else if (lookAxis === 2 && viewUpAxis === 1) {\n      [bw, bh] = dims;\n    }\n\n    const viewAspect = w / h;\n    const boundsAspect = bw / bh;\n    let scale = 0;\n    if (viewAspect >= boundsAspect) {\n      scale = bh / 2;\n    } else {\n      scale = bw / 2 / viewAspect;\n    }\n\n    model.camera.setParallelScale(scale);\n  };\n}\n\nconst DEFAULT_VALUES = {\n  slicingMode: null, // XYZIJK. Null means fallback to model.axis.\n};\n\nexport function extend(publicAPI, model, initialValues = {}) {\n  Object.assign(model, initialValues, DEFAULT_VALUES);\n\n  // slicing mode overrides axis\n  macro.setGet(publicAPI, model, ['slicingMode']);\n\n  vtkView2DProxy.extend(publicAPI, model, initialValues);\n\n  vtkLPSView2DProxy(publicAPI, model);\n}\n\nexport const newInstance = macro.newInstance(extend, 'vtkLPSView2DProxy');\n\nexport default { newInstance, extend };\n","import macro from '@kitware/vtk.js/macro';\n\nimport vtkSliceRepresentationProxy from '@kitware/vtk.js/Proxy/Representations/SliceRepresentationProxy';\n\nconst SLICE_MODE_MAP = {\n  X: 'I',\n  Y: 'J',\n  Z: 'K',\n  I: 'I',\n  J: 'J',\n  K: 'K',\n};\n\nfunction vtkIJKSliceRepresentationProxy(publicAPI, model) {\n  model.classHierarchy.push('vtkIJKSliceRepresentationProxy');\n\n  const superClass = { ...publicAPI };\n\n  // pretend XYZ slicing is actually just IJK.\n  publicAPI.setSlicingMode = (modeString) => {\n    return superClass.setSlicingMode(SLICE_MODE_MAP[modeString]);\n  };\n}\n\n// ----------------------------------------------------------------------------\n// Object factory\n// ----------------------------------------------------------------------------\n\nconst DEFAULT_VALUES = {};\n\n// ----------------------------------------------------------------------------\n\nexport function extend(publicAPI, model, initialValues = {}) {\n  Object.assign(model, DEFAULT_VALUES, initialValues);\n\n  // Object methods\n  vtkSliceRepresentationProxy.extend(publicAPI, model);\n\n  macro.proxyPropertyMapping(publicAPI, model, {\n    opacity: { modelKey: 'property', property: 'opacity' },\n  });\n\n  // Object specific methods\n  vtkIJKSliceRepresentationProxy(publicAPI, model);\n}\n\n// ----------------------------------------------------------------------------\n\nexport const newInstance = macro.newInstance(\n  extend,\n  'vtkIJKSliceRepresentationProxy'\n);\n\n// ----------------------------------------------------------------------------\n\nexport default { newInstance, extend };\n","import macro from '@kitware/vtk.js/macro';\nimport vtkColorTransferFunction from '@kitware/vtk.js/Rendering/Core/ColorTransferFunction';\nimport vtkPiecewiseFunction from '@kitware/vtk.js/Common/DataModel/PiecewiseFunction';\nimport ImagePropertyConstants from '@kitware/vtk.js/Rendering/Core/ImageProperty/Constants';\n\nimport vtkIJKSliceRepresentationProxy from '../IJKSliceRepresentationProxy';\n\nconst { InterpolationType } = ImagePropertyConstants;\n\n// ----------------------------------------------------------------------------\n// vtkLabelMapSliceRepProxy methods\n// ----------------------------------------------------------------------------\n\nfunction vtkLabelMapSliceRepProxy(publicAPI, model) {\n  // Set our className\n  model.classHierarchy.push('vtkLabelMapSliceRepProxy');\n\n  let labelMapSub = null;\n\n  // needed for vtk.js >= 23.0.0\n  model.property.setUseLookupTableScalarRange(true);\n  model.property.setInterpolationType(InterpolationType.NEAREST);\n  model.mapper.setRelativeCoincidentTopologyPolygonOffsetParameters(-2, -2);\n\n  let cachedColorMap = null;\n\n  function updateTransferFunctions(labelmap) {\n    const colorMap = labelmap.getColorMap();\n    if (colorMap === cachedColorMap) {\n      return;\n    }\n    // Cache the colormap using ref equality. This will\n    // avoid updating the colormap unnecessarily.\n    cachedColorMap = colorMap;\n\n    const cfun = vtkColorTransferFunction.newInstance();\n    const ofun = vtkPiecewiseFunction.newInstance();\n\n    Object.keys(colorMap).forEach((label) => {\n      const l = Number(label);\n      cfun.addRGBPoint(l, ...colorMap[label].slice(0, 3).map((c) => c / 255));\n      ofun.addPoint(l, colorMap[label][3] / 255);\n    });\n\n    model.property.setRGBTransferFunction(cfun);\n    model.property.setScalarOpacity(ofun);\n  }\n\n  function setInputData(labelmap) {\n    if (labelMapSub) {\n      labelMapSub.unsubscribe();\n      labelMapSub = null;\n    }\n\n    if (labelmap) {\n      labelMapSub = labelmap.onModified(() =>\n        updateTransferFunctions(labelmap)\n      );\n      updateTransferFunctions(labelmap);\n    }\n  }\n\n  // override because we manage our own color/opacity functions\n  publicAPI.setColorBy = () => {};\n\n  publicAPI.delete = macro.chain(publicAPI.delete, () => {\n    if (labelMapSub) {\n      labelMapSub.unsubscribe();\n      labelMapSub = null;\n    }\n  });\n\n  // Keep things updated\n  model.sourceDependencies.push({ setInputData });\n}\n\n// ----------------------------------------------------------------------------\n// Object factory\n// ----------------------------------------------------------------------------\n\nconst DEFAULT_VALUES = {};\n\n// ----------------------------------------------------------------------------\n\nexport function extend(publicAPI, model, initialValues = {}) {\n  Object.assign(model, DEFAULT_VALUES, initialValues);\n\n  // Object methods\n  vtkIJKSliceRepresentationProxy.extend(publicAPI, model);\n\n  // Object specific methods\n  vtkLabelMapSliceRepProxy(publicAPI, model);\n}\n\n// ----------------------------------------------------------------------------\n\nexport const newInstance = macro.newInstance(\n  extend,\n  'vtkLabelMapSliceRepProxy'\n);\n\n// ----------------------------------------------------------------------------\n\nexport default { newInstance, extend };\n","import vtkLookupTableProxy from '@kitware/vtk.js/Proxy/Core/LookupTableProxy';\nimport vtkPiecewiseFunctionProxy from '@kitware/vtk.js/Proxy/Core/PiecewiseFunctionProxy';\n\nimport vtkSourceProxy from '@kitware/vtk.js/Proxy/Core/SourceProxy';\n\nimport vtkVolumeRepresentationProxy from '@kitware/vtk.js/Proxy/Representations/VolumeRepresentationProxy';\nimport vtkGeometryRepresentationProxy from '@kitware/vtk.js/Proxy/Representations/GeometryRepresentationProxy';\n\nimport vtkLPSView3DProxy from '@/src/vtk/LPSView3DProxy';\nimport vtkLPSView2DProxy from '@/src/vtk/LPSView2DProxy';\nimport vtkIJKSliceRepresentationProxy from '@/src/vtk/IJKSliceRepresentationProxy';\nimport vtkLabelMapSliceRepProxy from '@/src/vtk/LabelMapSliceRepProxy';\n\nfunction createProxyDefinition(\n  classFactory,\n  ui = [],\n  links = [],\n  definitionOptions = {},\n  props = {}\n) {\n  return {\n    class: classFactory,\n    options: { links, ui, ...definitionOptions },\n    props,\n  };\n}\n\nfunction createDefaultView(classFactory, options = [], props = {}) {\n  return createProxyDefinition(classFactory, [], [], options, props);\n}\n\n// ----------------------------------------------------------------------------\n\nexport default {\n  definitions: {\n    Proxy: {\n      LookupTable: createProxyDefinition(vtkLookupTableProxy, [], [], {\n        presetName: 'Default (Cool to Warm)',\n      }),\n      PiecewiseFunction: createProxyDefinition(vtkPiecewiseFunctionProxy),\n    },\n    Sources: {\n      TrivialProducer: createProxyDefinition(vtkSourceProxy),\n    },\n    Representations: {\n      ImageSlice: createProxyDefinition(vtkIJKSliceRepresentationProxy),\n      LabelMapSlice: createProxyDefinition(vtkLabelMapSliceRepProxy),\n      Volume: createProxyDefinition(vtkVolumeRepresentationProxy),\n      Geometry: createProxyDefinition(vtkGeometryRepresentationProxy),\n    },\n    Views: {\n      View3D: createDefaultView(vtkLPSView3DProxy),\n      View2D: createDefaultView(vtkLPSView2DProxy),\n    },\n  },\n  representations: {\n    View3D: {\n      vtkImageData: { name: 'Volume' },\n      vtkPolyData: { name: 'Geometry' },\n    },\n    View2D: {\n      vtkImageData: { name: 'ImageSlice' },\n      vtkLabelMap: { name: 'LabelMapSlice' },\n    },\n  },\n};\n","import vtkPolyData from '@kitware/vtk.js/Common/DataModel/PolyData';\nimport vtkActor2D from '@kitware/vtk.js/Rendering/Core/Actor2D';\nimport vtkContextRepresentation from '@kitware/vtk.js/Widgets/Representations/ContextRepresentation';\nimport vtkWidgetRepresentation from '@kitware/vtk.js/Widgets/Representations/WidgetRepresentation';\nimport macro from '@kitware/vtk.js/macros';\nimport vtkMapper2D from '@kitware/vtk.js/Rendering/Core/Mapper2D';\nimport vtkCoordinate from '@kitware/vtk.js/Rendering/Core/Coordinate';\nimport { Coordinate } from '@kitware/vtk.js/Rendering/Core/Coordinate/Constants';\nimport { Representation } from '@kitware/vtk.js/Rendering/Core/Property/Constants';\nimport { DisplayLocation } from '@kitware/vtk.js/Rendering/Core/Property2D/Constants';\nimport { vec3 } from 'gl-matrix';\n\nfunction generateContour({ stencil, location, slicingIndex, indexToWorld }) {\n  const [xdim, ydim] = stencil.size;\n  const xoffset = Math.floor((xdim - 1) / 2);\n  const yoffset = Math.floor((ydim - 1) / 2);\n\n  // grid of corner points (top-left to bottom-right)\n  const gridxdim = xdim + 1;\n  const gridydim = ydim + 1;\n\n  const vertices = []; // arr of 3-tuples\n  const lines = []; // arr of 2-tuples of vertex indices\n\n  // maps grid x/y to vertex index\n  const vertexMap = {};\n  const getOrCreateVertexIndex = (x, y) => {\n    const key = `${x},${y}`;\n    if (key in vertexMap) {\n      return vertexMap[key];\n    }\n\n    const indexCoords = [...location].map((val) => Math.round(val));\n    if (slicingIndex === 0) {\n      indexCoords[1] += x - xoffset - 0.5;\n      indexCoords[2] += y - yoffset - 0.5;\n    } else if (slicingIndex === 1) {\n      indexCoords[0] += x - xoffset - 0.5;\n      indexCoords[2] += y - yoffset - 0.5;\n    } else if (slicingIndex === 2) {\n      indexCoords[0] += x - xoffset - 0.5;\n      indexCoords[1] += y - yoffset - 0.5;\n    }\n\n    // get the grid point x/y's actual vertex in world space\n    // since grid x/y represents the top-left of the actual pixel\n    // at x/y, the true continuous index value of the vertex\n    // is x-0.5/y-0.5.\n\n    const worldCoords = [];\n    vec3.transformMat4(worldCoords, indexCoords, indexToWorld);\n    vertices.push(worldCoords);\n\n    const index = vertices.length - 1;\n    vertexMap[key] = index;\n    return index;\n  };\n\n  const getStampPixelAt = (x, y) => {\n    if (x < 0 || x >= xdim) return 0;\n    if (y < 0 || y >= ydim) return 0;\n    return stencil.pixels[y * xdim + x] || 0;\n  };\n\n  for (let gy = 0; gy < gridydim; gy++) {\n    for (let gx = 0; gx < gridxdim; gx++) {\n      // evaluate point to see if it needs inclusion\n      // by looking at all 4 pixels that share this point\n      // as a corner.\n      // if all empty or all filled, the current point is\n      // not used in the contour.\n      const count =\n        getStampPixelAt(gx, gy) +\n        getStampPixelAt(gx - 1, gy) +\n        getStampPixelAt(gx, gy - 1) +\n        getStampPixelAt(gx - 1, gy - 1);\n\n      if (count > 0 && count < 4) {\n        const v0 = getOrCreateVertexIndex(gx, gy);\n\n        // now do line check. We look at the east and south lines.\n        // east first\n        if (getStampPixelAt(gx, gy) !== getStampPixelAt(gx, gy - 1)) {\n          const v1 = getOrCreateVertexIndex(gx + 1, gy);\n          lines.push([v0, v1]);\n        }\n        // south next\n        if (getStampPixelAt(gx, gy) !== getStampPixelAt(gx - 1, gy)) {\n          const v1 = getOrCreateVertexIndex(gx, gy + 1);\n          lines.push([v0, v1]);\n        }\n      }\n    }\n  }\n\n  return {\n    points: new Float32Array(vertices.flat()),\n    lines: new Uint16Array(lines.map(([v0, v1]) => [2, v0, v1]).flat()),\n  };\n}\n\nfunction vtkPaintBrushContextRepresentation(publicAPI, model) {\n  model.classHierarchy.push('vtkPaintBrushContextRepresentation');\n\n  model.internalPolyData = vtkPolyData.newInstance({ mtime: 0 });\n  model.internalArrays = {\n    points: model.internalPolyData.getPoints(),\n    lines: model.internalPolyData.getLines(),\n  };\n\n  model.pipelines = {\n    brush: {\n      source: publicAPI,\n      mapper: vtkMapper2D.newInstance({\n        transformCoordinate: vtkCoordinate.newInstance({\n          coordinateSystem: Coordinate.WORLD,\n        }),\n      }),\n      actor: vtkActor2D.newInstance({ pickable: false, parentProp: publicAPI }),\n    },\n  };\n\n  const actorProperty = model.pipelines.brush.actor.getProperty();\n  actorProperty.setLineWidth(2);\n  actorProperty.setColor([1, 0, 0]);\n  actorProperty.setDisplayLocation(DisplayLocation.FOREGROUND);\n  actorProperty.setRepresentation(Representation.SURFACE);\n\n  vtkWidgetRepresentation.connectPipeline(model.pipelines.brush);\n\n  publicAPI.addActor(model.pipelines.brush.actor);\n\n  publicAPI.requestData = (inData, outData) => {\n    const widgetState = inData[0];\n\n    const stencil = widgetState.getStencil();\n    const brush = widgetState.getBrush();\n    const { indexToWorld, worldToIndex } = model;\n\n    if (stencil && brush.getOrigin()) {\n      const location = [];\n      vec3.transformMat4(location, brush.getOrigin(), worldToIndex);\n\n      const contour = generateContour({\n        stencil,\n        location,\n        slicingIndex: model.slicingIndex,\n        indexToWorld,\n      });\n\n      const { points, lines } = model.internalArrays;\n      points.setData(contour.points);\n      lines.setData(contour.lines);\n\n      model.internalPolyData.modified();\n    }\n    outData[0] = model.internalPolyData;\n  };\n}\n\nconst DEFAULT_VALUES = {\n  defaultScale: 1,\n  drawBorder: false,\n  drawFace: true,\n  worldToIndex: null,\n  indexToWorld: null,\n  slicingIndex: 0,\n};\n\n// ----------------------------------------------------------------------------\n\nexport function extend(publicAPI, model, initialValues = {}) {\n  Object.assign(model, DEFAULT_VALUES, initialValues);\n  vtkContextRepresentation.extend(publicAPI, model, initialValues);\n  macro.setGet(publicAPI, model, [\n    'slicingIndex',\n    'indexToWorld',\n    'worldToIndex',\n  ]);\n  macro.get(publicAPI, model, ['mapper', 'actor']);\n  vtkPaintBrushContextRepresentation(publicAPI, model);\n}\n\n// ----------------------------------------------------------------------------\n\nexport const newInstance = macro.newInstance(\n  extend,\n  'vtkPaintBrushContextRepresentation'\n);\n\nexport default { newInstance, extend };\n","import macro from '@kitware/vtk.js/macro';\n\nexport function shouldIgnoreEvent(e: any) {\n  return e.altKey || e.controlKey || e.shiftKey;\n}\n\nexport default function widgetBehavior(publicAPI: any, model: any) {\n  model.classHierarchy.push('vtkPaintWidgetProp');\n\n  // support setting per-view widget manipulators\n  macro.setGet(publicAPI, model, ['manipulator']);\n\n  let isPainting = false;\n\n  /**\n   * Starts painting\n   */\n  publicAPI.handleLeftButtonPress = (eventData: any) => {\n    if (!model.manipulator || shouldIgnoreEvent(eventData)) {\n      return macro.VOID;\n    }\n\n    const worldCoords = model.manipulator.handleEvent(\n      eventData,\n      model._apiSpecificRenderWindow\n    );\n\n    if (!worldCoords) {\n      return macro.VOID;\n    }\n\n    const brush = model.widgetState.getBrush();\n    brush.setOrigin(...worldCoords);\n\n    isPainting = true;\n    publicAPI.invokeStartInteractionEvent();\n    return macro.EVENT_ABORT;\n  };\n\n  /**\n   * Paints\n   */\n  publicAPI.handleMouseMove = (eventData: any) => {\n    if (shouldIgnoreEvent(eventData)) {\n      return macro.VOID;\n    }\n\n    const worldCoords = model.manipulator.handleEvent(\n      eventData,\n      model._apiSpecificRenderWindow\n    );\n\n    if (!worldCoords) {\n      return macro.VOID;\n    }\n\n    const brush = model.widgetState.getBrush();\n    brush.setOrigin(...worldCoords);\n\n    if (isPainting) {\n      publicAPI.invokeInteractionEvent();\n    }\n    return macro.EVENT_ABORT;\n  };\n\n  /**\n   * Finishes paint\n   */\n  publicAPI.handleLeftButtonRelease = (eventData: any) => {\n    if (!isPainting || shouldIgnoreEvent(eventData)) {\n      return macro.VOID;\n    }\n\n    isPainting = false;\n    publicAPI.invokeEndInteractionEvent();\n    return macro.EVENT_ABORT;\n  };\n\n  publicAPI.handleMouseWheel = () => {\n    if (isPainting) {\n      return macro.EVENT_ABORT;\n    }\n    return macro.VOID;\n  };\n\n  publicAPI.grabFocus = () => {\n    if (!model.hasFocus) {\n      model.hasFocus = true;\n      model._interactor.requestAnimation(publicAPI);\n    }\n  };\n\n  publicAPI.loseFocus = () => {\n    if (model.hasFocus) {\n      model._interactor.cancelAnimation(publicAPI);\n    }\n    model.hasFocus = false;\n    // model._widgetManager.enablePicking();\n    // model._interactor.render();\n  };\n}\n","import { IBrushStencil } from '@/src/core/tools/paint/brush';\nimport type { Vector3 } from '@kitware/vtk.js/types';\nimport vtkStateBuilder from '@kitware/vtk.js/Widgets/Core/StateBuilder';\nimport vtkWidgetState from '@kitware/vtk.js/Widgets/Core/WidgetState';\n\nexport interface PaintPointWidgetState extends vtkWidgetState {\n  setOrigin(origin: Vector3 | null): boolean;\n  getOrigin(): Vector3 | null;\n  setScale1(scale: number): boolean;\n  getScale1(): number;\n  setVisible(visible: boolean): boolean;\n  getVisible(): boolean;\n  setColor(color: number): boolean;\n  getColor(): number;\n}\n\nexport interface PaintWidgetState extends vtkWidgetState {\n  getBrush(): PaintPointWidgetState;\n  getStencil(): IBrushStencil;\n  setStencil(stencil: IBrushStencil): boolean;\n}\n\nexport default function generateState() {\n  return vtkStateBuilder\n    .createBuilder()\n    .addStateFromMixin({\n      labels: ['brush'],\n      name: 'brush',\n      mixins: ['origin', 'scale1', 'visible', 'color'],\n      initialValues: {\n        scale1: 1,\n        origin: null,\n        visible: true,\n      },\n    })\n    .addField({\n      name: 'stencil',\n      initialValue: null,\n    })\n    .build() as PaintWidgetState;\n}\n","import macro from '@kitware/vtk.js/macro';\nimport vtkAbstractWidgetFactory from '@kitware/vtk.js/Widgets/Core/AbstractWidgetFactory';\nimport vtkPlanePointManipulator from '@kitware/vtk.js/Widgets/Manipulators/PlaneManipulator';\nimport vtkPaintBrushContextRepresentation from '@/src/vtk/PaintBrushContextRepresentation';\n\nimport widgetBehavior from './behavior';\nimport stateGenerator from './state';\n\nexport { shouldIgnoreEvent } from './behavior';\n\n// ----------------------------------------------------------------------------\n// Factory\n// ----------------------------------------------------------------------------\n\nfunction vtkPaintWidget(publicAPI, model) {\n  model.classHierarchy.push('vtkPaintWidget');\n\n  model.methodsToLink = ['slicingIndex', 'indexToWorld', 'worldToIndex'];\n\n  publicAPI.getRepresentationsForViewType = () => [\n    {\n      builder: vtkPaintBrushContextRepresentation,\n      labels: ['brush'],\n    },\n  ];\n\n  // Default manipulator\n  model.manipulator = vtkPlanePointManipulator.newInstance();\n}\n\n// ----------------------------------------------------------------------------\n\nconst DEFAULT_VALUES = {};\n\n// ----------------------------------------------------------------------------\n\nexport function extend(publicAPI, model, initialValues = {}) {\n  Object.assign(model, DEFAULT_VALUES, initialValues);\n\n  vtkAbstractWidgetFactory.extend(publicAPI, model, {\n    ...initialValues,\n    behavior: widgetBehavior,\n    widgetState: stateGenerator(),\n  });\n  macro.get(publicAPI, model, ['manipulator']);\n\n  vtkPaintWidget(publicAPI, model);\n}\n\n// ----------------------------------------------------------------------------\n\nexport const newInstance = macro.newInstance(extend, 'vtkPaintWidget');\n\n// ----------------------------------------------------------------------------\n\nexport default { newInstance, extend };\n","import type { Vector2 } from '@kitware/vtk.js/types';\nimport { IBrushStencil, IPaintBrush } from './brush';\n\n// Adapted from http://members.chello.at/easyfilter/bresenham.html\nfunction rasterizeEllipse(xdiam: number, ydiam: number) {\n  const buffer = new Uint8Array(xdiam * ydiam);\n\n  const putPixel = (x: number, y: number) => {\n    buffer[x + y * xdiam] = 1;\n  };\n\n  const blitLine = (x0: number, x1: number, y: number) => {\n    const start = y * xdiam + x0;\n    const end = start + (x1 - x0 + 1);\n    buffer.fill(1, start, end);\n  };\n\n  let x0 = 0;\n  let y0 = 0;\n  let x1 = xdiam - 1;\n  let y1 = ydiam - 1;\n\n  let a = x1;\n  let b = y1;\n  // eslint-disable-next-line no-bitwise\n  const b1 = b & 1;\n  let dx = 4 * (1 - a) * b * b;\n  let dy = 4 * (b1 + 1) * a * a;\n  let err = dx + dy + b1 * a * a;\n  let e2 = 0;\n\n  y0 += Math.floor((b + 1) / 2);\n  y1 = y0 - b1;\n  a *= 8 * a;\n  b *= 8 * b;\n  do {\n    blitLine(x0, x1, y0);\n    blitLine(x0, x1, y1);\n    e2 = 2 * err;\n    if (e2 <= dy) {\n      y0++;\n      y1--;\n      dy += a;\n      err += dy;\n    }\n    if (e2 >= dx || 2 * err > dy) {\n      x0++;\n      x1--;\n      dx += b;\n      err += dx;\n    }\n  } while (x0 <= x1);\n  while (y0 - y1 < ydiam) {\n    putPixel(x0 - 1, y0);\n    putPixel(x1 + 1, y0++);\n    putPixel(x0 - 1, y1);\n    putPixel(x1 + 1, y1--);\n  }\n\n  return buffer;\n}\n\nexport default class EllipsePaintBrush implements IPaintBrush {\n  private size: number = 1;\n  private scale: Vector2 = [1, 1];\n  private cachedStencil!: IBrushStencil;\n\n  constructor() {\n    this.recomputeStencil();\n  }\n\n  setSize(size: number) {\n    this.size = Math.max(0, size);\n    this.recomputeStencil();\n  }\n\n  setScale(scale: Vector2) {\n    this.scale = scale;\n    this.recomputeStencil();\n  }\n\n  private recomputeStencil() {\n    const scaledSize = [\n      Math.ceil(this.size * this.scale[0]),\n      Math.ceil(this.size * this.scale[1]),\n    ] as Vector2;\n    this.cachedStencil = {\n      size: scaledSize,\n      pixels: rasterizeEllipse(scaledSize[0], scaledSize[1]),\n    };\n  }\n\n  getStencil() {\n    return this.cachedStencil;\n  }\n}\n","import vtkLabelMap from '@/src/vtk/LabelMap';\nimport vtkPaintWidget from '@/src/vtk/PaintWidget';\nimport type { Vector2 } from '@kitware/vtk.js/types';\nimport { vec3 } from 'gl-matrix';\nimport { IPaintBrush } from './brush';\nimport EllipsePaintBrush from './ellipse-brush';\n\nexport default class PaintTool {\n  readonly factory: vtkPaintWidget;\n  private brush: IPaintBrush;\n  private brushValue: number;\n\n  constructor() {\n    this.factory = vtkPaintWidget.newInstance();\n    this.brush = new EllipsePaintBrush();\n    this.brushValue = 1;\n  }\n\n  private updateWidgetStencil() {\n    // use unscaled stencil for paint outline\n    const stencil = this.brush.getStencil();\n    const widgetState = this.factory.getWidgetState();\n    widgetState.setStencil(stencil);\n  }\n\n  setBrushSize(size: number) {\n    this.brush.setSize(size);\n    this.updateWidgetStencil();\n  }\n\n  setBrushScale(scale: Vector2) {\n    this.brush.setScale(scale);\n    this.updateWidgetStencil();\n  }\n\n  setBrushValue(value: number) {\n    this.brushValue = value;\n  }\n\n  /**\n   * Adds paint to a labelmap.\n   *\n   * If endPoint is specified, then linearly interpolates the brush\n   * from the start to the end.\n   *\n   * Assumption: startPoint and endPoint are on the same slice axis.\n   *\n   * @param labelmap paint in this labelmap\n   * @param sliceAxis Which index-space axis to paint on (0, 1, or 2).\n   * @param startPoint start point\n   * @param endPoint ending point (optional)\n   */\n  paintLabelmap(\n    labelmap: vtkLabelMap,\n    sliceAxis: 0 | 1 | 2,\n    startPoint: vec3,\n    endPoint?: vec3\n  ) {\n    const stencil = this.brush.getStencil();\n\n    const start = [\n      // transforms + floating point errors can make zero values occasionally\n      // turn into really tiny negative values\n      ...startPoint.map((val) => Math.round(val)),\n    ];\n    // Assumption: startPoint and endPoint are on the same slice axis.\n    const ijkSlice = start[sliceAxis];\n    start.splice(sliceAxis, 1);\n\n    let end = [...start];\n    if (endPoint) {\n      end = [...endPoint.map((val) => Math.round(val))];\n      end.splice(sliceAxis, 1);\n    }\n\n    const labelmapPixels = labelmap.getPointData().getScalars().getData();\n    const labelmapDims = labelmap.getDimensions();\n    const jStride = labelmapDims[0];\n    const kStride = labelmapDims[0] * labelmapDims[1];\n\n    const isInBounds = (point: number[]) =>\n      point[0] >= 0 &&\n      point[1] >= 0 &&\n      point[2] >= 0 &&\n      point[0] < labelmapDims[0] &&\n      point[1] < labelmapDims[1] &&\n      point[2] < labelmapDims[2];\n\n    const { pixels, size } = stencil;\n    const centerX = Math.floor((size[0] - 1) / 2);\n    const centerY = Math.floor((size[1] - 1) / 2);\n\n    const point1 = [...start];\n    const point2 = [...end];\n    const rounded = [0, 0, 0];\n    const curPoint: number[] = [0, 0];\n    for (let y = 0; y < size[1]; y++) {\n      const ydelta = y - centerY;\n      const yoffset = y * size[0];\n      for (let x = 0; x < size[0]; x++) {\n        const xdelta = x - centerX;\n        const pixelOffset = yoffset + x;\n        if (pixels[pixelOffset]) {\n          point1[0] = start[0] + xdelta;\n          point1[1] = start[1] + ydelta;\n          point2[0] = end[0] + xdelta;\n          point2[1] = end[1] + ydelta;\n\n          // line between the two points\n          const dx = point2[0] - point1[0];\n          const dy = point2[1] - point1[1];\n          let steps = Math.abs(Math.abs(dx) > Math.abs(dy) ? dx : dy);\n          const incX = dx / steps;\n          const incY = dy / steps;\n          [curPoint[0], curPoint[1]] = point1;\n          while (steps-- >= 0) {\n            // add slice axis to make a proper 3D index\n            curPoint.splice(sliceAxis, 0, ijkSlice);\n            rounded[0] = Math.round(curPoint[0]);\n            rounded[1] = Math.round(curPoint[1]);\n            rounded[2] = Math.round(curPoint[2]);\n\n            if (isInBounds(rounded)) {\n              const offset =\n                rounded[0] + rounded[1] * jStride + rounded[2] * kStride;\n              labelmapPixels[offset] = this.brushValue;\n            }\n\n            // undo adding the slice axis value\n            curPoint.splice(sliceAxis, 1);\n\n            curPoint[0] += incX;\n            curPoint[1] += incY;\n          }\n        }\n      }\n    }\n\n    labelmap.modified();\n  }\n}\n","import { DICOMIO } from '../io/dicom';\nimport ProxyWrapper from './proxies';\nimport PaintTool from './tools/paint';\n\n/**\n * Pinia plugin for injecting tool services.\n */\nexport function CorePiniaProviderPlugin({\n  paint,\n  proxies,\n  dicomIO,\n}: {\n  paint?: PaintTool;\n  proxies?: ProxyWrapper;\n  dicomIO?: DICOMIO;\n} = {}) {\n  const dependencies = {\n    $paint: paint ?? new PaintTool(),\n    $proxies: proxies,\n    $dicomIO: dicomIO ?? new DICOMIO(),\n  };\n  return () => dependencies;\n}\n","import type { vtkObject } from '@kitware/vtk.js/interfaces';\nimport { VtkProxy } from '@kitware/vtk.js/macros';\nimport vtkAbstractRepresentationProxy from '@kitware/vtk.js/Proxy/Core/AbstractRepresentationProxy';\nimport vtkProxyManager from '@kitware/vtk.js/Proxy/Core/ProxyManager';\nimport vtkSourceProxy from '@kitware/vtk.js/Proxy/Core/SourceProxy';\nimport vtkViewProxy from '@kitware/vtk.js/Proxy/Core/ViewProxy';\n\n// mapped in proxy.js\nexport enum ViewProxyType {\n  Volume = 'View3D',\n  Slice = 'View2D',\n}\n\n/**\n * Wrapper around the vtkProxyManager, since we don't need some of\n * its complexities.\n */\nexport default class ProxyWrapper {\n  private viewProxies: Map<string, vtkViewProxy>;\n  private dataProxies: Map<string, vtkSourceProxy<vtkObject>>;\n  private proxyManager: vtkProxyManager;\n\n  constructor(proxyManager: vtkProxyManager) {\n    this.viewProxies = new Map();\n    this.dataProxies = new Map();\n    this.proxyManager = proxyManager;\n  }\n\n  delete() {\n    const deleteProxy = (proxy: VtkProxy) =>\n      this.proxyManager.deleteProxy(proxy);\n\n    this.viewProxies.forEach(deleteProxy);\n    this.dataProxies.forEach(deleteProxy);\n  }\n\n  createView(id: string, type: ViewProxyType) {\n    if (this.viewProxies.has(id)) {\n      throw new Error('Cannot create a view with the same ID');\n    }\n\n    const proxy = this.proxyManager.createProxy<vtkViewProxy>('Views', type, {\n      name: type,\n    });\n\n    this.viewProxies.set(id, proxy);\n    return proxy;\n  }\n\n  getView<T extends vtkViewProxy>(id: string) {\n    return <T | null>this.viewProxies.get(id);\n  }\n\n  removeView(id: string) {\n    const proxy = this.viewProxies.get(id);\n    if (proxy) {\n      this.proxyManager.deleteProxy(proxy);\n      this.viewProxies.delete(id);\n    }\n  }\n\n  addData<T extends vtkObject>(id: string, data: T) {\n    if (this.dataProxies.has(id)) {\n      return;\n    }\n    const proxy = this.proxyManager.createProxy<vtkSourceProxy<T>>(\n      'Sources',\n      'TrivialProducer'\n    );\n    proxy.setInputData(data);\n    this.dataProxies.set(id, proxy);\n  }\n\n  getData<T extends vtkObject>(id: string) {\n    return <vtkSourceProxy<T> | null>(this.dataProxies.get(id) ?? null);\n  }\n\n  updateData<T extends vtkObject>(id: string, data: T) {\n    const proxy = this.dataProxies.get(id);\n    if (!proxy) {\n      return;\n    }\n    proxy.setInputData(data);\n  }\n\n  deleteData(id: string) {\n    const proxy = this.dataProxies.get(id);\n    this.dataProxies.delete(id);\n    if (proxy) this.proxyManager.deleteProxy(proxy);\n    else throw new Error('Did not find proxy for ID');\n  }\n\n  getDataRepresentationForView<T extends vtkAbstractRepresentationProxy>(\n    dataID: string,\n    viewID: string\n  ): T | null {\n    const dataProxy = this.dataProxies.get(dataID);\n    const viewProxy = this.viewProxies.get(viewID);\n    if (!dataProxy || !viewProxy) {\n      return null;\n    }\n\n    return this.proxyManager.getRepresentation(dataProxy, viewProxy);\n  }\n}\n","/**\n * document.exitPointerLock is undefined on iOS.\n * - Tested on iOS Safari 15.6.1.\n */\nexport function patchExitPointerLock() {\n  const { exitPointerLock } = document;\n  document.exitPointerLock = () => {\n    try {\n      exitPointerLock?.call(document);\n    } catch (e) {\n      // ignore if undefined\n    }\n  };\n}\n","import * as Sentry from '@sentry/vue';\nimport { useLocalStorage } from '@vueuse/core';\nimport { defineStore } from 'pinia';\nimport { App, ref, watch } from 'vue';\n\nconst { VITE_SENTRY_DSN } = import.meta.env;\n\nexport const LOCAL_STORAGE_KEY = 'error-reporting-off';\n\nexport const errorReportingConfigured = !!VITE_SENTRY_DSN;\n\nexport const init = (app: App<Element>) => {\n  const sentryOff = localStorage.getItem(LOCAL_STORAGE_KEY);\n  if (sentryOff !== 'true' && errorReportingConfigured)\n    Sentry.init({\n      app,\n      dsn: VITE_SENTRY_DSN,\n      integrations: [new Sentry.Replay()],\n      // Performance Monitoring\n      tracesSampleRate: 0.1, // Capture 10% of the transactions\n      // Session Replay\n      replaysSessionSampleRate: 0.1, // This sets the sample rate at 10%. You may want to change it to 100% while in development and then sample at a lower rate in production.\n      replaysOnErrorSampleRate: 1.0, // If you're not already sampling the entire session, change the sample rate to 100% when sampling sessions where errors occur.\n    });\n};\n\nconst disable = () => {\n  Sentry.close(200);\n};\n\nexport const useErrorReporting = defineStore('error-reporting', () => {\n  const disableReportingStorage = useLocalStorage(LOCAL_STORAGE_KEY, 'false');\n\n  const disableReporting = ref(disableReportingStorage.value === 'true');\n\n  // sync boolean to local storage\n  watch(disableReporting, () => {\n    disableReportingStorage.value = String(disableReporting.value);\n    if (disableReporting.value) disable();\n  });\n\n  return { disableReporting };\n});\n","<!-- \n  LOGIN VIEW FOR © AREA 19, OCG WEB APP.\n  ALLOWS USERS TO LOG IN TO THEIR ACCOUNT, \n  BY ACCESSING A DATABASE AND VALIDATING USERNAME AND PASSWORD.\n  DEVELOPPED IN MONTREAL, QC, CANADA.\n  JULY 2023.\n -->\n\n<template>\n  <!-- The main container with a dynamic class binding -->\n  <div :class=\"container\">\n    <!-- Login form container -->\n    <div class=\"login-form\" :class=\"{ loaded: loaded }\">\n      <!-- Displaying a personalized greeting based on the time of day. \n      Time of day is calculated in script below-->\n      <h2>Good {{ timeofday }}</h2>\n\n      <!-- Title for the login section -->\n      <h4>Sign into your account</h4>\n\n      <!-- Login form -->\n      <form @submit=\"login\">\n        <!-- Label and input field for the username -->\n        <label for=\"username\"\n          >User name\n          <input type=\"text\" id=\"username\" v-model=\"username\" required\n        /></label>\n        <!-- Invalid message that appears if credentials are not found. -->\n        <div class=\"invalidLogin\" :class=\"{ view: invalidLogin }\">\n          <p>Username not found</p>\n        </div>\n\n        <!-- Label and input field for the password -->\n        <label for=\"password\"\n          >Password\n          <input type=\"password\" id=\"password\" v-model=\"password\" required\n        /></label>\n        <!-- Invalid message that appears if credentials are not found. -->\n        <div class=\"invalidLogin\" :class=\"{ view: invalidLogin }\">\n          <p>Invalid Password</p>\n        </div>\n\n        <!-- Submit button to initiate the login process -->\n        <button type=\"submit\" style=\"align-self: center\">Log In</button>\n\n        <!-- Button to try app as a guest. (temporary, will likely be removed) -->\n        <h4 style=\"margin-top: 40px\">Don't have an account?</h4>\n        <h4\n          @click=\"signup\"\n          @keydown.space.prevent=\"handleKeyDown\"\n          style=\"color: #0085ff\"\n          class=\"sign-up-b\"\n        >\n          Try as Guest\n        </h4>\n      </form>\n    </div>\n  </div>\n</template>\n\n<script>\n// Importing libraries\nimport userCredentials from '../database/users.json';\n// import store from '/src/store/index.js';\n\nexport default {\n  data() {\n    return {\n      timeofday: 'Day',\n      container: 'container',\n      invalidLogin: false,\n      loaded: false,\n    };\n  },\n  created() {\n    this.timeofday = this.getTimeOfDay(); // Getting time of day.\n    this.container = `${this.container} ${this.timeofday.toLowerCase()}`; // Setting background based on timeofday.\n    window.localStorage.setItem('userLoggedIn', 'GUEST USER'); // Setting logged in user to GUEST USER.\n  },\n  mounted() {\n    // Fading in the login container once mounted succesfully.\n    setTimeout(() => {\n      this.loaded = true;\n    }, 100);\n  },\n\n  methods: {\n    /**\n     * Gets the time of day based on the current hour.\n     *\n     * This function determines the time of day (Morning, Afternoon, Evening, or Day)\n     * based on the current hour of the system clock. It is used for displaying a\n     * personalized greeting and adjusting the user interface based on the time of day.\n     *\n     * @returns {string} The time of day as a string (Morning, Afternoon, Evening, or Day).\n     */\n    getTimeOfDay() {\n      // Get the current hour from the system clock\n      const currentHour = new Date().getHours();\n\n      // Check the current hour and return the corresponding time of day\n      if (currentHour >= 5 && currentHour < 12) {\n        return 'Morning'; // If it's between 5 AM and 12 PM, it's morning\n      }\n      if (currentHour >= 12 && currentHour < 18) {\n        return 'Afternoon'; // If it's between 12 PM and 6 PM, it's afternoon\n      }\n      if (currentHour >= 18 && currentHour < 23) {\n        return 'Evening'; // If it's between 6 PM and 11 PM, it's evening\n      }\n      return 'Day'; // Otherwise, it's day (between 11 PM and 5 AM)\n    },\n\n    /**\n     * Handles the login process when the login form is submitted.\n     *\n     * This method is triggered when the login form is submitted. It performs the\n     * following steps:\n     *\n     * 1. Prevents the default form submission to avoid page reload.\n     * 2. Checks if the entered username and password exist in the local JSON database.\n     *   2.aTODO: Will change to server side database.\n     * 3. If the credentials are correct:\n     *    - Stores the username in the application's state (currently using window.store).\n     *    - Saves the username in the browser's local storage to remember the logged-in user.\n     *    - Navigates the user to the '/home' route, indicating successful login.\n     * 4. If the credentials are incorrect, displays invalid credentials in red under fields.\n     *\n     * @param {Event} event - The form submission event to prevent default form behavior.\n     */\n    login(event) {\n      // Prevent default form submission to avoid page reload\n      event.preventDefault();\n\n      // Check if the entered username and password exist in the local JSON database\n      const match = userCredentials.find(\n        (item) =>\n          item.username === this.username && item.password === this.password\n      );\n\n      if (match) {\n        // If credentials are correct:\n        // 1. Emit the username to the 'required' page:\n        // store.commit('setUsername', this.username);\n        // 2. Save the username in the browser's local storage to remember the logged-in user:\n        window.localStorage.setItem('userLoggedIn', this.username);\n        // 3. Navigate the user to the '/home' route, indicating successful login:\n        this.$router.push('/home');\n      } else {\n        // If credentials are incorrect:\n        // Handle incorrect credentials here. (Currently only showing user not found, incorrect password text).\n        this.invalidLogin = true;\n      }\n    },\n\n    /**\n     * Handles the signup process when the signup form is submitted. (Currently disabled.)\n     *\n     * This method is triggered when the signup form is submitted. It performs the\n     * following steps:\n     *\n     * 1. Prevents the default form submission to avoid page reload.\n     * 2. Creates a new user object with the entered username and password.\n     * 3. Adds the new user object to the local JSON database of user credentials. (eventually to a database)\n     * 4. Navigates the user to the '/home' route, indicating successful signup.\n     *\n     *\n     * @param {Event} event - The form submission event to prevent default form behavior.\n     */\n    signup(event) {\n      // Prevent default form submission to avoid page reload\n      event.preventDefault();\n\n      // Create a new user object with the entered username and password\n      const newUser = {\n        username: this.username,\n        password: this.password,\n      };\n\n      // Add the new user object to the local JSON database of user credentials\n      userCredentials.push(newUser);\n\n      // Optionally, display an alert to indicate successful signup (commented out in the code)\n      // alert(`Successfully added a new user! Username: ${this.username}, Password: ${this.password}`);\n\n      // Navigate the user to the '/home' route, indicating successful signup\n      this.$router.push('/home');\n    },\n  },\n};\n</script>\n\n<style scoped>\n/* The main container styling */\n\n.container {\n  display: flex;\n  justify-content: right;\n  padding-right: 15vw;\n  align-items: center;\n  height: 100vh;\n  /* Background gradient using fallback for old browsers */\n  background: #200122;\n  /* Chrome 10-25, Safari 5.1-6 */\n  background: -webkit-linear-gradient(to top, #6f0000, #200122);\n  /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */\n  background: linear-gradient(to bottom, #06293d, #963b0e, #06293d);\n  background-repeat: space;\n  background-size: cover;\n}\n\n/* Background images for different times of day */\n.afternoon {\n  background-image: url('/images/afternoon.jpg');\n}\n\n.morning {\n  background-image: url('/images/morning.jpg');\n}\n\n.evening {\n  background-image: url('/images/night.jpg');\n}\n\n.day {\n  background-image: url('/images/day.jpg');\n}\n\n/* Styling for the login form */\n.login-form {\n  background: #00000080 0% 0% no-repeat padding-box;\n  border-radius: 19px;\n  opacity: 0;\n  backdrop-filter: blur(30px);\n  -webkit-backdrop-filter: blur(30px);\n  /* Additional padding and sizing for the form */\n  padding-left: 36px;\n  padding-right: 36px;\n  padding-top: 53px;\n  border-radius: 19px;\n  width: 521px;\n  height: 646px;\n  transition: opacity 0.5s ease-in-out;\n}\n\n/* Transition opacity when loaded */\n.login-form.loaded {\n  opacity: 1;\n}\n\n/* Heading styles */\nh2 {\n  text-align: center;\n  font: normal normal normal 32px/39px;\n  font-family: 'Proxima Nova', sans-serif;\n  font-weight: lighter;\n  font-size: 32px;\n}\n\nh4 {\n  text-align: center;\n  font: normal normal normal 18px/23px;\n  font-family: 'Proxima Nova', sans-serif;\n  font-size: 18px;\n  font-weight: lighter;\n}\n\n/* Label styles */\nlabel {\n  font-size: 18px;\n  margin-bottom: 13px;\n  margin-top: 39px;\n  font-family: 'Proxima Nova', sans-serif;\n  font-weight: lighter;\n}\n\n/* Form layout */\nform {\n  display: flex;\n  flex-direction: column;\n}\n\n/* Input field styles */\ninput {\n  font-size: 20px;\n  /* Border styles for the input fields */\n  border-style: solid;\n  border-color: rgb(255, 255, 255);\n  border-radius: 15px;\n  -webkit-border-radius: 15px; /* Vendor prefix for Safari/Chrome */\n  border: 1px solid #ffffff63;\n  border-radius: 7px;\n  -webkit-border-radius: 7px; /* Vendor prefix for Safari/Chrome */\n  opacity: 1;\n  color: rgb(255, 255, 255);\n  padding-left: 10px;\n  width: 450px;\n  height: 66px;\n}\n\n/* Button styles */\nbutton {\n  margin-top: 29px;\n  padding: 8px 16px;\n  /* Gradient background for the button */\n  background-size: 300% 100%;\n  background-image: linear-gradient(\n    to right,\n    #25aae1,\n    #4481eb,\n    #04befe,\n    #3f86ed\n  );\n  border-radius: 33px;\n  -webkit-border-radius: 33px; /* Vendor prefix for Safari/Chrome */\n  width: 131px;\n  height: 44px;\n  transition: background 0.3s ease;\n}\n\n/* Button hover effect */\nbutton:hover {\n  background-position: 60% 50%;\n\n  -o-transition: all 0.4s ease-in-out;\n  -webkit-transition: all 0.4s ease-in-out;\n  transition: all 0.4s ease-in-out;\n}\n\n/* Styles for clickable elements with the \"sign-up-b\" class */\n.sign-up-b {\n  cursor: pointer;\n}\n\n/* Styles for displaying an error message for invalid login */\n.invalidLogin {\n  height: 5px;\n  color: #ff6a6a;\n  padding-left: 5px;\n  padding-top: 2px;\n  opacity: 0;\n  transition: opacity 0.3s ease-out;\n}\n\n/* Styles to make the error message visible */\n.invalidLogin.view {\n  opacity: 1;\n}\n\n/* Media queries for responsive design */\n@media screen and (max-width: 620px) {\n  /* Adjust the container padding for smaller screens */\n  .container {\n    padding-right: 5vw;\n  }\n\n  /* Adjust the form width and padding for smaller screens */\n  .login-form {\n    width: 90%;\n    padding-left: 15px;\n    padding-right: 15px;\n  }\n\n  /* Adjust the input field and button width for smaller screens */\n  input,\n  button {\n    max-width: 100%;\n  }\n}\n</style>\n","<!-- \n    RENDERING A PERSONALIZED GREETING MESSAGE.\n    USES DATA BINDING TO DYNAMICALLY DISPLAY THE TIME OF DAY AND THE USERNAME.\n    GREETS USER WITH GOOD + TIMEOF DAY (calculated on created()).\n    GRABS USER NAME FROM LOCAL STORAGE. STORED DURING LOGIN.\n    COMPONENT PART OF © AREA 19, OCG WEB APP.\n    DEVELOPPED IN MONTREAL, QC, CANADA.\n    JULY 2023.\n  -->\n<template>\n  <div class=\"greeting\">\n    <!-- The 'timeofday' variable will be replaced with the appropriate greeting time. -->\n    <h2>Good {{ timeofday }},</h2>\n\n    <!-- The 'username' prop will be replaced with the user's name. -->\n    <h1>{{ username }}</h1>\n  </div>\n</template>\n\n<script>\nexport default {\n  props: {\n    username: String,\n  },\n  methods: {\n    /**\n     * Gets the time of day based on the current hour.\n     *\n     * This function determines the time of day (Morning, Afternoon, Evening, or Day)\n     * based on the current hour of the system clock. It is used for displaying a\n     * personalized greeting and adjusting the user interface based on the time of day.\n     *\n     * @returns {string} The time of day as a string (Morning, Afternoon, Evening, or Day).\n     */\n    getTimeOfDay() {\n      // Get the current hour from the system clock\n      const currentHour = new Date().getHours();\n\n      // Check the current hour and return the corresponding time of day\n      if (currentHour >= 5 && currentHour < 12) {\n        return 'Morning'; // If it's between 5 AM and 12 PM, it's morning\n      }\n      if (currentHour >= 12 && currentHour < 18) {\n        return 'Afternoon'; // If it's between 12 PM and 6 PM, it's afternoon\n      }\n      if (currentHour >= 18 && currentHour < 23) {\n        return 'Evening'; // If it's between 6 PM and 11 PM, it's evening\n      }\n      return 'Night'; // Otherwise, it's night (between 11 PM and 5 AM)\n    },\n  },\n  data() {\n    return {\n      timeofday: 'Day',\n    };\n  },\n  created() {\n    this.timeofday = this.getTimeOfDay();\n  },\n};\n</script>\n\n<style scoped>\n/* Styles for the greeting container */\n.greeting {\n  /* Add styles for the welcome message */\n  text-align: center;\n}\n\n/* Styles for the main heading */\nh1 {\n  font-size: 50px;\n  font-weight: 400;\n}\n\n/* Styles for the subheading */\nh2 {\n  font-size: 34px;\n  font-weight: 300;\n}\n\n/* Responsive Styles */\n\n/* For screens smaller than 768px */\n@media screen and (max-width: 767px) {\n  h1 {\n    font-size: 40px;\n  }\n\n  h2 {\n    font-size: 28px;\n  }\n}\n\n/* For screens between 768px and 1023px */\n@media screen and (min-width: 768px) and (max-width: 1023px) {\n  h1 {\n    font-size: 45px;\n  }\n\n  h2 {\n    font-size: 30px;\n  }\n}\n</style>\n","<!-- \n    COMPONENT THAT DISPLAYS PATIENT INFORMATION WITHIN A ROUTER LINK.\n    WHEN PATIENT IS CLIKED, LOCAL STORAGE IS UPDATED TO THE CLICKED PATIENT.\n    COMPONENT PART OF © AREA 19, OCG WEB APP.\n    DEVELOPPED IN MONTREAL, QC, CANADA.\n    JULY 2023.\n  -->\n<template>\n  <!-- The router-link element is used to navigate to the \"/analysis\" route when clicked. -->\n  <router-link to=\"/analysis\" style=\"text-decoration: none\">\n    <!-- The patient information is displayed within a div with the \"patient\" class. -->\n    <div\n      class=\"patient\"\n      @mouseover=\"isHovered = true\"\n      @focusin=\"isHovered = true\"\n      @click=\"updatepatient(patient)\"\n      @keydown.space.prevent=\"handleKeyDown\"\n      @mouseout=\"isHovered = false\"\n      @focusout=\"isHovered = false\"\n    >\n      <!-- The following are headings displaying various patient details. The \"hovered\" class is applied when the element is hovered. -->\n      <h3 :class=\"{ hovered: isHovered }\">{{ patient.name }}</h3>\n      <h3 :class=\"{ hovered: isHovered }\">{{ patient.lastname }}</h3>\n      <h3 :class=\"{ hovered: isHovered }\">{{ patient.dob }}</h3>\n      <h3 :class=\"{ hovered: isHovered }\">{{ patient.gender }}</h3>\n      <h3 :class=\"{ hovered: isHovered }\">{{ patient.scandate }}</h3>\n      <h3 :class=\"{ hovered: isHovered }\">{{ patient.scanlocation }}</h3>\n    </div>\n  </router-link>\n</template>\n\n<script>\n// import store from '/src/store/index.js';\n\nexport default {\n  props: {\n    patient: Object,\n  },\n  methods: {\n    // Update localStoragePatient to the patient object.\n    updatepatient(patient) {\n      // Use JSON.stringify to store object not string.\n      window.localStorage.setItem('currentPatient', JSON.stringify(patient));\n\n      // store.state.patient.name = patient.name.toUpperCase();\n      // store.state.patient.lastname = patient.lastname.toUpperCase();\n      // store.state.patient.breathingrate = patient.breathingrate;\n      // store.state.patient.age = patient.age;\n      // store.state.patient.weight = patient.weight;\n      // store.state.patient.height = patient.height;\n      // store.state.patient.gender = patient.gender;\n    },\n  },\n\n  data() {\n    return {\n      isHovered: false,\n      currentPatient: '',\n    };\n  },\n};\n</script>\n\n<style scoped>\n/* Styling for the container of patient information */\n.patient {\n  height: 60px; /* Set the height of the container */\n  display: grid; /* Use grid layout for the container */\n  grid-template-columns: repeat(\n    6,\n    15vw [col-start]\n  ); /* Define 6 equal-width columns using viewport width */\n  color: rgb(179, 177, 177); /* Set the text color for patient information */\n  align-items: center; /* Center-align content vertically within the container */\n  justify-items: center; /* Center-align content horizontally within the container */\n  cursor: pointer; /* Change the cursor to a pointer on hover, indicating clickability */\n  transition: 0.3s; /* Apply a smooth transition effect with a duration of 0.3 seconds */\n  text-decoration: none; /* Remove any text decoration (e.g., underline) from the container */\n}\n\n/* Styling when the patient information container is hovered */\n.patient:hover {\n  background: #229ed75e; /* Semi-transparent background color when hovered */\n  /* Apply a linear gradient from transparent to a lighter blue (#229ed78a) and back to transparent horizontally */\n  background: linear-gradient(\n    to right,\n    rgba(0, 0, 0, 0),\n    #229ed78a,\n    rgba(0, 0, 0, 0)\n  );\n  transition: 0.3s; /* Apply the same 0.3-second smooth transition effect when hovered */\n}\n\n/* Styling for all h3 elements within the patient container */\nh3 {\n  font-weight: 300; /* Set the font weight to 300 (light) for the heading elements */\n  color: white; /* Set the text color for the heading elements to white */\n  text-decoration: none; /* Remove any text decoration from the headings */\n}\n\n/* Styling for h3 elements with the \"hovered\" class */\n.hovered {\n  color: #229ed7; /* Set the text color to a specific blue (#229ed7) when the element has the \"hovered\" class */\n  font-weight: 500; /* Increase the font weight to 500 (medium) for the \"hovered\" elements */\n}\n\n/* Media query for small screens (max-width: 767px) */\n@media only screen and (max-width: 767px) {\n  .patient {\n    text-align: center; /* Center-align the content in the column */\n  }\n\n  h3 {\n    font-size: 14px; /* Reduce font size for better fit on small screens */\n  }\n}\n</style>\n","<template>\n  <div class=\"loading-container\">\n    <div class=\"loading-spinner\"></div>\n    <p class=\"loading-text\">Loading...</p>\n  </div>\n</template>\n\n<style>\n.loading-container {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n}\n\n.loading-spinner {\n  border: 5px solid rgba(0, 173, 255, 0.5);\n  border-top: 10px solid rgba(217, 84, 118, 0.9);\n  border-radius: 50%;\n  width: 100px;\n  height: 100px;\n  animation: spin 0.8s linear infinite;\n}\n\n.loading-text {\n  margin-top: 10px;\n  font-size: 24px;\n  color: #c0c0c0;\n}\n\n@keyframes spin {\n  0% {\n    transform: rotate(0deg);\n  }\n  100% {\n    transform: rotate(360deg);\n  }\n}\n</style>\n","<!-- \n    PATIENT CONTAINER, SHOWS A LIST OF PATIENTS. \n    CURRENLTY, GENERATING RANDOM PATIENTS.\n    COMPONENT PART OF © AREA 19, OCG WEB APP.\n    DEVELOPPED IN MONTREAL, QC, CANADA.\n    JULY 2023.\n  -->\n<template>\n  <div class=\"patient-header\">\n    <!-- Section for displaying the column headers -->\n    <h3>Last Name</h3>\n    <h3>First Name</h3>\n    <h3>Date of Birth</h3>\n    <h3>Gender</h3>\n    <h3>Scan Date</h3>\n    <h3>Scan Location</h3>\n  </div>\n\n  <div v-if=\"loaded\" class=\"patient-container\">\n    <!-- This is the container for displaying individual patient information \n      The code inside this div uses v-for directive to loop through each patient in the filteredPatients array \n      !We use filteredPatients so that user can search by criteria \n      The :key attribute is used to uniquely identify each patient element and aid in efficient rendering -->\n    <div :key=\"patient.id\" v-for=\"patient in filteredPatients\">\n      <!-- The 'Patient' component is used to display detailed information for each patient \n      The 'patient' prop is passed to the 'Patient' component to provide the patient data -->\n      <PatientElement :patient=\"patient\" />\n    </div>\n  </div>\n  <div v-else>\n    <LoadingScreen />\n  </div>\n</template>\n\n<script>\nimport PatientElement from './PatientElement.vue';\n// import store from '/src/store/index.js';\nimport LoadingScreen from './LoadingScreen.vue';\n\nexport default {\n  props: {\n    patients: { type: Array },\n  },\n  data() {\n    return {\n      filter: '',\n      loaded: false,\n    };\n  },\n\n  computed: {\n    filteredPatients() {\n      const filterString = this.filter.toLowerCase().replace(/\\s/g, '');\n      if (filterString === '') {\n        return this.patients;\n      }\n\n      return this.patients.filter(\n        (patient) =>\n          patient.name.toLowerCase().includes(filterString) ||\n          patient.lastname.toLowerCase().includes(filterString) ||\n          patient.scanlocation.toLowerCase().includes(filterString)\n      );\n    },\n  },\n\n  methods: {\n    // generateRandomBirthDate(st, en) {\n    //   // Generate a random year between 1900 and 2023\n    //   const year = Math.floor(Math.random() * (st - en + 1)) + en;\n    //   // Generate a random month between 1 and 12\n    //   var month = Math.floor(Math.random() * 12) + 1;\n    //   // Generate a random day between 1 and 28/30/31 based on the month\n    //   var daysinmonths = new Date(year, month, 0).getDate();\n    //   var day = Math.floor(Math.random() * (daysinmonths - 1 + 1)) + 1;\n    //   // Format the date components as two-digit strings\n    //   var formattedDay = day.toString().padStart(2, '0');\n    //   var formattedMonth = month.toString().padStart(2, '0');\n    //   // Combine the components into the final string format\n    //   var formattedDate = formattedDay + '/' + formattedMonth + '/' + year;\n    //   return formattedDate;\n    // },\n    // calculateAge(birthDate) {\n    //   var today = new Date();\n    //   var birthDateParts = birthDate.split('/');\n    //   var birthDay = parseInt(birthDateParts[0]);\n    //   var birthMonth = parseInt(birthDateParts[1]);\n    //   var birthYear = parseInt(birthDateParts[2]);\n    //   var age = today.getFullYear() - birthYear;\n    //   // Check if the current date is before the birth date this year\n    //   var hasBirthdayPassed =\n    //     today.getMonth() + 1 > birthMonth ||\n    //     (today.getMonth() + 1 === birthMonth && today.getDate() >= birthDay);\n    //   // Subtract 1 from the age if the birthday has not yet occurred this year\n    //   if (!hasBirthdayPassed) {\n    //     age--;\n    //   }\n    //   return age;\n    // },\n    // generateRandomPatients(count) {\n    //   const patients = [];\n    //   const firstNames = ['John', 'Jane', 'David', 'Sarah', 'Michael', 'Emily'];\n    //   const lastNames = [\n    //     'Smith',\n    //     'Johnson',\n    //     'Williams',\n    //     'Brown',\n    //     'Jones',\n    //     'Davis',\n    //   ];\n    //   const genders = ['Male', 'Female'];\n    //   const scanLocations = [\n    //     'Montreal',\n    //     'LosAngeles',\n    //     'Clinic X',\n    //     'Medical Center',\n    //     'MUHC',\n    //   ];\n    //   for (let i = 0; i < count; i++) {\n    //     const id = i + 1;\n    //     const firstName =\n    //       firstNames[Math.floor(Math.random() * firstNames.length)];\n    //     const lastName =\n    //       lastNames[Math.floor(Math.random() * lastNames.length)];\n    //     const dateOfBirth = this.generateRandomBirthDate(2004, 1970);\n    //     const gender = genders[Math.floor(Math.random() * genders.length)];\n    //     const scanDate = this.generateRandomBirthDate(2023, 2010);\n    //     const scanLocation =\n    //       scanLocations[Math.floor(Math.random() * scanLocations.length)];\n    //     const page = this.calculateAge(dateOfBirth);\n    //     const height = Math.floor(Math.random() * 100 + 100);\n    //     const weight = Math.floor(Math.random() * 100 + 40);\n    //     const breathingrate = Math.floor(Math.random() * 80 + 19);\n    //     patients.push({\n    //       id: id,\n    //       name: firstName,\n    //       lastname: lastName,\n    //       dob: dateOfBirth,\n    //       gender: gender,\n    //       scandate: scanDate,\n    //       scanlocation: scanLocation,\n    //       age: page,\n    //       weight: weight,\n    //       height: height,\n    //       breathingrate: breathingrate,\n    //     });\n    //   }\n    //   patients.push({\n    //     id: 111,\n    //     name: 'Mitchel',\n    //     lastname: 'Benovoy',\n    //     dob: '01/02/1982',\n    //     gender: 'Male',\n    //     scandate: '01/02/2023',\n    //     scanlocation: 'Area 19 Office',\n    //   });\n    //   return patients;\n    // },\n  },\n\n  components: {\n    PatientElement,\n    LoadingScreen,\n  },\n\n  mounted() {\n    setTimeout(() => {\n      this.loaded = true;\n    }, 600);\n  },\n};\n</script>\n\n<style scoped>\n.patient-container {\n  /* border: 1px solid white; */\n  align-self: center;\n  height: 63vh;\n  overflow: scroll;\n  /* Add styles for the patient container */\n  -ms-overflow-style: none;\n  scrollbar-width: none;\n}\n.patient-container::-webkit-scrollbar {\n  display: none;\n  width: 0 !important;\n}\n/* Styles for the patient header */\n.patient-header {\n  height: 50px;\n  display: grid;\n  align-items: center;\n  justify-items: center;\n  grid-template-columns: repeat(6, 15vw [col-start]);\n  color: rgb(179, 177, 177);\n}\n\nh3 {\n  font-weight: 300;\n}\n\n/* Media query for screens up to 768px width (e.g., tablets and smaller devices) */\n@media screen and (max-width: 768px) {\n  /* Change flex-direction to column to stack h3 elements vertically */\n  .patient-header {\n    text-align: center;\n  }\n\n  h3 {\n    font-size: 14px;\n  }\n\n  /* Reduce margin at the bottom of h3 elements for a more compact layout */\n  .patient-header h3 {\n    margin-bottom: 5px;\n  }\n}\n</style>\n","import { defineStore } from 'pinia';\n\nconst START_ID = 0;\n\nexport const useIdStore = defineStore('id', () => {\n  let id: number = START_ID;\n  return {\n    nextId() {\n      return String(++id);\n    },\n    reset() {\n      id = START_ID;\n    },\n  };\n});\n","import type { Bounds } from '@kitware/vtk.js/types';\nimport { vec3, mat3 } from 'gl-matrix';\nimport {\n  LPSAxis,\n  LPSAxisDir,\n  LPSBounds,\n  LPSDirections,\n  LPSPoint,\n} from '../types/lps';\n\nexport const LPSAxes: LPSAxis[] = ['Sagittal', 'Coronal', 'Axial'];\n\nexport function createLPSPoint(): LPSPoint {\n  return {\n    Sagittal: 0,\n    Coronal: 0,\n    Axial: 0,\n  };\n}\n\nexport function createLPSBounds(): LPSBounds {\n  return {\n    Sagittal: [0, 0],\n    Coronal: [0, 0],\n    Axial: [0, 0],\n  };\n}\n\nexport function getAxisBounds(\n  bounds: Bounds,\n  axis: LPSAxis,\n  directions: LPSDirections\n) {\n  const index = 2 * directions[axis];\n  return bounds.slice(index, index + 2) as [number, number];\n}\n\nexport function getLPSAxisFromDir(dir: LPSAxisDir): LPSAxis {\n  switch (dir) {\n    case 'Superior':\n    case 'Inferior':\n      return 'Axial';\n    case 'Left':\n    case 'Right':\n      return 'Sagittal';\n    case 'Posterior':\n    case 'Anterior':\n      return 'Coronal';\n    default:\n      throw new Error(`Invalid LPS direction: ${dir}`);\n  }\n}\n\nexport const defaultLPSDirections = () => ({\n  Left: vec3.fromValues(1, 0, 0),\n  Right: vec3.fromValues(-1, 0, 0),\n  Posterior: vec3.fromValues(0, 1, 0),\n  Anterior: vec3.fromValues(0, -1, 0),\n  Superior: vec3.fromValues(0, 0, 1),\n  Inferior: vec3.fromValues(0, 0, -1),\n\n  Sagittal: 0 as const,\n  Coronal: 1 as const,\n  Axial: 2 as const,\n});\n\n/**\n * Associates the column vectors of a 3x3 matrix with the LPS axes.\n *\n * For each of the LPS axes, this function returns the associated column index (0, 1, 2)\n * in the provided 3x3 column-major matrix.\n *\n * Approach:\n *   - find the max of the direction matrix, ignoring columns and rows marked as done\n *   - assign the column vector of that max value to the row axis\n *   - mark that row and column as done\n *   - continue until all rows and columns are done\n */\nexport function getLPSDirections(direction: mat3): LPSDirections {\n  // Track the rows and columns that have yet to be assigned.\n  const availableCols = [0, 1, 2];\n  const availableRows = [0, 1, 2];\n  const lpsDirs: LPSDirections = defaultLPSDirections();\n\n  for (let i = 0; i < 3; i++) {\n    let bestValue = 0;\n    let bestValueLoc = [0, 0]; // col, row\n    let removeIndices = [0, 0]; // indices into availableCols/Rows for deletion\n\n    availableCols.forEach((col, colIdx) => {\n      availableRows.forEach((row, rowIdx) => {\n        const value = direction[col * 3 + row];\n        if (Math.abs(value) > Math.abs(bestValue)) {\n          bestValue = value;\n          bestValueLoc = [col, row];\n          removeIndices = [colIdx, rowIdx];\n        }\n      });\n    });\n\n    // the row index corresponds to the index of the LPS axis\n    const [col, axis] = bestValueLoc;\n    const axisVector = direction.slice(col * 3, (col + 1) * 3);\n    const vecSign = Math.sign(bestValue);\n    const posVector = axisVector.map((c) => c * vecSign) as vec3;\n    const negVector = axisVector.map((c) => c * -vecSign) as vec3;\n    if (axis === 0) {\n      // Sagittal\n      lpsDirs.Left = posVector;\n      lpsDirs.Right = negVector;\n      lpsDirs.Sagittal = col as 0 | 1 | 2;\n    } else if (axis === 1) {\n      // Coronal\n      lpsDirs.Posterior = posVector;\n      lpsDirs.Anterior = negVector;\n      lpsDirs.Coronal = col as 0 | 1 | 2;\n    } else if (axis === 2) {\n      // Axial\n      lpsDirs.Superior = posVector;\n      lpsDirs.Inferior = negVector;\n      lpsDirs.Axial = col as 0 | 1 | 2;\n    }\n\n    availableCols.splice(removeIndices[0], 1);\n    availableRows.splice(removeIndices[1], 1);\n  }\n\n  return lpsDirs;\n}\n","export enum Tools {\n  WindowLevel = 'WindowLevel',\n  Pan = 'Pan',\n  Zoom = 'Zoom',\n  Ruler = 'Ruler',\n  Paint = 'Paint',\n  Rectangle = 'Rectangle',\n  Crosshairs = 'Crosshairs',\n  Crop = 'Crop',\n  Contour = 'Contour',\n}\n","export enum LayoutDirection {\n  V = 'V',\n  H = 'H',\n}\n\nexport type Layout = {\n  direction: LayoutDirection;\n  items: Array<Layout | string>;\n  name?: string;\n};\n","import JSZip from 'jszip';\nimport { z } from 'zod';\nimport type { Vector3 } from '@kitware/vtk.js/types';\nimport vtkPiecewiseFunctionProxy, {\n  PiecewiseGaussian,\n  PiecewiseNode,\n} from '@kitware/vtk.js/Proxy/Core/PiecewiseFunctionProxy';\n\nimport { Tools as ToolsEnum } from '@/src/store/tools/types';\nimport { Ruler } from '@/src/types/ruler';\nimport { Rectangle } from '@/src/types/rectangle';\nimport { LPSCroppingPlanes } from '@/src/types/crop';\nimport { FrameOfReference } from '@/src/utils/frameOfReference';\nimport { Optional } from '@/src/types';\nimport { AnnotationTool } from '@/src/types/annotationTool';\n\nimport {\n  CameraConfig,\n  SliceConfig,\n  WindowLevelConfig,\n  LayersConfig,\n  VolumeColorConfig,\n} from '../../store/view-configs/types';\nimport { LPSAxisDir, LPSAxis } from '../../types/lps';\nimport { LayoutDirection } from '../../types/layout';\nimport {\n  ViewType,\n  ColorBy,\n  ColorTransferFunction,\n  OpacityFunction,\n  OpacityGaussians,\n  OpacityPoints,\n  OpacityNodes,\n  ColoringConfig,\n  CVRConfig,\n  BlendConfig,\n} from '../../types/views';\n\nexport enum DatasetType {\n  DICOM = 'dicom',\n  IMAGE = 'image',\n}\n\nconst DatasetTypeNative = z.nativeEnum(DatasetType);\n\nconst LPSAxisDir = z.union([\n  z.literal('Left'),\n  z.literal('Right'),\n  z.literal('Posterior'),\n  z.literal('Anterior'),\n  z.literal('Superior'),\n  z.literal('Inferior'),\n]) satisfies z.ZodType<LPSAxisDir>;\n\nconst Dataset = z.object({\n  id: z.string(),\n  path: z.string(),\n  type: DatasetTypeNative,\n});\nexport type Dataset = z.infer<typeof Dataset>;\n\nconst baseRemoteFileSchema = z.object({\n  archiveSrc: z.object({ path: z.string() }).optional(),\n  uriSrc: z.object({ uri: z.string(), name: z.string() }).optional(),\n});\n\ntype RemoteFileType = z.infer<typeof baseRemoteFileSchema> & {\n  parent?: RemoteFileType;\n};\n\n// This is a serialized DataSource that has a UriSource ancestor.\nconst RemoteFile: z.ZodType<RemoteFileType> = baseRemoteFileSchema.extend({\n  parent: z.lazy(() => RemoteFile.optional()),\n});\nexport type RemoteFile = z.infer<typeof RemoteFile>;\n\nconst LayoutDirectionNative = z.nativeEnum(LayoutDirection);\n\nexport interface Layout {\n  name?: string;\n  direction: LayoutDirection;\n  items: Array<Layout | string>;\n}\n\nconst Layout: z.ZodType<Layout> = z.lazy(() =>\n  z.object({\n    name: z.string().optional(),\n    direction: LayoutDirectionNative,\n    items: z.array(z.union([Layout, z.string()])),\n  })\n);\n\nconst Vector3 = z.tuple([\n  z.number(),\n  z.number(),\n  z.number(),\n]) satisfies z.ZodType<Vector3>;\n\nconst WindowLevelConfig = z.object({\n  width: z.number(),\n  level: z.number(),\n  min: z.number(),\n  max: z.number(),\n}) satisfies z.ZodType<WindowLevelConfig>;\n\nconst SliceConfig = z.object({\n  slice: z.number(),\n  min: z.number(),\n  max: z.number(),\n  axisDirection: LPSAxisDir,\n}) satisfies z.ZodType<SliceConfig>;\n\nconst CameraConfig = z.object({\n  parallelScale: z.number().optional(),\n  position: Vector3.optional(),\n  focalPoint: Vector3.optional(),\n  directionOfProjection: Vector3.optional(),\n  viewUp: Vector3.optional(),\n}) satisfies z.ZodType<CameraConfig>;\n\nconst ColorBy = z.object({\n  arrayName: z.string(),\n  location: z.string(),\n}) satisfies z.ZodType<ColorBy>;\n\nconst PiecewiseGaussian = z.object({\n  position: z.number(),\n  height: z.number(),\n  width: z.number(),\n  xBias: z.number(),\n  yBias: z.number(),\n}) satisfies z.ZodType<PiecewiseGaussian>;\n\nconst PiecewiseNode = z.object({\n  x: z.number(),\n  y: z.number(),\n  midpoint: z.number(),\n  sharpness: z.number(),\n}) as z.ZodType<PiecewiseNode>;\n\nconst OpacityGaussians = z.object({\n  mode: z.literal(vtkPiecewiseFunctionProxy.Mode.Gaussians),\n  gaussians: PiecewiseGaussian.array(),\n  mappingRange: z.tuple([z.number(), z.number()]),\n}) satisfies z.ZodType<OpacityGaussians>;\n\nconst OpacityPoints = z.object({\n  mode: z.literal(vtkPiecewiseFunctionProxy.Mode.Points),\n  preset: z.string(),\n  shift: z.number(),\n  mappingRange: z.tuple([z.number(), z.number()]),\n}) satisfies z.ZodType<OpacityPoints>;\n\nconst OpacityNodes = z.object({\n  mode: z.literal(vtkPiecewiseFunctionProxy.Mode.Nodes),\n  nodes: PiecewiseNode.array(),\n  mappingRange: z.tuple([z.number(), z.number()]),\n}) satisfies z.ZodType<OpacityNodes>;\n\nconst OpacityFunction = z.union([\n  OpacityGaussians,\n  OpacityPoints,\n  OpacityNodes,\n]);\n\nconst ColorTransferFunction = z.object({\n  preset: z.string(),\n  mappingRange: z.tuple([z.number(), z.number()]),\n}) satisfies z.ZodType<ColorTransferFunction>;\n\nconst ColoringConfig = z.object({\n  colorBy: ColorBy,\n  transferFunction: ColorTransferFunction,\n  opacityFunction: OpacityFunction,\n}) satisfies z.ZodType<ColoringConfig>;\n\nconst CVRConfig = z.object({\n  enabled: z.boolean(),\n  lightFollowsCamera: z.boolean(),\n  volumeQuality: z.number(),\n  useVolumetricScatteringBlending: z.boolean(),\n  volumetricScatteringBlending: z.number(),\n  useLocalAmbientOcclusion: z.boolean(),\n  laoKernelSize: z.number(),\n  laoKernelRadius: z.number(),\n  ambient: z.number(),\n  diffuse: z.number(),\n  specular: z.number(),\n}) satisfies z.ZodType<CVRConfig>;\n\nconst VolumeColorConfig = z.object({\n  colorBy: ColorBy,\n  transferFunction: ColorTransferFunction,\n  opacityFunction: OpacityFunction,\n  cvr: CVRConfig,\n}) satisfies z.ZodType<VolumeColorConfig>;\n\nconst BlendConfig = z.object({\n  opacity: z.number(),\n}) satisfies z.ZodType<BlendConfig>;\n\nconst LayersConfig = z.object({\n  colorBy: ColorBy,\n  transferFunction: ColorTransferFunction,\n  opacityFunction: OpacityFunction,\n  blendConfig: BlendConfig,\n}) satisfies z.ZodType<LayersConfig>;\n\nconst ViewConfig = z.object({\n  window: WindowLevelConfig.optional(),\n  slice: SliceConfig.optional(),\n  layers: LayersConfig.optional(),\n  camera: CameraConfig.optional(),\n  volumeColorConfig: VolumeColorConfig.optional(),\n});\n\nconst ViewType = z.union([\n  z.literal('2D'),\n  z.literal('3D'),\n]) satisfies z.ZodType<ViewType>;\n\nexport type ViewConfig = z.infer<typeof ViewConfig>;\n\nconst View = z.object({\n  id: z.string(),\n  type: ViewType,\n  props: z.record(z.any()),\n  config: z.record(ViewConfig),\n});\n\nexport type View = z.infer<typeof View>;\n\nexport const LabelMap = z.object({\n  id: z.string(),\n  parent: z.string(),\n  path: z.string(),\n});\n\nexport type LabelMap = z.infer<typeof LabelMap>;\n\nconst LPSAxis = z.union([\n  z.literal('Axial'),\n  z.literal('Sagittal'),\n  z.literal('Coronal'),\n]) satisfies z.ZodType<LPSAxis>;\n\nconst FrameOfReference = z.object({\n  planeOrigin: Vector3,\n  planeNormal: Vector3,\n}) satisfies z.ZodType<FrameOfReference>;\n\nconst AnnotationTool = z.object({\n  imageID: z.string(),\n  frameOfReference: FrameOfReference,\n  slice: z.number(),\n  id: z.string(),\n  name: z.string(),\n  color: z.string(),\n  label: z.string().optional(),\n  labelName: z.string().optional(),\n}) satisfies z.ZodType<AnnotationTool>;\n\nconst makeToolEntry = <T extends z.ZodRawShape>(tool: z.ZodObject<T>) =>\n  z.object({ tools: z.array(tool), labels: z.record(tool.partial()) });\n\nconst Ruler = AnnotationTool.extend({\n  firstPoint: Vector3,\n  secondPoint: Vector3,\n}) satisfies z.ZodType<Ruler>;\n\nconst Rulers = makeToolEntry(Ruler);\n\nconst Rectangle = Ruler.extend({\n  id: z.string() as unknown as z.ZodType<Rectangle['id']>,\n  fillColor: z.string().optional(),\n}) satisfies z.ZodType<Optional<Rectangle, 'fillColor'>>;\n\nconst Rectangles = makeToolEntry(Rectangle);\n\nconst Crosshairs = z.object({\n  position: Vector3,\n});\n\nexport type Crosshairs = z.infer<typeof Crosshairs>;\n\nconst ToolsEnumNative = z.nativeEnum(ToolsEnum);\n\nconst Paint = z.object({\n  activeLabelmapID: z.string().nullable(),\n  brushSize: z.number(),\n  brushValue: z.number(),\n  labelmapOpacity: z.number(),\n});\n\nconst LPSCroppingPlanes = z.object({\n  Sagittal: z.tuple([z.number(), z.number()]),\n  Coronal: z.tuple([z.number(), z.number()]),\n  Axial: z.tuple([z.number(), z.number()]),\n}) satisfies z.ZodType<LPSCroppingPlanes>;\n\nconst Cropping = z.record(LPSCroppingPlanes);\n\nconst Tools = z.object({\n  rulers: Rulers.optional(),\n  rectangles: Rectangles.optional(),\n  crosshairs: Crosshairs,\n  paint: Paint,\n  crop: Cropping,\n  current: ToolsEnumNative,\n});\n\nexport type Tools = z.infer<typeof Tools>;\n\nexport const ParentToLayers = z\n  .object({\n    selectionKey: z.string(),\n    sourceSelectionKeys: z.string().array(),\n  })\n  .array();\n\nexport type ParentToLayers = z.infer<typeof ParentToLayers>;\n\nexport const ManifestSchema = z.object({\n  version: z.string(),\n  datasets: Dataset.array(),\n  remoteFiles: z.record(RemoteFile.array()),\n  labelMaps: LabelMap.array(),\n  tools: Tools,\n  views: View.array(),\n  primarySelection: z.string().optional(),\n  layout: Layout,\n  parentToLayers: ParentToLayers,\n});\n\nexport type Manifest = z.infer<typeof ManifestSchema>;\n\nexport interface StateFile {\n  zip: JSZip;\n  manifest: Manifest;\n}\n","import { Maybe } from '@/src/types';\n\n/**\n * Represents a URI source with a file name for the downloaded resource.\n *\n * This can optionally be paired with a FileSource, indicating that the\n * FileSource is a remote FileSource.\n */\nexport interface UriSource {\n  uri: string;\n  name: string;\n}\n\n/**\n * Represents a user-specified file.\n *\n * This can optionally be paired with an ArchiveSource.\n */\nexport interface FileSource {\n  file: File;\n  fileType: string;\n}\n\n/**\n * If an archive source is specified, then it is assumed that the data source\n * has a FileSource (representing the file inside the archive), and a parent\n * data source with a FileSource that refers to the archive.\n */\nexport interface ArchiveSource {\n  // Full path + filename inside the archive\n  path: string;\n}\n\n/**\n * Used to collect DICOM file data sources.\n *\n * This is currently used for consolidating multiple DICOM files into one\n * DataSource for error stack trace purposes.\n */\nexport interface DicomSource {\n  // eslint-disable-next-line no-use-before-define\n  sources: DataSource[];\n}\n\n/**\n * Represents a source of data.\n *\n * If the parent property is set, it represents the DataSource from which this\n * DataSource was derived.\n *\n * Examples:\n * - { uriSrc }: a file that has yet to be downloaded.\n * - { fileSrc, parent: { uriSrc } }: a file with URI provenance info.\n * - { fileSrc, archiveSrc, parent }: a file originating from an archive.\n * - { dicomSrc }: a list of dicom data sources.\n */\nexport interface DataSource {\n  fileSrc?: FileSource;\n  uriSrc?: UriSource;\n  archiveSrc?: ArchiveSource;\n  dicomSrc?: DicomSource;\n  parent?: DataSource;\n}\n\nexport type DataSourceWithFile = DataSource & { fileSrc: FileSource };\n\n/**\n * Creates a DataSource from a single file.\n * @param file\n * @returns\n */\nexport const fileToDataSource = (file: File): DataSource => ({\n  fileSrc: {\n    file,\n    fileType: file.type,\n  },\n});\n\n/**\n * Creates a DataSource from a URI.\n * @param uri\n * @returns\n */\nexport const uriToDataSource = (uri: string, name: string): DataSource => ({\n  uriSrc: {\n    uri,\n    name,\n  },\n});\n\n/**\n * Creates a DataSource from a file downloaded from a URI.\n * @param uri\n * @returns\n */\nexport const remoteFileToDataSource = (\n  file: File,\n  uri: string\n): DataSource => ({\n  ...fileToDataSource(file),\n  ...uriToDataSource(uri, file.name),\n});\n\n/**\n * Determines if a data source has remote provenance.\n * @param ds\n * @returns\n */\nexport function isRemoteDataSource(ds: DataSource): boolean {\n  return !!ds.uriSrc || (!!ds.parent && isRemoteDataSource(ds.parent));\n}\n\n/**\n * Flattens a data source hierarchy, ordered by descendant first.\n *\n * For a given data source `ds`, `ds` is the descendant and `ds.parent` is the\n * ancestor.\n *\n * @param ds\n * @returns\n */\nexport function flattenDataSourceHierarchy(ds: DataSource): DataSource[] {\n  const sources: DataSource[] = [];\n  let cur: Maybe<DataSource> = ds;\n  while (cur) {\n    sources.push(cur);\n    cur = cur.parent;\n  }\n  return sources;\n}\n\n/**\n * Gets the name associated with a data source, if any.\n * @param ds\n */\nexport function getDataSourceName(ds: Maybe<DataSource>): Maybe<string> {\n  if (ds?.fileSrc) {\n    return ds.fileSrc.file.name;\n  }\n\n  if (ds?.uriSrc) {\n    return ds.uriSrc.name;\n  }\n\n  if (ds?.dicomSrc?.sources.length) {\n    const { sources } = ds.dicomSrc;\n    const [first] = sources;\n    const more = sources.length > 1 ? ` (+${sources.length - 1} more)` : '';\n    return `${getDataSourceName(first)}${more}`;\n  }\n\n  return null;\n}\n\n/**\n * Serializes a data source into a JSON formattable object.\n *\n * FileSources are stripped, as they cannot be properly serialized. This\n * includes the fileType property, which should be inferred when retyping the\n * file.\n * @param ds\n */\nexport function serializeDataSource(ds: DataSource) {\n  const output = { ...ds };\n  delete output.fileSrc;\n  if (output.parent) {\n    output.parent = serializeDataSource(output.parent);\n  }\n  return output;\n}\n","import { defineStore } from 'pinia';\nimport { DataSourceWithFile } from '@/src/io/import/dataSource';\n\ninterface State {\n  byDataID: Record<string, DataSourceWithFile[]>;\n}\n\n/**\n * Store the File objects associated with a given dataset.\n */\nexport const useFileStore = defineStore('files', {\n  state: (): State => ({\n    byDataID: {},\n  }),\n\n  getters: {\n    // Returns DataSource[] used to build a dataID\n    getDataSources: (state) => (dataID: string) => state.byDataID[dataID] ?? [],\n\n    // Returns [File] used to build a dataID\n    getFiles: (state) => (dataID: string) =>\n      (state.byDataID[dataID] ?? []).map((ds) => ds.fileSrc.file),\n  },\n\n  actions: {\n    remove(dataID: string) {\n      if (dataID in this.byDataID) {\n        delete this.byDataID[dataID];\n      }\n    },\n\n    add(dataID: string, files: DataSourceWithFile[]) {\n      this.byDataID[dataID] = files;\n    },\n  },\n});\n","import { partition } from '@/src/utils';\nimport {\n  isRemoteDataSource,\n  serializeDataSource,\n} from '@/src/io/import/dataSource';\nimport { StateFile, DatasetType } from './schema';\nimport { useFileStore } from '../../store/datasets-files';\n\nexport async function serializeData(\n  stateFile: StateFile,\n  dataIDs: string[],\n  dataType: DatasetType\n) {\n  const fileStore = useFileStore();\n  const { zip } = stateFile;\n  const {\n    manifest: { datasets, remoteFiles },\n  } = stateFile;\n\n  dataIDs.forEach((id) => {\n    const sources = fileStore.getDataSources(id);\n    if (!sources.length) {\n      throw new Error(`No files for dataID: ${id}`);\n    }\n\n    const [remotes, toZip] = partition(isRemoteDataSource, sources);\n\n    remoteFiles[id] = remotes.map(serializeDataSource);\n\n    const dataPath = `data/${id}/`;\n\n    toZip.forEach((ds) => {\n      const { file } = ds.fileSrc;\n      const filePath = `${dataPath}/${file.name}`;\n      zip.file(filePath, file);\n    });\n\n    datasets.push({\n      id,\n      path: dataPath,\n      type: dataType,\n    });\n  });\n}\n","import { defineStore } from 'pinia';\nimport { vec3, mat3, mat4 } from 'gl-matrix';\nimport { vtkImageData } from '@kitware/vtk.js/Common/DataModel/ImageData';\nimport type { Bounds } from '@kitware/vtk.js/types';\n\nimport { useIdStore } from '@/src/store/id';\nimport { defaultLPSDirections, getLPSDirections } from '../utils/lps';\nimport { removeFromArray } from '../utils';\nimport { StateFile, DatasetType } from '../io/state-file/schema';\nimport { serializeData } from '../io/state-file/utils';\nimport { useFileStore } from './datasets-files';\nimport { ImageMetadata } from '../types/image';\n\nexport const defaultImageMetadata = () => ({\n  name: '(none)',\n  orientation: mat3.create(),\n  lpsOrientation: defaultLPSDirections(),\n  spacing: vec3.fromValues(1, 1, 1),\n  origin: vec3.create(),\n  dimensions: vec3.fromValues(1, 1, 1),\n  worldBounds: [0, 1, 0, 1, 0, 1] as Bounds,\n  worldToIndex: mat4.create(),\n  indexToWorld: mat4.create(),\n});\n\ninterface State {\n  idList: string[]; // list of IDs\n  dataIndex: Record<string, vtkImageData>; // ID -> VTK object\n  metadata: Record<string, ImageMetadata>; // ID -> metadata\n}\n\nexport const useImageStore = defineStore('images', {\n  state: (): State => ({\n    idList: [],\n    dataIndex: Object.create(null),\n    metadata: Object.create(null),\n  }),\n  actions: {\n    addVTKImageData(name: string, imageData: vtkImageData) {\n      const id = useIdStore().nextId();\n\n      this.idList.push(id);\n      this.dataIndex[id] = imageData;\n\n      this.$proxies.addData(id, imageData);\n\n      this.metadata[id] = { ...defaultImageMetadata(), name };\n      this.updateData(id, imageData);\n      return id;\n    },\n\n    updateData(id: string, imageData: vtkImageData) {\n      if (id in this.metadata) {\n        const metadata: ImageMetadata = {\n          name: this.metadata[id].name,\n          dimensions: imageData.getDimensions() as vec3,\n          spacing: imageData.getSpacing() as vec3,\n          origin: imageData.getOrigin() as vec3,\n          orientation: imageData.getDirection(),\n          lpsOrientation: getLPSDirections(imageData.getDirection()),\n          worldBounds: imageData.getBounds(),\n          worldToIndex: imageData.getWorldToIndex(),\n          indexToWorld: imageData.getIndexToWorld(),\n        };\n\n        this.metadata[id] = metadata;\n      }\n      this.$proxies.updateData(id, imageData);\n      this.dataIndex[id] = imageData;\n    },\n\n    deleteData(id: string) {\n      if (id in this.dataIndex) {\n        delete this.dataIndex[id];\n        delete this.metadata[id];\n        removeFromArray(this.idList, id);\n      }\n    },\n\n    async serialize(stateFile: StateFile) {\n      const fileStore = useFileStore();\n      // We want to filter out volume images (which are generated and don't have\n      // input files in fileStore with matching imageID.)\n      const dataIDs = this.idList.filter((id) => id in fileStore.byDataID);\n\n      await serializeData(stateFile, dataIDs, DatasetType.IMAGE);\n    },\n  },\n});\n","import vtkITKHelper from '@kitware/vtk.js/Common/DataModel/ITKHelper';\nimport { defineStore } from 'pinia';\nimport { Image } from 'itk-wasm';\nimport { DataSourceWithFile } from '@/src/io/import/dataSource';\nimport { pick, removeFromArray } from '../utils';\nimport { useImageStore } from './datasets-images';\nimport { useFileStore } from './datasets-files';\nimport { StateFile, DatasetType } from '../io/state-file/schema';\nimport { serializeData } from '../io/state-file/utils';\nimport { DICOMIO } from '../io/dicom';\n\nexport const ANONYMOUS_PATIENT = 'Anonymous';\nexport const ANONYMOUS_PATIENT_ID = 'ANONYMOUS';\n\nexport function imageCacheMultiKey(offset: number, asThumbnail: boolean) {\n  return `${offset}!!${asThumbnail}`;\n}\n\nexport interface VolumeKeys {\n  patientKey: string;\n  studyKey: string;\n  volumeKey: string;\n}\n\nexport interface PatientInfo {\n  PatientID: string;\n  PatientName: string;\n  PatientBirthDate: string;\n  PatientSex: string;\n}\n\nexport interface StudyInfo {\n  StudyID: string;\n  StudyInstanceUID: string;\n  StudyDate: string;\n  StudyTime: string;\n  AccessionNumber: string;\n  StudyDescription: string;\n}\n\nexport interface VolumeInfo {\n  NumberOfSlices: number;\n  VolumeID: string;\n  Modality: string;\n  SeriesInstanceUID: string;\n  SeriesNumber: string;\n  SeriesDescription: string;\n}\n\ninterface State {\n  // volumeKey -> imageCacheMultiKey -> ITKImage\n  sliceData: Record<string, Record<string, Image>>;\n\n  // volumeKey -> imageID\n  volumeToImageID: Record<string, string | undefined>;\n  // imageID -> volumeKey\n  imageIDToVolumeKey: Record<string, string>;\n\n  // volume invalidation information\n  needsRebuild: Record<string, boolean>;\n\n  // patientKey -> patient info\n  patientInfo: Record<string, PatientInfo>;\n  // patientKey -> array of studyKeys\n  patientStudies: Record<string, string[]>;\n\n  // studyKey -> study info\n  studyInfo: Record<string, StudyInfo>;\n  // studyKey -> array of volumeKeys\n  studyVolumes: Record<string, string[]>;\n\n  // volumeKey -> volume info\n  volumeInfo: Record<string, VolumeInfo>;\n\n  // parent pointers\n  // volumeKey -> studyKey\n  volumeStudy: Record<string, string>;\n  // studyKey -> patientKey\n  studyPatient: Record<string, string>;\n}\n\nconst readDicomTags = (dicomIO: DICOMIO, file: File) =>\n  dicomIO.readTags(file, [\n    { name: 'PatientName', tag: '0010|0010', strconv: true },\n    { name: 'PatientID', tag: '0010|0020', strconv: true },\n    { name: 'PatientBirthDate', tag: '0010|0030' },\n    { name: 'PatientSex', tag: '0010|0040' },\n    { name: 'StudyInstanceUID', tag: '0020|000d' },\n    { name: 'StudyDate', tag: '0008|0020' },\n    { name: 'StudyTime', tag: '0008|0030' },\n    { name: 'StudyID', tag: '0020|0010', strconv: true },\n    { name: 'AccessionNumber', tag: '0008|0050' },\n    { name: 'StudyDescription', tag: '0008|1030', strconv: true },\n    { name: 'Modality', tag: '0008|0060' },\n    { name: 'SeriesInstanceUID', tag: '0020|000e' },\n    { name: 'SeriesNumber', tag: '0020|0011' },\n    { name: 'SeriesDescription', tag: '0008|103e', strconv: true },\n  ]);\n\nexport const useDICOMStore = defineStore('dicom', {\n  state: (): State => ({\n    sliceData: {},\n    volumeToImageID: {},\n    imageIDToVolumeKey: {},\n    patientInfo: {},\n    patientStudies: {},\n    studyInfo: {},\n    studyVolumes: {},\n    volumeInfo: {},\n    volumeStudy: {},\n    studyPatient: {},\n    needsRebuild: {},\n  }),\n  actions: {\n    async importFiles(datasets: DataSourceWithFile[]) {\n      if (!datasets.length) return [];\n\n      const dicomIO = this.$dicomIO;\n\n      const fileToDataSource = new Map(\n        datasets.map((ds) => [ds.fileSrc.file, ds])\n      );\n      const allFiles = [...fileToDataSource.keys()];\n\n      const volumeToFiles = await dicomIO.categorizeFiles(allFiles);\n\n      const fileStore = useFileStore();\n\n      // Link VolumeKey and DatasetFiles in fileStore\n      Object.entries(volumeToFiles).forEach(([volumeKey, files]) => {\n        const volumeDatasetFiles = files.map((file) => {\n          const source = fileToDataSource.get(file);\n          if (!source)\n            throw new Error('Did not match File with source DataSource');\n          return source;\n        });\n        fileStore.add(volumeKey, volumeDatasetFiles);\n      });\n\n      await Promise.all(\n        Object.entries(volumeToFiles).map(async ([volumeKey, files]) => {\n          // Read tags of first file\n          if (!(volumeKey in this.volumeInfo)) {\n            const tags = await readDicomTags(dicomIO, files[0]);\n            // TODO parse the raw string values\n            const patient = {\n              PatientID: tags.PatientID || ANONYMOUS_PATIENT_ID,\n              PatientName: tags.PatientName || ANONYMOUS_PATIENT,\n              PatientBirthDate: tags.PatientBirthDate || '',\n              PatientSex: tags.PatientSex || '',\n            };\n\n            const study = pick(\n              tags,\n              'StudyID',\n              'StudyInstanceUID',\n              'StudyDate',\n              'StudyTime',\n              'AccessionNumber',\n              'StudyDescription'\n            );\n\n            const volumeInfo = {\n              ...pick(\n                tags,\n                'Modality',\n                'SeriesInstanceUID',\n                'SeriesNumber',\n                'SeriesDescription'\n              ),\n              NumberOfSlices: files.length,\n              VolumeID: volumeKey,\n            };\n\n            this._updateDatabase(patient, study, volumeInfo);\n          }\n\n          // invalidate any existing volume\n          if (volumeKey in this.volumeToImageID) {\n            // buildVolume requestor uses this as a rebuild hint\n            this.needsRebuild[volumeKey] = true;\n          }\n        })\n      );\n\n      return Object.keys(volumeToFiles);\n    },\n\n    _updateDatabase(\n      patient: PatientInfo,\n      study: StudyInfo,\n      volume: VolumeInfo\n    ) {\n      const patientKey = patient.PatientID;\n      const studyKey = study.StudyInstanceUID;\n      const volumeKey = volume.VolumeID;\n\n      if (!(patientKey in this.patientInfo)) {\n        this.patientInfo[patientKey] = patient;\n        this.patientStudies[patientKey] = [];\n      }\n\n      if (!(studyKey in this.studyInfo)) {\n        this.studyInfo[studyKey] = study;\n        this.studyVolumes[studyKey] = [];\n        this.studyPatient[studyKey] = patientKey;\n        this.patientStudies[patientKey].push(studyKey);\n      }\n\n      if (!(volumeKey in this.volumeInfo)) {\n        this.volumeInfo[volumeKey] = volume;\n        this.volumeStudy[volumeKey] = studyKey;\n        this.sliceData[volumeKey] = {};\n        this.studyVolumes[studyKey].push(volumeKey);\n      }\n    },\n\n    deleteVolume(volumeKey: string) {\n      const imageStore = useImageStore();\n      if (volumeKey in this.volumeInfo) {\n        const studyKey = this.volumeStudy[volumeKey];\n        delete this.volumeInfo[volumeKey];\n        delete this.sliceData[volumeKey];\n        delete this.volumeStudy[volumeKey];\n\n        if (volumeKey in this.volumeToImageID) {\n          const imageID = this.volumeToImageID[volumeKey]!;\n          imageStore.deleteData(imageID!);\n          delete this.volumeToImageID[volumeKey];\n          delete this.imageIDToVolumeKey[imageID];\n        }\n\n        removeFromArray(this.studyVolumes[studyKey], volumeKey);\n        if (this.studyVolumes[studyKey].length === 0) {\n          this.deleteStudy(studyKey);\n        }\n      }\n    },\n\n    deleteStudy(studyKey: string) {\n      if (studyKey in this.studyInfo) {\n        const patientKey = this.studyPatient[studyKey];\n        delete this.studyInfo[studyKey];\n        delete this.studyPatient[studyKey];\n\n        [...this.studyVolumes[studyKey]].forEach((volumeKey) =>\n          this.deleteVolume(volumeKey)\n        );\n        delete this.studyVolumes[studyKey];\n\n        removeFromArray(this.patientStudies[patientKey], studyKey);\n        if (this.patientStudies[patientKey].length === 0) {\n          this.deletePatient(patientKey);\n        }\n      }\n    },\n\n    deletePatient(patientKey: string) {\n      if (patientKey in this.patientInfo) {\n        delete this.patientInfo[patientKey];\n\n        [...this.patientStudies[patientKey]].forEach((studyKey) =>\n          this.deleteStudy(studyKey)\n        );\n        delete this.patientStudies[patientKey];\n      }\n    },\n\n    async serialize(stateFile: StateFile) {\n      const dataIDs = Object.keys(this.volumeInfo);\n      await serializeData(stateFile, dataIDs, DatasetType.DICOM);\n    },\n\n    async deserialize(files: DataSourceWithFile[]) {\n      return this.importFiles(files).then((volumeKeys) => {\n        if (volumeKeys.length !== 1) {\n          // Volumes are store individually so we should get one back.\n          throw new Error('Invalid state file.');\n        }\n\n        return volumeKeys[0];\n      });\n    },\n\n    // returns an ITK image object\n    async getVolumeSlice(\n      volumeKey: string,\n      sliceIndex: number,\n      asThumbnail = false\n    ) {\n      const dicomIO = this.$dicomIO;\n      const fileStore = useFileStore();\n\n      const cacheKey = imageCacheMultiKey(sliceIndex, asThumbnail);\n      if (\n        volumeKey in this.sliceData &&\n        cacheKey in this.sliceData[volumeKey]\n      ) {\n        return this.sliceData[volumeKey][cacheKey];\n      }\n\n      if (!(volumeKey in this.volumeInfo)) {\n        throw new Error(`Cannot find given volume key: ${volumeKey}`);\n      }\n      const volumeInfo = this.volumeInfo[volumeKey];\n      const numSlices = volumeInfo.NumberOfSlices;\n\n      if (sliceIndex < 1 || sliceIndex > numSlices) {\n        throw new Error(`Slice ${sliceIndex} is out of bounds`);\n      }\n\n      const volumeFiles = fileStore.getFiles(volumeKey);\n\n      if (!volumeFiles) {\n        throw new Error(`No files found for volume key: ${volumeKey}`);\n      }\n\n      const sliceFile = volumeFiles[sliceIndex - 1];\n\n      const itkImage = await dicomIO.getVolumeSlice(sliceFile, asThumbnail);\n\n      this.sliceData[volumeKey][cacheKey] = itkImage;\n      return itkImage;\n    },\n\n    // returns an ITK image object\n    async getVolumeThumbnail(volumeKey: string) {\n      const { NumberOfSlices } = this.volumeInfo[volumeKey];\n      const middleSlice = Math.ceil(NumberOfSlices / 2);\n      return this.getVolumeSlice(volumeKey, middleSlice, true);\n    },\n\n    async buildVolume(volumeKey: string, forceRebuild: boolean = false) {\n      const imageStore = useImageStore();\n      const dicomIO = this.$dicomIO;\n\n      const rebuild = forceRebuild || this.needsRebuild[volumeKey];\n\n      if (!rebuild && this.volumeToImageID[volumeKey]) {\n        const imageID = this.volumeToImageID[volumeKey]!;\n        return imageStore.dataIndex[imageID];\n      }\n\n      const fileStore = useFileStore();\n      const files = fileStore.getFiles(volumeKey);\n      if (!files) throw new Error('No files for volume key');\n      const image = vtkITKHelper.convertItkToVtkImage(\n        await dicomIO.buildImage(files)\n      );\n\n      const existingImageID = this.volumeToImageID[volumeKey];\n      if (existingImageID) {\n        imageStore.updateData(existingImageID, image);\n      } else {\n        const name = this.volumeInfo[volumeKey].SeriesInstanceUID;\n        const imageID = imageStore.addVTKImageData(name, image);\n        this.imageIDToVolumeKey[imageID] = volumeKey;\n        this.volumeToImageID[volumeKey] = imageID;\n      }\n\n      delete this.needsRebuild[volumeKey];\n\n      return image;\n    },\n  },\n});\n","import { defineStore } from 'pinia';\nimport vtkPolyData from '@kitware/vtk.js/Common/DataModel/PolyData';\nimport { useIdStore } from '@/src/store/id';\n\ninterface State {\n  idList: string[]; // list of IDs\n  dataIndex: Record<string, vtkPolyData>; // ID -> VTK object\n  metadata: Record<string, {}>; // ID -> metadata\n}\nexport const useModelStore = defineStore('models', {\n  state: (): State => ({\n    idList: [],\n    dataIndex: {},\n    metadata: {},\n  }),\n  actions: {\n    addVTKPolyData(name: string, polyData: vtkPolyData) {\n      const id = useIdStore().nextId();\n      this.idList.push(id);\n      this.dataIndex[id] = polyData;\n      this.$proxies.addData(id, polyData);\n      return id;\n    },\n  },\n});\n","import { defineStore } from 'pinia';\nimport { removeFromArray } from '../utils';\n\nexport enum MessageType {\n  Error,\n  Warning,\n  Info,\n  Success,\n}\n\nexport type MessageOptions = {\n  details?: string;\n  persist?: boolean;\n};\n\nexport interface Message {\n  id: string;\n  type: MessageType;\n  title: string;\n  options: MessageOptions;\n}\n\nexport type UpdateProgressFunction = (progress: number) => void;\nexport type TaskFunction = (updateProgress?: UpdateProgressFunction) => any;\ninterface State {\n  _nextID: number;\n  byID: Record<string, Message>;\n  msgList: string[];\n}\n\nexport const useMessageStore = defineStore('message', {\n  state: (): State => ({\n    _nextID: 1,\n    byID: {},\n    msgList: [],\n  }),\n  getters: {\n    messages(): Array<Message> {\n      return this.msgList.map((id: string) => this.byID[id]);\n    },\n    // only info, error, warn\n    importantMessages(): Array<Message> {\n      return this.messages.filter((msg) => msg.type !== MessageType.Success);\n    },\n  },\n  actions: {\n    /**\n     * Adds an error message.\n     * @param title message title\n     * @param opts an Error, a string containing details, or a MessageOptions\n     */\n    addError(title: string, opts?: Error | string | MessageOptions) {\n      if (opts instanceof Error) {\n        return this._addMessage(\n          {\n            type: MessageType.Error,\n            title,\n          },\n          {\n            details: String(opts),\n            persist: false,\n          }\n        );\n      }\n      return this._addMessage(\n        {\n          type: MessageType.Error,\n          title,\n        },\n        opts\n      );\n    },\n    /**\n     * Adds a warning message.\n     * @param title message title\n     * @param opts a string containing details or a MessageOptions\n     */\n    addWarning(title: string, details?: string | MessageOptions) {\n      return this._addMessage(\n        {\n          type: MessageType.Warning,\n          title,\n        },\n        details\n      );\n    },\n    /**\n     * Adds a success message.\n     * @param title message title\n     * @param opts a string containing details or a MessageOptions\n     */\n    addInfo(title: string, details?: string | MessageOptions) {\n      return this._addMessage(\n        {\n          type: MessageType.Info,\n          title,\n        },\n        details\n      );\n    },\n    /**\n     * Adds a success message.\n     * @param title message title\n     * @param opts a string containing details or a MessageOptions\n     */\n    addSuccess(title: string, details?: string | MessageOptions) {\n      return this._addMessage(\n        {\n          type: MessageType.Success,\n          title,\n        },\n        details\n      );\n    },\n    clearOne(id: string) {\n      if (id in this.byID) {\n        removeFromArray(this.msgList, id);\n        delete this.byID[id];\n      }\n    },\n    clearAll() {\n      this.byID = {};\n      this.msgList = [];\n    },\n    _addMessage(\n      msg: Omit<Message, 'id' | 'options'>,\n      details?: string | MessageOptions\n    ) {\n      const id = String(this._nextID++);\n      const options: MessageOptions = {\n        persist: false,\n        ...(typeof details === 'string' ? { details } : details),\n      };\n      this.byID[id] = {\n        ...msg,\n        options,\n        id,\n      };\n      this.msgList.push(id);\n      return id;\n    },\n  },\n});\n","import { useMessageStore } from '../store/messages';\n\nexport async function useErrorMessage(message: string, task: Function) {\n  try {\n    return await task();\n  } catch (err) {\n    if (err instanceof Error) {\n      const messageStore = useMessageStore();\n      messageStore.addError(message, {\n        details: `${err}. More details can be found in the developer's console.`,\n      });\n    }\n    console.error(err);\n  }\n  return undefined;\n}\n","import vtkImageData from '@kitware/vtk.js/Common/DataModel/ImageData';\nimport { vtkObject } from '@kitware/vtk.js/interfaces';\nimport { defineStore } from 'pinia';\nimport { computed, ref } from 'vue';\nimport { useDICOMStore } from './datasets-dicom';\nimport { useImageStore } from './datasets-images';\nimport { useModelStore } from './datasets-models';\nimport { useFileStore } from './datasets-files';\nimport { StateFile } from '../io/state-file/schema';\nimport { useErrorMessage } from '../composables/useErrorMessage';\n\nexport const DataType = {\n  Image: 'Image',\n  Model: 'Model',\n};\n\nexport const makeDICOMSelection = (volumeKey: string) =>\n  ({\n    type: 'dicom',\n    volumeKey,\n  } as const);\n\nexport type DICOMSelection = ReturnType<typeof makeDICOMSelection>;\n\nexport const makeImageSelection = (imageID: string) =>\n  ({\n    type: 'image',\n    dataID: imageID,\n  } as const);\n\nexport type ImageSelection = ReturnType<typeof makeImageSelection>;\n\nexport type DataSelection = DICOMSelection | ImageSelection;\n\nexport const getImageID = (selection: DataSelection) => {\n  if (selection.type === 'image') return selection.dataID;\n  if (selection.type === 'dicom')\n    return useDICOMStore().volumeToImageID[selection.volumeKey]; // volume selected, but image may not have been made yet\n\n  const _exhaustiveCheck: never = selection;\n  throw new Error(`invalid selection type ${_exhaustiveCheck}`);\n};\n\nexport const getImage = async (selection: DataSelection) => {\n  const images = useImageStore();\n  const dicoms = useDICOMStore();\n  if (selection.type === 'dicom') {\n    // ensure image data exists\n    await useErrorMessage('Failed to build volume', () =>\n      dicoms.buildVolume(selection.volumeKey)\n    );\n    return images.dataIndex[getImageID(selection)!];\n  }\n  // just an image that should be in dataIndex\n  return images.dataIndex[selection.dataID];\n};\n\n// Converts imageID to VolumeKey if exists, else return input imageID\nexport const getDataID = (imageID: string) => {\n  const dicomStore = useDICOMStore();\n  return dicomStore.imageIDToVolumeKey[imageID] ?? imageID;\n};\n\n// Pass VolumeKey or ImageID and get ImageID\nexport const findImageID = (dataID: string) => {\n  const dicomStore = useDICOMStore();\n  return dicomStore.volumeToImageID[dataID] ?? dataID;\n};\n\nexport function selectionEquals(s1: DataSelection, s2: DataSelection) {\n  if (s1.type === 'dicom' && s2.type === 'dicom') {\n    return s1.volumeKey === s2.volumeKey;\n  }\n  if (s1.type === 'image' && s2.type === 'image') {\n    return s1.dataID === s2.dataID;\n  }\n  return false;\n}\n\nexport const useDatasetStore = defineStore('dataset', () => {\n  type _This = ReturnType<typeof useDatasetStore>;\n\n  const imageStore = useImageStore();\n  const modelStore = useModelStore();\n  const dicomStore = useDICOMStore();\n  const fileStore = useFileStore();\n\n  // --- state --- //\n\n  const primarySelection = ref<DataSelection | null>(null);\n\n  // --- getters --- //\n\n  const primaryImageID = computed(() => {\n    if (primarySelection.value) return getImageID(primarySelection.value);\n    return undefined;\n  });\n\n  const primaryDataset = computed<vtkImageData | null>(() => {\n    const { dataIndex } = imageStore;\n    return (primaryImageID.value && dataIndex[primaryImageID.value]) || null;\n  });\n\n  const allDataIDs = computed(() => {\n    return [...imageStore.idList, ...modelStore.idList];\n  });\n\n  function getDataProxyByID<T extends vtkObject>(this: _This, id: string) {\n    return this.$proxies.getData<T>(id);\n  }\n\n  // --- actions --- //\n\n  function setPrimarySelection(sel: DataSelection | null) {\n    primarySelection.value = sel;\n\n    if (sel === null) {\n      return;\n    }\n\n    // if selection is dicom, call buildVolume\n    if (sel.type === 'dicom') {\n      useErrorMessage('Failed to build volume', () =>\n        dicomStore.buildVolume(sel.volumeKey)\n      );\n    }\n  }\n\n  async function serialize(stateFile: StateFile) {\n    await dicomStore.serialize(stateFile);\n    await imageStore.serialize(stateFile);\n\n    if (primarySelection.value !== null) {\n      let id = null;\n      if (primarySelection.value.type === 'dicom') {\n        id = primarySelection.value.volumeKey;\n      } else {\n        id = primarySelection.value.dataID;\n      }\n\n      const { manifest } = stateFile;\n      manifest.primarySelection = id;\n    }\n  }\n\n  // --- watch for deletion --- //\n\n  imageStore.$onAction(({ name, args, after }) => {\n    if (name !== 'deleteData') {\n      return;\n    }\n    after(() => {\n      const [id] = args;\n      const sel = primarySelection.value;\n      if (sel?.type === 'image' && sel.dataID === id) {\n        primarySelection.value = null;\n      }\n      // remove file store entry\n      fileStore.remove(id);\n    });\n  });\n\n  dicomStore.$onAction(({ name, args, after }) => {\n    if (name !== 'deleteVolume') {\n      return;\n    }\n\n    after(() => {\n      const [volumeKey] = args;\n      const sel = primarySelection.value;\n      if (sel?.type === 'dicom' && volumeKey === sel.volumeKey) {\n        primarySelection.value = null;\n      }\n\n      fileStore.remove(volumeKey);\n    });\n  });\n\n  return {\n    primarySelection,\n    primaryDataset,\n    allDataIDs,\n    getDataProxyByID,\n    setPrimarySelection,\n    serialize,\n  };\n});\n","import { Awaitable } from '@vueuse/core';\nimport { Maybe } from '@/src/types';\nimport { defer, partition } from '../utils';\n\n/**\n * Represents a pipeline error.\n *\n * The inputDataStackTrace property provides the inputs that caused the error.\n * It is ordered by nested level, starting with the inner most execution context\n * input.\n *\n * The cause property refers to the original thrown object that resulted in the\n * error.\n */\nexport interface PipelineError<DataType> {\n  message: string;\n  inputDataStackTrace: DataType[];\n  cause: unknown;\n}\n\n/**\n * Represents a pipeline's execution result.\n *\n * The data property holds any return values from handlers.\n *\n * The errors property holds any errors reported from (potentially nested)\n * executions.\n */\nexport interface PipelineResult<DataType, ResultType> {\n  ok: boolean;\n  data: ResultType[];\n  errors: PipelineError<DataType>[];\n}\n\nfunction createPipelineError<DataType>(\n  message: string,\n  input: DataType,\n  cause: unknown\n) {\n  return {\n    message,\n    inputDataStackTrace: [input],\n    cause,\n  };\n}\n\nexport interface IPipeline<DataType, ResultType> {\n  /**\n   * Runs a given input through a middleware pipeline.\n   * @param input\n   */\n  execute(input: DataType): Promise<PipelineResult<DataType, ResultType>>;\n}\n\nconst DoneSentinel: symbol = Symbol('DoneSentinel');\ntype DoneSentinelType = symbol;\nexport type Done<Out> = (out?: Out) => DoneSentinelType;\n\nexport interface PipelineContext<DataType, ResultType, ExtraContext> {\n  /**\n   * Terminate the pipeline with an optional pipeline return value.\n   * @param pipelineReturn\n   */\n  done: Done<ResultType>;\n  /**\n   * Execute the pipeline with the given input.\n   * @param input\n   */\n  execute(\n    input: DataType,\n    extra?: ExtraContext\n  ): Promise<PipelineResult<DataType, ResultType>>;\n  /**\n   * Any extra user-supplied data.\n   */\n  extra?: ExtraContext;\n}\n\n/**\n * Represents an element/step of a pipeline.\n *\n * Handlers have three pipeline operations availble to them:\n * - process input and produce output for the rest of the pipeline\n * - terminate the pipeline and optionally produce a result\n * - start a nested execution of the pipeline with new data\n *\n * Handlers receive input data via the `input` parameter and pass data down the\n * pipeline by returning. Pipeline execution will await asynchronous handlers if\n * they return a Promise that resolves to the output data.\n *\n * The second argument to a handler is a context object containing an\n * `execute()` method and a `done()` method.\n *\n * A handler is free to start new pipeline executions by calling\n * `execute(input)`.  The handler does not need to await the `execute` call, as\n * the top-level pipeline will track all nested executions.\n *\n * If a handler wishes to terminate the pipeline, it must call `done()`. This\n * will signal the pipeline to terminate after the handler returns.  An optional\n * pipeline result value can be passed as the single argument to `done(output)`.\n * If `done()` is signalled, then the handler's return value is ignored.\n *\n * To facilitate typing and to avoid accidentally forgetting to return a value\n * in a handler, handlers are typed to return either the DataType or the return\n * value of done().\n */\nexport type Handler<\n  DataType,\n  ResultType = undefined,\n  ExtraContext = undefined\n> = (\n  input: DataType,\n  context: PipelineContext<DataType, ResultType, ExtraContext>\n) => Awaitable<DataType | DoneSentinelType>;\n\n/**\n * Represents an executable pipeline.\n *\n * Features supported:\n * - Execution of a pipeline in the given order of the provided handlers\n * - Handlers can run nested executions of the same pipeline\n * - Handlers can optionally transform data for downstream use\n * - Early termination\n * - Reporting errors. This includes un-nesting errors from nested executions.\n * - Reporting data returned from terminating handlers, if any.\n */\nexport default class Pipeline<\n  DataType,\n  ResultType = undefined,\n  ExtraContext = undefined\n> implements IPipeline<DataType, ResultType>\n{\n  private handlers: Handler<DataType, ResultType, ExtraContext>[];\n\n  constructor(handlers?: Handler<DataType, ResultType, ExtraContext>[]) {\n    this.handlers = Array.from(handlers ?? []);\n  }\n\n  /**\n   * Executes the pipeline with a given input.\n   *\n   * This method will resolve once this execution context and all\n   * nested execution contexts have finished, allowing for aggregate\n   * error reporting.\n   *\n   * Extra context data can be passed to all handlers via the `.extra` property.\n   * In nested execution scenarios, handlers may choose to pass their own extra\n   * context data into `execute(arg, extra)`. If none is supplied, the extra\n   * context data from the outermost `execute()` call is used.\n   *\n   * @param input\n   * @param extraContext\n   * @returns {PipelineResult}\n   */\n  async execute(input: DataType, extraContext?: ExtraContext) {\n    return this.startExecutionContext(input, extraContext);\n  }\n\n  private async startExecutionContext(\n    input: DataType,\n    extraContext?: ExtraContext\n  ) {\n    const handlers = [...this.handlers];\n    const nestedExecutions: Array<\n      Promise<PipelineResult<DataType, ResultType>>\n    > = [];\n    const execution = defer<Maybe<ResultType>>();\n\n    const terminate = (result: Maybe<ResultType>, error?: Error) => {\n      if (error) {\n        execution.reject(error);\n      } else {\n        execution.resolve(result);\n      }\n    };\n\n    const invokeHandler = async (data: DataType, index: number) => {\n      let doneInvoked = false;\n      // eslint-disable-next-line no-undef-init\n      let pipelineResult: ResultType | undefined = undefined;\n      const endOfPipeline = index >= handlers.length;\n\n      const context: PipelineContext<DataType, ResultType, ExtraContext> = {\n        done: (out?: ResultType): DoneSentinelType => {\n          if (doneInvoked) {\n            throw new Error('done() called twice!');\n          }\n\n          doneInvoked = true;\n          pipelineResult = out;\n          return DoneSentinel;\n        },\n        execute: async (arg: DataType, innerExtra?: ExtraContext) => {\n          const promise = this.execute(arg, innerExtra ?? extraContext);\n          nestedExecutions.push(promise);\n          return promise;\n        },\n        extra: extraContext,\n      };\n\n      let output: DataType | DoneSentinelType;\n\n      if (endOfPipeline) {\n        output = DoneSentinel;\n      }\n\n      try {\n        if (endOfPipeline) {\n          output = DoneSentinel;\n        } else {\n          const handler = handlers[index];\n          output = await handler(data, context);\n        }\n      } catch (thrown) {\n        const error =\n          thrown instanceof Error\n            ? thrown\n            : new Error(thrown ? String(thrown) : 'Unknown error occurred');\n        terminate(undefined, error);\n        return;\n      }\n\n      if (doneInvoked || endOfPipeline) {\n        terminate(pipelineResult);\n        return;\n      }\n\n      invokeHandler(output as DataType, index + 1);\n    };\n\n    const result: PipelineResult<DataType, ResultType> = {\n      ok: true,\n      data: [],\n      errors: [],\n    };\n\n    try {\n      await invokeHandler(input, 0);\n      const ret = await execution.promise;\n      if (ret != null) {\n        result.data.push(ret);\n      }\n    } catch (err) {\n      const message = err instanceof Error ? err.message : String(err);\n      result.ok = false;\n      result.errors.push(createPipelineError(message, input, err));\n    }\n\n    const innerResults = await Promise.all(nestedExecutions);\n    const [succeededInner, failedInner] = partition(\n      (res) => res.ok,\n      innerResults\n    );\n\n    if (failedInner.length > 0) {\n      result.ok = false;\n    }\n\n    succeededInner.forEach((okResult) => {\n      result.data.push(...okResult.data);\n    });\n\n    failedInner.forEach((failedResult) => {\n      const { errors } = failedResult;\n\n      // add current input to the input stack trace\n      errors.forEach((err) => {\n        err.inputDataStackTrace.push(input);\n      });\n\n      result.errors.push(...errors);\n    });\n\n    return result;\n  }\n}\n","import { ImportHandler } from '@/src/io/import/common';\n\n/**\n * Adds DICOM files to the extra context.\n * @param dataSource\n * @returns\n */\nconst handleDicomFile: ImportHandler = (dataSource, { extra, done }) => {\n  const { fileSrc } = dataSource;\n  if (extra?.dicomDataSources && fileSrc?.fileType === 'application/dicom') {\n    extra.dicomDataSources.push(dataSource);\n    return done();\n  }\n  return dataSource;\n};\n\nexport default handleDicomFile;\n","import { Awaitable } from '@vueuse/core';\nimport { URL } from 'whatwg-url';\n\n/**\n * Percent is in [0, 1]. If it's Infinity, then the progress is indeterminate.\n */\nexport type ProgressCallback = (percent: number) => void;\n\nexport interface FetchCache<T> extends Map<string, Awaitable<T>> {}\n\nexport interface FetchOptions<T> {\n  progress?: ProgressCallback;\n  cache?: FetchCache<T>;\n}\n\ninterface URLHandler {\n  testURL(url: string): boolean;\n  fetchURL(url: string, options?: FetchOptions<unknown>): Promise<Blob | null>;\n}\n\n/**\n * Handles HTTP(S) connections.\n *\n * Progress is approximate, given that data can be sent over gzipped.\n */\nconst HTTPHandler: URLHandler = {\n  testURL: (url) => {\n    const { protocol } = new URL(url, window.location.href);\n    return protocol === 'http:' || protocol === 'https:';\n  },\n  fetchURL: async (url, options = {}) => {\n    const { progress } = options;\n\n    const response = await fetch(url);\n    if (response.status !== 200) {\n      throw new Error(\n        `Fetching resource failed (HTTP code ${response.status})`\n      );\n    }\n\n    if (!progress) {\n      return response.blob();\n    }\n\n    const contentLength = Number(response.headers.get('content-length')) ?? -1;\n    if (contentLength < 0) {\n      progress(Infinity);\n      return response.blob();\n    }\n\n    const reader = response.body?.getReader();\n    if (!reader) {\n      return null;\n    }\n\n    const bytes = new Uint8Array(contentLength);\n    let recv = 0;\n    let done = false;\n    do {\n      // eslint-disable-next-line no-await-in-loop\n      const readData = await reader.read();\n      done = readData.done;\n      if (readData.value && !done) {\n        bytes.set(readData.value, recv);\n        recv += readData.value.length;\n        progress(recv / contentLength);\n      }\n    } while (!done);\n\n    return new Blob([bytes]);\n  },\n};\n\nconst HANDLERS = [HTTPHandler];\n\nexport function canFetchUrl(url: string) {\n  return !!HANDLERS.find((h) => h.testURL(url));\n}\n\n/**\n * Fetches a file.\n * @returns a File instance.\n */\nexport async function fetchFile(\n  url: string,\n  name: string,\n  options?: FetchOptions<File>\n) {\n  const handler = HANDLERS.find((h) => h.testURL(url));\n  if (!handler) {\n    throw new Error(`Cannot find a handler for URL: ${url}`);\n  }\n\n  const cache = options?.cache;\n  if (cache?.has(url)) {\n    return cache.get(url)!;\n  }\n\n  const promise = handler.fetchURL(url, options).then((blob) => {\n    if (!blob) {\n      throw new Error(`Failed to download ${url}`);\n    }\n    return new File([blob], name);\n  });\n\n  // allow trying again on the off-chance the error is transient\n  promise.catch(() => {\n    cache?.delete(url);\n  });\n\n  cache?.set(url, promise);\n  return promise;\n}\n\n/**\n * Fetches json.\n * @returns json data\n */\nexport async function fetchJSON<T>(url: string, options?: FetchOptions<T>) {\n  const handler = HANDLERS.find((h) => h.testURL(url));\n  if (!handler) {\n    throw new Error(`Cannot find a handler for URL: ${url}`);\n  }\n\n  const blob = await handler.fetchURL(url, options);\n  if (!blob) {\n    throw new Error(`Failed to download ${url}`);\n  }\n\n  const buffer = await blob.arrayBuffer();\n  const decoder = new TextDecoder();\n  return JSON.parse(decoder.decode(new Uint8Array(buffer))) as T;\n}\n","import { canFetchUrl, fetchFile } from '@/src/utils/fetch';\nimport { ImportHandler } from '@/src/io/import/common';\n\n/**\n * Downloads a URL to a file DataSource.\n *\n * Input: { uriSrc }\n * Output: { fileSrc, uriSrc }\n *\n * Provides optional caching if the execution context provides a cache.\n * @param dataSource\n * @returns\n */\nconst downloadUrl: ImportHandler = async (\n  dataSource,\n  { execute, done, extra }\n) => {\n  const { fileSrc, uriSrc } = dataSource;\n  if (!fileSrc && uriSrc && canFetchUrl(uriSrc.uri)) {\n    try {\n      const file = await fetchFile(uriSrc.uri, uriSrc.name, {\n        cache: extra?.fetchFileCache,\n      });\n      execute({\n        ...dataSource,\n        fileSrc: {\n          file,\n          fileType: '',\n        },\n      });\n      return done();\n    } catch (err) {\n      throw new Error(`Could not download URL ${uriSrc.uri}`, {\n        cause: err instanceof Error ? err : undefined,\n      });\n    }\n  }\n  return dataSource;\n};\n\nexport default downloadUrl;\n","import JSZip from 'jszip';\nimport { basename, dirname } from '@/src/utils/path';\nimport { FileEntry } from './types';\n\nexport async function extractFilesFromZip(zipFile: File): Promise<FileEntry[]> {\n  const zip = await JSZip.loadAsync(zipFile);\n  const promises: Promise<File>[] = [];\n  const paths: string[] = [];\n  zip.forEach((relPath, file) => {\n    if (!file.dir) {\n      const fileName = basename(file.name);\n      const path = dirname(file.name);\n      const fileEntry = zip.file(file.name);\n      if (fileEntry) {\n        promises.push(\n          fileEntry.async('blob').then((blob) => new File([blob], fileName))\n        );\n        paths.push(path);\n      }\n    }\n  });\n\n  return Promise.all(promises).then((files) => {\n    return files.map((file, index) => {\n      return {\n        file,\n        archivePath: paths[index],\n      };\n    });\n  });\n}\n","import { FetchCache } from '@/src/utils/fetch';\nimport { DataSource, FileSource } from '@/src/io/import/dataSource';\nimport { Handler } from '@/src/core/pipeline';\nimport { ARCHIVE_FILE_TYPES } from '@/src/io/mimeTypes';\nimport { Awaitable } from '@vueuse/core';\n\nexport interface ImportResult {\n  dataSource: DataSource;\n  dataID?: string;\n  dataType?: 'image' | 'dicom' | 'model';\n}\n\nexport type ArchiveContents = Record<string, File>;\nexport type ArchiveCache = Map<File, Awaitable<ArchiveContents>>;\n\nexport interface ImportContext {\n  // Caches URL responses\n  fetchFileCache?: FetchCache<File>;\n  // Caches archives. ArchiveFile -> { [archivePath]: File }\n  archiveCache?: ArchiveCache;\n  // Records dicom files\n  dicomDataSources?: DataSource[];\n}\n\nexport type ImportHandler = Handler<DataSource, ImportResult, ImportContext>;\n\nexport function isArchive(\n  ds: DataSource\n): ds is DataSource & { fileSrc: FileSource } {\n  return !!ds.fileSrc && ARCHIVE_FILE_TYPES.has(ds.fileSrc.fileType);\n}\n","import { extractFilesFromZip } from '@/src/io/zip';\nimport { ImportHandler, isArchive } from '@/src/io/import/common';\n\n/**\n * Extracts all files from an archive.\n * @param dataSource\n */\nconst extractArchive: ImportHandler = async (dataSource, { execute, done }) => {\n  if (isArchive(dataSource)) {\n    const files = await extractFilesFromZip(dataSource.fileSrc.file);\n    files.forEach((entry) => {\n      execute({\n        fileSrc: {\n          file: entry.file,\n          fileType: '',\n        },\n        archiveSrc: {\n          path: `${entry.archivePath}/${entry.file.name}`,\n        },\n        parent: dataSource,\n      });\n    });\n    return done();\n  }\n  return dataSource;\n};\n\nexport default extractArchive;\n","import {\n  ArchiveCache,\n  ArchiveContents,\n  ImportHandler,\n  isArchive,\n} from '@/src/io/import/common';\nimport { extractFilesFromZip } from '@/src/io/zip';\nimport { Maybe } from '@/src/types';\nimport * as path from '@/src/utils/path';\nimport { Awaitable } from '@vueuse/core';\n\nasync function extractArchiveContents(archiveFile: File, cache?: ArchiveCache) {\n  let contentsPromise: Maybe<Awaitable<ArchiveContents>> =\n    cache?.get(archiveFile);\n  if (contentsPromise) {\n    return contentsPromise;\n  }\n\n  contentsPromise = extractFilesFromZip(archiveFile).then((files) => {\n    return files.reduce((mapping, fileEntry) => {\n      const fullPath = path.join(fileEntry.archivePath, fileEntry.file.name);\n      return Object.assign(mapping, {\n        [fullPath]: fileEntry.file,\n      });\n    }, {} as ArchiveContents);\n  });\n\n  if (cache) {\n    cache.set(archiveFile, contentsPromise);\n  }\n\n  return contentsPromise;\n}\n\n/**\n * Extracts a single target file from an archive.\n *\n * If the fileSrc already exists, nothing is done. Otherwise, attempt to\n * extract the file from the parent archive.\n *\n * Input data source must be of the following form:\n * { archiveSrc, parent: DataSource with a fileSrc }\n * @param dataSource\n * @returns\n */\nconst extractArchiveTarget: ImportHandler = async (\n  dataSource,\n  { extra, execute, done }\n) => {\n  const { fileSrc, archiveSrc, parent } = dataSource;\n  const { archiveCache } = extra ?? {};\n\n  if (!fileSrc && archiveSrc && parent) {\n    if (!parent?.fileSrc) {\n      throw new Error(\n        'Cannot extract an archive target with an unresolved parent'\n      );\n    }\n\n    if (!isArchive(parent)) {\n      throw new Error('Parent is not a supported archive file');\n    }\n\n    const archiveContents = await extractArchiveContents(\n      parent.fileSrc.file,\n      archiveCache\n    );\n\n    const targetName = path.normalize(archiveSrc.path);\n    const targetFile = archiveContents[targetName];\n    if (!targetFile) {\n      throw new Error(`Failed to find archive member ${targetName}`);\n    }\n\n    execute({\n      ...dataSource,\n      fileSrc: {\n        file: targetFile,\n        fileType: '',\n      },\n    });\n    return done();\n  }\n\n  return dataSource;\n};\n\nexport default extractArchiveTarget;\n","import { S3Client, ListObjectsV2Command } from '@aws-sdk/client-s3';\nimport { URL } from 'whatwg-url';\n\n/**\n * Detects `s3://` uri.\n * @param uri\n * @returns\n */\nexport const isAmazonS3Uri = (uri: string) => new URL(uri).protocol === 's3:';\n\nexport type ObjectAvailableCallback = (url: string, name: string) => void;\n\nfunction getObjectPublicUrl(bucket: string, key: string) {\n  return `https://${bucket}.s3.amazonaws.com/${key}`;\n}\n\nasync function fetchObjectsWithPagination(\n  bucket: string,\n  prefix: string,\n  onObjectAvailable: ObjectAvailableCallback = () => {}\n) {\n  const client = new S3Client({\n    region: 'us-east-1',\n    // workaround for sdk's inability to specify anonymous credentials\n    signer: { sign: async (request) => request },\n  });\n\n  const paginate = async (continuationToken?: string) => {\n    const listObjectsCmd = new ListObjectsV2Command({\n      Bucket: bucket,\n      Prefix: prefix,\n      ContinuationToken: continuationToken,\n      MaxKeys: 1000,\n    });\n\n    let result;\n    try {\n      result = await client.send(listObjectsCmd);\n    } catch (err) {\n      console.error(err);\n      throw err;\n    }\n\n    if (!result.Contents) {\n      throw new Error('S3 returned no objects');\n    }\n\n    result.Contents.forEach((obj) => {\n      if (!obj.Key) return;\n      const name = obj.Key;\n      const url = getObjectPublicUrl(bucket, obj.Key);\n      onObjectAvailable(name, url);\n    });\n\n    if (result.IsTruncated && result.NextContinuationToken) {\n      await paginate(result.NextContinuationToken);\n    }\n  };\n\n  await paginate();\n}\n\n/**\n * Extracts bucket and prefix from `s3://` URIs\n * @param uri\n * @returns\n */\nexport const extractBucketAndPrefixFromS3Uri = (uri: string) => {\n  const { hostname: bucket, pathname } = new URL(uri);\n  // drop the leading forward slash\n  const objectName = pathname.replace(/^\\//, '');\n  return [bucket, objectName] as const;\n};\n\n/**\n * Gets all objects from an s3:// URI.\n *\n * Signed/credentialed requests are currently not supported.\n *\n * @param s3Uri\n */\nexport const getObjectsFromS3 = async (\n  s3Uri: string,\n  onObjectAvailable: ObjectAvailableCallback = () => {}\n) => {\n  const [bucket, objPrefix] = extractBucketAndPrefixFromS3Uri(s3Uri);\n  await fetchObjectsWithPagination(bucket, objPrefix, onObjectAvailable);\n};\n","import { getObjectsFromS3, isAmazonS3Uri } from '@/src/io/amazonS3';\nimport { ImportHandler } from '@/src/io/import/common';\n\nconst handleAmazonS3: ImportHandler = async (dataSource, { execute, done }) => {\n  const { uriSrc } = dataSource;\n  if (uriSrc && isAmazonS3Uri(uriSrc.uri)) {\n    try {\n      await getObjectsFromS3(uriSrc.uri, (name, url) => {\n        execute({\n          uriSrc: {\n            uri: url,\n            name,\n          },\n          parent: dataSource,\n        });\n      });\n      return done();\n    } catch (err) {\n      throw new Error(`Could not download S3 URI ${uriSrc.uri}`, {\n        cause: err instanceof Error ? err : undefined,\n      });\n    }\n  }\n  return dataSource;\n};\n\nexport default handleAmazonS3;\n","import { URL } from 'whatwg-url';\nimport { fetchJSON } from '../utils/fetch';\n\nexport interface GcsObject {\n  kind: string;\n  id: string;\n  selfLink: string;\n  mediaLink: string;\n  name: string;\n  bucket: string;\n  size: string;\n}\n\ninterface GcsObjectListResult {\n  kind: string;\n  nextPageToken?: string;\n  items: GcsObject[];\n}\n\n/**\n * Detects `gs://` uri.\n * @param uri\n * @returns\n */\nexport const isGoogleCloudStorageUri = (uri: string) =>\n  new URL(uri).protocol === 'gs:';\n\n/**\n * Extracts bucket and prefix from `gs://` URIs\n * @param uri\n * @returns\n */\nexport const extractBucketAndPrefixFromGsUri = (uri: string) => {\n  const { hostname: bucket, pathname } = new URL(uri);\n  // drop the leading forward slash\n  const objectName = pathname.replace(/^\\//, '');\n  return [bucket, objectName] as const;\n};\n\nexport type ObjectAvailableCallback = (object: GcsObject) => void;\n\nconst getObjectEndpoint = (bucket: string) =>\n  `https://storage.googleapis.com/storage/v1/b/${bucket}/o`;\n\nasync function fetchObjectsWithPagination(\n  bucket: string,\n  prefix: string,\n  onObjectAvailable: ObjectAvailableCallback = () => {}\n) {\n  const objects: GcsObject[] = [];\n\n  const paginate = async (nextToken?: string) => {\n    const url = new URL(getObjectEndpoint(bucket));\n    url.searchParams.append('prefix', prefix);\n    url.searchParams.append('maxResults', '1000');\n    if (nextToken) {\n      url.searchParams.append('pageToken', nextToken);\n    }\n\n    const page = await fetchJSON<GcsObjectListResult>(url.toString());\n    if (page.kind !== 'storage#objects') {\n      throw new Error('GCS did not return a list of objects!');\n    }\n\n    objects.push(...page.items);\n    page.items.forEach((obj) => onObjectAvailable(obj));\n\n    if (page.nextPageToken) {\n      await paginate(page.nextPageToken);\n    }\n  };\n\n  await paginate();\n  return objects;\n}\n\n/**\n * Gets all objects from a given gs:// URI.\n *\n * Signed/credentialed requests are currently not supported.\n *\n * This is a simplified entrypoint for GCS. We're not using\n * @google-cloud/storage due to node dependencies. As such, this will most\n * definitely be incomplete (slight API missteps, no retries, etc.) For the\n * purpose of just downloading datasets, it should work just fine.\n *\n * @param gsUri\n * @param onObjectAvailable\n * @returns\n */\nexport const getObjectsFromGsUri = async (\n  gsUri: string,\n  onObjectAvailable: ObjectAvailableCallback = () => {}\n) => {\n  const [bucketName, objPrefix] = extractBucketAndPrefixFromGsUri(gsUri);\n  return fetchObjectsWithPagination(bucketName, objPrefix, onObjectAvailable);\n};\n","import {\n  getObjectsFromGsUri,\n  isGoogleCloudStorageUri,\n} from '@/src/io/googleCloudStorage';\nimport { ImportHandler } from '@/src/io/import/common';\n\nconst handleGoogleCloudStorage: ImportHandler = async (\n  dataSource,\n  { execute, done }\n) => {\n  const { uriSrc } = dataSource;\n  if (uriSrc && isGoogleCloudStorageUri(uriSrc.uri)) {\n    try {\n      await getObjectsFromGsUri(uriSrc.uri, (object) => {\n        execute({\n          uriSrc: {\n            uri: object.mediaLink,\n            name: object.name,\n          },\n          parent: dataSource,\n        });\n      });\n      return done();\n    } catch (err) {\n      throw new Error(`Could not download GCS URI ${uriSrc.uri}`, {\n        cause: err instanceof Error ? err : undefined,\n      });\n    }\n  }\n  return dataSource;\n};\n\nexport default handleGoogleCloudStorage;\n","import vtkImageData from '@kitware/vtk.js/Common/DataModel/ImageData';\nimport vtkPolyData from '@kitware/vtk.js/Common/DataModel/PolyData';\nimport { useFileStore } from '@/src/store/datasets-files';\nimport { useImageStore } from '@/src/store/datasets-images';\nimport { useModelStore } from '@/src/store/datasets-models';\nimport { FILE_READERS } from '@/src/io';\nimport { ImportHandler } from '@/src/io/import/common';\nimport { DataSourceWithFile } from '@/src/io/import/dataSource';\n\n/**\n * Reads and imports a file DataSource.\n * @param dataSource\n * @returns\n */\nconst importSingleFile: ImportHandler = async (dataSource, { done }) => {\n  if (!dataSource.fileSrc) {\n    return dataSource;\n  }\n\n  const { fileSrc } = dataSource;\n  if (!FILE_READERS.has(fileSrc.fileType)) {\n    return dataSource;\n  }\n\n  const reader = FILE_READERS.get(fileSrc.fileType)!;\n  const dataObject = await reader(fileSrc.file);\n\n  const fileStore = useFileStore();\n\n  if (dataObject.isA('vtkImageData')) {\n    const dataID = useImageStore().addVTKImageData(\n      fileSrc.file.name,\n      dataObject as vtkImageData\n    );\n    fileStore.add(dataID, [dataSource as DataSourceWithFile]);\n\n    return done({\n      dataID,\n      dataSource,\n      dataType: 'image',\n    });\n  }\n\n  if (dataObject.isA('vtkPolyData')) {\n    const dataID = useModelStore().addVTKPolyData(\n      fileSrc.file.name,\n      dataObject as vtkPolyData\n    );\n    fileStore.add(dataID, [dataSource as DataSourceWithFile]);\n\n    return done({\n      dataID,\n      dataSource,\n      dataType: 'model',\n    });\n  }\n\n  throw new Error('Data reader did not produce a valid dataset');\n};\n\nexport default importSingleFile;\n","import { z } from 'zod';\n\nconst RemoteResource = z.object({\n  url: z.string(),\n  name: z.optional(z.string()),\n});\n\nexport const RemoteDataManifest = z.object({\n  resources: z.array(RemoteResource),\n});\n\nexport async function readRemoteManifestFile(manifestFile: File) {\n  const decoder = new TextDecoder();\n  const ab = await manifestFile.arrayBuffer();\n  const text = decoder.decode(new Uint8Array(ab));\n  const manifest = RemoteDataManifest.parse(JSON.parse(text));\n  return manifest;\n}\n","import { DataSource } from '@/src/io/import/dataSource';\nimport { ImportHandler } from '@/src/io/import/common';\nimport { readRemoteManifestFile } from '@src/io/manifest';\n\n/**\n * Reads a JSON file that conforms to the remote manifest spec.\n * @param dataSource\n * @returns\n */\nconst handleRemoteManifest: ImportHandler = async (\n  dataSource,\n  { done, execute }\n) => {\n  const { fileSrc } = dataSource;\n  if (fileSrc?.fileType === 'application/json') {\n    const remotes: DataSource[] = [];\n    try {\n      const manifest = await readRemoteManifestFile(fileSrc.file);\n      manifest.resources.forEach((res) => {\n        remotes.push({\n          uriSrc: {\n            uri: res.url,\n            name: res.name ?? new URL(res.url).pathname,\n          },\n          parent: dataSource,\n        });\n      });\n    } catch (err) {\n      return dataSource;\n    }\n\n    remotes.forEach((remote) => {\n      execute(remote);\n    });\n    return done();\n  }\n  return dataSource;\n};\n\nexport default handleRemoteManifest;\n","import macro from '@kitware/vtk.js/macro';\nimport vtkImageData from '@kitware/vtk.js/Common/DataModel/ImageData';\n\n// ----------------------------------------------------------------------------\n// vtkLabelMap methods\n// ----------------------------------------------------------------------------\n\nfunction vtkLabelMap(publicAPI, model) {\n  // Set our className\n  model.classHierarchy.push('vtkLabelMap');\n\n  if (model.colorMap === null) {\n    // default colormap\n    model.colorMap = {\n      0: [0, 0, 0, 0],\n      1: [0, 0, 0, 255],\n    };\n  }\n}\n\n// ----------------------------------------------------------------------------\n// Object factory\n// ----------------------------------------------------------------------------\n\nconst DEFAULT_VALUES = {\n  // default opacity map uses 0 as the transparent pixel\n  colorMap: null,\n};\n\n// ----------------------------------------------------------------------------\n\nexport function extend(publicAPI, model, initialValues = {}) {\n  Object.assign(model, DEFAULT_VALUES, initialValues);\n\n  vtkImageData.extend(publicAPI, model, initialValues);\n\n  macro.setGet(publicAPI, model, ['colorMap']);\n\n  // Object specific methods\n  vtkLabelMap(publicAPI, model);\n}\n\n// ----------------------------------------------------------------------------\n\nexport const newInstance = macro.newInstance(extend, 'vtkLabelMap');\n\n// ----------------------------------------------------------------------------\n\nexport default { newInstance, extend };\n","import MRICardiacThumbnail from '@/src/assets/samples/MRI-Cardiac.jpg';\nimport MRIPROSTATExThumbnail from '@/src/assets/samples/MRI-PROSTATEx.jpg';\nimport MRAHeadThumbnail from '@/src/assets/samples/MRA-Head_and_Neck.jpg';\nimport CTAHeadThumbnail from '@/src/assets/samples/CTA-Head_and_Neck.jpg';\nimport USFetusThumbnail from '@/src/assets/samples/3DUS-Fetus.jpg';\nimport { Layout, LayoutDirection } from './types/layout';\nimport { ViewSpec } from './types/views';\nimport { SampleDataset } from './types';\n\n/**\n * These are the initial view IDs.\n */\nexport const InitViewIDs: Record<string, string> = {\n  Coronal: 'Coronal',\n  Sagittal: 'Sagittal',\n  Axial: 'Axial',\n  Three: '3D',\n};\n\n/**\n * View spec for the initial view IDs.\n */\nexport const InitViewSpecs: Record<string, ViewSpec> = {\n  [InitViewIDs.Coronal]: {\n    viewType: '2D',\n    props: {\n      viewDirection: 'Right',\n      viewUp: 'Superior',\n    },\n  },\n  [InitViewIDs.Sagittal]: {\n    viewType: '2D',\n    props: {\n      viewDirection: 'Posterior',\n      viewUp: 'Superior',\n    },\n  },\n  [InitViewIDs.Axial]: {\n    viewType: '2D',\n    props: {\n      viewDirection: 'Superior',\n      viewUp: 'Anterior',\n    },\n  },\n  [InitViewIDs.Three]: {\n    viewType: '3D',\n    props: {\n      viewDirection: 'Posterior',\n      viewUp: 'Superior',\n    },\n  },\n};\n\n/**\n * The default view spec.\n */\nexport const DefaultViewSpec = InitViewSpecs[InitViewIDs.Axial];\n\n/**\n * Defines the default layouts.\n */\nexport const Layouts: Record<string, Layout> = [\n  {\n    name: 'Axial Only',\n    direction: LayoutDirection.H,\n    items: [InitViewIDs.Axial],\n  },\n  {\n    name: 'Axial Primary',\n    direction: LayoutDirection.V,\n    items: [\n      InitViewIDs.Axial,\n      {\n        direction: LayoutDirection.H,\n        items: [InitViewIDs.Three, InitViewIDs.Coronal, InitViewIDs.Sagittal],\n      },\n    ],\n  },\n  {\n    name: '3D Primary',\n    direction: LayoutDirection.V,\n    items: [\n      InitViewIDs.Three,\n      {\n        direction: LayoutDirection.H,\n        items: [InitViewIDs.Coronal, InitViewIDs.Sagittal, InitViewIDs.Axial],\n      },\n    ],\n  },\n  {\n    name: 'Quad View',\n    direction: LayoutDirection.H,\n    items: [\n      {\n        direction: LayoutDirection.V,\n        items: [InitViewIDs.Coronal, InitViewIDs.Three],\n      },\n      {\n        direction: LayoutDirection.V,\n        items: [InitViewIDs.Sagittal, InitViewIDs.Axial],\n      },\n    ],\n  },\n  {\n    name: '3D Only',\n    direction: LayoutDirection.H,\n    items: [InitViewIDs.Three],\n  },\n].reduce((layouts, layout) => {\n  return { ...layouts, [layout.name]: layout };\n}, {});\n\nexport const LABELMAP_PALETTE = {\n  0: [0, 0, 0, 0], // eraser\n  1: [153, 153, 0, 255],\n  2: [76, 76, 0, 255],\n  3: [255, 255, 0, 255],\n  4: [0, 76, 0, 255],\n  5: [0, 153, 0, 255],\n  6: [0, 255, 0, 255],\n  7: [76, 0, 0, 255],\n  8: [153, 0, 0, 255],\n  9: [255, 0, 0, 255],\n  10: [0, 76, 76, 255],\n  11: [0, 153, 153, 255],\n  12: [0, 255, 255, 255],\n  13: [0, 0, 76, 255],\n  14: [0, 0, 153, 255],\n} as Record<number, number[]>;\n\nexport const SAMPLE_DATA: SampleDataset[] = [\n  {\n    name: 'CTA Head and Neck',\n    filename: 'CTA-Head_and_Neck.zip',\n    description:\n      'CTA head and neck scan of elderly patient with tumor. (80 MB)',\n    url: 'https://data.kitware.com/api/v1/item/6347159711dab81428208e24/download',\n    image: CTAHeadThumbnail,\n  },\n  {\n    name: 'MRA Head and Neck',\n    filename: 'MRA-Head_and_Neck.zip',\n    description:\n      'MRA from Patient Contributed Image Repository. Click application help icon \"(?)\" for more info. (15 MB)',\n    url: 'https://data.kitware.com/api/v1/item/6352a2b311dab8142820a33b/download',\n    image: MRAHeadThumbnail,\n  },\n  {\n    name: 'MRI Cardiac 3D and Cine',\n    filename: 'MRI-Cardiac-3D_and_Cine.zip',\n    description:\n      'MRI scan with two series: 3D axial non-gated and 2 chamber cine. (4 MB)',\n    url: 'https://data.kitware.com/api/v1/item/6350b28f11dab8142820949d/download',\n    image: MRICardiacThumbnail,\n  },\n  {\n    name: 'MRI PROSTATEx',\n    filename: 'MRI-PROSTATEx-0004.zip',\n    description:\n      'MRI from the SPIE-AAPM-NCI PROSTATEx challenge. Click application help \"(?)\" icon for more info. (3 MB)',\n    url: 'https://data.kitware.com/api/v1/item/63527c7311dab8142820a338/download',\n    image: MRIPROSTATExThumbnail,\n  },\n  {\n    name: '3D US Fetus',\n    filename: '3DUS-Fetus.mha',\n    description:\n      '3D ultrasound of a baby. Downloaded from tomovision.com.(8 MB)',\n    url: 'https://data.kitware.com/api/v1/item/635679c311dab8142820a4f4/download',\n    image: USFetusThumbnail,\n  },\n];\n\nexport const TOOL_COLORS = [\n  '#58f24c',\n  '#8de4d3',\n  '#f0a4b1',\n  '#a3c9fe',\n  '#c8f251',\n  '#fea53b',\n];\n\nexport const RULER_LABEL_DEFAULTS = {\n  red: { color: 'red' },\n  green: { color: '#00ff00' },\n  white: { color: '#ffffff' },\n};\n\nexport const RECTANGLE_LABEL_DEFAULTS = {\n  artifact: { color: '#888888', fillColor: '#ffbf0040' },\n  innocuous: { color: '#00ff00', fillColor: '#00ff0020' },\n  lesion: { color: 'red', fillColor: 'transparent' },\n};\n\nexport const DECREMENT_LABEL_KEY = 'q';\nexport const INCREMENT_LABEL_KEY = 'w';\n\nexport const DEFAULT_PRESET_BY_MODALITY: Record<string, string> = {\n  CT: 'CT-AAA',\n  MR: 'CT-Coronary-Arteries-2',\n  US: 'US-Fetal',\n};\n","import vtkDataArray from '@kitware/vtk.js/Common/Core/DataArray';\nimport vtkImageData from '@kitware/vtk.js/Common/DataModel/ImageData';\nimport { defineStore } from 'pinia';\nimport { useImageStore } from '@/src/store/datasets-images';\nimport { join, normalize } from '@/src/utils/path';\nimport { useIdStore } from '@/src/store/id';\nimport vtkLabelMap from '../vtk/LabelMap';\nimport { LABELMAP_PALETTE } from '../config';\nimport { StateFile, Manifest } from '../io/state-file/schema';\nimport { vtiReader, vtiWriter } from '../io/vtk/async';\nimport { FileEntry } from '../io/types';\nimport { findImageID, getDataID } from './datasets';\n\nconst LabelmapArrayType = Uint8Array;\nexport type LabelmapArrayType = Uint8Array;\n\ninterface State {\n  idList: string[];\n  labelmaps: Record<string, vtkLabelMap>;\n  parentImage: Record<string, string>;\n}\n\nfunction createLabelmapFromImage(imageData: vtkImageData) {\n  const points = new LabelmapArrayType(imageData.getNumberOfPoints());\n  const labelmap = vtkLabelMap.newInstance(\n    imageData.get('spacing', 'origin', 'direction')\n  );\n  labelmap.getPointData().setScalars(\n    vtkDataArray.newInstance({\n      numberOfComponents: 1,\n      values: points,\n    })\n  );\n  labelmap.setDimensions(imageData.getDimensions());\n  labelmap.computeTransforms();\n  labelmap.setColorMap(LABELMAP_PALETTE);\n\n  return labelmap;\n}\n\nfunction toLabelMap(imageData: vtkImageData) {\n  const labelmap = vtkLabelMap.newInstance(\n    imageData.get(\n      'spacing',\n      'origin',\n      'direction',\n      'indexToWorld',\n      'worldToIndex',\n      'dataDescription',\n      'pointData'\n    )\n  );\n  labelmap.setDimensions(imageData.getDimensions());\n  labelmap.computeTransforms();\n  labelmap.setColorMap(LABELMAP_PALETTE);\n\n  return labelmap;\n}\n\nexport const useLabelmapStore = defineStore('labelmap', {\n  state: (): State => ({\n    idList: [],\n    labelmaps: Object.create(null),\n    parentImage: Object.create(null),\n  }),\n  actions: {\n    newLabelmapFromImage(imageID: string) {\n      const imageStore = useImageStore();\n      const imageData = imageStore.dataIndex[imageID];\n      if (!imageData) {\n        return null;\n      }\n\n      const id = useIdStore().nextId();\n      const labelmap = createLabelmapFromImage(imageData);\n\n      this.idList.push(id);\n      this.parentImage[id] = imageID;\n      this.labelmaps[id] = labelmap;\n\n      this.$proxies.addData(id, labelmap);\n\n      return id;\n    },\n    async serialize(state: StateFile) {\n      const { labelMaps } = state.manifest;\n      const { zip } = state;\n\n      await Promise.all(\n        Object.entries(this.labelmaps).map(async ([id, labelMap]) => {\n          const labelPath = `labels/${id}.vti`;\n          const parent = getDataID(this.parentImage[id]);\n          labelMaps.push({\n            id,\n            parent,\n            path: labelPath,\n          });\n\n          const serializedData = await vtiWriter(labelMap);\n          zip.file(labelPath, serializedData);\n        })\n      );\n    },\n    async deserialize(\n      manifest: Manifest,\n      stateFiles: FileEntry[],\n      dataIDMap: Record<string, string>\n    ) {\n      const { labelMaps } = manifest;\n\n      const labelmapIDMap: Record<string, string> = {};\n\n      labelMaps.forEach(async (labelMap) => {\n        const [file] = stateFiles\n          .filter(\n            (entry) =>\n              join(entry.archivePath, entry.file.name) ===\n              normalize(labelMap.path)\n          )\n          .map((entry) => entry.file);\n\n        // map parent id to new id\n        // eslint-disable-next-line no-param-reassign\n        labelMap.parent = dataIDMap[labelMap.parent];\n\n        const { parent } = labelMap;\n        const id = useIdStore().nextId();\n        labelmapIDMap[labelMap.id] = id;\n\n        const imageData = await vtiReader(file);\n        const labelMapObj = toLabelMap(imageData as vtkImageData);\n        this.idList.push(id);\n        this.parentImage[id] = findImageID(parent);\n        this.labelmaps[id] = labelMapObj;\n        this.$proxies.addData(id, labelMapObj);\n      });\n\n      return labelmapIDMap;\n    },\n  },\n});\n","import {\n  runPipeline,\n  InterfaceTypes,\n  imageSharedBufferOrCopy,\n  WorkerPool,\n  stackImages,\n} from 'itk-wasm';\nimport { join } from '@/src/utils/path';\n\nexport async function runWasm(\n  pipeline,\n  args,\n  images,\n  outputs = [{ type: InterfaceTypes.Image }]\n) {\n  const numberOfWorkers = navigator.hardwareConcurrency\n    ? navigator.hardwareConcurrency\n    : 6;\n\n  const aImage = images[0];\n  const splits = Math.min(\n    parseInt(numberOfWorkers / 2, 10),\n    Math.max(aImage.size[aImage.size.length - 1], 1),\n    4 // avoid out of memory errors with larger images\n  );\n\n  const splitsArg = splits.toString();\n  const tasks = [...Array(splits).keys()].map((split) => {\n    const taskArgs = [\n      ...[...Array(images.length).keys()].map((num) => num.toString()),\n      '0', // input image space\n      ...args,\n      '--max-total-splits',\n      splitsArg,\n      '--split',\n      split.toString(),\n      '--number-of-splits',\n      splitsArg,\n      '--memory-io',\n    ];\n\n    const inputs = images.map((image) => ({\n      type: InterfaceTypes.Image,\n      data: imageSharedBufferOrCopy(image),\n    }));\n\n    return [pipeline, taskArgs, outputs, inputs, join(import.meta.env.BASE_URL, '/itk/pipelines'),\n      join(import.meta.env.BASE_URL, '/itk/pipeline.worker.js')];\n  });\n\n  const workerPool = new WorkerPool(numberOfWorkers, runPipeline);\n  const results = await workerPool.runTasks(tasks).promise;\n  workerPool.terminateWorkers();\n  const validResults = results.filter((r) => r.returnValue === 0);\n  const imageSplits = validResults.map(\n    ({ outputs: pipelineOutput }) => pipelineOutput[0].data\n  );\n\n  return stackImages(imageSplits);\n}\n","import { arrayEquals } from '@/src/utils';\nimport { Image } from 'itk-wasm';\nimport { runWasm } from './itkWasmUtils';\n\n\nconst compareProps = ['size', 'direction', 'origin', 'spacing'] as const;\n\nexport function compareImageSpaces(imageA: Image, imageB: Image) {\n  const equalKeys = compareProps.map((key) =>\n    arrayEquals(imageA[key], imageB[key])\n  );\n  return equalKeys.every((b) => b);\n}\n\nexport async function resample(fixed: Image, moving: Image) {\n  if (compareImageSpaces(fixed, moving)) return moving; // same space, just return\n\n  const { size, spacing, origin, direction } = fixed;\n  const args = [\n    '--size',\n    size.join(','),\n    '--spacing',\n    spacing.join(','),\n    '--origin',\n    origin.join(','),\n    '--direction',\n    direction.join(','),\n  ];\n\n  return runWasm('resample', args, [moving]);\n}\n","import { ref } from 'vue';\nimport vtkITKHelper from '@kitware/vtk.js/Common/DataModel/ITKHelper';\nimport vtkImageData from '@kitware/vtk.js/Common/DataModel/ImageData';\nimport vtkBoundingBox from '@kitware/vtk.js/Common/DataModel/BoundingBox';\nimport { defineStore } from 'pinia';\nimport { useImageStore } from '@/src/store/datasets-images';\nimport { resample } from '../io/resample/resample';\nimport { useDICOMStore } from './datasets-dicom';\nimport {\n  DataSelection,\n  makeDICOMSelection,\n  makeImageSelection,\n  selectionEquals,\n  getImage,\n} from './datasets';\nimport { useErrorMessage } from '../composables/useErrorMessage';\nimport { Manifest, StateFile } from '../io/state-file/schema';\n\n// differ from Image/Volume IDs with a branded type\ntype DataSelectionKey = string & { __type: 'DataSelectionKey' };\nexport type LayerID = string & { __type: 'LayerID' };\n\nexport type Layer = {\n  selection: DataSelection;\n  id: LayerID;\n};\n\nconst assertNeverDataSelection = (selection: never): never => {\n  throw new Error(`Unknown DataSelection: ${selection}`);\n};\n\nconst getID = (selection: DataSelection) => {\n  if (selection.type === 'dicom') return selection.volumeKey;\n  if (selection.type === 'image') return selection.dataID;\n  return assertNeverDataSelection(selection);\n};\n\nconst toDataSelectionKey = (selection: DataSelection) => {\n  const id = getID(selection);\n  return `${selection.type}::${id}` as DataSelectionKey;\n};\n\nconst toDataSelectionFromKey = (key: DataSelectionKey) => {\n  const [type, id] = key.split('::') as [DataSelection['type'], string];\n\n  if (type === 'dicom') return makeDICOMSelection(id);\n  if (type === 'image') return makeImageSelection(id);\n\n  return assertNeverDataSelection(type);\n};\n\nexport const useLayersStore = defineStore('layer', () => {\n  type _This = ReturnType<typeof useLayersStore>;\n\n  const parentToLayers = ref<Record<DataSelectionKey, Layer[]>>({});\n  const layerImages = ref<Record<LayerID, vtkImageData>>({});\n\n  async function _addLayer(\n    this: _This,\n    parent: DataSelection,\n    source: DataSelection\n  ) {\n    if (!parent) {\n      throw new Error('Tried to addLayer without parent data selection');\n    }\n\n    const parentKey = toDataSelectionKey(parent);\n    const id = `${parentKey}::${toDataSelectionKey(source)}` as LayerID;\n    this.parentToLayers[parentKey] = [\n      ...(this.parentToLayers[parentKey] ?? []),\n      { selection: source, id } as Layer,\n    ];\n\n    const [parentImage, sourceImage] = await Promise.all(\n      [parent, source].map(getImage)\n    );\n\n    if (\n      !vtkBoundingBox.intersects(\n        parentImage.getBounds(),\n        sourceImage.getBounds()\n      )\n    ) {\n      this.deleteLayer(parent, source);\n      throw new Error(\n        'Image bounds do not intersect, so no overlap in physical space'\n      );\n    }\n\n    const itkImage = await resample(\n      vtkITKHelper.convertVtkToItkImage(parentImage),\n      vtkITKHelper.convertVtkToItkImage(sourceImage)\n    );\n    const image = vtkITKHelper.convertItkToVtkImage(itkImage);\n\n    this.$proxies.addData(id, image);\n\n    // calling after adding data to proxy manager delays enabling deletion, thus avoiding error\n    this.layerImages[id] = image;\n  }\n\n  async function addLayer(\n    this: _This,\n    parent: DataSelection,\n    source: DataSelection\n  ) {\n    return useErrorMessage('Failed to build layer', () =>\n      this._addLayer(parent, source)\n    );\n  }\n\n  function deleteLayer(\n    this: _This,\n    parent: DataSelection,\n    source: DataSelection\n  ) {\n    if (!parent) {\n      throw new Error('Tried to deleteLayer without parent data selection');\n    }\n\n    const parentKey = toDataSelectionKey(parent);\n    const layers = this.parentToLayers[parentKey] ?? [];\n\n    const layerToDelete = layers.find(({ selection }) =>\n      selectionEquals(selection, source)\n    );\n    if (!layerToDelete) return;\n\n    this.parentToLayers[parentKey] = layers.filter(\n      (layer) => layer !== layerToDelete\n    );\n\n    delete this.layerImages[layerToDelete.id];\n\n    // May have errored creating data, so check before delete\n    if (this.$proxies.getData(layerToDelete.id))\n      this.$proxies.deleteData(layerToDelete.id);\n  }\n\n  function getLayers(key: DataSelection | null | undefined) {\n    if (!key) return [];\n    const dataKey = toDataSelectionKey(key);\n    return parentToLayers.value[dataKey] ?? [];\n  }\n\n  const getLayer = (layerID: LayerID) =>\n    Object.values(parentToLayers.value)\n      .flat()\n      .flat()\n      .find(({ id }) => id === layerID);\n\n  // --- watch for deletion --- //\n\n  const deleteSelection = (deleteKey: DataSelection) => {\n    const layerStore = useLayersStore();\n    // delete as parent\n    layerStore\n      .getLayers(deleteKey)\n      .forEach(({ selection }) => layerStore.deleteLayer(deleteKey, selection));\n    // delete from layer lists\n    Object.keys(layerStore.parentToLayers)\n      .map((key) => toDataSelectionFromKey(key as DataSelectionKey))\n      .forEach((parent) => layerStore.deleteLayer(parent, deleteKey));\n  };\n\n  const imageStore = useImageStore();\n  imageStore.$onAction(({ name, args }) => {\n    if (name !== 'deleteData') {\n      return;\n    }\n    const [id] = args;\n    const selection = makeImageSelection(id);\n    deleteSelection(selection);\n  });\n\n  const dicomStore = useDICOMStore();\n  dicomStore.$onAction(({ name, args }) => {\n    if (name !== 'deleteVolume') {\n      return;\n    }\n    const [volumeKey] = args;\n    const selection = makeDICOMSelection(volumeKey);\n    deleteSelection(selection);\n  });\n\n  function serialize(this: _This, state: StateFile) {\n    state.manifest.parentToLayers = Object.entries(this.parentToLayers).map(\n      ([selectionKey, layers]) => ({\n        selectionKey,\n        sourceSelectionKeys: layers.map(({ selection }) =>\n          toDataSelectionKey(selection)\n        ),\n      })\n    );\n  }\n\n  function deserialize(\n    this: _This,\n    manifest: Manifest,\n    dataIDMap: Record<string, string>\n  ) {\n    const remapSelection = (selection: DataSelection) => {\n      if (selection.type === 'dicom')\n        return makeDICOMSelection(dataIDMap[selection.volumeKey]);\n      if (selection.type === 'image')\n        return makeImageSelection(dataIDMap[selection.dataID]);\n\n      const _exhaustiveCheck: never = selection;\n      throw new Error(`invalid selection type ${_exhaustiveCheck}`);\n    };\n\n    const { parentToLayers: parentToLayersSerialized } = manifest;\n    parentToLayersSerialized.forEach(\n      ({ selectionKey, sourceSelectionKeys }) => {\n        const parent = remapSelection(\n          toDataSelectionFromKey(selectionKey as DataSelectionKey)\n        );\n        sourceSelectionKeys.forEach((sourceKey) => {\n          const source = remapSelection(\n            toDataSelectionFromKey(sourceKey as DataSelectionKey)\n          );\n          this.addLayer(parent, source);\n        });\n      }\n    );\n  }\n\n  return {\n    parentToLayers,\n    layerImages,\n    _addLayer,\n    addLayer,\n    deleteLayer,\n    getLayers,\n    getLayer,\n    serialize,\n    deserialize,\n  };\n});\n","import { computed } from 'vue';\nimport { useDatasetStore } from '../store/datasets';\nimport { useDICOMStore } from '../store/datasets-dicom';\nimport { defaultImageMetadata, useImageStore } from '../store/datasets-images';\nimport { useLayersStore } from '../store/datasets-layers';\nimport { createLPSBounds, getAxisBounds } from '../utils/lps';\n\n// Returns a spatially inflated image extent\nexport function getImageSpatialExtent(imageID: string | null) {\n  const imageStore = useImageStore();\n\n  if (imageID && imageID in imageStore.metadata) {\n    const { lpsOrientation } = imageStore.metadata[imageID];\n    const image = imageStore.dataIndex[imageID];\n    if (image) {\n      const extent = image.getSpatialExtent();\n      return {\n        Sagittal: getAxisBounds(extent, 'Sagittal', lpsOrientation),\n        Coronal: getAxisBounds(extent, 'Coronal', lpsOrientation),\n        Axial: getAxisBounds(extent, 'Axial', lpsOrientation),\n      };\n    }\n  }\n  return createLPSBounds();\n}\n\nexport function useCurrentImage() {\n  const dataStore = useDatasetStore();\n  const dicomStore = useDICOMStore();\n  const imageStore = useImageStore();\n  const layersStore = useLayersStore();\n\n  const currentImageID = computed(() => {\n    const { primarySelection } = dataStore;\n    const { volumeToImageID } = dicomStore;\n\n    if (primarySelection?.type === 'image') {\n      return primarySelection.dataID;\n    }\n    if (primarySelection?.type === 'dicom') {\n      return volumeToImageID[primarySelection.volumeKey] || null;\n    }\n    return null;\n  });\n\n  const currentImageMetadata = computed(() => {\n    const { metadata } = imageStore;\n    const imageID = currentImageID.value;\n\n    if (imageID) {\n      return metadata[imageID];\n    }\n    return defaultImageMetadata();\n  });\n\n  const currentImageData = computed(() => {\n    if (currentImageID.value)\n      // assumed to be only images for now\n      return imageStore.dataIndex[currentImageID.value];\n    return undefined;\n  });\n\n  const currentImageExtent = computed(() =>\n    getImageSpatialExtent(currentImageID.value)\n  );\n\n  const isImageLoading = computed(() => {\n    return !!dataStore.primarySelection && !dataStore.primaryDataset;\n  });\n\n  const currentLayers = computed(() =>\n    layersStore\n      .getLayers(dataStore.primarySelection)\n      .filter(({ id }) => id in layersStore.layerImages)\n  );\n\n  return {\n    currentImageData,\n    currentImageID,\n    currentImageMetadata,\n    currentImageExtent,\n    isImageLoading,\n    currentLayers,\n  };\n}\n","import { getImageSpatialExtent } from '@/src/composables/useCurrentImage';\nimport { LPSAxis } from '@/src/types/lps';\nimport { getAxisBounds } from '@/src/utils/lps';\nimport vtkPlane from '@kitware/vtk.js/Common/DataModel/Plane';\nimport type { Vector2, Vector3 } from '@kitware/vtk.js/types';\nimport { computed, reactive, readonly, unref } from 'vue';\nimport { MaybeRef } from '@vueuse/core';\nimport { vec3 } from 'gl-matrix';\nimport { defineStore } from 'pinia';\nimport { arrayEqualsWithComparator } from '@/src/utils';\nimport { useImageStore } from '../datasets-images';\nimport { LPSCroppingPlanes } from '../../types/crop';\nimport { ImageMetadata } from '../../types/image';\nimport { StateFile, Manifest } from '../../io/state-file/schema';\n\nfunction clampRangeToBounds(range: Vector2, bounds: Vector2) {\n  return [\n    Math.max(bounds[0], Math.min(bounds[1], range[0])),\n    Math.max(bounds[0], Math.min(bounds[1], range[1])),\n  ] as Vector2;\n}\n\nfunction convertCropBoundsToVTKPlane(\n  cropBounds: LPSCroppingPlanes,\n  metadata: ImageMetadata,\n  axis: LPSAxis,\n  lowerUpper: 0 | 1\n) {\n  const { indexToWorld, orientation, lpsOrientation: lpsDirs } = metadata;\n\n  const origin = [0, 0, 0] as Vector3;\n  const axisIndex = lpsDirs[axis];\n  origin[axisIndex] = cropBounds[axis][lowerUpper];\n  vec3.transformMat4(origin, origin, indexToWorld);\n\n  // The lower bound normal is the associated column in the\n  // image orientation matrix. The upper bound normal is the\n  // lower bound normal, but negated.\n  const neg = -(lowerUpper * 2 - 1);\n  const normal = [\n    ...orientation.slice(axisIndex * 3, axisIndex * 3 + 3).map((c) => c * neg),\n  ] as Vector3;\n\n  return vtkPlane.newInstance({ origin, normal });\n}\n\nexport function croppingPlanesEqual(a1: vtkPlane[], a2: vtkPlane[]) {\n  return arrayEqualsWithComparator<vtkPlane>(a1, a2, (p1, p2) => {\n    return (\n      vec3.equals(p1.getOrigin(), p2.getOrigin()) &&\n      vec3.equals(p1.getNormal(), p2.getNormal())\n    );\n  });\n}\n\nexport const useCropStore = defineStore('crop', () => {\n  const imageStore = useImageStore();\n\n  const state = reactive({\n    croppingByImageID: {} as Record<string, LPSCroppingPlanes>,\n  });\n\n  const getComputedVTKPlanes = (imageID: MaybeRef<string | null>) =>\n    computed(() => {\n      const id = unref(imageID);\n      if (id && id in state.croppingByImageID && id in imageStore.metadata) {\n        const cropBounds = state.croppingByImageID[id];\n        const metadata = imageStore.metadata[id];\n        return [\n          convertCropBoundsToVTKPlane(cropBounds, metadata, 'Sagittal', 0),\n          convertCropBoundsToVTKPlane(cropBounds, metadata, 'Sagittal', 1),\n          convertCropBoundsToVTKPlane(cropBounds, metadata, 'Coronal', 0),\n          convertCropBoundsToVTKPlane(cropBounds, metadata, 'Coronal', 1),\n          convertCropBoundsToVTKPlane(cropBounds, metadata, 'Axial', 0),\n          convertCropBoundsToVTKPlane(cropBounds, metadata, 'Axial', 1),\n        ];\n      }\n      return null;\n    });\n\n  const clampCroppingPlanes = (\n    imageID: string,\n    planes: LPSCroppingPlanes\n  ): LPSCroppingPlanes => {\n    const lpsBounds = getImageSpatialExtent(imageID);\n    // if perf becomes an issue, change this to modify the planes arg\n    return {\n      Sagittal: clampRangeToBounds(planes.Sagittal, lpsBounds.Sagittal),\n      Coronal: clampRangeToBounds(planes.Coronal, lpsBounds.Coronal),\n      Axial: clampRangeToBounds(planes.Axial, lpsBounds.Axial),\n    };\n  };\n\n  const setCropping = (imageID: string, planes: LPSCroppingPlanes) => {\n    state.croppingByImageID[imageID] = clampCroppingPlanes(imageID, planes);\n  };\n\n  const setCroppingForAxis = (\n    imageID: string,\n    axis: LPSAxis,\n    planes: Vector2\n  ) => {\n    if (imageID in state.croppingByImageID) {\n      setCropping(imageID, {\n        ...state.croppingByImageID[imageID],\n        [axis]: planes,\n      });\n    }\n  };\n\n  const resetCropping = (imageID: string) => {\n    const image = imageStore.dataIndex[imageID];\n    if (!image) return;\n\n    const { lpsOrientation } = imageStore.metadata[imageID];\n    const extent = image.getSpatialExtent();\n    setCropping(imageID, {\n      Sagittal: getAxisBounds(extent, 'Sagittal', lpsOrientation),\n      Coronal: getAxisBounds(extent, 'Coronal', lpsOrientation),\n      Axial: getAxisBounds(extent, 'Axial', lpsOrientation),\n    });\n  };\n\n  function serialize(stateFile: StateFile) {\n    const { tools } = stateFile.manifest;\n    tools.crop = state.croppingByImageID;\n  }\n\n  function deserialize(manifest: Manifest, dataIDMap: Record<string, string>) {\n    const cropping = manifest.tools.crop;\n\n    Object.entries(cropping).forEach(([imageID, planes]) => {\n      const newImageID = dataIDMap[imageID];\n      setCropping(newImageID, planes);\n    });\n  }\n\n  return {\n    croppingByImageID: readonly(state.croppingByImageID),\n    getComputedVTKPlanes,\n    setCropping,\n    setCroppingForAxis,\n    resetCropping,\n    serialize,\n    deserialize,\n  };\n});\n","import type { Bounds, Vector3 } from '@kitware/vtk.js/types';\nimport vtkStateBuilder from '@kitware/vtk.js/Widgets/Core/StateBuilder';\nimport vtkWidgetState from '@kitware/vtk.js/Widgets/Core/WidgetState';\nimport { mat4 } from 'gl-matrix';\n\nexport interface CrosshairsHandleWidgetState extends vtkWidgetState {\n  setOrigin(origin: Vector3 | null): boolean;\n  getOrigin(): Vector3 | null;\n  setScale1(scale: number): boolean;\n  getScale1(): number;\n  setVisible(visible: boolean): boolean;\n  getVisible(): boolean;\n  setBounds(bounds: Bounds): boolean;\n  getBounds(): Bounds;\n}\n\nexport interface CrosshairsWidgetState extends vtkWidgetState {\n  setPlaced(placed: boolean): boolean;\n  getPlaced(): boolean;\n  setIndexToWorld(indexToWorld: mat4): boolean;\n  getIndexToWorld(): mat4;\n  setWorldToIndex(worldToIndex: mat4): boolean;\n  getWorldToIndex(): mat4;\n  getHandle(): CrosshairsHandleWidgetState;\n}\n\nexport default function generateState() {\n  return vtkStateBuilder\n    .createBuilder()\n    .addField({\n      name: 'placed',\n      initialValue: false,\n    })\n    .addField({\n      name: 'indexToWorld',\n      initialValue: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    })\n    .addField({\n      name: 'worldToIndex',\n      initialValue: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    })\n    .addStateFromMixin({\n      labels: ['handle'],\n      mixins: ['origin', 'bounds'],\n      name: 'handle',\n      initialValues: {\n        origin: null,\n      },\n    })\n    .build();\n}\n","import macro from '@kitware/vtk.js/macro';\nimport type { Bounds } from '@kitware/vtk.js/types';\nimport { vec3 } from 'gl-matrix';\n\nfunction clampPointToBounds(bounds: Bounds, point: vec3) {\n  return point.map((p, i) =>\n    Math.max(bounds[i * 2], Math.min(bounds[i * 2 + 1], p))\n  ) as vec3;\n}\n\nexport default function widgetBehavior(publicAPI: any, model: any) {\n  model.classHierarchy.push('vtkCrosshairsWidgetProp');\n  let isDragging = false;\n\n  // support setting per-view widget manipulators\n  macro.setGet(publicAPI, model, ['manipulator']);\n\n  // --------------------------------------------------------------------------\n  // Interactor events\n  // --------------------------------------------------------------------------\n\n  function ignoreKey(e: any) {\n    return e.altKey || e.controlKey || e.shiftKey;\n  }\n\n  // --------------------------------------------------------------------------\n  // Left press: Select handle to drag\n  // --------------------------------------------------------------------------\n\n  publicAPI.handleLeftButtonPress = (e: any) => {\n    if (!model.pickable || ignoreKey(e)) {\n      return macro.VOID;\n    }\n\n    model.widgetState.setPlaced(true);\n    isDragging = true;\n    model._interactor.requestAnimation(publicAPI);\n    model._apiSpecificRenderWindow.setCursor('crosshairs');\n    publicAPI.invokeStartInteractionEvent();\n    publicAPI.handleMouseMove(e);\n    return macro.EVENT_ABORT;\n  };\n\n  // --------------------------------------------------------------------------\n  // Mouse move: Drag selected handle / Handle follow the mouse\n  // --------------------------------------------------------------------------\n\n  publicAPI.handleMouseMove = (callData: any) => {\n    // technically need to call requestAnimation during\n    // the initial phase of placing the crosshairs,\n    // but that's not needed since no VTK object\n    // is actually being rendered.\n\n    if (\n      (!model.widgetState.getPlaced() || isDragging) &&\n      model.pickable &&\n      model.manipulator &&\n      !ignoreKey(callData)\n    ) {\n      const worldCoordsOfPointer = model.manipulator.handleEvent(\n        callData,\n        model._apiSpecificRenderWindow\n      );\n\n      const handle = model.widgetState.getHandle();\n      const worldToIndex = model.widgetState.getWorldToIndex();\n      const indexToWorld = model.widgetState.getIndexToWorld();\n      if (worldToIndex.length && indexToWorld.length) {\n        const indexCoordsOfPointer = vec3.create();\n        const worldOrigin = vec3.create();\n        const bounds = handle.getBounds();\n\n        vec3.transformMat4(\n          indexCoordsOfPointer,\n          worldCoordsOfPointer,\n          worldToIndex\n        );\n        const indexOrigin = clampPointToBounds(bounds, indexCoordsOfPointer);\n        vec3.transformMat4(worldOrigin, indexOrigin, indexToWorld);\n\n        handle.setOrigin(worldOrigin);\n        publicAPI.invokeInteractionEvent();\n        return macro.EVENT_ABORT;\n      }\n    }\n\n    return macro.VOID;\n  };\n\n  // --------------------------------------------------------------------------\n  // Left release: Finish drag / Create new handle\n  // --------------------------------------------------------------------------\n\n  publicAPI.handleLeftButtonRelease = () => {\n    if (isDragging && model.pickable) {\n      model._interactor.cancelAnimation(publicAPI);\n      model._apiSpecificRenderWindow.setCursor('default');\n      publicAPI.invokeEndInteractionEvent();\n    }\n    isDragging = false;\n  };\n\n  // --------------------------------------------------------------------------\n  // Focus API - modeHandle follow mouse when widget has focus\n  // --------------------------------------------------------------------------\n\n  publicAPI.grabFocus = () => {};\n\n  // --------------------------------------------------------------------------\n\n  publicAPI.loseFocus = () => {};\n}\n","import macro from '@kitware/vtk.js/macro';\nimport vtkAbstractWidgetFactory from '@kitware/vtk.js/Widgets/Core/AbstractWidgetFactory';\nimport vtkPlanePointManipulator from '@kitware/vtk.js/Widgets/Manipulators/PlaneManipulator';\n\nimport { ViewTypes } from '@kitware/vtk.js/Widgets/Core/WidgetManager/Constants';\n\nimport stateGenerator from './state';\nimport widgetBehavior from './behavior';\n\n// ----------------------------------------------------------------------------\n// Factory\n// ----------------------------------------------------------------------------\n\nfunction vtkCrosshairsWidget(publicAPI, model) {\n  model.classHierarchy.push('vtkCrosshairsWidget');\n\n  // --- Widget Requirement ---------------------------------------------------\n\n  model.behavior = widgetBehavior;\n  model.widgetState = stateGenerator();\n\n  publicAPI.getRepresentationsForViewType = (viewType) => {\n    switch (viewType) {\n      case ViewTypes.DEFAULT:\n      case ViewTypes.GEOMETRY:\n      case ViewTypes.SLICE:\n      case ViewTypes.VOLUME:\n      default:\n        return [];\n    }\n  };\n\n  // --------------------------------------------------------------------------\n  // initialization\n  // --------------------------------------------------------------------------\n\n  model.widgetState.onBoundsChange((bounds) => {\n    const center = [\n      (bounds[0] + bounds[1]) * 0.5,\n      (bounds[2] + bounds[3]) * 0.5,\n      (bounds[4] + bounds[5]) * 0.5,\n    ];\n    model.widgetState.getHandle().setOrigin(center);\n  });\n\n  // Default manipulator\n  model.manipulator = vtkPlanePointManipulator.newInstance();\n}\n\n// ----------------------------------------------------------------------------\n\nconst DEFAULT_VALUES = {\n  // manipulator: null,\n};\n\n// ----------------------------------------------------------------------------\n\nexport function extend(publicAPI, model, initialValues = {}) {\n  Object.assign(model, DEFAULT_VALUES, initialValues);\n\n  vtkAbstractWidgetFactory.extend(publicAPI, model, initialValues);\n  macro.setGet(publicAPI, model, ['manipulator']);\n\n  vtkCrosshairsWidget(publicAPI, model);\n}\n\n// ----------------------------------------------------------------------------\n\nexport const newInstance = macro.newInstance(extend, 'vtkCrosshairsWidget');\n\n// ----------------------------------------------------------------------------\n\nexport default { newInstance, extend };\n","import { Maybe } from '../types';\n\nexport type DoubleKeyRecord<V> = Record<string, Record<string, V>>;\n\n/* eslint-disable no-param-reassign */\n\nexport function patchDoubleKeyRecord<V>(\n  record: DoubleKeyRecord<V>,\n  k1: string,\n  k2: string,\n  patch: Partial<V>\n) {\n  if (!(k1 in record)) {\n    record[k1] = {};\n  }\n\n  // triggers shallow record[k1][k2] watchers\n  record[k1][k2] = {\n    ...record[k1][k2],\n    ...patch,\n  };\n}\n\nexport function deleteSecondKey<V>(record: DoubleKeyRecord<V>, k2: string) {\n  Object.keys(record).forEach((k1) => {\n    delete record[k1][k2];\n  });\n}\n\n/* eslint-enable no-param-reassign */\n\nexport function getDoubleKeyRecord<V>(\n  record: DoubleKeyRecord<V>,\n  k1: Maybe<string>,\n  k2: Maybe<string>\n): Maybe<V> {\n  if (k1 == null || k2 == null) return null;\n  return record[k1]?.[k2];\n}\n","import { DoubleKeyRecord } from '@/src/utils/doubleKeyRecord';\nimport { StateFile, ViewConfig } from '../../io/state-file/schema';\nimport {\n  CameraConfig,\n  LayersConfig,\n  SliceConfig,\n  VolumeColorConfig,\n  WindowLevelConfig,\n} from './types';\nimport { ensureDefault } from '../../utils';\n\ntype SubViewConfig =\n  | CameraConfig\n  | SliceConfig\n  | VolumeColorConfig\n  | WindowLevelConfig\n  | LayersConfig;\n\ntype ViewConfigGetter = (\n  viewID: string,\n  dataID: string\n) => SubViewConfig | undefined;\n\ntype ViewConfigStateKey = keyof ViewConfig;\n\nexport const serializeViewConfig = <K extends ViewConfigStateKey>(\n  stateFile: StateFile,\n  configGetter: ViewConfigGetter,\n  viewConfigStateKey: K\n) => {\n  const dataIDs = stateFile.manifest.datasets.map((dataset) => dataset.id);\n  const { views } = stateFile.manifest;\n\n  views.forEach((view) => {\n    dataIDs.forEach((dataID) => {\n      const { config } = view;\n\n      const viewConfig = configGetter(view.id, dataID);\n      if (viewConfig !== undefined) {\n        const configForData = ensureDefault(dataID, config, {} as ViewConfig);\n\n        configForData[viewConfigStateKey] = viewConfig as ViewConfig[K];\n      }\n    });\n  });\n};\n\nexport const serializeViewConfigV2 = <\n  K extends ViewConfigStateKey,\n  V extends ViewConfig[K]\n>(\n  stateFile: StateFile,\n  viewConfigs: DoubleKeyRecord<V>,\n  viewConfigStateKey: K\n) => {\n  const dataIDs = stateFile.manifest.datasets.map((dataset) => dataset.id);\n  const { views } = stateFile.manifest;\n\n  views.forEach((view) => {\n    dataIDs.forEach((dataID) => {\n      const { config } = view;\n\n      const viewConfig = viewConfigs[view.id]?.[dataID];\n      if (viewConfig !== undefined) {\n        const configForData = ensureDefault(dataID, config, {} as ViewConfig);\n\n        configForData[viewConfigStateKey] = viewConfig as ViewConfig[K];\n      }\n    });\n  });\n};\n\n/**\n * @param viewConfigs Expected to be a DoubleKeyRecord. Index is ordered as (ViewID, DataID)\n * @param viewConfigStateKey\n * @returns\n */\nexport const createViewConfigSerializer = <\n  K extends ViewConfigStateKey,\n  V extends ViewConfig[K]\n>(\n  viewConfigs: DoubleKeyRecord<V>,\n  viewConfigStateKey: K\n) => {\n  return (stateFile: StateFile) => {\n    serializeViewConfigV2(stateFile, viewConfigs, viewConfigStateKey);\n  };\n};\n","import { clampValue } from '@/src/utils';\nimport { defineStore } from 'pinia';\nimport { reactive } from 'vue';\nimport {\n  DoubleKeyRecord,\n  deleteSecondKey,\n  getDoubleKeyRecord,\n  patchDoubleKeyRecord,\n} from '@/src/utils/doubleKeyRecord';\nimport { Maybe } from '@/src/types';\nimport { createViewConfigSerializer } from './common';\nimport { ViewConfig } from '../../io/state-file/schema';\nimport { SliceConfig } from './types';\n\nexport const defaultSliceConfig = (): SliceConfig => ({\n  slice: 0,\n  min: 0,\n  max: 1,\n  axisDirection: 'Inferior',\n});\n\nexport const useViewSliceStore = defineStore('viewSlice', () => {\n  const configs = reactive<DoubleKeyRecord<SliceConfig>>({});\n\n  const getConfig = (viewID: Maybe<string>, dataID: Maybe<string>) =>\n    getDoubleKeyRecord(configs, viewID, dataID);\n\n  const updateConfig = (\n    viewID: string,\n    dataID: string,\n    patch: Partial<SliceConfig>\n  ) => {\n    const config = {\n      ...defaultSliceConfig(),\n      ...getConfig(viewID, dataID),\n      ...patch,\n    };\n\n    config.slice = clampValue(config.slice, config.min, config.max);\n    patchDoubleKeyRecord(configs, viewID, dataID, config);\n  };\n\n  const resetSlice = (viewID: string, dataID: string) => {\n    const config = getConfig(viewID, dataID);\n    if (!config) return;\n\n    // Setting this to floor() will affect images where the\n    // middle slice is fractional.\n    // This is consistent with vtkImageMapper and SliceRepresentationProxy.\n    updateConfig(viewID, dataID, {\n      slice: Math.ceil((config.min + config.max) / 2),\n    });\n  };\n\n  const removeView = (viewID: string) => {\n    delete configs[viewID];\n  };\n\n  const removeData = (dataID: string, viewID?: string) => {\n    if (viewID) {\n      delete configs[viewID]?.[dataID];\n    } else {\n      deleteSecondKey(configs, dataID);\n    }\n  };\n\n  const serialize = createViewConfigSerializer(configs, 'slice');\n\n  const deserialize = (viewID: string, config: Record<string, ViewConfig>) => {\n    Object.entries(config).forEach(([dataID, viewConfig]) => {\n      if (viewConfig.slice) {\n        updateConfig(viewID, dataID, viewConfig.slice);\n      }\n    });\n  };\n\n  return {\n    configs,\n    getConfig,\n    updateConfig,\n    resetSlice,\n    removeView,\n    removeData,\n    serialize,\n    deserialize,\n  };\n});\n\nexport default useViewSliceStore;\n","import { defineStore } from 'pinia';\nimport { reactive, ref } from 'vue';\nimport {\n  DoubleKeyRecord,\n  deleteSecondKey,\n  getDoubleKeyRecord,\n  patchDoubleKeyRecord,\n} from '@/src/utils/doubleKeyRecord';\nimport { Maybe } from '@/src/types';\nimport { createViewConfigSerializer } from './common';\nimport { ViewConfig } from '../../io/state-file/schema';\nimport { WindowLevelConfig } from './types';\n\nexport const defaultWindowLevelConfig = (): WindowLevelConfig => ({\n  width: 1,\n  level: 0.5,\n  min: 0,\n  max: 1,\n});\n\nconst useWindowingStore = defineStore('windowing', () => {\n  const configs = reactive<DoubleKeyRecord<WindowLevelConfig>>({});\n  const syncAcrossViews = ref(true);\n\n  const setSyncAcrossViews = (yn: boolean) => {\n    syncAcrossViews.value = yn;\n  };\n\n  const getConfig = (viewID: Maybe<string>, dataID: Maybe<string>) =>\n    getDoubleKeyRecord(configs, viewID, dataID);\n\n  /**\n   * Syncs the window/level/min/max params of (srcViewID, srcDataID) across all views sharing the dataset.\n   * @param srcViewID\n   * @param srcDataID\n   */\n  const syncWindowLevel = (srcViewID: string, srcDataID: string) => {\n    if (!syncAcrossViews.value) return;\n\n    const config = configs[srcViewID]?.[srcDataID];\n    if (!config) return;\n\n    Object.keys(configs)\n      .filter((viewID) => viewID !== srcViewID)\n      .forEach((viewID) => {\n        patchDoubleKeyRecord(configs, viewID, srcDataID, config);\n      });\n  };\n\n  const updateConfig = (\n    viewID: string,\n    dataID: string,\n    patch: Partial<WindowLevelConfig>\n  ) => {\n    patchDoubleKeyRecord(configs, viewID, dataID, {\n      ...defaultWindowLevelConfig(),\n      ...configs[viewID]?.[dataID],\n      ...patch,\n    });\n\n    if (syncAcrossViews.value) {\n      syncWindowLevel(viewID, dataID);\n    }\n  };\n\n  const resetWindowLevel = (viewID: string, dataID: string) => {\n    const config = configs[viewID]?.[dataID];\n    if (config == null) return;\n\n    const width = config.max - config.min;\n    const level = (config.max + config.min) / 2;\n    updateConfig(viewID, dataID, { width, level });\n  };\n\n  const removeView = (viewID: string) => {\n    delete configs[viewID];\n  };\n\n  const removeData = (dataID: string, viewID?: string) => {\n    if (viewID) {\n      delete configs[viewID]?.[dataID];\n    } else {\n      deleteSecondKey(configs, dataID);\n    }\n  };\n\n  const serialize = createViewConfigSerializer(configs, 'window');\n\n  const deserialize = (viewID: string, config: Record<string, ViewConfig>) => {\n    Object.entries(config).forEach(([dataID, viewConfig]) => {\n      if (viewConfig.window) {\n        updateConfig(viewID, dataID, viewConfig.window);\n      }\n    });\n  };\n\n  return {\n    configs,\n    getConfig,\n    setSyncAcrossViews,\n    updateConfig,\n    resetWindowLevel,\n    removeView,\n    removeData,\n    serialize,\n    deserialize,\n  };\n});\n\nexport default useWindowingStore;\n","import vtkPiecewiseFunctionProxy from '@kitware/vtk.js/Proxy/Core/PiecewiseFunctionProxy';\nimport vtkColorMaps from '@kitware/vtk.js/Rendering/Core/ColorTransferFunction/ColorMaps';\nimport vtkRenderer from '@kitware/vtk.js/Rendering/Core/Renderer';\nimport vtkOpenGLRenderWindow from '@kitware/vtk.js/Rendering/OpenGL/RenderWindow';\nimport type { Vector2, Vector3 } from '@kitware/vtk.js/types';\nimport { intersectDisplayWithPlane } from '@kitware/vtk.js/Widgets/Manipulators/PlaneManipulator';\nimport { OpacityFunction } from '../types/views';\n\nexport function computeWorldToDisplay(\n  xyz: Vector3,\n  renderer: vtkRenderer\n): Vector2 | null {\n  const view = renderer.getRenderWindow()?.getViews()?.[0];\n  if (view) {\n    const [x, y, z] = xyz;\n    return view.worldToDisplay(x, y, z, renderer);\n  }\n  return null;\n}\n\nexport function computeDisplayToWorld(\n  xy: Vector2,\n  renderer: vtkRenderer\n): Vector3 | null {\n  const view = renderer.getRenderWindow()?.getViews()?.[0];\n  if (view) {\n    const [x, y] = xy;\n    return view.displayToWorld(x, y, 0, renderer);\n  }\n  return null;\n}\n\nexport function normalizeMouseEventPosition(\n  ev: MouseEvent,\n  view: vtkOpenGLRenderWindow\n) {\n  const canvas = view.getCanvas();\n  if (!canvas) return null;\n\n  const bounds = canvas.getBoundingClientRect();\n  const scaleX = canvas.width / bounds.width;\n  const scaleY = canvas.height / bounds.height;\n  return [\n    scaleX * (ev.clientX - bounds.left),\n    scaleY * (bounds.height - ev.clientY + bounds.top),\n  ] as Vector2;\n}\n\nexport function intersectMouseEventWithPlane(\n  ev: MouseEvent,\n  renderer: vtkRenderer,\n  origin: Vector3,\n  normal: Vector3\n) {\n  const view = renderer\n    .getRenderWindow()\n    ?.getViews()[0] as vtkOpenGLRenderWindow;\n  if (!view) return null;\n\n  const position = normalizeMouseEventPosition(ev, view);\n  if (!position) return null;\n\n  return intersectDisplayWithPlane(\n    position[0],\n    position[1],\n    origin,\n    normal,\n    renderer,\n    view\n  );\n}\n\n/**\n * Converts world coordinates to SVG-friendly coordinates.\n *\n * Assumes that the SVG layer is the same size as the renderer.\n * TODO verify this is the case.\n */\nexport function worldToSVG(xyz: Vector3, renderer: vtkRenderer) {\n  const coords = computeWorldToDisplay(xyz, renderer);\n  const view = renderer.getRenderWindow()?.getViews()?.[0];\n  if (coords && view) {\n    const [, height] = view.getViewportSize(renderer);\n    // convert from canvas space to svg space\n    return [\n      coords[0] / devicePixelRatio,\n      (height - coords[1]) / devicePixelRatio,\n    ] as Vector2;\n  }\n  return null;\n}\n\n/**\n * Gets the CSS coordinates for a vtk.js mouse event.\n */\nexport function getCSSCoordinatesFromEvent(eventData: any) {\n  const { pokedRenderer }: { pokedRenderer: vtkRenderer } = eventData;\n  const view = pokedRenderer?.getRenderWindow()?.getViews()?.[0] as\n    | vtkOpenGLRenderWindow\n    | undefined;\n  const bbox = view?.getContainer()?.getBoundingClientRect();\n\n  if (!('position' in eventData) || !bbox) {\n    return null;\n  }\n\n  return [\n    bbox.left + eventData.position.x / devicePixelRatio,\n    bbox.top + bbox.height - eventData.position.y / devicePixelRatio,\n  ] as Vector2;\n}\n\n/**\n * Shifts the opacity points from a preset.\n */\nexport function getShiftedOpacityFromPreset(\n  presetName: string,\n  effectiveRange: [number, number],\n  shift: number\n) {\n  const preset = vtkColorMaps.getPresetByName(presetName);\n  if (preset.OpacityPoints) {\n    const OpacityPoints = preset.OpacityPoints as number[];\n    const points = [];\n    for (let i = 0; i < OpacityPoints.length; i += 2) {\n      points.push([OpacityPoints[i], OpacityPoints[i + 1]]);\n    }\n\n    const [xmin, xmax] = effectiveRange;\n    const width = xmax - xmin;\n    return points.map(([x, y]) => [(x - xmin) / width + shift, y]);\n  }\n  return null;\n}\n\n/**\n * Retrieves an OpacityFunction from a preset.\n */\nexport function getOpacityFunctionFromPreset(\n  presetName: string\n): Partial<OpacityFunction> {\n  const preset = vtkColorMaps.getPresetByName(presetName);\n\n  if (preset.OpacityPoints) {\n    return {\n      mode: vtkPiecewiseFunctionProxy.Mode.Points,\n      preset: presetName,\n      shift: 0,\n    };\n  }\n  return {\n    mode: vtkPiecewiseFunctionProxy.Mode.Gaussians,\n    // deep-copy necessary\n    gaussians: JSON.parse(\n      JSON.stringify(vtkPiecewiseFunctionProxy.Defaults.Gaussians)\n    ),\n  };\n}\n\n/**\n * Inflate an axis bounds defined as [min, max] by some delta.\n *\n * @param bounds Must be [number, number]. (Typed number[] for convenience.)\n * @param delta\n * @returns\n */\nexport function inflateAxisBounds(bounds: number[], delta: number) {\n  return [bounds[0] + delta, bounds[1] + delta];\n}\n\n/**\n * Retrieves the color function range, if any.\n *\n * Will only return the color function range if the preset\n * has AbsoluteRange specified as true. For medical presets,\n * the range is defined by the transfer function point range,\n * rather than the dataset data range.\n * @param presetName\n * @returns\n */\nexport function getColorFunctionRangeFromPreset(\n  presetName: string\n): [number, number] | null {\n  const preset = vtkColorMaps.getPresetByName(presetName);\n  if (!preset) return null;\n\n  const { AbsoluteRange, RGBPoints } = preset;\n  if (AbsoluteRange && RGBPoints) {\n    let min = Infinity;\n    let max = -Infinity;\n    for (let i = 0; i < RGBPoints.length; i += 4) {\n      min = Math.min(min, RGBPoints[i]);\n      max = Math.max(max, RGBPoints[i]);\n    }\n    return [min, max];\n  }\n  return null;\n}\n\n/**\n * Retrieves the effective opacity mapping range, if any.\n *\n * Presets may specify an effective range for the scalar opacity\n * mapping range.\n * @param presetName\n * @returns\n */\nexport function getOpacityRangeFromPreset(presetName: string) {\n  const preset = vtkColorMaps.getPresetByName(presetName);\n  if (preset.EffectiveRange) {\n    return [...preset.EffectiveRange] as [number, number];\n  }\n  return null;\n}\n","import vtkColorMaps from '@kitware/vtk.js/Rendering/Core/ColorTransferFunction/ColorMaps';\nimport MedicalPresets from '@/src/vtk/MedicalColorPresets.json';\n\nfunction registerPresets(presets: typeof MedicalPresets) {\n  for (let i = 0; i < presets.length; i += 1) {\n    vtkColorMaps.addPreset(presets[i]);\n  }\n}\n\nregisterPresets(MedicalPresets);\n\n/* prettier-ignore */\nconst GroupedPresets = [\n  {\n    group: 'CT',\n    presets: [\n      'CT-AAA',\n      'CT-AAA2',\n      'CT-Bone',\n      'CT-Bones',\n      'CT-Cardiac',\n      'CT-Cardiac2',\n      'CT-Cardiac3',\n      'CT-Chest-Contrast-Enhanced',\n      'CT-Chest-Vessels',\n      'CT-Coronary-Arteries',\n      'CT-Coronary-Arteries-2',\n      'CT-Coronary-Arteries-3',\n      'CT-Cropped-Volume-Bone',\n      'CT-Fat',\n      'CT-Liver-Vasculature',\n      'CT-Lung',\n      'CT-MIP',\n      'CT-Muscle',\n      'CT-Pulmonary-Arteries',\n      'CT-Soft-Tissue',\n      'CT-Air',\n      'CT-X-ray',\n    ],\n  },\n  {\n    group: 'MR',\n    presets: [\n      'MR-Default',\n      'MR-Angio',\n      'MR-MIP',\n      'MR-T2-Brain',\n    ],\n  },\n  {\n    group: 'DTI',\n    presets: [\n      'DTI-FA-Brain',\n    ],\n  },\n  {\n    group: 'US',\n    presets: [\n      'US-Fetal',\n    ],\n  },\n];\n\nexport const DEFAULT_PRESET = 'CT-AAA';\nexport const PresetNameList = GroupedPresets.flatMap((group) => group.presets);\nexport default GroupedPresets;\n","import vtkImageData from '@kitware/vtk.js/Common/DataModel/ImageData';\nimport vtkPiecewiseFunctionProxy from '@kitware/vtk.js/Proxy/Core/PiecewiseFunctionProxy';\nimport {\n  getColorFunctionRangeFromPreset,\n  getOpacityFunctionFromPreset,\n} from '@/src/utils/vtk-helpers';\nimport { ColorTransferFunction } from '@/src/types/views';\nimport { defineStore } from 'pinia';\nimport { reactive } from 'vue';\nimport {\n  DoubleKeyRecord,\n  deleteSecondKey,\n  getDoubleKeyRecord,\n  patchDoubleKeyRecord,\n} from '@/src/utils/doubleKeyRecord';\nimport { Maybe } from '@/src/types';\nimport { identity } from '@/src/utils';\nimport { createViewConfigSerializer } from './common';\nimport { DEFAULT_PRESET } from '../../vtk/ColorMaps';\nimport { ViewConfig } from '../../io/state-file/schema';\nimport { LayersConfig } from './types';\nimport { LayerID, useLayersStore } from '../datasets-layers';\nimport { useDICOMStore } from '../datasets-dicom';\n\nexport const MODALITY_TO_PRESET: Record<string, string> = {\n  PT: '2hot',\n};\n\nfunction getPreset(id: LayerID) {\n  const layersStore = useLayersStore();\n  const layer = layersStore.getLayer(id);\n  if (layer) {\n    if (layer.selection.type === 'dicom') {\n      const dicomStore = useDICOMStore();\n      const { Modality = undefined } =\n        dicomStore.volumeInfo[layer.selection.volumeKey];\n      return (Modality && MODALITY_TO_PRESET[Modality]) || DEFAULT_PRESET;\n    }\n  }\n  return DEFAULT_PRESET;\n}\n\nexport const defaultLayersConfig = (): LayersConfig => ({\n  colorBy: {\n    arrayName: '',\n    location: 'pointData',\n  },\n  transferFunction: {\n    preset: '',\n    mappingRange: [0, 1],\n  },\n  opacityFunction: {\n    mode: vtkPiecewiseFunctionProxy.Mode.Gaussians,\n    gaussians: [],\n    mappingRange: [0, 1],\n  },\n  blendConfig: { opacity: 0.6 },\n});\n\nexport const useLayerColoringStore = defineStore('layerColoring', () => {\n  const configs = reactive<DoubleKeyRecord<LayersConfig>>({});\n\n  const getConfig = (viewID: Maybe<string>, dataID: Maybe<string>) =>\n    getDoubleKeyRecord(configs, viewID, dataID);\n\n  const updateConfig = (\n    viewID: string,\n    dataID: string,\n    patch: Partial<LayersConfig>\n  ) => {\n    const config = {\n      ...defaultLayersConfig(),\n      ...getConfig(viewID, dataID),\n      ...patch,\n    };\n\n    patchDoubleKeyRecord(configs, viewID, dataID, config);\n  };\n\n  const createUpdateFunc = <K extends keyof LayersConfig>(\n    key: K,\n    transform: (config: LayersConfig[K]) => LayersConfig[K] = identity\n  ) => {\n    return (\n      viewID: string,\n      dataID: LayerID,\n      update: Partial<LayersConfig[K]>\n    ) => {\n      const config = getConfig(viewID, dataID) ?? defaultLayersConfig();\n      const updatedConfig = transform({\n        ...config[key],\n        ...update,\n      });\n      updateConfig(viewID, dataID, { [key]: updatedConfig });\n    };\n  };\n\n  const updateColorBy = createUpdateFunc('colorBy');\n  const updateColorTransferFunction = createUpdateFunc('transferFunction');\n  const updateOpacityFunction = createUpdateFunc('opacityFunction');\n  const updateBlendConfig = createUpdateFunc('blendConfig');\n\n  const setColorPreset = (viewID: string, layerID: LayerID, preset: string) => {\n    const layersStore = useLayersStore();\n    const image = layersStore.layerImages[layerID];\n    if (!image) return;\n    const imageDataRange = image.getPointData().getScalars().getRange();\n\n    const ctRange = getColorFunctionRangeFromPreset(preset);\n    const ctFunc: Partial<ColorTransferFunction> = {\n      preset,\n      mappingRange: ctRange || imageDataRange,\n    };\n    updateColorTransferFunction(viewID, layerID, ctFunc);\n\n    const opFunc = getOpacityFunctionFromPreset(preset);\n    opFunc.mappingRange = imageDataRange;\n    updateOpacityFunction(viewID, layerID, opFunc);\n  };\n\n  const resetToDefault = (\n    viewID: string,\n    dataID: LayerID,\n    image: vtkImageData\n  ) => {\n    const scalars = image.getPointData().getScalars();\n\n    updateColorBy(viewID, dataID, {\n      arrayName: scalars.getName() + dataID,\n      location: 'pointData',\n    });\n    setColorPreset(viewID, dataID, getPreset(dataID));\n  };\n\n  const removeView = (viewID: string) => {\n    delete configs[viewID];\n  };\n\n  const removeData = (dataID: string, viewID?: string) => {\n    if (viewID) {\n      delete configs[viewID]?.[dataID];\n    } else {\n      deleteSecondKey(configs, dataID);\n    }\n  };\n\n  const serialize = createViewConfigSerializer(configs, 'layers');\n\n  const deserialize = (viewID: string, config: Record<string, ViewConfig>) => {\n    Object.entries(config).forEach(([dataID, viewConfig]) => {\n      if (viewConfig.layers) {\n        updateConfig(viewID, dataID, viewConfig.layers);\n      }\n    });\n  };\n\n  return {\n    configs,\n    getConfig,\n    updateConfig,\n    updateColorBy,\n    updateColorTransferFunction,\n    updateOpacityFunction,\n    updateBlendConfig,\n    resetToDefault,\n    setColorPreset,\n    removeView,\n    removeData,\n    serialize,\n    deserialize,\n  };\n});\n\nexport default useLayerColoringStore;\n","import { defineStore } from 'pinia';\nimport {\n  DoubleKeyRecord,\n  deleteSecondKey,\n  getDoubleKeyRecord,\n  patchDoubleKeyRecord,\n} from '@/src/utils/doubleKeyRecord';\nimport { reactive } from 'vue';\nimport { Maybe } from '@/src/types';\nimport { createViewConfigSerializer } from './common';\nimport { ViewConfig } from '../../io/state-file/schema';\nimport { CameraConfig } from './types';\n\nexport const useViewCameraStore = defineStore('viewCamera', () => {\n  const configs = reactive<DoubleKeyRecord<CameraConfig>>({});\n\n  const getConfig = (viewID: Maybe<string>, dataID: Maybe<string>) =>\n    getDoubleKeyRecord(configs, viewID, dataID);\n\n  const updateConfig = (\n    viewID: string,\n    dataID: string,\n    patch: Partial<CameraConfig>\n  ) => {\n    const config = {\n      ...getConfig(viewID, dataID),\n      ...patch,\n    };\n\n    patchDoubleKeyRecord(configs, viewID, dataID, config);\n  };\n\n  const removeView = (viewID: string) => {\n    delete configs[viewID];\n  };\n\n  const removeData = (dataID: string, viewID?: string) => {\n    if (viewID) {\n      delete configs[viewID]?.[dataID];\n    } else {\n      deleteSecondKey(configs, dataID);\n    }\n  };\n\n  const serialize = createViewConfigSerializer(configs, 'camera');\n\n  const deserialize = (viewID: string, config: Record<string, ViewConfig>) => {\n    Object.entries(config).forEach(([dataID, viewConfig]) => {\n      if (viewConfig.camera) {\n        updateConfig(viewID, dataID, viewConfig.camera);\n      }\n    });\n  };\n\n  return {\n    configs,\n    getConfig,\n    updateConfig,\n    removeView,\n    removeData,\n    serialize,\n    deserialize,\n  };\n});\n\nexport default useViewCameraStore;\n","import vtkImageData from '@kitware/vtk.js/Common/DataModel/ImageData';\nimport vtkPiecewiseFunctionProxy from '@kitware/vtk.js/Proxy/Core/PiecewiseFunctionProxy';\nimport {\n  getColorFunctionRangeFromPreset,\n  getOpacityFunctionFromPreset,\n} from '@/src/utils/vtk-helpers';\nimport { DEFAULT_PRESET_BY_MODALITY } from '@/src/config';\nimport { ColorTransferFunction } from '@/src/types/views';\nimport { defineStore } from 'pinia';\nimport { reactive } from 'vue';\nimport {\n  DoubleKeyRecord,\n  deleteSecondKey,\n  getDoubleKeyRecord,\n  patchDoubleKeyRecord,\n} from '@/src/utils/doubleKeyRecord';\nimport { Maybe } from '@/src/types';\nimport { identity } from '@/src/utils';\nimport { createViewConfigSerializer } from './common';\nimport { DEFAULT_PRESET } from '../../vtk/ColorMaps';\nimport { ViewConfig } from '../../io/state-file/schema';\nimport { VolumeColorConfig } from './types';\nimport { useDICOMStore } from '../datasets-dicom';\nimport { useImageStore } from '../datasets-images';\n\nexport const DEFAULT_AMBIENT = 0.2;\nexport const DEFAULT_DIFFUSE = 0.7;\nexport const DEFAULT_SPECULAR = 0.3;\n\nfunction getPresetFromImageModality(imageID: string) {\n  const dicomStore = useDICOMStore();\n  if (imageID in dicomStore.imageIDToVolumeKey) {\n    const volKey = dicomStore.imageIDToVolumeKey[imageID];\n    const { Modality } = dicomStore.volumeInfo[volKey];\n    if (Modality in DEFAULT_PRESET_BY_MODALITY) {\n      return DEFAULT_PRESET_BY_MODALITY[Modality];\n    }\n  }\n  return DEFAULT_PRESET;\n}\n\nexport const defaultVolumeColorConfig = (): VolumeColorConfig => ({\n  colorBy: {\n    arrayName: '',\n    location: 'pointData',\n  },\n  transferFunction: {\n    preset: '',\n    mappingRange: [0, 1],\n  },\n  opacityFunction: {\n    mode: vtkPiecewiseFunctionProxy.Mode.Gaussians,\n    gaussians: [],\n    mappingRange: [0, 1],\n  },\n  cvr: {\n    enabled: true,\n    lightFollowsCamera: true,\n    volumeQuality: 2,\n    useVolumetricScatteringBlending: true,\n    volumetricScatteringBlending: 0.5,\n    useLocalAmbientOcclusion: true,\n    laoKernelRadius: 5,\n    laoKernelSize: 15,\n    ambient: DEFAULT_AMBIENT,\n    diffuse: DEFAULT_DIFFUSE,\n    specular: DEFAULT_SPECULAR,\n  },\n});\n\nexport const useVolumeColoringStore = defineStore('volumeColoring', () => {\n  const configs = reactive<DoubleKeyRecord<VolumeColorConfig>>({});\n\n  const getConfig = (viewID: Maybe<string>, dataID: Maybe<string>) =>\n    getDoubleKeyRecord(configs, viewID, dataID);\n\n  const updateConfig = (\n    viewID: string,\n    dataID: string,\n    patch: Partial<VolumeColorConfig>\n  ) => {\n    const config = {\n      ...defaultVolumeColorConfig(),\n      ...getConfig(viewID, dataID),\n      ...patch,\n    };\n\n    patchDoubleKeyRecord(configs, viewID, dataID, config);\n  };\n\n  const createUpdateFunc = <K extends keyof VolumeColorConfig>(\n    key: K,\n    transform: (config: VolumeColorConfig[K]) => VolumeColorConfig[K] = identity\n  ) => {\n    return (\n      viewID: string,\n      dataID: string,\n      update: Partial<VolumeColorConfig[K]>\n    ) => {\n      const config = getConfig(viewID, dataID) ?? defaultVolumeColorConfig();\n      const updatedConfig = transform({\n        ...config[key],\n        ...update,\n      });\n      updateConfig(viewID, dataID, { [key]: updatedConfig });\n    };\n  };\n\n  const updateColorBy = createUpdateFunc('colorBy');\n  const updateColorTransferFunction = createUpdateFunc('transferFunction');\n  const updateOpacityFunction = createUpdateFunc('opacityFunction');\n  const updateCVRParameters = createUpdateFunc('cvr');\n\n  const setColorPreset = (viewID: string, imageID: string, preset: string) => {\n    const imageStore = useImageStore();\n    const image = imageStore.dataIndex[imageID];\n    if (!image) return;\n    const imageDataRange = image.getPointData().getScalars().getRange();\n\n    const ctRange = getColorFunctionRangeFromPreset(preset);\n    const ctFunc: Partial<ColorTransferFunction> = {\n      preset,\n      mappingRange: ctRange || imageDataRange,\n    };\n    updateColorTransferFunction(viewID, imageID, ctFunc);\n\n    const opFunc = getOpacityFunctionFromPreset(preset);\n    opFunc.mappingRange = imageDataRange;\n    updateOpacityFunction(viewID, imageID, opFunc);\n  };\n\n  const resetToDefaultColoring = (\n    viewID: string,\n    dataID: string,\n    image: vtkImageData\n  ) => {\n    const scalars = image.getPointData().getScalars();\n\n    updateColorBy(viewID, dataID, {\n      arrayName: scalars.getName(),\n      location: 'pointData',\n    });\n    setColorPreset(viewID, dataID, getPresetFromImageModality(dataID));\n  };\n\n  const removeView = (viewID: string) => {\n    delete configs[viewID];\n  };\n\n  const removeData = (dataID: string, viewID?: string) => {\n    if (viewID) {\n      delete configs[viewID]?.[dataID];\n    } else {\n      deleteSecondKey(configs, dataID);\n    }\n  };\n\n  const serialize = createViewConfigSerializer(configs, 'volumeColorConfig');\n\n  const deserialize = (viewID: string, config: Record<string, ViewConfig>) => {\n    Object.entries(config).forEach(([dataID, viewConfig]) => {\n      if (viewConfig.volumeColorConfig) {\n        updateConfig(viewID, dataID, viewConfig.volumeColorConfig);\n      }\n    });\n  };\n\n  return {\n    configs,\n    getConfig,\n    updateConfig,\n    updateColorBy,\n    updateColorTransferFunction,\n    updateOpacityFunction,\n    updateCVRParameters,\n    resetToDefaultColoring,\n    setColorPreset,\n    removeView,\n    removeData,\n    serialize,\n    deserialize,\n  };\n});\n\nexport default useVolumeColoringStore;\n","import { defineStore } from 'pinia';\n\nimport useViewSliceStore from './view-configs/slicing';\nimport useWindowingStore from './view-configs/windowing';\nimport useLayerColoringStore from './view-configs/layers';\nimport useViewCameraStore from './view-configs/camera';\nimport useVolumeColoringStore from './view-configs/volume-coloring';\nimport { StateFile, ViewConfig } from '../io/state-file/schema';\nimport { useImageStore } from './datasets-images';\n\n/**\n * This store saves view configuration that is associated with a specific\n * view. The key is a synthetic id generated from the view ID and data ID.\n */\nexport const useViewConfigStore = defineStore('viewConfig', () => {\n  const viewSliceStore = useViewSliceStore();\n  const windowingStore = useWindowingStore();\n  const layerColoringStore = useLayerColoringStore();\n  const viewCameraStore = useViewCameraStore();\n  const volumeColoringStore = useVolumeColoringStore();\n\n  const removeView = (viewID: string) => {\n    viewSliceStore.removeView(viewID);\n    windowingStore.removeView(viewID);\n    layerColoringStore.removeView(viewID);\n    viewCameraStore.removeView(viewID);\n    volumeColoringStore.removeView(viewID);\n  };\n\n  const removeData = (dataID: string, viewID?: string) => {\n    viewSliceStore.removeData(dataID, viewID);\n    windowingStore.removeData(dataID, viewID);\n    layerColoringStore.removeData(dataID, viewID);\n    viewCameraStore.removeData(dataID, viewID);\n    volumeColoringStore.removeData(dataID, viewID);\n  };\n\n  const serialize = (stateFile: StateFile) => {\n    viewSliceStore.serialize(stateFile);\n    windowingStore.serialize(stateFile);\n    layerColoringStore.serialize(stateFile);\n    viewCameraStore.serialize(stateFile);\n    volumeColoringStore.serialize(stateFile);\n  };\n\n  const deserialize = (\n    viewID: string,\n    config: Record<string, ViewConfig>,\n    dataIDMap: Record<string, string>\n  ) => {\n    // First update the view config map to use the new dataIDs\n    const updatedConfig: Record<string, ViewConfig> = {};\n    Object.entries(config).forEach(([dataID, viewConfig]) => {\n      const newDataID = dataIDMap[dataID];\n      updatedConfig[newDataID] = viewConfig;\n    });\n\n    viewSliceStore.deserialize(viewID, updatedConfig);\n    windowingStore.deserialize(viewID, updatedConfig);\n    layerColoringStore.deserialize(viewID, updatedConfig);\n    viewCameraStore.deserialize(viewID, updatedConfig);\n    volumeColoringStore.deserialize(viewID, updatedConfig);\n  };\n\n  // delete hook\n  const imageStore = useImageStore();\n  imageStore.$onAction(({ name, args }) => {\n    if (name === 'deleteData') {\n      const [id] = args;\n      removeData(id);\n    }\n  });\n\n  return {\n    removeView,\n    removeData,\n    serialize,\n    deserialize,\n  };\n});\n","import vtkAbstractRepresentationProxy from '@kitware/vtk.js/Proxy/Core/AbstractRepresentationProxy';\nimport vtkViewProxy from '@kitware/vtk.js/Proxy/Core/ViewProxy';\nimport { defineStore } from 'pinia';\nimport { DefaultViewSpec, InitViewSpecs } from '../config';\nimport { ViewProxyType } from '../core/proxies';\nimport { Layout, LayoutDirection } from '../types/layout';\nimport { useViewConfigStore } from './view-configs';\nimport { ViewSpec } from '../types/views';\nimport {\n  StateFile,\n  Layout as StateFileLayout,\n  View,\n} from '../io/state-file/schema';\n\ninterface State {\n  layout: Layout;\n  viewSpecs: Record<string, ViewSpec>;\n}\n\nexport const useViewStore = defineStore('view', {\n  state: (): State => ({\n    layout: {\n      direction: LayoutDirection.V,\n      items: [],\n    },\n    viewSpecs: structuredClone(InitViewSpecs),\n  }),\n  getters: {\n    viewIDs(state) {\n      return Object.keys(state.viewSpecs);\n    },\n    getViewProxy() {\n      return <T extends vtkViewProxy>(id: string) => {\n        return this.$proxies.getView<T>(id);\n      };\n    },\n    getDataRepresentationForView() {\n      return <T extends vtkAbstractRepresentationProxy>(\n        dataID: string,\n        viewID: string\n      ) => {\n        return <T | null>(\n          this.$proxies.getDataRepresentationForView(dataID, viewID)\n        );\n      };\n    },\n  },\n  actions: {\n    createOrGetViewProxy<T extends vtkViewProxy = vtkViewProxy>(\n      id: string,\n      type: ViewProxyType\n    ) {\n      return (\n        this.$proxies.getView<T>(id) ?? <T>this.$proxies.createView(id, type)\n      );\n    },\n    addView(id: string) {\n      if (!(id in this.viewSpecs)) {\n        this.viewSpecs[id] = structuredClone(DefaultViewSpec);\n      }\n    },\n    removeView(id: string) {\n      if (id in this.viewSpecs) {\n        delete this.viewSpecs[id];\n        this.$proxies.removeView(id);\n      }\n    },\n    setLayout(layout: Layout) {\n      this.layout = layout;\n\n      const layoutsToProcess = [layout];\n      while (layoutsToProcess.length) {\n        const ly = layoutsToProcess.shift()!;\n        ly.items.forEach((item) => {\n          if (typeof item === 'string') {\n            // item is a view ID\n            this.addView(item);\n          } else {\n            layoutsToProcess.push(item);\n          }\n        });\n      }\n    },\n    serialize(stateFile: StateFile) {\n      const viewConfigStore = useViewConfigStore();\n      const { manifest } = stateFile;\n      const { views } = manifest;\n\n      manifest.layout = this.layout as StateFileLayout;\n\n      // Serialize the view specs\n      Object.entries(this.viewSpecs).forEach(([id, spec]) => {\n        const type = spec.viewType;\n        const { props } = spec;\n        const config = {};\n\n        const view = {\n          id,\n          type,\n          props,\n          config,\n        };\n\n        views.push(view);\n      });\n\n      // Serialize the view config\n      viewConfigStore.serialize(stateFile);\n    },\n    deserialize(views: View[], dataIDMap: Record<string, string>) {\n      const viewConfigStore = useViewConfigStore();\n\n      views.forEach((view) => {\n        const viewID = view.id;\n\n        const viewSpec = {\n          viewType: view.type,\n          props: view.props,\n        };\n\n        this.viewSpecs[viewID] = viewSpec;\n\n        // Now delegate the deserialization of the view config\n        const { config } = view;\n        viewConfigStore.deserialize(viewID, config, dataIDMap);\n      });\n    },\n  },\n});\n","import { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport vtkCrosshairsWidget from '@/src/vtk/CrosshairsWidget';\nimport type { Bounds, Vector3 } from '@kitware/vtk.js/types';\nimport { inflate } from '@kitware/vtk.js/Common/DataModel/BoundingBox';\nimport { computed, ref, unref, watch } from 'vue';\nimport { vec3 } from 'gl-matrix';\nimport { defineStore } from 'pinia';\nimport { getLPSAxisFromDir } from '@/src/utils/lps';\nimport { Manifest, StateFile } from '@/src/io/state-file/schema';\nimport { useViewStore } from '../views';\nimport useViewSliceStore from '../view-configs/slicing';\n\nexport const useCrosshairsToolStore = defineStore('crosshairs', () => {\n  type _This = ReturnType<typeof useCrosshairsToolStore>;\n\n  const factory = vtkCrosshairsWidget.newInstance();\n  const widgetState = factory.getWidgetState();\n  const handle = widgetState.getHandle();\n\n  const active = ref(false);\n  const { currentImageID, currentImageMetadata } = useCurrentImage();\n\n  // world-space\n  const position = ref<Vector3>([0, 0, 0]);\n  // image space\n  const imagePosition = computed(() => {\n    const out = vec3.create();\n    vec3.transformMat4(\n      out,\n      position.value,\n      currentImageMetadata.value.worldToIndex\n    );\n    return out as Vector3;\n  });\n\n  const viewSliceStore = useViewSliceStore();\n  const viewStore = useViewStore();\n\n  // only gets views that have a slicing config\n  const currentViewIDs = computed(() => {\n    const imageID = unref(currentImageID);\n    if (imageID) {\n      return viewStore.viewIDs.filter(\n        (viewID) => !!viewSliceStore.getConfig(viewID, imageID)\n      );\n    }\n    return [];\n  });\n\n  function getWidgetFactory(this: _This) {\n    return factory;\n  }\n\n  function setPosition(pos: Vector3) {\n    position.value = pos;\n  }\n\n  // update the slicing\n  watch(imagePosition, (indexPos) => {\n    if (active.value) {\n      const imageID = unref(currentImageID);\n      const { lpsOrientation } = unref(currentImageMetadata);\n\n      if (!imageID) {\n        return;\n      }\n\n      currentViewIDs.value.forEach((viewID) => {\n        const sliceConfig = viewSliceStore.getConfig(viewID, imageID);\n        const axis = getLPSAxisFromDir(sliceConfig!.axisDirection);\n        const index = lpsOrientation[axis];\n        const slice = Math.round(indexPos[index]);\n        viewSliceStore.updateConfig(viewID, imageID, { slice });\n      });\n    }\n  });\n\n  // update widget state based on current image\n  watch(\n    currentImageMetadata,\n    (metadata) => {\n      widgetState.setIndexToWorld(metadata.indexToWorld);\n      widgetState.setWorldToIndex(metadata.worldToIndex);\n      const [xDim, yDim, zDim] = metadata.dimensions;\n      const imageBounds: Bounds = [0, xDim - 1, 0, yDim - 1, 0, zDim - 1];\n      // inflate by 0.5, since the image slice rendering is inflated\n      // by 0.5.\n      handle.setBounds(inflate(imageBounds, 0.5));\n    },\n    { immediate: true }\n  );\n\n  // update the position\n  handle.onModified(() => {\n    const origin = handle.getOrigin();\n    if (origin) {\n      position.value = origin;\n    }\n  });\n\n  function activateTool() {\n    widgetState.setPlaced(false);\n    active.value = true;\n    return true;\n  }\n\n  function deactivateTool() {\n    active.value = false;\n  }\n\n  function serialize(state: StateFile) {\n    const { crosshairs } = state.manifest.tools;\n    crosshairs.position = position.value;\n  }\n\n  function deserialize(manifest: Manifest) {\n    const { crosshairs } = manifest.tools;\n    position.value = crosshairs.position;\n  }\n\n  return {\n    getWidgetFactory,\n    setPosition,\n    position,\n    imagePosition,\n    activateTool,\n    deactivateTool,\n    serialize,\n    deserialize,\n  };\n});\n","import type { Vector2 } from '@kitware/vtk.js/types';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { Manifest, StateFile } from '@/src/io/state-file/schema';\nimport { computed, ref, watch } from 'vue';\nimport { vec3 } from 'gl-matrix';\nimport { defineStore } from 'pinia';\nimport { Tools } from './types';\nimport { useLabelmapStore } from '../datasets-labelmaps';\n\nconst DEFAULT_BRUSH_SIZE = 4;\nconst DEFAULT_BRUSH_VALUE = 1;\n\nexport const usePaintToolStore = defineStore('paint', () => {\n  type _This = ReturnType<typeof usePaintToolStore>;\n\n  const activeLabelmapID = ref<string | null>(null);\n  const brushSize = ref(DEFAULT_BRUSH_SIZE);\n  const brushValue = ref(DEFAULT_BRUSH_VALUE);\n  const strokePoints = ref<vec3[]>([]);\n  const labelmapOpacity = ref(1);\n  const isActive = ref(false);\n\n  const { currentImageID } = useCurrentImage();\n\n  function getWidgetFactory(this: _This) {\n    return this.$paint.factory;\n  }\n\n  const activeLabelmap = computed(() => {\n    if (!activeLabelmapID.value) return null;\n    const labelmapStore = useLabelmapStore();\n    return labelmapStore.labelmaps[activeLabelmapID.value] ?? null;\n  });\n\n  // --- actions --- //\n\n  function selectOrCreateLabelmap(imageID: string | null) {\n    if (!imageID) {\n      activeLabelmapID.value = null;\n      return;\n    }\n\n    const labelmapStore = useLabelmapStore();\n    const found = Object.entries(labelmapStore.parentImage).find(\n      ([, parentID]) => imageID === parentID\n    );\n    if (found) {\n      [activeLabelmapID.value] = found;\n    } else {\n      activeLabelmapID.value = labelmapStore.newLabelmapFromImage(imageID);\n    }\n  }\n\n  function setBrushSize(this: _This, size: number) {\n    brushSize.value = Math.round(size);\n    this.$paint.setBrushSize(size);\n  }\n\n  function setBrushValue(this: _This, value: number) {\n    brushValue.value = value;\n    this.$paint.setBrushValue(value);\n  }\n\n  function setLabelmapOpacity(opacity: number) {\n    labelmapOpacity.value = Math.min(1, Math.max(0, opacity));\n  }\n\n  function doPaintStroke(this: _This, axisIndex: 0 | 1 | 2) {\n    if (!activeLabelmap.value) {\n      return;\n    }\n\n    const lastIndex = strokePoints.value.length - 1;\n    if (lastIndex >= 0) {\n      const lastPoint = strokePoints.value[lastIndex];\n      const prevPoint =\n        lastIndex >= 1 ? strokePoints.value[lastIndex - 1] : undefined;\n      this.$paint.paintLabelmap(\n        activeLabelmap.value,\n        axisIndex,\n        lastPoint,\n        prevPoint\n      );\n    }\n  }\n\n  function setSliceAxis(this: _This, axisIndex: 0 | 1 | 2) {\n    if (!activeLabelmap.value) return;\n    const spacing = activeLabelmap.value.getSpacing();\n    spacing.splice(axisIndex, 1);\n    const scale: Vector2 = [1 / spacing[0], 1 / spacing[1]];\n    this.$paint.setBrushScale(scale);\n  }\n\n  function startStroke(this: _This, indexPoint: vec3, axisIndex: 0 | 1 | 2) {\n    strokePoints.value = [vec3.clone(indexPoint)];\n    doPaintStroke.call(this, axisIndex);\n  }\n\n  function placeStrokePoint(\n    this: _This,\n    indexPoint: vec3,\n    axisIndex: 0 | 1 | 2\n  ) {\n    strokePoints.value.push(indexPoint);\n    doPaintStroke.call(this, axisIndex);\n  }\n\n  function endStroke(this: _This, indexPoint: vec3, axisIndex: 0 | 1 | 2) {\n    strokePoints.value.push(indexPoint);\n    doPaintStroke.call(this, axisIndex);\n  }\n\n  // --- setup and teardown --- //\n\n  function activateTool(this: _This) {\n    const imageID = currentImageID.value;\n    if (!imageID) {\n      return false;\n    }\n    selectOrCreateLabelmap(imageID);\n    this.$paint.setBrushSize(this.brushSize);\n\n    isActive.value = true;\n    return true;\n  }\n\n  function deactivateTool() {\n    activeLabelmapID.value = null;\n    isActive.value = false;\n  }\n\n  function serialize(state: StateFile) {\n    const { paint } = state.manifest.tools;\n\n    paint.activeLabelmapID = activeLabelmapID.value;\n    paint.brushSize = brushSize.value;\n    paint.brushValue = brushValue.value;\n    paint.labelmapOpacity = labelmapOpacity.value;\n  }\n\n  function deserialize(\n    this: _This,\n    manifest: Manifest,\n    labelmapIDMap: Record<string, string>\n  ) {\n    const { paint } = manifest.tools;\n    this.setBrushSize(paint.brushSize);\n    this.setBrushValue(paint.brushValue);\n    this.setLabelmapOpacity(paint.labelmapOpacity);\n    isActive.value = manifest.tools.current === Tools.Paint;\n\n    if (paint.activeLabelmapID !== null) {\n      activeLabelmapID.value = labelmapIDMap[paint.activeLabelmapID];\n    }\n  }\n\n  // --- change labelmap if paint is active --- //\n\n  watch(currentImageID, (imageID) => {\n    if (isActive.value) {\n      selectOrCreateLabelmap(imageID);\n    }\n  });\n\n  return {\n    // state\n    activeLabelmapID,\n    brushSize,\n    brushValue,\n    strokePoints,\n    labelmapOpacity,\n    isActive,\n\n    getWidgetFactory,\n\n    activateTool,\n    deactivateTool,\n\n    selectOrCreateLabelmap,\n    setBrushSize,\n    setBrushValue,\n    setLabelmapOpacity,\n    setSliceAxis,\n    startStroke,\n    placeStrokePoint,\n    endStroke,\n    serialize,\n    deserialize,\n  };\n});\n","import { vec3 } from 'gl-matrix';\nimport type { Vector3 } from '@kitware/vtk.js/types';\nimport { LPSAxis } from '../types/lps';\nimport { EPSILON } from '../constants';\nimport { roundIfCloseToInteger } from '.';\nimport { ImageMetadata } from '../types/image';\n\nconst tmp = vec3.create();\n\n/**\n * Defines a 2D plane used for locating annotations.\n */\nexport interface FrameOfReference {\n  planeNormal: Vector3;\n  planeOrigin: Vector3;\n}\n\nexport interface FrameOfReferenceToImageSliceAndAxisOptions {\n  epsilon?: number;\n  allowNonIntegralSlice?: boolean;\n  allowOutOfBoundsSlice?: boolean;\n}\n\n/**\n * Returns the image slice and LPS axis for a given frame of reference.\n *\n * If the frame of reference is not aligned to the image metadata, then null is returned.\n * @param {FrameOfReference} frame\n * @param {ImageMetadata} metadata\n * @param {FrameOfReferenceToImageSliceAndAxisOptions?} options\n */\nexport function frameOfReferenceToImageSliceAndAxis(\n  frame: FrameOfReference,\n  metadata: ImageMetadata,\n  options?: FrameOfReferenceToImageSliceAndAxisOptions\n): { axis: LPSAxis; slice: number } | null {\n  const epsilon = options?.epsilon ?? EPSILON;\n  const allowNonIntegralSlice = options?.allowNonIntegralSlice ?? false;\n  const allowOutOfBoundsSlice = options?.allowOutOfBoundsSlice ?? false;\n\n  const { planeNormal, planeOrigin } = frame;\n  const { dimensions, lpsOrientation, worldToIndex } = metadata;\n\n  let axis: LPSAxis | null = null;\n  const { Left, Right, Posterior, Anterior, Superior, Inferior } =\n    lpsOrientation;\n  if (vec3.equals(Left, planeNormal) || vec3.equals(Right, planeNormal)) {\n    axis = 'Sagittal';\n  } else if (\n    vec3.equals(Posterior, planeNormal) ||\n    vec3.equals(Anterior, planeNormal)\n  ) {\n    axis = 'Coronal';\n  } else if (\n    vec3.equals(Superior, planeNormal) ||\n    vec3.equals(Inferior, planeNormal)\n  ) {\n    axis = 'Axial';\n  }\n\n  if (!axis) {\n    return null;\n  }\n\n  vec3.transformMat4(tmp, planeOrigin, worldToIndex);\n  const index = lpsOrientation[axis];\n  const slice = roundIfCloseToInteger(tmp[index], epsilon);\n\n  if (!allowNonIntegralSlice && !Number.isInteger(slice)) {\n    return null;\n  }\n\n  if (!allowOutOfBoundsSlice && (slice < 0 || slice >= dimensions[index])) {\n    return null;\n  }\n\n  return { axis, slice };\n}\n","import { Maybe } from '@/src/types';\nimport { ref } from 'vue';\nimport { StoreActions, StoreState } from 'pinia';\nimport { useIdStore } from '../id';\n\nexport type Label<Props> = Partial<Props & { labelName: string }>;\nexport type Labels<Props> = Record<string, Label<Props>>;\n\ntype LabelID = string;\n\nconst labelDefault = { labelName: 'New Label' };\n\n// param newLabelDefault should contain all label controlled props\n// of the tool so placing tool does hold any last active label props.\nexport const useLabels = <Props>(newLabelDefault: Label<Props>) => {\n  type ToolLabel = Label<Props>;\n\n  const labels = ref<Labels<Props>>({});\n\n  const activeLabel = ref<string | undefined>();\n  const setActiveLabel = (id: string) => {\n    activeLabel.value = id;\n  };\n\n  const addLabel = (label: ToolLabel = {}) => {\n    const id = useIdStore().nextId();\n    labels.value[id] = {\n      ...labelDefault,\n      ...newLabelDefault,\n      ...label,\n    };\n\n    setActiveLabel(id);\n    return id;\n  };\n\n  const deleteLabel = (id: LabelID) => {\n    if (!(id in labels.value)) throw new Error('Label does not exist');\n\n    delete labels.value[id];\n    labels.value = { ...labels.value }; // trigger reactive update for measurement list\n\n    // pick another active label if deleted was active\n    if (id === activeLabel.value) {\n      const labelIDs = Object.keys(labels.value);\n      if (labelIDs.length !== 0) setActiveLabel(labelIDs[0]);\n      else setActiveLabel('');\n    }\n  };\n\n  const updateLabel = (id: LabelID, patch: ToolLabel) => {\n    if (!(id in labels.value)) throw new Error('Label does not exist');\n\n    labels.value = { ...labels.value, [id]: { ...labels.value[id], ...patch } };\n  };\n\n  // Flag to indicate if should clear existing labels\n  const defaultLabels = ref(true);\n\n  const clearDefaultLabels = () => {\n    if (defaultLabels.value) labels.value = {};\n    defaultLabels.value = false;\n  };\n\n  /*\n   * If new label have the same name as existing label, overwrite existing label.\n   *\n   * param label: label to merge\n   * param clearDefault: if true, clear initial labels, do nothing if initial labels already cleared\n   */\n  const mergeLabel = (label: ToolLabel, clearDefault: boolean = true) => {\n    if (clearDefault) clearDefaultLabels();\n\n    const { labelName } = label;\n    const sameLabelName = Object.entries(labels.value).find(\n      ([, { labelName: existingName }]) => existingName === labelName\n    );\n\n    if (sameLabelName) {\n      const [existingID] = sameLabelName;\n      updateLabel(existingID, label);\n      return existingID;\n    }\n\n    return addLabel(label);\n  };\n\n  /*\n   * If new label have the same name as existing label, overwrite existing label.\n   *\n   * param newLabels: each key is the label name\n   * param clearDefault: if true, clear initial labels, do nothing if initial labels already cleared\n   */\n  const mergeLabels = (\n    newLabels: Maybe<Labels<Props>>,\n    clearDefault: boolean = true\n  ) => {\n    Object.entries(newLabels ?? {}).forEach(([labelName, props]) =>\n      mergeLabel({ ...props, labelName }, clearDefault)\n    );\n  };\n\n  return {\n    labels,\n    activeLabel,\n    setActiveLabel,\n    addLabel,\n    deleteLabel,\n    updateLabel,\n    mergeLabel,\n    mergeLabels,\n  };\n};\n\ntype UseLabels<Tool> = ReturnType<typeof useLabels<Tool>>;\n\nexport type LabelsStore<Tool> = StoreState<UseLabels<Tool>> &\n  StoreActions<UseLabels<Tool>>;\n","import { Ref, computed, ref, watch } from 'vue';\nimport { Store } from 'pinia';\n\nimport { Maybe, PartialWithRequired } from '@/src/types';\nimport { TOOL_COLORS } from '@/src/config';\nimport { removeFromArray } from '@/src/utils';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { frameOfReferenceToImageSliceAndAxis } from '@/src/utils/frameOfReference';\nimport { useViewStore } from '@/src/store/views';\nimport { getLPSAxisFromDir } from '@/src/utils/lps';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport { AnnotationTool } from '@/src/types/annotationTool';\nimport { findImageID, getDataID } from '@/src/store/datasets';\nimport { useIdStore } from '@/src/store/id';\nimport useViewSliceStore from '../view-configs/slicing';\nimport { useLabels, Labels, Label } from './useLabels';\n\nconst makeAnnotationToolDefaults = () => ({\n  frameOfReference: {\n    planeOrigin: [0, 0, 0],\n    planeNormal: [1, 0, 0],\n  },\n  slice: -1,\n  imageID: '',\n  placing: false,\n  color: TOOL_COLORS[0],\n  name: 'baseAnnotationTool',\n});\n\n// Must return addTool in consuming Pinia store.\nexport const useAnnotationTool = <\n  MakeToolDefaults extends (...args: any) => any,\n  LabelProps\n>({\n  toolDefaults,\n  initialLabels,\n  newLabelDefault,\n}: {\n  toolDefaults: MakeToolDefaults;\n  initialLabels: Labels<LabelProps>;\n  newLabelDefault: Label<LabelProps>;\n}) => {\n  type ToolDefaults = ReturnType<MakeToolDefaults>;\n  type Tool = ToolDefaults & AnnotationTool;\n  type ToolPatch = Partial<Omit<Tool, 'id'>>;\n  type ToolID = Tool['id'];\n\n  // cast to Ref<ToolID[]> needed. https://github.com/vuejs/core/issues/2136#issuecomment-693524663\n  const toolIDs = ref<ToolID[]>([]) as Ref<ToolID[]>;\n  const toolByID = ref<Record<ToolID, Tool>>(Object.create(null)) as Ref<\n    Record<ToolID, Tool>\n  >;\n\n  const tools = computed(() => {\n    const byID = toolByID.value;\n    return toolIDs.value.map((id) => byID[id]);\n  });\n\n  const labels = useLabels<LabelProps>(newLabelDefault);\n  labels.mergeLabels(initialLabels, false);\n\n  function makePropsFromLabel(label: string | undefined) {\n    if (!label) return { labelName: '' };\n\n    const labelProps = labels.labels.value[label];\n    if (labelProps) return labelProps;\n\n    // if label deleted, remove label name from tool\n    return { labelName: '' };\n  }\n\n  function addTool(this: Store, tool: ToolPatch): ToolID {\n    const id = useIdStore().nextId() as ToolID;\n    if (id in toolByID.value) {\n      throw new Error('Cannot add tool with conflicting ID');\n    }\n\n    toolByID.value[id] = {\n      ...makeAnnotationToolDefaults(),\n      ...toolDefaults(),\n      label: labels.activeLabel.value,\n      ...tool,\n      // updates label props if changed between sessions\n      ...makePropsFromLabel(tool.label),\n      id,\n    };\n\n    toolIDs.value.push(id);\n    return id;\n  }\n\n  function removeTool(id: ToolID) {\n    if (!(id in toolByID.value)) return;\n\n    removeFromArray(toolIDs.value, id);\n    delete toolByID.value[id];\n  }\n\n  function updateTool(id: ToolID, patch: ToolPatch) {\n    if (!(id in toolByID.value)) return;\n\n    toolByID.value[id] = { ...toolByID.value[id], ...patch, id };\n  }\n\n  // updates props controlled by labels\n  watch(labels.labels, () => {\n    toolIDs.value.forEach((id) => {\n      const tool = toolByID.value[id];\n      const propsFromLabel = makePropsFromLabel(tool.label);\n      updateTool(id, { ...tool, ...propsFromLabel });\n    });\n  });\n\n  function jumpToTool(toolID: ToolID) {\n    const tool = toolByID.value[toolID];\n    const { currentImageID, currentImageMetadata } = useCurrentImage();\n\n    const imageID = currentImageID.value;\n    if (!imageID || tool.imageID !== imageID) return;\n\n    const toolImageFrame = frameOfReferenceToImageSliceAndAxis(\n      tool.frameOfReference,\n      currentImageMetadata.value\n    );\n\n    if (!toolImageFrame) return;\n\n    const viewStore = useViewStore();\n    const relevantViewIDs = viewStore.viewIDs.filter((viewID) => {\n      const viewSpec = viewStore.viewSpecs[viewID];\n      const viewDir = viewSpec.props.viewDirection as LPSAxisDir | undefined;\n      return viewDir && getLPSAxisFromDir(viewDir) === toolImageFrame.axis;\n    });\n\n    const viewSliceStore = useViewSliceStore();\n    relevantViewIDs.forEach((viewID) => {\n      viewSliceStore.updateConfig(viewID, imageID, {\n        slice: tool.slice!,\n      });\n    });\n  }\n\n  const activateTool = () => true;\n  const deactivateTool = () => {};\n\n  const serialize = () => {\n    const toolsSerialized = toolIDs.value\n      .map((toolID) => toolByID.value[toolID])\n      .filter((tool) => !tool.placing)\n      .map(({ imageID, ...rest }) => ({\n        // If parent image is DICOM, save VolumeKey\n        imageID: getDataID(imageID),\n        ...rest,\n      }));\n\n    return {\n      tools: toolsSerialized,\n      labels: labels.labels.value,\n    };\n  };\n\n  type Serialized = {\n    tools: PartialWithRequired<Tool, 'imageID'>[];\n    labels: Labels<Tool>;\n  };\n  function deserialize(\n    this: Store,\n    serialized: Maybe<Serialized>,\n    dataIDMap: Record<string, string>\n  ) {\n    const labelIDMap = Object.fromEntries(\n      Object.entries(serialized?.labels ?? {}).map(([id, label]) => {\n        const newID = labels.mergeLabel(label); // side effect\n        return [id, newID];\n      })\n    );\n\n    serialized?.tools\n      .map(\n        ({ imageID, label, ...rest }) =>\n          ({\n            ...rest,\n            imageID: findImageID(dataIDMap[imageID]),\n            label: (label && labelIDMap[label]) || '',\n          } as ToolPatch)\n      )\n      .forEach((tool) => addTool.call(this, tool));\n  }\n\n  return {\n    ...labels,\n    toolIDs,\n    toolByID,\n    tools,\n    addTool,\n    removeTool,\n    updateTool,\n    jumpToTool,\n    activateTool,\n    deactivateTool,\n    serialize,\n    deserialize,\n  };\n};\n","import { computed } from 'vue';\nimport { defineStore } from 'pinia';\nimport type { Vector3 } from '@kitware/vtk.js/types';\nimport { distance2BetweenPoints } from '@kitware/vtk.js/Common/Core/Math';\n\nimport { RULER_LABEL_DEFAULTS } from '@/src/config';\nimport { Manifest, StateFile } from '@/src/io/state-file/schema';\n\nimport { useAnnotationTool } from './useAnnotationTool';\n\nconst rulerDefaults = () => ({\n  firstPoint: [0, 0, 0] as Vector3,\n  secondPoint: [0, 0, 0] as Vector3,\n  id: '',\n  name: 'Ruler',\n});\n\nconst newLabelDefault = {\n  color: '#ffffff',\n};\n\nexport const useRulerStore = defineStore('ruler', () => {\n  type _This = ReturnType<typeof useRulerStore>;\n\n  const {\n    toolIDs: rulerIDs,\n    toolByID: rulerByID,\n    tools: rulers,\n    addTool: addRuler,\n    updateTool: updateRuler,\n    removeTool: removeRuler,\n    jumpToTool: jumpToRuler,\n    serialize: serializeTool,\n    deserialize: deserializeTool,\n    activateTool,\n    deactivateTool,\n    ...rest // label tools\n  } = useAnnotationTool({\n    toolDefaults: rulerDefaults,\n    initialLabels: RULER_LABEL_DEFAULTS,\n    newLabelDefault,\n  });\n\n  const lengthByID = computed<Record<string, number>>(() => {\n    const byID = rulerByID.value;\n    return rulerIDs.value.reduce((lengths, id) => {\n      const { firstPoint, secondPoint } = byID[id];\n      return Object.assign(lengths, {\n        [id]: Math.sqrt(distance2BetweenPoints(firstPoint, secondPoint)),\n      });\n    }, {});\n  });\n\n  // --- serialization --- //\n\n  function serialize(state: StateFile) {\n    state.manifest.tools.rulers = serializeTool();\n  }\n\n  function deserialize(\n    this: _This,\n    manifest: Manifest,\n    dataIDMap: Record<string, string>\n  ) {\n    deserializeTool.call(this, manifest.tools.rulers, dataIDMap);\n  }\n\n  return {\n    ...rest,\n    rulerIDs,\n    rulerByID,\n    rulers,\n    lengthByID,\n    addRuler,\n    updateRuler,\n    removeRuler,\n    jumpToRuler,\n    serialize,\n    deserialize,\n    activateTool,\n    deactivateTool,\n  };\n});\n","import { defineStore } from 'pinia';\nimport type { Vector3 } from '@kitware/vtk.js/types';\nimport { Manifest, StateFile } from '@/src/io/state-file/schema';\nimport { RECTANGLE_LABEL_DEFAULTS } from '@/src/config';\nimport { RectangleID } from '@/src/types/rectangle';\n\nimport { useAnnotationTool } from './useAnnotationTool';\n\nconst rectangleDefaults = () => ({\n  firstPoint: [0, 0, 0] as Vector3,\n  secondPoint: [0, 0, 0] as Vector3,\n  id: '' as RectangleID,\n  name: 'Rectangle',\n  fillColor: 'transparent',\n});\n\nconst newLabelDefault = {\n  color: '#ffffff',\n  fillColor: 'transparent',\n};\n\nexport const useRectangleStore = defineStore('rectangles', () => {\n  type _This = ReturnType<typeof useRectangleStore>;\n\n  const {\n    serialize: serializeTool,\n    deserialize: deserializeTool,\n    ...toolStoreProps\n  } = useAnnotationTool({\n    toolDefaults: rectangleDefaults,\n    initialLabels: RECTANGLE_LABEL_DEFAULTS,\n    newLabelDefault,\n  });\n\n  // --- serialization --- //\n\n  function serialize(state: StateFile) {\n    state.manifest.tools.rectangles = serializeTool();\n  }\n\n  function deserialize(\n    this: _This,\n    manifest: Manifest,\n    dataIDMap: Record<string, string>\n  ) {\n    deserializeTool.call(this, manifest.tools.rectangles, dataIDMap);\n  }\n\n  return {\n    ...toolStoreProps,\n    serialize,\n    deserialize,\n  };\n});\n","import { Maybe } from '@/src/types';\nimport { FrameOfReference } from '@/src/utils/frameOfReference';\nimport { Vector2, Vector3 } from '@kitware/vtk.js/types';\nimport { mat3, mat4, vec2, vec3 } from 'gl-matrix';\n\n/**\n * Reference frame from a 2D (x,y[,0]) coord to 3D coord.\n *\n * Represents a transform from an IJ slice (K=0) to an XYZ slice.\n *\n * See the implementation of getReferencePlaneFromSlice for construction.\n */\nexport interface ReferencePlane {\n  /**\n   * The transform from 2D to 3D\n   */\n  t: mat4;\n  /**\n   * Internal cache of the inverse of t.\n   */\n  _tInv: Maybe<mat4>;\n}\n\nexport function createReferencePlane(): ReferencePlane {\n  return {\n    t: mat4.create(),\n    _tInv: null,\n  };\n}\n\nconst tmp3d = vec3.create();\nconst tmpMat3 = mat3.create();\n\nexport function transform2dTo3d(\n  pt2d: Vector2,\n  refPlane: ReferencePlane,\n  out?: Vector3\n): Vector3 {\n  const _out = out ?? vec3.create();\n  vec3.set(tmp3d, pt2d[0], pt2d[1], 0);\n  vec3.transformMat4(_out, tmp3d, refPlane.t);\n  return _out as Vector3;\n}\n\nfunction invertMat4(m: mat4): mat4 {\n  const minv = mat4.create();\n  mat4.invert(minv, m);\n  return minv;\n}\n\nexport function getInverse(refPlane: ReferencePlane): mat4 {\n  // eslint-disable-next-line no-param-reassign\n  refPlane._tInv = refPlane._tInv ?? invertMat4(refPlane.t);\n  return refPlane._tInv;\n}\n\nexport function transform3dTo2d(\n  pt3d: Vector3,\n  refPlane: ReferencePlane,\n  out?: Vector2\n): Vector2 {\n  const _out = out ?? vec2.create();\n  const inv = getInverse(refPlane);\n  vec3.transformMat4(tmp3d, pt3d, inv);\n  vec2.set(_out, tmp3d[0], tmp3d[1]);\n  return _out as Vector2;\n}\n\nexport function referencePlaneToFrame(\n  refPlane: ReferencePlane\n): FrameOfReference {\n  // the reference plane is implicitly defined\n  // as centered at 0,0,0 with a +Z normal\n  const origin: Vector3 = [0, 0, 0];\n  vec3.transformMat4(origin, origin, refPlane.t);\n\n  const normal: Vector3 = [0, 0, 1];\n  // extract just rotation\n  mat3.fromMat4(tmpMat3, refPlane.t);\n  vec3.transformMat3(normal, normal, tmpMat3);\n  vec3.normalize(normal, normal);\n\n  return {\n    planeNormal: normal,\n    planeOrigin: origin,\n  };\n}\n\nconst SliceAxisTransforms: Record<0 | 1 | 2, mat4> = {\n  0: mat4.fromValues(0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1),\n  1: mat4.fromValues(1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1),\n  2: mat4.create(),\n};\n\nexport function getReferencePlaneFromSlice(\n  indexToWorld: mat4,\n  slice: number,\n  sliceAxis: 0 | 1 | 2\n): ReferencePlane {\n  const t = mat4.create();\n  // z=0 to z=slice\n  mat4.fromTranslation(t, [0, 0, slice]);\n  // rotate to correct slice axis\n  mat4.mul(t, SliceAxisTransforms[sliceAxis], t);\n  mat4.mul(t, indexToWorld, t);\n  const a = {\n    t,\n    _tInv: invertMat4(t),\n  };\n\n  return a;\n}\n","import { createReferencePlane } from '@/src/core/contours/referencePlane';\nimport { Maybe } from '@/src/types';\nimport { defineStore } from 'pinia';\nimport { ContourID } from '@/src/types/contour';\nimport { ref } from 'vue';\nimport { useAnnotationTool } from './useAnnotationTool';\n\nexport enum ContourToolMode {\n  Select = 'Select',\n  FreehandDraw = 'FreehandDraw',\n  CircleNudge = 'CircleNudge',\n  PointPlacing = 'PointPlacing',\n  Threshold = 'Threshold',\n}\n\nconst makeContourDefaults = () => ({\n  id: '' as ContourID,\n  name: 'Contour',\n  polyLine: [] as number[],\n  // TODO this likely will share a ref\n  referencePlane: createReferencePlane(),\n});\n\nconst useContourStore = defineStore('contour', () => {\n  // type This = ReturnType<typeof contourStore>;\n\n  const selectedContourID = ref<Maybe<ContourID>>();\n  const mode = ref<ContourToolMode>(ContourToolMode.FreehandDraw);\n\n  // ignore serialize/deserialize fow now\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const { serialize, deserialize, ...toolStoreProps } = useAnnotationTool({\n    toolDefaults: makeContourDefaults,\n    initialLabels: {\n      'Default label': { color: '#ff0000' },\n    },\n    newLabelDefault: { color: '#ff0000' },\n  });\n\n  function selectContour(id: Maybe<ContourID>) {\n    selectedContourID.value = id;\n  }\n\n  // extend removeTool to handle selectedContourID case\n  function removeTool(id: ContourID) {\n    if (selectedContourID.value === id) {\n      selectedContourID.value = null;\n    }\n    return toolStoreProps.removeTool(id);\n  }\n\n  function setMode(toolMode: ContourToolMode) {\n    mode.value = toolMode;\n  }\n\n  return {\n    ...toolStoreProps,\n    removeTool,\n    // do not support serialization for now\n    serialize: () => {},\n    deserialize: () => {},\n    selectedContourID,\n    mode,\n    selectContour,\n    setMode,\n  };\n});\n\nexport default useContourStore;\n","import { Manifest, StateFile } from '@/src/io/state-file/schema';\nimport { defineStore } from 'pinia';\nimport { useCropStore } from './crop';\nimport { useCrosshairsToolStore } from './crosshairs';\nimport { usePaintToolStore } from './paint';\nimport { useRulerStore } from './rulers';\nimport { useRectangleStore } from './rectangles';\nimport { Tools } from './types';\nimport useContourStore from './contours';\n\ninterface State {\n  currentTool: Tools;\n}\n\nexport interface IToolStore {\n  activateTool: () => boolean;\n  deactivateTool: () => void;\n}\n\nfunction getStore(tool: Tools): IToolStore | null {\n  if (tool === Tools.Ruler) {\n    return useRulerStore();\n  }\n  if (tool === Tools.Rectangle) {\n    return useRectangleStore();\n  }\n  if (tool === Tools.Paint) {\n    return usePaintToolStore();\n  }\n  if (tool === Tools.Crosshairs) {\n    return useCrosshairsToolStore();\n  }\n  if (tool === Tools.Contour) {\n    return useContourStore();\n  }\n  return null;\n}\n\n/**\n * Returns true if the tool is ready to be\n * activated. By default, a tool without a\n * store setup() will be activated.\n */\nfunction setupTool(tool: Tools) {\n  const store = getStore(tool);\n  if (store) {\n    return store.activateTool();\n  }\n  return true;\n}\n\nfunction teardownTool(tool: Tools) {\n  const store = getStore(tool);\n  if (store) {\n    store.deactivateTool();\n  }\n}\n\nexport const useToolStore = defineStore('tool', {\n  state: (): State => ({\n    currentTool: Tools.WindowLevel,\n  }),\n  actions: {\n    setCurrentTool(tool: Tools) {\n      if (!setupTool(tool)) {\n        return;\n      }\n      teardownTool(this.currentTool);\n      this.currentTool = tool;\n    },\n    serialize(state: StateFile) {\n      const { tools } = state.manifest;\n      const rulerStore = useRulerStore();\n      const rectangleStore = useRectangleStore();\n      const crosshairsStore = useCrosshairsToolStore();\n      const paintStore = usePaintToolStore();\n      const cropStore = useCropStore();\n\n      rulerStore.serialize(state);\n      rectangleStore.serialize(state);\n      crosshairsStore.serialize(state);\n      paintStore.serialize(state);\n      cropStore.serialize(state);\n\n      tools.current = this.currentTool;\n    },\n    deserialize(\n      manifest: Manifest,\n      labelmapIDMap: Record<string, string>,\n      dataIDMap: Record<string, string>\n    ) {\n      const { tools } = manifest;\n      const rulerStore = useRulerStore();\n      const rectangleStore = useRectangleStore();\n      const crosshairsStore = useCrosshairsToolStore();\n      const paintStore = usePaintToolStore();\n      const cropStore = useCropStore();\n\n      rulerStore.deserialize(manifest, dataIDMap);\n      rectangleStore.deserialize(manifest, dataIDMap);\n      crosshairsStore.deserialize(manifest);\n      paintStore.deserialize(manifest, labelmapIDMap);\n      cropStore.deserialize(manifest, dataIDMap);\n      this.currentTool = tools.current;\n    },\n  },\n});\n","import JSZip from 'jszip';\nimport { useDatasetStore } from '@/src/store/datasets';\nimport { useLabelmapStore } from '@/src/store/datasets-labelmaps';\nimport { useLayersStore } from '@/src/store/datasets-layers';\nimport { useToolStore } from '@/src/store/tools';\nimport { Tools } from '@/src/store/tools/types';\nimport { useViewStore } from '@/src/store/views';\nimport { LayoutDirection } from '@/src/types/layout';\nimport { Manifest } from './schema';\n\nimport { retypeFile } from '../io';\nimport { ARCHIVE_FILE_TYPES } from '../mimeTypes';\n\nexport const MANIFEST = 'manifest.json';\nexport const MANIFEST_VERSION = '2.1.0';\n\nexport async function serialize() {\n  const datasetStore = useDatasetStore();\n  const viewStore = useViewStore();\n  const labelStore = useLabelmapStore();\n  const toolStore = useToolStore();\n  const layersStore = useLayersStore();\n\n  const zip = new JSZip();\n  const manifest: Manifest = {\n    version: MANIFEST_VERSION,\n    datasets: [],\n    remoteFiles: {},\n    labelMaps: [],\n    tools: {\n      crosshairs: {\n        position: [0, 0, 0],\n      },\n      paint: {\n        activeLabelmapID: null,\n        brushSize: 8,\n        brushValue: 1,\n        labelmapOpacity: 1,\n      },\n      crop: {},\n      current: Tools.WindowLevel,\n    },\n    layout: {\n      direction: LayoutDirection.H,\n      items: [],\n    },\n    views: [],\n    parentToLayers: [],\n  };\n\n  const stateFile = {\n    zip,\n    manifest,\n  };\n\n  await datasetStore.serialize(stateFile);\n  viewStore.serialize(stateFile);\n  await labelStore.serialize(stateFile);\n  toolStore.serialize(stateFile);\n  await layersStore.serialize(stateFile);\n\n  zip.file(MANIFEST, JSON.stringify(manifest));\n\n  return zip.generateAsync({ type: 'blob' });\n}\n\nexport async function isStateFile(file: File) {\n  const typedFile = await retypeFile(file);\n  if (ARCHIVE_FILE_TYPES.has(typedFile.type)) {\n    const zip = await JSZip.loadAsync(typedFile);\n\n    return zip.file(MANIFEST) !== null;\n  }\n\n  return false;\n}\n","import { ImportHandler } from '@/src/io/import/common';\n\n/**\n * Ends a pipeline execution, returning the final data source.\n * @param dataSource\n * @returns\n */\nconst doneWithDataSource: ImportHandler = (dataSource, { done }) => {\n  return done({ dataSource });\n};\n\nexport default doneWithDataSource;\n","import { getFileMimeType } from '@/src/io';\nimport { ImportHandler } from '@/src/io/import/common';\n\n/**\n * Transforms a file data source to have a mime type\n * @param dataSource\n */\nconst updateFileMimeType: ImportHandler = async (dataSource) => {\n  let src = dataSource;\n  const { fileSrc } = src;\n  if (fileSrc && fileSrc.fileType === '') {\n    const mime = await getFileMimeType(fileSrc.file);\n    if (mime) {\n      src = {\n        ...src,\n        fileSrc: {\n          ...fileSrc,\n          fileType: mime,\n        },\n      };\n    }\n  }\n  return src;\n};\n\nexport default updateFileMimeType;\n","import { Dataset, Manifest, ManifestSchema } from '@/src/io/state-file/schema';\nimport { FileEntry } from '@/src/io/types';\nimport * as path from '@/src/utils/path';\nimport {\n  ArchiveContents,\n  ImportContext,\n  ImportHandler,\n  ImportResult,\n} from '@/src/io/import/common';\nimport {\n  DataSource,\n  DataSourceWithFile,\n  fileToDataSource,\n} from '@/src/io/import/dataSource';\nimport { MANIFEST, isStateFile } from '@/src/io/state-file';\nimport { ensureError, partition } from '@/src/utils';\nimport Pipeline, { PipelineContext } from '@/src/core/pipeline';\nimport { Awaitable } from '@vueuse/core';\nimport doneWithDataSource from '@/src/io/import/processors/doneWithDataSource';\nimport { useDICOMStore } from '@/src/store/datasets-dicom';\nimport { useViewStore } from '@/src/store/views';\nimport {\n  DataSelection,\n  makeDICOMSelection,\n  makeImageSelection,\n  useDatasetStore,\n} from '@/src/store/datasets';\nimport { useLabelmapStore } from '@/src/store/datasets-labelmaps';\nimport { useToolStore } from '@/src/store/tools';\nimport { useLayersStore } from '@/src/store/datasets-layers';\nimport { extractFilesFromZip } from '@/src/io/zip';\nimport downloadUrl from '@/src/io/import/processors/downloadUrl';\nimport updateFileMimeType from '@/src/io/import/processors/updateFileMimeType';\nimport extractArchiveTarget from '@/src/io/import/processors/extractArchiveTarget';\n\nconst resolveUriSource: ImportHandler = async (dataSource, { extra, done }) => {\n  const { uriSrc } = dataSource;\n\n  if (uriSrc) {\n    const result = await new Pipeline([\n      downloadUrl,\n      updateFileMimeType,\n      doneWithDataSource,\n    ]).execute(dataSource, extra);\n    if (!result.ok) {\n      throw result.errors[0].cause;\n    }\n    // downloadUrl returns the fully resolved data source.\n    // We call done here since we've resolved the UriSource\n    // and no more processing is needed.\n    return done({\n      dataSource: result.data[0].dataSource,\n    });\n  }\n\n  return dataSource;\n};\n\nconst processParentIfNoFile: ImportHandler = async (\n  dataSource,\n  { execute }\n) => {\n  const { fileSrc, parent } = dataSource;\n  if (!fileSrc && parent) {\n    const result = await execute(parent);\n    if (!result.ok) {\n      throw new Error('Could not process parent', {\n        cause: ensureError(result.errors[0].cause),\n      });\n    }\n    // update the parent\n    return {\n      ...dataSource,\n      parent: result.data[0].dataSource,\n    };\n  }\n  return dataSource;\n};\n\nconst resolveArchiveMember: ImportHandler = async (\n  dataSource,\n  { extra, done }\n) => {\n  if (dataSource.archiveSrc) {\n    const pipeline = new Pipeline([\n      extractArchiveTarget,\n      updateFileMimeType,\n      doneWithDataSource,\n    ]);\n    const result = await pipeline.execute(dataSource, extra);\n    if (!result.ok) {\n      throw result.errors[0].cause;\n    }\n    // extractArchiveTarget returns the fully resolved data source.\n    return done({\n      dataSource: result.data[0].dataSource,\n    });\n  }\n  return dataSource;\n};\n\nfunction getDataSourcesForDataset(\n  dataset: Dataset,\n  manifest: Manifest,\n  stateFileContents: FileEntry[]\n) {\n  const inStateFile = stateFileContents\n    .filter(\n      (entry) =>\n        path.normalize(entry.archivePath) === path.normalize(dataset.path)\n    )\n    .map((entry) => fileToDataSource(entry.file));\n  const remotes = manifest.remoteFiles[dataset.id] ?? [];\n  return [...inStateFile, ...remotes];\n}\n\nasync function restoreDatasets(\n  manifest: Manifest,\n  datasetFiles: FileEntry[],\n  { extra, execute }: PipelineContext<DataSource, ImportResult, ImportContext>\n) {\n  const archiveCache = new Map<File, Awaitable<ArchiveContents>>();\n\n  // normalize archive paths for comparison\n  const stateDatasetFiles = datasetFiles.map((datasetFile) => {\n    return {\n      ...datasetFile,\n      archivePath: path.normalize(datasetFile.archivePath),\n    };\n  });\n\n  const { datasets } = manifest;\n  // Mapping of the state file ID => new store ID\n  const stateIDToStoreID: Record<string, string> = {};\n\n  // This pipeline resolves data sources that have remote provenance.\n  const resolvePipeline = new Pipeline([\n    updateFileMimeType,\n    resolveUriSource,\n    // process parent after resolving the uri source, so we don't\n    // unnecessarily download ancestor UriSources.\n    processParentIfNoFile,\n    resolveArchiveMember,\n    doneWithDataSource,\n  ]);\n\n  await Promise.all(\n    datasets.map(async (dataset) => {\n      let datasetDataSources = getDataSourcesForDataset(\n        dataset,\n        manifest,\n        stateDatasetFiles\n      );\n\n      // resolve any remote data sources or archive members\n      datasetDataSources = await Promise.all(\n        datasetDataSources.map(async (source) => {\n          const result = await resolvePipeline.execute(source, {\n            ...extra,\n            archiveCache,\n          });\n          if (!result.ok) {\n            throw result.errors[0].cause;\n          }\n          return result.data[0].dataSource;\n        })\n      );\n\n      // do the import\n      const dicomSources: DataSourceWithFile[] = [];\n      const importResults = await Promise.all(\n        datasetDataSources.map((source) =>\n          execute(source, {\n            ...extra,\n            archiveCache,\n            dicomDataSources: dicomSources,\n          })\n        )\n      );\n\n      if (dicomSources.length) {\n        const dicomStore = useDICOMStore();\n        const volumeKeys = await dicomStore.importFiles(dicomSources);\n        if (volumeKeys.length !== 1) {\n          throw new Error('Obtained more than one volume from DICOM import');\n        }\n\n        const [key] = volumeKeys;\n        // generate imageID so rulers and labelmaps can use stateIDToStoreID to setup there internal imageStore imageID references\n        await dicomStore.buildVolume(key);\n        stateIDToStoreID[dataset.id] = key;\n      } else if (importResults.length === 1) {\n        if (!importResults[0].ok) {\n          throw importResults[0].errors[0].cause;\n        }\n\n        const [result] = importResults;\n        if (result.data.length !== 1) {\n          throw new Error(\n            'Import encountered multiple volumes for a single dataset'\n          );\n        }\n\n        const { dataID } = result.data[0];\n        if (!dataID) {\n          throw new Error('Failed to import dataset');\n        }\n\n        stateIDToStoreID[dataset.id] = dataID;\n      } else {\n        throw new Error('Could not load any data from the session');\n      }\n    })\n  );\n\n  return stateIDToStoreID;\n}\n\nconst restoreStateFile: ImportHandler = async (\n  dataSource,\n  { done, extra, execute }\n) => {\n  const { fileSrc } = dataSource;\n  if (fileSrc && (await isStateFile(fileSrc.file))) {\n    const stateFileContents = await extractFilesFromZip(fileSrc.file);\n\n    const [manifests, restOfStateFile] = partition(\n      (dataFile) => dataFile.file.name === MANIFEST,\n      stateFileContents\n    );\n\n    if (manifests.length !== 1) {\n      throw new Error('State file does not have exactly 1 manifest');\n    }\n\n    const manifest = ManifestSchema.parse(\n      JSON.parse(await manifests[0].file.text())\n    );\n\n    // We restore the view first, so that the appropriate watchers are triggered\n    // in the views as the data is loaded\n    useViewStore().setLayout(manifest.layout);\n\n    const stateIDToStoreID = await restoreDatasets(manifest, restOfStateFile, {\n      extra,\n      execute,\n      done,\n    });\n\n    // Restore the primary selection\n    if (manifest.primarySelection !== undefined) {\n      const selectedID = stateIDToStoreID[manifest.primarySelection];\n      let dataSelection: DataSelection | undefined;\n\n      if (selectedID in useDICOMStore().volumeInfo) {\n        dataSelection = makeDICOMSelection(selectedID);\n      } else {\n        dataSelection = makeImageSelection(selectedID);\n      }\n\n      useDatasetStore().setPrimarySelection(dataSelection);\n    }\n\n    // Restore the views\n    useViewStore().deserialize(manifest.views, stateIDToStoreID);\n\n    // Restore the labelmaps\n    const labelmapIDMap = await useLabelmapStore().deserialize(\n      manifest,\n      restOfStateFile,\n      stateIDToStoreID\n    );\n\n    // Restore the tools\n    useToolStore().deserialize(manifest, labelmapIDMap, stateIDToStoreID);\n\n    useLayersStore().deserialize(manifest, stateIDToStoreID);\n\n    return done();\n  }\n  return dataSource;\n};\n\nexport default restoreStateFile;\n","import { z } from 'zod';\n\nimport { ImportHandler } from '@/src/io/import/common';\nimport { useRectangleStore } from '@/src/store/tools/rectangles';\nimport { useRulerStore } from '@/src/store/tools/rulers';\n\nconst Color = z.string();\n\nconst Label = z.object({\n  color: Color,\n});\n\nconst RulerLabel = Label;\n\nconst RectangleLabel = z.intersection(\n  Label,\n  z.object({\n    fillColor: Color,\n  })\n);\n\nconst Config = z.object({\n  labels: z.record(Label).or(z.null()).optional(),\n  rulerLabels: z.record(RulerLabel).or(z.null()).optional(),\n  rectangleLabels: z.record(RectangleLabel).or(z.null()).optional(),\n});\n\nconst readConfigFile = async (configFile: File) => {\n  const decoder = new TextDecoder();\n  const ab = await configFile.arrayBuffer();\n  const text = decoder.decode(new Uint8Array(ab));\n  return Config.parse(JSON.parse(text));\n};\n\nconst applyConfig = (manifest: z.infer<typeof Config>) => {\n  // pass through null labels, use fallback labels if undefined\n  const labelsIfUndefined = (toolLabels: typeof manifest.labels) => {\n    if (toolLabels === undefined) return manifest.labels;\n    return toolLabels;\n  };\n  useRulerStore().mergeLabels(labelsIfUndefined(manifest.rulerLabels));\n  useRectangleStore().mergeLabels(labelsIfUndefined(manifest.rectangleLabels));\n};\n\n/**\n * Reads a JSON file with label config and updates stores.\n * @param dataSource\n * @returns\n */\nconst handleConfig: ImportHandler = async (dataSource, { done }) => {\n  const { fileSrc } = dataSource;\n  if (fileSrc?.fileType === 'application/json') {\n    try {\n      const manifest = await readConfigFile(fileSrc.file);\n      applyConfig(manifest);\n    } catch (err) {\n      return dataSource;\n    }\n    return done();\n  }\n  return dataSource;\n};\n\nexport default handleConfig;\n","import Pipeline, { PipelineResult } from '@/src/core/pipeline';\nimport { ImportHandler, ImportResult } from '@/src/io/import/common';\nimport { DataSource, DataSourceWithFile } from '@/src/io/import/dataSource';\nimport handleDicomFile from '@/src/io/import/processors/handleDicomFile';\nimport downloadUrl from '@/src/io/import/processors/downloadUrl';\nimport extractArchive from '@/src/io/import/processors/extractArchive';\nimport extractArchiveTargetFromCache from '@/src/io/import/processors/extractArchiveTarget';\nimport handleAmazonS3 from '@/src/io/import/processors/handleAmazonS3';\nimport handleGoogleCloudStorage from '@/src/io/import/processors/handleGoogleCloudStorage';\nimport importSingleFile from '@/src/io/import/processors/importSingleFile';\nimport handleRemoteManifest from '@/src/io/import/processors/remoteManifest';\nimport restoreStateFile from '@/src/io/import/processors/restoreStateFile';\nimport updateFileMimeType from '@/src/io/import/processors/updateFileMimeType';\nimport handleConfig from '@/src/io/import/processors/handleConfig';\nimport { useDICOMStore } from '@/src/store/datasets-dicom';\nimport { makeDICOMSelection, makeImageSelection } from '@/src/store/datasets';\n\nexport type ImportDataSourcesResult = PipelineResult<DataSource, ImportResult>;\n\nexport function convertSuccessResultToDataSelection(\n  result: ImportDataSourcesResult\n) {\n  if (result.data.length === 0) {\n    return null;\n  }\n\n  const { dataID, dataType } = result.data[0];\n  if (!dataID) {\n    return null;\n  }\n\n  if (dataType === 'dicom') {\n    return makeDICOMSelection(dataID);\n  }\n\n  if (dataType === 'image') {\n    return makeImageSelection(dataID);\n  }\n\n  return null;\n}\n\n/**\n * Tries to turn a thrown object into a meaningful error string.\n * @param error\n * @returns\n */\nfunction toMeaningfulErrorString(thrown: unknown) {\n  const strThrown = String(thrown);\n  if (!strThrown || strThrown === '[object Object]') {\n    return 'Unknown error. More details in the dev console.';\n  }\n  return strThrown;\n}\n\nconst unhandledResource: ImportHandler = () => {\n  throw new Error('Failed to handle resource');\n};\n\nexport async function importDataSources(dataSources: DataSource[]) {\n  const middleware: Array<ImportHandler> = [\n    // updating the file type should be first in the pipeline\n    updateFileMimeType,\n    // handleConfig must before restoreStateFile for label props to be applied to deserialized tools\n    handleConfig,\n    restoreStateFile,\n    handleRemoteManifest,\n    handleGoogleCloudStorage,\n    handleAmazonS3,\n    downloadUrl,\n    extractArchiveTargetFromCache,\n    extractArchive,\n    // should be before importSingleFile, since DICOM is more specific\n    handleDicomFile,\n    importSingleFile,\n    // catch any unhandled resource\n    unhandledResource,\n  ];\n\n  const importContext = {\n    fetchFileCache: new Map<string, File>(),\n    dicomDataSources: [] as DataSourceWithFile[],\n  };\n\n  const pipeline = new Pipeline(middleware);\n  const results = await Promise.all(\n    dataSources.map((r) => pipeline.execute(r, importContext))\n  );\n\n  if (!importContext.dicomDataSources.length) {\n    return results;\n  }\n\n  // handle DICOM loading\n\n  const dicomDataSource: DataSource = {\n    dicomSrc: {\n      sources: importContext.dicomDataSources,\n    },\n  };\n  const dicomResult: PipelineResult<DataSource, ImportResult> = {\n    ok: true,\n    data: [],\n    errors: [],\n  };\n\n  try {\n    const volumeKeys = await useDICOMStore().importFiles(\n      importContext.dicomDataSources\n    );\n    dicomResult.data.push(\n      ...volumeKeys.map((key) => ({\n        dataID: key,\n        dataType: 'dicom' as const,\n        dataSource: dicomDataSource,\n      }))\n    );\n  } catch (err) {\n    dicomResult.ok = false;\n    dicomResult.errors.push({\n      message: toMeaningfulErrorString(err),\n      cause: err,\n      inputDataStackTrace: [dicomDataSource],\n    });\n  }\n\n  // remove all results that have no result data\n  return [...results.filter((result) => result.data.length), dicomResult];\n}\n","<template>\n  <v-btn\n    variant=\"text\"\n    :rounded=\"0\"\n    dark\n    :height=\"sizeV\"\n    :width=\"sizeV\"\n    :min-width=\"sizeV\"\n    :max-width=\"sizeV\"\n    :class=\"classV\"\n    v-bind=\"$attrs\"\n  >\n    <v-icon :size=\"iconSize\">{{ icon }}</v-icon>\n    <v-tooltip\n      :location=\"tooltipLocation\"\n      activator=\"parent\"\n      transition=\"slide-x-transition\"\n    >\n      <span>{{ name }}</span>\n    </v-tooltip>\n    <slot />\n  </v-btn>\n</template>\n\n<script>\nexport default {\n  name: 'ToolButton',\n  props: {\n    icon: { type: String, required: true },\n    name: { type: String, required: true },\n    size: { type: [Number, String], default: 40 },\n    buttonClass: [String, Array, Object],\n    tooltipLocation: { type: String, default: 'right' },\n  },\n\n  computed: {\n    sizeV() {\n      return Number(this.size);\n    },\n    iconSize() {\n      return Math.floor(0.6 * this.sizeV);\n    },\n    classV() {\n      const classSpec = this.buttonClass;\n      if (typeof classSpec === 'string') {\n        return classSpec;\n      }\n      if (Array.isArray(classSpec)) {\n        return classSpec.join(' ');\n      }\n      if (classSpec && Object.keys(classSpec).length) {\n        return Object.keys(this.buttonClass)\n          .filter((key) => this.buttonClass[key])\n          .join(' ');\n      }\n      return '';\n    },\n  },\n};\n</script>\n","<script lang=\"ts\">\nimport {\n  defineComponent,\n  onMounted,\n  PropType,\n  provide,\n  ref,\n  toRefs,\n  watch,\n} from 'vue';\n\ntype EqualsTestFunc<T> = (a: T, b: T) => boolean;\n\nexport const ItemGroupProvider = Symbol('ItemGroup');\n\nexport interface ItemGroupProviderValue {\n  selectItem: (item: unknown) => void;\n  isSelected: (item: unknown) => boolean;\n}\n\nexport default defineComponent({\n  props: {\n    modelValue: null,\n    mandatory: Boolean,\n    equalsTest: Function as PropType<EqualsTestFunc<any>>,\n  },\n  setup(props, { emit, slots }) {\n    const { modelValue, mandatory, equalsTest } = toRefs(props);\n    const internalValue = ref<unknown>();\n\n    watch(modelValue, (v) => {\n      if (v !== internalValue.value) {\n        internalValue.value = v;\n      }\n    });\n\n    onMounted(() => {\n      internalValue.value = modelValue.value;\n    });\n\n    const selectItem = (item: unknown) => {\n      if (mandatory.value && !item) {\n        return;\n      }\n      internalValue.value = item;\n      emit('update:modelValue', internalValue.value);\n    };\n\n    const isSelected = (item: unknown) => {\n      if (internalValue.value == null) {\n        return false;\n      }\n\n      return equalsTest.value\n        ? equalsTest.value(item, internalValue.value)\n        : item === internalValue.value;\n    };\n\n    provide<ItemGroupProviderValue>(ItemGroupProvider, {\n      selectItem,\n      isSelected,\n    });\n\n    return () => slots.default?.();\n  },\n});\n</script>\n","<script lang=\"ts\">\nimport { inject, defineComponent, toRefs } from 'vue';\nimport { ItemGroupProvider, ItemGroupProviderValue } from './ItemGroup.vue';\n\nexport default defineComponent({\n  props: {\n    value: {\n      type: null,\n      required: true,\n    },\n  },\n  setup(props, { slots }) {\n    const { value } = toRefs(props);\n    const itemGroup = inject<ItemGroupProviderValue>(ItemGroupProvider);\n\n    if (!itemGroup) {\n      throw new Error('GroupableItem needs ItemGroup!');\n    }\n\n    const select = () => {\n      itemGroup.selectItem(value.value);\n    };\n\n    const toggle = () => {\n      if (!itemGroup) {\n        return;\n      }\n\n      itemGroup.selectItem(\n        itemGroup.isSelected(value.value) ? undefined : value.value\n      );\n    };\n\n    return () =>\n      slots.default?.({\n        active: itemGroup.isSelected(value.value),\n        select,\n        toggle,\n      });\n  },\n});\n</script>\n","/**\n * Converts an RGBA tuple to a hex string with alpha.\n *\n * Adds the prefix '#'.\n *\n * @param rgba a 4-tuple with components ranging from 0-255.\n */\nexport function rgbaToHexa(rgba: number[]) {\n  const hexa = rgba.map((comp) => `0${comp.toString(16)}`.slice(-2));\n  return `#${hexa.join('')}`;\n}\n\n/**\n * Parses a hex color with optional alpha channel.\n *\n * Returns an RGBA array with components scaled to [0,255].\n *\n * @param hexa a hexa color in the format \"[#]RRGGBB[AA]\"\n */\nexport function hexaToRGBA(hexa: string) {\n  const values = hexa.startsWith('#') ? hexa.substring(1) : hexa;\n  const rgba = [0, 0, 0, 255];\n  const length = Math.min(4, values.length / 2);\n  for (let i = 0; i < length; i++) {\n    rgba[i] = Number.parseInt(values.substring(2 * i, 2 * i + 2), 16);\n  }\n  return rgba;\n}\n","<template>\n  <v-card width=\"350px\">\n    <v-container>\n      <!--\n      <v-row no-gutters align=\"center\">\n        <v-col>\n          <v-select\n            density=\"compact\"\n            outlined\n            hide-details\n            label=\"Select or create a labelmap\"\n          />\n        </v-col>\n      </v-row>\n      -->\n      <v-row no-gutters align=\"center\">\n        <v-col>\n          <v-slider\n            :model-value=\"brushSize\"\n            @update:model-value=\"setBrushSize\"\n            density=\"compact\"\n            hide-details\n            label=\"Size\"\n            min=\"1\"\n            max=\"50\"\n          >\n            <template v-slot:append>\n              <v-text-field\n                :model-value=\"brushSize\"\n                @input=\"setBrushSize\"\n                variant=\"underlined\"\n                class=\"mt-n1 pt-0\"\n                style=\"width: 40px\"\n                hide-details\n                type=\"number\"\n                min=\"1\"\n                max=\"50\"\n              />\n            </template>\n          </v-slider>\n        </v-col>\n      </v-row>\n      <v-row no-gutters align=\"center\">\n        <v-col>\n          <v-slider\n            :model-value=\"opacity\"\n            @update:model-value=\"setOpacity\"\n            density=\"compact\"\n            hide-details\n            label=\"Opacity\"\n            min=\"0\"\n            max=\"1\"\n            step=\"0.01\"\n          >\n            <template v-slot:append>\n              <v-text-field\n                :model-value=\"opacity\"\n                @input=\"setOpacity\"\n                variant=\"underlined\"\n                class=\"mt-n1 pt-0\"\n                style=\"width: 40px\"\n                hide-details\n                type=\"number\"\n                min=\"0\"\n                max=\"1\"\n                step=\"0.1\"\n              />\n            </template>\n          </v-slider>\n        </v-col>\n      </v-row>\n      <v-row no-gutters align=\"center\">\n        <v-col>\n          <v-color-picker\n            hide-canvas\n            hide-inputs\n            hide-mode-switch\n            hide-sliders\n            show-swatches\n            elevation=\"0\"\n            :swatches=\"swatches\"\n            :model-value=\"brushColor\"\n            @update:model-value=\"setBrushColor\"\n          />\n        </v-col>\n      </v-row>\n    </v-container>\n  </v-card>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent } from 'vue';\nimport { LABELMAP_PALETTE } from '../config';\nimport { usePaintToolStore } from '../store/tools/paint';\nimport { rgbaToHexa } from '../utils/color';\n\n// generates both the swatches for v-color-picker and the color-to-value mapping\nfunction convertToSwatches(\n  palette: typeof LABELMAP_PALETTE,\n  width: number = 5\n) {\n  const hexToValue: Record<string, number> = {};\n  const swatches: string[][] = [];\n  const entries = Object.entries(palette);\n  while (entries.length) {\n    const [value, rgba] = entries.shift()!;\n    const hex = rgbaToHexa(rgba).toUpperCase();\n    hexToValue[hex] = Number(value);\n\n    let row = swatches[swatches.length - 1];\n    if (!row || row.length === width) {\n      row = [];\n      swatches.push(row);\n    }\n    row.push(hex);\n  }\n\n  return { hexToValue, swatches };\n}\n\nexport default defineComponent({\n  name: 'PaintControls',\n\n  setup() {\n    const paintStore = usePaintToolStore();\n\n    const { hexToValue, swatches } = convertToSwatches(LABELMAP_PALETTE, 3);\n    const brushColor = computed(() => {\n      const value = paintStore.brushValue;\n      if (value in LABELMAP_PALETTE) {\n        return rgbaToHexa(LABELMAP_PALETTE[value]);\n      }\n      return null;\n    });\n\n    const setBrushColor = (color: string) => {\n      const hexa = `${color}FF`.toUpperCase();\n      if (hexa in hexToValue) {\n        paintStore.setBrushValue(hexToValue[hexa]);\n      }\n    };\n\n    const brushSize = computed(() => paintStore.brushSize);\n    const setBrushSize = (size: number) => {\n      paintStore.setBrushSize(Number(size));\n    };\n\n    const opacity = computed(() => paintStore.labelmapOpacity);\n    const setOpacity = (op: number) => {\n      paintStore.setLabelmapOpacity(Number(op));\n    };\n\n    return {\n      brushSize,\n      setBrushSize,\n      swatches,\n      brushColor,\n      setBrushColor,\n      opacity,\n      setOpacity,\n    };\n  },\n});\n</script>\n\n<style scoped>\n.form-label {\n  color: rgba(0, 0, 0, 0.6);\n}\n\n.scrolled-radios {\n  max-height: 300px;\n  overflow: auto;\n  /* prevents hover circle from clipping left */\n  padding-left: 6px;\n}\n</style>\n","<template>\n  <v-card width=\"350px\">\n    <v-container>\n      <!--\n      <v-row no-gutters align=\"center\">\n        <v-col>\n          <v-select\n            density=\"compact\"\n            outlined\n            hide-details\n            label=\"Select or create a labelmap\"\n          />\n        </v-col>\n      </v-row>\n      -->\n      <v-row no-gutters align=\"center\">\n        <v-col>\n          <v-slider\n            :model-value=\"brushSize\"\n            @update:model-value=\"setBrushSize\"\n            density=\"compact\"\n            hide-details\n            label=\"Size\"\n            min=\"1\"\n            max=\"50\"\n          >\n            <template v-slot:append>\n              <v-text-field\n                :model-value=\"brushSize\"\n                @input=\"setBrushSize\"\n                variant=\"underlined\"\n                class=\"mt-n1 pt-0\"\n                style=\"width: 40px\"\n                hide-details\n                type=\"number\"\n                min=\"1\"\n                max=\"50\"\n              />\n            </template>\n          </v-slider>\n        </v-col>\n      </v-row>\n      <v-row no-gutters align=\"center\">\n        <v-col>\n          <v-slider\n            :model-value=\"opacity\"\n            @update:model-value=\"setOpacity\"\n            density=\"compact\"\n            hide-details\n            label=\"Opacity\"\n            min=\"0\"\n            max=\"1\"\n            step=\"0.01\"\n          >\n            <template v-slot:append>\n              <v-text-field\n                :model-value=\"opacity\"\n                @input=\"setOpacity\"\n                variant=\"underlined\"\n                class=\"mt-n1 pt-0\"\n                style=\"width: 40px\"\n                hide-details\n                type=\"number\"\n                min=\"0\"\n                max=\"1\"\n                step=\"0.1\"\n              />\n            </template>\n          </v-slider>\n        </v-col>\n      </v-row>\n      <v-row no-gutters align=\"center\">\n        <v-col>\n          <v-color-picker\n            hide-canvas\n            hide-inputs\n            hide-mode-switch\n            hide-sliders\n            show-swatches\n            elevation=\"0\"\n            :swatches=\"swatches\"\n            :model-value=\"brushColor\"\n            @update:model-value=\"setBrushColor\"\n          />\n        </v-col>\n      </v-row>\n    </v-container>\n  </v-card>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent } from 'vue';\nimport { LABELMAP_PALETTE } from '../config';\nimport { usePaintToolStore } from '../store/tools/paint';\nimport { rgbaToHexa } from '../utils/color';\n\n// generates both the swatches for v-color-picker and the color-to-value mapping\nfunction convertToSwatches(\n  palette: typeof LABELMAP_PALETTE,\n  width: number = 5\n) {\n  const hexToValue: Record<string, number> = {};\n  const swatches: string[][] = [];\n  const entries = Object.entries(palette);\n  while (entries.length) {\n    const [value, rgba] = entries.shift()!;\n    const hex = rgbaToHexa(rgba).toUpperCase();\n    hexToValue[hex] = Number(value);\n\n    let row = swatches[swatches.length - 1];\n    if (!row || row.length === width) {\n      row = [];\n      swatches.push(row);\n    }\n    row.push(hex);\n  }\n\n  return { hexToValue, swatches };\n}\n\nexport default defineComponent({\n  name: 'PaintControls',\n\n  setup() {\n    const paintStore = usePaintToolStore();\n\n    const { hexToValue, swatches } = convertToSwatches(LABELMAP_PALETTE, 3);\n    const brushColor = computed(() => {\n      const value = paintStore.brushValue;\n      if (value in LABELMAP_PALETTE) {\n        return rgbaToHexa(LABELMAP_PALETTE[value]);\n      }\n      return null;\n    });\n\n    const setBrushColor = (color: string) => {\n      const hexa = `${color}FF`.toUpperCase();\n      if (hexa in hexToValue) {\n        paintStore.setBrushValue(hexToValue[hexa]);\n      }\n    };\n\n    const brushSize = computed(() => paintStore.brushSize);\n    const setBrushSize = (size: number) => {\n      paintStore.setBrushSize(Number(size));\n    };\n\n    const opacity = computed(() => paintStore.labelmapOpacity);\n    const setOpacity = (op: number) => {\n      paintStore.setLabelmapOpacity(Number(op));\n    };\n\n    return {\n      brushSize,\n      setBrushSize,\n      swatches,\n      brushColor,\n      setBrushColor,\n      opacity,\n      setOpacity,\n    };\n  },\n});\n</script>\n\n<style scoped>\n.form-label {\n  color: rgba(0, 0, 0, 0.6);\n}\n\n.scrolled-radios {\n  max-height: 300px;\n  overflow: auto;\n  /* prevents hover circle from clipping left */\n  padding-left: 6px;\n}\n</style>\n","<script lang=\"ts\">\nimport { watch, ref, computed, defineComponent } from 'vue';\nimport { useDisplay } from 'vuetify';\nimport ToolButton from './ToolButton.vue';\n\nexport default defineComponent({\n  name: 'MenuToolButton',\n  props: {\n    icon: { type: String, required: true },\n    name: { type: String, required: true },\n    size: { type: [Number, String], default: 40 },\n    active: Boolean,\n    disabled: Boolean,\n    mobileOnlyMenu: Boolean,\n  },\n  components: {\n    ToolButton,\n  },\n  setup(props) {\n    const display = useDisplay();\n\n    const showLeft = computed(() => !display.mobile.value);\n\n    const menuOn = ref(false);\n\n    const enableMenu = computed(\n      () => !props.mobileOnlyMenu || display.mobile.value\n    );\n\n    // Disable menu if mobile only\n    watch(menuOn, (on) => {\n      menuOn.value = on && enableMenu.value;\n    });\n\n    // Turn off menu if tool deselected\n    const active = computed(() => props.active);\n    watch(active, (on) => {\n      if (!on) {\n        menuOn.value = false;\n      }\n    });\n\n    return { showLeft, menuOn, enableMenu };\n  },\n});\n</script>\n\n<template>\n  <v-menu\n    no-click-animation\n    :close-on-content-click=\"false\"\n    v-model=\"menuOn\"\n    :location=\"showLeft ? 'left' : 'right'\"\n    class=\"overflow-auto\"\n  >\n    <template #activator=\"{ props }\">\n      <tool-button\n        :icon=\"icon\"\n        :name=\"name\"\n        :buttonClass=\"['tool-btn', active ? 'tool-btn-selected' : '']\"\n        :disabled=\"disabled\"\n        :size=\"size\"\n        @click=\"$emit('click')\"\n        v-bind=\"props\"\n      >\n        <v-icon\n          v-if=\"active && enableMenu\"\n          :class=\"[showLeft ? 'menu-more-left' : 'menu-more-right']\"\n          size=\"18\"\n        >\n          {{ showLeft ? 'mdi-menu-left' : 'mdi-menu-right' }}\n        </v-icon>\n      </tool-button>\n    </template>\n\n    <div class=\"menu-content elevation-24\">\n      <slot />\n    </div>\n  </v-menu>\n</template>\n\n<style scoped>\n.menu-more-left {\n  position: absolute;\n  left: -12%;\n}\n.menu-more-right {\n  position: absolute;\n  right: -12%;\n}\n\n.menu-content {\n  /* Show on top of button tooltip */\n  z-index: 1;\n}\n</style>\n","<script lang=\"ts\">\nimport { watch, ref, computed, defineComponent } from 'vue';\nimport { useDisplay } from 'vuetify';\nimport ToolButton from './ToolButton.vue';\n\nexport default defineComponent({\n  name: 'MenuToolButton',\n  props: {\n    icon: { type: String, required: true },\n    name: { type: String, required: true },\n    size: { type: [Number, String], default: 40 },\n    active: Boolean,\n    disabled: Boolean,\n    mobileOnlyMenu: Boolean,\n  },\n  components: {\n    ToolButton,\n  },\n  setup(props) {\n    const display = useDisplay();\n\n    const showLeft = computed(() => !display.mobile.value);\n\n    const menuOn = ref(false);\n\n    const enableMenu = computed(\n      () => !props.mobileOnlyMenu || display.mobile.value\n    );\n\n    // Disable menu if mobile only\n    watch(menuOn, (on) => {\n      menuOn.value = on && enableMenu.value;\n    });\n\n    // Turn off menu if tool deselected\n    const active = computed(() => props.active);\n    watch(active, (on) => {\n      if (!on) {\n        menuOn.value = false;\n      }\n    });\n\n    return { showLeft, menuOn, enableMenu };\n  },\n});\n</script>\n\n<template>\n  <v-menu\n    no-click-animation\n    :close-on-content-click=\"false\"\n    v-model=\"menuOn\"\n    :location=\"showLeft ? 'left' : 'right'\"\n    class=\"overflow-auto\"\n  >\n    <template #activator=\"{ props }\">\n      <tool-button\n        :icon=\"icon\"\n        :name=\"name\"\n        :buttonClass=\"['tool-btn', active ? 'tool-btn-selected' : '']\"\n        :disabled=\"disabled\"\n        :size=\"size\"\n        @click=\"$emit('click')\"\n        v-bind=\"props\"\n      >\n        <v-icon\n          v-if=\"active && enableMenu\"\n          :class=\"[showLeft ? 'menu-more-left' : 'menu-more-right']\"\n          size=\"18\"\n        >\n          {{ showLeft ? 'mdi-menu-left' : 'mdi-menu-right' }}\n        </v-icon>\n      </tool-button>\n    </template>\n\n    <div class=\"menu-content elevation-24\">\n      <slot />\n    </div>\n  </v-menu>\n</template>\n\n<style scoped>\n.menu-more-left {\n  position: absolute;\n  left: -12%;\n}\n.menu-more-right {\n  position: absolute;\n  right: -12%;\n}\n\n.menu-content {\n  /* Show on top of button tooltip */\n  z-index: 1;\n}\n</style>\n","<script lang=\"ts\">\nimport { defineComponent } from 'vue';\nimport ToolButton from '@/src/components/ToolButton.vue';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { useCropStore } from '@/src/store/tools/crop';\n\nexport default defineComponent({\n  components: {\n    ToolButton,\n  },\n  setup() {\n    const { currentImageID } = useCurrentImage();\n    const cropStore = useCropStore();\n\n    const resetCrop = () => {\n      const imageID = currentImageID.value;\n      if (imageID) {\n        cropStore.resetCropping(imageID);\n      }\n    };\n\n    return {\n      resetCrop,\n    };\n  },\n});\n</script>\n\n<template>\n  <v-card dark>\n    <tool-button\n      size=\"40\"\n      icon=\"mdi-restore\"\n      name=\"Reset Crop\"\n      @click=\"resetCrop\"\n    />\n  </v-card>\n</template>\n","<script lang=\"ts\">\nimport { defineComponent } from 'vue';\nimport ToolButton from '@/src/components/ToolButton.vue';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { useCropStore } from '@/src/store/tools/crop';\n\nexport default defineComponent({\n  components: {\n    ToolButton,\n  },\n  setup() {\n    const { currentImageID } = useCurrentImage();\n    const cropStore = useCropStore();\n\n    const resetCrop = () => {\n      const imageID = currentImageID.value;\n      if (imageID) {\n        cropStore.resetCropping(imageID);\n      }\n    };\n\n    return {\n      resetCrop,\n    };\n  },\n});\n</script>\n\n<template>\n  <v-card dark>\n    <tool-button\n      size=\"40\"\n      icon=\"mdi-restore\"\n      name=\"Reset Crop\"\n      @click=\"resetCrop\"\n    />\n  </v-card>\n</template>\n","<script setup lang=\"ts\">\nimport { computed, ref, watch } from 'vue';\nimport { LabelsStore } from '@/src/store/tools/useLabels';\nimport { AnnotationTool } from '../types/annotationTool';\nimport { standardizeColor } from '../utils';\n\nconst props = defineProps<{\n  label: string;\n  labelsStore: LabelsStore<AnnotationTool>;\n}>();\n\nconst label = computed(() => props.labelsStore.labels[props.label]);\n\nconst labelName = ref(label.value.labelName);\nwatch(labelName, (name) => {\n  props.labelsStore.updateLabel(props.label, { labelName: name });\n});\n\nconst colorLocal = ref(standardizeColor(label.value.color));\nwatch(colorLocal, (color) => {\n  props.labelsStore.updateLabel(props.label, { color });\n});\n\nconst emit = defineEmits(['close']);\nconst deleteLabel = () => {\n  emit('close');\n  props.labelsStore.deleteLabel(props.label);\n};\n</script>\n\n<template>\n  <v-card>\n    <v-card-title class=\"d-flex flex-row align-center\">\n      Edit Label\n      <v-spacer />\n      <v-btn\n        variant=\"text\"\n        density=\"compact\"\n        icon=\"mdi-close\"\n        @click=\"$emit('close')\"\n      />\n    </v-card-title>\n\n    <v-card-item>\n      <div class=\"d-flex flex-row\">\n        <div class=\"flex-grow-1 d-flex flex-column justify-space-between mr-4\">\n          <div>\n            <v-text-field\n              v-model=\"labelName\"\n              @keydown.stop.enter=\"$emit('close')\"\n              label=\"Name\"\n              class=\"flex-grow-0\"\n            />\n          </div>\n          <v-card-actions class=\"mb-2 px-0\">\n            <v-btn color=\"secondary\" variant=\"elevated\" @click=\"$emit('close')\">\n              Done\n            </v-btn>\n            <v-spacer />\n            <v-btn color=\"red\" variant=\"tonal\" @click=\"deleteLabel\">\n              Delete label\n            </v-btn>\n          </v-card-actions>\n        </div>\n        <v-color-picker v-model=\"colorLocal\" mode=\"rgb\" label=\"Color\" />\n      </div>\n    </v-card-item>\n  </v-card>\n</template>\n","<script setup lang=\"ts\">\nimport { computed, ref, watchEffect } from 'vue';\nimport { useDisplay } from 'vuetify';\nimport { LabelsStore } from '@/src/store/tools/useLabels';\nimport { AnnotationTool } from '@/src/types/annotationTool';\nimport { Maybe } from '@/src/types';\nimport LabelEditor from './LabelEditor.vue';\n\nconst props = defineProps<{\n  labelsStore: LabelsStore<AnnotationTool>;\n}>();\n\nconst labels = computed(() => Object.entries(props.labelsStore.labels));\n// item groups need an index, not a value\nconst activeLabelIndex = computed(() => {\n  return labels.value.findIndex(\n    ([name]) => name === props.labelsStore.activeLabel\n  );\n});\n\nconst editingLabel =\n  ref<Maybe<keyof typeof props.labelsStore.labels>>(undefined);\n\nconst createLabel = () => {\n  editingLabel.value = props.labelsStore.addLabel();\n};\n\nconst editDialog = ref(false);\nwatchEffect(() => {\n  editDialog.value = !!editingLabel.value;\n});\n\nconst display = useDisplay();\nconst mobile = computed(() => display.mobile.value);\n</script>\n\n<template>\n  <v-card class=\"pt-2\">\n    <v-card-subtitle>Labels</v-card-subtitle>\n    <v-container>\n      <v-item-group\n        :model-value=\"activeLabelIndex\"\n        selected-class=\"card-active\"\n        mandatory\n      >\n        <v-row dense>\n          <v-col\n            cols=\"6\"\n            v-for=\"[id, { labelName, color }] in labels\"\n            :key=\"id\"\n          >\n            <v-item v-slot=\"{ selectedClass, toggle }\">\n              <v-chip\n                variant=\"tonal\"\n                :class=\"['w-100 d-flex', selectedClass]\"\n                @click=\"\n                  () => {\n                    toggle();\n                    labelsStore.setActiveLabel(id);\n                  }\n                \"\n              >\n                <!-- dot container keeps overflowing name from squishing dot width  -->\n                <div class=\"dot-container mr-3\">\n                  <div class=\"color-dot\" :style=\"{ background: color }\" />\n                </div>\n                <span class=\"overflow-hidden\">{{ labelName }}</span>\n                <v-btn\n                  icon=\"mdi-pencil\"\n                  density=\"compact\"\n                  class=\"ml-auto\"\n                  variant=\"plain\"\n                  @click.stop=\"\n                    () => {\n                      editingLabel = id;\n                      editDialog = true;\n                    }\n                  \"\n                />\n              </v-chip>\n            </v-item>\n          </v-col>\n\n          <!-- Add Label button -->\n          <v-col cols=\"6\">\n            <v-chip variant=\"outlined\" class=\"w-100\" @click=\"createLabel\">\n              <v-icon class=\"mr-2\">mdi-plus</v-icon>\n              Add Label\n            </v-chip>\n          </v-col>\n        </v-row>\n      </v-item-group>\n    </v-container>\n  </v-card>\n\n  <v-dialog v-model=\"editDialog\" :width=\"mobile ? '100%' : '50%'\">\n    <LabelEditor\n      @close=\"editingLabel = undefined\"\n      v-if=\"editingLabel\"\n      :label=\"editingLabel\"\n      :labelsStore=\"labelsStore\"\n    />\n  </v-dialog>\n</template>\n\n<style scoped>\n.card-active {\n  background-color: rgb(var(--v-theme-selection-bg-color));\n  border-color: rgb(var(--v-theme-selection-border-color));\n}\n\n.color-dot {\n  width: 18px;\n  height: 18px;\n  border-radius: 16px;\n}\n.dot-container {\n  width: 18px;\n}\n</style>\n","<script setup lang=\"ts\">\nimport { useRulerStore } from '@src/store/tools/rulers';\nimport LabelControls from '@src/components/LabelControls.vue';\n\nconst activeToolStore = useRulerStore();\n</script>\n\n<template>\n  <LabelControls :labels-store=\"activeToolStore\" />\n</template>\n","<script setup lang=\"ts\">\nimport { useRectangleStore } from '@src/store/tools/rectangles';\nimport LabelControls from '@src/components/LabelControls.vue';\n\nconst activeToolStore = useRectangleStore();\n</script>\n\n<template>\n  <LabelControls :labels-store=\"activeToolStore\" />\n</template>\n","<script setup lang=\"ts\">\nimport ToolButton from '@/src/components/ToolButton.vue';\nimport useContourStore, { ContourToolMode } from '@/src/store/tools/contours';\nimport { storeToRefs } from 'pinia';\nimport LabelControls from '@/src/components/LabelControls.vue';\n\nconst contourStore = useContourStore();\nconst { mode } = storeToRefs(contourStore);\n\nfunction setMode(m: ContourToolMode) {\n  contourStore.setMode(m);\n}\n</script>\n\n<template>\n  <v-card dark>\n    <v-card-subtitle class=\"my-1\">Tools</v-card-subtitle>\n    <v-item-group\n      mandatory\n      selected-class=\"tool-btn-selected\"\n      :model-value=\"mode\"\n      @update:model-value=\"setMode\"\n    >\n      <v-item\n        v-slot=\"{ selectedClass, toggle }\"\n        :value=\"ContourToolMode.Select\"\n      >\n        <tool-button\n          size=\"40\"\n          icon=\"mdi-cursor-default\"\n          name=\"Select\"\n          :buttonClass=\"selectedClass || ''\"\n          @click=\"toggle\"\n        />\n      </v-item>\n      <v-item\n        v-slot=\"{ selectedClass, toggle }\"\n        :value=\"ContourToolMode.FreehandDraw\"\n      >\n        <tool-button\n          size=\"40\"\n          icon=\"mdi-draw\"\n          name=\"Freehand\"\n          :buttonClass=\"selectedClass || ''\"\n          @click=\"toggle\"\n        />\n      </v-item>\n      <v-item\n        v-slot=\"{ selectedClass, toggle }\"\n        :value=\"ContourToolMode.PointPlacing\"\n      >\n        <tool-button\n          size=\"40\"\n          icon=\"mdi-vector-polyline\"\n          name=\"Point Placing\"\n          :buttonClass=\"selectedClass || ''\"\n          @click=\"toggle\"\n        />\n      </v-item>\n      <v-item\n        v-slot=\"{ selectedClass, toggle }\"\n        :value=\"ContourToolMode.Threshold\"\n      >\n        <tool-button\n          size=\"40\"\n          icon=\"mdi-math-integral\"\n          name=\"Threshold\"\n          :buttonClass=\"selectedClass || ''\"\n          @click=\"toggle\"\n        />\n      </v-item>\n      <v-item\n        v-slot=\"{ selectedClass, toggle }\"\n        :value=\"ContourToolMode.CircleNudge\"\n      >\n        <tool-button\n          size=\"40\"\n          icon=\"mdi-circle-multiple-outline\"\n          name=\"Nudge\"\n          :buttonClass=\"selectedClass || ''\"\n          @click=\"toggle\"\n        />\n      </v-item>\n    </v-item-group>\n    <label-controls :labels-store=\"contourStore\" />\n  </v-card>\n</template>\n\n<style>\n.tool-btn-selected {\n  background-color: rgba(128, 128, 255, 0.7);\n}\n</style>\n","<template>\n  <item-group\n    mandatory\n    :model-value=\"currentTool\"\n    @update:model-value=\"setCurrentTool($event)\"\n  >\n    <groupable-item\n      v-slot:default=\"{ active, toggle }\"\n      :value=\"Tools.WindowLevel\"\n    >\n      <tool-button\n        icon=\"mdi-circle-half-full\"\n        name=\"Window & Level\"\n        :buttonClass=\"['tool-btn', active ? 'tool-btn-selected' : '']\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      />\n    </groupable-item>\n    <groupable-item v-slot:default=\"{ active, toggle }\" :value=\"Tools.Pan\">\n      <tool-button\n        icon=\"mdi-cursor-move\"\n        name=\"Pan\"\n        :buttonClass=\"['tool-btn', active ? 'tool-btn-selected' : '']\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      />\n    </groupable-item>\n    <groupable-item v-slot:default=\"{ active, toggle }\" :value=\"Tools.Zoom\">\n      <tool-button\n        icon=\"mdi-magnify-plus-outline\"\n        name=\"Zoom\"\n        :buttonClass=\"['tool-btn', active ? 'tool-btn-selected' : '']\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      />\n    </groupable-item>\n    <groupable-item\n      v-slot:default=\"{ active, toggle }\"\n      :value=\"Tools.Crosshairs\"\n    >\n      <tool-button\n        icon=\"mdi-crosshairs\"\n        name=\"Crosshairs\"\n        :buttonClass=\"['tool-btn', active ? 'tool-btn-selected' : '']\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      />\n    </groupable-item>\n\n    <groupable-item v-slot:default=\"{ active, toggle }\" :value=\"Tools.Paint\">\n      <menu-tool-button\n        icon=\"mdi-brush\"\n        name=\"Paint\"\n        :active=\"active\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      >\n        <paint-controls />\n      </menu-tool-button>\n    </groupable-item>\n    <groupable-item\n      v-slot:default=\"{ active, toggle }\"\n      :value=\"Tools.Rectangle\"\n    >\n      <menu-tool-button\n        icon=\"mdi-vector-square\"\n        name=\"Rectangle\"\n        :mobileOnlyMenu=\"true\"\n        :active=\"active\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      >\n        <rectangle-controls />\n      </menu-tool-button>\n    </groupable-item>\n    <groupable-item v-slot:default=\"{ active, toggle }\" :value=\"Tools.Ruler\">\n      <menu-tool-button\n        icon=\"mdi-ruler\"\n        name=\"Ruler\"\n        :mobileOnlyMenu=\"true\"\n        :active=\"active\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      >\n        <ruler-controls />\n      </menu-tool-button>\n    </groupable-item>\n\n    <groupable-item v-slot:default=\"{ active, toggle }\" :value=\"Tools.Contour\">\n      <menu-tool-button\n        icon=\"mdi-shape-circle-plus\"\n        name=\"Contour\"\n        :active=\"active\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      >\n        <contour-controls />\n      </menu-tool-button>\n    </groupable-item>\n\n    <groupable-item v-slot:default=\"{ active, toggle }\" :value=\"Tools.Crop\">\n      <menu-tool-button\n        icon=\"mdi-crop\"\n        name=\"Crop\"\n        :active=\"active\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      >\n        <crop-controls />\n      </menu-tool-button>\n    </groupable-item>\n  </item-group>\n</template>\n\n<script lang=\"ts\">\nimport { storeToRefs } from 'pinia';\nimport { computed, defineComponent, ref } from 'vue';\nimport { onKeyDown } from '@vueuse/core';\nimport { Tools } from '@/src/store/tools/types';\nimport ToolButton from './ToolButton.vue';\nimport ItemGroup from './ItemGroup.vue';\nimport GroupableItem from './GroupableItem.vue';\nimport { useDatasetStore } from '../store/datasets';\nimport { useToolStore } from '../store/tools';\nimport PaintControls from './PaintControls.vue';\nimport MenuToolButton from './MenuToolButton.vue';\nimport CropControls from './tools/crop/CropControls.vue';\nimport { useRectangleStore } from '../store/tools/rectangles';\nimport { useRulerStore } from '../store/tools/rulers';\nimport RulerControls from './RulerControls.vue';\nimport RectangleControls from './RectangleControls.vue';\nimport ContourControls from './tools/contour/ContourControls.vue';\n\nexport default defineComponent({\n  components: {\n    ToolButton,\n    MenuToolButton,\n    ItemGroup,\n    GroupableItem,\n    PaintControls,\n    CropControls,\n    RulerControls,\n    RectangleControls,\n    ContourControls,\n  },\n  setup() {\n    const dataStore = useDatasetStore();\n    const toolStore = useToolStore();\n\n    console.log(storeToRefs(toolStore));\n\n    const noCurrentImage = computed(() => !dataStore.primaryDataset);\n    // const noCurrentImage = false;\n    const currentTool = computed(() => toolStore.currentTool);\n\n    const rectangleStore = useRectangleStore();\n    const rulerStore = useRulerStore();\n\n    const paintMenu = ref(false);\n    const cropMenu = ref(false);\n\n    onKeyDown('Escape', () => {\n      paintMenu.value = false;\n      cropMenu.value = false;\n    });\n\n    return {\n      currentTool,\n      setCurrentTool: toolStore.setCurrentTool,\n      noCurrentImage,\n      Tools,\n      paintMenu,\n      cropMenu,\n      rectangleStore,\n      rulerStore,\n    };\n  },\n});\n</script>\n\n<style>\n.tool-btn-selected {\n  background-color: rgb(var(--v-theme-selection-bg-color));\n}\n</style>\n\n<style scoped>\n.menu-more {\n  position: absolute;\n  right: -10%;\n}\n\n.tool-separator {\n  width: 75%;\n  height: 1px;\n  border: none;\n  border-top: 1px solid rgb(112, 112, 112);\n}\n\n.popup-menu {\n  max-width: 400px; /* a little less than v-navigation-drawer in App.vue */\n}\n</style>\n","<template>\n  <item-group\n    mandatory\n    :model-value=\"currentTool\"\n    @update:model-value=\"setCurrentTool($event)\"\n  >\n    <groupable-item\n      v-slot:default=\"{ active, toggle }\"\n      :value=\"Tools.WindowLevel\"\n    >\n      <tool-button\n        icon=\"mdi-circle-half-full\"\n        name=\"Window & Level\"\n        :buttonClass=\"['tool-btn', active ? 'tool-btn-selected' : '']\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      />\n    </groupable-item>\n    <groupable-item v-slot:default=\"{ active, toggle }\" :value=\"Tools.Pan\">\n      <tool-button\n        icon=\"mdi-cursor-move\"\n        name=\"Pan\"\n        :buttonClass=\"['tool-btn', active ? 'tool-btn-selected' : '']\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      />\n    </groupable-item>\n    <groupable-item v-slot:default=\"{ active, toggle }\" :value=\"Tools.Zoom\">\n      <tool-button\n        icon=\"mdi-magnify-plus-outline\"\n        name=\"Zoom\"\n        :buttonClass=\"['tool-btn', active ? 'tool-btn-selected' : '']\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      />\n    </groupable-item>\n    <groupable-item\n      v-slot:default=\"{ active, toggle }\"\n      :value=\"Tools.Crosshairs\"\n    >\n      <tool-button\n        icon=\"mdi-crosshairs\"\n        name=\"Crosshairs\"\n        :buttonClass=\"['tool-btn', active ? 'tool-btn-selected' : '']\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      />\n    </groupable-item>\n\n    <groupable-item v-slot:default=\"{ active, toggle }\" :value=\"Tools.Paint\">\n      <menu-tool-button\n        icon=\"mdi-brush\"\n        name=\"Paint\"\n        :active=\"active\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      >\n        <paint-controls />\n      </menu-tool-button>\n    </groupable-item>\n    <groupable-item\n      v-slot:default=\"{ active, toggle }\"\n      :value=\"Tools.Rectangle\"\n    >\n      <menu-tool-button\n        icon=\"mdi-vector-square\"\n        name=\"Rectangle\"\n        :mobileOnlyMenu=\"true\"\n        :active=\"active\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      >\n        <rectangle-controls />\n      </menu-tool-button>\n    </groupable-item>\n    <groupable-item v-slot:default=\"{ active, toggle }\" :value=\"Tools.Ruler\">\n      <menu-tool-button\n        icon=\"mdi-ruler\"\n        name=\"Ruler\"\n        :mobileOnlyMenu=\"true\"\n        :active=\"active\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      >\n        <ruler-controls />\n      </menu-tool-button>\n    </groupable-item>\n\n    <groupable-item v-slot:default=\"{ active, toggle }\" :value=\"Tools.Contour\">\n      <menu-tool-button\n        icon=\"mdi-shape-circle-plus\"\n        name=\"Contour\"\n        :active=\"active\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      >\n        <contour-controls />\n      </menu-tool-button>\n    </groupable-item>\n\n    <groupable-item v-slot:default=\"{ active, toggle }\" :value=\"Tools.Crop\">\n      <menu-tool-button\n        icon=\"mdi-crop\"\n        name=\"Crop\"\n        :active=\"active\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      >\n        <crop-controls />\n      </menu-tool-button>\n    </groupable-item>\n  </item-group>\n</template>\n\n<script lang=\"ts\">\nimport { storeToRefs } from 'pinia';\nimport { computed, defineComponent, ref } from 'vue';\nimport { onKeyDown } from '@vueuse/core';\nimport { Tools } from '@/src/store/tools/types';\nimport ToolButton from './ToolButton.vue';\nimport ItemGroup from './ItemGroup.vue';\nimport GroupableItem from './GroupableItem.vue';\nimport { useDatasetStore } from '../store/datasets';\nimport { useToolStore } from '../store/tools';\nimport PaintControls from './PaintControls.vue';\nimport MenuToolButton from './MenuToolButton.vue';\nimport CropControls from './tools/crop/CropControls.vue';\nimport { useRectangleStore } from '../store/tools/rectangles';\nimport { useRulerStore } from '../store/tools/rulers';\nimport RulerControls from './RulerControls.vue';\nimport RectangleControls from './RectangleControls.vue';\nimport ContourControls from './tools/contour/ContourControls.vue';\n\nexport default defineComponent({\n  components: {\n    ToolButton,\n    MenuToolButton,\n    ItemGroup,\n    GroupableItem,\n    PaintControls,\n    CropControls,\n    RulerControls,\n    RectangleControls,\n    ContourControls,\n  },\n  setup() {\n    const dataStore = useDatasetStore();\n    const toolStore = useToolStore();\n\n    console.log(storeToRefs(toolStore));\n\n    const noCurrentImage = computed(() => !dataStore.primaryDataset);\n    // const noCurrentImage = false;\n    const currentTool = computed(() => toolStore.currentTool);\n\n    const rectangleStore = useRectangleStore();\n    const rulerStore = useRulerStore();\n\n    const paintMenu = ref(false);\n    const cropMenu = ref(false);\n\n    onKeyDown('Escape', () => {\n      paintMenu.value = false;\n      cropMenu.value = false;\n    });\n\n    return {\n      currentTool,\n      setCurrentTool: toolStore.setCurrentTool,\n      noCurrentImage,\n      Tools,\n      paintMenu,\n      cropMenu,\n      rectangleStore,\n      rulerStore,\n    };\n  },\n});\n</script>\n\n<style>\n.tool-btn-selected {\n  background-color: rgb(var(--v-theme-selection-bg-color));\n}\n</style>\n\n<style scoped>\n.menu-more {\n  position: absolute;\n  right: -10%;\n}\n\n.tool-separator {\n  width: 75%;\n  height: 1px;\n  border: none;\n  border-top: 1px solid rgb(112, 112, 112);\n}\n\n.popup-menu {\n  max-width: 400px; /* a little less than v-navigation-drawer in App.vue */\n}\n</style>\n","import { onUnmounted } from 'vue';\nimport type { vtkSubscription } from '@kitware/vtk.js/interfaces';\n\nexport function manageVTKSubscription(subscription: vtkSubscription) {\n  onUnmounted(() => subscription.unsubscribe());\n}\n","import { ref } from 'vue';\nimport vtkCamera from '@kitware/vtk.js/Rendering/Core/Camera';\nimport { manageVTKSubscription } from '@src/composables/manageVTKSubscription';\nimport { vec3 } from 'gl-matrix';\n\nexport function useResizeToFit(\n  camera: vtkCamera,\n  initialValue: boolean = false\n) {\n  const resizeToFit = ref(initialValue);\n\n  let trackResizeToFit = true;\n  const cachedCameraInfo = {\n    position: [0, 0, 0] as vec3,\n    parallelScale: 0,\n  };\n\n  manageVTKSubscription(\n    camera.onModified(() => {\n      if (trackResizeToFit && resizeToFit.value) {\n        const position = camera.getPosition();\n        const parallelScale = camera.getParallelScale();\n        if (\n          !vec3.equals(position, cachedCameraInfo.position) ||\n          parallelScale !== cachedCameraInfo.parallelScale\n        ) {\n          resizeToFit.value = false;\n        }\n      }\n    })\n  );\n\n  function ignoreResizeToFitTracking(cb: () => void) {\n    if (trackResizeToFit) {\n      trackResizeToFit = false;\n      try {\n        cb();\n      } finally {\n        trackResizeToFit = true;\n      }\n    }\n  }\n\n  function resetResizeToFitTracking() {\n    cachedCameraInfo.position = camera.getPosition();\n    cachedCameraInfo.parallelScale = camera.getParallelScale();\n  }\n\n  return { resizeToFit, ignoreResizeToFitTracking, resetResizeToFitTracking };\n}\n","<template>\n  <div\n    class=\"slice-slider\"\n    ref=\"handleContainer\"\n    @pointerdown=\"onDragStart\"\n    @pointermove=\"onDragMove\"\n    @pointerup=\"onDragEnd\"\n    @pointercancel=\"onDragEnd\"\n    @contextmenu=\"$event.preventDefault()\"\n  >\n    <div class=\"slice-slider-track\" />\n    <div\n      class=\"slice-slider-handle\"\n      ref=\"handle\"\n      :style=\"{\n        height: `${handleHeight}px`,\n        transform: `translate3d(0, ${handlePosition}px, 0)`,\n      }\"\n    />\n  </div>\n</template>\n\n<script>\nfunction getYOffsetFromTransform(matStr) {\n  if (!matStr || matStr === 'none') {\n    return 0;\n  }\n  const values = matStr\n    .match(/matrix(?:3d)?\\((.+)\\)/)[1]\n    .split(',')\n    .map((v) => Number(v));\n  const is3D = matStr.includes('3d');\n  return is3D ? values[13] : values[5];\n}\n\nexport default {\n  props: {\n    slice: {\n      type: Number,\n      default: 0,\n    },\n    min: {\n      type: Number,\n      required: true,\n    },\n    max: {\n      type: Number,\n      required: true,\n    },\n    step: {\n      type: Number,\n      required: true,\n    },\n    handleHeight: {\n      type: Number,\n      default: 20,\n    },\n  },\n\n  data() {\n    return {\n      maxHandlePos: 0,\n      dragging: false,\n      initialHandlePos: 0,\n      initialMousePosY: 0,\n      yOffset: 0,\n    };\n  },\n\n  computed: {\n    handlePosition() {\n      const range = this.max - this.min <= 0 ? 1 : this.max - this.min;\n      const pos = this.maxHandlePos * ((this.slice - this.min) / range);\n      return this.dragging ? this.draggingHandlePos : pos;\n    },\n    draggingHandlePos() {\n      return Math.min(\n        Math.max(0, this.initialHandlePos + this.yOffset),\n        this.maxHandlePos\n      );\n    },\n  },\n\n  mounted() {\n    this.updateMaxHandlePos();\n    this.resizeObserver = new ResizeObserver((entries) => {\n      if (entries.length === 1) {\n        this.updateMaxHandlePos();\n      }\n    });\n    this.resizeObserver.observe(this.$refs.handleContainer);\n  },\n\n  beforeUnmount() {\n    this.resizeObserver.disconnect();\n  },\n\n  methods: {\n    updateMaxHandlePos() {\n      this.maxHandlePos =\n        this.$refs.handleContainer.clientHeight - this.handleHeight;\n    },\n\n    onDragStart(ev) {\n      ev.preventDefault();\n\n      this.dragging = true;\n      this.initialMousePosY = ev.pageY;\n\n      if (ev.target === this.$refs.handle) {\n        const handleStyles = window.getComputedStyle(this.$refs.handle);\n        this.initialHandlePos = getYOffsetFromTransform(handleStyles.transform);\n      } else {\n        // move handle to mouse pos\n        const { y } = this.$refs.handleContainer.getBoundingClientRect();\n        this.initialHandlePos = Math.max(\n          0,\n          Math.min(this.maxHandlePos, ev.pageY - y - this.handleHeight / 2)\n        );\n        const newSlice = this.getNearestSlice(this.initialHandlePos);\n        this.$emit('input', newSlice);\n      }\n\n      this.yOffset = 0;\n\n      this.$refs.handleContainer.setPointerCapture(ev.pointerId);\n    },\n\n    onDragMove(ev) {\n      if (!this.$refs.handleContainer.hasPointerCapture(ev.pointerId)) return;\n      ev.preventDefault();\n\n      this.yOffset = ev.pageY - this.initialMousePosY;\n      const slice = this.getNearestSlice(this.handlePosition);\n      this.$emit('input', slice);\n    },\n\n    onDragEnd(ev) {\n      if (!this.$refs.handleContainer.hasPointerCapture(ev.pointerId)) return;\n      ev.preventDefault();\n      this.$refs.handleContainer.releasePointerCapture(ev.pointerId);\n\n      this.dragging = false;\n      const slice = this.getNearestSlice(this.handlePosition);\n      this.$emit('input', slice);\n    },\n\n    getNearestSlice(pos) {\n      const sliceEstimate = pos / this.maxHandlePos;\n      const frac = sliceEstimate * (this.max - this.min) + this.min;\n      return Math.round(frac / this.step) * this.step;\n    },\n  },\n};\n</script>\n\n<style scoped>\n.slice-slider {\n  touch-action: none;\n}\n\n.slice-slider-handle {\n  position: relative;\n  width: 100%;\n  background: #ccc;\n  box-sizing: border-box;\n  border-radius: 3px;\n  border: 1px solid #999;\n}\n\n.slice-slider-track {\n  position: absolute;\n  margin: 0 auto;\n  top: 8px;\n  left: 0;\n  right: 0;\n  bottom: 8px;\n  width: 1px;\n  border: 1px solid #888;\n  border-radius: 2px;\n}\n</style>\n","<template>\n  <div :class=\"$style.gridRoot\">\n    <div :class=\"[$style.top, $style.row]\">\n      <div :class=\"[$style.left, $style.cell]\">\n        <slot name=\"top-left\" />\n      </div>\n      <div :class=\"[$style.center, $style.cell]\">\n        <slot name=\"top-center\" />\n      </div>\n      <div :class=\"[$style.right, $style.cell]\">\n        <slot name=\"top-right\" />\n      </div>\n    </div>\n    <div :class=\"[$style.middle, $style.row]\">\n      <div :class=\"[$style.left, $style.cell]\">\n        <slot name=\"middle-left\" />\n      </div>\n      <div :class=\"[$style.center, $style.cell]\">\n        <slot name=\"middle-center\" />\n      </div>\n      <div :class=\"[$style.right, $style.cell]\">\n        <slot name=\"middle-right\" />\n      </div>\n    </div>\n    <div :class=\"[$style.bottom, $style.row]\">\n      <div :class=\"[$style.left, $style.cell]\">\n        <slot name=\"bottom-left\" />\n      </div>\n      <div :class=\"[$style.center, $style.cell]\">\n        <slot name=\"bottom-center\" />\n      </div>\n      <div :class=\"[$style.right, $style.cell]\">\n        <slot name=\"bottom-right\" />\n      </div>\n    </div>\n  </div>\n</template>\n\n<style module>\n.gridRoot {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n}\n\n.row {\n  flex: 1;\n  display: flex;\n  flex-direction: row;\n  align-items: stretch;\n}\n\n.cell {\n  flex: 1;\n}\n\n.top,\n.left {\n  align-items: flex-start;\n}\n\n.center,\n.middle {\n  align-items: center;\n}\n\n.bottom,\n.right {\n  align-items: flex-end;\n}\n\n.left {\n  text-align: left;\n}\n\n.center {\n  text-align: center;\n}\n\n.right {\n  text-align: right;\n}\n</style>\n","import { onBeforeUnmount, Ref, unref, watch } from 'vue';\n\n/**\n * Invokes a callback whenever an element is resized.\n */\nexport function useResizeObserver(\n  targetElRef: Ref<Element | null | undefined>,\n  callback: (entry: ResizeObserverEntry) => void\n) {\n  const observer = new ResizeObserver((entries) => {\n    if (entries.length === 1) {\n      callback(entries[0]);\n    }\n  });\n\n  watch(\n    targetElRef,\n    (targetEl, prevTarget) => {\n      if (prevTarget) {\n        observer.unobserve(prevTarget);\n      }\n      if (targetEl) {\n        observer.observe(targetEl);\n      }\n    },\n    { immediate: true }\n  );\n\n  onBeforeUnmount(() => {\n    const targetEl = unref(targetElRef);\n    if (targetEl) {\n      observer.unobserve(targetEl);\n    }\n  });\n\n  return observer;\n}\n","import type { vtkSubscription } from '@kitware/vtk.js/interfaces';\nimport { isRef, onUnmounted, watchEffect } from 'vue';\nimport { MaybeRef } from '@vueuse/core';\n\ntype Listener = (obj: any) => void;\ntype VTKCallback = (listener: Listener) => vtkSubscription;\n\nexport function useVTKCallback(\n  callback: MaybeRef<VTKCallback | null | undefined>\n) {\n  const handleListener = (listener: Listener) => {\n    let subscription: vtkSubscription | null = null;\n\n    const cleanup = () => {\n      subscription?.unsubscribe();\n      subscription = null;\n    };\n    onUnmounted(cleanup);\n\n    if (isRef(callback)) {\n      watchEffect(() => {\n        cleanup();\n        if (callback.value) {\n          subscription = callback.value(listener);\n        }\n      });\n    } else if (callback) {\n      subscription = callback(listener);\n    }\n  };\n\n  return handleListener;\n}\n","import { computed, Ref, ref } from 'vue';\nimport { vec3 } from 'gl-matrix';\nimport type { Vector3 } from '@kitware/vtk.js/types';\nimport vtkViewProxy from '@kitware/vtk.js/Proxy/Core/ViewProxy';\nimport { EPSILON } from '../constants';\nimport { useVTKCallback } from './useVTKCallback';\n\nexport function toOrderedLabels(vec: Vector3) {\n  return (\n    vec\n      .map((v, i) => ({ value: v, axis: i }))\n      // remove components close to zero, since we won't show those labels\n      .filter(({ value }) => Math.abs(value) > EPSILON)\n      // sort from largest to smallest component\n      .sort((a, b) => Math.abs(b.value) - Math.abs(a.value))\n      // apply labels\n      .map(({ value, axis }) => (Math.sign(value) === 1 ? 'LPS' : 'RAI')[axis])\n      .join('')\n  );\n}\n\n/**\n * Computes orientation labels for a given view.\n *\n * Labels are with respect to the current camera orientation.\n *\n * vtk.js coordinate coordinate is implied to be LPS, so orientation labels\n * are determined solely from the camera' direction and view-up.\n */\nexport function useOrientationLabels(view: Ref<vtkViewProxy>) {\n  const camera = computed(() => view.value.getCamera());\n\n  const top = ref('');\n  const left = ref('');\n  const bottom = ref('');\n  const right = ref('');\n\n  function updateAxes() {\n    const vup = camera.value.getViewUp();\n    const vdir = camera.value.getDirectionOfProjection();\n    const vright = [0, 0, 0] as Vector3;\n\n    // vup and vdir should not be parallel for cameras\n    vec3.cross(vright, vdir, vup);\n\n    const vbottom = vup.map((c) => c * -1) as Vector3;\n    const vleft = vright.map((c) => c * -1) as Vector3;\n\n    top.value = toOrderedLabels(vup);\n    right.value = toOrderedLabels(vright);\n    bottom.value = toOrderedLabels(vbottom);\n    left.value = toOrderedLabels(vleft);\n  }\n\n  const cameraOnModified = useVTKCallback(\n    computed(() => camera.value.onModified)\n  );\n  cameraOnModified(updateAxes);\n  updateAxes();\n\n  return { top, right, bottom, left };\n}\n","import { computed, Ref, unref } from 'vue';\nimport { MaybeRef } from '@vueuse/core';\nimport { mat3 } from 'gl-matrix';\nimport { ImageMetadata } from '../types/image';\nimport { LPSAxisDir } from '../types/lps';\nimport { getLPSDirections } from '../utils/lps';\n\n/**\n *\n * @param {Ref<LPSAxisDir>} viewDirection an LPS view look-direction\n * @param {Ref<LPSAxisDir>} viewUp an LPS view up-direction\n * @param {Ref<ImageMetadata>} imageMetadataRef image metadata\n */\nexport function useCameraOrientation(\n  viewDirection: MaybeRef<LPSAxisDir>,\n  viewUp: MaybeRef<LPSAxisDir>,\n  imageMetadataRef: Ref<ImageMetadata>\n) {\n  const orientationMatrix = computed(\n    () => imageMetadataRef.value.orientation as mat3\n  );\n  const lpsDirections = computed(() =>\n    getLPSDirections(orientationMatrix.value)\n  );\n  const cameraDirVec = computed(\n    () => lpsDirections.value[unref(viewDirection)]\n  );\n  const cameraUpVec = computed(() => lpsDirections.value[unref(viewUp)]);\n\n  return {\n    cameraDirVec,\n    cameraUpVec,\n  };\n}\n","<script lang=\"ts\">\nimport {\n  computed,\n  defineComponent,\n  onBeforeUnmount,\n  toRefs,\n  watch,\n  h,\n} from 'vue';\nimport vtkLPSView2DProxy from '@/src/vtk/LPSView2DProxy';\nimport { useToolStore } from '@/src/store/tools';\nimport { Tools } from '@/src/store/tools/types';\nimport useWindowingStore, {\n  defaultWindowLevelConfig,\n} from '@/src/store/view-configs/windowing';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport vtkMouseRangeManipulator from '@kitware/vtk.js/Interaction/Manipulators/MouseRangeManipulator';\nimport { useViewStore } from '@/src/store/views';\n\nfunction computeStep(min: number, max: number) {\n  return Math.min(max - min, 1) / 256;\n}\n\ninterface Props {\n  viewId: string;\n}\n\nconst WindowLevelToolComponent = defineComponent({\n  name: 'WindowLevelTool',\n  props: {\n    viewId: {\n      type: String,\n      required: true,\n    },\n  },\n  setup(props) {\n    const { viewId: viewID } = toRefs(props);\n    const windowingStore = useWindowingStore();\n    const viewStore = useViewStore();\n    const { currentImageID } = useCurrentImage();\n\n    const viewProxy = computed(\n      () => viewStore.getViewProxy<vtkLPSView2DProxy>(viewID.value)!\n    );\n\n    const windowConfigDefaults = defaultWindowLevelConfig();\n    const wlConfig = computed(() =>\n      windowingStore.getConfig(viewID.value, currentImageID.value)\n    );\n\n    const wwRange = computed(() => ({\n      min: 1e-12, // ensure we don't hit zero and jump to white\n      max:\n        wlConfig.value != null\n          ? wlConfig.value.max - wlConfig.value.min\n          : windowConfigDefaults.max,\n      step:\n        wlConfig.value != null\n          ? computeStep(wlConfig.value.min, wlConfig.value.max)\n          : computeStep(windowConfigDefaults.min, windowConfigDefaults.max),\n    }));\n    const wlRange = computed(() => ({\n      min:\n        wlConfig.value != null ? wlConfig.value.min : windowConfigDefaults.min,\n      max:\n        wlConfig.value != null ? wlConfig.value.max : windowConfigDefaults.max,\n      step:\n        wlConfig.value != null\n          ? computeStep(wlConfig.value.min, wlConfig.value.max)\n          : computeStep(windowConfigDefaults.min, windowConfigDefaults.max),\n    }));\n\n    const vertVal = computed(() =>\n      wlConfig.value != null ? wlConfig.value.width : windowConfigDefaults.width\n    );\n\n    const horizVal = computed(() =>\n      wlConfig.value != null ? wlConfig.value.level : windowConfigDefaults.level\n    );\n\n    const rangeManipulator = vtkMouseRangeManipulator.newInstance({\n      button: 1,\n      scrollEnabled: false,\n    });\n\n    watch(\n      viewProxy,\n      (curViewProxy, oldViewProxy) => {\n        if (oldViewProxy) {\n          const istyle = oldViewProxy.getInteractorStyle2D();\n          istyle.removeMouseManipulator(rangeManipulator);\n        }\n\n        if (curViewProxy) {\n          // assumed to be vtkInteractorStyleManipulator\n          const istyle = viewProxy.value.getInteractorStyle2D();\n          istyle.addMouseManipulator(rangeManipulator);\n        }\n      },\n      { immediate: true }\n    );\n\n    onBeforeUnmount(() => {\n      // for some reason, VtkTwoView.onBeforeUnmount is being\n      // invoked before this onBeforeUnmount during HMR.\n      if (!viewProxy.value.isDeleted()) {\n        const istyle = viewProxy.value.getInteractorStyle2D();\n        istyle.removeMouseManipulator(rangeManipulator);\n      }\n    });\n\n    function updateManipulator() {\n      rangeManipulator.removeAllListeners();\n      const vertRange = wwRange.value;\n      const horizRange = wlRange.value;\n\n      rangeManipulator.setVerticalListener(\n        vertRange.min,\n        vertRange.max,\n        vertRange.step,\n        () => vertVal.value,\n        (v) => {\n          if (currentImageID.value != null) {\n            windowingStore.updateConfig(viewID.value, currentImageID.value, {\n              width: v,\n            });\n          }\n        }\n      );\n\n      rangeManipulator.setHorizontalListener(\n        horizRange.min,\n        horizRange.max,\n        horizRange.step,\n        () => horizVal.value,\n        (v) => {\n          if (currentImageID.value != null) {\n            windowingStore.updateConfig(viewID.value, currentImageID.value, {\n              level: v,\n            });\n          }\n        }\n      );\n    }\n\n    watch(\n      // Computed wwRange and wlRange are new objects with every mouse movement.\n      // So only updateManipulator() if min/max/step change by comparing with deep equals.\n      () => JSON.stringify({ w: wwRange.value, l: wlRange.value }),\n      updateManipulator,\n      { immediate: true }\n    );\n\n    return () => null;\n  },\n});\n\nexport default function WindowLevelTool(props: Props) {\n  const toolStore = useToolStore();\n  const active = computed(() => toolStore.currentTool === Tools.WindowLevel);\n  return active.value ? h(WindowLevelToolComponent, props) : [];\n}\n</script>\n","<script lang=\"ts\">\nimport {\n  computed,\n  defineComponent,\n  onBeforeUnmount,\n  ref,\n  toRefs,\n  watch,\n} from 'vue';\nimport vtkLPSView2DProxy from '@/src/vtk/LPSView2DProxy';\nimport vtkMouseRangeManipulator from '@kitware/vtk.js/Interaction/Manipulators/MouseRangeManipulator';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { useViewStore } from '@/src/store/views';\nimport useViewSliceStore, {\n  defaultSliceConfig,\n} from '@/src/store/view-configs/slicing';\n\nexport default defineComponent({\n  name: 'SliceScrollTool',\n  props: {\n    viewId: {\n      type: String,\n      required: true,\n    },\n  },\n  setup(props) {\n    const { viewId: viewID } = toRefs(props);\n    const viewSliceStore = useViewSliceStore();\n    const viewStore = useViewStore();\n    const { currentImageID } = useCurrentImage();\n\n    const viewProxy = computed(\n      () => viewStore.getViewProxy<vtkLPSView2DProxy>(viewID.value)!\n    );\n\n    const sliceConfigDefault = defaultSliceConfig();\n    const sliceConfig = computed(() =>\n      viewSliceStore.getConfig(viewID.value, currentImageID.value)\n    );\n    const sliceRange = computed(() => ({\n      min:\n        sliceConfig.value != null\n          ? sliceConfig.value.min\n          : sliceConfigDefault.min,\n      max:\n        sliceConfig.value != null\n          ? sliceConfig.value.max\n          : sliceConfigDefault.max,\n      step: 1,\n      default:\n        sliceConfig.value != null\n          ? sliceConfig.value.slice\n          : sliceConfigDefault.slice,\n    }));\n\n    const scrollVal = ref(0);\n\n    const rangeManipulator = vtkMouseRangeManipulator.newInstance({\n      button: -1, // don't bind to any buttons\n      scrollEnabled: true,\n    });\n\n    watch(\n      viewProxy,\n      (curViewProxy, oldViewProxy) => {\n        if (oldViewProxy) {\n          const istyle = oldViewProxy.getInteractorStyle2D();\n          istyle.removeMouseManipulator(rangeManipulator);\n        }\n\n        if (curViewProxy) {\n          // assumed to be vtkInteractorStyleManipulator\n          const istyle = viewProxy.value.getInteractorStyle2D();\n          istyle.addMouseManipulator(rangeManipulator);\n        }\n      },\n      { immediate: true }\n    );\n\n    onBeforeUnmount(() => {\n      // for some reason, VtkTwoView.onBeforeUnmount is being\n      // invoked before this onBeforeUnmount during HMR.\n      if (!viewProxy.value.isDeleted()) {\n        const istyle = viewProxy.value.getInteractorStyle2D();\n        istyle.removeMouseManipulator(rangeManipulator);\n      }\n    });\n\n    function updateManipulator() {\n      rangeManipulator.removeAllListeners();\n      const range = sliceRange.value;\n\n      rangeManipulator.setScrollListener(\n        range.min,\n        range.max,\n        range.step,\n        () => scrollVal.value,\n        (slice) => {\n          if (currentImageID.value !== null) {\n            viewSliceStore.updateConfig(viewID.value, currentImageID.value, {\n              slice,\n            });\n          }\n        }\n      );\n    }\n\n    watch(\n      sliceRange,\n      (range) => {\n        scrollVal.value = range.default;\n        updateManipulator();\n      },\n      { immediate: true }\n    );\n\n    return () => null;\n  },\n});\n</script>\n","<script lang=\"ts\">\nimport {\n  computed,\n  defineComponent,\n  PropType,\n  onBeforeUnmount,\n  toRefs,\n  watch,\n} from 'vue';\nimport { useViewStore } from '@/src/store/views';\nimport { vtkLPSViewProxy } from '@/src/types/vtk-types';\n\nexport default defineComponent({\n  name: 'MouseManipulatorTool',\n  props: {\n    // only useful for determining the kind of manipulator\n    name: String,\n    viewId: {\n      type: String,\n      required: true,\n    },\n    manipulatorClass: {\n      type: Object,\n      required: true,\n    },\n    options: {\n      type: Array as PropType<Array<any>>,\n      default: () => [],\n    },\n  },\n  setup(props) {\n    const { viewId: viewID, options } = toRefs(props);\n\n    const viewStore = useViewStore();\n    const viewProxy = computed(\n      () => viewStore.getViewProxy<vtkLPSViewProxy>(viewID.value)!\n    );\n\n    const intStyle = computed(() => {\n      return viewProxy.value.isA('vtkView2DProxy')\n        ? viewProxy.value.getInteractorStyle2D()\n        : viewProxy.value.getInteractorStyle3D();\n    });\n\n    const manipulators: any[] = [];\n\n    function updateStyle(\n      style: any,\n      newManipulators: any[],\n      oldManipulators: any[]\n    ) {\n      if (style !== null) {\n        oldManipulators.forEach((m) => style.removeMouseManipulator(m));\n        newManipulators.forEach((m) => style.addMouseManipulator(m));\n      }\n    }\n\n    watch(\n      options,\n      (newOptions) => {\n        // Maintain the size of manipulators array equal to options array.\n        while (manipulators.length > newOptions.length) {\n          const m = manipulators.pop();\n          intStyle.value.removeMouseManipulator(m);\n          m.delete();\n        }\n\n        const oldManipulators = Array.from(manipulators);\n\n        for (let i = manipulators.length; i < newOptions.length; ++i) {\n          manipulators.push(props.manipulatorClass.newInstance(newOptions[i]));\n        }\n\n        newOptions.forEach((opt, idx) => {\n          if ('button' in opt) {\n            manipulators[idx].setButton(opt.button);\n          }\n          manipulators[idx].setShift(!!opt.shift);\n          manipulators[idx].setControl(!!opt.control);\n        });\n\n        updateStyle(intStyle.value, manipulators, oldManipulators);\n      },\n      { immediate: true }\n    );\n\n    watch(\n      intStyle,\n      (curIntStyle, oldIntStyle) => {\n        manipulators.forEach((m) => {\n          if (oldIntStyle) {\n            oldIntStyle.removeMouseManipulator(m);\n          }\n          if (curIntStyle) {\n            curIntStyle.addMouseManipulator(m);\n          }\n        });\n      },\n      { immediate: true }\n    );\n\n    onBeforeUnmount(() => {\n      if (!viewProxy.value.isDeleted()) {\n        manipulators.forEach((m) => intStyle.value.removeMouseManipulator(m));\n      }\n    });\n\n    return () => null;\n  },\n});\n</script>\n","<script lang=\"ts\">\nimport { h } from 'vue';\nimport vtkMouseCameraTrackballPanManipulator from '@kitware/vtk.js/Interaction/Manipulators/MouseCameraTrackballPanManipulator';\nimport { useToolStore } from '@/src/store/tools';\nimport { Tools } from '@/src/store/tools/types';\nimport MouseManipulatorTool from './MouseManipulatorTool.vue';\n\ninterface Props {\n  viewId: string;\n}\n\nexport default function PanTool(props: Props) {\n  const toolStore = useToolStore();\n  const toolOptions = [];\n  toolOptions.push({ button: 2 });\n  toolOptions.push({ button: 1, shift: true });\n  if (toolStore.currentTool === Tools.Pan) {\n    // Additionally enable left-button-only action if Pan tool is active\n    toolOptions.push({ button: 1 });\n  }\n\n  return h(MouseManipulatorTool, {\n    ...props,\n    name: 'PanTool',\n    manipulatorClass: vtkMouseCameraTrackballPanManipulator,\n    options: toolOptions,\n  });\n}\n</script>\n","<script lang=\"ts\">\nimport { h } from 'vue';\nimport vtkMouseCameraTrackballZoomToMouseManipulator from '@kitware/vtk.js/Interaction/Manipulators/MouseCameraTrackballZoomToMouseManipulator';\nimport { useToolStore } from '@/src/store/tools';\nimport { Tools } from '@/src/store/tools/types';\nimport MouseManipulatorTool from './MouseManipulatorTool.vue';\n\ninterface Props {\n  viewId: string;\n}\n\nexport default function ZoomTool(props: Props) {\n  const toolStore = useToolStore();\n  const toolOptions = [];\n  toolOptions.push({ button: 3, flipDirection: true });\n  toolOptions.push({ button: 1, control: true, flipDirection: true });\n  if (toolStore.currentTool === Tools.Zoom) {\n    // Additionally enable left-button-only action if Zoom tool is active\n    toolOptions.push({ button: 1, flipDirection: true });\n  }\n\n  return h(MouseManipulatorTool, {\n    ...props,\n    name: 'ZoomTool',\n    manipulatorClass: vtkMouseCameraTrackballZoomToMouseManipulator,\n    options: toolOptions,\n  });\n}\n</script>\n","import macro from '@kitware/vtk.js/macro';\nimport type { Vector3 } from '@kitware/vtk.js/types';\n\nexport enum InteractionState {\n  PlacingFirst = 'PlacingFirst',\n  PlacingSecond = 'PlacingSecond',\n  Select = 'Select',\n  Dragging = 'Dragging',\n}\n\nexport function shouldIgnoreEvent(e: any) {\n  return e.altKey || e.controlKey || e.shiftKey;\n}\n\nexport default function widgetBehavior(publicAPI: any, model: any) {\n  model.classHierarchy.push('vtkRulerWidgetProp');\n\n  model.interactionState = InteractionState.Select;\n  let draggingState: any = null;\n\n  macro.setGet(publicAPI, model, ['interactionState']);\n  // support setting per-view widget manipulators\n  macro.setGet(publicAPI, model, ['manipulator']);\n  // support forwarding events\n  macro.event(publicAPI, model, 'RightClickEvent');\n  macro.event(publicAPI, model, 'PlacedEvent');\n\n  publicAPI.deactivateAllHandles = () => {\n    model.widgetState.deactivate();\n    model.activeState = null;\n  };\n\n  publicAPI.setFirstPoint = (coord: Vector3) => {\n    const point = model.widgetState.getFirstPoint();\n    point.setOrigin(coord);\n  };\n\n  publicAPI.setSecondPoint = (coord: Vector3) => {\n    const point = model.widgetState.getSecondPoint();\n    point.setOrigin(coord);\n  };\n\n  const originalSetInteractionState = publicAPI.setInteractionState;\n  publicAPI.setInteractionState = (state: InteractionState) => {\n    const changed = originalSetInteractionState(state);\n    if (changed && state === InteractionState.PlacingFirst) {\n      model.widgetState.setIsPlaced(false);\n      model.widgetState.getFirstPoint().setVisible(false);\n      model.widgetState.getSecondPoint().setVisible(false);\n    }\n    return changed;\n  };\n\n  publicAPI.resetInteractions = () => {\n    model._interactor.cancelAnimation(publicAPI, true);\n  };\n\n  /**\n   * Places or drags a point.\n   */\n  publicAPI.handleLeftButtonPress = (eventData: any) => {\n    if (!model.manipulator || shouldIgnoreEvent(eventData)) {\n      return macro.VOID;\n    }\n\n    // This ruler widget is passive, so if another widget\n    // is active, we don't do anything.\n    const activeWidget = model._widgetManager.getActiveWidget();\n    if (activeWidget && activeWidget !== publicAPI) {\n      return macro.VOID;\n    }\n\n    const worldCoords = model.manipulator.handleEvent(\n      eventData,\n      model._apiSpecificRenderWindow\n    );\n    if (!worldCoords.length) {\n      return macro.VOID;\n    }\n\n    const intState = publicAPI.getInteractionState();\n\n    if (intState === InteractionState.PlacingFirst) {\n      publicAPI.setFirstPoint(worldCoords);\n      publicAPI.setSecondPoint(worldCoords);\n      model.widgetState.getFirstPoint().setVisible(true);\n      model.widgetState.getSecondPoint().setVisible(true);\n\n      model._interactor.requestAnimation(publicAPI);\n      publicAPI.invokeStartInteractionEvent();\n      publicAPI.setInteractionState(InteractionState.PlacingSecond);\n      return macro.EVENT_ABORT;\n    }\n\n    if (intState === InteractionState.PlacingSecond) {\n      publicAPI.setSecondPoint(worldCoords);\n      model.widgetState.setIsPlaced(true);\n\n      publicAPI.setInteractionState(InteractionState.Select);\n      publicAPI.invokeEndInteractionEvent();\n      publicAPI.invokePlacedEvent();\n\n      model._interactor.cancelAnimation(publicAPI);\n      return macro.EVENT_ABORT;\n    }\n\n    // dragging\n    if (model.activeState?.getActive() && model.pickable) {\n      draggingState = model.activeState;\n      publicAPI.setInteractionState(InteractionState.Dragging);\n      model._apiSpecificRenderWindow.setCursor('grabbing');\n      model._interactor.requestAnimation(publicAPI);\n      publicAPI.invokeStartInteractionEvent();\n      return macro.EVENT_ABORT;\n    }\n\n    return macro.VOID;\n  };\n\n  /**\n   * Moves a point around.\n   */\n  publicAPI.handleMouseMove = (eventData: any) => {\n    const worldCoords = model.manipulator.handleEvent(\n      eventData,\n      model._apiSpecificRenderWindow\n    );\n    if (!worldCoords.length) {\n      return macro.VOID;\n    }\n\n    const intState = publicAPI.getInteractionState();\n\n    if (intState === InteractionState.PlacingSecond) {\n      model.widgetState.getSecondPoint().setOrigin(worldCoords);\n      // show second point during placement\n      model.widgetState.getSecondPoint().setVisible(true);\n      publicAPI.invokeInteractionEvent();\n      return macro.EVENT_ABORT;\n    }\n\n    if (\n      publicAPI.getInteractionState() === InteractionState.Dragging &&\n      draggingState\n    ) {\n      draggingState.setOrigin(worldCoords);\n      publicAPI.invokeInteractionEvent();\n      return macro.EVENT_ABORT;\n    }\n\n    return macro.VOID;\n  };\n\n  /**\n   * Finishes dragging\n   */\n  publicAPI.handleLeftButtonRelease = (eventData: any) => {\n    if (draggingState) {\n      const worldCoords = model.manipulator.handleEvent(\n        eventData,\n        model._apiSpecificRenderWindow\n      );\n      if (worldCoords.length) {\n        draggingState.setOrigin(worldCoords);\n      }\n\n      draggingState = null;\n      publicAPI.setInteractionState(InteractionState.Select);\n      model._apiSpecificRenderWindow.setCursor('pointer');\n      model.widgetState.deactivate();\n      model._interactor.cancelAnimation(publicAPI);\n      publicAPI.invokeEndInteractionEvent();\n      model._widgetManager.enablePicking();\n    }\n  };\n\n  publicAPI.handleRightButtonPress = (eventData: any) => {\n    if (\n      shouldIgnoreEvent(eventData) ||\n      publicAPI.getInteractionState() !== InteractionState.Select ||\n      !model.activeState\n    ) {\n      return macro.VOID;\n    }\n    publicAPI.invokeRightClickEvent(eventData);\n    return macro.EVENT_ABORT;\n  };\n\n  publicAPI.grabFocus = () => {\n    throw new Error('grabFocus is not implemented');\n  };\n\n  publicAPI.loseFocus = () => {\n    throw new Error('loseFocus is not implemented');\n  };\n}\n","import macro from '@kitware/vtk.js/macros';\nimport vtkWidgetState from '@kitware/vtk.js/Widgets/Core/WidgetState';\nimport visibleMixin from '@kitware/vtk.js/Widgets/Core/StateBuilder/visibleMixin';\nimport scale1Mixin from '@kitware/vtk.js/Widgets/Core/StateBuilder/scale1Mixin';\n\nconst PIXEL_SIZE = 20;\n\nfunction watchStore(publicAPI, store, getter, cmp) {\n  let cached = getter();\n  const unsubscribe = store.$subscribe(() => {\n    const val = getter();\n    if (cmp ? cmp(cached, val) : cached !== val) {\n      cached = val;\n      publicAPI.modified();\n    }\n  });\n\n  const originalDelete = publicAPI.delete;\n  publicAPI.delete = () => {\n    unsubscribe();\n    originalDelete();\n  };\n}\n\nfunction _createPointState(\n  publicAPI,\n  model,\n  { id, store, key, visible = true }\n) {\n  Object.assign(model, {\n    id,\n    _store: store,\n    key,\n  });\n  vtkWidgetState.extend(publicAPI, model, {});\n  visibleMixin.extend(publicAPI, model, { visible });\n  scale1Mixin.extend(publicAPI, model, { scale1: PIXEL_SIZE });\n\n  const getRuler = () => {\n    return model._store.rulerByID[model.id];\n  };\n\n  const updateRuler = (patch) => model._store.updateRuler(model.id, patch);\n\n  publicAPI.getOrigin = () => {\n    return getRuler()?.[model.key];\n  };\n\n  publicAPI.setOrigin = (xyz) => {\n    updateRuler({\n      [model.key]: xyz,\n    });\n    publicAPI.modified();\n  };\n\n  watchStore(publicAPI, model._store, () => getRuler()?.[model.key]);\n}\n\nconst createPointState = macro.newInstance(\n  _createPointState,\n  'vtkRulerWidgetStatePoint'\n);\n\nexport default createPointState;\n","import macro from '@kitware/vtk.js/macros';\nimport vtkWidgetState from '@kitware/vtk.js/Widgets/Core/WidgetState';\nimport bounds from '@kitware/vtk.js/Widgets/Core/StateBuilder/boundsMixin';\n\nimport createPointState from './pointState';\n\nexport const PointsLabel = 'points';\n\nfunction watchState(publicAPI: any, state: any, callback: () => {}) {\n  let subscription = state.onModified(callback);\n  const originalDelete = publicAPI.delete;\n  publicAPI.delete = () => {\n    subscription.unsubscribe();\n    subscription = null;\n    originalDelete();\n  };\n}\n\nfunction vtkRulerWidgetState(publicAPI: any, model: any) {\n  const firstPoint = createPointState({\n    id: model.id,\n    store: model._store,\n    key: 'firstPoint',\n    visible: true,\n  });\n  const secondPoint = createPointState({\n    id: model.id,\n    store: model._store,\n    key: 'secondPoint',\n    visible: true,\n  });\n\n  watchState(publicAPI, firstPoint, () => publicAPI.modified());\n  watchState(publicAPI, secondPoint, () => publicAPI.modified());\n\n  model.labels = {\n    [PointsLabel]: [firstPoint, secondPoint],\n  };\n\n  publicAPI.getFirstPoint = () => firstPoint;\n  publicAPI.getSecondPoint = () => secondPoint;\n}\n\nconst defaultValues = (initialValues: any) => ({\n  isPlaced: false,\n  ...initialValues,\n});\n\nfunction _createRulerWidgetState(\n  publicAPI: any,\n  model: any,\n  initialValues: any\n) {\n  Object.assign(model, defaultValues(initialValues));\n  vtkWidgetState.extend(publicAPI, model, initialValues);\n  bounds.extend(publicAPI, model);\n\n  macro.get(publicAPI, model, ['id']);\n  macro.setGet(publicAPI, model, ['isPlaced']);\n  macro.moveToProtected(publicAPI, model, ['store']);\n\n  vtkRulerWidgetState(publicAPI, model);\n}\n\nconst createRulerWidgetState = macro.newInstance(\n  _createRulerWidgetState,\n  'vtkRulerWidgetState'\n);\n\nexport default createRulerWidgetState;\n","import macro from '@kitware/vtk.js/macro';\nimport vtkAbstractWidgetFactory from '@kitware/vtk.js/Widgets/Core/AbstractWidgetFactory';\nimport vtkPlanePointManipulator from '@kitware/vtk.js/Widgets/Manipulators/PlaneManipulator';\nimport vtkSphereHandleRepresentation from '@kitware/vtk.js/Widgets/Representations/SphereHandleRepresentation';\nimport { distance2BetweenPoints } from '@kitware/vtk.js/Common/Core/Math';\n\nimport widgetBehavior from './behavior';\nimport stateGenerator, { PointsLabel } from './state';\n\nexport { InteractionState } from './behavior';\n\n// ----------------------------------------------------------------------------\n// Factory\n// ----------------------------------------------------------------------------\n\nfunction vtkRulerWidget(publicAPI, model) {\n  model.classHierarchy.push('vtkRulerWidget');\n\n  // --- Widget Requirement ---------------------------------------------------\n\n  publicAPI.getRepresentationsForViewType = () => [\n    {\n      builder: vtkSphereHandleRepresentation,\n      labels: [PointsLabel],\n      initialValues: {\n        scaleInPixels: true,\n      },\n    },\n  ];\n\n  publicAPI.getLength = () => {\n    const first = model.widgetState.getFirstPoint().getOrigin();\n    const second = model.widgetState.getSecondPoint().getOrigin();\n    if (!first || !second) {\n      return 0;\n    }\n    return Math.sqrt(distance2BetweenPoints(first, second));\n  };\n\n  // Default manipulator\n  model.manipulator = vtkPlanePointManipulator.newInstance();\n}\n\n// ----------------------------------------------------------------------------\n\nconst DEFAULT_VALUES = {};\n\n// ----------------------------------------------------------------------------\n\nexport function extend(publicAPI, model, initialValues = {}) {\n  Object.assign(model, DEFAULT_VALUES, initialValues);\n\n  vtkAbstractWidgetFactory.extend(publicAPI, model, {\n    ...initialValues,\n    behavior: widgetBehavior,\n    widgetState: stateGenerator(initialValues),\n  });\n  macro.get(publicAPI, model, ['manipulator']);\n\n  vtkRulerWidget(publicAPI, model);\n}\n\n// ----------------------------------------------------------------------------\n\nexport const newInstance = macro.newInstance(extend, 'vtkRulerWidget');\n\n// ----------------------------------------------------------------------------\n\nexport default { newInstance, extend };\n","import type { Vector3 } from '@kitware/vtk.js/types';\nimport vtkPlaneManipulator from '@kitware/vtk.js/Widgets/Manipulators/PlaneManipulator';\nimport { vec3 } from 'gl-matrix';\nimport { ImageMetadata } from '../types/image';\nimport { LPSAxisDir } from '../types/lps';\nimport { getLPSAxisFromDir } from './lps';\n\nexport function updatePlaneManipulatorFor2DView(\n  manipulator: vtkPlaneManipulator,\n  viewDir: LPSAxisDir,\n  slice: number,\n  imageMetadata: ImageMetadata\n) {\n  const { lpsOrientation } = imageMetadata;\n  const axis = lpsOrientation[getLPSAxisFromDir(viewDir)];\n\n  const normal: vec3 = lpsOrientation[viewDir];\n  const origin: vec3 = [0, 0, 0];\n  origin[axis] = slice;\n\n  vec3.transformMat4(origin, origin, imageMetadata.indexToWorld);\n\n  manipulator.setUserNormal(normal as Vector3);\n  manipulator.setUserOrigin(origin as Vector3);\n}\n\nexport function createPlaneManipulatorFor2DView(\n  viewDir: LPSAxisDir,\n  slice: number,\n  imageMetadata: ImageMetadata\n) {\n  const manipulator = vtkPlaneManipulator.newInstance();\n  updatePlaneManipulatorFor2DView(manipulator, viewDir, slice, imageMetadata);\n  return manipulator;\n}\n","<template>\n  <g>\n    <line\n      v-if=\"first && second\"\n      :x1=\"first.x\"\n      :y1=\"first.y\"\n      :x2=\"second.x\"\n      :y2=\"second.y\"\n      :stroke=\"color\"\n      stroke-width=\"1\"\n    />\n    <!-- radius is related to the vtkRulerWidget scale, specified in state -->\n    <circle\n      v-if=\"first\"\n      :cx=\"first.x\"\n      :cy=\"first.y\"\n      :stroke=\"color\"\n      stroke-width=\"1\"\n      fill=\"transparent\"\n      :r=\"10 / devicePixelRatio\"\n    />\n    <circle\n      v-if=\"second\"\n      :cx=\"second.x\"\n      :cy=\"second.y\"\n      :stroke=\"color\"\n      stroke-width=\"1\"\n      fill=\"transparent\"\n      :r=\"10 / devicePixelRatio\"\n      class=\"handle\"\n    />\n    <text\n      v-if=\"second\"\n      :x=\"second.x\"\n      :y=\"second.y\"\n      :dx=\"textdx\"\n      :dy=\"textdy\"\n      :text-anchor=\"anchor\"\n      stroke-width=\"0.75\"\n      stroke=\"black\"\n      fill=\"white\"\n      :font-size=\"`${textSize}px`\"\n      font-weight=\"bold\"\n    >\n      {{ rulerLength }}\n    </text>\n  </g>\n</template>\n\n<script lang=\"ts\">\nimport { useResizeObserver } from '@/src/composables/useResizeObserver';\nimport { useVTKCallback } from '@/src/composables/useVTKCallback';\nimport { ToolContainer } from '@/src/constants';\nimport { useViewStore } from '@/src/store/views';\nimport { worldToSVG } from '@/src/utils/vtk-helpers';\nimport vtkLPSView2DProxy from '@/src/vtk/LPSView2DProxy';\nimport type { Vector3 } from '@kitware/vtk.js/types';\nimport {\n  PropType,\n  computed,\n  defineComponent,\n  toRefs,\n  unref,\n  ref,\n  watch,\n  inject,\n} from 'vue';\n\ntype SVGPoint = {\n  x: number;\n  y: number;\n};\n\nexport default defineComponent({\n  props: {\n    point1: Array as PropType<Array<number>>,\n    point2: Array as PropType<Array<number>>,\n    color: String,\n    length: Number,\n    viewId: {\n      type: String,\n      required: true,\n    },\n    textOffset: {\n      type: Number,\n      default: 8,\n    },\n    textSize: {\n      type: Number,\n      default: 14,\n    },\n  },\n  setup(props) {\n    const {\n      viewId: viewID,\n      point1,\n      point2,\n      textOffset,\n      length,\n    } = toRefs(props);\n    const firstPoint = ref<SVGPoint | null>();\n    const secondPoint = ref<SVGPoint | null>();\n\n    const viewStore = useViewStore();\n\n    const viewProxy = computed(\n      () => viewStore.getViewProxy<vtkLPSView2DProxy>(viewID.value)!\n    );\n\n    const updatePoints = () => {\n      const viewRenderer = viewProxy.value.getRenderer();\n      const pt1 = unref(point1) as Vector3 | undefined;\n      const pt2 = unref(point2) as Vector3 | undefined;\n      if (pt1) {\n        const point2D = worldToSVG(pt1, viewRenderer);\n        if (point2D) {\n          firstPoint.value = {\n            x: point2D[0],\n            y: point2D[1],\n          };\n        }\n      } else {\n        firstPoint.value = null;\n      }\n\n      if (pt2) {\n        const point2D = worldToSVG(pt2, viewRenderer);\n        if (point2D) {\n          secondPoint.value = {\n            x: point2D[0],\n            y: point2D[1],\n          };\n        }\n      } else {\n        secondPoint.value = null;\n      }\n    };\n\n    const cameraOnModified = useVTKCallback(\n      computed(() => viewProxy.value.getCamera().onModified)\n    );\n    cameraOnModified(updatePoints);\n\n    watch([viewProxy, point1, point2], updatePoints, {\n      deep: true,\n      immediate: true,\n    });\n\n    const textProperties = computed(() => {\n      const first = unref(firstPoint);\n      const second = unref(secondPoint);\n      const offset = textOffset.value;\n      if (!first || !second) {\n        return null;\n      }\n      if (second.x > first.x) {\n        return { dx: offset, dy: -offset, anchor: 'start' };\n      }\n      return { dx: -offset, dy: -offset, anchor: 'end' };\n    });\n\n    // --- resize --- //\n\n    const containerEl = inject(ToolContainer)!;\n\n    useResizeObserver(containerEl, () => {\n      updatePoints();\n    });\n\n    return {\n      devicePixelRatio,\n      textdx: computed(() => textProperties.value?.dx ?? 0),\n      textdy: computed(() => textProperties.value?.dy ?? 0),\n      anchor: computed(() => textProperties.value?.anchor ?? 'start'),\n      first: firstPoint,\n      second: secondPoint,\n      rulerLength: computed(() => length?.value?.toFixed(2) ?? ''),\n    };\n  },\n});\n</script>\n\n<style scoped>\n.handle {\n  cursor: pointer;\n}\n</style>\n","<template>\n  <g>\n    <line\n      v-if=\"first && second\"\n      :x1=\"first.x\"\n      :y1=\"first.y\"\n      :x2=\"second.x\"\n      :y2=\"second.y\"\n      :stroke=\"color\"\n      stroke-width=\"1\"\n    />\n    <!-- radius is related to the vtkRulerWidget scale, specified in state -->\n    <circle\n      v-if=\"first\"\n      :cx=\"first.x\"\n      :cy=\"first.y\"\n      :stroke=\"color\"\n      stroke-width=\"1\"\n      fill=\"transparent\"\n      :r=\"10 / devicePixelRatio\"\n    />\n    <circle\n      v-if=\"second\"\n      :cx=\"second.x\"\n      :cy=\"second.y\"\n      :stroke=\"color\"\n      stroke-width=\"1\"\n      fill=\"transparent\"\n      :r=\"10 / devicePixelRatio\"\n      class=\"handle\"\n    />\n    <text\n      v-if=\"second\"\n      :x=\"second.x\"\n      :y=\"second.y\"\n      :dx=\"textdx\"\n      :dy=\"textdy\"\n      :text-anchor=\"anchor\"\n      stroke-width=\"0.75\"\n      stroke=\"black\"\n      fill=\"white\"\n      :font-size=\"`${textSize}px`\"\n      font-weight=\"bold\"\n    >\n      {{ rulerLength }}\n    </text>\n  </g>\n</template>\n\n<script lang=\"ts\">\nimport { useResizeObserver } from '@/src/composables/useResizeObserver';\nimport { useVTKCallback } from '@/src/composables/useVTKCallback';\nimport { ToolContainer } from '@/src/constants';\nimport { useViewStore } from '@/src/store/views';\nimport { worldToSVG } from '@/src/utils/vtk-helpers';\nimport vtkLPSView2DProxy from '@/src/vtk/LPSView2DProxy';\nimport type { Vector3 } from '@kitware/vtk.js/types';\nimport {\n  PropType,\n  computed,\n  defineComponent,\n  toRefs,\n  unref,\n  ref,\n  watch,\n  inject,\n} from 'vue';\n\ntype SVGPoint = {\n  x: number;\n  y: number;\n};\n\nexport default defineComponent({\n  props: {\n    point1: Array as PropType<Array<number>>,\n    point2: Array as PropType<Array<number>>,\n    color: String,\n    length: Number,\n    viewId: {\n      type: String,\n      required: true,\n    },\n    textOffset: {\n      type: Number,\n      default: 8,\n    },\n    textSize: {\n      type: Number,\n      default: 14,\n    },\n  },\n  setup(props) {\n    const {\n      viewId: viewID,\n      point1,\n      point2,\n      textOffset,\n      length,\n    } = toRefs(props);\n    const firstPoint = ref<SVGPoint | null>();\n    const secondPoint = ref<SVGPoint | null>();\n\n    const viewStore = useViewStore();\n\n    const viewProxy = computed(\n      () => viewStore.getViewProxy<vtkLPSView2DProxy>(viewID.value)!\n    );\n\n    const updatePoints = () => {\n      const viewRenderer = viewProxy.value.getRenderer();\n      const pt1 = unref(point1) as Vector3 | undefined;\n      const pt2 = unref(point2) as Vector3 | undefined;\n      if (pt1) {\n        const point2D = worldToSVG(pt1, viewRenderer);\n        if (point2D) {\n          firstPoint.value = {\n            x: point2D[0],\n            y: point2D[1],\n          };\n        }\n      } else {\n        firstPoint.value = null;\n      }\n\n      if (pt2) {\n        const point2D = worldToSVG(pt2, viewRenderer);\n        if (point2D) {\n          secondPoint.value = {\n            x: point2D[0],\n            y: point2D[1],\n          };\n        }\n      } else {\n        secondPoint.value = null;\n      }\n    };\n\n    const cameraOnModified = useVTKCallback(\n      computed(() => viewProxy.value.getCamera().onModified)\n    );\n    cameraOnModified(updatePoints);\n\n    watch([viewProxy, point1, point2], updatePoints, {\n      deep: true,\n      immediate: true,\n    });\n\n    const textProperties = computed(() => {\n      const first = unref(firstPoint);\n      const second = unref(secondPoint);\n      const offset = textOffset.value;\n      if (!first || !second) {\n        return null;\n      }\n      if (second.x > first.x) {\n        return { dx: offset, dy: -offset, anchor: 'start' };\n      }\n      return { dx: -offset, dy: -offset, anchor: 'end' };\n    });\n\n    // --- resize --- //\n\n    const containerEl = inject(ToolContainer)!;\n\n    useResizeObserver(containerEl, () => {\n      updatePoints();\n    });\n\n    return {\n      devicePixelRatio,\n      textdx: computed(() => textProperties.value?.dx ?? 0),\n      textdy: computed(() => textProperties.value?.dy ?? 0),\n      anchor: computed(() => textProperties.value?.anchor ?? 'start'),\n      first: firstPoint,\n      second: secondPoint,\n      rulerLength: computed(() => length?.value?.toFixed(2) ?? ''),\n    };\n  },\n});\n</script>\n\n<style scoped>\n.handle {\n  cursor: pointer;\n}\n</style>\n","<script lang=\"ts\">\nimport vtkRulerWidget, {\n  InteractionState,\n  vtkRulerViewWidget,\n  vtkRulerWidgetPointState,\n} from '@/src/vtk/RulerWidget';\nimport vtkWidgetManager from '@kitware/vtk.js/Widgets/Core/WidgetManager';\nimport {\n  computed,\n  defineComponent,\n  onBeforeUnmount,\n  onMounted,\n  onUnmounted,\n  PropType,\n  Ref,\n  ref,\n  toRefs,\n  watch,\n  watchEffect,\n} from 'vue';\nimport vtkPlaneManipulator from '@kitware/vtk.js/Widgets/Manipulators/PlaneManipulator';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { updatePlaneManipulatorFor2DView } from '@/src/utils/manipulators';\nimport type { vtkSubscription } from '@kitware/vtk.js/interfaces';\nimport { getCSSCoordinatesFromEvent } from '@/src/utils/vtk-helpers';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport { useRulerStore } from '@/src/store/tools/rulers';\nimport { useVTKCallback } from '@/src/composables/useVTKCallback';\nimport RulerSVG2D from '@/src/components/tools/ruler/RulerSVG2D.vue';\nimport { watchOnce } from '@vueuse/core';\n\nexport default defineComponent({\n  name: 'RulerWidget2D',\n  emits: ['placed', 'contextmenu'],\n  props: {\n    rulerId: {\n      type: String,\n      required: true,\n    },\n    widgetManager: {\n      type: Object as PropType<vtkWidgetManager>,\n      required: true,\n    },\n    viewId: {\n      type: String,\n      required: true,\n    },\n    viewDirection: {\n      type: String as PropType<LPSAxisDir>,\n      required: true,\n    },\n    currentSlice: {\n      type: Number,\n      required: true,\n    },\n    isPlacing: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  components: {\n    RulerSVG2D,\n  },\n  setup(props, { emit }) {\n    const { rulerId, widgetManager, viewDirection, currentSlice, isPlacing } =\n      toRefs(props);\n\n    const rulerStore = useRulerStore();\n    const ruler = computed(() => rulerStore.rulerByID[rulerId.value]);\n    const { currentImageID, currentImageMetadata } = useCurrentImage();\n\n    const widgetFactory = vtkRulerWidget.newInstance({\n      id: rulerId.value,\n      store: rulerStore,\n      isPlaced: !isPlacing.value,\n    });\n    const widget = ref<vtkRulerViewWidget | null>(null);\n\n    onMounted(() => {\n      widget.value = widgetManager.value.addWidget(\n        widgetFactory\n      ) as vtkRulerViewWidget;\n    });\n\n    onUnmounted(() => {\n      if (!widget.value) {\n        return;\n      }\n      widgetManager.value.removeWidget(widget.value);\n      widget.value.delete();\n      widgetFactory.delete();\n    });\n\n    watch(\n      [isPlacing, widget],\n      ([placing, widget_]) => {\n        if (placing && widget_) {\n          widget_.setInteractionState(InteractionState.PlacingFirst);\n        }\n      },\n      { immediate: true }\n    );\n\n    // --- reset on slice/image changes --- //\n\n    watch([currentSlice, currentImageID, widget], () => {\n      const isPlaced = widget.value?.getWidgetState().getIsPlaced();\n      if (widget.value && !isPlaced) {\n        widget.value.resetInteractions();\n        widget.value.setInteractionState(InteractionState.PlacingFirst);\n      }\n    });\n\n    // --- placed event --- //\n\n    const onPlacedEvent = useVTKCallback(\n      computed(() => widget.value?.onPlacedEvent)\n    );\n\n    onPlacedEvent(() => {\n      emit('placed');\n    });\n\n    // --- right click handling --- //\n\n    let rightClickSub: vtkSubscription | null = null;\n\n    onMounted(() => {\n      if (!widget.value) {\n        return;\n      }\n      rightClickSub = widget.value.onRightClickEvent((eventData) => {\n        const coords = getCSSCoordinatesFromEvent(eventData);\n        if (coords) {\n          emit('contextmenu', coords);\n        }\n      });\n    });\n\n    onBeforeUnmount(() => {\n      if (rightClickSub) {\n        rightClickSub.unsubscribe();\n        rightClickSub = null;\n      }\n    });\n\n    // --- manipulator --- //\n\n    const manipulator = vtkPlaneManipulator.newInstance();\n\n    onMounted(() => {\n      if (!widget.value) {\n        return;\n      }\n      widget.value.setManipulator(manipulator);\n    });\n\n    watchEffect(() => {\n      updatePlaneManipulatorFor2DView(\n        manipulator,\n        viewDirection.value,\n        ruler.value?.slice ?? currentSlice.value,\n        currentImageMetadata.value\n      );\n    });\n\n    // --- visibility --- //\n\n    // toggles the pickability of the ruler handles,\n    // since the 3D ruler parts are visually hidden.\n    watch(\n      () => !!widget.value && ruler.value?.slice === currentSlice.value,\n      (visible) => {\n        widget.value?.setVisibility(visible);\n      },\n      { immediate: true }\n    );\n\n    onMounted(() => {\n      if (!widget.value) {\n        return;\n      }\n      // hide handle visibility, but not picking visibility\n      widget.value.setHandleVisibility(false);\n      widgetManager.value.renderWidgets();\n    });\n\n    // --- handle pick visibility --- //\n\n    const usePointVisibility = (\n      pointState: Ref<vtkRulerWidgetPointState | undefined>\n    ) => {\n      const visible = ref(false);\n      const updateVisibility = () => {\n        if (!pointState.value) return;\n        visible.value = pointState.value.getVisible();\n      };\n\n      const onModified = useVTKCallback(\n        computed(() => pointState.value?.onModified)\n      );\n      onModified(() => updateVisibility());\n\n      watchOnce(pointState, () => updateVisibility());\n\n      return visible;\n    };\n\n    const firstPointVisible = usePointVisibility(\n      computed(() => widget.value?.getWidgetState().getFirstPoint())\n    );\n    const secondPointVisible = usePointVisibility(\n      computed(() => widget.value?.getWidgetState().getSecondPoint())\n    );\n\n    return {\n      ruler,\n      firstPoint: computed(() => {\n        return firstPointVisible.value ? ruler.value.firstPoint : undefined;\n      }),\n      secondPoint: computed(() => {\n        return secondPointVisible.value ? ruler.value.secondPoint : undefined;\n      }),\n      length: computed(() => rulerStore.lengthByID[ruler.value.id]),\n    };\n  },\n});\n</script>\n\n<template>\n  <RulerSVG2D\n    v-show=\"currentSlice === ruler.slice\"\n    :view-id=\"viewId\"\n    :point1=\"firstPoint\"\n    :point2=\"secondPoint\"\n    :color=\"ruler.color\"\n    :length=\"length\"\n  />\n</template>\n","<script lang=\"ts\">\nimport vtkRulerWidget, {\n  InteractionState,\n  vtkRulerViewWidget,\n  vtkRulerWidgetPointState,\n} from '@/src/vtk/RulerWidget';\nimport vtkWidgetManager from '@kitware/vtk.js/Widgets/Core/WidgetManager';\nimport {\n  computed,\n  defineComponent,\n  onBeforeUnmount,\n  onMounted,\n  onUnmounted,\n  PropType,\n  Ref,\n  ref,\n  toRefs,\n  watch,\n  watchEffect,\n} from 'vue';\nimport vtkPlaneManipulator from '@kitware/vtk.js/Widgets/Manipulators/PlaneManipulator';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { updatePlaneManipulatorFor2DView } from '@/src/utils/manipulators';\nimport type { vtkSubscription } from '@kitware/vtk.js/interfaces';\nimport { getCSSCoordinatesFromEvent } from '@/src/utils/vtk-helpers';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport { useRulerStore } from '@/src/store/tools/rulers';\nimport { useVTKCallback } from '@/src/composables/useVTKCallback';\nimport RulerSVG2D from '@/src/components/tools/ruler/RulerSVG2D.vue';\nimport { watchOnce } from '@vueuse/core';\n\nexport default defineComponent({\n  name: 'RulerWidget2D',\n  emits: ['placed', 'contextmenu'],\n  props: {\n    rulerId: {\n      type: String,\n      required: true,\n    },\n    widgetManager: {\n      type: Object as PropType<vtkWidgetManager>,\n      required: true,\n    },\n    viewId: {\n      type: String,\n      required: true,\n    },\n    viewDirection: {\n      type: String as PropType<LPSAxisDir>,\n      required: true,\n    },\n    currentSlice: {\n      type: Number,\n      required: true,\n    },\n    isPlacing: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  components: {\n    RulerSVG2D,\n  },\n  setup(props, { emit }) {\n    const { rulerId, widgetManager, viewDirection, currentSlice, isPlacing } =\n      toRefs(props);\n\n    const rulerStore = useRulerStore();\n    const ruler = computed(() => rulerStore.rulerByID[rulerId.value]);\n    const { currentImageID, currentImageMetadata } = useCurrentImage();\n\n    const widgetFactory = vtkRulerWidget.newInstance({\n      id: rulerId.value,\n      store: rulerStore,\n      isPlaced: !isPlacing.value,\n    });\n    const widget = ref<vtkRulerViewWidget | null>(null);\n\n    onMounted(() => {\n      widget.value = widgetManager.value.addWidget(\n        widgetFactory\n      ) as vtkRulerViewWidget;\n    });\n\n    onUnmounted(() => {\n      if (!widget.value) {\n        return;\n      }\n      widgetManager.value.removeWidget(widget.value);\n      widget.value.delete();\n      widgetFactory.delete();\n    });\n\n    watch(\n      [isPlacing, widget],\n      ([placing, widget_]) => {\n        if (placing && widget_) {\n          widget_.setInteractionState(InteractionState.PlacingFirst);\n        }\n      },\n      { immediate: true }\n    );\n\n    // --- reset on slice/image changes --- //\n\n    watch([currentSlice, currentImageID, widget], () => {\n      const isPlaced = widget.value?.getWidgetState().getIsPlaced();\n      if (widget.value && !isPlaced) {\n        widget.value.resetInteractions();\n        widget.value.setInteractionState(InteractionState.PlacingFirst);\n      }\n    });\n\n    // --- placed event --- //\n\n    const onPlacedEvent = useVTKCallback(\n      computed(() => widget.value?.onPlacedEvent)\n    );\n\n    onPlacedEvent(() => {\n      emit('placed');\n    });\n\n    // --- right click handling --- //\n\n    let rightClickSub: vtkSubscription | null = null;\n\n    onMounted(() => {\n      if (!widget.value) {\n        return;\n      }\n      rightClickSub = widget.value.onRightClickEvent((eventData) => {\n        const coords = getCSSCoordinatesFromEvent(eventData);\n        if (coords) {\n          emit('contextmenu', coords);\n        }\n      });\n    });\n\n    onBeforeUnmount(() => {\n      if (rightClickSub) {\n        rightClickSub.unsubscribe();\n        rightClickSub = null;\n      }\n    });\n\n    // --- manipulator --- //\n\n    const manipulator = vtkPlaneManipulator.newInstance();\n\n    onMounted(() => {\n      if (!widget.value) {\n        return;\n      }\n      widget.value.setManipulator(manipulator);\n    });\n\n    watchEffect(() => {\n      updatePlaneManipulatorFor2DView(\n        manipulator,\n        viewDirection.value,\n        ruler.value?.slice ?? currentSlice.value,\n        currentImageMetadata.value\n      );\n    });\n\n    // --- visibility --- //\n\n    // toggles the pickability of the ruler handles,\n    // since the 3D ruler parts are visually hidden.\n    watch(\n      () => !!widget.value && ruler.value?.slice === currentSlice.value,\n      (visible) => {\n        widget.value?.setVisibility(visible);\n      },\n      { immediate: true }\n    );\n\n    onMounted(() => {\n      if (!widget.value) {\n        return;\n      }\n      // hide handle visibility, but not picking visibility\n      widget.value.setHandleVisibility(false);\n      widgetManager.value.renderWidgets();\n    });\n\n    // --- handle pick visibility --- //\n\n    const usePointVisibility = (\n      pointState: Ref<vtkRulerWidgetPointState | undefined>\n    ) => {\n      const visible = ref(false);\n      const updateVisibility = () => {\n        if (!pointState.value) return;\n        visible.value = pointState.value.getVisible();\n      };\n\n      const onModified = useVTKCallback(\n        computed(() => pointState.value?.onModified)\n      );\n      onModified(() => updateVisibility());\n\n      watchOnce(pointState, () => updateVisibility());\n\n      return visible;\n    };\n\n    const firstPointVisible = usePointVisibility(\n      computed(() => widget.value?.getWidgetState().getFirstPoint())\n    );\n    const secondPointVisible = usePointVisibility(\n      computed(() => widget.value?.getWidgetState().getSecondPoint())\n    );\n\n    return {\n      ruler,\n      firstPoint: computed(() => {\n        return firstPointVisible.value ? ruler.value.firstPoint : undefined;\n      }),\n      secondPoint: computed(() => {\n        return secondPointVisible.value ? ruler.value.secondPoint : undefined;\n      }),\n      length: computed(() => rulerStore.lengthByID[ruler.value.id]),\n    };\n  },\n});\n</script>\n\n<template>\n  <RulerSVG2D\n    v-show=\"currentSlice === ruler.slice\"\n    :view-id=\"viewId\"\n    :point1=\"firstPoint\"\n    :point2=\"secondPoint\"\n    :color=\"ruler.color\"\n    :length=\"length\"\n  />\n</template>\n","<template>\n  <div class=\"overlay-no-events\">\n    <svg class=\"overlay-no-events\">\n      <RulerWidget2D\n        v-for=\"ruler in rulers\"\n        :key=\"ruler.id\"\n        :ruler-id=\"ruler.id\"\n        :is-placing=\"ruler.id === placingRulerID\"\n        :current-slice=\"currentSlice\"\n        :view-id=\"viewId\"\n        :view-direction=\"viewDirection\"\n        :widget-manager=\"widgetManager\"\n        @contextmenu=\"openContextMenu(ruler.id, $event)\"\n        @placed=\"onRulerPlaced\"\n      />\n    </svg>\n    <v-menu\n      v-model=\"contextMenu.show\"\n      class=\"position-absolute\"\n      :style=\"{\n        top: `${contextMenu.y}px`,\n        left: `${contextMenu.x}px`,\n      }\"\n      close-on-click\n      close-on-content-click\n    >\n      <v-list density=\"compact\">\n        <v-list-item @click=\"deleteRulerFromContextMenu\">\n          <v-list-item-title>Delete</v-list-item-title>\n        </v-list-item>\n      </v-list>\n    </v-menu>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport {\n  computed,\n  defineComponent,\n  onUnmounted,\n  PropType,\n  reactive,\n  ref,\n  toRefs,\n  watch,\n} from 'vue';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { useToolStore } from '@/src/store/tools';\nimport { Tools } from '@/src/store/tools/types';\nimport { useRulerStore } from '@/src/store/tools/rulers';\nimport { getLPSAxisFromDir } from '@/src/utils/lps';\nimport RulerWidget2D from '@/src/components/tools/ruler/RulerWidget2D.vue';\nimport vtkWidgetManager from '@kitware/vtk.js/Widgets/Core/WidgetManager';\nimport type { Vector2, Vector3 } from '@kitware/vtk.js/types';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport { storeToRefs } from 'pinia';\nimport {\n  FrameOfReference,\n  frameOfReferenceToImageSliceAndAxis,\n} from '@/src/utils/frameOfReference';\nimport { Ruler } from '@/src/types/ruler';\nimport { vec3 } from 'gl-matrix';\n\nexport default defineComponent({\n  name: 'RulerTool',\n  props: {\n    viewId: {\n      type: String,\n      required: true,\n    },\n    currentSlice: {\n      type: Number,\n      required: true,\n    },\n    viewDirection: {\n      type: String as PropType<LPSAxisDir>,\n      required: true,\n    },\n    widgetManager: {\n      type: Object as PropType<vtkWidgetManager>,\n      required: true,\n    },\n  },\n  components: {\n    RulerWidget2D,\n  },\n  setup(props) {\n    const { viewDirection, currentSlice } = toRefs(props);\n    const toolStore = useToolStore();\n    const rulerStore = useRulerStore();\n    const { rulers, activeLabel } = storeToRefs(rulerStore);\n\n    const { currentImageID, currentImageMetadata } = useCurrentImage();\n    const isToolActive = computed(() => toolStore.currentTool === Tools.Ruler);\n    const viewAxis = computed(() => getLPSAxisFromDir(viewDirection.value));\n\n    const placingRulerID = ref<string | null>(null);\n\n    // --- active ruler management --- //\n\n    watch(\n      placingRulerID,\n      (id, prevId) => {\n        if (prevId != null) {\n          rulerStore.updateRuler(prevId, { placing: false });\n        }\n        if (id != null) {\n          rulerStore.updateRuler(id, { placing: true });\n        }\n      },\n      { immediate: true }\n    );\n\n    watch(\n      [isToolActive, currentImageID] as const,\n      ([active, imageID]) => {\n        if (placingRulerID.value != null) {\n          rulerStore.removeRuler(placingRulerID.value);\n          placingRulerID.value = null;\n        }\n        if (active && imageID) {\n          placingRulerID.value = rulerStore.addRuler({\n            imageID,\n            placing: true,\n          });\n        }\n      },\n      { immediate: true }\n    );\n\n    watch(\n      [activeLabel, placingRulerID],\n      ([label, placingTool]) => {\n        if (placingTool != null) {\n          rulerStore.updateRuler(placingTool, {\n            label,\n            ...(label && rulerStore.labels[label]),\n          });\n        }\n      },\n      { immediate: true }\n    );\n\n    onUnmounted(() => {\n      if (placingRulerID.value != null) {\n        rulerStore.removeRuler(placingRulerID.value);\n        placingRulerID.value = null;\n      }\n    });\n\n    const onRulerPlaced = () => {\n      if (currentImageID.value) {\n        placingRulerID.value = rulerStore.addRuler({\n          imageID: currentImageID.value,\n          placing: true,\n        });\n      }\n    };\n\n    // --- updating active ruler frame --- //\n\n    // TODO useCurrentFrameOfReference(viewDirection)\n    const getCurrentFrameOfReference = (): FrameOfReference => {\n      const { lpsOrientation, indexToWorld } = currentImageMetadata.value;\n      const planeNormal = lpsOrientation[viewDirection.value] as Vector3;\n\n      const lpsIdx = lpsOrientation[viewAxis.value];\n      const planeOrigin: Vector3 = [0, 0, 0];\n      planeOrigin[lpsIdx] = currentSlice.value;\n      // convert index pt to world pt\n      vec3.transformMat4(planeOrigin, planeOrigin, indexToWorld);\n\n      return {\n        planeNormal,\n        planeOrigin,\n      };\n    };\n\n    // update active ruler's frame + slice, since the\n    // active ruler is not finalized.\n    watch(\n      [currentSlice, placingRulerID] as const,\n      ([slice, rulerID]) => {\n        if (!rulerID) return;\n        rulerStore.updateRuler(rulerID, {\n          frameOfReference: getCurrentFrameOfReference(),\n          slice,\n        });\n      },\n      { immediate: true }\n    );\n\n    // --- context menu --- //\n\n    const contextMenu = reactive({\n      show: false,\n      x: 0,\n      y: 0,\n      forRulerID: '',\n    });\n\n    const openContextMenu = (rulerID: string, displayXY: Vector2) => {\n      [contextMenu.x, contextMenu.y] = displayXY;\n      contextMenu.show = true;\n      contextMenu.forRulerID = rulerID;\n    };\n\n    const deleteRulerFromContextMenu = () => {\n      rulerStore.removeRuler(contextMenu.forRulerID);\n    };\n\n    // --- ruler data --- //\n\n    // does the ruler's frame of reference match\n    // the view's axis\n    const doesRulerFrameMatchViewAxis = (ruler: Partial<Ruler>) => {\n      if (!ruler.frameOfReference) return false;\n      const rulerAxis = frameOfReferenceToImageSliceAndAxis(\n        ruler.frameOfReference,\n        currentImageMetadata.value,\n        {\n          allowOutOfBoundsSlice: true,\n        }\n      );\n      return !!rulerAxis && rulerAxis.axis === viewAxis.value;\n    };\n\n    const currentRulers = computed(() => {\n      const { lengthByID } = rulerStore;\n      const curImageID = currentImageID.value;\n\n      const rulerData = rulers.value\n        .filter((ruler) => {\n          // only show rulers for the current image\n          // and current view axis\n          return (\n            ruler.imageID === curImageID && doesRulerFrameMatchViewAxis(ruler)\n          );\n        })\n        .map((ruler) => {\n          return {\n            ...ruler,\n            length: lengthByID[ruler.id],\n          };\n        });\n\n      return rulerData;\n    });\n\n    return {\n      rulers: currentRulers,\n      placingRulerID,\n      contextMenu,\n      openContextMenu,\n      deleteRulerFromContextMenu,\n      onRulerPlaced,\n    };\n  },\n});\n</script>\n\n<style scoped src=\"@/src/components/styles/vtk-view.css\"></style>\n","<template>\n  <div class=\"overlay-no-events\">\n    <svg class=\"overlay-no-events\">\n      <RulerWidget2D\n        v-for=\"ruler in rulers\"\n        :key=\"ruler.id\"\n        :ruler-id=\"ruler.id\"\n        :is-placing=\"ruler.id === placingRulerID\"\n        :current-slice=\"currentSlice\"\n        :view-id=\"viewId\"\n        :view-direction=\"viewDirection\"\n        :widget-manager=\"widgetManager\"\n        @contextmenu=\"openContextMenu(ruler.id, $event)\"\n        @placed=\"onRulerPlaced\"\n      />\n    </svg>\n    <v-menu\n      v-model=\"contextMenu.show\"\n      class=\"position-absolute\"\n      :style=\"{\n        top: `${contextMenu.y}px`,\n        left: `${contextMenu.x}px`,\n      }\"\n      close-on-click\n      close-on-content-click\n    >\n      <v-list density=\"compact\">\n        <v-list-item @click=\"deleteRulerFromContextMenu\">\n          <v-list-item-title>Delete</v-list-item-title>\n        </v-list-item>\n      </v-list>\n    </v-menu>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport {\n  computed,\n  defineComponent,\n  onUnmounted,\n  PropType,\n  reactive,\n  ref,\n  toRefs,\n  watch,\n} from 'vue';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { useToolStore } from '@/src/store/tools';\nimport { Tools } from '@/src/store/tools/types';\nimport { useRulerStore } from '@/src/store/tools/rulers';\nimport { getLPSAxisFromDir } from '@/src/utils/lps';\nimport RulerWidget2D from '@/src/components/tools/ruler/RulerWidget2D.vue';\nimport vtkWidgetManager from '@kitware/vtk.js/Widgets/Core/WidgetManager';\nimport type { Vector2, Vector3 } from '@kitware/vtk.js/types';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport { storeToRefs } from 'pinia';\nimport {\n  FrameOfReference,\n  frameOfReferenceToImageSliceAndAxis,\n} from '@/src/utils/frameOfReference';\nimport { Ruler } from '@/src/types/ruler';\nimport { vec3 } from 'gl-matrix';\n\nexport default defineComponent({\n  name: 'RulerTool',\n  props: {\n    viewId: {\n      type: String,\n      required: true,\n    },\n    currentSlice: {\n      type: Number,\n      required: true,\n    },\n    viewDirection: {\n      type: String as PropType<LPSAxisDir>,\n      required: true,\n    },\n    widgetManager: {\n      type: Object as PropType<vtkWidgetManager>,\n      required: true,\n    },\n  },\n  components: {\n    RulerWidget2D,\n  },\n  setup(props) {\n    const { viewDirection, currentSlice } = toRefs(props);\n    const toolStore = useToolStore();\n    const rulerStore = useRulerStore();\n    const { rulers, activeLabel } = storeToRefs(rulerStore);\n\n    const { currentImageID, currentImageMetadata } = useCurrentImage();\n    const isToolActive = computed(() => toolStore.currentTool === Tools.Ruler);\n    const viewAxis = computed(() => getLPSAxisFromDir(viewDirection.value));\n\n    const placingRulerID = ref<string | null>(null);\n\n    // --- active ruler management --- //\n\n    watch(\n      placingRulerID,\n      (id, prevId) => {\n        if (prevId != null) {\n          rulerStore.updateRuler(prevId, { placing: false });\n        }\n        if (id != null) {\n          rulerStore.updateRuler(id, { placing: true });\n        }\n      },\n      { immediate: true }\n    );\n\n    watch(\n      [isToolActive, currentImageID] as const,\n      ([active, imageID]) => {\n        if (placingRulerID.value != null) {\n          rulerStore.removeRuler(placingRulerID.value);\n          placingRulerID.value = null;\n        }\n        if (active && imageID) {\n          placingRulerID.value = rulerStore.addRuler({\n            imageID,\n            placing: true,\n          });\n        }\n      },\n      { immediate: true }\n    );\n\n    watch(\n      [activeLabel, placingRulerID],\n      ([label, placingTool]) => {\n        if (placingTool != null) {\n          rulerStore.updateRuler(placingTool, {\n            label,\n            ...(label && rulerStore.labels[label]),\n          });\n        }\n      },\n      { immediate: true }\n    );\n\n    onUnmounted(() => {\n      if (placingRulerID.value != null) {\n        rulerStore.removeRuler(placingRulerID.value);\n        placingRulerID.value = null;\n      }\n    });\n\n    const onRulerPlaced = () => {\n      if (currentImageID.value) {\n        placingRulerID.value = rulerStore.addRuler({\n          imageID: currentImageID.value,\n          placing: true,\n        });\n      }\n    };\n\n    // --- updating active ruler frame --- //\n\n    // TODO useCurrentFrameOfReference(viewDirection)\n    const getCurrentFrameOfReference = (): FrameOfReference => {\n      const { lpsOrientation, indexToWorld } = currentImageMetadata.value;\n      const planeNormal = lpsOrientation[viewDirection.value] as Vector3;\n\n      const lpsIdx = lpsOrientation[viewAxis.value];\n      const planeOrigin: Vector3 = [0, 0, 0];\n      planeOrigin[lpsIdx] = currentSlice.value;\n      // convert index pt to world pt\n      vec3.transformMat4(planeOrigin, planeOrigin, indexToWorld);\n\n      return {\n        planeNormal,\n        planeOrigin,\n      };\n    };\n\n    // update active ruler's frame + slice, since the\n    // active ruler is not finalized.\n    watch(\n      [currentSlice, placingRulerID] as const,\n      ([slice, rulerID]) => {\n        if (!rulerID) return;\n        rulerStore.updateRuler(rulerID, {\n          frameOfReference: getCurrentFrameOfReference(),\n          slice,\n        });\n      },\n      { immediate: true }\n    );\n\n    // --- context menu --- //\n\n    const contextMenu = reactive({\n      show: false,\n      x: 0,\n      y: 0,\n      forRulerID: '',\n    });\n\n    const openContextMenu = (rulerID: string, displayXY: Vector2) => {\n      [contextMenu.x, contextMenu.y] = displayXY;\n      contextMenu.show = true;\n      contextMenu.forRulerID = rulerID;\n    };\n\n    const deleteRulerFromContextMenu = () => {\n      rulerStore.removeRuler(contextMenu.forRulerID);\n    };\n\n    // --- ruler data --- //\n\n    // does the ruler's frame of reference match\n    // the view's axis\n    const doesRulerFrameMatchViewAxis = (ruler: Partial<Ruler>) => {\n      if (!ruler.frameOfReference) return false;\n      const rulerAxis = frameOfReferenceToImageSliceAndAxis(\n        ruler.frameOfReference,\n        currentImageMetadata.value,\n        {\n          allowOutOfBoundsSlice: true,\n        }\n      );\n      return !!rulerAxis && rulerAxis.axis === viewAxis.value;\n    };\n\n    const currentRulers = computed(() => {\n      const { lengthByID } = rulerStore;\n      const curImageID = currentImageID.value;\n\n      const rulerData = rulers.value\n        .filter((ruler) => {\n          // only show rulers for the current image\n          // and current view axis\n          return (\n            ruler.imageID === curImageID && doesRulerFrameMatchViewAxis(ruler)\n          );\n        })\n        .map((ruler) => {\n          return {\n            ...ruler,\n            length: lengthByID[ruler.id],\n          };\n        });\n\n      return rulerData;\n    });\n\n    return {\n      rulers: currentRulers,\n      placingRulerID,\n      contextMenu,\n      openContextMenu,\n      deleteRulerFromContextMenu,\n      onRulerPlaced,\n    };\n  },\n});\n</script>\n\n<style scoped src=\"@/src/components/styles/vtk-view.css\"></style>\n","import macro from '@kitware/vtk.js/macro';\n\nimport vtkRulerWidget from '../RulerWidget';\n\nexport { InteractionState } from '../RulerWidget/behavior';\n// ----------------------------------------------------------------------------\n// Factory\n// ----------------------------------------------------------------------------\n\nfunction vtkRectangleWidget(publicAPI, model) {\n  model.classHierarchy.push('vtkRectangleWidget');\n}\n\n// ----------------------------------------------------------------------------\n\nconst DEFAULT_VALUES = {};\n\n// ----------------------------------------------------------------------------\n\nexport function extend(publicAPI, model, initialValues = {}) {\n  Object.assign(model, DEFAULT_VALUES, initialValues);\n\n  const { store: toolStore, ...rest } = initialValues;\n\n  const rulerStore = {\n    ...toolStore,\n    rulerByID: toolStore.toolByID,\n    updateRuler: toolStore.updateTool,\n  };\n\n  vtkRulerWidget.extend(publicAPI, model, { store: rulerStore, ...rest });\n\n  vtkRectangleWidget(publicAPI, model);\n}\n\n// ----------------------------------------------------------------------------\n\nexport const newInstance = macro.newInstance(extend, 'vtkRectangleWidget');\n\n// ----------------------------------------------------------------------------\n\nexport default { newInstance, extend };\n","<template>\n  <g>\n    <rect\n      :x=\"rectangle.x\"\n      :y=\"rectangle.y\"\n      :width=\"rectangle.width\"\n      :height=\"rectangle.height\"\n      :stroke=\"color\"\n      stroke-width=\"1\"\n      :fill=\"fillColor\"\n    />\n    <!-- radius is related to the vtkRectangleWidget scale, specified in state -->\n    <circle\n      v-if=\"first\"\n      :cx=\"first.x\"\n      :cy=\"first.y\"\n      :stroke=\"color\"\n      stroke-width=\"1\"\n      fill=\"transparent\"\n      :r=\"10 / devicePixelRatio\"\n    />\n    <circle\n      v-if=\"second\"\n      :cx=\"second.x\"\n      :cy=\"second.y\"\n      :stroke=\"color\"\n      stroke-width=\"1\"\n      fill=\"transparent\"\n      :r=\"10 / devicePixelRatio\"\n    />\n  </g>\n</template>\n\n<script lang=\"ts\">\nimport { useResizeObserver } from '@/src/composables/useResizeObserver';\nimport { useVTKCallback } from '@/src/composables/useVTKCallback';\nimport { ToolContainer } from '@/src/constants';\nimport { useViewStore } from '@/src/store/views';\nimport { worldToSVG } from '@/src/utils/vtk-helpers';\nimport vtkLPSView2DProxy from '@/src/vtk/LPSView2DProxy';\nimport type { Vector3 } from '@kitware/vtk.js/types';\nimport {\n  PropType,\n  computed,\n  defineComponent,\n  toRefs,\n  unref,\n  ref,\n  watch,\n  inject,\n} from 'vue';\n\ntype SVGPoint = {\n  x: number;\n  y: number;\n};\n\nexport default defineComponent({\n  props: {\n    point1: Array as PropType<Array<number>>,\n    point2: Array as PropType<Array<number>>,\n    color: String,\n    fillColor: String,\n    viewId: {\n      type: String,\n      required: true,\n    },\n  },\n  setup(props) {\n    const { viewId: viewID, point1, point2 } = toRefs(props);\n    const firstPoint = ref<SVGPoint | null>();\n    const secondPoint = ref<SVGPoint | null>();\n\n    const viewStore = useViewStore();\n\n    const viewProxy = computed(\n      () => viewStore.getViewProxy<vtkLPSView2DProxy>(viewID.value)!\n    );\n\n    const updatePoints = () => {\n      const viewRenderer = viewProxy.value.getRenderer();\n      const pt1 = unref(point1) as Vector3 | undefined;\n      const pt2 = unref(point2) as Vector3 | undefined;\n      if (pt1) {\n        const point2D = worldToSVG(pt1, viewRenderer);\n        if (point2D) {\n          firstPoint.value = {\n            x: point2D[0],\n            y: point2D[1],\n          };\n        }\n      } else {\n        firstPoint.value = null;\n      }\n\n      if (pt2) {\n        const point2D = worldToSVG(pt2, viewRenderer);\n        if (point2D) {\n          secondPoint.value = {\n            x: point2D[0],\n            y: point2D[1],\n          };\n        }\n      } else {\n        secondPoint.value = null;\n      }\n    };\n\n    const rectangle = computed(() => {\n      const [firstX, firstY] = [\n        firstPoint.value?.x ?? 0,\n        firstPoint.value?.y ?? 0,\n      ];\n      const [secondX, secondY] = [\n        secondPoint.value?.x ?? firstX,\n        secondPoint.value?.y ?? firstY,\n      ];\n      return {\n        x: Math.min(firstX, secondX),\n        y: Math.min(firstY, secondY),\n        width: Math.abs(firstX - secondX),\n        height: Math.abs(firstY - secondY),\n      };\n    });\n\n    const cameraOnModified = useVTKCallback(\n      computed(() => viewProxy.value.getCamera().onModified)\n    );\n    cameraOnModified(updatePoints);\n\n    watch([viewProxy, point1, point2], updatePoints, {\n      deep: true,\n      immediate: true,\n    });\n\n    // --- resize --- //\n\n    const containerEl = inject(ToolContainer)!;\n\n    useResizeObserver(containerEl, () => {\n      updatePoints();\n    });\n\n    return {\n      devicePixelRatio,\n      first: firstPoint,\n      second: secondPoint,\n      rectangle,\n    };\n  },\n});\n</script>\n","<template>\n  <g>\n    <rect\n      :x=\"rectangle.x\"\n      :y=\"rectangle.y\"\n      :width=\"rectangle.width\"\n      :height=\"rectangle.height\"\n      :stroke=\"color\"\n      stroke-width=\"1\"\n      :fill=\"fillColor\"\n    />\n    <!-- radius is related to the vtkRectangleWidget scale, specified in state -->\n    <circle\n      v-if=\"first\"\n      :cx=\"first.x\"\n      :cy=\"first.y\"\n      :stroke=\"color\"\n      stroke-width=\"1\"\n      fill=\"transparent\"\n      :r=\"10 / devicePixelRatio\"\n    />\n    <circle\n      v-if=\"second\"\n      :cx=\"second.x\"\n      :cy=\"second.y\"\n      :stroke=\"color\"\n      stroke-width=\"1\"\n      fill=\"transparent\"\n      :r=\"10 / devicePixelRatio\"\n    />\n  </g>\n</template>\n\n<script lang=\"ts\">\nimport { useResizeObserver } from '@/src/composables/useResizeObserver';\nimport { useVTKCallback } from '@/src/composables/useVTKCallback';\nimport { ToolContainer } from '@/src/constants';\nimport { useViewStore } from '@/src/store/views';\nimport { worldToSVG } from '@/src/utils/vtk-helpers';\nimport vtkLPSView2DProxy from '@/src/vtk/LPSView2DProxy';\nimport type { Vector3 } from '@kitware/vtk.js/types';\nimport {\n  PropType,\n  computed,\n  defineComponent,\n  toRefs,\n  unref,\n  ref,\n  watch,\n  inject,\n} from 'vue';\n\ntype SVGPoint = {\n  x: number;\n  y: number;\n};\n\nexport default defineComponent({\n  props: {\n    point1: Array as PropType<Array<number>>,\n    point2: Array as PropType<Array<number>>,\n    color: String,\n    fillColor: String,\n    viewId: {\n      type: String,\n      required: true,\n    },\n  },\n  setup(props) {\n    const { viewId: viewID, point1, point2 } = toRefs(props);\n    const firstPoint = ref<SVGPoint | null>();\n    const secondPoint = ref<SVGPoint | null>();\n\n    const viewStore = useViewStore();\n\n    const viewProxy = computed(\n      () => viewStore.getViewProxy<vtkLPSView2DProxy>(viewID.value)!\n    );\n\n    const updatePoints = () => {\n      const viewRenderer = viewProxy.value.getRenderer();\n      const pt1 = unref(point1) as Vector3 | undefined;\n      const pt2 = unref(point2) as Vector3 | undefined;\n      if (pt1) {\n        const point2D = worldToSVG(pt1, viewRenderer);\n        if (point2D) {\n          firstPoint.value = {\n            x: point2D[0],\n            y: point2D[1],\n          };\n        }\n      } else {\n        firstPoint.value = null;\n      }\n\n      if (pt2) {\n        const point2D = worldToSVG(pt2, viewRenderer);\n        if (point2D) {\n          secondPoint.value = {\n            x: point2D[0],\n            y: point2D[1],\n          };\n        }\n      } else {\n        secondPoint.value = null;\n      }\n    };\n\n    const rectangle = computed(() => {\n      const [firstX, firstY] = [\n        firstPoint.value?.x ?? 0,\n        firstPoint.value?.y ?? 0,\n      ];\n      const [secondX, secondY] = [\n        secondPoint.value?.x ?? firstX,\n        secondPoint.value?.y ?? firstY,\n      ];\n      return {\n        x: Math.min(firstX, secondX),\n        y: Math.min(firstY, secondY),\n        width: Math.abs(firstX - secondX),\n        height: Math.abs(firstY - secondY),\n      };\n    });\n\n    const cameraOnModified = useVTKCallback(\n      computed(() => viewProxy.value.getCamera().onModified)\n    );\n    cameraOnModified(updatePoints);\n\n    watch([viewProxy, point1, point2], updatePoints, {\n      deep: true,\n      immediate: true,\n    });\n\n    // --- resize --- //\n\n    const containerEl = inject(ToolContainer)!;\n\n    useResizeObserver(containerEl, () => {\n      updatePoints();\n    });\n\n    return {\n      devicePixelRatio,\n      first: firstPoint,\n      second: secondPoint,\n      rectangle,\n    };\n  },\n});\n</script>\n","<script lang=\"ts\">\nimport vtkWidgetManager from '@kitware/vtk.js/Widgets/Core/WidgetManager';\nimport {\n  computed,\n  defineComponent,\n  onBeforeUnmount,\n  onMounted,\n  onUnmounted,\n  PropType,\n  Ref,\n  ref,\n  toRefs,\n  watch,\n  watchEffect,\n} from 'vue';\nimport vtkPlaneManipulator from '@kitware/vtk.js/Widgets/Manipulators/PlaneManipulator';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { updatePlaneManipulatorFor2DView } from '@/src/utils/manipulators';\nimport type { vtkSubscription } from '@kitware/vtk.js/interfaces';\nimport { getCSSCoordinatesFromEvent } from '@/src/utils/vtk-helpers';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport { useVTKCallback } from '@/src/composables/useVTKCallback';\nimport { useRectangleStore } from '@/src/store/tools/rectangles';\nimport vtkRectangleWidget, {\n  vtkRectangleViewWidget,\n  InteractionState,\n} from '@/src/vtk/RectangleWidget';\nimport RectangleSVG2D from '@/src/components/tools/rectangle/RectangleSVG2D.vue';\nimport { vtkRulerWidgetPointState } from '@/src/vtk/RulerWidget';\nimport { watchOnce } from '@vueuse/core';\nimport { RectangleID } from '@/src/types/rectangle';\n\nconst useStore = useRectangleStore;\nconst vtkWidgetFactory = vtkRectangleWidget;\ntype WidgetView = vtkRectangleViewWidget;\ntype vtkWidgetPointState = vtkRulerWidgetPointState;\ntype ToolID = RectangleID;\nconst SVG2DComponent = RectangleSVG2D;\n\nexport default defineComponent({\n  name: 'RectangleWidget2D',\n  emits: ['placed', 'contextmenu'],\n  props: {\n    toolId: {\n      type: String,\n      required: true,\n    },\n    widgetManager: {\n      type: Object as PropType<vtkWidgetManager>,\n      required: true,\n    },\n    viewId: {\n      type: String,\n      required: true,\n    },\n    viewDirection: {\n      type: String as PropType<LPSAxisDir>,\n      required: true,\n    },\n    currentSlice: {\n      type: Number,\n      required: true,\n    },\n    isPlacing: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  components: {\n    SVG2DComponent,\n  },\n  setup(props, { emit }) {\n    const {\n      toolId: stringToolId,\n      widgetManager,\n      viewDirection,\n      currentSlice,\n      isPlacing,\n    } = toRefs(props);\n    const toolId = ref(stringToolId.value) as Ref<ToolID>;\n\n    const toolStore = useStore();\n    const tool = computed(() => toolStore.toolByID[toolId.value]);\n    const { currentImageID, currentImageMetadata } = useCurrentImage();\n\n    const widgetFactory = vtkWidgetFactory.newInstance({\n      id: toolId.value,\n      store: toolStore,\n      isPlaced: !isPlacing.value,\n    });\n    const widget = ref<WidgetView | null>(null);\n\n    onMounted(() => {\n      widget.value = widgetManager.value.addWidget(widgetFactory) as WidgetView;\n    });\n\n    onUnmounted(() => {\n      if (!widget.value) {\n        return;\n      }\n      widgetManager.value.removeWidget(widget.value);\n      widget.value.delete();\n      widgetFactory.delete();\n    });\n\n    watch(\n      [isPlacing, widget],\n      ([placing, widget_]) => {\n        if (placing && widget_) {\n          widget_.setInteractionState(InteractionState.PlacingFirst);\n        }\n      },\n      { immediate: true }\n    );\n\n    // --- reset on slice/image changes --- //\n\n    watch([currentSlice, currentImageID, widget], () => {\n      const isPlaced = widget.value?.getWidgetState().getIsPlaced();\n      if (widget.value && !isPlaced) {\n        widget.value.resetInteractions();\n        widget.value.setInteractionState(InteractionState.PlacingFirst);\n      }\n    });\n\n    const onPlacedEvent = useVTKCallback(\n      computed(() => widget.value?.onPlacedEvent)\n    );\n\n    onPlacedEvent(() => {\n      emit('placed');\n    });\n\n    // --- right click handling --- //\n\n    let rightClickSub: vtkSubscription | null = null;\n\n    onMounted(() => {\n      if (!widget.value) {\n        return;\n      }\n      rightClickSub = widget.value.onRightClickEvent((eventData) => {\n        const coords = getCSSCoordinatesFromEvent(eventData);\n        if (coords) {\n          emit('contextmenu', coords);\n        }\n      });\n    });\n\n    onBeforeUnmount(() => {\n      if (rightClickSub) {\n        rightClickSub.unsubscribe();\n        rightClickSub = null;\n      }\n    });\n\n    // --- manipulator --- //\n\n    const manipulator = vtkPlaneManipulator.newInstance();\n\n    onMounted(() => {\n      if (!widget.value) {\n        return;\n      }\n      widget.value.setManipulator(manipulator);\n    });\n\n    watchEffect(() => {\n      updatePlaneManipulatorFor2DView(\n        manipulator,\n        viewDirection.value,\n        tool.value?.slice ?? currentSlice.value,\n        currentImageMetadata.value\n      );\n    });\n\n    // --- visibility --- //\n\n    // toggles the pickability of the tool handles,\n    // since the 3D tool parts are visually hidden.\n    watch(\n      () => !!widget.value && tool.value?.slice === currentSlice.value,\n      (visible) => {\n        widget.value?.setVisibility(visible);\n      },\n      { immediate: true }\n    );\n\n    onMounted(() => {\n      if (!widget.value) {\n        return;\n      }\n      // hide handle visibility, but not picking visibility\n      widget.value.setHandleVisibility(false);\n      widgetManager.value.renderWidgets();\n    });\n\n    // --- handle pick visibility --- //\n    const usePointVisibility = (\n      pointState: Ref<vtkWidgetPointState | undefined>\n    ) => {\n      const visible = ref(false);\n      const updateVisibility = () => {\n        if (!pointState.value) return;\n        visible.value = pointState.value.getVisible();\n      };\n      const onModified = useVTKCallback(\n        computed(() => pointState.value?.onModified)\n      );\n      onModified(() => updateVisibility());\n      watchOnce(pointState, () => updateVisibility());\n      return visible;\n    };\n\n    const firstPointVisible = usePointVisibility(\n      computed(() => widget.value?.getWidgetState().getFirstPoint())\n    );\n    const secondPointVisible = usePointVisibility(\n      computed(() => widget.value?.getWidgetState().getSecondPoint())\n    );\n\n    return {\n      tool,\n      firstPoint: computed(() => {\n        return firstPointVisible.value ? tool.value.firstPoint : undefined;\n      }),\n      secondPoint: computed(() => {\n        return secondPointVisible.value ? tool.value.secondPoint : undefined;\n      }),\n    };\n  },\n});\n</script>\n\n<template>\n  <SVG2DComponent\n    v-show=\"currentSlice === tool.slice\"\n    :view-id=\"viewId\"\n    :point1=\"firstPoint\"\n    :point2=\"secondPoint\"\n    :color=\"tool.color\"\n    :fill-color=\"tool.fillColor\"\n  />\n</template>\n","<script lang=\"ts\">\nimport vtkWidgetManager from '@kitware/vtk.js/Widgets/Core/WidgetManager';\nimport {\n  computed,\n  defineComponent,\n  onBeforeUnmount,\n  onMounted,\n  onUnmounted,\n  PropType,\n  Ref,\n  ref,\n  toRefs,\n  watch,\n  watchEffect,\n} from 'vue';\nimport vtkPlaneManipulator from '@kitware/vtk.js/Widgets/Manipulators/PlaneManipulator';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { updatePlaneManipulatorFor2DView } from '@/src/utils/manipulators';\nimport type { vtkSubscription } from '@kitware/vtk.js/interfaces';\nimport { getCSSCoordinatesFromEvent } from '@/src/utils/vtk-helpers';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport { useVTKCallback } from '@/src/composables/useVTKCallback';\nimport { useRectangleStore } from '@/src/store/tools/rectangles';\nimport vtkRectangleWidget, {\n  vtkRectangleViewWidget,\n  InteractionState,\n} from '@/src/vtk/RectangleWidget';\nimport RectangleSVG2D from '@/src/components/tools/rectangle/RectangleSVG2D.vue';\nimport { vtkRulerWidgetPointState } from '@/src/vtk/RulerWidget';\nimport { watchOnce } from '@vueuse/core';\nimport { RectangleID } from '@/src/types/rectangle';\n\nconst useStore = useRectangleStore;\nconst vtkWidgetFactory = vtkRectangleWidget;\ntype WidgetView = vtkRectangleViewWidget;\ntype vtkWidgetPointState = vtkRulerWidgetPointState;\ntype ToolID = RectangleID;\nconst SVG2DComponent = RectangleSVG2D;\n\nexport default defineComponent({\n  name: 'RectangleWidget2D',\n  emits: ['placed', 'contextmenu'],\n  props: {\n    toolId: {\n      type: String,\n      required: true,\n    },\n    widgetManager: {\n      type: Object as PropType<vtkWidgetManager>,\n      required: true,\n    },\n    viewId: {\n      type: String,\n      required: true,\n    },\n    viewDirection: {\n      type: String as PropType<LPSAxisDir>,\n      required: true,\n    },\n    currentSlice: {\n      type: Number,\n      required: true,\n    },\n    isPlacing: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  components: {\n    SVG2DComponent,\n  },\n  setup(props, { emit }) {\n    const {\n      toolId: stringToolId,\n      widgetManager,\n      viewDirection,\n      currentSlice,\n      isPlacing,\n    } = toRefs(props);\n    const toolId = ref(stringToolId.value) as Ref<ToolID>;\n\n    const toolStore = useStore();\n    const tool = computed(() => toolStore.toolByID[toolId.value]);\n    const { currentImageID, currentImageMetadata } = useCurrentImage();\n\n    const widgetFactory = vtkWidgetFactory.newInstance({\n      id: toolId.value,\n      store: toolStore,\n      isPlaced: !isPlacing.value,\n    });\n    const widget = ref<WidgetView | null>(null);\n\n    onMounted(() => {\n      widget.value = widgetManager.value.addWidget(widgetFactory) as WidgetView;\n    });\n\n    onUnmounted(() => {\n      if (!widget.value) {\n        return;\n      }\n      widgetManager.value.removeWidget(widget.value);\n      widget.value.delete();\n      widgetFactory.delete();\n    });\n\n    watch(\n      [isPlacing, widget],\n      ([placing, widget_]) => {\n        if (placing && widget_) {\n          widget_.setInteractionState(InteractionState.PlacingFirst);\n        }\n      },\n      { immediate: true }\n    );\n\n    // --- reset on slice/image changes --- //\n\n    watch([currentSlice, currentImageID, widget], () => {\n      const isPlaced = widget.value?.getWidgetState().getIsPlaced();\n      if (widget.value && !isPlaced) {\n        widget.value.resetInteractions();\n        widget.value.setInteractionState(InteractionState.PlacingFirst);\n      }\n    });\n\n    const onPlacedEvent = useVTKCallback(\n      computed(() => widget.value?.onPlacedEvent)\n    );\n\n    onPlacedEvent(() => {\n      emit('placed');\n    });\n\n    // --- right click handling --- //\n\n    let rightClickSub: vtkSubscription | null = null;\n\n    onMounted(() => {\n      if (!widget.value) {\n        return;\n      }\n      rightClickSub = widget.value.onRightClickEvent((eventData) => {\n        const coords = getCSSCoordinatesFromEvent(eventData);\n        if (coords) {\n          emit('contextmenu', coords);\n        }\n      });\n    });\n\n    onBeforeUnmount(() => {\n      if (rightClickSub) {\n        rightClickSub.unsubscribe();\n        rightClickSub = null;\n      }\n    });\n\n    // --- manipulator --- //\n\n    const manipulator = vtkPlaneManipulator.newInstance();\n\n    onMounted(() => {\n      if (!widget.value) {\n        return;\n      }\n      widget.value.setManipulator(manipulator);\n    });\n\n    watchEffect(() => {\n      updatePlaneManipulatorFor2DView(\n        manipulator,\n        viewDirection.value,\n        tool.value?.slice ?? currentSlice.value,\n        currentImageMetadata.value\n      );\n    });\n\n    // --- visibility --- //\n\n    // toggles the pickability of the tool handles,\n    // since the 3D tool parts are visually hidden.\n    watch(\n      () => !!widget.value && tool.value?.slice === currentSlice.value,\n      (visible) => {\n        widget.value?.setVisibility(visible);\n      },\n      { immediate: true }\n    );\n\n    onMounted(() => {\n      if (!widget.value) {\n        return;\n      }\n      // hide handle visibility, but not picking visibility\n      widget.value.setHandleVisibility(false);\n      widgetManager.value.renderWidgets();\n    });\n\n    // --- handle pick visibility --- //\n    const usePointVisibility = (\n      pointState: Ref<vtkWidgetPointState | undefined>\n    ) => {\n      const visible = ref(false);\n      const updateVisibility = () => {\n        if (!pointState.value) return;\n        visible.value = pointState.value.getVisible();\n      };\n      const onModified = useVTKCallback(\n        computed(() => pointState.value?.onModified)\n      );\n      onModified(() => updateVisibility());\n      watchOnce(pointState, () => updateVisibility());\n      return visible;\n    };\n\n    const firstPointVisible = usePointVisibility(\n      computed(() => widget.value?.getWidgetState().getFirstPoint())\n    );\n    const secondPointVisible = usePointVisibility(\n      computed(() => widget.value?.getWidgetState().getSecondPoint())\n    );\n\n    return {\n      tool,\n      firstPoint: computed(() => {\n        return firstPointVisible.value ? tool.value.firstPoint : undefined;\n      }),\n      secondPoint: computed(() => {\n        return secondPointVisible.value ? tool.value.secondPoint : undefined;\n      }),\n    };\n  },\n});\n</script>\n\n<template>\n  <SVG2DComponent\n    v-show=\"currentSlice === tool.slice\"\n    :view-id=\"viewId\"\n    :point1=\"firstPoint\"\n    :point2=\"secondPoint\"\n    :color=\"tool.color\"\n    :fill-color=\"tool.fillColor\"\n  />\n</template>\n","<template>\n  <div class=\"overlay-no-events\">\n    <svg class=\"overlay-no-events\">\n      <RectangleWidget2D\n        v-for=\"tool in tools\"\n        :key=\"tool.id\"\n        :tool-id=\"tool.id\"\n        :is-placing=\"tool.id === placingToolID\"\n        :current-slice=\"currentSlice\"\n        :view-id=\"viewId\"\n        :view-direction=\"viewDirection\"\n        :widget-manager=\"widgetManager\"\n        @contextmenu=\"openContextMenu(tool.id, $event)\"\n        @placed=\"onToolPlaced\"\n      />\n    </svg>\n    <v-menu\n      v-model=\"contextMenu.show\"\n      class=\"position-absolute\"\n      :style=\"{\n        top: `${contextMenu.y}px`,\n        left: `${contextMenu.x}px`,\n      }\"\n      close-on-click\n      close-on-content-click\n    >\n      <v-list density=\"compact\">\n        <v-list-item @click=\"deleteToolFromContextMenu\">\n          <v-list-item-title>Delete</v-list-item-title>\n        </v-list-item>\n      </v-list>\n    </v-menu>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport {\n  computed,\n  defineComponent,\n  onUnmounted,\n  PropType,\n  reactive,\n  ref,\n  toRefs,\n  watch,\n} from 'vue';\nimport { storeToRefs } from 'pinia';\nimport { vec3 } from 'gl-matrix';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { useToolStore } from '@/src/store/tools';\nimport { Tools } from '@/src/store/tools/types';\nimport { getLPSAxisFromDir } from '@/src/utils/lps';\nimport RectangleWidget2D from '@/src/components/tools/rectangle/RectangleWidget2D.vue';\nimport vtkWidgetManager from '@kitware/vtk.js/Widgets/Core/WidgetManager';\nimport type { Vector2, Vector3 } from '@kitware/vtk.js/types';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport {\n  FrameOfReference,\n  frameOfReferenceToImageSliceAndAxis,\n} from '@/src/utils/frameOfReference';\nimport { useRectangleStore } from '@/src/store/tools/rectangles';\nimport { Rectangle, RectangleID } from '@/src/types/rectangle';\n\ntype ToolID = RectangleID;\ntype Tool = Rectangle;\nconst useActiveToolStore = useRectangleStore;\n\nexport default defineComponent({\n  name: 'RectangleTool',\n  props: {\n    viewId: {\n      type: String,\n      required: true,\n    },\n    currentSlice: {\n      type: Number,\n      required: true,\n    },\n    viewDirection: {\n      type: String as PropType<LPSAxisDir>,\n      required: true,\n    },\n    widgetManager: {\n      type: Object as PropType<vtkWidgetManager>,\n      required: true,\n    },\n  },\n  components: {\n    RectangleWidget2D,\n  },\n  setup(props) {\n    const { viewDirection, currentSlice } = toRefs(props);\n    const toolStore = useToolStore();\n    const activeToolStore = useActiveToolStore();\n    const { tools, activeLabel } = storeToRefs(activeToolStore);\n\n    const { currentImageID, currentImageMetadata } = useCurrentImage();\n    const isToolActive = computed(\n      () => toolStore.currentTool === Tools.Rectangle\n    );\n    const viewAxis = computed(() => getLPSAxisFromDir(viewDirection.value));\n\n    const placingToolID = ref<RectangleID | null>(null);\n\n    // --- active tool management --- //\n\n    watch(\n      placingToolID,\n      (id, prevId) => {\n        if (prevId != null) {\n          activeToolStore.updateTool(prevId, { placing: false });\n        }\n        if (id != null) {\n          activeToolStore.updateTool(id, { placing: true });\n        }\n      },\n      { immediate: true }\n    );\n\n    watch(\n      [isToolActive, currentImageID] as const,\n      ([active, imageID]) => {\n        if (placingToolID.value != null) {\n          activeToolStore.removeTool(placingToolID.value);\n          placingToolID.value = null;\n        }\n        if (active && imageID) {\n          placingToolID.value = activeToolStore.addTool({\n            imageID,\n            placing: true,\n          });\n        }\n      },\n      { immediate: true }\n    );\n\n    watch(\n      [activeLabel, placingToolID],\n      ([label, placingTool]) => {\n        if (placingTool != null) {\n          activeToolStore.updateTool(placingTool, {\n            label,\n            ...(label && activeToolStore.labels[label]),\n          });\n        }\n      },\n      { immediate: true }\n    );\n\n    onUnmounted(() => {\n      if (placingToolID.value != null) {\n        activeToolStore.removeTool(placingToolID.value);\n        placingToolID.value = null;\n      }\n    });\n\n    const onToolPlaced = () => {\n      if (currentImageID.value) {\n        placingToolID.value = activeToolStore.addTool({\n          imageID: currentImageID.value,\n          placing: true,\n        });\n      }\n    };\n\n    // --- updating active tool frame --- //\n\n    // TODO useCurrentFrameOfReference(viewDirection)\n    const getCurrentFrameOfReference = (): FrameOfReference => {\n      const { lpsOrientation, indexToWorld } = currentImageMetadata.value;\n      const planeNormal = lpsOrientation[viewDirection.value] as Vector3;\n      const lpsIdx = lpsOrientation[viewAxis.value];\n      const planeOrigin: Vector3 = [0, 0, 0];\n      planeOrigin[lpsIdx] = currentSlice.value;\n      // convert index pt to world pt\n      vec3.transformMat4(planeOrigin, planeOrigin, indexToWorld);\n      return {\n        planeNormal,\n        planeOrigin,\n      };\n    };\n    // update active ruler's frame + slice, since the\n    // active ruler is not finalized.\n    watch(\n      [currentSlice, placingToolID] as const,\n      ([slice, toolID]) => {\n        if (!toolID) return;\n        activeToolStore.updateTool(toolID, {\n          frameOfReference: getCurrentFrameOfReference(),\n          slice,\n        });\n      },\n      { immediate: true }\n    );\n\n    // --- context menu --- //\n\n    const contextMenu = reactive({\n      show: false,\n      x: 0,\n      y: 0,\n      forToolID: '' as ToolID,\n    });\n\n    const openContextMenu = (toolID: ToolID, displayXY: Vector2) => {\n      [contextMenu.x, contextMenu.y] = displayXY;\n      contextMenu.show = true;\n      contextMenu.forToolID = toolID;\n    };\n\n    const deleteToolFromContextMenu = () => {\n      activeToolStore.removeTool(contextMenu.forToolID);\n    };\n\n    // --- tool data --- //\n\n    // does the tools's frame of reference match\n    // the view's axis\n    const doesToolFrameMatchViewAxis = (tool: Partial<Tool>) => {\n      if (!tool.frameOfReference) return false;\n      const toolAxis = frameOfReferenceToImageSliceAndAxis(\n        tool.frameOfReference,\n        currentImageMetadata.value,\n        {\n          allowOutOfBoundsSlice: true,\n        }\n      );\n      return !!toolAxis && toolAxis.axis === viewAxis.value;\n    };\n\n    const currentTools = computed(() => {\n      const curImageID = currentImageID.value;\n\n      return tools.value.filter((tool) => {\n        // only show tools for the current image\n        // and current view axis\n        return tool.imageID === curImageID && doesToolFrameMatchViewAxis(tool);\n      });\n    });\n\n    return {\n      tools: currentTools,\n      placingToolID,\n      contextMenu,\n      openContextMenu,\n      deleteToolFromContextMenu,\n      onToolPlaced,\n    };\n  },\n});\n</script>\n\n<style scoped src=\"@/src/components/styles/vtk-view.css\"></style>\n","<template>\n  <div class=\"overlay-no-events\">\n    <svg class=\"overlay-no-events\">\n      <RectangleWidget2D\n        v-for=\"tool in tools\"\n        :key=\"tool.id\"\n        :tool-id=\"tool.id\"\n        :is-placing=\"tool.id === placingToolID\"\n        :current-slice=\"currentSlice\"\n        :view-id=\"viewId\"\n        :view-direction=\"viewDirection\"\n        :widget-manager=\"widgetManager\"\n        @contextmenu=\"openContextMenu(tool.id, $event)\"\n        @placed=\"onToolPlaced\"\n      />\n    </svg>\n    <v-menu\n      v-model=\"contextMenu.show\"\n      class=\"position-absolute\"\n      :style=\"{\n        top: `${contextMenu.y}px`,\n        left: `${contextMenu.x}px`,\n      }\"\n      close-on-click\n      close-on-content-click\n    >\n      <v-list density=\"compact\">\n        <v-list-item @click=\"deleteToolFromContextMenu\">\n          <v-list-item-title>Delete</v-list-item-title>\n        </v-list-item>\n      </v-list>\n    </v-menu>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport {\n  computed,\n  defineComponent,\n  onUnmounted,\n  PropType,\n  reactive,\n  ref,\n  toRefs,\n  watch,\n} from 'vue';\nimport { storeToRefs } from 'pinia';\nimport { vec3 } from 'gl-matrix';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { useToolStore } from '@/src/store/tools';\nimport { Tools } from '@/src/store/tools/types';\nimport { getLPSAxisFromDir } from '@/src/utils/lps';\nimport RectangleWidget2D from '@/src/components/tools/rectangle/RectangleWidget2D.vue';\nimport vtkWidgetManager from '@kitware/vtk.js/Widgets/Core/WidgetManager';\nimport type { Vector2, Vector3 } from '@kitware/vtk.js/types';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport {\n  FrameOfReference,\n  frameOfReferenceToImageSliceAndAxis,\n} from '@/src/utils/frameOfReference';\nimport { useRectangleStore } from '@/src/store/tools/rectangles';\nimport { Rectangle, RectangleID } from '@/src/types/rectangle';\n\ntype ToolID = RectangleID;\ntype Tool = Rectangle;\nconst useActiveToolStore = useRectangleStore;\n\nexport default defineComponent({\n  name: 'RectangleTool',\n  props: {\n    viewId: {\n      type: String,\n      required: true,\n    },\n    currentSlice: {\n      type: Number,\n      required: true,\n    },\n    viewDirection: {\n      type: String as PropType<LPSAxisDir>,\n      required: true,\n    },\n    widgetManager: {\n      type: Object as PropType<vtkWidgetManager>,\n      required: true,\n    },\n  },\n  components: {\n    RectangleWidget2D,\n  },\n  setup(props) {\n    const { viewDirection, currentSlice } = toRefs(props);\n    const toolStore = useToolStore();\n    const activeToolStore = useActiveToolStore();\n    const { tools, activeLabel } = storeToRefs(activeToolStore);\n\n    const { currentImageID, currentImageMetadata } = useCurrentImage();\n    const isToolActive = computed(\n      () => toolStore.currentTool === Tools.Rectangle\n    );\n    const viewAxis = computed(() => getLPSAxisFromDir(viewDirection.value));\n\n    const placingToolID = ref<RectangleID | null>(null);\n\n    // --- active tool management --- //\n\n    watch(\n      placingToolID,\n      (id, prevId) => {\n        if (prevId != null) {\n          activeToolStore.updateTool(prevId, { placing: false });\n        }\n        if (id != null) {\n          activeToolStore.updateTool(id, { placing: true });\n        }\n      },\n      { immediate: true }\n    );\n\n    watch(\n      [isToolActive, currentImageID] as const,\n      ([active, imageID]) => {\n        if (placingToolID.value != null) {\n          activeToolStore.removeTool(placingToolID.value);\n          placingToolID.value = null;\n        }\n        if (active && imageID) {\n          placingToolID.value = activeToolStore.addTool({\n            imageID,\n            placing: true,\n          });\n        }\n      },\n      { immediate: true }\n    );\n\n    watch(\n      [activeLabel, placingToolID],\n      ([label, placingTool]) => {\n        if (placingTool != null) {\n          activeToolStore.updateTool(placingTool, {\n            label,\n            ...(label && activeToolStore.labels[label]),\n          });\n        }\n      },\n      { immediate: true }\n    );\n\n    onUnmounted(() => {\n      if (placingToolID.value != null) {\n        activeToolStore.removeTool(placingToolID.value);\n        placingToolID.value = null;\n      }\n    });\n\n    const onToolPlaced = () => {\n      if (currentImageID.value) {\n        placingToolID.value = activeToolStore.addTool({\n          imageID: currentImageID.value,\n          placing: true,\n        });\n      }\n    };\n\n    // --- updating active tool frame --- //\n\n    // TODO useCurrentFrameOfReference(viewDirection)\n    const getCurrentFrameOfReference = (): FrameOfReference => {\n      const { lpsOrientation, indexToWorld } = currentImageMetadata.value;\n      const planeNormal = lpsOrientation[viewDirection.value] as Vector3;\n      const lpsIdx = lpsOrientation[viewAxis.value];\n      const planeOrigin: Vector3 = [0, 0, 0];\n      planeOrigin[lpsIdx] = currentSlice.value;\n      // convert index pt to world pt\n      vec3.transformMat4(planeOrigin, planeOrigin, indexToWorld);\n      return {\n        planeNormal,\n        planeOrigin,\n      };\n    };\n    // update active ruler's frame + slice, since the\n    // active ruler is not finalized.\n    watch(\n      [currentSlice, placingToolID] as const,\n      ([slice, toolID]) => {\n        if (!toolID) return;\n        activeToolStore.updateTool(toolID, {\n          frameOfReference: getCurrentFrameOfReference(),\n          slice,\n        });\n      },\n      { immediate: true }\n    );\n\n    // --- context menu --- //\n\n    const contextMenu = reactive({\n      show: false,\n      x: 0,\n      y: 0,\n      forToolID: '' as ToolID,\n    });\n\n    const openContextMenu = (toolID: ToolID, displayXY: Vector2) => {\n      [contextMenu.x, contextMenu.y] = displayXY;\n      contextMenu.show = true;\n      contextMenu.forToolID = toolID;\n    };\n\n    const deleteToolFromContextMenu = () => {\n      activeToolStore.removeTool(contextMenu.forToolID);\n    };\n\n    // --- tool data --- //\n\n    // does the tools's frame of reference match\n    // the view's axis\n    const doesToolFrameMatchViewAxis = (tool: Partial<Tool>) => {\n      if (!tool.frameOfReference) return false;\n      const toolAxis = frameOfReferenceToImageSliceAndAxis(\n        tool.frameOfReference,\n        currentImageMetadata.value,\n        {\n          allowOutOfBoundsSlice: true,\n        }\n      );\n      return !!toolAxis && toolAxis.axis === viewAxis.value;\n    };\n\n    const currentTools = computed(() => {\n      const curImageID = currentImageID.value;\n\n      return tools.value.filter((tool) => {\n        // only show tools for the current image\n        // and current view axis\n        return tool.imageID === curImageID && doesToolFrameMatchViewAxis(tool);\n      });\n    });\n\n    return {\n      tools: currentTools,\n      placingToolID,\n      contextMenu,\n      openContextMenu,\n      deleteToolFromContextMenu,\n      onToolPlaced,\n    };\n  },\n});\n</script>\n\n<style scoped src=\"@/src/components/styles/vtk-view.css\"></style>\n","import macro from '@kitware/vtk.js/macros';\nimport vtkActor from '@kitware/vtk.js/Rendering/Core/Actor';\nimport vtkMapper from '@kitware/vtk.js/Rendering/Core/Mapper';\nimport vtkWidgetRepresentation from '@kitware/vtk.js/Widgets/Representations/WidgetRepresentation';\nimport vtkPolyData from '@kitware/vtk.js/Common/DataModel/PolyData';\nimport { RenderingTypes } from '@kitware/vtk.js/Widgets/Core/WidgetManager/Constants';\nimport { vec2, vec3 } from 'gl-matrix';\nimport { transform2dTo3d } from '@/src/core/contours/referencePlane';\n\nconst PICKING_LINE_WIDTH = 32;\nconst DEFAULT_LINE_WIDTH = 2;\nconst SELECTED_LINE_WIDTH = 4;\n\nfunction vtkContourRepresentation(publicAPI, model) {\n  // Set our className\n  model.classHierarchy.push('vtkContourRepresentation');\n\n  model._polyData = vtkPolyData.newInstance({ mtime: 0 });\n  model._pdPoints = null;\n  model._pdLines = null;\n\n  model._pipelines = {\n    lines: {\n      source: publicAPI,\n      mapper: vtkMapper.newInstance(),\n      actor: vtkActor.newInstance({ parentProp: publicAPI }),\n    },\n  };\n\n  model._pipelines.lines.actor.getProperty().setLineWidth(2);\n  vtkWidgetRepresentation.connectPipeline(model._pipelines.lines);\n  publicAPI.addActor(model._pipelines.lines.actor);\n\n  publicAPI.getRepresentationStates = (input = model.inputData[0]) => input;\n\n  function allocatePolyDataArrays(contour) {\n    // reminder: polyLine is a flattened array of 2D points\n    const polyLine = contour.getPolyLine();\n    const refPlane = contour.getReferencePlane();\n    const numPoints = contour.getPolyLineLength();\n    const finalized = contour.getFinalized();\n    const closedAddition = finalized ? 1 : 0;\n\n    if (!polyLine || !refPlane) return;\n\n    if (model._pdPoints?.length !== numPoints * 3) {\n      model._pdPoints = new Float32Array(numPoints * 3);\n    }\n    if (model._pdLines?.length !== numPoints + 1) {\n      model._pdLines = new Float32Array(numPoints + 1 + closedAddition);\n    }\n\n    let ptOffset = 0;\n    let cellOffset = 0;\n\n    model._pdLines[cellOffset++] = numPoints + closedAddition;\n\n    const pt2d = vec2.create();\n    const pt3d = vec3.create();\n    for (let i = 0; i < polyLine.length; ) {\n      model._pdLines[cellOffset++] = ptOffset / 3;\n\n      vec3.set(pt2d, polyLine[i++], polyLine[i++]);\n      transform2dTo3d(pt2d, refPlane, pt3d);\n\n      /* eslint-disable prefer-destructuring */\n      model._pdPoints[ptOffset++] = pt3d[0];\n      model._pdPoints[ptOffset++] = pt3d[1];\n      model._pdPoints[ptOffset++] = pt3d[2];\n      /* eslint-enable prefer-destructuring */\n    }\n\n    if (finalized) {\n      model._pdLines[cellOffset] = 0;\n    }\n  }\n\n  let width = DEFAULT_LINE_WIDTH;\n\n  publicAPI.requestData = (inData, outData) => {\n    const contour = publicAPI.getRepresentationStates(inData[0]);\n\n    allocatePolyDataArrays(contour);\n\n    if (model._pdPoints && model._pdLines) {\n      model._polyData.getPoints().setData(model._pdPoints);\n      model._polyData.getLines().setData(model._pdLines);\n\n      model._polyData.getPoints().modified();\n      model._polyData.modified();\n    }\n\n    width = contour.getSelected() ? SELECTED_LINE_WIDTH : DEFAULT_LINE_WIDTH;\n    model._pipelines.lines.actor.getProperty().setLineWidth(width);\n    model._pipelines.lines.actor.getProperty().setColor(contour.getColor());\n\n    outData[0] = model._polyData;\n  };\n\n  /**\n   * When mousing over the line, if behavior != CONTEXT,\n   * returns the parent state.\n   * @param {object} prop\n   * @param {number} compositeID\n   * @returns {object}\n   */\n  publicAPI.getSelectedState = () => {\n    return model.inputData[0];\n  };\n\n  const { updateActorVisibility } = publicAPI;\n  publicAPI.updateActorVisibility = (\n    renderingType = RenderingTypes.FRONT_BUFFER,\n    ctxVisible = true,\n    handleVisible = true\n  ) => {\n    if (renderingType === RenderingTypes.PICKING_BUFFER) {\n      model._pipelines.lines.actor\n        .getProperty()\n        .setLineWidth(PICKING_LINE_WIDTH);\n    } else {\n      model._pipelines.lines.actor.getProperty().setLineWidth(width);\n    }\n    updateActorVisibility(renderingType, ctxVisible, handleVisible);\n  };\n}\n\n// ----------------------------------------------------------------------------\n// Object factory\n// ----------------------------------------------------------------------------\n\nconst DEFAULT_VALUES = {};\n\n// ----------------------------------------------------------------------------\n\nexport function extend(publicAPI, model, initialValues = {}) {\n  const newDefault = { ...DEFAULT_VALUES, ...initialValues };\n  vtkWidgetRepresentation.extend(publicAPI, model, newDefault);\n\n  vtkContourRepresentation(publicAPI, model);\n}\n\n// ----------------------------------------------------------------------------\n\nexport const newInstance = macro.newInstance(\n  extend,\n  'vtkContourRepresentation'\n);\n\n// ----------------------------------------------------------------------------\n\nexport default { newInstance, extend };\n","import { Vector3 } from '@kitware/vtk.js/types';\nimport { vec3 } from 'gl-matrix';\n\nexport enum Mode {\n  Select = 'Select',\n  Freehand = 'Freehand',\n  Nudge = 'Nudge',\n  PointPlacing = 'PointPlacing',\n  Threshold = 'Threshold',\n}\n\nexport const InteractionState = {\n  Idle: 'Idle',\n  Moving: 'Moving',\n  FreehandDrawing: 'FreehandDrawing',\n  Nudging: 'Nudging',\n  PointPlacing: 'PointPlacing',\n  Thresholding: 'Thresholding',\n};\n\nexport function ignoreKey(e: any) {\n  return e.altKey || e.controlKey || e.shiftKey;\n}\n\nexport function getEventWorldPosition(model: any, callData: any) {\n  const pos = model.manipulator.handleEvent(\n    callData,\n    model._apiSpecificRenderWindow\n  );\n  return pos?.length === 3 ? pos : null;\n}\n\nexport function pickOrthogonalVector(vector: Vector3) {\n  // if there is a zero component, skip it.\n  const skipIndex = vector.findIndex((v) => v === 0) ?? 0;\n  const orthogonal = vec3.create();\n  // one possible orthogonal vector for [a,b,c] is [b,-a,0].\n  // We compute one such vector ignoring the min index, since it can be zero.\n  const c1Idx = (skipIndex + 1) % 3;\n  const c2Idx = (skipIndex + 2) % 3;\n  orthogonal[c1Idx] = vector[c2Idx];\n  orthogonal[c2Idx] = -vector[c1Idx];\n  return orthogonal;\n}\n\n/**\n * Creates an orthogonal axes from a given vector.\n * @param vector\n * @returns\n */\nexport function createOrthogonalAxes(vector: Vector3) {\n  const up = pickOrthogonalVector(vector);\n  const right = vec3.create();\n  vec3.cross(right, vector, up);\n  return { up, right };\n}\n","import { Vector2 } from '@kitware/vtk.js/types';\nimport { vec2 } from 'gl-matrix';\nimport bspline from 'b-spline';\n\nexport interface InterpolationOptions {\n  degree?: number;\n  interPointSpacing?: number;\n  closed?: boolean;\n  clamped?: boolean;\n  dt?: number;\n}\n\n/**\n * @param {number[]} points A flattened array of 2D coords.\n * @param options\n */\nexport function interpolateCurve(\n  points: number[],\n  options?: InterpolationOptions\n) {\n  const degree = options?.degree ?? 2;\n  const interPointSpacing = options?.interPointSpacing ?? 0.1;\n  const closed = options?.closed ?? false;\n  const clamped = options?.clamped ?? false;\n\n  const numOriginalPoints = points.length / 3;\n\n  const closedCurve: Vector2[] = [];\n  const prevPt = vec2.create();\n  let arcLength = 0;\n  for (let i = 0; i < points.length; i += 2) {\n    const pt = [points[i], points[i + 1]] as Vector2;\n    closedCurve.push(pt);\n\n    if (i > 0) {\n      arcLength += vec2.dist(prevPt, pt);\n    }\n    vec2.copy(prevPt, pt);\n  }\n\n  if (closed) {\n    closedCurve.push(...closedCurve.slice(0, degree + 1));\n  }\n\n  let knots: number[] | undefined;\n\n  if (clamped) {\n    knots = [];\n    const npts = closedCurve.length;\n    for (let i = 0; i < npts + degree + 1; i++) {\n      knots.push(i);\n    }\n  }\n\n  const remapT = !clamped && closed ? 1 - 1 / (numOriginalPoints + 1) : 1;\n  const dt = options?.dt ?? interPointSpacing / arcLength;\n  // TODO float32array?\n  const out: number[] = [];\n\n  for (let t = 0; t < 1; t += dt) {\n    const ipt = bspline(t * remapT, degree, closedCurve, knots);\n    out.push(ipt[0], ipt[1]);\n  }\n\n  return out;\n}\n","import macro from '@kitware/vtk.js/macros';\nimport {\n  getEventWorldPosition,\n  ignoreKey,\n  InteractionState,\n  Mode,\n} from './common';\nimport { interpolateCurve } from '../interpolation';\n\nexport default function freehandBehavior(publicAPI: any, model: any) {\n  const original = { ...publicAPI };\n\n  function isActiveMode() {\n    return publicAPI.getMode() === Mode.Freehand;\n  }\n\n  function resetModeInteraction() {\n    publicAPI.setInteractionState(InteractionState.Idle);\n    model._interactor.cancelAnimation(publicAPI);\n    publicAPI.invokeEndInteractionEvent();\n  }\n\n  publicAPI.resetInteractionState = () => {\n    if (isActiveMode() && !publicAPI.isInteractionIdle()) {\n      model.widgetState.clearPolyLine();\n      resetModeInteraction();\n    }\n    original.resetInteractionState();\n  };\n\n  publicAPI.handleLeftButtonPress = (callData: any) => {\n    if (original.handleLeftButtonPress?.(callData) === macro.EVENT_ABORT) {\n      return macro.EVENT_ABORT;\n    }\n\n    if (!isActiveMode() || !model.manipulator || ignoreKey(callData)) {\n      return macro.VOID;\n    }\n\n    // do not modify a finalized contour\n    if (model.widgetState.getFinalized()) {\n      return macro.VOID;\n    }\n\n    // This contour widget is passive, so if another widget\n    // is active, we don't do anything.\n    const activeWidget = model._widgetManager.getActiveWidget();\n    if (activeWidget && activeWidget !== publicAPI) {\n      return macro.VOID;\n    }\n\n    const worldCoords = getEventWorldPosition(model, callData);\n    if (!worldCoords) {\n      return macro.VOID;\n    }\n\n    publicAPI.setInteractionState(InteractionState.FreehandDrawing);\n    model.widgetState.clearPolyLine();\n    model.widgetState.add3dPointToPolyLine(worldCoords);\n\n    model._interactor.requestAnimation(publicAPI);\n    publicAPI.invokeStartInteractionEvent();\n    return macro.EVENT_ABORT;\n  };\n\n  publicAPI.handleMouseMove = (callData: any) => {\n    if (original.handleMouseMove?.(callData) === macro.EVENT_ABORT) {\n      return macro.EVENT_ABORT;\n    }\n\n    if (\n      !isActiveMode() ||\n      publicAPI.getInteractionState() !== InteractionState.FreehandDrawing ||\n      ignoreKey(callData)\n    ) {\n      return macro.VOID;\n    }\n\n    const coord = getEventWorldPosition(model, callData);\n    if (coord) {\n      model.widgetState.add3dPointToPolyLine(coord);\n      publicAPI.invokeInteractionEvent();\n    }\n\n    return macro.EVENT_ABORT;\n  };\n\n  publicAPI.handleLeftButtonRelease = (callData: any) => {\n    if (original.handleLeftButtonRelease?.(callData) === macro.EVENT_ABORT) {\n      return macro.EVENT_ABORT;\n    }\n\n    if (\n      !isActiveMode() ||\n      publicAPI.getInteractionState() !== InteractionState.FreehandDrawing ||\n      ignoreKey(callData)\n    ) {\n      return macro.VOID;\n    }\n\n    const coord = getEventWorldPosition(model, callData);\n    if (coord) {\n      model.widgetState.add3dPointToPolyLine(coord);\n    }\n\n    const polyLine = model.widgetState.getPolyLine();\n\n    // if there are more than 2 points\n    if (polyLine.length >= 3 * 2) {\n      // interpolate curve\n      const newCurve = interpolateCurve(model.widgetState.getPolyLine(), {\n        degree: 2,\n        interPointSpacing: 0.01,\n        closed: true,\n        clamped: false,\n      });\n      model.widgetState.setPolyLine(newCurve);\n\n      model.widgetState.setFinalized(true);\n    }\n    resetModeInteraction();\n    return macro.EVENT_ABORT;\n  };\n}\n","import { vec2 } from 'gl-matrix';\nimport { Maybe } from '@/src/types';\nimport macro from '@kitware/vtk.js/macros';\nimport { Vector2 } from '@kitware/vtk.js/types';\nimport { transform3dTo2d } from '@/src/core/contours/referencePlane';\nimport {\n  InteractionState,\n  Mode,\n  getEventWorldPosition,\n  ignoreKey,\n} from './common';\n\nconst DeselectIgnoreModes = new Set([Mode.Nudge]);\n\nexport default function selectBehavior(publicAPI: any, model: any) {\n  const original = { ...publicAPI };\n\n  let moveOrigin: Vector2 = [0, 0];\n  let origPolyLine: Maybe<number[]> = null;\n\n  macro.event(publicAPI, model, 'SelectedEvent');\n\n  const delta = vec2.create();\n\n  function translateContour(to: Vector2) {\n    if (!origPolyLine) return;\n\n    vec2.sub(delta, to, moveOrigin);\n    const polyLine = model.widgetState.getPolyLine();\n    for (let i = 0; i < polyLine.length; i += 2) {\n      polyLine[i] = origPolyLine[i] + delta[0];\n      polyLine[i + 1] = origPolyLine[i + 1] + delta[1];\n    }\n    model.widgetState.modified();\n  }\n\n  function resetModeInteraction() {\n    publicAPI.setInteractionState(InteractionState.Idle);\n    model._interactor.cancelAnimation(publicAPI);\n    publicAPI.invokeEndInteractionEvent();\n  }\n\n  publicAPI.resetInteractionState = () => {\n    if (publicAPI.getInteractionState() === InteractionState.Moving) {\n      resetModeInteraction();\n    }\n    original.resetInteractionState();\n  };\n\n  publicAPI.handleLeftButtonPress = (callData: any) => {\n    if (original.handleLeftButtonPress?.(callData) === macro.EVENT_ABORT) {\n      return macro.EVENT_ABORT;\n    }\n\n    if (ignoreKey(callData)) {\n      return macro.VOID;\n    }\n\n    if (model._widgetManager.getActiveWidget() !== publicAPI) {\n      if (!DeselectIgnoreModes.has(publicAPI.getMode())) {\n        // deselect, since we clicked on something other than the widget\n        publicAPI.invokeSelectedEvent(false);\n      }\n      return macro.VOID;\n    }\n\n    publicAPI.invokeSelectedEvent(true);\n\n    const worldCoords = getEventWorldPosition(model, callData);\n    if (!worldCoords) {\n      return macro.EVENT_ABORT;\n    }\n\n    moveOrigin = transform3dTo2d(\n      worldCoords,\n      model.widgetState.getReferencePlane()\n    );\n    origPolyLine = [...model.widgetState.getPolyLine()];\n\n    // also enable the ability to move the contour\n    publicAPI.setInteractionState(InteractionState.Moving);\n    model._interactor.requestAnimation(publicAPI);\n    publicAPI.invokeStartInteractionEvent();\n\n    return macro.EVENT_ABORT;\n  };\n\n  publicAPI.handleMouseMove = (callData: any) => {\n    if (original.handleMouseMove?.(callData) === macro.EVENT_ABORT) {\n      return macro.EVENT_ABORT;\n    }\n\n    if (\n      !publicAPI.isSelected() ||\n      publicAPI.getInteractionState() !== InteractionState.Moving ||\n      ignoreKey(callData)\n    ) {\n      return macro.VOID;\n    }\n\n    const coord = getEventWorldPosition(model, callData);\n    if (coord) {\n      translateContour(\n        transform3dTo2d(coord, model.widgetState.getReferencePlane())\n      );\n      publicAPI.invokeInteractionEvent();\n    }\n\n    return macro.EVENT_ABORT;\n  };\n\n  publicAPI.handleLeftButtonRelease = (callData: any) => {\n    if (original.handleLeftButtonRelease?.(callData) === macro.EVENT_ABORT) {\n      return macro.EVENT_ABORT;\n    }\n\n    if (\n      publicAPI.getInteractionState() !== InteractionState.Moving ||\n      ignoreKey(callData)\n    ) {\n      return macro.VOID;\n    }\n\n    const coord = getEventWorldPosition(model, callData);\n    if (coord) {\n      translateContour(\n        transform3dTo2d(coord, model.widgetState.getReferencePlane())\n      );\n    }\n\n    resetModeInteraction();\n    return macro.EVENT_ABORT;\n  };\n}\n","import { Vector2, Vector3 } from '@kitware/vtk.js/types';\nimport { vec2, vec3 } from 'gl-matrix';\nimport {\n  ReferencePlane,\n  transform2dTo3d,\n  transform3dTo2d,\n} from './referencePlane';\n\nexport interface NudgeCircle {\n  center: Vector3;\n  radius: number;\n}\n\n/**\n * Addition in the ring of integers modulo N.\n * @param a\n * @param b\n * @param n\n * @returns\n */\nfunction addModuloN(a: number, b: number, n: number) {\n  return (a + b) % n;\n}\n\n/* eslint-disable no-param-reassign */\nfunction calcMidpoint(out: vec2, v1: vec2, v2: vec2) {\n  out[0] = (v1[0] + v2[0]) / 2;\n  out[1] = (v1[1] + v2[1]) / 2;\n}\n/* eslint-enable no-param-reassign */\n\n/**\n * Nudges a contour with a circle of a given radius.\n *\n * Points that are inside the circle get nudged to the circle's border.\n *\n * @param {number[]} points 2D points in flattened array\n * @param {NudgeCircle} nudgeCircle nudging circle in 3D\n * @param refPlane reference plane\n */\nfunction nudgePoints(\n  points: number[],\n  nudgeCircle: NudgeCircle,\n  refPlane: ReferencePlane\n) {\n  const { radius, center } = nudgeCircle;\n  const nudgeRadius2 = radius ** 2;\n  const nudgeVec = vec3.create();\n  const point: Vector3 = [0, 0, 0];\n  const pt2d: Vector2 = [0, 0];\n  for (let i = 0; i < points.length; i += 2) {\n    vec2.set(pt2d, points[i], points[i + 1]);\n    transform2dTo3d(pt2d, refPlane, point);\n\n    const dist2 = vec3.sqrDist(point, center);\n    if (dist2 >= nudgeRadius2) {\n      // eslint-disable-next-line no-continue\n      continue;\n    }\n\n    vec3.sub(nudgeVec, point, center);\n    vec3.scale(nudgeVec, nudgeVec, Math.sqrt(nudgeRadius2 / dist2));\n    vec3.add(point, center, nudgeVec);\n\n    transform3dTo2d(point, refPlane, pt2d);\n\n    /* eslint-disable */\n    points[i] = pt2d[0];\n    points[i + 1] = pt2d[1];\n    /* eslint-enable */\n  }\n}\n\n/**\n * Adjusts contour points to stay within a desired spacing range.\n * @param points\n * @param minPointSpacing\n * @param maxPointSpacing\n * @returns\n */\nfunction adjustPoints(\n  points: number[],\n  minPointSpacing: number,\n  maxPointSpacing: number\n) {\n  if (points.length < 2) return;\n\n  const minSpacing2 = minPointSpacing ** 2;\n  const maxSpacing2 = maxPointSpacing ** 2;\n\n  const curVec = vec2.create();\n  const nextVec = vec2.create();\n  const midpoint = vec2.create();\n  const intermediate = vec2.create();\n\n  let curIdx = 0;\n  let crossed = false;\n  let stop = false;\n  do {\n    let newIdx = curIdx;\n    const nextIdx = addModuloN(curIdx, 2, points.length);\n\n    vec2.set(curVec, points[curIdx], points[curIdx + 1]);\n    vec2.set(nextVec, points[nextIdx], points[nextIdx + 1]);\n\n    const dist2 = vec2.sqrDist(curVec, nextVec);\n\n    if (dist2 < minSpacing2) {\n      // merge cur and next at the midpoint\n      // TODO what to do if every point is closer than minPointSpacing?\n      // It's possible to collapse into a singular point.\n      calcMidpoint(midpoint, curVec, nextVec);\n      points.splice(nextIdx, 2);\n      points.splice(curIdx, 2);\n      points.splice(curIdx, 0, ...midpoint);\n    } else if (dist2 > maxSpacing2) {\n      // insert new points\n      const numNewPoints = Math.ceil(Math.sqrt(dist2 / maxSpacing2));\n      const tdelta = 1 / (numNewPoints + 1);\n      const newPoints = [];\n      for (let t = tdelta; t < 1; t += tdelta) {\n        vec2.lerp(intermediate, curVec, nextVec, t);\n        newPoints.push(...intermediate);\n      }\n      // TODO nudge new points\n      points.splice(nextIdx, 0, ...newPoints);\n      // continue processing at nextVec\n      newIdx = addModuloN(curIdx, newPoints.length + 2, points.length);\n    } else {\n      newIdx = addModuloN(curIdx, 2, points.length);\n    }\n\n    // We handle the [last point, first point] segment by stopping\n    // after we've processed one more segment after crossing.\n    stop = crossed;\n    crossed = newIdx < curIdx;\n    curIdx = newIdx;\n  } while (!stop);\n}\n\n/**\n * Nudges a contour.\n * @param contour\n * @param nudgeCircle\n * @param minPointSpacing\n * @param maxPointSpacing\n */\nexport function nudgeContour(\n  contour: number[],\n  nudgeCircle: NudgeCircle,\n  referencePlane: ReferencePlane,\n  minPointSpacing = 0.0001,\n  maxPointSpacing = 0.1\n) {\n  nudgePoints(contour, nudgeCircle, referencePlane);\n  adjustPoints(contour, minPointSpacing, maxPointSpacing);\n  // TODO handle intersections\n}\n\n/**\n * Finds the closest point along the contour.\n * @param contour\n * @param point\n * @returns the index of the 2-tuple in the provided contour\n */\nexport function closestPointAlongContour(contour: number[], point: Vector2) {\n  let closestIndex = 0;\n  let bestDist2 = Infinity;\n  const vec = vec2.create();\n  for (let i = 0; i < contour.length; i += 2) {\n    vec2.set(vec, contour[i], contour[i + 1]);\n    const d2 = vec2.sqrDist(vec, point);\n    if (d2 < bestDist2) {\n      closestIndex = i;\n      bestDist2 = d2;\n    }\n  }\n\n  return closestIndex;\n}\n","import macro from '@kitware/vtk.js/macros';\nimport { Vector3 } from '@kitware/vtk.js/types';\nimport {\n  closestPointAlongContour,\n  nudgeContour,\n} from '@/src/core/contours/nudge';\nimport {\n  transform2dTo3d,\n  transform3dTo2d,\n} from '@/src/core/contours/referencePlane';\nimport { vec3 } from 'gl-matrix';\nimport {\n  InteractionState,\n  Mode,\n  getEventWorldPosition,\n  ignoreKey,\n} from './common';\nimport { ContourWidgetState } from '..';\n\n// Determines the gap between the nudge circle and the contour.\nconst RADIUS_GAP_PERCENT = 0.95;\n\ninterface Model {\n  _radius: number;\n  widgetState: ContourWidgetState;\n\n  [name: string]: any;\n}\n\nexport default function nudgeBehavior(publicAPI: any, model: Model) {\n  const original = { ...publicAPI };\n\n  model._radius = 1;\n\n  function isActiveMode() {\n    return publicAPI.getMode() === Mode.Nudge;\n  }\n\n  function doNudge(center: Vector3) {\n    const polyLine = model.widgetState.getPolyLine();\n    const refPlane = model.widgetState.getReferencePlane();\n    nudgeContour(polyLine, { center, radius: model._radius }, refPlane);\n    model.widgetState.modified();\n  }\n\n  function resetModeInteraction() {\n    const circleContextState = publicAPI.getWidgetState().getCircleContext();\n    circleContextState.setVisible(false);\n\n    publicAPI.setInteractionState(InteractionState.Idle);\n    model._interactor.cancelAnimation(publicAPI);\n    publicAPI.invokeEndInteractionEvent();\n  }\n\n  publicAPI.resetInteractionState = () => {\n    if (isActiveMode() && !publicAPI.isInteractionIdle()) {\n      resetModeInteraction();\n    }\n    original.resetInteractionState();\n  };\n\n  publicAPI.handleLeftButtonPress = (callData: any) => {\n    if (original.handleLeftButtonPress?.(callData) === macro.EVENT_ABORT) {\n      return macro.EVENT_ABORT;\n    }\n\n    if (\n      !isActiveMode() ||\n      !publicAPI.isSelected() ||\n      !model.manipulator ||\n      ignoreKey(callData)\n    ) {\n      return macro.VOID;\n    }\n\n    // This contour widget is passive, so if another widget\n    // is active, we don't do anything.\n    const activeWidget = model._widgetManager.getActiveWidget();\n    if (activeWidget && activeWidget !== publicAPI) {\n      return macro.VOID;\n    }\n\n    const worldCoords = getEventWorldPosition(model, callData);\n    if (!worldCoords) {\n      return macro.VOID;\n    }\n\n    // set the radius\n    const { widgetState } = model;\n    const polyLine = widgetState.getPolyLine();\n    const refPlane = widgetState.getReferencePlane();\n    const closestPtIndex = closestPointAlongContour(\n      polyLine,\n      transform3dTo2d(worldCoords, refPlane)\n    );\n\n    const distance = vec3.dist(\n      worldCoords,\n      transform2dTo3d(\n        [polyLine[closestPtIndex], polyLine[closestPtIndex + 1]],\n        refPlane\n      )\n    );\n    model._radius = distance * RADIUS_GAP_PERCENT;\n\n    // setup the nudge circle visualization\n    const normal = model.manipulator.getNormal();\n    const up = model._renderer.getActiveCamera().getViewUp();\n    const horiz = vec3.create();\n    vec3.cross(horiz, up, normal);\n\n    const circleContextState = widgetState.getCircleContext();\n    circleContextState.setDirection(normal);\n    circleContextState.setUp(up);\n    circleContextState.setRight(horiz);\n    circleContextState.setOrigin(worldCoords);\n    circleContextState.setScale3([model._radius, model._radius, 1]);\n    circleContextState.setVisible(true);\n\n    publicAPI.setInteractionState(InteractionState.Nudging);\n\n    model._interactor.requestAnimation(publicAPI);\n    publicAPI.invokeStartInteractionEvent();\n    return macro.EVENT_ABORT;\n  };\n\n  publicAPI.handleMouseMove = (callData: any) => {\n    if (original.handleMouseMove?.(callData) === macro.EVENT_ABORT) {\n      return macro.EVENT_ABORT;\n    }\n\n    if (\n      !isActiveMode() ||\n      !publicAPI.isSelected() ||\n      publicAPI.getInteractionState() !== InteractionState.Nudging ||\n      ignoreKey(callData)\n    ) {\n      return macro.VOID;\n    }\n\n    const coord = getEventWorldPosition(model, callData);\n    if (coord) {\n      publicAPI.getWidgetState().getCircleContext().setOrigin(coord);\n      doNudge(coord);\n      publicAPI.invokeInteractionEvent();\n    }\n\n    return macro.EVENT_ABORT;\n  };\n\n  publicAPI.handleLeftButtonRelease = (callData: any) => {\n    if (original.handleLeftButtonRelease?.(callData) === macro.EVENT_ABORT) {\n      return macro.EVENT_ABORT;\n    }\n\n    if (\n      !isActiveMode() ||\n      !publicAPI.isSelected() ||\n      publicAPI.getInteractionState() !== InteractionState.Nudging ||\n      ignoreKey(callData)\n    ) {\n      return macro.VOID;\n    }\n\n    const coord = getEventWorldPosition(model, callData);\n    if (coord) {\n      doNudge(coord);\n    }\n\n    resetModeInteraction();\n\n    return macro.EVENT_ABORT;\n  };\n}\n","import macro from '@kitware/vtk.js/macros';\nimport { Vector2 } from '@kitware/vtk.js/types';\nimport { transform3dTo2d } from '@/src/core/contours/referencePlane';\nimport {\n  getEventWorldPosition,\n  ignoreKey,\n  InteractionState,\n  Mode,\n} from './common';\nimport { interpolateCurve } from '../interpolation';\n\nexport default function pointPlacingBehavior(publicAPI: any, model: any) {\n  const original = { ...publicAPI };\n\n  function isActiveMode() {\n    return publicAPI.getMode() === Mode.PointPlacing;\n  }\n\n  function resetModeInteraction() {\n    model._widgetManager.releaseFocus();\n    publicAPI.setInteractionState(InteractionState.Idle);\n    model._interactor.cancelAnimation(publicAPI);\n    publicAPI.invokeEndInteractionEvent();\n  }\n\n  function updateLastPoint(coord: Vector2) {\n    const polyLine = model.widgetState.getPolyLine();\n    // assumes polyLine.length >= 2\n    const last = polyLine.length - 1;\n    /* eslint-disable prefer-destructuring */\n    polyLine[last - 1] = coord[0];\n    polyLine[last] = coord[1];\n    /* eslint-enable prefer-destructuring */\n    model.widgetState.modified();\n  }\n\n  function dropLastPoint() {\n    const polyLine = model.widgetState.getPolyLine();\n    polyLine.splice(-2, 2);\n    model.widgetState.modified();\n  }\n\n  publicAPI.resetInteractionState = () => {\n    if (isActiveMode() && !publicAPI.isInteractionIdle()) {\n      model.widgetState.clearPolyLine();\n      resetModeInteraction();\n    }\n    original.resetInteractionState();\n  };\n\n  publicAPI.handleLeftButtonPress = (callData: any) => {\n    if (original.handleLeftButtonPress?.(callData) === macro.EVENT_ABORT) {\n      return macro.EVENT_ABORT;\n    }\n\n    if (!isActiveMode() || !model.manipulator || ignoreKey(callData)) {\n      return macro.VOID;\n    }\n\n    // do not modify a finalized contour\n    if (model.widgetState.getFinalized()) {\n      return macro.VOID;\n    }\n\n    // This contour widget is passive, so if another widget\n    // is active, we don't do anything.\n    const activeWidget = model._widgetManager.getActiveWidget();\n    if (activeWidget && activeWidget !== publicAPI) {\n      return macro.VOID;\n    }\n\n    const worldCoords = getEventWorldPosition(model, callData);\n    if (!worldCoords) {\n      return macro.VOID;\n    }\n\n    const point2d = transform3dTo2d(\n      worldCoords,\n      model.widgetState.getReferencePlane()\n    );\n\n    // we are placing a new point!\n    if (publicAPI.getInteractionState() === InteractionState.PointPlacing) {\n      updateLastPoint(point2d);\n      model.widgetState.add2dPointToPolyLine(point2d);\n\n      publicAPI.invokeInteractionEvent();\n    } else {\n      // starting a new contour\n      model._widgetManager.grabFocus(publicAPI);\n\n      publicAPI.setInteractionState(InteractionState.PointPlacing);\n      model.widgetState.setFinalized(false);\n      model.widgetState.clearPolyLine();\n      model.widgetState.add2dPointToPolyLine(point2d);\n\n      // add a second point, since the last point is used as the cursor handle\n      model.widgetState.add2dPointToPolyLine(point2d);\n\n      model._interactor.requestAnimation(publicAPI);\n      publicAPI.invokeStartInteractionEvent();\n    }\n\n    return macro.EVENT_ABORT;\n  };\n\n  publicAPI.handleMouseMove = (callData: any) => {\n    if (original.handleMouseMove?.(callData) === macro.EVENT_ABORT) {\n      return macro.EVENT_ABORT;\n    }\n\n    if (\n      !isActiveMode() ||\n      publicAPI.getInteractionState() !== InteractionState.PointPlacing ||\n      ignoreKey(callData)\n    ) {\n      return macro.VOID;\n    }\n\n    const coord = getEventWorldPosition(model, callData);\n    if (coord) {\n      const point2d = transform3dTo2d(\n        coord,\n        model.widgetState.getReferencePlane()\n      );\n      updateLastPoint(point2d);\n      publicAPI.invokeInteractionEvent();\n    }\n\n    return macro.EVENT_ABORT;\n  };\n\n  publicAPI.handleRightButtonPress = (callData: any) => {\n    if (original.handleRightButtonPress?.(callData) === macro.EVENT_ABORT) {\n      return macro.EVENT_ABORT;\n    }\n\n    if (\n      !isActiveMode() ||\n      publicAPI.getInteractionState() !== InteractionState.PointPlacing ||\n      ignoreKey(callData)\n    ) {\n      return macro.VOID;\n    }\n\n    dropLastPoint();\n\n    if (model.widgetState.getPolyLineLength() <= 2) {\n      model.widgetState.clearPolyLine();\n    } else {\n      // interpolate curve\n      const newCurve = interpolateCurve(model.widgetState.getPolyLine(), {\n        degree: 2,\n        interPointSpacing: 0.01,\n        closed: true,\n        clamped: false,\n      });\n      model.widgetState.setPolyLine(newCurve);\n      model.widgetState.setFinalized(true);\n    }\n\n    resetModeInteraction();\n    return macro.EVENT_ABORT;\n  };\n}\n","/* eslint-disable prefer-destructuring */\n\nimport macro from '@kitware/vtk.js/macros';\nimport vtkPolyData from '@kitware/vtk.js/Common/DataModel/PolyData';\nimport vtkEdgeLocator from '@kitware/vtk.js/Common/DataModel/EdgeLocator';\n\nimport vtkCaseTable from '@kitware/vtk.js/Filters/General/ImageMarchingSquares/caseTable';\n\nconst { vtkErrorMacro } = macro;\n\n/**\n * Modified vtkImageMarchingSquares from vtk.js.\n */\n\n// ----------------------------------------------------------------------------\n// vtkImageMarchingSquares methods\n// ----------------------------------------------------------------------------\n\nfunction vtkImageMarchingSquares(publicAPI, model) {\n  // Set our className\n  model.classHierarchy.push('vtkImageMarchingSquares');\n\n  publicAPI.getContourValues = () => model.contourValues;\n  publicAPI.setContourValues = (cValues) => {\n    model.contourValues = cValues;\n    publicAPI.modified();\n  };\n\n  const ids = [];\n  const pixelScalars = [];\n  const pixelPts = [];\n  const edgeLocator = vtkEdgeLocator.newInstance();\n\n  // Retrieve scalars and pixel coordinates. i-j-k is origin of pixel.\n  publicAPI.getPixelScalars = (i, j, k, slice, dims, origin, spacing, s) => {\n    // First get the indices for the pixel\n    // i,j,k is the smallest index of the examined quad\n    ids[0] = k * slice + j * dims[0] + i; // i, j, k\n    ids[1] = ids[0] + 1; // i+1, j, k\n    ids[2] = ids[0] + dims[0]; // i, j+1, k\n    ids[3] = ids[2] + 1; // i+1, j+1, k\n\n    // Invariants based on the looping pattern:\n    // i in [-1, dims[0])\n    // j in [-1, dims[1])\n    const iInBounds = i >= 0;\n    const jInBounds = j >= 0;\n    const i1InBounds = i + 1 < dims[0];\n    const j1InBounds = j + 1 < dims[1];\n\n    // TODO configurable background color\n    pixelScalars[0] = iInBounds && jInBounds ? s[ids[0]] : 0;\n    pixelScalars[1] = i1InBounds && jInBounds ? s[ids[1]] : 0;\n    pixelScalars[2] = iInBounds && j1InBounds ? s[ids[2]] : 0;\n    pixelScalars[3] = i1InBounds && j1InBounds ? s[ids[3]] : 0;\n  };\n\n  // Retrieve pixel coordinates. i-j-k is origin of pixel.\n  publicAPI.getPixelPoints = (i, j, k, dims, origin, spacing) => {\n    // (i,i+1),(j,j+1),(k,k+1) - i varies fastest; then j; then k\n    pixelPts[0] = origin[0] + i * spacing[0]; // 0\n    pixelPts[1] = origin[1] + j * spacing[1];\n\n    pixelPts[2] = pixelPts[0] + spacing[0]; // 1\n    pixelPts[3] = pixelPts[1];\n\n    pixelPts[4] = pixelPts[0]; // 2\n    pixelPts[5] = pixelPts[1] + spacing[1];\n\n    pixelPts[6] = pixelPts[2]; // 3\n    pixelPts[7] = pixelPts[5];\n  };\n\n  publicAPI.produceLines = (\n    cVal,\n    i,\n    j,\n    k,\n    slice,\n    dims,\n    origin,\n    spacing,\n    scalars,\n    points,\n    lines\n  ) => {\n    const CASE_MASK = [1, 2, 8, 4]; // case table is actually for quad\n    const xyz = [];\n    let pId;\n\n    publicAPI.getPixelScalars(i, j, k, slice, dims, origin, spacing, scalars);\n\n    let index = 0;\n    for (let idx = 0; idx < 4; idx++) {\n      if (pixelScalars[idx] >= cVal) {\n        index |= CASE_MASK[idx]; // eslint-disable-line no-bitwise\n      }\n    }\n\n    const pixelLines = vtkCaseTable.getCase(index);\n    if (pixelLines[0] < 0) {\n      return; // don't get the pixel coordinates, nothing to do\n    }\n\n    publicAPI.getPixelPoints(i, j, k, dims, origin, spacing);\n\n    const z = origin[2] + k * spacing[2];\n    for (let idx = 0; pixelLines[idx] >= 0; idx += 2) {\n      lines.push(2);\n      for (let eid = 0; eid < 2; eid++) {\n        const edgeVerts = vtkCaseTable.getEdge(pixelLines[idx + eid]);\n        pId = undefined;\n        if (model.mergePoints) {\n          pId = edgeLocator.isInsertedEdge(\n            ids[edgeVerts[0]],\n            ids[edgeVerts[1]]\n          )?.value;\n        }\n        if (pId === undefined) {\n          // CHANGE: hard-code to 0.5, ignoring interpolation.\n          const t = 0.5;\n\n          const x0Offset = edgeVerts[0] * 2;\n          const x00 = pixelPts[x0Offset];\n          const x01 = pixelPts[x0Offset + 1];\n          const x1Offset = edgeVerts[1] * 2;\n          const x10 = pixelPts[x1Offset];\n          const x11 = pixelPts[x1Offset + 1];\n\n          xyz[0] = x00 + t * (x10 - x00);\n          xyz[1] = x01 + t * (x11 - x01);\n          pId = points.length / 3;\n          points.push(xyz[0], xyz[1], z);\n\n          if (model.mergePoints) {\n            edgeLocator.insertEdge(ids[edgeVerts[0]], ids[edgeVerts[1]], pId);\n          }\n        }\n        lines.push(pId);\n      }\n    }\n  };\n\n  publicAPI.requestData = (inData, outData) => {\n    // implement requestData\n    const input = inData[0];\n\n    if (!input) {\n      vtkErrorMacro('Invalid or missing input');\n      return;\n    }\n\n    // Retrieve output and volume data\n    const origin = input.getOrigin();\n    const spacing = input.getSpacing();\n    const dims = input.getDimensions();\n    const s = input.getPointData().getScalars().getData();\n\n    // Points - dynamic array\n    const pBuffer = [];\n\n    // Cells - dynamic array\n    const lBuffer = [];\n\n    // Ensure slice is valid\n    const slice = dims[0] * dims[1];\n    let k = Math.round(model.slice);\n    if (k >= dims[2]) {\n      k = 0;\n    }\n\n    // Loop over all contour values, and then pixels, determine case and process\n    for (let cv = 0; cv < model.contourValues.length; ++cv) {\n      // Handle the image border by adding a 1 pixel border\n      // of background color.\n      // getPixelScalars handles the out-of-bounds pixel accesses.\n      for (let j = -1; j < dims[1]; ++j) {\n        for (let i = -1; i < dims[0]; ++i) {\n          publicAPI.produceLines(\n            model.contourValues[cv],\n            i,\n            j,\n            k,\n            slice,\n            dims,\n            origin,\n            spacing,\n            s,\n            pBuffer,\n            lBuffer\n          );\n        }\n      }\n      edgeLocator.initialize();\n    }\n\n    // Update output\n    const polydata = vtkPolyData.newInstance();\n    polydata.getPoints().setData(new Float32Array(pBuffer), 3);\n    polydata.getLines().setData(new Uint32Array(lBuffer));\n    outData[0] = polydata;\n  };\n}\n\n// ----------------------------------------------------------------------------\n// Object factory\n// ----------------------------------------------------------------------------\n\nconst DEFAULT_VALUES = {\n  contourValues: [],\n  slice: 0,\n  mergePoints: false,\n};\n\n// ----------------------------------------------------------------------------\n\nexport function extend(publicAPI, model, initialValues = {}) {\n  Object.assign(model, DEFAULT_VALUES, initialValues);\n\n  // Make this a VTK object\n  macro.obj(publicAPI, model);\n\n  // Also make it an algorithm with one input and one output\n  macro.algo(publicAPI, model, 1, 1);\n\n  macro.setGet(publicAPI, model, ['slice', 'mergePoints']);\n\n  // Object specific methods\n  macro.algo(publicAPI, model, 1, 1);\n  vtkImageMarchingSquares(publicAPI, model);\n}\n\n// ----------------------------------------------------------------------------\n\nexport const newInstance = macro.newInstance(extend, 'vtkImageMarchingSquares');\n\n// ----------------------------------------------------------------------------\n\nexport default { newInstance, extend };\n","import vtkDataArray from '@kitware/vtk.js/Common/Core/DataArray';\nimport vtkImageData from '@kitware/vtk.js/Common/DataModel/ImageData';\nimport vtkPolyData from '@kitware/vtk.js/Common/DataModel/PolyData';\nimport { Vector2, Vector3 } from '@kitware/vtk.js/types';\nimport { mat4, vec2, vec3 } from 'gl-matrix';\nimport vtkImageMarchingSquares from '@/src/vtk/ImageMarchingSquares';\n\nexport type BinaryMask = Uint8Array;\n\ntype SliceAxis = 0 | 1 | 2;\n\nexport const FILLED = 2;\nexport const VISITED = 1;\nexport const EMPTY = 0;\n\nfunction getSliceDimensions(\n  baseDimensions: Vector3,\n  sliceAxis: SliceAxis\n): Vector2 {\n  const sliceDims = [...baseDimensions];\n  sliceDims.splice(sliceAxis, 1);\n  return sliceDims as Vector2;\n}\n\nexport function createBinaryMask(\n  baseImage: vtkImageData,\n  sliceAxis: SliceAxis\n): vtkImageData {\n  const [iDim, jDim] = getSliceDimensions(baseImage.getDimensions(), sliceAxis);\n  const pixels = new Uint8Array(iDim * jDim);\n  const dataArray = vtkDataArray.newInstance({\n    values: pixels,\n    numberOfComponents: 1,\n  });\n  const image = vtkImageData.newInstance();\n  image.setDimensions([iDim, jDim, 1]);\n  image.getPointData().setScalars(dataArray);\n  return image;\n}\n\nexport function ijToIjk(\n  ij: Vector2,\n  sliceAxis: SliceAxis,\n  slice: number\n): Vector3 {\n  const ijk = [...ij];\n  ijk.splice(sliceAxis, 0, slice);\n  return ijk as Vector3;\n}\n\nexport function ijkToIj(ijk: Vector3, sliceAxis: SliceAxis): Vector2 {\n  const ij = [...ijk];\n  ij.splice(sliceAxis, 1);\n  return ij as Vector2;\n}\n\nexport function directDistance2D(pt1: Vector2, pt2: Vector2) {\n  return vec2.dist(pt1, pt2);\n}\n\nexport function manhattanDistance2D(pt1: Vector2, pt2: Vector2) {\n  return Math.abs(pt1[0] - pt2[0]) + Math.abs(pt1[1] - pt2[1]);\n}\n\n/**\n * Creates a get/set pixel accessor for a contiguous image array.\n *\n * Coordinates must be IJK integral coordinates.\n *\n * No bounds check is done.\n * @param dims\n * @returns\n */\nfunction createImagePixelAccessor(image: vtkImageData, dims = 3) {\n  if (dims > 3) {\n    throw new Error('Cannot support dim > 3');\n  }\n\n  const pixels = image.getPointData().getScalars().getData();\n\n  const [iDim, jDim, kDim] = image.getDimensions();\n  const ijSkip = dims === 3 ? iDim * jDim : 0;\n  const iSkip = dims >= 2 ? iDim : 0;\n\n  return {\n    get: (coord: number[]) => {\n      const i = coord[0] ?? 0;\n      const j = coord[1] ?? 0;\n      const k = coord[2] ?? 0;\n      return pixels[k * ijSkip + j * iSkip + i];\n    },\n    set: (coord: number[], value: number) => {\n      const i = coord[0] ?? 0;\n      const j = coord[1] ?? 0;\n      const k = coord[2] ?? 0;\n      pixels[k * ijSkip + j * iSkip + i] = value;\n    },\n    inBounds: (coord: number[]) => {\n      const i = coord[0] ?? 0;\n      const j = coord[1] ?? 0;\n      const k = coord[2] ?? 0;\n      return i >= 0 && i < iDim && j >= 0 && j < jDim && k >= 0 && k < kDim;\n    },\n    fill: (value: number) => {\n      pixels.fill(value);\n    },\n  };\n}\n\n/**\n * Thresholds an image.\n *\n * Produced mask image will have three values:\n * - EMPTY (0): background\n * - VISITED (1): background (outside of threshold), but was visited.\n * - FILLED (2): foreground, part of threshold.\n * @param baseImage\n * @param sliceAxis 0 | 1 | 2\n * @param slice IJK slice as integer\n * @param maskImage\n * @param seedPoint IJK integral coordinates\n * @param thresholdRadius\n * @param maxDistance\n */\nexport function thresholdSlice(\n  baseImage: vtkImageData,\n  sliceAxis: SliceAxis,\n  slice: number,\n  maskImage: vtkImageData,\n  seedPoint: Vector3,\n  thresholdRadius: number,\n  maxDistance: number,\n  distanceFunction = directDistance2D\n) {\n  const basePixels = createImagePixelAccessor(baseImage, 3);\n  const maskPixels = createImagePixelAccessor(maskImage, 2);\n  const seedPointIj = ijkToIj(seedPoint, sliceAxis);\n  const seedValue = basePixels.get(seedPoint);\n  const minValue = seedValue - thresholdRadius;\n  const maxValue = seedValue + thresholdRadius;\n\n  maskPixels.fill(EMPTY);\n\n  const queue = [seedPointIj];\n  while (queue.length) {\n    const ij = queue.shift()!;\n\n    if (\n      !maskPixels.inBounds(ij) ||\n      maskPixels.get(ij) !== 0 ||\n      distanceFunction(seedPointIj, ij) > maxDistance\n    ) {\n      // eslint-disable-next-line no-continue\n      continue;\n    }\n\n    // visited\n    maskPixels.set(ij, VISITED);\n\n    const ijk = ijToIjk(ij, sliceAxis, slice);\n    const pixel = basePixels.get(ijk);\n\n    if (pixel < minValue || pixel > maxValue) {\n      // eslint-disable-next-line no-continue\n      continue;\n    }\n\n    // masked\n    maskPixels.set(ij, FILLED);\n\n    const [i, j] = ij;\n    for (let di = -1; di <= 1; di++) {\n      for (let dj = -1; dj <= 1; dj++) {\n        // 4 neighbor results in fewer spurious contours\n        if ((!di && dj) || (di && !dj)) {\n          queue.push([i + di, j + dj]);\n        }\n      }\n    }\n  }\n}\n\nexport function maskToBoundaryLines(mask: vtkImageData) {\n  const msquares = vtkImageMarchingSquares.newInstance({ mergePoints: true });\n  msquares.setContourValues([FILLED]);\n  msquares.setInputData(mask);\n  return msquares.getOutputData() as vtkPolyData;\n}\n\nconst SliceAxisTransforms: Record<0 | 1 | 2, mat4> = {\n  0: mat4.fromValues(0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1),\n  1: mat4.fromValues(1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1),\n  2: mat4.fromValues(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1),\n};\n\nexport function transformPolyDataToSlice(\n  pd: vtkPolyData,\n  slice: number,\n  ijkSliceAxis: 0 | 1 | 2,\n  indexToWorld: mat4\n) {\n  const points = pd.getPoints().getData();\n  const transform = mat4.create();\n  // points start on k=0 plane\n  mat4.fromTranslation(transform, [0, 0, slice]);\n  // rotate to correct slice axis\n  mat4.mul(transform, SliceAxisTransforms[ijkSliceAxis], transform);\n  mat4.mul(transform, indexToWorld, transform);\n\n  const pt = vec3.create();\n  for (let i = 0; i < points.length; i += 3) {\n    vec3.set(pt, points[i], points[i + 1], points[i + 2]);\n    vec3.transformMat4(pt, pt, transform);\n    [points[i], points[i + 1], points[i + 2]] = pt;\n  }\n}\n","/* eslint-disable prefer-destructuring */\n/* eslint-disable no-continue */\nimport vtkPolyData from '@kitware/vtk.js/Common/DataModel/PolyData';\nimport { vtkAlgorithm, vtkObject } from '@kitware/vtk.js/interfaces';\nimport macro from '@kitware/vtk.js/macro';\nimport { Vector2 } from '@kitware/vtk.js/types';\nimport hull from 'hull.js';\n\ninterface CellPoints {\n  cellType: number;\n  cellPointIds: number[] | null;\n}\n\nenum Dir {\n  Forward = 1,\n  Backward = -1,\n}\n\ninterface ParameterizedPoint {\n  t: number;\n  ptId: number;\n}\n\ninterface vtkContourLoopExtraction extends vtkObject, vtkAlgorithm {\n  getConvexHull(): boolean;\n  setConvexHull(ch: boolean): boolean;\n  setMergeContours(merge: boolean): boolean;\n  getMergeContours(): boolean;\n  extractContours(input: vtkPolyData, output: vtkPolyData): void;\n  computeConvexHull(input: vtkPolyData, output: vtkPolyData): void;\n  requestData(inData: [vtkPolyData], outData: [vtkPolyData]): void;\n  traverseLoop(\n    pd: vtkPolyData,\n    dir: Dir,\n    startLineId: number,\n    startPtId: number,\n    loopPoints: ParameterizedPoint[]\n  ): number;\n}\n\ninterface Model {\n  [key: string]: any;\n}\n\n/**\n * Implementation taken from vtkContourLoopExtraction.cxx in the VTK project.\n *\n * Added the mergeContours flag.\n */\nfunction vtkContourLoopExtractionCtor(\n  publicAPI: vtkContourLoopExtraction,\n  model: Model\n) {\n  model.classHierarchy.push('vtkContourLoopExtraction');\n\n  const visited = new Set<number>();\n\n  publicAPI.traverseLoop = (pd, dir, startLineId, startPtId, loopPoints) => {\n    let lineId = startLineId;\n    let lastPtId = startPtId;\n    let terminated = false;\n    let numInserted = 0;\n\n    while (!terminated) {\n      const { cellPointIds } = pd.getCellPoints(lineId) as CellPoints;\n      if (!cellPointIds) continue;\n\n      lastPtId =\n        cellPointIds[0] !== lastPtId ? cellPointIds[0] : cellPointIds[1];\n      numInserted++;\n\n      // parametric point value\n      const t = dir * numInserted;\n      loopPoints.push({ t, ptId: lastPtId });\n\n      const lineCell = pd.getPointCells(lastPtId) as unknown as number[];\n\n      if (lineCell.length !== 2 || lastPtId === startPtId) {\n        // looped\n        return lastPtId;\n      }\n\n      if (lineCell.length === 2) {\n        // continue along loop\n        lineId = lineCell[0] !== lineId ? lineCell[0] : lineCell[1];\n        visited.add(lineId);\n      } else {\n        // empty or invalid cell\n        terminated = true;\n      }\n    }\n\n    return lastPtId;\n  };\n\n  publicAPI.computeConvexHull = (input, output) => {\n    const inPoints = input.getPoints().getData();\n\n    const hullInputPoints: Array<Vector2> = [];\n    for (let i = 0; i < inPoints.length; i += 3) {\n      hullInputPoints.push([inPoints[i], inPoints[i + 1]]);\n    }\n\n    const convexHullPoints = hull(hullInputPoints, Infinity);\n\n    // @ts-ignore\n    const outPoints = new inPoints.constructor(convexHullPoints.length * 3);\n    const outLines = new Uint32Array(1 + convexHullPoints.length + 1);\n    outLines[0] = convexHullPoints.length;\n\n    for (let i = 0, outIdx = 0; i < convexHullPoints.length; i++, outIdx += 3) {\n      const pt = convexHullPoints[i] as number[];\n      outPoints[outIdx] = pt[0];\n      outPoints[outIdx + 1] = pt[1];\n      outPoints[outIdx + 2] = 0;\n      outLines[i + 1] = i;\n    }\n\n    // close loop\n    outLines[outLines.length - 1] = outLines[1];\n\n    output.getPoints().setData(outPoints);\n    output.getLines().setData(outLines);\n  };\n\n  publicAPI.extractContours = (input, output) => {\n    const loops: Array<ParameterizedPoint[]> = [];\n    visited.clear();\n\n    const inLines = input.getLines();\n    output.getPoints().setData(Float32Array.from(input.getPoints().getData()));\n\n    // TODO skip if cached input mtime hasn't changed.\n    // iterate over input lines\n    for (let li = 0; li < inLines.getNumberOfCells(); li++) {\n      if (visited.has(li)) {\n        continue;\n      }\n\n      const { cellPointIds } = input.getCellPoints(li) as CellPoints;\n      if (!cellPointIds) {\n        continue;\n      }\n\n      visited.add(li);\n      const startPtId = cellPointIds[0];\n\n      const loopPoints = [];\n      loopPoints.push({ t: 0, ptId: startPtId });\n\n      const endPtId = publicAPI.traverseLoop(\n        input,\n        Dir.Forward,\n        li,\n        startPtId,\n        loopPoints\n      );\n\n      if (startPtId !== endPtId) {\n        // didn't find a loop. Go other direction to see where we end up\n        publicAPI.traverseLoop(input, Dir.Backward, li, startPtId, loopPoints);\n        loopPoints.sort((a, b) => (a.t < b.t ? -1 : 1));\n        // make closed contour\n        if (\n          loopPoints.length &&\n          loopPoints[0].ptId !== loopPoints.at(-1)?.ptId\n        ) {\n          loopPoints.push({ ...loopPoints.at(-1)! });\n        }\n      }\n\n      if (loopPoints.length) {\n        loops.push(loopPoints);\n      }\n    }\n\n    // clear output lines\n    const outLines = output.getLines();\n    outLines.resize(0);\n\n    if (publicAPI.getMergeContours() && loops.length) {\n      let largestIndex = 0;\n      let longestLoop = 0;\n      loops.forEach((loop, index) => {\n        if (loop.length > longestLoop) {\n          largestIndex = index;\n          longestLoop = loop.length;\n        }\n      });\n      outLines.insertNextCell(loops[largestIndex].map((pt) => pt.ptId));\n    } else {\n      loops.forEach((loop) => {\n        outLines.insertNextCell(loop.map((pt) => pt.ptId));\n      });\n    }\n  };\n\n  publicAPI.requestData = (inData, outData) => {\n    const [input] = inData;\n\n    if (!outData[0]) {\n      outData[0] = vtkPolyData.newInstance();\n    }\n    const [output] = outData;\n\n    if (publicAPI.getConvexHull()) {\n      publicAPI.computeConvexHull(input, output);\n    } else {\n      publicAPI.extractContours(input, output);\n    }\n\n    output.modified();\n  };\n}\n\n// ----------------------------------------------------------------------------\n\nconst DEFAULT_VALUES = {\n  mergeContours: false,\n  convexHull: false,\n};\n\n// ----------------------------------------------------------------------------\n\nexport function extend(publicAPI: object, model: object, initialValues = {}) {\n  Object.assign(model, DEFAULT_VALUES, initialValues);\n\n  macro.obj(publicAPI, model);\n  macro.algo(publicAPI, model, 1, 1);\n  macro.setGet(publicAPI, model, ['mergeContours', 'convexHull']);\n\n  vtkContourLoopExtractionCtor(publicAPI as vtkContourLoopExtraction, model);\n}\n\n// ----------------------------------------------------------------------------\n\nexport const newInstance = macro.newInstance(\n  extend,\n  'vtkContourLoopExtraction'\n);\n\n// ----------------------------------------------------------------------------\n\nconst vtkContourLoopExtraction: {\n  newInstance: typeof newInstance;\n  extend: typeof extend;\n} = { newInstance, extend };\n\nexport default vtkContourLoopExtraction;\n","import {\n  ReferencePlane,\n  createReferencePlane,\n  transform2dTo3d,\n} from '@/src/core/contours/referencePlane';\nimport vtkPolyData from '@kitware/vtk.js/Common/DataModel/PolyData';\nimport { vtkAlgorithm, vtkObject } from '@kitware/vtk.js/interfaces';\nimport macro from '@kitware/vtk.js/macro';\nimport { TypedArray, Vector2, Vector3 } from '@kitware/vtk.js/types';\nimport { vec2 } from 'gl-matrix';\n\ninterface vtkTransformPolyDataToPlane extends vtkObject, vtkAlgorithm {\n  setRefPlane(plane: ReferencePlane): boolean;\n  getRefPlane(): ReferencePlane;\n  requestData(inData: [vtkPolyData], outData: [vtkPolyData]): void;\n}\n\ninterface Model {\n  [key: string]: any;\n}\n\ntype TypedArrayConstructor =\n  | Int8ArrayConstructor\n  | Uint8ArrayConstructor\n  | Uint8ClampedArrayConstructor\n  | Int16ArrayConstructor\n  | Uint16ArrayConstructor\n  | Int32ArrayConstructor\n  | Uint32ArrayConstructor\n  | Float32ArrayConstructor\n  | Float64ArrayConstructor;\n\nfunction cloneArray(arr: number[] | TypedArray) {\n  if (Array.isArray(arr)) {\n    return [...arr];\n  }\n  return (arr.constructor as TypedArrayConstructor).from(arr);\n}\n\n/**\n * Input polydata is expected to have points on the (x,y,0) plane.\n */\nfunction vtkTransformPolyDataToPlaneCtor(\n  publicAPI: vtkTransformPolyDataToPlane,\n  model: Model\n) {\n  model.classHierarchy.push('vtkTransformPolyDataToPlane');\n\n  publicAPI.requestData = (inData, outData) => {\n    const refPlane = publicAPI.getRefPlane() ?? createReferencePlane();\n\n    const [inPd] = inData;\n\n    if (!outData[0]) {\n      outData[0] = vtkPolyData.newInstance();\n    }\n    const [output] = outData;\n\n    const outPoints = Float32Array.from(inPd.getPoints().getData());\n    output.getPoints().setData(outPoints);\n\n    const pt2d: Vector2 = [0, 0];\n    const pt3d: Vector3 = [0, 0, 0];\n    for (let i = 0; i < outPoints.length; i += 3) {\n      vec2.set(pt2d, outPoints[i], outPoints[i + 1]);\n      transform2dTo3d(pt2d, refPlane, pt3d);\n      /* eslint-disable prefer-destructuring */\n      outPoints[i] = pt3d[0];\n      outPoints[i + 1] = pt3d[1];\n      outPoints[i + 2] = pt3d[2];\n      /* eslint-enable prefer-destructuring */\n    }\n\n    const inLines = inPd.getLines().getData();\n    output.getLines().setData(cloneArray(inLines));\n\n    output.modified();\n  };\n}\n\n// ----------------------------------------------------------------------------\n\nconst DEFAULT_VALUES = {\n  refPlane: null,\n};\n\n// ----------------------------------------------------------------------------\n\nexport function extend(publicAPI: object, model: object, initialValues = {}) {\n  Object.assign(model, DEFAULT_VALUES, initialValues);\n\n  macro.obj(publicAPI, model);\n  macro.algo(publicAPI, model, 1, 1);\n  macro.setGet(publicAPI, model, ['refPlane']);\n\n  vtkTransformPolyDataToPlaneCtor(\n    publicAPI as vtkTransformPolyDataToPlane,\n    model\n  );\n}\n\n// ----------------------------------------------------------------------------\n\nexport const newInstance = macro.newInstance(\n  extend,\n  'vtkTransformPolyDataToPlane'\n);\n\n// ----------------------------------------------------------------------------\n\nconst vtkTransformPolyDataToPlane: {\n  newInstance: typeof newInstance;\n  extend: typeof extend;\n} = { newInstance, extend };\n\nexport default vtkTransformPolyDataToPlane;\n","import { vec3 } from 'gl-matrix';\nimport macro from '@kitware/vtk.js/macros';\nimport vtkImageData from '@kitware/vtk.js/Common/DataModel/ImageData';\nimport { roundVector } from '@kitware/vtk.js/Common/Core/Math';\nimport { Maybe } from '@/src/types';\nimport { Vector2, Vector3 } from '@kitware/vtk.js/types';\nimport {\n  createBinaryMask,\n  ijkToIj,\n  maskToBoundaryLines,\n  thresholdSlice,\n} from '@/src/core/contours/threshold';\nimport vtkActor from '@kitware/vtk.js/Rendering/Core/Actor';\nimport vtkMapper from '@kitware/vtk.js/Rendering/Core/Mapper';\nimport vtkPolyData from '@kitware/vtk.js/Common/DataModel/PolyData';\nimport vtkProperty from '@kitware/vtk.js/Rendering/Core/Property';\nimport vtkContourLoopExtraction from '@/src/vtk/ContourLoopExtraction';\nimport {\n  getEventWorldPosition,\n  ignoreKey,\n  InteractionState,\n  Mode,\n} from './common';\nimport { ContourWidgetState } from '..';\nimport vtkTransformPolyDataToPlane from '../../TransformPolyDataToPlane';\n\nconst MERGE_CONTOURS_KEY = 'm';\nconst CONVEX_HULL_CONTOURS_KEY = 'c';\nconst THRESHOLD_LINE_WIDTH = 2;\n\ninterface Model {\n  imageData: Maybe<vtkImageData>;\n  sliceAxis: 0 | 1 | 2;\n  slice: number;\n  maskBoundaryLines: vtkPolyData;\n  // point ids refer to points from maskBoundaryLines\n  loops: vtkPolyData;\n  contourLoopExtraction: vtkContourLoopExtraction;\n  transformPolyData: vtkTransformPolyDataToPlane;\n  mergeContours: boolean;\n  doConvexHull: boolean;\n  contour: {\n    actor: vtkActor;\n    mapper: vtkMapper;\n    property: vtkProperty;\n  };\n  widgetState: ContourWidgetState;\n\n  [name: string]: any;\n}\n\nfunction createActorPipeline() {\n  const actor = vtkActor.newInstance();\n  const mapper = vtkMapper.newInstance();\n  const property = actor.getProperty();\n  actor.setMapper(mapper);\n  return { actor, mapper, property };\n}\n\nexport default function thresholdBehavior(publicAPI: any, model: Model) {\n  const original = { ...publicAPI };\n\n  model.imageData = null;\n  model.sliceAxis = 0;\n  model.slice = 0;\n  model.loops = vtkPolyData.newInstance();\n  model.maskBoundaryLines = vtkPolyData.newInstance();\n  model.mergeContours = false;\n  model.doConvexHull = false;\n\n  model.contour = createActorPipeline();\n  model.contour.property.setLineWidth(THRESHOLD_LINE_WIDTH);\n\n  model.contourLoopExtraction = vtkContourLoopExtraction.newInstance();\n  model.transformPolyData = vtkTransformPolyDataToPlane.newInstance();\n\n  /**\n   * contourExtraction produces 2D loops.\n   *\n   * transformPolyData produces 3D loops from contourExtraction.\n   */\n\n  model.transformPolyData.setInputConnection(\n    model.contourLoopExtraction.getOutputPort()\n  );\n\n  function resetVisualizingContour() {\n    model.contour.mapper.setInputData(vtkPolyData.newInstance());\n  }\n\n  function addVisualizingContour() {\n    model._renderer?.addActor(model.contour.actor);\n  }\n\n  function removeVisualizingContour() {\n    model._renderer?.removeActor(model.contour.actor);\n  }\n\n  function commitCurrentContours() {\n    const store = model.widgetState.getStore();\n\n    // get current contour info\n    const id = model.widgetState.getId();\n    const drawingContour = store.toolByID[id];\n\n    const loops2d = model.contourLoopExtraction.getOutputData();\n    const loopCells = loops2d.getLines();\n    const loopPoints = loops2d.getPoints();\n    const maxCellLoc = loopCells.getData().length;\n\n    const coord = [0, 0, 0];\n    for (let loc = 0; loc < maxCellLoc; ) {\n      const loop = loopCells.getCell(loc) as unknown as number[];\n      loc += loop.length + 1;\n\n      const polyLine: number[] = [];\n      let { length } = loop;\n      // break closed contours\n      if (loop[0] === loop.at(-1)) {\n        length--;\n      }\n\n      for (let j = 0; j < length; j++) {\n        loopPoints.getPoint(loop[j], coord);\n        polyLine.push(coord[0], coord[1]);\n      }\n\n      store.addTool({\n        ...drawingContour,\n        polyLine,\n      });\n    }\n  }\n\n  // set initial empty contour data\n  resetVisualizingContour();\n\n  // cache these in the event setThresholdingParameters is called\n  // while thresholding.\n  let curImageData: Maybe<vtkImageData> = null;\n  let maskImage: Maybe<vtkImageData> = null;\n  let curSliceAxis: 0 | 1 | 2 = 0;\n  let curSlice: number = 0;\n  let startPointWorld: Vector3 = [0, 0, 0];\n  let startPointIjk: Vector3 = [0, 0, 0];\n  let startPointIj: Vector2 = [0, 0];\n\n  function renderCurrentContours() {\n    if (!curImageData) {\n      return;\n    }\n\n    model.transformPolyData.setRefPlane(model.widgetState.getReferencePlane());\n    const pd = model.transformPolyData.getOutputData();\n    model.contour.mapper.setInputData(pd);\n    model.contour.mapper.modified();\n  }\n\n  function isActiveMode() {\n    return publicAPI.getMode() === Mode.Threshold;\n  }\n\n  function resetModeInteraction() {\n    removeVisualizingContour();\n    resetVisualizingContour();\n\n    const circleContextState = publicAPI.getWidgetState().getCircleContext();\n    circleContextState.setVisible(false);\n\n    // Do not set this widget to be finalized, as we commit all contours separately.\n    // Reason: thresholding can generate more than one contour.\n\n    model._widgetManager.releaseFocus();\n    publicAPI.setInteractionState(InteractionState.Idle);\n    model._interactor.cancelAnimation(publicAPI);\n    publicAPI.invokeEndInteractionEvent();\n  }\n\n  publicAPI.resetInteractionState = () => {\n    if (isActiveMode() && !publicAPI.isInteractionIdle()) {\n      resetModeInteraction();\n    }\n\n    original.resetInteractionState();\n  };\n\n  publicAPI.setThresholdingImageSlice = (\n    imageData: vtkImageData,\n    sliceAxis: 0 | 1 | 2,\n    slice: number\n  ) => {\n    model.imageData = imageData;\n    model.sliceAxis = sliceAxis;\n    model.slice = Math.round(slice);\n  };\n\n  publicAPI.handleKeyPress = (callData: any) => {\n    if (original.handleKeyPress?.(callData) === macro.EVENT_ABORT) {\n      return macro.EVENT_ABORT;\n    }\n\n    if (\n      !isActiveMode() ||\n      !model.manipulator ||\n      ignoreKey(callData) ||\n      model.widgetState.getFinalized() ||\n      publicAPI.getInteractionState() !== InteractionState.Thresholding\n    ) {\n      return macro.VOID;\n    }\n\n    let needsRender = false;\n\n    if (callData.key === MERGE_CONTOURS_KEY) {\n      model.mergeContours = !model.mergeContours;\n      model.contourLoopExtraction.setMergeContours(model.mergeContours);\n      needsRender = true;\n    } else if (callData.key === CONVEX_HULL_CONTOURS_KEY) {\n      model.doConvexHull = !model.doConvexHull;\n      model.contourLoopExtraction.setConvexHull(model.doConvexHull);\n      needsRender = true;\n    }\n\n    if (needsRender) {\n      renderCurrentContours();\n      publicAPI.invokeInteractionEvent();\n      return macro.EVENT_ABORT;\n    }\n\n    return macro.VOID;\n  };\n\n  publicAPI.handleLeftButtonPress = (callData: any) => {\n    if (original.handleLeftButtonPress?.(callData) === macro.EVENT_ABORT) {\n      return macro.EVENT_ABORT;\n    }\n\n    if (!isActiveMode() || !model.manipulator || ignoreKey(callData)) {\n      return macro.VOID;\n    }\n\n    if (!model.imageData || model.sliceAxis == null || model.slice == null) {\n      return macro.VOID;\n    }\n\n    curImageData = model.imageData;\n    curSliceAxis = model.sliceAxis;\n    curSlice = model.slice;\n    maskImage = createBinaryMask(curImageData!, curSliceAxis);\n\n    // do not modify a finalized contour\n    if (model.widgetState.getFinalized()) {\n      return macro.VOID;\n    }\n\n    // This contour widget is passive, so if another widget\n    // is active, we don't do anything.\n    const activeWidget = model._widgetManager.getActiveWidget();\n    if (activeWidget && activeWidget !== publicAPI) {\n      return macro.VOID;\n    }\n\n    const worldCoords = getEventWorldPosition(model, callData);\n    if (!worldCoords) {\n      return macro.VOID;\n    }\n\n    addVisualizingContour();\n\n    // reset mergeContours\n    model.mergeContours = false;\n\n    const indexCoords = model.imageData.worldToIndex(worldCoords) as Vector3;\n    startPointWorld = worldCoords;\n    startPointIjk = roundVector(indexCoords);\n    startPointIj = ijkToIj(startPointIjk, curSliceAxis);\n\n    model._widgetManager.grabFocus(publicAPI);\n    publicAPI.setInteractionState(InteractionState.Thresholding);\n    model.widgetState.setFinalized(false);\n    model.widgetState.clearPolyLine();\n\n    model._interactor.requestAnimation(publicAPI);\n    publicAPI.invokeStartInteractionEvent();\n\n    return macro.EVENT_ABORT;\n  };\n\n  publicAPI.handleMouseMove = (callData: any) => {\n    if (original.handleMouseMove?.(callData) === macro.EVENT_ABORT) {\n      return macro.EVENT_ABORT;\n    }\n\n    if (\n      !isActiveMode() ||\n      publicAPI.getInteractionState() !== InteractionState.Thresholding ||\n      ignoreKey(callData)\n    ) {\n      return macro.VOID;\n    }\n\n    if (!curImageData) {\n      return macro.VOID;\n    }\n\n    const coord = roundVector(\n      curImageData.worldToIndex(\n        getEventWorldPosition(model, callData)\n      ) as Vector3\n    );\n    if (coord && curImageData && maskImage) {\n      const ijCoord = ijkToIj(coord, curSliceAxis);\n      const maxDistance = Math.abs(ijCoord[0] - startPointIj[0]);\n      const threshRadius = Math.abs(ijCoord[1] - startPointIj[1]);\n\n      const ijkDims = curImageData.getDimensions();\n      const ijDims = ijkToIj(ijkDims, curSliceAxis);\n      const diag = Math.sqrt(ijDims[0] ** 2 + ijkDims[1] ** 2);\n      const range = curImageData.getPointData().getScalars().getRange();\n      const rangeWidth = range[1] - range[0];\n      const adjustedThreshold =\n        (Math.min(threshRadius, diag) / diag) * rangeWidth;\n\n      thresholdSlice(\n        curImageData,\n        curSliceAxis,\n        curSlice,\n        maskImage,\n        startPointIjk,\n        adjustedThreshold,\n        maxDistance\n      );\n\n      model.maskBoundaryLines = maskToBoundaryLines(maskImage);\n\n      // required for contour loop extraction\n      model.maskBoundaryLines.buildLinks();\n\n      // loops are in 2D space\n      model.contourLoopExtraction.setInputData(model.maskBoundaryLines);\n\n      renderCurrentContours();\n\n      // draw circle context\n      const normal = model.manipulator.getNormal();\n      const up = model._renderer.getActiveCamera().getViewUp();\n      const horiz = vec3.create();\n      vec3.cross(horiz, up, normal);\n\n      const circleContextState = model.widgetState.getCircleContext();\n      circleContextState.setDirection(normal);\n      circleContextState.setUp(up);\n      circleContextState.setRight(horiz);\n      circleContextState.setOrigin(startPointWorld);\n      circleContextState.setScale3([maxDistance, threshRadius, 1]);\n      circleContextState.setVisible(true);\n\n      publicAPI.invokeInteractionEvent();\n    }\n\n    return macro.EVENT_ABORT;\n  };\n\n  publicAPI.handleLeftButtonRelease = (callData: any) => {\n    if (original.handleLeftButtonRelease?.(callData) === macro.EVENT_ABORT) {\n      return macro.EVENT_ABORT;\n    }\n\n    if (\n      !isActiveMode() ||\n      publicAPI.getInteractionState() !== InteractionState.Thresholding ||\n      ignoreKey(callData)\n    ) {\n      return macro.VOID;\n    }\n\n    commitCurrentContours();\n    resetModeInteraction();\n\n    return macro.EVENT_ABORT;\n  };\n}\n","import macro from '@kitware/vtk.js/macros';\nimport freehandBehavior from './behavior/freehand';\nimport { InteractionState, ignoreKey } from './behavior/common';\nimport selectBehavior from './behavior/select';\nimport nudgeBehavior from './behavior/nudge';\nimport pointPlacingBehavior from './behavior/pointPlacing';\nimport thresholdBehavior from './behavior/threshold';\n\nexport default function widgetBehavior(publicAPI: any, model: any) {\n  model.classHierarchy.push('vtkContourWidgetProp');\n\n  model.interactionState = InteractionState.Idle;\n  model.mode = null;\n\n  macro.event(publicAPI, model, 'RightClickEvent');\n\n  // support setting per-view widget manipulators\n  macro.setGet(publicAPI, model, ['manipulator']);\n  macro.setGet(publicAPI, model, ['mode']);\n  macro.setGet(publicAPI, model, ['interactionState']);\n\n  publicAPI.setDisplayCallback = (callback: () => {}) =>\n    model.representations[0].setDisplayCallback(callback);\n\n  publicAPI.isInteractionIdle = () => {\n    return publicAPI.getInteractionState() === InteractionState.Idle;\n  };\n\n  publicAPI.resetInteractionState = () => {\n    publicAPI.setInteractionState(InteractionState.Idle);\n  };\n\n  publicAPI.isSelected = () => {\n    return model.widgetState.getSelected();\n  };\n\n  publicAPI.handleRightButtonPress = (eventData: any) => {\n    if (\n      ignoreKey(eventData) ||\n      model._widgetManager.getActiveWidget() !== publicAPI\n    ) {\n      return macro.VOID;\n    }\n    publicAPI.invokeRightClickEvent(eventData);\n    return macro.EVENT_ABORT;\n  };\n\n  // select should be first so that contour selection works\n  selectBehavior(publicAPI, model);\n  freehandBehavior(publicAPI, model);\n  pointPlacingBehavior(publicAPI, model);\n  nudgeBehavior(publicAPI, model);\n  thresholdBehavior(publicAPI, model);\n}\n","import { toRaw } from 'vue';\nimport macro from '@kitware/vtk.js/macros';\nimport vtkWidgetState from '@kitware/vtk.js/Widgets/Core/WidgetState';\nimport bounds from '@kitware/vtk.js/Widgets/Core/StateBuilder/boundsMixin';\nimport scale3 from '@kitware/vtk.js/Widgets/Core/StateBuilder/scale3Mixin';\nimport visible from '@kitware/vtk.js/Widgets/Core/StateBuilder/visibleMixin';\nimport origin from '@kitware/vtk.js/Widgets/Core/StateBuilder/originMixin';\nimport orientation from '@kitware/vtk.js/Widgets/Core/StateBuilder/orientationMixin';\nimport { vec2 } from 'gl-matrix';\nimport { transform3dTo2d } from '@/src/core/contours/referencePlane';\nimport { hexaToRGBA } from '@/src/utils/color';\n\nfunction createCircleContextState(publicAPI, model, initialValues) {\n  vtkWidgetState.extend(publicAPI, model, initialValues);\n  scale3.extend(publicAPI, model, initialValues);\n  visible.extend(publicAPI, model, initialValues);\n  orientation.extend(publicAPI, model, initialValues);\n  origin.extend(publicAPI, model, initialValues);\n}\n\nconst newCircleContextStateInstance = macro.newInstance(\n  createCircleContextState,\n  'vtkCircleContextContourWidgetState'\n);\n\nfunction vtkContourWidgetState(publicAPI, model) {\n  model.classHierarchy.push('vtkContourWidgetState');\n\n  model._circleContextState = newCircleContextStateInstance();\n  publicAPI.bindState(model._circleContextState, ['circleContext']);\n\n  publicAPI.getCircleContext = () => model._circleContextState;\n\n  function getContour() {\n    return model._store.toolByID[model.id];\n  }\n\n  // Avoid proxy access/tracking on polyline reference\n  publicAPI.getPolyLine = () => toRaw(getContour()?.polyLine);\n  publicAPI.getReferencePlane = () => getContour()?.referencePlane;\n\n  publicAPI.getPolyLineLength = () => {\n    const pl = getContour()?.polyLine;\n    return pl ? pl.length / 2 : 0;\n  };\n\n  const point2d = vec2.create();\n\n  /**\n   * @param {Vector3} coord\n   */\n  publicAPI.add3dPointToPolyLine = (coord) => {\n    const pl = publicAPI.getPolyLine();\n    const refPlane = publicAPI.getReferencePlane();\n    if (!pl || !refPlane) return;\n\n    transform3dTo2d(coord, refPlane, point2d);\n    publicAPI.add2dPointToPolyLine(point2d);\n  };\n\n  /**\n   * @param {Vector2} coord\n   */\n  publicAPI.add2dPointToPolyLine = (coord) => {\n    const pl = publicAPI.getPolyLine();\n    if (!pl) return;\n\n    pl.push(...coord);\n    publicAPI.modified();\n  };\n\n  publicAPI.clearPolyLine = () => {\n    const pl = publicAPI.getPolyLine();\n    if (!pl) return;\n\n    pl.length = 0;\n    publicAPI.modified();\n  };\n\n  /**\n   * Takes a polyline comprised of 2D points in the contour's frame of reference.\n   * @param polyLine\n   */\n  publicAPI.setPolyLine = (polyLine) => {\n    const contour = getContour();\n    if (!contour) return;\n\n    contour.polyLine = polyLine;\n    publicAPI.modified();\n  };\n\n  publicAPI.getColor = () => {\n    const label = getContour()?.label;\n    if (label) {\n      // color components needs to be in [0,1]\n      return hexaToRGBA(model._store.labels[label].color).map((c) => c / 255);\n    }\n    return null;\n  };\n}\n\nconst defaultValues = (initialValues) => ({\n  finalized: false,\n  selected: false,\n  ...initialValues,\n});\n\nfunction createContourState(publicAPI, model, initialValues) {\n  Object.assign(model, defaultValues(initialValues));\n  vtkWidgetState.extend(publicAPI, model, initialValues);\n  bounds.extend(publicAPI, model);\n\n  macro.get(publicAPI, model, ['id']);\n  macro.setGet(publicAPI, model, ['finalized', 'selected']);\n  macro.moveToProtected(publicAPI, model, ['store']);\n  macro.get(publicAPI, model, ['_store']);\n\n  if (!model.id) {\n    throw new Error('No ID provided!');\n  }\n\n  if (!model._store) {\n    throw new Error('No store provided!');\n  }\n\n  vtkContourWidgetState(publicAPI, model);\n}\n\n// ----------------------------------------------------------------------------\n\nexport const newInstance = macro.newInstance(\n  createContourState,\n  'vtkContourWidgetState'\n);\n\n// ----------------------------------------------------------------------------\n\nexport default function generateState(initialValues) {\n  return newInstance(initialValues);\n}\n","import macro from '@kitware/vtk.js/macros';\nimport vtkAbstractWidgetFactory from '@kitware/vtk.js/Widgets/Core/AbstractWidgetFactory';\nimport vtkPlanePointManipulator from '@kitware/vtk.js/Widgets/Manipulators/PlaneManipulator';\nimport vtkCircleContextRepresentation from '@kitware/vtk.js/Widgets/Representations/CircleContextRepresentation';\nimport { ViewTypes } from '@kitware/vtk.js/Widgets/Core/WidgetManager/Constants';\n\nimport vtkContourRepresentation from './representation';\nimport widgetBehavior from './behavior';\nimport generateState from './state';\n\n// ----------------------------------------------------------------------------\n// Factory\n// ----------------------------------------------------------------------------\n\nfunction vtkContourWidget(publicAPI, model) {\n  model.classHierarchy.push('vtkContourWidget');\n\n  // --- Widget Requirement ---------------------------------------------------\n\n  publicAPI.getRepresentationsForViewType = (viewType) => {\n    switch (viewType) {\n      case ViewTypes.DEFAULT:\n      case ViewTypes.GEOMETRY:\n      case ViewTypes.SLICE:\n      case ViewTypes.VOLUME:\n      default:\n        return [\n          {\n            builder: vtkContourRepresentation,\n          },\n          {\n            builder: vtkCircleContextRepresentation,\n            labels: ['circleContext'],\n          },\n        ];\n    }\n  };\n\n  // --------------------------------------------------------------------------\n  // initialization\n  // --------------------------------------------------------------------------\n\n  // Default manipulator\n  publicAPI.setManipulator(\n    model.manipulator || vtkPlanePointManipulator.newInstance()\n  );\n}\n\n// ----------------------------------------------------------------------------\n\nconst defaultValues = (initialValues) => ({\n  manipulator: null,\n  behavior: widgetBehavior,\n  widgetState: generateState(initialValues),\n  ...initialValues,\n});\n\n// ----------------------------------------------------------------------------\n\nexport function extend(publicAPI, model, initialValues = {}) {\n  Object.assign(model, defaultValues(initialValues));\n\n  vtkAbstractWidgetFactory.extend(publicAPI, model, initialValues);\n  macro.setGet(publicAPI, model, ['manipulator']);\n  macro.event(publicAPI, model, 'finalized');\n\n  vtkContourWidget(publicAPI, model);\n}\n\n// ----------------------------------------------------------------------------\n\nexport const newInstance = macro.newInstance(extend, 'vtkContourWidget');\n\n// ----------------------------------------------------------------------------\n\nexport default { newInstance, extend };\n","<script lang=\"ts\">\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { useVTKCallback } from '@/src/composables/useVTKCallback';\nimport useContourStore, { ContourToolMode } from '@/src/store/tools/contours';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport { updatePlaneManipulatorFor2DView } from '@/src/utils/manipulators';\nimport { getCSSCoordinatesFromEvent } from '@/src/utils/vtk-helpers';\nimport vtkContourWidget, {\n  vtkContourViewWidget,\n} from '@/src/vtk/ContourWidget';\nimport { Mode } from '@/src/vtk/ContourWidget/behavior/common';\nimport vtkLPSView2DProxy from '@/src/vtk/LPSView2DProxy';\nimport vtkWidgetManager from '@kitware/vtk.js/Widgets/Core/WidgetManager';\nimport vtkPlaneManipulator from '@kitware/vtk.js/Widgets/Manipulators/PlaneManipulator';\nimport type { vtkSubscription } from '@kitware/vtk.js/interfaces';\nimport {\n  PropType,\n  defineComponent,\n  toRefs,\n  computed,\n  ref,\n  onMounted,\n  onUnmounted,\n  watch,\n  watchEffect,\n  onBeforeUnmount,\n} from 'vue';\nimport { getLPSAxisFromDir } from '@/src/utils/lps';\nimport { ContourID } from '@/src/types/contour';\n\nconst ModeMap: Record<ContourToolMode, Mode> = {\n  [ContourToolMode.Select]: Mode.Select,\n  [ContourToolMode.FreehandDraw]: Mode.Freehand,\n  [ContourToolMode.CircleNudge]: Mode.Nudge,\n  [ContourToolMode.PointPlacing]: Mode.PointPlacing,\n  [ContourToolMode.Threshold]: Mode.Threshold,\n};\n\nexport default defineComponent({\n  name: 'ContourWidget2D',\n  emits: ['finalize', 'select', 'contextmenu'],\n  props: {\n    contourId: {\n      type: String as unknown as PropType<ContourID>,\n      required: true,\n    },\n    widgetManager: {\n      type: Object as PropType<vtkWidgetManager>,\n      required: true,\n    },\n    viewId: {\n      type: String,\n      required: true,\n    },\n    viewDirection: {\n      type: String as PropType<LPSAxisDir>,\n      required: true,\n    },\n    currentSlice: {\n      type: Number,\n      required: true,\n    },\n    drawing: {\n      type: Boolean,\n      default: false,\n    },\n    selected: {\n      type: Boolean,\n      default: false,\n    },\n    mode: {\n      type: String as PropType<ContourToolMode>,\n      required: true,\n    },\n  },\n  setup(props, { emit }) {\n    const {\n      viewId,\n      contourId,\n      widgetManager,\n      viewDirection,\n      currentSlice,\n      drawing,\n      selected: isSelected,\n      mode,\n    } = toRefs(props);\n\n    const store = useContourStore();\n    const contour = computed(() => store.toolByID[contourId.value]);\n    const { currentImageData, currentImageID, currentImageMetadata } =\n      useCurrentImage();\n\n    const viewProxy = computed<vtkLPSView2DProxy | null>(() => {\n      return store.$proxies.getView(viewId.value);\n    });\n\n    const widgetFactory = vtkContourWidget.newInstance({\n      id: contourId.value,\n      store,\n      finalized: !drawing.value,\n    });\n    const widget = ref<vtkContourViewWidget | null>(null);\n    const widgetState = computed(() => widget.value?.getWidgetState());\n\n    onMounted(() => {\n      widget.value = widgetManager.value.addWidget(\n        widgetFactory\n      ) as vtkContourViewWidget;\n    });\n\n    onUnmounted(() => {\n      if (!widget.value) {\n        return;\n      }\n      widgetManager.value.removeWidget(widget.value);\n      widget.value.delete();\n      widgetFactory.delete();\n    });\n\n    // --- mode --- //\n\n    watchEffect(() => {\n      const widgetMode = ModeMap[mode.value];\n      widget.value?.setMode(widgetMode);\n    });\n\n    // --- reset cases --- //\n\n    watch([currentSlice, currentImageID, widget], () => {\n      widget.value?.resetInteractionState();\n    });\n\n    onBeforeUnmount(() => {\n      // ensure we reset any existing interaction state prior to unmounting\n      widget.value?.resetInteractionState();\n    });\n\n    // --- event handling --- //\n\n    const onEndInteractionEvent = useVTKCallback(\n      computed(() => widget.value?.onEndInteractionEvent)\n    );\n\n    onEndInteractionEvent(() => {\n      if (widget.value?.getWidgetState().getFinalized()) {\n        emit('finalize');\n      }\n    });\n\n    // --- selection --- //\n\n    const onSelectedEvent = useVTKCallback(\n      computed(() => widget.value?.onSelectedEvent)\n    );\n\n    onSelectedEvent((selected) => {\n      emit('select', selected);\n    });\n\n    // update widget state's selection state if selected prop changes\n    watchEffect(() => {\n      widgetState.value?.setSelected(isSelected.value);\n      // renders any visual cues when selecting\n      viewProxy.value?.renderLater();\n    });\n\n    // --- right click handling --- //\n\n    let rightClickSub: vtkSubscription | null = null;\n\n    onMounted(() => {\n      if (!widget.value) {\n        return;\n      }\n      rightClickSub = widget.value.onRightClickEvent((eventData) => {\n        const coords = getCSSCoordinatesFromEvent(eventData);\n        if (coords) {\n          emit('contextmenu', coords);\n        }\n      });\n    });\n\n    onBeforeUnmount(() => {\n      if (rightClickSub) {\n        rightClickSub.unsubscribe();\n        rightClickSub = null;\n      }\n    });\n\n    // --- manipulator --- //\n\n    const manipulator = vtkPlaneManipulator.newInstance();\n\n    onMounted(() => {\n      widget.value?.setManipulator(manipulator);\n    });\n\n    watchEffect(() => {\n      updatePlaneManipulatorFor2DView(\n        manipulator,\n        viewDirection.value,\n        currentSlice.value,\n        currentImageMetadata.value\n      );\n    });\n\n    // --- visibility --- //\n\n    watch(\n      () =>\n        !!viewProxy.value &&\n        !!widget.value &&\n        contour.value?.slice === currentSlice.value,\n      (visible) => {\n        widget.value?.setVisibility(visible);\n      },\n      { immediate: true }\n    );\n\n    onMounted(() => {\n      if (!widget.value) {\n        return;\n      }\n      // hide handle visibility, but not picking visibility\n      widget.value.setHandleVisibility(false);\n      // render picking buffer\n      widgetManager.value.renderWidgets();\n      // render front buffer\n      viewProxy.value?.renderLater();\n    });\n\n    // --- rendering --- //\n\n    // widgetState.getColor() is backed by contourStore.\n    // Whenever the color changes, update the widget state\n    // mtime and render the new color.\n    watch(\n      () => widget.value?.getWidgetState().getColor(),\n      () => {\n        widget.value?.getWidgetState().modified();\n        viewProxy.value?.renderLater();\n      }\n    );\n\n    // --- set widget data --- //\n\n    const viewAxisIndex = computed(() => {\n      return currentImageMetadata.value.lpsOrientation[\n        getLPSAxisFromDir(viewDirection.value)\n      ];\n    });\n\n    watchEffect(() => {\n      const imageData = currentImageData.value;\n      const sliceAxis = viewAxisIndex.value;\n      const slice = currentSlice.value;\n      if (widget.value && imageData) {\n        widget.value.setThresholdingImageSlice(imageData, sliceAxis, slice);\n      }\n    });\n\n    return () => null;\n  },\n});\n</script>\n","<script lang=\"ts\">\nimport { onKeyDown } from '@vueuse/core';\nimport { Maybe } from '@/src/types';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { useToolStore } from '@/src/store/tools';\nimport useContourStore, { ContourToolMode } from '@/src/store/tools/contours';\nimport { Tools } from '@/src/store/tools/types';\nimport { useViewStore } from '@/src/store/views';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport { frameOfReferenceToImageSliceAndAxis } from '@/src/utils/frameOfReference';\nimport { getLPSAxisFromDir } from '@/src/utils/lps';\nimport type { Vector2 } from '@kitware/vtk.js/types';\nimport vtkWidgetManager from '@kitware/vtk.js/Widgets/Core/WidgetManager';\nimport {\n  computed,\n  defineComponent,\n  ref,\n  toRefs,\n  watch,\n  PropType,\n  onUnmounted,\n  reactive,\n} from 'vue';\nimport { storeToRefs } from 'pinia';\nimport {\n  ReferencePlane,\n  referencePlaneToFrame,\n  getReferencePlaneFromSlice,\n} from '@/src/core/contours/referencePlane';\nimport type { ContourID } from '@/src/types/contour';\nimport ContourWidget2D from './contour/ContourWidget2D.vue';\n\nconst AutoAddDrawingContourModes = new Set([\n  ContourToolMode.FreehandDraw,\n  ContourToolMode.PointPlacing,\n  ContourToolMode.Threshold,\n]);\n\nfunction fequals(a: number, b: number, eps = 1e-6) {\n  return Math.abs(a - b) < eps;\n}\n\nexport default defineComponent({\n  components: { ContourWidget2D },\n  props: {\n    viewId: {\n      type: String,\n      required: true,\n    },\n    currentSlice: {\n      type: Number,\n      required: true,\n    },\n    viewDirection: {\n      type: String as PropType<LPSAxisDir>,\n      required: true,\n    },\n    widgetManager: {\n      type: Object as PropType<vtkWidgetManager>,\n      required: true,\n    },\n  },\n  setup(props) {\n    const { viewId, viewDirection, currentSlice } = toRefs(props);\n    const toolStore = useToolStore();\n    const contourStore = useContourStore();\n    const { currentImageID, currentImageMetadata } = useCurrentImage();\n    const viewAxis = computed(() => getLPSAxisFromDir(viewDirection.value));\n    const { mode: toolMode, selectedContourID } = storeToRefs(contourStore);\n\n    const drawingContourID = ref<Maybe<ContourID>>(null);\n\n    const isToolActive = computed(\n      () => toolStore.currentTool === Tools.Contour\n    );\n    const viewType = computed(() => {\n      const viewStore = useViewStore();\n      return viewStore.viewSpecs[viewId.value].viewType;\n    });\n\n    type IsContourInCurrentViewOptions = {\n      checkImageID?: boolean;\n      checkSlice?: boolean;\n    };\n\n    const isContourInCurrentView = (\n      contourId: ContourID,\n      opts?: IsContourInCurrentViewOptions\n    ) => {\n      const { toolByID } = contourStore;\n      if (!(contourId in toolByID)) return false;\n\n      const { referencePlane, imageID } = toolByID[contourId];\n\n      const frameOfReference = referencePlaneToFrame(referencePlane);\n      const axisAndSlice = frameOfReferenceToImageSliceAndAxis(\n        frameOfReference,\n        currentImageMetadata.value,\n        {\n          allowOutOfBoundsSlice: true,\n        }\n      );\n      if (!axisAndSlice) return false;\n\n      const checkImageID = opts?.checkImageID ?? false;\n      const checkSlice = opts?.checkSlice ?? false;\n      const { axis, slice } = axisAndSlice;\n      return (\n        axis === viewAxis.value &&\n        (!checkImageID || imageID === currentImageID.value) &&\n        (!checkSlice || fequals(slice, currentSlice.value))\n      );\n    };\n\n    const contours = computed(() => {\n      return contourStore.toolIDs\n        .filter((id) => {\n          // only show contours for the current image and view axis\n          return isContourInCurrentView(id, { checkImageID: true });\n        })\n        .map((id) => contourStore.toolByID[id])\n        .filter(Boolean);\n    });\n\n    // --- active/drawing contour management -- //\n\n    const commitDrawingContour = () => {\n      drawingContourID.value = null;\n    };\n\n    const addDrawingContour = () => {\n      if (currentImageID.value && !drawingContourID.value) {\n        drawingContourID.value = contourStore.addTool({\n          imageID: currentImageID.value,\n        });\n      }\n    };\n\n    const clearDrawingContour = () => {\n      if (drawingContourID.value != null) {\n        contourStore.removeTool(drawingContourID.value);\n        drawingContourID.value = null;\n      }\n    };\n\n    // update the drawing contour's label to the active label\n    const { activeLabel } = storeToRefs(contourStore);\n\n    watch(\n      [activeLabel, drawingContourID],\n      ([label, contourID]) => {\n        if (contourID) {\n          contourStore.updateTool(contourID, {\n            label,\n          });\n        }\n      },\n      { immediate: true }\n    );\n\n    watch(\n      [isToolActive, currentImageID],\n      ([active, imageID]) => {\n        clearDrawingContour();\n        if (active && imageID) {\n          addDrawingContour();\n        }\n      },\n      { immediate: true }\n    );\n\n    watch(\n      toolMode,\n      (mode) => {\n        clearDrawingContour();\n        if (AutoAddDrawingContourModes.has(mode)) {\n          addDrawingContour();\n        }\n      },\n      { immediate: true }\n    );\n\n    onUnmounted(() => {\n      clearDrawingContour();\n    });\n\n    const onContourFinalized = (id: ContourID) => {\n      if (id === drawingContourID.value) {\n        commitDrawingContour();\n        addDrawingContour();\n      }\n    };\n\n    // --- updating active/drawing contour frame --- //\n\n    function getCurrentReferencePlane(): ReferencePlane {\n      const { lpsOrientation, indexToWorld } = currentImageMetadata.value;\n      const sliceAxis = lpsOrientation[viewAxis.value];\n      return getReferencePlaneFromSlice(\n        indexToWorld,\n        currentSlice.value,\n        sliceAxis\n      );\n    }\n\n    // update active/drawing contour's frame + slice, since the\n    // active/drawing contour is not finalized.\n    watch(\n      [currentSlice, drawingContourID] as const,\n      ([slice, contourID]) => {\n        if (!contourID) return;\n        contourStore.updateTool(contourID, {\n          slice,\n          referencePlane: getCurrentReferencePlane(),\n        });\n      },\n      { immediate: true }\n    );\n\n    // --- selected contour --- //\n\n    const onContourSelected = (id: ContourID, selected: boolean) => {\n      if (selected) {\n        contourStore.selectContour(id);\n      } else if (id === selectedContourID.value) {\n        contourStore.selectContour(null);\n      }\n    };\n\n    watch([currentSlice, currentImageID], () => {\n      const selected = selectedContourID.value;\n      if (!selected) return;\n\n      if (\n        isContourInCurrentView(selected, {\n          checkImageID: true,\n          checkSlice: true,\n        })\n      ) {\n        contourStore.selectContour(null);\n      }\n    });\n\n    onKeyDown(['Delete', 'Backspace'], (ev) => {\n      ev.preventDefault();\n      if (selectedContourID.value) {\n        contourStore.removeTool(selectedContourID.value);\n      }\n    });\n\n    // --- context menu --- //\n\n    const contextMenu = reactive({\n      visible: false,\n      x: 0,\n      y: 0,\n      id: '' as ContourID,\n    });\n\n    const onContextMenu = (id: ContourID, displayXY: Vector2) => {\n      [contextMenu.x, contextMenu.y] = displayXY;\n      contextMenu.visible = true;\n      contextMenu.id = id;\n    };\n\n    const deleteFromContextMenu = () => {\n      contourStore.removeTool(contextMenu.id);\n    };\n\n    const contextMenuLabels = computed(() => {\n      const { id: contourID } = contextMenu;\n      if (!(contourID in contourStore.toolByID)) {\n        return [];\n      }\n\n      const contour = contourStore.toolByID[contourID];\n      return Object.entries(contourStore.labels).map(([labelID, label]) => ({\n        id: labelID,\n        name: label.labelName,\n        isCurrent: contour.label === labelID,\n      }));\n    });\n\n    const setLabelFromContextMenu = (label: string) => {\n      contourStore.updateTool(contextMenu.id, { label });\n    };\n\n    // --- //\n\n    return {\n      isToolActive,\n      is2D: computed(() => viewType.value === '2D'),\n      contours,\n      drawingContourID,\n      selectedContourID,\n      toolMode: computed(() =>\n        isToolActive.value ? toolMode.value : ContourToolMode.Select\n      ),\n      contextMenu,\n      contextMenuLabels,\n      onContourFinalized,\n      onContourSelected,\n      onContextMenu,\n      deleteFromContextMenu,\n      setLabelFromContextMenu,\n    };\n  },\n});\n</script>\n\n<template>\n  <div v-if=\"is2D\" class=\"overlay-no-events\">\n    <ContourWidget2D\n      v-for=\"contour in contours\"\n      :key=\"contour.id\"\n      :view-id=\"viewId\"\n      :current-slice=\"currentSlice\"\n      :contour-id=\"contour.id\"\n      :view-direction=\"viewDirection\"\n      :widget-manager=\"widgetManager\"\n      :drawing=\"drawingContourID === contour.id\"\n      :mode=\"toolMode\"\n      :selected=\"selectedContourID === contour.id\"\n      @finalize=\"onContourFinalized(contour.id)\"\n      @select=\"onContourSelected(contour.id, $event)\"\n      @contextmenu=\"onContextMenu(contour.id, $event)\"\n    />\n    <v-menu\n      v-model=\"contextMenu.visible\"\n      :style=\"{\n        position: 'absolute',\n        top: `${contextMenu.y}px`,\n        left: `${contextMenu.x}px`,\n      }\"\n      close-on-click\n      close-on-content-click\n    >\n      <v-list dense>\n        <v-list-item @click.stop>\n          <v-list-item-title\n            class=\"d-flex flex-row align-center justify-space-betwen\"\n          >\n            <span>Change label to...</span>\n            <v-icon>mdi-chevron-right</v-icon>\n          </v-list-item-title>\n          <v-menu open-on-hover activator=\"parent\" location=\"end\">\n            <v-list dense>\n              <v-list-item v-for=\"(label, idx) in contextMenuLabels\" :key=\"idx\">\n                <v-radio\n                  :label=\"label.name\"\n                  :model-value=\"label.isCurrent\"\n                  @click=\"setLabelFromContextMenu(label.id)\"\n                >\n                </v-radio>\n              </v-list-item>\n            </v-list>\n          </v-menu>\n        </v-list-item>\n        <v-list-item @click=\"deleteFromContextMenu\">\n          <v-list-item-title>Delete</v-list-item-title>\n        </v-list-item>\n      </v-list>\n    </v-menu>\n  </div>\n</template>\n\n<style scoped src=\"@/src/components/styles/vtk-view.css\"></style>\n","<script lang=\"ts\">\nimport { onKeyDown } from '@vueuse/core';\nimport { Maybe } from '@/src/types';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { useToolStore } from '@/src/store/tools';\nimport useContourStore, { ContourToolMode } from '@/src/store/tools/contours';\nimport { Tools } from '@/src/store/tools/types';\nimport { useViewStore } from '@/src/store/views';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport { frameOfReferenceToImageSliceAndAxis } from '@/src/utils/frameOfReference';\nimport { getLPSAxisFromDir } from '@/src/utils/lps';\nimport type { Vector2 } from '@kitware/vtk.js/types';\nimport vtkWidgetManager from '@kitware/vtk.js/Widgets/Core/WidgetManager';\nimport {\n  computed,\n  defineComponent,\n  ref,\n  toRefs,\n  watch,\n  PropType,\n  onUnmounted,\n  reactive,\n} from 'vue';\nimport { storeToRefs } from 'pinia';\nimport {\n  ReferencePlane,\n  referencePlaneToFrame,\n  getReferencePlaneFromSlice,\n} from '@/src/core/contours/referencePlane';\nimport type { ContourID } from '@/src/types/contour';\nimport ContourWidget2D from './contour/ContourWidget2D.vue';\n\nconst AutoAddDrawingContourModes = new Set([\n  ContourToolMode.FreehandDraw,\n  ContourToolMode.PointPlacing,\n  ContourToolMode.Threshold,\n]);\n\nfunction fequals(a: number, b: number, eps = 1e-6) {\n  return Math.abs(a - b) < eps;\n}\n\nexport default defineComponent({\n  components: { ContourWidget2D },\n  props: {\n    viewId: {\n      type: String,\n      required: true,\n    },\n    currentSlice: {\n      type: Number,\n      required: true,\n    },\n    viewDirection: {\n      type: String as PropType<LPSAxisDir>,\n      required: true,\n    },\n    widgetManager: {\n      type: Object as PropType<vtkWidgetManager>,\n      required: true,\n    },\n  },\n  setup(props) {\n    const { viewId, viewDirection, currentSlice } = toRefs(props);\n    const toolStore = useToolStore();\n    const contourStore = useContourStore();\n    const { currentImageID, currentImageMetadata } = useCurrentImage();\n    const viewAxis = computed(() => getLPSAxisFromDir(viewDirection.value));\n    const { mode: toolMode, selectedContourID } = storeToRefs(contourStore);\n\n    const drawingContourID = ref<Maybe<ContourID>>(null);\n\n    const isToolActive = computed(\n      () => toolStore.currentTool === Tools.Contour\n    );\n    const viewType = computed(() => {\n      const viewStore = useViewStore();\n      return viewStore.viewSpecs[viewId.value].viewType;\n    });\n\n    type IsContourInCurrentViewOptions = {\n      checkImageID?: boolean;\n      checkSlice?: boolean;\n    };\n\n    const isContourInCurrentView = (\n      contourId: ContourID,\n      opts?: IsContourInCurrentViewOptions\n    ) => {\n      const { toolByID } = contourStore;\n      if (!(contourId in toolByID)) return false;\n\n      const { referencePlane, imageID } = toolByID[contourId];\n\n      const frameOfReference = referencePlaneToFrame(referencePlane);\n      const axisAndSlice = frameOfReferenceToImageSliceAndAxis(\n        frameOfReference,\n        currentImageMetadata.value,\n        {\n          allowOutOfBoundsSlice: true,\n        }\n      );\n      if (!axisAndSlice) return false;\n\n      const checkImageID = opts?.checkImageID ?? false;\n      const checkSlice = opts?.checkSlice ?? false;\n      const { axis, slice } = axisAndSlice;\n      return (\n        axis === viewAxis.value &&\n        (!checkImageID || imageID === currentImageID.value) &&\n        (!checkSlice || fequals(slice, currentSlice.value))\n      );\n    };\n\n    const contours = computed(() => {\n      return contourStore.toolIDs\n        .filter((id) => {\n          // only show contours for the current image and view axis\n          return isContourInCurrentView(id, { checkImageID: true });\n        })\n        .map((id) => contourStore.toolByID[id])\n        .filter(Boolean);\n    });\n\n    // --- active/drawing contour management -- //\n\n    const commitDrawingContour = () => {\n      drawingContourID.value = null;\n    };\n\n    const addDrawingContour = () => {\n      if (currentImageID.value && !drawingContourID.value) {\n        drawingContourID.value = contourStore.addTool({\n          imageID: currentImageID.value,\n        });\n      }\n    };\n\n    const clearDrawingContour = () => {\n      if (drawingContourID.value != null) {\n        contourStore.removeTool(drawingContourID.value);\n        drawingContourID.value = null;\n      }\n    };\n\n    // update the drawing contour's label to the active label\n    const { activeLabel } = storeToRefs(contourStore);\n\n    watch(\n      [activeLabel, drawingContourID],\n      ([label, contourID]) => {\n        if (contourID) {\n          contourStore.updateTool(contourID, {\n            label,\n          });\n        }\n      },\n      { immediate: true }\n    );\n\n    watch(\n      [isToolActive, currentImageID],\n      ([active, imageID]) => {\n        clearDrawingContour();\n        if (active && imageID) {\n          addDrawingContour();\n        }\n      },\n      { immediate: true }\n    );\n\n    watch(\n      toolMode,\n      (mode) => {\n        clearDrawingContour();\n        if (AutoAddDrawingContourModes.has(mode)) {\n          addDrawingContour();\n        }\n      },\n      { immediate: true }\n    );\n\n    onUnmounted(() => {\n      clearDrawingContour();\n    });\n\n    const onContourFinalized = (id: ContourID) => {\n      if (id === drawingContourID.value) {\n        commitDrawingContour();\n        addDrawingContour();\n      }\n    };\n\n    // --- updating active/drawing contour frame --- //\n\n    function getCurrentReferencePlane(): ReferencePlane {\n      const { lpsOrientation, indexToWorld } = currentImageMetadata.value;\n      const sliceAxis = lpsOrientation[viewAxis.value];\n      return getReferencePlaneFromSlice(\n        indexToWorld,\n        currentSlice.value,\n        sliceAxis\n      );\n    }\n\n    // update active/drawing contour's frame + slice, since the\n    // active/drawing contour is not finalized.\n    watch(\n      [currentSlice, drawingContourID] as const,\n      ([slice, contourID]) => {\n        if (!contourID) return;\n        contourStore.updateTool(contourID, {\n          slice,\n          referencePlane: getCurrentReferencePlane(),\n        });\n      },\n      { immediate: true }\n    );\n\n    // --- selected contour --- //\n\n    const onContourSelected = (id: ContourID, selected: boolean) => {\n      if (selected) {\n        contourStore.selectContour(id);\n      } else if (id === selectedContourID.value) {\n        contourStore.selectContour(null);\n      }\n    };\n\n    watch([currentSlice, currentImageID], () => {\n      const selected = selectedContourID.value;\n      if (!selected) return;\n\n      if (\n        isContourInCurrentView(selected, {\n          checkImageID: true,\n          checkSlice: true,\n        })\n      ) {\n        contourStore.selectContour(null);\n      }\n    });\n\n    onKeyDown(['Delete', 'Backspace'], (ev) => {\n      ev.preventDefault();\n      if (selectedContourID.value) {\n        contourStore.removeTool(selectedContourID.value);\n      }\n    });\n\n    // --- context menu --- //\n\n    const contextMenu = reactive({\n      visible: false,\n      x: 0,\n      y: 0,\n      id: '' as ContourID,\n    });\n\n    const onContextMenu = (id: ContourID, displayXY: Vector2) => {\n      [contextMenu.x, contextMenu.y] = displayXY;\n      contextMenu.visible = true;\n      contextMenu.id = id;\n    };\n\n    const deleteFromContextMenu = () => {\n      contourStore.removeTool(contextMenu.id);\n    };\n\n    const contextMenuLabels = computed(() => {\n      const { id: contourID } = contextMenu;\n      if (!(contourID in contourStore.toolByID)) {\n        return [];\n      }\n\n      const contour = contourStore.toolByID[contourID];\n      return Object.entries(contourStore.labels).map(([labelID, label]) => ({\n        id: labelID,\n        name: label.labelName,\n        isCurrent: contour.label === labelID,\n      }));\n    });\n\n    const setLabelFromContextMenu = (label: string) => {\n      contourStore.updateTool(contextMenu.id, { label });\n    };\n\n    // --- //\n\n    return {\n      isToolActive,\n      is2D: computed(() => viewType.value === '2D'),\n      contours,\n      drawingContourID,\n      selectedContourID,\n      toolMode: computed(() =>\n        isToolActive.value ? toolMode.value : ContourToolMode.Select\n      ),\n      contextMenu,\n      contextMenuLabels,\n      onContourFinalized,\n      onContourSelected,\n      onContextMenu,\n      deleteFromContextMenu,\n      setLabelFromContextMenu,\n    };\n  },\n});\n</script>\n\n<template>\n  <div v-if=\"is2D\" class=\"overlay-no-events\">\n    <ContourWidget2D\n      v-for=\"contour in contours\"\n      :key=\"contour.id\"\n      :view-id=\"viewId\"\n      :current-slice=\"currentSlice\"\n      :contour-id=\"contour.id\"\n      :view-direction=\"viewDirection\"\n      :widget-manager=\"widgetManager\"\n      :drawing=\"drawingContourID === contour.id\"\n      :mode=\"toolMode\"\n      :selected=\"selectedContourID === contour.id\"\n      @finalize=\"onContourFinalized(contour.id)\"\n      @select=\"onContourSelected(contour.id, $event)\"\n      @contextmenu=\"onContextMenu(contour.id, $event)\"\n    />\n    <v-menu\n      v-model=\"contextMenu.visible\"\n      :style=\"{\n        position: 'absolute',\n        top: `${contextMenu.y}px`,\n        left: `${contextMenu.x}px`,\n      }\"\n      close-on-click\n      close-on-content-click\n    >\n      <v-list dense>\n        <v-list-item @click.stop>\n          <v-list-item-title\n            class=\"d-flex flex-row align-center justify-space-betwen\"\n          >\n            <span>Change label to...</span>\n            <v-icon>mdi-chevron-right</v-icon>\n          </v-list-item-title>\n          <v-menu open-on-hover activator=\"parent\" location=\"end\">\n            <v-list dense>\n              <v-list-item v-for=\"(label, idx) in contextMenuLabels\" :key=\"idx\">\n                <v-radio\n                  :label=\"label.name\"\n                  :model-value=\"label.isCurrent\"\n                  @click=\"setLabelFromContextMenu(label.id)\"\n                >\n                </v-radio>\n              </v-list-item>\n            </v-list>\n          </v-menu>\n        </v-list-item>\n        <v-list-item @click=\"deleteFromContextMenu\">\n          <v-list-item-title>Delete</v-list-item-title>\n        </v-list-item>\n      </v-list>\n    </v-menu>\n  </div>\n</template>\n\n<style scoped src=\"@/src/components/styles/vtk-view.css\"></style>\n","<script lang=\"ts\">\nimport vtkWidgetManager from '@kitware/vtk.js/Widgets/Core/WidgetManager';\nimport {\n  computed,\n  defineComponent,\n  onBeforeUnmount,\n  onMounted,\n  onUnmounted,\n  PropType,\n  ref,\n  toRefs,\n  watchEffect,\n} from 'vue';\nimport vtkPlaneManipulator from '@kitware/vtk.js/Widgets/Manipulators/PlaneManipulator';\nimport { getLPSAxisFromDir } from '@/src/utils/lps';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { updatePlaneManipulatorFor2DView } from '@/src/utils/manipulators';\nimport type { vtkSubscription } from '@kitware/vtk.js/interfaces';\nimport { usePaintToolStore } from '@/src/store/tools/paint';\nimport { vtkPaintViewWidget } from '@/src/vtk/PaintWidget';\nimport { useViewStore } from '@/src/store/views';\nimport { PaintWidgetState } from '@/src/vtk/PaintWidget/state';\nimport { vec3 } from 'gl-matrix';\nimport { manageVTKSubscription } from '@/src/composables/manageVTKSubscription';\nimport { LPSAxisDir } from '@/src/types/lps';\n\nexport default defineComponent({\n  name: 'PaintWidget2D',\n  props: {\n    widgetManager: {\n      type: Object as PropType<vtkWidgetManager>,\n      required: true,\n    },\n    viewId: {\n      type: String,\n      required: true,\n    },\n    viewDirection: {\n      type: String as PropType<LPSAxisDir>,\n      required: true,\n    },\n    slice: {\n      type: Number,\n      required: true,\n    },\n  },\n  setup(props) {\n    const {\n      widgetManager: widgetManagerRef,\n      viewDirection,\n      slice,\n      viewId: viewID,\n    } = toRefs(props);\n\n    const paintStore = usePaintToolStore();\n    const factory = paintStore.getWidgetFactory();\n\n    const viewStore = useViewStore();\n    const viewProxyRef = computed(() => viewStore.getViewProxy(viewID.value));\n\n    const widgetRef = ref<vtkPaintViewWidget>();\n\n    const { currentImageMetadata } = useCurrentImage();\n    const viewAxis = computed(() => getLPSAxisFromDir(viewDirection.value));\n    const viewAxisIndex = computed(\n      () => currentImageMetadata.value.lpsOrientation[viewAxis.value]\n    );\n\n    const worldPointToIndex = (worldPoint: vec3) => {\n      const { worldToIndex } = currentImageMetadata.value;\n      const indexPoint = vec3.create();\n      vec3.transformMat4(indexPoint, worldPoint, worldToIndex);\n      return indexPoint;\n    };\n\n    onMounted(() => {\n      const widgetManager = widgetManagerRef.value;\n      widgetRef.value = widgetManager.addWidget(factory) as vtkPaintViewWidget;\n\n      if (!widgetRef.value) {\n        throw new Error('[PaintWidget2D] failed to create view widget');\n      }\n    });\n\n    // --- widget representation config --- //\n\n    watchEffect(() => {\n      const widget = widgetRef.value!;\n      const metadata = currentImageMetadata.value;\n      const slicingIndex = metadata.lpsOrientation[viewAxis.value];\n      if (widget) {\n        widget.setSlicingIndex(slicingIndex);\n        widget.setIndexToWorld(metadata.indexToWorld);\n        widget.setWorldToIndex(metadata.worldToIndex);\n      }\n    });\n\n    // --- interaction --- //\n\n    const subs: vtkSubscription[] = [];\n\n    onMounted(() => {\n      const widget = widgetRef.value!;\n\n      subs.push(\n        widget.onStartInteractionEvent(() => {\n          // start stroke\n          const state = widget.getWidgetState() as PaintWidgetState;\n          // StartInteraction cannot occur if origin is null.\n          const indexPoint = worldPointToIndex(state.getBrush().getOrigin()!);\n          paintStore.startStroke(indexPoint, viewAxisIndex.value);\n        }),\n        widget.onInteractionEvent(() => {\n          // register stroke\n          const state = widget.getWidgetState() as PaintWidgetState;\n          const indexPoint = worldPointToIndex(state.getBrush().getOrigin()!);\n          paintStore.placeStrokePoint(indexPoint, viewAxisIndex.value);\n        }),\n        widget.onEndInteractionEvent(() => {\n          // end stroke\n          const state = widget.getWidgetState() as PaintWidgetState;\n          const indexPoint = worldPointToIndex(state.getBrush().getOrigin()!);\n          paintStore.endStroke(indexPoint, viewAxisIndex.value);\n        })\n      );\n    });\n\n    onUnmounted(() => {\n      while (subs.length) {\n        subs.pop()!.unsubscribe();\n      }\n    });\n\n    // --- manipulator --- //\n\n    const manipulator = vtkPlaneManipulator.newInstance();\n\n    onMounted(() => {\n      widgetRef.value!.setManipulator(manipulator);\n    });\n\n    watchEffect(() => {\n      updatePlaneManipulatorFor2DView(\n        manipulator,\n        viewDirection.value,\n        slice.value,\n        currentImageMetadata.value\n      );\n    });\n\n    // --- visibility --- //\n\n    onMounted(() => {\n      widgetRef.value!.setVisibility(false);\n    });\n\n    manageVTKSubscription(\n      viewProxyRef.value!.getInteractor().onMouseEnter(() => {\n        const widget = widgetRef.value;\n        if (widget) {\n          paintStore.setSliceAxis(viewAxisIndex.value);\n          widget.setVisibility(true);\n        }\n      })\n    );\n\n    manageVTKSubscription(\n      viewProxyRef.value!.getInteractor().onMouseLeave(() => {\n        const widget = widgetRef.value;\n        if (widget) {\n          widget.setVisibility(false);\n        }\n      })\n    );\n\n    // --- focus and rendering --- //\n\n    onMounted(() => {\n      const widgetManager = widgetManagerRef.value;\n      widgetManager.renderWidgets();\n      widgetManager.grabFocus(widgetRef.value!);\n    });\n\n    onBeforeUnmount(() => {\n      widgetManagerRef.value.removeWidget(widgetRef.value!);\n      widgetManagerRef.value.releaseFocus();\n    });\n\n    return () => null;\n  },\n});\n</script>\n","<template>\n  <div class=\"overlay-no-events\">\n    <PaintWidget2D\n      v-if=\"active\"\n      :slice=\"slice\"\n      :view-id=\"viewId\"\n      :view-direction=\"viewDirection\"\n      :widget-manager=\"widgetManager\"\n    />\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, PropType } from 'vue';\nimport vtkWidgetManager from '@kitware/vtk.js/Widgets/Core/WidgetManager';\nimport { usePaintToolStore } from '@/src/store/tools/paint';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport PaintWidget2D from './paint/PaintWidget2D.vue';\n\nexport default defineComponent({\n  name: 'PaintTool',\n  props: {\n    viewId: {\n      type: String,\n      required: true,\n    },\n    slice: {\n      type: Number,\n      required: true,\n    },\n    viewDirection: {\n      type: String as PropType<LPSAxisDir>,\n      required: true,\n    },\n    widgetManager: {\n      type: Object as PropType<vtkWidgetManager>,\n      required: true,\n    },\n  },\n  components: {\n    PaintWidget2D,\n  },\n  setup() {\n    const paintStore = usePaintToolStore();\n    const active = computed(() => paintStore.isActive);\n\n    return {\n      active,\n    };\n  },\n});\n</script>\n\n<style scoped src=\"@/src/components/styles/vtk-view.css\"></style>\n","<template>\n  <div class=\"overlay-no-events\">\n    <PaintWidget2D\n      v-if=\"active\"\n      :slice=\"slice\"\n      :view-id=\"viewId\"\n      :view-direction=\"viewDirection\"\n      :widget-manager=\"widgetManager\"\n    />\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, PropType } from 'vue';\nimport vtkWidgetManager from '@kitware/vtk.js/Widgets/Core/WidgetManager';\nimport { usePaintToolStore } from '@/src/store/tools/paint';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport PaintWidget2D from './paint/PaintWidget2D.vue';\n\nexport default defineComponent({\n  name: 'PaintTool',\n  props: {\n    viewId: {\n      type: String,\n      required: true,\n    },\n    slice: {\n      type: Number,\n      required: true,\n    },\n    viewDirection: {\n      type: String as PropType<LPSAxisDir>,\n      required: true,\n    },\n    widgetManager: {\n      type: Object as PropType<vtkWidgetManager>,\n      required: true,\n    },\n  },\n  components: {\n    PaintWidget2D,\n  },\n  setup() {\n    const paintStore = usePaintToolStore();\n    const active = computed(() => paintStore.isActive);\n\n    return {\n      active,\n    };\n  },\n});\n</script>\n\n<style scoped src=\"@/src/components/styles/vtk-view.css\"></style>\n","import vtkAbstractRepresentationProxy from '@kitware/vtk.js/Proxy/Core/AbstractRepresentationProxy';\nimport { computed, Ref, watch } from 'vue';\nimport { useViewStore } from '../store/views';\nimport { vtkLPSViewProxy } from '../types/vtk-types';\nimport { arrayEquals } from '../utils';\n\ninterface Scene {\n  baseImage?: Ref<string | null>;\n  labelmaps?: Ref<string[]>;\n  layers?: Ref<string[]>;\n  models?: Ref<string[]>;\n}\n\ntype RepProxy = vtkAbstractRepresentationProxy;\n\nexport function useSceneBuilder<\n  BaseImageType extends RepProxy = RepProxy,\n  LabelMapType extends RepProxy = RepProxy,\n  LayerType extends RepProxy = RepProxy,\n  ModelType extends RepProxy = RepProxy\n>(viewID: Ref<string>, sceneIDs: Scene) {\n  const viewStore = useViewStore();\n  const viewProxy = computed(() =>\n    viewStore.getViewProxy<vtkLPSViewProxy>(viewID.value)\n  );\n\n  const baseImageRep = computed(() => {\n    const imageID = sceneIDs.baseImage?.value;\n    if (!imageID) return null;\n\n    return viewStore.getDataRepresentationForView<BaseImageType>(\n      imageID,\n      viewID.value\n    );\n  });\n\n  const labelmapReps = computed(() => {\n    const labelmapIDs = sceneIDs.labelmaps?.value ?? [];\n    return labelmapIDs\n      .map((id) =>\n        viewStore.getDataRepresentationForView<LabelMapType>(id, viewID.value)\n      )\n      .filter(Boolean) as LabelMapType[];\n  });\n\n  const layerReps = computed(\n    () =>\n      (sceneIDs.layers?.value ?? [])\n        .map((id) =>\n          viewStore.getDataRepresentationForView<LayerType>(id, viewID.value)\n        )\n        .filter(Boolean) as LayerType[]\n  );\n\n  const modelReps = computed(() => {\n    const modelIDs = sceneIDs.models?.value ?? [];\n    return modelIDs\n      .map((id) =>\n        viewStore.getDataRepresentationForView<ModelType>(id, viewID.value)\n      )\n      .filter(Boolean) as ModelType[];\n  });\n\n  type SceneObject = BaseImageType | LabelMapType | LayerType | ModelType;\n\n  const allRepresentations = computed<SceneObject[]>(() => {\n    return [\n      baseImageRep.value,\n      ...labelmapReps.value,\n      ...layerReps.value,\n      ...modelReps.value,\n    ].filter(Boolean) as SceneObject[];\n  });\n\n  watch(\n    [viewProxy, allRepresentations],\n    ([view, reps], [, oldReps]) => {\n      if (!view) {\n        throw new Error('[useSceneBuilder] No view available');\n      }\n\n      if (oldReps && arrayEquals(reps, oldReps)) {\n        return;\n      }\n\n      view.removeAllRepresentations();\n      reps.forEach((rep) => {\n        view.addRepresentation(rep);\n      });\n\n      // TODO not sure why I need this, but might as well keep\n      // the renderer up to date.\n      // For reference, this doesn't get invoked when resetting the\n      // camera with a supplied bounds, so we manually invoke it here.\n      view.getRenderer().computeVisiblePropBounds();\n      view.renderLater();\n    },\n    { immediate: true }\n  );\n\n  return { baseImageRep, labelmapReps, layerReps, modelReps };\n}\n","import { manageVTKSubscription } from '@src/composables/manageVTKSubscription';\nimport { Ref } from 'vue';\nimport { CameraConfig } from '../store/view-configs/types';\nimport { vtkLPSViewProxy } from '../types/vtk-types';\nimport useViewCameraStore from '../store/view-configs/camera';\n\nexport function usePersistCameraConfig(\n  viewID: Ref<string>,\n  dataID: Ref<string | null>,\n  viewProxy: Ref<vtkLPSViewProxy>,\n  ...toPersist: (keyof CameraConfig)[]\n) {\n  const viewCameraStore = useViewCameraStore();\n  let persistCameraConfig = true;\n\n  // We setup this list of functions to avoid if and indexOf in the onModified\n  // call.\n  const persist: (() => void)[] = [];\n\n  if (toPersist.indexOf('position') > -1) {\n    persist.push(() => {\n      if (dataID.value !== null && persistCameraConfig) {\n        viewCameraStore.updateConfig(viewID.value, dataID.value, {\n          position: viewProxy.value.getCamera().getPosition(),\n        });\n      }\n    });\n  }\n  if (toPersist.indexOf('viewUp') > -1) {\n    persist.push(() => {\n      if (dataID.value !== null && persistCameraConfig) {\n        viewCameraStore.updateConfig(viewID.value, dataID.value, {\n          viewUp: viewProxy.value.getCamera().getViewUp(),\n        });\n      }\n    });\n  }\n  if (toPersist.indexOf('focalPoint') > -1) {\n    persist.push(() => {\n      if (dataID.value !== null && persistCameraConfig) {\n        viewCameraStore.updateConfig(viewID.value, dataID.value, {\n          focalPoint: viewProxy.value.getCamera().getFocalPoint(),\n        });\n      }\n    });\n  }\n  if (toPersist.indexOf('directionOfProjection') > -1) {\n    persist.push(() => {\n      if (dataID.value !== null && persistCameraConfig) {\n        viewCameraStore.updateConfig(viewID.value, dataID.value, {\n          directionOfProjection: viewProxy.value\n            .getCamera()\n            .getDirectionOfProjection(),\n        });\n      }\n    });\n  }\n  if (toPersist.indexOf('parallelScale') > -1) {\n    persist.push(() => {\n      if (dataID.value !== null && persistCameraConfig) {\n        viewCameraStore.updateConfig(viewID.value, dataID.value, {\n          parallelScale: viewProxy.value.getCamera().getParallelScale(),\n        });\n      }\n    });\n  }\n\n  manageVTKSubscription(\n    viewProxy.value.getCamera().onModified(() => {\n      persist.forEach((persistFunc) => persistFunc());\n    })\n  );\n\n  function blockPersistingCameraConfig(func: () => void) {\n    persistCameraConfig = false;\n    try {\n      func();\n    } finally {\n      persistCameraConfig = true;\n    }\n  }\n\n  function restoreCameraConfig(cameraConfig: CameraConfig) {\n    blockPersistingCameraConfig(() => {\n      toPersist.forEach((key: keyof CameraConfig) => {\n        // Parallel scale\n        if (key === 'parallelScale' && cameraConfig.parallelScale) {\n          viewProxy.value\n            .getCamera()\n            .setParallelScale(cameraConfig.parallelScale);\n        }\n        // Position\n        else if (key === 'position' && cameraConfig.position) {\n          const { position } = cameraConfig;\n          viewProxy.value\n            .getCamera()\n            .setPosition(position[0], position[1], position[2]);\n        }\n        // Focal point\n        else if (key === 'focalPoint' && cameraConfig.focalPoint) {\n          const { focalPoint } = cameraConfig;\n          viewProxy.value\n            .getCamera()\n            .setFocalPoint(focalPoint[0], focalPoint[1], focalPoint[2]);\n          viewProxy.value\n            .getInteractorStyle2D()\n            .setCenterOfRotation([...focalPoint]);\n          viewProxy.value\n            .getInteractorStyle3D()\n            .setCenterOfRotation([...focalPoint]);\n        }\n        // Direction of projection\n        else if (\n          key === 'directionOfProjection' &&\n          cameraConfig.directionOfProjection\n        ) {\n          const { directionOfProjection } = cameraConfig;\n          viewProxy.value\n            .getCamera()\n            .setDirectionOfProjection(\n              directionOfProjection[0],\n              directionOfProjection[1],\n              directionOfProjection[2]\n            );\n        }\n        // View up\n        else if (key === 'viewUp' && cameraConfig.viewUp) {\n          const { viewUp } = cameraConfig;\n          viewProxy.value\n            .getCamera()\n            .setViewUp(viewUp[0], viewUp[1], viewUp[2]);\n        }\n      });\n    });\n  }\n\n  return { restoreCameraConfig };\n}\n","<script lang=\"ts\">\nimport vtkWidgetManager from '@kitware/vtk.js/Widgets/Core/WidgetManager';\nimport {\n  defineComponent,\n  onBeforeUnmount,\n  onMounted,\n  PropType,\n  ref,\n  toRefs,\n  watchEffect,\n} from 'vue';\nimport vtkPlaneManipulator from '@kitware/vtk.js/Widgets/Manipulators/PlaneManipulator';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { updatePlaneManipulatorFor2DView } from '@/src/utils/manipulators';\nimport { vtkCrosshairsViewWidget } from '@/src/vtk/CrosshairsWidget';\nimport { useCrosshairsToolStore } from '@/src/store/tools/crosshairs';\n\nexport default defineComponent({\n  name: 'CrosshairsWidget2D',\n  props: {\n    widgetManager: {\n      type: Object as PropType<vtkWidgetManager>,\n      required: true,\n    },\n    viewId: {\n      type: String,\n      required: true,\n    },\n    viewDirection: {\n      type: String as PropType<LPSAxisDir>,\n      required: true,\n    },\n    slice: {\n      type: Number,\n      required: true,\n    },\n  },\n  setup(props) {\n    const {\n      widgetManager: widgetManagerRef,\n      viewDirection,\n      slice,\n    } = toRefs(props);\n\n    const crosshairsStore = useCrosshairsToolStore();\n    const factory = crosshairsStore.getWidgetFactory();\n\n    const widgetRef = ref<vtkCrosshairsViewWidget>();\n\n    const { currentImageMetadata } = useCurrentImage();\n    onMounted(() => {\n      const widgetManager = widgetManagerRef.value;\n      widgetRef.value = widgetManager.addWidget(\n        factory\n      ) as vtkCrosshairsViewWidget;\n\n      if (!widgetRef.value) {\n        throw new Error('[PaintWidget2D] failed to create view widget');\n      }\n    });\n\n    // --- manipulator --- //\n\n    const manipulator = vtkPlaneManipulator.newInstance();\n\n    onMounted(() => {\n      widgetRef.value!.setManipulator(manipulator);\n    });\n\n    watchEffect(() => {\n      updatePlaneManipulatorFor2DView(\n        manipulator,\n        viewDirection.value,\n        slice.value,\n        currentImageMetadata.value\n      );\n    });\n\n    // --- visibility --- //\n\n    onMounted(() => {\n      widgetRef.value!.setVisibility(true);\n    });\n\n    // --- focus and rendering --- //\n\n    onMounted(() => {\n      const widgetManager = widgetManagerRef.value;\n      widgetManager.renderWidgets();\n    });\n\n    onBeforeUnmount(() => {\n      widgetManagerRef.value.removeWidget(widgetRef.value!);\n    });\n\n    return () => null;\n  },\n});\n</script>\n","<template>\n  <g>\n    <line\n      v-if=\"x != null && y != null\"\n      :x1=\"x\"\n      y1=\"0%\"\n      :x2=\"x\"\n      :y2=\"y - 8\"\n      stroke=\"yellow\"\n      stroke-width=\"1\"\n    />\n    <line\n      v-if=\"x != null && y != null\"\n      :x1=\"x\"\n      :y1=\"y + 8\"\n      :x2=\"x\"\n      y2=\"100%\"\n      stroke=\"yellow\"\n      stroke-width=\"1\"\n    />\n    <line\n      v-if=\"x != null && y != null\"\n      x1=\"0%\"\n      :y1=\"y\"\n      :x2=\"x - 8\"\n      :y2=\"y\"\n      stroke=\"yellow\"\n      stroke-width=\"1\"\n    />\n    <line\n      v-if=\"x != null && y != null\"\n      :x1=\"x + 8\"\n      :y1=\"y\"\n      x2=\"100%\"\n      :y2=\"y\"\n      stroke=\"yellow\"\n      stroke-width=\"1\"\n    />\n  </g>\n</template>\n\n<script lang=\"ts\">\nimport { useResizeObserver } from '@/src/composables/useResizeObserver';\nimport { useVTKCallback } from '@/src/composables/useVTKCallback';\nimport { ToolContainer } from '@/src/constants';\nimport { useViewStore } from '@/src/store/views';\nimport { worldToSVG } from '@/src/utils/vtk-helpers';\nimport vtkLPSView2DProxy from '@/src/vtk/LPSView2DProxy';\nimport type { Vector3 } from '@kitware/vtk.js/types';\nimport {\n  PropType,\n  defineComponent,\n  toRefs,\n  unref,\n  ref,\n  watchEffect,\n  computed,\n  inject,\n} from 'vue';\n\ntype SVGPoint = {\n  x: number;\n  y: number;\n};\n\nexport default defineComponent({\n  props: {\n    position: Array as PropType<Array<number>>,\n    viewId: {\n      type: String,\n      required: true,\n    },\n  },\n  setup(props) {\n    const { viewId: viewID, position } = toRefs(props);\n    const position2D = ref<SVGPoint>();\n\n    const viewStore = useViewStore();\n\n    const viewProxy = computed(\n      () => viewStore.getViewProxy<vtkLPSView2DProxy>(viewID.value)!\n    );\n\n    const updatePoints = () => {\n      const viewRenderer = viewProxy.value.getRenderer();\n      const pt = unref(position) as Vector3 | undefined;\n      if (pt) {\n        const point2D = worldToSVG(pt, viewRenderer);\n        if (point2D) {\n          position2D.value = {\n            x: point2D[0],\n            y: point2D[1],\n          };\n        }\n      }\n    };\n\n    const cameraOnModified = useVTKCallback(\n      computed(() => viewProxy.value.getCamera().onModified)\n    );\n    cameraOnModified(updatePoints);\n\n    watchEffect(updatePoints);\n\n    // --- resize --- //\n\n    const containerEl = inject(ToolContainer)!;\n\n    useResizeObserver(containerEl, () => {\n      updatePoints();\n    });\n\n    return {\n      devicePixelRatio,\n      x: computed(() => position2D.value?.x),\n      y: computed(() => position2D.value?.y),\n    };\n  },\n});\n</script>\n\n<style scoped>\n.handle {\n  cursor: pointer;\n}\n</style>\n","<template>\n  <g>\n    <line\n      v-if=\"x != null && y != null\"\n      :x1=\"x\"\n      y1=\"0%\"\n      :x2=\"x\"\n      :y2=\"y - 8\"\n      stroke=\"yellow\"\n      stroke-width=\"1\"\n    />\n    <line\n      v-if=\"x != null && y != null\"\n      :x1=\"x\"\n      :y1=\"y + 8\"\n      :x2=\"x\"\n      y2=\"100%\"\n      stroke=\"yellow\"\n      stroke-width=\"1\"\n    />\n    <line\n      v-if=\"x != null && y != null\"\n      x1=\"0%\"\n      :y1=\"y\"\n      :x2=\"x - 8\"\n      :y2=\"y\"\n      stroke=\"yellow\"\n      stroke-width=\"1\"\n    />\n    <line\n      v-if=\"x != null && y != null\"\n      :x1=\"x + 8\"\n      :y1=\"y\"\n      x2=\"100%\"\n      :y2=\"y\"\n      stroke=\"yellow\"\n      stroke-width=\"1\"\n    />\n  </g>\n</template>\n\n<script lang=\"ts\">\nimport { useResizeObserver } from '@/src/composables/useResizeObserver';\nimport { useVTKCallback } from '@/src/composables/useVTKCallback';\nimport { ToolContainer } from '@/src/constants';\nimport { useViewStore } from '@/src/store/views';\nimport { worldToSVG } from '@/src/utils/vtk-helpers';\nimport vtkLPSView2DProxy from '@/src/vtk/LPSView2DProxy';\nimport type { Vector3 } from '@kitware/vtk.js/types';\nimport {\n  PropType,\n  defineComponent,\n  toRefs,\n  unref,\n  ref,\n  watchEffect,\n  computed,\n  inject,\n} from 'vue';\n\ntype SVGPoint = {\n  x: number;\n  y: number;\n};\n\nexport default defineComponent({\n  props: {\n    position: Array as PropType<Array<number>>,\n    viewId: {\n      type: String,\n      required: true,\n    },\n  },\n  setup(props) {\n    const { viewId: viewID, position } = toRefs(props);\n    const position2D = ref<SVGPoint>();\n\n    const viewStore = useViewStore();\n\n    const viewProxy = computed(\n      () => viewStore.getViewProxy<vtkLPSView2DProxy>(viewID.value)!\n    );\n\n    const updatePoints = () => {\n      const viewRenderer = viewProxy.value.getRenderer();\n      const pt = unref(position) as Vector3 | undefined;\n      if (pt) {\n        const point2D = worldToSVG(pt, viewRenderer);\n        if (point2D) {\n          position2D.value = {\n            x: point2D[0],\n            y: point2D[1],\n          };\n        }\n      }\n    };\n\n    const cameraOnModified = useVTKCallback(\n      computed(() => viewProxy.value.getCamera().onModified)\n    );\n    cameraOnModified(updatePoints);\n\n    watchEffect(updatePoints);\n\n    // --- resize --- //\n\n    const containerEl = inject(ToolContainer)!;\n\n    useResizeObserver(containerEl, () => {\n      updatePoints();\n    });\n\n    return {\n      devicePixelRatio,\n      x: computed(() => position2D.value?.x),\n      y: computed(() => position2D.value?.y),\n    };\n  },\n});\n</script>\n\n<style scoped>\n.handle {\n  cursor: pointer;\n}\n</style>\n","<template>\n  <div v-if=\"active\" class=\"overlay-no-events\">\n    <svg class=\"overlay-no-events\">\n      <CrosshairSVG2D\n        v-show=\"isVisible\"\n        :view-id=\"viewId\"\n        :position=\"position\"\n      />\n    </svg>\n    <CrosshairsWidget2D\n      :slice=\"slice\"\n      :view-id=\"viewId\"\n      :view-direction=\"viewDirection\"\n      :widget-manager=\"widgetManager\"\n    />\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { storeToRefs } from 'pinia';\nimport { computed, defineComponent, PropType, toRefs } from 'vue';\nimport vtkWidgetManager from '@kitware/vtk.js/Widgets/Core/WidgetManager';\nimport { getLPSAxisFromDir } from '@/src/utils/lps';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport { useToolStore } from '@/src/store/tools';\nimport { Tools } from '@/src/store/tools/types';\nimport { useCrosshairsToolStore } from '@/src/store/tools/crosshairs';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { clampValue } from '@/src/utils';\nimport CrosshairsWidget2D from './crosshairs/CrosshairsWidget2D.vue';\nimport CrosshairSVG2D from './crosshairs/CrosshairSVG2D.vue';\n\nexport default defineComponent({\n  name: 'CrosshairsTool',\n  props: {\n    viewId: {\n      type: String,\n      required: true,\n    },\n    slice: {\n      type: Number,\n      required: true,\n    },\n    viewDirection: {\n      type: String as PropType<LPSAxisDir>,\n      required: true,\n    },\n    widgetManager: {\n      type: Object as PropType<vtkWidgetManager>,\n      required: true,\n    },\n  },\n  components: {\n    CrosshairsWidget2D,\n    CrosshairSVG2D,\n  },\n  setup(props) {\n    const { viewDirection, slice } = toRefs(props);\n\n    const toolStore = useToolStore();\n    const { position, imagePosition } = storeToRefs(useCrosshairsToolStore());\n\n    const { currentImageMetadata } = useCurrentImage();\n    const active = computed(() => toolStore.currentTool === Tools.Crosshairs);\n    const isVisible = computed(() => {\n      const { lpsOrientation, dimensions } = currentImageMetadata.value;\n      const axis = getLPSAxisFromDir(viewDirection.value);\n      const index = lpsOrientation[axis];\n      // Since the image rectangle is inflated by 0.5,\n      // clamp to the allowed range for the slice.\n      const crosshairsSlice = clampValue(\n        imagePosition.value[index],\n        0,\n        dimensions[index] - 1\n      );\n      return Math.round(crosshairsSlice) === slice.value;\n    });\n\n    return {\n      active,\n      position,\n      isVisible,\n    };\n  },\n});\n</script>\n\n<style scoped src=\"@/src/components/styles/vtk-view.css\"></style>\n","<template>\n  <div v-if=\"active\" class=\"overlay-no-events\">\n    <svg class=\"overlay-no-events\">\n      <CrosshairSVG2D\n        v-show=\"isVisible\"\n        :view-id=\"viewId\"\n        :position=\"position\"\n      />\n    </svg>\n    <CrosshairsWidget2D\n      :slice=\"slice\"\n      :view-id=\"viewId\"\n      :view-direction=\"viewDirection\"\n      :widget-manager=\"widgetManager\"\n    />\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { storeToRefs } from 'pinia';\nimport { computed, defineComponent, PropType, toRefs } from 'vue';\nimport vtkWidgetManager from '@kitware/vtk.js/Widgets/Core/WidgetManager';\nimport { getLPSAxisFromDir } from '@/src/utils/lps';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport { useToolStore } from '@/src/store/tools';\nimport { Tools } from '@/src/store/tools/types';\nimport { useCrosshairsToolStore } from '@/src/store/tools/crosshairs';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { clampValue } from '@/src/utils';\nimport CrosshairsWidget2D from './crosshairs/CrosshairsWidget2D.vue';\nimport CrosshairSVG2D from './crosshairs/CrosshairSVG2D.vue';\n\nexport default defineComponent({\n  name: 'CrosshairsTool',\n  props: {\n    viewId: {\n      type: String,\n      required: true,\n    },\n    slice: {\n      type: Number,\n      required: true,\n    },\n    viewDirection: {\n      type: String as PropType<LPSAxisDir>,\n      required: true,\n    },\n    widgetManager: {\n      type: Object as PropType<vtkWidgetManager>,\n      required: true,\n    },\n  },\n  components: {\n    CrosshairsWidget2D,\n    CrosshairSVG2D,\n  },\n  setup(props) {\n    const { viewDirection, slice } = toRefs(props);\n\n    const toolStore = useToolStore();\n    const { position, imagePosition } = storeToRefs(useCrosshairsToolStore());\n\n    const { currentImageMetadata } = useCurrentImage();\n    const active = computed(() => toolStore.currentTool === Tools.Crosshairs);\n    const isVisible = computed(() => {\n      const { lpsOrientation, dimensions } = currentImageMetadata.value;\n      const axis = getLPSAxisFromDir(viewDirection.value);\n      const index = lpsOrientation[axis];\n      // Since the image rectangle is inflated by 0.5,\n      // clamp to the allowed range for the slice.\n      const crosshairsSlice = clampValue(\n        imagePosition.value[index],\n        0,\n        dimensions[index] - 1\n      );\n      return Math.round(crosshairsSlice) === slice.value;\n    });\n\n    return {\n      active,\n      position,\n      isVisible,\n    };\n  },\n});\n</script>\n\n<style scoped src=\"@/src/components/styles/vtk-view.css\"></style>\n","import vtkViewProxy from '@kitware/vtk.js/Proxy/Core/ViewProxy';\nimport { computed, ref, unref, watch } from 'vue';\nimport { MaybeRef } from '@vueuse/core';\nimport { ViewProxyType } from '../core/proxies';\nimport { useViewStore } from '../store/views';\nimport { useVTKCallback } from './useVTKCallback';\n\nexport function useViewProxy<T extends vtkViewProxy = vtkViewProxy>(\n  id: MaybeRef<string>,\n  type: MaybeRef<ViewProxyType>\n) {\n  const viewStore = useViewStore();\n\n  const container = ref<HTMLElement | null>(null);\n\n  const setContainer = (el: HTMLElement | null | undefined) => {\n    container.value = el ?? null;\n  };\n\n  const viewProxy = computed<T>(() =>\n    viewStore.createOrGetViewProxy(unref(id), unref(type))\n  );\n\n  watch(viewProxy, (curViewProxy, oldViewProxy) => {\n    oldViewProxy.setContainer(null);\n    curViewProxy.setContainer(container.value);\n  });\n\n  watch(container, (curContainer) => {\n    viewProxy.value.setContainer(curContainer);\n    // setContainer doesn't call modified\n    viewProxy.value.modified();\n  });\n\n  return {\n    viewProxy,\n    setContainer,\n  };\n}\n\nfunction onViewProxyModified<T extends vtkViewProxy = vtkViewProxy>(\n  viewProxy: MaybeRef<T>,\n  callback: () => void\n) {\n  const onModified = useVTKCallback(\n    computed(() => unref(viewProxy).onModified)\n  );\n  onModified(callback);\n}\n\nfunction useMountedViewProxy<T extends vtkViewProxy = vtkViewProxy>(\n  viewProxy: MaybeRef<T>\n) {\n  const mounted = ref(false);\n\n  const updateMounted = () => {\n    mounted.value = !!unref(viewProxy).getContainer();\n  };\n\n  updateMounted();\n\n  onViewProxyModified(viewProxy, updateMounted);\n\n  return mounted;\n}\n\nexport function useViewProxyMounted<T extends vtkViewProxy = vtkViewProxy>(\n  viewProxy: MaybeRef<T>,\n  callback: () => void\n) {\n  const mounted = useMountedViewProxy(viewProxy);\n\n  watch(\n    mounted,\n    (m) => {\n      if (m) callback();\n    },\n    { immediate: true }\n  );\n}\n\nexport function useViewProxyUnmounted<T extends vtkViewProxy = vtkViewProxy>(\n  viewProxy: MaybeRef<T>,\n  callback: () => void\n) {\n  const mounted = useMountedViewProxy(viewProxy);\n\n  watch(\n    mounted,\n    (m, prev) => {\n      if (prev && !m) callback();\n    },\n    { immediate: true }\n  );\n}\n","import vtkViewProxy from '@kitware/vtk.js/Proxy/Core/ViewProxy';\nimport vtkWidgetManager from '@kitware/vtk.js/Widgets/Core/WidgetManager';\nimport { CaptureOn } from '@kitware/vtk.js/Widgets/Core/WidgetManager/Constants';\nimport { computed, onUnmounted, Ref, watch } from 'vue';\nimport { useViewProxyMounted, useViewProxyUnmounted } from './useViewProxy';\n\nexport function useWidgetManager(viewProxy: Ref<vtkViewProxy>) {\n  const widgetManager = computed(() => {\n    const wm = vtkWidgetManager.newInstance({\n      pickingEnabled: false,\n      useSvgLayer: false,\n      captureOn: CaptureOn.MOUSE_MOVE,\n    });\n    return wm;\n  });\n\n  useViewProxyMounted(viewProxy, () => {\n    widgetManager.value.setRenderer(viewProxy.value.getRenderer());\n    widgetManager.value.enablePicking();\n  });\n\n  useViewProxyUnmounted(viewProxy, () => {\n    widgetManager.value.disablePicking();\n  });\n\n  watch(widgetManager, (curWM, oldWM) => {\n    if (curWM) {\n      curWM.setRenderer(viewProxy.value.getRenderer());\n      curWM.enablePicking();\n    }\n    if (oldWM) {\n      oldWM.delete();\n    }\n  });\n\n  onUnmounted(() => {\n    widgetManager.value.delete();\n  });\n\n  return { widgetManager };\n}\n","import type { Vector3 } from '@kitware/vtk.js/types';\nimport { computed, unref } from 'vue';\nimport { MaybeRef } from '@vueuse/core';\nimport { getLPSAxisFromDir } from '../utils/lps';\nimport { useCurrentImage } from './useCurrentImage';\nimport useViewSliceStore from '../store/view-configs/slicing';\n\n/**\n * Returns information about the current slice.\n *\n * axisName: the name of the axis\n * axisIndex: corresponding index in an LPS coordinate array\n * number: slice value\n * planeNormal: slice plane normal\n * planeOrigin: slice plane origin\n * @param viewID\n */\nexport function useCurrentSlice(viewID: MaybeRef<string | null>) {\n  const viewSliceStore = useViewSliceStore();\n  const { currentImageMetadata, currentImageID } = useCurrentImage();\n  return computed(() => {\n    const config = viewSliceStore.getConfig(\n      unref(viewID),\n      currentImageID.value\n    );\n    if (!config) {\n      return null;\n    }\n\n    const { lpsOrientation } = currentImageMetadata.value;\n    const axis = getLPSAxisFromDir(config.axisDirection);\n    const planeOrigin = [0, 0, 0] as Vector3;\n    planeOrigin[lpsOrientation[axis]] = config.slice;\n    return {\n      axisName: axis,\n      axisIndex: lpsOrientation[axis],\n      number: config.slice,\n      planeNormal: lpsOrientation[config.axisDirection] as Vector3,\n      planeOrigin,\n    };\n  });\n}\n","import vtkOpenGLRenderWindow from '@kitware/vtk.js/Rendering/OpenGL/RenderWindow';\nimport vtkRenderer from '@kitware/vtk.js/Rendering/Core/Renderer';\nimport type { Vector2, Vector3 } from '@kitware/vtk.js/types';\nimport { computed, ref, unref, watchEffect } from 'vue';\nimport { MaybeRef, useResizeObserver } from '@vueuse/core';\nimport { vec3 } from 'gl-matrix';\nimport { useVTKCallback } from './useVTKCallback';\nimport { computeWorldToDisplay } from '../utils/vtk-helpers';\n\ntype MaybeCoords = Vector3 | vec3 | null | undefined;\ntype MaybeMultiCoords = Vector3[] | vec3[] | null | undefined;\ntype MaybeRenderer = vtkRenderer | null | undefined;\n\n/**\n * Returns a reactive vtkOpenGLRenderWindow container ref.\n *\n * @param view\n * @returns\n */\nexport function useVTKViewContainer(\n  view: MaybeRef<vtkOpenGLRenderWindow | null | undefined>\n) {\n  const container = ref<HTMLElement | null>(null);\n\n  const update = () => {\n    container.value = unref(view)?.getContainer() ?? null;\n  };\n\n  const onModified = useVTKCallback(computed(() => unref(view)?.onModified));\n  onModified(update);\n  update();\n\n  return container;\n}\n\n/**\n * Transforms a list of world coordinates into display coordinates.\n *\n * @param worldCoords\n * @param renderer\n * @returns\n */\nexport function useVTKMultiWorldToDisplay(\n  worldCoords: MaybeRef<MaybeMultiCoords>,\n  renderer: MaybeRef<MaybeRenderer>\n) {\n  const displayCoords = ref<Vector2[]>([]);\n  const view = computed(\n    () =>\n      unref(renderer)\n        ?.getRenderWindow()\n        ?.getViews()?.[0] as vtkOpenGLRenderWindow\n  );\n  const container = useVTKViewContainer(view);\n\n  const update = () => {\n    const coords = unref(worldCoords);\n    const ren = unref(renderer);\n\n    if (coords == null || !ren) {\n      return;\n    }\n\n    displayCoords.value = coords.map((xyz) => {\n      const disp = computeWorldToDisplay(xyz as Vector3, ren)!;\n      // convert from canvas space to display space\n      return [\n        disp[0] / devicePixelRatio,\n        disp[1] / devicePixelRatio,\n      ] as Vector2;\n    }) as Vector2[];\n  };\n\n  const cameraOnModified = useVTKCallback(\n    computed(() => unref(renderer)?.getActiveCamera().onModified)\n  );\n\n  useResizeObserver(container, update);\n  watchEffect(update);\n  cameraOnModified(update);\n  update();\n\n  return displayCoords;\n}\n\n/**\n * Transforms a single world coordinate into a display coordinate.\n *\n * @param worldCoords\n * @param renderer\n * @returns\n */\nexport function useVTKWorldToDisplay(\n  worldCoords: MaybeRef<MaybeCoords>,\n  renderer: MaybeRef<MaybeRenderer>\n) {\n  const manyCoords = computed(() => {\n    const c = unref(worldCoords);\n    if (c != null) {\n      return [c];\n    }\n    return null;\n  });\n\n  const displayCoords = useVTKMultiWorldToDisplay(manyCoords, renderer);\n  return computed(() => {\n    if (displayCoords.value.length === 1) {\n      return displayCoords.value[0];\n    }\n    return null;\n  });\n}\n\n/**\n * Transforms a list of world coordinates into SVG coordinates.\n *\n * @param worldCoords\n * @param renderer\n * @returns\n */\nexport function useVTKMultiWorldToSVG(\n  worldCoords: MaybeRef<MaybeMultiCoords>,\n  renderer: MaybeRef<MaybeRenderer>\n) {\n  const displayCoords = useVTKMultiWorldToDisplay(worldCoords, renderer);\n  const svgCoords = computed(() => {\n    const disp = displayCoords.value;\n    const ren = unref(renderer);\n    const view = ren?.getRenderWindow()?.getViews()?.[0];\n    if (ren && view) {\n      const [, height] = view.getViewportSize(ren);\n      return disp.map((xy) => {\n        // flip Y axis\n        return [xy[0], height / devicePixelRatio - xy[1]];\n      });\n    }\n    return null;\n  });\n\n  return svgCoords;\n}\n","<script lang=\"ts\">\nimport { defineComponent, PropType, ref } from 'vue';\nimport { CropLine } from './types';\n\nexport default defineComponent({\n  props: {\n    line: {\n      required: true,\n      type: Object as PropType<CropLine<number[]>>,\n    },\n    clickWidth: {\n      default: 20,\n      type: Number,\n    },\n    outOfBounds: {\n      default: false,\n      type: Boolean,\n    },\n  },\n  setup() {\n    const cursor = ref('grab');\n    const grabLineEl = ref<Element | null>(null);\n    const focusWidth = ref(0);\n\n    const onPointer = (down: boolean, ev: PointerEvent) => {\n      if (down) {\n        grabLineEl.value?.setPointerCapture(ev.pointerId);\n      } else {\n        grabLineEl.value?.releasePointerCapture(ev.pointerId);\n      }\n      cursor.value = down ? 'grabbing' : 'grab';\n    };\n\n    const onHover = (hover: boolean) => {\n      focusWidth.value = hover ? 2 : 0;\n    };\n\n    return {\n      onPointer,\n      onHover,\n      cursor,\n      grabLineEl,\n      focusWidth,\n    };\n  },\n});\n</script>\n\n<template>\n  <g>\n    <line\n      :x1=\"line.startEdge[0]\"\n      :y1=\"line.startEdge[1]\"\n      :x2=\"line.startCrop[0]\"\n      :y2=\"line.startCrop[1]\"\n      :stroke-width=\"2 + focusWidth\"\n      stroke-dasharray=\"6\"\n      stroke-linecap=\"square\"\n      stroke=\"rgba(200, 255, 0, 0.5)\"\n    />\n    <line\n      :x1=\"line.startCrop[0]\"\n      :y1=\"line.startCrop[1]\"\n      :x2=\"line.endCrop[0]\"\n      :y2=\"line.endCrop[1]\"\n      :stroke-width=\"2 + focusWidth\"\n      :stroke-dasharray=\"outOfBounds ? 6 : 'none'\"\n      stroke-linecap=\"butt\"\n      stroke=\"rgb(200, 255, 0)\"\n    />\n    <line\n      :x1=\"line.endCrop[0]\"\n      :y1=\"line.endCrop[1]\"\n      :x2=\"line.endEdge[0]\"\n      :y2=\"line.endEdge[1]\"\n      :stroke-width=\"2 + focusWidth\"\n      stroke-dasharray=\"6\"\n      stroke-linecap=\"square\"\n      stroke=\"rgba(200, 255, 0, 0.5)\"\n    />\n    <!-- the listener hitbox -->\n    <line\n      ref=\"grabLineEl\"\n      class=\"pointer-events-all\"\n      :style=\"{ cursor }\"\n      @pointerenter=\"onHover(true)\"\n      @pointerleave=\"onHover(false)\"\n      @pointerdown=\"onPointer(true, $event)\"\n      @pointerup=\"onPointer(false, $event)\"\n      :x1=\"line.startEdge[0]\"\n      :y1=\"line.startEdge[1]\"\n      :x2=\"line.endEdge[0]\"\n      :y2=\"line.endEdge[1]\"\n      fill=\"none\"\n      stroke-opacity=\"0\"\n      stroke-dasharray=\"none\"\n      :stroke-width=\"Number($attrs['stroke-width'] || 0) + clickWidth || 0\"\n      v-bind=\"$attrs\"\n    />\n  </g>\n</template>\n\n<style scoped src=\"@/src/components/styles/utils.css\"></style>\n","<script lang=\"ts\">\nimport { defineComponent, PropType, ref } from 'vue';\nimport { CropLine } from './types';\n\nexport default defineComponent({\n  props: {\n    line: {\n      required: true,\n      type: Object as PropType<CropLine<number[]>>,\n    },\n    clickWidth: {\n      default: 20,\n      type: Number,\n    },\n    outOfBounds: {\n      default: false,\n      type: Boolean,\n    },\n  },\n  setup() {\n    const cursor = ref('grab');\n    const grabLineEl = ref<Element | null>(null);\n    const focusWidth = ref(0);\n\n    const onPointer = (down: boolean, ev: PointerEvent) => {\n      if (down) {\n        grabLineEl.value?.setPointerCapture(ev.pointerId);\n      } else {\n        grabLineEl.value?.releasePointerCapture(ev.pointerId);\n      }\n      cursor.value = down ? 'grabbing' : 'grab';\n    };\n\n    const onHover = (hover: boolean) => {\n      focusWidth.value = hover ? 2 : 0;\n    };\n\n    return {\n      onPointer,\n      onHover,\n      cursor,\n      grabLineEl,\n      focusWidth,\n    };\n  },\n});\n</script>\n\n<template>\n  <g>\n    <line\n      :x1=\"line.startEdge[0]\"\n      :y1=\"line.startEdge[1]\"\n      :x2=\"line.startCrop[0]\"\n      :y2=\"line.startCrop[1]\"\n      :stroke-width=\"2 + focusWidth\"\n      stroke-dasharray=\"6\"\n      stroke-linecap=\"square\"\n      stroke=\"rgba(200, 255, 0, 0.5)\"\n    />\n    <line\n      :x1=\"line.startCrop[0]\"\n      :y1=\"line.startCrop[1]\"\n      :x2=\"line.endCrop[0]\"\n      :y2=\"line.endCrop[1]\"\n      :stroke-width=\"2 + focusWidth\"\n      :stroke-dasharray=\"outOfBounds ? 6 : 'none'\"\n      stroke-linecap=\"butt\"\n      stroke=\"rgb(200, 255, 0)\"\n    />\n    <line\n      :x1=\"line.endCrop[0]\"\n      :y1=\"line.endCrop[1]\"\n      :x2=\"line.endEdge[0]\"\n      :y2=\"line.endEdge[1]\"\n      :stroke-width=\"2 + focusWidth\"\n      stroke-dasharray=\"6\"\n      stroke-linecap=\"square\"\n      stroke=\"rgba(200, 255, 0, 0.5)\"\n    />\n    <!-- the listener hitbox -->\n    <line\n      ref=\"grabLineEl\"\n      class=\"pointer-events-all\"\n      :style=\"{ cursor }\"\n      @pointerenter=\"onHover(true)\"\n      @pointerleave=\"onHover(false)\"\n      @pointerdown=\"onPointer(true, $event)\"\n      @pointerup=\"onPointer(false, $event)\"\n      :x1=\"line.startEdge[0]\"\n      :y1=\"line.startEdge[1]\"\n      :x2=\"line.endEdge[0]\"\n      :y2=\"line.endEdge[1]\"\n      fill=\"none\"\n      stroke-opacity=\"0\"\n      stroke-dasharray=\"none\"\n      :stroke-width=\"Number($attrs['stroke-width'] || 0) + clickWidth || 0\"\n      v-bind=\"$attrs\"\n    />\n  </g>\n</template>\n\n<style scoped src=\"@/src/components/styles/utils.css\"></style>\n","<script lang=\"ts\">\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { useCurrentSlice } from '@/src/composables/useCurrentSlice';\nimport { useVTKMultiWorldToSVG } from '@/src/composables/useVTKWorldToDisplay';\nimport { ImageMetadata } from '@/src/types/image';\nimport { useCropStore } from '@/src/store/tools/crop';\nimport { useViewStore } from '@/src/store/views';\nimport { LPSAxis, LPSBounds, LPSPoint } from '@/src/types/lps';\nimport { createLPSBounds, createLPSPoint, LPSAxes } from '@/src/utils/lps';\nimport { intersectMouseEventWithPlane } from '@/src/utils/vtk-helpers';\nimport vtkLPSView2DProxy from '@/src/vtk/LPSView2DProxy';\nimport vtkRenderer from '@kitware/vtk.js/Rendering/Core/Renderer';\nimport type { Vector2, Vector3 } from '@kitware/vtk.js/types';\nimport {\n  computed,\n  ComputedRef,\n  DeepReadonly,\n  defineComponent,\n  ref,\n  Ref,\n  toRefs,\n} from 'vue';\nimport { vec3 } from 'gl-matrix';\nimport Crop2DLineHandle from './Crop2DLineHandle.vue';\nimport { CropLines } from './types';\n\nfunction computeCropLines(\n  viewID: Ref<string | null>,\n  cropAxis: Ref<LPSAxis | null>,\n  cropPlanes: DeepReadonly<Ref<Record<LPSAxis, number[]>>>,\n  boundary: Ref<Record<LPSAxis, number[]>>\n): ComputedRef<CropLines<LPSPoint> | null> {\n  const currentSlice = useCurrentSlice(viewID);\n\n  return computed(() => {\n    // pre-check reactivity\n    const viewIDVal = viewID.value;\n    const cropAxisVal = cropAxis.value;\n    const cropPlanesVal = cropPlanes.value;\n    const boundaryVal = boundary.value;\n    const sliceInfo = currentSlice.value;\n\n    if (!viewIDVal || !cropAxisVal || !sliceInfo) {\n      return null;\n    }\n\n    const sliceAxis = sliceInfo.axisName;\n    const [perpAxis] = LPSAxes.filter(\n      (ax) => ax !== cropAxisVal && ax !== sliceAxis\n    );\n    const cropRange = cropPlanesVal[cropAxisVal];\n    const perpRange = cropPlanesVal[perpAxis];\n    const perpBoundary = boundaryVal[perpAxis];\n\n    const sliceCropRange = cropPlanesVal[sliceAxis];\n    const slice = sliceInfo.number;\n    const outOfBounds = slice < sliceCropRange[0] || sliceCropRange[1] < slice;\n\n    const getLineSegments = (index: number) => {\n      const startEdge = createLPSPoint();\n      const startCrop = createLPSPoint();\n      const endCrop = createLPSPoint();\n      const endEdge = createLPSPoint();\n\n      startEdge[cropAxisVal] = cropRange[index];\n      startCrop[cropAxisVal] = cropRange[index];\n      endCrop[cropAxisVal] = cropRange[index];\n      endEdge[cropAxisVal] = cropRange[index];\n\n      [startEdge[perpAxis], endEdge[perpAxis]] = perpBoundary;\n      [startCrop[perpAxis], endCrop[perpAxis]] = perpRange;\n\n      return { startEdge, startCrop, endCrop, endEdge };\n    };\n\n    return {\n      lowerLine: getLineSegments(0),\n      upperLine: getLineSegments(1),\n      outOfBounds,\n    };\n  });\n}\n\nfunction cropLinesToSVGDisplay(\n  cropLines: Ref<CropLines<LPSPoint> | null>,\n  imageMetadata: Ref<ImageMetadata>,\n  renderer: Ref<vtkRenderer>\n): ComputedRef<CropLines<number[]> | null> {\n  // gather points\n  const worldPoints = computed(() => {\n    const lines = cropLines.value;\n    const { lpsOrientation, indexToWorld } = imageMetadata.value;\n    if (!lines) {\n      return null;\n    }\n    return [\n      lines.lowerLine.startEdge,\n      lines.lowerLine.startCrop,\n      lines.lowerLine.endCrop,\n      lines.lowerLine.endEdge,\n      lines.upperLine.startEdge,\n      lines.upperLine.startCrop,\n      lines.upperLine.endCrop,\n      lines.upperLine.endEdge,\n    ].map((indexLPSPoint) => {\n      const indexPt = [0, 0, 0] as vec3;\n      indexPt[lpsOrientation.Sagittal] = indexLPSPoint.Sagittal;\n      indexPt[lpsOrientation.Coronal] = indexLPSPoint.Coronal;\n      indexPt[lpsOrientation.Axial] = indexLPSPoint.Axial;\n\n      const out = [0, 0, 0] as vec3;\n      vec3.transformMat4(out, indexPt, indexToWorld);\n      return out as Vector3;\n    });\n  });\n\n  // transform points to svg\n  const svgPoints = useVTKMultiWorldToSVG(worldPoints, renderer);\n\n  // create a new CropLines with SVG points\n  return computed(() => {\n    const lines = cropLines.value;\n    const points = svgPoints.value;\n    if (!lines || !points?.length) {\n      return null;\n    }\n\n    return {\n      lowerLine: {\n        startEdge: points[0],\n        startCrop: points[1],\n        endCrop: points[2],\n        endEdge: points[3],\n      },\n      upperLine: {\n        startEdge: points[4],\n        startCrop: points[5],\n        endCrop: points[6],\n        endEdge: points[7],\n      },\n      outOfBounds: lines.outOfBounds,\n    };\n  });\n}\n\nfunction useDragging({\n  mouseEventToLPSPoint,\n  getCropEdgePos,\n  setCropEdgePos,\n}: {\n  mouseEventToLPSPoint: (ev: PointerEvent) => LPSPoint | null;\n  getCropEdgePos: (axis: LPSAxis, lowerUpper: 0 | 1) => number;\n  setCropEdgePos: (axis: LPSAxis, lowerUpper: 0 | 1, pos: number) => void;\n}) {\n  const activeAxis = ref<LPSAxis | null>();\n  const activeEdge = ref<0 | 1 | null>();\n  const initialPointerIndex = ref<LPSPoint>(createLPSPoint());\n  const initialCrop = ref<number>(0);\n\n  const onPointerDown = (\n    ax: LPSAxis,\n    selectedCropEdge: 0 | 1,\n    ev: PointerEvent\n  ) => {\n    // ev -> world -> index -> LPSPoint -> save as starting index\n    // save the starting axis edge value\n    const initialPoint = mouseEventToLPSPoint(ev);\n    if (!initialPoint) return;\n\n    initialPointerIndex.value = initialPoint;\n    initialCrop.value = getCropEdgePos(ax, selectedCropEdge);\n    activeAxis.value = ax;\n    activeEdge.value = selectedCropEdge;\n  };\n\n  const onPointerMove = (ev: PointerEvent) => {\n    if (activeAxis.value == null || activeEdge.value == null) {\n      return;\n    }\n    const axis = activeAxis.value;\n\n    const point = mouseEventToLPSPoint(ev);\n    if (!point) return;\n\n    // calc delta along ax from starting pos via startingIndex\n    // apply delta to starting axis edge value\n    const delta = point[axis] - initialPointerIndex.value[axis];\n    setCropEdgePos(axis, activeEdge.value, initialCrop.value + delta);\n  };\n\n  const onPointerUp = () => {\n    activeAxis.value = null;\n    activeEdge.value = null;\n  };\n\n  return {\n    onPointerDown,\n    onPointerMove,\n    onPointerUp,\n  };\n}\n\nexport default defineComponent({\n  props: {\n    viewId: {\n      required: true,\n      type: String,\n    },\n  },\n  components: {\n    Crop2DLineHandle,\n  },\n  setup(props) {\n    const { viewId: viewID } = toRefs(props);\n\n    const viewStore = useViewStore();\n    const viewProxy = computed(\n      () => viewStore.getViewProxy<vtkLPSView2DProxy>(viewID.value)!\n    );\n    const renderer = computed(() => viewProxy.value?.getRenderer());\n\n    const {\n      currentImageExtent: imageExtent,\n      currentImageID,\n      currentImageMetadata,\n    } = useCurrentImage();\n    const currentSlice = useCurrentSlice(viewID);\n    const currentSlicingAxis = computed(\n      () => currentSlice.value?.axisName ?? null\n    );\n\n    const cropStore = useCropStore();\n    const cropPlanes = computed((): DeepReadonly<LPSBounds> => {\n      const imageID = currentImageID.value;\n      if (imageID && imageID in cropStore.croppingByImageID) {\n        return cropStore.croppingByImageID[imageID];\n      }\n      return createLPSBounds();\n    });\n\n    const inPlaneAxes = computed(() =>\n      LPSAxes.filter(\n        (ax) => currentSlicingAxis.value && ax !== currentSlicingAxis.value\n      )\n    );\n    const ax1 = computed(() => inPlaneAxes.value[0] ?? null);\n    const ax2 = computed(() => inPlaneAxes.value[1] ?? null);\n\n    // crop lines in image space\n    const ax1Lines = computeCropLines(viewID, ax1, cropPlanes, imageExtent);\n    const ax2Lines = computeCropLines(viewID, ax2, cropPlanes, imageExtent);\n\n    // crop lines in display space\n    const ax1SVGLines = cropLinesToSVGDisplay(\n      ax1Lines,\n      currentImageMetadata,\n      renderer\n    );\n    const ax2SVGLines = cropLinesToSVGDisplay(\n      ax2Lines,\n      currentImageMetadata,\n      renderer\n    );\n\n    const { onPointerDown, onPointerMove, onPointerUp } = useDragging({\n      mouseEventToLPSPoint(ev: PointerEvent) {\n        const ren = renderer.value;\n        if (!ren) return null;\n\n        const sliceInfo = currentSlice.value;\n        if (!sliceInfo) return null;\n\n        const { lpsOrientation, worldToIndex } = currentImageMetadata.value;\n        const coord = intersectMouseEventWithPlane(\n          ev,\n          ren,\n          sliceInfo.planeOrigin,\n          sliceInfo.planeNormal\n        );\n        if (!coord) return null;\n\n        // convert from world to index\n        vec3.transformMat4(coord, coord, worldToIndex);\n\n        const point = createLPSPoint();\n        point.Sagittal = coord[lpsOrientation.Sagittal];\n        point.Coronal = coord[lpsOrientation.Coronal];\n        point.Axial = coord[lpsOrientation.Axial];\n\n        return point;\n      },\n      getCropEdgePos(axis: LPSAxis, lowerUpper: 0 | 1) {\n        return cropPlanes.value[axis][lowerUpper];\n      },\n      setCropEdgePos(axis: LPSAxis, lowerUpper: 0 | 1, pos: number) {\n        if (!currentImageID.value) return;\n\n        // enforce cropping edge bounds\n        const planes = cropPlanes.value;\n        const [lower, upper] = planes[axis];\n        const [min, max] = imageExtent.value[axis];\n        const newPlanes: Vector2 = [lower, upper];\n        if (lowerUpper === 0) {\n          newPlanes[0] = Math.max(min, Math.min(pos, upper));\n        } else if (lowerUpper === 1) {\n          newPlanes[1] = Math.max(lower, Math.min(pos, max));\n        }\n\n        cropStore.setCroppingForAxis(currentImageID.value, axis, newPlanes);\n      },\n    });\n\n    return {\n      ax1: computed(() => ({\n        name: ax1.value,\n        lines: ax1SVGLines.value,\n      })),\n      ax2: computed(() => ({\n        name: ax2.value,\n        lines: ax2SVGLines.value,\n      })),\n      onPointerDown,\n      onPointerMove,\n      onPointerUp,\n    };\n  },\n});\n</script>\n\n<template>\n  <g>\n    <template v-if=\"ax1.lines != null\">\n      <crop-2D-line-handle\n        :line=\"ax1.lines.lowerLine\"\n        :out-of-bounds=\"ax1.lines.outOfBounds\"\n        @pointerdown=\"onPointerDown(ax1.name, 0, $event)\"\n        @pointermove=\"onPointerMove\"\n        @pointerup=\"onPointerUp\"\n      />\n      <crop-2D-line-handle\n        :line=\"ax1.lines.upperLine\"\n        :out-of-bounds=\"ax1.lines.outOfBounds\"\n        @pointerdown=\"onPointerDown(ax1.name, 1, $event)\"\n        @pointermove=\"onPointerMove\"\n        @pointerup=\"onPointerUp\"\n      />\n    </template>\n    <template v-if=\"ax2.lines != null\">\n      <crop-2D-line-handle\n        :line=\"ax2.lines.lowerLine\"\n        :out-of-bounds=\"ax2.lines.outOfBounds\"\n        @pointerdown=\"onPointerDown(ax2.name, 0, $event)\"\n        @pointermove=\"onPointerMove\"\n        @pointerup=\"onPointerUp\"\n      />\n      <crop-2D-line-handle\n        :line=\"ax2.lines.upperLine\"\n        :out-of-bounds=\"ax2.lines.outOfBounds\"\n        @pointerdown=\"onPointerDown(ax2.name, 1, $event)\"\n        @pointermove=\"onPointerMove\"\n        @pointerup=\"onPointerUp\"\n      />\n    </template>\n  </g>\n</template>\n\n<style scoped src=\"@/src/components/styles/vtk-view.css\"></style>\n","<script lang=\"ts\">\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { useCurrentSlice } from '@/src/composables/useCurrentSlice';\nimport { useVTKMultiWorldToSVG } from '@/src/composables/useVTKWorldToDisplay';\nimport { ImageMetadata } from '@/src/types/image';\nimport { useCropStore } from '@/src/store/tools/crop';\nimport { useViewStore } from '@/src/store/views';\nimport { LPSAxis, LPSBounds, LPSPoint } from '@/src/types/lps';\nimport { createLPSBounds, createLPSPoint, LPSAxes } from '@/src/utils/lps';\nimport { intersectMouseEventWithPlane } from '@/src/utils/vtk-helpers';\nimport vtkLPSView2DProxy from '@/src/vtk/LPSView2DProxy';\nimport vtkRenderer from '@kitware/vtk.js/Rendering/Core/Renderer';\nimport type { Vector2, Vector3 } from '@kitware/vtk.js/types';\nimport {\n  computed,\n  ComputedRef,\n  DeepReadonly,\n  defineComponent,\n  ref,\n  Ref,\n  toRefs,\n} from 'vue';\nimport { vec3 } from 'gl-matrix';\nimport Crop2DLineHandle from './Crop2DLineHandle.vue';\nimport { CropLines } from './types';\n\nfunction computeCropLines(\n  viewID: Ref<string | null>,\n  cropAxis: Ref<LPSAxis | null>,\n  cropPlanes: DeepReadonly<Ref<Record<LPSAxis, number[]>>>,\n  boundary: Ref<Record<LPSAxis, number[]>>\n): ComputedRef<CropLines<LPSPoint> | null> {\n  const currentSlice = useCurrentSlice(viewID);\n\n  return computed(() => {\n    // pre-check reactivity\n    const viewIDVal = viewID.value;\n    const cropAxisVal = cropAxis.value;\n    const cropPlanesVal = cropPlanes.value;\n    const boundaryVal = boundary.value;\n    const sliceInfo = currentSlice.value;\n\n    if (!viewIDVal || !cropAxisVal || !sliceInfo) {\n      return null;\n    }\n\n    const sliceAxis = sliceInfo.axisName;\n    const [perpAxis] = LPSAxes.filter(\n      (ax) => ax !== cropAxisVal && ax !== sliceAxis\n    );\n    const cropRange = cropPlanesVal[cropAxisVal];\n    const perpRange = cropPlanesVal[perpAxis];\n    const perpBoundary = boundaryVal[perpAxis];\n\n    const sliceCropRange = cropPlanesVal[sliceAxis];\n    const slice = sliceInfo.number;\n    const outOfBounds = slice < sliceCropRange[0] || sliceCropRange[1] < slice;\n\n    const getLineSegments = (index: number) => {\n      const startEdge = createLPSPoint();\n      const startCrop = createLPSPoint();\n      const endCrop = createLPSPoint();\n      const endEdge = createLPSPoint();\n\n      startEdge[cropAxisVal] = cropRange[index];\n      startCrop[cropAxisVal] = cropRange[index];\n      endCrop[cropAxisVal] = cropRange[index];\n      endEdge[cropAxisVal] = cropRange[index];\n\n      [startEdge[perpAxis], endEdge[perpAxis]] = perpBoundary;\n      [startCrop[perpAxis], endCrop[perpAxis]] = perpRange;\n\n      return { startEdge, startCrop, endCrop, endEdge };\n    };\n\n    return {\n      lowerLine: getLineSegments(0),\n      upperLine: getLineSegments(1),\n      outOfBounds,\n    };\n  });\n}\n\nfunction cropLinesToSVGDisplay(\n  cropLines: Ref<CropLines<LPSPoint> | null>,\n  imageMetadata: Ref<ImageMetadata>,\n  renderer: Ref<vtkRenderer>\n): ComputedRef<CropLines<number[]> | null> {\n  // gather points\n  const worldPoints = computed(() => {\n    const lines = cropLines.value;\n    const { lpsOrientation, indexToWorld } = imageMetadata.value;\n    if (!lines) {\n      return null;\n    }\n    return [\n      lines.lowerLine.startEdge,\n      lines.lowerLine.startCrop,\n      lines.lowerLine.endCrop,\n      lines.lowerLine.endEdge,\n      lines.upperLine.startEdge,\n      lines.upperLine.startCrop,\n      lines.upperLine.endCrop,\n      lines.upperLine.endEdge,\n    ].map((indexLPSPoint) => {\n      const indexPt = [0, 0, 0] as vec3;\n      indexPt[lpsOrientation.Sagittal] = indexLPSPoint.Sagittal;\n      indexPt[lpsOrientation.Coronal] = indexLPSPoint.Coronal;\n      indexPt[lpsOrientation.Axial] = indexLPSPoint.Axial;\n\n      const out = [0, 0, 0] as vec3;\n      vec3.transformMat4(out, indexPt, indexToWorld);\n      return out as Vector3;\n    });\n  });\n\n  // transform points to svg\n  const svgPoints = useVTKMultiWorldToSVG(worldPoints, renderer);\n\n  // create a new CropLines with SVG points\n  return computed(() => {\n    const lines = cropLines.value;\n    const points = svgPoints.value;\n    if (!lines || !points?.length) {\n      return null;\n    }\n\n    return {\n      lowerLine: {\n        startEdge: points[0],\n        startCrop: points[1],\n        endCrop: points[2],\n        endEdge: points[3],\n      },\n      upperLine: {\n        startEdge: points[4],\n        startCrop: points[5],\n        endCrop: points[6],\n        endEdge: points[7],\n      },\n      outOfBounds: lines.outOfBounds,\n    };\n  });\n}\n\nfunction useDragging({\n  mouseEventToLPSPoint,\n  getCropEdgePos,\n  setCropEdgePos,\n}: {\n  mouseEventToLPSPoint: (ev: PointerEvent) => LPSPoint | null;\n  getCropEdgePos: (axis: LPSAxis, lowerUpper: 0 | 1) => number;\n  setCropEdgePos: (axis: LPSAxis, lowerUpper: 0 | 1, pos: number) => void;\n}) {\n  const activeAxis = ref<LPSAxis | null>();\n  const activeEdge = ref<0 | 1 | null>();\n  const initialPointerIndex = ref<LPSPoint>(createLPSPoint());\n  const initialCrop = ref<number>(0);\n\n  const onPointerDown = (\n    ax: LPSAxis,\n    selectedCropEdge: 0 | 1,\n    ev: PointerEvent\n  ) => {\n    // ev -> world -> index -> LPSPoint -> save as starting index\n    // save the starting axis edge value\n    const initialPoint = mouseEventToLPSPoint(ev);\n    if (!initialPoint) return;\n\n    initialPointerIndex.value = initialPoint;\n    initialCrop.value = getCropEdgePos(ax, selectedCropEdge);\n    activeAxis.value = ax;\n    activeEdge.value = selectedCropEdge;\n  };\n\n  const onPointerMove = (ev: PointerEvent) => {\n    if (activeAxis.value == null || activeEdge.value == null) {\n      return;\n    }\n    const axis = activeAxis.value;\n\n    const point = mouseEventToLPSPoint(ev);\n    if (!point) return;\n\n    // calc delta along ax from starting pos via startingIndex\n    // apply delta to starting axis edge value\n    const delta = point[axis] - initialPointerIndex.value[axis];\n    setCropEdgePos(axis, activeEdge.value, initialCrop.value + delta);\n  };\n\n  const onPointerUp = () => {\n    activeAxis.value = null;\n    activeEdge.value = null;\n  };\n\n  return {\n    onPointerDown,\n    onPointerMove,\n    onPointerUp,\n  };\n}\n\nexport default defineComponent({\n  props: {\n    viewId: {\n      required: true,\n      type: String,\n    },\n  },\n  components: {\n    Crop2DLineHandle,\n  },\n  setup(props) {\n    const { viewId: viewID } = toRefs(props);\n\n    const viewStore = useViewStore();\n    const viewProxy = computed(\n      () => viewStore.getViewProxy<vtkLPSView2DProxy>(viewID.value)!\n    );\n    const renderer = computed(() => viewProxy.value?.getRenderer());\n\n    const {\n      currentImageExtent: imageExtent,\n      currentImageID,\n      currentImageMetadata,\n    } = useCurrentImage();\n    const currentSlice = useCurrentSlice(viewID);\n    const currentSlicingAxis = computed(\n      () => currentSlice.value?.axisName ?? null\n    );\n\n    const cropStore = useCropStore();\n    const cropPlanes = computed((): DeepReadonly<LPSBounds> => {\n      const imageID = currentImageID.value;\n      if (imageID && imageID in cropStore.croppingByImageID) {\n        return cropStore.croppingByImageID[imageID];\n      }\n      return createLPSBounds();\n    });\n\n    const inPlaneAxes = computed(() =>\n      LPSAxes.filter(\n        (ax) => currentSlicingAxis.value && ax !== currentSlicingAxis.value\n      )\n    );\n    const ax1 = computed(() => inPlaneAxes.value[0] ?? null);\n    const ax2 = computed(() => inPlaneAxes.value[1] ?? null);\n\n    // crop lines in image space\n    const ax1Lines = computeCropLines(viewID, ax1, cropPlanes, imageExtent);\n    const ax2Lines = computeCropLines(viewID, ax2, cropPlanes, imageExtent);\n\n    // crop lines in display space\n    const ax1SVGLines = cropLinesToSVGDisplay(\n      ax1Lines,\n      currentImageMetadata,\n      renderer\n    );\n    const ax2SVGLines = cropLinesToSVGDisplay(\n      ax2Lines,\n      currentImageMetadata,\n      renderer\n    );\n\n    const { onPointerDown, onPointerMove, onPointerUp } = useDragging({\n      mouseEventToLPSPoint(ev: PointerEvent) {\n        const ren = renderer.value;\n        if (!ren) return null;\n\n        const sliceInfo = currentSlice.value;\n        if (!sliceInfo) return null;\n\n        const { lpsOrientation, worldToIndex } = currentImageMetadata.value;\n        const coord = intersectMouseEventWithPlane(\n          ev,\n          ren,\n          sliceInfo.planeOrigin,\n          sliceInfo.planeNormal\n        );\n        if (!coord) return null;\n\n        // convert from world to index\n        vec3.transformMat4(coord, coord, worldToIndex);\n\n        const point = createLPSPoint();\n        point.Sagittal = coord[lpsOrientation.Sagittal];\n        point.Coronal = coord[lpsOrientation.Coronal];\n        point.Axial = coord[lpsOrientation.Axial];\n\n        return point;\n      },\n      getCropEdgePos(axis: LPSAxis, lowerUpper: 0 | 1) {\n        return cropPlanes.value[axis][lowerUpper];\n      },\n      setCropEdgePos(axis: LPSAxis, lowerUpper: 0 | 1, pos: number) {\n        if (!currentImageID.value) return;\n\n        // enforce cropping edge bounds\n        const planes = cropPlanes.value;\n        const [lower, upper] = planes[axis];\n        const [min, max] = imageExtent.value[axis];\n        const newPlanes: Vector2 = [lower, upper];\n        if (lowerUpper === 0) {\n          newPlanes[0] = Math.max(min, Math.min(pos, upper));\n        } else if (lowerUpper === 1) {\n          newPlanes[1] = Math.max(lower, Math.min(pos, max));\n        }\n\n        cropStore.setCroppingForAxis(currentImageID.value, axis, newPlanes);\n      },\n    });\n\n    return {\n      ax1: computed(() => ({\n        name: ax1.value,\n        lines: ax1SVGLines.value,\n      })),\n      ax2: computed(() => ({\n        name: ax2.value,\n        lines: ax2SVGLines.value,\n      })),\n      onPointerDown,\n      onPointerMove,\n      onPointerUp,\n    };\n  },\n});\n</script>\n\n<template>\n  <g>\n    <template v-if=\"ax1.lines != null\">\n      <crop-2D-line-handle\n        :line=\"ax1.lines.lowerLine\"\n        :out-of-bounds=\"ax1.lines.outOfBounds\"\n        @pointerdown=\"onPointerDown(ax1.name, 0, $event)\"\n        @pointermove=\"onPointerMove\"\n        @pointerup=\"onPointerUp\"\n      />\n      <crop-2D-line-handle\n        :line=\"ax1.lines.upperLine\"\n        :out-of-bounds=\"ax1.lines.outOfBounds\"\n        @pointerdown=\"onPointerDown(ax1.name, 1, $event)\"\n        @pointermove=\"onPointerMove\"\n        @pointerup=\"onPointerUp\"\n      />\n    </template>\n    <template v-if=\"ax2.lines != null\">\n      <crop-2D-line-handle\n        :line=\"ax2.lines.lowerLine\"\n        :out-of-bounds=\"ax2.lines.outOfBounds\"\n        @pointerdown=\"onPointerDown(ax2.name, 0, $event)\"\n        @pointermove=\"onPointerMove\"\n        @pointerup=\"onPointerUp\"\n      />\n      <crop-2D-line-handle\n        :line=\"ax2.lines.upperLine\"\n        :out-of-bounds=\"ax2.lines.outOfBounds\"\n        @pointerdown=\"onPointerDown(ax2.name, 1, $event)\"\n        @pointermove=\"onPointerMove\"\n        @pointerup=\"onPointerUp\"\n      />\n    </template>\n  </g>\n</template>\n\n<style scoped src=\"@/src/components/styles/vtk-view.css\"></style>\n","<script lang=\"ts\">\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { useVTKCallback } from '@/src/composables/useVTKCallback';\nimport { VTKThreeViewWidgetManager } from '@/src/constants';\nimport { useCropStore } from '@/src/store/tools/crop';\nimport { LPSCroppingPlanes } from '@/src/types/crop';\nimport { useViewStore } from '@/src/store/views';\nimport { arrayEquals } from '@/src/utils';\nimport { getAxisBounds, LPSAxes } from '@/src/utils/lps';\nimport vtkLPSView3DProxy from '@/src/vtk/LPSView3DProxy';\nimport type { Bounds } from '@kitware/vtk.js/types';\nimport vtkImageCroppingWidget, {\n  ImageCroppingWidgetState,\n  vtkImageCroppingViewWidget,\n} from '@kitware/vtk.js/Widgets/Widgets3D/ImageCroppingWidget';\nimport {\n  computed,\n  DeepReadonly,\n  defineComponent,\n  inject,\n  onBeforeUnmount,\n  ref,\n  toRefs,\n  watch,\n} from 'vue';\nimport { useViewProxyMounted } from '@/src/composables/useViewProxy';\n\nfunction isValidCroppingPlanes(planes: LPSCroppingPlanes) {\n  return (\n    planes.Sagittal[0] <= planes.Sagittal[1] &&\n    planes.Coronal[0] <= planes.Coronal[1] &&\n    planes.Axial[0] <= planes.Axial[1]\n  );\n}\n\nfunction lpsPlanesEqual(a: LPSCroppingPlanes, b: LPSCroppingPlanes) {\n  return (\n    a.Axial[0] === b.Axial[0] &&\n    a.Axial[1] === b.Axial[1] &&\n    a.Sagittal[0] === b.Sagittal[0] &&\n    a.Sagittal[1] === b.Sagittal[1] &&\n    a.Coronal[0] === b.Coronal[0] &&\n    a.Coronal[1] === b.Coronal[1]\n  );\n}\n\nexport default defineComponent({\n  props: {\n    viewId: {\n      type: String,\n      required: true,\n    },\n  },\n\n  setup(props) {\n    const { viewId: viewID } = toRefs(props);\n\n    const widgetManager = inject(VTKThreeViewWidgetManager);\n    if (!widgetManager) {\n      throw new Error('Crop3D component cannot access the 2D widget manager.');\n    }\n\n    const viewStore = useViewStore();\n    const viewProxy = computed(\n      () => viewStore.getViewProxy<vtkLPSView3DProxy>(viewID.value)!\n    );\n\n    const cropStore = useCropStore();\n    const { currentImageID, currentImageMetadata } = useCurrentImage();\n    const croppingPlanes = computed(() => {\n      const imageID = currentImageID.value;\n      if (imageID && imageID in cropStore.croppingByImageID) {\n        return cropStore.croppingByImageID[imageID];\n      }\n      return null;\n    });\n\n    const factory = vtkImageCroppingWidget.newInstance();\n    const state = factory.getWidgetState() as ImageCroppingWidgetState;\n\n    factory.setEdgeHandlesEnabled(false);\n    factory.setFaceHandlesEnabled(true);\n    factory.setCornerHandlesEnabled(true);\n\n    const widget = ref<vtkImageCroppingViewWidget>();\n\n    watch(widgetManager, (wm, oldWm) => {\n      if (oldWm) {\n        oldWm.removeWidget(factory);\n      }\n      if (wm) {\n        widget.value = wm.addWidget(factory) as vtkImageCroppingViewWidget;\n      }\n    });\n\n    useViewProxyMounted(viewProxy, () => {\n      if (widgetManager.value) {\n        widget.value = widgetManager.value.addWidget(\n          factory\n        ) as vtkImageCroppingViewWidget;\n\n        // update representation to not be as 3D\n        widget.value.getRepresentations().forEach((rep) => {\n          rep.getActors().forEach((actor) => {\n            actor.getProperty().setAmbient(1);\n          });\n        });\n\n        // show widget\n        viewProxy.value.renderLater();\n      }\n    });\n\n    onBeforeUnmount(() => {\n      if (widgetManager.value) {\n        widgetManager.value.removeWidget(factory);\n      }\n    });\n\n    watch(\n      currentImageMetadata,\n      (metadata) => {\n        state.setWorldToIndexT(metadata.worldToIndex);\n        state.setIndexToWorldT(metadata.indexToWorld);\n        state.placeWidget(metadata.worldBounds);\n      },\n      { immediate: true }\n    );\n\n    const applyPlanes = (lpsPlanes: DeepReadonly<LPSCroppingPlanes>) => {\n      const { lpsOrientation: dirs } = currentImageMetadata.value;\n      // LPSCroppingPlanes -> Bounds\n      const planes = [0, 0, 0, 0, 0, 0] as Bounds;\n      LPSAxes.forEach((axis) => {\n        [planes[dirs[axis] * 2], planes[dirs[axis] * 2 + 1]] = lpsPlanes[axis];\n      });\n\n      // prevent infinite loops\n      if (!arrayEquals(planes, state.getCroppingPlanes().getPlanes())) {\n        state.getCroppingPlanes().setPlanes(planes);\n        viewProxy.value.renderLater();\n      }\n    };\n\n    watch(\n      croppingPlanes,\n      (lpsPlanes) => {\n        if (lpsPlanes) {\n          applyPlanes(lpsPlanes);\n        }\n      },\n      { immediate: true }\n    );\n\n    const onPlanesUpdated = useVTKCallback(\n      state.getCroppingPlanes().onModified\n    );\n\n    onPlanesUpdated(() => {\n      const imageID = currentImageID.value;\n      if (!imageID) return;\n\n      // Bounds -> LPSCroppingPlanes\n      const planes = state.getCroppingPlanes().getPlanes();\n      const { lpsOrientation } = currentImageMetadata.value;\n      const lpsPlanes: LPSCroppingPlanes = {\n        Sagittal: getAxisBounds(planes, 'Sagittal', lpsOrientation),\n        Coronal: getAxisBounds(planes, 'Coronal', lpsOrientation),\n        Axial: getAxisBounds(planes, 'Axial', lpsOrientation),\n      };\n\n      // avoid updates if equal\n      const planesFromStore = croppingPlanes.value;\n      if (\n        planesFromStore &&\n        lpsPlanesEqual(lpsPlanes, planesFromStore as LPSCroppingPlanes)\n      ) {\n        return;\n      }\n\n      if (isValidCroppingPlanes(lpsPlanes)) {\n        cropStore.setCropping(imageID, lpsPlanes);\n      } else if (planesFromStore) {\n        applyPlanes(planesFromStore);\n      }\n    });\n\n    return () => null;\n  },\n});\n</script>\n","<script lang=\"ts\">\nimport { useViewStore } from '@/src/store/views';\nimport { computed, defineComponent, toRefs, watch } from 'vue';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { useCropStore } from '@/src/store/tools/crop';\nimport { useToolStore } from '@/src/store/tools';\nimport { Tools } from '@/src/store/tools/types';\nimport Crop2D from './crop/Crop2D.vue';\nimport Crop3D from './crop/Crop3D.vue';\n\nexport default defineComponent({\n  props: {\n    viewId: {\n      type: String,\n      required: true,\n    },\n  },\n  components: {\n    Crop2D,\n    Crop3D,\n  },\n  setup(props) {\n    const { viewId: viewID } = toRefs(props);\n\n    const { currentImageID } = useCurrentImage();\n    const cropStore = useCropStore();\n    const toolStore = useToolStore();\n\n    const active = computed(() => toolStore.currentTool === Tools.Crop);\n\n    watch(\n      currentImageID,\n      (imageID) => {\n        if (imageID && !(imageID in cropStore.croppingByImageID)) {\n          cropStore.resetCropping(imageID);\n        }\n      },\n      { immediate: true }\n    );\n\n    const viewType = computed(() => {\n      const viewStore = useViewStore();\n      return viewStore.viewSpecs[viewID.value].viewType;\n    });\n\n    return {\n      active,\n      viewType,\n    };\n  },\n});\n</script>\n\n<template>\n  <svg class=\"overlay-no-events\">\n    <crop-2D v-if=\"active && viewType === '2D'\" :view-id=\"viewId\" />\n    <crop-3D v-if=\"active && viewType === '3D'\" :view-id=\"viewId\" />\n  </svg>\n</template>\n\n<style scoped src=\"@/src/components/styles/vtk-view.css\"></style>\n","<script lang=\"ts\">\nimport { useViewStore } from '@/src/store/views';\nimport { computed, defineComponent, toRefs, watch } from 'vue';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { useCropStore } from '@/src/store/tools/crop';\nimport { useToolStore } from '@/src/store/tools';\nimport { Tools } from '@/src/store/tools/types';\nimport Crop2D from './crop/Crop2D.vue';\nimport Crop3D from './crop/Crop3D.vue';\n\nexport default defineComponent({\n  props: {\n    viewId: {\n      type: String,\n      required: true,\n    },\n  },\n  components: {\n    Crop2D,\n    Crop3D,\n  },\n  setup(props) {\n    const { viewId: viewID } = toRefs(props);\n\n    const { currentImageID } = useCurrentImage();\n    const cropStore = useCropStore();\n    const toolStore = useToolStore();\n\n    const active = computed(() => toolStore.currentTool === Tools.Crop);\n\n    watch(\n      currentImageID,\n      (imageID) => {\n        if (imageID && !(imageID in cropStore.croppingByImageID)) {\n          cropStore.resetCropping(imageID);\n        }\n      },\n      { immediate: true }\n    );\n\n    const viewType = computed(() => {\n      const viewStore = useViewStore();\n      return viewStore.viewSpecs[viewID.value].viewType;\n    });\n\n    return {\n      active,\n      viewType,\n    };\n  },\n});\n</script>\n\n<template>\n  <svg class=\"overlay-no-events\">\n    <crop-2D v-if=\"active && viewType === '2D'\" :view-id=\"viewId\" />\n    <crop-3D v-if=\"active && viewType === '3D'\" :view-id=\"viewId\" />\n  </svg>\n</template>\n\n<style scoped src=\"@/src/components/styles/vtk-view.css\"></style>\n","import { inject } from 'vue';\nimport vtkProxyManager from '@kitware/vtk.js/Proxy/Core/ProxyManager';\n\nconst defaultKey = 'ProxyManager';\n\nexport function withProxyManager(cb: (pxm: vtkProxyManager) => void) {\n  const pxm = inject<vtkProxyManager>('ProxyManager');\n  return pxm ? cb(pxm) : null;\n}\n\nexport function useProxyManager(key = defaultKey) {\n  return inject<vtkProxyManager>(key ?? defaultKey);\n}\n","<template>\n  <div\n    class=\"vtk-container-wrapper\"\n    tabindex=\"0\"\n    @pointerenter=\"hover = true\"\n    @pointerleave=\"hover = false\"\n    @focusin=\"hover = true\"\n    @focusout=\"hover = false\"\n  >\n    <div class=\"vtk-gutter\">\n      <v-btn dark icon size=\"medium\" variant=\"text\" @click=\"enableResizeToFit\">\n        <v-icon size=\"medium\" class=\"py-1\">mdi-camera-flip-outline</v-icon>\n        <v-tooltip\n          location=\"right\"\n          activator=\"parent\"\n          transition=\"slide-x-transition\"\n        >\n          Reset Camera\n        </v-tooltip>\n      </v-btn>\n      <slice-slider\n        class=\"slice-slider\"\n        :slice=\"currentSlice\"\n        :min=\"sliceMin\"\n        :max=\"sliceMax\"\n        :step=\"1\"\n        :handle-height=\"20\"\n        @input=\"setSlice\"\n      />\n    </div>\n    <div class=\"vtk-container\" :class=\"active ? 'active' : ''\">\n      <div class=\"vtk-sub-container\">\n        <div class=\"vtk-view\" ref=\"vtkContainerRef\" />\n      </div>\n      <div class=\"overlay-no-events tool-layer\" ref=\"toolContainer\">\n        <pan-tool :view-id=\"viewID\" />\n        <zoom-tool :view-id=\"viewID\" />\n        <slice-scroll-tool :view-id=\"viewID\" />\n        <window-level-tool :view-id=\"viewID\" />\n        <contour-tool\n          :view-id=\"viewID\"\n          :widget-manager=\"widgetManager\"\n          :view-direction=\"viewDirection\"\n          :current-slice=\"currentSlice\"\n        />\n        <ruler-tool\n          :view-id=\"viewID\"\n          :widget-manager=\"widgetManager\"\n          :view-direction=\"viewDirection\"\n          :current-slice=\"currentSlice\"\n        />\n        <rectangle-tool\n          :view-id=\"viewID\"\n          :widget-manager=\"widgetManager\"\n          :view-direction=\"viewDirection\"\n          :current-slice=\"currentSlice\"\n        />\n        <paint-tool\n          :view-id=\"viewID\"\n          :view-direction=\"viewDirection\"\n          :widget-manager=\"widgetManager\"\n          :slice=\"currentSlice\"\n        />\n        <crosshairs-tool\n          :view-id=\"viewID\"\n          :view-direction=\"viewDirection\"\n          :widget-manager=\"widgetManager\"\n          :slice=\"currentSlice\"\n        />\n        <crop-tool :view-id=\"viewID\" />\n      </div>\n      <view-overlay-grid class=\"overlay-no-events view-annotations\">\n        <template v-slot:top-center>\n          <div class=\"annotation-cell\">\n            <span>{{ topLabel }}</span>\n          </div>\n        </template>\n        <template v-slot:middle-left>\n          <div class=\"annotation-cell\">\n            <span>{{ leftLabel }}</span>\n          </div>\n        </template>\n        <template v-slot:bottom-left>\n          <div class=\"annotation-cell\">\n            <div>Slice: {{ currentSlice + 1 }}/{{ sliceMax + 1 }}</div>\n            <div\n              v-if=\"\n                typeof windowWidth === 'number' &&\n                typeof windowLevel === 'number'\n              \"\n            >\n              W/L: {{ windowWidth.toFixed(2) }} / {{ windowLevel.toFixed(2) }}\n            </div>\n          </div>\n        </template>\n        <template v-slot:top-right>\n          <div class=\"annotation-cell\">\n            <v-menu\n              open-on-hover\n              location=\"bottom left\"\n              left\n              nudge-left=\"10\"\n              dark\n              v-if=\"dicomInfo !== null\"\n              max-width=\"300px\"\n            >\n              <template v-slot:activator=\"{ props }\">\n                <v-icon\n                  v-bind=\"props\"\n                  dark\n                  size=\"x-large\"\n                  class=\"pointer-events-all hover-info\"\n                >\n                  mdi-information\n                </v-icon>\n              </template>\n              <v-list class=\"bg-grey-darken-3\">\n                <v-list-item>\n                  <v-list-item-title class=\"font-weight-bold\">\n                    PATIENT / CASE\n                  </v-list-item-title>\n                  <v-divider />\n                  <v-list-item-title>\n                    ID: {{ dicomInfo.patientID }}\n                  </v-list-item-title>\n                </v-list-item>\n                <v-list-item>\n                  <v-list-item-title class=\"font-weight-bold\">\n                    STUDY\n                  </v-list-item-title>\n                  <v-divider />\n                  <v-list-item-title>\n                    ID: {{ dicomInfo.studyID }}\n                  </v-list-item-title>\n                  <v-list-item-title>\n                    {{ dicomInfo.studyDescription }}\n                  </v-list-item-title>\n                </v-list-item>\n                <v-list-item>\n                  <v-list-item-title class=\"font-weight-bold\">\n                    SERIES\n                  </v-list-item-title>\n                  <v-divider />\n                  <v-list-item-title>\n                    Series #: {{ dicomInfo.seriesNumber }}\n                  </v-list-item-title>\n                  <v-list-item-title>\n                    {{ dicomInfo.seriesDescription }}\n                  </v-list-item-title>\n                </v-list-item>\n              </v-list>\n            </v-menu>\n          </div>\n        </template>\n      </view-overlay-grid>\n      <transition name=\"loading\">\n        <div v-if=\"isImageLoading\" class=\"overlay-no-events loading\">\n          <div>Loading the image</div>\n          <div>\n            <v-progress-circular indeterminate color=\"blue\" />\n          </div>\n        </div>\n      </transition>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport {\n  computed,\n  defineComponent,\n  onBeforeMount,\n  onBeforeUnmount,\n  onMounted,\n  PropType,\n  provide,\n  ref,\n  toRefs,\n  watch,\n  watchEffect,\n} from 'vue';\nimport { vec3 } from 'gl-matrix';\nimport { onKeyStroke } from '@vueuse/core';\n\nimport { useResizeToFit } from '@src/composables/useResizeToFit';\nimport vtkLPSView2DProxy from '@src/vtk/LPSView2DProxy';\nimport vtkIJKSliceRepresentationProxy from '@src/vtk/IJKSliceRepresentationProxy';\nimport vtkPiecewiseFunctionProxy from '@kitware/vtk.js/Proxy/Core/PiecewiseFunctionProxy';\nimport { Mode as LookupTableProxyMode } from '@kitware/vtk.js/Proxy/Core/LookupTableProxy';\nimport { manageVTKSubscription } from '@src/composables/manageVTKSubscription';\nimport SliceSlider from '@src/components/SliceSlider.vue';\nimport ViewOverlayGrid from '@src/components/ViewOverlayGrid.vue';\nimport { useResizeObserver } from '../composables/useResizeObserver';\nimport { useOrientationLabels } from '../composables/useOrientationLabels';\nimport { getLPSAxisFromDir } from '../utils/lps';\nimport { useCurrentImage } from '../composables/useCurrentImage';\nimport { useCameraOrientation } from '../composables/useCameraOrientation';\nimport WindowLevelTool from './tools/WindowLevelTool.vue';\nimport SliceScrollTool from './tools/SliceScrollTool.vue';\nimport PanTool from './tools/PanTool.vue';\nimport ZoomTool from './tools/ZoomTool.vue';\nimport RulerTool from './tools/RulerTool.vue';\nimport RectangleTool from './tools/RectangleTool.vue';\nimport ContourTool from './tools/ContourTool.vue';\nimport PaintTool from './tools/PaintTool.vue';\nimport { useSceneBuilder } from '../composables/useSceneBuilder';\nimport { useDICOMStore } from '../store/datasets-dicom';\nimport { useLabelmapStore } from '../store/datasets-labelmaps';\nimport vtkLabelMapSliceRepProxy from '../vtk/LabelMapSliceRepProxy';\nimport { usePaintToolStore } from '../store/tools/paint';\nimport useWindowingStore from '../store/view-configs/windowing';\nimport { usePersistCameraConfig } from '../composables/usePersistCameraConfig';\nimport CrosshairsTool from './tools/CrosshairsTool.vue';\nimport { LPSAxisDir } from '../types/lps';\nimport { ViewProxyType } from '../core/proxies';\nimport { useViewProxy } from '../composables/useViewProxy';\nimport { useWidgetManager } from '../composables/useWidgetManager';\nimport useViewSliceStore, {\n  defaultSliceConfig,\n} from '../store/view-configs/slicing';\nimport CropTool from './tools/CropTool.vue';\nimport { ToolContainer, VTKTwoViewWidgetManager } from '../constants';\nimport { useProxyManager } from '../composables/proxyManager';\nimport { getShiftedOpacityFromPreset } from '../utils/vtk-helpers';\nimport { useLayersStore } from '../store/datasets-layers';\nimport { useViewCameraStore } from '../store/view-configs/camera';\nimport useLayerColoringStore from '../store/view-configs/layers';\n\nconst SLICE_OFFSET_KEYS: Record<string, number> = {\n  ArrowLeft: -1,\n  ArrowRight: 1,\n  ArrowUp: -1,\n  ArrowDown: 1,\n} as const;\n\nexport default defineComponent({\n  name: 'VtkTwoView',\n  props: {\n    id: {\n      type: String,\n      required: true,\n    },\n    viewDirection: {\n      type: String as PropType<LPSAxisDir>,\n      required: true,\n    },\n    viewUp: {\n      type: String as PropType<LPSAxisDir>,\n      required: true,\n    },\n  },\n  components: {\n    SliceSlider,\n    ViewOverlayGrid,\n    WindowLevelTool,\n    SliceScrollTool,\n    PanTool,\n    ZoomTool,\n    RulerTool,\n    RectangleTool,\n    PaintTool,\n    CrosshairsTool,\n    CropTool,\n    ContourTool,\n  },\n  setup(props) {\n    const windowingStore = useWindowingStore();\n    const viewSliceStore = useViewSliceStore();\n    const viewCameraStore = useViewCameraStore();\n    const layerColoringStore = useLayerColoringStore();\n    const paintStore = usePaintToolStore();\n\n    const { id: viewID, viewDirection, viewUp } = toRefs(props);\n\n    const vtkContainerRef = ref<HTMLElement>();\n\n    const viewAxis = computed(() => getLPSAxisFromDir(viewDirection.value));\n\n    // --- computed vars --- //\n\n    const {\n      currentImageData: curImageData,\n      currentImageID: curImageID,\n      currentImageMetadata: curImageMetadata,\n      isImageLoading,\n      currentLayers,\n    } = useCurrentImage();\n\n    const dicomStore = useDICOMStore();\n\n    const sliceConfigDefaults = defaultSliceConfig();\n    const sliceConfig = computed(() =>\n      viewSliceStore.getConfig(viewID.value, curImageID.value)\n    );\n    const currentSlice = computed(\n      () => sliceConfig.value?.slice ?? sliceConfigDefaults.slice\n    );\n    const sliceMin = computed(\n      () => sliceConfig.value?.min ?? sliceConfigDefaults.min\n    );\n    const sliceMax = computed(\n      () => sliceConfig.value?.max ?? sliceConfigDefaults.max\n    );\n\n    const wlConfig = computed({\n      get: () => windowingStore.getConfig(viewID.value, curImageID.value),\n      set: (newValue) => {\n        const imageID = curImageID.value;\n        if (imageID !== null && newValue != null) {\n          windowingStore.updateConfig(viewID.value, imageID, newValue);\n        }\n      },\n    });\n\n    const windowWidth = computed(() => wlConfig.value?.width);\n    const windowLevel = computed(() => wlConfig.value?.level);\n    const dicomInfo = computed(() => {\n      if (\n        curImageID.value !== null &&\n        curImageID.value in dicomStore.imageIDToVolumeKey\n      ) {\n        const volumeKey = dicomStore.imageIDToVolumeKey[curImageID.value];\n        const volumeInfo = dicomStore.volumeInfo[volumeKey];\n        const studyKey = dicomStore.volumeStudy[volumeKey];\n        const studyInfo = dicomStore.studyInfo[studyKey];\n        const patientKey = dicomStore.studyPatient[studyKey];\n        const patientInfo = dicomStore.patientInfo[patientKey];\n\n        const patientID = patientInfo.PatientID;\n        const studyID = studyInfo.StudyID;\n        const studyDescription = studyInfo.StudyDescription;\n        const seriesNumber = volumeInfo.SeriesNumber;\n        const seriesDescription = volumeInfo.SeriesDescription;\n\n        return {\n          patientID,\n          studyID,\n          studyDescription,\n          seriesNumber,\n          seriesDescription,\n        };\n      }\n\n      return null;\n    });\n\n    const sliceDomain = computed(() => {\n      const { lpsOrientation, dimensions } = curImageMetadata.value;\n      const ijkIndex = lpsOrientation[viewAxis.value];\n      const dimMax = dimensions[ijkIndex];\n\n      return {\n        min: 0,\n        max: dimMax - 1,\n      };\n    });\n\n    // --- setters --- //\n\n    const setSlice = (slice: number) => {\n      if (curImageID.value !== null) {\n        viewSliceStore.updateConfig(viewID.value, curImageID.value, {\n          slice,\n        });\n      }\n    };\n\n    // --- view proxy setup --- //\n\n    const { viewProxy, setContainer: setViewProxyContainer } =\n      useViewProxy<vtkLPSView2DProxy>(viewID, ViewProxyType.Slice);\n\n    onBeforeMount(() => {\n      // do this before mount, as the ManipulatorTools run onMounted\n      // before this component does.\n      viewProxy.value.getInteractorStyle2D().removeAllManipulators();\n    });\n\n    onMounted(() => {\n      setViewProxyContainer(vtkContainerRef.value);\n      viewProxy.value.setOrientationAxesVisibility(false);\n    });\n\n    onBeforeUnmount(() => {\n      setViewProxyContainer(null);\n    });\n\n    // --- Slicing setup --- //\n\n    watchEffect(() => {\n      const ijkIndex = curImageMetadata.value.lpsOrientation[viewAxis.value];\n      viewProxy.value.setSlicingMode('IJK'[ijkIndex]);\n    });\n\n    watch(\n      [viewID, curImageID, viewDirection],\n      ([viewID_, imageID, viewDir]) => {\n        if (!imageID || sliceConfig.value != null) {\n          return;\n        }\n\n        viewSliceStore.updateConfig(viewID_, imageID, {\n          ...sliceDomain.value,\n          axisDirection: viewDir,\n        });\n        viewSliceStore.resetSlice(viewID_, imageID);\n      },\n      { immediate: true }\n    );\n\n    // --- arrows change slice --- //\n\n    const hover = ref(false);\n    const onKeyDown = (event: KeyboardEvent) => {\n      if (!curImageID.value || !hover.value) return;\n\n      const sliceOffset = SLICE_OFFSET_KEYS[event.key] ?? 0;\n      if (sliceOffset) {\n        viewSliceStore.updateConfig(viewID.value, curImageID.value, {\n          slice: currentSlice.value + sliceOffset,\n        });\n\n        event.stopPropagation();\n      }\n    };\n    onKeyStroke(Object.keys(SLICE_OFFSET_KEYS), onKeyDown);\n\n    // --- resizing --- //\n\n    useResizeObserver(vtkContainerRef, () => viewProxy.value.resize());\n\n    // Used by SVG tool widgets for resizeCallback\n    const toolContainer = ref<HTMLElement>();\n    provide(ToolContainer, toolContainer);\n\n    // --- widget manager --- //\n\n    const { widgetManager } = useWidgetManager(viewProxy);\n    provide(VTKTwoViewWidgetManager, widgetManager);\n\n    // --- window/level setup --- //\n\n    watch(\n      curImageData,\n      (imageData) => {\n        if (curImageID.value == null || wlConfig.value != null || !imageData) {\n          return;\n        }\n\n        // TODO listen to changes in point data\n        const range = imageData.getPointData().getScalars().getRange();\n        windowingStore.updateConfig(viewID.value, curImageID.value, {\n          min: range[0],\n          max: range[1],\n        });\n        windowingStore.resetWindowLevel(viewID.value, curImageID.value);\n      },\n      {\n        immediate: true,\n      }\n    );\n\n    // --- scene setup --- //\n\n    const labelmapStore = useLabelmapStore();\n\n    const labelmapIDs = computed(() => {\n      return labelmapStore.idList.filter(\n        (id) => labelmapStore.parentImage[id] === curImageID.value\n      );\n    });\n\n    const layerIDs = computed(() => currentLayers.value.map(({ id }) => id));\n\n    const { baseImageRep, labelmapReps, layerReps } = useSceneBuilder<\n      vtkIJKSliceRepresentationProxy,\n      vtkLabelMapSliceRepProxy,\n      vtkIJKSliceRepresentationProxy\n    >(viewID, {\n      baseImage: curImageID,\n      labelmaps: labelmapIDs,\n      layers: layerIDs,\n    });\n\n    // --- camera setup --- //\n\n    const { cameraDirVec, cameraUpVec } = useCameraOrientation(\n      viewDirection,\n      viewUp,\n      curImageMetadata\n    );\n    const { resizeToFit, ignoreResizeToFitTracking, resetResizeToFitTracking } =\n      useResizeToFit(viewProxy.value.getCamera(), false);\n\n    const resizeToFitScene = () =>\n      ignoreResizeToFitTracking(() => {\n        // resize to fit\n        const lookAxis =\n          curImageMetadata.value.lpsOrientation[\n            getLPSAxisFromDir(viewDirection.value)\n          ];\n        const upAxis =\n          curImageMetadata.value.lpsOrientation[\n            getLPSAxisFromDir(viewUp.value)\n          ];\n        const dimsWithSpacing = curImageMetadata.value.dimensions.map(\n          (d, i) => d * curImageMetadata.value.spacing[i]\n        );\n        viewProxy.value.resizeToFit(lookAxis, upAxis, dimsWithSpacing);\n        resetResizeToFitTracking();\n      });\n\n    const resetCamera = () => {\n      const bounds = curImageMetadata.value.worldBounds;\n      const center = [\n        (bounds[0] + bounds[1]) / 2,\n        (bounds[2] + bounds[3]) / 2,\n        (bounds[4] + bounds[5]) / 2,\n      ] as vec3;\n\n      // do not track resizeToFit state\n      ignoreResizeToFitTracking(() => {\n        viewProxy.value.updateCamera(\n          cameraDirVec.value,\n          cameraUpVec.value,\n          center\n        );\n        viewProxy.value.resetCamera(bounds);\n      });\n\n      resizeToFitScene();\n\n      viewProxy.value.renderLater();\n    };\n\n    manageVTKSubscription(\n      viewProxy.value.onResize(() => {\n        if (resizeToFit.value) {\n          resizeToFitScene();\n        }\n      })\n    );\n\n    // if we re-enable resizeToFit, reset the camera\n    watch(resizeToFit, () => {\n      if (resizeToFit.value) {\n        resetCamera();\n      }\n    });\n\n    const { restoreCameraConfig } = usePersistCameraConfig(\n      viewID,\n      curImageID,\n      viewProxy,\n      'parallelScale',\n      'position',\n      'focalPoint',\n      'viewUp'\n    );\n\n    watch(\n      [curImageID, cameraDirVec, cameraUpVec],\n      () => {\n        const cameraConfig = viewCameraStore.getConfig(\n          viewID.value,\n          curImageID.value\n        );\n\n        // If we have a saved camera configuration restore it\n        if (cameraConfig) {\n          restoreCameraConfig(cameraConfig);\n\n          viewProxy.value.getRenderer().resetCameraClippingRange();\n          viewProxy.value.renderLater();\n\n          // Prevent resize\n          resizeToFit.value = false;\n        } else if (resizeToFit.value) {\n          resetCamera();\n        } else {\n          // this will trigger a resetCamera() call\n          resizeToFit.value = true;\n        }\n      },\n      { immediate: true, deep: true }\n    );\n\n    // --- viewport orientation/camera labels --- //\n\n    const { top: topLabel, left: leftLabel } = useOrientationLabels(viewProxy);\n\n    // --- apply windowing and slice configs --- //\n\n    watchEffect(() => {\n      if (sliceConfig.value == null || wlConfig.value == null) {\n        return;\n      }\n\n      const { slice } = sliceConfig.value;\n      const { width, level } = wlConfig.value;\n      const rep = baseImageRep.value;\n      if (rep) {\n        rep.setSlice(slice);\n        rep.setWindowWidth(width);\n        rep.setWindowLevel(level);\n      }\n      [...layerReps.value, ...labelmapReps.value].forEach((lRep) => {\n        lRep.setSlice(slice);\n      });\n\n      viewProxy.value.renderLater();\n    });\n\n    // --- apply labelmap opacity --- //\n\n    watchEffect(() => {\n      const { labelmapOpacity } = paintStore;\n      labelmapReps.value.forEach((lmRep) => {\n        lmRep.setOpacity(labelmapOpacity);\n      });\n    });\n\n    // --- layers setup --- //\n\n    const layersConfigs = computed(() =>\n      layerIDs.value.map((id) => layerColoringStore.getConfig(viewID.value, id))\n    );\n\n    const layersStore = useLayersStore();\n    watch(\n      [viewID, currentLayers],\n      () => {\n        currentLayers.value.forEach(({ id }, layerIndex) => {\n          const image = layersStore.layerImages[id];\n          const layerConfig = layersConfigs.value[layerIndex];\n          if (image && !layerConfig) {\n            layerColoringStore.resetToDefault(viewID.value, id, image);\n          }\n        });\n      },\n      { immediate: true }\n    );\n\n    // --- layer coloring --- //\n\n    const proxyManager = useProxyManager()!;\n\n    const colorBys = computed(() =>\n      layersConfigs.value.map((config) => config?.colorBy)\n    );\n    const transferFunctions = computed(() =>\n      layersConfigs.value.map((config) => config?.transferFunction)\n    );\n    const opacityFunctions = computed(() =>\n      layersConfigs.value.map((config) => config?.opacityFunction)\n    );\n    const blendConfigs = computed(() =>\n      layersConfigs.value.map((config) => config?.blendConfig)\n    );\n\n    watch(\n      [layerReps, colorBys, transferFunctions, opacityFunctions, blendConfigs],\n      () => {\n        layerReps.value\n          .map(\n            (layerRep, idx) =>\n              [\n                layerRep,\n                colorBys.value[idx],\n                transferFunctions.value[idx],\n                opacityFunctions.value[idx],\n                blendConfigs.value[idx],\n              ] as const\n          )\n          .forEach(\n            ([\n              rep,\n              colorBy,\n              transferFunction,\n              opacityFunction,\n              blendConfig,\n            ]) => {\n              if (\n                !colorBy ||\n                !transferFunction ||\n                !opacityFunction ||\n                !blendConfig\n              ) {\n                return;\n              }\n\n              const { arrayName, location } = colorBy;\n              const ctFunc = transferFunction;\n              const opFunc = opacityFunction;\n\n              const lut = proxyManager.getLookupTable(arrayName);\n              lut.setMode(LookupTableProxyMode.Preset);\n              lut.setPresetName(ctFunc.preset);\n              lut.setDataRange(...ctFunc.mappingRange);\n\n              const pwf = proxyManager.getPiecewiseFunction(arrayName);\n              pwf.setMode(opFunc.mode);\n              pwf.setDataRange(...opFunc.mappingRange);\n\n              switch (opFunc.mode) {\n                case vtkPiecewiseFunctionProxy.Mode.Gaussians:\n                  pwf.setGaussians(opFunc.gaussians);\n                  break;\n                case vtkPiecewiseFunctionProxy.Mode.Points: {\n                  const opacityPoints = getShiftedOpacityFromPreset(\n                    opFunc.preset,\n                    opFunc.mappingRange,\n                    opFunc.shift\n                  );\n                  if (opacityPoints) {\n                    pwf.setPoints(opacityPoints);\n                  }\n                  break;\n                }\n                case vtkPiecewiseFunctionProxy.Mode.Nodes:\n                  pwf.setNodes(opFunc.nodes);\n                  break;\n                default:\n              }\n\n              // control color range manually\n              rep.setRescaleOnColorBy(false);\n              rep.setColorBy(arrayName, location);\n              rep.setOpacity(blendConfig.opacity);\n\n              // Need to trigger a render for when we are restoring from a state file\n              viewProxy.value.renderLater();\n            }\n          );\n      },\n      { immediate: true, deep: true }\n    );\n\n    return {\n      vtkContainerRef,\n      toolContainer,\n      viewID,\n      viewProxy,\n      viewAxis,\n      active: true,\n      currentSlice,\n      sliceMin,\n      sliceMax,\n      windowWidth,\n      windowLevel,\n      topLabel,\n      leftLabel,\n      isImageLoading,\n      setSlice,\n      widgetManager,\n      dicomInfo,\n      enableResizeToFit() {\n        resizeToFit.value = true;\n      },\n      hover,\n    };\n  },\n});\n</script>\n\n<style scoped src=\"@/src/components/styles/vtk-view.css\"></style>\n<style scoped src=\"@/src/components/styles/utils.css\"></style>\n<style scoped>\n.hover-info {\n  width: 32px;\n  height: 32px;\n  cursor: pointer;\n}\n</style>\n","<template>\n  <div\n    class=\"vtk-container-wrapper\"\n    tabindex=\"0\"\n    @pointerenter=\"hover = true\"\n    @pointerleave=\"hover = false\"\n    @focusin=\"hover = true\"\n    @focusout=\"hover = false\"\n  >\n    <div class=\"vtk-gutter\">\n      <v-btn dark icon size=\"medium\" variant=\"text\" @click=\"enableResizeToFit\">\n        <v-icon size=\"medium\" class=\"py-1\">mdi-camera-flip-outline</v-icon>\n        <v-tooltip\n          location=\"right\"\n          activator=\"parent\"\n          transition=\"slide-x-transition\"\n        >\n          Reset Camera\n        </v-tooltip>\n      </v-btn>\n      <slice-slider\n        class=\"slice-slider\"\n        :slice=\"currentSlice\"\n        :min=\"sliceMin\"\n        :max=\"sliceMax\"\n        :step=\"1\"\n        :handle-height=\"20\"\n        @input=\"setSlice\"\n      />\n    </div>\n    <div class=\"vtk-container\" :class=\"active ? 'active' : ''\">\n      <div class=\"vtk-sub-container\">\n        <div class=\"vtk-view\" ref=\"vtkContainerRef\" />\n      </div>\n      <div class=\"overlay-no-events tool-layer\" ref=\"toolContainer\">\n        <pan-tool :view-id=\"viewID\" />\n        <zoom-tool :view-id=\"viewID\" />\n        <slice-scroll-tool :view-id=\"viewID\" />\n        <window-level-tool :view-id=\"viewID\" />\n        <contour-tool\n          :view-id=\"viewID\"\n          :widget-manager=\"widgetManager\"\n          :view-direction=\"viewDirection\"\n          :current-slice=\"currentSlice\"\n        />\n        <ruler-tool\n          :view-id=\"viewID\"\n          :widget-manager=\"widgetManager\"\n          :view-direction=\"viewDirection\"\n          :current-slice=\"currentSlice\"\n        />\n        <rectangle-tool\n          :view-id=\"viewID\"\n          :widget-manager=\"widgetManager\"\n          :view-direction=\"viewDirection\"\n          :current-slice=\"currentSlice\"\n        />\n        <paint-tool\n          :view-id=\"viewID\"\n          :view-direction=\"viewDirection\"\n          :widget-manager=\"widgetManager\"\n          :slice=\"currentSlice\"\n        />\n        <crosshairs-tool\n          :view-id=\"viewID\"\n          :view-direction=\"viewDirection\"\n          :widget-manager=\"widgetManager\"\n          :slice=\"currentSlice\"\n        />\n        <crop-tool :view-id=\"viewID\" />\n      </div>\n      <view-overlay-grid class=\"overlay-no-events view-annotations\">\n        <template v-slot:top-center>\n          <div class=\"annotation-cell\">\n            <span>{{ topLabel }}</span>\n          </div>\n        </template>\n        <template v-slot:middle-left>\n          <div class=\"annotation-cell\">\n            <span>{{ leftLabel }}</span>\n          </div>\n        </template>\n        <template v-slot:bottom-left>\n          <div class=\"annotation-cell\">\n            <div>Slice: {{ currentSlice + 1 }}/{{ sliceMax + 1 }}</div>\n            <div\n              v-if=\"\n                typeof windowWidth === 'number' &&\n                typeof windowLevel === 'number'\n              \"\n            >\n              W/L: {{ windowWidth.toFixed(2) }} / {{ windowLevel.toFixed(2) }}\n            </div>\n          </div>\n        </template>\n        <template v-slot:top-right>\n          <div class=\"annotation-cell\">\n            <v-menu\n              open-on-hover\n              location=\"bottom left\"\n              left\n              nudge-left=\"10\"\n              dark\n              v-if=\"dicomInfo !== null\"\n              max-width=\"300px\"\n            >\n              <template v-slot:activator=\"{ props }\">\n                <v-icon\n                  v-bind=\"props\"\n                  dark\n                  size=\"x-large\"\n                  class=\"pointer-events-all hover-info\"\n                >\n                  mdi-information\n                </v-icon>\n              </template>\n              <v-list class=\"bg-grey-darken-3\">\n                <v-list-item>\n                  <v-list-item-title class=\"font-weight-bold\">\n                    PATIENT / CASE\n                  </v-list-item-title>\n                  <v-divider />\n                  <v-list-item-title>\n                    ID: {{ dicomInfo.patientID }}\n                  </v-list-item-title>\n                </v-list-item>\n                <v-list-item>\n                  <v-list-item-title class=\"font-weight-bold\">\n                    STUDY\n                  </v-list-item-title>\n                  <v-divider />\n                  <v-list-item-title>\n                    ID: {{ dicomInfo.studyID }}\n                  </v-list-item-title>\n                  <v-list-item-title>\n                    {{ dicomInfo.studyDescription }}\n                  </v-list-item-title>\n                </v-list-item>\n                <v-list-item>\n                  <v-list-item-title class=\"font-weight-bold\">\n                    SERIES\n                  </v-list-item-title>\n                  <v-divider />\n                  <v-list-item-title>\n                    Series #: {{ dicomInfo.seriesNumber }}\n                  </v-list-item-title>\n                  <v-list-item-title>\n                    {{ dicomInfo.seriesDescription }}\n                  </v-list-item-title>\n                </v-list-item>\n              </v-list>\n            </v-menu>\n          </div>\n        </template>\n      </view-overlay-grid>\n      <transition name=\"loading\">\n        <div v-if=\"isImageLoading\" class=\"overlay-no-events loading\">\n          <div>Loading the image</div>\n          <div>\n            <v-progress-circular indeterminate color=\"blue\" />\n          </div>\n        </div>\n      </transition>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport {\n  computed,\n  defineComponent,\n  onBeforeMount,\n  onBeforeUnmount,\n  onMounted,\n  PropType,\n  provide,\n  ref,\n  toRefs,\n  watch,\n  watchEffect,\n} from 'vue';\nimport { vec3 } from 'gl-matrix';\nimport { onKeyStroke } from '@vueuse/core';\n\nimport { useResizeToFit } from '@src/composables/useResizeToFit';\nimport vtkLPSView2DProxy from '@src/vtk/LPSView2DProxy';\nimport vtkIJKSliceRepresentationProxy from '@src/vtk/IJKSliceRepresentationProxy';\nimport vtkPiecewiseFunctionProxy from '@kitware/vtk.js/Proxy/Core/PiecewiseFunctionProxy';\nimport { Mode as LookupTableProxyMode } from '@kitware/vtk.js/Proxy/Core/LookupTableProxy';\nimport { manageVTKSubscription } from '@src/composables/manageVTKSubscription';\nimport SliceSlider from '@src/components/SliceSlider.vue';\nimport ViewOverlayGrid from '@src/components/ViewOverlayGrid.vue';\nimport { useResizeObserver } from '../composables/useResizeObserver';\nimport { useOrientationLabels } from '../composables/useOrientationLabels';\nimport { getLPSAxisFromDir } from '../utils/lps';\nimport { useCurrentImage } from '../composables/useCurrentImage';\nimport { useCameraOrientation } from '../composables/useCameraOrientation';\nimport WindowLevelTool from './tools/WindowLevelTool.vue';\nimport SliceScrollTool from './tools/SliceScrollTool.vue';\nimport PanTool from './tools/PanTool.vue';\nimport ZoomTool from './tools/ZoomTool.vue';\nimport RulerTool from './tools/RulerTool.vue';\nimport RectangleTool from './tools/RectangleTool.vue';\nimport ContourTool from './tools/ContourTool.vue';\nimport PaintTool from './tools/PaintTool.vue';\nimport { useSceneBuilder } from '../composables/useSceneBuilder';\nimport { useDICOMStore } from '../store/datasets-dicom';\nimport { useLabelmapStore } from '../store/datasets-labelmaps';\nimport vtkLabelMapSliceRepProxy from '../vtk/LabelMapSliceRepProxy';\nimport { usePaintToolStore } from '../store/tools/paint';\nimport useWindowingStore from '../store/view-configs/windowing';\nimport { usePersistCameraConfig } from '../composables/usePersistCameraConfig';\nimport CrosshairsTool from './tools/CrosshairsTool.vue';\nimport { LPSAxisDir } from '../types/lps';\nimport { ViewProxyType } from '../core/proxies';\nimport { useViewProxy } from '../composables/useViewProxy';\nimport { useWidgetManager } from '../composables/useWidgetManager';\nimport useViewSliceStore, {\n  defaultSliceConfig,\n} from '../store/view-configs/slicing';\nimport CropTool from './tools/CropTool.vue';\nimport { ToolContainer, VTKTwoViewWidgetManager } from '../constants';\nimport { useProxyManager } from '../composables/proxyManager';\nimport { getShiftedOpacityFromPreset } from '../utils/vtk-helpers';\nimport { useLayersStore } from '../store/datasets-layers';\nimport { useViewCameraStore } from '../store/view-configs/camera';\nimport useLayerColoringStore from '../store/view-configs/layers';\n\nconst SLICE_OFFSET_KEYS: Record<string, number> = {\n  ArrowLeft: -1,\n  ArrowRight: 1,\n  ArrowUp: -1,\n  ArrowDown: 1,\n} as const;\n\nexport default defineComponent({\n  name: 'VtkTwoView',\n  props: {\n    id: {\n      type: String,\n      required: true,\n    },\n    viewDirection: {\n      type: String as PropType<LPSAxisDir>,\n      required: true,\n    },\n    viewUp: {\n      type: String as PropType<LPSAxisDir>,\n      required: true,\n    },\n  },\n  components: {\n    SliceSlider,\n    ViewOverlayGrid,\n    WindowLevelTool,\n    SliceScrollTool,\n    PanTool,\n    ZoomTool,\n    RulerTool,\n    RectangleTool,\n    PaintTool,\n    CrosshairsTool,\n    CropTool,\n    ContourTool,\n  },\n  setup(props) {\n    const windowingStore = useWindowingStore();\n    const viewSliceStore = useViewSliceStore();\n    const viewCameraStore = useViewCameraStore();\n    const layerColoringStore = useLayerColoringStore();\n    const paintStore = usePaintToolStore();\n\n    const { id: viewID, viewDirection, viewUp } = toRefs(props);\n\n    const vtkContainerRef = ref<HTMLElement>();\n\n    const viewAxis = computed(() => getLPSAxisFromDir(viewDirection.value));\n\n    // --- computed vars --- //\n\n    const {\n      currentImageData: curImageData,\n      currentImageID: curImageID,\n      currentImageMetadata: curImageMetadata,\n      isImageLoading,\n      currentLayers,\n    } = useCurrentImage();\n\n    const dicomStore = useDICOMStore();\n\n    const sliceConfigDefaults = defaultSliceConfig();\n    const sliceConfig = computed(() =>\n      viewSliceStore.getConfig(viewID.value, curImageID.value)\n    );\n    const currentSlice = computed(\n      () => sliceConfig.value?.slice ?? sliceConfigDefaults.slice\n    );\n    const sliceMin = computed(\n      () => sliceConfig.value?.min ?? sliceConfigDefaults.min\n    );\n    const sliceMax = computed(\n      () => sliceConfig.value?.max ?? sliceConfigDefaults.max\n    );\n\n    const wlConfig = computed({\n      get: () => windowingStore.getConfig(viewID.value, curImageID.value),\n      set: (newValue) => {\n        const imageID = curImageID.value;\n        if (imageID !== null && newValue != null) {\n          windowingStore.updateConfig(viewID.value, imageID, newValue);\n        }\n      },\n    });\n\n    const windowWidth = computed(() => wlConfig.value?.width);\n    const windowLevel = computed(() => wlConfig.value?.level);\n    const dicomInfo = computed(() => {\n      if (\n        curImageID.value !== null &&\n        curImageID.value in dicomStore.imageIDToVolumeKey\n      ) {\n        const volumeKey = dicomStore.imageIDToVolumeKey[curImageID.value];\n        const volumeInfo = dicomStore.volumeInfo[volumeKey];\n        const studyKey = dicomStore.volumeStudy[volumeKey];\n        const studyInfo = dicomStore.studyInfo[studyKey];\n        const patientKey = dicomStore.studyPatient[studyKey];\n        const patientInfo = dicomStore.patientInfo[patientKey];\n\n        const patientID = patientInfo.PatientID;\n        const studyID = studyInfo.StudyID;\n        const studyDescription = studyInfo.StudyDescription;\n        const seriesNumber = volumeInfo.SeriesNumber;\n        const seriesDescription = volumeInfo.SeriesDescription;\n\n        return {\n          patientID,\n          studyID,\n          studyDescription,\n          seriesNumber,\n          seriesDescription,\n        };\n      }\n\n      return null;\n    });\n\n    const sliceDomain = computed(() => {\n      const { lpsOrientation, dimensions } = curImageMetadata.value;\n      const ijkIndex = lpsOrientation[viewAxis.value];\n      const dimMax = dimensions[ijkIndex];\n\n      return {\n        min: 0,\n        max: dimMax - 1,\n      };\n    });\n\n    // --- setters --- //\n\n    const setSlice = (slice: number) => {\n      if (curImageID.value !== null) {\n        viewSliceStore.updateConfig(viewID.value, curImageID.value, {\n          slice,\n        });\n      }\n    };\n\n    // --- view proxy setup --- //\n\n    const { viewProxy, setContainer: setViewProxyContainer } =\n      useViewProxy<vtkLPSView2DProxy>(viewID, ViewProxyType.Slice);\n\n    onBeforeMount(() => {\n      // do this before mount, as the ManipulatorTools run onMounted\n      // before this component does.\n      viewProxy.value.getInteractorStyle2D().removeAllManipulators();\n    });\n\n    onMounted(() => {\n      setViewProxyContainer(vtkContainerRef.value);\n      viewProxy.value.setOrientationAxesVisibility(false);\n    });\n\n    onBeforeUnmount(() => {\n      setViewProxyContainer(null);\n    });\n\n    // --- Slicing setup --- //\n\n    watchEffect(() => {\n      const ijkIndex = curImageMetadata.value.lpsOrientation[viewAxis.value];\n      viewProxy.value.setSlicingMode('IJK'[ijkIndex]);\n    });\n\n    watch(\n      [viewID, curImageID, viewDirection],\n      ([viewID_, imageID, viewDir]) => {\n        if (!imageID || sliceConfig.value != null) {\n          return;\n        }\n\n        viewSliceStore.updateConfig(viewID_, imageID, {\n          ...sliceDomain.value,\n          axisDirection: viewDir,\n        });\n        viewSliceStore.resetSlice(viewID_, imageID);\n      },\n      { immediate: true }\n    );\n\n    // --- arrows change slice --- //\n\n    const hover = ref(false);\n    const onKeyDown = (event: KeyboardEvent) => {\n      if (!curImageID.value || !hover.value) return;\n\n      const sliceOffset = SLICE_OFFSET_KEYS[event.key] ?? 0;\n      if (sliceOffset) {\n        viewSliceStore.updateConfig(viewID.value, curImageID.value, {\n          slice: currentSlice.value + sliceOffset,\n        });\n\n        event.stopPropagation();\n      }\n    };\n    onKeyStroke(Object.keys(SLICE_OFFSET_KEYS), onKeyDown);\n\n    // --- resizing --- //\n\n    useResizeObserver(vtkContainerRef, () => viewProxy.value.resize());\n\n    // Used by SVG tool widgets for resizeCallback\n    const toolContainer = ref<HTMLElement>();\n    provide(ToolContainer, toolContainer);\n\n    // --- widget manager --- //\n\n    const { widgetManager } = useWidgetManager(viewProxy);\n    provide(VTKTwoViewWidgetManager, widgetManager);\n\n    // --- window/level setup --- //\n\n    watch(\n      curImageData,\n      (imageData) => {\n        if (curImageID.value == null || wlConfig.value != null || !imageData) {\n          return;\n        }\n\n        // TODO listen to changes in point data\n        const range = imageData.getPointData().getScalars().getRange();\n        windowingStore.updateConfig(viewID.value, curImageID.value, {\n          min: range[0],\n          max: range[1],\n        });\n        windowingStore.resetWindowLevel(viewID.value, curImageID.value);\n      },\n      {\n        immediate: true,\n      }\n    );\n\n    // --- scene setup --- //\n\n    const labelmapStore = useLabelmapStore();\n\n    const labelmapIDs = computed(() => {\n      return labelmapStore.idList.filter(\n        (id) => labelmapStore.parentImage[id] === curImageID.value\n      );\n    });\n\n    const layerIDs = computed(() => currentLayers.value.map(({ id }) => id));\n\n    const { baseImageRep, labelmapReps, layerReps } = useSceneBuilder<\n      vtkIJKSliceRepresentationProxy,\n      vtkLabelMapSliceRepProxy,\n      vtkIJKSliceRepresentationProxy\n    >(viewID, {\n      baseImage: curImageID,\n      labelmaps: labelmapIDs,\n      layers: layerIDs,\n    });\n\n    // --- camera setup --- //\n\n    const { cameraDirVec, cameraUpVec } = useCameraOrientation(\n      viewDirection,\n      viewUp,\n      curImageMetadata\n    );\n    const { resizeToFit, ignoreResizeToFitTracking, resetResizeToFitTracking } =\n      useResizeToFit(viewProxy.value.getCamera(), false);\n\n    const resizeToFitScene = () =>\n      ignoreResizeToFitTracking(() => {\n        // resize to fit\n        const lookAxis =\n          curImageMetadata.value.lpsOrientation[\n            getLPSAxisFromDir(viewDirection.value)\n          ];\n        const upAxis =\n          curImageMetadata.value.lpsOrientation[\n            getLPSAxisFromDir(viewUp.value)\n          ];\n        const dimsWithSpacing = curImageMetadata.value.dimensions.map(\n          (d, i) => d * curImageMetadata.value.spacing[i]\n        );\n        viewProxy.value.resizeToFit(lookAxis, upAxis, dimsWithSpacing);\n        resetResizeToFitTracking();\n      });\n\n    const resetCamera = () => {\n      const bounds = curImageMetadata.value.worldBounds;\n      const center = [\n        (bounds[0] + bounds[1]) / 2,\n        (bounds[2] + bounds[3]) / 2,\n        (bounds[4] + bounds[5]) / 2,\n      ] as vec3;\n\n      // do not track resizeToFit state\n      ignoreResizeToFitTracking(() => {\n        viewProxy.value.updateCamera(\n          cameraDirVec.value,\n          cameraUpVec.value,\n          center\n        );\n        viewProxy.value.resetCamera(bounds);\n      });\n\n      resizeToFitScene();\n\n      viewProxy.value.renderLater();\n    };\n\n    manageVTKSubscription(\n      viewProxy.value.onResize(() => {\n        if (resizeToFit.value) {\n          resizeToFitScene();\n        }\n      })\n    );\n\n    // if we re-enable resizeToFit, reset the camera\n    watch(resizeToFit, () => {\n      if (resizeToFit.value) {\n        resetCamera();\n      }\n    });\n\n    const { restoreCameraConfig } = usePersistCameraConfig(\n      viewID,\n      curImageID,\n      viewProxy,\n      'parallelScale',\n      'position',\n      'focalPoint',\n      'viewUp'\n    );\n\n    watch(\n      [curImageID, cameraDirVec, cameraUpVec],\n      () => {\n        const cameraConfig = viewCameraStore.getConfig(\n          viewID.value,\n          curImageID.value\n        );\n\n        // If we have a saved camera configuration restore it\n        if (cameraConfig) {\n          restoreCameraConfig(cameraConfig);\n\n          viewProxy.value.getRenderer().resetCameraClippingRange();\n          viewProxy.value.renderLater();\n\n          // Prevent resize\n          resizeToFit.value = false;\n        } else if (resizeToFit.value) {\n          resetCamera();\n        } else {\n          // this will trigger a resetCamera() call\n          resizeToFit.value = true;\n        }\n      },\n      { immediate: true, deep: true }\n    );\n\n    // --- viewport orientation/camera labels --- //\n\n    const { top: topLabel, left: leftLabel } = useOrientationLabels(viewProxy);\n\n    // --- apply windowing and slice configs --- //\n\n    watchEffect(() => {\n      if (sliceConfig.value == null || wlConfig.value == null) {\n        return;\n      }\n\n      const { slice } = sliceConfig.value;\n      const { width, level } = wlConfig.value;\n      const rep = baseImageRep.value;\n      if (rep) {\n        rep.setSlice(slice);\n        rep.setWindowWidth(width);\n        rep.setWindowLevel(level);\n      }\n      [...layerReps.value, ...labelmapReps.value].forEach((lRep) => {\n        lRep.setSlice(slice);\n      });\n\n      viewProxy.value.renderLater();\n    });\n\n    // --- apply labelmap opacity --- //\n\n    watchEffect(() => {\n      const { labelmapOpacity } = paintStore;\n      labelmapReps.value.forEach((lmRep) => {\n        lmRep.setOpacity(labelmapOpacity);\n      });\n    });\n\n    // --- layers setup --- //\n\n    const layersConfigs = computed(() =>\n      layerIDs.value.map((id) => layerColoringStore.getConfig(viewID.value, id))\n    );\n\n    const layersStore = useLayersStore();\n    watch(\n      [viewID, currentLayers],\n      () => {\n        currentLayers.value.forEach(({ id }, layerIndex) => {\n          const image = layersStore.layerImages[id];\n          const layerConfig = layersConfigs.value[layerIndex];\n          if (image && !layerConfig) {\n            layerColoringStore.resetToDefault(viewID.value, id, image);\n          }\n        });\n      },\n      { immediate: true }\n    );\n\n    // --- layer coloring --- //\n\n    const proxyManager = useProxyManager()!;\n\n    const colorBys = computed(() =>\n      layersConfigs.value.map((config) => config?.colorBy)\n    );\n    const transferFunctions = computed(() =>\n      layersConfigs.value.map((config) => config?.transferFunction)\n    );\n    const opacityFunctions = computed(() =>\n      layersConfigs.value.map((config) => config?.opacityFunction)\n    );\n    const blendConfigs = computed(() =>\n      layersConfigs.value.map((config) => config?.blendConfig)\n    );\n\n    watch(\n      [layerReps, colorBys, transferFunctions, opacityFunctions, blendConfigs],\n      () => {\n        layerReps.value\n          .map(\n            (layerRep, idx) =>\n              [\n                layerRep,\n                colorBys.value[idx],\n                transferFunctions.value[idx],\n                opacityFunctions.value[idx],\n                blendConfigs.value[idx],\n              ] as const\n          )\n          .forEach(\n            ([\n              rep,\n              colorBy,\n              transferFunction,\n              opacityFunction,\n              blendConfig,\n            ]) => {\n              if (\n                !colorBy ||\n                !transferFunction ||\n                !opacityFunction ||\n                !blendConfig\n              ) {\n                return;\n              }\n\n              const { arrayName, location } = colorBy;\n              const ctFunc = transferFunction;\n              const opFunc = opacityFunction;\n\n              const lut = proxyManager.getLookupTable(arrayName);\n              lut.setMode(LookupTableProxyMode.Preset);\n              lut.setPresetName(ctFunc.preset);\n              lut.setDataRange(...ctFunc.mappingRange);\n\n              const pwf = proxyManager.getPiecewiseFunction(arrayName);\n              pwf.setMode(opFunc.mode);\n              pwf.setDataRange(...opFunc.mappingRange);\n\n              switch (opFunc.mode) {\n                case vtkPiecewiseFunctionProxy.Mode.Gaussians:\n                  pwf.setGaussians(opFunc.gaussians);\n                  break;\n                case vtkPiecewiseFunctionProxy.Mode.Points: {\n                  const opacityPoints = getShiftedOpacityFromPreset(\n                    opFunc.preset,\n                    opFunc.mappingRange,\n                    opFunc.shift\n                  );\n                  if (opacityPoints) {\n                    pwf.setPoints(opacityPoints);\n                  }\n                  break;\n                }\n                case vtkPiecewiseFunctionProxy.Mode.Nodes:\n                  pwf.setNodes(opFunc.nodes);\n                  break;\n                default:\n              }\n\n              // control color range manually\n              rep.setRescaleOnColorBy(false);\n              rep.setColorBy(arrayName, location);\n              rep.setOpacity(blendConfig.opacity);\n\n              // Need to trigger a render for when we are restoring from a state file\n              viewProxy.value.renderLater();\n            }\n          );\n      },\n      { immediate: true, deep: true }\n    );\n\n    return {\n      vtkContainerRef,\n      toolContainer,\n      viewID,\n      viewProxy,\n      viewAxis,\n      active: true,\n      currentSlice,\n      sliceMin,\n      sliceMax,\n      windowWidth,\n      windowLevel,\n      topLabel,\n      leftLabel,\n      isImageLoading,\n      setSlice,\n      widgetManager,\n      dicomInfo,\n      enableResizeToFit() {\n        resizeToFit.value = true;\n      },\n      hover,\n    };\n  },\n});\n</script>\n\n<style scoped src=\"@/src/components/styles/vtk-view.css\"></style>\n<style scoped src=\"@/src/components/styles/utils.css\"></style>\n<style scoped>\n.hover-info {\n  width: 32px;\n  height: 32px;\n  cursor: pointer;\n}\n</style>\n","<template>\n  <div class=\"viewers-tools-container\">\n    <VtkTwoView\n      key=\"sagitalv\"\n      id=\"Sagittal\"\n      viewDirection=\"Posterior\"\n      viewUp=\"Superior\"\n    />\n\n    <div class=\"tool-strip\">\n      <CheckContoursToolStrip />\n    </div>\n\n    <VtkTwoView\n      key=\"sagitalv\"\n      id=\"Coronal\"\n      viewDirection=\"Right\"\n      viewUp=\"Superior\"\n    />\n  </div>\n</template>\n\n<script>\n// import ScreenTemp from '../components/ScreenTemp.vue';\nimport CheckContoursToolStrip from './CheckContoursToolStrip.vue';\nimport VtkTwoView from './VtkTwoView.vue';\n\nexport default {\n  components: {\n    CheckContoursToolStrip,\n    VtkTwoView,\n  },\n};\n</script>\n\n<style scoped>\n.viewers-tools-container {\n  display: flex;\n  padding: 5px;\n  gap: 50px;\n  background: rgba(0, 0, 0, 0.1);\n  border-radius: 11px;\n  border: 1px solid #00ddff;\n}\n\n.tool-strip {\n  display: flex;\n  flex-direction: column;\n  align-content: center;\n  justify-content: space-between;\n  gap: 20px;\n  padding-top: 70px;\n  padding-bottom: 70px;\n  height: 750px;\n}\n\n@media (max-width: 1400px) {\n  .viewers-tools-container {\n    gap: 25px;\n  }\n}\n</style>\n","<template>\n  <div\n    v-on:dragover.prevent=\"onDragOver\"\n    v-on:dragleave=\"onDragLeave\"\n    v-on:drop.prevent=\"onDrop\"\n    v-bind=\"$attrs\"\n  >\n    <slot :dragHover=\"dragHover\" />\n  </div>\n</template>\n\n<script>\nasync function readAllDirEntries(dirEntry) {\n  const reader = dirEntry.createReader();\n  const allEntries = [];\n  let entries = [];\n  do {\n    // eslint-disable-next-line no-await-in-loop\n    entries = await new Promise((resolve, reject) => {\n      reader.readEntries(resolve, reject);\n    });\n    allEntries.push(...entries);\n  } while (entries.length);\n  return allEntries;\n}\n\nasync function entryToFile(fileEntry) {\n  return new Promise((resolve, reject) => {\n    fileEntry.file(resolve, reject);\n  });\n}\n\nasync function readAllFiles(entries) {\n  const toProcess = [...entries];\n  const fileEntries = [];\n  while (toProcess.length) {\n    const entry = toProcess.shift();\n    if (entry.isFile) {\n      fileEntries.push(entry);\n    } else {\n      // eslint-disable-next-line no-await-in-loop\n      toProcess.push(...(await readAllDirEntries(entry)));\n    }\n  }\n  return Promise.all(fileEntries.map(entryToFile));\n}\n\nexport default {\n  name: 'DragAndDrop',\n  props: {\n    enabled: Boolean,\n  },\n  data() {\n    return {\n      dragHover: false,\n    };\n  },\n  methods: {\n    onDragOver(ev) {\n      if (this.enabled) {\n        ev.preventDefault();\n\n        const { types } = ev.dataTransfer;\n        if (\n          types && types instanceof Array\n            ? types.indexOf('Files') !== -1\n            : 'Files' in types\n        ) {\n          this.dragHover = true;\n          if (this.dragTimeout !== null) {\n            window.clearTimeout(this.dragTimeout);\n            this.dragTimeout = null;\n          }\n        }\n      }\n    },\n    onDragLeave() {\n      if (this.enabled) {\n        this.dragTimeout = window.setTimeout(() => {\n          this.dragHover = false;\n          this.dragTimeout = null;\n        }, 50);\n      }\n    },\n    async onDrop(ev) {\n      if (this.enabled) {\n        this.dragHover = false;\n        if (ev.dataTransfer.items) {\n          const entries = [...ev.dataTransfer.items].map((item) => {\n            const getAsEntry = item.webkitGetAsEntry || item.getAsEntry;\n            return getAsEntry.call(item);\n          });\n          const files = await readAllFiles(entries);\n          this.$emit('drop-files', files);\n        } else {\n          this.$emit('drop-files', Array.from(ev.dataTransfer.files));\n        }\n      }\n    },\n  },\n  created() {\n    // used to debounce dragover\n    this.dragTimeout = null;\n  },\n};\n</script>\n","export function logError(error: unknown) {\n  let cur = error;\n  while (cur) {\n    if (cur !== error) {\n      console.error('The above error was caused by:', cur);\n    } else {\n      console.error(cur);\n    }\n\n    if (cur instanceof Error) {\n      cur = cur.cause;\n    } else {\n      cur = null;\n    }\n  }\n}\n","import { onBeforeUnmount, onMounted } from 'vue';\nimport { useMessageStore } from '../store/messages';\n\nexport function useGlobalErrorHook() {\n  const messageStore = useMessageStore();\n\n  const onError = (event: ErrorEvent) => {\n    messageStore.addError('Application error (click for details)', event.error);\n  };\n\n  onMounted(() => {\n    window.addEventListener('error', onError);\n  });\n\n  onBeforeUnmount(() => {\n    window.removeEventListener('error', onError);\n  });\n}\n","import type { vtkSubscription } from '@kitware/vtk.js/interfaces';\nimport { VtkProxy } from '@kitware/vtk.js/macros';\nimport { onBeforeUnmount } from 'vue';\nimport { withProxyManager } from './proxyManager';\n\nexport enum ProxyManagerEvent {\n  ProxyCreated,\n  ProxyModified,\n  ProxyDeleted,\n  ProxyRegistrationChange,\n}\n\nexport function onProxyManagerEvent(\n  event: ProxyManagerEvent,\n  cb: (proxyID: string, obj: VtkProxy | null) => void\n) {\n  const subs: vtkSubscription[] = [];\n\n  withProxyManager((proxyManager) => {\n    const proxySubs = Object.create(null);\n\n    subs.push(\n      proxyManager.onProxyRegistrationChange((info) => {\n        const { action, proxyId, proxy } = info;\n        if (action === 'register') {\n          if (event === ProxyManagerEvent.ProxyCreated) {\n            cb(proxyId, proxy);\n          }\n          if (event === ProxyManagerEvent.ProxyModified) {\n            proxySubs[proxyId] = proxy.onModified(() => cb(proxyId, proxy));\n          }\n        } else if (action === 'unregister') {\n          if (proxyId in proxySubs) {\n            proxySubs[proxyId].unsubscribe();\n            delete proxySubs[proxyId];\n          }\n          if (event === ProxyManagerEvent.ProxyDeleted) {\n            cb(proxyId, null);\n          }\n        }\n      })\n    );\n  });\n\n  onBeforeUnmount(() => {\n    while (subs.length) {\n      subs.pop()!.unsubscribe();\n    }\n  });\n}\n","import vtkViewProxy from '@kitware/vtk.js/Proxy/Core/ViewProxy';\nimport { useEventListener, useThrottleFn } from '@vueuse/core';\nimport { Messages } from '../constants';\nimport { useMessageStore } from '../store/messages';\nimport { onProxyManagerEvent, ProxyManagerEvent } from './onProxyManagerEvent';\n\nexport function useWebGLWatchdog() {\n  const watchdogs = new Map<string, () => void>();\n\n  const reportError = useThrottleFn(() => {\n    const messageStore = useMessageStore();\n    messageStore.addError(Messages.WebGLLost.title, Messages.WebGLLost.details);\n  }, 100);\n\n  onProxyManagerEvent(ProxyManagerEvent.ProxyCreated, (id, obj) => {\n    if (!obj || !obj.isA('vtkViewProxy')) return;\n    const view = obj as vtkViewProxy;\n    // TODO getCanvas() typing\n    const canvas = view\n      .getRenderWindow()\n      .getViews()[0]\n      .getCanvas() as HTMLCanvasElement;\n\n    const cleanup = useEventListener(canvas, 'webglcontextlost', reportError);\n    watchdogs.set(id, cleanup);\n  });\n\n  onProxyManagerEvent(ProxyManagerEvent.ProxyDeleted, (id) => {\n    if (watchdogs.has(id)) {\n      watchdogs.get(id)!();\n      watchdogs.delete(id);\n    }\n  });\n}\n","import { createToastInterface } from 'vue-toastification';\n\nconst toast = createToastInterface({\n  position: 'bottom-left',\n  timeout: 3000,\n  hideProgressBar: true,\n  maxToasts: 3,\n  transition: 'Vue-Toastification__fade',\n});\n\nexport const useToast = () => toast;\n","import { TYPE } from 'vue-toastification';\nimport { useToast } from '@/src/composables/useToast';\nimport { ToastID } from 'vue-toastification/dist/types/types';\nimport { useMessageStore } from '../store/messages';\n\nexport function useAppLoadingNotifications() {\n  const toast = useToast();\n  const messageStore = useMessageStore();\n\n  let loadingCount = 0;\n  let toastID: ToastID | null = null;\n  let error: Error | null = null;\n\n  const resetState = () => {\n    loadingCount = 0;\n    toastID = null;\n    error = null;\n  };\n\n  const _setError = (err: Error) => {\n    error = err;\n  };\n\n  const startLoading = () => {\n    loadingCount++;\n    if (toastID === null) {\n      toastID = toast.info('Loading datasets...', {\n        timeout: false,\n        closeButton: false,\n        closeOnClick: false,\n      });\n    }\n  };\n\n  const stopLoading = () => {\n    loadingCount--;\n    if (loadingCount === 0 && toastID !== null) {\n      if (error) {\n        toast.dismiss(toastID);\n        messageStore.addError('Some files failed to load', error);\n      } else {\n        toast.update(toastID, {\n          content: 'Datasets loaded!',\n          options: {\n            type: TYPE.SUCCESS,\n            timeout: 3000,\n            closeButton: 'button',\n            closeOnClick: true,\n          },\n        });\n      }\n      resetState();\n    }\n  };\n\n  /**\n   * Notifies of loading status until all function calls return.\n   * @param fn function to call\n   * @returns whatever fn returns.\n   */\n  const runAsLoading = async (fn: (setError: typeof _setError) => void) => {\n    startLoading();\n    try {\n      return await fn(_setError);\n    } finally {\n      stopLoading();\n    }\n  };\n\n  return {\n    runAsLoading,\n  };\n}\n","import { onKeyDown } from '@vueuse/core';\n\nimport { DECREMENT_LABEL_KEY, INCREMENT_LABEL_KEY } from '../config';\nimport { useToolStore } from '../store/tools';\nimport { Tools } from '../store/tools/types';\nimport { useRectangleStore } from '../store/tools/rectangles';\nimport { useRulerStore } from '../store/tools/rulers';\n\nconst applyLabelOffset = (offset: number) => {\n  const toolToStore = {\n    [Tools.Rectangle]: useRectangleStore(),\n    [Tools.Ruler]: useRulerStore(),\n  };\n  const toolStore = useToolStore();\n\n  // @ts-ignore - map may not have all keys of tools\n  const activeToolStore = toolToStore[toolStore.currentTool];\n  if (!activeToolStore) return;\n\n  const labels = Object.entries(activeToolStore.labels);\n  const activeLabelIndex = labels.findIndex(\n    ([name]) => name === activeToolStore.activeLabel\n  );\n\n  const [nextLabel] = labels.at((activeLabelIndex + offset) % labels.length)!;\n  activeToolStore.setActiveLabel(nextLabel);\n};\n\nexport function useKeyboardShortcuts() {\n  onKeyDown(DECREMENT_LABEL_KEY, () => applyLabelOffset(-1));\n  onKeyDown(INCREMENT_LABEL_KEY, () => applyLabelOffset(1));\n}\n","<script lang=\"ts\">\nimport { computed, defineComponent, Ref, ref, watch } from 'vue';\nimport { storeToRefs } from 'pinia';\nimport { useDisplay } from 'vuetify';\nimport { useDatasetStore } from '@/src/store/datasets';\nimport { logError } from '@/src/utils/loggers';\nimport {\n  importDataSources,\n  ImportDataSourcesResult,\n  convertSuccessResultToDataSelection,\n} from '@/src/io/import/importDataSources';\n\nimport {\n  DataSource,\n  fileToDataSource,\n  getDataSourceName,\n} from '../io/import/dataSource';\nimport { useImageStore } from '../store/datasets-images';\nimport { useViewStore } from '../store/views';\nimport { MessageType, useMessageStore } from '../store/messages';\nimport { Layouts } from '../config';\nimport { useGlobalErrorHook } from '../composables/useGlobalErrorHook';\nimport { useWebGLWatchdog } from '../composables/useWebGLWatchdog';\nimport { useAppLoadingNotifications } from '../composables/useAppLoadingNotifications';\nimport { partition } from '../utils';\nimport { useKeyboardShortcuts } from '../composables/useKeyboardShortcuts';\n\nasync function loadFiles(\n  sources: DataSource[],\n  setError: (err: Error) => void\n) {\n  const dataStore = useDatasetStore();\n\n  let results: ImportDataSourcesResult[];\n  try {\n    results = await importDataSources(sources);\n  } catch (error) {\n    setError(error as Error);\n    return;\n  }\n\n  const [succeeded, errored] = partition((result) => result.ok, results);\n\n  if (!dataStore.primarySelection && succeeded.length) {\n    const selection = convertSuccessResultToDataSelection(succeeded[0]);\n    if (selection) {\n      dataStore.setPrimarySelection(selection);\n    }\n  }\n\n  if (errored.length) {\n    const errorMessages = errored.map((errResult) => {\n      // pick first error\n      const [firstError] = errResult.errors;\n      // pick innermost dataset that errored\n      const name = getDataSourceName(firstError.inputDataStackTrace[0]);\n      // log error for debugging\n      logError(firstError.cause);\n      return `- ${name}: ${firstError.message}`;\n    });\n    const failedError = new Error(\n      `These files failed to load:\\n${errorMessages.join('\\n')}`\n    );\n\n    setError(failedError);\n  }\n}\n\nexport default defineComponent({\n  components: {},\n  setup() {\n    const imageStore = useImageStore();\n    const messageStore = useMessageStore();\n    const viewStore = useViewStore();\n\n    useGlobalErrorHook();\n    useWebGLWatchdog();\n    useKeyboardShortcuts();\n\n    const { runAsLoading } = useAppLoadingNotifications();\n\n    // --- layout --- //\n\n    const layoutName: Ref<string> = ref('Quad View');\n    const { layout: currentLayout } = storeToRefs(viewStore);\n\n    watch(\n      layoutName,\n      () => {\n        const layout = Layouts[layoutName.value] || [];\n        viewStore.setLayout(layout);\n      },\n      {\n        immediate: true,\n      }\n    );\n\n    watch(currentLayout, () => {\n      if (\n        currentLayout.value?.name &&\n        currentLayout.value.name !== layoutName.value\n      ) {\n        layoutName.value = currentLayout.value.name;\n      }\n    });\n\n    // --- file handling --- //\n\n    async function openFiles(files: FileList | null) {\n      if (!files) {\n        return;\n      }\n\n      const dataSources = Array.from(files).map(fileToDataSource);\n      runAsLoading((setError) => loadFiles(dataSources, setError));\n    }\n\n    const fileEl = document.createElement('input');\n    fileEl.setAttribute('type', 'file');\n    fileEl.setAttribute('multiple', 'multiple');\n    fileEl.setAttribute('accept', '*');\n    fileEl.addEventListener('change', () => openFiles(fileEl.files));\n\n    function userPromptFiles() {\n      fileEl.value = '';\n      fileEl.click();\n    }\n\n    // --- template vars --- //\n\n    const hasData = computed(() => imageStore.idList.length > 0);\n    const messageCount = computed(() => messageStore.importantMessages.length);\n    const messageBadgeColor = computed(() => {\n      if (\n        messageStore.importantMessages.find(\n          (msg) => msg.type === MessageType.Error\n        )\n      ) {\n        return 'error';\n      }\n      if (\n        messageStore.importantMessages.find(\n          (msg) => msg.type === MessageType.Warning\n        )\n      ) {\n        return 'warning';\n      }\n      return 'primary';\n    });\n\n    const saveDialog = ref(false);\n\n    const saveHappening = ref(false);\n\n    const display = useDisplay();\n\n    // const errorReportingStore = useErrorReporting();\n    // const showErrorReporting = computed(() => {\n    //   return errorReportingConfigured && !errorReportingStore.disableReporting;\n    // });\n\n    return {\n      aboutBoxDialog: ref(false),\n      messageDialog: ref(false),\n      settingsDialog: ref(false),\n      saveDialog,\n      saveHappening,\n      leftSideBar: ref(!display.mobile.value),\n      mobile: display.mobile,\n      messageCount,\n      messageBadgeColor,\n      layoutName,\n      currentLayout,\n      Layouts,\n      userPromptFiles,\n      openFiles,\n      hasData,\n    };\n  },\n});\n</script>\n","<!-- \n    BUTTON TO ADD A NEW PATIENT. \n    WHEN BUTTON IS CLICKED AN OVERLAY SHOWS WITH OPTIONS FOR ADDING PATIENT DATA.\n    OVERLAY ALLOWS USER TO CLICK AND UPLOAD FILE OR DRAG AND DROP FILE TO UPLOAD.\n    COMPONENT PART OF © AREA 19, OCG WEB APP.\n    DEVELOPPED IN MONTREAL, QC, CANADA.\n    JULY 2023.\n  -->\n\n<template>\n  <HandleUpload ref=\"handleUpload\" />\n\n  <div style=\"position: relative\">\n    <button @click=\"openOverlay\">\n      <!-- The button triggers the 'openOverlay' method when clicked to toggle showOverlay. -->\n      Add New Patient\n      <i class=\"fa-solid fa-user-plus\" style=\"color: #ffffff\"></i>\n      <!-- The button text and an icon for adding a new patient. -->\n    </button>\n    <drag-and-drop enabled @drop-files=\"openFiles\" id=\"app-container\">\n      <div\n        class=\"overlay\"\n        :class=\"{ show: showOverlay }\"\n        @dragover=\"handleDragOver\"\n      >\n        <!-- \n      The overlay is shown only when 'showOverlay' property is true. \n    -->\n\n        <!-- Only show text and icons after overlay has been fully shown. -->\n        <div class=\"add-patient-header\" :class=\"{ visible: showTextOverlay }\">\n          <i\n            @click=\"openOverlay\"\n            @keydown.space.prevent=\"handleKeyDown\"\n            class=\"fa-solid fa-xmark fa-xl\"\n            style=\"color: #ffffff\"\n          ></i>\n          <!-- \n        The close icon allows users to close the overlay by calling 'openOverlay'\n        method when clicked. \n      -->\n        </div>\n\n        <div\n          @click=\"openFileDialog\"\n          @dragenter=\"handleDragEnter\"\n          @dragleave=\"handleDragLeave\"\n          @drop=\"handleDrop\"\n          @keydown.space.prevent=\"handleKeyDown\"\n          class=\"load-files\"\n          :class=\"{ visible: showTextOverlay }\"\n        >\n          <!-- \n        The 'load-files' section allows users to load files to add a new study.\n        It triggers the 'openFileDialog' method when clicked.\n      -->\n\n          <input\n            type=\"file\"\n            ref=\"fileInput\"\n            style=\"display: none\"\n            @change=\"handleFileChange\"\n            aria-labelledby=\"fileInput\"\n          />\n\n          <!-- \n        The hidden file input element allows users to select files from their device,\n        which will trigger the 'handleFileChange' method when files are selected.\n      -->\n          <i class=\"fa-solid fa-file-import fa-2xl\" style=\"color: #ffffff\"></i>\n          <!-- An icon representing the file import functionality. -->\n          <br />\n          <h2>{{ loadFileText }}</h2>\n          <!-- Heading for the 'Load Files' section. -->\n          <h4>{{ browseTextFile }}</h4>\n          <!-- Description for the 'Load Files' section. -->\n        </div>\n      </div>\n    </drag-and-drop>\n  </div>\n  <div style=\"display: none\">\n    <CheckContours />\n  </div>\n</template>\n\n<script>\nimport { useDatasetStore } from '@/src/store/datasets';\nimport { useDICOMStore } from '@/src/store/datasets-dicom';\nimport {\n  importDataSources,\n  convertSuccessResultToDataSelection,\n} from '@/src/io/import/importDataSources';\nimport CheckContours from './CheckContours.vue';\nimport DragAndDrop from './DragAndDrop.vue';\nimport HandleUpload from './HandleUpload.vue';\n\nimport { fileToDataSource } from '../io/import/dataSource';\nimport { partition } from '../utils';\n\nexport default {\n  components: {\n    DragAndDrop,\n    HandleUpload,\n    CheckContours,\n  },\n\n  data() {\n    /**\n     * Data properties of the component.\n     * @returns {Object} An object containing the component's data properties.\n     */\n    return {\n      showOverlay: false, // A flag to control the visibility of the overlay.\n      showTextOverlay: false, // A flag to control the visibility of the text inside the overlay.\n      isDraggingOver: false,\n      loadFileText: 'Load Files',\n      browseTextFile: 'Browse your data to automatically add a new study.',\n      dataStore: useDatasetStore(),\n      currentPatientStoreID: null,\n    };\n  },\n  methods: {\n    /**\n     * Toggles the overlay and sets a timeout to show the text overlay after a delay if the overlay is shown.\n     */\n    async openFiles(file) {\n      const dataSources = Array.from(file).map(fileToDataSource);\n      this.loadFiles(dataSources);\n    },\n\n    async loadFiles(sources) {\n      const results = await importDataSources(sources);\n\n      this.currentPatientStoreID = results[0].data[0].dataID;\n      const partitionResult = partition((result) => result.ok, results);\n      const succeeded = partitionResult[0];\n\n      if (!this.dataStore.primarySelection && succeeded.length) {\n        const selection = convertSuccessResultToDataSelection(succeeded[0]);\n        if (selection) {\n          this.dataStore.setPrimarySelection(selection);\n        }\n      }\n\n      const dicomStore = useDICOMStore();\n      const volumeKey = this.currentPatientStoreID;\n      const volumeInfo = dicomStore.volumeInfo[volumeKey];\n      const studyKey = dicomStore.volumeStudy[volumeKey];\n      const studyInfo = dicomStore.studyInfo[studyKey];\n      const patientKey = dicomStore.studyPatient[studyKey];\n      const patientInfo = dicomStore.patientInfo[patientKey];\n      // console.log('key Here');\n      // console.log(volumeKey);\n      // console.log(volumeInfo);\n      // console.log(studyInfo);\n      // console.log(patientInfo);\n      // console.log(patientInfo.PatientName);\n\n      const patient = {\n        id: 1,\n        name: patientInfo.PatientID,\n        lastname: patientInfo.PatientName,\n        dob: patientInfo.PatientBirthDate,\n        gender: patientInfo.PatientSex,\n        scandate: studyInfo.StudyDate,\n        scanlocation: volumeInfo.SeriesDescription,\n      };\n\n      this.$emit('new-patient', patient);\n\n      this.openOverlay();\n    },\n\n    handleKeyDown(event) {\n      if (event.key === ' ') {\n        this.showOverlay();\n      }\n    },\n    openOverlay() {\n      if (this.showOverlay) {\n        this.showTextOverlay = false;\n      }\n      this.showOverlay = !this.showOverlay;\n      if (this.showOverlay) {\n        /**\n         * Set a timeout to show the text overlay after a delay when the overlay is shown.\n         * This creates a smooth transition effect.\n         */\n        setTimeout(() => {\n          this.showTextOverlay = true;\n        }, 200);\n      }\n    },\n\n    /**\n     * Opens the file dialog by programmatically clicking the hidden file input element.\n     * Triggered when the user wants to select a file from their device.\n     */\n    openFileDialog() {\n      this.$refs.fileInput.click();\n    },\n\n    /**\n     * Handles the change event when a file is selected through the file input element.\n     * @param {Event} event - The event object representing the file change event.\n     */\n    handleFileChange(event) {\n      const selectedFile = event.target.files[0];\n      this.openFiles(selectedFile);\n      // Handle the selected file as needed\n      // console.log('Selected File:', selectedFile);\n    },\n    /**\n     * Handles the dragenter event when a file is dragged over the overlay.\n     * @param {Event} event - The event object representing the dragenter event.\n     */\n    handleDragEnter(event) {\n      event.preventDefault();\n      this.isDraggingOver = true;\n    },\n\n    /**\n     * Handles the dragover event when a file is being dragged over the overlay.\n     * @param {Event} event - The event object representing the dragover event.\n     */\n    handleDragOver(event) {\n      event.preventDefault();\n      this.isDraggingOver = true;\n      this.loadFileText = 'Drop File to Upload';\n    },\n\n    /**\n     * Handles the dragleave event when a file is dragged out of the overlay.\n     * @param {Event} event - The event object representing the dragleave event.\n     */\n    handleDragLeave(event) {\n      event.preventDefault();\n      this.isDraggingOver = false;\n      this.loadFileText = 'Load Files';\n    },\n\n    /**\n     * Handles the drop event when a file is dropped onto the overlay.\n     * @param {Event} event - The event object representing the drop event.\n     */\n    handleDrop(event) {\n      event.preventDefault();\n      this.isDraggingOver = false;\n      this.loadFileText = 'Load Files';\n\n      let files;\n      if (event.dataTransfer) {\n        // Attempt to access the files from the dataTransfer property directly.\n        files = event.dataTransfer.files;\n      } else if (event.target && event.target.files) {\n        // If direct access doesn't work, try to access files from the event target.\n        files = event.target.files;\n      }\n\n      console.log(files);\n    },\n  },\n};\n</script>\n\n<style scoped>\n/* Default button styles */\nbutton {\n  background: #000000f5;\n  padding: 10px;\n  border-radius: 24px;\n  width: 230px;\n  min-width: 180px;\n  height: 48px;\n  align-self: center;\n  position: relative;\n  /* Making sure the button stays on top of the overlay:*/\n  z-index: 99999;\n  backdrop-filter: blur(30px);\n  -webkit-backdrop-filter: blur(30px);\n}\n\n/* Button styles on hover */\nbutton:hover {\n  background: rgba(0, 0, 0, 0.65);\n}\n\n/* Margin for the icon */\ni {\n  margin-left: 10px;\n}\n\n/* Initial styles when the overlay is hidden */\n.overlay {\n  position: absolute;\n  top: 0;\n  width: 0;\n  height: 0;\n  padding: 0;\n  background-color: rgba(0, 0, 0, 0);\n  border-radius: 15px;\n  overflow: hidden;\n  transition: width 0.3s, height 0.3s, padding 0.3s, background-color 0.3s;\n}\n\n/* Styles when the overlay is shown (expanded) */\n.overlay.show {\n  width: 50vw;\n  height: 65vh;\n\n  background-color: rgba(0, 0, 0, 0.849);\n}\n\n.add-patient-header {\n  display: flex;\n  height: 55px;\n  justify-content: flex-end;\n  align-items: center;\n  padding: 20px;\n}\n\n.add-patient-header i {\n  cursor: pointer;\n}\n\n.load-files {\n  display: flex;\n  flex-direction: column;\n  gap: 5px;\n  height: 80%;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n}\n\n/* Animate the appearance */\n.add-patient-header,\n.load-files {\n  opacity: 0; /* Initial opacity when hidden */\n  transition: opacity 0.2s ease;\n}\n\n.add-patient-header.visible,\n.load-files.visible {\n  opacity: 1; /* Opacity when shown */\n}\n\n/* Responsive styles */\n@media screen and (max-width: 767px) {\n  /* Adjust the button size for smaller screens */\n  button {\n    min-width: 140px;\n    height: 40px;\n    font-size: 12px;\n  }\n\n  /* Adjust the overlay size for smaller screens */\n  .overlay.show {\n    padding: 5px;\n    text-align: center;\n  }\n\n  /* Adjust alignment for smaller screens */\n  .add-patient-header {\n    justify-content: flex-start;\n  }\n\n  /* Adjust font size for smaller screens */\n  .load-files {\n    font-size: 12px;\n  }\n}\n</style>\n","<!-- \n    SEARCH BAR COMPONENT USED TO FIND PATIENTS GIVEN AN INPUT. \n    CURRENTLY SIMPLY EMITS ITS INPUT TO PARENT.\n    COMPONENT PART OF © AREA 19, OCG WEB APP.\n    DEVELOPPED IN MONTREAL, QC, CANADA.\n    JULY 2023.\n  -->\n\n<template>\n  <div class=\"searchbar\">\n    <!--\n    The 'input' element is used to capture the user's search input.\n    The 'v-model' directive binds the input value to the 'searchTerm' data property, enabling two-way data binding.\n    When the user types in the input field, the 'searchTerm' data property is automatically updated.\n    -->\n    <input\n      type=\"text\"\n      v-model=\"searchTerm\"\n      @input=\"handleInput\"\n      placeholder=\"Find Patient...\"\n      aria-labelledby=\"findPatientSearchBox\"\n    />\n  </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      searchTerm: '',\n    };\n  },\n  methods: {\n    handleInput() {\n      // Emit the search term to the parent component\n      this.$emit('search-term-updated', this.searchTerm);\n    },\n    handleSearch() {\n      // Emit the search term to the parent component when the search button is clicked\n      this.$emit('search-term-updated', this.searchTerm);\n    },\n  },\n};\n</script>\n\n<style scoped>\n.searchbar {\n  background: #000000f5;\n  border-radius: 15px;\n  width: 30vw;\n  height: 48px;\n  display: flex;\n  border-radius: 24px;\n  align-self: center;\n  min-width: 150px;\n}\n\ninput {\n  border: none;\n  outline: none;\n  width: 100%;\n  padding-left: 70px;\n}\n\n/* For screens between 768px and 1023px */\n@media screen and (max-width: 768px) {\n  .searchbar {\n    /* Adjust the width for medium-sized screens */\n    width: 100%;\n    max-width: 500px;\n    height: 40px;\n  }\n  input {\n    padding-left: 10px;\n    font-size: 12px;\n  }\n}\n</style>\n","<!-- \n    BUTTON TO LOG USER OUT, RESETS LOCALSTORAGE AND ROUTS USER TO /LOGIN\n    COMPONENT PART OF © AREA 19, OCG WEB APP.\n    DEVELOPPED IN MONTREAL, QC, CANADA.\n    JULY 2023.\n  -->\n<template>\n  <!-- Uses Vue Router's 'router-link' to navigate to the \"/login\" route when clicked. -->\n  <router-link to=\"/login\" style=\"text-decoration: none\">\n    <!-- The button element represents the clickable logout button. It triggers the 'logOutUser' method when clicked. -->\n    <button @click=\"logOutUser\">\n      Log Out\n      <!-- Text inside the button indicating that clicking it will log the user out. -->\n      <i\n        class=\"fa-solid fa-arrow-right-from-bracket\"\n        style=\"color: #ffffff\"\n      ></i>\n      <!-- The <i> element represents an icon (arrow pointing right) displayed next to the \"Log Out\" text inside the button. It's styled to have white color. -->\n    </button>\n  </router-link>\n</template>\n\n<script>\nexport default {\n  methods: {\n    logOutUser() {\n      // Logs user out and clears localstorage.\n      window.localStorage.setItem('userLoggedIn', 'GUEST USER');\n      window.localStorage.clear();\n    },\n  },\n};\n</script>\n\n<style scoped>\n/* Styles for the 'button' element */\nbutton {\n  /* Semi-transparent black background */\n  background: rgba(0, 0, 0, 0.75);\n\n  /* Padding around the button content */\n  padding: 10px;\n\n  /* Rounded corners */\n  border-radius: 24px;\n\n  /* Fixed width and height */\n  width: 130px;\n  height: 48px;\n\n  /* Center the button along the container's cross-axis (vertically) */\n  align-self: center;\n\n  /* Set the text color to white */\n  color: white;\n}\n\n/* Hover effect for the 'button' element */\nbutton:hover {\n  /* Slightly darker background on hover */\n  background: rgba(0, 0, 0, 0.65);\n}\n\n/* Styles for the 'i' element (assuming it represents an icon) */\ni {\n  /* Add space between the icon and the text */\n  margin-left: 10px;\n}\n\n@media screen and (max-width: 768px) {\n  /* For screens with a width of 480 pixels or less */\n  button {\n    /* Further adjust the width and height for smaller screens */\n    width: 90px;\n    height: 40px;\n    /* Decrease the font size for better fit */\n    font-size: 12px;\n    /* Reduce the icon's left margin to save space */\n    margin-left: 5px;\n  }\n}\n</style>\n","<!-- \n  HOME VIEW FOR © AREA 19, OCG WEB APP.\n  DEVELOPPED IN MONTREAL, QC, CANADA.\n  JULY 2023.\n -->\n\n<template>\n  <!-- This is the main template for the component -->\n  <div :class=\"container\">\n    <!-- The main container div with dynamic class binding for background image loading -->\n\n    <div class=\"home\">\n      <!-- The home section of the component -->\n\n      <HomeGreetings :username=\"username\" />\n      <!-- A component to greet the user with their username.\n         Component takes username as a prop -->\n\n      <br />\n      <!-- Line break for spacing -->\n\n      <div class=\"user-bar\">\n        <!-- Container for patient-related components -->\n\n        <AddPatient @new-patient=\"handleNewPatient\" />\n        <!-- A component that handles adding new patients -->\n\n        <FindPatient @search-term-updated=\"updatefilter\" />\n        <!-- A component to find a patient, emitting 'search-term-updated' event -->\n\n        <LogOut style=\"margin-left: auto; align-self: center\" />\n        <!-- A component to log the user out, with custom styling -->\n      </div>\n      <!-- End of user-bar section -->\n\n      <PatientContainer :patients=\"patients\" />\n\n      <!-- A container to display patient list along with patient information -->\n      <h5 style=\"color: grey; margin-left: 90%\">Area 19 OCG Prototype V.0.1</h5>\n    </div>\n\n    <!-- End of home section -->\n  </div>\n  <!-- End of main container div -->\n</template>\n\n<script>\nimport HomeGreetings from '../components/HomeGreetings.vue';\nimport PatientContainer from '../components/PatientContainer.vue';\n// import store from '/src/store/index.js';\nimport AddPatient from '../components/AddPatient.vue';\nimport FindPatient from '../components/FindPatient.vue';\nimport LogOut from '../components/LogOut.vue';\n\nexport default {\n  data() {\n    return {\n      username: 'GUEST USER',\n      filter: '',\n      container: 'container',\n      patients: [\n        {\n          id: 111,\n          name: 'SAMPLE',\n          lastname: 'SAMPLE',\n          dob: '01/02/1982',\n          breathingrate: '60',\n          age: '32',\n          weight: 65,\n          height: 175,\n          gender: 'Male',\n          scandate: '01/02/2023',\n          scanlocation: 'Area 19 Office',\n        },\n      ],\n    };\n  },\n  components: {\n    HomeGreetings,\n    PatientContainer,\n    AddPatient,\n    FindPatient,\n    LogOut,\n  },\n  mounted() {\n    this.username = window.localStorage.getItem('userLoggedIn');\n    window.localStorage.setItem('currentView', 'QualityCheck');\n  },\n  methods: {\n    updatefilter() {\n      // store.state.searchFilter = infilter;\n    },\n    getTimeOfDay() {\n      const currentHour = new Date().getHours();\n\n      if (currentHour >= 5 && currentHour < 12) {\n        return 'Morning';\n      }\n      if (currentHour >= 12 && currentHour < 18) {\n        return 'Afternoon';\n      }\n      if (currentHour >= 18 && currentHour < 23) {\n        return 'Evening';\n      }\n      return 'Day';\n    },\n    handleNewPatient(patient) {\n      this.patients.push(patient);\n    },\n  },\n  created() {\n    this.timeofday = this.getTimeOfDay();\n    this.container = `${this.container} ${this.timeofday.toLowerCase()}`;\n  },\n};\n</script>\n\n<style scoped>\n.home {\n  padding: 50px;\n  background: rgba(0, 0, 0, 0.2);\n  backdrop-filter: brightness(40%) blur(30px);\n  -webkit-backdrop-filter: brightness(40%) blur(30px);\n  width: 100%;\n  height: 100vh;\n}\n\n/* Styles for the .user-bar element */\n.user-bar {\n  /* Set a fixed height for the user bar */\n  height: 65px;\n\n  /* Use flexbox to horizontally center its child elements */\n  display: flex;\n  align-items: center;\n\n  /* Set the width to 90% of its container */\n  width: 90%;\n\n  /* Center the user bar within its container */\n  margin-left: auto;\n  margin-right: auto;\n\n  /* Add a gap of 20px between its child elements */\n  gap: 20px;\n}\n\n.container {\n  /* From https://css.glass */\n  background-repeat: space;\n  background-size: cover;\n  padding: none;\n}\n\n.afternoon {\n  background-image: url('/images/afternoon.jpg');\n}\n\n.morning {\n  background-image: url('/images/morning.jpg');\n}\n\n.evening {\n  background-image: url('/images/night.jpg');\n}\n\n.day {\n  background-image: url('/images/day.jpg');\n}\n\n/* Responsive styles for different screen sizes */\n@media screen and (max-width: 767px) {\n  /* For screens with a width of 767 pixels or less */\n  .user-bar {\n    /* Reduce the height for smaller screens */\n    height: 50px;\n\n    /* Decrease the gap between its child elements for better fit */\n    gap: 10px;\n\n    /* Modify other styles as needed for smaller screens */\n  }\n}\n\n@media screen and (max-width: 480px) {\n  /* For screens with a width of 480 pixels or less */\n  .user-bar {\n    /* Further adjust the height for even smaller screens */\n    height: 40px;\n\n    /* Decrease the gap between its child elements for better fit */\n    gap: 5px;\n\n    /* Modify other styles as needed for even smaller screens */\n  }\n}\n</style>\n","<template>\n  <item-group\n    mandatory\n    :model-value=\"currentTool\"\n    @update:model-value=\"setCurrentTool($event)\"\n  >\n    <div class=\"my-1 tool-separator\" />\n    <groupable-item\n      v-slot:default=\"{ active, toggle }\"\n      :value=\"Tools.WindowLevel\"\n    >\n      <tool-button\n        icon=\"mdi-circle-half-full\"\n        name=\"Window & Level\"\n        :buttonClass=\"['tool-btn', active ? 'tool-btn-selected' : '']\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      />\n    </groupable-item>\n    <groupable-item v-slot:default=\"{ active, toggle }\" :value=\"Tools.Pan\">\n      <tool-button\n        icon=\"mdi-cursor-move\"\n        name=\"Pan\"\n        :buttonClass=\"['tool-btn', active ? 'tool-btn-selected' : '']\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      />\n    </groupable-item>\n    <groupable-item v-slot:default=\"{ active, toggle }\" :value=\"Tools.Zoom\">\n      <tool-button\n        icon=\"mdi-magnify-plus-outline\"\n        name=\"Zoom\"\n        :buttonClass=\"['tool-btn', active ? 'tool-btn-selected' : '']\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      />\n    </groupable-item>\n    <groupable-item\n      v-slot:default=\"{ active, toggle }\"\n      :value=\"Tools.Crosshairs\"\n    >\n      <tool-button\n        icon=\"mdi-crosshairs\"\n        name=\"Crosshairs\"\n        :buttonClass=\"['tool-btn', active ? 'tool-btn-selected' : '']\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      />\n    </groupable-item>\n    <div class=\"my-1 tool-separator\" />\n    <groupable-item v-slot:default=\"{ active, toggle }\" :value=\"Tools.Paint\">\n      <menu-tool-button\n        icon=\"mdi-brush\"\n        name=\"Paint\"\n        :active=\"active\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      >\n        <paint-controls />\n      </menu-tool-button>\n    </groupable-item>\n    <groupable-item\n      v-slot:default=\"{ active, toggle }\"\n      :value=\"Tools.Rectangle\"\n    >\n      <menu-tool-button\n        icon=\"mdi-vector-square\"\n        name=\"Rectangle\"\n        :mobileOnlyMenu=\"true\"\n        :active=\"active\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      >\n        <rectangle-controls />\n      </menu-tool-button>\n    </groupable-item>\n    <groupable-item v-slot:default=\"{ active, toggle }\" :value=\"Tools.Ruler\">\n      <menu-tool-button\n        icon=\"mdi-ruler\"\n        name=\"Ruler\"\n        :mobileOnlyMenu=\"true\"\n        :active=\"active\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      >\n        <ruler-controls />\n      </menu-tool-button>\n    </groupable-item>\n    <groupable-item v-slot:default=\"{ active, toggle }\" :value=\"Tools.Contour\">\n      <menu-tool-button\n        icon=\"mdi-shape-circle-plus\"\n        name=\"Contour\"\n        mobile-only-menu\n        :active=\"active\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      >\n        <contour-controls />\n      </menu-tool-button>\n    </groupable-item>\n    <div class=\"my-1 tool-separator\" />\n    <groupable-item v-slot:default=\"{ active, toggle }\" :value=\"Tools.Crop\">\n      <menu-tool-button\n        icon=\"mdi-crop\"\n        name=\"Crop\"\n        :active=\"active\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      >\n        <crop-controls />\n      </menu-tool-button>\n    </groupable-item>\n  </item-group>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, ref } from 'vue';\nimport { onKeyDown } from '@vueuse/core';\nimport { Tools } from '@/src/store/tools/types';\nimport ToolButton from './ToolButton.vue';\nimport ItemGroup from './ItemGroup.vue';\nimport GroupableItem from './GroupableItem.vue';\nimport { useDatasetStore } from '../store/datasets';\nimport { useToolStore } from '../store/tools';\nimport PaintControls from './PaintControls.vue';\nimport MenuToolButton from './MenuToolButton.vue';\nimport CropControls from './tools/crop/CropControls.vue';\nimport { useRectangleStore } from '../store/tools/rectangles';\nimport { useRulerStore } from '../store/tools/rulers';\nimport RulerControls from './RulerControls.vue';\nimport RectangleControls from './RectangleControls.vue';\nimport ContourControls from './tools/contour/ContourControls.vue';\n\nexport default defineComponent({\n  components: {\n    ToolButton,\n    MenuToolButton,\n    ItemGroup,\n    GroupableItem,\n    PaintControls,\n    CropControls,\n    RulerControls,\n    RectangleControls,\n    ContourControls,\n  },\n  setup() {\n    const dataStore = useDatasetStore();\n    const toolStore = useToolStore();\n\n    const noCurrentImage = computed(() => !dataStore.primaryDataset);\n    const currentTool = computed(() => toolStore.currentTool);\n\n    const rectangleStore = useRectangleStore();\n    const rulerStore = useRulerStore();\n\n    const paintMenu = ref(false);\n    const cropMenu = ref(false);\n\n    onKeyDown('Escape', () => {\n      paintMenu.value = false;\n      cropMenu.value = false;\n    });\n\n    return {\n      currentTool,\n      setCurrentTool: toolStore.setCurrentTool,\n      noCurrentImage,\n      Tools,\n      paintMenu,\n      cropMenu,\n      rectangleStore,\n      rulerStore,\n    };\n  },\n});\n</script>\n\n<style>\n.tool-btn-selected {\n  background-color: rgb(var(--v-theme-selection-bg-color));\n}\n</style>\n\n<style scoped>\n.menu-more {\n  position: absolute;\n  right: -10%;\n}\n\n.tool-separator {\n  width: 75%;\n  height: 1px;\n  border: none;\n  border-top: 1px solid rgb(112, 112, 112);\n}\n\n.popup-menu {\n  max-width: 400px; /* a little less than v-navigation-drawer in App.vue */\n}\n</style>\n","<template>\n  <item-group\n    mandatory\n    :model-value=\"currentTool\"\n    @update:model-value=\"setCurrentTool($event)\"\n  >\n    <div class=\"my-1 tool-separator\" />\n    <groupable-item\n      v-slot:default=\"{ active, toggle }\"\n      :value=\"Tools.WindowLevel\"\n    >\n      <tool-button\n        icon=\"mdi-circle-half-full\"\n        name=\"Window & Level\"\n        :buttonClass=\"['tool-btn', active ? 'tool-btn-selected' : '']\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      />\n    </groupable-item>\n    <groupable-item v-slot:default=\"{ active, toggle }\" :value=\"Tools.Pan\">\n      <tool-button\n        icon=\"mdi-cursor-move\"\n        name=\"Pan\"\n        :buttonClass=\"['tool-btn', active ? 'tool-btn-selected' : '']\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      />\n    </groupable-item>\n    <groupable-item v-slot:default=\"{ active, toggle }\" :value=\"Tools.Zoom\">\n      <tool-button\n        icon=\"mdi-magnify-plus-outline\"\n        name=\"Zoom\"\n        :buttonClass=\"['tool-btn', active ? 'tool-btn-selected' : '']\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      />\n    </groupable-item>\n    <groupable-item\n      v-slot:default=\"{ active, toggle }\"\n      :value=\"Tools.Crosshairs\"\n    >\n      <tool-button\n        icon=\"mdi-crosshairs\"\n        name=\"Crosshairs\"\n        :buttonClass=\"['tool-btn', active ? 'tool-btn-selected' : '']\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      />\n    </groupable-item>\n    <div class=\"my-1 tool-separator\" />\n    <groupable-item v-slot:default=\"{ active, toggle }\" :value=\"Tools.Paint\">\n      <menu-tool-button\n        icon=\"mdi-brush\"\n        name=\"Paint\"\n        :active=\"active\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      >\n        <paint-controls />\n      </menu-tool-button>\n    </groupable-item>\n    <groupable-item\n      v-slot:default=\"{ active, toggle }\"\n      :value=\"Tools.Rectangle\"\n    >\n      <menu-tool-button\n        icon=\"mdi-vector-square\"\n        name=\"Rectangle\"\n        :mobileOnlyMenu=\"true\"\n        :active=\"active\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      >\n        <rectangle-controls />\n      </menu-tool-button>\n    </groupable-item>\n    <groupable-item v-slot:default=\"{ active, toggle }\" :value=\"Tools.Ruler\">\n      <menu-tool-button\n        icon=\"mdi-ruler\"\n        name=\"Ruler\"\n        :mobileOnlyMenu=\"true\"\n        :active=\"active\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      >\n        <ruler-controls />\n      </menu-tool-button>\n    </groupable-item>\n    <groupable-item v-slot:default=\"{ active, toggle }\" :value=\"Tools.Contour\">\n      <menu-tool-button\n        icon=\"mdi-shape-circle-plus\"\n        name=\"Contour\"\n        mobile-only-menu\n        :active=\"active\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      >\n        <contour-controls />\n      </menu-tool-button>\n    </groupable-item>\n    <div class=\"my-1 tool-separator\" />\n    <groupable-item v-slot:default=\"{ active, toggle }\" :value=\"Tools.Crop\">\n      <menu-tool-button\n        icon=\"mdi-crop\"\n        name=\"Crop\"\n        :active=\"active\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      >\n        <crop-controls />\n      </menu-tool-button>\n    </groupable-item>\n  </item-group>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, ref } from 'vue';\nimport { onKeyDown } from '@vueuse/core';\nimport { Tools } from '@/src/store/tools/types';\nimport ToolButton from './ToolButton.vue';\nimport ItemGroup from './ItemGroup.vue';\nimport GroupableItem from './GroupableItem.vue';\nimport { useDatasetStore } from '../store/datasets';\nimport { useToolStore } from '../store/tools';\nimport PaintControls from './PaintControls.vue';\nimport MenuToolButton from './MenuToolButton.vue';\nimport CropControls from './tools/crop/CropControls.vue';\nimport { useRectangleStore } from '../store/tools/rectangles';\nimport { useRulerStore } from '../store/tools/rulers';\nimport RulerControls from './RulerControls.vue';\nimport RectangleControls from './RectangleControls.vue';\nimport ContourControls from './tools/contour/ContourControls.vue';\n\nexport default defineComponent({\n  components: {\n    ToolButton,\n    MenuToolButton,\n    ItemGroup,\n    GroupableItem,\n    PaintControls,\n    CropControls,\n    RulerControls,\n    RectangleControls,\n    ContourControls,\n  },\n  setup() {\n    const dataStore = useDatasetStore();\n    const toolStore = useToolStore();\n\n    const noCurrentImage = computed(() => !dataStore.primaryDataset);\n    const currentTool = computed(() => toolStore.currentTool);\n\n    const rectangleStore = useRectangleStore();\n    const rulerStore = useRulerStore();\n\n    const paintMenu = ref(false);\n    const cropMenu = ref(false);\n\n    onKeyDown('Escape', () => {\n      paintMenu.value = false;\n      cropMenu.value = false;\n    });\n\n    return {\n      currentTool,\n      setCurrentTool: toolStore.setCurrentTool,\n      noCurrentImage,\n      Tools,\n      paintMenu,\n      cropMenu,\n      rectangleStore,\n      rulerStore,\n    };\n  },\n});\n</script>\n\n<style>\n.tool-btn-selected {\n  background-color: rgb(var(--v-theme-selection-bg-color));\n}\n</style>\n\n<style scoped>\n.menu-more {\n  position: absolute;\n  right: -10%;\n}\n\n.tool-separator {\n  width: 75%;\n  height: 1px;\n  border: none;\n  border-top: 1px solid rgb(112, 112, 112);\n}\n\n.popup-menu {\n  max-width: 400px; /* a little less than v-navigation-drawer in App.vue */\n}\n</style>\n","<template>\r\n  <div class=\"circleIcon\">\r\n    {{ number }}\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  props: {\r\n    number: {\r\n      type: Number,\r\n      default: 1,\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.circleIcon {\r\n  width: 26px;\r\n  height: 26px;\r\n  border-radius: 50%;\r\n  background-color: white;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-content: center;\r\n  font-weight: bold;\r\n  box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.2);\r\n  color: black;\r\n  font-size: 18px;\r\n  text-align: center;\r\n}\r\n\r\n/* Media query for large laptops */\r\n@media (max-width: 1450px) {\r\n  .circleIcon {\r\n    width: 20px;\r\n    height: 20px;\r\n    font-size: 14px;\r\n  }\r\n}\r\n\r\n/* Media query for normal sized laptops */\r\n@media (max-width: 1030px) {\r\n  .circleIcon {\r\n    width: 15px;\r\n    height: 15px;\r\n    font-size: 12px;\r\n  }\r\n}\r\n</style>\r\n","<!-- \n    HEADER COMPONENT THAT IS RENDERED INSIDE OF ANALYSIS.VUE\n    SHOWS BASIC USER INFORMATION (LEFT) AND TOOLBAR (RIGHT) OR BUTTONS (QUALITY CHECK).\n    COMPONENT PART OF © AREA 19, OCG WEB APP.\n    DEVELOPPED IN MONTREAL, QC, CANADA.\n    JULY 2023.\n  -->\n<template>\n  <!-- Header container -->\n  <div class=\"header-container\">\n    <!-- Patient information section -->\n    <div class=\"patient-info-container\">\n      <!-- Patient name section -->\n      <div class=\"patient-name\">\n        <!-- Label for patient name -->\n        <h3 class=\"label\">PATIENT</h3>\n        <!-- Display patient first and last name -->\n        <h3>{{ patientName }} {{ patientLastName }}</h3>\n      </div>\n\n      <!-- Breathing rate section -->\n      <div class=\"breathing-rate\">\n        <!-- Display patient's resting heart rate -->\n        <h1>{{ patientBrate }}</h1>\n        <!-- Label for resting heart rate -->\n        <h3 class=\"label\" style=\"text-align: left\">RESTING <br />HEART RATE</h3>\n      </div>\n\n      <!-- Patient information details section -->\n      <div class=\"info\">\n        <!-- Age -->\n        <div>\n          <!-- Label for age -->\n          <h3 class=\"label\">AGE</h3>\n          <!-- Display patient's age -->\n          <h3>{{ patientage }}</h3>\n        </div>\n        <!-- Weight -->\n        <div>\n          <!-- Label for weight -->\n          <h3 class=\"label\">WEIGHT</h3>\n          <!-- Display patient's weight in kilograms -->\n          <h3>{{ patientweight }} Kg</h3>\n        </div>\n        <!-- Height -->\n        <div>\n          <!-- Label for height -->\n          <h3 class=\"label\">HEIGHT</h3>\n          <!-- Display patient's height in centimeters -->\n          <h3>{{ patientheight }} cm</h3>\n        </div>\n        <!-- Gender -->\n        <div>\n          <!-- Label for gender -->\n          <h3 class=\"label\">GENDER</h3>\n          <!-- Display patient's gender -->\n          <h3>{{ patientgender }}</h3>\n        </div>\n      </div>\n    </div>\n\n    <!-- Tools section for GraphicalAnalysis -->\n    <div v-if=\"activeComponent == 'GraphicalAnalysis'\" class=\"tools\">\n      <!-- Display ToolStrip component -->\n      <ToolStrip />\n    </div>\n\n    <!-- QualityCheck section -->\n    <div v-if=\"activeComponent == 'QualityCheck'\" class=\"quality-screen-toggle\">\n      <!-- Check Breathing Splits option -->\n      <div\n        class=\"toggleQaContainer\"\n        :class=\"{ clicked: checkContours == false }\"\n        @click=\"handleclick('CheckBreathingSplits')\"\n        @keydown.space.prevent=\"handleKeyDown\"\n      >\n        <IconNumber />\n        <h2>CHECK BREATHING SPLITS</h2>\n      </div>\n\n      <div\n        class=\"toggleQaContainer\"\n        :class=\"{ clicked: checkContours }\"\n        @click=\"handleclick('CheckContours')\"\n        @keydown.space.prevent=\"handleKeyDown\"\n      >\n        <!-- Check Contours option -->\n        <IconNumber :number=\"2\" />\n        <h2>CHECK CONTOURS</h2>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\n// Import the Vuex store\n// import store from '/src/store/index.js';\n\n// Import the ToolStrip component\nimport ToolStrip from './ToolStrip.vue';\nimport IconNumber from './IconNumber.vue';\n\nexport default {\n  // Register the ToolStrip component\n  components: { ToolStrip, IconNumber },\n\n  // Define props for the component\n  props: {\n    // Active component indicates the currently displayed component\n    activeComponent: { type: String, default: 'analysis' },\n  },\n\n  // Component data properties\n  data() {\n    return {\n      // Patient information data\n      patient: null,\n      patientName: null,\n      patientLastName: null,\n      patientBrate: null,\n      patientage: null,\n      patientweight: null,\n      patientheight: null,\n      patientgender: null,\n      // State to track if checkContours is active\n      checkContours: null,\n    };\n  },\n\n  // Lifecycle hook: mounted\n\n  mounted() {\n    const currentQaView = window.sessionStorage.getItem('currentQaView');\n    if (currentQaView) {\n      this.handleclick(currentQaView);\n    } else {\n      // Initialize checkContours to false\n      this.checkContours = false;\n    }\n\n    // Get the current patient data from local storage\n    this.patient = JSON.parse(window.localStorage.getItem('currentPatient'));\n\n    // Extract and format patient information\n    this.patientName = this.patient.name.toUpperCase();\n    this.patientLastName = this.patient.lastname.toUpperCase();\n    this.patientBrate = this.patient.breathingrate;\n    this.patientage = this.patient.age;\n    this.patientweight = this.patient.weight;\n    this.patientheight = this.patient.height;\n    this.patientgender = this.patient.gender;\n  },\n\n  // Component methods\n  methods: {\n    // Handle click events for quality check options\n    handleclick(text) {\n      if (text === 'CheckBreathingSplits') {\n        this.checkContours = false;\n      } else {\n        this.checkContours = true;\n      }\n\n      window.sessionStorage.setItem('currentQaView', text);\n\n      // Emit the 'updatequalitycheck' event with the checkContours value\n      this.$emit('updatequalitycheck', this.checkContours);\n    },\n  },\n};\n</script>\n\n<style scoped>\n/* Styles for header container */\n.header-container {\n  padding-left: 10px;\n  display: flex;\n  align-items: center;\n  gap: 80px;\n  height: 72px;\n  font-size: 18px;\n  overflow: hidden;\n}\n\n/* Styles for patient information section */\n.patient-info-container {\n  display: flex;\n  gap: 40px;\n}\n\n/* Styles for patient name section */\n\n.patient-name {\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n}\n\n.patient-name h3 {\n  font-weight: 400;\n  line-height: 25px;\n}\n\n/* Styles for label text */\n.label {\n  color: #ffffff80;\n  font-weight: 400;\n  font-size: 14px;\n  line-height: 19px;\n}\n\n.info {\n  display: flex;\n  align-items: center;\n}\n\n.info h3 {\n  font-size: 14px;\n  text-align: center;\n}\n\n/* Styles for breathing rate section */\n.breathing-rate {\n  display: flex;\n  align-items: center;\n  min-width: 130px;\n  text-align: center;\n}\n\n.breathing-rate h1 {\n  font-weight: 400;\n  font-size: 32px;\n  line-height: 43px;\n}\n\n.breathing-rate h3 {\n  margin-left: 5%;\n  font-size: 14px;\n}\n\n/* Styles for tools section */\n.tools {\n  display: flex;\n  gap: 20px;\n  align-items: center;\n  align-self: center;\n}\n\n/* Styles for h1 element (patient breathing rate) */\n.breathing-rate h1 {\n  font-size: 35px;\n}\n\n/* Styles for patient information details section */\n.info {\n  display: flex;\n  gap: 20px;\n}\n\n/* Styles for quality screen toggle section */\n.quality-screen-toggle {\n  display: flex;\n  gap: 20px;\n}\n\n.toggleQaContainer {\n  display: flex;\n  /* Fallback background */\n  background-color: #70707030;\n  gap: 8px;\n  align-items: center;\n  padding: 10px 18px 10px 12px;\n  max-height: 46px;\n  border-radius: 15px;\n  cursor: pointer;\n  opacity: 0.3;\n  transition: opacity 0.3s ease-out;\n  background: rgba(255, 255, 255, 0.1);\n  border-radius: 16px;\n  backdrop-filter: blur(5px);\n  -webkit-backdrop-filter: blur(5px);\n}\n\n.toggleQaContainer:hover {\n  opacity: 0.6;\n}\n\n/* Styles for clicked quality check option */\n.toggleQaContainer.clicked {\n  opacity: 1;\n}\n\n/* Styles for h2 elements (for quality check options) */\n.quality-screen-toggle h2 {\n  font-weight: 500;\n  font-size: 18px;\n}\n\n/* Media query for large laptops */\n@media (max-width: 1450px) {\n  .header-container {\n    padding-top: 10px;\n    font-size: 16px;\n  }\n  .breathing-rate {\n    width: 180px;\n  }\n\n  .patient-info-container {\n    gap: 35px;\n  }\n\n  .breathing-rate h1 {\n    font-size: 30px;\n  }\n  h3 {\n    font-size: 18px;\n  }\n\n  .quality-screen-toggle h2 {\n    font-size: 14px;\n  }\n  .toggleQaContainer {\n    padding: 10px;\n  }\n}\n\n/* Media query for normal sized laptops */\n@media (max-width: 1300px) {\n  .header-container {\n    padding-top: 15px;\n    gap: 5%;\n    text-align: left;\n    font-size: 14px;\n  }\n\n  .patient-name {\n    width: 150px;\n    font-size: 14px;\n  }\n\n  .patient-name h3 {\n    line-height: 20px;\n  }\n  .breathing-rate {\n    width: 180px;\n  }\n\n  .patient-info-container {\n    gap: 0px;\n  }\n\n  .breathing-rate h1 {\n    font-size: 28px;\n  }\n  h3 {\n    font-size: 14px;\n  }\n  .toggleQaContainer {\n    padding: 10px;\n  }\n  .quality-screen-toggle h2 {\n    font-size: 12px;\n  }\n}\n</style>\n","<!-- \n    NAVIGATION COMPONENT THAT IS RENDERED INSIDE OF ANALYSIS.VUE\n    ALLOWS USER TO NAVIGATE BETWEEN THE MAIN COMPONENTS OF THE APP.\n    COMPONENT PART OF © AREA 19, OCG WEB APP.\n    DEVELOPPED IN MONTREAL, QC, CANADA.\n    JULY 2023.\n  -->\n\n<template>\n  <!-- Toolbar container -->\n  <div class=\"toolbar\">\n    <!-- Tools section -->\n    <div class=\"tools\">\n      <!-- Patient List link -->\n      <router-link to=\"/home\" style=\"text-decoration: none\" class=\"normal\">\n        <!-- Patient List tool -->\n        <div class=\"tool\">\n          <!-- Reduce the icon size based on screenwidth -->\n          <i\n            v-if=\"$matches.mediumLaptop.min\"\n            class=\"fa-solid fa-people-arrows fa-xl\"\n          ></i>\n          <i v-else class=\"fa-solid fa-people-arrows fa-lg\"></i>\n          <h4 class=\"section-tag\">Patient List</h4>\n        </div>\n      </router-link>\n\n      <!-- Quality Check tool -->\n      <div\n        class=\"tool\"\n        :class=\"{ active: selectedTool === 'QualityCheck' }\"\n        @click=\"selectTool('QualityCheck')\"\n        @keydown.prevent=\"handleKeyDown\"\n      >\n        <!-- Reduce the icon size based on screenwidth -->\n        <i\n          v-if=\"$matches.mediumLaptop.min\"\n          class=\"fa-solid fa-file-circle-check fa-xl\"\n        ></i>\n        <i v-else class=\"fa-solid fa-file-circle-check fa-lg\"></i>\n        <h4 class=\"section-tag\">Quality Check</h4>\n      </div>\n\n      <!-- Graphical Analysis tool -->\n      <div\n        class=\"tool\"\n        :class=\"{ active: selectedTool === 'GraphicalAnalysis' }\"\n        @click=\"selectTool('GraphicalAnalysis')\"\n        @keydown.prevent=\"handleKeyDown\"\n      >\n        <!-- Reduce the icon size based on screenwidth -->\n        <i\n          v-if=\"$matches.mediumLaptop.min\"\n          class=\"fa-sharp fa-solid fa-microscope fa-xl\"\n        ></i>\n        <i v-else class=\"fa-sharp fa-solid fa-microscope fa-lg\"></i>\n        <h4 class=\"section-tag\">Analysis</h4>\n      </div>\n\n      <!-- Report Maker tool -->\n      <div\n        class=\"tool\"\n        :class=\"{ active: selectedTool === 'ReportMaker' }\"\n        @click=\"selectTool('ReportMaker')\"\n        @keydown.prevent=\"handleKeyDown\"\n      >\n        <!-- Reduce the icon size based on screenwidth -->\n        <i\n          v-if=\"$matches.mediumLaptop.min\"\n          class=\"fa-regular fa-file-pdf fa-xl\"\n        ></i>\n        <i v-else class=\"fa-regular fa-file-pdf fa-lg\"></i>\n        <h4 class=\"section-tag\">Report</h4>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      // Initially selected tool\n      selectedTool: 'QualityCheck', // Set the initial value based on the previous page\n    };\n  },\n  methods: {\n    // Method to select a tool and emit an event with the selected tool so that parent can handle.\n    selectTool(tool) {\n      if (this.selectedTool === tool) {\n        return; // If the tool is already selected, do nothing\n      }\n      this.selectedTool = tool;\n      // Emit the 'tool-selected' event with the selected tool as the payload\n      this.$emit('tool-selected', tool);\n    },\n    handleKeyDown(event) {\n      console.log(event);\n      if (event.key === '1') {\n        this.selectTool('QualityCheck');\n      } else if (event.key === '2') {\n        this.selectTool('GraphicalAnalysis');\n      } else {\n        this.selectTool('ReportMaker');\n      }\n    },\n  },\n  mounted() {\n    // Set the selected tool based on the last viewed tool saved in local storage.\n    this.selectedTool = window.localStorage.getItem('currentView');\n  },\n};\n</script>\n\n<style scoped>\n/* Styles for normal class */\n.normal {\n  color: white;\n}\n\n/* Styles for toolbar container */\n.toolbar {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n}\n\n/* Styles for tools section */\n.tools {\n  display: flex;\n  flex-direction: column;\n  text-align: center;\n  background: rgba(0, 0, 0, 0.46);\n  width: 60px;\n  padding-top: 30px;\n  padding-bottom: 30px;\n  border-radius: 37px;\n  justify-content: center;\n  align-items: center;\n  padding: 15px;\n  padding-top: 40px;\n  padding-bottom: 40px;\n  gap: 30px;\n}\n\n/* Styles for active tool */\n.active {\n  color: #00ddff;\n}\n\n/* Styles for each individual tool */\n.tool {\n  justify-items: center;\n  cursor: pointer;\n}\n\n/* Hover styles for each individual tool */\n.tool:hover {\n  color: #00ddffea;\n  transition: 0.3s;\n}\n\n/* Styles for h4 element (section label) */\n.section-tag {\n  margin-top: 10px;\n  font-size: 12px;\n  text-align: center;\n}\n\n/* Media query for small screens */\n@media (max-width: 1300px) {\n  .tools {\n    padding: 10px;\n    padding-top: 30px;\n    padding-bottom: 30px;\n    gap: 20px;\n  }\n\n  .section-tag {\n    margin-top: 5px;\n  }\n}\n</style>\n","<template>\n  <div\n    :class=\"{ 'custom-button': true, highlighted: isActive }\"\n    @click=\"handleClick\"\n    @mouseover=\"isHovered = true\"\n    @focusin=\"isHovered = true\"\n    @mouseout=\"isHovered = false\"\n    @focusout=\"isHovered = false\"\n    @keydown.space.prevent=\"handleKeyDown\"\n  >\n    <div class=\"button-content\">\n      <div>\n        <h1 :style=\"{ color: stateColor }\">{{ state }}</h1>\n      </div>\n      <div style=\"display: flex; justify-content: space-between\">\n        <div>\n          <h2>{{ heartrate }} BPM</h2>\n          <h4>HEART RATE</h4>\n        </div>\n        <div>\n          <h2>{{ duration }}</h2>\n          <h4>DURATION</h4>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  props: {\n    heartrate: {\n      type: Number,\n      required: true,\n    },\n    duration: {\n      type: String,\n      required: true,\n    },\n    state: {\n      type: String,\n      required: true,\n    },\n    isActive: {\n      type: Boolean,\n      required: true,\n    },\n    stateColor: {\n      type: String,\n      required: false,\n      default: '#66C9DA',\n    },\n  },\n  data() {\n    return {\n      isHovered: false,\n    };\n  },\n  methods: {\n    handleClick() {\n      this.$emit('state-change', this.state);\n    },\n  },\n};\n</script>\n\n<style scoped>\nh1 {\n  text-align: left;\n  font-size: 16px;\n}\n\nh2 {\n  font-size: 20px;\n  line-height: 15px;\n}\nh4 {\n  font-size: 12px;\n  color: #5b5b5b;\n}\n.custom-button {\n  cursor: pointer;\n  padding: 10px;\n  border-radius: 15px;\n  /* border: 1px solid #ccc; */\n  width: 180px;\n  height: 75px;\n  /* background-color: #f9f9f9; */\n  color: #ffffff;\n  transition: background-color 0.5s;\n}\n\n.custom-button:hover {\n  background-color: #70707020;\n}\n\n.highlighted {\n  background-color: #70707020;\n}\n\n.button-content {\n  display: flex;\n  flex-direction: column;\n  /* align-items: center; */\n  /* justify-content: center; */\n}\n</style>\n","<template>\r\n  <div>\r\n    <canvas ref=\"canvas\"></canvas>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: 'PatientInfoHUD',\r\n  mounted() {\r\n    const { canvas } = this.$refs;\r\n    canvas.width = this.numImages * this.imgWidth;\r\n    canvas.height = this.imgHeight;\r\n\r\n    this.addPhaseId();\r\n    this.addHRInfo();\r\n  },\r\n\r\n  data() {\r\n    return {\r\n      paddingX: 15,\r\n    };\r\n  },\r\n  props: {\r\n    isHidden: { type: Boolean },\r\n    numImages: { type: Number, required: true },\r\n    imgWidth: { type: Number, required: true },\r\n    imgHeight: { type: Number, required: true },\r\n  },\r\n  methods: {\r\n    addPhaseId() {\r\n      const { canvas } = this.$refs;\r\n      const context = canvas.getContext('2d');\r\n      context.font = '500 12px Roboto'; // Set the font for the text\r\n      context.textAlign = 'left';\r\n      context.textBaseline = 'middle';\r\n      context.fillStyle = 'white'; // Set the text color to white\r\n      const { numImages } = this;\r\n\r\n      const phasePaddingX = this.paddingX;\r\n      const phaseTextY = 15;\r\n\r\n      for (let i = 0; i < numImages; i++) {\r\n        context.fillText(\r\n          `Phase ${i + 1}`,\r\n          phasePaddingX + this.imgWidth * i,\r\n          phaseTextY\r\n        );\r\n      }\r\n    },\r\n    addHRInfo() {\r\n      const { canvas } = this.$refs;\r\n      const context = canvas.getContext('2d');\r\n\r\n      context.font = '500 12px Roboto'; // Set the font for the text\r\n      context.textAlign = 'left';\r\n      context.textBaseline = 'middle';\r\n      context.fillStyle = 'white'; // Set the text color to white\r\n      const { numImages } = this;\r\n\r\n      const phasePaddingX = this.paddingX;\r\n      const phaseTextY = 30;\r\n\r\n      for (let i = 0; i < numImages; i++) {\r\n        context.fillText(\r\n          `HR ${this.getRandomInt(106, 30)}`,\r\n          phasePaddingX + this.imgWidth * i,\r\n          phaseTextY\r\n        );\r\n      }\r\n    },\r\n\r\n    getRandomInt(max, min) {\r\n      return min + Math.floor(Math.random() * (max - min));\r\n    },\r\n  },\r\n};\r\n</script>\r\n","<template>\n  <div class=\"range-slider\" :style=\"{ width: canvasWidth + 'px' }\">\n    <canvas\n      ref=\"canvas\"\n      @mousedown=\"handleMouseDown\"\n      @dblclick=\"handledblCkick\"\n      @mousemove=\"handleMouseMove\"\n      @mouseup=\"handleMouseUp\"\n      @mouseleave=\"handleMouseUp\"\n      @focusout=\"handleMouseUp\"\n      :style=\"{ cursor: canvasCursor }\"\n    ></canvas>\n  </div>\n</template>\n\n<script>\nimport throttle from 'lodash.throttle';\n\nexport default {\n  name: 'RangeSlider',\n  props: {\n    maxExpand: { type: Number, default: 10 },\n    minExpand: { type: Number, default: 3 },\n    canvasWidth: { type: Number },\n\n    sliceObj: { type: Object },\n    numImages: Number,\n    imgWidth: Number,\n  },\n\n  data() {\n    return {\n      canvasHeight: 44,\n      thumbRadius: 3,\n      isDragging: false,\n      startThumbX: 0,\n      endThumbX: 0,\n      minValue: 0,\n      maxValue: 100,\n      startValue: 0,\n      startValueParent: 0,\n      endValue: 10,\n      startDragX: null,\n      scrollerHeight: 12,\n      canvasCursor: 'pointer',\n    };\n  },\n  mounted() {\n    this.endValue =\n      1 / ((this.imgWidth * this.numImages) / (this.canvasWidth - 8) / 100);\n    console.log(`IMAGE STRIP WIDTH: ${this.canvasWidth}`);\n\n    this.drawCanvas();\n    this.throttledSliderMove = throttle(this.moveScale, 5);\n  },\n  methods: {\n    drawCurrentView(startX, endX) {\n      const x = startX;\n      const width = Math.abs(endX - startX);\n      const { canvas } = this.$refs;\n      const ctx = canvas.getContext('2d');\n      // ctx.strokeStyle = obj.stroke;\n      ctx.strokeStyle = '#FFFFFF';\n      // ctx.fillStyle = obj.color;\n      ctx.fillStyle = '#FFFFFF05';\n      const height = 35;\n      const y = (this.canvasHeight - height) / 2;\n\n      ctx.lineWidth = 3;\n      const cornerRadius = 6;\n\n      ctx.beginPath();\n      ctx.moveTo(x + cornerRadius, y);\n      ctx.lineTo(x + width - cornerRadius, y);\n      ctx.arcTo(x + width, y, x + width, y + cornerRadius, cornerRadius);\n      ctx.lineTo(x + width, y + height - cornerRadius);\n      ctx.arcTo(\n        x + width,\n        y + height,\n        x + width - cornerRadius,\n        y + height,\n        cornerRadius\n      );\n      ctx.lineTo(x + cornerRadius, y + height);\n      ctx.arcTo(x, y + height, x, y + height - cornerRadius, cornerRadius);\n      ctx.lineTo(x, y + cornerRadius);\n      ctx.arcTo(x, y, x + cornerRadius, y, cornerRadius);\n      ctx.closePath();\n\n      ctx.fill(); // Fill the rectangle with red\n      ctx.stroke(); // Draw the stroke around the rectangle\n    },\n    drawHandle(ctx, xStart, yStart, width, height, borderRadius, color) {\n      const context = ctx;\n      const xEnd = xStart + width;\n      const yEnd = yStart + height;\n      // Draw rounded rectangle\n      context.beginPath();\n      context.moveTo(xStart + borderRadius, yStart);\n      context.lineTo(xEnd - borderRadius, yStart);\n      context.quadraticCurveTo(xEnd, yStart, xEnd, yStart + borderRadius);\n      context.lineTo(xEnd, yEnd - borderRadius);\n      context.quadraticCurveTo(xEnd, yEnd, xEnd - borderRadius, yEnd);\n      context.lineTo(xStart + borderRadius, yEnd);\n      context.quadraticCurveTo(xStart, yEnd, xStart, yEnd - borderRadius);\n      context.lineTo(xStart, yStart + borderRadius);\n      context.quadraticCurveTo(xStart, yStart, xStart + borderRadius, yStart);\n      context.closePath();\n\n      context.lineWidth = 2; // Border width\n      context.strokeStyle = color; // Border color\n      context.stroke();\n\n      // Fill the rectangle with a color\n      context.fillStyle = color;\n      context.fill();\n    },\n    drawSegment(startX, endX, color) {\n      const { canvas } = this.$refs;\n      const ctx = canvas.getContext('2d');\n\n      const verticalSpace = (this.canvasHeight - 32) / 2;\n      const distance = Math.abs(endX - startX);\n\n      this.drawHandle(ctx, startX, verticalSpace, 8, 32, 4, color);\n      // Draw rest of track ahead:\n      ctx.fillStyle = color;\n      ctx.fillRect(\n        startX,\n        canvas.height / 2 - this.scrollerHeight / 2,\n        distance,\n        this.scrollerHeight\n      );\n      this.drawHandle(ctx, endX, verticalSpace, 8, 32, 4, color);\n    },\n\n    drawTrack() {\n      const { canvas } = this.$refs;\n      const ctx = canvas.getContext('2d');\n      // Draw track:\n      ctx.fillStyle = '#3D3D3D';\n      ctx.fillRect(\n        0,\n        canvas.height / 2 - this.scrollerHeight / 2,\n        canvas.width,\n        this.scrollerHeight\n      );\n    },\n    drawCanvas() {\n      const { canvas } = this.$refs;\n      const ctx = canvas.getContext('2d');\n\n      canvas.width = this.canvasWidth - 8;\n      canvas.height = this.canvasHeight;\n\n      const startThumbX = this.getValueToXPosition(this.startValue);\n      const endThumbX = this.getValueToXPosition(this.endValue);\n\n      const startFtoX = this.getObjLocToVal(\n        this.sliceObj.states.FREEBREATHING.start\n      );\n\n      const endFtoX = this.getObjLocToVal(\n        this.sliceObj.states.FREEBREATHING.end\n      );\n\n      const startHtoX = this.getObjLocToVal(\n        this.sliceObj.states.HYPERVENTILATION.start\n      );\n\n      const endHtoX = this.getObjLocToVal(\n        this.sliceObj.states.HYPERVENTILATION.end\n      );\n\n      const startBHtoX = this.getObjLocToVal(\n        this.sliceObj.states.BREATHHOLD.start\n      );\n\n      const endBHtoX = this.getObjLocToVal(this.sliceObj.states.BREATHHOLD.end);\n\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n      // // Draw track\n      this.drawTrack();\n\n      // Draw state positions:\n\n      this.drawSegment(startFtoX, endFtoX - 7, '#5FBBCB');\n      this.drawSegment(startHtoX + 3, endHtoX - 7, '#C24ABC');\n      this.drawSegment(startBHtoX + 3, endBHtoX - 7, '#D95476');\n\n      this.drawCurrentView(startThumbX, endThumbX);\n    },\n\n    getObjLocToVal(obj) {\n      const endF = obj.XLocation / (this.imgWidth * this.numImages);\n      const endFtoX = this.getValueToXPosition(endF * 100);\n\n      return endFtoX;\n    },\n\n    getValueToXPosition(value) {\n      const range = this.maxValue - this.minValue;\n      const width = this.canvasWidth - 8 - this.thumbRadius * 2;\n      return ((value - this.minValue) * width) / range + this.thumbRadius;\n    },\n    getXPositionToValue(x) {\n      const range = this.maxValue - this.minValue;\n      const width = this.canvasWidth - 8 - this.thumbRadius * 2;\n      return ((x - this.thumbRadius) * range) / width + this.minValue;\n    },\n    handleMouseDown(event) {\n      const { canvas } = this.$refs;\n      const rect = canvas.getBoundingClientRect();\n      const mouseX = event.clientX - rect.left;\n\n      const startThumbX = this.getValueToXPosition(this.startValue);\n      const endThumbX = this.getValueToXPosition(this.endValue);\n\n      this.startDragX = mouseX;\n\n      if (mouseX < endThumbX && mouseX > startThumbX) {\n        this.isDragging = 'middle';\n        this.canvasCursor = 'grab';\n      }\n    },\n    handledblCkick(event) {\n      const { canvas } = this.$refs;\n      const rect = canvas.getBoundingClientRect();\n      const mouseX = event.clientX - rect.left;\n\n      const widthWindow = Math.abs(this.startValue - this.endValue);\n\n      const newStart = Math.min(\n        Math.max(this.getXPositionToValue(mouseX) - widthWindow / 2, 0),\n        this.maxValue - widthWindow\n      );\n\n      this.startValue = newStart;\n      this.endValue = this.startValue + widthWindow;\n\n      this.throttledSliderMove(this.startValue);\n      this.drawCanvas();\n    },\n    handleMouseMove(event) {\n      if (!this.isDragging) {\n        return;\n      }\n\n      const { canvas } = this.$refs;\n      const rect = canvas.getBoundingClientRect();\n      const mouseX = event.clientX - rect.left;\n\n      const value = this.getXPositionToValue(mouseX);\n      const dx = value - this.getXPositionToValue(this.startDragX);\n\n      if (\n        this.endValue + dx > this.maxValue ||\n        this.startValue + dx < this.minValue\n      ) {\n        return;\n      }\n      this.startValue += dx;\n      this.endValue += dx;\n      this.throttledSliderMove(this.startValue);\n\n      this.drawCanvas();\n\n      this.startDragX = this.getValueToXPosition(value);\n    },\n    handleMouseUp() {\n      if (!this.isDragging) {\n        return;\n      }\n      this.isDragging = false;\n      this.canvasCursor = 'pointer';\n    },\n\n    moveScale(dx) {\n      this.$emit('move', dx);\n    },\n    updatePosition(newPosition) {\n      const dx = newPosition - this.startValue;\n      this.startValue = newPosition;\n      this.endValue += dx;\n      this.drawCanvas();\n    },\n  },\n  watch: {\n    canvasWidth() {\n      this.drawCanvas();\n    },\n  },\n};\n</script>\n\n<style scoped>\n.range-slider {\n  position: relative;\n  height: 44px;\n  background: #ffffff12;\n  /* From https://css.glass */\n  background: rgba(255, 255, 255, 0.15);\n  border-radius: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);\n  backdrop-filter: blur(5px);\n  -webkit-backdrop-filter: blur(5px);\n}\n\ncanvas {\n  cursor: pointer;\n}\n</style>\n","<template>\r\n  <div\r\n    @contextmenu.prevent=\"openContextMenu\"\r\n    @click=\"closeContextMenu\"\r\n    @mousewheel.passive=\"closeContextMenu\"\r\n    @keypress.prevent=\"handleKeyPress\"\r\n  >\r\n    <slot></slot>\r\n    <transition name=\"fade\">\r\n      <div\r\n        v-if=\"showContextMenu\"\r\n        class=\"custom-context-menu\"\r\n        :style=\"{ top: `${contextMenuY}px`, left: `${contextMenuX}px` }\"\r\n      >\r\n        <div\r\n          class=\"option\"\r\n          @click=\"addLabel('systoles')\"\r\n          @keypress=\"h\"\r\n          :class=\"{ noClick: hasLabel }\"\r\n        >\r\n          <i class=\"fa-solid fa-plus fa-sm\" style=\"color: #ffffff\"></i>\r\n          <h5>Add Systole Label</h5>\r\n        </div>\r\n\r\n        <div\r\n          class=\"option\"\r\n          @click=\"addLabel('diastoles')\"\r\n          @keypress=\"h\"\r\n          :class=\"{ noClick: hasLabel }\"\r\n        >\r\n          <i class=\"fa-solid fa-circle-plus fa-sm\" style=\"color: #ffffff\"></i>\r\n          <h5>Add Diastole Label</h5>\r\n        </div>\r\n\r\n        <div\r\n          class=\"option\"\r\n          @click=\"removeLabel()\"\r\n          @keypress=\"h\"\r\n          :class=\"{ noClick: !hasLabel }\"\r\n        >\r\n          <i class=\"fa-regular fa-trash-can fa-sm\" style=\"color: #ffffff\"></i>\r\n          <h5>Delete Label</h5>\r\n        </div>\r\n      </div>\r\n    </transition>\r\n    <transition name=\"fade\">\r\n      <div\r\n        v-if=\"showError\"\r\n        class=\"custom-context-menu\"\r\n        :style=\"{ top: `${contextMenuY}px`, left: `${contextMenuX}px` }\"\r\n      >\r\n        <div class=\"warning\">\r\n          <i\r\n            class=\"fa-solid fa-triangle-exclamation\"\r\n            style=\"color: #ffcc00\"\r\n          ></i>\r\n          <h5>Unable to edit label! Please click within a breathing state.</h5>\r\n        </div>\r\n      </div>\r\n    </transition>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  props: {\r\n    hasLabel: null,\r\n  },\r\n  data() {\r\n    return {\r\n      showContextMenu: false,\r\n      showError: false,\r\n      contextMenuX: 0,\r\n      contextMenuY: 0,\r\n    };\r\n  },\r\n  methods: {\r\n    openContextMenu(event) {\r\n      this.showContextMenu = true;\r\n      this.contextMenuX = event.clientX;\r\n      this.contextMenuY = event.clientY;\r\n    },\r\n    closeContextMenu() {\r\n      this.showContextMenu = false;\r\n      this.showError = false;\r\n    },\r\n    addLabel(option) {\r\n      this.$emit('add-label', option);\r\n      this.showContextMenu = false;\r\n    },\r\n    removeLabel() {\r\n      this.$emit('remove-label');\r\n      this.showContextMenu = false;\r\n    },\r\n    popError(event) {\r\n      this.showError = true;\r\n      this.contextMenuX = event.clientX;\r\n      this.contextMenuY = event.clientY;\r\n    },\r\n    handleKeyPress() {},\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.custom-context-menu {\r\n  position: absolute;\r\n  z-index: 999999;\r\n  background-color: rgba(0, 0, 0, 0.74);\r\n  box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.2);\r\n  border-radius: 5px;\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 0.2rem;\r\n  padding: 0.5rem 0rem 0.5rem 0rem;\r\n  width: 200px;\r\n}\r\n\r\n.option {\r\n  width: 100%;\r\n\r\n  padding: 0.2rem 0.5rem 0.2rem 0.5rem;\r\n  display: flex;\r\n  gap: 0.5rem;\r\n  align-items: center;\r\n}\r\n.option:hover {\r\n  background: #79cfde98;\r\n  transition: all 0.3s ease;\r\n}\r\n\r\n.warning {\r\n  color: #ffcc00;\r\n  display: flex;\r\n  gap: 0.4rem;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n  padding-left: 0.5rem;\r\n  text-align: center;\r\n}\r\n\r\n.option.noClick {\r\n  opacity: 0.3;\r\n  pointer-events: none;\r\n}\r\n/* Styles for the fade-in animation */\r\n.fade-enter-active,\r\n.fade-leave-active {\r\n  transition: opacity 0.3s ease;\r\n}\r\n\r\n.fade-enter-from,\r\n.fade-leave-to {\r\n  opacity: 0;\r\n}\r\n</style>\r\n","<!-- STILL UNDER WORKS-->\n<template>\n  <div :class=\"{ hide: isHidden }\" class=\"horizontal-bar\">\n    <canvas\n      ref=\"canvas\"\n      :style=\"{ cursor: canvasCursor }\"\n      @mousedown=\"startResize\"\n      @focusin=\"startResize\"\n      @focusout=\"endResize\"\n      @mousemove=\"mousemoving\"\n      @mouseup=\"endResize\"\n      @mouseout=\"endResize\"\n      @contextmenu.prevent=\"handleRightClick\"\n      @mousewheel.passive=\"this.$refs.menu.closeContextMenu\"\n    ></canvas>\n  </div>\n\n  <AddCardiacCycle\n    ref=\"menu\"\n    :has-label=\"hasLabelOnClick\"\n    @add-label=\"handleAddLabel\"\n    @remove-label=\"handleRemoveLabel\"\n  />\n</template>\n\n<script>\nimport AddCardiacCycle from './AddCardiacCycle.vue';\n\nexport default {\n  emits: ['update-slice', 'remove-label', 'add-label'],\n  props: {\n    isHidden: { type: Boolean },\n    numImages: { type: Number, required: true },\n    imgWidth: { type: Number, required: true },\n    sliceObj: { type: Object, required: true },\n    BARHEIGHT: {\n      type: Number,\n      default: 284,\n    },\n    BARWIDTH: {\n      type: Number,\n      // default: 800,\n      default: 800,\n    },\n  },\n  components: {\n    AddCardiacCycle,\n  },\n  data() {\n    return {\n      handlerBarWidth: 9,\n      cardiacCyclesLabelWidth: 110,\n      handleBarGrab: { width: 30, height: 28 },\n      addNewLabelX: 0,\n      hasLabelOnClick: false,\n\n      canvasCursor: 'default',\n      moving: false,\n      movingObj: 'none',\n      barHeight: this.BARHEIGHT,\n      startX: 0,\n      barWidth: this.BARWIDTH,\n      mouse: {\n        x: null,\n        y: null,\n      },\n    };\n  },\n\n  mounted() {\n    this.addXLocations();\n    this.drawTrimmer();\n  },\n  watch: {\n    barWidth() {\n      this.drawTrimmer();\n    },\n    barHeight() {\n      this.drawTrimmer();\n    },\n  },\n  methods: {\n    /**\n     * Draws a labeled cycle object (systole or diastole) on the canvas with specified properties.\n     *\n     * @param {Object} objInput - The input object containing properties of the cycle.\n     * @property {number} objInput.XLocation - The X-coordinate of the cycle's location.\n     * @property {string} objInput.id - The text label for the cycle.\n     */\n    drawCycleLabel(objInput) {\n      // Extract properties from the input object\n      const obj = objInput;\n      const x = obj.XLocation;\n\n      // Extract text for the label\n      const text = obj.id;\n\n      // Extract label width and canvas reference\n      const width = this.cardiacCyclesLabelWidth;\n      const { canvas } = this.$refs;\n\n      // Obtain canvas 2D context\n      const ctx = canvas.getContext('2d');\n\n      // Set the fill style for the container\n      ctx.fillStyle = '#00000070';\n\n      // Define positioning and dimensions for the container\n      const y = 8;\n      const height = 35;\n      const cornerRadius = 15;\n\n      // Begin drawing the container\n      ctx.beginPath();\n      ctx.moveTo(x + cornerRadius, y);\n      // Draw top line with rounded corner\n      ctx.lineTo(x + width - cornerRadius, y);\n      ctx.arcTo(x + width, y, x + width, y + cornerRadius, cornerRadius);\n      // Draw right line with rounded corner\n      ctx.lineTo(x + width, y + height - cornerRadius);\n      ctx.arcTo(\n        x + width,\n        y + height,\n        x + width - cornerRadius,\n        y + height,\n        cornerRadius\n      );\n      // Draw bottom line with rounded corner\n      ctx.lineTo(x + cornerRadius, y + height);\n      ctx.arcTo(x, y + height, x, y + height - cornerRadius, cornerRadius);\n      // Draw left line with rounded corner\n      ctx.lineTo(x, y + cornerRadius);\n      ctx.arcTo(x, y, x + cornerRadius, y, cornerRadius);\n      ctx.closePath();\n\n      ctx.fill(); // Fill the rectangle with a semi-transparent color\n      // ctx.stroke(); // Optionally, draw the stroke\n\n      // Add Label Text\n      ctx.font = '300 18px Roboto'; // Set font for the text\n      ctx.textAlign = 'center';\n      ctx.textBaseline = 'middle';\n      ctx.fillStyle = 'white'; // Set text color to white\n\n      // Calculate text position\n      const textX = x + width / 2;\n      const textY = y + height / 2;\n      ctx.fillText(text, textX, textY);\n\n      // Calculate circle positions and properties\n      const circleRadius = 2;\n      const circleSpacingX = 3;\n      const circleSpacingY = 2.5;\n      const circleColor = 'rgba(255,255,255,0.65)';\n\n      // Draw inner handle circles\n      for (let col = 0; col < 3; col++) {\n        const centerX =\n          x -\n          10 +\n          width / 2 +\n          circleSpacingX +\n          col * (2 * circleRadius + circleSpacingX);\n        const centerY =\n          18 + circleSpacingY + 10 + (2 * circleRadius + circleSpacingY);\n\n        // Draw a circle\n        ctx.beginPath();\n        ctx.arc(centerX, centerY, circleRadius, 0, Math.PI * 2);\n        ctx.fillStyle = circleColor;\n        ctx.fill();\n        ctx.closePath();\n      }\n    },\n    /**\n     * Draws bars on top and bottom add borders of a specific state.\n     * @param {string} state - The state identifier for which the bars are drawn.\n     * @param {string} color - The color of the bars to be drawn.\n     */\n    drawBars(state, color) {\n      const { canvas } = this.$refs;\n\n      // Get the 2D rendering context of the canvas.\n      const ctx = canvas.getContext('2d');\n\n      // Set the fill style for the bars.\n      ctx.fillStyle = color;\n\n      // Calculate the starting and ending X coordinates for the bars.\n      const start =\n        this.sliceObj.states[state].start.XLocation + this.handlerBarWidth;\n      const end = this.sliceObj.states[state].end.XLocation;\n\n      // Begin drawing the bars on the canvas.\n      ctx.beginPath();\n\n      // Draw the top line of the bars.\n      ctx.moveTo(start, 0);\n      ctx.lineTo(end, 0);\n\n      // Draw the bottom line of the bars.\n      ctx.moveTo(start, this.barHeight);\n      ctx.lineTo(end, this.barHeight);\n\n      // Set the line width and stroke style for the bars.\n      ctx.lineWidth = 3;\n      ctx.strokeStyle = color;\n\n      // Perform the stroke to render the bars on the canvas.\n      ctx.stroke();\n    },\n    drawTrimmer() {\n      const { canvas } = this.$refs;\n      const context = canvas.getContext('2d');\n      const canvasWidth = this.barWidth;\n      const canvasHeight = this.barHeight;\n      canvas.width = canvasWidth;\n      canvas.height = canvasHeight;\n      context.clearRect(0, 0, canvas.width, canvas.height);\n\n      Object.entries(this.sliceObj.states).forEach(([state, data]) => {\n        this.drawBars(state, data.color);\n        data.cardiacCycles.systoles.forEach((systole) =>\n          this.drawCycleLabel(systole)\n        );\n        data.cardiacCycles.diastoles.forEach((diastole) =>\n          this.drawCycleLabel(diastole)\n        );\n        this.drawStartEndHandlers(data);\n      });\n    },\n\n    findIfLabelOnClick() {\n      const phaseClick = Math.floor(this.addNewLabelX / this.imgWidth) + 1;\n      const state = this.findStateUserClicked();\n      try {\n        const { cardiacCycles } = this.sliceObj.states[state];\n\n        let foundLabel = null;\n        let foundIndex = null;\n        Object.keys(cardiacCycles).some((key) => {\n          foundIndex = cardiacCycles[key].findIndex((labelHere) => {\n            if (labelHere.phaseLocation === phaseClick) {\n              foundLabel = key;\n              return true;\n            }\n            return false;\n          });\n          return foundIndex !== -1;\n        });\n\n        if (foundIndex !== -1) {\n          return { state, foundLabel, foundIndex };\n        }\n      } catch (error) {\n        return 'error';\n      }\n      return null;\n    },\n\n    /**\n     * Returns the state at which the user clicked on based on mouse position.\n     * @returns {string|null} - The name of the state or null if no state was found.\n     */\n    findStateUserClicked() {\n      // Initialize a variable to store the found state\n      let foundState = null;\n\n      // Iterate through each state in the sliceObj.states using the 'some' method\n      Object.keys(this.sliceObj.states).some((state) => {\n        // Convert the phase location of the state's end to X coordinate\n        const endLocation = this.sliceObj.states[state].end.XLocation;\n\n        const startLocation = this.sliceObj.states[state].start.XLocation;\n\n        // Check if the current mouse X position is less than or equal to the end location\n        if (startLocation <= this.mouse.x && this.mouse.x <= endLocation) {\n          // Set the found state and return true to break out of the 'some' loop\n          foundState = state;\n          return true;\n        }\n\n        // Return false to continue iterating through the states\n        return false;\n      });\n\n      // Return the found state (or null if no state was found)\n      return foundState;\n    },\n\n    findObjonCursor(state) {\n      const stateObj = this.sliceObj.states[state];\n\n      // const mousePhase = Math.floor(this.mouse.x / this.imgWidth) + 1;\n      // TODO: incorparate a way to only look at the current mousePhase\n      // for labels for faster search.\n\n      const { start, end, cardiacCycles } = stateObj;\n\n      if (this.checkMouseOnStart(start)) {\n        return start;\n      }\n      if (this.checkMouseOnEnd(end)) {\n        return end;\n      }\n      const targetSystole = this.checkAllLabels(cardiacCycles.systoles);\n      if (targetSystole) {\n        return targetSystole;\n      }\n      const targetDiastole = this.checkAllLabels(cardiacCycles.diastoles);\n      if (targetDiastole) {\n        return targetDiastole;\n      }\n      return null;\n    },\n\n    checkMouseOnStart(start) {\n      const xMin = start.XLocation;\n      const xMax = xMin + this.handleBarGrab.width;\n      const yMin = this.barHeight / 2 - this.handleBarGrab.height;\n      const yMax = this.barHeight / 2 + this.handleBarGrab.height;\n\n      return this.checkMouseInArea(xMin, xMax, yMin, yMax);\n    },\n\n    checkMouseOnEnd(end) {\n      const xMin = end.XLocation - this.handleBarGrab.width;\n      const xMax = xMin + this.handleBarGrab.width;\n      const yMin = this.barHeight / 2 - this.handleBarGrab.height;\n      const yMax = this.barHeight / 2 + this.handleBarGrab.height;\n\n      return this.checkMouseInArea(xMin, xMax, yMin, yMax);\n    },\n\n    checkMouseOnLabel(label) {\n      const xMin = label.XLocation;\n      const xMax = xMin + this.cardiacCyclesLabelWidth;\n      const yMin = 8;\n      const yMax = 40;\n\n      return this.checkMouseInArea(xMin, xMax, yMin, yMax);\n    },\n\n    checkAllLabels(cardiacCycleArray) {\n      return cardiacCycleArray.find((cycle) => this.checkMouseOnLabel(cycle));\n    },\n\n    checkMouseInArea(xMin, xMax, yMin, yMax) {\n      return (\n        this.mouse.x >= xMin &&\n        this.mouse.x <= xMax &&\n        this.mouse.y >= yMin &&\n        this.mouse.y <= yMax\n      );\n    },\n\n    // Function called when user clicks on the video trimmer.\n    startResize(event) {\n      this.$refs.menu.closeContextMenu();\n      // Getting user mouse position:\n      this.mouse.x = event.offsetX;\n      this.mouse.y = event.offsetY;\n      this.startX = this.mouse.x;\n\n      const clickedState = this.findStateUserClicked();\n\n      if (clickedState) {\n        const targetObj = this.findObjonCursor(clickedState);\n        if (targetObj) {\n          this.moving = true;\n          this.movingObj = targetObj;\n        }\n      }\n    },\n\n    handleNotMoving() {\n      const currentState = this.findStateUserClicked();\n      this.updateCursor();\n      if (currentState) {\n        if (this.findObjonCursor(currentState)) {\n          this.updateCursor('grab');\n        } else {\n          this.updateCursor();\n        }\n      }\n    },\n\n    handleCheckUpperLowerBound(id, state, dx, lowerbound, upperbound) {\n      if (id === 'start') {\n        return (\n          this.sliceObj.states[state].start.XLocation + dx + this.imgWidth >\n            this.sliceObj.states[state].end.XLocation ||\n          this.sliceObj.states[state].start.XLocation + dx <= lowerbound\n        );\n      }\n      return (\n        this.sliceObj.states[state].end.XLocation + dx - this.imgWidth - 50 <\n          this.sliceObj.states[state].start.XLocation ||\n        this.sliceObj.states[state].end.XLocation + dx >= upperbound\n      );\n    },\n\n    mousemoving(event) {\n      // Check if the cursor is inside the videotrimmer or if user is dragging:\n      // Used to avoid edge cases.\n      if (\n        !(\n          (event.offsetX >=\n            this.sliceObj.states.FREEBREATHING.start.XLocation &&\n            event.offsetX <=\n              this.sliceObj.states.BREATHHOLD.end.XLocation + 30) ||\n          this.moving\n        )\n      ) {\n        this.updateCursor();\n        return;\n      }\n      // If inside the videotrimmer, grab mouse position:\n      this.mouse.x = event.offsetX;\n      this.mouse.y = event.offsetY;\n\n      // If the user is not dragging, simply change the cursor to the appropriate event:\n      // (i.e., grab or default)\n      if (!this.moving) {\n        this.handleNotMoving();\n        return;\n      }\n\n      // If the user is dragging an object:\n      event.preventDefault();\n      const xhere = event.offsetX;\n      const dx = xhere - this.startX;\n\n      // Check whether the object we are moving is start or end:\n      if (this.movingObj.id === 'end' || this.movingObj.id === 'start') {\n        // Check whether the moving object is kept between bounds.\n\n        // Getting the state before and after  the moving state.\n        const previousState = this.getPreviousKey(\n          this.sliceObj.states,\n          this.movingObj.state\n        );\n\n        const nextState = this.getNextKey(\n          this.sliceObj.states,\n          this.movingObj.state\n        );\n\n        // If the moving state is FREEBREATHING [0], then the minimum the user can drag over is 0.\n        // Otherwise, the minimum will be the end of the state before current.\n        const lowerbound = !previousState\n          ? 0\n          : this.sliceObj.states[previousState].end.XLocation;\n\n        // // If the moving state is BREATHHOLD [2], then the maximum the user can drag over is barWidth.\n        // // Otherwise, the maximum will be the start of the state after current.\n        const upperbound = !nextState\n          ? this.barWidth\n          : this.sliceObj.states[nextState].start.XLocation;\n\n        // Check for lowebound upperbound as well as keeping space between start and end:\n        if (\n          this.handleCheckUpperLowerBound(\n            this.movingObj.id,\n            this.movingObj.state,\n            dx,\n            lowerbound,\n            upperbound\n          )\n        ) {\n          return;\n        }\n        const { cardiacCycles } = this.sliceObj.states[this.movingObj.state];\n\n        const collision = Object.keys(cardiacCycles).some((cycleKey) => {\n          const cycle = cardiacCycles[cycleKey];\n          return cycle.some((targetCycle) => {\n            return this.checkCollisionStartEnd(targetCycle, dx);\n          });\n        });\n\n        if (collision) {\n          return;\n        }\n        this.startX = xhere;\n        this.movingObj.XLocation += dx;\n        requestAnimationFrame(this.drawTrimmer);\n        return;\n      }\n\n      // 1. Check if the object that we are moving is \"current, diastole or systole\"\n\n      /* If loop checking based on moving object to prevent it from going over bounds.\n            If current object is \"current\", refering to the current phase, then it is allowed\n            to travel across the states. Otherwise, the object is bounded by its start and end.\n            if object is not \"current\" and the\n            new position of the object would be out of bounds then return. */\n      if (\n        this.movingObj.XLocation + dx <=\n          this.sliceObj.states[this.movingObj.state].start.XLocation ||\n        this.movingObj.XLocation + dx >\n          this.sliceObj.states[this.movingObj.state].end.XLocation -\n            this.cardiacCyclesLabelWidth\n      ) {\n        // In the case where the condition is not satisfied, simply update position and redraw:\n      } else {\n        this.movingObj.XLocation += dx;\n        requestAnimationFrame(this.drawTrimmer);\n\n        // Resetting start X to the new position so\n        //  that dx can be calculated based on last mouse position.\n        this.startX = xhere;\n      }\n      // 1.Cont. If movingObj is not \"current, diastole or systole\" then:\n    },\n    checkCollisionStartEnd(obj, dx) {\n      if (this.movingObj.id === 'start') {\n        if (dx < 0) {\n          return false;\n        }\n        return (\n          this.movingObj.XLocation + dx - 10 >=\n          (obj.phaseLocation - 1) * this.imgWidth\n        );\n      }\n      if (this.movingObj.id === 'end') {\n        if (dx > 0) {\n          return false;\n        }\n        return (\n          this.movingObj.XLocation + dx + 15 <=\n          obj.phaseLocation * this.imgWidth\n        );\n      }\n      return false;\n    },\n    drawhandle(ctx, xStart, yStart, xEnd, yEnd, borderRadius, color) {\n      const context = ctx;\n      // Draw rounded rectangle\n      context.beginPath();\n      context.moveTo(xStart + borderRadius, yStart);\n      context.lineTo(xEnd - borderRadius, yStart);\n      context.quadraticCurveTo(xEnd, yStart, xEnd, yStart + borderRadius);\n      context.lineTo(xEnd, yEnd - borderRadius);\n      context.quadraticCurveTo(xEnd, yEnd, xEnd - borderRadius, yEnd);\n      context.lineTo(xStart + borderRadius, yEnd);\n      context.quadraticCurveTo(xStart, yEnd, xStart, yEnd - borderRadius);\n      context.lineTo(xStart, yStart + borderRadius);\n      context.quadraticCurveTo(xStart, yStart, xStart + borderRadius, yStart);\n      context.closePath();\n\n      context.lineWidth = 2; // Border width\n      context.strokeStyle = color; // Border color\n      context.stroke();\n\n      // Fill the rectangle with a color\n      context.fillStyle = color;\n      context.fill();\n\n      // Calculate circle positions and properties\n      const circleRadius = 2.5;\n      const circleSpacingX = 3;\n      const circleSpacingY = 2.5;\n      const circleColor = 'rgba(255,255,255,0.65)';\n\n      // Draw inner handle circles\n      for (let row = 0; row < 3; row++) {\n        for (let col = 0; col < 2; col++) {\n          const centerX =\n            xStart +\n            borderRadius +\n            circleSpacingX +\n            col * (2 * circleRadius + circleSpacingX);\n          const centerY =\n            yStart +\n            borderRadius +\n            circleSpacingY +\n            10 +\n            row * (2 * circleRadius + circleSpacingY);\n\n          context.beginPath();\n          context.arc(centerX, centerY, circleRadius, 0, Math.PI * 2);\n          context.fillStyle = circleColor;\n          context.fill();\n          context.closePath();\n        }\n      }\n    },\n\n    drawStartEndHandlers(dataInput) {\n      const data = dataInput;\n      const { canvas } = this.$refs;\n      const ctx = canvas.getContext('2d');\n      const borderRadius = 5;\n      const width = this.handlerBarWidth + borderRadius;\n      const height = this.barHeight;\n      const y = 0;\n      let x = data.start.XLocation;\n      data.start.XLocation = x;\n      const fillColor = data.color;\n\n      // Draw Start Handle:\n      ctx.beginPath();\n      ctx.moveTo(x + borderRadius, y);\n      ctx.lineTo(x + width - borderRadius, y);\n      ctx.lineTo(x + width - borderRadius, y + height);\n      ctx.lineTo(x + borderRadius, y + height);\n      ctx.arcTo(x, y + height, x, y + height - borderRadius, borderRadius);\n      ctx.lineTo(x, y + borderRadius);\n      ctx.arcTo(x, y, x + borderRadius, y, borderRadius);\n\n      ctx.closePath();\n      ctx.fillStyle = fillColor;\n      ctx.fill();\n\n      this.drawhandle(\n        ctx,\n        x + borderRadius - 4,\n        height / 2 - this.handleBarGrab.height,\n        x + this.handleBarGrab.width,\n        height / 2 + this.handleBarGrab.height,\n        8,\n        fillColor\n      );\n\n      // Draw End Handle:\n      x = data.end.XLocation;\n      data.end.XLocation = x;\n      x -= borderRadius;\n      ctx.beginPath();\n      ctx.moveTo(x + borderRadius, y);\n      ctx.arcTo(x + width, y, x + width, y + borderRadius, borderRadius);\n      ctx.lineTo(x + width, y + height - borderRadius);\n      ctx.arcTo(\n        x + width,\n        y + height,\n        x + width - borderRadius,\n        y + height,\n        borderRadius\n      );\n      ctx.lineTo(x + borderRadius, y + height);\n      ctx.closePath();\n      ctx.fillStyle = fillColor;\n      ctx.fill();\n\n      this.drawhandle(\n        ctx,\n        x - this.handleBarGrab.width + borderRadius + 7,\n        height / 2 - this.handleBarGrab.height,\n        x + borderRadius + 4,\n        height / 2 + this.handleBarGrab.height,\n        8,\n        fillColor\n      );\n    },\n\n    checksingleobj(obj) {\n      return (\n        this.mouse.x >= obj.location && this.mouse.x <= obj.location + obj.width\n      );\n    },\n    snapObject() {\n      this.movingObj.phaseLocation = this.convertXLocationtoPhase(\n        this.movingObj.XLocation,\n        this.movingObj.id\n      );\n      this.movingObj.XLocation = this.convertPhaseLocationtoX(\n        this.movingObj.phaseLocation,\n        this.movingObj.id\n      );\n    },\n\n    endResize() {\n      if (!this.moving) {\n        return;\n      }\n      this.moving = false;\n      this.snapObject();\n      this.drawTrimmer();\n\n      this.startX = this.mouse.x;\n      this.moving = false;\n      this.movingObj = 'none';\n\n      this.$emit('update-slice', this.sliceObj);\n    },\n    updateCursor(curtype = 'default') {\n      this.canvasCursor = curtype;\n    },\n    /**\n     * Retrieves the key that comes after the given state in the object.\n     * @param {Object} obj - The object from which to retrieve the next key.\n     * @param {string} currentKey - The state to find the next state for.\n     * @returns {(string|boolean)} - The next state in the object, or false if not found or state is the last state.\n     */\n    getNextKey(obj, currentKey) {\n      const keys = Object.keys(obj);\n      const currentIndex = keys.indexOf(currentKey);\n\n      if (currentIndex === -1 || currentIndex === keys.length - 1) {\n        // If the current state is not found or it's the last state in the object\n        return false;\n      }\n\n      return keys[currentIndex + 1];\n    },\n\n    /**\n     * Retrieves the state that comes before the given state in the object.\n     * @param {Object} obj - The object from which to retrieve the previous state.\n     * @param {string} currentKey - The state to find the previous state for.\n     * @returns {(string|boolean)} - The previous state in the object, or false if not found or state is the first state.\n     */\n    getPreviousKey(obj, currentKey) {\n      const keys = Object.keys(obj);\n      const currentIndex = keys.indexOf(currentKey);\n\n      if (currentIndex <= 0) {\n        // If the current state is not found or it's the first state in the object\n        return false;\n      }\n\n      return keys[currentIndex - 1];\n    },\n    /**\n     * Handles the addition of a new label (systole, diastole)\n     *\n     * @param {string} id - The identifier of the label to be added ('systoles' or 'diastoles').\n     */\n    handleAddLabel(id) {\n      // Find the state where the user clicked\n      const stateHere = this.findStateUserClicked();\n\n      // Determine the phase based on the id parameter\n      const phase = id === 'systoles' ? 'Systole' : 'Diastole';\n\n      // Calculate the phase location and XLocation\n      const PhaseLocation = Math.floor(this.mouse.x / this.imgWidth) + 1; // Adding 1 since phase start at 1\n      const xlocation = this.convertPhaseLocationtoX(PhaseLocation);\n\n      // Create the new label object that will be added\n      const newLabel = {\n        id: phase,\n        state: stateHere,\n        phaseLocation: PhaseLocation,\n        XLocation: xlocation,\n      };\n\n      // Emit an event to add the label\n      this.$emit('add-label', {\n        id: this.sliceObj.id,\n        target: id,\n        state: stateHere,\n        newLabel,\n      });\n\n      // Redraw the trimmer component\n      this.drawTrimmer();\n    },\n\n    /**\n     * Handles a right-click event to show context menu.\n     *\n     * @param {MouseEvent} event - The right-click event object.\n     */\n    handleRightClick(event) {\n      // Set the x-coordinate where the new label will be added\n      this.addNewLabelX = event.offsetX;\n\n      // Update the mouse x-coordinate (needed to find the state at which the user clicked)\n      this.mouse.x = this.addNewLabelX;\n\n      // Check if a label is present at the clicked location\n      this.hasLabelOnClick = this.findIfLabelOnClick();\n\n      // If user clicked outside of a breathing state, then show an error:\n      if (this.hasLabelOnClick === 'error') {\n        this.$refs.menu.popError(event);\n        return;\n      }\n\n      // Otherwise open the context menu:\n      this.$refs.menu.openContextMenu(event);\n    },\n\n    /**\n     * Handles the removal of a label from cardiac cycle.\n     */\n    handleRemoveLabel() {\n      // Retrieve information about the label to be removed\n      const { state, foundLabel, foundIndex } = this.hasLabelOnClick;\n\n      // Identify the target array containing the label\n      const targetArray = this.sliceObj.states[state].cardiacCycles[foundLabel];\n\n      // Remove the label from the target array\n      const newArray = this.removeElementAtIndex(targetArray, foundIndex);\n\n      // Emit an event to update the removed label in the prop object\n      this.$emit('remove-label', {\n        id: this.sliceObj.id,\n        state,\n        cycle: foundLabel,\n        newArray,\n      });\n\n      // Redraw the trimmer component\n      this.drawTrimmer();\n    },\n    /**\n     * Removes an element at the specified index from the given array and returns a new array\n     * without modifying old array.\n     *\n     * @param {Array} arr - The input array from which an element needs to be removed.\n     * @param {number} index - The index of the element to be removed.\n     * @returns {Array} - A new array with the specified element removed.\n     * @throws {Error} - Throws an error if the index is out of the valid range of the array.\n     */\n    removeElementAtIndex(arr, index) {\n      // Check if the index is within the valid range of the array\n      if (index < 0 || index >= arr.length) {\n        throw new Error('Index is out of range');\n      }\n\n      // Create a new array without modifying the original array\n      const newArray = [...arr];\n\n      // Remove the element at the given index\n      newArray.splice(index, 1);\n\n      return newArray;\n    },\n    /**\n     * Converts a phase location to its corresponding X coordinate on the display.\n     * @param {number} pLocation - The phase location value.\n     * @param {string} id - Identifier indicating whether it's the 'start', 'end', or cardiac cycle.\n     * @returns {number} - The X coordinate corresponding to the given phase location.\n     */\n    convertPhaseLocationtoX(pLocation, id) {\n      let xLocation;\n\n      // Calculate X coordinate based on the provided phase location and identifier.\n      if (id === 'start') {\n        // For 'start' phase, adjust X coordinate considering image width.\n        xLocation = (pLocation - 1) * this.imgWidth;\n      } else if (id === 'end') {\n        // For 'end' phase, adjust X coordinate considering image and handler bar width.\n        xLocation = pLocation * this.imgWidth - this.handlerBarWidth;\n      } else {\n        // For cardiac phases, calculate X coordinate with respect to image width and label width.\n        const spaceX = (this.imgWidth - this.cardiacCyclesLabelWidth) / 2;\n        xLocation = (pLocation - 1) * this.imgWidth + spaceX;\n      }\n\n      // Return the calculated X coordinate.\n      return xLocation;\n    },\n\n    convertXLocationtoPhase(xLocation, id) {\n      let pLocation;\n      // let tempLocation = xLocation - this.imgWidth / 2;\n      // tempLocation = tempLocation < 0 ? 0 : tempLocation;\n\n      // Calculate X coordinate based on the provided phase location and identifier.\n      if (id === 'start') {\n        const tempLocation = xLocation + this.imgWidth / 2;\n        // For 'start' phase, adjust X coordinate considering image width.\n        pLocation = Math.floor(tempLocation / this.imgWidth) + 1;\n      } else if (id === 'end') {\n        // For 'end' phase, adjust X coordinate considering image and handler bar width.\n        const tempLocation = xLocation - this.imgWidth / 2;\n        pLocation = Math.floor(tempLocation / this.imgWidth) + 1;\n      } else {\n        // For cardiac phases, calculate X coordinate with respect to image width and label width.\n        const labelMidwayLoc = xLocation + this.cardiacCyclesLabelWidth / 2;\n        pLocation = Math.floor(labelMidwayLoc / this.imgWidth) + 1;\n        // pLocation = Math.floor(tempLocation / this.imgWidth);\n      }\n\n      // Return the calculated X coordinate.\n      return pLocation;\n    },\n\n    /**\n     * Helper Function that adds the XLocation property to the given object based on phaseLocation and id.\n     * @param {object} obj - The object to which XLocation will be added.\n     * @param {string} id - The identifier for the conversion (e.g., 'start', 'end').\n     */\n    addXLocation(obj, id) {\n      const target = obj;\n\n      // Calculate and assign the XLocation property using phaseLocation and id.\n      target.XLocation = this.convertPhaseLocationtoX(target.phaseLocation, id);\n    },\n\n    /**\n     * Iterates through the states in the sliceObj and adds XLocation properties.\n     * XLocation is calculated for start, end, diastole, and systole phases of cardiac cycles.\n     */\n    addXLocations() {\n      Object.entries(this.sliceObj.states).forEach(([state]) => {\n        const data = this.sliceObj.states[state];\n\n        // Add XLocation for start and end phases.\n        this.addXLocation(data.start, 'start');\n        this.addXLocation(data.end, 'end');\n\n        // Add XLocation for diastoles in cardiac cycles.\n        data.cardiacCycles.diastoles.forEach((diastole) =>\n          this.addXLocation(diastole)\n        );\n\n        // Add XLocation for systoles in cardiac cycles.\n        data.cardiacCycles.systoles.forEach((systole) =>\n          this.addXLocation(systole)\n        );\n      });\n    },\n  },\n};\n</script>\n\n<style scoped>\n.canvas {\n  background: black;\n}\n.horizontal-bar {\n  height: 60px;\n  position: relative;\n  transition: opacity 0.3s ease-out;\n}\n\n.horizontal-bar.hide {\n  opacity: 0;\n  user-select: none;\n  pointer-events: none;\n}\n\n.expandable-box {\n  position: absolute;\n  top: 0;\n  left: 10px; /* adjust this value to set the initial position of the box */\n  height: 20px; /* should match the bar height */\n  background-color: blue; /* customize the box background color */\n  transition: width 0.2s ease; /* add a smooth transition effect */\n}\n</style>\n","<template>\n  <div style=\"height: 284px\">\n    <div\n      class=\"strip\"\n      :style=\"{ width: maxWidth - 250 + 'px' }\"\n      ref=\"image-container\"\n      @mousewheel.passive=\"scrollX\"\n    >\n      <div class=\"video-trimmer-container\" ref=\"video-trimmer-container\">\n        <VideoTrimmer\n          :slice-obj=\"sliceObj\"\n          :BARHEIGHT=\"imageHeight\"\n          :BARWIDTH=\"videTrimWidth\"\n          :numImages=\"this.numImages\"\n          :imgWidth=\"imageWidth\"\n          :isHidden=\"!isHidden\"\n          ref=\"videotrimmer\"\n          @update-slice=\"handleUpdateSlice\"\n          @remove-label=\"handleRemoveLabel\"\n          @add-label=\"handleAddLabel\"\n        />\n      </div>\n\n      <div :style=\"{ height: heightHere + 'px' }\" ref=\"moviestripcont\">\n        <canvas ref=\"movieStripCanvas\"></canvas>\n      </div>\n      <Transition>\n        <div v-if=\"hideinfo\">\n          <ImageBarImageInfo\n            :numImages=\"this.numImages\"\n            :imgWidth=\"imageWidth\"\n            :imgHeight=\"heightHere\"\n          />\n        </div>\n      </Transition>\n    </div>\n  </div>\n  <ImageStripSlider\n    :numImages=\"this.numImages\"\n    :imgWidth=\"imageWidth\"\n    :slice-obj=\"sliceObj\"\n    :canvasWidth=\"maxWidth - 250\"\n    @updateDone=\"drawMovieStrip\"\n    @move=\"moveX\"\n    ref=\"sliderBar\"\n  />\n</template>\n\n<script>\nimport ImageBarImageInfo from './ImageBarImageInfo.vue';\nimport ImageStripSlider from './ImageStripSlider.vue';\nimport VideoTrimmer from './VideoTrimmer.vue';\n\nexport default {\n  components: {\n    ImageStripSlider,\n    VideoTrimmer,\n    ImageBarImageInfo,\n  },\n  emits: ['newstate', 'update-slice', 'remove-label', 'add-label'],\n  props: {\n    currentState: { type: String, default: 'FREEBREATHING' },\n    maxWidth: { type: Number, default: 1560 },\n    isHidden: { type: Boolean, default: true },\n    hideinfo: { type: Boolean, required: true, default: true },\n    numImages: {\n      type: Number,\n      default: 100,\n    },\n    id: { type: String },\n    sliceObj: { type: Object, required: true },\n  },\n  data() {\n    return {\n      imageWidth: 286,\n      requestId: null,\n      videTrimWidth: null,\n      imageHeight: 284,\n      imageRatio: 0,\n      originalImageWidth: 0,\n      imageHeightWidthRatio: 0,\n      heightHere: 284,\n      viewState: 'FREEBREATHING',\n    };\n  },\n  created() {\n    this.videTrimWidth = this.imageWidth * this.numImages;\n  },\n  mounted() {\n    const imgTemp = new Image();\n    imgTemp.src = './images/test.png';\n\n    imgTemp.onload = () => {\n      this.imageHeightWidthRatio = imgTemp.naturalHeight / imgTemp.naturalWidth;\n      this.imageHeight = this.imageWidth * this.imageHeightWidthRatio;\n      this.$refs.videotrimmer.barHeight = this.imageHeight;\n    };\n\n    imgTemp.onerror = () => {\n      console.error('Failed to load the image.');\n    };\n\n    this.drawMovieStrip();\n\n    setTimeout(() => {\n      this.$emit('loaded');\n    }, 1500);\n  },\n  methods: {\n    drawMovieStrip() {\n      // Access the canvas element\n      const canvas = this.$refs.movieStripCanvas;\n      const context = canvas.getContext('2d');\n      const { numImages } = this;\n\n      canvas.width = this.imageWidth * numImages;\n      canvas.height = this.imageHeight;\n      this.videTrimWidth = canvas.width;\n\n      // Clear the visible canvas\n      context.clearRect(0, 0, canvas.width, canvas.height);\n\n      // Draw your images on the offscreen canvas\n      const images = Array(numImages).fill('./images/test.png');\n      const { imageWidth } = this;\n\n      let x = 0;\n\n      // Create a list of image loading promises\n      const imagePromises = images.map((image) => {\n        return new Promise((resolve, reject) => {\n          const img = new Image();\n          img.src = image; // Use the correct path to the image\n\n          img.onload = () => {\n            resolve(img); // Resolve the promise with the loaded image\n          };\n\n          img.onerror = (error) => {\n            reject(error); // Reject the promise on image loading error\n          };\n        });\n      });\n\n      // Wait for all images to load before drawing them\n      Promise.all(imagePromises)\n        .then((loadedImages) => {\n          loadedImages.forEach((img) => {\n            // this.imageHeight =\n            //   img.naturalHeight / (img.naturalWidth / imageWidth);\n            // this.originalImageWidth = img.naturalWidth;\n\n            context.drawImage(img, x, 0, imageWidth, this.imageHeight);\n\n            x += imageWidth;\n          });\n        })\n        .catch((error) => {\n          console.error(error); // Handle image loading errors\n        });\n    },\n\n    scrollX(e) {\n      const container = 'image-container';\n      const containerElement = this.$refs[container];\n\n      // Check if the Ctrl key is being held\n      if (e.ctrlKey) {\n        containerElement.scrollLeft += e.deltaY * 2.5;\n        // You can add any other actions you want to perform when Ctrl key is held during scrolling.\n      } else {\n        // Perform the scrolling action as before\n        containerElement.scrollLeft += e.deltaY / 4;\n      }\n\n      // Update the sliderBar instance\n      const slideInstance = this.$refs.sliderBar;\n      slideInstance.updatePosition(\n        (100 * containerElement.scrollLeft) / containerElement.scrollWidth\n      );\n      this.getScrollState();\n    },\n\n    moveX(dx) {\n      const container = `image-container`;\n      this.$refs[container].scrollLeft =\n        this.$refs[container].scrollWidth * (dx / 100);\n      this.getScrollState();\n    },\n    getScrollState() {\n      const states = ['FREEBREATHING', 'HYPERVENTILATION', 'BREATHHOLD'];\n\n      const videoTrimObject = this.sliceObj;\n      const scrollCont = this.$refs[`image-container`].scrollLeft;\n\n      if (\n        videoTrimObject.states[this.viewState].start.XLocation < scrollCont &&\n        scrollCont < videoTrimObject.states[this.viewState].end.XLocation\n      ) {\n        // Do nothing, already in the correct state\n      } else {\n        const newState = states.find(\n          (state) => scrollCont < videoTrimObject.states[state].end.XLocation\n        );\n\n        if (newState) {\n          this.viewState = newState;\n          this.$emit('newstate', this.viewState);\n        }\n      }\n    },\n    scrollAnimation(containerElement, scrollAmount) {\n      const targetElement = containerElement;\n      const start = targetElement.scrollLeft;\n      // const end = start + scrollAmount;\n      const duration = 300; // Animation duration in milliseconds (adjust as needed)\n      let startTime;\n\n      function step(timestamp) {\n        if (!startTime) startTime = timestamp;\n        const progress = timestamp - startTime;\n        const percentage = Math.min(progress / duration, 1);\n\n        targetElement.scrollLeft = start + scrollAmount * percentage;\n\n        if (percentage < 1) {\n          requestAnimationFrame(step);\n        }\n      }\n\n      requestAnimationFrame(step);\n    },\n    scrollToState(state) {\n      const containerElement = this.$refs['image-container'];\n\n      const newloc = this.sliceObj.states[state].start.XLocation;\n\n      const ds = newloc - containerElement.scrollLeft;\n\n      // Update the sliderBar instance\n      this.scrollAnimation(containerElement, ds);\n\n      const slideInstance = this.$refs.sliderBar;\n      slideInstance.updatePosition(\n        (100 * newloc) / containerElement.scrollWidth\n      );\n    },\n\n    handleUpdateSlice(slice) {\n      this.$emit('update-slice', slice);\n      this.$refs.sliderBar.drawCanvas();\n    },\n    handleRemoveLabel(obj) {\n      this.$emit('remove-label', obj);\n    },\n    handleAddLabel(obj) {\n      this.$emit('add-label', obj);\n    },\n  },\n};\n</script>\n\n<style scoped>\n.strip {\n  overflow: hidden;\n  overflow-y: hidden;\n  scrollbar-width: none; /* Hide the scrollbar in modern browsers */\n  -ms-overflow-style: none;\n  border-radius: 2px;\n  display: grid;\n  grid-template-columns: 1fr;\n  transform: all 0.3s;\n}\n\n.strip div {\n  grid-row-start: 1;\n  grid-column-start: 1;\n}\n\n.video-trimmer-container {\n  overflow: hidden;\n  overflow-y: hidden;\n  scrollbar-width: none; /* Hide the scrollbar in modern browsers */\n  -ms-overflow-style: none;\n}\n\n.slidecontainer {\n  width: 100%; /* Width of the outside container */\n}\n\n.slider {\n  width: 100%;\n}\n\n.v-enter-active,\n.v-leave-active {\n  transition: opacity 0.5s ease;\n}\n\n.v-enter-from,\n.v-leave-to {\n  opacity: 0;\n}\n</style>\n","<template>\r\n  <div\r\n    @click=\"handleclick\"\r\n    class=\"circle2\"\r\n    :class=\"{ clicked: status }\"\r\n    @keydown.space.prevent=\"handleKeyDown\"\r\n  >\r\n    <div :class=\"{ clicked: status }\" class=\"icon-container\">\r\n      <img\r\n        :src=\"'/icons/' + iconSource + '.svg'\"\r\n        :style=\"{ height: iconHeight + 'px' }\"\r\n        alt=\"Icon\"\r\n      />\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  props: {\r\n    iconSource: { type: String, default: 'input-cursor' },\r\n    id: { type: Number },\r\n    status: { type: Boolean, default: true },\r\n    iconHeight: { type: Number, default: 30 },\r\n  },\r\n  methods: {\r\n    handleclick() {\r\n      this.$emit('toggleVisibility', this.status);\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.circle2 {\r\n  border-radius: 50px;\r\n  background-color: #00000030;\r\n  height: 48px;\r\n  width: 48px;\r\n  cursor: pointer;\r\n  margin-top: 5px;\r\n  margin-bottom: 8px;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  transition: all 0.3s ease-in-out;\r\n}\r\n\r\n.circle2:hover {\r\n  background-color: #70707030;\r\n}\r\n\r\n.circle2.clicked {\r\n  background-color: #70707040;\r\n}\r\n\r\n.icon-container {\r\n  display: flex;\r\n  align-content: center;\r\n  justify-content: center;\r\n  cursor: pointer;\r\n  opacity: 1;\r\n  filter: invert(99%) sepia(93%) saturate(3%) hue-rotate(254deg)\r\n    brightness(106%) contrast(100%);\r\n  transition: all 0.3s ease-in-out;\r\n}\r\n\r\n.icon-container.clicked {\r\n  opacity: 1;\r\n  filter: invert(57%) sepia(95%) saturate(558%) hue-rotate(359deg)\r\n    brightness(101%) contrast(107%);\r\n}\r\n</style>\r\n","<template>\r\n  <div class=\"cards\" :style=\"{ flexDirection: flexDirection }\">\r\n    <div\r\n      v-for=\"item in count\"\r\n      :key=\"item\"\r\n      class=\"card is-loading\"\r\n      :style=\"{\r\n        width: givenWidth + 'px',\r\n        height: givenHeight + 'px',\r\n        borderRadius: radius + 'px',\r\n      }\"\r\n    ></div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  props: {\r\n    givenWidth: { type: Number },\r\n    givenHeight: { type: Number },\r\n    count: { type: Number, default: 1 },\r\n    flexDirection: { type: String, default: 'column' },\r\n    radius: { type: Number, default: 5 },\r\n  },\r\n};\r\n</script>\r\n\r\n<style>\r\n.cards {\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: space-between;\r\n  gap: 5px;\r\n}\r\n\r\n.card {\r\n  box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);\r\n}\r\n\r\n.card.is-loading {\r\n  background: #eee;\r\n  background: linear-gradient(\r\n    110deg,\r\n    #79cfde38 8%,\r\n    #7ed7e738 20%,\r\n    #79cfde38 33%\r\n  );\r\n  background-size: 200% 100%;\r\n  animation: shine 1s linear infinite;\r\n}\r\n\r\n@keyframes shine {\r\n  to {\r\n    background-position-x: -200%;\r\n  }\r\n}\r\n</style>\r\n","<template>\r\n  <div class=\"slice\">\r\n    <div class=\"state-control\">\r\n      <SquareLoader :given-width=\"100\" :givenHeight=\"35\" />\r\n      <br />\r\n\r\n      <SquareLoader\r\n        :given-width=\"45\"\r\n        :givenHeight=\"45\"\r\n        :count=\"3\"\r\n        flexDirection=\"row\"\r\n        :radius=\"50\"\r\n      />\r\n      <br />\r\n      <SquareLoader :given-width=\"180\" :givenHeight=\"65\" :count=\"3\" />\r\n    </div>\r\n    <div style=\"overflow: hidden\">\r\n      <SquareLoader\r\n        :given-width=\"284\"\r\n        :givenHeight=\"250\"\r\n        :count=\"Math.floor((allowedWidth - 250) / 284) + 1\"\r\n        flexDirection=\"row\"\r\n      />\r\n      <br />\r\n      <SquareLoader :given-width=\"allowedWidth - 270\" :givenHeight=\"44\" />\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport SquareLoader from './SquareLoader.vue';\r\n\r\nexport default {\r\n  props: {\r\n    allowedWidth: { type: Number },\r\n  },\r\n\r\n  components: {\r\n    SquareLoader,\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.slice {\r\n  border-radius: 11px;\r\n  background-color: rgba(0, 0, 0, 0.4);\r\n  max-height: 400px;\r\n  display: flex;\r\n  padding: 35px;\r\n\r\n  gap: 20px;\r\n}\r\n</style>\r\n","<template>\r\n  <SkeletonLoaderCBS v-show=\"loading\" :allowedWidth=\"allowedWidth\" />\r\n  <Transition name=\"slide-fade\">\r\n    <div\r\n      v-show=\"!loading\"\r\n      class=\"slice\"\r\n      :style=\"{ width: allowedWidth + 'px' }\"\r\n    >\r\n      <div class=\"state-control\">\r\n        <h1 class=\"slice-name\">{{ sliceInfo.name }}</h1>\r\n        <div class=\"toggle-icons-container\">\r\n          <IconToggleQA\r\n            :id=\"sliceInfo.id\"\r\n            @toggleVisibility=\"$emit('toggle-trimmer', sliceInfo.id)\"\r\n            iconSource=\"adjust-trim\"\r\n            :status=\"sliceInfo.imgBarProperties.showTrimmer\"\r\n          />\r\n          <IconToggleQA\r\n            :id=\"sliceInfo.id\"\r\n            @toggleVisibility=\"$emit('toggle-patient-info', sliceInfo.id)\"\r\n            iconSource=\"hide-bottom\"\r\n            :status=\"sliceInfo.imgBarProperties.showPatientInfo\"\r\n          />\r\n          <IconToggleQA\r\n            :id=\"sliceInfo.id\"\r\n            :status=\"sliceInfo.imgBarProperties.showGraph\"\r\n            iconSource=\"show-contours\"\r\n            @toggleVisibility=\"$emit('toggle-graph', sliceInfo.id)\"\r\n          />\r\n        </div>\r\n        <div class=\"state-buttons\">\r\n          <StateButtons\r\n            :id=\"sliceInfo.id\"\r\n            :heartrate=\"stateButtons.FREEBREATHING.heartrate\"\r\n            :duration=\"stateButtons.FREEBREATHING.duration\"\r\n            :state=\"'FREE BREATHING'\"\r\n            :is-active=\"stateButtons.currentState === 'FREEBREATHING'\"\r\n            @state-change=\"handleStateChange\"\r\n          />\r\n          <StateButtons\r\n            :id=\"sliceInfo.id\"\r\n            :heartrate=\"stateButtons.HYPERVENTILATION.heartrate\"\r\n            :duration=\"stateButtons.HYPERVENTILATION.duration\"\r\n            :state=\"'HYPERVENTILATION'\"\r\n            :is-active=\"stateButtons.currentState === 'HYPERVENTILATION'\"\r\n            :stateColor=\"stateButtons.HYPERVENTILATION.stateColor\"\r\n            @state-change=\"handleStateChange\"\r\n          />\r\n\r\n          <StateButtons\r\n            :id=\"sliceInfo.id\"\r\n            :heartrate=\"stateButtons.BREATHHOLD.heartrate\"\r\n            :duration=\"stateButtons.BREATHHOLD.duration\"\r\n            :state=\"'BREATHHOLD'\"\r\n            :is-active=\"stateButtons.currentState === 'BREATHHOLD'\"\r\n            :stateColor=\"stateButtons.BREATHHOLD.stateColor\"\r\n            @state-change=\"handleStateChange\"\r\n          />\r\n        </div>\r\n      </div>\r\n      <div class=\"movie-strip\">\r\n        <ImageBar\r\n          :id=\"sliceInfo.sliceOBJ.id\"\r\n          :isHidden=\"sliceInfo.imgBarProperties.showTrimmer\"\r\n          :hideinfo=\"sliceInfo.imgBarProperties.showPatientInfo\"\r\n          :slice-obj=\"sliceInfo.sliceOBJ\"\r\n          :currentState=\"stateButtons.currentState\"\r\n          :maxWidth=\"allowedWidth\"\r\n          ref=\"imgBar\"\r\n          @newstate=\"handleNewState\"\r\n          @update-slice=\"handleUpdateSlice\"\r\n          @remove-label=\"handleRemoveLabel\"\r\n          @add-label=\"handleAddLabel\"\r\n          @loaded=\"loading = false\"\r\n        />\r\n      </div>\r\n    </div>\r\n  </Transition>\r\n</template>\r\n\r\n<script>\r\nimport StateButtons from './StateButtons.vue';\r\nimport ImageBar from './ImageBar.vue';\r\nimport IconToggleQA from './IconToggleQA.vue';\r\nimport SkeletonLoaderCBS from './SkeletonLoaderCBS.vue';\r\n\r\nexport default {\r\n  components: {\r\n    StateButtons,\r\n    ImageBar,\r\n    IconToggleQA,\r\n    SkeletonLoaderCBS,\r\n  },\r\n  props: {\r\n    sliceInfo: { type: Object },\r\n  },\r\n  data() {\r\n    return {\r\n      stateButtons: this.sliceInfo.stateButtons,\r\n      allowedWidth: null,\r\n      loading: true,\r\n    };\r\n  },\r\n  methods: {\r\n    handleStateChange(state) {\r\n      const cleanState = state.replace(/\\s/g, '');\r\n      this.$emit('state-change', cleanState);\r\n      this.$refs.imgBar.scrollToState(cleanState);\r\n    },\r\n\r\n    handleNewState(state) {\r\n      this.$emit('state-change', state);\r\n    },\r\n    handleUpdateSlice(newSlice) {\r\n      this.$emit('update-slice', newSlice);\r\n    },\r\n    handleRemoveLabel(obj) {\r\n      this.$emit('remove-label', obj);\r\n    },\r\n    handleAddLabel(obj) {\r\n      this.$emit('add-label', obj);\r\n    },\r\n    handleResize() {\r\n      this.allowedWidth = window.innerWidth - 100;\r\n\r\n      if (this.allowedWidth > 2000) {\r\n        this.allowedWidth = 2000;\r\n      }\r\n    },\r\n  },\r\n  created() {\r\n    window.addEventListener('resize', this.handleResize);\r\n    this.handleResize();\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.slice {\r\n  border-radius: 11px;\r\n  background-color: rgba(0, 0, 0, 0.4);\r\n  max-height: 400px;\r\n  display: flex;\r\n  padding: 35px;\r\n\r\n  gap: 20px;\r\n}\r\n\r\n.slice-name {\r\n  font-size: 24px;\r\n  line-height: 35px;\r\n}\r\n.slices-containers {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 6px;\r\n  /* max-width: 95vw; */\r\n}\r\n\r\n.toggle-icons-container {\r\n  display: flex;\r\n  flex-direction: row;\r\n  justify-content: space-between;\r\n}\r\n\r\n.state-buttons {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 10px;\r\n}\r\n\r\n.movie-strip {\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.slide-fade-enter-active {\r\n  transition: all 0.3s ease-in;\r\n}\r\n\r\n.slide-fade-leave-active {\r\n  transition: all 0.2s cubic-bezier(1, 0.5, 0.8, 1);\r\n}\r\n\r\n.slide-fade-enter-from,\r\n.slide-fade-leave-to {\r\n  opacity: 0;\r\n}\r\n\r\n@media (max-height: 850px) {\r\n  .slice {\r\n    padding-bottom: 10px;\r\n    padding-top: 10px;\r\n  }\r\n}\r\n\r\n@media (max-height: 800px) {\r\n  .slice {\r\n    padding-bottom: 5px;\r\n    padding-top: 5px;\r\n  }\r\n}\r\n</style>\r\n","<template>\n  <div class=\"slices-containers\">\n    <BreathingSplitRow\n      :slice-info=\"sliceInfo1\"\n      @toggle-trimmer=\"\n        sliceInfo1.imgBarProperties.showTrimmer =\n          !sliceInfo1.imgBarProperties.showTrimmer\n      \"\n      @toggle-patient-info=\"\n        sliceInfo1.imgBarProperties.showPatientInfo =\n          !sliceInfo1.imgBarProperties.showPatientInfo\n      \"\n      @toggle-graph=\"\n        sliceInfo1.imgBarProperties.showGraph =\n          !sliceInfo1.imgBarProperties.showGraph\n      \"\n      @state-change=\"sliceInfo1.stateButtons.currentState = $event\"\n      @update-slice=\"handleUpdateSlice\"\n      @remove-label=\"handleRemoveLabel\"\n      @add-label=\"handleAddLabel\"\n    />\n\n    <BreathingSplitRow\n      :slice-info=\"sliceInfo2\"\n      @toggle-trimmer=\"\n        sliceInfo2.imgBarProperties.showTrimmer =\n          !sliceInfo2.imgBarProperties.showTrimmer\n      \"\n      @toggle-patient-info=\"\n        sliceInfo2.imgBarProperties.showPatientInfo =\n          !sliceInfo2.imgBarProperties.showPatientInfo\n      \"\n      @toggle-graph=\"\n        sliceInfo2.imgBarProperties.showGraph =\n          !sliceInfo2.imgBarProperties.showGraph\n      \"\n      @state-change=\"sliceInfo2.stateButtons.currentState = $event\"\n      @update-slice=\"handleUpdateSlice\"\n      @remove-label=\"handleRemoveLabel\"\n      @add-label=\"handleAddLabel\"\n    />\n  </div>\n</template>\n\n<script>\nimport BreathingSplitRow from './BreathingSplitRow.vue';\n\nexport default {\n  components: {\n    BreathingSplitRow,\n  },\n  data() {\n    return {\n      caseObj: {\n        slice1: {\n          id: 'slice1',\n          states: {\n            FREEBREATHING: {\n              color: '#79CFDE',\n              start: {\n                id: 'start',\n                state: 'FREEBREATHING',\n                phaseLocation: 1,\n              },\n              end: {\n                id: 'end',\n                state: 'FREEBREATHING',\n                phaseLocation: 4,\n              },\n              cardiacCycles: {\n                systoles: [\n                  {\n                    id: 'Systole',\n                    state: 'FREEBREATHING',\n                    phaseLocation: 1,\n                  },\n                  {\n                    id: 'Systole',\n                    state: 'FREEBREATHING',\n                    phaseLocation: 2,\n                  },\n                ],\n                diastoles: [\n                  {\n                    id: 'Diastole',\n                    state: 'FREEBREATHING',\n                    phaseLocation: 3,\n                  },\n                ],\n              },\n            },\n            HYPERVENTILATION: {\n              color: '#C24ABC',\n              start: {\n                id: 'start',\n                state: 'HYPERVENTILATION',\n                phaseLocation: 5,\n              },\n              end: {\n                id: 'end',\n                state: 'HYPERVENTILATION',\n                phaseLocation: 20,\n              },\n              cardiacCycles: {\n                systoles: [\n                  {\n                    id: 'Systole',\n                    state: 'HYPERVENTILATION',\n                    phaseLocation: 5,\n                  },\n                ],\n                diastoles: [\n                  {\n                    id: 'Diastole',\n                    state: 'HYPERVENTILATION',\n                    phaseLocation: 6,\n                  },\n                ],\n              },\n            },\n            BREATHHOLD: {\n              color: '#d95476',\n              start: {\n                id: 'start',\n                state: 'BREATHHOLD',\n                phaseLocation: 21,\n              },\n              end: {\n                id: 'end',\n                state: 'BREATHHOLD',\n                phaseLocation: 30,\n              },\n              cardiacCycles: {\n                systoles: [\n                  {\n                    id: 'Systole',\n                    state: 'BREATHHOLD',\n                    phaseLocation: 25,\n                  },\n                ],\n                diastoles: [\n                  {\n                    id: 'Diastole',\n                    state: 'BREATHHOLD',\n                    phaseLocation: 28,\n                  },\n                ],\n              },\n            },\n          },\n        },\n        slice2: {\n          id: 'slice2',\n          states: {\n            FREEBREATHING: {\n              color: '#79CFDE',\n              start: {\n                id: 'start',\n                state: 'FREEBREATHING',\n                phaseLocation: 1,\n              },\n              end: {\n                id: 'end',\n                state: 'FREEBREATHING',\n                phaseLocation: 10,\n              },\n              cardiacCycles: {\n                systoles: [\n                  {\n                    id: 'Systole',\n                    state: 'FREEBREATHING',\n                    phaseLocation: 3,\n                  },\n                ],\n                diastoles: [\n                  {\n                    id: 'Diastole',\n                    state: 'FREEBREATHING',\n                    phaseLocation: 5,\n                  },\n                ],\n              },\n            },\n            HYPERVENTILATION: {\n              color: '#C24ABC',\n              start: {\n                id: 'start',\n                state: 'HYPERVENTILATION',\n                phaseLocation: 11,\n              },\n              end: {\n                id: 'end',\n                state: 'HYPERVENTILATION',\n                phaseLocation: 30,\n              },\n              cardiacCycles: {\n                systoles: [\n                  {\n                    id: 'Systole',\n                    state: 'HYPERVENTILATION',\n                    phaseLocation: 12,\n                  },\n                ],\n                diastoles: [\n                  {\n                    id: 'Diastole',\n                    state: 'HYPERVENTILATION',\n                    phaseLocation: 20,\n                  },\n                ],\n              },\n            },\n            BREATHHOLD: {\n              color: '#d95476',\n              start: {\n                id: 'start',\n                state: 'BREATHHOLD',\n                phaseLocation: 31,\n              },\n              end: {\n                id: 'end',\n                state: 'BREATHHOLD',\n                phaseLocation: 80,\n              },\n              cardiacCycles: {\n                systoles: [\n                  {\n                    id: 'Systole',\n                    state: 'BREATHHOLD',\n                    phaseLocation: 35,\n                  },\n                ],\n                diastoles: [\n                  {\n                    id: 'Diastole',\n                    state: 'BREATHHOLD',\n                    phaseLocation: 60,\n                  },\n                ],\n              },\n            },\n          },\n        },\n      },\n      sliceInfo1: {\n        name: 'SLICE 1',\n        id: 1,\n        sliceOBJ: null,\n        stateButtons: {\n          currentState: 'FREEBREATHING',\n          FREEBREATHING: {\n            state: 'FREEBREATHING',\n            heartrate: 80,\n            duration: '01:32',\n            stateColor: '#E242E6',\n          },\n          HYPERVENTILATION: {\n            state: 'HYPERVENTILATION',\n            heartrate: 120,\n            duration: '02:32',\n            stateColor: '#E242E6',\n          },\n          BREATHHOLD: {\n            state: 'BREATHHOLD',\n            heartrate: 70,\n            duration: '00:32',\n            stateColor: '#D95476',\n          },\n        },\n        imgBarProperties: {\n          showTrimmer: true,\n          showPatientInfo: true,\n          showGraph: false,\n        },\n      },\n      sliceInfo2: {\n        name: 'SLICE 2',\n        id: 2,\n        sliceOBJ: null,\n        stateButtons: {\n          currentState: 'FREEBREATHING',\n          FREEBREATHING: {\n            state: 'FREEBREATHING',\n            heartrate: 50,\n            duration: '01:32',\n            stateColor: '#E242E6',\n          },\n          HYPERVENTILATION: {\n            state: 'HYPERVENTILATION',\n            heartrate: 60,\n            duration: '01:32',\n            stateColor: '#E242E6',\n          },\n          BREATHHOLD: {\n            state: 'BREATHHOLD',\n            heartrate: 125,\n            duration: '01:32',\n            stateColor: '#D95476',\n          },\n        },\n        imgBarProperties: {\n          showTrimmer: true,\n          showPatientInfo: true,\n          showGraph: false,\n        },\n      },\n    };\n  },\n  methods: {\n    handleUpdateSlice(newSlice) {\n      const targetSlice = newSlice.id;\n      this.caseObj[targetSlice] = newSlice;\n    },\n    handleRemoveLabel(obj) {\n      this.caseObj[obj.id].states[obj.state].cardiacCycles[obj.cycle] =\n        obj.newArray;\n    },\n    handleAddLabel(obj) {\n      this.caseObj[obj.id].states[obj.state].cardiacCycles[obj.target].push(\n        obj.newLabel\n      );\n    },\n  },\n  created() {\n    this.sliceInfo1.sliceOBJ = this.caseObj.slice1;\n    this.sliceInfo2.sliceOBJ = this.caseObj.slice2;\n  },\n};\n</script>\n\n<style scoped>\n.slices-containers {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n  max-width: 95vw;\n}\n</style>\n","<template>\n  <div class=\"qualitycontainer\">\n    <div :class=\"{ loaded: 1 }\" class=\"comp-container\">\n      <transition name=\"fade\">\n        <component :is=\"currentComponent\" />\n      </transition>\n    </div>\n    <!-- <div v-if=\"loading\">\n      <LoadingScreen />\n    </div> -->\n  </div>\n</template>\n\n<script>\n// import ScreenTemp from '../components/ScreenTemp.vue';\nimport CheckBreathingSplits from '../components/CheckBreathingSplits.vue';\nimport CheckContours from '../components/CheckContours.vue';\nimport LoadingScreen from '../components/LoadingScreen.vue';\n\nexport default {\n  components: {\n    CheckBreathingSplits,\n    CheckContours,\n    LoadingScreen,\n  },\n\n  data() {\n    return {\n      currentComponent: 'CheckBreathingSplits',\n    };\n  },\n  methods: {\n    handleButtonClicked(id) {\n      this.activeButton = id;\n    },\n    // handleloaded(status) {\n    //   this.loading = !status;\n    // },\n    toggleComponent(newComponent) {\n      this.currentComponent = newComponent;\n    },\n  },\n\n  mounted() {\n    const currentQaView = window.sessionStorage.getItem('currentQaView');\n    if (currentQaView) {\n      this.currentComponent = currentQaView;\n    } else {\n      this.currentComponent = 'CheckBreathingSplits';\n    }\n\n    // if (currentQaView) {\n    //   this.currentComponent = currentQaView;\n    // }\n  },\n\n  // watch: {\n  //   currentComponent() {},\n  // },\n  // Other component code\n};\n</script>\n\n<style scoped>\n.qualitycontainer {\n  padding: 1px;\n}\n\n.fade-enter-from {\n  opacity: 0;\n  transform: scale(0.97);\n}\n.fade-enter-to {\n  opacity: 1;\n}\n\n.fade-enter-active {\n  transition: all 0.5s ease;\n}\n\n.comp-container {\n  display: none;\n}\n.comp-container.loaded {\n  display: block;\n}\n</style>\n","<template>\n  <div\n    class=\"logo-holder\"\n    @click=\"openImageDialog\"\n    @dragenter=\"handleDragOver\"\n    @dragover=\"handleDragOver\"\n    @drop=\"handleImageDrop\"\n    @dragleave=\"handleDragLeave\"\n    ref=\"logoContainer\"\n    @keydown.space.prevent=\"handleKeyDown\"\n  >\n    <img\n      v-if=\"imageSource\"\n      :src=\"imageSource\"\n      alt=\"Uploaded Logo\"\n      :style=\"{ cursor: 'pointer' }\"\n    />\n    <div\n      class=\"place-holder\"\n      :class=\"{ hover: hovering }\"\n      v-if=\"editable && !imageSource\"\n    >\n      <h4 @dragover=\"handleDragOver\">Click or Drop Logo</h4>\n    </div>\n\n    <input\n      ref=\"imageInput\"\n      type=\"file\"\n      style=\"display: none\"\n      accept=\"image/*\"\n      @change=\"handleImageChange\"\n      aria-labelledby=\"logoImageInput\"\n    />\n  </div>\n</template>\n\n<script>\nexport default {\n  props: {\n    editable: { type: Boolean },\n  },\n  data() {\n    return {\n      imageSource: null,\n\n      hovering: false,\n    };\n  },\n  methods: {\n    openImageDialog() {\n      this.$refs.imageInput.click();\n    },\n    handleImageChange(event) {\n      this.uploadImage(event.target.files[0]);\n    },\n    handleImageDrop(event) {\n      event.preventDefault();\n      const file = event.dataTransfer.files[0];\n      this.uploadImage(file);\n    },\n    handleDragOver(event) {\n      event.preventDefault();\n\n      this.hovering = true;\n    },\n    handleDragLeave() {\n      this.hovering = false;\n    },\n    uploadImage(file) {\n      if (file) {\n        const reader = new FileReader();\n        reader.onloadend = () => {\n          this.imageSource = reader.result;\n        };\n        reader.readAsDataURL(file);\n      }\n    },\n  },\n};\n</script>\n\n<style scoped>\n.logo-holder {\n  display: flex;\n  width: 200px;\n  height: 70px;\n  align-self: center;\n  align-items: center;\n  justify-content: center;\n\n  cursor: pointer;\n  overflow: hidden;\n}\n\nimg {\n  max-width: 100%;\n  max-height: 100%;\n}\n\n.place-holder {\n  display: flex;\n  color: #229ed7;\n  height: 70%;\n  width: 100%;\n  align-items: center;\n  justify-content: center;\n  gap: 5px;\n\n  border-radius: 15px;\n  /* From https://css.glass */\n  background: rgba(0, 0, 0, 0.06);\n  border-radius: 10px;\n  transition: all 0.3s ease-out;\n}\n\n.place-holder:hover {\n  height: 85%;\n\n  color: rgb(35, 156, 212);\n  border: 1px solid #229ed7;\n}\n\n.hover {\n  height: 85%;\n\n  color: rgb(35, 156, 212);\n  border: 2px dashed #229ed7;\n}\n\n/* Additional styling can be added here if needed */\n</style>\n","<template>\n  <div v-if=\"editable\" class=\"select\">\n    <select\n      :id=\"id\"\n      required\n      @change=\"onOptionSelected($event)\"\n      aria-labelledby=\"dropDownComponentinReportElement\"\n    >\n      <option value=\"\" disabled selected>Select...</option>\n      <option\n        v-for=\"(option, index) in options\"\n        :key=\"index\"\n        :value=\"option.value\"\n      >\n        {{ option.label }}\n      </option>\n    </select>\n  </div>\n  <h5 class=\"selected-option\" v-else>{{ selectedOption }}</h5>\n</template>\n\n<script>\nexport default {\n  props: {\n    id: {\n      type: String,\n      required: true,\n    },\n    options: {\n      type: Array,\n      required: true,\n    },\n    editable: { type: Boolean, default: true },\n  },\n  data() {\n    return {\n      selectedOption: 'Select...',\n    };\n  },\n  methods: {\n    onOptionSelected(event) {\n      const selectedValue = event.target.value;\n      this.selectedOption = selectedValue;\n      this.$emit('option-selected', this.id, selectedValue);\n    },\n  },\n};\n</script>\n\n<style scoped>\n.selected-option {\n  line-height: 22px;\n  align-self: center;\n  color: black;\n  font-size: 13px;\n  font-weight: bold;\n}\n.select {\n  position: relative;\n  width: 100px;\n\n  color: black;\n  display: flex;\n  /* justify-content: center; */\n}\n\nselect {\n  color: black;\n  height: 22px;\n}\n\n.select select {\n  appearance: none;\n  -webkit-appearance: none;\n  padding: 0px 20px 3px 5px;\n  width: 100%;\n  border: 1px solid #e8eaed;\n  border-radius: 5px;\n  background: white;\n  box-shadow: 0 1px 3px -2px #9098a9;\n  cursor: pointer;\n  font-family: inherit;\n  font-size: 14px;\n  transition: all 150ms ease;\n}\n\n.select select:required:invalid {\n  color: #5a667f;\n}\n\n.select select option {\n  color: #223254;\n}\n\n.select select option[value=''][disabled] {\n  display: none;\n}\n\n.select select:focus {\n  outline: none;\n  border-color: #0077ff;\n}\n\n.select select:hover + svg {\n  stroke: #0077ff;\n}\n</style>\n","<template>\n  <div\n    id=\"image-container\"\n    :class=\"{ moving: moveMode, hover: hovering }\"\n    :style=\"{ height: height + 'px', width: width + 'pt' }\"\n    @dragenter=\"handleDragOver\"\n    @dragover=\"handleDragOver\"\n    @drop=\"handleImageDrop\"\n    @dragleave=\"handleDragLeave\"\n  >\n    <div v-if=\"editable\" class=\"buttons\">\n      <div\n        class=\"upload-button\"\n        title=\"Upload File\"\n        alt=\"Upload File\"\n        style=\"position: relative\"\n      >\n        <button class=\"upload-buttons upload-image\" @click=\"openFilePicker\">\n          <i class=\"fas fa-upload fa-lg\" style=\"color: #ffffff\"></i>\n        </button>\n        <input\n          type=\"file\"\n          ref=\"imageLoaderInput\"\n          name=\"imageLoader\"\n          style=\"display: none\"\n          accept=\"image/*\"\n          @change=\"uploadImage\"\n          aria-labelledby=\"hiddenImageInputinReport\"\n        />\n      </div>\n\n      <div\n        v-if=\"originalImage\"\n        class=\"move-button\"\n        title=\"Move\"\n        alt=\"Move\"\n        style=\"position: relative\"\n      >\n        <button\n          class=\"upload-buttons\"\n          :class=\"{ moving: moveMode }\"\n          style=\"left: 50px\"\n          @click=\"toggleMoveMode\"\n        >\n          <i class=\"fas fa-arrows fa-lg\" style=\"color: #ffffff\"></i>\n        </button>\n      </div>\n\n      <div\n        v-if=\"originalImage\"\n        class=\"zoom-in-button\"\n        title=\"Zoom In\"\n        alt=\"Zoom In\"\n        style=\"position: relative\"\n      >\n        <button class=\"upload-buttons\" style=\"left: 90px\" @click=\"zoomIn\">\n          <i class=\"fas fa-search-plus fa-lg\" style=\"color: #ffffff\"></i>\n        </button>\n      </div>\n\n      <div\n        v-if=\"originalImage\"\n        class=\"zoom-out-button\"\n        title=\"Zoom Out\"\n        alt=\"Zoom Out\"\n        style=\"position: relative\"\n      >\n        <button class=\"upload-buttons\" style=\"left: 130px\" @click=\"zoomOut\">\n          <i class=\"fas fa-search-minus fa-lg\" style=\"color: #ffffff\"></i>\n        </button>\n      </div>\n\n      <!-- <div\n        v-if=\"originalImage\"\n        class=\"reset-zoom-button\"\n        title=\"Reset Zoom\"\n        alt=\"Reset Zoom\"\n        style=\"position: relative\"\n      >\n        <button\n          class=\"upload-buttons\"\n          style=\"left: 170px\"\n          @click=\"resetImagePositionAndZoom\"\n        >\n          <i class=\"fa-solid fa-arrows-rotate fa-lg\" style=\"color: #ffffff\"></i>\n        </button>\n      </div> -->\n    </div>\n    <div ref=\"vascular-image-div\">\n      <div style=\"position: relative\" v-if=\"addBar\">\n        <img\n          style=\"user-select: none; -webkit-user-drag: none\"\n          id=\"bar-graph-legend-os\"\n          ref=\"barGraphLegend\"\n          alt=\"Image Not Loaded\"\n        />\n      </div>\n      <div\n        :style=\"{ height: height + 'px', width: width + 'pt' }\"\n        ref=\"zoomControl\"\n      >\n        <canvas\n          ref=\"canvas\"\n          id=\"vascular-image\"\n          @mousedown=\"handleMouseDown\"\n          @mousemove=\"handleMouseMove\"\n          @mouseup=\"handleMouseUp\"\n        ></canvas>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport html2canvas from 'html2canvas';\n\nexport default {\n  props: {\n    id: { type: String },\n    width: { type: Number, default: 200 },\n    height: { type: Number, default: 250 },\n    canvasText: { type: String, default: 'Select or Drop Image' },\n    addBar: { type: String, default: null },\n    editable: { type: Boolean, default: true },\n  },\n  data() {\n    return {\n      moveMode: false,\n      isMoving: false,\n      cStartX: null,\n      cStartY: null,\n      canvasX: 0,\n      canvasY: 0,\n      zoomValue: 1,\n      defaultZoomValue: 1,\n      originalImage: null,\n      hovering: false,\n    };\n  },\n  methods: {\n    setupCanvas() {\n      // width = 270, height = 250,\n      const { canvas } = this.$refs;\n      const ctx = canvas.getContext('2d');\n      canvas.width = this.width * (1 / 0.75);\n      canvas.height = this.height;\n\n      ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n      ctx.fillStyle = 'white';\n      ctx.font = '20px Arial';\n      ctx.textAlign = 'center';\n      ctx.textBaseline = 'middle';\n\n      this.wrapText(\n        ctx,\n        this.canvasText,\n        canvas.width / 2,\n        canvas.height / 2,\n        150\n      );\n    },\n    wrapText(context, text, x, yi, maxWidth) {\n      let y = yi;\n      const words = text.split(' ');\n      let line = '';\n      const lineHeight = context.measureText('M').width * 1.2; // Adjust line height as needed\n\n      for (let i = 0; i < words.length; i++) {\n        const testLine = `${line + words[i]} `;\n        const testWidth = context.measureText(testLine).width;\n\n        if (testWidth > maxWidth && i > 0) {\n          context.fillText(line, x, y);\n          line = `${words[i]} `;\n          y += lineHeight;\n        } else {\n          line = testLine;\n        }\n      }\n\n      context.fillText(line, x, y);\n    },\n    drawImage() {\n      const { canvas } = this.$refs;\n      const ctx = canvas.getContext('2d');\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      ctx.drawImage(this.originalImage, 0, 0);\n    },\n    openFilePicker() {\n      this.$refs.imageLoaderInput.click();\n    },\n    uploadImage(event) {\n      const file = event.target.files[0];\n\n      const { canvas } = this.$refs;\n      if (file) {\n        const reader = new FileReader();\n        reader.onload = (e) => {\n          this.originalImage = new Image();\n          this.originalImage.onload = () => {\n            canvas.width = this.originalImage.width + 10;\n            canvas.height = this.originalImage.height + 10;\n            this.drawImage();\n          };\n          this.originalImage.src = e.target.result;\n          this.updateImageZoom();\n          this.resetImagePositionAndZoom();\n        };\n        reader.readAsDataURL(file);\n      }\n    },\n    uploadImageDrop(file) {\n      const { canvas } = this.$refs;\n      if (file) {\n        const reader = new FileReader();\n        reader.onload = (e) => {\n          this.originalImage = new Image();\n          this.originalImage.onload = () => {\n            canvas.width = this.originalImage.width + 10;\n            canvas.height = this.originalImage.height + 10;\n            this.drawImage();\n          };\n          this.originalImage.src = e.target.result;\n          this.updateImageZoom();\n          this.resetImagePositionAndZoom();\n        };\n        reader.readAsDataURL(file);\n      }\n    },\n    handleImageDrop(event) {\n      event.preventDefault();\n      const file = event.dataTransfer.files[0];\n      this.uploadImageDrop(file);\n      this.hovering = false;\n    },\n    handleDragOver(event) {\n      event.preventDefault();\n\n      this.hovering = true;\n    },\n    handleDragLeave() {\n      this.hovering = false;\n    },\n\n    toggleMoveMode() {\n      if (this.originalImage) {\n        this.moveMode = !this.moveMode;\n      }\n    },\n    handleMouseDown(event) {\n      if (!this.moveMode) {\n        return;\n      }\n      this.isMoving = true;\n      this.cStartX = event.clientX;\n      this.cStartY = event.clientY;\n    },\n    handleMouseMove(event) {\n      if (!this.moveMode || !this.isMoving) {\n        // Do nothing here.\n      } else if (this.cStartX !== undefined && this.cStartY !== undefined) {\n        const diffX = event.clientX - this.cStartX;\n        const diffY = event.clientY - this.cStartY;\n        this.canvasX += diffX;\n        this.canvasY += diffY;\n        this.$refs.canvas.style.transform = `translate(${this.canvasX}px, ${this.canvasY}px)`;\n        this.cStartX = event.clientX;\n        this.cStartY = event.clientY;\n      }\n    },\n    handleMouseUp() {\n      this.isMoving = false;\n      this.cStartX = undefined;\n      this.cStartY = undefined;\n    },\n    zoomIn() {\n      this.zoomValue += 0.025;\n      this.updateImageZoom();\n    },\n    zoomOut() {\n      this.zoomValue -= 0.025;\n      this.updateImageZoom();\n    },\n    resetImagePositionAndZoom() {\n      this.moveMode = false;\n      this.zoomValue = this.defaultZoomValue;\n      this.updateImageZoom();\n    },\n    updateImageZoom() {\n      if (this.originalImage) {\n        const updateDiv = this.$refs.zoomControl;\n\n        // Set the scale value and set origin to top left\n        updateDiv.style.transform = `scale(${this.zoomValue})`;\n        updateDiv.style.transformOrigin = '0 0';\n      }\n    },\n    async captureScreenshot() {\n      // Get the reference to the \"vascular-image-div\" div\n      const divElement = this.$refs['vascular-image-div'];\n\n      // Use html2canvas to capture a screenshot of the div\n      html2canvas(divElement, { logging: false, scale: 3 })\n        .then((canvas) => {\n          // Convert the canvas to an image data URL\n          const imageDataURL = canvas.toDataURL('image/png');\n\n          // Emit the image data URL to the parent component\n          this.$emit('screenshot-captured', this.id, imageDataURL);\n        })\n        .catch((error) => {\n          console.error('Error capturing screenshot:', error);\n        });\n    },\n  },\n  mounted() {\n    this.setupCanvas();\n\n    if (this.addBar) {\n      const imgTemp = new Image();\n      imgTemp.src = this.addBar;\n      imgTemp.onload = () => {\n        this.$refs.barGraphLegend.src = imgTemp.src;\n      };\n    }\n  },\n  watch: {\n    editable() {\n      if (this.moveMode) {\n        this.moveMode = !this.moveMode;\n        this.handleMouseUp();\n      }\n    },\n  },\n};\n</script>\n\n<style scoped>\n.upload-buttons {\n  cursor: pointer;\n  position: absolute;\n  background-color: #3a39396e;\n  border-radius: 5px;\n  border: none;\n  display: block;\n  width: 30px;\n  height: 30px;\n  top: 10px;\n  z-index: 100;\n}\n\n.upload-image {\n  left: 10px;\n}\n\n.upload-buttons:hover {\n  background-color: #229ed7c0;\n  transition: 0.3s;\n}\n\n#image-container {\n  justify-self: center;\n  align-self: center;\n  background-color: #0000003b;\n  overflow: hidden;\n}\n.hover {\n  border: 2px dashed #229ed7;\n}\n\n.upload-buttons.moving {\n  background-color: #229ed7;\n}\n\n#image-container.moving {\n  cursor: grab;\n}\n\n#bar-graph-legend-os {\n  height: 200px;\n  position: absolute;\n  left: 215px;\n  top: 25px;\n  z-index: 10;\n  background: #5252524b;\n  padding: 5px;\n  padding-right: 2px;\n  border-radius: 10px;\n}\n</style>\n","<template>\n  <div style=\"position: relative\">\n    <canvas ref=\"chartCanvas\"></canvas>\n    <div\n      style=\"\n        position: absolute;\n        color: rgb(255, 255, 255);\n        top: 10px;\n        left: 14px;\n        width: 38px;\n        height: 20px;\n        text-align: center;\n      \"\n    >\n      <h5>\n        {{ LAD }}\n      </h5>\n    </div>\n    <div\n      style=\"\n        position: absolute;\n        color: rgb(255, 255, 255);\n        top: 55px;\n        left: 12px;\n\n        width: 38px;\n        height: 20px;\n        text-align: center;\n      \"\n    >\n      <h5>\n        {{ RCA }}\n      </h5>\n    </div>\n\n    <div\n      style=\"\n        position: absolute;\n        color: rgb(255, 255, 255);\n        top: 32px;\n        left: 52px;\n\n        width: 35px;\n        height: 20px;\n        text-align: center;\n      \"\n    >\n      <h5>\n        {{ LCX }}\n      </h5>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  props: {\n    id: {\n      type: String,\n      required: false,\n    },\n    values: {\n      type: Array,\n      required: true,\n    },\n  },\n  data() {\n    return {\n      outerradius: 85 / 2 - 1,\n      LAD: null,\n      LCX: null,\n      RCA: null,\n    };\n  },\n  watch: {\n    values() {\n      this.setValues();\n      this.createChart();\n    },\n  },\n  mounted() {\n    this.setValues();\n\n    this.createChart();\n  },\n  methods: {\n    setValues() {\n      [this.LAD, this.LCX, this.RCA] = this.values;\n    },\n    createChart() {\n      const canvas = this.$refs.chartCanvas;\n      const ctx = canvas.getContext('2d');\n\n      canvas.width = 85;\n      canvas.height = 85;\n\n      const centerX = canvas.width / 2;\n      const centerY = canvas.height / 2;\n      const outerRadius = this.outerradius;\n      const innerRadius = outerRadius / 4;\n\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      // Customize the colors for each section\n      //   const sectionColors = ['#a2191a', '#105a93', '#1f7c55'];\n      const sectionColors = this.getColors([this.RCA, this.LAD, this.LCX]);\n      // Define the data for the chart sections\n      const chartData = [1, 1, 1]; // Equal values for each section\n\n      const totalValue = chartData.reduce((total, value) => total + value, 0);\n\n      let startAngle = 0;\n      chartData.forEach((value, index) => {\n        const sectionAngle = (value / totalValue) * Math.PI * 2;\n        const endAngle = startAngle + sectionAngle;\n\n        ctx.beginPath();\n        ctx.moveTo(\n          centerX + outerRadius * Math.cos(startAngle),\n          centerY + outerRadius * Math.sin(startAngle)\n        );\n        ctx.arc(centerX, centerY, outerRadius, startAngle, endAngle);\n        ctx.arc(centerX, centerY, innerRadius, endAngle, startAngle, true);\n        ctx.closePath();\n        ctx.fillStyle = sectionColors[index];\n        ctx.fill();\n\n        // Add stroke between the regions\n        ctx.lineWidth = 0.5;\n        ctx.strokeStyle = 'black';\n        ctx.stroke();\n\n        startAngle = endAngle;\n      });\n\n      // Draw white stroke around the outer circle\n      ctx.beginPath();\n      ctx.arc(centerX, centerY, outerRadius, 0, Math.PI * 2);\n      ctx.strokeStyle = '#00000';\n      ctx.lineWidth = 0;\n      ctx.stroke();\n\n      // Draw white stroke around the inner hole\n      ctx.beginPath();\n      ctx.arc(centerX, centerY, innerRadius, 0, Math.PI * 2);\n      ctx.strokeStyle = '#00000';\n      ctx.lineWidth = 0;\n      ctx.stroke();\n    },\n    numberToColorGradient(numberi) {\n      let number = numberi;\n      // Remove any percentage symbols from the input\n      number = number.toString().replace(/%/g, '');\n\n      // Define the color stops and their corresponding percentages\n      const colorStops = [\n        {\n          color: [1, 25, 242],\n          minPercentage: 0,\n          maxPercentage: 0.23,\n        }, // Dark Blue\n        {\n          color: [0, 227, 252],\n          minPercentage: 0.23,\n          maxPercentage: 0.45,\n        }, // Light Blue\n        {\n          color: [44, 246, 91],\n          minPercentage: 0.45,\n          maxPercentage: 0.6,\n        }, // Green\n        {\n          color: [252, 208, 13],\n          minPercentage: 0.6,\n          maxPercentage: 0.75,\n        }, // Yellow\n        {\n          color: [255, 16, 1],\n          minPercentage: 0.75,\n          maxPercentage: 1,\n        }, // Red\n      ];\n\n      // Clamp the input number to the range of -30 to 30\n      number = Math.min(Math.max(Number(number), -20), 20);\n\n      // Map the input number to the percentage range of 0 to 1\n      const percentage = (number + 20) / 40;\n\n      // Find the corresponding color stops based on the percentage\n      let startStop;\n      let endStop;\n      for (let i = 0; i < colorStops.length; i++) {\n        if (\n          percentage >= colorStops[i].minPercentage &&\n          percentage <= colorStops[i].maxPercentage\n        ) {\n          startStop = colorStops[i];\n          endStop = colorStops[i + 1];\n          break;\n        }\n      }\n\n      // Handle values greater than the last color stop\n      if (!endStop) {\n        startStop = colorStops[colorStops.length - 2];\n        endStop = colorStops[colorStops.length - 1];\n      }\n\n      // Perform linear interpolation to calculate the RGB values\n      const t =\n        (percentage - startStop.minPercentage) /\n        (endStop.maxPercentage - startStop.minPercentage);\n      const r = Math.round(\n        startStop.color[0] + t * (endStop.color[0] - startStop.color[0])\n      );\n      const g = Math.round(\n        startStop.color[1] + t * (endStop.color[1] - startStop.color[1])\n      );\n      const b = Math.round(\n        startStop.color[2] + t * (endStop.color[2] - startStop.color[2])\n      );\n\n      return `rgb(${r}, ${g}, ${b})`;\n    },\n    getColors(arr) {\n      return [\n        this.numberToColorGradient(arr[0]),\n        this.numberToColorGradient(arr[1]),\n        this.numberToColorGradient(arr[2]),\n      ];\n    },\n  },\n};\n</script>\n\n<style scoped>\ncanvas {\n  transform: rotate(60deg);\n}\n\nh5 {\n  font-weight: 400;\n  font-size: 12px;\n}\n</style>\n","<template>\n  <input\n    :value=\"propValue\"\n    @input=\"updateProp\"\n    @blur=\"stopEditing\"\n    ref=\"inputField\"\n    :class=\"{ edit: editable }\"\n  />\n</template>\n\n<script>\nexport default {\n  props: {\n    id: { type: String, required: true },\n    propValue: {\n      type: String,\n      required: true,\n      default: '00',\n    },\n    editable: { type: Boolean, default: true },\n  },\n  data() {\n    return {\n      editing: 0,\n      editedValue: this.propValue,\n    };\n  },\n  methods: {\n    stopEditing() {\n      this.$emit('updateValue', this.id, this.editedValue);\n    },\n    updateProp(event) {\n      this.editedValue = event.target.value;\n    },\n  },\n  watch: {\n    editable() {\n      this.$refs.inputField.readOnly = !this.editable;\n    },\n  },\n  mounted() {\n    if (!this.editable) {\n      this.$refs.inputField.readOnly = true;\n    }\n  },\n};\n</script>\n\n<style scoped>\nh5 {\n  color: #000917;\n  font-weight: bold;\n  font-size: 13px;\n  height: 17px;\n  padding-left: 2%;\n  width: 50px;\n}\n\ninput {\n  color: #000917;\n  font-weight: bold;\n  font-size: 13px;\n  padding-left: 2%;\n  outline: none;\n  width: 50px;\n  height: 17px;\n  overflow: hidden;\n  border: 1px dashed #ffffff00;\n  transition: all 0.3s ease;\n}\n\ninput.edit {\n  border: 1px dashed #229ed7;\n}\n</style>\n","<template>\n  <textarea\n    :value=\"propValue\"\n    @input=\"updateProp\"\n    @blur=\"stopEditing\"\n    ref=\"inputField\"\n    :class=\"{ edit: editable, noedit: !editable }\"\n    :placeholder=\"placeholder\"\n    aria-labelledby=\"textAreaInReportEditable\"\n  ></textarea>\n</template>\n\n<script>\nexport default {\n  props: {\n    id: { type: String, required: true },\n    propValue: {\n      type: String,\n      required: true,\n      default: '00',\n    },\n    placeholder: { type: String, default: '' },\n    editable: { type: Boolean, default: true },\n  },\n  data() {\n    return {\n      editing: 0,\n      editedValue: this.propValue,\n    };\n  },\n  methods: {\n    stopEditing() {\n      this.$emit('updateValue', this.id, this.editedValue);\n    },\n    updateProp(event) {\n      this.editedValue = event.target.value;\n    },\n  },\n  mounted() {\n    if (!this.editable) {\n      this.$refs.inputField.readOnly = true;\n    }\n  },\n  watch: {\n    editable() {\n      this.$refs.inputField.readOnly = !this.editable;\n    },\n  },\n};\n</script>\n\n<style scoped>\nh5 {\n  color: #5e5d6c;\n  font-weight: bold;\n  font-size: 13px;\n  height: 17px;\n  width: 50px;\n}\n\ntextarea {\n  color: #5e5d6c;\n  font-weight: bold;\n  font-size: 13px;\n  outline: none;\n  width: 50px;\n  height: 17px;\n  overflow: hidden;\n  background: none;\n  line-height: 15px;\n}\n\ntextarea.edit {\n  border: 1px dashed #229ed7;\n  background: none;\n  line-height: 18px;\n  font-size: 13px;\n  color: #5e5d6c;\n  transition: all 0.3s ease-in-out;\n}\n\ntextarea.noedit {\n  border: 1px dashed #ffffff00;\n  transition: all 0.3s ease-in-out;\n  background: none;\n  font-weight: bold;\n  font-size: 13px;\n  line-height: 18px;\n  color: #5e5d6c;\n}\n</style>\n","<template>\n  <div class=\"print-area\">\n    <div id=\"report-element\" class=\"report-element\">\n      <div class=\"row1\">\n        <ReportTextBox\n          id=\"reportTitle\"\n          :editable=\"editable\"\n          :propValue=\"OS_REPORT_VALUES.reportTitle\"\n          @updateValue=\"handleUpdateValues\"\n          style=\"\n            width: 450px;\n            color: #000000;\n            font-weight: bold;\n            font-size: 30px;\n            height: 40px;\n            padding: 0%;\n          \"\n        />\n        <div ref=\"reportLogo\">\n          <ReportLogoHolder\n            :editable=\"editable\"\n            @imageUpdated=\"handleLogoUpdate\"\n          />\n        </div>\n      </div>\n\n      <div class=\"row2\">\n        <h5>Patient</h5>\n\n        <ReportTextBox\n          id=\"patientName\"\n          :editable=\"editable\"\n          :propValue=\"OS_REPORT_VALUES.patientName\"\n          @updateValue=\"handleUpdateValues\"\n          style=\"\n            width: 650px;\n            color: #229ed7;\n            font-weight: 500;\n            font-size: 30px;\n            height: 35px;\n            padding: 0%;\n          \"\n        />\n      </div>\n\n      <div class=\"row3\" style=\"border-bottom: 1px solid black\">\n        <div id=\"gender\" style=\"display: flex; gap: 5px\">\n          <h5>Gender:</h5>\n          <ReportDropDown\n            :editable=\"editable\"\n            id=\"patientGender\"\n            :options=\"genderOptions\"\n            @option-selected=\"onOptionSelected\"\n          />\n        </div>\n        <div>\n          <h5>\n            Age:\n            <ReportTextBox\n              id=\"patientAge\"\n              :editable=\"editable\"\n              :propValue=\"OS_REPORT_VALUES.patientAge\"\n              @updateValue=\"handleUpdateValues\"\n            />\n          </h5>\n        </div>\n        <div>\n          <h5>\n            DOB:\n            <ReportTextBox\n              id=\"patientDOB\"\n              :editable=\"editable\"\n              :propValue=\"OS_REPORT_VALUES.patientDOB\"\n              @updateValue=\"handleUpdateValues\"\n              style=\"width: 120px\"\n            />\n          </h5>\n        </div>\n        <div>\n          <h5>\n            Patient ID:\n            <ReportTextBox\n              id=\"patientID\"\n              :editable=\"editable\"\n              :propValue=\"OS_REPORT_VALUES.patientID\"\n              @updateValue=\"handleUpdateValues\"\n              style=\"width: 110px\"\n            />\n          </h5>\n        </div>\n      </div>\n\n      <div class=\"below\">\n        <div class=\"left-column\">\n          <div class=\"Exam\">\n            <h4 style=\"margin-bottom: 5px\">Exam</h4>\n            <h5 style=\"height: 15px\">RBH number:</h5>\n            <ReportTextBox\n              id=\"rbhNumber\"\n              :editable=\"editable\"\n              :propValue=\"OS_REPORT_VALUES.rbhNumber\"\n              @updateValue=\"handleUpdateValues\"\n              style=\"width: 110px; padding-left: 0px\"\n            />\n\n            <h5 style=\"height: 15px\">Protocol:</h5>\n            <ReportTextBox\n              id=\"protocol\"\n              :editable=\"editable\"\n              :propValue=\"OS_REPORT_VALUES.protocol\"\n              @updateValue=\"handleUpdateValues\"\n              style=\"width: 110px; padding-left: 0px\"\n            />\n\n            <h5 style=\"height: 15px\">Date:</h5>\n            <ReportTextBox\n              id=\"scanDate\"\n              :editable=\"editable\"\n              :propValue=\"OS_REPORT_VALUES.scanDate\"\n              @updateValue=\"handleUpdateValues\"\n              style=\"width: 110px; padding-left: 0px\"\n            />\n\n            <h5 style=\"height: 15px\">Time:</h5>\n            <ReportTextBox\n              id=\"scanTime\"\n              :editable=\"editable\"\n              :propValue=\"OS_REPORT_VALUES.scanTime\"\n              @updateValue=\"handleUpdateValues\"\n              style=\"width: 110px; padding-left: 0px\"\n            />\n          </div>\n          <div class=\"Scan\">\n            <h4 style=\"margin-bottom: 5px\">Scan</h4>\n            <h5>Complete Data:</h5>\n            <ReportDropDown\n              id=\"completeData\"\n              :editable=\"editable\"\n              :options=\"completeDataOptions\"\n              @option-selected=\"onOptionSelected\"\n            />\n\n            <h5>Image Quality:</h5>\n            <ReportDropDown\n              id=\"imageQuality\"\n              :editable=\"editable\"\n              :options=\"imageQualityOptions\"\n              @option-selected=\"onOptionSelected\"\n            />\n            <!-- <select\n              id=\"imageQuality\"\n              contenteditable=\"true\"\n              style=\"margin-bottom: 5px\"\n            >\n              <option>Select</option>\n              <option value=\"Excellent\">Excellent</option>\n              <option value=\"Good\">Good</option>\n              <option value=\"Ok\">Ok</option>\n              <option value=\"Bad\">Bad</option>\n            </select> -->\n          </div>\n          <div class=\"Technologist\">\n            <h4 style=\"margin-bottom: 10px\">Analytical Team</h4>\n\n            <h5 style=\"height: 15px\">Reader:</h5>\n            <ReportTextBox\n              id=\"reader\"\n              :editable=\"editable\"\n              :propValue=\"OS_REPORT_VALUES.reader\"\n              @updateValue=\"handleUpdateValues\"\n              style=\"width: 150px; padding-left: 0px\"\n            />\n\n            <h5 style=\"height: 15px\">Verified by:</h5>\n            <ReportTextBox\n              id=\"verifier\"\n              :editable=\"editable\"\n              :propValue=\"OS_REPORT_VALUES.verifier\"\n              @updateValue=\"handleUpdateValues\"\n              style=\"width: 150px; padding-left: 0px\"\n            />\n          </div>\n          <div class=\"Scanner\">\n            <h4 style=\"margin-bottom: 10px\">Scanner</h4>\n            <h5 style=\"height: 15px\">System:</h5>\n            <ReportTextBox\n              id=\"scannerSystem\"\n              :editable=\"editable\"\n              :propValue=\"OS_REPORT_VALUES.scannerSystem\"\n              @updateValue=\"handleUpdateValues\"\n              style=\"width: 150px; padding-left: 0px\"\n            />\n\n            <h5 style=\"height: 15px\">Field Strength:</h5>\n            <ReportTextBox\n              id=\"fieldStrength\"\n              :editable=\"editable\"\n              :propValue=\"OS_REPORT_VALUES.fieldStrength\"\n              @updateValue=\"handleUpdateValues\"\n              style=\"width: 100px; padding-left: 0px\"\n            />\n\n            <h5 style=\"height: 15px\">Software Version:</h5>\n            <ReportTextBox\n              id=\"softwareVersion\"\n              :editable=\"editable\"\n              :propValue=\"OS_REPORT_VALUES.softwareVersion\"\n              @updateValue=\"handleUpdateValues\"\n              style=\"width: 100px; padding-left: 0px\"\n            />\n          </div>\n\n          <div class=\"Scanner\">\n            <ReportTextBoxMultiple\n              id=\"starClaimer\"\n              :editable=\"editable\"\n              :propValue=\"OS_REPORT_VALUES.starClaimer\"\n              @updateValue=\"handleUpdateValues\"\n              style=\"\n                width: 170px;\n                height: 120px;\n                padding: 0px;\n                padding-top: 5px;\n                font-style: italic;\n              \"\n            />\n            <!-- <h5\n              style=\"width: 150px; font-style: italic\"\n              contenteditable=\"true\"\n              id=\"starClaimer\"\n            >\n              *Normal values are continuously being updated, therefore, may be\n              subject to changes\n            </h5> -->\n          </div>\n\n          <div>\n            <h5 style=\"width: 150px; font-style: italic\">\n              For research use only.\n            </h5>\n          </div>\n        </div>\n\n        <div class=\"right-column\">\n          <div class=\"summary\">\n            <h4 style=\"height: 15px\">SUMMARY</h4>\n            <ReportTextBoxMultiple\n              id=\"summary\"\n              :editable=\"editable\"\n              :propValue=\"OS_REPORT_VALUES.summary\"\n              placeholder=\"Type Summary Here...\"\n              @updateValue=\"handleUpdateValues\"\n              style=\"\n                width: 100%;\n                padding: 10px 10px;\n                height: 190px;\n                font-size: 14px;\n                color: black;\n                background-color: #f8f8f8;\n              \"\n            />\n            <!-- <textarea\n              style=\"height: 190px; color: black; outline: none\"\n              id=\"summaryText\"\n              placeholder=\"Type Summary Here...\"\n            ></textarea> -->\n          </div>\n\n          <div class=\"detailed-report\">\n            <div class=\"overview\">\n              <div class=\"labels\">\n                <br />\n\n                <h5 style=\"width: 120px\">Heart Rate</h5>\n                <h5 style=\"width: 120px\">Normal Range</h5>\n              </div>\n\n              <div class=\"baselinevals\">\n                <h5 style=\"color: #5e5d6c\">BASELINE</h5>\n                <ReportTextBox\n                  id=\"heartRateBaseline\"\n                  :editable=\"editable\"\n                  :propValue=\"OS_REPORT_VALUES.heartRateBaseline\"\n                  @updateValue=\"handleUpdateValues\"\n                  style=\"width: 60px; padding-left: 0px; font-size: 14px\"\n                />\n              </div>\n\n              <div class=\"hyperventvals\">\n                <h5 style=\"color: #5e5d6c\">HV</h5>\n                <ReportTextBox\n                  id=\"heartRateHV\"\n                  :editable=\"editable\"\n                  :propValue=\"OS_REPORT_VALUES.heartRateHV\"\n                  @updateValue=\"handleUpdateValues\"\n                  style=\"width: 60px; padding-left: 0px; font-size: 14px\"\n                />\n              </div>\n\n              <div class=\"BHvals\">\n                <h5 style=\"color: #5e5d6c; width: 90px\">BH @ 30 SEC</h5>\n                <ReportTextBox\n                  id=\"heartRateBH\"\n                  :editable=\"editable\"\n                  :propValue=\"OS_REPORT_VALUES.heartRateBH\"\n                  @updateValue=\"handleUpdateValues\"\n                  style=\"width: 60px; padding-left: 0px; font-size: 14px\"\n                />\n              </div>\n\n              <div class=\"baselinevals\">\n                <h5 style=\"color: #5e5d6c\">&Delta; HR</h5>\n                <ReportTextBox\n                  id=\"dtheartrate\"\n                  :editable=\"editable\"\n                  :propValue=\"OS_REPORT_VALUES.dtheartrate\"\n                  @updateValue=\"handleUpdateValues\"\n                  style=\"width: 60px; padding-left: 0px; font-size: 14px\"\n                />\n                <ReportTextBox\n                  id=\"dtheartrateNormalRange\"\n                  :editable=\"editable\"\n                  :propValue=\"OS_REPORT_VALUES.dtheartrateNormalRange\"\n                  @updateValue=\"handleUpdateValues\"\n                  style=\"width: 60px; padding-left: 0px; font-size: 14px\"\n                />\n              </div>\n            </div>\n\n            <div class=\"overview_middle\">\n              <div class=\"col\">\n                <h4>VASCULAR</h4>\n                <div class=\"vals\">\n                  <div\n                    class=\"valuesOCG\"\n                    style=\"padding-left: 10px; padding-top: 10px\"\n                  >\n                    <h6 style=\"margin-bottom: 10px; padding-left: 5px\">\n                      B-MORE\n                    </h6>\n                    <div style=\"display: flex; position: relative\">\n                      <h5>\n                        Global\n                        <ReportTextBox\n                          id=\"vascularGlobal\"\n                          :editable=\"editable\"\n                          :propValue=\"OS_REPORT_VALUES.vascularGlobal\"\n                          @updateValue=\"handleUpdateValues\"\n                          style=\"margin-left: 12px; padding-left: 4%\"\n                        />\n                      </h5>\n\n                      <div style=\"position: absolute; left: 80px; width: 190px\">\n                        <h5 style=\"margin-left: 25px\">\n                          *Normal Range:\n                          <ReportTextBox\n                            id=\"normalRangeVascular\"\n                            :editable=\"editable\"\n                            :propValue=\"OS_REPORT_VALUES.normalRangeVascular\"\n                            @updateValue=\"handleUpdateValues\"\n                          />\n                        </h5>\n                      </div>\n                    </div>\n\n                    <h5>\n                      LAD\n                      <ReportTextBox\n                        id=\"vascularLAD\"\n                        :editable=\"editable\"\n                        :propValue=\"OS_REPORT_VALUES.vascularLAD\"\n                        @updateValue=\"handleUpdateValues\"\n                        style=\"margin-left: 24.5px\"\n                      />\n                    </h5>\n\n                    <h5>\n                      LCX\n                      <ReportTextBox\n                        id=\"vascularLCX\"\n                        :editable=\"editable\"\n                        :propValue=\"OS_REPORT_VALUES.vascularLCX\"\n                        @updateValue=\"handleUpdateValues\"\n                        style=\"margin-left: 25.5px\"\n                      />\n                    </h5>\n\n                    <h5>\n                      RCA\n                      <ReportTextBox\n                        id=\"vascularRCA\"\n                        :editable=\"editable\"\n                        :propValue=\"OS_REPORT_VALUES.vascularRCA\"\n                        @updateValue=\"handleUpdateValues\"\n                        style=\"margin-left: 23px\"\n                      />\n                    </h5>\n                  </div>\n                </div>\n                <ReportImageContainer\n                  id=\"vascularImage\"\n                  ref=\"vascularImage\"\n                  :editable=\"editable\"\n                  :add-bar=\"'./images/bar.png'\"\n                  @screenshotCaptured=\"handleImageScreenshot\"\n                />\n              </div>\n\n              <div class=\"col\" style=\"margin-left: 2%\">\n                <h4>STRAIN</h4>\n                <div class=\"vals\">\n                  <div class=\"valuesSTRAIN\">\n                    <div class=\"strain-containter\">\n                      <h6>B-MORE</h6>\n                      <h5>Global</h5>\n                      <h5>LAD</h5>\n                      <h5>LCX</h5>\n                      <h5>RCA</h5>\n                    </div>\n\n                    <div class=\"strain-containter\">\n                      <h6>BASELINE</h6>\n\n                      <ReportTextBox\n                        id=\"strainGLOBALBaseline\"\n                        :editable=\"editable\"\n                        :propValue=\"OS_REPORT_VALUES.strainGLOBALBaseline\"\n                        @updateValue=\"handleUpdateValues\"\n                      />\n                      <ReportTextBox\n                        id=\"strainLADBaseline\"\n                        :editable=\"editable\"\n                        :propValue=\"OS_REPORT_VALUES.strainLADBaseline\"\n                        @updateValue=\"handleUpdateValues\"\n                      />\n                      <ReportTextBox\n                        id=\"strainLCXBaseline\"\n                        :editable=\"editable\"\n                        :propValue=\"OS_REPORT_VALUES.strainLCXBaseline\"\n                        @updateValue=\"handleUpdateValues\"\n                      />\n\n                      <ReportTextBox\n                        id=\"strainRCABaseline\"\n                        :editable=\"editable\"\n                        :propValue=\"OS_REPORT_VALUES.strainRCABaseline\"\n                        @updateValue=\"handleUpdateValues\"\n                      />\n                    </div>\n\n                    <div class=\"strain-containter\">\n                      <h6 style=\"padding-left: 8%\">HV</h6>\n\n                      <ReportTextBox\n                        id=\"strainGLOBALHV\"\n                        :editable=\"editable\"\n                        :propValue=\"OS_REPORT_VALUES.strainGLOBALHV\"\n                        @updateValue=\"handleUpdateValues\"\n                      />\n                      <ReportTextBox\n                        id=\"strainLADHV\"\n                        :editable=\"editable\"\n                        :propValue=\"OS_REPORT_VALUES.strainLADHV\"\n                        @updateValue=\"handleUpdateValues\"\n                      />\n                      <ReportTextBox\n                        id=\"strainLCXHV\"\n                        :editable=\"editable\"\n                        :propValue=\"OS_REPORT_VALUES.strainLCXHV\"\n                        @updateValue=\"handleUpdateValues\"\n                      />\n\n                      <ReportTextBox\n                        id=\"strainRCAHV\"\n                        :editable=\"editable\"\n                        :propValue=\"OS_REPORT_VALUES.strainRCAHV\"\n                        @updateValue=\"handleUpdateValues\"\n                      />\n                    </div>\n\n                    <div class=\"strain-containter\">\n                      <h6>BH @ 30 SEC</h6>\n\n                      <ReportTextBox\n                        id=\"strainGLOBALBH\"\n                        :editable=\"editable\"\n                        :propValue=\"OS_REPORT_VALUES.strainGLOBALBH\"\n                        @updateValue=\"handleUpdateValues\"\n                      />\n                      <ReportTextBox\n                        id=\"strainLADBH\"\n                        :editable=\"editable\"\n                        :propValue=\"OS_REPORT_VALUES.strainLADBH\"\n                        @updateValue=\"handleUpdateValues\"\n                      />\n                      <ReportTextBox\n                        id=\"strainLCXBH\"\n                        :editable=\"editable\"\n                        :propValue=\"OS_REPORT_VALUES.strainLCXBH\"\n                        @updateValue=\"handleUpdateValues\"\n                      />\n\n                      <ReportTextBox\n                        id=\"strainRCABH\"\n                        :editable=\"editable\"\n                        :propValue=\"OS_REPORT_VALUES.strainRCABH\"\n                        @updateValue=\"handleUpdateValues\"\n                      />\n                    </div>\n                  </div>\n                </div>\n                <ReportImageContainer\n                  id=\"strainImage\"\n                  ref=\"strainImage\"\n                  :editable=\"editable\"\n                  @screenshotCaptured=\"handleImageScreenshot\"\n                />\n              </div>\n            </div>\n            <div class=\"overview_graphs\">\n              <div\n                style=\"\n                  display: flex;\n                  flex-direction: column;\n                  align-items: center;\n                  width: 278px;\n                \"\n              >\n                <h4 style=\"color: black\">Oxygen Sensitive Map</h4>\n                <ReportImageContainer\n                  id=\"oxygenSensitiveMap\"\n                  ref=\"oxygenSensitiveMap\"\n                  :editable=\"editable\"\n                  :width=\"150\"\n                  :height=\"150\"\n                  canvasText=\"Upload OS-Map\"\n                  @screenshotCaptured=\"handleImageScreenshot\"\n                />\n              </div>\n              <div class=\"strainmaps\">\n                <h4 style=\"color: black\">STRAIN MAPS</h4>\n\n                <div class=\"territorymaps\" ref=\"territorymapimg\">\n                  <ReportStrainMaps\n                    id=\"strainMapBaseline\"\n                    :values=\"[\n                      OS_REPORT_VALUES.strainLADBaseline,\n                      OS_REPORT_VALUES.strainLCXBaseline,\n                      OS_REPORT_VALUES.strainRCABaseline,\n                    ]\"\n                  />\n                  <ReportStrainMaps\n                    id=\"strainMapHV\"\n                    :values=\"[\n                      OS_REPORT_VALUES.strainLADHV,\n                      OS_REPORT_VALUES.strainLCXHV,\n                      OS_REPORT_VALUES.strainRCAHV,\n                    ]\"\n                  />\n                  <ReportStrainMaps\n                    id=\"strainMapBH\"\n                    :values=\"[\n                      OS_REPORT_VALUES.strainLADBH,\n                      OS_REPORT_VALUES.strainLCXBH,\n                      OS_REPORT_VALUES.strainRCABH,\n                    ]\"\n                  />\n                </div>\n                <div>\n                  <p\n                    style=\"\n                      margin-right: auto;\n                      background-color: #8f8f8f3b;\n                      width: 90px;\n                      padding: 2px;\n                      padding-left: 5px;\n                      border-radius: 10px;\n                    \"\n                  >\n                    Normal Range:\n                    <ReportTextBox\n                      id=\"normalRange\"\n                      :editable=\"editable\"\n                      :propValue=\"OS_REPORT_VALUES.normalRange\"\n                      @updateValue=\"handleUpdateValues\"\n                    />\n                  </p>\n                </div>\n                <div class=\"mapnames\">\n                  <h5>BASELINE</h5>\n                  <h5>HYPER-VENTILATION</h5>\n                  <h5>\n                    BREATH-HOLD <br />\n                    (30 sec)\n                  </h5>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport html2canvas from 'html2canvas';\nimport jsPDF from 'jspdf';\nimport ReportLogoHolder from './ReportLogoHolder.vue';\nimport ReportDropDown from './ReportDropDown.vue';\nimport ReportImageContainer from './ReportImageContainer.vue';\nimport ReportStrainMaps from './ReportStrainMaps.vue';\nimport ReportTextBox from './ReportTextBox.vue';\nimport ReportTextBoxMultiple from './ReportTextBoxMultiple.vue';\n// import VueHtml2pdf from 'vue-html2pdf'\n\nexport default {\n  components: {\n    ReportLogoHolder,\n    ReportDropDown,\n    ReportImageContainer,\n    ReportStrainMaps,\n    ReportTextBox,\n    ReportTextBoxMultiple,\n  },\n  props: {\n    editable: { type: Boolean, required: true, default: true },\n  },\n  data() {\n    return {\n      genderOptions: [\n        { value: 'Female', label: 'Female' },\n        { value: 'Male', label: 'Male' },\n        { value: 'Other', label: 'Other' },\n      ],\n      completeDataOptions: [\n        { value: 'Yes', label: 'Yes' },\n        { value: 'No', label: 'No' },\n      ],\n      imageQualityOptions: [\n        { value: 'Excellent', label: 'Excellent' },\n        { value: 'Good', label: 'Good' },\n        { value: 'OK', label: 'OK' },\n        { value: 'Bad', label: 'Bad' },\n      ],\n\n      OS_REPORT_VALUES: {\n        reportTitle: 'BE-OS CMR Report',\n        reportLogo: null,\n\n        patientName: 'PATIENT NAME',\n        patientGender: '',\n        patientAge: '00',\n        patientDOB: 'DD-Mon-YYYY',\n        patientID: '123 456 789',\n\n        // scanID: \"\",\n        rbhNumber: '000 000 000',\n        protocol: 'OS C-',\n        scanDate: 'DD-Mon-YYYY',\n        scanTime: '00:00',\n\n        completeData: '',\n        imageQuality: '',\n\n        reader: 'Reader Name, MD',\n        verifier: 'Verifier Name, MD',\n\n        scannerSystem: 'Philips Ingenia',\n        fieldStrength: '1.5T',\n        softwareVersion: '5.7.1.3',\n        starClaimer:\n          '*Normal values are continuously being updated, therefore, may be subject to changes',\n\n        summary: '',\n\n        heartRateBaseline: '00',\n        heartRateHV: '00',\n        heartRateBH: '00',\n        dtheartrate: '00',\n        dtheartrateNormalRange: '>15',\n\n        vascularGlobal: '00',\n        vascularLAD: '00',\n        vascularLCX: '00',\n        vascularRCA: '00',\n        normalRangeVascular: '>9.1',\n\n        strainLADBaseline: '00',\n        strainLADHV: '00',\n        strainLADBH: '00',\n\n        strainLCXBaseline: '00',\n        strainLCXHV: '00',\n        strainLCXBH: '00',\n\n        strainRCABaseline: '00',\n        strainRCAHV: '00',\n        strainRCABH: '00',\n\n        strainGLOBALBaseline: '00',\n        strainGLOBALHV: '00',\n        strainGLOBALBH: '00',\n\n        vascularImage: '',\n        strainImage: '',\n\n        oxygenSensitiveMap: '',\n        strainMapImage: '',\n\n        strainMapBaseline: '',\n        strainMapHV: '',\n        strainMapBH: '',\n        normalRange: '<-20%',\n      },\n    };\n  },\n  methods: {\n    onOptionSelected(id, value) {\n      this.OS_REPORT_VALUES[id] = value;\n    },\n    handleLogoUpdate(newLogo) {\n      this.OS_REPORT_VALUES.reportLogo = newLogo;\n    },\n    handleUpdateValues(id, newValue) {\n      // Update the 'values[id]' with the new content when the user edits the field\n      this.OS_REPORT_VALUES[id] = newValue;\n    },\n    downloadReport() {\n      this.buildPDF();\n    },\n    async getImage(id) {\n      await this.$refs[id].captureScreenshot();\n    },\n\n    async getImages() {\n      await this.getImage('strainImage');\n      await this.getImage('vascularImage');\n      await this.getImage('oxygenSensitiveMap');\n      await this.captureScreenshot('strainMapImage', 'territorymapimg');\n      await this.captureScreenshot('reportLogo', 'reportLogo');\n    },\n    async captureScreenshot(id, element) {\n      // Get the reference to the \"vascular-image-div\" div\n      const divElement = this.$refs[element];\n\n      // Use html2canvas to capture a screenshot of the div\n      html2canvas(divElement, { logging: false, scale: 3 })\n        .then((canvas) => {\n          // Convert the canvas to an image data URL\n          const imageDataURL = canvas.toDataURL('image/png');\n\n          // Emit the image data URL to the parent component\n          this.handleImageScreenshot(id, imageDataURL);\n        })\n        .catch((error) => {\n          console.error('Error capturing screenshot:', error);\n        });\n    },\n\n    handleImageScreenshot(id, image) {\n      this.OS_REPORT_VALUES[id] = image;\n    },\n    buildPDF() {\n      const fileOBJ = this.OS_REPORT_VALUES;\n      // const fileOBJ = JSON.parse(window.localStorage.getItem('reportValues'));\n      window.jsPDF = window.jspdf.jsPDF;\n      // Document of 210mm wide and 297mm high\n      const doc = jsPDF('p', 'pt', [612, 792]);\n      doc.addFont('/fonts/Roboto-Light.ttf', 'Roboto', 'normal');\n      doc.addFont('/fonts/arial_italic.ttf', 'Arial', 'normal');\n      doc.addFont('/fonts/arial_greek.ttf', 'ArialGreek', 'normal');\n      // doc.addFont('arial_bold.ttf', 'Arial', 'normal');\n\n      doc.setFont('helvetica', 'bold');\n      doc.setFontSize(22);\n      doc.text(fileOBJ.reportTitle, 42, 60);\n\n      doc.setFontSize(9);\n      doc.setTextColor('#5E5D6C');\n      doc.text('Patient', 42, 80);\n\n      if (fileOBJ.reportLogo != null) {\n        doc.addImage(fileOBJ.reportLogo, 'PNG', 413, 25, 150, 52.5);\n      }\n\n      doc.setFontSize(15);\n      doc.setTextColor('#229ED7');\n      doc.text(fileOBJ.patientName, 42, 97);\n\n      doc.setFontSize(9);\n      doc.setTextColor('#5E5D6C');\n      doc.text('Gender:', 43, 114);\n\n      doc.setFontSize(10);\n      doc.setTextColor('#000917');\n      doc.text(fileOBJ.patientGender, 81, 114);\n\n      doc.setFontSize(9);\n      doc.setTextColor('#5E5D6C');\n      doc.text('Age:', 164, 114);\n\n      doc.setFontSize(10);\n      doc.setTextColor('#000917');\n      doc.text(fileOBJ.patientAge, 187, 114);\n\n      doc.setFontSize(9);\n      doc.setTextColor('#5E5D6C');\n      doc.text('DOB:', 269, 114);\n\n      doc.setFontSize(10);\n      doc.setTextColor('#000917');\n      doc.text(fileOBJ.patientDOB, 294, 114);\n\n      doc.setFontSize(9);\n      doc.setTextColor('#5E5D6C');\n      doc.text('Patient ID:', 410, 114);\n\n      doc.setFontSize(10);\n      doc.setTextColor('#000917');\n      doc.text(fileOBJ.patientID, 460, 114);\n\n      doc.setLineWidth(0.1);\n      doc.line(577, 120, 35, 122); // horizontal line\n\n      // Below is Exam Data:\n      doc.setFontSize(10);\n      doc.setTextColor('#5E5D6C');\n      doc.text('Exam', 42, 148);\n\n      doc.setFontSize(9);\n      doc.setTextColor('#5E5D6C');\n      doc.text('RBH number:', 42, 162);\n\n      doc.setFontSize(9);\n      doc.setTextColor('#000917');\n      doc.text(fileOBJ.rbhNumber, 42, 175);\n\n      doc.setFontSize(9);\n      doc.setTextColor('#5E5D6C');\n      doc.text('Protocol:', 42, 189);\n\n      doc.setFontSize(9);\n      doc.setTextColor('#000917');\n      doc.text(fileOBJ.protocol, 42, 202);\n\n      doc.setFontSize(9);\n      doc.setTextColor('#5E5D6C');\n      doc.text('Date:', 42, 216);\n\n      doc.setFontSize(9);\n      doc.setTextColor('#000917');\n      doc.text(fileOBJ.scanDate, 42, 229);\n\n      doc.setFontSize(9);\n      doc.setTextColor('#5E5D6C');\n      doc.text('Time:', 42, 243);\n\n      doc.setFontSize(9);\n      doc.setTextColor('#000917');\n      doc.text(fileOBJ.scanTime, 42, 256);\n\n      // Below is Scan Data:\n\n      doc.setFontSize(10);\n      doc.setTextColor('#5E5D6C');\n      doc.text('Scan', 42, 293);\n\n      doc.setFontSize(9);\n      doc.setTextColor('#5E5D6C');\n      doc.text('Complete Data:', 42, 307);\n\n      doc.setFontSize(9);\n      doc.setTextColor('#000917');\n      doc.text(fileOBJ.completeData, 42, 320);\n\n      doc.setFontSize(9);\n      doc.setTextColor('#5E5D6C');\n      doc.text('Image Quality:', 42, 334);\n\n      doc.setFontSize(9);\n      doc.setTextColor('#000917');\n      doc.text(fileOBJ.imageQuality, 42, 347);\n\n      // Below is Analytical Team:\n\n      doc.setFontSize(10);\n      doc.setTextColor('#5E5D6C');\n      doc.text('Analytical Team', 42, 383);\n\n      doc.setFontSize(9);\n      doc.setTextColor('#5E5D6C');\n      doc.text('Reader:', 42, 397);\n\n      doc.setFontSize(9);\n      doc.setTextColor('#000917');\n      doc.text(fileOBJ.reader, 42, 410);\n\n      doc.setFontSize(9);\n      doc.setTextColor('#5E5D6C');\n      doc.text('Verified By:', 42, 424);\n\n      doc.setFontSize(9);\n      doc.setTextColor('#000917');\n      doc.text(fileOBJ.verifier, 42, 437);\n\n      // Below is Scanner Info:\n      doc.setFontSize(10);\n      doc.setTextColor('#5E5D6C');\n      doc.text('Scanner', 42, 473);\n\n      doc.setFontSize(9);\n      doc.setTextColor('#5E5D6C');\n      doc.text('System:', 42, 487);\n\n      doc.setFontSize(9);\n      doc.setTextColor('#000917');\n      doc.text(fileOBJ.scannerSystem, 42, 500);\n\n      doc.setFontSize(9);\n      doc.setTextColor('#5E5D6C');\n      doc.text('Field Strength:', 42, 514);\n\n      doc.setFontSize(9);\n      doc.setTextColor('#000917');\n      doc.text(fileOBJ.fieldStrength, 42, 527);\n\n      doc.setFontSize(9);\n      doc.setTextColor('#5E5D6C');\n      doc.text('Software Version:', 42, 541);\n\n      doc.setFontSize(9);\n      doc.setTextColor('#000917');\n      doc.text(fileOBJ.softwareVersion, 42, 554);\n\n      // Adding subject to change info text:\n      doc.setTextColor('#5E5D6C');\n      doc.setFont('helvetica', 'normal');\n      doc.setFont('Arial');\n      this.processSentences(fileOBJ.starClaimer, 120, doc, 42, 594);\n\n      doc.text('For research use only.', 42, 760);\n      doc.setFont('helvetica', 'bold');\n\n      // SUMMARY:\n      doc.setFontSize(12);\n      doc.setTextColor('#5E5D6C');\n      doc.text('SUMMARY', 170, 148);\n\n      // Containers For Summary  and data:\n      doc.setFillColor('#f8f8f8');\n      doc.setDrawColor(255, 255, 255);\n      doc.roundedRect(166, 155, 425, 110, 10, 10, 'FD');\n\n      // Adding Summary Text:\n      doc.setFontSize(9);\n      doc.setTextColor('#000917');\n      this.processSentences(fileOBJ.summary, 380, doc, 178, 170);\n\n      // Large Container for all values:\n      doc.setFillColor('#f8f8f8');\n      doc.setDrawColor(255, 255, 255);\n      doc.roundedRect(166, 270, 425, 500, 10, 10, 'FD');\n\n      // Overview Container (Heart Rate):\n      doc.setFillColor('#e0e0e0');\n      doc.setDrawColor(255, 255, 255);\n      doc.roundedRect(176, 275, 405, 55, 5, 5, 'FD');\n\n      doc.setFontSize(10);\n      doc.setTextColor('#000917');\n\n      // HEART RATE VALUES:\n      doc.text('Heart Rate', 186, 305);\n      doc.text('Normal Range', 186, 320);\n      doc.text(fileOBJ.heartRateBaseline, 286, 305);\n      doc.text(fileOBJ.heartRateHV, 379, 305);\n      doc.text(fileOBJ.heartRateBH, 440, 305);\n      doc.text(fileOBJ.dtheartrate, 520, 305);\n      doc.text(fileOBJ.dtheartrateNormalRange, 520, 320);\n\n      // HEART RATE HEADER:\n      doc.setFontSize(9);\n      doc.setTextColor('#5E5D6C');\n      doc.text('BASELINE', 286, 290);\n      doc.text('HV', 379, 290);\n      doc.text('BH @ 30 SEC', 440, 290);\n\n      doc.setFont('helvetica', 'normal');\n      doc.setFont('ArialGreek');\n      doc.text('Δ', 520, 290);\n      doc.setFont('helvetica', 'bold');\n      doc.text('HR', 530, 290);\n\n      // Vascular & Strain Containers:\n      doc.setFillColor('#e0e0e0');\n      doc.setDrawColor(255, 255, 255);\n      doc.roundedRect(176, 350, 200, 75, 5, 5, 'FD');\n      doc.roundedRect(381, 350, 200, 75, 5, 5, 'FD');\n\n      // Vascular & Strain Header:\n      doc.setFontSize(12);\n      doc.text('VASCULAR', 180, 345);\n      doc.text('STRAIN', 385, 345);\n\n      // VASCULAR CONTAINER:\n      doc.setFontSize(8);\n      doc.text('B-MORE', 185, 365);\n      doc.setTextColor('#000917');\n      doc.setFontSize(9);\n      doc.text('Global', 185, 380);\n      doc.text('LAD', 185, 392);\n      doc.text('LCX', 185, 404);\n      doc.text('RCA', 185, 415);\n\n      // VASCULAR VALUES:\n      doc.text(fileOBJ.vascularGlobal, 230, 380);\n      doc.text('*Normal Range: ', 260, 380);\n      doc.text(fileOBJ.normalRangeVascular, 330, 380);\n      // doc.text('\\< Hello' , 330, 380);\n\n      doc.text(fileOBJ.vascularLAD, 230, 392);\n      doc.text(fileOBJ.vascularLCX, 230, 404);\n      doc.text(fileOBJ.vascularRCA, 230, 415);\n\n      // STRAIN CONTAINER:\n      doc.setFontSize(8);\n      doc.setTextColor('#5E5D6C');\n      doc.text('B-MORE', 390, 365);\n      doc.text('BASELINE', 435, 365);\n      doc.text('HV', 485, 365);\n      doc.text('BH @ 30 SEC', 522, 365);\n\n      doc.setFontSize(9);\n      doc.setTextColor('#000917');\n      doc.text('Global', 390, 380);\n      doc.text('LAD', 390, 392);\n      doc.text('LCX', 390, 404);\n      doc.text('RCA', 390, 415);\n\n      // Strain VALUES:\n\n      // GLOBAL\n      doc.text(fileOBJ.strainGLOBALBaseline, 435, 380);\n      doc.text(fileOBJ.strainGLOBALHV, 485, 380);\n      doc.text(fileOBJ.strainGLOBALBH, 523, 380);\n\n      // LAD\n      doc.text(fileOBJ.strainLADBaseline, 435, 392);\n      doc.text(fileOBJ.strainLADHV, 485, 392);\n      doc.text(fileOBJ.strainLADBH, 523, 392);\n\n      // LCX\n      doc.text(fileOBJ.strainLCXBaseline, 435, 404);\n      doc.text(fileOBJ.strainLCXHV, 485, 404);\n      doc.text(fileOBJ.strainLCXBH, 523, 404);\n\n      // RCA\n      doc.text(fileOBJ.strainRCABaseline, 435, 415);\n      doc.text(fileOBJ.strainRCAHV, 485, 415);\n      doc.text(fileOBJ.strainRCABH, 523, 415);\n\n      // Vascular and Strain Images:\n      doc.roundedRect(176, 430, 200, 187.5, 0, 0, 'FD');\n      doc.roundedRect(381, 430, 200, 187.5, 0, 0, 'FD');\n\n      // OS-Map Graph:\n      doc.setFontSize(12);\n      doc.setTextColor('#000917');\n      doc.text('Oxygen Sensitive Map', 210, 635);\n      // doc.roundedRect(176, 640, 200, 125, 0, 0, 'FD');\n\n      doc.text('STRAIN MAPS', 382, 635);\n      // doc.roundedRect(381, 640, 200, 90, 0, 0, 'FD');\n\n      doc.setFontSize(8);\n      doc.setTextColor('#5E5D6C');\n      doc.text('BASELINE', 390, 753);\n      doc.text('HYPER-', 467, 748);\n      doc.text('VENTILATION', 455, 758);\n      doc.text('BREATH-', 535, 743);\n      doc.text('HOLD', 540, 753);\n      doc.text('(30 sec)', 537, 763);\n\n      // Normal Range Container (Strain Maps):\n      doc.setFillColor('#e0e0e0');\n      doc.setDrawColor(255, 255, 255);\n      doc.roundedRect(375, 715, 75, 25, 7, 7, 'FD');\n      doc.setFontSize(9);\n      doc.setTextColor('#000917');\n      doc.text('Normal Range: ', 380, 724.5);\n      doc.text(fileOBJ.normalRange, 380, 734.5);\n\n      // // Call the function to take screenshots and store them in an object\n      // takeScreenshots(divIds).then((screenshotsObject) => {\n      doc.addImage(fileOBJ.strainImage, 'PNG', 381, 430, 200, 187.5);\n      doc.addImage(fileOBJ.vascularImage, 'PNG', 176, 430, 200, 187.5);\n      doc.addImage(fileOBJ.oxygenSensitiveMap, 'PNG', 201, 650, 150, 112.5);\n      doc.addImage(fileOBJ.strainMapImage, 'PNG', 376, 645, 210, 70);\n      //   doc.addImage(\n      //     screenshotsObject['territory-map-img'],\n      //     'PNG',\n      //     376,\n      //     645,\n      //     210,\n      //     70\n      //   );\n\n      const today = new Date().toLocaleDateString('en-US');\n\n      doc.save(`Area19_Report_${fileOBJ.patientName}_${today}.pdf`);\n\n      // });\n    },\n    processSentences(inputString, lineWidth, doc, xLocation, initialY) {\n      // Helper function to measure the width of the text using a given font\n      function getTextWidth(text) {\n        const element = document.createElement('span');\n        element.style.font = '10px Arial';\n        element.style.position = 'absolute';\n        element.style.visibility = 'hidden';\n        element.textContent = text;\n        document.body.appendChild(element);\n        const { width } = element.getBoundingClientRect();\n        document.body.removeChild(element);\n        return width;\n      }\n\n      // Remove any leading/trailing whitespace and split the input into sentences\n      let sentences = inputString.trim().split(/(?<=[.!?])|\\n/); // Split by \".\", \"!\", \"?\" including punctuation\n      sentences = sentences.map((string) => string.replace(/\\n/g, ''));\n      // Helper function to split a long sentence into chunks based on the line width\n      function splitSentence(sentence, width) {\n        const words = sentence.split(' ');\n        const chunks = [];\n        let currentChunk = words[0];\n\n        for (let i = 1; i < words.length; i++) {\n          const testChunk = `${currentChunk} ${words[i]}`;\n          const testWidth = getTextWidth(testChunk);\n\n          if (testWidth <= width) {\n            currentChunk = testChunk;\n          } else {\n            chunks.push(currentChunk);\n            currentChunk = words[i];\n          }\n        }\n\n        chunks.push(currentChunk);\n        return chunks;\n      }\n\n      let logIndex = 0; // Variable to keep track of the index\n      let y = initialY;\n\n      // Process each sentence\n      sentences.forEach((sentence) => {\n        if (getTextWidth(sentence) > lineWidth) {\n          const sentenceChunks = splitSentence(sentence, lineWidth);\n\n          sentenceChunks.forEach((chunk) => {\n            if (logIndex > 0) {\n              y += 14;\n            }\n            doc.text(chunk, xLocation, y);\n            logIndex++;\n          });\n        } else {\n          if (logIndex > 0) {\n            y += 14;\n          }\n          doc.text(sentence, xLocation, y);\n          logIndex++;\n        }\n      });\n    },\n  },\n  watch: {\n    OS_REPORT_VALUES: {\n      handler() {\n        window.localStorage.setItem(\n          'reportValues',\n          JSON.stringify(this.OS_REPORT_VALUES)\n        );\n      },\n      deep: true,\n    },\n    editable() {\n      if (!this.editable) {\n        this.getImages();\n      }\n    },\n  },\n};\n</script>\n\n<style scoped>\n* {\n  user-select: none;\n}\nh1 {\n  color: black;\n}\n\nbody h3 {\n  color: #5e5d6c;\n  font-weight: 500;\n}\n\nbody h5 {\n  color: #5e5d6c;\n  font-weight: 500;\n  font-size: 13px;\n}\n\nbody h4 {\n  color: #5e5d6c;\n  font-weight: 700;\n}\n\nbody h2 {\n  color: #229ed7;\n  font-weight: 500;\n  border: none;\n  outline: none;\n}\n\nbody p {\n  color: #000917;\n  font-weight: 700;\n  font-size: 12px;\n  width: 80%;\n}\nbody {\n  display: flex;\n  gap: 50px;\n  print-color-adjust: exact;\n  -webkit-print-color-adjust: exact;\n}\n\n.report-element {\n  width: 612pt;\n  height: 850pt;\n  margin-left: auto;\n  margin-right: auto;\n  display: grid;\n  grid-template-columns: [col1] 40px [col2] 50px [col3] auto [col4] 50px [col5] 40px [end];\n  grid-template-rows: [row1] 5% [row2] 5% [row3] 2.5% [row4];\n  padding: 20px;\n  border: 2px solid black;\n  margin-top: 2%;\n  border-radius: 15px;\n  background: white;\n}\n\n.row1 {\n  grid-column: 1/5;\n  grid-row: 1;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n#logo {\n  max-width: 100%;\n  max-height: 100%;\n  align-self: center;\n  justify-self: center;\n}\n\n#logo:hover {\n  opacity: 0.8;\n  transition: 0.3s;\n}\n\n.row2 {\n  border: 0px solid black;\n  grid-column: 1/6;\n  grid-row: 2;\n}\n\n.row3 {\n  border-bottom: 1px solid black;\n  width: 100%;\n  grid-column: 1/6;\n  grid-row: 3;\n  display: grid;\n  grid-template-columns: 23% 23% 23% 23%;\n  align-content: center;\n}\n\n.below {\n  width: 100%;\n  grid-column: 1 / end;\n  grid-row: 4 / end;\n  display: grid;\n  grid-template-columns: 17% 10% 25% 28% 25%;\n  align-content: center;\n  display: grid;\n  margin-top: 2%;\n  grid-template-columns: [col1] 23% [col2] 77%;\n  grid-template-rows: 100%;\n}\n\n.left-column {\n  border: 0px solid black;\n  width: 100%;\n  grid-column: 1;\n  display: grid;\n  grid-template-columns: 100%;\n  grid-template-rows: 24% 15% 15% 20% 22%;\n}\n\n.right-column {\n  width: 100%;\n  display: grid;\n  grid-template-rows: 23.5%;\n}\n\n.Scan span {\n  font-weight: bold;\n}\n\ntextarea {\n  width: 100%;\n  height: 85%;\n  padding: 10px 10px;\n  margin-top: 10px;\n  overflow-y: hidden;\n\n  box-sizing: border-box;\n  border: 2px solid #ccc;\n  border-radius: 4px;\n  background-color: #f8f8f8;\n  resize: none;\n  font-size: 14px;\n  font-weight: bold;\n  line-height: 25px;\n}\n\n.detailed-report {\n  display: grid;\n  border: 2px solid #ccc;\n  grid-template-rows: 15% 55% 30%;\n  background-color: #f8f8f8;\n  border-radius: 15px;\n}\n\n.overview {\n  border-radius: 15px;\n  width: 96%;\n  height: 80%;\n  justify-self: center;\n  align-self: center;\n  background-color: #8f8f8f3b;\n  display: grid;\n  grid-template-columns: 28% 18% 16% 24% 18%;\n}\n\n.overview h5 {\n  color: #000917;\n  font-weight: bold;\n  font-size: 14px;\n  width: 60px;\n}\n\n.labels {\n  display: grid;\n  padding-left: 10px;\n  padding-top: 10px;\n\n  grid-template-rows: 33% 33% 33%;\n}\n.baselinevals {\n  display: grid;\n  padding-top: 10px;\n\n  grid-template-rows: 33% 33% 33%;\n}\n.hyperventvals {\n  display: grid;\n  padding-top: 10px;\n\n  grid-template-rows: 33% 33% 33%;\n}\n.BHvals {\n  display: grid;\n  padding-top: 10px;\n\n  grid-template-rows: 33% 33% 33%;\n}\n\n.overview_middle {\n  display: grid;\n  grid-template-columns: 50% 50%;\n\n  width: 96%;\n  justify-self: center;\n}\n\n.overview_graphs {\n  display: grid;\n  grid-template-columns: 50% 50%;\n  margin-top: 10px;\n  width: 96%;\n  justify-self: center;\n}\n\n.col {\n  display: grid;\n  grid-template-rows: 5% 30% 65%;\n  width: 98%;\n}\n\n.vals {\n  border-radius: 15px;\n  width: 100%;\n  height: 100%;\n  justify-self: center;\n  align-self: center;\n  background-color: #8f8f8f3b;\n}\n.valuesOCG {\n  padding: 3%;\n}\n\n.valuesOCG h6 {\n  color: #5e5d6c;\n}\n\n.valuesOCG h5 {\n  color: #000917;\n  font-weight: bold;\n  font-size: 13px;\n  line-height: 17px;\n  padding-left: 2%;\n}\n\n.valuesOCG span {\n  padding-left: 25px;\n}\n\n.valuesSTRAIN {\n  padding: 3%;\n  display: grid;\n  grid-template-columns: 24% 25% 23% 28%;\n}\n.valuesSTRAIN h5 {\n  color: #000917;\n  font-weight: bold;\n  font-size: 13px;\n  line-height: 17px;\n  padding-left: 2%;\n}\n.valuesSTRAIN h6 {\n  color: #5e5d6c;\n}\n\n.strain-containter {\n  display: grid;\n  grid-template-rows: 20% 20% 20% 20% 20%;\n  gap: 2px;\n}\n\n.upload-buttons {\n  cursor: pointer;\n  position: absolute;\n  background-color: #3a39396e;\n  border-radius: 5px;\n  border: none;\n  display: block;\n  width: 30px;\n  height: 30px;\n  top: 10px;\n  z-index: 100;\n}\n\n.upload-image {\n  left: 10px;\n}\n\n.upload-buttons:hover {\n  background-color: #7070707a;\n  transition: 0.3s;\n}\n\n#image-container {\n  margin-top: 5px;\n  width: 95%;\n  height: 250px;\n  width: 200pt;\n  justify-self: center;\n  align-self: center;\n  background-color: #0000003b;\n  overflow: hidden;\n  background-size: 130%;\n  background-position: 50% 0;\n}\n\n/* #image-container:hover {\n    opacity: 0.8;\n    transition: 0.3s;\n  } */\n\n/* #image-container2:hover {\n    opacity: 0.8;\n    transition: 0.3s;\n  } */\n\n#bar-graph-legend-os {\n  height: 200px;\n  position: absolute;\n  left: 215px;\n  top: 25px;\n  z-index: 10;\n  background: #5252524b;\n  padding: 5px;\n  padding-right: 2px;\n  border-radius: 10px;\n}\n\n.strainmaps {\n  display: grid;\n  grid-template-rows: 10% 54% 18% 23%;\n  padding-left: 10px;\n}\n\n.territorymaps {\n  display: flex;\n  gap: 10px;\n  justify-content: center;\n  width: 210pt;\n  height: 69pt;\n  border: none;\n  background-color: #f8f8f8;\n  padding-top: 2px;\n  margin-top: 5px;\n}\n\n.territorymaps svg {\n  width: 85px;\n  height: 85px;\n}\n\n.mapnames {\n  display: grid;\n  grid-template-columns: 85px 85px 85px;\n  justify-content: center;\n  gap: 10px;\n  text-align: center;\n}\n\n.mapnames h5 {\n  font-size: 12px;\n  align-self: center;\n  margin-top: -20px;\n}\n\n#graph-container {\n  position: absolute;\n  top: 945px;\n  left: 540px;\n  height: 150px;\n  width: 200px;\n  background: rgb(248, 248, 248);\n  overflow: hidden;\n  border: 2px solid red;\n}\n\n#graph-container img:active {\n  cursor: grabbing;\n}\n\n#graph-container img {\n  width: 100%;\n  height: auto;\n  transition: transform 0.2s;\n  position: absolute;\n  top: 0;\n  left: 0;\n  cursor: grab;\n}\n\n@page {\n  size: A4;\n}\n\n@media print {\n  #report-element {\n    margin-top: 0px;\n    border: None;\n    padding: 0;\n  }\n  body {\n    background: rgb(231, 0, 0);\n  }\n\n  #graph-container {\n    border: 0px solid white;\n    position: absolute;\n    top: 905px;\n    left: 220px;\n  }\n  #bar-graph-legend-os {\n    left: 259px;\n  }\n}\n</style>\n","<template>\n  <div class=\"reportcontainermain\">\n    <div class=\"reporthere\">\n      <!-- <div class=\"hidereport\">\n                <h1>hello</h1>\n            </div> -->\n\n      <Report ref=\"editablereport\" :editable=\"edit\" />\n    </div>\n\n    <div class=\"toolbar\">\n      <button class=\"tool\" @click=\"handleEdit\" :class=\"{ clicked: edit }\">\n        <h1>Edit</h1>\n      </button>\n      <button class=\"tool\"><h1>Share</h1></button>\n      <button class=\"tool\" @click=\"printReport\">\n        <h1>Print</h1>\n      </button>\n      <div style=\"position: relative\">\n        <button class=\"tool\" @click=\"handleSave\"><h1>Save</h1></button>\n        <div class=\"popup\" :class=\"{ show: showPopup }\">\n          <h5>Please stop editing first.</h5>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport Report from '../components/ReportHtml.vue';\n\nexport default {\n  components: {\n    Report,\n  },\n  methods: {\n    printReport() {\n      this.$refs.editablereport.buildPDF();\n    },\n    handleEdit() {\n      this.edit = !this.edit;\n    },\n    handleSave() {\n      if (this.edit) {\n        // Show the popup for 3 seconds\n        this.showPopup = true;\n        setTimeout(() => {\n          this.showPopup = false;\n        }, 3000); // 3000 milliseconds = 3 seconds\n      } else {\n        this.$refs.editablereport.downloadReport();\n      }\n    },\n  },\n  data() {\n    return {\n      edit: true,\n      showPopup: false,\n    };\n  },\n};\n</script>\n\n<style scoped>\n.popup {\n  position: absolute;\n  left: 145px;\n  top: 18px;\n  transform: translate(-50%, -50%);\n  background-color: rgba(0, 0, 0, 0.3);\n  color: white;\n  padding: 10px 15px;\n  border-radius: 5px;\n  z-index: 9999;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  font-size: 14px;\n  opacity: 0;\n  pointer-events: none;\n  transition: opacity 0.3s ease-out;\n  width: 180px;\n}\n\n.popup.show {\n  opacity: 1;\n  pointer-events: auto;\n}\n\n.reportcontainermain {\n  background: rgba(0, 0, 0, 0.5);\n  height: 100%;\n  width: 100%;\n  display: grid;\n  grid-template-columns: 25% 45% 10% 20%;\n  gap: 17px;\n  overflow: hidden;\n}\n\n.clicked {\n  background: #229ed7;\n}\n\n/* .hidereport{\n    background: rgba(255, 0, 0, 0.13);\n    position: absolute;\n    width: 580pt;\n    height: 800pt;\n\n} */\n\n.reporthere {\n  /* border: 2px solid white; */\n  border-radius: 7px;\n  width: 100%;\n  margin-left: auto;\n  margin-right: auto;\n  margin-top: 5%;\n  grid-column: 2;\n  overflow: scroll;\n  /* overflow-y: hidden; */\n  overflow-x: hidden; /* Hide horizontal scrollbar */\n  user-select: all;\n  -ms-overflow-style: none;\n  scrollbar-width: none;\n  height: 85vh;\n}\n\n.reporthere::-webkit-scrollbar {\n  display: none;\n  width: 0 !important;\n}\n\n.toolbar {\n  /* border: 2px solid white; */\n  display: flex;\n  flex-direction: column;\n  margin-bottom: auto;\n  margin-top: 30%;\n  gap: 15.5px;\n}\n.tool {\n  border: 1px solid #707070;\n  /* padding: 7.5px; */\n  width: 50px;\n  height: 35px;\n}\n\n.tool h1 {\n  font-size: 13px;\n}\n\n.tool:hover {\n  background: #229ed78c;\n  transition: 0.2s;\n}\n\n/* Media query for large laptops */\n@media (max-width: 1450px) {\n  .reportcontainermain {\n    grid-template-columns: 15% 60% 10%;\n  }\n}\n\n/* Media query for normal sized laptops */\n@media (max-width: 1400px) {\n  .reportcontainermain {\n    grid-template-columns: 1% 83% 10%;\n  }\n}\n</style>\n","<template>\n  <div>\n    <canvas ref=\"canvas\" width=\"411\" height=\"206\" style=\"\"></canvas>\n  </div>\n</template>\n\n<script>\nexport default {\n  props: {\n    dataToGraph: {\n      type: Array,\n    },\n  },\n\n  watch: {\n    dataToGraph: {\n      deep: true,\n      handler() {\n        // console.log('change');\n        // console.log(this.dataToGraph);\n\n        this.drawLines();\n        // myLineChart = new LineChart(con);\n      },\n    },\n  },\n\n  data() {\n    return {\n      canvasId: 'myCanvas',\n\n      // user defined properties\n      minX: 0,\n      minY: 0,\n      maxX: 15,\n      maxY: 1,\n      unitsPerTickX: 5,\n      unitsPerTickY: 0.25,\n      title: 'Normalized SI (RV-LV)',\n\n      // constants\n      padding: 15,\n      tickSize: 0.1,\n      axisColor: 'white',\n      pointRadius: 1,\n      font: '10pt Arial',\n      fontHeight: 10,\n      rangeX: null,\n      rangeY: null,\n      numXTicks: null,\n      numYTicks: null,\n      x: null,\n      y: null,\n      width: null,\n      height: null,\n      scaleX: null,\n      scaleY: null,\n\n      context: null,\n      data: null,\n    };\n  },\n\n  methods: {\n    drawSysDias(contexti, xDiastole) {\n      const context = contexti;\n      context.save();\n      context.translate(this.x, this.y + this.height);\n\n      context.font = '12px Arial';\n      context.fillStyle = 'white';\n\n      context.fillText(\n        'Systole',\n        0 * this.scaleX,\n        0 - (this.height + this.padding)\n      );\n\n      // Create gradient\n      // console.log(this.scaleX);\n      const grd = context.createLinearGradient(\n        xDiastole * this.scaleX,\n        0,\n        this.maxX * this.scaleX - 50,\n        0\n      );\n      grd.addColorStop(0, 'rgba(38, 151, 192, 0.25)');\n      grd.addColorStop(1, '#686F7100');\n\n      // Fill with gradient\n      context.fillStyle = grd;\n      context.fillRect(\n        xDiastole * this.scaleX,\n        0,\n        this.maxX * this.scaleX,\n        0 - (this.height + 2 * this.padding)\n      );\n      context.strokeStyle = 'white';\n      context.lineWidth = 1;\n      context.beginPath();\n      context.moveTo(xDiastole * this.scaleX, 0);\n      context.lineTo(\n        xDiastole * this.scaleX,\n        0 - (this.height + 2 * this.padding)\n      );\n      context.stroke();\n\n      context.fillStyle = 'white';\n\n      context.fillText(\n        'Diastole',\n        xDiastole * this.scaleX + 5,\n        0 - (this.height + this.padding)\n      );\n      context.restore();\n    },\n\n    getLongestValueWidth(contexti) {\n      let longestValueWidth = 0;\n      const context = contexti;\n      context.font = this.font;\n\n      for (let n = 0; n <= this.numYTicks; n++) {\n        const value = this.maxY - n * this.unitsPerTickY;\n        longestValueWidth = Math.max(\n          longestValueWidth,\n          context.measureText(value).width\n        );\n      }\n      return longestValueWidth;\n    },\n\n    drawXAxis(contexti) {\n      const context = contexti;\n      context.save();\n      context.beginPath();\n      context.moveTo(this.x, this.y + this.height);\n      // context.lineTo(this.x + this.width, this.y + this.height);\n      context.strokeStyle = this.axisColor;\n      context.lineWidth = 1;\n      context.stroke();\n\n      // draw tick marks (optional)\n      // for (var n = 0; n < this.numXTicks; n++) {\n      //   context.beginPath();\n      //   context.moveTo(\n      //     ((n + 1) * this.width) / this.numXTicks + this.x,\n      //     this.y + this.height\n      //   );\n      //   context.lineTo(\n      //     ((n + 1) * this.width) / this.numXTicks + this.x,\n      //     this.y + this.height - this.tickSize\n      //   );\n      //   context.stroke();\n      // }\n\n      // draw labels\n      context.font = this.font;\n      context.fillStyle = 'white';\n      context.textAlign = 'center';\n      context.textBaseline = 'middle';\n\n      // Draw x axis\n      for (let n = -1; n < this.numXTicks; n++) {\n        const label = Math.round(((n + 1) * this.maxX) / this.numXTicks);\n        context.save();\n        context.translate(\n          ((n + 1) * this.width) / this.numXTicks + this.x,\n          this.y + this.height + this.padding\n        );\n        context.fillText(label, 0, 0);\n        context.restore();\n      }\n      context.restore();\n    },\n\n    drawYAxis(contexti) {\n      const context = contexti;\n      context.save();\n      context.save();\n      context.beginPath();\n      context.moveTo(this.x, this.y);\n      // context.lineTo(this.x, this.y + this.height);\n      context.strokeStyle = this.axisColor;\n      // context.lineWidth = 0.5;\n      context.stroke();\n      context.restore();\n\n      // draw values\n      context.font = this.font;\n      context.fillStyle = 'white';\n      context.textAlign = 'right';\n      context.textBaseline = 'middle';\n\n      for (let n = 0; n <= this.numYTicks; n++) {\n        const value = this.maxY - (n * this.maxY) / this.numYTicks;\n        context.save();\n        context.translate(\n          this.x - this.padding + 5,\n          (n * this.height) / this.numYTicks + this.y\n        );\n        context.fillText(value, 0, 0);\n        context.restore();\n      }\n      context.restore();\n    },\n\n    drawLine(contexti, data, color, width) {\n      const context = contexti;\n      context.save();\n      this.transformContext(context);\n      context.lineWidth = width;\n      context.strokeStyle = color;\n      context.fillStyle = color;\n      context.shadowBlur = 10;\n      context.shadowColor = color;\n\n      context.beginPath();\n      context.moveTo(data[0].x * this.scaleX, data[0].y * this.scaleY);\n\n      for (let n = 0; n < data.length; n++) {\n        const point = data[n];\n\n        // draw segment\n        context.lineTo(point.x * this.scaleX, point.y * this.scaleY);\n        context.stroke();\n        context.closePath();\n        context.beginPath();\n        context.arc(\n          point.x * this.scaleX,\n          point.y * this.scaleY,\n          this.pointRadius,\n          0,\n          2 * Math.PI,\n          false\n        );\n        context.fill();\n        context.closePath();\n\n        // position for next segment\n        context.beginPath();\n        context.moveTo(point.x * this.scaleX, point.y * this.scaleY);\n      }\n      context.restore();\n    },\n    transformContext(context) {\n      // move context to center of canvas\n      context.translate(this.x, this.y + this.height);\n\n      // invert the y scale so that increments\n      // as you move upwards\n      context.scale(1, -1);\n    },\n    generateRandomData(n) {\n      const data = [];\n\n      for (let i = 0; i <= n; i++) {\n        const x = i * 1; // Increasing x-values by increments of 20\n        const y = Math.random(); // Random y-value between 0 and 1\n\n        data.push({ x, y });\n      }\n\n      return data;\n    },\n\n    drawLines() {\n      const { context } = this;\n\n      context.clearRect(\n        0 + this.padding,\n        this.y - 2 * this.padding,\n        this.width + 4 * this.padding,\n        this.height + 4 * this.padding\n      );\n      const colors = ['#a2191a', '#105a93', '#1f7c55'];\n\n      for (let i = 0; i < this.dataToGraph.length; i++) {\n        if (this.dataToGraph[i] === 1) {\n          this.drawLine(context, this.data[i], colors[i], 2);\n        }\n      }\n      this.drawSysDias(context, 7.5);\n      this.drawXAxis(context);\n      this.drawYAxis(context);\n    },\n  },\n  mounted() {\n    const { canvas } = this.$refs;\n    const context = canvas.getContext('2d');\n    this.x = this.getLongestValueWidth(context) + this.padding * 2 + 25;\n    this.context = context;\n    this.y = this.padding * 2;\n    this.width = canvas.width - this.x - this.padding * 2;\n    this.height = canvas.height - this.y - this.padding - this.fontHeight;\n    this.rangeX = this.maxX - this.minY;\n    this.scaleX = this.width / this.rangeX;\n    this.rangeY = this.maxY - this.minY;\n    this.scaleY = this.height / this.rangeY;\n\n    this.numXTicks = Math.round(this.rangeX / this.unitsPerTickX);\n    this.numYTicks = Math.round(this.rangeY / this.unitsPerTickY);\n\n    // draw x y axis and tick marks\n    this.drawXAxis(context);\n    this.drawYAxis(context);\n\n    // Save the current transformation state\n    context.save();\n\n    // Set the rotation angle and position of the text\n    context.translate(10, this.height / 1.5);\n    context.rotate((270 * Math.PI) / 180);\n\n    // Set the text properties\n    context.font = '12px Arial';\n    context.fillStyle = 'white';\n    context.textAlign = 'center';\n    context.textBaseline = 'middle';\n\n    // Draw the rotated text\n    context.fillText(this.title, 0, 0);\n\n    // Restore the original transformation state\n    context.restore();\n\n    this.drawSysDias(context, 7.5);\n\n    // const myLineChart = new LineChart(this.con);\n\n    // const redData = [\n    //   { x: 20, y: 0.85 },\n    //   { x: 40, y: 0.75 },\n    //   { x: 60, y: 0 },\n    //   { x: 80, y: 0 },\n    //   { x: 100, y: 0 },\n    //   { x: 120, y: 0.4 },\n    //   { x: 150, y: 0.35 },\n    // ];\n    const dataHere = [\n      this.generateRandomData(15),\n      this.generateRandomData(15),\n      this.generateRandomData(15),\n    ];\n\n    this.data = dataHere;\n\n    this.drawLines();\n  },\n};\n</script>\n\n<style scoped>\n.fade-enter-active,\n.fade-leave-active {\n  transition: opacity 0.5s;\n}\n\n.fade-enter,\n.fade-leave-to {\n  opacity: 0;\n}\n</style>\n","<template>\n  <div>\n    <canvas ref=\"chartCanvas\"></canvas>\n  </div>\n</template>\n\n<script>\nexport default {\n  props: {\n    id: {\n      type: Number,\n      required: true,\n    },\n  },\n  data() {\n    return {\n      sectionOpacities: [0.7, 0.7, 0.7], // Initial opacity values for each section\n      hoveredSection: -1,\n      outerradius: 60,\n    };\n  },\n  mounted() {\n    this.createChart();\n  },\n  methods: {\n    createChart() {\n      const canvas = this.$refs.chartCanvas;\n      const ctx = canvas.getContext('2d');\n\n      const centerX = canvas.width / 2 - 85;\n      const centerY = canvas.height / 2;\n      const outerRadius = this.outerradius;\n      const innerRadius = outerRadius / 3;\n\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      canvas.addEventListener('click', this.handleChartClick);\n\n      canvas.addEventListener('mousemove', this.handleChartHover);\n      canvas.addEventListener('mouseleave', this.handleChartLeave);\n      canvas.addEventListener('dblclick', this.handleChartDoubleClick);\n\n      // Customize the colors for each section\n      const sectionColors = ['#a2191a', '#105a93', '#1f7c55'];\n\n      // Define the data for the chart sections\n      const chartData = [1, 1, 1]; // Equal values for each section\n\n      const totalValue = chartData.reduce((total, value) => total + value, 0);\n\n      let startAngle = 0;\n      chartData.forEach((value, index) => {\n        const sectionAngle = (value / totalValue) * Math.PI * 2;\n        const endAngle = startAngle + sectionAngle;\n\n        ctx.beginPath();\n        ctx.moveTo(\n          centerX + outerRadius * Math.cos(startAngle),\n          centerY + outerRadius * Math.sin(startAngle)\n        );\n        ctx.arc(centerX, centerY, outerRadius, startAngle, endAngle);\n        ctx.arc(centerX, centerY, innerRadius, endAngle, startAngle, true);\n        ctx.closePath();\n\n        // Apply opacity to the section\n        const opacity =\n          this.hoveredSection === index\n            ? this.sectionOpacities[index] + 0.3\n            : this.sectionOpacities[index];\n        ctx.globalAlpha = opacity;\n\n        ctx.fillStyle = sectionColors[index];\n        ctx.fill();\n\n        // Reset globalAlpha back to 1\n        ctx.globalAlpha = 1;\n\n        // Add stroke between the regions\n        ctx.strokeStyle = '#ffffff';\n        ctx.lineWidth = 2;\n        ctx.stroke();\n\n        startAngle = endAngle;\n      });\n\n      // Draw white stroke around the outer circle\n      ctx.beginPath();\n      ctx.arc(centerX, centerY, outerRadius, 0, Math.PI * 2);\n      ctx.strokeStyle = '#ffffff';\n      ctx.lineWidth = 1;\n      ctx.stroke();\n\n      // Draw white stroke around the inner hole\n      ctx.beginPath();\n      ctx.arc(centerX, centerY, innerRadius, 0, Math.PI * 2);\n      ctx.strokeStyle = '#ffffff';\n      ctx.lineWidth = 1;\n      ctx.stroke();\n    },\n    handleChartClick(event) {\n      const canvas = this.$refs.chartCanvas;\n      const rect = canvas.getBoundingClientRect();\n      const mouseX = event.clientX - rect.left;\n      const mouseY = event.clientY - rect.top;\n\n      const centerX = canvas.width / 2 - 85;\n      const centerY = canvas.height / 2;\n      const outerRadius = this.outerradius;\n      const innerRadius = outerRadius / 3;\n\n      const distanceFromCenter = Math.sqrt(\n        (mouseX - centerX) ** 2 + (mouseY - centerY) ** 2\n      );\n\n      if (distanceFromCenter < innerRadius) {\n        // Clicked on the inner hole, restore all opacities\n        this.sectionOpacities = [0.7, 0.7, 0.7];\n      } else if (distanceFromCenter >= outerRadius) {\n        return;\n      } else {\n        const angle = Math.atan2(mouseY - centerY, mouseX - centerX);\n        const normalizedAngle = angle >= 0 ? angle : angle + Math.PI * 2;\n\n        const sectionIndex = Math.floor((normalizedAngle / (Math.PI * 2)) * 3);\n\n        // Toggle opacity for the clicked section\n        this.sectionOpacities[sectionIndex] =\n          this.sectionOpacities[sectionIndex] === 0.7 ? 0.2 : 0.7;\n      }\n\n      // Redraw the chart with updated opacities\n      //   this.$emit('segment-updated', this.id, this.sectionOpacities);\n      this.createChart();\n      this.$emit('segment-updated', this.id, this.sectionOpacities);\n    },\n\n    handleChartDoubleClick(event) {\n      const canvas = this.$refs.chartCanvas;\n      const rect = canvas.getBoundingClientRect();\n      const mouseX = event.clientX - rect.left;\n      const mouseY = event.clientY - rect.top;\n\n      const centerX = canvas.width / 2 - 85;\n      const centerY = canvas.height / 2;\n      const outerRadius = this.outerradius;\n      const innerRadius = outerRadius / 3;\n\n      const distanceFromCenter = Math.sqrt(\n        (mouseX - centerX) ** 2 + (mouseY - centerY) ** 2\n      );\n\n      if (distanceFromCenter < innerRadius) {\n        // Clicked on the inner hole, restore all opacities\n        this.sectionOpacities = [0.7, 0.7, 0.7];\n      } else if (distanceFromCenter >= outerRadius) {\n        return;\n      } else {\n        const angle = Math.atan2(mouseY - centerY, mouseX - centerX);\n        const normalizedAngle = angle >= 0 ? angle : angle + Math.PI * 2;\n\n        const sectionIndex = Math.floor((normalizedAngle / (Math.PI * 2)) * 3);\n\n        // Toggle opacity for the clicked section\n        this.sectionOpacities = [0.2, 0.2, 0.2];\n        this.sectionOpacities[sectionIndex] = 0.7;\n      }\n\n      // Redraw the chart with updated opacities\n      //   this.$emit('segment-updated', this.id, this.sectionOpacities);\n      this.createChart();\n      this.$emit('segment-updated', this.id, this.sectionOpacities);\n    },\n\n    handleChartHover(event) {\n      const canvas = this.$refs.chartCanvas;\n      const rect = canvas.getBoundingClientRect();\n      const mouseX = event.clientX - rect.left;\n      const mouseY = event.clientY - rect.top;\n\n      const centerX = canvas.width / 2 - 85;\n      const centerY = canvas.height / 2;\n      const outerRadius = this.outerradius;\n      const innerRadius = outerRadius / 3;\n\n      const distanceFromCenter = Math.sqrt(\n        (mouseX - centerX) ** 2 + (mouseY - centerY) ** 2\n      );\n\n      if (distanceFromCenter < innerRadius) {\n        // Hovered on the inner hole, restore all opacities\n        this.hoveredSection = -1;\n      } else if (distanceFromCenter >= outerRadius) {\n        this.handleChartLeave();\n        return;\n      } else {\n        const angle = Math.atan2(mouseY - centerY, mouseX - centerX);\n        const normalizedAngle = angle >= 0 ? angle : angle + Math.PI * 2;\n\n        const sectionIndex = Math.floor((normalizedAngle / (Math.PI * 2)) * 3);\n\n        // Update the hovered section\n        this.hoveredSection = sectionIndex;\n      }\n\n      // Redraw the chart with updated opacities\n      this.createChart();\n    },\n    handleChartLeave() {\n      // Reset the hovered section when leaving the chart\n      this.hoveredSection = -1;\n\n      // Redraw the chart with updated opacities\n      this.createChart();\n    },\n  },\n};\n</script>\n\n<style scoped></style>\n","<template>\n  <div>\n    <h4\n      @mouseenter=\"handleMouseEnter\"\n      @focusin=\"handleMouseEnter\"\n      @mouseleave=\"handleMouseLeave\"\n      @focusout=\"handleMouseLeave\"\n      @click=\"handleClick\"\n      :style=\"{ opacity: setTextOpacity }\"\n      @keydown.space.prevent=\"handleKeyDown\"\n    >\n      {{ label }}\n    </h4>\n  </div>\n</template>\n\n<script>\nexport default {\n  props: {\n    label: {\n      type: String,\n      default: 'Territory Min',\n    },\n    textOpacity: {\n      type: Number,\n      default: 1,\n    },\n  },\n  updated() {},\n\n  data() {\n    return {\n      setTextOpacity: this.textOpacity,\n    };\n  },\n  methods: {\n    handleMouseEnter() {\n      // Function to call when hovering over the div\n      this.setTextOpacity += 0.3;\n      // Call your desired function or perform any action\n    },\n    handleMouseLeave() {\n      // Function to call when hovering out of the div\n      this.setTextOpacity -= 0.3;\n      // Call your desired function or perform any action\n    },\n    handleClick() {\n      // Function to call when hovering out of the div\n      // if (this.setTextOpacity <= 0.6) {\n      //   this.setTextOpacity = 0.9;\n      // } else {\n      //   this.setTextOpacity = 0.6;\n      // }\n\n      this.$emit('biomarker-click', this.label);\n\n      // Call your desired function or perform any action\n    },\n  },\n};\n</script>\n\n<style scoped>\nh4 {\n  font-size: 14px;\n}\n\nh4:hover {\n  opacity: 1;\n  cursor: pointer;\n}\n</style>\n","<template>\n  <div class=\"biomarkerviewer\">\n    <div class=\"biomarkercomponent\">\n      <div class=\"screen1\" :style=\"{ height: itemHeight + 'px' }\">\n        <ScreenTemp />\n      </div>\n      <div class=\"graphs\">\n        <div class=\"headertitle\">\n          <h2>ANALYSIS</h2>\n\n          <!-- <i\n            @click=\"changeHeight\"\n            class=\"fa-solid fa-play fa-rotate-270\"\n            style=\"color: #c4c4c4; margin-left: auto\"\n            @keydown.space.prevent=\"handleKeyDown\"\n          ></i> -->\n        </div>\n\n        <div\n          class=\"territoryGraphs\"\n          ref=\"scrollContainer0\"\n          @mousewheel=\"scrollX($event, 0)\"\n        >\n          <div v-for=\"graph in territoryGraphs\" :key=\"graph.id\">\n            <GraphTerritories\n              :id=\"graph.id\"\n              :label=\"graph.title\"\n              :textOpacity=\"graph.opacity\"\n              @biomarker-click=\"handleToggleMarker(0)\"\n            />\n          </div>\n        </div>\n        <div class=\"content\">\n          <div class=\"left\">\n            <TerritoriesSegments\n              :id=\"1\"\n              @segment-updated=\"handleSegmentUpdate\"\n            />\n          </div>\n          <div class=\"right\">\n            <transition name=\"fade\">\n              <div v-if=\"showComponent[0]\">\n                <SimpleGraph :dataToGraph=\"canGraph[0].allowed\" />\n              </div>\n            </transition>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"biomarkercomponent\">\n      <div class=\"screen1\" :style=\"{ height: itemHeight + 'px' }\">\n        <ScreenTemp />\n      </div>\n      <div class=\"graphs\">\n        <h2>ANALYSIS</h2>\n        <div\n          class=\"territoryGraphs\"\n          ref=\"scrollContainer1\"\n          @mousewheel=\"scrollX($event, 1)\"\n        >\n          <div v-for=\"graph in territoryGraphs\" :key=\"graph.id\">\n            <GraphTerritories\n              :id=\"graph.id\"\n              :label=\"graph.title\"\n              :textOpacity=\"graph.opacity\"\n              @biomarker-click=\"handleToggleMarker(1)\"\n            />\n          </div>\n        </div>\n        <div class=\"content\">\n          <div class=\"left\">\n            <TerritoriesSegments\n              :id=\"2\"\n              @segment-updated=\"handleSegmentUpdate\"\n            />\n          </div>\n          <div class=\"right\">\n            <transition name=\"fade\">\n              <div v-if=\"showComponent[1]\">\n                <SimpleGraph :dataToGraph=\"canGraph[1].allowed\" />\n              </div>\n            </transition>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"biomarkercomponent\">\n      <div class=\"screen1\" :style=\"{ height: itemHeight + 'px' }\">\n        <ScreenTemp />\n      </div>\n      <div class=\"graphs\">\n        <h2>ANALYSIS</h2>\n        <div\n          class=\"territoryGraphs\"\n          ref=\"scrollContainer2\"\n          @mousewheel=\"scrollX($event, 2)\"\n        >\n          <div v-for=\"graph in territoryGraphs\" :key=\"graph.id\">\n            <GraphTerritories\n              :label=\"graph.title\"\n              :textOpacity=\"graph.opacity\"\n              @biomarker-click=\"handleToggleMarker(2)\"\n            />\n          </div>\n        </div>\n        <div class=\"content\">\n          <div class=\"left\">\n            <TerritoriesSegments\n              :id=\"3\"\n              @segment-updated=\"handleSegmentUpdate\"\n            />\n          </div>\n          <div class=\"right\">\n            <transition name=\"fade\">\n              <div v-if=\"showComponent[2]\">\n                <SimpleGraph :dataToGraph=\"canGraph[2].allowed\" />\n              </div>\n            </transition>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport SimpleGraph from '../components/SimpleGraph.vue';\n// import ScreenTemp from '../components/ScreenTemp.vue';\nimport TerritoriesSegments from '../components/TerritoriesSegments.vue';\nimport GraphTerritories from '../components/GraphTerritories.vue';\n\nexport default {\n  components: {\n    SimpleGraph,\n    TerritoriesSegments,\n    GraphTerritories,\n  },\n  data() {\n    return {\n      canGraph: [\n        { id: 1, allowed: [1, 1, 1] },\n        { id: 2, allowed: [1, 1, 1] },\n        { id: 3, allowed: [1, 1, 1] },\n      ],\n      itemHeight: 510,\n      showComponent: [1, 1, 1],\n\n      territoryGraphs: [\n        { id: 1, title: 'Territory Min', opacity: 0.3 },\n        {\n          id: 2,\n          title: 'Territory Absolute Velocity',\n          opacity: 0.3,\n        },\n        { id: 3, title: 'Territory Median', opacity: 0.3 },\n        { id: 4, title: 'Sector Median', opacity: 0.3 },\n        { id: 5, title: 'Sector Max', opacity: 0.3 },\n        { id: 6, title: 'Sector Min', opacity: 0.3 },\n      ],\n    };\n  },\n  methods: {\n    handleSegmentUpdate(itemID, newAllowed) {\n      for (let i = 0; i < 3; i++) {\n        this.canGraph[itemID - 1].allowed[i] = newAllowed[i] > 0.5;\n      }\n    },\n    // scrollLeft() {\n    //   this.$refs.scrollContainer.scrollLeft -= 20;\n    // },\n    // scrollRight() {\n    //   this.$refs.scrollContainer.scrollLeft += 20;\n    // },\n    scrollX(e, id) {\n      const containter = `scrollContainer${id}`;\n      this.$refs[containter].scrollLeft += e.deltaY / 10;\n    },\n    handleToggleMarker(itemID) {\n      //   for (let i = 0; i < this.territoryGraphs.length; i++) {\n      //     if (this.territoryGraphs[i].title == itemID) {\n      //       this.territoryGraphs[i].opacity = 0.6;\n      //       console.log(`OPACITY CHANGED ${itemID}`);\n      //     } else {\n      //       this.territoryGraphs[i].opacity = 0.3;\n      //     }\n      //   }\n      console.log(itemID);\n      this.showComponent[itemID] = false;\n      this.showComponent[itemID] = true;\n    },\n  },\n  // Other component code\n};\n</script>\n\n<style scoped>\ni {\n  cursor: pointer;\n}\n.headertitle {\n  display: flex;\n  gap: 10px;\n}\n\nh2 {\n  font-size: 18px;\n}\n\nh4 {\n  font-size: 14px;\n}\n\n.content {\n  display: grid;\n  align-items: center;\n  grid-template-columns: 25% 75%;\n  overflow: hidden;\n  grid-row: 3;\n  margin-top: 20px;\n}\n\n.valuesheader {\n  margin-top: 30px;\n}\n.territoryGraphs {\n  display: flex;\n  gap: 20px;\n  margin-top: 10px;\n  overflow-x: hidden;\n  overflow-y: hidden;\n  scrollbar-width: none; /* Hide the scrollbar in modern browsers */\n  -ms-overflow-style: none; /*\n  /* border: 1px solid white; */\n  white-space: nowrap;\n}\n.right {\n  grid-column: 2;\n  overflow: hidden;\n}\n\n.left {\n  grid-column: 1;\n  overflow: hidden;\n}\n\n.biomarkerviewer {\n  height: 100%;\n  display: grid;\n  grid-template-columns: 33% 33% 33%;\n  gap: 10px;\n  padding: 1px;\n}\n\n.biomarkercomponent {\n  display: grid;\n  grid-template-rows: 60% 40%;\n  background: #00000050;\n}\n\n.screens {\n  padding: 2px;\n  /* border: 2px solid rgb(217, 255, 0); */\n  grid-row: 1;\n  display: grid;\n  grid-template-columns: 49.5% 49.5%;\n\n  gap: 1%;\n}\n\n.screen1 {\n  /* border: 1px solid rgb(136, 8, 8); */\n  padding: 0px;\n  border-radius: 15px;\n  /* width: 907px; */\n  text-align: center;\n  justify-items: center;\n  overflow: hidden;\n  border: 1px solid #00ddff;\n}\n\n.graphs {\n  grid-row: 2;\n  padding: 20px;\n  /* border: 1px solid rgb(136, 8, 8); */\n  display: grid;\n  grid-template-rows: 7.5% 10% 85%;\n}\n\n.fade-enter-active {\n  transition: all 0.5s ease;\n}\n\n.fade-enter-from {\n  opacity: 0;\n  transform: translateX(-20%);\n}\n\n.fade-enter-to {\n  opacity: 1;\n  transform: translateX(0);\n}\n</style>\n","<!-- \n    MAIN DYNAMIC DASHBOARD FOR CONDUCTING QUALITY CHECK, ANALYSIS AND GENERATING REPORT. \n    COMPONENT PART OF © AREA 19, OCG WEB APP.\n    DEVELOPPED IN MONTREAL, QC, CANADA.\n    JULY 2023.\n  -->\n\n<template>\n  <!-- Adding a overlay for smaller screen sizes as wb app is not fully responsive. -->\n  <div class=\"mobile-overlay\">\n    <div class=\"warning\">\n      <h2>\n        It appears that you are trying to use our app on a screen size of less\n        than 1200 px wide. <br />\n        Currently our app is limited to larger devices. Please try on a larger\n        laptop.\n      </h2>\n    </div>\n  </div>\n  <!-- Main container -->\n  <div :class=\"container\">\n    <!-- Body container -->\n    <div class=\"body\">\n      <!-- Navigation Bar section -->\n      <div class=\"navigationBar\">\n        <!-- AnalysisNavigationBar component to handle view selection (patient list, quality check, analysis, report) -->\n        <AnalysisNavigationBar @tool-selected=\"handleToolSelected\" />\n      </div>\n      <div class=\"header-main\">\n        <!-- Header section -->\n        <div class=\"header\">\n          <!-- PatientHeaderInfo component to display patient information and update quality check view -->\n          <PatientHeaderInfo\n            :activeComponent=\"currentComponent\"\n            @updatequalitycheck=\"handleUpdateQualityCheck\"\n          />\n        </div>\n\n        <!-- Main section -->\n        <div class=\"main\">\n          <!-- Use fade transition when switching components -->\n          <transition name=\"fade\">\n            <!-- Dynamic component based on currentComponent -->\n            <component :is=\"currentComponent\" ref=\"mainAnalysisComponent\" />\n          </transition>\n        </div>\n\n        <!-- Version information -->\n        <h5 style=\"margin-left: auto; color: grey\">\n          Area 19 OCG Prototype V.0.1\n        </h5>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport PatientHeaderInfo from '../components/PatientHeaderInfo.vue';\nimport AnalysisNavigationBar from '../components/AnalysisNavigationBar.vue';\nimport VtkTwoView from '../components/VtkTwoView.vue';\nimport QualityCheck from './QualityCheck.vue';\nimport ReportMaker from './ReportMaker.vue';\nimport GraphicalAnalysis from './GraphicalAnalysis.vue';\n\nexport default {\n  components: {\n    // Registered Vue components used in this script\n    PatientHeaderInfo,\n    AnalysisNavigationBar,\n    VtkTwoView,\n    QualityCheck,\n    ReportMaker,\n    GraphicalAnalysis,\n  },\n  data() {\n    return {\n      // Data properties\n      container: 'container',\n      currentComponent: 'QualityCheck',\n    };\n  },\n  methods: {\n    // Method to get the time of day based on the current hour\n    getTimeOfDay() {\n      const currentHour = new Date().getHours();\n\n      if (currentHour >= 5 && currentHour < 12) {\n        return 'Morning';\n      }\n      if (currentHour >= 12 && currentHour < 18) {\n        return 'Afternoon';\n      }\n      if (currentHour >= 18 && currentHour < 23) {\n        return 'Evening';\n      }\n      return 'Day';\n    },\n    // Method to handle tool selection from the AnalysisnavigationBar component\n    handleToolSelected(tool) {\n      if (tool === 'ReportMaker') {\n        this.currentComponent = 'ReportMaker';\n      } else if (tool === 'QualityCheck') {\n        this.currentComponent = 'QualityCheck';\n      } else if (tool === 'GraphicalAnalysis') {\n        this.currentComponent = 'GraphicalAnalysis';\n      }\n      // Save the current view in local storage for persistence\n      window.localStorage.setItem('currentView', this.currentComponent);\n      // Handle the selected tool, update the displayed content accordingly\n    },\n    // Method to handle the update of QualityCheck component based on checkContours value\n    handleUpdateQualityCheck(checkContours) {\n      if (checkContours) {\n        this.$refs.mainAnalysisComponent.toggleComponent('CheckContours');\n      } else {\n        this.$refs.mainAnalysisComponent.toggleComponent(\n          'CheckBreathingSplits'\n        );\n      }\n    },\n  },\n  created() {\n    // Set the time of day and update the container class accordingly\n    this.timeofday = this.getTimeOfDay();\n    this.container = `${this.container} ${this.timeofday.toLowerCase()}`;\n  },\n  mounted() {\n    // Retrieve the last selected view from local storage. Used when user reloads.\n    this.currentComponent = window.localStorage.getItem('currentView');\n  },\n};\n</script>\n\n<style scoped>\n/* Styles for small screen warning */\n.mobile-overlay {\n  position: absolute;\n  z-index: 9999;\n  height: 100vh;\n  width: 100vw;\n  background: rgba(170, 170, 170, 0.534);\n  display: none;\n  align-items: center;\n  justify-content: center;\n  padding: 1rem;\n  background: rgba(255, 255, 255, 0.096);\n  backdrop-filter: brightness(40%) blur(30px);\n  -webkit-backdrop-filter: brightness(40%) blur(30px);\n  user-select: none;\n}\n.warning {\n  max-width: 40rem;\n  min-height: 12rem;\n  background: rgba(97, 97, 97, 0.514);\n  padding: 0.8rem;\n  border-radius: 10px;\n  text-align: center;\n  display: flex;\n  align-items: center;\n  background: rgba(255, 255, 255, 0.096);\n  backdrop-filter: brightness(20%) blur(30px);\n  -webkit-backdrop-filter: brightness(20%) blur(30px);\n}\n\n/* Styles for the container */\n.container {\n  background-repeat: space;\n  background-size: cover;\n  padding: none;\n}\n\n/* Styles for the afternoon background */\n.afternoon {\n  background-image: url('/images/afternoon.jpg');\n}\n\n/* Styles for the morning background */\n.morning {\n  background-image: url('/images/morning.jpg');\n}\n\n/* Styles for the evening background */\n.evening {\n  background-image: url('/images/night.jpg');\n}\n\n/* Styles for the day background */\n.day {\n  background-image: url('/images/day.jpg');\n}\n\n/* Styles for the body */\n.body {\n  display: flex;\n  height: 100vh;\n  width: 100vw;\n  background: rgba(0, 0, 0, 0.2);\n  backdrop-filter: brightness(40%) blur(30px);\n  -webkit-backdrop-filter: brightness(40%) blur(30px);\n}\n\n/* Styles for the header */\n.header {\n  max-height: 72px;\n}\n\n/* Styles for the main content */\n.main {\n  overflow: hidden;\n  width: 95vw;\n}\n\n/* Styles for the navigationBar */\n.navigationBar {\n  padding-left: 10px;\n  padding-right: 7px;\n}\n\n/* Styles for the fade-in animation */\n.fade-enter-from {\n  opacity: 0;\n  transform: scale(0.97);\n}\n.fade-enter-to {\n  opacity: 1;\n}\n\n.fade-enter-active {\n  transition: all 0.5s ease;\n}\n\n/* Media query for small laptops */\n@media (max-width: 1180px) {\n  .mobile-overlay {\n    display: flex;\n  }\n}\n</style>\n","import { createRouter, createWebHistory } from 'vue-router';\n\n// import Main from '../views/Main.vue';\nimport Login from '../views/UserLogin.vue';\nimport Home from '../views/HomeMain.vue';\nimport Analysis from '../views/MainAnalysis.vue';\n\nconst routes = [\n  {\n    path: '/',\n    redirect: '/login', // Redirect the root URL to the login page\n  },\n\n  {\n    path: '/login',\n    name: 'Login',\n    component: Login,\n  },\n  // {\n  //   path: '/main',\n  //   name: 'Main',\n  //   component: Main,\n  // },\n  {\n    path: '/home',\n    name: 'Home',\n    component: Home,\n  },\n  {\n    path: '/analysis',\n    name: 'Analysis',\n    component: Analysis,\n  },\n];\n\nconst router = createRouter({\n  history: createWebHistory(),\n  routes,\n});\n\nexport default router;\n","import 'vue-toastification/dist/index.css';\nimport 'vuetify/lib/styles/main.css';\nimport '@/src/global.css';\n\nimport '@kitware/vtk.js/Rendering/OpenGL/Profiles/Geometry';\nimport '@kitware/vtk.js/Rendering/OpenGL/Profiles/Volume';\nimport '@kitware/vtk.js/Rendering/OpenGL/Profiles/Glyph';\n\nimport { createApp } from 'vue';\nimport VueToast from 'vue-toastification';\nimport { createPinia } from 'pinia';\nimport vtkProxyManager from '@kitware/vtk.js/Proxy/Core/ProxyManager';\nimport vtkMapper from '@kitware/vtk.js/Rendering/Core/Mapper';\nimport vtkImageMapper from '@kitware/vtk.js/Rendering/Core/ImageMapper';\nimport { VueResponsiveness } from 'vue-responsiveness';\n\nimport App from './components/App.vue';\nimport vuetify from './plugins/vuetify';\nimport { DICOMIO } from './io/dicom';\nimport { FILE_READERS } from './io';\nimport { registerAllReaders } from './io/readers';\nimport proxyConfiguration from './vtk/proxy';\nimport { CorePiniaProviderPlugin } from './core/provider';\nimport ProxyWrapper from './core/proxies';\nimport { patchExitPointerLock } from './utils/hacks';\nimport { init as initErrorReporting } from './utils/errorReporting';\n\nimport router from './router';\n\n// patches\npatchExitPointerLock();\n\n// Initialize global mapper topologies\n// polys and lines in the front\nvtkMapper.setResolveCoincidentTopologyToPolygonOffset();\nvtkMapper.setResolveCoincidentTopologyPolygonOffsetParameters(-3, -3);\nvtkMapper.setResolveCoincidentTopologyLineOffsetParameters(-3, -3);\n// image poly in the back\nvtkImageMapper.setResolveCoincidentTopologyToPolygonOffset();\nvtkImageMapper.setResolveCoincidentTopologyPolygonOffsetParameters(1, 1);\n\nregisterAllReaders(FILE_READERS);\n\nconst proxyManager = vtkProxyManager.newInstance({ proxyConfiguration });\n\nconst dicomIO = new DICOMIO();\ndicomIO.initialize();\n\nconst pinia = createPinia();\npinia.use(\n  CorePiniaProviderPlugin({\n    proxies: new ProxyWrapper(proxyManager),\n    dicomIO,\n  })\n);\n\nconst app = createApp(App);\n\ninitErrorReporting(app);\n\napp.provide('ProxyManager', proxyManager);\napp.use(pinia);\napp.use(VueToast);\napp.use(vuetify);\napp.use(VueResponsiveness, {\n  smallLaptop: 1200,\n  mediumLaptop: 1300,\n  largerLaptop: 1400,\n  xLargeLaptop: 1600,\n  desktop: 1900,\n  _4K: 2500,\n});\napp.use(router).mount('#app');\n"],"names":["_sfc_main$1b","defineComponent","_resolveComponent","dirname","path","p","basename","normalize","join","segments","sanitizeFileName","name","sanitizeFile","file","DICOMIO","module","args","inputs","outputs","runPipeline","resolve","reject","result","readDICOMTags","files","index","buffer","InterfaceTypes","fd","volumeToFileIndexes","volumeKey","fileIndexes","fileIndex","tags","tagsArgs","t","tagValues","info","tag","asThumbnail","fixed","moving","size","spacing","origin","direction","seriesFiles","readImageDICOMFileSeries","FILE_EXT_TO_MIME","FILE_EXTENSIONS","MIME_TYPES","ARCHIVE_FILE_TYPES","FILE_MAGIC_DB","c","HEAD_CHUNK","prefixEquals","target","prefix","i","getFileMimeFromMagic","head","reader","chunk","mime","header","skip","getFileMimeType","fileType","supportedExt","ext","mimeFromMagic","retypeFile","type","readFileAs","fio","readFileAsArrayBuffer","FILE_READERS","identity","arg","defer","innerResolve","innerReject","value","reason","res","rej","removeFromArray","arr","el","idx","clampValue","min","max","pick","obj","keys","o","k","partition","predicate","partitioned","val","partitionIndex","ensureDefault","key","records","default_","arrayEquals","a","b","roundIfCloseToInteger","eps","EPSILON","rounded","ensureError","standardizeColor","color","ctx","PromiseWorker","worker","message","transferables","wrappedMsg","deferred","ev","id","error","runAsyncVTKReader","readerName","data","vtk","runAsyncVTKWriter","writerName","dataSet","stlReader","vtiReader","vtpReader","vtiWriter","ITK_IMAGE_MIME_TYPES","extensionToImageIO","vtkITKImageReader","readImageArrayBuffer","itkReader","fileBuffer","registerAllReaders","readerMap","commonViewCustomizations","publicAPI","model","delayedRender","macro","dims","devicePixelRatio","width","height","blocking","timeout","rep","directionOfProjection","viewUp","focalPoint","position","vec3.clone","vec3.sub","setContainer","resetCamera","vtkLPSView3DProxy","extend","initialValues","vtkViewProxy","newInstance","vtkLPSView3DProxy$1","vtkLPSView2DProxy","superClass","boundsToUse","mode","count","lookAxis","viewUpAxis","w","h","bw","bh","viewAspect","boundsAspect","scale","DEFAULT_VALUES","vtkView2DProxy","vtkLPSView2DProxy$1","SLICE_MODE_MAP","vtkIJKSliceRepresentationProxy","modeString","vtkSliceRepresentationProxy","vtkIJKSliceRepresentationProxy$1","InterpolationType","ImagePropertyConstants","vtkLabelMapSliceRepProxy","labelMapSub","cachedColorMap","updateTransferFunctions","labelmap","colorMap","cfun","vtkColorTransferFunction","ofun","vtkPiecewiseFunction","label","l","setInputData","vtkLabelMapSliceRepProxy$1","createProxyDefinition","classFactory","ui","links","definitionOptions","props","createDefaultView","options","proxyConfiguration","vtkLookupTableProxy","vtkPiecewiseFunctionProxy","vtkSourceProxy","vtkVolumeRepresentationProxy","vtkGeometryRepresentationProxy","generateContour","stencil","location","slicingIndex","indexToWorld","xdim","ydim","xoffset","yoffset","gridxdim","gridydim","vertices","lines","vertexMap","getOrCreateVertexIndex","x","y","indexCoords","worldCoords","vec3.transformMat4","getStampPixelAt","gy","gx","v0","v1","vtkPaintBrushContextRepresentation","vtkPolyData","vtkMapper2D","vtkCoordinate","Coordinate","vtkActor2D","actorProperty","DisplayLocation","Representation","vtkWidgetRepresentation","inData","outData","widgetState","brush","worldToIndex","contour","points","vtkContextRepresentation","vtkPaintBrushContextRepresentation$1","shouldIgnoreEvent","widgetBehavior","isPainting","eventData","generateState","vtkStateBuilder","vtkPaintWidget","vtkPlanePointManipulator","vtkAbstractWidgetFactory","stateGenerator","vtkPaintWidget$1","rasterizeEllipse","xdiam","ydiam","putPixel","blitLine","x0","x1","start","end","y0","y1","b1","dx","dy","err","e2","EllipsePaintBrush","scaledSize","PaintTool$1","sliceAxis","startPoint","endPoint","ijkSlice","labelmapPixels","labelmapDims","jStride","kStride","isInBounds","point","pixels","centerX","centerY","point1","point2","curPoint","ydelta","xdelta","pixelOffset","steps","incX","incY","offset","CorePiniaProviderPlugin","paint","proxies","dicomIO","dependencies","PaintTool","ViewProxyType","ProxyWrapper","proxyManager","deleteProxy","proxy","dataID","viewID","dataProxy","viewProxy","patchExitPointerLock","exitPointerLock","VITE_SENTRY_DSN","LOCAL_STORAGE_KEY","errorReportingConfigured","init","app","Sentry.init","Sentry.Replay","disable","Sentry.close","defineStore","disableReportingStorage","useLocalStorage","disableReporting","ref","watch","_sfc_main","currentHour","event","userCredentials","item","newUser","_hoisted_1","_withScopeId","_createElementVNode","_hoisted_2","_hoisted_3","_hoisted_5","_hoisted_6","_hoisted_9","_createElementBlock","$data","_normalizeClass","_toDisplayString","$options","_ctx","$event","_hoisted_8","_openBlock","$props","patient","_createBlock","_component_router_link","_cache","_hoisted_4","_sfc_render","filterString","PatientElement","LoadingScreen","_Fragment","_renderList","_createVNode","_component_PatientElement","_component_LoadingScreen","START_ID","useIdStore","LPSAxes","createLPSPoint","createLPSBounds","getAxisBounds","bounds","axis","directions","getLPSAxisFromDir","dir","defaultLPSDirections","vec3.fromValues","getLPSDirections","availableCols","availableRows","lpsDirs","bestValue","bestValueLoc","removeIndices","col","colIdx","row","rowIdx","axisVector","vecSign","posVector","negVector","Tools","LayoutDirection","DatasetType","DatasetTypeNative","z","LPSAxisDir","Dataset","baseRemoteFileSchema","RemoteFile","LayoutDirectionNative","Layout","Vector3","WindowLevelConfig","SliceConfig","CameraConfig","ColorBy","PiecewiseGaussian","PiecewiseNode","OpacityGaussians","OpacityPoints","OpacityNodes","OpacityFunction","ColorTransferFunction","CVRConfig","VolumeColorConfig","BlendConfig","LayersConfig","ViewConfig","ViewType","View","LabelMap","FrameOfReference","AnnotationTool","makeToolEntry","tool","Ruler","Rulers","Rectangle","Rectangles","Crosshairs","ToolsEnumNative","ToolsEnum","Paint","LPSCroppingPlanes","Cropping","ParentToLayers","ManifestSchema","fileToDataSource","isRemoteDataSource","ds","getDataSourceName","_a","sources","first","more","serializeDataSource","output","useFileStore","state","serializeData","stateFile","dataIDs","dataType","fileStore","zip","datasets","remoteFiles","remotes","toZip","dataPath","filePath","defaultImageMetadata","mat3.create","vec3.create","mat4.create","useImageStore","imageData","metadata","ANONYMOUS_PATIENT","ANONYMOUS_PATIENT_ID","imageCacheMultiKey","readDicomTags","useDICOMStore","allFiles","volumeToFiles","volumeDatasetFiles","source","study","volumeInfo","volume","patientKey","studyKey","imageStore","imageID","volumeKeys","sliceIndex","cacheKey","numSlices","volumeFiles","sliceFile","itkImage","NumberOfSlices","middleSlice","forceRebuild","image","vtkITKHelper","existingImageID","useModelStore","polyData","MessageType","MessageType2","useMessageStore","msg","title","opts","details","useErrorMessage","task","makeDICOMSelection","makeImageSelection","getImageID","selection","_exhaustiveCheck","getImage","images","dicoms","getDataID","findImageID","selectionEquals","s1","s2","useDatasetStore","modelStore","dicomStore","primarySelection","primaryImageID","computed","primaryDataset","dataIndex","allDataIDs","getDataProxyByID","setPrimarySelection","sel","serialize","manifest","after","createPipelineError","input","cause","DoneSentinel","Pipeline","handlers","extraContext","nestedExecutions","execution","terminate","invokeHandler","doneInvoked","pipelineResult","endOfPipeline","context","out","innerExtra","promise","handler","thrown","ret","innerResults","succeededInner","failedInner","okResult","failedResult","errors","handleDicomFile","dataSource","extra","done","fileSrc","HTTPHandler","url","protocol","URL","progress","response","contentLength","bytes","recv","readData","HANDLERS","canFetchUrl","fetchFile","cache","blob","fetchJSON","decoder","downloadUrl","execute","uriSrc","extractFilesFromZip","zipFile","JSZip","promises","paths","relPath","fileName","fileEntry","isArchive","extractArchive","entry","extractArchiveContents","archiveFile","contentsPromise","mapping","fullPath","path.join","extractArchiveTarget","archiveSrc","parent","archiveCache","archiveContents","targetName","path.normalize","targetFile","isAmazonS3Uri","uri","getObjectPublicUrl","bucket","fetchObjectsWithPagination","onObjectAvailable","client","S3Client","request","paginate","continuationToken","listObjectsCmd","ListObjectsV2Command","extractBucketAndPrefixFromS3Uri","pathname","objectName","getObjectsFromS3","s3Uri","objPrefix","handleAmazonS3","isGoogleCloudStorageUri","extractBucketAndPrefixFromGsUri","getObjectEndpoint","objects","nextToken","page","getObjectsFromGsUri","gsUri","bucketName","handleGoogleCloudStorage","object","importSingleFile","dataObject","RemoteResource","RemoteDataManifest","readRemoteManifestFile","manifestFile","ab","text","handleRemoteManifest","remote","vtkLabelMap","vtkImageData","vtkLabelMap$1","InitViewIDs","InitViewSpecs","DefaultViewSpec","Layouts","layouts","layout","LABELMAP_PALETTE","TOOL_COLORS","RULER_LABEL_DEFAULTS","RECTANGLE_LABEL_DEFAULTS","DECREMENT_LABEL_KEY","INCREMENT_LABEL_KEY","DEFAULT_PRESET_BY_MODALITY","LabelmapArrayType","createLabelmapFromImage","vtkDataArray","toLabelMap","useLabelmapStore","labelMaps","labelMap","labelPath","serializedData","stateFiles","dataIDMap","labelmapIDMap","labelMapObj","runWasm","pipeline","numberOfWorkers","aImage","splits","splitsArg","tasks","split","taskArgs","num","imageSharedBufferOrCopy","workerPool","WorkerPool","results","imageSplits","r","pipelineOutput","stackImages","compareProps","compareImageSpaces","imageA","imageB","resample","assertNeverDataSelection","getID","toDataSelectionKey","toDataSelectionFromKey","useLayersStore","parentToLayers","layerImages","_addLayer","parentKey","parentImage","sourceImage","vtkBoundingBox","addLayer","deleteLayer","layers","layerToDelete","layer","getLayers","dataKey","getLayer","layerID","deleteSelection","deleteKey","layerStore","selectionKey","deserialize","remapSelection","parentToLayersSerialized","sourceSelectionKeys","sourceKey","getImageSpatialExtent","lpsOrientation","extent","useCurrentImage","dataStore","layersStore","currentImageID","volumeToImageID","currentImageMetadata","currentImageData","currentImageExtent","isImageLoading","currentLayers","clampRangeToBounds","range","convertCropBoundsToVTKPlane","cropBounds","lowerUpper","orientation","axisIndex","neg","normal","vtkPlane","useCropStore","reactive","getComputedVTKPlanes","unref","clampCroppingPlanes","planes","lpsBounds","setCropping","setCroppingForAxis","resetCropping","tools","cropping","newImageID","readonly","clampPointToBounds","isDragging","ignoreKey","e","callData","worldCoordsOfPointer","handle","indexCoordsOfPointer","worldOrigin","indexOrigin","vtkCrosshairsWidget","viewType","ViewTypes","center","vtkCrosshairsWidget$1","patchDoubleKeyRecord","record","k1","k2","patch","deleteSecondKey","getDoubleKeyRecord","serializeViewConfigV2","viewConfigs","viewConfigStateKey","dataset","views","view","config","viewConfig","configForData","createViewConfigSerializer","defaultSliceConfig","useViewSliceStore","configs","getConfig","updateConfig","resetSlice","removeView","removeData","defaultWindowLevelConfig","useWindowingStore","syncAcrossViews","setSyncAcrossViews","yn","syncWindowLevel","srcViewID","srcDataID","resetWindowLevel","level","computeWorldToDisplay","xyz","renderer","_b","normalizeMouseEventPosition","canvas","scaleX","scaleY","intersectMouseEventWithPlane","intersectDisplayWithPlane","worldToSVG","coords","getCSSCoordinatesFromEvent","pokedRenderer","bbox","_c","getShiftedOpacityFromPreset","presetName","effectiveRange","shift","preset","vtkColorMaps","xmin","xmax","getOpacityFunctionFromPreset","getColorFunctionRangeFromPreset","AbsoluteRange","RGBPoints","registerPresets","presets","MedicalPresets","GroupedPresets","DEFAULT_PRESET","group","MODALITY_TO_PRESET","getPreset","Modality","defaultLayersConfig","useLayerColoringStore","createUpdateFunc","transform","update","updatedConfig","updateColorBy","updateColorTransferFunction","updateOpacityFunction","updateBlendConfig","setColorPreset","imageDataRange","ctRange","opFunc","resetToDefault","scalars","useViewCameraStore","DEFAULT_AMBIENT","DEFAULT_DIFFUSE","DEFAULT_SPECULAR","getPresetFromImageModality","volKey","defaultVolumeColorConfig","useVolumeColoringStore","updateCVRParameters","resetToDefaultColoring","useViewConfigStore","viewSliceStore","windowingStore","layerColoringStore","viewCameraStore","volumeColoringStore","newDataID","useViewStore","layoutsToProcess","viewConfigStore","spec","viewSpec","useCrosshairsToolStore","factory","active","imagePosition","viewStore","currentViewIDs","getWidgetFactory","setPosition","pos","indexPos","sliceConfig","slice","xDim","yDim","zDim","imageBounds","inflate","activateTool","deactivateTool","crosshairs","DEFAULT_BRUSH_SIZE","DEFAULT_BRUSH_VALUE","usePaintToolStore","activeLabelmapID","brushSize","brushValue","strokePoints","labelmapOpacity","isActive","activeLabelmap","selectOrCreateLabelmap","labelmapStore","found","parentID","setBrushSize","setBrushValue","setLabelmapOpacity","opacity","doPaintStroke","lastIndex","lastPoint","prevPoint","setSliceAxis","startStroke","indexPoint","placeStrokePoint","endStroke","tmp","frameOfReferenceToImageSliceAndAxis","frame","epsilon","allowNonIntegralSlice","allowOutOfBoundsSlice","planeNormal","planeOrigin","dimensions","Left","Right","Posterior","Anterior","Superior","Inferior","vec3.equals","labelDefault","useLabels","newLabelDefault","labels","activeLabel","setActiveLabel","addLabel","deleteLabel","labelIDs","updateLabel","defaultLabels","clearDefaultLabels","mergeLabel","clearDefault","labelName","sameLabelName","existingName","existingID","newLabels","makeAnnotationToolDefaults","useAnnotationTool","toolDefaults","initialLabels","toolIDs","toolByID","byID","makePropsFromLabel","labelProps","addTool","removeTool","updateTool","propsFromLabel","jumpToTool","toolID","toolImageFrame","relevantViewIDs","viewDir","rest","serialized","labelIDMap","newID","rulerDefaults","useRulerStore","rulerIDs","rulerByID","rulers","addRuler","updateRuler","removeRuler","jumpToRuler","serializeTool","deserializeTool","lengthByID","lengths","firstPoint","secondPoint","distance2BetweenPoints","rectangleDefaults","useRectangleStore","toolStoreProps","createReferencePlane","tmp3d","tmpMat3","transform2dTo3d","pt2d","refPlane","_out","vec3.set","invertMat4","m","minv","mat4.invert","getInverse","transform3dTo2d","pt3d","vec2.create","inv","vec2.set","referencePlaneToFrame","mat3.fromMat4","vec3.transformMat3","vec3.normalize","SliceAxisTransforms","mat4.fromValues","getReferencePlaneFromSlice","mat4.fromTranslation","mat4.mul","ContourToolMode","makeContourDefaults","useContourStore","selectedContourID","selectContour","setMode","toolMode","getStore","setupTool","store","teardownTool","useToolStore","rulerStore","rectangleStore","crosshairsStore","paintStore","cropStore","MANIFEST","isStateFile","typedFile","doneWithDataSource","updateFileMimeType","src","resolveUriSource","processParentIfNoFile","resolveArchiveMember","getDataSourcesForDataset","stateFileContents","inStateFile","restoreDatasets","datasetFiles","stateDatasetFiles","datasetFile","stateIDToStoreID","resolvePipeline","datasetDataSources","dicomSources","importResults","restoreStateFile","manifests","restOfStateFile","dataFile","selectedID","dataSelection","Color","Label","RulerLabel","RectangleLabel","Config","readConfigFile","configFile","applyConfig","labelsIfUndefined","toolLabels","handleConfig","convertSuccessResultToDataSelection","toMeaningfulErrorString","strThrown","unhandledResource","importDataSources","dataSources","middleware","extractArchiveTargetFromCache","importContext","dicomDataSource","dicomResult","classSpec","_component_v_btn","_mergeProps","_component_v_icon","_component_v_tooltip","_renderSlot","ItemGroupProvider","_sfc_main$14","emit","slots","modelValue","mandatory","equalsTest","toRefs","internalValue","v","onMounted","provide","_sfc_main$13","itemGroup","inject","select","toggle","rgbaToHexa","rgba","comp","hexaToRGBA","hexa","values","length","convertToSwatches","palette","hexToValue","swatches","entries","hex","_sfc_main$12","brushColor","setBrushColor","op","_component_v_card","_withCtx","_component_v_container","_component_v_row","_component_v_col","_component_v_slider","_component_v_text_field","_component_v_color_picker","_sfc_main$11","ToolButton","display","useDisplay","showLeft","menuOn","enableMenu","on","_component_v_menu","_component_tool_button","_sfc_main$10","colorLocal","activeLabelIndex","editingLabel","createLabel","editDialog","watchEffect","mobile","activeToolStore","contourStore","storeToRefs","_sfc_main$W","MenuToolButton","ItemGroup","GroupableItem","PaintControls","CropControls","RulerControls","RectangleControls","ContourControls","toolStore","noCurrentImage","currentTool","paintMenu","cropMenu","onKeyDown","_component_item_group","_component_groupable_item","_component_menu_tool_button","manageVTKSubscription","subscription","onUnmounted","useResizeToFit","camera","initialValue","resizeToFit","trackResizeToFit","cachedCameraInfo","parallelScale","ignoreResizeToFitTracking","cb","resetResizeToFitTracking","getYOffsetFromTransform","matStr","handleStyles","newSlice","frac","_normalizeStyle","useResizeObserver","targetElRef","callback","observer","targetEl","prevTarget","onBeforeUnmount","useVTKCallback","listener","cleanup","isRef","toOrderedLabels","vec","useOrientationLabels","top","left","bottom","right","updateAxes","vup","vdir","vright","vec3.cross","vbottom","vleft","useCameraOrientation","viewDirection","imageMetadataRef","orientationMatrix","lpsDirections","cameraDirVec","cameraUpVec","computeStep","WindowLevelToolComponent","windowConfigDefaults","wlConfig","wwRange","wlRange","vertVal","horizVal","rangeManipulator","vtkMouseRangeManipulator","curViewProxy","oldViewProxy","updateManipulator","vertRange","horizRange","WindowLevelTool","_sfc_main$T","sliceConfigDefault","sliceRange","scrollVal","_sfc_main$S","intStyle","manipulators","updateStyle","style","newManipulators","oldManipulators","newOptions","opt","curIntStyle","oldIntStyle","PanTool","toolOptions","MouseManipulatorTool","vtkMouseCameraTrackballPanManipulator","ZoomTool","vtkMouseCameraTrackballZoomToMouseManipulator","InteractionState","draggingState","coord","originalSetInteractionState","changed","activeWidget","intState","PIXEL_SIZE","watchStore","getter","cmp","cached","unsubscribe","originalDelete","_createPointState","visible","vtkWidgetState","visibleMixin","scale1Mixin","getRuler","createPointState","PointsLabel","watchState","vtkRulerWidgetState","defaultValues","_createRulerWidgetState","createRulerWidgetState","vtkRulerWidget","vtkSphereHandleRepresentation","second","vtkRulerWidget$1","updatePlaneManipulatorFor2DView","manipulator","imageMetadata","_sfc_main$R","textOffset","updatePoints","viewRenderer","pt1","pt2","point2D","textProperties","containerEl","ToolContainer","$setup","_createCommentVNode","_sfc_main$Q","RulerSVG2D","rulerId","widgetManager","currentSlice","isPlacing","ruler","widgetFactory","widget","placing","widget_","isPlaced","rightClickSub","vtkPlaneManipulator","usePointVisibility","pointState","updateVisibility","watchOnce","firstPointVisible","secondPointVisible","_withDirectives","_component_RulerSVG2D","_sfc_main$P","RulerWidget2D","isToolActive","viewAxis","placingRulerID","prevId","placingTool","onRulerPlaced","getCurrentFrameOfReference","lpsIdx","rulerID","contextMenu","openContextMenu","displayXY","deleteRulerFromContextMenu","doesRulerFrameMatchViewAxis","rulerAxis","curImageID","_component_RulerWidget2D","_component_v_list","_component_v_list_item","_component_v_list_item_title","vtkRectangleWidget","vtkRectangleWidget$1","_sfc_main$O","rectangle","firstX","firstY","secondX","secondY","_d","useStore","vtkWidgetFactory","SVG2DComponent","RectangleSVG2D","_sfc_main$N","stringToolId","toolId","_component_SVG2DComponent","useActiveToolStore","_sfc_main$M","RectangleWidget2D","placingToolID","onToolPlaced","deleteToolFromContextMenu","doesToolFrameMatchViewAxis","toolAxis","_component_RectangleWidget2D","PICKING_LINE_WIDTH","DEFAULT_LINE_WIDTH","SELECTED_LINE_WIDTH","vtkContourRepresentation","vtkMapper","vtkActor","allocatePolyDataArrays","polyLine","numPoints","finalized","closedAddition","ptOffset","cellOffset","updateActorVisibility","renderingType","RenderingTypes","ctxVisible","handleVisible","newDefault","vtkContourRepresentation$1","Mode","getEventWorldPosition","interpolateCurve","degree","interPointSpacing","closed","clamped","numOriginalPoints","closedCurve","prevPt","arcLength","pt","vec2.dist","vec2.copy","knots","npts","remapT","dt","ipt","bspline","freehandBehavior","original","isActiveMode","resetModeInteraction","newCurve","DeselectIgnoreModes","selectBehavior","moveOrigin","origPolyLine","delta","translateContour","to","vec2.sub","addModuloN","calcMidpoint","v2","nudgePoints","nudgeCircle","radius","nudgeRadius2","nudgeVec","dist2","vec3.sqrDist","vec3.scale","vec3.add","adjustPoints","minPointSpacing","maxPointSpacing","minSpacing2","maxSpacing2","curVec","nextVec","midpoint","intermediate","curIdx","crossed","stop","newIdx","nextIdx","vec2.sqrDist","tdelta","newPoints","vec2.lerp","nudgeContour","referencePlane","closestPointAlongContour","closestIndex","bestDist2","d2","RADIUS_GAP_PERCENT","nudgeBehavior","doNudge","closestPtIndex","distance","vec3.dist","up","horiz","circleContextState","pointPlacingBehavior","updateLastPoint","last","dropLastPoint","point2d","vtkErrorMacro","vtkImageMarchingSquares","cValues","ids","pixelScalars","pixelPts","edgeLocator","vtkEdgeLocator","j","s","iInBounds","jInBounds","i1InBounds","j1InBounds","cVal","CASE_MASK","pId","pixelLines","vtkCaseTable","eid","edgeVerts","x0Offset","x00","x01","x1Offset","x10","x11","pBuffer","lBuffer","cv","polydata","vtkImageMarchingSquares$1","FILLED","VISITED","EMPTY","getSliceDimensions","baseDimensions","sliceDims","createBinaryMask","baseImage","iDim","jDim","dataArray","ijToIjk","ij","ijk","ijkToIj","directDistance2D","createImagePixelAccessor","kDim","ijSkip","iSkip","thresholdSlice","maskImage","seedPoint","thresholdRadius","maxDistance","distanceFunction","basePixels","maskPixels","seedPointIj","seedValue","minValue","maxValue","queue","pixel","di","dj","maskToBoundaryLines","mask","msquares","vtkContourLoopExtractionCtor","visited","pd","startLineId","startPtId","loopPoints","lineId","lastPtId","terminated","numInserted","cellPointIds","lineCell","inPoints","hullInputPoints","convexHullPoints","hull","outPoints","outLines","outIdx","loops","inLines","li","endPtId","largestIndex","longestLoop","loop","vtkContourLoopExtraction","cloneArray","vtkTransformPolyDataToPlaneCtor","inPd","vtkTransformPolyDataToPlane","MERGE_CONTOURS_KEY","CONVEX_HULL_CONTOURS_KEY","THRESHOLD_LINE_WIDTH","createActorPipeline","actor","mapper","property","thresholdBehavior","resetVisualizingContour","addVisualizingContour","removeVisualizingContour","commitCurrentContours","drawingContour","loops2d","loopCells","maxCellLoc","loc","curImageData","curSliceAxis","curSlice","startPointWorld","startPointIjk","startPointIj","renderCurrentContours","needsRender","roundVector","ijCoord","threshRadius","ijkDims","ijDims","diag","rangeWidth","adjustedThreshold","createCircleContextState","scale3","newCircleContextStateInstance","vtkContourWidgetState","getContour","toRaw","pl","createContourState","vtkContourWidget","vtkCircleContextRepresentation","vtkContourWidget$1","ModeMap","_sfc_main$L","viewId","contourId","drawing","isSelected","widgetMode","selected","viewAxisIndex","AutoAddDrawingContourModes","fequals","_sfc_main$K","ContourWidget2D","drawingContourID","isContourInCurrentView","frameOfReference","axisAndSlice","checkImageID","checkSlice","contours","commitDrawingContour","addDrawingContour","clearDrawingContour","contourID","onContourFinalized","getCurrentReferencePlane","onContourSelected","onContextMenu","deleteFromContextMenu","contextMenuLabels","labelID","setLabelFromContextMenu","_component_ContourWidget2D","_withModifiers","_component_v_radio","_sfc_main$J","widgetManagerRef","viewProxyRef","widgetRef","worldPointToIndex","worldPoint","subs","_sfc_main$I","PaintWidget2D","_component_PaintWidget2D","useSceneBuilder","sceneIDs","baseImageRep","labelmapReps","layerReps","modelReps","allRepresentations","reps","oldReps","usePersistCameraConfig","toPersist","persistCameraConfig","persist","persistFunc","blockPersistingCameraConfig","func","restoreCameraConfig","cameraConfig","_sfc_main$H","_sfc_main$G","position2D","_sfc_main$F","CrosshairsWidget2D","CrosshairSVG2D","isVisible","crosshairsSlice","_component_CrosshairsWidget2D","_component_CrosshairSVG2D","useViewProxy","container","curContainer","onViewProxyModified","useMountedViewProxy","mounted","updateMounted","useViewProxyMounted","useViewProxyUnmounted","prev","useWidgetManager","vtkWidgetManager","CaptureOn","curWM","oldWM","useCurrentSlice","useVTKViewContainer","useVTKMultiWorldToDisplay","displayCoords","ren","disp","cameraOnModified","useVTKMultiWorldToSVG","xy","_sfc_main$E","cursor","grabLineEl","focusWidth","down","hover","computeCropLines","cropAxis","cropPlanes","boundary","viewIDVal","cropAxisVal","cropPlanesVal","boundaryVal","sliceInfo","perpAxis","ax","cropRange","perpRange","perpBoundary","sliceCropRange","outOfBounds","getLineSegments","startEdge","startCrop","endCrop","endEdge","cropLinesToSVGDisplay","cropLines","worldPoints","indexLPSPoint","indexPt","svgPoints","useDragging","mouseEventToLPSPoint","getCropEdgePos","setCropEdgePos","activeAxis","activeEdge","initialPointerIndex","initialCrop","selectedCropEdge","initialPoint","_sfc_main$D","Crop2DLineHandle","imageExtent","currentSlicingAxis","inPlaneAxes","ax1","ax2","ax1Lines","ax2Lines","ax1SVGLines","ax2SVGLines","onPointerDown","onPointerMove","onPointerUp","lower","upper","newPlanes","_component_crop_2D_line_handle","isValidCroppingPlanes","lpsPlanesEqual","_sfc_main$C","VTKThreeViewWidgetManager","croppingPlanes","vtkImageCroppingWidget","wm","oldWm","applyPlanes","lpsPlanes","dirs","planesFromStore","_sfc_main$B","Crop2D","Crop3D","_component_crop_3D","_component_crop_2D","defaultKey","withProxyManager","pxm","useProxyManager","SLICE_OFFSET_KEYS","_sfc_main$A","SliceSlider","ViewOverlayGrid","SliceScrollTool","RulerTool","RectangleTool","CrosshairsTool","CropTool","ContourTool","vtkContainerRef","curImageMetadata","sliceConfigDefaults","sliceMin","sliceMax","newValue","windowWidth","windowLevel","dicomInfo","studyInfo","patientID","studyID","studyDescription","seriesNumber","seriesDescription","sliceDomain","ijkIndex","setSlice","setViewProxyContainer","onBeforeMount","viewID_","sliceOffset","onKeyStroke","toolContainer","VTKTwoViewWidgetManager","labelmapIDs","layerIDs","resizeToFitScene","upAxis","dimsWithSpacing","d","topLabel","leftLabel","lRep","lmRep","layersConfigs","layerIndex","layerConfig","colorBys","transferFunctions","opacityFunctions","blendConfigs","layerRep","colorBy","transferFunction","opacityFunction","blendConfig","arrayName","ctFunc","lut","LookupTableProxyMode","pwf","opacityPoints","n","_pushScopeId","_popScopeId","_hoisted_7","_hoisted_10","_component_slice_slider","_component_pan_tool","_component_zoom_tool","_component_slice_scroll_tool","_component_window_level_tool","_component_contour_tool","_component_ruler_tool","_component_rectangle_tool","_component_paint_tool","_component_crosshairs_tool","_component_crop_tool","_component_view_overlay_grid","_component_v_divider","_Transition","_hoisted_11","_component_v_progress_circular","CheckContoursToolStrip","VtkTwoView","_component_VtkTwoView","_component_CheckContoursToolStrip","readAllDirEntries","dirEntry","allEntries","entryToFile","readAllFiles","toProcess","fileEntries","types","logError","cur","useGlobalErrorHook","messageStore","onError","ProxyManagerEvent","ProxyManagerEvent2","onProxyManagerEvent","proxySubs","action","proxyId","useWebGLWatchdog","watchdogs","reportError","useThrottleFn","Messages","useEventListener","toast","createToastInterface","useToast","useAppLoadingNotifications","loadingCount","toastID","resetState","_setError","startLoading","stopLoading","TYPE","fn","applyLabelOffset","toolToStore","nextLabel","useKeyboardShortcuts","loadFiles","setError","succeeded","errored","errorMessages","errResult","firstError","failedError","_sfc_main$x","runAsLoading","layoutName","currentLayout","openFiles","fileEl","userPromptFiles","hasData","messageCount","messageBadgeColor","saveDialog","saveHappening","DragAndDrop","HandleUpload","CheckContours","patientInfo","selectedFile","_component_HandleUpload","_component_drag_and_drop","_component_CheckContours","HomeGreetings","PatientContainer","AddPatient","FindPatient","LogOut","_component_HomeGreetings","_component_AddPatient","_component_FindPatient","_component_LogOut","_component_PatientContainer","_sfc_main$s","ToolStrip","IconNumber","currentQaView","_hoisted_14","_hoisted_15","_hoisted_12","_component_ToolStrip","_hoisted_13","_component_IconNumber","numImages","phasePaddingX","phaseTextY","throttle","startX","endX","cornerRadius","xStart","yStart","borderRadius","xEnd","yEnd","verticalSpace","startThumbX","endThumbX","startFtoX","endFtoX","startHtoX","endHtoX","startBHtoX","endBHtoX","endF","rect","mouseX","widthWindow","newStart","newPosition","option","AddCardiacCycle","objInput","textX","textY","circleRadius","circleSpacingX","circleSpacingY","circleColor","canvasWidth","canvasHeight","systole","diastole","phaseClick","cardiacCycles","foundLabel","foundIndex","labelHere","foundState","endLocation","stateObj","targetSystole","targetDiastole","xMin","xMax","yMin","yMax","cardiacCycleArray","cycle","clickedState","targetObj","currentState","lowerbound","upperbound","xhere","previousState","nextState","cycleKey","targetCycle","dataInput","fillColor","curtype","currentKey","currentIndex","stateHere","phase","PhaseLocation","xlocation","newLabel","targetArray","newArray","pLocation","xLocation","spaceX","tempLocation","labelMidwayLoc","_component_AddCardiacCycle","ImageStripSlider","VideoTrimmer","ImageBarImageInfo","imgTemp","imageWidth","imagePromises","img","loadedImages","containerElement","states","videoTrimObject","scrollCont","newState","scrollAmount","targetElement","duration","startTime","step","timestamp","percentage","newloc","_component_VideoTrimmer","_component_ImageBarImageInfo","_component_ImageStripSlider","SquareLoader","_component_SquareLoader","StateButtons","ImageBar","IconToggleQA","SkeletonLoaderCBS","cleanState","_component_SkeletonLoaderCBS","_component_IconToggleQA","_component_StateButtons","_component_ImageBar","BreathingSplitRow","targetSlice","_component_BreathingSplitRow","CheckBreathingSplits","newComponent","_resolveDynamicComponent","selectedValue","yi","maxWidth","words","line","lineHeight","testLine","diffX","diffY","updateDiv","divElement","html2canvas","imageDataURL","_hoisted_16","outerRadius","innerRadius","sectionColors","chartData","totalValue","total","startAngle","sectionAngle","endAngle","numberi","number","colorStops","startStop","endStop","g","ReportLogoHolder","ReportDropDown","ReportImageContainer","ReportStrainMaps","ReportTextBox","ReportTextBoxMultiple","newLogo","element","fileOBJ","doc","jsPDF","today","inputString","lineWidth","initialY","getTextWidth","sentences","string","splitSentence","sentence","chunks","currentChunk","testChunk","logIndex","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_30","_hoisted_31","_hoisted_33","_hoisted_34","_hoisted_35","_hoisted_36","_hoisted_37","_hoisted_39","_hoisted_40","_hoisted_41","_hoisted_42","_hoisted_43","_hoisted_44","_hoisted_45","_hoisted_46","_hoisted_47","_hoisted_48","_hoisted_49","_hoisted_50","_hoisted_52","_hoisted_53","_hoisted_54","_hoisted_55","_hoisted_57","_hoisted_58","_hoisted_59","_hoisted_61","_hoisted_62","_hoisted_63","_hoisted_64","_hoisted_65","_hoisted_66","_hoisted_67","_hoisted_68","_hoisted_69","_hoisted_70","_hoisted_71","_hoisted_73","_component_ReportTextBox","_component_ReportLogoHolder","_component_ReportDropDown","_component_ReportTextBoxMultiple","_hoisted_32","_hoisted_38","_hoisted_51","_component_ReportImageContainer","_hoisted_56","_hoisted_60","_hoisted_72","_component_ReportStrainMaps","_hoisted_74","Report","_component_Report","contexti","xDiastole","grd","longestValueWidth","colors","dataHere","mouseY","distanceFromCenter","angle","normalizedAngle","sectionIndex","SimpleGraph","TerritoriesSegments","GraphTerritories","itemID","newAllowed","containter","_component_ScreenTemp","graph","_component_GraphTerritories","_component_TerritoriesSegments","_component_SimpleGraph","PatientHeaderInfo","AnalysisNavigationBar","QualityCheck","ReportMaker","GraphicalAnalysis","checkContours","_component_AnalysisNavigationBar","_component_PatientHeaderInfo","routes","Login","Home","Analysis","router","createRouter","createWebHistory","vtkImageMapper","vtkProxyManager","pinia","createPinia","createApp","App","initErrorReporting","VueToast","vuetify","VueResponsiveness"],"mappings":"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ACJ,MAAO,mBACP,cAAe,CAChB,CACF,CACF,CACF,EACD,WAAY,CACV,MAAO,UACP,MAAO,CACL,GAAI,QACJ,MAAO,aACP,cAAe,EAChB,EACD,IAAK,CACH,GAAI,MACJ,MAAO,aACP,cAAe,EAChB,EACD,cAAe,CACb,SAAU,CACR,CACE,GAAI,UACJ,MAAO,aACP,cAAe,EAChB,CACF,EACD,UAAW,CACT,CACE,GAAI,WACJ,MAAO,aACP,cAAe,EAChB,CACF,CACF,CACF,CACF,CACF,EACD,OAAQ,CACN,GAAI,SACJ,OAAQ,CACN,cAAe,CACb,MAAO,UACP,MAAO,CACL,GAAI,QACJ,MAAO,gBACP,cAAe,CAChB,EACD,IAAK,CACH,GAAI,MACJ,MAAO,gBACP,cAAe,EAChB,EACD,cAAe,CACb,SAAU,CACR,CACE,GAAI,UACJ,MAAO,gBACP,cAAe,CAChB,CACF,EACD,UAAW,CACT,CACE,GAAI,WACJ,MAAO,gBACP,cAAe,CAChB,CACF,CACF,CACF,EACD,iBAAkB,CAChB,MAAO,UACP,MAAO,CACL,GAAI,QACJ,MAAO,mBACP,cAAe,EAChB,EACD,IAAK,CACH,GAAI,MACJ,MAAO,mBACP,cAAe,EAChB,EACD,cAAe,CACb,SAAU,CACR,CACE,GAAI,UACJ,MAAO,mBACP,cAAe,EAChB,CACF,EACD,UAAW,CACT,CACE,GAAI,WACJ,MAAO,mBACP,cAAe,EAChB,CACF,CACF,CACF,EACD,WAAY,CACV,MAAO,UACP,MAAO,CACL,GAAI,QACJ,MAAO,aACP,cAAe,EAChB,EACD,IAAK,CACH,GAAI,MACJ,MAAO,aACP,cAAe,EAChB,EACD,cAAe,CACb,SAAU,CACR,CACE,GAAI,UACJ,MAAO,aACP,cAAe,EAChB,CACF,EACD,UAAW,CACT,CACE,GAAI,WACJ,MAAO,aACP,cAAe,EAChB,CACF,CACF,CACF,CACF,CACF,CACF,EACD,WAAY,CACV,KAAM,UACN,GAAI,EACJ,SAAU,KACV,aAAc,CACZ,aAAc,gBACd,cAAe,CACb,MAAO,gBACP,UAAW,GACX,SAAU,QACV,WAAY,SACb,EACD,iBAAkB,CAChB,MAAO,mBACP,UAAW,IACX,SAAU,QACV,WAAY,SACb,EACD,WAAY,CACV,MAAO,aACP,UAAW,GACX,SAAU,QACV,WAAY,SACb,CACF,EACD,iBAAkB,CAChB,YAAa,GACb,gBAAiB,GACjB,UAAW,EACZ,CACF,EACD,WAAY,CACV,KAAM,UACN,GAAI,EACJ,SAAU,KACV,aAAc,CACZ,aAAc,gBACd,cAAe,CACb,MAAO,gBACP,UAAW,GACX,SAAU,QACV,WAAY,SACb,EACD,iBAAkB,CAChB,MAAO,mBACP,UAAW,GACX,SAAU,QACV,WAAY,SACb,EACD,WAAY,CACV,MAAO,aACP,UAAW,IACX,SAAU,QACV,WAAY,SACb,CACF,EACD,iBAAkB,CAChB,YAAa,GACb,gBAAiB,GACjB,UAAW,EACZ,CACF,EAEJ,EACD,QAAS,CACP,kBAAkBh5B,EAAU,CAC1B,MAAMi5B,EAAcj5B,EAAS,GAC7B,KAAK,QAAQi5B,CAAW,EAAIj5B,CAC7B,EACD,kBAAkBhoC,EAAK,CACrB,KAAK,QAAQA,EAAI,EAAE,EAAE,OAAOA,EAAI,KAAK,EAAE,cAAcA,EAAI,KAAK,EAC5DA,EAAI,QACP,EACD,eAAeA,EAAK,CAClB,KAAK,QAAQA,EAAI,EAAE,EAAE,OAAOA,EAAI,KAAK,EAAE,cAAcA,EAAI,MAAM,EAAE,KAC/DA,EAAI,SAEP,CACF,EACD,SAAU,CACR,KAAK,WAAW,SAAW,KAAK,QAAQ,OACxC,KAAK,WAAW,SAAW,KAAK,QAAQ,MACzC,CACH,EAtUOyQ,GAAA,CAAA,MAAM,mBAAmB,0DAA9B,OAAAgB,EAAA,EAAAR,EAwCM,MAxCNR,GAwCM,CAvCJ6B,EAkBE4uD,EAAA,CAjBC,aAAYhwD,EAAU,WACtB,gBAAcY,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAP,GAAWL,EAAU,WAAC,iBAAiB,aAAyBA,EAAU,WAAC,iBAAiB,aAI1G,oBAAmBY,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAP,GAAWL,EAAU,WAAC,iBAAiB,iBAA6BA,EAAU,WAAC,iBAAiB,iBAInH,cAAYY,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAP,GAAWL,EAAU,WAAC,iBAAiB,WAAuBA,EAAU,WAAC,iBAAiB,WAItG,6BAAcA,EAAU,WAAC,aAAa,aAAeK,GACrD,cAAcF,EAAiB,kBAC/B,cAAcA,EAAiB,kBAC/B,WAAWA,EAAc,oFAG5BiB,EAkBE4uD,EAAA,CAjBC,aAAYhwD,EAAU,WACtB,gBAAcY,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAP,GAAWL,EAAU,WAAC,iBAAiB,aAAyBA,EAAU,WAAC,iBAAiB,aAI1G,oBAAmBY,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAP,GAAWL,EAAU,WAAC,iBAAiB,iBAA6BA,EAAU,WAAC,iBAAiB,iBAInH,cAAYY,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAP,GAAWL,EAAU,WAAC,iBAAiB,WAAuBA,EAAU,WAAC,iBAAiB,WAItG,6BAAcA,EAAU,WAAC,aAAa,aAAeK,GACrD,cAAcF,EAAiB,kBAC/B,cAAcA,EAAiB,kBAC/B,WAAWA,EAAc,qJCpBhC,MAAKlB,GAAU,CACb,WAAY,CACV,qBAAAgxD,GACA,cAAApJ,GACA,cAAA5lD,EACD,EAED,MAAO,CACL,MAAO,CACL,iBAAkB,uBAErB,EACD,QAAS,CACP,oBAAoBpQ,EAAI,CACtB,KAAK,aAAeA,CACrB,EAID,gBAAgBq/D,EAAc,CAC5B,KAAK,iBAAmBA,CACzB,CACF,EAED,SAAU,CACR,MAAMlI,EAAgB,OAAO,eAAe,QAAQ,eAAe,EAC/DA,EACF,KAAK,iBAAmBA,EAExB,KAAK,iBAAmB,sBAM3B,CAMH,EA3DOzoD,GAAA,CAAA,MAAM,kBAAkB,2BAA7B,OAAAgB,EAAA,EAAAR,EASM,MATNR,GASM,CARJE,EAIM,MAAA,CAJA,MAAKQ,EAAA,CAAE,CAAa,OAAA,CAAA,EAAQ,gBAAgB,CAAA,IAChDmB,EAEamhD,GAAA,CAFD,KAAK,MAAM,EAAA,WACrB,IAAoC,EAApChiD,EAAA,EAAAG,EAAoCyvD,GAApBnwD,EAAgB,gBAAA,CAAA,8ECiCxC,MAAKf,GAAU,CACb,MAAO,CACL,SAAU,CAAE,KAAM,OAAS,CAC5B,EACD,MAAO,CACL,MAAO,CACL,YAAa,KAEb,SAAU,GAEb,EACD,QAAS,CACP,iBAAkB,CAChB,KAAK,MAAM,WAAW,OACvB,EACD,kBAAkBE,EAAO,CACvB,KAAK,YAAYA,EAAM,OAAO,MAAM,CAAC,CAAC,CACvC,EACD,gBAAgBA,EAAO,CACrBA,EAAM,eAAc,EACpB,MAAMtV,EAAOsV,EAAM,aAAa,MAAM,CAAC,EACvC,KAAK,YAAYtV,CAAI,CACtB,EACD,eAAesV,EAAO,CACpBA,EAAM,eAAc,EAEpB,KAAK,SAAW,EACjB,EACD,iBAAkB,CAChB,KAAK,SAAW,EACjB,EACD,YAAYtV,EAAM,CAChB,GAAIA,EAAM,CACR,MAAMgD,EAAS,IAAI,WACnBA,EAAO,UAAY,IAAM,CACvB,KAAK,YAAcA,EAAO,QAE5BA,EAAO,cAAchD,CAAI,EAE5B,CACF,CACH,iDA7EEkW,EAgCM,MAAA,CA/BJ,MAAM,cACL,4BAAOI,EAAe,iBAAAA,EAAA,gBAAA,GAAAnW,CAAA,GACtB,gCAAWmW,EAAc,gBAAAA,EAAA,eAAA,GAAAnW,CAAA,GACzB,+BAAUmW,EAAc,gBAAAA,EAAA,eAAA,GAAAnW,CAAA,GACxB,2BAAMmW,EAAe,iBAAAA,EAAA,gBAAA,GAAAnW,CAAA,GACrB,gCAAWmW,EAAe,iBAAAA,EAAA,gBAAA,GAAAnW,CAAA,GAC3B,IAAI,gBACH,oCAAuBoW,EAAa,eAAAA,EAAA,cAAA,GAAApW,CAAA,EAAA,CAAA,SAAA,CAAA,EAAA,CAAA,OAAA,CAAA,KAG7BgW,EAAW,iBADnBD,EAKE,MAAA,OAHC,IAAKC,EAAW,YACjB,IAAI,gBACH,MAAO,CAAqB,OAAA,SAAA,wBAKvBQ,EAAA,WAAaR,EAAW,iBAHhCD,EAMM,MAAA,OALJ,MAAKE,EAAA,CAAC,eAAc,CAAA,MACHD,EAAQ,QAAA,CAAA,CAAA,IAGzBP,EAAsD,KAAA,CAAjD,+BAAUU,EAAc,gBAAAA,EAAA,eAAA,GAAAnW,CAAA,IAAE,qBAAkB,EAAA,gBAGnDyV,EAOE,QAAA,CANA,IAAI,aACJ,KAAK,OACL,MAAA,CAAqB,QAAA,MAAA,EACrB,OAAO,UACN,6BAAQU,EAAiB,mBAAAA,EAAA,kBAAA,GAAAnW,CAAA,GAC1B,kBAAgB,iGCTtB,MAAKiV,GAAU,CACb,MAAO,CACL,GAAI,CACF,KAAM,OACN,SAAU,EACX,EACD,QAAS,CACP,KAAM,MACN,SAAU,EACX,EACD,SAAU,CAAE,KAAM,QAAS,QAAS,EAAM,CAC3C,EACD,MAAO,CACL,MAAO,CACL,eAAgB,YAEnB,EACD,QAAS,CACP,iBAAiBE,EAAO,CACtB,MAAMixD,EAAgBjxD,EAAM,OAAO,MACnC,KAAK,eAAiBixD,EACtB,KAAK,MAAM,kBAAmB,KAAK,GAAIA,CAAa,CACrD,CACF,CACH,uDA7CuB,MAAM,8BAOvB3wD,EAAqD,SAAA,CAA7C,MAAM,GAAG,SAAA,GAAS,SAAA,IAAS,YAAS,EAAA,CAAA,yBAU5C,MAAM,mDAjBCe,EAAQ,UAAnBD,IAAAR,EAgBM,MAhBNR,GAgBM,CAfJE,EAcS,SAAA,CAbN,GAAIe,EAAE,GACP,SAAA,GACC,SAAMI,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAP,GAAEF,EAAgB,iBAACE,CAAM,GAChC,kBAAgB,qCAEhBV,IACAY,EAAA,EAAA,EAAAR,EAMSmB,GALmB,KAAAC,GAAAX,EAAA,QAAlB,CAAA0pD,EAAQz/D,SADlBsV,EAMS,SAAA,CAJN,IAAKtV,EACL,MAAOy/D,EAAO,KAEZ,EAAAhqD,EAAAgqD,EAAO,KAAK,EAAA,EAAArpD,EAAA,0BAIrBd,EAA4D,KAA5DH,GAA4DM,EAAtBF,EAAc,cAAA,EAAA,CAAA,kECkGtD,MAAKf,GAAU,CACb,MAAO,CACL,GAAI,CAAE,KAAM,MAAQ,EACpB,MAAO,CAAE,KAAM,OAAQ,QAAS,GAAK,EACrC,OAAQ,CAAE,KAAM,OAAQ,QAAS,GAAK,EACtC,WAAY,CAAE,KAAM,OAAQ,QAAS,sBAAwB,EAC7D,OAAQ,CAAE,KAAM,OAAQ,QAAS,IAAM,EACvC,SAAU,CAAE,KAAM,QAAS,QAAS,EAAM,CAC3C,EACD,MAAO,CACL,MAAO,CACL,SAAU,GACV,SAAU,GACV,QAAS,KACT,QAAS,KACT,QAAS,EACT,QAAS,EACT,UAAW,EACX,iBAAkB,EAClB,cAAe,KACf,SAAU,GAEb,EACD,QAAS,CACP,aAAc,CAEZ,KAAM,CAAE,OAAAwf,CAAK,EAAM,KAAK,MAClBpuB,EAAMouB,EAAO,WAAW,IAAI,EAClCA,EAAO,MAAQ,KAAK,OAAS,EAAI,KACjCA,EAAO,OAAS,KAAK,OAErBpuB,EAAI,UAAY,qBAChBA,EAAI,SAAS,EAAG,EAAGouB,EAAO,MAAOA,EAAO,MAAM,EAE9CpuB,EAAI,UAAY,QAChBA,EAAI,KAAO,aACXA,EAAI,UAAY,SAChBA,EAAI,aAAe,SAEnB,KAAK,SACHA,EACA,KAAK,WACLouB,EAAO,MAAQ,EACfA,EAAO,OAAS,EAChB,IAEH,EACD,SAAStR,EAASqG,EAAMzb,EAAGs4D,EAAIC,EAAU,CACvC,IAAIt4D,EAAIq4D,EACR,MAAME,EAAQ/8C,EAAK,MAAM,GAAG,EAC5B,IAAIg9C,EAAO,GACX,MAAMC,EAAatjD,EAAQ,YAAY,GAAG,EAAE,MAAQ,IAEpD,QAASzgB,EAAI,EAAGA,EAAI6jE,EAAM,OAAQ7jE,IAAK,CACrC,MAAMgkE,EAAW,GAAGF,EAAOD,EAAM7jE,CAAC,KAChBygB,EAAQ,YAAYujD,CAAQ,EAAE,MAEhCJ,GAAY5jE,EAAI,GAC9BygB,EAAQ,SAASqjD,EAAMz4D,EAAGC,CAAC,EAC3Bw4D,EAAO,GAAGD,EAAM7jE,CAAC,KACjBsL,GAAKy4D,GAELD,EAAOE,EAIXvjD,EAAQ,SAASqjD,EAAMz4D,EAAGC,CAAC,CAC5B,EACD,WAAY,CACV,KAAM,CAAE,OAAAymB,CAAK,EAAM,KAAK,MAClBpuB,EAAMouB,EAAO,WAAW,IAAI,EAClCpuB,EAAI,UAAU,EAAG,EAAGouB,EAAO,MAAOA,EAAO,MAAM,EAC/CpuB,EAAI,UAAU,KAAK,cAAe,EAAG,CAAC,CACvC,EACD,gBAAiB,CACf,KAAK,MAAM,iBAAiB,OAC7B,EACD,YAAY8O,EAAO,CACjB,MAAMtV,EAAOsV,EAAM,OAAO,MAAM,CAAC,EAE3B,CAAE,OAAAsf,CAAK,EAAM,KAAK,MACxB,GAAI50B,EAAM,CACR,MAAMgD,EAAS,IAAI,WACnBA,EAAO,OAAUwuB,GAAM,CACrB,KAAK,cAAgB,IAAI,MACzB,KAAK,cAAc,OAAS,IAAM,CAChCoD,EAAO,MAAQ,KAAK,cAAc,MAAQ,GAC1CA,EAAO,OAAS,KAAK,cAAc,OAAS,GAC5C,KAAK,UAAS,GAEhB,KAAK,cAAc,IAAMpD,EAAE,OAAO,OAClC,KAAK,gBAAe,EACpB,KAAK,0BAAyB,GAEhCxuB,EAAO,cAAchD,CAAI,EAE5B,EACD,gBAAgBA,EAAM,CACpB,KAAM,CAAE,OAAA40B,CAAK,EAAM,KAAK,MACxB,GAAI50B,EAAM,CACR,MAAMgD,EAAS,IAAI,WACnBA,EAAO,OAAUwuB,GAAM,CACrB,KAAK,cAAgB,IAAI,MACzB,KAAK,cAAc,OAAS,IAAM,CAChCoD,EAAO,MAAQ,KAAK,cAAc,MAAQ,GAC1CA,EAAO,OAAS,KAAK,cAAc,OAAS,GAC5C,KAAK,UAAS,GAEhB,KAAK,cAAc,IAAMpD,EAAE,OAAO,OAClC,KAAK,gBAAe,EACpB,KAAK,0BAAyB,GAEhCxuB,EAAO,cAAchD,CAAI,EAE5B,EACD,gBAAgBsV,EAAO,CACrBA,EAAM,eAAc,EACpB,MAAMtV,EAAOsV,EAAM,aAAa,MAAM,CAAC,EACvC,KAAK,gBAAgBtV,CAAI,EACzB,KAAK,SAAW,EACjB,EACD,eAAesV,EAAO,CACpBA,EAAM,eAAc,EAEpB,KAAK,SAAW,EACjB,EACD,iBAAkB,CAChB,KAAK,SAAW,EACjB,EAED,gBAAiB,CACX,KAAK,gBACP,KAAK,SAAW,CAAC,KAAK,SAEzB,EACD,gBAAgBA,EAAO,CAChB,KAAK,WAGV,KAAK,SAAW,GAChB,KAAK,QAAUA,EAAM,QACrB,KAAK,QAAUA,EAAM,QACtB,EACD,gBAAgBA,EAAO,CACrB,GAAI,GAAC,KAAK,UAAY,CAAC,KAAK,WAErB,GAAI,KAAK,UAAY,QAAa,KAAK,UAAY,OAAW,CACnE,MAAMwxD,EAAQxxD,EAAM,QAAU,KAAK,QAC7ByxD,EAAQzxD,EAAM,QAAU,KAAK,QACnC,KAAK,SAAWwxD,EAChB,KAAK,SAAWC,EAChB,KAAK,MAAM,OAAO,MAAM,UAAY,aAAa,KAAK,cAAc,KAAK,aACzE,KAAK,QAAUzxD,EAAM,QACrB,KAAK,QAAUA,EAAM,SAExB,EACD,eAAgB,CACd,KAAK,SAAW,GAChB,KAAK,QAAU,OACf,KAAK,QAAU,MAChB,EACD,QAAS,CACP,KAAK,WAAa,KAClB,KAAK,gBAAe,CACrB,EACD,SAAU,CACR,KAAK,WAAa,KAClB,KAAK,gBAAe,CACrB,EACD,2BAA4B,CAC1B,KAAK,SAAW,GAChB,KAAK,UAAY,KAAK,iBACtB,KAAK,gBAAe,CACrB,EACD,iBAAkB,CAChB,GAAI,KAAK,cAAe,CACtB,MAAM0xD,EAAY,KAAK,MAAM,YAG7BA,EAAU,MAAM,UAAY,SAAS,KAAK,aAC1CA,EAAU,MAAM,gBAAkB,MAErC,EACD,MAAM,mBAAoB,CAExB,MAAMC,EAAa,KAAK,MAAM,oBAAoB,EAGlDC,GAAYD,EAAY,CAAE,QAAS,GAAO,MAAO,EAAG,EACjD,KAAMryC,GAAW,CAEhB,MAAMuyC,EAAevyC,EAAO,UAAU,WAAW,EAGjD,KAAK,MAAM,sBAAuB,KAAK,GAAIuyC,CAAY,EACxD,EACA,MAAOlgE,GAAU,CAChB,QAAQ,MAAM,8BAA+BA,CAAK,CACpD,CAAC,CACJ,CACF,EACD,SAAU,CAGR,GAFA,KAAK,YAAW,EAEZ,KAAK,OAAQ,CACf,MAAMg9D,EAAU,IAAI,MACpBA,EAAQ,IAAM,KAAK,OACnBA,EAAQ,OAAS,IAAM,CACrB,KAAK,MAAM,eAAe,IAAMA,EAAQ,KAG7C,EACD,MAAO,CACL,UAAW,CACL,KAAK,WACP,KAAK,SAAW,CAAC,KAAK,SACtB,KAAK,cAAa,EAErB,CACF,CACH,uDAtUyB,MAAM,eAEvB,MAAM,gBACN,MAAM,cACN,IAAI,cACJ,MAAA,CAA0B,SAAA,UAAA,aAGxBruD,EAA0D,IAAA,CAAvD,MAAM,sBAAsB,MAAA,CAAsB,MAAA,SAAA,iBAArDE,cAeF,MAAM,cACN,MAAM,OACN,IAAI,OACJ,MAAA,CAA0B,SAAA,UAAA,aAQxBF,EAA0D,IAAA,CAAvD,MAAM,sBAAsB,MAAA,CAAsB,MAAA,SAAA,iBAArDI,cAMF,MAAM,iBACN,MAAM,UACN,IAAI,UACJ,MAAA,CAA0B,SAAA,UAAA,aAGxBJ,EAA+D,IAAA,CAA5D,MAAM,2BAA2B,MAAA,CAAsB,MAAA,SAAA,iBAA1DK,cAMF,MAAM,kBACN,MAAM,WACN,IAAI,WACJ,MAAA,CAA0B,SAAA,UAAA,aAGxBL,EAAgE,IAAA,CAA7D,MAAM,4BAA4B,MAAA,CAAsB,MAAA,SAAA,iBAA3D0oD,IAoBDF,GAAA,CAAA,IAAI,oBAAoB,YACtB,MAAA,CAA0B,SAAA,UAAA,OAE3B,MAAA,CAAkD,cAAA,OAAA,oBAAA,MAAA,EAClD,GAAG,sBACH,IAAI,iBACJ,IAAI,wDA7FZloD,EA6GM,MAAA,CA5GJ,GAAG,kBACF,MAAKE,EAAA,CAAA,OAAYD,EAAQ,SAAA,MAASA,EAAQ,SAAA,EAC1C,MAAKg3B,GAAA,CAAA,OAAYx2B,EAAM,OAAA,KAAA,MAAgBA,EAAK,MAAA,IAAA,CAAA,EAC5C,gCAAWL,EAAc,gBAAAA,EAAA,eAAA,GAAAnW,CAAA,GACzB,+BAAUmW,EAAc,gBAAAA,EAAA,eAAA,GAAAnW,CAAA,GACxB,6BAAMmW,EAAe,iBAAAA,EAAA,gBAAA,GAAAnW,CAAA,GACrB,kCAAWmW,EAAe,iBAAAA,EAAA,gBAAA,GAAAnW,CAAA,KAEhBwW,EAAQ,UAAnBD,IAAAR,EA6EM,MA7ENR,GA6EM,CA5EJE,EAkBM,MAlBNC,GAkBM,CAZJD,EAES,SAAA,CAFD,MAAM,8BAA+B,4BAAOU,EAAc,gBAAAA,EAAA,eAAA,GAAAnW,CAAA,QAGlEyV,EAQE,QAAA,CAPA,KAAK,OACL,IAAI,mBACJ,KAAK,cACL,MAAA,CAAqB,QAAA,MAAA,EACrB,OAAO,UACN,6BAAQU,EAAW,aAAAA,EAAA,YAAA,GAAAnW,CAAA,GACpB,kBAAgB,wCAKZgW,EAAa,eADrBO,IAAAR,EAeM,MAfNH,GAeM,CARJH,EAOS,SAAA,CANP,MAAKQ,EAAA,CAAC,iBAAgB,CAAA,OACJD,EAAQ,QAAA,CAAA,CAAA,EAC1B,MAAA,CAAkB,KAAA,MAAA,EACjB,4BAAOG,EAAc,gBAAAA,EAAA,eAAA,GAAAnW,CAAA,sBAOlBgW,EAAa,eADrBO,IAAAR,EAUM,MAVNO,GAUM,CAHJb,EAES,SAAA,CAFD,MAAM,iBAAiB,MAAA,CAAkB,KAAA,MAAA,EAAE,4BAAOU,EAAM,QAAAA,EAAA,OAAA,GAAAnW,CAAA,oBAM1DgW,EAAa,eADrBO,IAAAR,EAUM,MAVNyiD,GAUM,CAHJ/iD,EAES,SAAA,CAFD,MAAM,iBAAiB,MAAA,CAAmB,KAAA,OAAA,EAAE,4BAAOU,EAAO,SAAAA,EAAA,QAAA,GAAAnW,CAAA,gCAqBtEyV,EAqBM,MArBNwoD,GAqBM,CApBkCznD,EAAM,QAA5CD,IAAAR,EAOM,MAPNmoD,GAOM,CANJzoD,EAKE,MALFwxD,GAKE,KAAA,GAAA,cAEJxxD,EAWM,MAAA,CAVH,MAAKu3B,GAAA,CAAA,OAAYx2B,EAAM,OAAA,KAAA,MAAgBA,EAAK,MAAA,IAAA,CAAA,EAC7C,IAAI,gBAEJf,EAMU,SAAA,CALR,IAAI,SACJ,GAAG,iBACF,gCAAWU,EAAe,iBAAAA,EAAA,gBAAA,GAAAnW,CAAA,GAC1B,gCAAWmW,EAAe,iBAAAA,EAAA,gBAAA,GAAAnW,CAAA,GAC1B,8BAASmW,EAAa,eAAAA,EAAA,cAAA,GAAAnW,CAAA,4FCnDjC,MAAKiV,GAAU,CACb,MAAO,CACL,GAAI,CACF,KAAM,OACN,SAAU,EACX,EACD,OAAQ,CACN,KAAM,MACN,SAAU,EACX,CACF,EACD,MAAO,CACL,MAAO,CACL,YAAa,GAAK,EAAI,EACtB,IAAK,KACL,IAAK,KACL,IAAK,KAER,EACD,MAAO,CACL,QAAS,CACP,KAAK,UAAS,EACd,KAAK,YAAW,CACjB,CACF,EACD,SAAU,CACR,KAAK,UAAS,EAEd,KAAK,YAAW,CACjB,EACD,QAAS,CACP,WAAY,CACV,CAAC,KAAK,IAAK,KAAK,IAAK,KAAK,GAAG,EAAI,KAAK,MACvC,EACD,aAAc,CACZ,MAAMwf,EAAS,KAAK,MAAM,YACpBpuB,EAAMouB,EAAO,WAAW,IAAI,EAElCA,EAAO,MAAQ,GACfA,EAAO,OAAS,GAEhB,MAAMpiB,EAAUoiB,EAAO,MAAQ,EACzBniB,EAAUmiB,EAAO,OAAS,EAC1ByyC,EAAc,KAAK,YACnBC,EAAcD,EAAc,EAElC7gE,EAAI,UAAU,EAAG,EAAGouB,EAAO,MAAOA,EAAO,MAAM,EAG/C,MAAM2yC,EAAgB,KAAK,UAAU,CAAC,KAAK,IAAK,KAAK,IAAK,KAAK,GAAG,CAAC,EAE7DC,EAAY,CAAC,EAAG,EAAG,CAAC,EAEpBC,EAAaD,EAAU,OAAO,CAACE,EAAOrjE,IAAUqjE,EAAQrjE,EAAO,CAAC,EAEtE,IAAIsjE,EAAa,EACjBH,EAAU,QAAQ,CAACnjE,EAAOzD,IAAU,CAClC,MAAMgnE,EAAgBvjE,EAAQojE,EAAc,KAAK,GAAK,EAChDI,EAAWF,EAAaC,EAE9BphE,EAAI,UAAS,EACbA,EAAI,OACFgM,EAAU60D,EAAc,KAAK,IAAIM,CAAU,EAC3Cl1D,EAAU40D,EAAc,KAAK,IAAIM,CAAU,GAE7CnhE,EAAI,IAAIgM,EAASC,EAAS40D,EAAaM,EAAYE,CAAQ,EAC3DrhE,EAAI,IAAIgM,EAASC,EAAS60D,EAAaO,EAAUF,EAAY,EAAI,EACjEnhE,EAAI,UAAS,EACbA,EAAI,UAAY+gE,EAAc3mE,CAAK,EACnC4F,EAAI,KAAI,EAGRA,EAAI,UAAY,GAChBA,EAAI,YAAc,QAClBA,EAAI,OAAM,EAEVmhE,EAAaE,CACf,CAAC,EAGDrhE,EAAI,UAAS,EACbA,EAAI,IAAIgM,EAASC,EAAS40D,EAAa,EAAG,KAAK,GAAK,CAAC,EACrD7gE,EAAI,YAAc,SAClBA,EAAI,UAAY,EAChBA,EAAI,OAAM,EAGVA,EAAI,UAAS,EACbA,EAAI,IAAIgM,EAASC,EAAS60D,EAAa,EAAG,KAAK,GAAK,CAAC,EACrD9gE,EAAI,YAAc,SAClBA,EAAI,UAAY,EAChBA,EAAI,OAAM,CACX,EACD,sBAAsBshE,EAAS,CAC7B,IAAIC,EAASD,EAEbC,EAASA,EAAO,SAAQ,EAAG,QAAQ,KAAM,EAAE,EAG3C,MAAMC,EAAa,CACjB,CACE,MAAO,CAAC,EAAG,GAAI,GAAG,EAClB,cAAe,EACf,cAAe,GAChB,EACD,CACE,MAAO,CAAC,EAAG,IAAK,GAAG,EACnB,cAAe,IACf,cAAe,GAChB,EACD,CACE,MAAO,CAAC,GAAI,IAAK,EAAE,EACnB,cAAe,IACf,cAAe,EAChB,EACD,CACE,MAAO,CAAC,IAAK,IAAK,EAAE,EACpB,cAAe,GACf,cAAe,GAChB,EACD,CACE,MAAO,CAAC,IAAK,GAAI,CAAC,EAClB,cAAe,IACf,cAAe,CAChB,GAIHD,EAAS,KAAK,IAAI,KAAK,IAAI,OAAOA,CAAM,EAAG,GAAG,EAAG,EAAE,EAGnD,MAAM9C,GAAc8C,EAAS,IAAM,GAGnC,IAAIE,EACAC,EACJ,QAASrlE,EAAI,EAAGA,EAAImlE,EAAW,OAAQnlE,IACrC,GACEoiE,GAAc+C,EAAWnlE,CAAC,EAAE,eAC5BoiE,GAAc+C,EAAWnlE,CAAC,EAAE,cAC5B,CACAolE,EAAYD,EAAWnlE,CAAC,EACxBqlE,EAAUF,EAAWnlE,EAAI,CAAC,EAC1B,MAKCqlE,IACHD,EAAYD,EAAWA,EAAW,OAAS,CAAC,EAC5CE,EAAUF,EAAWA,EAAW,OAAS,CAAC,GAI5C,MAAM1mE,GACH2jE,EAAagD,EAAU,gBACvBC,EAAQ,cAAgBD,EAAU,eAC/B,EAAI,KAAK,MACbA,EAAU,MAAM,CAAC,EAAI3mE,GAAK4mE,EAAQ,MAAM,CAAC,EAAID,EAAU,MAAM,CAAC,IAE1DE,EAAI,KAAK,MACbF,EAAU,MAAM,CAAC,EAAI3mE,GAAK4mE,EAAQ,MAAM,CAAC,EAAID,EAAU,MAAM,CAAC,IAE1DjiE,EAAI,KAAK,MACbiiE,EAAU,MAAM,CAAC,EAAI3mE,GAAK4mE,EAAQ,MAAM,CAAC,EAAID,EAAU,MAAM,CAAC,IAGhE,MAAO,OAAO,MAAME,MAAMniE,IAC3B,EACD,UAAUtB,EAAK,CACb,MAAO,CACL,KAAK,sBAAsBA,EAAI,CAAC,CAAC,EACjC,KAAK,sBAAsBA,EAAI,CAAC,CAAC,EACjC,KAAK,sBAAsBA,EAAI,CAAC,CAAC,EAEpC,CACF,CACH,EAvOOgR,GAAA,CAAA,MAAA,CAA0B,SAAA,UAAA,CAAA,EACrBG,GAAA,CAAA,IAAI,aAAa,EAEvBC,GAAA,CAAA,MAAA,CAQC,SAAA,WAAA,MAAA,qBAAA,IAAA,OAAA,KAAA,OAAA,MAAA,OAAA,OAAA,OAAA,aAAA,QAAA,CAAA,EAODkB,GAAA,CAAA,MAAA,CASC,SAAA,WAAA,MAAA,qBAAA,IAAA,OAAA,KAAA,OAAA,MAAA,OAAA,OAAA,OAAA,aAAA,QAAA,CAAA,EAQDjB,GAAA,CAAA,MAAA,CASC,SAAA,WAAA,MAAA,qBAAA,IAAA,OAAA,KAAA,OAAA,MAAA,OAAA,OAAA,OAAA,aAAA,QAAA,CAAA,2BA5CL,OAAAW,EAAA,EAAAR,EAkDM,MAlDNR,GAkDM,CAjDJE,EAAmC,SAAnCC,GAAmC,KAAA,GAAA,EACnCD,EAcM,MAdNE,GAcM,CAHJF,EAEK,YADAO,EAAG,GAAA,EAAA,CAAA,IAGVP,EAeM,MAfNoB,GAeM,CAHJpB,EAEK,YADAO,EAAG,GAAA,EAAA,CAAA,IAIVP,EAeM,MAfNG,GAeM,CAHJH,EAEK,YADAO,EAAG,GAAA,EAAA,CAAA,qECrCd,MAAKf,GAAU,CACb,MAAO,CACL,GAAI,CAAE,KAAM,OAAQ,SAAU,EAAM,EACpC,UAAW,CACT,KAAM,OACN,SAAU,GACV,QAAS,IACV,EACD,SAAU,CAAE,KAAM,QAAS,QAAS,EAAM,CAC3C,EACD,MAAO,CACL,MAAO,CACL,QAAS,EACT,YAAa,KAAK,UAErB,EACD,QAAS,CACP,aAAc,CACZ,KAAK,MAAM,cAAe,KAAK,GAAI,KAAK,WAAW,CACpD,EACD,WAAWE,EAAO,CAChB,KAAK,YAAcA,EAAM,OAAO,KACjC,CACF,EACD,MAAO,CACL,UAAW,CACT,KAAK,MAAM,WAAW,SAAW,CAAC,KAAK,QACxC,CACF,EACD,SAAU,CACH,KAAK,WACR,KAAK,MAAM,WAAW,SAAW,GAEpC,CACH,mDA5CEY,EAME,QAAA,CALC,MAAOS,EAAS,UAChB,4BAAOL,EAAU,YAAAA,EAAA,WAAA,GAAAnW,CAAA,GACjB,2BAAMmW,EAAW,aAAAA,EAAA,YAAA,GAAAnW,CAAA,GAClB,IAAI,aACH,cAAewW,EAAQ,QAAA,CAAA,8ECO5B,MAAKvB,GAAU,CACb,MAAO,CACL,GAAI,CAAE,KAAM,OAAQ,SAAU,EAAM,EACpC,UAAW,CACT,KAAM,OACN,SAAU,GACV,QAAS,IACV,EACD,YAAa,CAAE,KAAM,OAAQ,QAAS,EAAI,EAC1C,SAAU,CAAE,KAAM,QAAS,QAAS,EAAM,CAC3C,EACD,MAAO,CACL,MAAO,CACL,QAAS,EACT,YAAa,KAAK,UAErB,EACD,QAAS,CACP,aAAc,CACZ,KAAK,MAAM,cAAe,KAAK,GAAI,KAAK,WAAW,CACpD,EACD,WAAWE,EAAO,CAChB,KAAK,YAAcA,EAAM,OAAO,KACjC,CACF,EACD,SAAU,CACH,KAAK,WACR,KAAK,MAAM,WAAW,SAAW,GAEpC,EACD,MAAO,CACL,UAAW,CACT,KAAK,MAAM,WAAW,SAAW,CAAC,KAAK,QACxC,CACF,CACH,iEA/CEY,EAQY,WAAA,CAPT,MAAOS,EAAS,UAChB,4BAAOL,EAAU,YAAAA,EAAA,WAAA,GAAAnW,CAAA,GACjB,2BAAMmW,EAAW,aAAAA,EAAA,YAAA,GAAAnW,CAAA,GAClB,IAAI,aACH,MAAKiW,EAAA,CAAA,KAAUO,EAAQ,SAAA,OAAA,CAAWA,EAAQ,SAAA,EAC1C,YAAaA,EAAW,YACzB,kBAAgB,uGCgmBpB,MAAKvB,GAAU,CACb,WAAY,CACV,iBAAAgzD,GACA,eAAAC,GACA,qBAAAC,GACA,iBAAAC,GACA,cAAAC,GACA,sBAAAC,EACD,EACD,MAAO,CACL,SAAU,CAAE,KAAM,QAAS,SAAU,GAAM,QAAS,EAAM,CAC3D,EACD,MAAO,CACL,MAAO,CACL,cAAe,CACb,CAAE,MAAO,SAAU,MAAO,QAAU,EACpC,CAAE,MAAO,OAAQ,MAAO,MAAQ,EAChC,CAAE,MAAO,QAAS,MAAO,OAAS,CACnC,EACD,oBAAqB,CACnB,CAAE,MAAO,MAAO,MAAO,KAAO,EAC9B,CAAE,MAAO,KAAM,MAAO,IAAM,CAC7B,EACD,oBAAqB,CACnB,CAAE,MAAO,YAAa,MAAO,WAAa,EAC1C,CAAE,MAAO,OAAQ,MAAO,MAAQ,EAChC,CAAE,MAAO,KAAM,MAAO,IAAM,EAC5B,CAAE,MAAO,MAAO,MAAO,KAAO,CAC/B,EAED,iBAAkB,CAChB,YAAa,mBACb,WAAY,KAEZ,YAAa,eACb,cAAe,GACf,WAAY,KACZ,WAAY,cACZ,UAAW,cAGX,UAAW,cACX,SAAU,QACV,SAAU,cACV,SAAU,QAEV,aAAc,GACd,aAAc,GAEd,OAAQ,kBACR,SAAU,oBAEV,cAAe,kBACf,cAAe,OACf,gBAAiB,UACjB,YACE,sFAEF,QAAS,GAET,kBAAmB,KACnB,YAAa,KACb,YAAa,KACb,YAAa,KACb,uBAAwB,MAExB,eAAgB,KAChB,YAAa,KACb,YAAa,KACb,YAAa,KACb,oBAAqB,OAErB,kBAAmB,KACnB,YAAa,KACb,YAAa,KAEb,kBAAmB,KACnB,YAAa,KACb,YAAa,KAEb,kBAAmB,KACnB,YAAa,KACb,YAAa,KAEb,qBAAsB,KACtB,eAAgB,KAChB,eAAgB,KAEhB,cAAe,GACf,YAAa,GAEb,mBAAoB,GACpB,eAAgB,GAEhB,kBAAmB,GACnB,YAAa,GACb,YAAa,GACb,YAAa,OACd,EAEJ,EACD,QAAS,CACP,iBAAiBzhE,EAAI3C,EAAO,CAC1B,KAAK,iBAAiB2C,CAAE,EAAI3C,CAC7B,EACD,iBAAiBqkE,EAAS,CACxB,KAAK,iBAAiB,WAAaA,CACpC,EACD,mBAAmB1hE,EAAIwtD,EAAU,CAE/B,KAAK,iBAAiBxtD,CAAE,EAAIwtD,CAC7B,EACD,gBAAiB,CACf,KAAK,SAAQ,CACd,EACD,MAAM,SAASxtD,EAAI,CACjB,MAAM,KAAK,MAAMA,CAAE,EAAE,kBAAiB,CACvC,EAED,MAAM,WAAY,CAChB,MAAM,KAAK,SAAS,aAAa,EACjC,MAAM,KAAK,SAAS,eAAe,EACnC,MAAM,KAAK,SAAS,oBAAoB,EACxC,MAAM,KAAK,kBAAkB,iBAAkB,iBAAiB,EAChE,MAAM,KAAK,kBAAkB,aAAc,YAAY,CACxD,EACD,MAAM,kBAAkBA,EAAI2hE,EAAS,CAEnC,MAAM1B,EAAa,KAAK,MAAM0B,CAAO,EAGrCzB,GAAYD,EAAY,CAAE,QAAS,GAAO,MAAO,EAAG,EACjD,KAAMryC,GAAW,CAEhB,MAAMuyC,EAAevyC,EAAO,UAAU,WAAW,EAGjD,KAAK,sBAAsB5tB,EAAImgE,CAAY,EAC5C,EACA,MAAOlgE,GAAU,CAChB,QAAQ,MAAM,8BAA+BA,CAAK,CACpD,CAAC,CACJ,EAED,sBAAsBD,EAAI8Y,EAAO,CAC/B,KAAK,iBAAiB9Y,CAAE,EAAI8Y,CAC7B,EACD,UAAW,CACT,MAAM8oD,EAAU,KAAK,iBAErB,OAAO,MAAQ,OAAO,MAAM,MAE5B,MAAMC,EAAMC,GAAM,IAAK,KAAM,CAAC,IAAK,GAAG,CAAC,EACvCD,EAAI,QAAQ,0BAA2B,SAAU,QAAQ,EACzDA,EAAI,QAAQ,0BAA2B,QAAS,QAAQ,EACxDA,EAAI,QAAQ,yBAA0B,aAAc,QAAQ,EAG5DA,EAAI,QAAQ,YAAa,MAAM,EAC/BA,EAAI,YAAY,EAAE,EAClBA,EAAI,KAAKD,EAAQ,YAAa,GAAI,EAAE,EAEpCC,EAAI,YAAY,CAAC,EACjBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAK,UAAW,GAAI,EAAE,EAEtBD,EAAQ,YAAc,MACxBC,EAAI,SAASD,EAAQ,WAAY,MAAO,IAAK,GAAI,IAAK,IAAI,EAG5DC,EAAI,YAAY,EAAE,EAClBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAKD,EAAQ,YAAa,GAAI,EAAE,EAEpCC,EAAI,YAAY,CAAC,EACjBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAK,UAAW,GAAI,GAAG,EAE3BA,EAAI,YAAY,EAAE,EAClBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAKD,EAAQ,cAAe,GAAI,GAAG,EAEvCC,EAAI,YAAY,CAAC,EACjBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAK,OAAQ,IAAK,GAAG,EAEzBA,EAAI,YAAY,EAAE,EAClBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAKD,EAAQ,WAAY,IAAK,GAAG,EAErCC,EAAI,YAAY,CAAC,EACjBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAK,OAAQ,IAAK,GAAG,EAEzBA,EAAI,YAAY,EAAE,EAClBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAKD,EAAQ,WAAY,IAAK,GAAG,EAErCC,EAAI,YAAY,CAAC,EACjBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAK,cAAe,IAAK,GAAG,EAEhCA,EAAI,YAAY,EAAE,EAClBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAKD,EAAQ,UAAW,IAAK,GAAG,EAEpCC,EAAI,aAAa,EAAG,EACpBA,EAAI,KAAK,IAAK,IAAK,GAAI,GAAG,EAG1BA,EAAI,YAAY,EAAE,EAClBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAK,OAAQ,GAAI,GAAG,EAExBA,EAAI,YAAY,CAAC,EACjBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAK,cAAe,GAAI,GAAG,EAE/BA,EAAI,YAAY,CAAC,EACjBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAKD,EAAQ,UAAW,GAAI,GAAG,EAEnCC,EAAI,YAAY,CAAC,EACjBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAK,YAAa,GAAI,GAAG,EAE7BA,EAAI,YAAY,CAAC,EACjBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAKD,EAAQ,SAAU,GAAI,GAAG,EAElCC,EAAI,YAAY,CAAC,EACjBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAK,QAAS,GAAI,GAAG,EAEzBA,EAAI,YAAY,CAAC,EACjBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAKD,EAAQ,SAAU,GAAI,GAAG,EAElCC,EAAI,YAAY,CAAC,EACjBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAK,QAAS,GAAI,GAAG,EAEzBA,EAAI,YAAY,CAAC,EACjBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAKD,EAAQ,SAAU,GAAI,GAAG,EAIlCC,EAAI,YAAY,EAAE,EAClBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAK,OAAQ,GAAI,GAAG,EAExBA,EAAI,YAAY,CAAC,EACjBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAK,iBAAkB,GAAI,GAAG,EAElCA,EAAI,YAAY,CAAC,EACjBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAKD,EAAQ,aAAc,GAAI,GAAG,EAEtCC,EAAI,YAAY,CAAC,EACjBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAK,iBAAkB,GAAI,GAAG,EAElCA,EAAI,YAAY,CAAC,EACjBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAKD,EAAQ,aAAc,GAAI,GAAG,EAItCC,EAAI,YAAY,EAAE,EAClBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAK,kBAAmB,GAAI,GAAG,EAEnCA,EAAI,YAAY,CAAC,EACjBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAK,UAAW,GAAI,GAAG,EAE3BA,EAAI,YAAY,CAAC,EACjBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAKD,EAAQ,OAAQ,GAAI,GAAG,EAEhCC,EAAI,YAAY,CAAC,EACjBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAK,eAAgB,GAAI,GAAG,EAEhCA,EAAI,YAAY,CAAC,EACjBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAKD,EAAQ,SAAU,GAAI,GAAG,EAGlCC,EAAI,YAAY,EAAE,EAClBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAK,UAAW,GAAI,GAAG,EAE3BA,EAAI,YAAY,CAAC,EACjBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAK,UAAW,GAAI,GAAG,EAE3BA,EAAI,YAAY,CAAC,EACjBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAKD,EAAQ,cAAe,GAAI,GAAG,EAEvCC,EAAI,YAAY,CAAC,EACjBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAK,kBAAmB,GAAI,GAAG,EAEnCA,EAAI,YAAY,CAAC,EACjBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAKD,EAAQ,cAAe,GAAI,GAAG,EAEvCC,EAAI,YAAY,CAAC,EACjBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAK,oBAAqB,GAAI,GAAG,EAErCA,EAAI,YAAY,CAAC,EACjBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAKD,EAAQ,gBAAiB,GAAI,GAAG,EAGzCC,EAAI,aAAa,SAAS,EAC1BA,EAAI,QAAQ,YAAa,QAAQ,EACjCA,EAAI,QAAQ,OAAO,EACnB,KAAK,iBAAiBD,EAAQ,YAAa,IAAKC,EAAK,GAAI,GAAG,EAE5DA,EAAI,KAAK,yBAA0B,GAAI,GAAG,EAC1CA,EAAI,QAAQ,YAAa,MAAM,EAG/BA,EAAI,YAAY,EAAE,EAClBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAK,UAAW,IAAK,GAAG,EAG5BA,EAAI,aAAa,SAAS,EAC1BA,EAAI,aAAa,IAAK,IAAK,GAAG,EAC9BA,EAAI,YAAY,IAAK,IAAK,IAAK,IAAK,GAAI,GAAI,IAAI,EAGhDA,EAAI,YAAY,CAAC,EACjBA,EAAI,aAAa,SAAS,EAC1B,KAAK,iBAAiBD,EAAQ,QAAS,IAAKC,EAAK,IAAK,GAAG,EAGzDA,EAAI,aAAa,SAAS,EAC1BA,EAAI,aAAa,IAAK,IAAK,GAAG,EAC9BA,EAAI,YAAY,IAAK,IAAK,IAAK,IAAK,GAAI,GAAI,IAAI,EAGhDA,EAAI,aAAa,SAAS,EAC1BA,EAAI,aAAa,IAAK,IAAK,GAAG,EAC9BA,EAAI,YAAY,IAAK,IAAK,IAAK,GAAI,EAAG,EAAG,IAAI,EAE7CA,EAAI,YAAY,EAAE,EAClBA,EAAI,aAAa,SAAS,EAG1BA,EAAI,KAAK,aAAc,IAAK,GAAG,EAC/BA,EAAI,KAAK,eAAgB,IAAK,GAAG,EACjCA,EAAI,KAAKD,EAAQ,kBAAmB,IAAK,GAAG,EAC5CC,EAAI,KAAKD,EAAQ,YAAa,IAAK,GAAG,EACtCC,EAAI,KAAKD,EAAQ,YAAa,IAAK,GAAG,EACtCC,EAAI,KAAKD,EAAQ,YAAa,IAAK,GAAG,EACtCC,EAAI,KAAKD,EAAQ,uBAAwB,IAAK,GAAG,EAGjDC,EAAI,YAAY,CAAC,EACjBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAK,WAAY,IAAK,GAAG,EAC7BA,EAAI,KAAK,KAAM,IAAK,GAAG,EACvBA,EAAI,KAAK,cAAe,IAAK,GAAG,EAEhCA,EAAI,QAAQ,YAAa,QAAQ,EACjCA,EAAI,QAAQ,YAAY,EACxBA,EAAI,KAAK,IAAK,IAAK,GAAG,EACtBA,EAAI,QAAQ,YAAa,MAAM,EAC/BA,EAAI,KAAK,KAAM,IAAK,GAAG,EAGvBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,aAAa,IAAK,IAAK,GAAG,EAC9BA,EAAI,YAAY,IAAK,IAAK,IAAK,GAAI,EAAG,EAAG,IAAI,EAC7CA,EAAI,YAAY,IAAK,IAAK,IAAK,GAAI,EAAG,EAAG,IAAI,EAG7CA,EAAI,YAAY,EAAE,EAClBA,EAAI,KAAK,WAAY,IAAK,GAAG,EAC7BA,EAAI,KAAK,SAAU,IAAK,GAAG,EAG3BA,EAAI,YAAY,CAAC,EACjBA,EAAI,KAAK,SAAU,IAAK,GAAG,EAC3BA,EAAI,aAAa,SAAS,EAC1BA,EAAI,YAAY,CAAC,EACjBA,EAAI,KAAK,SAAU,IAAK,GAAG,EAC3BA,EAAI,KAAK,MAAO,IAAK,GAAG,EACxBA,EAAI,KAAK,MAAO,IAAK,GAAG,EACxBA,EAAI,KAAK,MAAO,IAAK,GAAG,EAGxBA,EAAI,KAAKD,EAAQ,eAAgB,IAAK,GAAG,EACzCC,EAAI,KAAK,kBAAmB,IAAK,GAAG,EACpCA,EAAI,KAAKD,EAAQ,oBAAqB,IAAK,GAAG,EAG9CC,EAAI,KAAKD,EAAQ,YAAa,IAAK,GAAG,EACtCC,EAAI,KAAKD,EAAQ,YAAa,IAAK,GAAG,EACtCC,EAAI,KAAKD,EAAQ,YAAa,IAAK,GAAG,EAGtCC,EAAI,YAAY,CAAC,EACjBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAK,SAAU,IAAK,GAAG,EAC3BA,EAAI,KAAK,WAAY,IAAK,GAAG,EAC7BA,EAAI,KAAK,KAAM,IAAK,GAAG,EACvBA,EAAI,KAAK,cAAe,IAAK,GAAG,EAEhCA,EAAI,YAAY,CAAC,EACjBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAK,SAAU,IAAK,GAAG,EAC3BA,EAAI,KAAK,MAAO,IAAK,GAAG,EACxBA,EAAI,KAAK,MAAO,IAAK,GAAG,EACxBA,EAAI,KAAK,MAAO,IAAK,GAAG,EAKxBA,EAAI,KAAKD,EAAQ,qBAAsB,IAAK,GAAG,EAC/CC,EAAI,KAAKD,EAAQ,eAAgB,IAAK,GAAG,EACzCC,EAAI,KAAKD,EAAQ,eAAgB,IAAK,GAAG,EAGzCC,EAAI,KAAKD,EAAQ,kBAAmB,IAAK,GAAG,EAC5CC,EAAI,KAAKD,EAAQ,YAAa,IAAK,GAAG,EACtCC,EAAI,KAAKD,EAAQ,YAAa,IAAK,GAAG,EAGtCC,EAAI,KAAKD,EAAQ,kBAAmB,IAAK,GAAG,EAC5CC,EAAI,KAAKD,EAAQ,YAAa,IAAK,GAAG,EACtCC,EAAI,KAAKD,EAAQ,YAAa,IAAK,GAAG,EAGtCC,EAAI,KAAKD,EAAQ,kBAAmB,IAAK,GAAG,EAC5CC,EAAI,KAAKD,EAAQ,YAAa,IAAK,GAAG,EACtCC,EAAI,KAAKD,EAAQ,YAAa,IAAK,GAAG,EAGtCC,EAAI,YAAY,IAAK,IAAK,IAAK,MAAO,EAAG,EAAG,IAAI,EAChDA,EAAI,YAAY,IAAK,IAAK,IAAK,MAAO,EAAG,EAAG,IAAI,EAGhDA,EAAI,YAAY,EAAE,EAClBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAK,uBAAwB,IAAK,GAAG,EAGzCA,EAAI,KAAK,cAAe,IAAK,GAAG,EAGhCA,EAAI,YAAY,CAAC,EACjBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAK,WAAY,IAAK,GAAG,EAC7BA,EAAI,KAAK,SAAU,IAAK,GAAG,EAC3BA,EAAI,KAAK,cAAe,IAAK,GAAG,EAChCA,EAAI,KAAK,UAAW,IAAK,GAAG,EAC5BA,EAAI,KAAK,OAAQ,IAAK,GAAG,EACzBA,EAAI,KAAK,WAAY,IAAK,GAAG,EAG7BA,EAAI,aAAa,SAAS,EAC1BA,EAAI,aAAa,IAAK,IAAK,GAAG,EAC9BA,EAAI,YAAY,IAAK,IAAK,GAAI,GAAI,EAAG,EAAG,IAAI,EAC5CA,EAAI,YAAY,CAAC,EACjBA,EAAI,aAAa,SAAS,EAC1BA,EAAI,KAAK,iBAAkB,IAAK,KAAK,EACrCA,EAAI,KAAKD,EAAQ,YAAa,IAAK,KAAK,EAIxCC,EAAI,SAASD,EAAQ,YAAa,MAAO,IAAK,IAAK,IAAK,KAAK,EAC7DC,EAAI,SAASD,EAAQ,cAAe,MAAO,IAAK,IAAK,IAAK,KAAK,EAC/DC,EAAI,SAASD,EAAQ,mBAAoB,MAAO,IAAK,IAAK,IAAK,KAAK,EACpEC,EAAI,SAASD,EAAQ,eAAgB,MAAO,IAAK,IAAK,IAAK,EAAE,EAU7D,MAAMG,EAAQ,IAAI,KAAM,EAAC,mBAAmB,OAAO,EAEnDF,EAAI,KAAK,iBAAiBD,EAAQ,eAAeG,OAAW,CAG7D,EACD,iBAAiBC,EAAaC,EAAWJ,EAAKpF,EAAWyF,EAAU,CAEjE,SAASC,EAAax/C,EAAM,CAC1B,MAAMg/C,EAAU,SAAS,cAAc,MAAM,EAC7CA,EAAQ,MAAM,KAAO,aACrBA,EAAQ,MAAM,SAAW,WACzBA,EAAQ,MAAM,WAAa,SAC3BA,EAAQ,YAAch/C,EACtB,SAAS,KAAK,YAAYg/C,CAAO,EACjC,KAAM,CAAE,MAAA//D,GAAU+/D,EAAQ,sBAAqB,EAC/C,gBAAS,KAAK,YAAYA,CAAO,EAC1B//D,CACT,CAGA,IAAIwgE,EAAYJ,EAAY,KAAM,EAAC,MAAM,WAAe,gBAAA,GACxDI,EAAYA,EAAU,IAAKC,GAAWA,EAAO,QAAQ,MAAO,EAAE,CAAC,EAE/D,SAASC,EAAcC,EAAU3gE,EAAO,CACtC,MAAM89D,EAAQ6C,EAAS,MAAM,GAAG,EAC1BC,EAAS,CAAA,EACf,IAAIC,EAAe/C,EAAM,CAAC,EAE1B,QAAS7jE,EAAI,EAAGA,EAAI6jE,EAAM,OAAQ7jE,IAAK,CACrC,MAAM6mE,EAAY,GAAGD,KAAgB/C,EAAM7jE,CAAC,IAC1BsmE,EAAaO,CAAS,GAEvB9gE,EACf6gE,EAAeC,GAEfF,EAAO,KAAKC,CAAY,EACxBA,EAAe/C,EAAM7jE,CAAC,GAI1B,OAAA2mE,EAAO,KAAKC,CAAY,EACjBD,CACT,CAEA,IAAIG,EAAW,EACXx7D,EAAI+6D,EAGRE,EAAU,QAASG,GAAa,CAC1BJ,EAAaI,CAAQ,EAAIN,EACJK,EAAcC,EAAUN,CAAS,EAEzC,QAAShmE,GAAU,CAC5B0mE,EAAW,IACbx7D,GAAK,IAEP06D,EAAI,KAAK5lE,EAAOwgE,EAAWt1D,CAAC,EAC5Bw7D,GACF,CAAC,GAEGA,EAAW,IACbx7D,GAAK,IAEP06D,EAAI,KAAKU,EAAU9F,EAAWt1D,CAAC,EAC/Bw7D,IAEJ,CAAC,CACF,CACF,EACD,MAAO,CACL,iBAAkB,CAChB,SAAU,CACR,OAAO,aAAa,QAClB,eACA,KAAK,UAAU,KAAK,gBAAgB,EAEvC,EACD,KAAM,EACP,EACD,UAAW,CACJ,KAAK,UACR,KAAK,UAAS,CAEjB,CACF,CACH,4CAzqCOj0D,GAAA,CAAA,MAAM,YAAY,MAChB,GAAG,iBAAiB,MAAM,kBACxBI,GAAA,CAAA,MAAM,MAAM,EAeVkB,GAAA,CAAA,IAAI,YAAY,EAQlBjB,GAAA,CAAA,MAAM,MAAM,EACfC,GAAAL,EAAA,IAAAC,EAAgB,UAAZ,UAAO,EAAA,CAAA,MAkBR,MAAM,OAAO,MAAA,CAAsC,gBAAA,iBAAA,OACjD,GAAG,SAAS,MAAA,CAA+B,QAAA,OAAA,IAAA,KAAA,GAC9CK,GAAAN,EAAA,IAAAC,EAAgB,UAAZ,UAAO,EAAA,CAAA,EA6CVgiD,GAAA,CAAA,MAAM,OAAO,EACXe,GAAA,CAAA,MAAM,aAAa,EACjB2F,GAAA,CAAA,MAAM,MAAM,EACfE,GAAA7oD,EAAA,IAAAC,EAAwC,KAApC,CAAA,MAAA,CAAA,gBAAA,KAAA,GAA2B,OAAI,EAAA,CAAA,EACnCwoD,GAAAzoD,EAAA,IAAAC,EAAyC,KAArC,CAAA,MAAA,CAAA,OAAA,MAAA,GAAqB,cAAW,EAAA,CAAA,EASpCyoD,GAAA1oD,EAAA,IAAAC,EAAuC,KAAnC,CAAA,MAAA,CAAA,OAAA,MAAA,GAAqB,YAAS,EAAA,CAAA,EASlCwxD,GAAAzxD,EAAA,IAAAC,EAAmC,KAA/B,CAAA,MAAA,CAAA,OAAA,MAAA,GAAqB,QAAK,EAAA,CAAA,EAS9Bg0D,GAAAj0D,EAAA,IAAAC,EAAmC,KAA/B,CAAA,MAAA,CAAA,OAAA,MAAA,GAAqB,QAAK,EAAA,CAAA,EAS3Bi0D,GAAA,CAAA,MAAM,MAAM,EACfC,GAAAn0D,EAAA,IAAAC,EAAwC,KAApC,CAAA,MAAA,CAAA,gBAAA,KAAA,GAA2B,OAAI,EAAA,CAAA,EACnCm0D,GAAAp0D,EAAA,IAAAC,EAAuB,UAAnB,iBAAc,EAAA,CAAA,EAQlBo0D,GAAAr0D,EAAA,IAAAC,EAAuB,UAAnB,iBAAc,EAAA,CAAA,EAmBfq0D,GAAA,CAAA,MAAM,cAAc,EACvBC,GAAAv0D,EAAA,IAAAC,EAAoD,KAAhD,CAAA,MAAA,CAAA,gBAAA,MAAA,GAA4B,kBAAe,EAAA,CAAA,EAE/Cu0D,GAAAx0D,EAAA,IAAAC,EAAqC,KAAjC,CAAA,MAAA,CAAA,OAAA,MAAA,GAAqB,UAAO,EAAA,CAAA,EAShCw0D,GAAAz0D,EAAA,IAAAC,EAA0C,KAAtC,CAAA,MAAA,CAAA,OAAA,MAAA,GAAqB,eAAY,EAAA,CAAA,EASlCy0D,GAAA,CAAA,MAAM,SAAS,EAClBC,GAAA30D,EAAA,IAAAC,EAA4C,KAAxC,CAAA,MAAA,CAAA,gBAAA,MAAA,GAA4B,UAAO,EAAA,CAAA,EACvC20D,GAAA50D,EAAA,IAAAC,EAAqC,KAAjC,CAAA,MAAA,CAAA,OAAA,MAAA,GAAqB,UAAO,EAAA,CAAA,EAShC40D,GAAA70D,EAAA,IAAAC,EAA6C,KAAzC,CAAA,MAAA,CAAA,OAAA,MAAA,GAAqB,kBAAe,EAAA,CAAA,EASxC60D,GAAA90D,EAAA,IAAAC,EAA+C,KAA3C,CAAA,MAAA,CAAA,OAAA,MAAA,GAAqB,oBAAiB,EAAA,CAAA,EAUvC80D,GAAA,CAAA,MAAM,SAAS,WAwBpB90D,EAIM,MAAA,KAAA,CAHJA,EAEK,KAFD,CAAA,MAAA,CAAA,MAAA,QAAA,aAAA,QAAA,GAAyC,0BAE7C,QAIC+0D,GAAA,CAAA,MAAM,cAAc,EAClBC,GAAA,CAAA,MAAM,SAAS,EAClBC,GAAAl1D,EAAA,IAAAC,EAAqC,KAAjC,CAAA,MAAA,CAAA,OAAA,MAAA,GAAqB,UAAO,EAAA,CAAA,EAuB7Bk1D,GAAA,CAAA,MAAM,iBAAiB,EACrBC,GAAA,CAAA,MAAM,UAAU,WACnBn1D,EAKM,MAAA,CALD,MAAM,UAAQ,CACjBA,EAAM,IAAA,EAENA,EAAwC,KAApC,CAAA,MAAA,CAAA,MAAA,OAAA,GAAqB,YAAU,EACnCA,EAA0C,KAAtC,CAAA,MAAA,CAAA,MAAA,OAAA,GAAqB,cAAY,QAGlCo1D,GAAA,CAAA,MAAM,cAAc,EACvBC,GAAAt1D,EAAA,IAAAC,EAAwC,KAApC,CAAA,MAAA,CAAA,MAAA,SAAA,GAAuB,WAAQ,EAAA,CAAA,EAUhCs1D,GAAA,CAAA,MAAM,eAAe,EACxBC,GAAAx1D,EAAA,IAAAC,EAAkC,KAA9B,CAAA,MAAA,CAAA,MAAA,SAAA,GAAuB,KAAE,EAAA,CAAA,EAU1Bw1D,GAAA,CAAA,MAAM,QAAQ,EACjBC,GAAA11D,EAAA,IAAAC,EAAwD,KAApD,CAAA,MAAA,CAAA,MAAA,UAAA,MAAA,MAAA,CAAmC,EAAC,cAAW,EAAA,CAAA,EAUhD01D,GAAA,CAAA,MAAM,cAAc,EACvBC,GAAA51D,EAAA,IAAAC,EAA0C,KAAtC,CAAA,MAAA,CAAA,MAAA,SAAA,GAAuB,OAAU,EAAA,CAAA,EAkBpC41D,GAAA,CAAA,MAAM,iBAAiB,EACrBC,GAAA,CAAA,MAAM,KAAK,EACdC,GAAA/1D,EAAA,IAAAC,EAAiB,UAAb,WAAQ,EAAA,CAAA,EACP+1D,GAAA,CAAA,MAAM,MAAM,MAEb,MAAM,YACN,MAAA,CAA6C,eAAA,OAAA,cAAA,MAAA,GAE7CC,GAAAj2D,EAAA,IAAAC,EAEK,KAFD,CAAA,MAAA,CAAA,gBAAA,OAAA,eAAA,KAAA,CAA8C,EAAC,WAEnD,EAAA,CAAA,EACKi2D,GAAA,CAAA,MAAA,CAAyC,QAAA,OAAA,SAAA,UAAA,CAAA,EAYvCC,GAAA,CAAA,MAAA,CAAoD,SAAA,WAAA,KAAA,OAAA,MAAA,OAAA,CAAA,EACnDC,GAAA,CAAA,MAAA,CAAyB,cAAA,MAAA,CAAA,MAuDlC,MAAM,MAAM,MAAA,CAAuB,cAAA,IAAA,GACtCC,GAAAr2D,EAAA,IAAAC,EAAe,UAAX,SAAM,EAAA,CAAA,EACLq2D,GAAA,CAAA,MAAM,MAAM,EACVC,GAAA,CAAA,MAAM,cAAc,WACvBt2D,EAMM,MAAA,CAND,MAAM,qBAAmB,CAC5BA,EAAe,UAAX,QAAM,EACVA,EAAe,UAAX,QAAM,EACVA,EAAY,UAAR,KAAG,EACPA,EAAY,UAAR,KAAG,EACPA,EAAY,UAAR,KAAG,QAGJu2D,GAAA,CAAA,MAAM,mBAAmB,EAC5BC,GAAAz2D,EAAA,IAAAC,EAAiB,UAAb,WAAQ,EAAA,CAAA,EA6BTy2D,GAAA,CAAA,MAAM,mBAAmB,EAC5BC,GAAA32D,EAAA,IAAAC,EAAoC,KAAhC,CAAA,MAAA,CAAA,eAAA,IAAA,GAAyB,KAAE,EAAA,CAAA,EA6B5B22D,GAAA,CAAA,MAAM,mBAAmB,EAC5BC,GAAA72D,EAAA,IAAAC,EAAoB,UAAhB,cAAW,EAAA,CAAA,EAsCpB62D,GAAA,CAAA,MAAM,iBAAiB,EAExBC,GAAA,CAAA,MAAA,CAKC,QAAA,OAAA,iBAAA,SAAA,cAAA,SAAA,MAAA,OAAA,CAAA,EAEDC,GAAAh3D,EAAA,IAAAC,EAAkD,KAA9C,CAAA,MAAA,CAAA,MAAA,OAAA,GAAqB,uBAAoB,EAAA,CAAA,EAW1Cg3D,GAAA,CAAA,MAAM,YAAY,EACrBC,GAAAl3D,EAAA,IAAAC,EAAyC,KAArC,CAAA,MAAA,CAAA,MAAA,OAAA,GAAqB,cAAW,EAAA,CAAA,MAE/B,MAAM,gBAAgB,IAAI,mBA4B3Bk3D,GAAA,CAAA,MAAA,CAOC,eAAA,OAAA,mBAAA,YAAA,MAAA,OAAA,QAAA,MAAA,eAAA,MAAA,gBAAA,MAAA,CAAA,WAWLl3D,EAOM,MAAA,CAPD,MAAM,YAAU,CACnBA,EAAiB,UAAb,UAAQ,EACZA,EAA0B,UAAtB,mBAAiB,EACrBA,EAGK,KAAA,KAAA,GAHD,eACU,EAAAA,EAAM,IAAA,IAAA,YAEpB,6LAjlBhB,OAAAc,EAAA,EAAAR,EAylBM,MAzlBNR,GAylBM,CAxlBJE,EAulBM,MAvlBNC,GAulBM,CAtlBJD,EAqBM,MArBNE,GAqBM,CApBJyB,EAaEw1D,EAAA,CAZA,GAAG,cACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,YAC5B,cAAaG,EAAkB,mBAChC,MAAA,CAOC,MAAA,QAAA,MAAA,UAAA,cAAA,OAAA,YAAA,OAAA,OAAA,OAAA,QAAA,IAAA,oDAEHV,EAKM,MALNoB,GAKM,CAJJO,EAGEy1D,EAAA,CAFC,SAAUr2D,EAAQ,SAClB,eAAcL,EAAgB,gEAKrCV,EAiBM,MAjBNG,GAiBM,CAhBJC,GAEAuB,EAaEw1D,EAAA,CAZA,GAAG,cACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,YAC5B,cAAaG,EAAkB,mBAChC,MAAA,CAOC,MAAA,QAAA,MAAA,UAAA,cAAA,MAAA,YAAA,OAAA,OAAA,OAAA,QAAA,IAAA,sDAILV,EA6CM,MA7CN+hD,GA6CM,CA5CJ/hD,EAQM,MARNa,GAQM,CAPJR,GACAsB,EAKE01D,EAAA,CAJC,SAAUt2D,EAAQ,SACnB,GAAG,gBACF,QAASR,EAAa,cACtB,iBAAiBG,EAAgB,sEAGtCV,EAUM,MAAA,KAAA,CATJA,EAQK,KAAA,KAAA,GARD,QAEF,EAAA2B,EAKEw1D,EAAA,CAJA,GAAG,aACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,WAC5B,cAAaG,EAAkB,yEAItCV,EAWM,MAAA,KAAA,CAVJA,EASK,KAAA,KAAA,GATD,QAEF,EAAA2B,EAMEw1D,EAAA,CALA,GAAG,aACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,WAC5B,cAAaG,EAAkB,mBAChC,MAAA,CAAoB,MAAA,OAAA,wDAI1BV,EAWM,MAAA,KAAA,CAVJA,EASK,KAAA,KAAA,GATD,eAEF,EAAA2B,EAMEw1D,EAAA,CALA,GAAG,YACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,UAC5B,cAAaG,EAAkB,mBAChC,MAAA,CAAoB,MAAA,OAAA,0DAM5BV,EA4fM,MA5fNgiD,GA4fM,CA3fJhiD,EAoJM,MApJN+iD,GAoJM,CAnJJ/iD,EAqCM,MArCN0oD,GAqCM,CApCJE,GACAJ,GACA7mD,EAMEw1D,EAAA,CALA,GAAG,YACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,UAC5B,cAAaG,EAAkB,mBAChC,MAAA,CAAuC,MAAA,QAAA,eAAA,KAAA,oDAGzC+nD,GACA9mD,EAMEw1D,EAAA,CALA,GAAG,WACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,SAC5B,cAAaG,EAAkB,mBAChC,MAAA,CAAuC,MAAA,QAAA,eAAA,KAAA,oDAGzC8wD,GACA7vD,EAMEw1D,EAAA,CALA,GAAG,WACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,SAC5B,cAAaG,EAAkB,mBAChC,MAAA,CAAuC,MAAA,QAAA,eAAA,KAAA,oDAGzCszD,GACAryD,EAMEw1D,EAAA,CALA,GAAG,WACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,SAC5B,cAAaG,EAAkB,mBAChC,MAAA,CAAuC,MAAA,QAAA,eAAA,KAAA,sDAG3CV,EA4BM,MA5BNi0D,GA4BM,CA3BJC,GACAC,GACAxyD,EAKE01D,EAAA,CAJA,GAAG,eACF,SAAUt2D,EAAQ,SAClB,QAASR,EAAmB,oBAC5B,iBAAiBG,EAAgB,oEAGpC0zD,GACAzyD,EAKE01D,EAAA,CAJA,GAAG,eACF,SAAUt2D,EAAQ,SAClB,QAASR,EAAmB,oBAC5B,iBAAiBG,EAAgB,sEActCV,EAoBM,MApBNq0D,GAoBM,CAnBJC,GAEAC,GACA5yD,EAMEw1D,EAAA,CALA,GAAG,SACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,OAC5B,cAAaG,EAAkB,mBAChC,MAAA,CAAuC,MAAA,QAAA,eAAA,KAAA,oDAGzC8zD,GACA7yD,EAMEw1D,EAAA,CALA,GAAG,WACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,SAC5B,cAAaG,EAAkB,mBAChC,MAAA,CAAuC,MAAA,QAAA,eAAA,KAAA,sDAG3CV,EA4BM,MA5BNy0D,GA4BM,CA3BJC,GACAC,GACAhzD,EAMEw1D,EAAA,CALA,GAAG,gBACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,cAC5B,cAAaG,EAAkB,mBAChC,MAAA,CAAuC,MAAA,QAAA,eAAA,KAAA,oDAGzCk0D,GACAjzD,EAMEw1D,EAAA,CALA,GAAG,gBACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,cAC5B,cAAaG,EAAkB,mBAChC,MAAA,CAAuC,MAAA,QAAA,eAAA,KAAA,oDAGzCm0D,GACAlzD,EAMEw1D,EAAA,CALA,GAAG,kBACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,gBAC5B,cAAaG,EAAkB,mBAChC,MAAA,CAAuC,MAAA,QAAA,eAAA,KAAA,sDAI3CV,EAsBM,MAtBN80D,GAsBM,CArBJnzD,EAYE21D,EAAA,CAXA,GAAG,cACF,SAAUv2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,YAC5B,cAAaG,EAAkB,mBAChC,MAAA,CAMC,MAAA,QAAA,OAAA,QAAA,QAAA,MAAA,cAAA,MAAA,aAAA,QAAA,sDAYL62D,KAOFv3D,EAoWM,MApWN+0D,GAoWM,CAnWJ/0D,EAsBM,MAtBNg1D,GAsBM,CArBJC,GACAtzD,EAcE21D,EAAA,CAbA,GAAG,UACF,SAAUv2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,QAC7B,YAAY,uBACX,cAAaG,EAAkB,mBAChC,MAAA,CAOC,MAAA,OAAA,QAAA,YAAA,OAAA,QAAA,YAAA,OAAA,MAAA,QAAA,mBAAA,SAAA,sDASLV,EA0UM,MA1UNk1D,GA0UM,CAzUJl1D,EA0DM,MA1DNm1D,GA0DM,CAzDJqC,GAOAx3D,EASM,MATNo1D,GASM,CARJC,GACA1zD,EAMEw1D,EAAA,CALA,GAAG,oBACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,kBAC5B,cAAaG,EAAkB,mBAChC,MAAA,CAAuD,MAAA,OAAA,eAAA,MAAA,YAAA,MAAA,sDAI3DV,EASM,MATNs1D,GASM,CARJC,GACA5zD,EAMEw1D,EAAA,CALA,GAAG,cACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,YAC5B,cAAaG,EAAkB,mBAChC,MAAA,CAAuD,MAAA,OAAA,eAAA,MAAA,YAAA,MAAA,sDAI3DV,EASM,MATNw1D,GASM,CARJC,GACA9zD,EAMEw1D,EAAA,CALA,GAAG,cACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,YAC5B,cAAaG,EAAkB,mBAChC,MAAA,CAAuD,MAAA,OAAA,eAAA,MAAA,YAAA,MAAA,sDAI3DV,EAgBM,MAhBN01D,GAgBM,CAfJC,GACAh0D,EAMEw1D,EAAA,CALA,GAAG,cACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,YAC5B,cAAaG,EAAkB,mBAChC,MAAA,CAAuD,MAAA,OAAA,eAAA,MAAA,YAAA,MAAA,oDAEzDiB,EAMEw1D,EAAA,CALA,GAAG,yBACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,uBAC5B,cAAaG,EAAkB,mBAChC,MAAA,CAAuD,MAAA,OAAA,eAAA,MAAA,YAAA,MAAA,wDAK7DV,EA6LM,MA7LN41D,GA6LM,CA5LJ51D,EA4EM,MA5EN61D,GA4EM,CA3EJC,GACA91D,EAkEM,MAlEN+1D,GAkEM,CAjEJ/1D,EAgEM,MAhENy3D,GAgEM,CA5DJzB,GAGAh2D,EAuBM,MAvBNi2D,GAuBM,CAtBJj2D,EASK,KAAA,KAAA,GATD,UAEF,EAAA2B,EAMEw1D,EAAA,CALA,GAAG,iBACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,eAC5B,cAAaG,EAAkB,mBAChC,MAAA,CAA2C,cAAA,OAAA,eAAA,IAAA,sDAI/CV,EAUM,MAVNk2D,GAUM,CATJl2D,EAQK,KARLm2D,GAQK,GARyB,kBAE5B,EAAAx0D,EAKEw1D,EAAA,CAJA,GAAG,sBACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,oBAC5B,cAAaG,EAAkB,2EAMxCV,EASK,KAAA,KAAA,GATD,OAEF,EAAA2B,EAMEw1D,EAAA,CALA,GAAG,cACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,YAC5B,cAAaG,EAAkB,mBAChC,MAAA,CAA2B,cAAA,QAAA,sDAI/BV,EASK,KAAA,KAAA,GATD,OAEF,EAAA2B,EAMEw1D,EAAA,CALA,GAAG,cACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,YAC5B,cAAaG,EAAkB,mBAChC,MAAA,CAA2B,cAAA,QAAA,sDAI/BV,EASK,KAAA,KAAA,GATD,OAEF,EAAA2B,EAMEw1D,EAAA,CALA,GAAG,cACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,YAC5B,cAAaG,EAAkB,mBAChC,MAAA,CAAyB,cAAA,MAAA,0DAKjCiB,EAME+1D,EAAA,CALA,GAAG,gBACH,IAAI,gBACH,SAAU32D,EAAQ,SAClB,UAAS,mBACT,qBAAoBL,EAAqB,+EAI9CV,EA6GM,MA7GN23D,GA6GM,CA5GJvB,GACAp2D,EAoGM,MApGNq2D,GAoGM,CAnGJr2D,EAkGM,MAlGNs2D,GAkGM,CAjGJsB,GAQA53D,EA4BM,MA5BNu2D,GA4BM,CA3BJC,GAEA70D,EAKEw1D,EAAA,CAJA,GAAG,uBACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,qBAC5B,cAAaG,EAAkB,qEAElCiB,EAKEw1D,EAAA,CAJA,GAAG,oBACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,kBAC5B,cAAaG,EAAkB,qEAElCiB,EAKEw1D,EAAA,CAJA,GAAG,oBACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,kBAC5B,cAAaG,EAAkB,qEAGlCiB,EAKEw1D,EAAA,CAJA,GAAG,oBACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,kBAC5B,cAAaG,EAAkB,uEAIpCV,EA4BM,MA5BNy2D,GA4BM,CA3BJC,GAEA/0D,EAKEw1D,EAAA,CAJA,GAAG,iBACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,eAC5B,cAAaG,EAAkB,qEAElCiB,EAKEw1D,EAAA,CAJA,GAAG,cACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,YAC5B,cAAaG,EAAkB,qEAElCiB,EAKEw1D,EAAA,CAJA,GAAG,cACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,YAC5B,cAAaG,EAAkB,qEAGlCiB,EAKEw1D,EAAA,CAJA,GAAG,cACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,YAC5B,cAAaG,EAAkB,uEAIpCV,EA4BM,MA5BN22D,GA4BM,CA3BJC,GAEAj1D,EAKEw1D,EAAA,CAJA,GAAG,iBACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,eAC5B,cAAaG,EAAkB,qEAElCiB,EAKEw1D,EAAA,CAJA,GAAG,cACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,YAC5B,cAAaG,EAAkB,qEAElCiB,EAKEw1D,EAAA,CAJA,GAAG,cACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,YAC5B,cAAaG,EAAkB,qEAGlCiB,EAKEw1D,EAAA,CAJA,GAAG,cACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,YAC5B,cAAaG,EAAkB,2EAKxCiB,EAKE+1D,EAAA,CAJA,GAAG,cACH,IAAI,cACH,SAAU32D,EAAQ,SAClB,qBAAoBL,EAAqB,uEAIhDV,EA8EM,MA9EN62D,GA8EM,CA7EJ72D,EAkBM,MAlBN82D,GAkBM,CAVJC,GACAp1D,EAQE+1D,EAAA,CAPA,GAAG,qBACH,IAAI,qBACH,SAAU32D,EAAQ,SAClB,MAAO,IACP,OAAQ,IACT,WAAW,gBACV,qBAAoBL,EAAqB,qEAG9CV,EAyDM,MAzDNg3D,GAyDM,CAxDJC,GAEAj3D,EAyBM,MAzBN63D,GAyBM,CAxBJl2D,EAOEm2D,EAAA,CANA,GAAG,oBACF,OAAM,CAA0Bv3D,EAAA,iBAAiB,kBAAyCA,EAAA,iBAAiB,kBAAyCA,EAAA,iBAAiB,uCAMxKoB,EAOEm2D,EAAA,CANA,GAAG,cACF,OAAM,CAA0Bv3D,EAAA,iBAAiB,YAAmCA,EAAA,iBAAiB,YAAmCA,EAAA,iBAAiB,iCAM5JoB,EAOEm2D,EAAA,CANA,GAAG,cACF,OAAM,CAA0Bv3D,EAAA,iBAAiB,YAAmCA,EAAA,iBAAiB,YAAmCA,EAAA,iBAAiB,uCAO9JP,EAmBM,MAAA,KAAA,CAlBJA,EAiBI,IAjBJk3D,GAiBI,GARH,iBAEC,EAAAv1D,EAKEw1D,EAAA,CAJA,GAAG,cACF,SAAUp2D,EAAQ,SAClB,UAAWR,EAAgB,iBAAC,YAC5B,cAAaG,EAAkB,yEAItCq3D,gFC7iBhB,MAAKv4D,GAAU,CACb,WAAY,CACV,OAAAw4D,EACD,EACD,QAAS,CACP,aAAc,CACZ,KAAK,MAAM,eAAe,UAC3B,EACD,YAAa,CACX,KAAK,KAAO,CAAC,KAAK,IACnB,EACD,YAAa,CACP,KAAK,MAEP,KAAK,UAAY,GACjB,WAAW,IAAM,CACf,KAAK,UAAY,EAClB,EAAE,GAAI,GAEP,KAAK,MAAM,eAAe,gBAE7B,CACF,EACD,MAAO,CACL,MAAO,CACL,KAAM,GACN,UAAW,GAEd,CACH,6CA3DOl4D,GAAA,CAAA,MAAM,qBAAqB,EACzBG,GAAA,CAAA,MAAM,YAAY,EAQlBC,GAAA,CAAA,MAAM,SAAS,EAEhBkB,GAAArB,GAAA,IAAAC,EAAa,UAAT,OAAI,EAAA,CAAA,MAARoB,cAEFpB,EAA4C,SAAA,CAApC,MAAM,QAAM,CAACA,EAAc,UAAV,OAAK,QAE5B+hD,GAAAhiD,GAAA,IAAAC,EAAc,UAAV,QAAK,EAAA,CAAA,MAAT+hD,IAEG1hD,GAAA,CAAA,MAAA,CAA0B,SAAA,UAAA,CAAA,EACY2hD,GAAAjiD,GAAA,IAAAC,EAAa,UAAT,OAAI,EAAA,CAAA,MAARgiD,IAEvC0G,GAAA3oD,GAAA,IAAAC,EAAmC,UAA/B,6BAA0B,EAAA,CAAA,MAA9B0oD,iDApBR,OAAA5nD,EAAA,EAAAR,EAwBM,MAxBNR,GAwBM,CAvBJE,EAMM,MANNC,GAMM,CADJ0B,EAAgDs2D,EAAA,CAAxC,IAAI,iBAAkB,SAAU13D,EAAI,6BAG9CP,EAcM,MAdNE,GAcM,CAbJF,EAES,SAAA,CAFD,MAAKQ,EAAA,CAAC,OAAM,CAAA,QAAwCD,EAAI,IAAA,CAAA,CAAA,EAA1C,4BAAOG,EAAU,YAAAA,EAAA,WAAA,GAAAnW,CAAA,UAGvC6V,GACAJ,EAES,SAAA,CAFD,MAAM,OAAQ,4BAAOU,EAAW,aAAAA,EAAA,YAAA,GAAAnW,CAAA,QAGxCyV,EAKM,MALNK,GAKM,CAJJL,EAA+D,SAAA,CAAvD,MAAM,OAAQ,4BAAOU,EAAU,YAAAA,EAAA,WAAA,GAAAnW,CAAA,QACvCyV,EAEM,MAAA,CAFD,MAAKQ,EAAA,CAAC,QAAO,CAAA,KAAiBD,EAAS,SAAA,CAAA,CAAA,8ECbpD,MAAKf,GAAU,CACb,MAAO,CACL,YAAa,CACX,KAAM,KACP,CACF,EAED,MAAO,CACL,YAAa,CACX,KAAM,GACN,SAAU,CAIR,KAAK,UAAS,CAEf,CACF,CACF,EAED,MAAO,CACL,MAAO,CACL,SAAU,WAGV,KAAM,EACN,KAAM,EACN,KAAM,GACN,KAAM,EACN,cAAe,EACf,cAAe,IACf,MAAO,wBAGP,QAAS,GACT,SAAU,GACV,UAAW,QACX,YAAa,EACb,KAAM,aACN,WAAY,GACZ,OAAQ,KACR,OAAQ,KACR,UAAW,KACX,UAAW,KACX,EAAG,KACH,EAAG,KACH,MAAO,KACP,OAAQ,KACR,OAAQ,KACR,OAAQ,KAER,QAAS,KACT,KAAM,KAET,EAED,QAAS,CACP,YAAY04D,EAAUC,EAAW,CAC/B,MAAMzqD,EAAUwqD,EAChBxqD,EAAQ,KAAI,EACZA,EAAQ,UAAU,KAAK,EAAG,KAAK,EAAI,KAAK,MAAM,EAE9CA,EAAQ,KAAO,aACfA,EAAQ,UAAY,QAEpBA,EAAQ,SACN,UACA,EAAI,KAAK,OACT,GAAK,KAAK,OAAS,KAAK,UAK1B,MAAM0qD,EAAM1qD,EAAQ,qBAClByqD,EAAY,KAAK,OACjB,EACA,KAAK,KAAO,KAAK,OAAS,GAC1B,GAEFC,EAAI,aAAa,EAAG,0BAA0B,EAC9CA,EAAI,aAAa,EAAG,WAAW,EAG/B1qD,EAAQ,UAAY0qD,EACpB1qD,EAAQ,SACNyqD,EAAY,KAAK,OACjB,EACA,KAAK,KAAO,KAAK,OACjB,GAAK,KAAK,OAAS,EAAI,KAAK,UAE9BzqD,EAAQ,YAAc,QACtBA,EAAQ,UAAY,EACpBA,EAAQ,UAAS,EACjBA,EAAQ,OAAOyqD,EAAY,KAAK,OAAQ,CAAC,EACzCzqD,EAAQ,OACNyqD,EAAY,KAAK,OACjB,GAAK,KAAK,OAAS,EAAI,KAAK,UAE9BzqD,EAAQ,OAAM,EAEdA,EAAQ,UAAY,QAEpBA,EAAQ,SACN,WACAyqD,EAAY,KAAK,OAAS,EAC1B,GAAK,KAAK,OAAS,KAAK,UAE1BzqD,EAAQ,QAAO,CAChB,EAED,qBAAqBwqD,EAAU,CAC7B,IAAIG,EAAoB,EACxB,MAAM3qD,EAAUwqD,EAChBxqD,EAAQ,KAAO,KAAK,KAEpB,QAASk0C,EAAI,EAAGA,GAAK,KAAK,UAAWA,IAAK,CACxC,MAAMnzD,EAAQ,KAAK,KAAOmzD,EAAI,KAAK,cACnCyW,EAAoB,KAAK,IACvBA,EACA3qD,EAAQ,YAAYjf,CAAK,EAAE,OAG/B,OAAO4pE,CACR,EAED,UAAUH,EAAU,CAClB,MAAMxqD,EAAUwqD,EAChBxqD,EAAQ,KAAI,EACZA,EAAQ,UAAS,EACjBA,EAAQ,OAAO,KAAK,EAAG,KAAK,EAAI,KAAK,MAAM,EAE3CA,EAAQ,YAAc,KAAK,UAC3BA,EAAQ,UAAY,EACpBA,EAAQ,OAAM,EAiBdA,EAAQ,KAAO,KAAK,KACpBA,EAAQ,UAAY,QACpBA,EAAQ,UAAY,SACpBA,EAAQ,aAAe,SAGvB,QAAS,EAAI,GAAI,EAAI,KAAK,UAAW,IAAK,CACxC,MAAMrX,EAAQ,KAAK,OAAQ,EAAI,GAAK,KAAK,KAAQ,KAAK,SAAS,EAC/DqX,EAAQ,KAAI,EACZA,EAAQ,WACJ,EAAI,GAAK,KAAK,MAAS,KAAK,UAAY,KAAK,EAC/C,KAAK,EAAI,KAAK,OAAS,KAAK,SAE9BA,EAAQ,SAASrX,EAAO,EAAG,CAAC,EAC5BqX,EAAQ,QAAO,EAEjBA,EAAQ,QAAO,CAChB,EAED,UAAUwqD,EAAU,CAClB,MAAMxqD,EAAUwqD,EAChBxqD,EAAQ,KAAI,EACZA,EAAQ,KAAI,EACZA,EAAQ,UAAS,EACjBA,EAAQ,OAAO,KAAK,EAAG,KAAK,CAAC,EAE7BA,EAAQ,YAAc,KAAK,UAE3BA,EAAQ,OAAM,EACdA,EAAQ,QAAO,EAGfA,EAAQ,KAAO,KAAK,KACpBA,EAAQ,UAAY,QACpBA,EAAQ,UAAY,QACpBA,EAAQ,aAAe,SAEvB,QAAS,EAAI,EAAG,GAAK,KAAK,UAAW,IAAK,CACxC,MAAMjf,EAAQ,KAAK,KAAQ,EAAI,KAAK,KAAQ,KAAK,UACjDif,EAAQ,KAAI,EACZA,EAAQ,UACN,KAAK,EAAI,KAAK,QAAU,EACvB,EAAI,KAAK,OAAU,KAAK,UAAY,KAAK,GAE5CA,EAAQ,SAASjf,EAAO,EAAG,CAAC,EAC5Bif,EAAQ,QAAO,EAEjBA,EAAQ,QAAO,CAChB,EAED,SAASwqD,EAAU1mE,EAAMb,EAAOqC,EAAO,CACrC,MAAM0a,EAAUwqD,EAChBxqD,EAAQ,KAAI,EACZ,KAAK,iBAAiBA,CAAO,EAC7BA,EAAQ,UAAY1a,EACpB0a,EAAQ,YAAc/c,EACtB+c,EAAQ,UAAY/c,EACpB+c,EAAQ,WAAa,GACrBA,EAAQ,YAAc/c,EAEtB+c,EAAQ,UAAS,EACjBA,EAAQ,OAAOlc,EAAK,CAAC,EAAE,EAAI,KAAK,OAAQA,EAAK,CAAC,EAAE,EAAI,KAAK,MAAM,EAE/D,QAASowD,EAAI,EAAGA,EAAIpwD,EAAK,OAAQowD,IAAK,CACpC,MAAMllD,EAAQlL,EAAKowD,CAAC,EAGpBl0C,EAAQ,OAAOhR,EAAM,EAAI,KAAK,OAAQA,EAAM,EAAI,KAAK,MAAM,EAC3DgR,EAAQ,OAAM,EACdA,EAAQ,UAAS,EACjBA,EAAQ,UAAS,EACjBA,EAAQ,IACNhR,EAAM,EAAI,KAAK,OACfA,EAAM,EAAI,KAAK,OACf,KAAK,YACL,EACA,EAAI,KAAK,GACT,IAEFgR,EAAQ,KAAI,EACZA,EAAQ,UAAS,EAGjBA,EAAQ,UAAS,EACjBA,EAAQ,OAAOhR,EAAM,EAAI,KAAK,OAAQA,EAAM,EAAI,KAAK,MAAM,EAE7DgR,EAAQ,QAAO,CAChB,EACD,iBAAiBA,EAAS,CAExBA,EAAQ,UAAU,KAAK,EAAG,KAAK,EAAI,KAAK,MAAM,EAI9CA,EAAQ,MAAM,EAAG,EAAE,CACpB,EACD,mBAAmBk0C,EAAG,CACpB,MAAMpwD,EAAO,CAAA,EAEb,QAASvE,EAAI,EAAGA,GAAK20D,EAAG30D,IAAK,CAC3B,MAAMqL,EAAIrL,EAAI,EACRsL,EAAI,KAAK,SAEf/G,EAAK,KAAK,CAAE,EAAA8G,EAAG,EAAAC,CAAG,CAAA,EAGpB,OAAO/G,CACR,EAED,WAAY,CACV,KAAM,CAAE,QAAAkc,CAAQ,EAAI,KAEpBA,EAAQ,UACN,EAAI,KAAK,QACT,KAAK,EAAI,EAAI,KAAK,QAClB,KAAK,MAAQ,EAAI,KAAK,QACtB,KAAK,OAAS,EAAI,KAAK,SAEzB,MAAM4qD,EAAS,CAAC,UAAW,UAAW,SAAS,EAE/C,QAASrrE,EAAI,EAAGA,EAAI,KAAK,YAAY,OAAQA,IACvC,KAAK,YAAYA,CAAC,IAAM,GAC1B,KAAK,SAASygB,EAAS,KAAK,KAAKzgB,CAAC,EAAGqrE,EAAOrrE,CAAC,EAAG,CAAC,EAGrD,KAAK,YAAYygB,EAAS,GAAG,EAC7B,KAAK,UAAUA,CAAO,EACtB,KAAK,UAAUA,CAAO,CACvB,CACF,EACD,SAAU,CACR,KAAM,CAAE,OAAAsR,CAAK,EAAM,KAAK,MAClBtR,EAAUsR,EAAO,WAAW,IAAI,EACtC,KAAK,EAAI,KAAK,qBAAqBtR,CAAO,EAAI,KAAK,QAAU,EAAI,GACjE,KAAK,QAAUA,EACf,KAAK,EAAI,KAAK,QAAU,EACxB,KAAK,MAAQsR,EAAO,MAAQ,KAAK,EAAI,KAAK,QAAU,EACpD,KAAK,OAASA,EAAO,OAAS,KAAK,EAAI,KAAK,QAAU,KAAK,WAC3D,KAAK,OAAS,KAAK,KAAO,KAAK,KAC/B,KAAK,OAAS,KAAK,MAAQ,KAAK,OAChC,KAAK,OAAS,KAAK,KAAO,KAAK,KAC/B,KAAK,OAAS,KAAK,OAAS,KAAK,OAEjC,KAAK,UAAY,KAAK,MAAM,KAAK,OAAS,KAAK,aAAa,EAC5D,KAAK,UAAY,KAAK,MAAM,KAAK,OAAS,KAAK,aAAa,EAG5D,KAAK,UAAUtR,CAAO,EACtB,KAAK,UAAUA,CAAO,EAGtBA,EAAQ,KAAI,EAGZA,EAAQ,UAAU,GAAI,KAAK,OAAS,GAAG,EACvCA,EAAQ,OAAQ,IAAM,KAAK,GAAM,GAAG,EAGpCA,EAAQ,KAAO,aACfA,EAAQ,UAAY,QACpBA,EAAQ,UAAY,SACpBA,EAAQ,aAAe,SAGvBA,EAAQ,SAAS,KAAK,MAAO,EAAG,CAAC,EAGjCA,EAAQ,QAAO,EAEf,KAAK,YAAYA,EAAS,GAAG,EAa7B,MAAM6qD,EAAW,CACf,KAAK,mBAAmB,EAAE,EAC1B,KAAK,mBAAmB,EAAE,EAC1B,KAAK,mBAAmB,EAAE,GAG5B,KAAK,KAAOA,EAEZ,KAAK,UAAS,CACf,CACH,MA3VY,IAAI,SAAS,MAAM,MAAM,OAAO,MAAM,MAAA,CAAQ,uCADxDj4D,EAEM,MAAA,KAAA,CADJN,EAAgE,SAAhEF,GAAgE,KAAA,GAAA,mECK/DN,GAAU,CACb,MAAO,CACL,GAAI,CACF,KAAM,OACN,SAAU,EACX,CACF,EACD,MAAO,CACL,MAAO,CACL,iBAAkB,CAAC,GAAK,GAAK,EAAG,EAChC,eAAgB,GAChB,YAAa,GAEhB,EACD,SAAU,CACR,KAAK,YAAW,CACjB,EACD,QAAS,CACP,aAAc,CACZ,MAAMwf,EAAS,KAAK,MAAM,YACpBpuB,EAAMouB,EAAO,WAAW,IAAI,EAE5BpiB,EAAUoiB,EAAO,MAAQ,EAAI,GAC7BniB,EAAUmiB,EAAO,OAAS,EAC1ByyC,EAAc,KAAK,YACnBC,EAAcD,EAAc,EAElC7gE,EAAI,UAAU,EAAG,EAAGouB,EAAO,MAAOA,EAAO,MAAM,EAC/CA,EAAO,iBAAiB,QAAS,KAAK,gBAAgB,EAEtDA,EAAO,iBAAiB,YAAa,KAAK,gBAAgB,EAC1DA,EAAO,iBAAiB,aAAc,KAAK,gBAAgB,EAC3DA,EAAO,iBAAiB,WAAY,KAAK,sBAAsB,EAG/D,MAAM2yC,EAAgB,CAAC,UAAW,UAAW,SAAS,EAGhDC,EAAY,CAAC,EAAG,EAAG,CAAC,EAEpBC,EAAaD,EAAU,OAAO,CAACE,EAAOrjE,IAAUqjE,EAAQrjE,EAAO,CAAC,EAEtE,IAAIsjE,EAAa,EACjBH,EAAU,QAAQ,CAACnjE,EAAOzD,IAAU,CAClC,MAAMgnE,EAAgBvjE,EAAQojE,EAAc,KAAK,GAAK,EAChDI,EAAWF,EAAaC,EAE9BphE,EAAI,UAAS,EACbA,EAAI,OACFgM,EAAU60D,EAAc,KAAK,IAAIM,CAAU,EAC3Cl1D,EAAU40D,EAAc,KAAK,IAAIM,CAAU,GAE7CnhE,EAAI,IAAIgM,EAASC,EAAS40D,EAAaM,EAAYE,CAAQ,EAC3DrhE,EAAI,IAAIgM,EAASC,EAAS60D,EAAaO,EAAUF,EAAY,EAAI,EACjEnhE,EAAI,UAAS,EAGb,MAAM+0B,EACJ,KAAK,iBAAmB36B,EACpB,KAAK,iBAAiBA,CAAK,EAAI,GAC/B,KAAK,iBAAiBA,CAAK,EACjC4F,EAAI,YAAc+0B,EAElB/0B,EAAI,UAAY+gE,EAAc3mE,CAAK,EACnC4F,EAAI,KAAI,EAGRA,EAAI,YAAc,EAGlBA,EAAI,YAAc,UAClBA,EAAI,UAAY,EAChBA,EAAI,OAAM,EAEVmhE,EAAaE,CACf,CAAC,EAGDrhE,EAAI,UAAS,EACbA,EAAI,IAAIgM,EAASC,EAAS40D,EAAa,EAAG,KAAK,GAAK,CAAC,EACrD7gE,EAAI,YAAc,UAClBA,EAAI,UAAY,EAChBA,EAAI,OAAM,EAGVA,EAAI,UAAS,EACbA,EAAI,IAAIgM,EAASC,EAAS60D,EAAa,EAAG,KAAK,GAAK,CAAC,EACrD9gE,EAAI,YAAc,UAClBA,EAAI,UAAY,EAChBA,EAAI,OAAM,CACX,EACD,iBAAiB8O,EAAO,CACtB,MAAMsf,EAAS,KAAK,MAAM,YACpBorC,EAAOprC,EAAO,wBACdqrC,EAAS3qD,EAAM,QAAU0qD,EAAK,KAC9BoO,EAAS94D,EAAM,QAAU0qD,EAAK,IAE9BxtD,EAAUoiB,EAAO,MAAQ,EAAI,GAC7BniB,EAAUmiB,EAAO,OAAS,EAC1ByyC,EAAc,KAAK,YACnBC,EAAcD,EAAc,EAE5BgH,EAAqB,KAAK,MAC7BpO,EAASztD,IAAY,GAAK47D,EAAS37D,IAAY,GAGlD,GAAI47D,EAAqB/G,EAEvB,KAAK,iBAAmB,CAAC,GAAK,GAAK,EAAG,MACjC,IAAI+G,GAAsBhH,EAC/B,OACK,CACL,MAAMiH,EAAQ,KAAK,MAAMF,EAAS37D,EAASwtD,EAASztD,CAAO,EACrD+7D,EAAkBD,GAAS,EAAIA,EAAQA,EAAQ,KAAK,GAAK,EAEzDE,EAAe,KAAK,MAAOD,GAAmB,KAAK,GAAK,GAAM,CAAC,EAGrE,KAAK,iBAAiBC,CAAY,EAChC,KAAK,iBAAiBA,CAAY,IAAM,GAAM,GAAM,IAKxD,KAAK,YAAW,EAChB,KAAK,MAAM,kBAAmB,KAAK,GAAI,KAAK,gBAAgB,CAC7D,EAED,uBAAuBl5D,EAAO,CAC5B,MAAMsf,EAAS,KAAK,MAAM,YACpBorC,EAAOprC,EAAO,wBACdqrC,EAAS3qD,EAAM,QAAU0qD,EAAK,KAC9BoO,EAAS94D,EAAM,QAAU0qD,EAAK,IAE9BxtD,EAAUoiB,EAAO,MAAQ,EAAI,GAC7BniB,EAAUmiB,EAAO,OAAS,EAC1ByyC,EAAc,KAAK,YACnBC,EAAcD,EAAc,EAE5BgH,EAAqB,KAAK,MAC7BpO,EAASztD,IAAY,GAAK47D,EAAS37D,IAAY,GAGlD,GAAI47D,EAAqB/G,EAEvB,KAAK,iBAAmB,CAAC,GAAK,GAAK,EAAG,MACjC,IAAI+G,GAAsBhH,EAC/B,OACK,CACL,MAAMiH,EAAQ,KAAK,MAAMF,EAAS37D,EAASwtD,EAASztD,CAAO,EACrD+7D,EAAkBD,GAAS,EAAIA,EAAQA,EAAQ,KAAK,GAAK,EAEzDE,EAAe,KAAK,MAAOD,GAAmB,KAAK,GAAK,GAAM,CAAC,EAGrE,KAAK,iBAAmB,CAAC,GAAK,GAAK,EAAG,EACtC,KAAK,iBAAiBC,CAAY,EAAI,IAKxC,KAAK,YAAW,EAChB,KAAK,MAAM,kBAAmB,KAAK,GAAI,KAAK,gBAAgB,CAC7D,EAED,iBAAiBl5D,EAAO,CACtB,MAAMsf,EAAS,KAAK,MAAM,YACpBorC,EAAOprC,EAAO,wBACdqrC,EAAS3qD,EAAM,QAAU0qD,EAAK,KAC9BoO,EAAS94D,EAAM,QAAU0qD,EAAK,IAE9BxtD,EAAUoiB,EAAO,MAAQ,EAAI,GAC7BniB,EAAUmiB,EAAO,OAAS,EAC1ByyC,EAAc,KAAK,YACnBC,EAAcD,EAAc,EAE5BgH,EAAqB,KAAK,MAC7BpO,EAASztD,IAAY,GAAK47D,EAAS37D,IAAY,GAGlD,GAAI47D,EAAqB/G,EAEvB,KAAK,eAAiB,WACb+G,GAAsBhH,EAAa,CAC5C,KAAK,iBAAgB,EACrB,WACK,CACL,MAAMiH,EAAQ,KAAK,MAAMF,EAAS37D,EAASwtD,EAASztD,CAAO,EACrD+7D,EAAkBD,GAAS,EAAIA,EAAQA,EAAQ,KAAK,GAAK,EAEzDE,EAAe,KAAK,MAAOD,GAAmB,KAAK,GAAK,GAAM,CAAC,EAGrE,KAAK,eAAiBC,EAIxB,KAAK,YAAW,CACjB,EACD,kBAAmB,CAEjB,KAAK,eAAiB,GAGtB,KAAK,YAAW,CACjB,CACF,CACH,EApNY94D,GAAA,CAAA,IAAI,aAAa,sCAD3BQ,EAEM,MAAA,KAAA,CADJN,EAAmC,SAAnCF,GAAmC,KAAA,GAAA,mCCevC,MAAKN,GAAU,CACb,MAAO,CACL,MAAO,CACL,KAAM,OACN,QAAS,eACV,EACD,YAAa,CACX,KAAM,OACN,QAAS,CACV,CACF,EACD,SAAU,CAAE,EAEZ,MAAO,CACL,MAAO,CACL,eAAgB,KAAK,YAExB,EACD,QAAS,CACP,kBAAmB,CAEjB,KAAK,gBAAkB,EAExB,EACD,kBAAmB,CAEjB,KAAK,gBAAkB,EAExB,EACD,aAAc,CAQZ,KAAK,MAAM,kBAAmB,KAAK,KAAK,CAGzC,CACF,CACH,sCA1DEc,EAYM,MAAA,KAAA,CAXJN,EAUK,KAAA,CATF,iCAAYU,EAAgB,kBAAAA,EAAA,iBAAA,GAAAnW,CAAA,GAC5B,8BAASmW,EAAgB,kBAAAA,EAAA,iBAAA,GAAAnW,CAAA,GACzB,iCAAYmW,EAAgB,kBAAAA,EAAA,iBAAA,GAAAnW,CAAA,GAC5B,+BAAUmW,EAAgB,kBAAAA,EAAA,iBAAA,GAAAnW,CAAA,GAC1B,4BAAOmW,EAAW,aAAAA,EAAA,YAAA,GAAAnW,CAAA,GAClB,kBAAkBgW,EAAc,cAAA,CAAA,EAChC,oCAAuBI,EAAa,eAAAA,EAAA,cAAA,GAAApW,CAAA,EAAA,CAAA,SAAA,CAAA,EAAA,CAAA,OAAA,CAAA,MAElCwW,EAAK,KAAA,EAAA,EAAA,mEC0Hd,MAAKvB,GAAU,CACb,WAAY,CACV,YAAAq5D,GACA,oBAAAC,GACA,iBAAAC,EACD,EACD,MAAO,CACL,MAAO,CACL,SAAU,CACR,CAAE,GAAI,EAAG,QAAS,CAAC,EAAG,EAAG,CAAC,CAAG,EAC7B,CAAE,GAAI,EAAG,QAAS,CAAC,EAAG,EAAG,CAAC,CAAG,EAC7B,CAAE,GAAI,EAAG,QAAS,CAAC,EAAG,EAAG,CAAC,CAAG,CAC9B,EACD,WAAY,IACZ,cAAe,CAAC,EAAG,EAAG,CAAC,EAEvB,gBAAiB,CACf,CAAE,GAAI,EAAG,MAAO,gBAAiB,QAAS,EAAK,EAC/C,CACE,GAAI,EACJ,MAAO,8BACP,QAAS,EACV,EACD,CAAE,GAAI,EAAG,MAAO,mBAAoB,QAAS,EAAK,EAClD,CAAE,GAAI,EAAG,MAAO,gBAAiB,QAAS,EAAK,EAC/C,CAAE,GAAI,EAAG,MAAO,aAAc,QAAS,EAAK,EAC5C,CAAE,GAAI,EAAG,MAAO,aAAc,QAAS,EAAK,CAC7C,EAEJ,EACD,QAAS,CACP,oBAAoBC,EAAQC,EAAY,CACtC,QAAShsE,EAAI,EAAGA,EAAI,EAAGA,IACrB,KAAK,SAAS+rE,EAAS,CAAC,EAAE,QAAQ/rE,CAAC,EAAIgsE,EAAWhsE,CAAC,EAAI,EAE1D,EAOD,QAAQ,EAAGmE,EAAI,CACb,MAAM8nE,EAAa,kBAAkB9nE,IACrC,KAAK,MAAM8nE,CAAU,EAAE,YAAc,EAAE,OAAS,EACjD,EACD,mBAAmBF,EAAQ,CASzB,QAAQ,IAAIA,CAAM,EAClB,KAAK,cAAcA,CAAM,EAAI,GAC7B,KAAK,cAAcA,CAAM,EAAI,EAC9B,CACF,CAEH,6CAjMOl5D,GAAA,CAAA,MAAM,iBAAiB,EACrBG,GAAA,CAAA,MAAM,oBAAoB,EAIxBC,GAAA,CAAA,MAAM,QAAQ,YACjBF,EASM,MAAA,CATD,MAAM,eAAa,CACtBA,EAAiB,UAAb,UAAQ,QAwBTG,GAAA,CAAA,MAAM,SAAS,EACbC,GAAA,CAAA,MAAM,MAAM,EAMZ2hD,GAAA,CAAA,MAAM,OAAO,aAWnB1hD,GAAA,CAAA,MAAM,oBAAoB,EAIxB2hD,GAAA,CAAA,MAAM,QAAQ,EACjBe,GAAAhjD,GAAA,IAAAC,EAAiB,UAAb,WAAQ,EAAA,CAAA,EAeP0oD,GAAA,CAAA,MAAM,SAAS,EACbE,GAAA,CAAA,MAAM,MAAM,EAMZJ,GAAA,CAAA,MAAM,OAAO,aAWnBgJ,GAAA,CAAA,MAAM,oBAAoB,EAIxBwC,GAAA,CAAA,MAAM,QAAQ,EACjBC,GAAAl0D,GAAA,IAAAC,EAAiB,UAAb,WAAQ,EAAA,CAAA,EAcPk0D,GAAA,CAAA,MAAM,SAAS,EACbC,GAAA,CAAA,MAAM,MAAM,EAMZC,GAAA,CAAA,MAAM,OAAO,oIAjH1B,OAAAtzD,EAAA,EAAAR,EA2HM,MA3HNR,GA2HM,CA1HJE,EA8CM,MA9CNC,GA8CM,CA7CJD,EAEM,MAAA,CAFD,MAAM,UAAW,iBAAiBO,EAAU,WAAA,KAAA,IAC/CoB,EAAcw3D,CAAA,MAEhBn5D,EAyCM,MAzCNE,GAyCM,CAxCJkB,GAWApB,EAaM,MAAA,CAZJ,MAAM,kBACN,IAAI,mBACH,aAAUmB,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAP,GAAEF,EAAO,QAACE,EAAM,CAAA,YAE3BN,EAOMmB,GAAA,KAAAC,GAPenB,EAAe,gBAAxB64D,QAAZ94D,EAOM,MAAA,CAPiC,IAAK84D,EAAM,KAChDz3D,EAKE03D,EAAA,CAJC,GAAID,EAAM,GACV,MAAOA,EAAM,MACb,YAAaA,EAAM,QACnB,gCAAiB14D,EAAkB,mBAAA,CAAA,yDAI1CV,EAcM,MAdNG,GAcM,CAbJH,EAKM,MALNI,GAKM,CAJJuB,EAGE23D,EAAA,CAFC,GAAI,EACJ,iBAAiB54D,EAAmB,oDAGzCV,EAMM,MANN+hD,GAMM,CALJpgD,EAIamhD,GAAA,CAJD,KAAK,MAAM,EAAA,WACrB,IAEM,CAFKviD,EAAa,cAAA,CAAA,OAAxBD,EAEM,MAAAO,GAAA,CADJc,EAAkD43D,EAAA,CAApC,YAAah5D,EAAQ,SAAA,CAAA,EAAI,6DAQnDP,EAoCM,MApCNK,GAoCM,CAnCJL,EAEM,MAAA,CAFD,MAAM,UAAW,iBAAiBO,EAAU,WAAA,KAAA,IAC/CoB,EAAcw3D,CAAA,MAEhBn5D,EA+BM,MA/BNgiD,GA+BM,CA9BJe,GACA/iD,EAaM,MAAA,CAZJ,MAAM,kBACN,IAAI,mBACH,aAAUmB,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAP,GAAEF,EAAO,QAACE,EAAM,CAAA,YAE3BN,EAOMmB,GAAA,KAAAC,GAPenB,EAAe,gBAAxB64D,QAAZ94D,EAOM,MAAA,CAPiC,IAAK84D,EAAM,KAChDz3D,EAKE03D,EAAA,CAJC,GAAID,EAAM,GACV,MAAOA,EAAM,MACb,YAAaA,EAAM,QACnB,gCAAiB14D,EAAkB,mBAAA,CAAA,yDAI1CV,EAcM,MAdN0oD,GAcM,CAbJ1oD,EAKM,MALN4oD,GAKM,CAJJjnD,EAGE23D,EAAA,CAFC,GAAI,EACJ,iBAAiB54D,EAAmB,oDAGzCV,EAMM,MANNwoD,GAMM,CALJ7mD,EAIamhD,GAAA,CAJD,KAAK,MAAM,EAAA,WACrB,IAEM,CAFKviD,EAAa,cAAA,CAAA,OAAxBD,EAEM,MAAAmoD,GAAA,CADJ9mD,EAAkD43D,EAAA,CAApC,YAAah5D,EAAQ,SAAA,CAAA,EAAI,6DAQnDP,EAmCM,MAnCNwxD,GAmCM,CAlCJxxD,EAEM,MAAA,CAFD,MAAM,UAAW,iBAAiBO,EAAU,WAAA,KAAA,IAC/CoB,EAAcw3D,CAAA,MAEhBn5D,EA8BM,MA9BNg0D,GA8BM,CA7BJC,GACAj0D,EAYM,MAAA,CAXJ,MAAM,kBACN,IAAI,mBACH,aAAUmB,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAP,GAAEF,EAAO,QAACE,EAAM,CAAA,YAE3BN,EAMMmB,GAAA,KAAAC,GANenB,EAAe,gBAAxB64D,QAAZ94D,EAMM,MAAA,CANiC,IAAK84D,EAAM,KAChDz3D,EAIE03D,EAAA,CAHC,MAAOD,EAAM,MACb,YAAaA,EAAM,QACnB,gCAAiB14D,EAAkB,mBAAA,CAAA,oDAI1CV,EAcM,MAdNk0D,GAcM,CAbJl0D,EAKM,MALNm0D,GAKM,CAJJxyD,EAGE23D,EAAA,CAFC,GAAI,EACJ,iBAAiB54D,EAAmB,oDAGzCV,EAMM,MANNo0D,GAMM,CALJzyD,EAIamhD,GAAA,CAJD,KAAK,MAAM,EAAA,WACrB,IAEM,CAFKviD,EAAa,cAAA,CAAA,OAAxBD,EAEM,MAAA+zD,GAAA,CADJ1yD,EAAkD43D,EAAA,CAApC,YAAah5D,EAAQ,SAAA,CAAA,EAAI,8HCrDvD,MAAKf,GAAU,CACb,WAAY,CAEV,kBAAAg6D,GACA,sBAAAC,GACA,WAAAvW,GACA,aAAAwW,GACA,YAAAC,GACA,kBAAAC,EACD,EACD,MAAO,CACL,MAAO,CAEL,UAAW,YACX,iBAAkB,eAErB,EACD,QAAS,CAEP,cAAe,CACb,MAAMn6D,EAAc,IAAI,KAAM,EAAC,SAAQ,EAEvC,OAAIA,GAAe,GAAKA,EAAc,GAC7B,UAELA,GAAe,IAAMA,EAAc,GAC9B,YAELA,GAAe,IAAMA,EAAc,GAC9B,UAEF,KACR,EAED,mBAAmBmG,EAAM,CACnBA,IAAS,cACX,KAAK,iBAAmB,cACfA,IAAS,eAClB,KAAK,iBAAmB,eACfA,IAAS,sBAClB,KAAK,iBAAmB,qBAG1B,OAAO,aAAa,QAAQ,cAAe,KAAK,gBAAgB,CAEjE,EAED,yBAAyBi0D,EAAe,CAClCA,EACF,KAAK,MAAM,sBAAsB,gBAAgB,eAAe,EAEhE,KAAK,MAAM,sBAAsB,gBAC/B,uBAGL,CACF,EACD,SAAU,CAER,KAAK,UAAY,KAAK,eACtB,KAAK,UAAY,GAAG,KAAK,aAAa,KAAK,UAAU,YAAa,GACnE,EACD,SAAU,CAER,KAAK,iBAAmB,OAAO,aAAa,QAAQ,aAAa,CAClE,CACH,uDAzHE75D,EASM,MAAA,CATD,MAAM,kBAAgB,CACzBA,EAOM,MAAA,CAPD,MAAM,SAAS,EAAA,CAClBA,EAKK,KAAA,KAAA,GALD,6FAEiB,EAAAA,EAAM,IAAA,IAAA,kFAG3B,YAMGC,GAAA,CAAA,MAAM,MAAM,EAEVC,GAAA,CAAA,MAAM,eAAe,EAIrBkB,GAAA,CAAA,MAAM,aAAa,EAEjBjB,GAAA,CAAA,MAAM,QAAQ,EASdC,GAAA,CAAA,MAAM,MAAM,EASjB2hD,GAAAhiD,GAAA,IAAAC,EAEK,KAFD,CAAA,MAAA,CAAA,cAAA,OAAA,MAAA,MAAA,CAAsC,EAAC,gCAE3C,EAAA,CAAA,6GAzCNF,GAWAE,EAiCM,MAAA,CAjCA,QAAOO,EAAS,SAAA,IAEpBP,EA8BM,MA9BNC,GA8BM,CA5BJD,EAGM,MAHNE,GAGM,CADJyB,EAA6Dm4D,EAAA,CAArC,eAAep5D,EAAkB,kBAAA,EAAA,KAAA,EAAA,CAAA,gBAAA,CAAA,IAE3DV,EAuBM,MAvBNoB,GAuBM,CArBJpB,EAMM,MANNG,GAMM,CAJJwB,EAGEo4D,EAAA,CAFC,gBAAiBx5D,EAAgB,iBACjC,qBAAoBG,EAAwB,+EAKjDV,EAMM,MANNI,GAMM,CAJJuB,EAGamhD,GAAA,CAHD,KAAK,MAAM,EAAA,WAErB,IAAgE,EAAhEhiD,IAAAG,EAAgEyvD,GAAhDnwD,EAAA,gBAAgB,EAAE,CAAA,IAAI,yBAAuB,KAAA,GAAA,aAKjEwhD,+ECzCFiY,GAAS,CACb,CACE,KAAM,IACN,SAAU,QACX,EAED,CACE,KAAM,SACN,KAAM,QACN,UAAWC,EACZ,EAMD,CACE,KAAM,QACN,KAAM,OACN,UAAWC,EACZ,EACD,CACE,KAAM,YACN,KAAM,WACN,UAAWC,EACZ,CACH,EAEMC,GAASC,GAAa,CAC1B,QAASC,GAAkB,EAC3B,OAAAN,EACF,CAAC,ECRDz7D,KAIA8kC,GAAU,4CAA2C,EACrDA,GAAU,oDAAoD,GAAI,EAAE,EACpEA,GAAU,iDAAiD,GAAI,EAAE,EAEjEk3B,GAAe,4CAA2C,EAC1DA,GAAe,oDAAoD,EAAG,CAAC,EAEvEhoE,GAAmBpE,EAAY,EAE/B,MAAM6P,GAAew8D,GAAgB,YAAY,CAAE,mBAAAvjE,EAAoB,CAAA,EAEjE0G,GAAU,IAAItT,GACpBsT,GAAQ,WAAU,EAElB,MAAM88D,GAAQC,GAAW,EACzBD,GAAM,IACJj9D,GAAwB,CACtB,QAAS,IAAIO,GAAaC,EAAY,EACtC,QAAAL,EACJ,CAAG,CACH,EAEA,MAAMkB,GAAM87D,GAAUC,EAAG,EAEzBC,GAAmBh8D,EAAG,EAEtBA,GAAI,QAAQ,eAAgBb,EAAY,EACxCa,GAAI,IAAI47D,EAAK,EACb57D,GAAI,IAAIi8D,EAAQ,EAChBj8D,GAAI,IAAIk8D,EAAO,EACfl8D,GAAI,IAAIm8D,GAAmB,CACzB,YAAa,KACb,aAAc,KACd,aAAc,KACd,aAAc,KACd,QAAS,KACT,IAAK,IACP,CAAC,EACDn8D,GAAI,IAAIu7D,EAAM,EAAE,MAAM,MAAM"}