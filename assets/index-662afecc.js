import{aw as X,aK as R,b0 as Y,b1 as V,b2 as ii,b3 as xo,b4 as Ke,b5 as ms,b6 as vs,b7 as ys,b8 as ai,af as si,A as pe,b9 as ee,ba as ws,bb as Ss,aN as _s,az as B,as as F,bc as Cs,aL as E,bd as g,be as U,bf as H,aU as tt,bg as An,bh as N,bi as nt,bj as ue,bk as ae,bl as se,bm as x,aO as ie,bn as Pe,aD as y,bo as Ye,bp as C,bq as ri,ak as De,a6 as pt,ao as I,br as Tt,bs as li,bt as bs,bu as Ts,bv as Is,bw as Rs,bx as xs,an as We,aI as Ds,aB as z,u as at,by as Pt,H as ci,bz as Me,bA as mt,E as Es,n as Ls,Y as Os,I as Ps,B as Vs,aj as Do,bB as Ce,aE as Gt,aq as oe,aQ as te,aC as Fn,aA as It,bC as j,ap as fe,bD as ne,bE as rt,bF as Wn,bG as Ae,aH as Ee,aF as ks,K as zn,ay as jn,bH as ui,aY as Bt,bI as di,bJ as Ms,bK as Bs,bL as As,bM as hi,bN as Fs,V as Ns,bO as $s,bP as Us,bQ as Hs,bR as Ws,aG as zs,bS as js,aZ as Gs,bT as Xs,aS as Be,bU as qs,aT as gi,bV as fi,bW as Ks,bX as Ys,bY as Qs,bZ as Zs,b_ as Js,b$ as er,c0 as tr}from"./vendor-1cfc01b0.js";import{_ as A,E as Gn,V as vt,a as pi,b as ft,c as cn,d as Vt,e as Eo,f as Nn,g as mi,h as vi,i as Xt,u as yi,j as yt,k as Lo,l as nr,m as or,n as ir,o as ar,p as wi,q as Si,r as ht,s as Oo,T as gn,t as At,v as Ze,w as Re,x as sr,y as rr,z as lr,A as On,B as cr,C as ur}from"./vuetify-ca35aafb.js";import{v as dr,a as _i,m as _,b as hr,c as gr,d as fr,I as pr,e as mr,f as vr,g as yr,h as xe,i as wr,j as Sr,k as _r,l as Cr,n as Je,o as br,p as Tr,C as Ir,q as Rr,D as xr,R as Dr,r as Xn,s as Ci,t as fn,u as ze,w as un,x as bi,y as Ti,z as Er,A as Lr,V as Qe,B as Or,E as pn,_ as Pr,F as Ii,G as Ri,H as Vr,J as kr,K as mn,L as xi,M as Mr,N as Di,O as Br,P as qt,Q as Ei,S as Po,T as Ar,U as Vo,W as ko,X as Fr,Y as Nr,Z as $r,$ as Ur,a0 as Hr,a1 as Wr,a2 as zr,a3 as jr,a4 as Li,a5 as Gr}from"./vtk.js-2d3e2a46.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();const Xr=X({name:"App",components:{}});function qr(e,t,n,s,o,i){const a=V("router-view");return R(),Y(a)}const Kr=A(Xr,[["render",qr]]);function Yr(e){const t=e.split(/\/+/g);return t.splice(-1,1),t.join("/")}function Qr(e){return e.split(/\/+/g).at(-1)??e}function wt(e){return e.replace(/\/+/g,"/").replace(/\/$/,"")}function St(...e){return wt(e.join("/"))}function $n(e){return e.replace(/\//g,"_")}function Mo(e){return new File([e],$n(e.name))}class Oi{constructor(){this.webWorker=null,this.initializeCheck=null}async runTask(t,n,s,o){return ii(this.webWorker,t,n,o,s,St("/","/itk/pipelines"),St("/","/itk/pipeline.worker.js"))}async initialize(){return this.initializeCheck||(this.initializeCheck=new Promise((t,n)=>{this.runTask("dicom",[],[],[]).then(s=>{s.webWorker?this.webWorker=s.webWorker:n(new Error("Could not initialize webworker"))}).then(async()=>{try{await xo(this.webWorker,new File([],""),null)}catch{}t()}).catch(n)})),this.initializeCheck}async categorizeFiles(t){await this.initialize();const n=await Promise.all(t.map(async(l,c)=>{const u=await l.arrayBuffer();return{type:Ke.BinaryFile,data:{path:c.toString(),data:new Uint8Array(u)}}})),s=["--action","categorize","--memory-io","0","--files",...n.map(l=>l.data.path)],o=[{type:Ke.TextStream}],i=await this.runTask("dicom",s,n,o),a=JSON.parse(i.outputs[0].data.data);return Object.fromEntries(Object.entries(a).map(([l,c])=>[l,c.map(u=>t[parseInt(u,10)])]))}async readTags(t,n){const s=n.map(a=>a.tag),i=(await xo(this.webWorker,Mo(t),s)).tags;return n.reduce((a,r)=>{const{tag:l,name:c}=r;return i.has(l)?{...a,[c]:i.get(l)}:a},{})}async getVolumeSlice(t,n=!1){await this.initialize();const s=await t.arrayBuffer(),o=[{type:Ke.BinaryFile,data:{path:$n(t.name),data:new Uint8Array(s)}}],i=["--action","getSliceImage","--thumbnail",n.toString(),"--file",$n(t.name),"--memory-io","0"],a=[{type:Ke.Image}];return(await this.runTask("dicom",i,o,a)).outputs[0].data}async resample(t,n){await this.initialize();const{size:s,spacing:o,origin:i,direction:a}=t,r=["--action","resample","0","--size",s.join(","),"--spacing",o.join(","),"--origin",i.join(","),"--direction",a.join(","),"--memory-io","0"],l=[{type:Ke.Image,data:n}],c=[{type:Ke.Image}];return(await this.runTask("dicom",r,l,c)).outputs[0].data}async buildImage(t){return await this.initialize(),(await ms(t.map(s=>Mo(s)))).image}}const Ft={vti:"application/vnd.unknown.vti",vtp:"application/vnd.unknown.vtp",stl:"model/stl",dcm:"application/dicom",zip:"application/zip",json:"application/json",gipl:"application/vnd.unknown.gipl","gipl.gz":"application/vnd.unknown.gipl",hdf5:"application/x-hdf5",jpg:"image/jpeg",jpeg:"image/jpeg",lsm:"application/vnd.unknown.lsm",mnc:"application/vnd.unknown.minc","mnc.gz":"application/vnd.unknown.minc",mnc2:"application/vnd.unknown.minc",mgh:"application/vnd.unknown.mgh",mgz:"application/vnd.unknown.mgh","mgh.gz":"application/vnd.unknown.mgh",mha:"application/vnd.unknown.metaimage",mhd:"application/vnd.unknown.metaimage",mrc:"application/vnd.unknown.mrc",nia:"application/vnd.unknown.nifti-1",nii:"application/vnd.unknown.nifti-1","nii.gz":"application/vnd.unknown.nifti-1",hdr:"application/vnd.unknown.nifti-1",nrrd:"application/vnd.unknown.nrrd",nhdr:"application/vnd.unknown.nrrd",png:"image/png",pic:"application/vnd.unknown.biorad",tif:"image/tiff",tiff:"image/tiff",vtk:"application/vnd.unknown.vtk",isq:"application/vnd.unknown.scanco",fdf:"application/vnd.unknown.fdf"},Bo=new Set(Object.keys(Ft)),Ao=new Set(Object.values(Ft)),Pi=new Set(["application/zip"]),Fo=[{mime:"application/dicom",skip:128,header:Array.from("DICM").map(e=>e.charCodeAt(0))}],Zr=512;function Jr(e,t){if(t.length>e.length)return!1;for(let n=0;n<t.length;n+=1)if(t[n]!==e[n])return!1;return!0}async function el(e){return new Promise(t=>{const n=e.slice(0,Zr),s=new FileReader;s.onload=()=>{const o=new Uint8Array(s.result);for(let i=0;i<Fo.length;i+=1){const{mime:a,header:r,skip:l=0}=Fo[i];if(Jr(o.slice(l),r)){t(a);return}}t(null)},s.readAsArrayBuffer(n)})}async function Vi(e){const t=e.type.toLowerCase();if(Ao.has(t))return t;if(Bo.has(t))return Ft[t];const n=[...Bo].find(o=>e.name.toLowerCase().endsWith(`.${o}`));if(n)return Ft[n];const s=await el(e);return s&&Ao.has(s)?s:null}async function tl(e){const t=await Vi(e)??"";return new File([e],e.name,{type:t.toLowerCase()})}async function nl(e,t){return new Promise(n=>{const s=new globalThis.FileReader;if(s.onload=()=>n(s.result),t==="ArrayBuffer")s.readAsArrayBuffer(e);else if(t==="Text")s.readAsText(e);else throw new TypeError(`readAs${t} is not a function`)})}async function ol(e){return nl(e,"ArrayBuffer")}const Un=new Map;function ki(e){return e}function Mi(){let e=null,t=null;const n=i=>{e&&e(i)},s=i=>{t&&t(i)};return{promise:new Promise((i,a)=>{e=i,t=a}),resolve:n,reject:s}}function Nt(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}function Bi(e,t,n){return Math.min(n,Math.max(t,e))}function No(e,...t){return t.reduce((n,s)=>({...n,[s]:e[s]}),{})}function vn(e,t){const n=[[],[]];return t.forEach(s=>{const o=e(s)?0:1;n[o].push(s)}),n}const il=(e,t,n)=>(e in t||(t[e]=n),t[e]);function qn(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function al(e,t=Gn){const n=Math.round(e);return Math.abs(n-e)<=t?n:e}function sl(e){return e instanceof Error?e:new Error(JSON.stringify(e))}function rl(e){if(!e)return"#ffffff";const t=document.createElement("canvas").getContext("2d");if(!t)throw new Error("Could not create canvas context");return t.fillStyle=e,t.fillStyle}class Ai{constructor(t){this.msgID=0,this.worker=t,this.waiting={},this.worker.onmessage=this.handleMessage.bind(this)}postMessage(t,n=[]){const s={id:this.msgID,message:t},o=Mi();return this.waiting[s.id]=o,this.worker.postMessage(s,n),this.msgID+=1,o.promise}handleMessage(t){const{id:n,error:s,message:o}=t.data;if(n in this.waiting){const i=this.waiting[n];delete this.waiting[n],s?i.reject(new Error(s)):i.resolve(o)}}}const Kn=e=>async t=>{const s=await new Ai(new Worker(new URL("/assets/async.reader.worker-f0ea3ad1.js",self.location),{type:"module"})).postMessage({file:t,readerName:e});if(s.status==="success")return dr(s.obj);throw s.error},ll=e=>async t=>{const s=await new Ai(new Worker(new URL("/assets/async.writer.worker-42a67950.js",self.location),{type:"module"})).postMessage({obj:t.getState(),writerName:e});if(s.status==="success")return s.data;throw s.error},cl=Kn("stl"),Fi=Kn("vti"),ul=Kn("vtp"),dl=ll("vti"),hl=Array.from(new Set(Array.from(vs.keys()).map(e=>Ft[e.toLowerCase()])));_i.setReadImageArrayBufferFromITK(ys);async function gl(e){const t=await ol(e),n=_i.newInstance();n.setFileName(e.name);try{await n.parseAsArrayBuffer(t)}catch{throw new Error("Failed to parse file")}return n.getOutputData()}function fl(e){e.set("application/vnd.unknown.vti",Fi),e.set("application/vnd.unknown.vtp",ul),e.set("model/stl",cl),hl.forEach(t=>{e.set(t,gl)})}function Ni(e,t){const n=_.debounce(t.renderWindow.render,5);e.resize=()=>{if(t.container){const a=t.container.getBoundingClientRect();if(a.width===a.height&&a.width===0)return;const r=window.devicePixelRatio||1,l=Math.max(10,Math.floor(r*a.width)),c=Math.max(10,Math.floor(r*a.height));t.renderWindow.getViews()[0].setSize(l,c),e.invokeResize({width:l,height:c}),e.render(!0)}},e.render=(a=!0)=>{t.orientationWidget.updateMarkerOrientation(),a?t.renderWindow.render():n()};let s=null;e.renderLater=()=>{s==null&&(s=setTimeout(()=>{e.render(),s=null},0))},e.removeAllRepresentations=()=>{t.representations.forEach(a=>t.renderer.removeViewProp(a)),t.representations.length=0},e.updateCamera=(a,r,l)=>{const c=ai(l);si(c,c,a),t.camera.setFocalPoint(...l),t.camera.setPosition(...c),t.camera.setDirectionOfProjection(...a),t.camera.setViewUp(...r)};const{setContainer:o}=e;e.setContainer=a=>{o(a),t.cornerAnnotation.setContainer(null)};const{resetCamera:i}=e;e.resetCamera=(...a)=>{i(a),t.renderer.updateLightsGeometryToFollowCamera()}}function pl(e,t){t.classHierarchy.push("vtkLPSView3DProxy"),Ni(e,t)}function $i(e,t,n={}){Object.assign(t,n),hr.extend(e,t,n),pl(e,t)}const ml=_.newInstance($i,"vtkLPSView3DProxy"),vl={newInstance:ml,extend:$i};function yl(e,t){t.classHierarchy.push("vtkLPSView2DProxy");const n={...e};Ni(e,t),e.bindRepresentationToManipulator=()=>{},e.resetCamera=(s=null)=>{t.renderer.resetCamera(s)},e.addRepresentation=s=>{s&&(t.representations.indexOf(s)===-1&&(t.representations.push(s),t.renderer.addViewProp(s)),s.setSlicingMode&&t.slicingMode&&s.setSlicingMode(t.slicingMode))},e.setSlicingMode=s=>{if(t.axis="IJK".indexOf(s),n.setSlicingMode(s)&&s){let o=t.representations.length;for(;o--;){const i=t.representations[o];i.setSlicingMode&&i.setSlicingMode(s)}}},e.resizeToFit=(s,o,i)=>{const[a,r]=t.renderWindow.getViews()[0].getSize();let l,c;s===0&&o===1?[,c,l]=i:s===0&&o===2?[,l,c]=i:s===1&&o===0?[c,,l]=i:s===1&&o===2?[l,,c]=i:s===2&&o===0?[c,l]=i:s===2&&o===1&&([l,c]=i);const u=a/r,d=l/c;let h=0;u>=d?h=c/2:h=l/2/u,t.camera.setParallelScale(h)}}const wl={slicingMode:null};function Ui(e,t,n={}){Object.assign(t,n,wl),_.setGet(e,t,["slicingMode"]),gr.extend(e,t,n),yl(e,t)}const Sl=_.newInstance(Ui,"vtkLPSView2DProxy"),_l={newInstance:Sl,extend:Ui},Cl={X:"I",Y:"J",Z:"K",I:"I",J:"J",K:"K"};function bl(e,t){t.classHierarchy.push("vtkIJKSliceRepresentationProxy");const n={...e};e.setSlicingMode=s=>n.setSlicingMode(Cl[s])}const Tl={};function Hi(e,t,n={}){Object.assign(t,Tl,n),fr.extend(e,t),_.proxyPropertyMapping(e,t,{opacity:{modelKey:"property",property:"opacity"}}),bl(e,t)}const Il=_.newInstance(Hi,"vtkIJKSliceRepresentationProxy"),Wi={newInstance:Il,extend:Hi},{InterpolationType:Rl}=pr;function xl(e,t){t.classHierarchy.push("vtkLabelMapSliceRepProxy");let n=null;t.property.setUseLookupTableScalarRange(!0),t.property.setInterpolationType(Rl.NEAREST),t.mapper.setRelativeCoincidentTopologyPolygonOffsetParameters(-2,-2);let s=null;function o(a){const r=a.getColorMap();if(r===s)return;s=r;const l=mr.newInstance(),c=vr.newInstance();Object.keys(r).forEach(u=>{const d=Number(u);l.addRGBPoint(d,...r[u].slice(0,3).map(h=>h/255)),c.addPoint(d,r[u][3]/255)}),t.property.setRGBTransferFunction(l),t.property.setScalarOpacity(c)}function i(a){n&&(n.unsubscribe(),n=null),a&&(n=a.onModified(()=>o(a)),o(a))}e.setColorBy=()=>{},e.delete=_.chain(e.delete,()=>{n&&(n.unsubscribe(),n=null)}),t.sourceDependencies.push({setInputData:i})}const Dl={};function zi(e,t,n={}){Object.assign(t,Dl,n),Wi.extend(e,t),xl(e,t)}const El=_.newInstance(zi,"vtkLabelMapSliceRepProxy"),Ll={newInstance:El,extend:zi};function qe(e,t=[],n=[],s={},o={}){return{class:e,options:{links:n,ui:t,...s},props:o}}function $o(e,t=[],n={}){return qe(e,[],[],t,n)}const Ol={definitions:{Proxy:{LookupTable:qe(yr,[],[],{presetName:"Default (Cool to Warm)"}),PiecewiseFunction:qe(xe)},Sources:{TrivialProducer:qe(wr)},Representations:{ImageSlice:qe(Wi),LabelMapSlice:qe(Ll),Volume:qe(Sr),Geometry:qe(_r)},Views:{View3D:$o(vl),View2D:$o(_l)}},representations:{View3D:{vtkImageData:{name:"Volume"},vtkPolyData:{name:"Geometry"}},View2D:{vtkImageData:{name:"ImageSlice"},vtkLabelMap:{name:"LabelMapSlice"}}}};function Pl({stencil:e,location:t,slicingIndex:n,indexToWorld:s}){const[o,i]=e.size,a=Math.floor((o-1)/2),r=Math.floor((i-1)/2),l=o+1,c=i+1,u=[],d=[],h={},v=(p,m)=>{const w=`${p},${m}`;if(w in h)return h[w];const T=[...t].map(O=>Math.round(O));n===0?(T[1]+=p-a-.5,T[2]+=m-r-.5):n===1?(T[0]+=p-a-.5,T[2]+=m-r-.5):n===2&&(T[0]+=p-a-.5,T[1]+=m-r-.5);const S=[];pe(S,T,s),u.push(S);const b=u.length-1;return h[w]=b,b},f=(p,m)=>p<0||p>=o||m<0||m>=i?0:e.pixels[m*o+p]||0;for(let p=0;p<c;p++)for(let m=0;m<l;m++){const w=f(m,p)+f(m-1,p)+f(m,p-1)+f(m-1,p-1);if(w>0&&w<4){const T=v(m,p);if(f(m,p)!==f(m,p-1)){const S=v(m+1,p);d.push([T,S])}if(f(m,p)!==f(m-1,p)){const S=v(m,p+1);d.push([T,S])}}}return{points:new Float32Array(u.flat()),lines:new Uint16Array(d.map(([p,m])=>[2,p,m]).flat())}}function Vl(e,t){t.classHierarchy.push("vtkPaintBrushContextRepresentation"),t.internalPolyData=Je.newInstance({mtime:0}),t.internalArrays={points:t.internalPolyData.getPoints(),lines:t.internalPolyData.getLines()},t.pipelines={brush:{source:e,mapper:br.newInstance({transformCoordinate:Tr.newInstance({coordinateSystem:Ir.WORLD})}),actor:Rr.newInstance({pickable:!1,parentProp:e})}};const n=t.pipelines.brush.actor.getProperty();n.setLineWidth(2),n.setColor([1,0,0]),n.setDisplayLocation(xr.FOREGROUND),n.setRepresentation(Dr.SURFACE),Xn.connectPipeline(t.pipelines.brush),e.addActor(t.pipelines.brush.actor),e.requestData=(s,o)=>{const i=s[0],a=i.getStencil(),r=i.getBrush(),{indexToWorld:l,worldToIndex:c}=t;if(a&&r.getOrigin()){const u=[];pe(u,r.getOrigin(),c);const d=Pl({stencil:a,location:u,slicingIndex:t.slicingIndex,indexToWorld:l}),{points:h,lines:v}=t.internalArrays;h.setData(d.points),v.setData(d.lines),t.internalPolyData.modified()}o[0]=t.internalPolyData}}const kl={defaultScale:1,drawBorder:!1,drawFace:!0,worldToIndex:null,indexToWorld:null,slicingIndex:0};function ji(e,t,n={}){Object.assign(t,kl,n),Cr.extend(e,t,n),_.setGet(e,t,["slicingIndex","indexToWorld","worldToIndex"]),_.get(e,t,["mapper","actor"]),Vl(e,t)}const Ml=_.newInstance(ji,"vtkPaintBrushContextRepresentation"),Bl={newInstance:Ml,extend:ji};function Pn(e){return e.altKey||e.controlKey||e.shiftKey}function Al(e,t){t.classHierarchy.push("vtkPaintWidgetProp"),_.setGet(e,t,["manipulator"]);let n=!1;e.handleLeftButtonPress=s=>{if(!t.manipulator||Pn(s))return _.VOID;const o=t.manipulator.handleEvent(s,t._apiSpecificRenderWindow);return o?(t.widgetState.getBrush().setOrigin(...o),n=!0,e.invokeStartInteractionEvent(),_.EVENT_ABORT):_.VOID},e.handleMouseMove=s=>{if(Pn(s))return _.VOID;const o=t.manipulator.handleEvent(s,t._apiSpecificRenderWindow);return o?(t.widgetState.getBrush().setOrigin(...o),n&&e.invokeInteractionEvent(),_.EVENT_ABORT):_.VOID},e.handleLeftButtonRelease=s=>!n||Pn(s)?_.VOID:(n=!1,e.invokeEndInteractionEvent(),_.EVENT_ABORT),e.handleMouseWheel=()=>n?_.EVENT_ABORT:_.VOID,e.grabFocus=()=>{t.hasFocus||(t.hasFocus=!0,t._interactor.requestAnimation(e))},e.loseFocus=()=>{t.hasFocus&&t._interactor.cancelAnimation(e),t.hasFocus=!1}}function Fl(){return Ci.createBuilder().addStateFromMixin({labels:["brush"],name:"brush",mixins:["origin","scale1","visible","color"],initialValues:{scale1:1,origin:null,visible:!0}}).addField({name:"stencil",initialValue:null}).build()}function Nl(e,t){t.classHierarchy.push("vtkPaintWidget"),t.methodsToLink=["slicingIndex","indexToWorld","worldToIndex"],e.getRepresentationsForViewType=()=>[{builder:Bl,labels:["brush"]}],t.manipulator=ze.newInstance()}const $l={};function Gi(e,t,n={}){Object.assign(t,$l,n),fn.extend(e,t,{...n,behavior:Al,widgetState:Fl()}),_.get(e,t,["manipulator"]),Nl(e,t)}const Ul=_.newInstance(Gi,"vtkPaintWidget"),Hl={newInstance:Ul,extend:Gi};function Wl(e,t){const n=new Uint8Array(e*t),s=(m,w)=>{n[m+w*e]=1},o=(m,w,T)=>{const S=T*e+m,b=S+(w-m+1);n.fill(1,S,b)};let i=0,a=0,r=e-1,l=t-1,c=r,u=l;const d=u&1;let h=4*(1-c)*u*u,v=4*(d+1)*c*c,f=h+v+d*c*c,p=0;a+=Math.floor((u+1)/2),l=a-d,c*=8*c,u*=8*u;do o(i,r,a),o(i,r,l),p=2*f,p<=v&&(a++,l--,v+=c,f+=v),(p>=h||2*f>v)&&(i++,r--,h+=u,f+=h);while(i<=r);for(;a-l<t;)s(i-1,a),s(r+1,a++),s(i-1,l),s(r+1,l--);return n}class zl{constructor(){this.size=1,this.scale=[1,1],this.recomputeStencil()}setSize(t){this.size=Math.max(0,t),this.recomputeStencil()}setScale(t){this.scale=t,this.recomputeStencil()}recomputeStencil(){const t=[Math.ceil(this.size*this.scale[0]),Math.ceil(this.size*this.scale[1])];this.cachedStencil={size:t,pixels:Wl(t[0],t[1])}}getStencil(){return this.cachedStencil}}let jl=class{constructor(){this.factory=Hl.newInstance(),this.brush=new zl,this.brushValue=1}updateWidgetStencil(){const t=this.brush.getStencil();this.factory.getWidgetState().setStencil(t)}setBrushSize(t){this.brush.setSize(t),this.updateWidgetStencil()}setBrushScale(t){this.brush.setScale(t),this.updateWidgetStencil()}setBrushValue(t){this.brushValue=t}paintLabelmap(t,n,s,o){const i=this.brush.getStencil(),a=[...s.map(D=>Math.round(D))],r=a[n];a.splice(n,1);let l=[...a];o&&(l=[...o.map(D=>Math.round(D))],l.splice(n,1));const c=t.getPointData().getScalars().getData(),u=t.getDimensions(),d=u[0],h=u[0]*u[1],v=D=>D[0]>=0&&D[1]>=0&&D[2]>=0&&D[0]<u[0]&&D[1]<u[1]&&D[2]<u[2],{pixels:f,size:p}=i,m=Math.floor((p[0]-1)/2),w=Math.floor((p[1]-1)/2),T=[...a],S=[...l],b=[0,0,0],O=[0,0];for(let D=0;D<p[1];D++){const k=D-w,L=D*p[0];for(let $=0;$<p[0];$++){const K=$-m,Z=L+$;if(f[Z]){T[0]=a[0]+K,T[1]=a[1]+k,S[0]=l[0]+K,S[1]=l[1]+k;const M=S[0]-T[0],W=S[1]-T[1];let J=Math.abs(Math.abs(M)>Math.abs(W)?M:W);const _e=M/J,me=W/J;for([O[0],O[1]]=T;J-->=0;){if(O.splice(n,0,r),b[0]=Math.round(O[0]),b[1]=Math.round(O[1]),b[2]=Math.round(O[2]),v(b)){const Ge=b[0]+b[1]*d+b[2]*h;c[Ge]=this.brushValue}O.splice(n,1),O[0]+=_e,O[1]+=me}}}}t.modified()}};function Gl({paint:e,proxies:t,dicomIO:n}={}){const s={$paint:e??new jl,$proxies:t,$dicomIO:n??new Oi};return()=>s}var Xi=(e=>(e.Volume="View3D",e.Slice="View2D",e))(Xi||{});class Xl{constructor(t){this.viewProxies=new Map,this.dataProxies=new Map,this.proxyManager=t}delete(){const t=n=>this.proxyManager.deleteProxy(n);this.viewProxies.forEach(t),this.dataProxies.forEach(t)}createView(t,n){if(this.viewProxies.has(t))throw new Error("Cannot create a view with the same ID");const s=this.proxyManager.createProxy("Views",n,{name:n});return this.viewProxies.set(t,s),s}getView(t){return this.viewProxies.get(t)}removeView(t){const n=this.viewProxies.get(t);n&&(this.proxyManager.deleteProxy(n),this.viewProxies.delete(t))}addData(t,n){if(this.dataProxies.has(t))return;const s=this.proxyManager.createProxy("Sources","TrivialProducer");s.setInputData(n),this.dataProxies.set(t,s)}getData(t){return this.dataProxies.get(t)??null}updateData(t,n){const s=this.dataProxies.get(t);s&&s.setInputData(n)}deleteData(t){const n=this.dataProxies.get(t);if(this.dataProxies.delete(t),n)this.proxyManager.deleteProxy(n);else throw new Error("Did not find proxy for ID")}getDataRepresentationForView(t,n){const s=this.dataProxies.get(t),o=this.viewProxies.get(n);return!s||!o?null:this.proxyManager.getRepresentation(s,o)}}function ql(){const{exitPointerLock:e}=document;document.exitPointerLock=()=>{try{e==null||e.call(document)}catch{}}}const{VITE_SENTRY_DSN:qi}={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},Ki="error-reporting-off",Kl=!!qi,Yl=e=>{localStorage.getItem(Ki)!=="true"&&Kl&&ws({app:e,dsn:qi,integrations:[new Ss],tracesSampleRate:.1,replaysSessionSampleRate:.1,replaysOnErrorSampleRate:1})},Ql=()=>{Cs(200)};ee("error-reporting",()=>{const e=_s(Ki,"false"),t=B(e.value==="true");return F(t,()=>{e.value=String(t.value),t.value&&Ql()}),{disableReporting:t}});const Uo=[{username:"Mitchel",password:"12345"},{username:"Glisant",password:"12345"},{username:"admin",password:"admin123"}];const Zl={data(){return{timeofday:"Day",container:"container",invalidLogin:!1,loaded:!1}},created(){this.timeofday=this.getTimeOfDay(),this.container=`${this.container} ${this.timeofday.toLowerCase()}`,window.localStorage.setItem("userLoggedIn","GUEST USER")},mounted(){setTimeout(()=>{this.loaded=!0},100)},methods:{getTimeOfDay(){const e=new Date().getHours();return e>=5&&e<12?"Morning":e>=12&&e<18?"Afternoon":e>=18&&e<23?"Evening":"Day"},login(e){e.preventDefault(),Uo.find(n=>n.username===this.username&&n.password===this.password)?(window.localStorage.setItem("userLoggedIn",this.username),this.$router.push("/home")):(this.invalidLogin=!0,setTimeout(()=>{this.invalidLogin=!1},2e3))},signup(e){e.preventDefault();const t={username:this.username,password:this.password};Uo.push(t),this.$router.push("/home")},handleFocus(){this.invalidLogin=!1}}},Kt=e=>(ae("data-v-3dc8a6ef"),e=e(),se(),e),Jl=Kt(()=>g("h4",null,"Sign into your account",-1)),ec={for:"username"},tc=Kt(()=>g("p",null,"Username not found",-1)),nc=[tc],oc={for:"password"},ic=Kt(()=>g("p",null,"Invalid Password",-1)),ac=[ic],sc=Kt(()=>g("button",{type:"submit",style:{"align-self":"center"}},"Log In",-1)),rc=Kt(()=>g("h4",{style:{"margin-top":"40px"}},"Don't have an account?",-1));function lc(e,t,n,s,o,i){return R(),E("div",{class:N(o.container)},[g("div",{class:N(["login-form",{loaded:o.loaded}])},[g("h2",null,"Good "+U(o.timeofday),1),Jl,g("form",{onSubmit:t[5]||(t[5]=(...a)=>i.login&&i.login(...a))},[g("label",ec,[H("User name "),tt(g("input",{type:"text",id:"username","onUpdate:modelValue":t[0]||(t[0]=a=>e.username=a),onFocusin:t[1]||(t[1]=(...a)=>i.handleFocus&&i.handleFocus(...a)),required:""},null,544),[[An,e.username]])]),g("div",{class:N(["invalidLogin",{view:o.invalidLogin}])},nc,2),g("label",oc,[H("Password "),tt(g("input",{type:"password",id:"password","onUpdate:modelValue":t[2]||(t[2]=a=>e.password=a),required:""},null,512),[[An,e.password]])]),g("div",{class:N(["invalidLogin",{view:o.invalidLogin}])},ac,2),sc,rc,g("h4",{onClick:t[3]||(t[3]=(...a)=>i.signup&&i.signup(...a)),onKeydown:t[4]||(t[4]=nt(ue((...a)=>e.handleKeyDown&&e.handleKeyDown(...a),["prevent"]),["space"])),style:{color:"#0085ff"},class:"sign-up-b"}," Try as Guest ",32)],32)],2)],2)}const cc=A(Zl,[["render",lc],["__scopeId","data-v-3dc8a6ef"]]);const uc={props:{username:String},methods:{getTimeOfDay(){const e=new Date().getHours();return e>=5&&e<12?"Morning":e>=12&&e<18?"Afternoon":e>=18&&e<23?"Evening":"Night"}},data(){return{timeofday:"Day"}},created(){this.timeofday=this.getTimeOfDay()}},dc={class:"greeting"};function hc(e,t,n,s,o,i){return R(),E("div",dc,[g("h2",null,"Good "+U(o.timeofday)+",",1),g("h1",null,U(n.username),1)])}const gc=A(uc,[["render",hc],["__scopeId","data-v-91098397"]]);const fc={emits:["removePatient"],props:{patient:Object},methods:{updatepatient(e){window.localStorage.setItem("currentPatient",JSON.stringify(e))},handleMouseOver(){this.isHovered=!0,this.$refs.patientElement.focus()},handleMouseOut(){this.patient&&(this.isHovered=!1,this.$refs.patientElement.blur())},handleKeyDown(e){e.key==="Delete"&&this.$emit("removePatient",this.patient)}},data(){return{isHovered:!1,currentPatient:""}}};function pc(e,t,n,s,o,i){const a=V("router-link");return R(),Y(a,{to:"/analysis",style:{"text-decoration":"none"}},{default:x(()=>[g("div",{class:"patient",tabindex:"-1",onMouseover:t[0]||(t[0]=(...r)=>i.handleMouseOver&&i.handleMouseOver(...r)),onFocusin:t[1]||(t[1]=(...r)=>i.handleMouseOver&&i.handleMouseOver(...r)),onClick:t[2]||(t[2]=r=>i.updatepatient(n.patient)),onKeydown:t[3]||(t[3]=(...r)=>i.handleKeyDown&&i.handleKeyDown(...r)),onMouseout:t[4]||(t[4]=(...r)=>i.handleMouseOut&&i.handleMouseOut(...r)),onFocusout:t[5]||(t[5]=(...r)=>i.handleMouseOut&&i.handleMouseOut(...r)),ref:"patientElement"},[g("h3",{class:N({hovered:o.isHovered})},U(n.patient.name),3),g("h3",{class:N({hovered:o.isHovered})},U(n.patient.lastname),3),g("h3",{class:N({hovered:o.isHovered})},U(n.patient.dob),3),g("h3",{class:N({hovered:o.isHovered})},U(n.patient.gender),3),g("h3",{class:N({hovered:o.isHovered})},U(n.patient.scandate),3),g("h3",{class:N({hovered:o.isHovered})},U(n.patient.scanlocation),3)],544)]),_:1})}const mc=A(fc,[["render",pc],["__scopeId","data-v-59020a19"]]);const vc={},yc={class:"loading-container"},wc=g("div",{class:"loading-spinner"},null,-1),Sc=g("p",{class:"loading-text"},"Loading...",-1),_c=[wc,Sc];function Cc(e,t){return R(),E("div",yc,_c)}const Yi=A(vc,[["render",Cc]]);const bc={emits:["removePatient"],props:{patients:{type:Array},filter:{type:String,default:""}},data(){return{loaded:!1}},computed:{filteredPatients(){const e=this.filter.toLowerCase().replace(/\s/g,"");return e===""?this.patients:this.patients.filter(t=>t.name.toLowerCase().includes(e)||t.lastname.toLowerCase().includes(e)||t.scanlocation.toLowerCase().includes(e))}},methods:{handleRemovePatient(e){this.$emit("removePatient",e)}},components:{PatientElement:mc,LoadingScreen:Yi},mounted(){setTimeout(()=>{this.loaded=!0},600)}},Tc=e=>(ae("data-v-93ac9fd2"),e=e(),se(),e),Ic=Tc(()=>g("div",{class:"patient-header"},[g("h3",null,"Last Name"),g("h3",null,"First Name"),g("h3",null,"Date of Birth"),g("h3",null,"Gender"),g("h3",null,"Scan Date"),g("h3",null,"Scan Location")],-1)),Rc={key:0,class:"patient-container"},xc={key:1};function Dc(e,t,n,s,o,i){const a=V("PatientElement"),r=V("LoadingScreen");return R(),E(ie,null,[Ic,o.loaded?(R(),E("div",Rc,[(R(!0),E(ie,null,Pe(i.filteredPatients,l=>(R(),E("div",{key:l.id},[y(a,{patient:l,onRemovePatient:i.handleRemovePatient},null,8,["patient","onRemovePatient"])]))),128))])):(R(),E("div",xc,[y(r)]))],64)}const Ec=A(bc,[["render",Dc],["__scopeId","data-v-93ac9fd2"]]),Ho=0,_t=ee("id",()=>{let e=Ho;return{nextId(){return String(++e)},reset(){e=Ho}}}),Yn=["Sagittal","Coronal","Axial"];function gt(){return{Sagittal:0,Coronal:0,Axial:0}}function Qi(){return{Sagittal:[0,0],Coronal:[0,0],Axial:[0,0]}}function $e(e,t,n){const s=2*n[t];return e.slice(s,s+2)}function be(e){switch(e){case"Superior":case"Inferior":return"Axial";case"Left":case"Right":return"Sagittal";case"Posterior":case"Anterior":return"Coronal";default:throw new Error(`Invalid LPS direction: ${e}`)}}const Zi=()=>({Left:Ye(1,0,0),Right:Ye(-1,0,0),Posterior:Ye(0,1,0),Anterior:Ye(0,-1,0),Superior:Ye(0,0,1),Inferior:Ye(0,0,-1),Sagittal:0,Coronal:1,Axial:2});function Ji(e){const t=[0,1,2],n=[0,1,2],s=Zi();for(let o=0;o<3;o++){let i=0,a=[0,0],r=[0,0];t.forEach((f,p)=>{n.forEach((m,w)=>{const T=e[f*3+m];Math.abs(T)>Math.abs(i)&&(i=T,a=[f,m],r=[p,w])})});const[l,c]=a,u=e.slice(l*3,(l+1)*3),d=Math.sign(i),h=u.map(f=>f*d),v=u.map(f=>f*-d);c===0?(s.Left=h,s.Right=v,s.Sagittal=l):c===1?(s.Posterior=h,s.Anterior=v,s.Coronal=l):c===2&&(s.Superior=h,s.Inferior=v,s.Axial=l),t.splice(r[0],1),n.splice(r[1],1)}return s}var ce=(e=>(e.WindowLevel="WindowLevel",e.Pan="Pan",e.Zoom="Zoom",e.Ruler="Ruler",e.Paint="Paint",e.Rectangle="Rectangle",e.Crosshairs="Crosshairs",e.Crop="Crop",e.Contour="Contour",e))(ce||{}),Ie=(e=>(e.V="V",e.H="H",e))(Ie||{}),yn=(e=>(e.DICOM="dicom",e.IMAGE="image",e))(yn||{});const Lc=C.nativeEnum(yn),Oc=C.union([C.literal("Left"),C.literal("Right"),C.literal("Posterior"),C.literal("Anterior"),C.literal("Superior"),C.literal("Inferior")]),Pc=C.object({id:C.string(),path:C.string(),type:Lc}),Vc=C.object({archiveSrc:C.object({path:C.string()}).optional(),uriSrc:C.object({uri:C.string(),name:C.string()}).optional()}),ea=Vc.extend({parent:C.lazy(()=>ea.optional())}),kc=C.nativeEnum(Ie),ta=C.lazy(()=>C.object({name:C.string().optional(),direction:kc,items:C.array(C.union([ta,C.string()]))})),Ne=C.tuple([C.number(),C.number(),C.number()]),Mc=C.object({width:C.number(),level:C.number(),min:C.number(),max:C.number()}),Bc=C.object({slice:C.number(),min:C.number(),max:C.number(),axisDirection:Oc}),Ac=C.object({parallelScale:C.number().optional(),position:Ne.optional(),focalPoint:Ne.optional(),directionOfProjection:Ne.optional(),viewUp:Ne.optional()}),Qn=C.object({arrayName:C.string(),location:C.string()}),Fc=C.object({position:C.number(),height:C.number(),width:C.number(),xBias:C.number(),yBias:C.number()}),Nc=C.object({x:C.number(),y:C.number(),midpoint:C.number(),sharpness:C.number()}),$c=C.object({mode:C.literal(xe.Mode.Gaussians),gaussians:Fc.array(),mappingRange:C.tuple([C.number(),C.number()])}),Uc=C.object({mode:C.literal(xe.Mode.Points),preset:C.string(),shift:C.number(),mappingRange:C.tuple([C.number(),C.number()])}),Hc=C.object({mode:C.literal(xe.Mode.Nodes),nodes:Nc.array(),mappingRange:C.tuple([C.number(),C.number()])}),Zn=C.union([$c,Uc,Hc]),Jn=C.object({preset:C.string(),mappingRange:C.tuple([C.number(),C.number()])});C.object({colorBy:Qn,transferFunction:Jn,opacityFunction:Zn});const Wc=C.object({enabled:C.boolean(),lightFollowsCamera:C.boolean(),volumeQuality:C.number(),useVolumetricScatteringBlending:C.boolean(),volumetricScatteringBlending:C.number(),useLocalAmbientOcclusion:C.boolean(),laoKernelSize:C.number(),laoKernelRadius:C.number(),ambient:C.number(),diffuse:C.number(),specular:C.number()}),zc=C.object({colorBy:Qn,transferFunction:Jn,opacityFunction:Zn,cvr:Wc}),jc=C.object({opacity:C.number()}),Gc=C.object({colorBy:Qn,transferFunction:Jn,opacityFunction:Zn,blendConfig:jc}),Xc=C.object({window:Mc.optional(),slice:Bc.optional(),layers:Gc.optional(),camera:Ac.optional(),volumeColorConfig:zc.optional()}),qc=C.union([C.literal("2D"),C.literal("3D")]),Kc=C.object({id:C.string(),type:qc,props:C.record(C.any()),config:C.record(Xc)}),Yc=C.object({id:C.string(),parent:C.string(),path:C.string()});C.union([C.literal("Axial"),C.literal("Sagittal"),C.literal("Coronal")]);const Qc=C.object({planeOrigin:Ne,planeNormal:Ne}),Zc=C.object({imageID:C.string(),frameOfReference:Qc,slice:C.number(),id:C.string(),name:C.string(),color:C.string(),label:C.string().optional(),labelName:C.string().optional()}),na=e=>C.object({tools:C.array(e),labels:C.record(e.partial())}),oa=Zc.extend({firstPoint:Ne,secondPoint:Ne}),Jc=na(oa),eu=oa.extend({id:C.string(),fillColor:C.string().optional()}),tu=na(eu),nu=C.object({position:Ne}),ou=C.nativeEnum(ce),iu=C.object({activeLabelmapID:C.string().nullable(),brushSize:C.number(),brushValue:C.number(),labelmapOpacity:C.number()}),au=C.object({Sagittal:C.tuple([C.number(),C.number()]),Coronal:C.tuple([C.number(),C.number()]),Axial:C.tuple([C.number(),C.number()])}),su=C.record(au),ru=C.object({rulers:Jc.optional(),rectangles:tu.optional(),crosshairs:nu,paint:iu,crop:su,current:ou}),lu=C.object({selectionKey:C.string(),sourceSelectionKeys:C.string().array()}).array(),cu=C.object({version:C.string(),datasets:Pc.array(),remoteFiles:C.record(ea.array()),labelMaps:Yc.array(),tools:ru,views:Kc.array(),primarySelection:C.string().optional(),layout:ta,parentToLayers:lu}),ia=e=>({fileSrc:{file:e,fileType:e.type}});function aa(e){return!!e.uriSrc||!!e.parent&&aa(e.parent)}function sa(e){const t={...e};return delete t.fileSrc,t.parent&&(t.parent=sa(t.parent)),t}const st=ee("files",{state:()=>({byDataID:{}}),getters:{getDataSources:e=>t=>e.byDataID[t]??[],getFiles:e=>t=>(e.byDataID[t]??[]).map(n=>n.fileSrc.file)},actions:{remove(e){e in this.byDataID&&delete this.byDataID[e]},add(e,t){this.byDataID[e]=t}}});async function ra(e,t,n){const s=st(),{zip:o}=e,{manifest:{datasets:i,remoteFiles:a}}=e;t.forEach(r=>{const l=s.getDataSources(r);if(!l.length)throw new Error(`No files for dataID: ${r}`);const[c,u]=vn(aa,l);a[r]=c.map(sa);const d=`data/${r}/`;u.forEach(h=>{const{file:v}=h.fileSrc,f=`${d}/${v.name}`;o.file(f,v)}),i.push({id:r,path:d,type:n})})}const la=()=>({name:"(none)",orientation:ri(),lpsOrientation:Zi(),spacing:Ye(1,1,1),origin:De(),dimensions:Ye(1,1,1),worldBounds:[0,1,0,1,0,1],worldToIndex:pt(),indexToWorld:pt()}),Le=ee("images",{state:()=>({idList:[],dataIndex:Object.create(null),metadata:Object.create(null)}),actions:{addVTKImageData(e,t){const n=_t().nextId();return this.idList.push(n),this.dataIndex[n]=t,this.$proxies.addData(n,t),this.metadata[n]={...la(),name:e},this.updateData(n,t),n},updateData(e,t){if(e in this.metadata){const n={name:this.metadata[e].name,dimensions:t.getDimensions(),spacing:t.getSpacing(),origin:t.getOrigin(),orientation:t.getDirection(),lpsOrientation:Ji(t.getDirection()),worldBounds:t.getBounds(),worldToIndex:t.getWorldToIndex(),indexToWorld:t.getIndexToWorld()};this.metadata[e]=n}this.$proxies.updateData(e,t),this.dataIndex[e]=t},deleteData(e){e in this.dataIndex&&(delete this.dataIndex[e],delete this.metadata[e],Nt(this.idList,e))},async serialize(e){const t=st(),n=this.idList.filter(s=>s in t.byDataID);await ra(e,n,yn.IMAGE)}}}),uu="Anonymous",du="ANONYMOUS";function hu(e,t){return`${e}!!${t}`}const gu=(e,t)=>e.readTags(t,[{name:"PatientName",tag:"0010|0010",strconv:!0},{name:"PatientID",tag:"0010|0020",strconv:!0},{name:"PatientBirthDate",tag:"0010|0030"},{name:"PatientSex",tag:"0010|0040"},{name:"StudyInstanceUID",tag:"0020|000d"},{name:"StudyDate",tag:"0008|0020"},{name:"StudyTime",tag:"0008|0030"},{name:"StudyID",tag:"0020|0010",strconv:!0},{name:"AccessionNumber",tag:"0008|0050"},{name:"StudyDescription",tag:"0008|1030",strconv:!0},{name:"Modality",tag:"0008|0060"},{name:"SeriesInstanceUID",tag:"0020|000e"},{name:"SeriesNumber",tag:"0020|0011"},{name:"SeriesDescription",tag:"0008|103e",strconv:!0}]),we=ee("dicom",{state:()=>({sliceData:{},volumeToImageID:{},imageIDToVolumeKey:{},patientInfo:{},patientStudies:{},studyInfo:{},studyVolumes:{},volumeInfo:{},volumeStudy:{},studyPatient:{},needsRebuild:{}}),actions:{async importFiles(e){if(!e.length)return[];const t=this.$dicomIO,n=new Map(e.map(a=>[a.fileSrc.file,a])),s=[...n.keys()],o=await t.categorizeFiles(s),i=st();return Object.entries(o).forEach(([a,r])=>{const l=r.map(c=>{const u=n.get(c);if(!u)throw new Error("Did not match File with source DataSource");return u});i.add(a,l)}),await Promise.all(Object.entries(o).map(async([a,r])=>{if(!(a in this.volumeInfo)){const l=await gu(t,r[0]),c={PatientID:l.PatientID||du,PatientName:l.PatientName||uu,PatientBirthDate:l.PatientBirthDate||"",PatientSex:l.PatientSex||""},u=No(l,"StudyID","StudyInstanceUID","StudyDate","StudyTime","AccessionNumber","StudyDescription"),d={...No(l,"Modality","SeriesInstanceUID","SeriesNumber","SeriesDescription"),NumberOfSlices:r.length,VolumeID:a};this._updateDatabase(c,u,d)}a in this.volumeToImageID&&(this.needsRebuild[a]=!0)})),Object.keys(o)},_updateDatabase(e,t,n){const s=e.PatientID,o=t.StudyInstanceUID,i=n.VolumeID;s in this.patientInfo||(this.patientInfo[s]=e,this.patientStudies[s]=[]),o in this.studyInfo||(this.studyInfo[o]=t,this.studyVolumes[o]=[],this.studyPatient[o]=s,this.patientStudies[s].push(o)),i in this.volumeInfo||(this.volumeInfo[i]=n,this.volumeStudy[i]=o,this.sliceData[i]={},this.studyVolumes[o].push(i))},deleteVolume(e){const t=Le();if(e in this.volumeInfo){const n=this.volumeStudy[e];if(delete this.volumeInfo[e],delete this.sliceData[e],delete this.volumeStudy[e],e in this.volumeToImageID){const s=this.volumeToImageID[e];t.deleteData(s),delete this.volumeToImageID[e],delete this.imageIDToVolumeKey[s]}Nt(this.studyVolumes[n],e),this.studyVolumes[n].length===0&&this.deleteStudy(n)}},deleteStudy(e){if(e in this.studyInfo){const t=this.studyPatient[e];delete this.studyInfo[e],delete this.studyPatient[e],[...this.studyVolumes[e]].forEach(n=>this.deleteVolume(n)),delete this.studyVolumes[e],Nt(this.patientStudies[t],e),this.patientStudies[t].length===0&&this.deletePatient(t)}},deletePatient(e){e in this.patientInfo&&(delete this.patientInfo[e],[...this.patientStudies[e]].forEach(t=>this.deleteStudy(t)),delete this.patientStudies[e])},async serialize(e){const t=Object.keys(this.volumeInfo);await ra(e,t,yn.DICOM)},async deserialize(e){return this.importFiles(e).then(t=>{if(t.length!==1)throw new Error("Invalid state file.");return t[0]})},async getVolumeSlice(e,t,n=!1){const s=this.$dicomIO,o=st(),i=hu(t,n);if(e in this.sliceData&&i in this.sliceData[e])return this.sliceData[e][i];if(!(e in this.volumeInfo))throw new Error(`Cannot find given volume key: ${e}`);const r=this.volumeInfo[e].NumberOfSlices;if(t<1||t>r)throw new Error(`Slice ${t} is out of bounds`);const l=o.getFiles(e);if(!l)throw new Error(`No files found for volume key: ${e}`);const c=l[t-1],u=await s.getVolumeSlice(c,n);return this.sliceData[e][i]=u,u},async getVolumeThumbnail(e){const{NumberOfSlices:t}=this.volumeInfo[e],n=Math.ceil(t/2);return this.getVolumeSlice(e,n,!0)},async buildVolume(e,t=!1){const n=Le(),s=this.$dicomIO;if(!(t||this.needsRebuild[e])&&this.volumeToImageID[e]){const c=this.volumeToImageID[e];return n.dataIndex[c]}const a=st().getFiles(e);if(!a)throw new Error("No files for volume key");const r=un.convertItkToVtkImage(await s.buildImage(a)),l=this.volumeToImageID[e];if(l)n.updateData(l,r);else{const c=this.volumeInfo[e].SeriesInstanceUID,u=n.addVTKImageData(c,r);this.imageIDToVolumeKey[u]=e,this.volumeToImageID[e]=u}return delete this.needsRebuild[e],r}}}),ca=ee("models",{state:()=>({idList:[],dataIndex:{},metadata:{}}),actions:{addVTKPolyData(e,t){const n=_t().nextId();return this.idList.push(n),this.dataIndex[n]=t,this.$proxies.addData(n,t),n}}}),fu=ee("message",{state:()=>({_nextID:1,byID:{},msgList:[]}),getters:{messages(){return this.msgList.map(e=>this.byID[e])},importantMessages(){return this.messages.filter(e=>e.type!==3)}},actions:{addError(e,t){return t instanceof Error?this._addMessage({type:0,title:e},{details:String(t),persist:!1}):this._addMessage({type:0,title:e},t)},addWarning(e,t){return this._addMessage({type:1,title:e},t)},addInfo(e,t){return this._addMessage({type:2,title:e},t)},addSuccess(e,t){return this._addMessage({type:3,title:e},t)},clearOne(e){e in this.byID&&(Nt(this.msgList,e),delete this.byID[e])},clearAll(){this.byID={},this.msgList=[]},_addMessage(e,t){const n=String(this._nextID++),s={persist:!1,...typeof t=="string"?{details:t}:t};return this.byID[n]={...e,options:s,id:n},this.msgList.push(n),n}}});async function eo(e,t){try{return await t()}catch(n){n instanceof Error&&fu().addError(e,{details:`${n}. More details can be found in the developer's console.`}),console.error(n)}}const $t=e=>({type:"dicom",volumeKey:e}),Ut=e=>({type:"image",dataID:e}),ua=e=>{if(e.type==="image")return e.dataID;if(e.type==="dicom")return we().volumeToImageID[e.volumeKey];const t=e;throw new Error(`invalid selection type ${t}`)},pu=async e=>{const t=Le(),n=we();return e.type==="dicom"?(await eo("Failed to build volume",()=>n.buildVolume(e.volumeKey)),t.dataIndex[ua(e)]):t.dataIndex[e.dataID]},da=e=>we().imageIDToVolumeKey[e]??e,ha=e=>we().volumeToImageID[e]??e;function mu(e,t){return e.type==="dicom"&&t.type==="dicom"?e.volumeKey===t.volumeKey:e.type==="image"&&t.type==="image"?e.dataID===t.dataID:!1}const Yt=ee("dataset",()=>{const e=Le(),t=ca(),n=we(),s=st(),o=B(null),i=I(()=>{if(o.value)return ua(o.value)}),a=I(()=>{const{dataIndex:d}=e;return i.value&&d[i.value]||null}),r=I(()=>[...e.idList,...t.idList]);function l(d){return this.$proxies.getData(d)}function c(d){o.value=d,d!==null&&d.type==="dicom"&&eo("Failed to build volume",()=>n.buildVolume(d.volumeKey))}async function u(d){if(await n.serialize(d),await e.serialize(d),o.value!==null){let h=null;o.value.type==="dicom"?h=o.value.volumeKey:h=o.value.dataID;const{manifest:v}=d;v.primarySelection=h}}return e.$onAction(({name:d,args:h,after:v})=>{d==="deleteData"&&v(()=>{const[f]=h,p=o.value;(p==null?void 0:p.type)==="image"&&p.dataID===f&&(o.value=null),s.remove(f)})}),n.$onAction(({name:d,args:h,after:v})=>{d==="deleteVolume"&&v(()=>{const[f]=h,p=o.value;(p==null?void 0:p.type)==="dicom"&&f===p.volumeKey&&(o.value=null),s.remove(f)})}),{primarySelection:o,primaryDataset:a,allDataIDs:r,getDataProxyByID:l,setPrimarySelection:c,serialize:u}});function vu(e,t,n){return{message:e,inputDataStackTrace:[t],cause:n}}const Vn=Symbol("DoneSentinel");class wn{constructor(t){this.handlers=Array.from(t??[])}async execute(t,n){return this.startExecutionContext(t,n)}async startExecutionContext(t,n){const s=[...this.handlers],o=[],i=Mi(),a=(h,v)=>{v?i.reject(v):i.resolve(h)},r=async(h,v)=>{let f=!1,p;const m=v>=s.length,w={done:S=>{if(f)throw new Error("done() called twice!");return f=!0,p=S,Vn},execute:async(S,b)=>{const O=this.execute(S,b??n);return o.push(O),O},extra:n};let T;m&&(T=Vn);try{if(m)T=Vn;else{const S=s[v];T=await S(h,w)}}catch(S){const b=S instanceof Error?S:new Error(S?String(S):"Unknown error occurred");a(void 0,b);return}if(f||m){a(p);return}r(T,v+1)},l={ok:!0,data:[],errors:[]};try{await r(t,0);const h=await i.promise;h!=null&&l.data.push(h)}catch(h){const v=h instanceof Error?h.message:String(h);l.ok=!1,l.errors.push(vu(v,t,h))}const c=await Promise.all(o),[u,d]=vn(h=>h.ok,c);return d.length>0&&(l.ok=!1),u.forEach(h=>{l.data.push(...h.data)}),d.forEach(h=>{const{errors:v}=h;v.forEach(f=>{f.inputDataStackTrace.push(t)}),l.errors.push(...v)}),l}}const yu=(e,{extra:t,done:n})=>{const{fileSrc:s}=e;return t!=null&&t.dicomDataSources&&(s==null?void 0:s.fileType)==="application/dicom"?(t.dicomDataSources.push(e),n()):e},wu={testURL:e=>{const{protocol:t}=new Tt(e,window.location.href);return t==="http:"||t==="https:"},fetchURL:async(e,t={})=>{var c;const{progress:n}=t,s=await fetch(e);if(s.status!==200)throw new Error(`Fetching resource failed (HTTP code ${s.status})`);if(!n)return s.blob();const o=Number(s.headers.get("content-length"))??-1;if(o<0)return n(1/0),s.blob();const i=(c=s.body)==null?void 0:c.getReader();if(!i)return null;const a=new Uint8Array(o);let r=0,l=!1;do{const u=await i.read();l=u.done,u.value&&!l&&(a.set(u.value,r),r+=u.value.length,n(r/o))}while(!l);return new Blob([a])}},to=[wu];function Su(e){return!!to.find(t=>t.testURL(e))}async function _u(e,t,n){const s=to.find(a=>a.testURL(e));if(!s)throw new Error(`Cannot find a handler for URL: ${e}`);const o=n==null?void 0:n.cache;if(o!=null&&o.has(e))return o.get(e);const i=s.fetchURL(e,n).then(a=>{if(!a)throw new Error(`Failed to download ${e}`);return new File([a],t)});return i.catch(()=>{o==null||o.delete(e)}),o==null||o.set(e,i),i}async function Cu(e,t){const n=to.find(a=>a.testURL(e));if(!n)throw new Error(`Cannot find a handler for URL: ${e}`);const s=await n.fetchURL(e,t);if(!s)throw new Error(`Failed to download ${e}`);const o=await s.arrayBuffer(),i=new TextDecoder;return JSON.parse(i.decode(new Uint8Array(o)))}const ga=async(e,{execute:t,done:n,extra:s})=>{const{fileSrc:o,uriSrc:i}=e;if(!o&&i&&Su(i.uri))try{const a=await _u(i.uri,i.name,{cache:s==null?void 0:s.fetchFileCache});return t({...e,fileSrc:{file:a,fileType:""}}),n()}catch(a){throw new Error(`Could not download URL ${i.uri}`,{cause:a instanceof Error?a:void 0})}return e};async function no(e){const t=await li.loadAsync(e),n=[],s=[];return t.forEach((o,i)=>{if(!i.dir){const a=Qr(i.name),r=Yr(i.name),l=t.file(i.name);l&&(n.push(l.async("blob").then(c=>new File([c],a))),s.push(r))}}),Promise.all(n).then(o=>o.map((i,a)=>({file:i,archivePath:s[a]})))}function fa(e){return!!e.fileSrc&&Pi.has(e.fileSrc.fileType)}const bu=async(e,{execute:t,done:n})=>fa(e)?((await no(e.fileSrc.file)).forEach(o=>{t({fileSrc:{file:o.file,fileType:""},archiveSrc:{path:`${o.archivePath}/${o.file.name}`},parent:e})}),n()):e;async function Tu(e,t){let n=t==null?void 0:t.get(e);return n||(n=no(e).then(s=>s.reduce((o,i)=>{const a=St(i.archivePath,i.file.name);return Object.assign(o,{[a]:i.file})},{})),t&&t.set(e,n),n)}const pa=async(e,{extra:t,execute:n,done:s})=>{const{fileSrc:o,archiveSrc:i,parent:a}=e,{archiveCache:r}=t??{};if(!o&&i&&a){if(!(a!=null&&a.fileSrc))throw new Error("Cannot extract an archive target with an unresolved parent");if(!fa(a))throw new Error("Parent is not a supported archive file");const l=await Tu(a.fileSrc.file,r),c=wt(i.path),u=l[c];if(!u)throw new Error(`Failed to find archive member ${c}`);return n({...e,fileSrc:{file:u,fileType:""}}),s()}return e},Iu=e=>new Tt(e).protocol==="s3:";function Ru(e,t){return`https://${e}.s3.amazonaws.com/${t}`}async function xu(e,t,n=()=>{}){const s=new bs({region:"us-east-1",signer:{sign:async i=>i}}),o=async i=>{const a=new Ts({Bucket:e,Prefix:t,ContinuationToken:i,MaxKeys:1e3});let r;try{r=await s.send(a)}catch(l){throw console.error(l),l}if(!r.Contents)throw new Error("S3 returned no objects");r.Contents.forEach(l=>{if(!l.Key)return;const c=l.Key,u=Ru(e,l.Key);n(c,u)}),r.IsTruncated&&r.NextContinuationToken&&await o(r.NextContinuationToken)};await o()}const Du=e=>{const{hostname:t,pathname:n}=new Tt(e),s=n.replace(/^\//,"");return[t,s]},Eu=async(e,t=()=>{})=>{const[n,s]=Du(e);await xu(n,s,t)},Lu=async(e,{execute:t,done:n})=>{const{uriSrc:s}=e;if(s&&Iu(s.uri))try{return await Eu(s.uri,(o,i)=>{t({uriSrc:{uri:i,name:o},parent:e})}),n()}catch(o){throw new Error(`Could not download S3 URI ${s.uri}`,{cause:o instanceof Error?o:void 0})}return e},Ou=e=>new Tt(e).protocol==="gs:",Pu=e=>{const{hostname:t,pathname:n}=new Tt(e),s=n.replace(/^\//,"");return[t,s]},Vu=e=>`https://storage.googleapis.com/storage/v1/b/${e}/o`;async function ku(e,t,n=()=>{}){const s=[],o=async i=>{const a=new Tt(Vu(e));a.searchParams.append("prefix",t),a.searchParams.append("maxResults","1000"),i&&a.searchParams.append("pageToken",i);const r=await Cu(a.toString());if(r.kind!=="storage#objects")throw new Error("GCS did not return a list of objects!");s.push(...r.items),r.items.forEach(l=>n(l)),r.nextPageToken&&await o(r.nextPageToken)};return await o(),s}const Mu=async(e,t=()=>{})=>{const[n,s]=Pu(e);return ku(n,s,t)},Bu=async(e,{execute:t,done:n})=>{const{uriSrc:s}=e;if(s&&Ou(s.uri))try{return await Mu(s.uri,o=>{t({uriSrc:{uri:o.mediaLink,name:o.name},parent:e})}),n()}catch(o){throw new Error(`Could not download GCS URI ${s.uri}`,{cause:o instanceof Error?o:void 0})}return e},Au=async(e,{done:t})=>{if(!e.fileSrc)return e;const{fileSrc:n}=e;if(!Un.has(n.fileType))return e;const o=await Un.get(n.fileType)(n.file),i=st();if(o.isA("vtkImageData")){const a=Le().addVTKImageData(n.file.name,o);return i.add(a,[e]),t({dataID:a,dataSource:e,dataType:"image"})}if(o.isA("vtkPolyData")){const a=ca().addVTKPolyData(n.file.name,o);return i.add(a,[e]),t({dataID:a,dataSource:e,dataType:"model"})}throw new Error("Data reader did not produce a valid dataset")},Fu=C.object({url:C.string(),name:C.optional(C.string())}),Nu=C.object({resources:C.array(Fu)});async function $u(e){const t=new TextDecoder,n=await e.arrayBuffer(),s=t.decode(new Uint8Array(n));return Nu.parse(JSON.parse(s))}const Uu=async(e,{done:t,execute:n})=>{const{fileSrc:s}=e;if((s==null?void 0:s.fileType)==="application/json"){const o=[];try{(await $u(s.file)).resources.forEach(a=>{o.push({uriSrc:{uri:a.url,name:a.name??new URL(a.url).pathname},parent:e})})}catch{return e}return o.forEach(i=>{n(i)}),t()}return e};function Hu(e,t){t.classHierarchy.push("vtkLabelMap"),t.colorMap===null&&(t.colorMap={0:[0,0,0,0],1:[0,0,0,255]})}const Wu={colorMap:null};function ma(e,t,n={}){Object.assign(t,Wu,n),bi.extend(e,t,n),_.setGet(e,t,["colorMap"]),Hu(e,t)}const zu=_.newInstance(ma,"vtkLabelMap"),va={newInstance:zu,extend:ma},le={Coronal:"Coronal",Sagittal:"Sagittal",Axial:"Axial",Three:"3D"},ya={[le.Coronal]:{viewType:"2D",props:{viewDirection:"Right",viewUp:"Superior"}},[le.Sagittal]:{viewType:"2D",props:{viewDirection:"Posterior",viewUp:"Superior"}},[le.Axial]:{viewType:"2D",props:{viewDirection:"Superior",viewUp:"Anterior"}},[le.Three]:{viewType:"3D",props:{viewDirection:"Posterior",viewUp:"Superior"}}},ju=ya[le.Axial];[{name:"Axial Only",direction:Ie.H,items:[le.Axial]},{name:"Axial Primary",direction:Ie.V,items:[le.Axial,{direction:Ie.H,items:[le.Three,le.Coronal,le.Sagittal]}]},{name:"3D Primary",direction:Ie.V,items:[le.Three,{direction:Ie.H,items:[le.Coronal,le.Sagittal,le.Axial]}]},{name:"Quad View",direction:Ie.H,items:[{direction:Ie.V,items:[le.Coronal,le.Three]},{direction:Ie.V,items:[le.Sagittal,le.Axial]}]},{name:"3D Only",direction:Ie.H,items:[le.Three]}].reduce((e,t)=>({...e,[t.name]:t}),{});const kt={0:[0,0,0,0],1:[153,153,0,255],2:[76,76,0,255],3:[255,255,0,255],4:[0,76,0,255],5:[0,153,0,255],6:[0,255,0,255],7:[76,0,0,255],8:[153,0,0,255],9:[255,0,0,255],10:[0,76,76,255],11:[0,153,153,255],12:[0,255,255,255],13:[0,0,76,255],14:[0,0,153,255]},Gu=["#58f24c","#8de4d3","#f0a4b1","#a3c9fe","#c8f251","#fea53b"],Xu={red:{color:"red"},green:{color:"#00ff00"},white:{color:"#ffffff"}},qu={artifact:{color:"#888888",fillColor:"#ffbf0040"},innocuous:{color:"#00ff00",fillColor:"#00ff0020"},lesion:{color:"red",fillColor:"transparent"}},Wo={CT:"CT-AAA",MR:"CT-Coronary-Arteries-2",US:"US-Fetal"},Ku=Uint8Array;function Yu(e){const t=new Ku(e.getNumberOfPoints()),n=va.newInstance(e.get("spacing","origin","direction"));return n.getPointData().setScalars(Ti.newInstance({numberOfComponents:1,values:t})),n.setDimensions(e.getDimensions()),n.computeTransforms(),n.setColorMap(kt),n}function Qu(e){const t=va.newInstance(e.get("spacing","origin","direction","indexToWorld","worldToIndex","dataDescription","pointData"));return t.setDimensions(e.getDimensions()),t.computeTransforms(),t.setColorMap(kt),t}const hn=ee("labelmap",{state:()=>({idList:[],labelmaps:Object.create(null),parentImage:Object.create(null)}),actions:{newLabelmapFromImage(e){const n=Le().dataIndex[e];if(!n)return null;const s=_t().nextId(),o=Yu(n);return this.idList.push(s),this.parentImage[s]=e,this.labelmaps[s]=o,this.$proxies.addData(s,o),s},async serialize(e){const{labelMaps:t}=e.manifest,{zip:n}=e;await Promise.all(Object.entries(this.labelmaps).map(async([s,o])=>{const i=`labels/${s}.vti`,a=da(this.parentImage[s]);t.push({id:s,parent:a,path:i});const r=await dl(o);n.file(i,r)}))},async deserialize(e,t,n){const{labelMaps:s}=e,o={};return s.forEach(async i=>{const[a]=t.filter(d=>St(d.archivePath,d.file.name)===wt(i.path)).map(d=>d.file);i.parent=n[i.parent];const{parent:r}=i,l=_t().nextId();o[i.id]=l;const c=await Fi(a),u=Qu(c);this.idList.push(l),this.parentImage[l]=ha(r),this.labelmaps[l]=u,this.$proxies.addData(l,u)}),o}}});async function Zu(e,t,n,s=[{type:Ke.Image}]){const o=navigator.hardwareConcurrency?navigator.hardwareConcurrency:6,i=n[0],a=Math.min(parseInt(o/2,10),Math.max(i.size[i.size.length-1],1),4),r=a.toString(),l=[...Array(a).keys()].map(v=>{const f=[...[...Array(n.length).keys()].map(m=>m.toString()),"0",...t,"--max-total-splits",r,"--split",v.toString(),"--number-of-splits",r,"--memory-io"],p=n.map(m=>({type:Ke.Image,data:Is(m)}));return[e,f,s,p,St("/","/itk/pipelines"),St("/","/itk/pipeline.worker.js")]}),c=new Rs(o,ii),u=await c.runTasks(l).promise;c.terminateWorkers();const h=u.filter(v=>v.returnValue===0).map(({outputs:v})=>v[0].data);return xs(h)}const Ju=["size","direction","origin","spacing"];function ed(e,t){return Ju.map(s=>qn(e[s],t[s])).every(s=>s)}async function td(e,t){if(ed(e,t))return t;const{size:n,spacing:s,origin:o,direction:i}=e,a=["--size",n.join(","),"--spacing",s.join(","),"--origin",o.join(","),"--direction",i.join(",")];return Zu("resample",a,[t])}const wa=e=>{throw new Error(`Unknown DataSelection: ${e}`)},nd=e=>e.type==="dicom"?e.volumeKey:e.type==="image"?e.dataID:wa(e),Ot=e=>{const t=nd(e);return`${e.type}::${t}`},kn=e=>{const[t,n]=e.split("::");return t==="dicom"?$t(n):t==="image"?Ut(n):wa(t)},Rt=ee("layer",()=>{const e=B({}),t=B({});async function n(h,v){if(!h)throw new Error("Tried to addLayer without parent data selection");const f=Ot(h),p=`${f}::${Ot(v)}`;this.parentToLayers[f]=[...this.parentToLayers[f]??[],{selection:v,id:p}];const[m,w]=await Promise.all([h,v].map(pu));if(!Er.intersects(m.getBounds(),w.getBounds()))throw this.deleteLayer(h,v),new Error("Image bounds do not intersect, so no overlap in physical space");const T=await td(un.convertVtkToItkImage(m),un.convertVtkToItkImage(w)),S=un.convertItkToVtkImage(T);this.$proxies.addData(p,S),this.layerImages[p]=S}async function s(h,v){return eo("Failed to build layer",()=>this._addLayer(h,v))}function o(h,v){if(!h)throw new Error("Tried to deleteLayer without parent data selection");const f=Ot(h),p=this.parentToLayers[f]??[],m=p.find(({selection:w})=>mu(w,v));m&&(this.parentToLayers[f]=p.filter(w=>w!==m),delete this.layerImages[m.id],this.$proxies.getData(m.id)&&this.$proxies.deleteData(m.id))}function i(h){if(!h)return[];const v=Ot(h);return e.value[v]??[]}const a=h=>Object.values(e.value).flat().flat().find(({id:v})=>v===h),r=h=>{const v=Rt();v.getLayers(h).forEach(({selection:f})=>v.deleteLayer(h,f)),Object.keys(v.parentToLayers).map(f=>kn(f)).forEach(f=>v.deleteLayer(f,h))};Le().$onAction(({name:h,args:v})=>{if(h!=="deleteData")return;const[f]=v,p=Ut(f);r(p)}),we().$onAction(({name:h,args:v})=>{if(h!=="deleteVolume")return;const[f]=v,p=$t(f);r(p)});function u(h){h.manifest.parentToLayers=Object.entries(this.parentToLayers).map(([v,f])=>({selectionKey:v,sourceSelectionKeys:f.map(({selection:p})=>Ot(p))}))}function d(h,v){const f=m=>{if(m.type==="dicom")return $t(v[m.volumeKey]);if(m.type==="image")return Ut(v[m.dataID]);const w=m;throw new Error(`invalid selection type ${w}`)},{parentToLayers:p}=h;p.forEach(({selectionKey:m,sourceSelectionKeys:w})=>{const T=f(kn(m));w.forEach(S=>{const b=f(kn(S));this.addLayer(T,b)})})}return{parentToLayers:e,layerImages:t,_addLayer:n,addLayer:s,deleteLayer:o,getLayers:i,getLayer:a,serialize:u,deserialize:d}});function Sa(e){const t=Le();if(e&&e in t.metadata){const{lpsOrientation:n}=t.metadata[e],s=t.dataIndex[e];if(s){const o=s.getSpatialExtent();return{Sagittal:$e(o,"Sagittal",n),Coronal:$e(o,"Coronal",n),Axial:$e(o,"Axial",n)}}}return Qi()}function re(){const e=Yt(),t=we(),n=Le(),s=Rt(),o=I(()=>{const{primarySelection:u}=e,{volumeToImageID:d}=t;return(u==null?void 0:u.type)==="image"?u.dataID:(u==null?void 0:u.type)==="dicom"&&d[u.volumeKey]||null}),i=I(()=>{const{metadata:u}=n,d=o.value;return d?u[d]:la()}),a=I(()=>{if(o.value)return n.dataIndex[o.value]}),r=I(()=>Sa(o.value)),l=I(()=>!!e.primarySelection&&!e.primaryDataset),c=I(()=>s.getLayers(e.primarySelection).filter(({id:u})=>u in s.layerImages));return{currentImageData:a,currentImageID:o,currentImageMetadata:i,currentImageExtent:r,isImageLoading:l,currentLayers:c}}function Mn(e,t){return[Math.max(t[0],Math.min(t[1],e[0])),Math.max(t[0],Math.min(t[1],e[1]))]}function dt(e,t,n,s){const{indexToWorld:o,orientation:i,lpsOrientation:a}=t,r=[0,0,0],l=a[n];r[l]=e[n][s],pe(r,r,o);const c=-(s*2-1),u=[...i.slice(l*3,l*3+3).map(d=>d*c)];return Lr.newInstance({origin:r,normal:u})}const Ct=ee("crop",()=>{const e=Le(),t=We({croppingByImageID:{}}),n=c=>I(()=>{const u=z(c);if(u&&u in t.croppingByImageID&&u in e.metadata){const d=t.croppingByImageID[u],h=e.metadata[u];return[dt(d,h,"Sagittal",0),dt(d,h,"Sagittal",1),dt(d,h,"Coronal",0),dt(d,h,"Coronal",1),dt(d,h,"Axial",0),dt(d,h,"Axial",1)]}return null}),s=(c,u)=>{const d=Sa(c);return{Sagittal:Mn(u.Sagittal,d.Sagittal),Coronal:Mn(u.Coronal,d.Coronal),Axial:Mn(u.Axial,d.Axial)}},o=(c,u)=>{t.croppingByImageID[c]=s(c,u)},i=(c,u,d)=>{c in t.croppingByImageID&&o(c,{...t.croppingByImageID[c],[u]:d})},a=c=>{const u=e.dataIndex[c];if(!u)return;const{lpsOrientation:d}=e.metadata[c],h=u.getSpatialExtent();o(c,{Sagittal:$e(h,"Sagittal",d),Coronal:$e(h,"Coronal",d),Axial:$e(h,"Axial",d)})};function r(c){const{tools:u}=c.manifest;u.crop=t.croppingByImageID}function l(c,u){const d=c.tools.crop;Object.entries(d).forEach(([h,v])=>{const f=u[h];o(f,v)})}return{croppingByImageID:Ds(t.croppingByImageID),getComputedVTKPlanes:n,setCropping:o,setCroppingForAxis:i,resetCropping:a,serialize:r,deserialize:l}});function od(){return Ci.createBuilder().addField({name:"placed",initialValue:!1}).addField({name:"indexToWorld",initialValue:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}).addField({name:"worldToIndex",initialValue:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}).addStateFromMixin({labels:["handle"],mixins:["origin","bounds"],name:"handle",initialValues:{origin:null}}).build()}function id(e,t){return t.map((n,s)=>Math.max(e[s*2],Math.min(e[s*2+1],n)))}function ad(e,t){t.classHierarchy.push("vtkCrosshairsWidgetProp");let n=!1;_.setGet(e,t,["manipulator"]);function s(o){return o.altKey||o.controlKey||o.shiftKey}e.handleLeftButtonPress=o=>!t.pickable||s(o)?_.VOID:(t.widgetState.setPlaced(!0),n=!0,t._interactor.requestAnimation(e),t._apiSpecificRenderWindow.setCursor("crosshairs"),e.invokeStartInteractionEvent(),e.handleMouseMove(o),_.EVENT_ABORT),e.handleMouseMove=o=>{if((!t.widgetState.getPlaced()||n)&&t.pickable&&t.manipulator&&!s(o)){const i=t.manipulator.handleEvent(o,t._apiSpecificRenderWindow),a=t.widgetState.getHandle(),r=t.widgetState.getWorldToIndex(),l=t.widgetState.getIndexToWorld();if(r.length&&l.length){const c=De(),u=De(),d=a.getBounds();pe(c,i,r);const h=id(d,c);return pe(u,h,l),a.setOrigin(u),e.invokeInteractionEvent(),_.EVENT_ABORT}}return _.VOID},e.handleLeftButtonRelease=()=>{n&&t.pickable&&(t._interactor.cancelAnimation(e),t._apiSpecificRenderWindow.setCursor("default"),e.invokeEndInteractionEvent()),n=!1},e.grabFocus=()=>{},e.loseFocus=()=>{}}function sd(e,t){t.classHierarchy.push("vtkCrosshairsWidget"),t.behavior=ad,t.widgetState=od(),e.getRepresentationsForViewType=n=>{switch(n){case Qe.DEFAULT:case Qe.GEOMETRY:case Qe.SLICE:case Qe.VOLUME:default:return[]}},t.widgetState.onBoundsChange(n=>{const s=[(n[0]+n[1])*.5,(n[2]+n[3])*.5,(n[4]+n[5])*.5];t.widgetState.getHandle().setOrigin(s)}),t.manipulator=ze.newInstance()}const rd={};function _a(e,t,n={}){Object.assign(t,rd,n),fn.extend(e,t,n),_.setGet(e,t,["manipulator"]),sd(e,t)}const ld=_.newInstance(_a,"vtkCrosshairsWidget"),cd={newInstance:ld,extend:_a};function bt(e,t,n,s){t in e||(e[t]={}),e[t][n]={...e[t][n],...s}}function Qt(e,t){Object.keys(e).forEach(n=>{delete e[n][t]})}function Zt(e,t,n){var s;return t==null||n==null?null:(s=e[t])==null?void 0:s[n]}const ud=(e,t,n)=>{const s=e.manifest.datasets.map(i=>i.id),{views:o}=e.manifest;o.forEach(i=>{s.forEach(a=>{var c;const{config:r}=i,l=(c=t[i.id])==null?void 0:c[a];if(l!==void 0){const u=il(a,r,{});u[n]=l}})})},Jt=(e,t)=>n=>{ud(n,e,t)},oo=()=>({slice:0,min:0,max:1,axisDirection:"Inferior"}),xt=ee("viewSlice",()=>{const e=We({}),t=(l,c)=>Zt(e,l,c),n=(l,c,u)=>{const d={...oo(),...t(l,c),...u};d.slice=Bi(d.slice,d.min,d.max),bt(e,l,c,d)},s=(l,c)=>{const u=t(l,c);u&&n(l,c,{slice:Math.ceil((u.min+u.max)/2)})},o=l=>{delete e[l]},i=(l,c)=>{var u;c?(u=e[c])==null||delete u[l]:Qt(e,l)},a=Jt(e,"slice");return{configs:e,getConfig:t,updateConfig:n,resetSlice:s,removeView:o,removeData:i,serialize:a,deserialize:(l,c)=>{Object.entries(c).forEach(([u,d])=>{d.slice&&n(l,u,d.slice)})}}}),Ca=()=>({width:1,level:.5,min:0,max:1}),io=ee("windowing",()=>{const e=We({}),t=B(!0),n=d=>{t.value=d},s=(d,h)=>Zt(e,d,h),o=(d,h)=>{var f;if(!t.value)return;const v=(f=e[d])==null?void 0:f[h];v&&Object.keys(e).filter(p=>p!==d).forEach(p=>{bt(e,p,h,v)})},i=(d,h,v)=>{var f;bt(e,d,h,{...Ca(),...(f=e[d])==null?void 0:f[h],...v}),t.value&&o(d,h)},a=(d,h)=>{var m;const v=(m=e[d])==null?void 0:m[h];if(v==null)return;const f=v.max-v.min,p=(v.max+v.min)/2;i(d,h,{width:f,level:p})},r=d=>{delete e[d]},l=(d,h)=>{var v;h?(v=e[h])==null||delete v[d]:Qt(e,d)},c=Jt(e,"window");return{configs:e,getConfig:s,setSyncAcrossViews:n,updateConfig:i,resetWindowLevel:a,removeView:r,removeData:l,serialize:c,deserialize:(d,h)=>{Object.entries(h).forEach(([v,f])=>{f.window&&i(d,v,f.window)})}}});function ba(e,t){var s,o;const n=(o=(s=t.getRenderWindow())==null?void 0:s.getViews())==null?void 0:o[0];if(n){const[i,a,r]=e;return n.worldToDisplay(i,a,r,t)}return null}function dd(e,t){const n=t.getCanvas();if(!n)return null;const s=n.getBoundingClientRect(),o=n.width/s.width,i=n.height/s.height;return[o*(e.clientX-s.left),i*(s.height-e.clientY+s.top)]}function hd(e,t,n,s){var a;const o=(a=t.getRenderWindow())==null?void 0:a.getViews()[0];if(!o)return null;const i=dd(e,o);return i?Or(i[0],i[1],n,s,t,o):null}function Ht(e,t){var o,i;const n=ba(e,t),s=(i=(o=t.getRenderWindow())==null?void 0:o.getViews())==null?void 0:i[0];if(n&&s){const[,a]=s.getViewportSize(t);return[n[0]/devicePixelRatio,(a-n[1])/devicePixelRatio]}return null}function ao(e){var o,i,a;const{pokedRenderer:t}=e,n=(i=(o=t==null?void 0:t.getRenderWindow())==null?void 0:o.getViews())==null?void 0:i[0],s=(a=n==null?void 0:n.getContainer())==null?void 0:a.getBoundingClientRect();return!("position"in e)||!s?null:[s.left+e.position.x/devicePixelRatio,s.top+s.height-e.position.y/devicePixelRatio]}function gd(e,t,n){const s=pn.getPresetByName(e);if(s.OpacityPoints){const o=s.OpacityPoints,i=[];for(let c=0;c<o.length;c+=2)i.push([o[c],o[c+1]]);const[a,r]=t,l=r-a;return i.map(([c,u])=>[(c-a)/l+n,u])}return null}function Ta(e){return pn.getPresetByName(e).OpacityPoints?{mode:xe.Mode.Points,preset:e,shift:0}:{mode:xe.Mode.Gaussians,gaussians:JSON.parse(JSON.stringify(xe.Defaults.Gaussians))}}function Ia(e){const t=pn.getPresetByName(e);if(!t)return null;const{AbsoluteRange:n,RGBPoints:s}=t;if(n&&s){let o=1/0,i=-1/0;for(let a=0;a<s.length;a+=4)o=Math.min(o,s[a]),i=Math.max(i,s[a]);return[o,i]}return null}const fd=[{Name:"CT-AAA",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,143.556,0,166.222,.686275,214.389,.696078,419.736,.833333,3071,.803922],RGBPoints:[-3024,0,0,0,143.556,.615686,.356863,.184314,166.222,.882353,.603922,.290196,214.389,1,1,1,419.736,1,.937033,.954531,3071,.827451,.658824,1],EffectiveRange:[143.556,419.736]},{Name:"CT-AAA2",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,129.542,0,145.244,.166667,157.02,.5,169.918,.627451,395.575,.8125,1578.73,.8125,3071,.8125],RGBPoints:[-3024,0,0,0,129.542,.54902,.25098,.14902,145.244,.6,.627451,.843137,157.02,.890196,.47451,.6,169.918,.992157,.870588,.392157,395.575,1,.886275,.658824,1578.73,1,.829256,.957922,3071,.827451,.658824,1],EffectiveRange:[0,1600]},{Name:"CT-Bone",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-16.4458,0,641.385,.715686,3071,.705882],RGBPoints:[-3024,0,0,0,-16.4458,.729412,.254902,.301961,641.385,.905882,.815686,.552941,3071,1,1,1],EffectiveRange:[-16.4458,641.385]},{Name:"CT-Bones",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-1e3,0,152.19,0,278.93,.190476,952,.2],RGBPoints:[-1e3,.3,.3,1,-488,.3,1,.3,463.28,1,0,0,659.15,1,.912535,.0374849,953,1,.3,.3],EffectiveRange:[152.19,952]},{Name:"CT-Cardiac",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-77.6875,0,94.9518,.285714,179.052,.553571,260.439,.848214,3071,.875],RGBPoints:[-3024,0,0,0,-77.6875,.54902,.25098,.14902,94.9518,.882353,.603922,.290196,179.052,1,.937033,.954531,260.439,.615686,0,0,3071,.827451,.658824,1],EffectiveRange:[-77.6875,260.439]},{Name:"CT-Cardiac2",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,42.8964,0,163.488,.428571,277.642,.776786,1587,.754902,3071,.754902],RGBPoints:[-3024,0,0,0,42.8964,.54902,.25098,.14902,163.488,.917647,.639216,.0588235,277.642,1,.878431,.623529,1587,1,1,1,3071,.827451,.658824,1],EffectiveRange:[42.8964,1587]},{Name:"CT-Cardiac3",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-86.9767,0,45.3791,.169643,139.919,.589286,347.907,.607143,1224.16,.607143,3071,.616071],RGBPoints:[-3024,0,0,0,-86.9767,0,.25098,1,45.3791,1,0,0,139.919,1,.894893,.894893,347.907,1,1,.25098,1224.16,1,1,1,3071,.827451,.658824,1],EffectiveRange:[-86.9767,1224.16]},{Name:"CT-Chest-Contrast-Enhanced",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,67.0106,0,251.105,.446429,439.291,.625,3071,.616071],RGBPoints:[-3024,0,0,0,67.0106,.54902,.25098,.14902,251.105,.882353,.603922,.290196,439.291,1,.937033,.954531,3071,.827451,.658824,1],EffectiveRange:[67.0106,439.291]},{Name:"CT-Chest-Vessels",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-1278.35,0,22.8277,.428571,439.291,.625,3071,.616071],RGBPoints:[-3024,0,0,0,-1278.35,.54902,.25098,.14902,22.8277,.882353,.603922,.290196,439.291,1,.937033,.954531,3071,.827451,.658824,1],EffectiveRange:[-1278.35,439.291]},{Name:"CT-Coronary-Arteries",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,136.47,0,159.215,.258929,318.43,.571429,478.693,.776786,3661,1],RGBPoints:[-2048,0,0,0,136.47,0,0,0,159.215,.159804,.159804,.159804,318.43,.764706,.764706,.764706,478.693,1,1,1,3661,1,1,1],EffectiveRange:[136.47,478.693]},{Name:"CT-Coronary-Arteries-2",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,142.677,0,145.016,.116071,192.174,.5625,217.24,.776786,384.347,.830357,3661,.830357],RGBPoints:[-2048,0,0,0,142.677,0,0,0,145.016,.615686,0,.0156863,192.174,.909804,.454902,0,217.24,.972549,.807843,.611765,384.347,.909804,.909804,1,3661,1,1,1],EffectiveRange:[142.677,384.347]},{Name:"CT-Coronary-Arteries-3",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,128.643,0,129.982,.0982143,173.636,.669643,255.884,.857143,584.878,.866071,3661,1],RGBPoints:[-2048,0,0,0,128.643,0,0,0,129.982,.615686,0,.0156863,173.636,.909804,.454902,0,255.884,.886275,.886275,.886275,584.878,.968627,.968627,.968627,3661,1,1,1],EffectiveRange:[128.643,584.878]},{Name:"CT-Cropped-Volume-Bone",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,-451,0,-450,1,1050,1,3661,1],RGBPoints:[-2048,0,0,0,-451,0,0,0,-450,.0556356,.0556356,.0556356,1050,1,1,1,3661,1,1,1],EffectiveRange:[-451,1050]},{Name:"CT-Fat",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-1e3,0,-100,0,-99,.15,-60,.15,-59,0,101.2,0,952,0],RGBPoints:[-1e3,.3,.3,1,-497.5,.3,1,.3,-99,0,0,1,-76.946,0,1,0,-65.481,.835431,.888889,.0165387,83.89,1,0,0,463.28,1,0,0,659.15,1,.912535,.0374849,2952,1,.300267,.299886],EffectiveRange:[-100,101.2]},{Name:"CT-Liver-Vasculature",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,149.113,0,157.884,.482143,339.96,.660714,388.526,.830357,1197.95,.839286,3661,.848214],RGBPoints:[-2048,0,0,0,149.113,0,0,0,157.884,.501961,.25098,0,339.96,.695386,.59603,.36886,388.526,.854902,.85098,.827451,1197.95,1,1,1,3661,1,1,1],EffectiveRange:[149.113,1197.95]},{Name:"CT-Lung",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-1e3,0,-600,0,-599,.15,-400,.15,-399,0,2952,0],RGBPoints:[-1e3,.3,.3,1,-600,0,0,1,-530,.134704,.781726,.0724558,-460,.929244,1,.109473,-400,.888889,.254949,.0240258,2952,1,.3,.3],EffectiveRange:[-600,-399]},{Name:"CT-MIP",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-637.62,0,700,1,3071,1],RGBPoints:[-3024,0,0,0,-637.62,1,1,1,700,1,1,1,3071,1,1,1],EffectiveRange:[-637.62,700]},{Name:"CT-Muscle",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-155.407,0,217.641,.676471,419.736,.833333,3071,.803922],RGBPoints:[-3024,0,0,0,-155.407,.54902,.25098,.14902,217.641,.882353,.603922,.290196,419.736,1,.937033,.954531,3071,.827451,.658824,1],EffectiveRange:[-155.407,419.736]},{Name:"CT-Pulmonary-Arteries",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,-568.625,0,-364.081,.0714286,-244.813,.401786,18.2775,.607143,447.798,.830357,3592.73,.839286],RGBPoints:[-2048,0,0,0,-568.625,0,0,0,-364.081,.396078,.301961,.180392,-244.813,.611765,.352941,.0705882,18.2775,.843137,.0156863,.156863,447.798,.752941,.752941,.752941,3592.73,1,1,1],EffectiveRange:[-568.625,447.798]},{Name:"CT-Soft-Tissue",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,-167.01,0,-160,1,240,1,3661,1],RGBPoints:[-2048,0,0,0,-167.01,0,0,0,-160,.0556356,.0556356,.0556356,240,1,1,1,3661,1,1,1],EffectiveRange:[-167.01,240]},{Name:"CT-Air",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,.705882,-900,.715686,-500,0,3071,0],RGBPoints:[-3024,1,1,1,-900,.2,1,1,-500,.3,.3,1,3071,0,0,0],EffectiveRange:[-1200,-200]},{Name:"CT-X-ray",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-200,0,1500,.05,3071,.05],RGBPoints:[-3024,1,1,1,3071,1,1,1],EffectiveRange:[-250,1550]},{Name:"MR-Angio",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,151.354,0,158.279,.4375,190.112,.580357,200.873,.732143,3661,.741071],RGBPoints:[-2048,0,0,0,151.354,0,0,0,158.279,.74902,.376471,0,190.112,1,.866667,.733333,200.873,.937255,.937255,.937255,3661,1,1,1],EffectiveRange:[151.354,200.873]},{Name:"MR-Default",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[0,0,20,0,40,.15,120,.3,220,.375,1024,.5],RGBPoints:[0,0,0,0,20,.168627,0,0,40,.403922,.145098,.0784314,120,.780392,.607843,.380392,220,.847059,.835294,.788235,1024,1,1,1],EffectiveRange:[0,220]},{Name:"MR-MIP",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[0,0,98.3725,0,416.637,1,2800,1],RGBPoints:[0,1,1,1,98.3725,1,1,1,416.637,1,1,1,2800,1,1,1],EffectiveRange:[0,416.637]},{Name:"MR-T2-Brain",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[0,0,36.05,0,218.302,.171429,412.406,1,641,1],RGBPoints:[0,0,0,0,98.7223,.956863,.839216,.192157,412.406,0,.592157,.807843,641,1,1,1],EffectiveRange:[0,412.406]},{Name:"DTI-FA-Brain",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[0,0,0,0,.3501,.0158,.49379,.7619,.6419,1,.992,1,.995,0,.995,0],RGBPoints:[0,1,0,0,0,1,0,0,.24974,.4941,1,0,.49949,0,.9882,1,.7492,.51764,0,1,.995,1,0,0,.995,1,0,0],EffectiveRange:[0,1]},{Name:"US-Fetal",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-10,0,0,0,270,.8],RGBPoints:[-10,.325,.153,.153,74,.474,.392,.302,136,.718,.51,.443,270,.76,.44,.53],EffectiveRange:[-10,270]},{ColorSpace:"Lab",Name:"2hot",RGBPoints:[-1,.0416667,0,0,-.873016,.208333,0,0,-.746032,.375,0,0,-.619048,.541667,0,0,-.492063,.708333,0,0,-.365079,.854137,0,0,-.238095,.937488,.039062,0,-.111111,1,.208333,0,.015873,1,.375,0,.142857,1,.541667,0,.269841,1,.708333,0,.396825,1,.858805,.03125,.52381,1,.947392,.15625,.650794,1,1,.3125,.777778,1,1,.5625,.904762,1,1,.8125,1,1,1,1]}];function pd(e){for(let t=0;t<e.length;t+=1)pn.addPreset(e[t])}pd(fd);const md=[{group:"CT",presets:["CT-AAA","CT-AAA2","CT-Bone","CT-Bones","CT-Cardiac","CT-Cardiac2","CT-Cardiac3","CT-Chest-Contrast-Enhanced","CT-Chest-Vessels","CT-Coronary-Arteries","CT-Coronary-Arteries-2","CT-Coronary-Arteries-3","CT-Cropped-Volume-Bone","CT-Fat","CT-Liver-Vasculature","CT-Lung","CT-MIP","CT-Muscle","CT-Pulmonary-Arteries","CT-Soft-Tissue","CT-Air","CT-X-ray"]},{group:"MR",presets:["MR-Default","MR-Angio","MR-MIP","MR-T2-Brain"]},{group:"DTI",presets:["DTI-FA-Brain"]},{group:"US",presets:["US-Fetal"]}],Hn="CT-AAA";md.flatMap(e=>e.presets);const vd={PT:"2hot"};function yd(e){const n=Rt().getLayer(e);if(n&&n.selection.type==="dicom"){const s=we(),{Modality:o=void 0}=s.volumeInfo[n.selection.volumeKey];return o&&vd[o]||Hn}return Hn}const zo=()=>({colorBy:{arrayName:"",location:"pointData"},transferFunction:{preset:"",mappingRange:[0,1]},opacityFunction:{mode:xe.Mode.Gaussians,gaussians:[],mappingRange:[0,1]},blendConfig:{opacity:.6}}),Ra=ee("layerColoring",()=>{const e=We({}),t=(f,p)=>Zt(e,f,p),n=(f,p,m)=>{const w={...zo(),...t(f,p),...m};bt(e,f,p,w)},s=(f,p=ki)=>(m,w,T)=>{const S=t(m,w)??zo(),b=p({...S[f],...T});n(m,w,{[f]:b})},o=s("colorBy"),i=s("transferFunction"),a=s("opacityFunction"),r=s("blendConfig"),l=(f,p,m)=>{const T=Rt().layerImages[p];if(!T)return;const S=T.getPointData().getScalars().getRange(),b=Ia(m);i(f,p,{preset:m,mappingRange:b||S});const D=Ta(m);D.mappingRange=S,a(f,p,D)},c=(f,p,m)=>{const w=m.getPointData().getScalars();o(f,p,{arrayName:w.getName()+p,location:"pointData"}),l(f,p,yd(p))},u=f=>{delete e[f]},d=(f,p)=>{var m;p?(m=e[p])==null||delete m[f]:Qt(e,f)},h=Jt(e,"layers");return{configs:e,getConfig:t,updateConfig:n,updateColorBy:o,updateColorTransferFunction:i,updateOpacityFunction:a,updateBlendConfig:r,resetToDefault:c,setColorPreset:l,removeView:u,removeData:d,serialize:h,deserialize:(f,p)=>{Object.entries(p).forEach(([m,w])=>{w.layers&&n(f,m,w.layers)})}}}),so=ee("viewCamera",()=>{const e=We({}),t=(r,l)=>Zt(e,r,l),n=(r,l,c)=>{const u={...t(r,l),...c};bt(e,r,l,u)},s=r=>{delete e[r]},o=(r,l)=>{var c;l?(c=e[l])==null||delete c[r]:Qt(e,r)},i=Jt(e,"camera");return{configs:e,getConfig:t,updateConfig:n,removeView:s,removeData:o,serialize:i,deserialize:(r,l)=>{Object.entries(l).forEach(([c,u])=>{u.camera&&n(r,c,u.camera)})}}}),wd=.2,Sd=.7,_d=.3;function Cd(e){const t=we();if(e in t.imageIDToVolumeKey){const n=t.imageIDToVolumeKey[e],{Modality:s}=t.volumeInfo[n];if(s in Wo)return Wo[s]}return Hn}const jo=()=>({colorBy:{arrayName:"",location:"pointData"},transferFunction:{preset:"",mappingRange:[0,1]},opacityFunction:{mode:xe.Mode.Gaussians,gaussians:[],mappingRange:[0,1]},cvr:{enabled:!0,lightFollowsCamera:!0,volumeQuality:2,useVolumetricScatteringBlending:!0,volumetricScatteringBlending:.5,useLocalAmbientOcclusion:!0,laoKernelRadius:5,laoKernelSize:15,ambient:wd,diffuse:Sd,specular:_d}}),bd=ee("volumeColoring",()=>{const e=We({}),t=(f,p)=>Zt(e,f,p),n=(f,p,m)=>{const w={...jo(),...t(f,p),...m};bt(e,f,p,w)},s=(f,p=ki)=>(m,w,T)=>{const S=t(m,w)??jo(),b=p({...S[f],...T});n(m,w,{[f]:b})},o=s("colorBy"),i=s("transferFunction"),a=s("opacityFunction"),r=s("cvr"),l=(f,p,m)=>{const T=Le().dataIndex[p];if(!T)return;const S=T.getPointData().getScalars().getRange(),b=Ia(m);i(f,p,{preset:m,mappingRange:b||S});const D=Ta(m);D.mappingRange=S,a(f,p,D)},c=(f,p,m)=>{const w=m.getPointData().getScalars();o(f,p,{arrayName:w.getName(),location:"pointData"}),l(f,p,Cd(p))},u=f=>{delete e[f]},d=(f,p)=>{var m;p?(m=e[p])==null||delete m[f]:Qt(e,f)},h=Jt(e,"volumeColorConfig");return{configs:e,getConfig:t,updateConfig:n,updateColorBy:o,updateColorTransferFunction:i,updateOpacityFunction:a,updateCVRParameters:r,resetToDefaultColoring:c,setColorPreset:l,removeView:u,removeData:d,serialize:h,deserialize:(f,p)=>{Object.entries(p).forEach(([m,w])=>{w.volumeColorConfig&&n(f,m,w.volumeColorConfig)})}}}),Go=ee("viewConfig",()=>{const e=xt(),t=io(),n=Ra(),s=so(),o=bd(),i=u=>{e.removeView(u),t.removeView(u),n.removeView(u),s.removeView(u),o.removeView(u)},a=(u,d)=>{e.removeData(u,d),t.removeData(u,d),n.removeData(u,d),s.removeData(u,d),o.removeData(u,d)},r=u=>{e.serialize(u),t.serialize(u),n.serialize(u),s.serialize(u),o.serialize(u)},l=(u,d,h)=>{const v={};Object.entries(d).forEach(([f,p])=>{const m=h[f];v[m]=p}),e.deserialize(u,v),t.deserialize(u,v),n.deserialize(u,v),s.deserialize(u,v),o.deserialize(u,v)};return Le().$onAction(({name:u,args:d})=>{if(u==="deleteData"){const[h]=d;a(h)}}),{removeView:i,removeData:a,serialize:r,deserialize:l}}),he=ee("view",{state:()=>({layout:{direction:Ie.V,items:[]},viewSpecs:structuredClone(ya)}),getters:{viewIDs(e){return Object.keys(e.viewSpecs)},getViewProxy(){return e=>this.$proxies.getView(e)},getDataRepresentationForView(){return(e,t)=>this.$proxies.getDataRepresentationForView(e,t)}},actions:{createOrGetViewProxy(e,t){return this.$proxies.getView(e)??this.$proxies.createView(e,t)},addView(e){e in this.viewSpecs||(this.viewSpecs[e]=structuredClone(ju))},removeView(e){e in this.viewSpecs&&(delete this.viewSpecs[e],this.$proxies.removeView(e))},setLayout(e){this.layout=e;const t=[e];for(;t.length;)t.shift().items.forEach(s=>{typeof s=="string"?this.addView(s):t.push(s)})},serialize(e){const t=Go(),{manifest:n}=e,{views:s}=n;n.layout=this.layout,Object.entries(this.viewSpecs).forEach(([o,i])=>{const a=i.viewType,{props:r}=i,c={id:o,type:a,props:r,config:{}};s.push(c)}),t.serialize(e)},deserialize(e,t){const n=Go();e.forEach(s=>{const o=s.id,i={viewType:s.type,props:s.props};this.viewSpecs[o]=i;const{config:a}=s;n.deserialize(o,a,t)})}}}),Wt=ee("crosshairs",()=>{const e=cd.newInstance(),t=e.getWidgetState(),n=t.getHandle(),s=B(!1),{currentImageID:o,currentImageMetadata:i}=re(),a=B([0,0,0]),r=I(()=>{const w=De();return pe(w,a.value,i.value.worldToIndex),w}),l=xt(),c=he(),u=I(()=>{const w=z(o);return w?c.viewIDs.filter(T=>!!l.getConfig(T,w)):[]});function d(){return e}function h(w){a.value=w}F(r,w=>{if(s.value){const T=z(o),{lpsOrientation:S}=z(i);if(!T)return;u.value.forEach(b=>{const O=l.getConfig(b,T),D=be(O.axisDirection),k=S[D],L=Math.round(w[k]);l.updateConfig(b,T,{slice:L})})}}),F(i,w=>{t.setIndexToWorld(w.indexToWorld),t.setWorldToIndex(w.worldToIndex);const[T,S,b]=w.dimensions,O=[0,T-1,0,S-1,0,b-1];n.setBounds(Pr(O,.5))},{immediate:!0}),n.onModified(()=>{const w=n.getOrigin();w&&(a.value=w)});function v(){return t.setPlaced(!1),s.value=!0,!0}function f(){s.value=!1}function p(w){const{crosshairs:T}=w.manifest.tools;T.position=a.value}function m(w){const{crosshairs:T}=w.tools;a.value=T.position}return{getWidgetFactory:d,setPosition:h,position:a,imagePosition:r,activateTool:v,deactivateTool:f,serialize:p,deserialize:m}}),Td=4,Id=1,lt=ee("paint",()=>{const e=B(null),t=B(Td),n=B(Id),s=B([]),o=B(1),i=B(!1),{currentImageID:a}=re();function r(){return this.$paint.factory}const l=I(()=>e.value?hn().labelmaps[e.value]??null:null);function c(D){if(!D){e.value=null;return}const k=hn(),L=Object.entries(k.parentImage).find(([,$])=>D===$);L?[e.value]=L:e.value=k.newLabelmapFromImage(D)}function u(D){t.value=Math.round(D),this.$paint.setBrushSize(D)}function d(D){n.value=D,this.$paint.setBrushValue(D)}function h(D){o.value=Math.min(1,Math.max(0,D))}function v(D){if(!l.value)return;const k=s.value.length-1;if(k>=0){const L=s.value[k],$=k>=1?s.value[k-1]:void 0;this.$paint.paintLabelmap(l.value,D,L,$)}}function f(D){if(!l.value)return;const k=l.value.getSpacing();k.splice(D,1);const L=[1/k[0],1/k[1]];this.$paint.setBrushScale(L)}function p(D,k){s.value=[ai(D)],v.call(this,k)}function m(D,k){s.value.push(D),v.call(this,k)}function w(D,k){s.value.push(D),v.call(this,k)}function T(){const D=a.value;return D?(c(D),this.$paint.setBrushSize(this.brushSize),i.value=!0,!0):!1}function S(){e.value=null,i.value=!1}function b(D){const{paint:k}=D.manifest.tools;k.activeLabelmapID=e.value,k.brushSize=t.value,k.brushValue=n.value,k.labelmapOpacity=o.value}function O(D,k){const{paint:L}=D.tools;this.setBrushSize(L.brushSize),this.setBrushValue(L.brushValue),this.setLabelmapOpacity(L.labelmapOpacity),i.value=D.tools.current===ce.Paint,L.activeLabelmapID!==null&&(e.value=k[L.activeLabelmapID])}return F(a,D=>{i.value&&c(D)}),{activeLabelmapID:e,brushSize:t,brushValue:n,strokePoints:s,labelmapOpacity:o,isActive:i,getWidgetFactory:r,activateTool:T,deactivateTool:S,selectOrCreateLabelmap:c,setBrushSize:u,setBrushValue:d,setLabelmapOpacity:h,setSliceAxis:f,startStroke:p,placeStrokePoint:m,endStroke:w,serialize:b,deserialize:O}}),Xo=De();function Sn(e,t,n){const s=(n==null?void 0:n.epsilon)??Gn,o=(n==null?void 0:n.allowNonIntegralSlice)??!1,i=(n==null?void 0:n.allowOutOfBoundsSlice)??!1,{planeNormal:a,planeOrigin:r}=e,{dimensions:l,lpsOrientation:c,worldToIndex:u}=t;let d=null;const{Left:h,Right:v,Posterior:f,Anterior:p,Superior:m,Inferior:w}=c;if(at(h,a)||at(v,a)?d="Sagittal":at(f,a)||at(p,a)?d="Coronal":(at(m,a)||at(w,a))&&(d="Axial"),!d)return null;pe(Xo,r,u);const T=c[d],S=al(Xo[T],s);return!o&&!Number.isInteger(S)||!i&&(S<0||S>=l[T])?null:{axis:d,slice:S}}const Rd={labelName:"New Label"},xd=e=>{const t=B({}),n=B(),s=d=>{n.value=d},o=(d={})=>{const h=_t().nextId();return t.value[h]={...Rd,...e,...d},s(h),h},i=d=>{if(!(d in t.value))throw new Error("Label does not exist");if(delete t.value[d],t.value={...t.value},d===n.value){const h=Object.keys(t.value);h.length!==0?s(h[0]):s("")}},a=(d,h)=>{if(!(d in t.value))throw new Error("Label does not exist");t.value={...t.value,[d]:{...t.value[d],...h}}},r=B(!0),l=()=>{r.value&&(t.value={}),r.value=!1},c=(d,h=!0)=>{h&&l();const{labelName:v}=d,f=Object.entries(t.value).find(([,{labelName:p}])=>p===v);if(f){const[p]=f;return a(p,d),p}return o(d)};return{labels:t,activeLabel:n,setActiveLabel:s,addLabel:o,deleteLabel:i,updateLabel:a,mergeLabel:c,mergeLabels:(d,h=!0)=>{Object.entries(d??{}).forEach(([v,f])=>c({...f,labelName:v},h))}}},Dd=()=>({frameOfReference:{planeOrigin:[0,0,0],planeNormal:[1,0,0]},slice:-1,imageID:"",placing:!1,color:Gu[0],name:"baseAnnotationTool"}),ro=({toolDefaults:e,initialLabels:t,newLabelDefault:n})=>{const s=B([]),o=B(Object.create(null)),i=I(()=>{const m=o.value;return s.value.map(w=>m[w])}),a=xd(n);a.mergeLabels(t,!1);function r(m){if(!m)return{labelName:""};const w=a.labels.value[m];return w||{labelName:""}}function l(m){const w=_t().nextId();if(w in o.value)throw new Error("Cannot add tool with conflicting ID");return o.value[w]={...Dd(),...e(),label:a.activeLabel.value,...m,...r(m.label),id:w},s.value.push(w),w}function c(m){m in o.value&&(Nt(s.value,m),delete o.value[m])}function u(m,w){m in o.value&&(o.value[m]={...o.value[m],...w,id:m})}F(a.labels,()=>{s.value.forEach(m=>{const w=o.value[m],T=r(w.label);u(m,{...w,...T})})});function d(m){const w=o.value[m],{currentImageID:T,currentImageMetadata:S}=re(),b=T.value;if(!b||w.imageID!==b)return;const O=Sn(w.frameOfReference,S.value);if(!O)return;const D=he(),k=D.viewIDs.filter($=>{const Z=D.viewSpecs[$].props.viewDirection;return Z&&be(Z)===O.axis}),L=xt();k.forEach($=>{L.updateConfig($,b,{slice:w.slice})})}const h=()=>!0,v=()=>{},f=()=>({tools:s.value.map(w=>o.value[w]).filter(w=>!w.placing).map(({imageID:w,...T})=>({imageID:da(w),...T})),labels:a.labels.value});function p(m,w){const T=Object.fromEntries(Object.entries((m==null?void 0:m.labels)??{}).map(([S,b])=>{const O=a.mergeLabel(b);return[S,O]}));m==null||m.tools.map(({imageID:S,label:b,...O})=>({...O,imageID:ha(w[S]),label:b&&T[b]||""})).forEach(S=>l.call(this,S))}return{...a,toolIDs:s,toolByID:o,tools:i,addTool:l,removeTool:c,updateTool:u,jumpToTool:d,activateTool:h,deactivateTool:v,serialize:f,deserialize:p}},Ed=()=>({firstPoint:[0,0,0],secondPoint:[0,0,0],id:"",name:"Ruler"}),Ld={color:"#ffffff"},Ue=ee("ruler",()=>{const{toolIDs:e,toolByID:t,tools:n,addTool:s,updateTool:o,removeTool:i,jumpToTool:a,serialize:r,deserialize:l,activateTool:c,deactivateTool:u,...d}=ro({toolDefaults:Ed,initialLabels:Xu,newLabelDefault:Ld}),h=I(()=>{const p=t.value;return e.value.reduce((m,w)=>{const{firstPoint:T,secondPoint:S}=p[w];return Object.assign(m,{[w]:Math.sqrt(Ii(T,S))})},{})});function v(p){p.manifest.tools.rulers=r()}function f(p,m){l.call(this,p.tools.rulers,m)}return{...d,rulerIDs:e,rulerByID:t,rulers:n,lengthByID:h,addRuler:s,updateRuler:o,removeRuler:i,jumpToRuler:a,serialize:v,deserialize:f,activateTool:c,deactivateTool:u}}),Od=()=>({firstPoint:[0,0,0],secondPoint:[0,0,0],id:"",name:"Rectangle",fillColor:"transparent"}),Pd={color:"#ffffff",fillColor:"transparent"},He=ee("rectangles",()=>{const{serialize:e,deserialize:t,...n}=ro({toolDefaults:Od,initialLabels:qu,newLabelDefault:Pd});function s(i){i.manifest.tools.rectangles=e()}function o(i,a){t.call(this,i.tools.rectangles,a)}return{...n,serialize:s,deserialize:o}});function xa(){return{t:pt(),_tInv:null}}const Mt=De(),qo=ri();function _n(e,t,n){const s=n??De();return ci(Mt,e[0],e[1],0),pe(s,Mt,t.t),s}function Da(e){const t=pt();return Es(t,e),t}function Vd(e){return e._tInv=e._tInv??Da(e.t),e._tInv}function et(e,t,n){const s=n??Me(),o=Vd(t);return pe(Mt,e,o),mt(s,Mt[0],Mt[1]),s}function kd(e){const t=[0,0,0];pe(t,t,e.t);const n=[0,0,1];return Ls(qo,e.t),Os(n,n,qo),Ps(n,n),{planeNormal:n,planeOrigin:t}}const Md={0:Pt(0,1,0,0,0,0,1,0,1,0,0,0,0,0,0,1),1:Pt(1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1),2:pt()};function Bd(e,t,n){const s=pt();return Vs(s,[0,0,t]),Do(s,Md[n],s),Do(s,e,s),{t:s,_tInv:Da(s)}}var ye=(e=>(e.Select="Select",e.FreehandDraw="FreehandDraw",e.CircleNudge="CircleNudge",e.PointPlacing="PointPlacing",e.Threshold="Threshold",e))(ye||{});const Ad=()=>({id:"",name:"Contour",polyLine:[],referencePlane:xa()}),Cn=ee("contour",()=>{const e=B(),t=B("FreehandDraw"),{serialize:n,deserialize:s,...o}=ro({toolDefaults:Ad,initialLabels:{"Default label":{color:"#ff0000"}},newLabelDefault:{color:"#ff0000"}});function i(l){e.value=l}function a(l){return e.value===l&&(e.value=null),o.removeTool(l)}function r(l){t.value=l}return{...o,removeTool:a,serialize:()=>{},deserialize:()=>{},selectedContourID:e,mode:t,selectContour:i,setMode:r}});function Ea(e){return e===ce.Ruler?Ue():e===ce.Rectangle?He():e===ce.Paint?lt():e===ce.Crosshairs?Wt():e===ce.Contour?Cn():null}function Fd(e){const t=Ea(e);return t?t.activateTool():!0}function Nd(e){const t=Ea(e);t&&t.deactivateTool()}const Ve=ee("tool",{state:()=>({currentTool:ce.WindowLevel}),actions:{setCurrentTool(e){Fd(e)&&(Nd(this.currentTool),this.currentTool=e)},serialize(e){const{tools:t}=e.manifest,n=Ue(),s=He(),o=Wt(),i=lt(),a=Ct();n.serialize(e),s.serialize(e),o.serialize(e),i.serialize(e),a.serialize(e),t.current=this.currentTool},deserialize(e,t,n){const{tools:s}=e,o=Ue(),i=He(),a=Wt(),r=lt(),l=Ct();o.deserialize(e,n),i.deserialize(e,n),a.deserialize(e),r.deserialize(e,t),l.deserialize(e,n),this.currentTool=s.current}}}),La="manifest.json";async function $d(e){const t=await tl(e);return Pi.has(t.type)?(await li.loadAsync(t)).file(La)!==null:!1}const lo=(e,{done:t})=>t({dataSource:e}),bn=async e=>{let t=e;const{fileSrc:n}=t;if(n&&n.fileType===""){const s=await Vi(n.file);s&&(t={...t,fileSrc:{...n,fileType:s}})}return t},Ud=async(e,{extra:t,done:n})=>{const{uriSrc:s}=e;if(s){const o=await new wn([ga,bn,lo]).execute(e,t);if(!o.ok)throw o.errors[0].cause;return n({dataSource:o.data[0].dataSource})}return e},Hd=async(e,{execute:t})=>{const{fileSrc:n,parent:s}=e;if(!n&&s){const o=await t(s);if(!o.ok)throw new Error("Could not process parent",{cause:sl(o.errors[0].cause)});return{...e,parent:o.data[0].dataSource}}return e},Wd=async(e,{extra:t,done:n})=>{if(e.archiveSrc){const o=await new wn([pa,bn,lo]).execute(e,t);if(!o.ok)throw o.errors[0].cause;return n({dataSource:o.data[0].dataSource})}return e};function zd(e,t,n){const s=n.filter(i=>wt(i.archivePath)===wt(e.path)).map(i=>ia(i.file)),o=t.remoteFiles[e.id]??[];return[...s,...o]}async function jd(e,t,{extra:n,execute:s}){const o=new Map,i=t.map(c=>({...c,archivePath:wt(c.archivePath)})),{datasets:a}=e,r={},l=new wn([bn,Ud,Hd,Wd,lo]);return await Promise.all(a.map(async c=>{let u=zd(c,e,i);u=await Promise.all(u.map(async v=>{const f=await l.execute(v,{...n,archiveCache:o});if(!f.ok)throw f.errors[0].cause;return f.data[0].dataSource}));const d=[],h=await Promise.all(u.map(v=>s(v,{...n,archiveCache:o,dicomDataSources:d})));if(d.length){const v=we(),f=await v.importFiles(d);if(f.length!==1)throw new Error("Obtained more than one volume from DICOM import");const[p]=f;await v.buildVolume(p),r[c.id]=p}else if(h.length===1){if(!h[0].ok)throw h[0].errors[0].cause;const[v]=h;if(v.data.length!==1)throw new Error("Import encountered multiple volumes for a single dataset");const{dataID:f}=v.data[0];if(!f)throw new Error("Failed to import dataset");r[c.id]=f}else throw new Error("Could not load any data from the session")})),r}const Gd=async(e,{done:t,extra:n,execute:s})=>{const{fileSrc:o}=e;if(o&&await $d(o.file)){const i=await no(o.file),[a,r]=vn(d=>d.file.name===La,i);if(a.length!==1)throw new Error("State file does not have exactly 1 manifest");const l=cu.parse(JSON.parse(await a[0].file.text()));he().setLayout(l.layout);const c=await jd(l,r,{extra:n,execute:s,done:t});if(l.primarySelection!==void 0){const d=c[l.primarySelection];let h;d in we().volumeInfo?h=$t(d):h=Ut(d),Yt().setPrimarySelection(h)}he().deserialize(l.views,c);const u=await hn().deserialize(l,r,c);return Ve().deserialize(l,u,c),Rt().deserialize(l,c),t()}return e},Oa=C.string(),co=C.object({color:Oa}),Xd=co,qd=C.intersection(co,C.object({fillColor:Oa})),Kd=C.object({labels:C.record(co).or(C.null()).optional(),rulerLabels:C.record(Xd).or(C.null()).optional(),rectangleLabels:C.record(qd).or(C.null()).optional()}),Yd=async e=>{const t=new TextDecoder,n=await e.arrayBuffer(),s=t.decode(new Uint8Array(n));return Kd.parse(JSON.parse(s))},Qd=e=>{const t=n=>n===void 0?e.labels:n;Ue().mergeLabels(t(e.rulerLabels)),He().mergeLabels(t(e.rectangleLabels))},Zd=async(e,{done:t})=>{const{fileSrc:n}=e;if((n==null?void 0:n.fileType)==="application/json"){try{const s=await Yd(n.file);Qd(s)}catch{return e}return t()}return e};function Jd(e){if(e.data.length===0)return null;const{dataID:t,dataType:n}=e.data[0];return t?n==="dicom"?$t(t):n==="image"?Ut(t):null:null}function eh(e){const t=String(e);return!t||t==="[object Object]"?"Unknown error. More details in the dev console.":t}const th=()=>{throw new Error("Failed to handle resource")};async function nh(e){const t=[bn,Zd,Gd,Uu,Bu,Lu,ga,pa,bu,yu,Au,th],n={fetchFileCache:new Map,dicomDataSources:[]},s=new wn(t),o=await Promise.all(e.map(r=>s.execute(r,n)));if(!n.dicomDataSources.length)return o;const i={dicomSrc:{sources:n.dicomDataSources}},a={ok:!0,data:[],errors:[]};try{const r=await we().importFiles(n.dicomDataSources);a.data.push(...r.map(l=>({dataID:l,dataType:"dicom",dataSource:i})))}catch(r){a.ok=!1,a.errors.push({message:eh(r),cause:r,inputDataStackTrace:[i]})}return[...o.filter(r=>r.data.length),a]}const oh={name:"ToolButton",props:{icon:{type:String,required:!0},name:{type:String,required:!0},size:{type:[Number,String],default:40},buttonClass:[String,Array,Object],tooltipLocation:{type:String,default:"right"}},computed:{sizeV(){return Number(this.size)},iconSize(){return Math.floor(.6*this.sizeV)},classV(){const e=this.buttonClass;return typeof e=="string"?e:Array.isArray(e)?e.join(" "):e&&Object.keys(e).length?Object.keys(this.buttonClass).filter(t=>this.buttonClass[t]).join(" "):""}}};function ih(e,t,n,s,o,i){return R(),Y(ft,Gt({variant:"text",rounded:0,dark:"",height:i.sizeV,width:i.sizeV,"min-width":i.sizeV,"max-width":i.sizeV,class:i.classV},e.$attrs),{default:x(()=>[y(vt,{size:i.iconSize},{default:x(()=>[H(U(n.icon),1)]),_:1},8,["size"]),y(pi,{location:n.tooltipLocation,activator:"parent",transition:"slide-x-transition"},{default:x(()=>[g("span",null,U(n.name),1)]),_:1},8,["location"]),Ce(e.$slots,"default")]),_:3},16,["height","width","min-width","max-width","class"])}const Fe=A(oh,[["render",ih]]),Pa=Symbol("ItemGroup"),Va=X({props:{modelValue:null,mandatory:Boolean,equalsTest:Function},setup(e,{emit:t,slots:n}){const{modelValue:s,mandatory:o,equalsTest:i}=oe(e),a=B();return F(s,c=>{c!==a.value&&(a.value=c)}),te(()=>{a.value=s.value}),Fn(Pa,{selectItem:c=>{o.value&&!c||(a.value=c,t("update:modelValue",a.value))},isSelected:c=>a.value==null?!1:i.value?i.value(c,a.value):c===a.value}),()=>{var c;return(c=n.default)==null?void 0:c.call(n)}}}),ka=X({props:{value:{type:null,required:!0}},setup(e,{slots:t}){const{value:n}=oe(e),s=It(Pa);if(!s)throw new Error("GroupableItem needs ItemGroup!");const o=()=>{s.selectItem(n.value)},i=()=>{s&&s.selectItem(s.isSelected(n.value)?void 0:n.value)};return()=>{var a;return(a=t.default)==null?void 0:a.call(t,{active:s.isSelected(n.value),select:o,toggle:i})}}});function Ma(e){return`#${e.map(n=>`0${n.toString(16)}`.slice(-2)).join("")}`}function ah(e){const t=e.startsWith("#")?e.substring(1):e,n=[0,0,0,255],s=Math.min(4,t.length/2);for(let o=0;o<s;o++)n[o]=Number.parseInt(t.substring(2*o,2*o+2),16);return n}function sh(e,t=5){const n={},s=[],o=Object.entries(e);for(;o.length;){const[i,a]=o.shift(),r=Ma(a).toUpperCase();n[r]=Number(i);let l=s[s.length-1];(!l||l.length===t)&&(l=[],s.push(l)),l.push(r)}return{hexToValue:n,swatches:s}}const rh=X({name:"PaintControls",setup(){const e=lt(),{hexToValue:t,swatches:n}=sh(kt,3),s=I(()=>{const c=e.brushValue;return c in kt?Ma(kt[c]):null}),o=c=>{const u=`${c}FF`.toUpperCase();u in t&&e.setBrushValue(t[u])},i=I(()=>e.brushSize),a=c=>{e.setBrushSize(Number(c))},r=I(()=>e.labelmapOpacity);return{brushSize:i,setBrushSize:a,swatches:n,brushColor:s,setBrushColor:o,opacity:r,setOpacity:c=>{e.setLabelmapOpacity(Number(c))}}}});function lh(e,t,n,s,o,i){return R(),Y(Xt,{width:"350px"},{default:x(()=>[y(vi,null,{default:x(()=>[y(cn,{"no-gutters":"",align:"center"},{default:x(()=>[y(Vt,null,{default:x(()=>[y(Eo,{"model-value":e.brushSize,"onUpdate:modelValue":e.setBrushSize,density:"compact","hide-details":"",label:"Size",min:"1",max:"50"},{append:x(()=>[y(Nn,{"model-value":e.brushSize,onInput:e.setBrushSize,variant:"underlined",class:"mt-n1 pt-0",style:{width:"40px"},"hide-details":"",type:"number",min:"1",max:"50"},null,8,["model-value","onInput"])]),_:1},8,["model-value","onUpdate:modelValue"])]),_:1})]),_:1}),y(cn,{"no-gutters":"",align:"center"},{default:x(()=>[y(Vt,null,{default:x(()=>[y(Eo,{"model-value":e.opacity,"onUpdate:modelValue":e.setOpacity,density:"compact","hide-details":"",label:"Opacity",min:"0",max:"1",step:"0.01"},{append:x(()=>[y(Nn,{"model-value":e.opacity,onInput:e.setOpacity,variant:"underlined",class:"mt-n1 pt-0",style:{width:"40px"},"hide-details":"",type:"number",min:"0",max:"1",step:"0.1"},null,8,["model-value","onInput"])]),_:1},8,["model-value","onUpdate:modelValue"])]),_:1})]),_:1}),y(cn,{"no-gutters":"",align:"center"},{default:x(()=>[y(Vt,null,{default:x(()=>[y(mi,{"hide-canvas":"","hide-inputs":"","hide-mode-switch":"","hide-sliders":"","show-swatches":"",elevation:"0",swatches:e.swatches,"model-value":e.brushColor,"onUpdate:modelValue":e.setBrushColor},null,8,["swatches","model-value","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})}const Ba=A(rh,[["render",lh],["__scopeId","data-v-6027fe65"]]),ch=X({name:"MenuToolButton",props:{icon:{type:String,required:!0},name:{type:String,required:!0},size:{type:[Number,String],default:40},active:Boolean,disabled:Boolean,mobileOnlyMenu:Boolean},components:{ToolButton:Fe},setup(e){const t=yi(),n=I(()=>!t.mobile.value),s=B(!1),o=I(()=>!e.mobileOnlyMenu||t.mobile.value);F(s,a=>{s.value=a&&o.value});const i=I(()=>e.active);return F(i,a=>{a||(s.value=!1)}),{showLeft:n,menuOn:s,enableMenu:o}}});const uh={class:"menu-content elevation-24"};function dh(e,t,n,s,o,i){const a=V("tool-button");return R(),Y(yt,{"no-click-animation":"","close-on-content-click":!1,modelValue:e.menuOn,"onUpdate:modelValue":t[1]||(t[1]=r=>e.menuOn=r),location:e.showLeft?"left":"right",class:"overflow-auto"},{activator:x(({props:r})=>[y(a,Gt({icon:e.icon,name:e.name,buttonClass:["tool-btn",e.active?"tool-btn-selected":""],disabled:e.disabled,size:e.size,onClick:t[0]||(t[0]=l=>e.$emit("click"))},r),{default:x(()=>[e.active&&e.enableMenu?(R(),Y(vt,{key:0,class:N([e.showLeft?"menu-more-left":"menu-more-right"]),size:"18"},{default:x(()=>[H(U(e.showLeft?"mdi-menu-left":"mdi-menu-right"),1)]),_:1},8,["class"])):j("",!0)]),_:2},1040,["icon","name","buttonClass","disabled","size"])]),default:x(()=>[g("div",uh,[Ce(e.$slots,"default",{},void 0,!0)])]),_:3},8,["modelValue","location"])}const Aa=A(ch,[["render",dh],["__scopeId","data-v-b1e30b7b"]]),hh=X({components:{ToolButton:Fe},setup(){const{currentImageID:e}=re(),t=Ct();return{resetCrop:()=>{const s=e.value;s&&t.resetCropping(s)}}}});function gh(e,t,n,s,o,i){const a=V("tool-button");return R(),Y(Xt,{dark:""},{default:x(()=>[y(a,{size:"40",icon:"mdi-restore",name:"Reset Crop",onClick:e.resetCrop},null,8,["onClick"])]),_:1})}const Fa=A(hh,[["render",gh]]),fh={class:"d-flex flex-row"},ph={class:"flex-grow-1 d-flex flex-column justify-space-between mr-4"},mh=X({__name:"LabelEditor",props:{label:null,labelsStore:null},emits:["close"],setup(e,{emit:t}){const n=e,s=I(()=>n.labelsStore.labels[n.label]),o=B(s.value.labelName);F(o,r=>{n.labelsStore.updateLabel(n.label,{labelName:r})});const i=B(rl(s.value.color));F(i,r=>{n.labelsStore.updateLabel(n.label,{color:r})});const a=()=>{t("close"),n.labelsStore.deleteLabel(n.label)};return(r,l)=>(R(),Y(Xt,null,{default:x(()=>[y(nr,{class:"d-flex flex-row align-center"},{default:x(()=>[H(" Edit Label "),y(Lo),y(ft,{variant:"text",density:"compact",icon:"mdi-close",onClick:l[0]||(l[0]=c=>r.$emit("close"))})]),_:1}),y(ir,null,{default:x(()=>[g("div",fh,[g("div",ph,[g("div",null,[y(Nn,{modelValue:o.value,"onUpdate:modelValue":l[1]||(l[1]=c=>o.value=c),onKeydown:l[2]||(l[2]=nt(ue(c=>r.$emit("close"),["stop"]),["enter"])),label:"Name",class:"flex-grow-0"},null,8,["modelValue"])]),y(or,{class:"mb-2 px-0"},{default:x(()=>[y(ft,{color:"secondary",variant:"elevated",onClick:l[3]||(l[3]=c=>r.$emit("close"))},{default:x(()=>[H(" Done ")]),_:1}),y(Lo),y(ft,{color:"red",variant:"tonal",onClick:a},{default:x(()=>[H(" Delete label ")]),_:1})]),_:1})]),y(mi,{modelValue:i.value,"onUpdate:modelValue":l[4]||(l[4]=c=>i.value=c),mode:"rgb",label:"Color"},null,8,["modelValue"])])]),_:1})]),_:1}))}}),vh={class:"dot-container mr-3"},yh={class:"overflow-hidden"},wh=X({__name:"LabelControls",props:{labelsStore:null},setup(e){const t=e,n=I(()=>Object.entries(t.labelsStore.labels)),s=I(()=>n.value.findIndex(([c])=>c===t.labelsStore.activeLabel)),o=B(void 0),i=()=>{o.value=t.labelsStore.addLabel()},a=B(!1);fe(()=>{a.value=!!o.value});const r=yi(),l=I(()=>r.mobile.value);return(c,u)=>(R(),E(ie,null,[y(Xt,{class:"pt-2"},{default:x(()=>[y(wi,null,{default:x(()=>[H("Labels")]),_:1}),y(vi,null,{default:x(()=>[y(Si,{"model-value":z(s),"selected-class":"card-active",mandatory:""},{default:x(()=>[y(cn,{dense:""},{default:x(()=>[(R(!0),E(ie,null,Pe(z(n),([d,{labelName:h,color:v}])=>(R(),Y(Vt,{cols:"6",key:d},{default:x(()=>[y(ht,null,{default:x(({selectedClass:f,toggle:p})=>[y(Oo,{variant:"tonal",class:N(["w-100 d-flex",f]),onClick:()=>{p(),e.labelsStore.setActiveLabel(d)}},{default:x(()=>[g("div",vh,[g("div",{class:"color-dot",style:ne({background:v})},null,4)]),g("span",yh,U(h),1),y(ft,{icon:"mdi-pencil",density:"compact",class:"ml-auto",variant:"plain",onClick:ue(()=>{o.value=d,a.value=!0},["stop"])},null,8,["onClick"])]),_:2},1032,["class","onClick"])]),_:2},1024)]),_:2},1024))),128)),y(Vt,{cols:"6"},{default:x(()=>[y(Oo,{variant:"outlined",class:"w-100",onClick:i},{default:x(()=>[y(vt,{class:"mr-2"},{default:x(()=>[H("mdi-plus")]),_:1}),H(" Add Label ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])]),_:1})]),_:1}),y(ar,{modelValue:a.value,"onUpdate:modelValue":u[1]||(u[1]=d=>a.value=d),width:z(l)?"100%":"50%"},{default:x(()=>[o.value?(R(),Y(mh,{key:0,onClose:u[0]||(u[0]=d=>o.value=void 0),label:o.value,labelsStore:e.labelsStore},null,8,["label","labelsStore"])):j("",!0)]),_:1},8,["modelValue","width"])],64))}});const uo=A(wh,[["__scopeId","data-v-3ba66c80"]]),Na=X({__name:"RulerControls",setup(e){const t=Ue();return(n,s)=>(R(),Y(uo,{"labels-store":z(t)},null,8,["labels-store"]))}}),$a=X({__name:"RectangleControls",setup(e){const t=He();return(n,s)=>(R(),Y(uo,{"labels-store":z(t)},null,8,["labels-store"]))}}),Ua=X({__name:"ContourControls",setup(e){const t=Cn(),{mode:n}=rt(t);function s(o){t.setMode(o)}return(o,i)=>(R(),Y(Xt,{dark:""},{default:x(()=>[y(wi,{class:"my-1"},{default:x(()=>[H("Tools")]),_:1}),y(Si,{mandatory:"","selected-class":"tool-btn-selected","model-value":z(n),"onUpdate:modelValue":s},{default:x(()=>[y(ht,{value:z(ye).Select},{default:x(({selectedClass:a,toggle:r})=>[y(Fe,{size:"40",icon:"mdi-cursor-default",name:"Select",buttonClass:a||"",onClick:r},null,8,["buttonClass","onClick"])]),_:1},8,["value"]),y(ht,{value:z(ye).FreehandDraw},{default:x(({selectedClass:a,toggle:r})=>[y(Fe,{size:"40",icon:"mdi-draw",name:"Freehand",buttonClass:a||"",onClick:r},null,8,["buttonClass","onClick"])]),_:1},8,["value"]),y(ht,{value:z(ye).PointPlacing},{default:x(({selectedClass:a,toggle:r})=>[y(Fe,{size:"40",icon:"mdi-vector-polyline",name:"Point Placing",buttonClass:a||"",onClick:r},null,8,["buttonClass","onClick"])]),_:1},8,["value"]),y(ht,{value:z(ye).Threshold},{default:x(({selectedClass:a,toggle:r})=>[y(Fe,{size:"40",icon:"mdi-math-integral",name:"Threshold",buttonClass:a||"",onClick:r},null,8,["buttonClass","onClick"])]),_:1},8,["value"]),y(ht,{value:z(ye).CircleNudge},{default:x(({selectedClass:a,toggle:r})=>[y(Fe,{size:"40",icon:"mdi-circle-multiple-outline",name:"Nudge",buttonClass:a||"",onClick:r},null,8,["buttonClass","onClick"])]),_:1},8,["value"])]),_:1},8,["model-value"]),y(uo,{"labels-store":z(t)},null,8,["labels-store"])]),_:1}))}});const Sh=X({components:{ToolButton:Fe,MenuToolButton:Aa,ItemGroup:Va,GroupableItem:ka,PaintControls:Ba,CropControls:Fa,RulerControls:Na,RectangleControls:$a,ContourControls:Ua},setup(){const e=Yt(),t=Ve();console.log(rt(t));const n=I(()=>!e.primaryDataset),s=I(()=>t.currentTool),o=He(),i=Ue(),a=B(!1),r=B(!1);return Wn("Escape",()=>{a.value=!1,r.value=!1}),{currentTool:s,setCurrentTool:t.setCurrentTool,noCurrentImage:n,Tools:ce,paintMenu:a,cropMenu:r,rectangleStore:o,rulerStore:i}}});function _h(e,t,n,s,o,i){const a=V("tool-button"),r=V("groupable-item"),l=V("paint-controls"),c=V("menu-tool-button"),u=V("rectangle-controls"),d=V("ruler-controls"),h=V("contour-controls"),v=V("crop-controls"),f=V("item-group");return R(),Y(f,{mandatory:"","model-value":e.currentTool,"onUpdate:modelValue":t[0]||(t[0]=p=>e.setCurrentTool(p))},{default:x(()=>[y(r,{value:e.Tools.WindowLevel},{default:x(({active:p,toggle:m})=>[y(a,{icon:"mdi-circle-half-full",name:"Window & Level",buttonClass:["tool-btn",p?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Pan},{default:x(({active:p,toggle:m})=>[y(a,{icon:"mdi-cursor-move",name:"Pan",buttonClass:["tool-btn",p?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Zoom},{default:x(({active:p,toggle:m})=>[y(a,{icon:"mdi-magnify-plus-outline",name:"Zoom",buttonClass:["tool-btn",p?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Crosshairs},{default:x(({active:p,toggle:m})=>[y(a,{icon:"mdi-crosshairs",name:"Crosshairs",buttonClass:["tool-btn",p?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Paint},{default:x(({active:p,toggle:m})=>[y(c,{icon:"mdi-brush",name:"Paint",active:p,disabled:e.noCurrentImage,onClick:m},{default:x(()=>[y(l)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Rectangle},{default:x(({active:p,toggle:m})=>[y(c,{icon:"mdi-vector-square",name:"Rectangle",mobileOnlyMenu:!0,active:p,disabled:e.noCurrentImage,onClick:m},{default:x(()=>[y(u)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Ruler},{default:x(({active:p,toggle:m})=>[y(c,{icon:"mdi-ruler",name:"Ruler",mobileOnlyMenu:!0,active:p,disabled:e.noCurrentImage,onClick:m},{default:x(()=>[y(d)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Contour},{default:x(({active:p,toggle:m})=>[y(c,{icon:"mdi-shape-circle-plus",name:"Contour",active:p,disabled:e.noCurrentImage,onClick:m},{default:x(()=>[y(h)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Crop},{default:x(({active:p,toggle:m})=>[y(c,{icon:"mdi-crop",name:"Crop",active:p,disabled:e.noCurrentImage,onClick:m},{default:x(()=>[y(v)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"])]),_:1},8,["model-value"])}const Ch=A(Sh,[["render",_h],["__scopeId","data-v-63968322"]]);function zt(e){Ae(()=>e.unsubscribe())}function bh(e,t=!1){const n=B(t);let s=!0;const o={position:[0,0,0],parallelScale:0};zt(e.onModified(()=>{if(s&&n.value){const r=e.getPosition(),l=e.getParallelScale();(!at(r,o.position)||l!==o.parallelScale)&&(n.value=!1)}}));function i(r){if(s){s=!1;try{r()}finally{s=!0}}}function a(){o.position=e.getPosition(),o.parallelScale=e.getParallelScale()}return{resizeToFit:n,ignoreResizeToFitTracking:i,resetResizeToFitTracking:a}}function Th(e){if(!e||e==="none")return 0;const t=e.match(/matrix(?:3d)?\((.+)\)/)[1].split(",").map(s=>Number(s));return e.includes("3d")?t[13]:t[5]}const Ih={props:{slice:{type:Number,default:0},min:{type:Number,required:!0},max:{type:Number,required:!0},step:{type:Number,required:!0},handleHeight:{type:Number,default:20}},data(){return{maxHandlePos:0,dragging:!1,initialHandlePos:0,initialMousePosY:0,yOffset:0}},computed:{handlePosition(){const e=this.max-this.min<=0?1:this.max-this.min,t=this.maxHandlePos*((this.slice-this.min)/e);return this.dragging?this.draggingHandlePos:t},draggingHandlePos(){return Math.min(Math.max(0,this.initialHandlePos+this.yOffset),this.maxHandlePos)}},mounted(){this.updateMaxHandlePos(),this.resizeObserver=new ResizeObserver(e=>{e.length===1&&this.updateMaxHandlePos()}),this.resizeObserver.observe(this.$refs.handleContainer)},beforeUnmount(){this.resizeObserver.disconnect()},methods:{updateMaxHandlePos(){this.maxHandlePos=this.$refs.handleContainer.clientHeight-this.handleHeight},onDragStart(e){if(e.preventDefault(),this.dragging=!0,this.initialMousePosY=e.pageY,e.target===this.$refs.handle){const t=window.getComputedStyle(this.$refs.handle);this.initialHandlePos=Th(t.transform)}else{const{y:t}=this.$refs.handleContainer.getBoundingClientRect();this.initialHandlePos=Math.max(0,Math.min(this.maxHandlePos,e.pageY-t-this.handleHeight/2));const n=this.getNearestSlice(this.initialHandlePos);this.$emit("input",n)}this.yOffset=0,this.$refs.handleContainer.setPointerCapture(e.pointerId)},onDragMove(e){if(!this.$refs.handleContainer.hasPointerCapture(e.pointerId))return;e.preventDefault(),this.yOffset=e.pageY-this.initialMousePosY;const t=this.getNearestSlice(this.handlePosition);this.$emit("input",t)},onDragEnd(e){if(!this.$refs.handleContainer.hasPointerCapture(e.pointerId))return;e.preventDefault(),this.$refs.handleContainer.releasePointerCapture(e.pointerId),this.dragging=!1;const t=this.getNearestSlice(this.handlePosition);this.$emit("input",t)},getNearestSlice(e){const n=e/this.maxHandlePos*(this.max-this.min)+this.min;return Math.round(n/this.step)*this.step}}},Rh=e=>(ae("data-v-45b64a9f"),e=e(),se(),e),xh=Rh(()=>g("div",{class:"slice-slider-track"},null,-1));function Dh(e,t,n,s,o,i){return R(),E("div",{class:"slice-slider",ref:"handleContainer",onPointerdown:t[0]||(t[0]=(...a)=>i.onDragStart&&i.onDragStart(...a)),onPointermove:t[1]||(t[1]=(...a)=>i.onDragMove&&i.onDragMove(...a)),onPointerup:t[2]||(t[2]=(...a)=>i.onDragEnd&&i.onDragEnd(...a)),onPointercancel:t[3]||(t[3]=(...a)=>i.onDragEnd&&i.onDragEnd(...a)),onContextmenu:t[4]||(t[4]=a=>a.preventDefault())},[xh,g("div",{class:"slice-slider-handle",ref:"handle",style:ne({height:`${n.handleHeight}px`,transform:`translate3d(0, ${i.handlePosition}px, 0)`})},null,4)],544)}const Eh=A(Ih,[["render",Dh],["__scopeId","data-v-45b64a9f"]]),Lh="_gridRoot_102tk_2",Oh="_row_102tk_9",Ph="_cell_102tk_16",Vh="_top_102tk_20",kh="_left_102tk_21",Mh="_center_102tk_25",Bh="_middle_102tk_26",Ah="_bottom_102tk_30",Fh="_right_102tk_31",Nh={gridRoot:Lh,row:Oh,cell:Ph,top:Vh,left:kh,center:Mh,middle:Bh,bottom:Ah,right:Fh},$h={};function Uh(e,t){return R(),E("div",{class:N(e.$style.gridRoot)},[g("div",{class:N([e.$style.top,e.$style.row])},[g("div",{class:N([e.$style.left,e.$style.cell])},[Ce(e.$slots,"top-left")],2),g("div",{class:N([e.$style.center,e.$style.cell])},[Ce(e.$slots,"top-center")],2),g("div",{class:N([e.$style.right,e.$style.cell])},[Ce(e.$slots,"top-right")],2)],2),g("div",{class:N([e.$style.middle,e.$style.row])},[g("div",{class:N([e.$style.left,e.$style.cell])},[Ce(e.$slots,"middle-left")],2),g("div",{class:N([e.$style.center,e.$style.cell])},[Ce(e.$slots,"middle-center")],2),g("div",{class:N([e.$style.right,e.$style.cell])},[Ce(e.$slots,"middle-right")],2)],2),g("div",{class:N([e.$style.bottom,e.$style.row])},[g("div",{class:N([e.$style.left,e.$style.cell])},[Ce(e.$slots,"bottom-left")],2),g("div",{class:N([e.$style.center,e.$style.cell])},[Ce(e.$slots,"bottom-center")],2),g("div",{class:N([e.$style.right,e.$style.cell])},[Ce(e.$slots,"bottom-right")],2)],2)],2)}const Hh={$style:Nh},Wh=A($h,[["render",Uh],["__cssModules",Hh]]);function Tn(e,t){const n=new ResizeObserver(s=>{s.length===1&&t(s[0])});return F(e,(s,o)=>{o&&n.unobserve(o),s&&n.observe(s)},{immediate:!0}),Ee(()=>{const s=z(e);s&&n.unobserve(s)}),n}function Se(e){return n=>{let s=null;const o=()=>{s==null||s.unsubscribe(),s=null};Ae(o),ks(e)?fe(()=>{o(),e.value&&(s=e.value(n))}):e&&(s=e(n))}}function rn(e){return e.map((t,n)=>({value:t,axis:n})).filter(({value:t})=>Math.abs(t)>Gn).sort((t,n)=>Math.abs(n.value)-Math.abs(t.value)).map(({value:t,axis:n})=>(Math.sign(t)===1?"LPS":"RAI")[n]).join("")}function zh(e){const t=I(()=>e.value.getCamera()),n=B(""),s=B(""),o=B(""),i=B("");function a(){const l=t.value.getViewUp(),c=t.value.getDirectionOfProjection(),u=[0,0,0];zn(u,c,l);const d=l.map(v=>v*-1),h=u.map(v=>v*-1);n.value=rn(l),i.value=rn(u),o.value=rn(d),s.value=rn(h)}return Se(I(()=>t.value.onModified))(a),a(),{top:n,right:i,bottom:o,left:s}}function jh(e,t,n){const s=I(()=>n.value.orientation),o=I(()=>Ji(s.value)),i=I(()=>o.value[z(e)]),a=I(()=>o.value[z(t)]);return{cameraDirVec:i,cameraUpVec:a}}function ln(e,t){return Math.min(t-e,1)/256}const Gh=X({name:"WindowLevelTool",props:{viewId:{type:String,required:!0}},setup(e){const{viewId:t}=oe(e),n=io(),s=he(),{currentImageID:o}=re(),i=I(()=>s.getViewProxy(t.value)),a=Ca(),r=I(()=>n.getConfig(t.value,o.value)),l=I(()=>({min:1e-12,max:r.value!=null?r.value.max-r.value.min:a.max,step:r.value!=null?ln(r.value.min,r.value.max):ln(a.min,a.max)})),c=I(()=>({min:r.value!=null?r.value.min:a.min,max:r.value!=null?r.value.max:a.max,step:r.value!=null?ln(r.value.min,r.value.max):ln(a.min,a.max)})),u=I(()=>r.value!=null?r.value.width:a.width),d=I(()=>r.value!=null?r.value.level:a.level),h=Ri.newInstance({button:1,scrollEnabled:!1});F(i,(f,p)=>{p&&p.getInteractorStyle2D().removeMouseManipulator(h),f&&i.value.getInteractorStyle2D().addMouseManipulator(h)},{immediate:!0}),Ee(()=>{i.value.isDeleted()||i.value.getInteractorStyle2D().removeMouseManipulator(h)});function v(){h.removeAllListeners();const f=l.value,p=c.value;h.setVerticalListener(f.min,f.max,f.step,()=>u.value,m=>{o.value!=null&&n.updateConfig(t.value,o.value,{width:m})}),h.setHorizontalListener(p.min,p.max,p.step,()=>d.value,m=>{o.value!=null&&n.updateConfig(t.value,o.value,{level:m})})}return F(()=>JSON.stringify({w:l.value,l:c.value}),v,{immediate:!0}),()=>null}});function Xh(e){const t=Ve();return I(()=>t.currentTool===ce.WindowLevel).value?jn(Gh,e):[]}const qh=X({name:"SliceScrollTool",props:{viewId:{type:String,required:!0}},setup(e){const{viewId:t}=oe(e),n=xt(),s=he(),{currentImageID:o}=re(),i=I(()=>s.getViewProxy(t.value)),a=oo(),r=I(()=>n.getConfig(t.value,o.value)),l=I(()=>({min:r.value!=null?r.value.min:a.min,max:r.value!=null?r.value.max:a.max,step:1,default:r.value!=null?r.value.slice:a.slice})),c=B(0),u=Ri.newInstance({button:-1,scrollEnabled:!0});F(i,(h,v)=>{v&&v.getInteractorStyle2D().removeMouseManipulator(u),h&&i.value.getInteractorStyle2D().addMouseManipulator(u)},{immediate:!0}),Ee(()=>{i.value.isDeleted()||i.value.getInteractorStyle2D().removeMouseManipulator(u)});function d(){u.removeAllListeners();const h=l.value;u.setScrollListener(h.min,h.max,h.step,()=>c.value,v=>{o.value!==null&&n.updateConfig(t.value,o.value,{slice:v})})}return F(l,h=>{c.value=h.default,d()},{immediate:!0}),()=>null}}),Ha=X({name:"MouseManipulatorTool",props:{name:String,viewId:{type:String,required:!0},manipulatorClass:{type:Object,required:!0},options:{type:Array,default:()=>[]}},setup(e){const{viewId:t,options:n}=oe(e),s=he(),o=I(()=>s.getViewProxy(t.value)),i=I(()=>o.value.isA("vtkView2DProxy")?o.value.getInteractorStyle2D():o.value.getInteractorStyle3D()),a=[];function r(l,c,u){l!==null&&(u.forEach(d=>l.removeMouseManipulator(d)),c.forEach(d=>l.addMouseManipulator(d)))}return F(n,l=>{for(;a.length>l.length;){const u=a.pop();i.value.removeMouseManipulator(u),u.delete()}const c=Array.from(a);for(let u=a.length;u<l.length;++u)a.push(e.manipulatorClass.newInstance(l[u]));l.forEach((u,d)=>{"button"in u&&a[d].setButton(u.button),a[d].setShift(!!u.shift),a[d].setControl(!!u.control)}),r(i.value,a,c)},{immediate:!0}),F(i,(l,c)=>{a.forEach(u=>{c&&c.removeMouseManipulator(u),l&&l.addMouseManipulator(u)})},{immediate:!0}),Ee(()=>{o.value.isDeleted()||a.forEach(l=>i.value.removeMouseManipulator(l))}),()=>null}});function Kh(e){const t=Ve(),n=[];return n.push({button:2}),n.push({button:1,shift:!0}),t.currentTool===ce.Pan&&n.push({button:1}),jn(Ha,{...e,name:"PanTool",manipulatorClass:Vr,options:n})}function Yh(e){const t=Ve(),n=[];return n.push({button:3,flipDirection:!0}),n.push({button:1,control:!0,flipDirection:!0}),t.currentTool===ce.Zoom&&n.push({button:1,flipDirection:!0}),jn(Ha,{...e,name:"ZoomTool",manipulatorClass:kr,options:n})}var jt=(e=>(e.PlacingFirst="PlacingFirst",e.PlacingSecond="PlacingSecond",e.Select="Select",e.Dragging="Dragging",e))(jt||{});function Ko(e){return e.altKey||e.controlKey||e.shiftKey}function Qh(e,t){t.classHierarchy.push("vtkRulerWidgetProp"),t.interactionState="Select";let n=null;_.setGet(e,t,["interactionState"]),_.setGet(e,t,["manipulator"]),_.event(e,t,"RightClickEvent"),_.event(e,t,"PlacedEvent"),e.deactivateAllHandles=()=>{t.widgetState.deactivate(),t.activeState=null},e.setFirstPoint=o=>{t.widgetState.getFirstPoint().setOrigin(o)},e.setSecondPoint=o=>{t.widgetState.getSecondPoint().setOrigin(o)};const s=e.setInteractionState;e.setInteractionState=o=>{const i=s(o);return i&&o==="PlacingFirst"&&(t.widgetState.setIsPlaced(!1),t.widgetState.getFirstPoint().setVisible(!1),t.widgetState.getSecondPoint().setVisible(!1)),i},e.resetInteractions=()=>{t._interactor.cancelAnimation(e,!0)},e.handleLeftButtonPress=o=>{var l;if(!t.manipulator||Ko(o))return _.VOID;const i=t._widgetManager.getActiveWidget();if(i&&i!==e)return _.VOID;const a=t.manipulator.handleEvent(o,t._apiSpecificRenderWindow);if(!a.length)return _.VOID;const r=e.getInteractionState();return r==="PlacingFirst"?(e.setFirstPoint(a),e.setSecondPoint(a),t.widgetState.getFirstPoint().setVisible(!0),t.widgetState.getSecondPoint().setVisible(!0),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),e.setInteractionState("PlacingSecond"),_.EVENT_ABORT):r==="PlacingSecond"?(e.setSecondPoint(a),t.widgetState.setIsPlaced(!0),e.setInteractionState("Select"),e.invokeEndInteractionEvent(),e.invokePlacedEvent(),t._interactor.cancelAnimation(e),_.EVENT_ABORT):(l=t.activeState)!=null&&l.getActive()&&t.pickable?(n=t.activeState,e.setInteractionState("Dragging"),t._apiSpecificRenderWindow.setCursor("grabbing"),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),_.EVENT_ABORT):_.VOID},e.handleMouseMove=o=>{const i=t.manipulator.handleEvent(o,t._apiSpecificRenderWindow);return i.length?e.getInteractionState()==="PlacingSecond"?(t.widgetState.getSecondPoint().setOrigin(i),t.widgetState.getSecondPoint().setVisible(!0),e.invokeInteractionEvent(),_.EVENT_ABORT):e.getInteractionState()==="Dragging"&&n?(n.setOrigin(i),e.invokeInteractionEvent(),_.EVENT_ABORT):_.VOID:_.VOID},e.handleLeftButtonRelease=o=>{if(n){const i=t.manipulator.handleEvent(o,t._apiSpecificRenderWindow);i.length&&n.setOrigin(i),n=null,e.setInteractionState("Select"),t._apiSpecificRenderWindow.setCursor("pointer"),t.widgetState.deactivate(),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent(),t._widgetManager.enablePicking()}},e.handleRightButtonPress=o=>Ko(o)||e.getInteractionState()!=="Select"||!t.activeState?_.VOID:(e.invokeRightClickEvent(o),_.EVENT_ABORT),e.grabFocus=()=>{throw new Error("grabFocus is not implemented")},e.loseFocus=()=>{throw new Error("loseFocus is not implemented")}}const Zh=20;function Jh(e,t,n,s){let o=n();const i=t.$subscribe(()=>{const r=n();(s?s(o,r):o!==r)&&(o=r,e.modified())}),a=e.delete;e.delete=()=>{i(),a()}}function eg(e,t,{id:n,store:s,key:o,visible:i=!0}){Object.assign(t,{id:n,_store:s,key:o}),mn.extend(e,t,{}),xi.extend(e,t,{visible:i}),Mr.extend(e,t,{scale1:Zh});const a=()=>t._store.rulerByID[t.id],r=l=>t._store.updateRuler(t.id,l);e.getOrigin=()=>{var l;return(l=a())==null?void 0:l[t.key]},e.setOrigin=l=>{r({[t.key]:l}),e.modified()},Jh(e,t._store,()=>{var l;return(l=a())==null?void 0:l[t.key]})}const Yo=_.newInstance(eg,"vtkRulerWidgetStatePoint"),Wa="points";function Qo(e,t,n){let s=t.onModified(n);const o=e.delete;e.delete=()=>{s.unsubscribe(),s=null,o()}}function tg(e,t){const n=Yo({id:t.id,store:t._store,key:"firstPoint",visible:!0}),s=Yo({id:t.id,store:t._store,key:"secondPoint",visible:!0});Qo(e,n,()=>e.modified()),Qo(e,s,()=>e.modified()),t.labels={[Wa]:[n,s]},e.getFirstPoint=()=>n,e.getSecondPoint=()=>s}const ng=e=>({isPlaced:!1,...e});function og(e,t,n){Object.assign(t,ng(n)),mn.extend(e,t,n),Di.extend(e,t),_.get(e,t,["id"]),_.setGet(e,t,["isPlaced"]),_.moveToProtected(e,t,["store"]),tg(e,t)}const ig=_.newInstance(og,"vtkRulerWidgetState");function ag(e,t){t.classHierarchy.push("vtkRulerWidget"),e.getRepresentationsForViewType=()=>[{builder:Br,labels:[Wa],initialValues:{scaleInPixels:!0}}],e.getLength=()=>{const n=t.widgetState.getFirstPoint().getOrigin(),s=t.widgetState.getSecondPoint().getOrigin();return!n||!s?0:Math.sqrt(Ii(n,s))},t.manipulator=ze.newInstance()}const sg={};function za(e,t,n={}){Object.assign(t,sg,n),fn.extend(e,t,{...n,behavior:Qh,widgetState:ig(n)}),_.get(e,t,["manipulator"]),ag(e,t)}const rg=_.newInstance(za,"vtkRulerWidget"),ja={newInstance:rg,extend:za};function en(e,t,n,s){const{lpsOrientation:o}=s,i=o[be(t)],a=o[t],r=[0,0,0];r[i]=n,pe(r,r,s.indexToWorld),e.setUserNormal(a),e.setUserOrigin(r)}const lg=X({props:{point1:Array,point2:Array,color:String,length:Number,viewId:{type:String,required:!0},textOffset:{type:Number,default:8},textSize:{type:Number,default:14}},setup(e){const{viewId:t,point1:n,point2:s,textOffset:o,length:i}=oe(e),a=B(),r=B(),l=he(),c=I(()=>l.getViewProxy(t.value)),u=()=>{const f=c.value.getRenderer(),p=z(n),m=z(s);if(p){const w=Ht(p,f);w&&(a.value={x:w[0],y:w[1]})}else a.value=null;if(m){const w=Ht(m,f);w&&(r.value={x:w[0],y:w[1]})}else r.value=null};Se(I(()=>c.value.getCamera().onModified))(u),F([c,n,s],u,{deep:!0,immediate:!0});const h=I(()=>{const f=z(a),p=z(r),m=o.value;return!f||!p?null:p.x>f.x?{dx:m,dy:-m,anchor:"start"}:{dx:-m,dy:-m,anchor:"end"}}),v=It(gn);return Tn(v,()=>{u()}),{devicePixelRatio,textdx:I(()=>{var f;return((f=h.value)==null?void 0:f.dx)??0}),textdy:I(()=>{var f;return((f=h.value)==null?void 0:f.dy)??0}),anchor:I(()=>{var f;return((f=h.value)==null?void 0:f.anchor)??"start"}),first:a,second:r,rulerLength:I(()=>{var f;return((f=i==null?void 0:i.value)==null?void 0:f.toFixed(2))??""})}}});const cg=["x1","y1","x2","y2","stroke"],ug=["cx","cy","stroke","r"],dg=["cx","cy","stroke","r"],hg=["x","y","dx","dy","text-anchor","font-size"];function gg(e,t,n,s,o,i){return R(),E("g",null,[e.first&&e.second?(R(),E("line",{key:0,x1:e.first.x,y1:e.first.y,x2:e.second.x,y2:e.second.y,stroke:e.color,"stroke-width":"1"},null,8,cg)):j("",!0),e.first?(R(),E("circle",{key:1,cx:e.first.x,cy:e.first.y,stroke:e.color,"stroke-width":"1",fill:"transparent",r:10/e.devicePixelRatio},null,8,ug)):j("",!0),e.second?(R(),E("circle",{key:2,cx:e.second.x,cy:e.second.y,stroke:e.color,"stroke-width":"1",fill:"transparent",r:10/e.devicePixelRatio,class:"handle"},null,8,dg)):j("",!0),e.second?(R(),E("text",{key:3,x:e.second.x,y:e.second.y,dx:e.textdx,dy:e.textdy,"text-anchor":e.anchor,"stroke-width":"0.75",stroke:"black",fill:"white","font-size":`${e.textSize}px`,"font-weight":"bold"},U(e.rulerLength),9,hg)):j("",!0)])}const fg=A(lg,[["render",gg],["__scopeId","data-v-85f6f954"]]),pg=X({name:"RulerWidget2D",emits:["placed","contextmenu"],props:{rulerId:{type:String,required:!0},widgetManager:{type:Object,required:!0},viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},currentSlice:{type:Number,required:!0},isPlacing:{type:Boolean,default:!1}},components:{RulerSVG2D:fg},setup(e,{emit:t}){const{rulerId:n,widgetManager:s,viewDirection:o,currentSlice:i,isPlacing:a}=oe(e),r=Ue(),l=I(()=>r.rulerByID[n.value]),{currentImageID:c,currentImageMetadata:u}=re(),d=ja.newInstance({id:n.value,store:r,isPlaced:!a.value}),h=B(null);te(()=>{h.value=s.value.addWidget(d)}),Ae(()=>{h.value&&(s.value.removeWidget(h.value),h.value.delete(),d.delete())}),F([a,h],([S,b])=>{S&&b&&b.setInteractionState(jt.PlacingFirst)},{immediate:!0}),F([i,c,h],()=>{var b;const S=(b=h.value)==null?void 0:b.getWidgetState().getIsPlaced();h.value&&!S&&(h.value.resetInteractions(),h.value.setInteractionState(jt.PlacingFirst))}),Se(I(()=>{var S;return(S=h.value)==null?void 0:S.onPlacedEvent}))(()=>{t("placed")});let f=null;te(()=>{h.value&&(f=h.value.onRightClickEvent(S=>{const b=ao(S);b&&t("contextmenu",b)}))}),Ee(()=>{f&&(f.unsubscribe(),f=null)});const p=ze.newInstance();te(()=>{h.value&&h.value.setManipulator(p)}),fe(()=>{var S;en(p,o.value,((S=l.value)==null?void 0:S.slice)??i.value,u.value)}),F(()=>{var S;return!!h.value&&((S=l.value)==null?void 0:S.slice)===i.value},S=>{var b;(b=h.value)==null||b.setVisibility(S)},{immediate:!0}),te(()=>{h.value&&(h.value.setHandleVisibility(!1),s.value.renderWidgets())});const m=S=>{const b=B(!1),O=()=>{S.value&&(b.value=S.value.getVisible())};return Se(I(()=>{var k;return(k=S.value)==null?void 0:k.onModified}))(()=>O()),ui(S,()=>O()),b},w=m(I(()=>{var S;return(S=h.value)==null?void 0:S.getWidgetState().getFirstPoint()})),T=m(I(()=>{var S;return(S=h.value)==null?void 0:S.getWidgetState().getSecondPoint()}));return{ruler:l,firstPoint:I(()=>w.value?l.value.firstPoint:void 0),secondPoint:I(()=>T.value?l.value.secondPoint:void 0),length:I(()=>r.lengthByID[l.value.id])}}});function mg(e,t,n,s,o,i){const a=V("RulerSVG2D");return tt((R(),Y(a,{"view-id":e.viewId,point1:e.firstPoint,point2:e.secondPoint,color:e.ruler.color,length:e.length},null,8,["view-id","point1","point2","color","length"])),[[Bt,e.currentSlice===e.ruler.slice]])}const vg=A(pg,[["render",mg]]),yg=X({name:"RulerTool",props:{viewId:{type:String,required:!0},currentSlice:{type:Number,required:!0},viewDirection:{type:String,required:!0},widgetManager:{type:Object,required:!0}},components:{RulerWidget2D:vg},setup(e){const{viewDirection:t,currentSlice:n}=oe(e),s=Ve(),o=Ue(),{rulers:i,activeLabel:a}=rt(o),{currentImageID:r,currentImageMetadata:l}=re(),c=I(()=>s.currentTool===ce.Ruler),u=I(()=>be(t.value)),d=B(null);F(d,(S,b)=>{b!=null&&o.updateRuler(b,{placing:!1}),S!=null&&o.updateRuler(S,{placing:!0})},{immediate:!0}),F([c,r],([S,b])=>{d.value!=null&&(o.removeRuler(d.value),d.value=null),S&&b&&(d.value=o.addRuler({imageID:b,placing:!0}))},{immediate:!0}),F([a,d],([S,b])=>{b!=null&&o.updateRuler(b,{label:S,...S&&o.labels[S]})},{immediate:!0}),Ae(()=>{d.value!=null&&(o.removeRuler(d.value),d.value=null)});const h=()=>{r.value&&(d.value=o.addRuler({imageID:r.value,placing:!0}))},v=()=>{const{lpsOrientation:S,indexToWorld:b}=l.value,O=S[t.value],D=S[u.value],k=[0,0,0];return k[D]=n.value,pe(k,k,b),{planeNormal:O,planeOrigin:k}};F([n,d],([S,b])=>{b&&o.updateRuler(b,{frameOfReference:v(),slice:S})},{immediate:!0});const f=We({show:!1,x:0,y:0,forRulerID:""}),p=(S,b)=>{[f.x,f.y]=b,f.show=!0,f.forRulerID=S},m=()=>{o.removeRuler(f.forRulerID)},w=S=>{if(!S.frameOfReference)return!1;const b=Sn(S.frameOfReference,l.value,{allowOutOfBoundsSlice:!0});return!!b&&b.axis===u.value};return{rulers:I(()=>{const{lengthByID:S}=o,b=r.value;return i.value.filter(D=>D.imageID===b&&w(D)).map(D=>({...D,length:S[D.id]}))}),placingRulerID:d,contextMenu:f,openContextMenu:p,deleteRulerFromContextMenu:m,onRulerPlaced:h}}});const wg={class:"overlay-no-events"},Sg={class:"overlay-no-events"};function _g(e,t,n,s,o,i){const a=V("RulerWidget2D");return R(),E("div",wg,[(R(),E("svg",Sg,[(R(!0),E(ie,null,Pe(e.rulers,r=>(R(),Y(a,{key:r.id,"ruler-id":r.id,"is-placing":r.id===e.placingRulerID,"current-slice":e.currentSlice,"view-id":e.viewId,"view-direction":e.viewDirection,"widget-manager":e.widgetManager,onContextmenu:l=>e.openContextMenu(r.id,l),onPlaced:e.onRulerPlaced},null,8,["ruler-id","is-placing","current-slice","view-id","view-direction","widget-manager","onContextmenu","onPlaced"]))),128))])),y(yt,{modelValue:e.contextMenu.show,"onUpdate:modelValue":t[0]||(t[0]=r=>e.contextMenu.show=r),class:"position-absolute",style:ne({top:`${e.contextMenu.y}px`,left:`${e.contextMenu.x}px`}),"close-on-click":"","close-on-content-click":""},{default:x(()=>[y(At,{density:"compact"},{default:x(()=>[y(Ze,{onClick:e.deleteRulerFromContextMenu},{default:x(()=>[y(Re,null,{default:x(()=>[H("Delete")]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1},8,["modelValue","style"])])}const Cg=A(yg,[["render",_g],["__scopeId","data-v-6e6ae374"]]);function bg(e,t){t.classHierarchy.push("vtkRectangleWidget")}const Tg={};function Ga(e,t,n={}){Object.assign(t,Tg,n);const{store:s,...o}=n,i={...s,rulerByID:s.toolByID,updateRuler:s.updateTool};ja.extend(e,t,{store:i,...o}),bg(e,t)}const Ig=_.newInstance(Ga,"vtkRectangleWidget"),Rg={newInstance:Ig,extend:Ga},xg=X({props:{point1:Array,point2:Array,color:String,fillColor:String,viewId:{type:String,required:!0}},setup(e){const{viewId:t,point1:n,point2:s}=oe(e),o=B(),i=B(),a=he(),r=I(()=>a.getViewProxy(t.value)),l=()=>{const h=r.value.getRenderer(),v=z(n),f=z(s);if(v){const p=Ht(v,h);p&&(o.value={x:p[0],y:p[1]})}else o.value=null;if(f){const p=Ht(f,h);p&&(i.value={x:p[0],y:p[1]})}else i.value=null},c=I(()=>{var m,w,T,S;const[h,v]=[((m=o.value)==null?void 0:m.x)??0,((w=o.value)==null?void 0:w.y)??0],[f,p]=[((T=i.value)==null?void 0:T.x)??h,((S=i.value)==null?void 0:S.y)??v];return{x:Math.min(h,f),y:Math.min(v,p),width:Math.abs(h-f),height:Math.abs(v-p)}});Se(I(()=>r.value.getCamera().onModified))(l),F([r,n,s],l,{deep:!0,immediate:!0});const d=It(gn);return Tn(d,()=>{l()}),{devicePixelRatio,first:o,second:i,rectangle:c}}}),Dg=["x","y","width","height","stroke","fill"],Eg=["cx","cy","stroke","r"],Lg=["cx","cy","stroke","r"];function Og(e,t,n,s,o,i){return R(),E("g",null,[g("rect",{x:e.rectangle.x,y:e.rectangle.y,width:e.rectangle.width,height:e.rectangle.height,stroke:e.color,"stroke-width":"1",fill:e.fillColor},null,8,Dg),e.first?(R(),E("circle",{key:0,cx:e.first.x,cy:e.first.y,stroke:e.color,"stroke-width":"1",fill:"transparent",r:10/e.devicePixelRatio},null,8,Eg)):j("",!0),e.second?(R(),E("circle",{key:1,cx:e.second.x,cy:e.second.y,stroke:e.color,"stroke-width":"1",fill:"transparent",r:10/e.devicePixelRatio},null,8,Lg)):j("",!0)])}const Pg=A(xg,[["render",Og]]),Vg=He,kg=Rg,Mg=Pg,Bg=X({name:"RectangleWidget2D",emits:["placed","contextmenu"],props:{toolId:{type:String,required:!0},widgetManager:{type:Object,required:!0},viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},currentSlice:{type:Number,required:!0},isPlacing:{type:Boolean,default:!1}},components:{SVG2DComponent:Mg},setup(e,{emit:t}){const{toolId:n,widgetManager:s,viewDirection:o,currentSlice:i,isPlacing:a}=oe(e),r=B(n.value),l=Vg(),c=I(()=>l.toolByID[r.value]),{currentImageID:u,currentImageMetadata:d}=re(),h=kg.newInstance({id:r.value,store:l,isPlaced:!a.value}),v=B(null);te(()=>{v.value=s.value.addWidget(h)}),Ae(()=>{v.value&&(s.value.removeWidget(v.value),v.value.delete(),h.delete())}),F([a,v],([b,O])=>{b&&O&&O.setInteractionState(jt.PlacingFirst)},{immediate:!0}),F([i,u,v],()=>{var O;const b=(O=v.value)==null?void 0:O.getWidgetState().getIsPlaced();v.value&&!b&&(v.value.resetInteractions(),v.value.setInteractionState(jt.PlacingFirst))}),Se(I(()=>{var b;return(b=v.value)==null?void 0:b.onPlacedEvent}))(()=>{t("placed")});let p=null;te(()=>{v.value&&(p=v.value.onRightClickEvent(b=>{const O=ao(b);O&&t("contextmenu",O)}))}),Ee(()=>{p&&(p.unsubscribe(),p=null)});const m=ze.newInstance();te(()=>{v.value&&v.value.setManipulator(m)}),fe(()=>{var b;en(m,o.value,((b=c.value)==null?void 0:b.slice)??i.value,d.value)}),F(()=>{var b;return!!v.value&&((b=c.value)==null?void 0:b.slice)===i.value},b=>{var O;(O=v.value)==null||O.setVisibility(b)},{immediate:!0}),te(()=>{v.value&&(v.value.setHandleVisibility(!1),s.value.renderWidgets())});const w=b=>{const O=B(!1),D=()=>{b.value&&(O.value=b.value.getVisible())};return Se(I(()=>{var L;return(L=b.value)==null?void 0:L.onModified}))(()=>D()),ui(b,()=>D()),O},T=w(I(()=>{var b;return(b=v.value)==null?void 0:b.getWidgetState().getFirstPoint()})),S=w(I(()=>{var b;return(b=v.value)==null?void 0:b.getWidgetState().getSecondPoint()}));return{tool:c,firstPoint:I(()=>T.value?c.value.firstPoint:void 0),secondPoint:I(()=>S.value?c.value.secondPoint:void 0)}}});function Ag(e,t,n,s,o,i){const a=V("SVG2DComponent");return tt((R(),Y(a,{"view-id":e.viewId,point1:e.firstPoint,point2:e.secondPoint,color:e.tool.color,"fill-color":e.tool.fillColor},null,8,["view-id","point1","point2","color","fill-color"])),[[Bt,e.currentSlice===e.tool.slice]])}const Fg=A(Bg,[["render",Ag]]),Ng=He,$g=X({name:"RectangleTool",props:{viewId:{type:String,required:!0},currentSlice:{type:Number,required:!0},viewDirection:{type:String,required:!0},widgetManager:{type:Object,required:!0}},components:{RectangleWidget2D:Fg},setup(e){const{viewDirection:t,currentSlice:n}=oe(e),s=Ve(),o=Ng(),{tools:i,activeLabel:a}=rt(o),{currentImageID:r,currentImageMetadata:l}=re(),c=I(()=>s.currentTool===ce.Rectangle),u=I(()=>be(t.value)),d=B(null);F(d,(S,b)=>{b!=null&&o.updateTool(b,{placing:!1}),S!=null&&o.updateTool(S,{placing:!0})},{immediate:!0}),F([c,r],([S,b])=>{d.value!=null&&(o.removeTool(d.value),d.value=null),S&&b&&(d.value=o.addTool({imageID:b,placing:!0}))},{immediate:!0}),F([a,d],([S,b])=>{b!=null&&o.updateTool(b,{label:S,...S&&o.labels[S]})},{immediate:!0}),Ae(()=>{d.value!=null&&(o.removeTool(d.value),d.value=null)});const h=()=>{r.value&&(d.value=o.addTool({imageID:r.value,placing:!0}))},v=()=>{const{lpsOrientation:S,indexToWorld:b}=l.value,O=S[t.value],D=S[u.value],k=[0,0,0];return k[D]=n.value,pe(k,k,b),{planeNormal:O,planeOrigin:k}};F([n,d],([S,b])=>{b&&o.updateTool(b,{frameOfReference:v(),slice:S})},{immediate:!0});const f=We({show:!1,x:0,y:0,forToolID:""}),p=(S,b)=>{[f.x,f.y]=b,f.show=!0,f.forToolID=S},m=()=>{o.removeTool(f.forToolID)},w=S=>{if(!S.frameOfReference)return!1;const b=Sn(S.frameOfReference,l.value,{allowOutOfBoundsSlice:!0});return!!b&&b.axis===u.value};return{tools:I(()=>{const S=r.value;return i.value.filter(b=>b.imageID===S&&w(b))}),placingToolID:d,contextMenu:f,openContextMenu:p,deleteToolFromContextMenu:m,onToolPlaced:h}}});const Ug={class:"overlay-no-events"},Hg={class:"overlay-no-events"};function Wg(e,t,n,s,o,i){const a=V("RectangleWidget2D");return R(),E("div",Ug,[(R(),E("svg",Hg,[(R(!0),E(ie,null,Pe(e.tools,r=>(R(),Y(a,{key:r.id,"tool-id":r.id,"is-placing":r.id===e.placingToolID,"current-slice":e.currentSlice,"view-id":e.viewId,"view-direction":e.viewDirection,"widget-manager":e.widgetManager,onContextmenu:l=>e.openContextMenu(r.id,l),onPlaced:e.onToolPlaced},null,8,["tool-id","is-placing","current-slice","view-id","view-direction","widget-manager","onContextmenu","onPlaced"]))),128))])),y(yt,{modelValue:e.contextMenu.show,"onUpdate:modelValue":t[0]||(t[0]=r=>e.contextMenu.show=r),class:"position-absolute",style:ne({top:`${e.contextMenu.y}px`,left:`${e.contextMenu.x}px`}),"close-on-click":"","close-on-content-click":""},{default:x(()=>[y(At,{density:"compact"},{default:x(()=>[y(Ze,{onClick:e.deleteToolFromContextMenu},{default:x(()=>[y(Re,null,{default:x(()=>[H("Delete")]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1},8,["modelValue","style"])])}const zg=A($g,[["render",Wg],["__scopeId","data-v-152d5701"]]),jg=32,Zo=2,Gg=4;function Xg(e,t){t.classHierarchy.push("vtkContourRepresentation"),t._polyData=Je.newInstance({mtime:0}),t._pdPoints=null,t._pdLines=null,t._pipelines={lines:{source:e,mapper:qt.newInstance(),actor:Ei.newInstance({parentProp:e})}},t._pipelines.lines.actor.getProperty().setLineWidth(2),Xn.connectPipeline(t._pipelines.lines),e.addActor(t._pipelines.lines.actor),e.getRepresentationStates=(i=t.inputData[0])=>i;function n(i){var p,m;const a=i.getPolyLine(),r=i.getReferencePlane(),l=i.getPolyLineLength(),c=i.getFinalized(),u=c?1:0;if(!a||!r)return;((p=t._pdPoints)==null?void 0:p.length)!==l*3&&(t._pdPoints=new Float32Array(l*3)),((m=t._pdLines)==null?void 0:m.length)!==l+1&&(t._pdLines=new Float32Array(l+1+u));let d=0,h=0;t._pdLines[h++]=l+u;const v=Me(),f=De();for(let w=0;w<a.length;)t._pdLines[h++]=d/3,ci(v,a[w++],a[w++]),_n(v,r,f),t._pdPoints[d++]=f[0],t._pdPoints[d++]=f[1],t._pdPoints[d++]=f[2];c&&(t._pdLines[h]=0)}let s=Zo;e.requestData=(i,a)=>{const r=e.getRepresentationStates(i[0]);n(r),t._pdPoints&&t._pdLines&&(t._polyData.getPoints().setData(t._pdPoints),t._polyData.getLines().setData(t._pdLines),t._polyData.getPoints().modified(),t._polyData.modified()),s=r.getSelected()?Gg:Zo,t._pipelines.lines.actor.getProperty().setLineWidth(s),t._pipelines.lines.actor.getProperty().setColor(r.getColor()),a[0]=t._polyData},e.getSelectedState=()=>t.inputData[0];const{updateActorVisibility:o}=e;e.updateActorVisibility=(i=Po.FRONT_BUFFER,a=!0,r=!0)=>{i===Po.PICKING_BUFFER?t._pipelines.lines.actor.getProperty().setLineWidth(jg):t._pipelines.lines.actor.getProperty().setLineWidth(s),o(i,a,r)}}const qg={};function Xa(e,t,n={}){const s={...qg,...n};Xn.extend(e,t,s),Xg(e,t)}const Kg=_.newInstance(Xa,"vtkContourRepresentation"),Yg={newInstance:Kg,extend:Xa};var Oe=(e=>(e.Select="Select",e.Freehand="Freehand",e.Nudge="Nudge",e.PointPlacing="PointPlacing",e.Threshold="Threshold",e))(Oe||{});const Q={Idle:"Idle",Moving:"Moving",FreehandDrawing:"FreehandDrawing",Nudging:"Nudging",PointPlacing:"PointPlacing",Thresholding:"Thresholding"};function de(e){return e.altKey||e.controlKey||e.shiftKey}function Te(e,t){const n=e.manipulator.handleEvent(t,e._apiSpecificRenderWindow);return(n==null?void 0:n.length)===3?n:null}function qa(e,t){const n=(t==null?void 0:t.degree)??2,s=(t==null?void 0:t.interPointSpacing)??.1,o=(t==null?void 0:t.closed)??!1,i=(t==null?void 0:t.clamped)??!1,a=e.length/3,r=[],l=Me();let c=0;for(let f=0;f<e.length;f+=2){const p=[e[f],e[f+1]];r.push(p),f>0&&(c+=di(l,p)),Ms(l,p)}o&&r.push(...r.slice(0,n+1));let u;if(i){u=[];const f=r.length;for(let p=0;p<f+n+1;p++)u.push(p)}const d=!i&&o?1-1/(a+1):1,h=(t==null?void 0:t.dt)??s/c,v=[];for(let f=0;f<1;f+=h){const p=Bs(f*d,n,r,u);v.push(p[0],p[1])}return v}function Qg(e,t){const n={...e};function s(){return e.getMode()===Oe.Freehand}function o(){e.setInteractionState(Q.Idle),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent()}e.resetInteractionState=()=>{s()&&!e.isInteractionIdle()&&(t.widgetState.clearPolyLine(),o()),n.resetInteractionState()},e.handleLeftButtonPress=i=>{var l;if(((l=n.handleLeftButtonPress)==null?void 0:l.call(n,i))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||!t.manipulator||de(i))return _.VOID;if(t.widgetState.getFinalized())return _.VOID;const a=t._widgetManager.getActiveWidget();if(a&&a!==e)return _.VOID;const r=Te(t,i);return r?(e.setInteractionState(Q.FreehandDrawing),t.widgetState.clearPolyLine(),t.widgetState.add3dPointToPolyLine(r),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),_.EVENT_ABORT):_.VOID},e.handleMouseMove=i=>{var r;if(((r=n.handleMouseMove)==null?void 0:r.call(n,i))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||e.getInteractionState()!==Q.FreehandDrawing||de(i))return _.VOID;const a=Te(t,i);return a&&(t.widgetState.add3dPointToPolyLine(a),e.invokeInteractionEvent()),_.EVENT_ABORT},e.handleLeftButtonRelease=i=>{var l;if(((l=n.handleLeftButtonRelease)==null?void 0:l.call(n,i))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||e.getInteractionState()!==Q.FreehandDrawing||de(i))return _.VOID;const a=Te(t,i);if(a&&t.widgetState.add3dPointToPolyLine(a),t.widgetState.getPolyLine().length>=3*2){const c=qa(t.widgetState.getPolyLine(),{degree:2,interPointSpacing:.01,closed:!0,clamped:!1});t.widgetState.setPolyLine(c),t.widgetState.setFinalized(!0)}return o(),_.EVENT_ABORT}}const Zg=new Set([Oe.Nudge]);function Jg(e,t){const n={...e};let s=[0,0],o=null;_.event(e,t,"SelectedEvent");const i=Me();function a(l){if(!o)return;As(i,l,s);const c=t.widgetState.getPolyLine();for(let u=0;u<c.length;u+=2)c[u]=o[u]+i[0],c[u+1]=o[u+1]+i[1];t.widgetState.modified()}function r(){e.setInteractionState(Q.Idle),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent()}e.resetInteractionState=()=>{e.getInteractionState()===Q.Moving&&r(),n.resetInteractionState()},e.handleLeftButtonPress=l=>{var u;if(((u=n.handleLeftButtonPress)==null?void 0:u.call(n,l))===_.EVENT_ABORT)return _.EVENT_ABORT;if(de(l))return _.VOID;if(t._widgetManager.getActiveWidget()!==e)return Zg.has(e.getMode())||e.invokeSelectedEvent(!1),_.VOID;e.invokeSelectedEvent(!0);const c=Te(t,l);return c?(s=et(c,t.widgetState.getReferencePlane()),o=[...t.widgetState.getPolyLine()],e.setInteractionState(Q.Moving),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),_.EVENT_ABORT):_.EVENT_ABORT},e.handleMouseMove=l=>{var u;if(((u=n.handleMouseMove)==null?void 0:u.call(n,l))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!e.isSelected()||e.getInteractionState()!==Q.Moving||de(l))return _.VOID;const c=Te(t,l);return c&&(a(et(c,t.widgetState.getReferencePlane())),e.invokeInteractionEvent()),_.EVENT_ABORT},e.handleLeftButtonRelease=l=>{var u;if(((u=n.handleLeftButtonRelease)==null?void 0:u.call(n,l))===_.EVENT_ABORT)return _.EVENT_ABORT;if(e.getInteractionState()!==Q.Moving||de(l))return _.VOID;const c=Te(t,l);return c&&a(et(c,t.widgetState.getReferencePlane())),r(),_.EVENT_ABORT}}function Bn(e,t,n){return(e+t)%n}function ef(e,t,n){e[0]=(t[0]+n[0])/2,e[1]=(t[1]+n[1])/2}function tf(e,t,n){const{radius:s,center:o}=t,i=s**2,a=De(),r=[0,0,0],l=[0,0];for(let c=0;c<e.length;c+=2){mt(l,e[c],e[c+1]),_n(l,n,r);const u=Fs(r,o);u>=i||(si(a,r,o),Ns(a,a,Math.sqrt(i/u)),$s(r,o,a),et(r,n,l),e[c]=l[0],e[c+1]=l[1])}}function nf(e,t,n){if(e.length<2)return;const s=t**2,o=n**2,i=Me(),a=Me(),r=Me(),l=Me();let c=0,u=!1,d=!1;do{let h=c;const v=Bn(c,2,e.length);mt(i,e[c],e[c+1]),mt(a,e[v],e[v+1]);const f=hi(i,a);if(f<s)ef(r,i,a),e.splice(v,2),e.splice(c,2),e.splice(c,0,...r);else if(f>o){const m=1/(Math.ceil(Math.sqrt(f/o))+1),w=[];for(let T=m;T<1;T+=m)Us(l,i,a,T),w.push(...l);e.splice(v,0,...w),h=Bn(c,w.length+2,e.length)}else h=Bn(c,2,e.length);d=u,u=h<c,c=h}while(!d)}function of(e,t,n,s=1e-4,o=.1){tf(e,t,n),nf(e,s,o)}function af(e,t){let n=0,s=1/0;const o=Me();for(let i=0;i<e.length;i+=2){mt(o,e[i],e[i+1]);const a=hi(o,t);a<s&&(n=i,s=a)}return n}const sf=.95;function rf(e,t){const n={...e};t._radius=1;function s(){return e.getMode()===Oe.Nudge}function o(a){const r=t.widgetState.getPolyLine(),l=t.widgetState.getReferencePlane();of(r,{center:a,radius:t._radius},l),t.widgetState.modified()}function i(){e.getWidgetState().getCircleContext().setVisible(!1),e.setInteractionState(Q.Idle),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent()}e.resetInteractionState=()=>{s()&&!e.isInteractionIdle()&&i(),n.resetInteractionState()},e.handleLeftButtonPress=a=>{var T;if(((T=n.handleLeftButtonPress)==null?void 0:T.call(n,a))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||!e.isSelected()||!t.manipulator||de(a))return _.VOID;const r=t._widgetManager.getActiveWidget();if(r&&r!==e)return _.VOID;const l=Te(t,a);if(!l)return _.VOID;const{widgetState:c}=t,u=c.getPolyLine(),d=c.getReferencePlane(),h=af(u,et(l,d)),v=Hs(l,_n([u[h],u[h+1]],d));t._radius=v*sf;const f=t.manipulator.getNormal(),p=t._renderer.getActiveCamera().getViewUp(),m=De();zn(m,p,f);const w=c.getCircleContext();return w.setDirection(f),w.setUp(p),w.setRight(m),w.setOrigin(l),w.setScale3([t._radius,t._radius,1]),w.setVisible(!0),e.setInteractionState(Q.Nudging),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),_.EVENT_ABORT},e.handleMouseMove=a=>{var l;if(((l=n.handleMouseMove)==null?void 0:l.call(n,a))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||!e.isSelected()||e.getInteractionState()!==Q.Nudging||de(a))return _.VOID;const r=Te(t,a);return r&&(e.getWidgetState().getCircleContext().setOrigin(r),o(r),e.invokeInteractionEvent()),_.EVENT_ABORT},e.handleLeftButtonRelease=a=>{var l;if(((l=n.handleLeftButtonRelease)==null?void 0:l.call(n,a))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||!e.isSelected()||e.getInteractionState()!==Q.Nudging||de(a))return _.VOID;const r=Te(t,a);return r&&o(r),i(),_.EVENT_ABORT}}function lf(e,t){const n={...e};function s(){return e.getMode()===Oe.PointPlacing}function o(){t._widgetManager.releaseFocus(),e.setInteractionState(Q.Idle),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent()}function i(r){const l=t.widgetState.getPolyLine(),c=l.length-1;l[c-1]=r[0],l[c]=r[1],t.widgetState.modified()}function a(){t.widgetState.getPolyLine().splice(-2,2),t.widgetState.modified()}e.resetInteractionState=()=>{s()&&!e.isInteractionIdle()&&(t.widgetState.clearPolyLine(),o()),n.resetInteractionState()},e.handleLeftButtonPress=r=>{var d;if(((d=n.handleLeftButtonPress)==null?void 0:d.call(n,r))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||!t.manipulator||de(r))return _.VOID;if(t.widgetState.getFinalized())return _.VOID;const l=t._widgetManager.getActiveWidget();if(l&&l!==e)return _.VOID;const c=Te(t,r);if(!c)return _.VOID;const u=et(c,t.widgetState.getReferencePlane());return e.getInteractionState()===Q.PointPlacing?(i(u),t.widgetState.add2dPointToPolyLine(u),e.invokeInteractionEvent()):(t._widgetManager.grabFocus(e),e.setInteractionState(Q.PointPlacing),t.widgetState.setFinalized(!1),t.widgetState.clearPolyLine(),t.widgetState.add2dPointToPolyLine(u),t.widgetState.add2dPointToPolyLine(u),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent()),_.EVENT_ABORT},e.handleMouseMove=r=>{var c;if(((c=n.handleMouseMove)==null?void 0:c.call(n,r))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||e.getInteractionState()!==Q.PointPlacing||de(r))return _.VOID;const l=Te(t,r);if(l){const u=et(l,t.widgetState.getReferencePlane());i(u),e.invokeInteractionEvent()}return _.EVENT_ABORT},e.handleRightButtonPress=r=>{var l;if(((l=n.handleRightButtonPress)==null?void 0:l.call(n,r))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!s()||e.getInteractionState()!==Q.PointPlacing||de(r))return _.VOID;if(a(),t.widgetState.getPolyLineLength()<=2)t.widgetState.clearPolyLine();else{const c=qa(t.widgetState.getPolyLine(),{degree:2,interPointSpacing:.01,closed:!0,clamped:!1});t.widgetState.setPolyLine(c),t.widgetState.setFinalized(!0)}return o(),_.EVENT_ABORT}}const{vtkErrorMacro:cf}=_;function uf(e,t){t.classHierarchy.push("vtkImageMarchingSquares"),e.getContourValues=()=>t.contourValues,e.setContourValues=a=>{t.contourValues=a,e.modified()};const n=[],s=[],o=[],i=Ar.newInstance();e.getPixelScalars=(a,r,l,c,u,d,h,v)=>{n[0]=l*c+r*u[0]+a,n[1]=n[0]+1,n[2]=n[0]+u[0],n[3]=n[2]+1;const f=a>=0,p=r>=0,m=a+1<u[0],w=r+1<u[1];s[0]=f&&p?v[n[0]]:0,s[1]=m&&p?v[n[1]]:0,s[2]=f&&w?v[n[2]]:0,s[3]=m&&w?v[n[3]]:0},e.getPixelPoints=(a,r,l,c,u,d)=>{o[0]=u[0]+a*d[0],o[1]=u[1]+r*d[1],o[2]=o[0]+d[0],o[3]=o[1],o[4]=o[0],o[5]=o[1]+d[1],o[6]=o[2],o[7]=o[5]},e.produceLines=(a,r,l,c,u,d,h,v,f,p,m)=>{var k;const w=[1,2,8,4],T=[];let S;e.getPixelScalars(r,l,c,u,d,h,v,f);let b=0;for(let L=0;L<4;L++)s[L]>=a&&(b|=w[L]);const O=Vo.getCase(b);if(O[0]<0)return;e.getPixelPoints(r,l,c,d,h,v);const D=h[2]+c*v[2];for(let L=0;O[L]>=0;L+=2){m.push(2);for(let $=0;$<2;$++){const K=Vo.getEdge(O[L+$]);if(S=void 0,t.mergePoints&&(S=(k=i.isInsertedEdge(n[K[0]],n[K[1]]))==null?void 0:k.value),S===void 0){const M=K[0]*2,W=o[M],J=o[M+1],_e=K[1]*2,me=o[_e],Ge=o[_e+1];T[0]=W+.5*(me-W),T[1]=J+.5*(Ge-J),S=p.length/3,p.push(T[0],T[1],D),t.mergePoints&&i.insertEdge(n[K[0]],n[K[1]],S)}m.push(S)}}},e.requestData=(a,r)=>{const l=a[0];if(!l){cf("Invalid or missing input");return}const c=l.getOrigin(),u=l.getSpacing(),d=l.getDimensions(),h=l.getPointData().getScalars().getData(),v=[],f=[],p=d[0]*d[1];let m=Math.round(t.slice);m>=d[2]&&(m=0);for(let T=0;T<t.contourValues.length;++T){for(let S=-1;S<d[1];++S)for(let b=-1;b<d[0];++b)e.produceLines(t.contourValues[T],b,S,m,p,d,c,u,h,v,f);i.initialize()}const w=Je.newInstance();w.getPoints().setData(new Float32Array(v),3),w.getLines().setData(new Uint32Array(f)),r[0]=w}}const df={contourValues:[],slice:0,mergePoints:!1};function Ka(e,t,n={}){Object.assign(t,df,n),_.obj(e,t),_.algo(e,t,1,1),_.setGet(e,t,["slice","mergePoints"]),_.algo(e,t,1,1),uf(e,t)}const hf=_.newInstance(Ka,"vtkImageMarchingSquares"),gf={newInstance:hf,extend:Ka},Ya=2,ff=1,pf=0;function mf(e,t){const n=[...e];return n.splice(t,1),n}function vf(e,t){const[n,s]=mf(e.getDimensions(),t),o=new Uint8Array(n*s),i=Ti.newInstance({values:o,numberOfComponents:1}),a=bi.newInstance();return a.setDimensions([n,s,1]),a.getPointData().setScalars(i),a}function yf(e,t,n){const s=[...e];return s.splice(t,0,n),s}function dn(e,t){const n=[...e];return n.splice(t,1),n}function wf(e,t){return di(e,t)}function Jo(e,t=3){if(t>3)throw new Error("Cannot support dim > 3");const n=e.getPointData().getScalars().getData(),[s,o,i]=e.getDimensions(),a=t===3?s*o:0,r=t>=2?s:0;return{get:l=>{const c=l[0]??0,u=l[1]??0,d=l[2]??0;return n[d*a+u*r+c]},set:(l,c)=>{const u=l[0]??0,d=l[1]??0,h=l[2]??0;n[h*a+d*r+u]=c},inBounds:l=>{const c=l[0]??0,u=l[1]??0,d=l[2]??0;return c>=0&&c<s&&u>=0&&u<o&&d>=0&&d<i},fill:l=>{n.fill(l)}}}function Sf(e,t,n,s,o,i,a,r=wf){const l=Jo(e,3),c=Jo(s,2),u=dn(o,t),d=l.get(o),h=d-i,v=d+i;c.fill(pf);const f=[u];for(;f.length;){const p=f.shift();if(!c.inBounds(p)||c.get(p)!==0||r(u,p)>a)continue;c.set(p,ff);const m=yf(p,t,n),w=l.get(m);if(w<h||w>v)continue;c.set(p,Ya);const[T,S]=p;for(let b=-1;b<=1;b++)for(let O=-1;O<=1;O++)(!b&&O||b&&!O)&&f.push([T+b,S+O])}}function _f(e){const t=gf.newInstance({mergePoints:!0});return t.setContourValues([Ya]),t.setInputData(e),t.getOutputData()}Pt(0,1,0,0,0,0,1,0,1,0,0,0,0,0,0,1),Pt(1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1),Pt(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);function Cf(e,t){t.classHierarchy.push("vtkContourLoopExtraction");const n=new Set;e.traverseLoop=(s,o,i,a,r)=>{let l=i,c=a,u=!1,d=0;for(;!u;){const{cellPointIds:h}=s.getCellPoints(l);if(!h)continue;c=h[0]!==c?h[0]:h[1],d++;const v=o*d;r.push({t:v,ptId:c});const f=s.getPointCells(c);if(f.length!==2||c===a)return c;f.length===2?(l=f[0]!==l?f[0]:f[1],n.add(l)):u=!0}return c},e.computeConvexHull=(s,o)=>{const i=s.getPoints().getData(),a=[];for(let u=0;u<i.length;u+=3)a.push([i[u],i[u+1]]);const r=Ws(a,1/0),l=new i.constructor(r.length*3),c=new Uint32Array(1+r.length+1);c[0]=r.length;for(let u=0,d=0;u<r.length;u++,d+=3){const h=r[u];l[d]=h[0],l[d+1]=h[1],l[d+2]=0,c[u+1]=u}c[c.length-1]=c[1],o.getPoints().setData(l),o.getLines().setData(c)},e.extractContours=(s,o)=>{var l;const i=[];n.clear();const a=s.getLines();o.getPoints().setData(Float32Array.from(s.getPoints().getData()));for(let c=0;c<a.getNumberOfCells();c++){if(n.has(c))continue;const{cellPointIds:u}=s.getCellPoints(c);if(!u)continue;n.add(c);const d=u[0],h=[];h.push({t:0,ptId:d});const v=e.traverseLoop(s,1,c,d,h);d!==v&&(e.traverseLoop(s,-1,c,d,h),h.sort((f,p)=>f.t<p.t?-1:1),h.length&&h[0].ptId!==((l=h.at(-1))==null?void 0:l.ptId)&&h.push({...h.at(-1)})),h.length&&i.push(h)}const r=o.getLines();if(r.resize(0),e.getMergeContours()&&i.length){let c=0,u=0;i.forEach((d,h)=>{d.length>u&&(c=h,u=d.length)}),r.insertNextCell(i[c].map(d=>d.ptId))}else i.forEach(c=>{r.insertNextCell(c.map(u=>u.ptId))})},e.requestData=(s,o)=>{const[i]=s;o[0]||(o[0]=Je.newInstance());const[a]=o;e.getConvexHull()?e.computeConvexHull(i,a):e.extractContours(i,a),a.modified()}}const bf={mergeContours:!1,convexHull:!1};function Qa(e,t,n={}){Object.assign(t,bf,n),_.obj(e,t),_.algo(e,t,1,1),_.setGet(e,t,["mergeContours","convexHull"]),Cf(e,t)}const Tf=_.newInstance(Qa,"vtkContourLoopExtraction"),If={newInstance:Tf,extend:Qa};function Rf(e){return Array.isArray(e)?[...e]:e.constructor.from(e)}function xf(e,t){t.classHierarchy.push("vtkTransformPolyDataToPlane"),e.requestData=(n,s)=>{const o=e.getRefPlane()??xa(),[i]=n;s[0]||(s[0]=Je.newInstance());const[a]=s,r=Float32Array.from(i.getPoints().getData());a.getPoints().setData(r);const l=[0,0],c=[0,0,0];for(let d=0;d<r.length;d+=3)mt(l,r[d],r[d+1]),_n(l,o,c),r[d]=c[0],r[d+1]=c[1],r[d+2]=c[2];const u=i.getLines().getData();a.getLines().setData(Rf(u)),a.modified()}}const Df={refPlane:null};function Za(e,t,n={}){Object.assign(t,Df,n),_.obj(e,t),_.algo(e,t,1,1),_.setGet(e,t,["refPlane"]),xf(e,t)}const Ef=_.newInstance(Za,"vtkTransformPolyDataToPlane"),Lf={newInstance:Ef,extend:Za},Of="m",Pf="c",Vf=2;function kf(){const e=Ei.newInstance(),t=qt.newInstance(),n=e.getProperty();return e.setMapper(t),{actor:e,mapper:t,property:n}}function Mf(e,t){const n={...e};t.imageData=null,t.sliceAxis=0,t.slice=0,t.loops=Je.newInstance(),t.maskBoundaryLines=Je.newInstance(),t.mergeContours=!1,t.doConvexHull=!1,t.contour=kf(),t.contour.property.setLineWidth(Vf),t.contourLoopExtraction=If.newInstance(),t.transformPolyData=Lf.newInstance(),t.transformPolyData.setInputConnection(t.contourLoopExtraction.getOutputPort());function s(){t.contour.mapper.setInputData(Je.newInstance())}function o(){var w;(w=t._renderer)==null||w.addActor(t.contour.actor)}function i(){var w;(w=t._renderer)==null||w.removeActor(t.contour.actor)}function a(){const w=t.widgetState.getStore(),T=t.widgetState.getId(),S=w.toolByID[T],b=t.contourLoopExtraction.getOutputData(),O=b.getLines(),D=b.getPoints(),k=O.getData().length,L=[0,0,0];for(let $=0;$<k;){const K=O.getCell($);$+=K.length+1;const Z=[];let{length:M}=K;K[0]===K.at(-1)&&M--;for(let W=0;W<M;W++)D.getPoint(K[W],L),Z.push(L[0],L[1]);w.addTool({...S,polyLine:Z})}}s();let r=null,l=null,c=0,u=0,d=[0,0,0],h=[0,0,0],v=[0,0];function f(){if(!r)return;t.transformPolyData.setRefPlane(t.widgetState.getReferencePlane());const w=t.transformPolyData.getOutputData();t.contour.mapper.setInputData(w),t.contour.mapper.modified()}function p(){return e.getMode()===Oe.Threshold}function m(){i(),s(),e.getWidgetState().getCircleContext().setVisible(!1),t._widgetManager.releaseFocus(),e.setInteractionState(Q.Idle),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent()}e.resetInteractionState=()=>{p()&&!e.isInteractionIdle()&&m(),n.resetInteractionState()},e.setThresholdingImageSlice=(w,T,S)=>{t.imageData=w,t.sliceAxis=T,t.slice=Math.round(S)},e.handleKeyPress=w=>{var S;if(((S=n.handleKeyPress)==null?void 0:S.call(n,w))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!p()||!t.manipulator||de(w)||t.widgetState.getFinalized()||e.getInteractionState()!==Q.Thresholding)return _.VOID;let T=!1;return w.key===Of?(t.mergeContours=!t.mergeContours,t.contourLoopExtraction.setMergeContours(t.mergeContours),T=!0):w.key===Pf&&(t.doConvexHull=!t.doConvexHull,t.contourLoopExtraction.setConvexHull(t.doConvexHull),T=!0),T?(f(),e.invokeInteractionEvent(),_.EVENT_ABORT):_.VOID},e.handleLeftButtonPress=w=>{var O;if(((O=n.handleLeftButtonPress)==null?void 0:O.call(n,w))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!p()||!t.manipulator||de(w))return _.VOID;if(!t.imageData||t.sliceAxis==null||t.slice==null)return _.VOID;if(r=t.imageData,c=t.sliceAxis,u=t.slice,l=vf(r,c),t.widgetState.getFinalized())return _.VOID;const T=t._widgetManager.getActiveWidget();if(T&&T!==e)return _.VOID;const S=Te(t,w);if(!S)return _.VOID;o(),t.mergeContours=!1;const b=t.imageData.worldToIndex(S);return d=S,h=ko(b),v=dn(h,c),t._widgetManager.grabFocus(e),e.setInteractionState(Q.Thresholding),t.widgetState.setFinalized(!1),t.widgetState.clearPolyLine(),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),_.EVENT_ABORT},e.handleMouseMove=w=>{var S;if(((S=n.handleMouseMove)==null?void 0:S.call(n,w))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!p()||e.getInteractionState()!==Q.Thresholding||de(w))return _.VOID;if(!r)return _.VOID;const T=ko(r.worldToIndex(Te(t,w)));if(T&&r&&l){const b=dn(T,c),O=Math.abs(b[0]-v[0]),D=Math.abs(b[1]-v[1]),k=r.getDimensions(),L=dn(k,c),$=Math.sqrt(L[0]**2+k[1]**2),K=r.getPointData().getScalars().getRange(),Z=K[1]-K[0],M=Math.min(D,$)/$*Z;Sf(r,c,u,l,h,M,O),t.maskBoundaryLines=_f(l),t.maskBoundaryLines.buildLinks(),t.contourLoopExtraction.setInputData(t.maskBoundaryLines),f();const W=t.manipulator.getNormal(),J=t._renderer.getActiveCamera().getViewUp(),_e=De();zn(_e,J,W);const me=t.widgetState.getCircleContext();me.setDirection(W),me.setUp(J),me.setRight(_e),me.setOrigin(d),me.setScale3([O,D,1]),me.setVisible(!0),e.invokeInteractionEvent()}return _.EVENT_ABORT},e.handleLeftButtonRelease=w=>{var T;return((T=n.handleLeftButtonRelease)==null?void 0:T.call(n,w))===_.EVENT_ABORT?_.EVENT_ABORT:!p()||e.getInteractionState()!==Q.Thresholding||de(w)?_.VOID:(a(),m(),_.EVENT_ABORT)}}function Bf(e,t){t.classHierarchy.push("vtkContourWidgetProp"),t.interactionState=Q.Idle,t.mode=null,_.event(e,t,"RightClickEvent"),_.setGet(e,t,["manipulator"]),_.setGet(e,t,["mode"]),_.setGet(e,t,["interactionState"]),e.setDisplayCallback=n=>t.representations[0].setDisplayCallback(n),e.isInteractionIdle=()=>e.getInteractionState()===Q.Idle,e.resetInteractionState=()=>{e.setInteractionState(Q.Idle)},e.isSelected=()=>t.widgetState.getSelected(),e.handleRightButtonPress=n=>de(n)||t._widgetManager.getActiveWidget()!==e?_.VOID:(e.invokeRightClickEvent(n),_.EVENT_ABORT),Jg(e,t),Qg(e,t),lf(e,t),rf(e,t),Mf(e,t)}function Af(e,t,n){mn.extend(e,t,n),Fr.extend(e,t,n),xi.extend(e,t,n),Nr.extend(e,t,n),$r.extend(e,t,n)}const Ff=_.newInstance(Af,"vtkCircleContextContourWidgetState");function Nf(e,t){t.classHierarchy.push("vtkContourWidgetState"),t._circleContextState=Ff(),e.bindState(t._circleContextState,["circleContext"]),e.getCircleContext=()=>t._circleContextState;function n(){return t._store.toolByID[t.id]}e.getPolyLine=()=>{var o;return zs((o=n())==null?void 0:o.polyLine)},e.getReferencePlane=()=>{var o;return(o=n())==null?void 0:o.referencePlane},e.getPolyLineLength=()=>{var i;const o=(i=n())==null?void 0:i.polyLine;return o?o.length/2:0};const s=Me();e.add3dPointToPolyLine=o=>{const i=e.getPolyLine(),a=e.getReferencePlane();!i||!a||(et(o,a,s),e.add2dPointToPolyLine(s))},e.add2dPointToPolyLine=o=>{const i=e.getPolyLine();i&&(i.push(...o),e.modified())},e.clearPolyLine=()=>{const o=e.getPolyLine();o&&(o.length=0,e.modified())},e.setPolyLine=o=>{const i=n();i&&(i.polyLine=o,e.modified())},e.getColor=()=>{var i;const o=(i=n())==null?void 0:i.label;return o?ah(t._store.labels[o].color).map(a=>a/255):null}}const $f=e=>({finalized:!1,selected:!1,...e});function Uf(e,t,n){if(Object.assign(t,$f(n)),mn.extend(e,t,n),Di.extend(e,t),_.get(e,t,["id"]),_.setGet(e,t,["finalized","selected"]),_.moveToProtected(e,t,["store"]),_.get(e,t,["_store"]),!t.id)throw new Error("No ID provided!");if(!t._store)throw new Error("No store provided!");Nf(e,t)}const Hf=_.newInstance(Uf,"vtkContourWidgetState");function Wf(e){return Hf(e)}function zf(e,t){t.classHierarchy.push("vtkContourWidget"),e.getRepresentationsForViewType=n=>{switch(n){case Qe.DEFAULT:case Qe.GEOMETRY:case Qe.SLICE:case Qe.VOLUME:default:return[{builder:Yg},{builder:Ur,labels:["circleContext"]}]}},e.setManipulator(t.manipulator||ze.newInstance())}const jf=e=>({manipulator:null,behavior:Bf,widgetState:Wf(e),...e});function Ja(e,t,n={}){Object.assign(t,jf(n)),fn.extend(e,t,n),_.setGet(e,t,["manipulator"]),_.event(e,t,"finalized"),zf(e,t)}const Gf=_.newInstance(Ja,"vtkContourWidget"),Xf={newInstance:Gf,extend:Ja},qf={[ye.Select]:Oe.Select,[ye.FreehandDraw]:Oe.Freehand,[ye.CircleNudge]:Oe.Nudge,[ye.PointPlacing]:Oe.PointPlacing,[ye.Threshold]:Oe.Threshold},Kf=X({name:"ContourWidget2D",emits:["finalize","select","contextmenu"],props:{contourId:{type:String,required:!0},widgetManager:{type:Object,required:!0},viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},currentSlice:{type:Number,required:!0},drawing:{type:Boolean,default:!1},selected:{type:Boolean,default:!1},mode:{type:String,required:!0}},setup(e,{emit:t}){const{viewId:n,contourId:s,widgetManager:o,viewDirection:i,currentSlice:a,drawing:r,selected:l,mode:c}=oe(e),u=Cn(),d=I(()=>u.toolByID[s.value]),{currentImageData:h,currentImageID:v,currentImageMetadata:f}=re(),p=I(()=>u.$proxies.getView(n.value)),m=Xf.newInstance({id:s.value,store:u,finalized:!r.value}),w=B(null),T=I(()=>{var L;return(L=w.value)==null?void 0:L.getWidgetState()});te(()=>{w.value=o.value.addWidget(m)}),Ae(()=>{w.value&&(o.value.removeWidget(w.value),w.value.delete(),m.delete())}),fe(()=>{var $;const L=qf[c.value];($=w.value)==null||$.setMode(L)}),F([a,v,w],()=>{var L;(L=w.value)==null||L.resetInteractionState()}),Ee(()=>{var L;(L=w.value)==null||L.resetInteractionState()}),Se(I(()=>{var L;return(L=w.value)==null?void 0:L.onEndInteractionEvent}))(()=>{var L;(L=w.value)!=null&&L.getWidgetState().getFinalized()&&t("finalize")}),Se(I(()=>{var L;return(L=w.value)==null?void 0:L.onSelectedEvent}))(L=>{t("select",L)}),fe(()=>{var L,$;(L=T.value)==null||L.setSelected(l.value),($=p.value)==null||$.renderLater()});let O=null;te(()=>{w.value&&(O=w.value.onRightClickEvent(L=>{const $=ao(L);$&&t("contextmenu",$)}))}),Ee(()=>{O&&(O.unsubscribe(),O=null)});const D=ze.newInstance();te(()=>{var L;(L=w.value)==null||L.setManipulator(D)}),fe(()=>{en(D,i.value,a.value,f.value)}),F(()=>{var L;return!!p.value&&!!w.value&&((L=d.value)==null?void 0:L.slice)===a.value},L=>{var $;($=w.value)==null||$.setVisibility(L)},{immediate:!0}),te(()=>{var L;w.value&&(w.value.setHandleVisibility(!1),o.value.renderWidgets(),(L=p.value)==null||L.renderLater())}),F(()=>{var L;return(L=w.value)==null?void 0:L.getWidgetState().getColor()},()=>{var L,$;(L=w.value)==null||L.getWidgetState().modified(),($=p.value)==null||$.renderLater()});const k=I(()=>f.value.lpsOrientation[be(i.value)]);return fe(()=>{const L=h.value,$=k.value,K=a.value;w.value&&L&&w.value.setThresholdingImageSlice(L,$,K)}),()=>null}}),Yf=new Set([ye.FreehandDraw,ye.PointPlacing,ye.Threshold]);function Qf(e,t,n=1e-6){return Math.abs(e-t)<n}const Zf=X({components:{ContourWidget2D:Kf},props:{viewId:{type:String,required:!0},currentSlice:{type:Number,required:!0},viewDirection:{type:String,required:!0},widgetManager:{type:Object,required:!0}},setup(e){const{viewId:t,viewDirection:n,currentSlice:s}=oe(e),o=Ve(),i=Cn(),{currentImageID:a,currentImageMetadata:r}=re(),l=I(()=>be(n.value)),{mode:c,selectedContourID:u}=rt(i),d=B(null),h=I(()=>o.currentTool===ce.Contour),v=I(()=>he().viewSpecs[t.value].viewType),f=(M,W)=>{const{toolByID:J}=i;if(!(M in J))return!1;const{referencePlane:_e,imageID:me}=J[M],Ge=kd(_e),Dt=Sn(Ge,r.value,{allowOutOfBoundsSlice:!0});if(!Dt)return!1;const xn=(W==null?void 0:W.checkImageID)??!1,nn=(W==null?void 0:W.checkSlice)??!1,{axis:Dn,slice:on}=Dt;return Dn===l.value&&(!xn||me===a.value)&&(!nn||Qf(on,s.value))},p=I(()=>i.toolIDs.filter(M=>f(M,{checkImageID:!0})).map(M=>i.toolByID[M]).filter(Boolean)),m=()=>{d.value=null},w=()=>{a.value&&!d.value&&(d.value=i.addTool({imageID:a.value}))},T=()=>{d.value!=null&&(i.removeTool(d.value),d.value=null)},{activeLabel:S}=rt(i);F([S,d],([M,W])=>{W&&i.updateTool(W,{label:M})},{immediate:!0}),F([h,a],([M,W])=>{T(),M&&W&&w()},{immediate:!0}),F(c,M=>{T(),Yf.has(M)&&w()},{immediate:!0}),Ae(()=>{T()});const b=M=>{M===d.value&&(m(),w())};function O(){const{lpsOrientation:M,indexToWorld:W}=r.value,J=M[l.value];return Bd(W,s.value,J)}F([s,d],([M,W])=>{W&&i.updateTool(W,{slice:M,referencePlane:O()})},{immediate:!0});const D=(M,W)=>{W?i.selectContour(M):M===u.value&&i.selectContour(null)};F([s,a],()=>{const M=u.value;M&&f(M,{checkImageID:!0,checkSlice:!0})&&i.selectContour(null)}),Wn(["Delete","Backspace"],M=>{M.preventDefault(),u.value&&i.removeTool(u.value)});const k=We({visible:!1,x:0,y:0,id:""}),L=(M,W)=>{[k.x,k.y]=W,k.visible=!0,k.id=M},$=()=>{i.removeTool(k.id)},K=I(()=>{const{id:M}=k;if(!(M in i.toolByID))return[];const W=i.toolByID[M];return Object.entries(i.labels).map(([J,_e])=>({id:J,name:_e.labelName,isCurrent:W.label===J}))}),Z=M=>{i.updateTool(k.id,{label:M})};return{isToolActive:h,is2D:I(()=>v.value==="2D"),contours:p,drawingContourID:d,selectedContourID:u,toolMode:I(()=>h.value?c.value:ye.Select),contextMenu:k,contextMenuLabels:K,onContourFinalized:b,onContourSelected:D,onContextMenu:L,deleteFromContextMenu:$,setLabelFromContextMenu:Z}}});const Jf=e=>(ae("data-v-f660d016"),e=e(),se(),e),ep={key:0,class:"overlay-no-events"},tp=Jf(()=>g("span",null,"Change label to...",-1));function np(e,t,n,s,o,i){const a=V("ContourWidget2D");return e.is2D?(R(),E("div",ep,[(R(!0),E(ie,null,Pe(e.contours,r=>(R(),Y(a,{key:r.id,"view-id":e.viewId,"current-slice":e.currentSlice,"contour-id":r.id,"view-direction":e.viewDirection,"widget-manager":e.widgetManager,drawing:e.drawingContourID===r.id,mode:e.toolMode,selected:e.selectedContourID===r.id,onFinalize:l=>e.onContourFinalized(r.id),onSelect:l=>e.onContourSelected(r.id,l),onContextmenu:l=>e.onContextMenu(r.id,l)},null,8,["view-id","current-slice","contour-id","view-direction","widget-manager","drawing","mode","selected","onFinalize","onSelect","onContextmenu"]))),128)),y(yt,{modelValue:e.contextMenu.visible,"onUpdate:modelValue":t[1]||(t[1]=r=>e.contextMenu.visible=r),style:ne({position:"absolute",top:`${e.contextMenu.y}px`,left:`${e.contextMenu.x}px`}),"close-on-click":"","close-on-content-click":""},{default:x(()=>[y(At,{dense:""},{default:x(()=>[y(Ze,{onClick:t[0]||(t[0]=ue(()=>{},["stop"]))},{default:x(()=>[y(Re,{class:"d-flex flex-row align-center justify-space-betwen"},{default:x(()=>[tp,y(vt,null,{default:x(()=>[H("mdi-chevron-right")]),_:1})]),_:1}),y(yt,{"open-on-hover":"",activator:"parent",location:"end"},{default:x(()=>[y(At,{dense:""},{default:x(()=>[(R(!0),E(ie,null,Pe(e.contextMenuLabels,(r,l)=>(R(),Y(Ze,{key:l},{default:x(()=>[y(sr,{label:r.name,"model-value":r.isCurrent,onClick:c=>e.setLabelFromContextMenu(r.id)},null,8,["label","model-value","onClick"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),y(Ze,{onClick:e.deleteFromContextMenu},{default:x(()=>[y(Re,null,{default:x(()=>[H("Delete")]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1},8,["modelValue","style"])])):j("",!0)}const op=A(Zf,[["render",np],["__scopeId","data-v-f660d016"]]),ip=X({name:"PaintWidget2D",props:{widgetManager:{type:Object,required:!0},viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},slice:{type:Number,required:!0}},setup(e){const{widgetManager:t,viewDirection:n,slice:s,viewId:o}=oe(e),i=lt(),a=i.getWidgetFactory(),r=he(),l=I(()=>r.getViewProxy(o.value)),c=B(),{currentImageMetadata:u}=re(),d=I(()=>be(n.value)),h=I(()=>u.value.lpsOrientation[d.value]),v=m=>{const{worldToIndex:w}=u.value,T=De();return pe(T,m,w),T};te(()=>{const m=t.value;if(c.value=m.addWidget(a),!c.value)throw new Error("[PaintWidget2D] failed to create view widget")}),fe(()=>{const m=c.value,w=u.value,T=w.lpsOrientation[d.value];m&&(m.setSlicingIndex(T),m.setIndexToWorld(w.indexToWorld),m.setWorldToIndex(w.worldToIndex))});const f=[];te(()=>{const m=c.value;f.push(m.onStartInteractionEvent(()=>{const w=m.getWidgetState(),T=v(w.getBrush().getOrigin());i.startStroke(T,h.value)}),m.onInteractionEvent(()=>{const w=m.getWidgetState(),T=v(w.getBrush().getOrigin());i.placeStrokePoint(T,h.value)}),m.onEndInteractionEvent(()=>{const w=m.getWidgetState(),T=v(w.getBrush().getOrigin());i.endStroke(T,h.value)}))}),Ae(()=>{for(;f.length;)f.pop().unsubscribe()});const p=ze.newInstance();return te(()=>{c.value.setManipulator(p)}),fe(()=>{en(p,n.value,s.value,u.value)}),te(()=>{c.value.setVisibility(!1)}),zt(l.value.getInteractor().onMouseEnter(()=>{const m=c.value;m&&(i.setSliceAxis(h.value),m.setVisibility(!0))})),zt(l.value.getInteractor().onMouseLeave(()=>{const m=c.value;m&&m.setVisibility(!1)})),te(()=>{const m=t.value;m.renderWidgets(),m.grabFocus(c.value)}),Ee(()=>{t.value.removeWidget(c.value),t.value.releaseFocus()}),()=>null}}),ap=X({name:"PaintTool",props:{viewId:{type:String,required:!0},slice:{type:Number,required:!0},viewDirection:{type:String,required:!0},widgetManager:{type:Object,required:!0}},components:{PaintWidget2D:ip},setup(){const e=lt();return{active:I(()=>e.isActive)}}});const sp={class:"overlay-no-events"};function rp(e,t,n,s,o,i){const a=V("PaintWidget2D");return R(),E("div",sp,[e.active?(R(),Y(a,{key:0,slice:e.slice,"view-id":e.viewId,"view-direction":e.viewDirection,"widget-manager":e.widgetManager},null,8,["slice","view-id","view-direction","widget-manager"])):j("",!0)])}const lp=A(ap,[["render",rp],["__scopeId","data-v-5ff6d31b"]]);function cp(e,t){const n=he(),s=I(()=>n.getViewProxy(e.value)),o=I(()=>{var u;const c=(u=t.baseImage)==null?void 0:u.value;return c?n.getDataRepresentationForView(c,e.value):null}),i=I(()=>{var u;return(((u=t.labelmaps)==null?void 0:u.value)??[]).map(d=>n.getDataRepresentationForView(d,e.value)).filter(Boolean)}),a=I(()=>{var c;return(((c=t.layers)==null?void 0:c.value)??[]).map(u=>n.getDataRepresentationForView(u,e.value)).filter(Boolean)}),r=I(()=>{var u;return(((u=t.models)==null?void 0:u.value)??[]).map(d=>n.getDataRepresentationForView(d,e.value)).filter(Boolean)}),l=I(()=>[o.value,...i.value,...a.value,...r.value].filter(Boolean));return F([s,l],([c,u],[,d])=>{if(!c)throw new Error("[useSceneBuilder] No view available");d&&qn(u,d)||(c.removeAllRepresentations(),u.forEach(h=>{c.addRepresentation(h)}),c.getRenderer().computeVisiblePropBounds(),c.renderLater())},{immediate:!0}),{baseImageRep:o,labelmapReps:i,layerReps:a,modelReps:r}}function up(e,t,n,...s){const o=so();let i=!0;const a=[];s.indexOf("position")>-1&&a.push(()=>{t.value!==null&&i&&o.updateConfig(e.value,t.value,{position:n.value.getCamera().getPosition()})}),s.indexOf("viewUp")>-1&&a.push(()=>{t.value!==null&&i&&o.updateConfig(e.value,t.value,{viewUp:n.value.getCamera().getViewUp()})}),s.indexOf("focalPoint")>-1&&a.push(()=>{t.value!==null&&i&&o.updateConfig(e.value,t.value,{focalPoint:n.value.getCamera().getFocalPoint()})}),s.indexOf("directionOfProjection")>-1&&a.push(()=>{t.value!==null&&i&&o.updateConfig(e.value,t.value,{directionOfProjection:n.value.getCamera().getDirectionOfProjection()})}),s.indexOf("parallelScale")>-1&&a.push(()=>{t.value!==null&&i&&o.updateConfig(e.value,t.value,{parallelScale:n.value.getCamera().getParallelScale()})}),zt(n.value.getCamera().onModified(()=>{a.forEach(c=>c())}));function r(c){i=!1;try{c()}finally{i=!0}}function l(c){r(()=>{s.forEach(u=>{if(u==="parallelScale"&&c.parallelScale)n.value.getCamera().setParallelScale(c.parallelScale);else if(u==="position"&&c.position){const{position:d}=c;n.value.getCamera().setPosition(d[0],d[1],d[2])}else if(u==="focalPoint"&&c.focalPoint){const{focalPoint:d}=c;n.value.getCamera().setFocalPoint(d[0],d[1],d[2]),n.value.getInteractorStyle2D().setCenterOfRotation([...d]),n.value.getInteractorStyle3D().setCenterOfRotation([...d])}else if(u==="directionOfProjection"&&c.directionOfProjection){const{directionOfProjection:d}=c;n.value.getCamera().setDirectionOfProjection(d[0],d[1],d[2])}else if(u==="viewUp"&&c.viewUp){const{viewUp:d}=c;n.value.getCamera().setViewUp(d[0],d[1],d[2])}})})}return{restoreCameraConfig:l}}const dp=X({name:"CrosshairsWidget2D",props:{widgetManager:{type:Object,required:!0},viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},slice:{type:Number,required:!0}},setup(e){const{widgetManager:t,viewDirection:n,slice:s}=oe(e),i=Wt().getWidgetFactory(),a=B(),{currentImageMetadata:r}=re();te(()=>{const c=t.value;if(a.value=c.addWidget(i),!a.value)throw new Error("[PaintWidget2D] failed to create view widget")});const l=ze.newInstance();return te(()=>{a.value.setManipulator(l)}),fe(()=>{en(l,n.value,s.value,r.value)}),te(()=>{a.value.setVisibility(!0)}),te(()=>{t.value.renderWidgets()}),Ee(()=>{t.value.removeWidget(a.value)}),()=>null}}),hp=X({props:{position:Array,viewId:{type:String,required:!0}},setup(e){const{viewId:t,position:n}=oe(e),s=B(),o=he(),i=I(()=>o.getViewProxy(t.value)),a=()=>{const c=i.value.getRenderer(),u=z(n);if(u){const d=Ht(u,c);d&&(s.value={x:d[0],y:d[1]})}};Se(I(()=>i.value.getCamera().onModified))(a),fe(a);const l=It(gn);return Tn(l,()=>{a()}),{devicePixelRatio,x:I(()=>{var c;return(c=s.value)==null?void 0:c.x}),y:I(()=>{var c;return(c=s.value)==null?void 0:c.y})}}});const gp=["x1","x2","y2"],fp=["x1","y1","x2"],pp=["y1","x2","y2"],mp=["x1","y1","y2"];function vp(e,t,n,s,o,i){return R(),E("g",null,[e.x!=null&&e.y!=null?(R(),E("line",{key:0,x1:e.x,y1:"0%",x2:e.x,y2:e.y-8,stroke:"yellow","stroke-width":"1"},null,8,gp)):j("",!0),e.x!=null&&e.y!=null?(R(),E("line",{key:1,x1:e.x,y1:e.y+8,x2:e.x,y2:"100%",stroke:"yellow","stroke-width":"1"},null,8,fp)):j("",!0),e.x!=null&&e.y!=null?(R(),E("line",{key:2,x1:"0%",y1:e.y,x2:e.x-8,y2:e.y,stroke:"yellow","stroke-width":"1"},null,8,pp)):j("",!0),e.x!=null&&e.y!=null?(R(),E("line",{key:3,x1:e.x+8,y1:e.y,x2:"100%",y2:e.y,stroke:"yellow","stroke-width":"1"},null,8,mp)):j("",!0)])}const yp=A(hp,[["render",vp],["__scopeId","data-v-d7c70d6c"]]),wp=X({name:"CrosshairsTool",props:{viewId:{type:String,required:!0},slice:{type:Number,required:!0},viewDirection:{type:String,required:!0},widgetManager:{type:Object,required:!0}},components:{CrosshairsWidget2D:dp,CrosshairSVG2D:yp},setup(e){const{viewDirection:t,slice:n}=oe(e),s=Ve(),{position:o,imagePosition:i}=rt(Wt()),{currentImageMetadata:a}=re(),r=I(()=>s.currentTool===ce.Crosshairs),l=I(()=>{const{lpsOrientation:c,dimensions:u}=a.value,d=be(t.value),h=c[d],v=Bi(i.value[h],0,u[h]-1);return Math.round(v)===n.value});return{active:r,position:o,isVisible:l}}});const Sp={key:0,class:"overlay-no-events"},_p={class:"overlay-no-events"};function Cp(e,t,n,s,o,i){const a=V("CrosshairSVG2D"),r=V("CrosshairsWidget2D");return e.active?(R(),E("div",Sp,[(R(),E("svg",_p,[tt(y(a,{"view-id":e.viewId,position:e.position},null,8,["view-id","position"]),[[Bt,e.isVisible]])])),y(r,{slice:e.slice,"view-id":e.viewId,"view-direction":e.viewDirection,"widget-manager":e.widgetManager},null,8,["slice","view-id","view-direction","widget-manager"])])):j("",!0)}const bp=A(wp,[["render",Cp],["__scopeId","data-v-8f19f7a7"]]);function Tp(e,t){const n=he(),s=B(null),o=a=>{s.value=a??null},i=I(()=>n.createOrGetViewProxy(z(e),z(t)));return F(i,(a,r)=>{r.setContainer(null),a.setContainer(s.value)}),F(s,a=>{i.value.setContainer(a),i.value.modified()}),{viewProxy:i,setContainer:o}}function Ip(e,t){Se(I(()=>z(e).onModified))(t)}function es(e){const t=B(!1),n=()=>{t.value=!!z(e).getContainer()};return n(),Ip(e,n),t}function ts(e,t){const n=es(e);F(n,s=>{s&&t()},{immediate:!0})}function Rp(e,t){const n=es(e);F(n,(s,o)=>{o&&!s&&t()},{immediate:!0})}function xp(e){const t=I(()=>Hr.newInstance({pickingEnabled:!1,useSvgLayer:!1,captureOn:Wr.MOUSE_MOVE}));return ts(e,()=>{t.value.setRenderer(e.value.getRenderer()),t.value.enablePicking()}),Rp(e,()=>{t.value.disablePicking()}),F(t,(n,s)=>{n&&(n.setRenderer(e.value.getRenderer()),n.enablePicking()),s&&s.delete()}),Ae(()=>{t.value.delete()}),{widgetManager:t}}function ns(e){const t=xt(),{currentImageMetadata:n,currentImageID:s}=re();return I(()=>{const o=t.getConfig(z(e),s.value);if(!o)return null;const{lpsOrientation:i}=n.value,a=be(o.axisDirection),r=[0,0,0];return r[i[a]]=o.slice,{axisName:a,axisIndex:i[a],number:o.slice,planeNormal:i[o.axisDirection],planeOrigin:r}})}function Dp(e){const t=B(null),n=()=>{var o;t.value=((o=z(e))==null?void 0:o.getContainer())??null};return Se(I(()=>{var o;return(o=z(e))==null?void 0:o.onModified}))(n),n(),t}function Ep(e,t){const n=B([]),s=I(()=>{var r,l,c;return(c=(l=(r=z(t))==null?void 0:r.getRenderWindow())==null?void 0:l.getViews())==null?void 0:c[0]}),o=Dp(s),i=()=>{const r=z(e),l=z(t);r==null||!l||(n.value=r.map(c=>{const u=ba(c,l);return[u[0]/devicePixelRatio,u[1]/devicePixelRatio]}))},a=Se(I(()=>{var r;return(r=z(t))==null?void 0:r.getActiveCamera().onModified}));return js(o,i),fe(i),a(i),i(),n}function Lp(e,t){const n=Ep(e,t);return I(()=>{var r,l;const o=n.value,i=z(t),a=(l=(r=i==null?void 0:i.getRenderWindow())==null?void 0:r.getViews())==null?void 0:l[0];if(i&&a){const[,c]=a.getViewportSize(i);return o.map(u=>[u[0],c/devicePixelRatio-u[1]])}return null})}const Op=X({props:{line:{required:!0,type:Object},clickWidth:{default:20,type:Number},outOfBounds:{default:!1,type:Boolean}},setup(){const e=B("grab"),t=B(null),n=B(0);return{onPointer:(i,a)=>{var r,l;i?(r=t.value)==null||r.setPointerCapture(a.pointerId):(l=t.value)==null||l.releasePointerCapture(a.pointerId),e.value=i?"grabbing":"grab"},onHover:i=>{n.value=i?2:0},cursor:e,grabLineEl:t,focusWidth:n}}});const Pp=["x1","y1","x2","y2","stroke-width"],Vp=["x1","y1","x2","y2","stroke-width","stroke-dasharray"],kp=["x1","y1","x2","y2","stroke-width"],Mp=["x1","y1","x2","y2","stroke-width"];function Bp(e,t,n,s,o,i){return R(),E("g",null,[g("line",{x1:e.line.startEdge[0],y1:e.line.startEdge[1],x2:e.line.startCrop[0],y2:e.line.startCrop[1],"stroke-width":2+e.focusWidth,"stroke-dasharray":"6","stroke-linecap":"square",stroke:"rgba(200, 255, 0, 0.5)"},null,8,Pp),g("line",{x1:e.line.startCrop[0],y1:e.line.startCrop[1],x2:e.line.endCrop[0],y2:e.line.endCrop[1],"stroke-width":2+e.focusWidth,"stroke-dasharray":e.outOfBounds?6:"none","stroke-linecap":"butt",stroke:"rgb(200, 255, 0)"},null,8,Vp),g("line",{x1:e.line.endCrop[0],y1:e.line.endCrop[1],x2:e.line.endEdge[0],y2:e.line.endEdge[1],"stroke-width":2+e.focusWidth,"stroke-dasharray":"6","stroke-linecap":"square",stroke:"rgba(200, 255, 0, 0.5)"},null,8,kp),g("line",Gt({ref:"grabLineEl",class:"pointer-events-all",style:{cursor:e.cursor},onPointerenter:t[0]||(t[0]=a=>e.onHover(!0)),onPointerleave:t[1]||(t[1]=a=>e.onHover(!1)),onPointerdown:t[2]||(t[2]=a=>e.onPointer(!0,a)),onPointerup:t[3]||(t[3]=a=>e.onPointer(!1,a)),x1:e.line.startEdge[0],y1:e.line.startEdge[1],x2:e.line.endEdge[0],y2:e.line.endEdge[1],fill:"none","stroke-opacity":"0","stroke-dasharray":"none","stroke-width":Number(e.$attrs["stroke-width"]||0)+e.clickWidth||0},e.$attrs),null,16,Mp)])}const Ap=A(Op,[["render",Bp],["__scopeId","data-v-926e0a5c"]]);function ei(e,t,n,s){const o=ns(e);return I(()=>{const i=e.value,a=t.value,r=n.value,l=s.value,c=o.value;if(!i||!a||!c)return null;const u=c.axisName,[d]=Yn.filter(S=>S!==a&&S!==u),h=r[a],v=r[d],f=l[d],p=r[u],m=c.number,w=m<p[0]||p[1]<m,T=S=>{const b=gt(),O=gt(),D=gt(),k=gt();return b[a]=h[S],O[a]=h[S],D[a]=h[S],k[a]=h[S],[b[d],k[d]]=f,[O[d],D[d]]=v,{startEdge:b,startCrop:O,endCrop:D,endEdge:k}};return{lowerLine:T(0),upperLine:T(1),outOfBounds:w}})}function ti(e,t,n){const s=I(()=>{const i=e.value,{lpsOrientation:a,indexToWorld:r}=t.value;return i?[i.lowerLine.startEdge,i.lowerLine.startCrop,i.lowerLine.endCrop,i.lowerLine.endEdge,i.upperLine.startEdge,i.upperLine.startCrop,i.upperLine.endCrop,i.upperLine.endEdge].map(l=>{const c=[0,0,0];c[a.Sagittal]=l.Sagittal,c[a.Coronal]=l.Coronal,c[a.Axial]=l.Axial;const u=[0,0,0];return pe(u,c,r),u}):null}),o=Lp(s,n);return I(()=>{const i=e.value,a=o.value;return!i||!(a!=null&&a.length)?null:{lowerLine:{startEdge:a[0],startCrop:a[1],endCrop:a[2],endEdge:a[3]},upperLine:{startEdge:a[4],startCrop:a[5],endCrop:a[6],endEdge:a[7]},outOfBounds:i.outOfBounds}})}function Fp({mouseEventToLPSPoint:e,getCropEdgePos:t,setCropEdgePos:n}){const s=B(),o=B(),i=B(gt()),a=B(0);return{onPointerDown:(u,d,h)=>{const v=e(h);v&&(i.value=v,a.value=t(u,d),s.value=u,o.value=d)},onPointerMove:u=>{if(s.value==null||o.value==null)return;const d=s.value,h=e(u);if(!h)return;const v=h[d]-i.value[d];n(d,o.value,a.value+v)},onPointerUp:()=>{s.value=null,o.value=null}}}const Np=X({props:{viewId:{required:!0,type:String}},components:{Crop2DLineHandle:Ap},setup(e){const{viewId:t}=oe(e),n=he(),s=I(()=>n.getViewProxy(t.value)),o=I(()=>{var D;return(D=s.value)==null?void 0:D.getRenderer()}),{currentImageExtent:i,currentImageID:a,currentImageMetadata:r}=re(),l=ns(t),c=I(()=>{var D;return((D=l.value)==null?void 0:D.axisName)??null}),u=Ct(),d=I(()=>{const D=a.value;return D&&D in u.croppingByImageID?u.croppingByImageID[D]:Qi()}),h=I(()=>Yn.filter(D=>c.value&&D!==c.value)),v=I(()=>h.value[0]??null),f=I(()=>h.value[1]??null),p=ei(t,v,d,i),m=ei(t,f,d,i),w=ti(p,r,o),T=ti(m,r,o),{onPointerDown:S,onPointerMove:b,onPointerUp:O}=Fp({mouseEventToLPSPoint(D){const k=o.value;if(!k)return null;const L=l.value;if(!L)return null;const{lpsOrientation:$,worldToIndex:K}=r.value,Z=hd(D,k,L.planeOrigin,L.planeNormal);if(!Z)return null;pe(Z,Z,K);const M=gt();return M.Sagittal=Z[$.Sagittal],M.Coronal=Z[$.Coronal],M.Axial=Z[$.Axial],M},getCropEdgePos(D,k){return d.value[D][k]},setCropEdgePos(D,k,L){if(!a.value)return;const $=d.value,[K,Z]=$[D],[M,W]=i.value[D],J=[K,Z];k===0?J[0]=Math.max(M,Math.min(L,Z)):k===1&&(J[1]=Math.max(K,Math.min(L,W))),u.setCroppingForAxis(a.value,D,J)}});return{ax1:I(()=>({name:v.value,lines:w.value})),ax2:I(()=>({name:f.value,lines:T.value})),onPointerDown:S,onPointerMove:b,onPointerUp:O}}});function $p(e,t,n,s,o,i){const a=V("crop-2D-line-handle");return R(),E("g",null,[e.ax1.lines!=null?(R(),E(ie,{key:0},[y(a,{line:e.ax1.lines.lowerLine,"out-of-bounds":e.ax1.lines.outOfBounds,onPointerdown:t[0]||(t[0]=r=>e.onPointerDown(e.ax1.name,0,r)),onPointermove:e.onPointerMove,onPointerup:e.onPointerUp},null,8,["line","out-of-bounds","onPointermove","onPointerup"]),y(a,{line:e.ax1.lines.upperLine,"out-of-bounds":e.ax1.lines.outOfBounds,onPointerdown:t[1]||(t[1]=r=>e.onPointerDown(e.ax1.name,1,r)),onPointermove:e.onPointerMove,onPointerup:e.onPointerUp},null,8,["line","out-of-bounds","onPointermove","onPointerup"])],64)):j("",!0),e.ax2.lines!=null?(R(),E(ie,{key:1},[y(a,{line:e.ax2.lines.lowerLine,"out-of-bounds":e.ax2.lines.outOfBounds,onPointerdown:t[2]||(t[2]=r=>e.onPointerDown(e.ax2.name,0,r)),onPointermove:e.onPointerMove,onPointerup:e.onPointerUp},null,8,["line","out-of-bounds","onPointermove","onPointerup"]),y(a,{line:e.ax2.lines.upperLine,"out-of-bounds":e.ax2.lines.outOfBounds,onPointerdown:t[3]||(t[3]=r=>e.onPointerDown(e.ax2.name,1,r)),onPointermove:e.onPointerMove,onPointerup:e.onPointerUp},null,8,["line","out-of-bounds","onPointermove","onPointerup"])],64)):j("",!0)])}const Up=A(Np,[["render",$p],["__scopeId","data-v-e3a0b15f"]]);function Hp(e){return e.Sagittal[0]<=e.Sagittal[1]&&e.Coronal[0]<=e.Coronal[1]&&e.Axial[0]<=e.Axial[1]}function Wp(e,t){return e.Axial[0]===t.Axial[0]&&e.Axial[1]===t.Axial[1]&&e.Sagittal[0]===t.Sagittal[0]&&e.Sagittal[1]===t.Sagittal[1]&&e.Coronal[0]===t.Coronal[0]&&e.Coronal[1]===t.Coronal[1]}const zp=X({props:{viewId:{type:String,required:!0}},setup(e){const{viewId:t}=oe(e),n=It(rr);if(!n)throw new Error("Crop3D component cannot access the 2D widget manager.");const s=he(),o=I(()=>s.getViewProxy(t.value)),i=Ct(),{currentImageID:a,currentImageMetadata:r}=re(),l=I(()=>{const f=a.value;return f&&f in i.croppingByImageID?i.croppingByImageID[f]:null}),c=zr.newInstance(),u=c.getWidgetState();c.setEdgeHandlesEnabled(!1),c.setFaceHandlesEnabled(!0),c.setCornerHandlesEnabled(!0);const d=B();F(n,(f,p)=>{p&&p.removeWidget(c),f&&(d.value=f.addWidget(c))}),ts(o,()=>{n.value&&(d.value=n.value.addWidget(c),d.value.getRepresentations().forEach(f=>{f.getActors().forEach(p=>{p.getProperty().setAmbient(1)})}),o.value.renderLater())}),Ee(()=>{n.value&&n.value.removeWidget(c)}),F(r,f=>{u.setWorldToIndexT(f.worldToIndex),u.setIndexToWorldT(f.indexToWorld),u.placeWidget(f.worldBounds)},{immediate:!0});const h=f=>{const{lpsOrientation:p}=r.value,m=[0,0,0,0,0,0];Yn.forEach(w=>{[m[p[w]*2],m[p[w]*2+1]]=f[w]}),qn(m,u.getCroppingPlanes().getPlanes())||(u.getCroppingPlanes().setPlanes(m),o.value.renderLater())};return F(l,f=>{f&&h(f)},{immediate:!0}),Se(u.getCroppingPlanes().onModified)(()=>{const f=a.value;if(!f)return;const p=u.getCroppingPlanes().getPlanes(),{lpsOrientation:m}=r.value,w={Sagittal:$e(p,"Sagittal",m),Coronal:$e(p,"Coronal",m),Axial:$e(p,"Axial",m)},T=l.value;T&&Wp(w,T)||(Hp(w)?i.setCropping(f,w):T&&h(T))}),()=>null}}),jp=X({props:{viewId:{type:String,required:!0}},components:{Crop2D:Up,Crop3D:zp},setup(e){const{viewId:t}=oe(e),{currentImageID:n}=re(),s=Ct(),o=Ve(),i=I(()=>o.currentTool===ce.Crop);F(n,r=>{r&&!(r in s.croppingByImageID)&&s.resetCropping(r)},{immediate:!0});const a=I(()=>he().viewSpecs[t.value].viewType);return{active:i,viewType:a}}});const Gp={class:"overlay-no-events"};function Xp(e,t,n,s,o,i){const a=V("crop-2D"),r=V("crop-3D");return R(),E("svg",Gp,[e.active&&e.viewType==="2D"?(R(),Y(a,{key:0,"view-id":e.viewId},null,8,["view-id"])):j("",!0),e.active&&e.viewType==="3D"?(R(),Y(r,{key:1,"view-id":e.viewId},null,8,["view-id"])):j("",!0)])}const qp=A(jp,[["render",Xp],["__scopeId","data-v-c08e53d9"]]),ni="ProxyManager";function Kp(e=ni){return It(e??ni)}const oi={ArrowLeft:-1,ArrowRight:1,ArrowUp:-1,ArrowDown:1},Yp=X({name:"VtkTwoView",props:{id:{type:String,required:!0},viewDirection:{type:String,required:!0},viewUp:{type:String,required:!0}},components:{SliceSlider:Eh,ViewOverlayGrid:Wh,WindowLevelTool:Xh,SliceScrollTool:qh,PanTool:Kh,ZoomTool:Yh,RulerTool:Cg,RectangleTool:zg,PaintTool:lp,CrosshairsTool:bp,CropTool:qp,ContourTool:op},setup(e){const t=io(),n=xt(),s=so(),o=Ra(),i=lt(),{id:a,viewDirection:r,viewUp:l}=oe(e),c=B(),u=I(()=>be(r.value)),{currentImageData:d,currentImageID:h,currentImageMetadata:v,isImageLoading:f,currentLayers:p}=re(),m=we(),w=oo(),T=I(()=>n.getConfig(a.value,h.value)),S=I(()=>{var P;return((P=T.value)==null?void 0:P.slice)??w.slice}),b=I(()=>{var P;return((P=T.value)==null?void 0:P.min)??w.min}),O=I(()=>{var P;return((P=T.value)==null?void 0:P.max)??w.max}),D=I({get:()=>t.getConfig(a.value,h.value),set:P=>{const G=h.value;G!==null&&P!=null&&t.updateConfig(a.value,G,P)}}),k=I(()=>{var P;return(P=D.value)==null?void 0:P.width}),L=I(()=>{var P;return(P=D.value)==null?void 0:P.level}),$=I(()=>{if(h.value!==null&&h.value in m.imageIDToVolumeKey){const P=m.imageIDToVolumeKey[h.value],G=m.volumeInfo[P],ge=m.volumeStudy[P],ve=m.studyInfo[ge],Xe=m.studyPatient[ge],Ln=m.patientInfo[Xe].PatientID,sn=ve.StudyID,ke=ve.StudyDescription,Lt=G.SeriesNumber,it=G.SeriesDescription;return{patientID:Ln,studyID:sn,studyDescription:ke,seriesNumber:Lt,seriesDescription:it}}return null}),K=I(()=>{const{lpsOrientation:P,dimensions:G}=v.value,ge=P[u.value];return{min:0,max:G[ge]-1}}),Z=P=>{h.value!==null&&n.updateConfig(a.value,h.value,{slice:P})},{viewProxy:M,setContainer:W}=Tp(a,Xi.Slice);Gs(()=>{M.value.getInteractorStyle2D().removeAllManipulators()}),te(()=>{W(c.value),M.value.setOrientationAxesVisibility(!1)}),Ee(()=>{W(null)}),fe(()=>{const P=v.value.lpsOrientation[u.value];M.value.setSlicingMode("IJK"[P])}),F([a,h,r],([P,G,ge])=>{!G||T.value!=null||(n.updateConfig(P,G,{...K.value,axisDirection:ge}),n.resetSlice(P,G))},{immediate:!0});const J=B(!1),_e=P=>{if(!h.value||!J.value)return;const G=oi[P.key]??0;G&&(n.updateConfig(a.value,h.value,{slice:S.value+G}),P.stopPropagation())};Xs(Object.keys(oi),_e),Tn(c,()=>M.value.resize());const me=B();Fn(gn,me);const{widgetManager:Ge}=xp(M);Fn(lr,Ge),F(d,P=>{if(h.value==null||D.value!=null||!P)return;const G=P.getPointData().getScalars().getRange();t.updateConfig(a.value,h.value,{min:G[0],max:G[1]}),t.resetWindowLevel(a.value,h.value)},{immediate:!0});const Dt=hn(),xn=I(()=>Dt.idList.filter(P=>Dt.parentImage[P]===h.value)),nn=I(()=>p.value.map(({id:P})=>P)),{baseImageRep:Dn,labelmapReps:on,layerReps:En}=cp(a,{baseImage:h,labelmaps:xn,layers:nn}),{cameraDirVec:mo,cameraUpVec:vo}=jh(r,l,v),{resizeToFit:ot,ignoreResizeToFitTracking:yo,resetResizeToFitTracking:ds}=bh(M.value.getCamera(),!1),wo=()=>yo(()=>{const P=v.value.lpsOrientation[be(r.value)],G=v.value.lpsOrientation[be(l.value)],ge=v.value.dimensions.map((ve,Xe)=>ve*v.value.spacing[Xe]);M.value.resizeToFit(P,G,ge),ds()}),So=()=>{const P=v.value.worldBounds,G=[(P[0]+P[1])/2,(P[2]+P[3])/2,(P[4]+P[5])/2];yo(()=>{M.value.updateCamera(mo.value,vo.value,G),M.value.resetCamera(P)}),wo(),M.value.renderLater()};zt(M.value.onResize(()=>{ot.value&&wo()})),F(ot,()=>{ot.value&&So()});const{restoreCameraConfig:hs}=up(a,h,M,"parallelScale","position","focalPoint","viewUp");F([h,mo,vo],()=>{const P=s.getConfig(a.value,h.value);P?(hs(P),M.value.getRenderer().resetCameraClippingRange(),M.value.renderLater(),ot.value=!1):ot.value?So():ot.value=!0},{immediate:!0,deep:!0});const{top:gs,left:fs}=zh(M);fe(()=>{if(T.value==null||D.value==null)return;const{slice:P}=T.value,{width:G,level:ge}=D.value,ve=Dn.value;ve&&(ve.setSlice(P),ve.setWindowWidth(G),ve.setWindowLevel(ge)),[...En.value,...on.value].forEach(Xe=>{Xe.setSlice(P)}),M.value.renderLater()}),fe(()=>{const{labelmapOpacity:P}=i;on.value.forEach(G=>{G.setOpacity(P)})});const Et=I(()=>nn.value.map(P=>o.getConfig(a.value,P))),ps=Rt();F([a,p],()=>{p.value.forEach(({id:P},G)=>{const ge=ps.layerImages[P],ve=Et.value[G];ge&&!ve&&o.resetToDefault(a.value,P,ge)})},{immediate:!0});const _o=Kp(),Co=I(()=>Et.value.map(P=>P==null?void 0:P.colorBy)),bo=I(()=>Et.value.map(P=>P==null?void 0:P.transferFunction)),To=I(()=>Et.value.map(P=>P==null?void 0:P.opacityFunction)),Io=I(()=>Et.value.map(P=>P==null?void 0:P.blendConfig));return F([En,Co,bo,To,Io],()=>{En.value.map((P,G)=>[P,Co.value[G],bo.value[G],To.value[G],Io.value[G]]).forEach(([P,G,ge,ve,Xe])=>{if(!G||!ge||!ve||!Xe)return;const{arrayName:an,location:Ln}=G,sn=ge,ke=ve,Lt=_o.getLookupTable(an);Lt.setMode(jr.Preset),Lt.setPresetName(sn.preset),Lt.setDataRange(...sn.mappingRange);const it=_o.getPiecewiseFunction(an);switch(it.setMode(ke.mode),it.setDataRange(...ke.mappingRange),ke.mode){case xe.Mode.Gaussians:it.setGaussians(ke.gaussians);break;case xe.Mode.Points:{const Ro=gd(ke.preset,ke.mappingRange,ke.shift);Ro&&it.setPoints(Ro);break}case xe.Mode.Nodes:it.setNodes(ke.nodes);break}P.setRescaleOnColorBy(!1),P.setColorBy(an,Ln),P.setOpacity(Xe.opacity),M.value.renderLater()})},{immediate:!0,deep:!0}),{vtkContainerRef:c,toolContainer:me,viewID:a,viewProxy:M,viewAxis:u,active:!0,currentSlice:S,sliceMin:b,sliceMax:O,windowWidth:k,windowLevel:L,topLabel:gs,leftLabel:fs,isImageLoading:f,setSlice:Z,widgetManager:Ge,dicomInfo:$,enableResizeToFit(){ot.value=!0},hover:J}}});const Qp=e=>(ae("data-v-f1605346"),e=e(),se(),e),Zp={class:"vtk-gutter"},Jp={class:"vtk-sub-container"},em={class:"vtk-view",ref:"vtkContainerRef"},tm={class:"overlay-no-events tool-layer",ref:"toolContainer"},nm={class:"annotation-cell"},om={class:"annotation-cell"},im={class:"annotation-cell"},am={key:0},sm={class:"annotation-cell"},rm={key:0,class:"overlay-no-events loading"},lm=Qp(()=>g("div",null,"Loading the image",-1));function cm(e,t,n,s,o,i){const a=V("slice-slider"),r=V("pan-tool"),l=V("zoom-tool"),c=V("slice-scroll-tool"),u=V("window-level-tool"),d=V("contour-tool"),h=V("ruler-tool"),v=V("rectangle-tool"),f=V("paint-tool"),p=V("crosshairs-tool"),m=V("crop-tool"),w=V("view-overlay-grid");return R(),E("div",{class:"vtk-container-wrapper",tabindex:"0",onPointerenter:t[0]||(t[0]=T=>e.hover=!0),onPointerleave:t[1]||(t[1]=T=>e.hover=!1),onFocusin:t[2]||(t[2]=T=>e.hover=!0),onFocusout:t[3]||(t[3]=T=>e.hover=!1)},[g("div",Zp,[y(ft,{dark:"",icon:"",size:"medium",variant:"text",onClick:e.enableResizeToFit},{default:x(()=>[y(vt,{size:"medium",class:"py-1"},{default:x(()=>[H("mdi-camera-flip-outline")]),_:1}),y(pi,{location:"right",activator:"parent",transition:"slide-x-transition"},{default:x(()=>[H(" Reset Camera ")]),_:1})]),_:1},8,["onClick"]),y(a,{class:"slice-slider",slice:e.currentSlice,min:e.sliceMin,max:e.sliceMax,step:1,"handle-height":20,onInput:e.setSlice},null,8,["slice","min","max","onInput"])]),g("div",{class:N(["vtk-container",e.active?"active":""])},[g("div",Jp,[g("div",em,null,512)]),g("div",tm,[y(r,{"view-id":e.viewID},null,8,["view-id"]),y(l,{"view-id":e.viewID},null,8,["view-id"]),y(c,{"view-id":e.viewID},null,8,["view-id"]),y(u,{"view-id":e.viewID},null,8,["view-id"]),y(d,{"view-id":e.viewID,"widget-manager":e.widgetManager,"view-direction":e.viewDirection,"current-slice":e.currentSlice},null,8,["view-id","widget-manager","view-direction","current-slice"]),y(h,{"view-id":e.viewID,"widget-manager":e.widgetManager,"view-direction":e.viewDirection,"current-slice":e.currentSlice},null,8,["view-id","widget-manager","view-direction","current-slice"]),y(v,{"view-id":e.viewID,"widget-manager":e.widgetManager,"view-direction":e.viewDirection,"current-slice":e.currentSlice},null,8,["view-id","widget-manager","view-direction","current-slice"]),y(f,{"view-id":e.viewID,"view-direction":e.viewDirection,"widget-manager":e.widgetManager,slice:e.currentSlice},null,8,["view-id","view-direction","widget-manager","slice"]),y(p,{"view-id":e.viewID,"view-direction":e.viewDirection,"widget-manager":e.widgetManager,slice:e.currentSlice},null,8,["view-id","view-direction","widget-manager","slice"]),y(m,{"view-id":e.viewID},null,8,["view-id"])],512),y(w,{class:"overlay-no-events view-annotations"},{"top-center":x(()=>[g("div",nm,[g("span",null,U(e.topLabel),1)])]),"middle-left":x(()=>[g("div",om,[g("span",null,U(e.leftLabel),1)])]),"bottom-left":x(()=>[g("div",im,[g("div",null,"Slice: "+U(e.currentSlice+1)+"/"+U(e.sliceMax+1),1),typeof e.windowWidth=="number"&&typeof e.windowLevel=="number"?(R(),E("div",am," W/L: "+U(e.windowWidth.toFixed(2))+" / "+U(e.windowLevel.toFixed(2)),1)):j("",!0)])]),"top-right":x(()=>[g("div",sm,[e.dicomInfo!==null?(R(),Y(yt,{key:0,"open-on-hover":"",location:"bottom left",left:"","nudge-left":"10",dark:"","max-width":"300px"},{activator:x(({props:T})=>[y(vt,Gt(T,{dark:"",size:"x-large",class:"pointer-events-all hover-info"}),{default:x(()=>[H(" mdi-information ")]),_:2},1040)]),default:x(()=>[y(At,{class:"bg-grey-darken-3"},{default:x(()=>[y(Ze,null,{default:x(()=>[y(Re,{class:"font-weight-bold"},{default:x(()=>[H(" PATIENT / CASE ")]),_:1}),y(On),y(Re,null,{default:x(()=>[H(" ID: "+U(e.dicomInfo.patientID),1)]),_:1})]),_:1}),y(Ze,null,{default:x(()=>[y(Re,{class:"font-weight-bold"},{default:x(()=>[H(" STUDY ")]),_:1}),y(On),y(Re,null,{default:x(()=>[H(" ID: "+U(e.dicomInfo.studyID),1)]),_:1}),y(Re,null,{default:x(()=>[H(U(e.dicomInfo.studyDescription),1)]),_:1})]),_:1}),y(Ze,null,{default:x(()=>[y(Re,{class:"font-weight-bold"},{default:x(()=>[H(" SERIES ")]),_:1}),y(On),y(Re,null,{default:x(()=>[H(" Series #: "+U(e.dicomInfo.seriesNumber),1)]),_:1}),y(Re,null,{default:x(()=>[H(U(e.dicomInfo.seriesDescription),1)]),_:1})]),_:1})]),_:1})]),_:1})):j("",!0)])]),_:1}),y(Be,{name:"loading"},{default:x(()=>[e.isImageLoading?(R(),E("div",rm,[lm,g("div",null,[y(cr,{indeterminate:"",color:"blue"})])])):j("",!0)]),_:1})],2)],32)}const os=A(Yp,[["render",cm],["__scopeId","data-v-f1605346"]]);const um={components:{CheckContoursToolStrip:Ch,VtkTwoView:os}},dm={class:"viewers-tools-container"},hm={class:"tool-strip"};function gm(e,t,n,s,o,i){const a=V("VtkTwoView"),r=V("CheckContoursToolStrip");return R(),E("div",dm,[y(a,{key:"sagitalv",id:"Sagittal",viewDirection:"Posterior",viewUp:"Superior"}),g("div",hm,[y(r)]),y(a,{key:"sagitalv",id:"Coronal",viewDirection:"Right",viewUp:"Superior"})])}const is=A(um,[["render",gm],["__scopeId","data-v-2880b87f"]]);async function fm(e){const t=e.createReader(),n=[];let s=[];do s=await new Promise((o,i)=>{t.readEntries(o,i)}),n.push(...s);while(s.length);return n}async function pm(e){return new Promise((t,n)=>{e.file(t,n)})}async function mm(e){const t=[...e],n=[];for(;t.length;){const s=t.shift();s.isFile?n.push(s):t.push(...await fm(s))}return Promise.all(n.map(pm))}const vm={name:"DragAndDrop",props:{enabled:Boolean},data(){return{dragHover:!1}},methods:{onDragOver(e){if(this.enabled){e.preventDefault();const{types:t}=e.dataTransfer;(t&&t instanceof Array?t.indexOf("Files")!==-1:"Files"in t)&&(this.dragHover=!0,this.dragTimeout!==null&&(window.clearTimeout(this.dragTimeout),this.dragTimeout=null))}},onDragLeave(){this.enabled&&(this.dragTimeout=window.setTimeout(()=>{this.dragHover=!1,this.dragTimeout=null},50))},async onDrop(e){if(this.enabled)if(this.dragHover=!1,e.dataTransfer.items){const t=[...e.dataTransfer.items].map(s=>(s.webkitGetAsEntry||s.getAsEntry).call(s)),n=await mm(t);this.$emit("drop-files",n)}else this.$emit("drop-files",Array.from(e.dataTransfer.files))}},created(){this.dragTimeout=null}};function ym(e,t,n,s,o,i){return R(),E("div",Gt({onDragover:t[0]||(t[0]=ue((...a)=>i.onDragOver&&i.onDragOver(...a),["prevent"])),onDragleave:t[1]||(t[1]=(...a)=>i.onDragLeave&&i.onDragLeave(...a)),onDrop:t[2]||(t[2]=ue((...a)=>i.onDrop&&i.onDrop(...a),["prevent"]))},e.$attrs),[Ce(e.$slots,"default",{dragHover:o.dragHover})],16)}const wm=A(vm,[["render",ym]]);const Sm={components:{DragAndDrop:wm,CheckContours:is},data(){return{showOverlay:!1,showTextOverlay:!1,isDraggingOver:!1,loadFileText:"Load Files",browseTextFile:"Browse your data to automatically add a new study.",dataStore:Yt(),currentPatientStoreID:null}},methods:{async openFiles(e){const t=Array.from(e).map(ia);this.loadFiles(t)},async loadFiles(e){const t=await nh(e);this.currentPatientStoreID=t[0].data[0].dataID;const s=vn(h=>h.ok,t)[0];if(!this.dataStore.primarySelection&&s.length){const h=Jd(s[0]);h&&this.dataStore.setPrimarySelection(h)}const o=we(),i=this.currentPatientStoreID;window.sessionStorage.setItem("target-volume-key",i);const a=o.volumeInfo[i],r=o.volumeStudy[i],l=o.studyInfo[r],c=o.studyPatient[r],u=o.patientInfo[c],d={id:1,name:u.PatientID,lastname:u.PatientName,dob:u.PatientBirthDate,gender:u.PatientSex,scandate:l.StudyDate,scanlocation:a.SeriesDescription};this.$emit("new-patient",d),this.openOverlay()},handleKeyDown(e){console.log(e.key),e.key===" "&&this.showOverlay()},openOverlay(){this.showOverlay&&(this.showTextOverlay=!1),this.showOverlay=!this.showOverlay,this.showOverlay&&setTimeout(()=>{this.showTextOverlay=!0},200)},openFileDialog(){this.$refs.fileInput.click()},handleFileChange(e){const t=e.target.files[0];this.openFiles(t)},handleDragEnter(e){e.preventDefault(),this.isDraggingOver=!0},handleDragOver(e){e.preventDefault(),this.isDraggingOver=!0,this.loadFileText="Drop File to Upload"},handleDragLeave(e){e.preventDefault(),this.isDraggingOver=!1,this.loadFileText="Load Files"}}},ho=e=>(ae("data-v-407c19f9"),e=e(),se(),e),_m={style:{position:"relative"}},Cm=ho(()=>g("i",{class:"fa-solid fa-user-plus",style:{color:"#ffffff"}},null,-1)),bm=ho(()=>g("i",{class:"fa-solid fa-file-import fa-2xl",style:{color:"#ffffff"}},null,-1)),Tm=ho(()=>g("br",null,null,-1)),Im={style:{display:"none"}};function Rm(e,t,n,s,o,i){const a=V("drag-and-drop"),r=V("CheckContours");return R(),E(ie,null,[g("div",_m,[g("button",{onClick:t[0]||(t[0]=(...l)=>i.openOverlay&&i.openOverlay(...l))},[H(" Add New Patient "),Cm]),y(a,{enabled:"",onDropFiles:i.openFiles,id:"app-container"},{default:x(()=>[g("div",{class:N(["overlay",{show:o.showOverlay}]),onDragover:t[8]||(t[8]=(...l)=>i.handleDragOver&&i.handleDragOver(...l))},[g("div",{class:N(["add-patient-header",{visible:o.showTextOverlay}])},[g("i",{onClick:t[1]||(t[1]=(...l)=>i.openOverlay&&i.openOverlay(...l)),onKeydown:t[2]||(t[2]=(...l)=>i.handleKeyDown&&i.handleKeyDown(...l)),class:"fa-solid fa-xmark fa-xl",style:{color:"#ffffff"}},null,32)],2),g("div",{onClick:t[4]||(t[4]=(...l)=>i.openFileDialog&&i.openFileDialog(...l)),onDragenter:t[5]||(t[5]=(...l)=>i.handleDragEnter&&i.handleDragEnter(...l)),onDragleave:t[6]||(t[6]=(...l)=>i.handleDragLeave&&i.handleDragLeave(...l)),onKeydown:t[7]||(t[7]=(...l)=>i.handleKeyDown&&i.handleKeyDown(...l)),class:N(["load-files",{visible:o.showTextOverlay}])},[g("input",{type:"file",ref:"fileInput",style:{display:"none"},onChange:t[3]||(t[3]=(...l)=>i.handleFileChange&&i.handleFileChange(...l)),"aria-labelledby":"fileInput"},null,544),bm,Tm,g("h2",null,U(o.loadFileText),1),g("h4",null,U(o.browseTextFile),1)],34)],34)]),_:1},8,["onDropFiles"])]),g("div",Im,[y(r)])],64)}const xm=A(Sm,[["render",Rm],["__scopeId","data-v-407c19f9"]]);const Dm={data(){return{searchTerm:""}},methods:{handleInput(){this.$emit("search-term-updated",this.searchTerm)},handleSearch(){this.$emit("search-term-updated",this.searchTerm)},handleKeydown(e){e.key==="Escape"?(e.preventDefault(),this.searchTerm=""):e.key==="Backspace"&&(e.preventDefault(),this.searchTerm=this.searchTerm.slice(0,-1)),this.handleInput()}}},Em={class:"searchbar"};function Lm(e,t,n,s,o,i){return R(),E("div",Em,[tt(g("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=a=>o.searchTerm=a),onInput:t[1]||(t[1]=(...a)=>i.handleInput&&i.handleInput(...a)),placeholder:"Find Patient...","aria-labelledby":"findPatientSearchBox",onKeydown:t[2]||(t[2]=(...a)=>i.handleKeydown&&i.handleKeydown(...a))},null,544),[[An,o.searchTerm]])])}const Om=A(Dm,[["render",Lm],["__scopeId","data-v-65339542"]]);const Pm={methods:{logOutUser(){window.localStorage.clear(),window.sessionStorage.clear(),window.localStorage.setItem("userLoggedIn","GUEST USER")}}},Vm=e=>(ae("data-v-3e27debf"),e=e(),se(),e),km=Vm(()=>g("i",{class:"fa-solid fa-arrow-right-from-bracket",style:{color:"#ffffff"}},null,-1));function Mm(e,t,n,s,o,i){const a=V("router-link");return R(),Y(a,{to:"/login",style:{"text-decoration":"none"}},{default:x(()=>[g("button",{onClick:t[0]||(t[0]=(...r)=>i.logOutUser&&i.logOutUser(...r))},[H(" Log Out "),km])]),_:1})}const Bm=A(Pm,[["render",Mm],["__scopeId","data-v-3e27debf"]]);const Am={props:{message:String},methods:{closePopup(){this.$emit("closePopup")},confirm(){this.$emit("confirmDelete"),this.closePopup()},handleKeydown(){}}},Fm={class:"popup-box"},Nm={class:"popup-buttons"};function $m(e,t,n,s,o,i){return R(),E("div",{class:"popup-overlay",onClick:t[2]||(t[2]=(...a)=>i.closePopup&&i.closePopup(...a)),onKeydown:t[3]||(t[3]=(...a)=>i.handleKeydown&&i.handleKeydown(...a))},[g("div",Fm,[g("p",null,U(n.message),1),g("div",Nm,[g("button",{onClick:t[0]||(t[0]=(...a)=>i.confirm&&i.confirm(...a))},"Delete"),g("button",{onClick:t[1]||(t[1]=(...a)=>i.closePopup&&i.closePopup(...a))},"Cancel")])])],32)}const Um=A(Am,[["render",$m],["__scopeId","data-v-eece1ae8"]]);const Hm={data(){return{username:"GUEST USER",filter:"",container:"container",patients:[{id:111,name:"SAMPLE",lastname:"SAMPLE",dob:"01/02/1982",breathingrate:"60",age:"32",weight:65,height:175,gender:"Male",scandate:"01/02/2023",scanlocation:"Area 19 Office"}],removePatientTarget:""}},components:{HomeGreetings:gc,PatientContainer:Ec,AddPatient:xm,FindPatient:Om,LogOut:Bm,PopUpDelete:Um},mounted(){this.username=window.localStorage.getItem("userLoggedIn"),window.localStorage.setItem("currentView","QualityCheck")},methods:{updatefilter(e){this.filter=e},handleRemovePatient(e){this.removePatientTarget=e},handleDeletePatient(){this.removePatientById(this.removePatientTarget.id),this.removePatientTarget=null},removePatientById(e){const t=this.patients.findIndex(n=>n.id===e);t!==-1&&this.patients.splice(t,1)},getTimeOfDay(){const e=new Date().getHours();return e>=5&&e<12?"Morning":e>=12&&e<18?"Afternoon":e>=18&&e<23?"Evening":"Day"},handleNewPatient(e){this.patients.push(e)}},created(){this.timeofday=this.getTimeOfDay(),this.container=`${this.container} ${this.timeofday.toLowerCase()}`}},as=e=>(ae("data-v-a347b694"),e=e(),se(),e),Wm={class:"home"},zm=as(()=>g("br",null,null,-1)),jm={class:"user-bar"},Gm=as(()=>g("h5",{style:{color:"grey","margin-left":"90%"}},"Area 19 OCG Prototype V.0.1",-1));function Xm(e,t,n,s,o,i){const a=V("PopUpDelete"),r=V("HomeGreetings"),l=V("AddPatient"),c=V("FindPatient"),u=V("LogOut"),d=V("PatientContainer");return R(),E("div",{class:N(o.container)},[g("div",Wm,[o.removePatientTarget?(R(),Y(a,{key:0,message:`You are about to delete ${o.removePatientTarget.name} and all it's files. Are you sure you want to proceed?`,onClosePopup:t[0]||(t[0]=h=>o.removePatientTarget=null),onConfirmDelete:i.handleDeletePatient},null,8,["message","onConfirmDelete"])):j("",!0),y(r,{username:o.username},null,8,["username"]),zm,g("div",jm,[y(l,{onNewPatient:i.handleNewPatient},null,8,["onNewPatient"]),y(c,{onSearchTermUpdated:i.updatefilter},null,8,["onSearchTermUpdated"]),y(u,{style:{"margin-left":"auto","align-self":"center"}})]),y(d,{patients:o.patients,filter:o.filter,onRemovePatient:i.handleRemovePatient},null,8,["patients","filter","onRemovePatient"]),Gm])],2)}const qm=A(Hm,[["render",Xm],["__scopeId","data-v-a347b694"]]),Km=X({components:{ToolButton:Fe,MenuToolButton:Aa,ItemGroup:Va,GroupableItem:ka,PaintControls:Ba,CropControls:Fa,RulerControls:Na,RectangleControls:$a,ContourControls:Ua},setup(){const e=Yt(),t=Ve(),n=I(()=>!e.primaryDataset),s=I(()=>t.currentTool),o=He(),i=Ue(),a=B(!1),r=B(!1);return Wn("Escape",()=>{a.value=!1,r.value=!1}),{currentTool:s,setCurrentTool:t.setCurrentTool,noCurrentImage:n,Tools:ce,paintMenu:a,cropMenu:r,rectangleStore:o,rulerStore:i}}});const go=e=>(ae("data-v-001108e5"),e=e(),se(),e),Ym=go(()=>g("div",{class:"my-1 tool-separator"},null,-1)),Qm=go(()=>g("div",{class:"my-1 tool-separator"},null,-1)),Zm=go(()=>g("div",{class:"my-1 tool-separator"},null,-1));function Jm(e,t,n,s,o,i){const a=V("tool-button"),r=V("groupable-item"),l=V("paint-controls"),c=V("menu-tool-button"),u=V("rectangle-controls"),d=V("ruler-controls"),h=V("contour-controls"),v=V("crop-controls"),f=V("item-group");return R(),Y(f,{mandatory:"","model-value":e.currentTool,"onUpdate:modelValue":t[0]||(t[0]=p=>e.setCurrentTool(p))},{default:x(()=>[Ym,y(r,{value:e.Tools.WindowLevel},{default:x(({active:p,toggle:m})=>[y(a,{icon:"mdi-circle-half-full",name:"Window & Level",buttonClass:["tool-btn",p?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Pan},{default:x(({active:p,toggle:m})=>[y(a,{icon:"mdi-cursor-move",name:"Pan",buttonClass:["tool-btn",p?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Zoom},{default:x(({active:p,toggle:m})=>[y(a,{icon:"mdi-magnify-plus-outline",name:"Zoom",buttonClass:["tool-btn",p?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Crosshairs},{default:x(({active:p,toggle:m})=>[y(a,{icon:"mdi-crosshairs",name:"Crosshairs",buttonClass:["tool-btn",p?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),Qm,y(r,{value:e.Tools.Paint},{default:x(({active:p,toggle:m})=>[y(c,{icon:"mdi-brush",name:"Paint",active:p,disabled:e.noCurrentImage,onClick:m},{default:x(()=>[y(l)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Rectangle},{default:x(({active:p,toggle:m})=>[y(c,{icon:"mdi-vector-square",name:"Rectangle",mobileOnlyMenu:!0,active:p,disabled:e.noCurrentImage,onClick:m},{default:x(()=>[y(u)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Ruler},{default:x(({active:p,toggle:m})=>[y(c,{icon:"mdi-ruler",name:"Ruler",mobileOnlyMenu:!0,active:p,disabled:e.noCurrentImage,onClick:m},{default:x(()=>[y(d)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Contour},{default:x(({active:p,toggle:m})=>[y(c,{icon:"mdi-shape-circle-plus",name:"Contour","mobile-only-menu":"",active:p,disabled:e.noCurrentImage,onClick:m},{default:x(()=>[y(h)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),Zm,y(r,{value:e.Tools.Crop},{default:x(({active:p,toggle:m})=>[y(c,{icon:"mdi-crop",name:"Crop",active:p,disabled:e.noCurrentImage,onClick:m},{default:x(()=>[y(v)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"])]),_:1},8,["model-value"])}const ev=A(Km,[["render",Jm],["__scopeId","data-v-001108e5"]]);const tv={props:{number:{type:Number,default:1}}},nv={class:"circleIcon"};function ov(e,t,n,s,o,i){return R(),E("div",nv,U(n.number),1)}const iv=A(tv,[["render",ov],["__scopeId","data-v-071ecef1"]]);const av={components:{ToolStrip:ev,IconNumber:iv},props:{activeComponent:{type:String,default:"analysis"}},data(){return{patient:null,patientName:null,patientLastName:null,patientBrate:null,patientage:null,patientweight:null,patientheight:null,patientgender:null,checkContours:null}},mounted(){const e=window.sessionStorage.getItem("currentQaView");e?this.handleclick(e):this.checkContours=!1,this.patient=JSON.parse(window.localStorage.getItem("currentPatient")),this.patientName=this.patient.name.toUpperCase(),this.patientLastName=this.patient.lastname.toUpperCase(),this.patientBrate=this.patient.breathingrate,this.patientage=this.patient.age,this.patientweight=this.patient.weight,this.patientheight=this.patient.height,this.patientgender=this.patient.gender},methods:{handleclick(e){e==="CheckBreathingSplits"?this.checkContours=!1:this.checkContours=!0,window.sessionStorage.setItem("currentQaView",e),this.$emit("updatequalitycheck",this.checkContours)}}},je=e=>(ae("data-v-6055083a"),e=e(),se(),e),sv={class:"header-container"},rv={class:"patient-info-container"},lv={class:"patient-name"},cv=je(()=>g("h3",{class:"label"},"PATIENT",-1)),uv={class:"breathing-rate"},dv=je(()=>g("h3",{class:"label",style:{"text-align":"left"}},[H("RESTING "),g("br"),H("HEART RATE")],-1)),hv={class:"info"},gv=je(()=>g("h3",{class:"label"},"AGE",-1)),fv=je(()=>g("h3",{class:"label"},"WEIGHT",-1)),pv=je(()=>g("h3",{class:"label"},"HEIGHT",-1)),mv=je(()=>g("h3",{class:"label"},"GENDER",-1)),vv={key:0,class:"tools"},yv={key:1,class:"quality-screen-toggle"},wv=je(()=>g("h2",null,"CHECK BREATHING SPLITS",-1)),Sv=je(()=>g("h2",null,"CHECK CONTOURS",-1)),_v=je(()=>g("div",{class:"helpIcon"},[g("i",{class:"fa-solid fa-question fa-l",style:{}})],-1));function Cv(e,t,n,s,o,i){const a=V("ToolStrip"),r=V("IconNumber");return R(),E("div",sv,[g("div",rv,[g("div",lv,[cv,g("h3",null,U(o.patientName)+" "+U(o.patientLastName),1)]),g("div",uv,[g("h1",null,U(o.patientBrate),1),dv]),g("div",hv,[g("div",null,[gv,g("h3",null,U(o.patientage),1)]),g("div",null,[fv,g("h3",null,U(o.patientweight)+" Kg",1)]),g("div",null,[pv,g("h3",null,U(o.patientheight)+" cm",1)]),g("div",null,[mv,g("h3",null,U(o.patientgender),1)])])]),n.activeComponent=="GraphicalAnalysis"?(R(),E("div",vv,[y(a)])):j("",!0),n.activeComponent=="QualityCheck"?(R(),E("div",yv,[g("div",{class:N(["toggleQaContainer",{clicked:o.checkContours==!1}]),onClick:t[0]||(t[0]=l=>i.handleclick("CheckBreathingSplits")),onKeydown:t[1]||(t[1]=nt(ue((...l)=>e.handleKeyDown&&e.handleKeyDown(...l),["prevent"]),["space"]))},[y(r),wv],34),g("div",{class:N(["toggleQaContainer",{clicked:o.checkContours}]),onClick:t[2]||(t[2]=l=>i.handleclick("CheckContours")),onKeydown:t[3]||(t[3]=nt(ue((...l)=>e.handleKeyDown&&e.handleKeyDown(...l),["prevent"]),["space"]))},[y(r,{number:2}),Sv],34)])):j("",!0),_v])}const bv=A(av,[["render",Cv],["__scopeId","data-v-6055083a"]]);const Tv={data(){return{selectedTool:"QualityCheck"}},methods:{selectTool(e){this.selectedTool!==e&&(this.selectedTool=e,this.$emit("tool-selected",e))},handleKeyDown(e){console.log(e),e.key==="1"?this.selectTool("QualityCheck"):e.key==="2"?this.selectTool("GraphicalAnalysis"):this.selectTool("ReportMaker")}},mounted(){this.selectedTool=window.localStorage.getItem("currentView")}},In=e=>(ae("data-v-46cbd000"),e=e(),se(),e),Iv={class:"toolbar"},Rv={class:"tools"},xv={class:"tool"},Dv={key:0,class:"fa-solid fa-people-arrows fa-xl"},Ev={key:1,class:"fa-solid fa-people-arrows fa-lg"},Lv=In(()=>g("h4",{class:"section-tag"},"Patient List",-1)),Ov={key:0,class:"fa-solid fa-file-circle-check fa-xl"},Pv={key:1,class:"fa-solid fa-file-circle-check fa-lg"},Vv=In(()=>g("h4",{class:"section-tag"},"Quality Check",-1)),kv={key:0,class:"fa-sharp fa-solid fa-microscope fa-xl"},Mv={key:1,class:"fa-sharp fa-solid fa-microscope fa-lg"},Bv=In(()=>g("h4",{class:"section-tag"},"Analysis",-1)),Av={key:0,class:"fa-regular fa-file-pdf fa-xl"},Fv={key:1,class:"fa-regular fa-file-pdf fa-lg"},Nv=In(()=>g("h4",{class:"section-tag"},"Report",-1));function $v(e,t,n,s,o,i){const a=V("router-link");return R(),E("div",Iv,[g("div",Rv,[y(a,{to:"/home",style:{"text-decoration":"none"},class:"normal"},{default:x(()=>[g("div",xv,[e.$matches.mediumLaptop.min?(R(),E("i",Dv)):(R(),E("i",Ev)),Lv])]),_:1}),g("div",{class:N(["tool",{active:o.selectedTool==="QualityCheck"}]),onClick:t[0]||(t[0]=r=>i.selectTool("QualityCheck")),onKeydown:t[1]||(t[1]=ue((...r)=>i.handleKeyDown&&i.handleKeyDown(...r),["prevent"]))},[e.$matches.mediumLaptop.min?(R(),E("i",Ov)):(R(),E("i",Pv)),Vv],34),g("div",{class:N(["tool",{active:o.selectedTool==="GraphicalAnalysis"}]),onClick:t[2]||(t[2]=r=>i.selectTool("GraphicalAnalysis")),onKeydown:t[3]||(t[3]=ue((...r)=>i.handleKeyDown&&i.handleKeyDown(...r),["prevent"]))},[e.$matches.mediumLaptop.min?(R(),E("i",kv)):(R(),E("i",Mv)),Bv],34),g("div",{class:N(["tool",{active:o.selectedTool==="ReportMaker"}]),onClick:t[4]||(t[4]=r=>i.selectTool("ReportMaker")),onKeydown:t[5]||(t[5]=ue((...r)=>i.handleKeyDown&&i.handleKeyDown(...r),["prevent"]))},[e.$matches.mediumLaptop.min?(R(),E("i",Av)):(R(),E("i",Fv)),Nv],34)])])}const Uv=A(Tv,[["render",$v],["__scopeId","data-v-46cbd000"]]);const Hv={props:{heartrate:{type:Number,required:!0},duration:{type:String,required:!0},state:{type:String,required:!0},isActive:{type:Boolean,required:!0},stateColor:{type:String,required:!1,default:"#66C9DA"}},data(){return{isHovered:!1}},methods:{handleClick(){this.$emit("state-change",this.state)}}},ss=e=>(ae("data-v-258e6b3d"),e=e(),se(),e),Wv={class:"button-content"},zv={style:{display:"flex","justify-content":"space-between"}},jv=ss(()=>g("h4",null,"HEART RATE",-1)),Gv=ss(()=>g("h4",null,"DURATION",-1));function Xv(e,t,n,s,o,i){return R(),E("div",{class:N({"custom-button":!0,highlighted:n.isActive}),onClick:t[0]||(t[0]=(...a)=>i.handleClick&&i.handleClick(...a)),onMouseover:t[1]||(t[1]=a=>o.isHovered=!0),onFocusin:t[2]||(t[2]=a=>o.isHovered=!0),onMouseout:t[3]||(t[3]=a=>o.isHovered=!1),onFocusout:t[4]||(t[4]=a=>o.isHovered=!1),onKeydown:t[5]||(t[5]=nt(ue((...a)=>e.handleKeyDown&&e.handleKeyDown(...a),["prevent"]),["space"]))},[g("div",Wv,[g("div",null,[g("h1",{style:ne({color:n.stateColor})},U(n.state),5)]),g("div",zv,[g("div",null,[g("h2",null,U(n.heartrate)+" BPM",1),jv]),g("div",null,[g("h2",null,U(n.duration),1),Gv])])])],34)}const qv=A(Hv,[["render",Xv],["__scopeId","data-v-258e6b3d"]]),Kv={name:"PatientInfoHUD",mounted(){const{canvas:e}=this.$refs;e.width=this.numImages*this.imgWidth,e.height=this.imgHeight,this.addPhaseId(),this.addHRInfo()},data(){return{paddingX:15}},props:{isHidden:{type:Boolean},numImages:{type:Number,required:!0},imgWidth:{type:Number,required:!0},imgHeight:{type:Number,required:!0}},methods:{addPhaseId(){const{canvas:e}=this.$refs,t=e.getContext("2d");t.font="500 12px Roboto",t.textAlign="left",t.textBaseline="middle",t.fillStyle="white";const{numImages:n}=this,s=this.paddingX,o=15;for(let i=0;i<n;i++)t.fillText(`Phase ${i+1}`,s+this.imgWidth*i,o)},addHRInfo(){const{canvas:e}=this.$refs,t=e.getContext("2d");t.font="500 12px Roboto",t.textAlign="left",t.textBaseline="middle",t.fillStyle="white";const{numImages:n}=this,s=this.paddingX,o=30;for(let i=0;i<n;i++)t.fillText(`HR ${this.getRandomInt(106,30)}`,s+this.imgWidth*i,o)},getRandomInt(e,t){return t+Math.floor(Math.random()*(e-t))}}},Yv={ref:"canvas"};function Qv(e,t,n,s,o,i){return R(),E("div",null,[g("canvas",Yv,null,512)])}const Zv=A(Kv,[["render",Qv]]);const Jv={name:"RangeSlider",props:{maxExpand:{type:Number,default:10},minExpand:{type:Number,default:3},canvasWidth:{type:Number},sliceObj:{type:Object},numImages:Number,imgWidth:Number},data(){return{canvasHeight:44,thumbRadius:3,isDragging:!1,startThumbX:0,endThumbX:0,minValue:0,maxValue:100,startValue:0,startValueParent:0,endValue:10,startDragX:null,scrollerHeight:12,canvasCursor:"pointer"}},mounted(){this.endValue=1/(this.imgWidth*this.numImages/(this.canvasWidth-8)/100),console.log(`IMAGE STRIP WIDTH: ${this.canvasWidth}`),this.drawCanvas(),this.throttledSliderMove=qs(this.moveScale,5)},methods:{drawCurrentView(e,t){const n=e,s=Math.abs(t-e),{canvas:o}=this.$refs,i=o.getContext("2d");i.strokeStyle="#FFFFFF",i.fillStyle="#FFFFFF05";const a=35,r=(this.canvasHeight-a)/2;i.lineWidth=3;const l=6;i.beginPath(),i.moveTo(n+l,r),i.lineTo(n+s-l,r),i.arcTo(n+s,r,n+s,r+l,l),i.lineTo(n+s,r+a-l),i.arcTo(n+s,r+a,n+s-l,r+a,l),i.lineTo(n+l,r+a),i.arcTo(n,r+a,n,r+a-l,l),i.lineTo(n,r+l),i.arcTo(n,r,n+l,r,l),i.closePath(),i.fill(),i.stroke()},drawHandle(e,t,n,s,o,i,a){const r=e,l=t+s,c=n+o;r.beginPath(),r.moveTo(t+i,n),r.lineTo(l-i,n),r.quadraticCurveTo(l,n,l,n+i),r.lineTo(l,c-i),r.quadraticCurveTo(l,c,l-i,c),r.lineTo(t+i,c),r.quadraticCurveTo(t,c,t,c-i),r.lineTo(t,n+i),r.quadraticCurveTo(t,n,t+i,n),r.closePath(),r.lineWidth=2,r.strokeStyle=a,r.stroke(),r.fillStyle=a,r.fill()},drawSegment(e,t,n){const{canvas:s}=this.$refs,o=s.getContext("2d"),i=(this.canvasHeight-32)/2,a=Math.abs(t-e);this.drawHandle(o,e,i,8,32,4,n),o.fillStyle=n,o.fillRect(e,s.height/2-this.scrollerHeight/2,a,this.scrollerHeight),this.drawHandle(o,t,i,8,32,4,n)},drawTrack(){const{canvas:e}=this.$refs,t=e.getContext("2d");t.fillStyle="#3D3D3D",t.fillRect(0,e.height/2-this.scrollerHeight/2,e.width,this.scrollerHeight)},drawCanvas(){const{canvas:e}=this.$refs,t=e.getContext("2d");e.width=this.canvasWidth-8,e.height=this.canvasHeight;const n=this.getValueToXPosition(this.startValue),s=this.getValueToXPosition(this.endValue),o=this.getObjLocToVal(this.sliceObj.states.FREEBREATHING.start),i=this.getObjLocToVal(this.sliceObj.states.FREEBREATHING.end),a=this.getObjLocToVal(this.sliceObj.states.HYPERVENTILATION.start),r=this.getObjLocToVal(this.sliceObj.states.HYPERVENTILATION.end),l=this.getObjLocToVal(this.sliceObj.states.BREATHHOLD.start),c=this.getObjLocToVal(this.sliceObj.states.BREATHHOLD.end);t.clearRect(0,0,e.width,e.height),this.drawTrack(),this.drawSegment(o,i-7,"#5FBBCB"),this.drawSegment(a+3,r-7,"#C24ABC"),this.drawSegment(l+3,c-7,"#D95476"),this.drawCurrentView(n,s)},getObjLocToVal(e){const t=e.XLocation/(this.imgWidth*this.numImages);return this.getValueToXPosition(t*100)},getValueToXPosition(e){const t=this.maxValue-this.minValue,n=this.canvasWidth-8-this.thumbRadius*2;return(e-this.minValue)*n/t+this.thumbRadius},getXPositionToValue(e){const t=this.maxValue-this.minValue,n=this.canvasWidth-8-this.thumbRadius*2;return(e-this.thumbRadius)*t/n+this.minValue},handleMouseDown(e){const{canvas:t}=this.$refs,n=t.getBoundingClientRect(),s=e.clientX-n.left,o=this.getValueToXPosition(this.startValue),i=this.getValueToXPosition(this.endValue);this.startDragX=s,s<i&&s>o&&(this.isDragging="middle",this.canvasCursor="grab")},handledblCkick(e){const{canvas:t}=this.$refs,n=t.getBoundingClientRect(),s=e.clientX-n.left,o=Math.abs(this.startValue-this.endValue),i=Math.min(Math.max(this.getXPositionToValue(s)-o/2,0),this.maxValue-o);this.startValue=i,this.endValue=this.startValue+o,this.throttledSliderMove(this.startValue),this.drawCanvas()},handleMouseMove(e){if(!this.isDragging)return;const{canvas:t}=this.$refs,n=t.getBoundingClientRect(),s=e.clientX-n.left,o=this.getXPositionToValue(s),i=o-this.getXPositionToValue(this.startDragX);this.endValue+i>this.maxValue||this.startValue+i<this.minValue||(this.startValue+=i,this.endValue+=i,this.throttledSliderMove(this.startValue),this.drawCanvas(),this.startDragX=this.getValueToXPosition(o))},handleMouseUp(){this.isDragging&&(this.isDragging=!1,this.canvasCursor="pointer")},moveScale(e){this.$emit("move",e)},updatePosition(e){const t=e-this.startValue;this.startValue=e,this.endValue+=t,this.drawCanvas()}},watch:{canvasWidth(){this.drawCanvas()}}};function e0(e,t,n,s,o,i){return R(),E("div",{class:"range-slider",style:ne({width:n.canvasWidth+"px"})},[g("canvas",{ref:"canvas",onMousedown:t[0]||(t[0]=(...a)=>i.handleMouseDown&&i.handleMouseDown(...a)),onDblclick:t[1]||(t[1]=(...a)=>i.handledblCkick&&i.handledblCkick(...a)),onMousemove:t[2]||(t[2]=(...a)=>i.handleMouseMove&&i.handleMouseMove(...a)),onMouseup:t[3]||(t[3]=(...a)=>i.handleMouseUp&&i.handleMouseUp(...a)),onMouseleave:t[4]||(t[4]=(...a)=>i.handleMouseUp&&i.handleMouseUp(...a)),onFocusout:t[5]||(t[5]=(...a)=>i.handleMouseUp&&i.handleMouseUp(...a)),style:ne({cursor:o.canvasCursor})},null,36)],4)}const t0=A(Jv,[["render",e0],["__scopeId","data-v-363fb1ad"]]);const n0={props:{hasLabel:null},data(){return{showContextMenu:!1,showError:!1,contextMenuX:0,contextMenuY:0}},methods:{openContextMenu(e){this.showContextMenu=!0,this.contextMenuX=e.clientX,this.contextMenuY=e.clientY},closeContextMenu(){this.showContextMenu=!1,this.showError=!1},addLabel(e){this.$emit("add-label",e),this.showContextMenu=!1},removeLabel(){this.$emit("remove-label"),this.showContextMenu=!1},popError(e){this.showError=!0,this.contextMenuX=e.clientX,this.contextMenuY=e.clientY},handleKeyPress(){}}},ct=e=>(ae("data-v-d079620a"),e=e(),se(),e),o0=ct(()=>g("i",{class:"fa-solid fa-plus fa-sm",style:{color:"#ffffff"}},null,-1)),i0=ct(()=>g("h5",null,"Add Systole Label",-1)),a0=[o0,i0],s0=ct(()=>g("i",{class:"fa-solid fa-circle-plus fa-sm",style:{color:"#ffffff"}},null,-1)),r0=ct(()=>g("h5",null,"Add Diastole Label",-1)),l0=[s0,r0],c0=ct(()=>g("i",{class:"fa-regular fa-trash-can fa-sm",style:{color:"#ffffff"}},null,-1)),u0=ct(()=>g("h5",null,"Delete Label",-1)),d0=[c0,u0],h0=ct(()=>g("div",{class:"warning"},[g("i",{class:"fa-solid fa-triangle-exclamation",style:{color:"#ffcc00"}}),g("h5",null,"Unable to edit label! Please click within a breathing state.")],-1)),g0=[h0];function f0(e,t,n,s,o,i){return R(),E("div",{onContextmenu:t[6]||(t[6]=ue((...a)=>i.openContextMenu&&i.openContextMenu(...a),["prevent"])),onClick:t[7]||(t[7]=(...a)=>i.closeContextMenu&&i.closeContextMenu(...a)),onMousewheelPassive:t[8]||(t[8]=(...a)=>i.closeContextMenu&&i.closeContextMenu(...a)),onKeypress:t[9]||(t[9]=ue((...a)=>i.handleKeyPress&&i.handleKeyPress(...a),["prevent"]))},[Ce(e.$slots,"default",{},void 0,!0),y(Be,{name:"fade"},{default:x(()=>[o.showContextMenu?(R(),E("div",{key:0,class:"custom-context-menu",style:ne({top:`${o.contextMenuY}px`,left:`${o.contextMenuX}px`})},[g("div",{class:N(["option",{noClick:n.hasLabel}]),onClick:t[0]||(t[0]=a=>i.addLabel("systoles")),onKeypress:t[1]||(t[1]=(...a)=>e.h&&e.h(...a))},a0,34),g("div",{class:N(["option",{noClick:n.hasLabel}]),onClick:t[2]||(t[2]=a=>i.addLabel("diastoles")),onKeypress:t[3]||(t[3]=(...a)=>e.h&&e.h(...a))},l0,34),g("div",{class:N(["option",{noClick:!n.hasLabel}]),onClick:t[4]||(t[4]=a=>i.removeLabel()),onKeypress:t[5]||(t[5]=(...a)=>e.h&&e.h(...a))},d0,34)],4)):j("",!0)]),_:1}),y(Be,{name:"fade"},{default:x(()=>[o.showError?(R(),E("div",{key:0,class:"custom-context-menu",style:ne({top:`${o.contextMenuY}px`,left:`${o.contextMenuX}px`})},g0,4)):j("",!0)]),_:1})],32)}const p0=A(n0,[["render",f0],["__scopeId","data-v-d079620a"]]);const m0={emits:["update-slice","remove-label","add-label"],props:{isHidden:{type:Boolean},numImages:{type:Number,required:!0},imgWidth:{type:Number,required:!0},sliceObj:{type:Object,required:!0},BARHEIGHT:{type:Number,default:284},BARWIDTH:{type:Number,default:800}},components:{AddCardiacCycle:p0},data(){return{handlerBarWidth:9,cardiacCyclesLabelWidth:110,handleBarGrab:{width:30,height:28},addNewLabelX:0,hasLabelOnClick:!1,canvasCursor:"default",moving:!1,movingObj:"none",barHeight:this.BARHEIGHT,startX:0,barWidth:this.BARWIDTH,mouse:{x:null,y:null}}},mounted(){this.addXLocations(),this.drawTrimmer()},watch:{barWidth(){this.drawTrimmer()},barHeight(){this.drawTrimmer()}},methods:{drawCycleLabel(e){const t=e,n=t.XLocation,s=t.id,o=this.cardiacCyclesLabelWidth,{canvas:i}=this.$refs,a=i.getContext("2d");a.fillStyle="#00000095";const r=8,l=35,c=15;a.beginPath(),a.moveTo(n+c,r),a.lineTo(n+o-c,r),a.arcTo(n+o,r,n+o,r+c,c),a.lineTo(n+o,r+l-c),a.arcTo(n+o,r+l,n+o-c,r+l,c),a.lineTo(n+c,r+l),a.arcTo(n,r+l,n,r+l-c,c),a.lineTo(n,r+c),a.arcTo(n,r,n+c,r,c),a.closePath(),a.fill(),a.font="300 18px Roboto",a.textAlign="center",a.textBaseline="middle",a.fillStyle="white";const u=n+o/2,d=r+l/2;a.fillText(s,u,d);const h=2,v=3,f=2.5,p="rgba(255,255,255,0.65)";for(let m=0;m<3;m++){const w=n-10+o/2+v+m*(2*h+v),T=18+f+10+(2*h+f);a.beginPath(),a.arc(w,T,h,0,Math.PI*2),a.fillStyle=p,a.fill(),a.closePath()}},drawBars(e,t){const{canvas:n}=this.$refs,s=n.getContext("2d");s.fillStyle=t;const o=this.sliceObj.states[e].start.XLocation+this.handlerBarWidth,i=this.sliceObj.states[e].end.XLocation;s.beginPath(),s.moveTo(o,0),s.lineTo(i,0),s.moveTo(o,this.barHeight),s.lineTo(i,this.barHeight),s.lineWidth=3,s.strokeStyle=t,s.stroke()},drawTrimmer(){const{canvas:e}=this.$refs,t=e.getContext("2d"),n=this.barWidth,s=this.barHeight;e.width=n,e.height=s,t.clearRect(0,0,e.width,e.height),Object.entries(this.sliceObj.states).forEach(([o,i])=>{this.drawBars(o,i.color),i.cardiacCycles.systoles.forEach(a=>this.drawCycleLabel(a)),i.cardiacCycles.diastoles.forEach(a=>this.drawCycleLabel(a)),this.drawStartEndHandlers(i)})},findIfLabelOnClick(){const e=Math.floor(this.addNewLabelX/this.imgWidth)+1,t=this.findStateUserClicked();try{const{cardiacCycles:n}=this.sliceObj.states[t];let s=null,o=null;if(Object.keys(n).some(i=>(o=n[i].findIndex(a=>a.phaseLocation===e?(s=i,!0):!1),o!==-1)),o!==-1)return{state:t,foundLabel:s,foundIndex:o}}catch{return"error"}return null},findStateUserClicked(){let e=null;return Object.keys(this.sliceObj.states).some(t=>{const n=this.sliceObj.states[t].end.XLocation;return this.sliceObj.states[t].start.XLocation<=this.mouse.x&&this.mouse.x<=n?(e=t,!0):!1}),e},findObjonCursor(e){const t=this.sliceObj.states[e],{start:n,end:s,cardiacCycles:o}=t;if(this.checkMouseOnStart(n))return n;if(this.checkMouseOnEnd(s))return s;const i=this.checkAllLabels(o.systoles);if(i)return i;const a=this.checkAllLabels(o.diastoles);return a||null},checkMouseOnStart(e){const t=e.XLocation,n=t+this.handleBarGrab.width,s=this.barHeight/2-this.handleBarGrab.height,o=this.barHeight/2+this.handleBarGrab.height;return this.checkMouseInArea(t,n,s,o)},checkMouseOnEnd(e){const t=e.XLocation-this.handleBarGrab.width,n=t+this.handleBarGrab.width,s=this.barHeight/2-this.handleBarGrab.height,o=this.barHeight/2+this.handleBarGrab.height;return this.checkMouseInArea(t,n,s,o)},checkMouseOnLabel(e){const t=e.XLocation,n=t+this.cardiacCyclesLabelWidth,s=8,o=40;return this.checkMouseInArea(t,n,s,o)},checkAllLabels(e){return e.find(t=>this.checkMouseOnLabel(t))},checkMouseInArea(e,t,n,s){return this.mouse.x>=e&&this.mouse.x<=t&&this.mouse.y>=n&&this.mouse.y<=s},startResize(e){this.$refs.menu.closeContextMenu(),this.mouse.x=e.offsetX,this.mouse.y=e.offsetY,this.startX=this.mouse.x;const t=this.findStateUserClicked();if(t){const n=this.findObjonCursor(t);n&&(this.moving=!0,this.movingObj=n)}},handleNotMoving(){const e=this.findStateUserClicked();this.updateCursor(),e&&(this.findObjonCursor(e)?this.updateCursor("grab"):this.updateCursor())},handleCheckUpperLowerBound(e,t,n,s,o){return e==="start"?this.sliceObj.states[t].start.XLocation+n+this.imgWidth>this.sliceObj.states[t].end.XLocation||this.sliceObj.states[t].start.XLocation+n<=s:this.sliceObj.states[t].end.XLocation+n-this.imgWidth-50<this.sliceObj.states[t].start.XLocation||this.sliceObj.states[t].end.XLocation+n>=o},mousemoving(e){if(!(e.offsetX>=this.sliceObj.states.FREEBREATHING.start.XLocation&&e.offsetX<=this.sliceObj.states.BREATHHOLD.end.XLocation+30||this.moving)){this.updateCursor();return}if(this.mouse.x=e.offsetX,this.mouse.y=e.offsetY,!this.moving){this.handleNotMoving();return}e.preventDefault();const t=e.offsetX,n=t-this.startX;if(this.movingObj.id==="end"||this.movingObj.id==="start"){const s=this.getPreviousKey(this.sliceObj.states,this.movingObj.state),o=this.getNextKey(this.sliceObj.states,this.movingObj.state),i=s?this.sliceObj.states[s].end.XLocation:0,a=o?this.sliceObj.states[o].start.XLocation:this.barWidth;if(this.handleCheckUpperLowerBound(this.movingObj.id,this.movingObj.state,n,i,a))return;const{cardiacCycles:r}=this.sliceObj.states[this.movingObj.state];if(Object.keys(r).some(c=>r[c].some(d=>this.checkCollisionStartEnd(d,n))))return;this.startX=t,this.movingObj.XLocation+=n,requestAnimationFrame(this.drawTrimmer);return}this.movingObj.XLocation+n<=this.sliceObj.states[this.movingObj.state].start.XLocation||this.movingObj.XLocation+n>this.sliceObj.states[this.movingObj.state].end.XLocation-this.cardiacCyclesLabelWidth||(this.movingObj.XLocation+=n,requestAnimationFrame(this.drawTrimmer),this.startX=t)},checkCollisionStartEnd(e,t){return this.movingObj.id==="start"?t<0?!1:this.movingObj.XLocation+t-10>=(e.phaseLocation-1)*this.imgWidth:this.movingObj.id==="end"?t>0?!1:this.movingObj.XLocation+t+15<=e.phaseLocation*this.imgWidth:!1},drawhandle(e,t,n,s,o,i,a){const r=e;r.beginPath(),r.moveTo(t+i,n),r.lineTo(s-i,n),r.quadraticCurveTo(s,n,s,n+i),r.lineTo(s,o-i),r.quadraticCurveTo(s,o,s-i,o),r.lineTo(t+i,o),r.quadraticCurveTo(t,o,t,o-i),r.lineTo(t,n+i),r.quadraticCurveTo(t,n,t+i,n),r.closePath(),r.lineWidth=2,r.strokeStyle=a,r.stroke(),r.fillStyle=a,r.fill();const l=2.5,c=3,u=2.5,d="rgba(255,255,255,0.65)";for(let h=0;h<3;h++)for(let v=0;v<2;v++){const f=t+i+c+v*(2*l+c),p=n+i+u+10+h*(2*l+u);r.beginPath(),r.arc(f,p,l,0,Math.PI*2),r.fillStyle=d,r.fill(),r.closePath()}},drawStartEndHandlers(e){const t=e,{canvas:n}=this.$refs,s=n.getContext("2d"),o=5,i=this.handlerBarWidth+o,a=this.barHeight,r=0;let l=t.start.XLocation;t.start.XLocation=l;const c=t.color;s.beginPath(),s.moveTo(l+o,r),s.lineTo(l+i-o,r),s.lineTo(l+i-o,r+a),s.lineTo(l+o,r+a),s.arcTo(l,r+a,l,r+a-o,o),s.lineTo(l,r+o),s.arcTo(l,r,l+o,r,o),s.closePath(),s.fillStyle=c,s.fill(),this.drawhandle(s,l+o-4,a/2-this.handleBarGrab.height,l+this.handleBarGrab.width,a/2+this.handleBarGrab.height,8,c),l=t.end.XLocation,t.end.XLocation=l,l-=o,s.beginPath(),s.moveTo(l+o,r),s.arcTo(l+i,r,l+i,r+o,o),s.lineTo(l+i,r+a-o),s.arcTo(l+i,r+a,l+i-o,r+a,o),s.lineTo(l+o,r+a),s.closePath(),s.fillStyle=c,s.fill(),this.drawhandle(s,l-this.handleBarGrab.width+o+7,a/2-this.handleBarGrab.height,l+o+4,a/2+this.handleBarGrab.height,8,c)},checksingleobj(e){return this.mouse.x>=e.location&&this.mouse.x<=e.location+e.width},snapObject(){this.movingObj.phaseLocation=this.convertXLocationtoPhase(this.movingObj.XLocation,this.movingObj.id),this.movingObj.XLocation=this.convertPhaseLocationtoX(this.movingObj.phaseLocation,this.movingObj.id)},endResize(){this.moving&&(this.moving=!1,this.snapObject(),this.drawTrimmer(),this.startX=this.mouse.x,this.moving=!1,this.movingObj="none",this.$emit("update-slice",this.sliceObj))},updateCursor(e="default"){this.canvasCursor=e},getNextKey(e,t){const n=Object.keys(e),s=n.indexOf(t);return s===-1||s===n.length-1?!1:n[s+1]},getPreviousKey(e,t){const n=Object.keys(e),s=n.indexOf(t);return s<=0?!1:n[s-1]},handleAddLabel(e){const t=this.findStateUserClicked(),n=e==="systoles"?"Systole":"Diastole",s=Math.floor(this.mouse.x/this.imgWidth)+1,o=this.convertPhaseLocationtoX(s),i={id:n,state:t,phaseLocation:s,XLocation:o};this.$emit("add-label",{id:this.sliceObj.id,target:e,state:t,newLabel:i}),this.drawTrimmer()},handleRightClick(e){if(this.addNewLabelX=e.offsetX,this.mouse.x=this.addNewLabelX,this.hasLabelOnClick=this.findIfLabelOnClick(),this.hasLabelOnClick==="error"){this.$refs.menu.popError(e);return}this.$refs.menu.openContextMenu(e)},handleRemoveLabel(){const{state:e,foundLabel:t,foundIndex:n}=this.hasLabelOnClick,s=this.sliceObj.states[e].cardiacCycles[t],o=this.removeElementAtIndex(s,n);this.$emit("remove-label",{id:this.sliceObj.id,state:e,cycle:t,newArray:o}),this.drawTrimmer()},removeElementAtIndex(e,t){if(t<0||t>=e.length)throw new Error("Index is out of range");const n=[...e];return n.splice(t,1),n},convertPhaseLocationtoX(e,t){let n;if(t==="start")n=(e-1)*this.imgWidth;else if(t==="end")n=e*this.imgWidth-this.handlerBarWidth;else{const s=(this.imgWidth-this.cardiacCyclesLabelWidth)/2;n=(e-1)*this.imgWidth+s}return n},convertXLocationtoPhase(e,t){let n;if(t==="start"){const s=e+this.imgWidth/2;n=Math.floor(s/this.imgWidth)+1}else if(t==="end"){const s=e-this.imgWidth/2;n=Math.floor(s/this.imgWidth)+1}else{const s=e+this.cardiacCyclesLabelWidth/2;n=Math.floor(s/this.imgWidth)+1}return n},addXLocation(e,t){const n=e;n.XLocation=this.convertPhaseLocationtoX(n.phaseLocation,t)},addXLocations(){Object.entries(this.sliceObj.states).forEach(([e])=>{const t=this.sliceObj.states[e];this.addXLocation(t.start,"start"),this.addXLocation(t.end,"end"),t.cardiacCycles.diastoles.forEach(n=>this.addXLocation(n)),t.cardiacCycles.systoles.forEach(n=>this.addXLocation(n))})}}};function v0(e,t,n,s,o,i){const a=V("AddCardiacCycle");return R(),E(ie,null,[g("div",{class:N([{hide:n.isHidden},"horizontal-bar"])},[g("canvas",{ref:"canvas",style:ne({cursor:o.canvasCursor}),onMousedown:t[0]||(t[0]=(...r)=>i.startResize&&i.startResize(...r)),onFocusin:t[1]||(t[1]=(...r)=>i.startResize&&i.startResize(...r)),onFocusout:t[2]||(t[2]=(...r)=>i.endResize&&i.endResize(...r)),onMousemove:t[3]||(t[3]=(...r)=>i.mousemoving&&i.mousemoving(...r)),onMouseup:t[4]||(t[4]=(...r)=>i.endResize&&i.endResize(...r)),onMouseout:t[5]||(t[5]=(...r)=>i.endResize&&i.endResize(...r)),onContextmenu:t[6]||(t[6]=ue((...r)=>i.handleRightClick&&i.handleRightClick(...r),["prevent"])),onMousewheelPassive:t[7]||(t[7]=(...r)=>this.$refs.menu.closeContextMenu&&this.$refs.menu.closeContextMenu(...r))},null,36)],2),y(a,{ref:"menu","has-label":o.hasLabelOnClick,onAddLabel:i.handleAddLabel,onRemoveLabel:i.handleRemoveLabel},null,8,["has-label","onAddLabel","onRemoveLabel"])],64)}const y0=A(m0,[["render",v0],["__scopeId","data-v-9b536eaa"]]);const w0={components:{ImageStripSlider:t0,VideoTrimmer:y0,ImageBarImageInfo:Zv},emits:["newstate","update-slice","remove-label","add-label"],props:{currentState:{type:String,default:"FREEBREATHING"},maxWidth:{type:Number,default:1560},isHidden:{type:Boolean,default:!0},hideinfo:{type:Boolean,required:!0,default:!0},numImages:{type:Number,default:100},id:{type:String},sliceObj:{type:Object,required:!0}},data(){return{imageWidth:286,requestId:null,videTrimWidth:null,imageHeight:286,imageRatio:0,originalImageWidth:0,imageHeightWidthRatio:0,heightHere:286,viewState:"FREEBREATHING",volumeKey:null,images:null}},mounted(){if(this.volumeKey=window.sessionStorage.getItem("target-volume-key"),this.volumeKey)this.getImagesFromStore();else{const e=new Image;e.src="./images/test.png",e.onload=()=>{this.imageHeightWidthRatio=e.naturalHeight/e.naturalWidth,this.imageHeight=this.imageWidth*this.imageHeightWidthRatio,this.$refs.videotrimmer.barHeight=this.imageHeight},e.onerror=()=>{console.error("Failed to load the image.")},this.drawMovieStrip(),setTimeout(()=>{this.$emit("loaded")},400)}},created(){this.videTrimWidth=this.imageWidth*this.numImages},methods:{async getImagesFromStore(){const t=await we().buildVolume(this.volumeKey),n=t.getPointData().getScalars().getData(),s=t.getDimensions();this.images=this.getImagesFromArray(n,s),this.scaledImages=await this.scaleImages(this.images,s[0],s[1],this.imageWidth,this.imageHeight),this.drawSingleImage(this.numImages),setTimeout(()=>{this.$emit("loaded")},200)},getImagesFromArray(e,t){const n=t[0]*t[1];return e.reduce((s,o,i)=>(i%n===0&&s.push(e.slice(i,i+n)),s),[])},drawSingleImage(e){const t=this.scaledImages,n=this.$refs.movieStripCanvas,s=n.getContext("2d"),o=this.imageWidth,i=this.imageWidth;n.width=this.imageWidth*e,n.height=o;for(let a=0;a<e;a++){const r=new Uint8ClampedArray(this.imageWidth*o*4);t[a].forEach((u,d)=>{const h=d*4;r[h]=u,r[h+1]=u,r[h+2]=u,r[h+3]=255});const c=new ImageData(r,i,o);s.putImageData(c,a*i,0)}s.setTransform(1,0,0,1,0,0)},async scaleImages(e,t,n,s,o){const i=[];for(let a=0;a<this.numImages;a++)i.push(this.scaleImage(e[a],t,n,s,o));return console.log("ended images"),i},scaleImage(e,t,n,s,o){return new Array(o*s).fill(0).map((a,r)=>{const l=Math.floor(r/s),u=r%s*(t-1)/(s-1),d=l*(n-1)/(o-1),h=Math.floor(u),v=Math.ceil(u),f=Math.floor(d),p=Math.ceil(d),m=e[f*t+h],w=e[f*t+v],T=e[p*t+h],S=e[p*t+v],b=u-h,O=d-f,D=m*(1-b)+w*b,k=T*(1-b)+S*b;return D*(1-O)+k*O})},drawMovieStrip(){const e=this.$refs.movieStripCanvas,t=e.getContext("2d"),{numImages:n}=this;e.width=this.imageWidth*n,e.height=this.imageHeight,this.videTrimWidth=e.width,t.clearRect(0,0,e.width,e.height);const s=Array(n).fill("./images/test.png"),{imageWidth:o}=this;let i=0;const a=s.map(r=>new Promise((l,c)=>{const u=new Image;u.src=r,u.onload=()=>{l(u)},u.onerror=d=>{c(d)}}));Promise.all(a).then(r=>{r.forEach(l=>{t.drawImage(l,i,0,o,this.imageHeight),i+=o})}).catch(r=>{console.error(r)})},scrollX(e){const t="image-container",n=this.$refs[t];e.ctrlKey?n.scrollLeft+=Math.sign(e.deltaY)*this.imageWidth:(n.scrollLeft+=e.deltaY/4,n.scrollLeft+=e.deltaX/4),this.$refs.sliderBar.updatePosition(100*n.scrollLeft/n.scrollWidth),this.getScrollState()},moveX(e){const t="image-container";this.$refs[t].scrollLeft=this.$refs[t].scrollWidth*(e/100),this.getScrollState()},getScrollState(){const e=["FREEBREATHING","HYPERVENTILATION","BREATHHOLD"],t=this.sliceObj,n=this.$refs["image-container"].scrollLeft;if(!(t.states[this.viewState].start.XLocation<n&&n<t.states[this.viewState].end.XLocation)){const s=e.find(o=>n<t.states[o].end.XLocation);s&&(this.viewState=s,this.$emit("newstate",this.viewState))}},scrollAnimation(e,t){const n=e,s=n.scrollLeft,o=300;let i;function a(r){i||(i=r);const l=r-i,c=Math.min(l/o,1);n.scrollLeft=s+t*c,c<1&&requestAnimationFrame(a)}requestAnimationFrame(a)},scrollToState(e){const t=this.$refs["image-container"],n=this.sliceObj.states[e].start.XLocation,s=n-t.scrollLeft;this.scrollAnimation(t,s),this.$refs.sliderBar.updatePosition(100*n/t.scrollWidth)},handleUpdateSlice(e){this.$emit("update-slice",e),this.$refs.sliderBar.drawCanvas()},handleRemoveLabel(e){this.$emit("remove-label",e)},handleAddLabel(e){this.$emit("add-label",e)}}},S0={style:{height:"300px"}},_0={class:"video-trimmer-container",ref:"video-trimmer-container"},C0={style:{height:"295px"},ref:"moviestripcont"},b0={ref:"movieStripCanvas"},T0={key:0};function I0(e,t,n,s,o,i){const a=V("VideoTrimmer"),r=V("ImageBarImageInfo"),l=V("ImageStripSlider");return R(),E(ie,null,[g("div",S0,[g("div",{class:"strip",style:ne({width:n.maxWidth-250+"px"}),ref:"image-container",onMousewheelPassive:t[0]||(t[0]=(...c)=>i.scrollX&&i.scrollX(...c))},[g("div",_0,[y(a,{"slice-obj":n.sliceObj,BARHEIGHT:o.imageHeight,BARWIDTH:o.videTrimWidth,numImages:this.numImages,imgWidth:o.imageWidth,isHidden:!n.isHidden,ref:"videotrimmer",onUpdateSlice:i.handleUpdateSlice,onRemoveLabel:i.handleRemoveLabel,onAddLabel:i.handleAddLabel},null,8,["slice-obj","BARHEIGHT","BARWIDTH","numImages","imgWidth","isHidden","onUpdateSlice","onRemoveLabel","onAddLabel"])],512),g("div",C0,[g("canvas",b0,null,512)],512),y(Be,null,{default:x(()=>[n.hideinfo?(R(),E("div",T0,[y(r,{numImages:this.numImages,imgWidth:o.imageWidth,imgHeight:o.heightHere},null,8,["numImages","imgWidth","imgHeight"])])):j("",!0)]),_:1})],36)]),y(l,{numImages:this.numImages,imgWidth:o.imageWidth,"slice-obj":n.sliceObj,canvasWidth:n.maxWidth-250,onUpdateDone:i.drawMovieStrip,onMove:i.moveX,ref:"sliderBar"},null,8,["numImages","imgWidth","slice-obj","canvasWidth","onUpdateDone","onMove"])],64)}const R0=A(w0,[["render",I0],["__scopeId","data-v-ad1ac1a9"]]);const x0={props:{iconSource:{type:String,default:"input-cursor"},id:{type:Number},status:{type:Boolean,default:!0},iconHeight:{type:Number,default:30}},methods:{handleclick(){this.$emit("toggleVisibility",this.status)}}},D0=["src"];function E0(e,t,n,s,o,i){return R(),E("div",{onClick:t[0]||(t[0]=(...a)=>i.handleclick&&i.handleclick(...a)),class:N(["circle2",{clicked:n.status}]),onKeydown:t[1]||(t[1]=nt(ue((...a)=>e.handleKeyDown&&e.handleKeyDown(...a),["prevent"]),["space"]))},[g("div",{class:N([{clicked:n.status},"icon-container"])},[g("img",{src:"/icons/"+n.iconSource+".svg",style:ne({height:n.iconHeight+"px"}),alt:"Icon"},null,12,D0)],2)],34)}const L0=A(x0,[["render",E0],["__scopeId","data-v-2d9b6532"]]);const O0={props:{givenWidth:{type:Number},givenHeight:{type:Number},count:{type:Number,default:1},flexDirection:{type:String,default:"column"},radius:{type:Number,default:5}}};function P0(e,t,n,s,o,i){return R(),E("div",{class:"cards",style:ne({flexDirection:n.flexDirection})},[(R(!0),E(ie,null,Pe(n.count,a=>(R(),E("div",{key:a,class:"card is-loading",style:ne({width:n.givenWidth+"px",height:n.givenHeight+"px",borderRadius:n.radius+"px"})},null,4))),128))],4)}const V0=A(O0,[["render",P0]]);const k0={props:{allowedWidth:{type:Number}},components:{SquareLoader:V0}},fo=e=>(ae("data-v-928a85d6"),e=e(),se(),e),M0={class:"slice"},B0={class:"state-control"},A0=fo(()=>g("br",null,null,-1)),F0=fo(()=>g("br",null,null,-1)),N0={style:{overflow:"hidden"}},$0=fo(()=>g("br",null,null,-1));function U0(e,t,n,s,o,i){const a=V("SquareLoader");return R(),E("div",M0,[g("div",B0,[y(a,{"given-width":100,givenHeight:35}),A0,y(a,{"given-width":45,givenHeight:45,count:3,flexDirection:"row",radius:50}),F0,y(a,{"given-width":180,givenHeight:65,count:3})]),g("div",N0,[y(a,{"given-width":284,givenHeight:250,count:Math.floor((n.allowedWidth-250)/284)+1,flexDirection:"row"},null,8,["count"]),$0,y(a,{"given-width":n.allowedWidth-270,givenHeight:44},null,8,["given-width"])])])}const H0=A(k0,[["render",U0],["__scopeId","data-v-928a85d6"]]);const W0={components:{StateButtons:qv,ImageBar:R0,IconToggleQA:L0,SkeletonLoaderCBS:H0},props:{sliceInfo:{type:Object}},data(){return{stateButtons:this.sliceInfo.stateButtons,allowedWidth:null,loading:!0}},methods:{handleStateChange(e){const t=e.replace(/\s/g,"");this.$emit("state-change",t),this.$refs.imgBar.scrollToState(t)},handleNewState(e){this.$emit("state-change",e)},handleUpdateSlice(e){this.$emit("update-slice",e)},handleRemoveLabel(e){this.$emit("remove-label",e)},handleAddLabel(e){this.$emit("add-label",e)},handleResize(){this.allowedWidth=window.innerWidth-100,this.allowedWidth>2e3&&(this.allowedWidth=2e3)}},created(){window.addEventListener("resize",this.handleResize),this.handleResize()}},z0={class:"state-control"},j0={class:"slice-name"},G0={class:"toggle-icons-container"},X0={class:"state-buttons"},q0={class:"movie-strip"};function K0(e,t,n,s,o,i){const a=V("SkeletonLoaderCBS"),r=V("IconToggleQA"),l=V("StateButtons"),c=V("ImageBar");return R(),E(ie,null,[tt(y(a,{allowedWidth:o.allowedWidth},null,8,["allowedWidth"]),[[Bt,o.loading]]),y(Be,{name:"slide-fade"},{default:x(()=>[tt(g("div",{class:"slice",style:ne({width:o.allowedWidth+"px"})},[g("div",z0,[g("h1",j0,U(n.sliceInfo.name),1),g("div",G0,[y(r,{id:n.sliceInfo.id,onToggleVisibility:t[0]||(t[0]=u=>e.$emit("toggle-trimmer",n.sliceInfo.id)),iconSource:"adjust-trim",status:n.sliceInfo.imgBarProperties.showTrimmer},null,8,["id","status"]),y(r,{id:n.sliceInfo.id,onToggleVisibility:t[1]||(t[1]=u=>e.$emit("toggle-patient-info",n.sliceInfo.id)),iconSource:"hide-bottom",status:n.sliceInfo.imgBarProperties.showPatientInfo},null,8,["id","status"]),y(r,{id:n.sliceInfo.id,status:n.sliceInfo.imgBarProperties.showGraph,iconSource:"show-contours",onToggleVisibility:t[2]||(t[2]=u=>e.$emit("toggle-graph",n.sliceInfo.id))},null,8,["id","status"])]),g("div",X0,[y(l,{id:n.sliceInfo.id,heartrate:o.stateButtons.FREEBREATHING.heartrate,duration:o.stateButtons.FREEBREATHING.duration,state:"FREE BREATHING","is-active":o.stateButtons.currentState==="FREEBREATHING",onStateChange:i.handleStateChange},null,8,["id","heartrate","duration","is-active","onStateChange"]),y(l,{id:n.sliceInfo.id,heartrate:o.stateButtons.HYPERVENTILATION.heartrate,duration:o.stateButtons.HYPERVENTILATION.duration,state:"HYPERVENTILATION","is-active":o.stateButtons.currentState==="HYPERVENTILATION",stateColor:o.stateButtons.HYPERVENTILATION.stateColor,onStateChange:i.handleStateChange},null,8,["id","heartrate","duration","is-active","stateColor","onStateChange"]),y(l,{id:n.sliceInfo.id,heartrate:o.stateButtons.BREATHHOLD.heartrate,duration:o.stateButtons.BREATHHOLD.duration,state:"BREATHHOLD","is-active":o.stateButtons.currentState==="BREATHHOLD",stateColor:o.stateButtons.BREATHHOLD.stateColor,onStateChange:i.handleStateChange},null,8,["id","heartrate","duration","is-active","stateColor","onStateChange"])])]),g("div",q0,[y(c,{id:n.sliceInfo.sliceOBJ.id,isHidden:n.sliceInfo.imgBarProperties.showTrimmer,hideinfo:n.sliceInfo.imgBarProperties.showPatientInfo,"slice-obj":n.sliceInfo.sliceOBJ,currentState:o.stateButtons.currentState,maxWidth:o.allowedWidth,ref:"imgBar",onNewstate:i.handleNewState,onUpdateSlice:i.handleUpdateSlice,onRemoveLabel:i.handleRemoveLabel,onAddLabel:i.handleAddLabel,onLoaded:t[3]||(t[3]=u=>o.loading=!1)},null,8,["id","isHidden","hideinfo","slice-obj","currentState","maxWidth","onNewstate","onUpdateSlice","onRemoveLabel","onAddLabel"])])],4),[[Bt,!o.loading]])]),_:1})],64)}const Y0=A(W0,[["render",K0],["__scopeId","data-v-4151b32e"]]);const Q0={components:{BreathingSplitRow:Y0},data(){return{caseObj:{slice1:{id:"slice1",states:{FREEBREATHING:{color:"#79CFDE",start:{id:"start",state:"FREEBREATHING",phaseLocation:1},end:{id:"end",state:"FREEBREATHING",phaseLocation:4},cardiacCycles:{systoles:[{id:"Systole",state:"FREEBREATHING",phaseLocation:1},{id:"Systole",state:"FREEBREATHING",phaseLocation:2}],diastoles:[{id:"Diastole",state:"FREEBREATHING",phaseLocation:3}]}},HYPERVENTILATION:{color:"#C24ABC",start:{id:"start",state:"HYPERVENTILATION",phaseLocation:5},end:{id:"end",state:"HYPERVENTILATION",phaseLocation:20},cardiacCycles:{systoles:[{id:"Systole",state:"HYPERVENTILATION",phaseLocation:5}],diastoles:[{id:"Diastole",state:"HYPERVENTILATION",phaseLocation:6}]}},BREATHHOLD:{color:"#d95476",start:{id:"start",state:"BREATHHOLD",phaseLocation:21},end:{id:"end",state:"BREATHHOLD",phaseLocation:30},cardiacCycles:{systoles:[{id:"Systole",state:"BREATHHOLD",phaseLocation:25}],diastoles:[{id:"Diastole",state:"BREATHHOLD",phaseLocation:28}]}}}},slice2:{id:"slice2",states:{FREEBREATHING:{color:"#79CFDE",start:{id:"start",state:"FREEBREATHING",phaseLocation:1},end:{id:"end",state:"FREEBREATHING",phaseLocation:10},cardiacCycles:{systoles:[{id:"Systole",state:"FREEBREATHING",phaseLocation:3}],diastoles:[{id:"Diastole",state:"FREEBREATHING",phaseLocation:5}]}},HYPERVENTILATION:{color:"#C24ABC",start:{id:"start",state:"HYPERVENTILATION",phaseLocation:11},end:{id:"end",state:"HYPERVENTILATION",phaseLocation:30},cardiacCycles:{systoles:[{id:"Systole",state:"HYPERVENTILATION",phaseLocation:12}],diastoles:[{id:"Diastole",state:"HYPERVENTILATION",phaseLocation:20}]}},BREATHHOLD:{color:"#d95476",start:{id:"start",state:"BREATHHOLD",phaseLocation:31},end:{id:"end",state:"BREATHHOLD",phaseLocation:80},cardiacCycles:{systoles:[{id:"Systole",state:"BREATHHOLD",phaseLocation:35}],diastoles:[{id:"Diastole",state:"BREATHHOLD",phaseLocation:60}]}}}}},sliceInfo1:{name:"SLICE 1",id:1,sliceOBJ:null,stateButtons:{currentState:"FREEBREATHING",FREEBREATHING:{state:"FREEBREATHING",heartrate:80,duration:"01:32",stateColor:"#E242E6"},HYPERVENTILATION:{state:"HYPERVENTILATION",heartrate:120,duration:"02:32",stateColor:"#E242E6"},BREATHHOLD:{state:"BREATHHOLD",heartrate:70,duration:"00:32",stateColor:"#D95476"}},imgBarProperties:{showTrimmer:!0,showPatientInfo:!0,showGraph:!1}},sliceInfo2:{name:"SLICE 2",id:2,sliceOBJ:null,stateButtons:{currentState:"FREEBREATHING",FREEBREATHING:{state:"FREEBREATHING",heartrate:50,duration:"01:32",stateColor:"#E242E6"},HYPERVENTILATION:{state:"HYPERVENTILATION",heartrate:60,duration:"01:32",stateColor:"#E242E6"},BREATHHOLD:{state:"BREATHHOLD",heartrate:125,duration:"01:32",stateColor:"#D95476"}},imgBarProperties:{showTrimmer:!0,showPatientInfo:!0,showGraph:!1}}}},methods:{handleUpdateSlice(e){const t=e.id;this.caseObj[t]=e},handleRemoveLabel(e){this.caseObj[e.id].states[e.state].cardiacCycles[e.cycle]=e.newArray},handleAddLabel(e){this.caseObj[e.id].states[e.state].cardiacCycles[e.target].push(e.newLabel)}},created(){this.sliceInfo1.sliceOBJ=this.caseObj.slice1,this.sliceInfo2.sliceOBJ=this.caseObj.slice2}},Z0={class:"slices-containers"};function J0(e,t,n,s,o,i){const a=V("BreathingSplitRow");return R(),E("div",Z0,[y(a,{"slice-info":o.sliceInfo1,onToggleTrimmer:t[0]||(t[0]=r=>o.sliceInfo1.imgBarProperties.showTrimmer=!o.sliceInfo1.imgBarProperties.showTrimmer),onTogglePatientInfo:t[1]||(t[1]=r=>o.sliceInfo1.imgBarProperties.showPatientInfo=!o.sliceInfo1.imgBarProperties.showPatientInfo),onToggleGraph:t[2]||(t[2]=r=>o.sliceInfo1.imgBarProperties.showGraph=!o.sliceInfo1.imgBarProperties.showGraph),onStateChange:t[3]||(t[3]=r=>o.sliceInfo1.stateButtons.currentState=r),onUpdateSlice:i.handleUpdateSlice,onRemoveLabel:i.handleRemoveLabel,onAddLabel:i.handleAddLabel},null,8,["slice-info","onUpdateSlice","onRemoveLabel","onAddLabel"]),y(a,{"slice-info":o.sliceInfo2,onToggleTrimmer:t[4]||(t[4]=r=>o.sliceInfo2.imgBarProperties.showTrimmer=!o.sliceInfo2.imgBarProperties.showTrimmer),onTogglePatientInfo:t[5]||(t[5]=r=>o.sliceInfo2.imgBarProperties.showPatientInfo=!o.sliceInfo2.imgBarProperties.showPatientInfo),onToggleGraph:t[6]||(t[6]=r=>o.sliceInfo2.imgBarProperties.showGraph=!o.sliceInfo2.imgBarProperties.showGraph),onStateChange:t[7]||(t[7]=r=>o.sliceInfo2.stateButtons.currentState=r),onUpdateSlice:i.handleUpdateSlice,onRemoveLabel:i.handleRemoveLabel,onAddLabel:i.handleAddLabel},null,8,["slice-info","onUpdateSlice","onRemoveLabel","onAddLabel"])])}const e1=A(Q0,[["render",J0],["__scopeId","data-v-ab7f5aee"]]);const t1={components:{CheckBreathingSplits:e1,CheckContours:is,LoadingScreen:Yi},data(){return{currentComponent:"CheckBreathingSplits"}},methods:{handleButtonClicked(e){this.activeButton=e},toggleComponent(e){this.currentComponent=e}},mounted(){const e=window.sessionStorage.getItem("currentQaView");e?this.currentComponent=e:this.currentComponent="CheckBreathingSplits"}},n1={class:"qualitycontainer"};function o1(e,t,n,s,o,i){return R(),E("div",n1,[g("div",{class:N([{loaded:1},"comp-container"])},[y(Be,{name:"fade"},{default:x(()=>[(R(),Y(gi(o.currentComponent)))]),_:1})])])}const i1=A(t1,[["render",o1],["__scopeId","data-v-25c3d57c"]]);const a1={props:{editable:{type:Boolean}},data(){return{imageSource:null,hovering:!1}},methods:{openImageDialog(){this.$refs.imageInput.click()},handleImageChange(e){this.uploadImage(e.target.files[0])},handleImageDrop(e){e.preventDefault();const t=e.dataTransfer.files[0];this.uploadImage(t)},handleDragOver(e){e.preventDefault(),this.hovering=!0},handleDragLeave(){this.hovering=!1},uploadImage(e){if(e){const t=new FileReader;t.onloadend=()=>{this.imageSource=t.result},t.readAsDataURL(e)}}}},s1=["src"];function r1(e,t,n,s,o,i){return R(),E("div",{class:"logo-holder",onClick:t[2]||(t[2]=(...a)=>i.openImageDialog&&i.openImageDialog(...a)),onDragenter:t[3]||(t[3]=(...a)=>i.handleDragOver&&i.handleDragOver(...a)),onDragover:t[4]||(t[4]=(...a)=>i.handleDragOver&&i.handleDragOver(...a)),onDrop:t[5]||(t[5]=(...a)=>i.handleImageDrop&&i.handleImageDrop(...a)),onDragleave:t[6]||(t[6]=(...a)=>i.handleDragLeave&&i.handleDragLeave(...a)),ref:"logoContainer",onKeydown:t[7]||(t[7]=nt(ue((...a)=>e.handleKeyDown&&e.handleKeyDown(...a),["prevent"]),["space"]))},[o.imageSource?(R(),E("img",{key:0,src:o.imageSource,alt:"Uploaded Logo",style:{cursor:"pointer"}},null,8,s1)):j("",!0),n.editable&&!o.imageSource?(R(),E("div",{key:1,class:N(["place-holder",{hover:o.hovering}])},[g("h4",{onDragover:t[0]||(t[0]=(...a)=>i.handleDragOver&&i.handleDragOver(...a))},"Click or Drop Logo",32)],2)):j("",!0),g("input",{ref:"imageInput",type:"file",style:{display:"none"},accept:"image/*",onChange:t[1]||(t[1]=(...a)=>i.handleImageChange&&i.handleImageChange(...a)),"aria-labelledby":"logoImageInput"},null,544)],544)}const l1=A(a1,[["render",r1],["__scopeId","data-v-bca1a7a6"]]);const c1={props:{id:{type:String,required:!0},options:{type:Array,required:!0},editable:{type:Boolean,default:!0}},data(){return{selectedOption:"Select..."}},methods:{onOptionSelected(e){const t=e.target.value;this.selectedOption=t,this.$emit("option-selected",this.id,t)}}},u1=e=>(ae("data-v-6a5101fe"),e=e(),se(),e),d1={key:0,class:"select"},h1=["id"],g1=u1(()=>g("option",{value:"",disabled:"",selected:""},"Select...",-1)),f1=["value"],p1={key:1,class:"selected-option"};function m1(e,t,n,s,o,i){return n.editable?(R(),E("div",d1,[g("select",{id:n.id,required:"",onChange:t[0]||(t[0]=a=>i.onOptionSelected(a)),"aria-labelledby":"dropDownComponentinReportElement"},[g1,(R(!0),E(ie,null,Pe(n.options,(a,r)=>(R(),E("option",{key:r,value:a.value},U(a.label),9,f1))),128))],40,h1)])):(R(),E("h5",p1,U(o.selectedOption),1))}const v1=A(c1,[["render",m1],["__scopeId","data-v-6a5101fe"]]);const y1={props:{id:{type:String},width:{type:Number,default:200},height:{type:Number,default:250},canvasText:{type:String,default:"Select or Drop Image"},addBar:{type:String,default:null},editable:{type:Boolean,default:!0}},data(){return{moveMode:!1,isMoving:!1,cStartX:null,cStartY:null,canvasX:0,canvasY:0,zoomValue:1,defaultZoomValue:1,originalImage:null,hovering:!1}},methods:{setupCanvas(){const{canvas:e}=this.$refs,t=e.getContext("2d");e.width=this.width*(1/.75),e.height=this.height,t.fillStyle="rgba(0, 0, 0, 0.3)",t.fillRect(0,0,e.width,e.height),t.fillStyle="white",t.font="20px Arial",t.textAlign="center",t.textBaseline="middle",this.wrapText(t,this.canvasText,e.width/2,e.height/2,150)},wrapText(e,t,n,s,o){let i=s;const a=t.split(" ");let r="";const l=e.measureText("M").width*1.2;for(let c=0;c<a.length;c++){const u=`${r+a[c]} `;e.measureText(u).width>o&&c>0?(e.fillText(r,n,i),r=`${a[c]} `,i+=l):r=u}e.fillText(r,n,i)},drawImage(){const{canvas:e}=this.$refs,t=e.getContext("2d");t.clearRect(0,0,e.width,e.height),t.drawImage(this.originalImage,0,0)},openFilePicker(){this.$refs.imageLoaderInput.click()},uploadImage(e){const t=e.target.files[0],{canvas:n}=this.$refs;if(t){const s=new FileReader;s.onload=o=>{this.originalImage=new Image,this.originalImage.onload=()=>{n.width=this.originalImage.width+10,n.height=this.originalImage.height+10,this.drawImage()},this.originalImage.src=o.target.result,this.updateImageZoom(),this.resetImagePositionAndZoom()},s.readAsDataURL(t)}},uploadImageDrop(e){const{canvas:t}=this.$refs;if(e){const n=new FileReader;n.onload=s=>{this.originalImage=new Image,this.originalImage.onload=()=>{t.width=this.originalImage.width+10,t.height=this.originalImage.height+10,this.drawImage()},this.originalImage.src=s.target.result,this.updateImageZoom(),this.resetImagePositionAndZoom()},n.readAsDataURL(e)}},handleImageDrop(e){e.preventDefault();const t=e.dataTransfer.files[0];this.uploadImageDrop(t),this.hovering=!1},handleDragOver(e){e.preventDefault(),this.hovering=!0},handleDragLeave(){this.hovering=!1},toggleMoveMode(){this.originalImage&&(this.moveMode=!this.moveMode)},handleMouseDown(e){this.moveMode&&(this.isMoving=!0,this.cStartX=e.clientX,this.cStartY=e.clientY)},handleMouseMove(e){if(!(!this.moveMode||!this.isMoving)){if(this.cStartX!==void 0&&this.cStartY!==void 0){const t=e.clientX-this.cStartX,n=e.clientY-this.cStartY;this.canvasX+=t,this.canvasY+=n,this.$refs.canvas.style.transform=`translate(${this.canvasX}px, ${this.canvasY}px)`,this.cStartX=e.clientX,this.cStartY=e.clientY}}},handleMouseUp(){this.isMoving=!1,this.cStartX=void 0,this.cStartY=void 0},zoomIn(){this.zoomValue+=.025,this.updateImageZoom()},zoomOut(){this.zoomValue-=.025,this.updateImageZoom()},resetImagePositionAndZoom(){this.moveMode=!1,this.zoomValue=this.defaultZoomValue,this.updateImageZoom()},updateImageZoom(){if(this.originalImage){const e=this.$refs.zoomControl;e.style.transform=`scale(${this.zoomValue})`,e.style.transformOrigin="0 0"}},async captureScreenshot(){const e=this.$refs["vascular-image-div"];fi(e,{logging:!1,scale:3}).then(t=>{const n=t.toDataURL("image/png");this.$emit("screenshot-captured",this.id,n)}).catch(t=>{console.error("Error capturing screenshot:",t)})}},mounted(){if(this.setupCanvas(),this.addBar){const e=new Image;e.src=this.addBar,e.onload=()=>{this.$refs.barGraphLegend.src=e.src}}},watch:{editable(){this.moveMode&&(this.moveMode=!this.moveMode,this.handleMouseUp())}}},Rn=e=>(ae("data-v-3e2c92d2"),e=e(),se(),e),w1={key:0,class:"buttons"},S1={class:"upload-button",title:"Upload File",alt:"Upload File",style:{position:"relative"}},_1=Rn(()=>g("i",{class:"fas fa-upload fa-lg",style:{color:"#ffffff"}},null,-1)),C1=[_1],b1={key:0,class:"move-button",title:"Move",alt:"Move",style:{position:"relative"}},T1=Rn(()=>g("i",{class:"fas fa-arrows fa-lg",style:{color:"#ffffff"}},null,-1)),I1=[T1],R1={key:1,class:"zoom-in-button",title:"Zoom In",alt:"Zoom In",style:{position:"relative"}},x1=Rn(()=>g("i",{class:"fas fa-search-plus fa-lg",style:{color:"#ffffff"}},null,-1)),D1=[x1],E1={key:2,class:"zoom-out-button",title:"Zoom Out",alt:"Zoom Out",style:{position:"relative"}},L1=Rn(()=>g("i",{class:"fas fa-search-minus fa-lg",style:{color:"#ffffff"}},null,-1)),O1=[L1],P1={ref:"vascular-image-div"},V1={key:0,style:{position:"relative"}},k1={style:{"user-select":"none","-webkit-user-drag":"none"},id:"bar-graph-legend-os",ref:"barGraphLegend",alt:"Image Not Loaded"};function M1(e,t,n,s,o,i){return R(),E("div",{id:"image-container",class:N({moving:o.moveMode,hover:o.hovering}),style:ne({height:n.height+"px",width:n.width+"pt"}),onDragenter:t[8]||(t[8]=(...a)=>i.handleDragOver&&i.handleDragOver(...a)),onDragover:t[9]||(t[9]=(...a)=>i.handleDragOver&&i.handleDragOver(...a)),onDrop:t[10]||(t[10]=(...a)=>i.handleImageDrop&&i.handleImageDrop(...a)),onDragleave:t[11]||(t[11]=(...a)=>i.handleDragLeave&&i.handleDragLeave(...a))},[n.editable?(R(),E("div",w1,[g("div",S1,[g("button",{class:"upload-buttons upload-image",onClick:t[0]||(t[0]=(...a)=>i.openFilePicker&&i.openFilePicker(...a))},C1),g("input",{type:"file",ref:"imageLoaderInput",name:"imageLoader",style:{display:"none"},accept:"image/*",onChange:t[1]||(t[1]=(...a)=>i.uploadImage&&i.uploadImage(...a)),"aria-labelledby":"hiddenImageInputinReport"},null,544)]),o.originalImage?(R(),E("div",b1,[g("button",{class:N(["upload-buttons",{moving:o.moveMode}]),style:{left:"50px"},onClick:t[2]||(t[2]=(...a)=>i.toggleMoveMode&&i.toggleMoveMode(...a))},I1,2)])):j("",!0),o.originalImage?(R(),E("div",R1,[g("button",{class:"upload-buttons",style:{left:"90px"},onClick:t[3]||(t[3]=(...a)=>i.zoomIn&&i.zoomIn(...a))},D1)])):j("",!0),o.originalImage?(R(),E("div",E1,[g("button",{class:"upload-buttons",style:{left:"130px"},onClick:t[4]||(t[4]=(...a)=>i.zoomOut&&i.zoomOut(...a))},O1)])):j("",!0)])):j("",!0),g("div",P1,[n.addBar?(R(),E("div",V1,[g("img",k1,null,512)])):j("",!0),g("div",{style:ne({height:n.height+"px",width:n.width+"pt"}),ref:"zoomControl"},[g("canvas",{ref:"canvas",id:"vascular-image",onMousedown:t[5]||(t[5]=(...a)=>i.handleMouseDown&&i.handleMouseDown(...a)),onMousemove:t[6]||(t[6]=(...a)=>i.handleMouseMove&&i.handleMouseMove(...a)),onMouseup:t[7]||(t[7]=(...a)=>i.handleMouseUp&&i.handleMouseUp(...a))},null,544)],4)],512)],38)}const B1=A(y1,[["render",M1],["__scopeId","data-v-3e2c92d2"]]);const A1={props:{id:{type:String,required:!1},values:{type:Array,required:!0}},data(){return{outerradius:85/2-1,LAD:null,LCX:null,RCA:null}},watch:{values(){this.setValues(),this.createChart()}},mounted(){this.setValues(),this.createChart()},methods:{setValues(){[this.LAD,this.LCX,this.RCA]=this.values},createChart(){const e=this.$refs.chartCanvas,t=e.getContext("2d");e.width=85,e.height=85;const n=e.width/2,s=e.height/2,o=this.outerradius,i=o/4;t.clearRect(0,0,e.width,e.height);const a=this.getColors([this.RCA,this.LAD,this.LCX]),r=[1,1,1],l=r.reduce((u,d)=>u+d,0);let c=0;r.forEach((u,d)=>{const h=u/l*Math.PI*2,v=c+h;t.beginPath(),t.moveTo(n+o*Math.cos(c),s+o*Math.sin(c)),t.arc(n,s,o,c,v),t.arc(n,s,i,v,c,!0),t.closePath(),t.fillStyle=a[d],t.fill(),t.lineWidth=.5,t.strokeStyle="black",t.stroke(),c=v}),t.beginPath(),t.arc(n,s,o,0,Math.PI*2),t.strokeStyle="#00000",t.lineWidth=0,t.stroke(),t.beginPath(),t.arc(n,s,i,0,Math.PI*2),t.strokeStyle="#00000",t.lineWidth=0,t.stroke()},numberToColorGradient(e){let t=e;t=t.toString().replace(/%/g,"");const n=[{color:[1,25,242],minPercentage:0,maxPercentage:.23},{color:[0,227,252],minPercentage:.23,maxPercentage:.45},{color:[44,246,91],minPercentage:.45,maxPercentage:.6},{color:[252,208,13],minPercentage:.6,maxPercentage:.75},{color:[255,16,1],minPercentage:.75,maxPercentage:1}];t=Math.min(Math.max(Number(t),-20),20);const s=(t+20)/40;let o,i;for(let u=0;u<n.length;u++)if(s>=n[u].minPercentage&&s<=n[u].maxPercentage){o=n[u],i=n[u+1];break}i||(o=n[n.length-2],i=n[n.length-1]);const a=(s-o.minPercentage)/(i.maxPercentage-o.minPercentage),r=Math.round(o.color[0]+a*(i.color[0]-o.color[0])),l=Math.round(o.color[1]+a*(i.color[1]-o.color[1])),c=Math.round(o.color[2]+a*(i.color[2]-o.color[2]));return`rgb(${r}, ${l}, ${c})`},getColors(e){return[this.numberToColorGradient(e[0]),this.numberToColorGradient(e[1]),this.numberToColorGradient(e[2])]}}},F1={style:{position:"relative"}},N1={ref:"chartCanvas"},$1={style:{position:"absolute",color:"rgb(255, 255, 255)",top:"10px",left:"14px",width:"38px",height:"20px","text-align":"center"}},U1={style:{position:"absolute",color:"rgb(255, 255, 255)",top:"55px",left:"12px",width:"38px",height:"20px","text-align":"center"}},H1={style:{position:"absolute",color:"rgb(255, 255, 255)",top:"32px",left:"52px",width:"35px",height:"20px","text-align":"center"}};function W1(e,t,n,s,o,i){return R(),E("div",F1,[g("canvas",N1,null,512),g("div",$1,[g("h5",null,U(o.LAD),1)]),g("div",U1,[g("h5",null,U(o.RCA),1)]),g("div",H1,[g("h5",null,U(o.LCX),1)])])}const z1=A(A1,[["render",W1],["__scopeId","data-v-4c39254e"]]);const j1={props:{id:{type:String,required:!0},propValue:{type:String,required:!0,default:"00"},editable:{type:Boolean,default:!0}},data(){return{editing:0,editedValue:this.propValue}},methods:{stopEditing(){this.$emit("updateValue",this.id,this.editedValue)},updateProp(e){this.editedValue=e.target.value}},watch:{editable(){this.$refs.inputField.readOnly=!this.editable}},mounted(){this.editable||(this.$refs.inputField.readOnly=!0)}},G1=["value"];function X1(e,t,n,s,o,i){return R(),E("input",{value:n.propValue,onInput:t[0]||(t[0]=(...a)=>i.updateProp&&i.updateProp(...a)),onBlur:t[1]||(t[1]=(...a)=>i.stopEditing&&i.stopEditing(...a)),ref:"inputField",class:N({edit:n.editable})},null,42,G1)}const q1=A(j1,[["render",X1],["__scopeId","data-v-e918b819"]]);const K1={props:{id:{type:String,required:!0},propValue:{type:String,required:!0,default:"00"},placeholder:{type:String,default:""},editable:{type:Boolean,default:!0}},data(){return{editing:0,editedValue:this.propValue}},methods:{stopEditing(){this.$emit("updateValue",this.id,this.editedValue)},updateProp(e){this.editedValue=e.target.value}},mounted(){this.editable||(this.$refs.inputField.readOnly=!0)},watch:{editable(){this.$refs.inputField.readOnly=!this.editable}}},Y1=["value","placeholder"];function Q1(e,t,n,s,o,i){return R(),E("textarea",{value:n.propValue,onInput:t[0]||(t[0]=(...a)=>i.updateProp&&i.updateProp(...a)),onBlur:t[1]||(t[1]=(...a)=>i.stopEditing&&i.stopEditing(...a)),ref:"inputField",class:N({edit:n.editable,noedit:!n.editable}),placeholder:n.placeholder,"aria-labelledby":"textAreaInReportEditable"},null,42,Y1)}const Z1=A(K1,[["render",Q1],["__scopeId","data-v-ab34c9dc"]]);const J1={components:{ReportLogoHolder:l1,ReportDropDown:v1,ReportImageContainer:B1,ReportStrainMaps:z1,ReportTextBox:q1,ReportTextBoxMultiple:Z1},props:{editable:{type:Boolean,required:!0,default:!0}},data(){return{genderOptions:[{value:"Female",label:"Female"},{value:"Male",label:"Male"},{value:"Other",label:"Other"}],completeDataOptions:[{value:"Yes",label:"Yes"},{value:"No",label:"No"}],imageQualityOptions:[{value:"Excellent",label:"Excellent"},{value:"Good",label:"Good"},{value:"OK",label:"OK"},{value:"Bad",label:"Bad"}],OS_REPORT_VALUES:{reportTitle:"BE-OS CMR Report",reportLogo:null,patientName:"PATIENT NAME",patientGender:"",patientAge:"00",patientDOB:"DD-Mon-YYYY",patientID:"123 456 789",rbhNumber:"000 000 000",protocol:"OS C-",scanDate:"DD-Mon-YYYY",scanTime:"00:00",completeData:"",imageQuality:"",reader:"Reader Name, MD",verifier:"Verifier Name, MD",scannerSystem:"Philips Ingenia",fieldStrength:"1.5T",softwareVersion:"5.7.1.3",starClaimer:"*Normal values are continuously being updated, therefore, may be subject to changes",summary:"",heartRateBaseline:"00",heartRateHV:"00",heartRateBH:"00",dtheartrate:"00",dtheartrateNormalRange:">15",vascularGlobal:"00",vascularLAD:"00",vascularLCX:"00",vascularRCA:"00",normalRangeVascular:">9.1",strainLADBaseline:"00",strainLADHV:"00",strainLADBH:"00",strainLCXBaseline:"00",strainLCXHV:"00",strainLCXBH:"00",strainRCABaseline:"00",strainRCAHV:"00",strainRCABH:"00",strainGLOBALBaseline:"00",strainGLOBALHV:"00",strainGLOBALBH:"00",vascularImage:"",strainImage:"",oxygenSensitiveMap:"",strainMapImage:"",strainMapBaseline:"",strainMapHV:"",strainMapBH:"",normalRange:"<-20%"}}},methods:{onOptionSelected(e,t){this.OS_REPORT_VALUES[e]=t},handleLogoUpdate(e){this.OS_REPORT_VALUES.reportLogo=e},handleUpdateValues(e,t){this.OS_REPORT_VALUES[e]=t},downloadReport(){this.buildPDF()},async getImage(e){await this.$refs[e].captureScreenshot()},async getImages(){await this.getImage("strainImage"),await this.getImage("vascularImage"),await this.getImage("oxygenSensitiveMap"),await this.captureScreenshot("strainMapImage","territorymapimg"),await this.captureScreenshot("reportLogo","reportLogo")},async captureScreenshot(e,t){const n=this.$refs[t];fi(n,{logging:!1,scale:3}).then(s=>{const o=s.toDataURL("image/png");this.handleImageScreenshot(e,o)}).catch(s=>{console.error("Error capturing screenshot:",s)})},handleImageScreenshot(e,t){this.OS_REPORT_VALUES[e]=t},buildPDF(){const e=this.OS_REPORT_VALUES;window.jsPDF=window.jspdf.jsPDF;const t=Ks("p","pt",[612,792]);t.addFont("/fonts/Roboto-Light.ttf","Roboto","normal"),t.addFont("/fonts/arial_italic.ttf","Arial","normal"),t.addFont("/fonts/arial_greek.ttf","ArialGreek","normal"),t.setFont("helvetica","bold"),t.setFontSize(22),t.text(e.reportTitle,42,60),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Patient",42,80),e.reportLogo!=null&&t.addImage(e.reportLogo,"PNG",413,25,150,52.5),t.setFontSize(15),t.setTextColor("#229ED7"),t.text(e.patientName,42,97),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Gender:",43,114),t.setFontSize(10),t.setTextColor("#000917"),t.text(e.patientGender,81,114),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Age:",164,114),t.setFontSize(10),t.setTextColor("#000917"),t.text(e.patientAge,187,114),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("DOB:",269,114),t.setFontSize(10),t.setTextColor("#000917"),t.text(e.patientDOB,294,114),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Patient ID:",410,114),t.setFontSize(10),t.setTextColor("#000917"),t.text(e.patientID,460,114),t.setLineWidth(.1),t.line(577,120,35,122),t.setFontSize(10),t.setTextColor("#5E5D6C"),t.text("Exam",42,148),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("RBH number:",42,162),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.rbhNumber,42,175),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Protocol:",42,189),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.protocol,42,202),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Date:",42,216),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.scanDate,42,229),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Time:",42,243),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.scanTime,42,256),t.setFontSize(10),t.setTextColor("#5E5D6C"),t.text("Scan",42,293),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Complete Data:",42,307),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.completeData,42,320),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Image Quality:",42,334),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.imageQuality,42,347),t.setFontSize(10),t.setTextColor("#5E5D6C"),t.text("Analytical Team",42,383),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Reader:",42,397),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.reader,42,410),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Verified By:",42,424),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.verifier,42,437),t.setFontSize(10),t.setTextColor("#5E5D6C"),t.text("Scanner",42,473),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("System:",42,487),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.scannerSystem,42,500),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Field Strength:",42,514),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.fieldStrength,42,527),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Software Version:",42,541),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.softwareVersion,42,554),t.setTextColor("#5E5D6C"),t.setFont("helvetica","normal"),t.setFont("Arial"),this.processSentences(e.starClaimer,120,t,42,594),t.text("For research use only.",42,760),t.setFont("helvetica","bold"),t.setFontSize(12),t.setTextColor("#5E5D6C"),t.text("SUMMARY",170,148),t.setFillColor("#f8f8f8"),t.setDrawColor(255,255,255),t.roundedRect(166,155,425,110,10,10,"FD"),t.setFontSize(9),t.setTextColor("#000917"),this.processSentences(e.summary,380,t,178,170),t.setFillColor("#f8f8f8"),t.setDrawColor(255,255,255),t.roundedRect(166,270,425,500,10,10,"FD"),t.setFillColor("#e0e0e0"),t.setDrawColor(255,255,255),t.roundedRect(176,275,405,55,5,5,"FD"),t.setFontSize(10),t.setTextColor("#000917"),t.text("Heart Rate",186,305),t.text("Normal Range",186,320),t.text(e.heartRateBaseline,286,305),t.text(e.heartRateHV,379,305),t.text(e.heartRateBH,440,305),t.text(e.dtheartrate,520,305),t.text(e.dtheartrateNormalRange,520,320),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("BASELINE",286,290),t.text("HV",379,290),t.text("BH @ 30 SEC",440,290),t.setFont("helvetica","normal"),t.setFont("ArialGreek"),t.text("Δ",520,290),t.setFont("helvetica","bold"),t.text("HR",530,290),t.setFillColor("#e0e0e0"),t.setDrawColor(255,255,255),t.roundedRect(176,350,200,75,5,5,"FD"),t.roundedRect(381,350,200,75,5,5,"FD"),t.setFontSize(12),t.text("VASCULAR",180,345),t.text("STRAIN",385,345),t.setFontSize(8),t.text("B-MORE",185,365),t.setTextColor("#000917"),t.setFontSize(9),t.text("Global",185,380),t.text("LAD",185,392),t.text("LCX",185,404),t.text("RCA",185,415),t.text(e.vascularGlobal,230,380),t.text("*Normal Range: ",260,380),t.text(e.normalRangeVascular,330,380),t.text(e.vascularLAD,230,392),t.text(e.vascularLCX,230,404),t.text(e.vascularRCA,230,415),t.setFontSize(8),t.setTextColor("#5E5D6C"),t.text("B-MORE",390,365),t.text("BASELINE",435,365),t.text("HV",485,365),t.text("BH @ 30 SEC",522,365),t.setFontSize(9),t.setTextColor("#000917"),t.text("Global",390,380),t.text("LAD",390,392),t.text("LCX",390,404),t.text("RCA",390,415),t.text(e.strainGLOBALBaseline,435,380),t.text(e.strainGLOBALHV,485,380),t.text(e.strainGLOBALBH,523,380),t.text(e.strainLADBaseline,435,392),t.text(e.strainLADHV,485,392),t.text(e.strainLADBH,523,392),t.text(e.strainLCXBaseline,435,404),t.text(e.strainLCXHV,485,404),t.text(e.strainLCXBH,523,404),t.text(e.strainRCABaseline,435,415),t.text(e.strainRCAHV,485,415),t.text(e.strainRCABH,523,415),t.roundedRect(176,430,200,187.5,0,0,"FD"),t.roundedRect(381,430,200,187.5,0,0,"FD"),t.setFontSize(12),t.setTextColor("#000917"),t.text("Oxygen Sensitive Map",210,635),t.text("STRAIN MAPS",382,635),t.setFontSize(8),t.setTextColor("#5E5D6C"),t.text("BASELINE",390,753),t.text("HYPER-",467,748),t.text("VENTILATION",455,758),t.text("BREATH-",535,743),t.text("HOLD",540,753),t.text("(30 sec)",537,763),t.setFillColor("#e0e0e0"),t.setDrawColor(255,255,255),t.roundedRect(375,715,75,25,7,7,"FD"),t.setFontSize(9),t.setTextColor("#000917"),t.text("Normal Range: ",380,724.5),t.text(e.normalRange,380,734.5),t.addImage(e.strainImage,"PNG",381,430,200,187.5),t.addImage(e.vascularImage,"PNG",176,430,200,187.5),t.addImage(e.oxygenSensitiveMap,"PNG",201,650,150,112.5),t.addImage(e.strainMapImage,"PNG",376,645,210,70);const n=new Date().toLocaleDateString("en-US");t.save(`Area19_Report_${e.patientName}_${n}.pdf`)},processSentences(e,t,n,s,o){function i(u){const d=document.createElement("span");d.style.font="10px Arial",d.style.position="absolute",d.style.visibility="hidden",d.textContent=u,document.body.appendChild(d);const{width:h}=d.getBoundingClientRect();return document.body.removeChild(d),h}let a=e.trim().split(new RegExp("(?<=[.!?])|\\n"));a=a.map(u=>u.replace(/\n/g,""));function r(u,d){const h=u.split(" "),v=[];let f=h[0];for(let p=1;p<h.length;p++){const m=`${f} ${h[p]}`;i(m)<=d?f=m:(v.push(f),f=h[p])}return v.push(f),v}let l=0,c=o;a.forEach(u=>{i(u)>t?r(u,t).forEach(h=>{l>0&&(c+=14),n.text(h,s,c),l++}):(l>0&&(c+=14),n.text(u,s,c),l++)})}},watch:{OS_REPORT_VALUES:{handler(){window.localStorage.setItem("reportValues",JSON.stringify(this.OS_REPORT_VALUES))},deep:!0},editable(){this.editable||this.getImages()}}},q=e=>(ae("data-v-d503f07e"),e=e(),se(),e),ey={class:"print-area"},ty={id:"report-element",class:"report-element"},ny={class:"row1"},oy={ref:"reportLogo"},iy={class:"row2"},ay=q(()=>g("h5",null,"Patient",-1)),sy={class:"row3",style:{"border-bottom":"1px solid black"}},ry={id:"gender",style:{display:"flex",gap:"5px"}},ly=q(()=>g("h5",null,"Gender:",-1)),cy={class:"below"},uy={class:"left-column"},dy={class:"Exam"},hy=q(()=>g("h4",{style:{"margin-bottom":"5px"}},"Exam",-1)),gy=q(()=>g("h5",{style:{height:"15px"}},"RBH number:",-1)),fy=q(()=>g("h5",{style:{height:"15px"}},"Protocol:",-1)),py=q(()=>g("h5",{style:{height:"15px"}},"Date:",-1)),my=q(()=>g("h5",{style:{height:"15px"}},"Time:",-1)),vy={class:"Scan"},yy=q(()=>g("h4",{style:{"margin-bottom":"5px"}},"Scan",-1)),wy=q(()=>g("h5",null,"Complete Data:",-1)),Sy=q(()=>g("h5",null,"Image Quality:",-1)),_y={class:"Technologist"},Cy=q(()=>g("h4",{style:{"margin-bottom":"10px"}},"Analytical Team",-1)),by=q(()=>g("h5",{style:{height:"15px"}},"Reader:",-1)),Ty=q(()=>g("h5",{style:{height:"15px"}},"Verified by:",-1)),Iy={class:"Scanner"},Ry=q(()=>g("h4",{style:{"margin-bottom":"10px"}},"Scanner",-1)),xy=q(()=>g("h5",{style:{height:"15px"}},"System:",-1)),Dy=q(()=>g("h5",{style:{height:"15px"}},"Field Strength:",-1)),Ey=q(()=>g("h5",{style:{height:"15px"}},"Software Version:",-1)),Ly={class:"Scanner"},Oy=q(()=>g("div",null,[g("h5",{style:{width:"150px","font-style":"italic"}}," For research use only. ")],-1)),Py={class:"right-column"},Vy={class:"summary"},ky=q(()=>g("h4",{style:{height:"15px"}},"SUMMARY",-1)),My={class:"detailed-report"},By={class:"overview"},Ay=q(()=>g("div",{class:"labels"},[g("br"),g("h5",{style:{width:"120px"}},"Heart Rate"),g("h5",{style:{width:"120px"}},"Normal Range")],-1)),Fy={class:"baselinevals"},Ny=q(()=>g("h5",{style:{color:"#5e5d6c"}},"BASELINE",-1)),$y={class:"hyperventvals"},Uy=q(()=>g("h5",{style:{color:"#5e5d6c"}},"HV",-1)),Hy={class:"BHvals"},Wy=q(()=>g("h5",{style:{color:"#5e5d6c",width:"90px"}},"BH @ 30 SEC",-1)),zy={class:"baselinevals"},jy=q(()=>g("h5",{style:{color:"#5e5d6c"}},"Δ HR",-1)),Gy={class:"overview_middle"},Xy={class:"col"},qy=q(()=>g("h4",null,"VASCULAR",-1)),Ky={class:"vals"},Yy={class:"valuesOCG",style:{"padding-left":"10px","padding-top":"10px"}},Qy=q(()=>g("h6",{style:{"margin-bottom":"10px","padding-left":"5px"}}," B-MORE ",-1)),Zy={style:{display:"flex",position:"relative"}},Jy={style:{position:"absolute",left:"80px",width:"190px"}},ew={style:{"margin-left":"25px"}},tw={class:"col",style:{"margin-left":"2%"}},nw=q(()=>g("h4",null,"STRAIN",-1)),ow={class:"vals"},iw={class:"valuesSTRAIN"},aw=q(()=>g("div",{class:"strain-containter"},[g("h6",null,"B-MORE"),g("h5",null,"Global"),g("h5",null,"LAD"),g("h5",null,"LCX"),g("h5",null,"RCA")],-1)),sw={class:"strain-containter"},rw=q(()=>g("h6",null,"BASELINE",-1)),lw={class:"strain-containter"},cw=q(()=>g("h6",{style:{"padding-left":"8%"}},"HV",-1)),uw={class:"strain-containter"},dw=q(()=>g("h6",null,"BH @ 30 SEC",-1)),hw={class:"overview_graphs"},gw={style:{display:"flex","flex-direction":"column","align-items":"center",width:"278px"}},fw=q(()=>g("h4",{style:{color:"black"}},"Oxygen Sensitive Map",-1)),pw={class:"strainmaps"},mw=q(()=>g("h4",{style:{color:"black"}},"STRAIN MAPS",-1)),vw={class:"territorymaps",ref:"territorymapimg"},yw={style:{"margin-right":"auto","background-color":"#8f8f8f3b",width:"90px",padding:"2px","padding-left":"5px","border-radius":"10px"}},ww=q(()=>g("div",{class:"mapnames"},[g("h5",null,"BASELINE"),g("h5",null,"HYPER-VENTILATION"),g("h5",null,[H(" BREATH-HOLD "),g("br"),H(" (30 sec) ")])],-1));function Sw(e,t,n,s,o,i){const a=V("ReportTextBox"),r=V("ReportLogoHolder"),l=V("ReportDropDown"),c=V("ReportTextBoxMultiple"),u=V("ReportImageContainer"),d=V("ReportStrainMaps");return R(),E("div",ey,[g("div",ty,[g("div",ny,[y(a,{id:"reportTitle",editable:n.editable,propValue:o.OS_REPORT_VALUES.reportTitle,onUpdateValue:i.handleUpdateValues,style:{width:"450px",color:"#000000","font-weight":"bold","font-size":"30px",height:"40px",padding:"0%"}},null,8,["editable","propValue","onUpdateValue"]),g("div",oy,[y(r,{editable:n.editable,onImageUpdated:i.handleLogoUpdate},null,8,["editable","onImageUpdated"])],512)]),g("div",iy,[ay,y(a,{id:"patientName",editable:n.editable,propValue:o.OS_REPORT_VALUES.patientName,onUpdateValue:i.handleUpdateValues,style:{width:"650px",color:"#229ed7","font-weight":"500","font-size":"30px",height:"35px",padding:"0%"}},null,8,["editable","propValue","onUpdateValue"])]),g("div",sy,[g("div",ry,[ly,y(l,{editable:n.editable,id:"patientGender",options:o.genderOptions,onOptionSelected:i.onOptionSelected},null,8,["editable","options","onOptionSelected"])]),g("div",null,[g("h5",null,[H(" Age: "),y(a,{id:"patientAge",editable:n.editable,propValue:o.OS_REPORT_VALUES.patientAge,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"])])]),g("div",null,[g("h5",null,[H(" DOB: "),y(a,{id:"patientDOB",editable:n.editable,propValue:o.OS_REPORT_VALUES.patientDOB,onUpdateValue:i.handleUpdateValues,style:{width:"120px"}},null,8,["editable","propValue","onUpdateValue"])])]),g("div",null,[g("h5",null,[H(" Patient ID: "),y(a,{id:"patientID",editable:n.editable,propValue:o.OS_REPORT_VALUES.patientID,onUpdateValue:i.handleUpdateValues,style:{width:"110px"}},null,8,["editable","propValue","onUpdateValue"])])])]),g("div",cy,[g("div",uy,[g("div",dy,[hy,gy,y(a,{id:"rbhNumber",editable:n.editable,propValue:o.OS_REPORT_VALUES.rbhNumber,onUpdateValue:i.handleUpdateValues,style:{width:"110px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"]),fy,y(a,{id:"protocol",editable:n.editable,propValue:o.OS_REPORT_VALUES.protocol,onUpdateValue:i.handleUpdateValues,style:{width:"110px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"]),py,y(a,{id:"scanDate",editable:n.editable,propValue:o.OS_REPORT_VALUES.scanDate,onUpdateValue:i.handleUpdateValues,style:{width:"110px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"]),my,y(a,{id:"scanTime",editable:n.editable,propValue:o.OS_REPORT_VALUES.scanTime,onUpdateValue:i.handleUpdateValues,style:{width:"110px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"])]),g("div",vy,[yy,wy,y(l,{id:"completeData",editable:n.editable,options:o.completeDataOptions,onOptionSelected:i.onOptionSelected},null,8,["editable","options","onOptionSelected"]),Sy,y(l,{id:"imageQuality",editable:n.editable,options:o.imageQualityOptions,onOptionSelected:i.onOptionSelected},null,8,["editable","options","onOptionSelected"])]),g("div",_y,[Cy,by,y(a,{id:"reader",editable:n.editable,propValue:o.OS_REPORT_VALUES.reader,onUpdateValue:i.handleUpdateValues,style:{width:"150px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"]),Ty,y(a,{id:"verifier",editable:n.editable,propValue:o.OS_REPORT_VALUES.verifier,onUpdateValue:i.handleUpdateValues,style:{width:"150px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"])]),g("div",Iy,[Ry,xy,y(a,{id:"scannerSystem",editable:n.editable,propValue:o.OS_REPORT_VALUES.scannerSystem,onUpdateValue:i.handleUpdateValues,style:{width:"150px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"]),Dy,y(a,{id:"fieldStrength",editable:n.editable,propValue:o.OS_REPORT_VALUES.fieldStrength,onUpdateValue:i.handleUpdateValues,style:{width:"100px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"]),Ey,y(a,{id:"softwareVersion",editable:n.editable,propValue:o.OS_REPORT_VALUES.softwareVersion,onUpdateValue:i.handleUpdateValues,style:{width:"100px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"])]),g("div",Ly,[y(c,{id:"starClaimer",editable:n.editable,propValue:o.OS_REPORT_VALUES.starClaimer,onUpdateValue:i.handleUpdateValues,style:{width:"170px",height:"120px",padding:"0px","padding-top":"5px","font-style":"italic"}},null,8,["editable","propValue","onUpdateValue"])]),Oy]),g("div",Py,[g("div",Vy,[ky,y(c,{id:"summary",editable:n.editable,propValue:o.OS_REPORT_VALUES.summary,placeholder:"Type Summary Here...",onUpdateValue:i.handleUpdateValues,style:{width:"100%",padding:"10px 10px",height:"190px","font-size":"14px",color:"black","background-color":"#f8f8f8"}},null,8,["editable","propValue","onUpdateValue"])]),g("div",My,[g("div",By,[Ay,g("div",Fy,[Ny,y(a,{id:"heartRateBaseline",editable:n.editable,propValue:o.OS_REPORT_VALUES.heartRateBaseline,onUpdateValue:i.handleUpdateValues,style:{width:"60px","padding-left":"0px","font-size":"14px"}},null,8,["editable","propValue","onUpdateValue"])]),g("div",$y,[Uy,y(a,{id:"heartRateHV",editable:n.editable,propValue:o.OS_REPORT_VALUES.heartRateHV,onUpdateValue:i.handleUpdateValues,style:{width:"60px","padding-left":"0px","font-size":"14px"}},null,8,["editable","propValue","onUpdateValue"])]),g("div",Hy,[Wy,y(a,{id:"heartRateBH",editable:n.editable,propValue:o.OS_REPORT_VALUES.heartRateBH,onUpdateValue:i.handleUpdateValues,style:{width:"60px","padding-left":"0px","font-size":"14px"}},null,8,["editable","propValue","onUpdateValue"])]),g("div",zy,[jy,y(a,{id:"dtheartrate",editable:n.editable,propValue:o.OS_REPORT_VALUES.dtheartrate,onUpdateValue:i.handleUpdateValues,style:{width:"60px","padding-left":"0px","font-size":"14px"}},null,8,["editable","propValue","onUpdateValue"]),y(a,{id:"dtheartrateNormalRange",editable:n.editable,propValue:o.OS_REPORT_VALUES.dtheartrateNormalRange,onUpdateValue:i.handleUpdateValues,style:{width:"60px","padding-left":"0px","font-size":"14px"}},null,8,["editable","propValue","onUpdateValue"])])]),g("div",Gy,[g("div",Xy,[qy,g("div",Ky,[g("div",Yy,[Qy,g("div",Zy,[g("h5",null,[H(" Global "),y(a,{id:"vascularGlobal",editable:n.editable,propValue:o.OS_REPORT_VALUES.vascularGlobal,onUpdateValue:i.handleUpdateValues,style:{"margin-left":"12px","padding-left":"4%"}},null,8,["editable","propValue","onUpdateValue"])]),g("div",Jy,[g("h5",ew,[H(" *Normal Range: "),y(a,{id:"normalRangeVascular",editable:n.editable,propValue:o.OS_REPORT_VALUES.normalRangeVascular,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"])])])]),g("h5",null,[H(" LAD "),y(a,{id:"vascularLAD",editable:n.editable,propValue:o.OS_REPORT_VALUES.vascularLAD,onUpdateValue:i.handleUpdateValues,style:{"margin-left":"24.5px"}},null,8,["editable","propValue","onUpdateValue"])]),g("h5",null,[H(" LCX "),y(a,{id:"vascularLCX",editable:n.editable,propValue:o.OS_REPORT_VALUES.vascularLCX,onUpdateValue:i.handleUpdateValues,style:{"margin-left":"25.5px"}},null,8,["editable","propValue","onUpdateValue"])]),g("h5",null,[H(" RCA "),y(a,{id:"vascularRCA",editable:n.editable,propValue:o.OS_REPORT_VALUES.vascularRCA,onUpdateValue:i.handleUpdateValues,style:{"margin-left":"23px"}},null,8,["editable","propValue","onUpdateValue"])])])]),y(u,{id:"vascularImage",ref:"vascularImage",editable:n.editable,"add-bar":"./images/bar.png",onScreenshotCaptured:i.handleImageScreenshot},null,8,["editable","add-bar","onScreenshotCaptured"])]),g("div",tw,[nw,g("div",ow,[g("div",iw,[aw,g("div",sw,[rw,y(a,{id:"strainGLOBALBaseline",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainGLOBALBaseline,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),y(a,{id:"strainLADBaseline",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainLADBaseline,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),y(a,{id:"strainLCXBaseline",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainLCXBaseline,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),y(a,{id:"strainRCABaseline",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainRCABaseline,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"])]),g("div",lw,[cw,y(a,{id:"strainGLOBALHV",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainGLOBALHV,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),y(a,{id:"strainLADHV",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainLADHV,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),y(a,{id:"strainLCXHV",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainLCXHV,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),y(a,{id:"strainRCAHV",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainRCAHV,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"])]),g("div",uw,[dw,y(a,{id:"strainGLOBALBH",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainGLOBALBH,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),y(a,{id:"strainLADBH",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainLADBH,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),y(a,{id:"strainLCXBH",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainLCXBH,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),y(a,{id:"strainRCABH",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainRCABH,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"])])])]),y(u,{id:"strainImage",ref:"strainImage",editable:n.editable,onScreenshotCaptured:i.handleImageScreenshot},null,8,["editable","onScreenshotCaptured"])])]),g("div",hw,[g("div",gw,[fw,y(u,{id:"oxygenSensitiveMap",ref:"oxygenSensitiveMap",editable:n.editable,width:150,height:150,canvasText:"Upload OS-Map",onScreenshotCaptured:i.handleImageScreenshot},null,8,["editable","onScreenshotCaptured"])]),g("div",pw,[mw,g("div",vw,[y(d,{id:"strainMapBaseline",values:[o.OS_REPORT_VALUES.strainLADBaseline,o.OS_REPORT_VALUES.strainLCXBaseline,o.OS_REPORT_VALUES.strainRCABaseline]},null,8,["values"]),y(d,{id:"strainMapHV",values:[o.OS_REPORT_VALUES.strainLADHV,o.OS_REPORT_VALUES.strainLCXHV,o.OS_REPORT_VALUES.strainRCAHV]},null,8,["values"]),y(d,{id:"strainMapBH",values:[o.OS_REPORT_VALUES.strainLADBH,o.OS_REPORT_VALUES.strainLCXBH,o.OS_REPORT_VALUES.strainRCABH]},null,8,["values"])],512),g("div",null,[g("p",yw,[H(" Normal Range: "),y(a,{id:"normalRange",editable:n.editable,propValue:o.OS_REPORT_VALUES.normalRange,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"])])]),ww])])])])])])])}const _w=A(J1,[["render",Sw],["__scopeId","data-v-d503f07e"]]);const Cw={components:{Report:_w},methods:{printReport(){this.$refs.editablereport.buildPDF()},handleEdit(){this.edit=!this.edit},handleSave(){this.edit?(this.showPopup=!0,setTimeout(()=>{this.showPopup=!1},3e3)):this.$refs.editablereport.downloadReport()}},data(){return{edit:!0,showPopup:!1}}},tn=e=>(ae("data-v-d6cad36d"),e=e(),se(),e),bw={class:"reportcontainermain"},Tw={class:"reporthere"},Iw={class:"toolbar"},Rw=tn(()=>g("h1",null,"Edit",-1)),xw=[Rw],Dw=tn(()=>g("button",{class:"tool"},[g("h1",null,"Share")],-1)),Ew=tn(()=>g("h1",null,"Print",-1)),Lw=[Ew],Ow={style:{position:"relative"}},Pw=tn(()=>g("h1",null,"Save",-1)),Vw=[Pw],kw=tn(()=>g("h5",null,"Please stop editing first.",-1)),Mw=[kw];function Bw(e,t,n,s,o,i){const a=V("Report");return R(),E("div",bw,[g("div",Tw,[y(a,{ref:"editablereport",editable:o.edit},null,8,["editable"])]),g("div",Iw,[g("button",{class:N(["tool",{clicked:o.edit}]),onClick:t[0]||(t[0]=(...r)=>i.handleEdit&&i.handleEdit(...r))},xw,2),Dw,g("button",{class:"tool",onClick:t[1]||(t[1]=(...r)=>i.printReport&&i.printReport(...r))},Lw),g("div",Ow,[g("button",{class:"tool",onClick:t[2]||(t[2]=(...r)=>i.handleSave&&i.handleSave(...r))},Vw),g("div",{class:N(["popup",{show:o.showPopup}])},Mw,2)])])])}const Aw=A(Cw,[["render",Bw],["__scopeId","data-v-d6cad36d"]]);const Fw={props:{dataToGraph:{type:Array}},watch:{dataToGraph:{deep:!0,handler(){this.drawLines()}}},data(){return{canvasId:"myCanvas",minX:0,minY:0,maxX:15,maxY:1,unitsPerTickX:5,unitsPerTickY:.25,title:"Normalized SI (RV-LV)",padding:15,tickSize:.1,axisColor:"white",pointRadius:1,font:"10pt Arial",fontHeight:10,rangeX:null,rangeY:null,numXTicks:null,numYTicks:null,x:null,y:null,width:null,height:null,scaleX:null,scaleY:null,context:null,data:null}},methods:{drawSysDias(e,t){const n=e;n.save(),n.translate(this.x,this.y+this.height),n.font="12px Arial",n.fillStyle="white",n.fillText("Systole",0*this.scaleX,0-(this.height+this.padding));const s=n.createLinearGradient(t*this.scaleX,0,this.maxX*this.scaleX-50,0);s.addColorStop(0,"rgba(38, 151, 192, 0.25)"),s.addColorStop(1,"#686F7100"),n.fillStyle=s,n.fillRect(t*this.scaleX,0,this.maxX*this.scaleX,0-(this.height+2*this.padding)),n.strokeStyle="white",n.lineWidth=1,n.beginPath(),n.moveTo(t*this.scaleX,0),n.lineTo(t*this.scaleX,0-(this.height+2*this.padding)),n.stroke(),n.fillStyle="white",n.fillText("Diastole",t*this.scaleX+5,0-(this.height+this.padding)),n.restore()},getLongestValueWidth(e){let t=0;const n=e;n.font=this.font;for(let s=0;s<=this.numYTicks;s++){const o=this.maxY-s*this.unitsPerTickY;t=Math.max(t,n.measureText(o).width)}return t},drawXAxis(e){const t=e;t.save(),t.beginPath(),t.moveTo(this.x,this.y+this.height),t.strokeStyle=this.axisColor,t.lineWidth=1,t.stroke(),t.font=this.font,t.fillStyle="white",t.textAlign="center",t.textBaseline="middle";for(let n=-1;n<this.numXTicks;n++){const s=Math.round((n+1)*this.maxX/this.numXTicks);t.save(),t.translate((n+1)*this.width/this.numXTicks+this.x,this.y+this.height+this.padding),t.fillText(s,0,0),t.restore()}t.restore()},drawYAxis(e){const t=e;t.save(),t.save(),t.beginPath(),t.moveTo(this.x,this.y),t.strokeStyle=this.axisColor,t.stroke(),t.restore(),t.font=this.font,t.fillStyle="white",t.textAlign="right",t.textBaseline="middle";for(let n=0;n<=this.numYTicks;n++){const s=this.maxY-n*this.maxY/this.numYTicks;t.save(),t.translate(this.x-this.padding+5,n*this.height/this.numYTicks+this.y),t.fillText(s,0,0),t.restore()}t.restore()},drawLine(e,t,n,s){const o=e;o.save(),this.transformContext(o),o.lineWidth=s,o.strokeStyle=n,o.fillStyle=n,o.shadowBlur=10,o.shadowColor=n,o.beginPath(),o.moveTo(t[0].x*this.scaleX,t[0].y*this.scaleY);for(let i=0;i<t.length;i++){const a=t[i];o.lineTo(a.x*this.scaleX,a.y*this.scaleY),o.stroke(),o.closePath(),o.beginPath(),o.arc(a.x*this.scaleX,a.y*this.scaleY,this.pointRadius,0,2*Math.PI,!1),o.fill(),o.closePath(),o.beginPath(),o.moveTo(a.x*this.scaleX,a.y*this.scaleY)}o.restore()},transformContext(e){e.translate(this.x,this.y+this.height),e.scale(1,-1)},generateRandomData(e){const t=[];for(let n=0;n<=e;n++){const s=n*1,o=Math.random();t.push({x:s,y:o})}return t},drawLines(){const{context:e}=this;e.clearRect(0+this.padding,this.y-2*this.padding,this.width+4*this.padding,this.height+4*this.padding);const t=["#a2191a","#105a93","#1f7c55"];for(let n=0;n<this.dataToGraph.length;n++)this.dataToGraph[n]===1&&this.drawLine(e,this.data[n],t[n],2);this.drawSysDias(e,7.5),this.drawXAxis(e),this.drawYAxis(e)}},mounted(){const{canvas:e}=this.$refs,t=e.getContext("2d");this.x=this.getLongestValueWidth(t)+this.padding*2+25,this.context=t,this.y=this.padding*2,this.width=e.width-this.x-this.padding*2,this.height=e.height-this.y-this.padding-this.fontHeight,this.rangeX=this.maxX-this.minY,this.scaleX=this.width/this.rangeX,this.rangeY=this.maxY-this.minY,this.scaleY=this.height/this.rangeY,this.numXTicks=Math.round(this.rangeX/this.unitsPerTickX),this.numYTicks=Math.round(this.rangeY/this.unitsPerTickY),this.drawXAxis(t),this.drawYAxis(t),t.save(),t.translate(10,this.height/1.5),t.rotate(270*Math.PI/180),t.font="12px Arial",t.fillStyle="white",t.textAlign="center",t.textBaseline="middle",t.fillText(this.title,0,0),t.restore(),this.drawSysDias(t,7.5);const n=[this.generateRandomData(15),this.generateRandomData(15),this.generateRandomData(15)];this.data=n,this.drawLines()}},Nw={ref:"canvas",width:"411",height:"206",style:{}};function $w(e,t,n,s,o,i){return R(),E("div",null,[g("canvas",Nw,null,512)])}const Uw=A(Fw,[["render",$w],["__scopeId","data-v-01332437"]]),Hw={props:{id:{type:Number,required:!0}},data(){return{sectionOpacities:[.7,.7,.7],hoveredSection:-1,outerradius:60}},mounted(){this.createChart()},methods:{createChart(){const e=this.$refs.chartCanvas,t=e.getContext("2d"),n=e.width/2-85,s=e.height/2,o=this.outerradius,i=o/3;t.clearRect(0,0,e.width,e.height),e.addEventListener("click",this.handleChartClick),e.addEventListener("mousemove",this.handleChartHover),e.addEventListener("mouseleave",this.handleChartLeave),e.addEventListener("dblclick",this.handleChartDoubleClick);const a=["#a2191a","#105a93","#1f7c55"],r=[1,1,1],l=r.reduce((u,d)=>u+d,0);let c=0;r.forEach((u,d)=>{const h=u/l*Math.PI*2,v=c+h;t.beginPath(),t.moveTo(n+o*Math.cos(c),s+o*Math.sin(c)),t.arc(n,s,o,c,v),t.arc(n,s,i,v,c,!0),t.closePath();const f=this.hoveredSection===d?this.sectionOpacities[d]+.3:this.sectionOpacities[d];t.globalAlpha=f,t.fillStyle=a[d],t.fill(),t.globalAlpha=1,t.strokeStyle="#ffffff",t.lineWidth=2,t.stroke(),c=v}),t.beginPath(),t.arc(n,s,o,0,Math.PI*2),t.strokeStyle="#ffffff",t.lineWidth=1,t.stroke(),t.beginPath(),t.arc(n,s,i,0,Math.PI*2),t.strokeStyle="#ffffff",t.lineWidth=1,t.stroke()},handleChartClick(e){const t=this.$refs.chartCanvas,n=t.getBoundingClientRect(),s=e.clientX-n.left,o=e.clientY-n.top,i=t.width/2-85,a=t.height/2,r=this.outerradius,l=r/3,c=Math.sqrt((s-i)**2+(o-a)**2);if(c<l)this.sectionOpacities=[.7,.7,.7];else{if(c>=r)return;{const u=Math.atan2(o-a,s-i),d=u>=0?u:u+Math.PI*2,h=Math.floor(d/(Math.PI*2)*3);this.sectionOpacities[h]=this.sectionOpacities[h]===.7?.2:.7}}this.createChart(),this.$emit("segment-updated",this.id,this.sectionOpacities)},handleChartDoubleClick(e){const t=this.$refs.chartCanvas,n=t.getBoundingClientRect(),s=e.clientX-n.left,o=e.clientY-n.top,i=t.width/2-85,a=t.height/2,r=this.outerradius,l=r/3,c=Math.sqrt((s-i)**2+(o-a)**2);if(c<l)this.sectionOpacities=[.7,.7,.7];else{if(c>=r)return;{const u=Math.atan2(o-a,s-i),d=u>=0?u:u+Math.PI*2,h=Math.floor(d/(Math.PI*2)*3);this.sectionOpacities=[.2,.2,.2],this.sectionOpacities[h]=.7}}this.createChart(),this.$emit("segment-updated",this.id,this.sectionOpacities)},handleChartHover(e){const t=this.$refs.chartCanvas,n=t.getBoundingClientRect(),s=e.clientX-n.left,o=e.clientY-n.top,i=t.width/2-85,a=t.height/2,r=this.outerradius,l=r/3,c=Math.sqrt((s-i)**2+(o-a)**2);if(c<l)this.hoveredSection=-1;else if(c>=r){this.handleChartLeave();return}else{const u=Math.atan2(o-a,s-i),d=u>=0?u:u+Math.PI*2,h=Math.floor(d/(Math.PI*2)*3);this.hoveredSection=h}this.createChart()},handleChartLeave(){this.hoveredSection=-1,this.createChart()}}},Ww={ref:"chartCanvas"};function zw(e,t,n,s,o,i){return R(),E("div",null,[g("canvas",Ww,null,512)])}const jw=A(Hw,[["render",zw]]);const Gw={props:{label:{type:String,default:"Territory Min"},textOpacity:{type:Number,default:1}},updated(){},data(){return{setTextOpacity:this.textOpacity}},methods:{handleMouseEnter(){this.setTextOpacity+=.3},handleMouseLeave(){this.setTextOpacity-=.3},handleClick(){this.$emit("biomarker-click",this.label)}}};function Xw(e,t,n,s,o,i){return R(),E("div",null,[g("h4",{onMouseenter:t[0]||(t[0]=(...a)=>i.handleMouseEnter&&i.handleMouseEnter(...a)),onFocusin:t[1]||(t[1]=(...a)=>i.handleMouseEnter&&i.handleMouseEnter(...a)),onMouseleave:t[2]||(t[2]=(...a)=>i.handleMouseLeave&&i.handleMouseLeave(...a)),onFocusout:t[3]||(t[3]=(...a)=>i.handleMouseLeave&&i.handleMouseLeave(...a)),onClick:t[4]||(t[4]=(...a)=>i.handleClick&&i.handleClick(...a)),style:ne({opacity:o.setTextOpacity}),onKeydown:t[5]||(t[5]=nt(ue((...a)=>e.handleKeyDown&&e.handleKeyDown(...a),["prevent"]),["space"]))},U(n.label),37)])}const qw=A(Gw,[["render",Xw],["__scopeId","data-v-65722d25"]]);const Kw={components:{SimpleGraph:Uw,TerritoriesSegments:jw,GraphTerritories:qw},data(){return{canGraph:[{id:1,allowed:[1,1,1]},{id:2,allowed:[1,1,1]},{id:3,allowed:[1,1,1]}],itemHeight:510,showComponent:[1,1,1],territoryGraphs:[{id:1,title:"Territory Min",opacity:.3},{id:2,title:"Territory Absolute Velocity",opacity:.3},{id:3,title:"Territory Median",opacity:.3},{id:4,title:"Sector Median",opacity:.3},{id:5,title:"Sector Max",opacity:.3},{id:6,title:"Sector Min",opacity:.3}]}},methods:{handleSegmentUpdate(e,t){for(let n=0;n<3;n++)this.canGraph[e-1].allowed[n]=t[n]>.5},scrollX(e,t){const n=`scrollContainer${t}`;this.$refs[n].scrollLeft+=e.deltaY/10},handleToggleMarker(e){console.log(e),this.showComponent[e]=!1,this.showComponent[e]=!0}}},po=e=>(ae("data-v-e71c7254"),e=e(),se(),e),Yw={class:"biomarkerviewer"},Qw={class:"biomarkercomponent"},Zw={class:"graphs"},Jw=po(()=>g("div",{class:"headertitle"},[g("h2",null,"ANALYSIS")],-1)),eS={class:"content"},tS={class:"left"},nS={class:"right"},oS={key:0},iS={class:"biomarkercomponent"},aS={class:"graphs"},sS=po(()=>g("h2",null,"ANALYSIS",-1)),rS={class:"content"},lS={class:"left"},cS={class:"right"},uS={key:0},dS={class:"biomarkercomponent"},hS={class:"graphs"},gS=po(()=>g("h2",null,"ANALYSIS",-1)),fS={class:"content"},pS={class:"left"},mS={class:"right"},vS={key:0};function yS(e,t,n,s,o,i){const a=V("ScreenTemp"),r=V("GraphTerritories"),l=V("TerritoriesSegments"),c=V("SimpleGraph");return R(),E("div",Yw,[g("div",Qw,[g("div",{class:"screen1",style:ne({height:o.itemHeight+"px"})},[y(a)],4),g("div",Zw,[Jw,g("div",{class:"territoryGraphs",ref:"scrollContainer0",onMousewheel:t[1]||(t[1]=u=>i.scrollX(u,0))},[(R(!0),E(ie,null,Pe(o.territoryGraphs,u=>(R(),E("div",{key:u.id},[y(r,{id:u.id,label:u.title,textOpacity:u.opacity,onBiomarkerClick:t[0]||(t[0]=d=>i.handleToggleMarker(0))},null,8,["id","label","textOpacity"])]))),128))],544),g("div",eS,[g("div",tS,[y(l,{id:1,onSegmentUpdated:i.handleSegmentUpdate},null,8,["onSegmentUpdated"])]),g("div",nS,[y(Be,{name:"fade"},{default:x(()=>[o.showComponent[0]?(R(),E("div",oS,[y(c,{dataToGraph:o.canGraph[0].allowed},null,8,["dataToGraph"])])):j("",!0)]),_:1})])])])]),g("div",iS,[g("div",{class:"screen1",style:ne({height:o.itemHeight+"px"})},[y(a)],4),g("div",aS,[sS,g("div",{class:"territoryGraphs",ref:"scrollContainer1",onMousewheel:t[3]||(t[3]=u=>i.scrollX(u,1))},[(R(!0),E(ie,null,Pe(o.territoryGraphs,u=>(R(),E("div",{key:u.id},[y(r,{id:u.id,label:u.title,textOpacity:u.opacity,onBiomarkerClick:t[2]||(t[2]=d=>i.handleToggleMarker(1))},null,8,["id","label","textOpacity"])]))),128))],544),g("div",rS,[g("div",lS,[y(l,{id:2,onSegmentUpdated:i.handleSegmentUpdate},null,8,["onSegmentUpdated"])]),g("div",cS,[y(Be,{name:"fade"},{default:x(()=>[o.showComponent[1]?(R(),E("div",uS,[y(c,{dataToGraph:o.canGraph[1].allowed},null,8,["dataToGraph"])])):j("",!0)]),_:1})])])])]),g("div",dS,[g("div",{class:"screen1",style:ne({height:o.itemHeight+"px"})},[y(a)],4),g("div",hS,[gS,g("div",{class:"territoryGraphs",ref:"scrollContainer2",onMousewheel:t[5]||(t[5]=u=>i.scrollX(u,2))},[(R(!0),E(ie,null,Pe(o.territoryGraphs,u=>(R(),E("div",{key:u.id},[y(r,{label:u.title,textOpacity:u.opacity,onBiomarkerClick:t[4]||(t[4]=d=>i.handleToggleMarker(2))},null,8,["label","textOpacity"])]))),128))],544),g("div",fS,[g("div",pS,[y(l,{id:3,onSegmentUpdated:i.handleSegmentUpdate},null,8,["onSegmentUpdated"])]),g("div",mS,[y(Be,{name:"fade"},{default:x(()=>[o.showComponent[2]?(R(),E("div",vS,[y(c,{dataToGraph:o.canGraph[2].allowed},null,8,["dataToGraph"])])):j("",!0)]),_:1})])])])])])}const wS=A(Kw,[["render",yS],["__scopeId","data-v-e71c7254"]]);const SS={components:{PatientHeaderInfo:bv,AnalysisNavigationBar:Uv,VtkTwoView:os,QualityCheck:i1,ReportMaker:Aw,GraphicalAnalysis:wS},data(){return{container:"container",currentComponent:"QualityCheck"}},methods:{getTimeOfDay(){const e=new Date().getHours();return e>=5&&e<12?"Morning":e>=12&&e<18?"Afternoon":e>=18&&e<23?"Evening":"Day"},handleToolSelected(e){e==="ReportMaker"?this.currentComponent="ReportMaker":e==="QualityCheck"?this.currentComponent="QualityCheck":e==="GraphicalAnalysis"&&(this.currentComponent="GraphicalAnalysis"),window.localStorage.setItem("currentView",this.currentComponent)},handleUpdateQualityCheck(e){e?this.$refs.mainAnalysisComponent.toggleComponent("CheckContours"):this.$refs.mainAnalysisComponent.toggleComponent("CheckBreathingSplits")}},created(){this.timeofday=this.getTimeOfDay(),this.container=`${this.container} ${this.timeofday.toLowerCase()}`},mounted(){this.currentComponent=window.localStorage.getItem("currentView")}},rs=e=>(ae("data-v-4b2d42a2"),e=e(),se(),e),_S=rs(()=>g("div",{class:"mobile-overlay"},[g("div",{class:"warning"},[g("h2",null,[H(" It appears that you are trying to use our app on a screen size of less than 1200 px wide. "),g("br"),H(" Currently our app is limited to larger devices. Please try on a larger laptop. ")])])],-1)),CS={class:"body"},bS={class:"navigationBar"},TS={class:"header-main"},IS={class:"header"},RS={class:"main"},xS=rs(()=>g("h5",{style:{"margin-left":"auto",color:"grey"}}," Area 19 OCG Prototype V.0.1 ",-1));function DS(e,t,n,s,o,i){const a=V("AnalysisNavigationBar"),r=V("PatientHeaderInfo");return R(),E(ie,null,[_S,g("div",{class:N(o.container)},[g("div",CS,[g("div",bS,[y(a,{onToolSelected:i.handleToolSelected},null,8,["onToolSelected"])]),g("div",TS,[g("div",IS,[y(r,{activeComponent:o.currentComponent,onUpdatequalitycheck:i.handleUpdateQualityCheck},null,8,["activeComponent","onUpdatequalitycheck"])]),g("div",RS,[y(Be,{name:"fade"},{default:x(()=>[(R(),Y(gi(o.currentComponent),{ref:"mainAnalysisComponent"},null,512))]),_:1})]),xS])])],2)],64)}const ES=A(SS,[["render",DS],["__scopeId","data-v-4b2d42a2"]]),LS=[{path:"/",redirect:"/login"},{path:"/login",name:"Login",component:cc},{path:"/home",name:"Home",component:qm},{path:"/analysis",name:"Analysis",component:ES}],OS=Ys({history:Qs(),routes:LS});ql();qt.setResolveCoincidentTopologyToPolygonOffset();qt.setResolveCoincidentTopologyPolygonOffsetParameters(-3,-3);qt.setResolveCoincidentTopologyLineOffsetParameters(-3,-3);Li.setResolveCoincidentTopologyToPolygonOffset();Li.setResolveCoincidentTopologyPolygonOffsetParameters(1,1);fl(Un);const ls=Gr.newInstance({proxyConfiguration:Ol}),cs=new Oi;cs.initialize();const us=Zs();us.use(Gl({proxies:new Xl(ls),dicomIO:cs}));const ut=Js(Kr);Yl(ut);ut.provide("ProxyManager",ls);ut.use(us);ut.use(er);ut.use(ur);ut.use(tr,{smallLaptop:1200,mediumLaptop:1300,largerLaptop:1400,xLargeLaptop:1600,desktop:1900,_4K:2500});ut.use(OS).mount("#app");
//# sourceMappingURL=index-662afecc.js.map
