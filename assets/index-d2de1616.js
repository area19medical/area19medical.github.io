import{aw as X,aK as R,b0 as K,b1 as P,b2 as hi,b3 as Oo,b4 as Ye,b5 as Is,b6 as Rs,b7 as xs,b8 as gi,af as fi,A as pe,b9 as te,ba as Ds,bb as Es,aN as Ls,az as M,as as F,bc as Os,aL as E,bd as g,be as U,bf as H,aU as pt,bg as Fn,bh as N,bi as Pe,bj as oe,bk as le,bl as ce,bm as x,aO as ue,bn as Be,aD as y,bo as Ke,bp as C,bq as pi,ak as Le,a6 as mt,ao as I,br as It,bs as mi,bt as Vs,bu as Ps,bv as ks,bw as Ms,bx as Bs,an as ze,aI as As,aB as z,u as at,by as Pt,H as vi,bz as Me,bA as vt,E as Fs,n as Ns,Y as $s,I as Us,B as Hs,aj as Vo,bB as be,aE as Xt,aq as ae,aQ as ee,aC as Nn,aA as lt,bC as j,ap as fe,bD as ie,bE as tt,bF as At,bG as Ne,aH as we,aF as Ws,K as Gn,ay as Xn,bH as yi,aY as qn,bI as wi,bJ as zs,bK as js,bL as Gs,bM as Si,bN as Xs,V as qs,bO as Ys,bP as Ks,bQ as Qs,bR as Js,aG as Zs,bS as er,aZ as tr,bT as nr,aS as He,bU as or,bV as ir,bW as ar,bX as sr,bY as rr,aT as _i,bZ as Ci,b_ as lr,b$ as cr,c0 as ur,c1 as dr,c2 as hr,c3 as gr,c4 as fr}from"./vendor-48013226.js";import{_ as A,E as Yn,V as yt,a as bi,b as ft,c as dn,d as kt,e as Po,f as $n,g as Ti,h as Ii,i as qt,u as Kn,j as wt,k as ko,l as pr,m as mr,n as vr,o as yr,p as Ri,q as xi,r as ht,s as Mo,T as pn,t as Ft,v as Je,w as De,x as wr,y as Sr,z as _r,A as Vn,B as Cr,M as Bo,C as br}from"./vuetify-f7bbfc1e.js";import{v as Tr,a as Di,m as _,b as Ir,c as Rr,d as xr,I as Dr,e as Er,f as Lr,g as Or,h as Ee,i as Vr,j as Pr,k as kr,l as Mr,n as Ze,o as Br,p as Ar,C as Fr,q as Nr,D as $r,R as Ur,r as Qn,s as Ei,t as mn,u as je,w as hn,x as Li,y as Oi,z as Hr,A as Wr,V as Qe,B as zr,E as vn,_ as jr,F as Vi,G as Pi,H as Gr,J as Xr,K as yn,L as ki,M as qr,N as Mi,O as Yr,P as Yt,Q as Bi,S as Ao,T as Kr,U as Fo,W as No,X as Qr,Y as Jr,Z as Zr,$ as el,a0 as tl,a1 as nl,a2 as ol,a3 as il,a4 as Ai,a5 as al}from"./vtk.js-2c901129.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();const sl=X({name:"App",components:{}});function rl(e,t,n,a,o,i){const s=P("router-view");return R(),K(s)}const ll=A(sl,[["render",rl]]);function cl(e){const t=e.split(/\/+/g);return t.splice(-1,1),t.join("/")}function ul(e){return e.split(/\/+/g).at(-1)??e}function St(e){return e.replace(/\/+/g,"/").replace(/\/$/,"")}function _t(...e){return St(e.join("/"))}function Un(e){return e.replace(/\//g,"_")}function $o(e){return new File([e],Un(e.name))}class Fi{constructor(){this.webWorker=null,this.initializeCheck=null}async runTask(t,n,a,o){return hi(this.webWorker,t,n,o,a,_t("/","/itk/pipelines"),_t("/","/itk/pipeline.worker.js"))}async initialize(){return this.initializeCheck||(this.initializeCheck=new Promise((t,n)=>{this.runTask("dicom",[],[],[]).then(a=>{a.webWorker?this.webWorker=a.webWorker:n(new Error("Could not initialize webworker"))}).then(async()=>{try{await Oo(this.webWorker,new File([],""),null)}catch{}t()}).catch(n)})),this.initializeCheck}async categorizeFiles(t){await this.initialize();const n=await Promise.all(t.map(async(l,c)=>{const u=await l.arrayBuffer();return{type:Ye.BinaryFile,data:{path:c.toString(),data:new Uint8Array(u)}}})),a=["--action","categorize","--memory-io","0","--files",...n.map(l=>l.data.path)],o=[{type:Ye.TextStream}],i=await this.runTask("dicom",a,n,o),s=JSON.parse(i.outputs[0].data.data);return Object.fromEntries(Object.entries(s).map(([l,c])=>[l,c.map(u=>t[parseInt(u,10)])]))}async readTags(t,n){const a=n.map(s=>s.tag),i=(await Oo(this.webWorker,$o(t),a)).tags;return n.reduce((s,r)=>{const{tag:l,name:c}=r;return i.has(l)?{...s,[c]:i.get(l)}:s},{})}async getVolumeSlice(t,n=!1){await this.initialize();const a=await t.arrayBuffer(),o=[{type:Ye.BinaryFile,data:{path:Un(t.name),data:new Uint8Array(a)}}],i=["--action","getSliceImage","--thumbnail",n.toString(),"--file",Un(t.name),"--memory-io","0"],s=[{type:Ye.Image}];return(await this.runTask("dicom",i,o,s)).outputs[0].data}async resample(t,n){await this.initialize();const{size:a,spacing:o,origin:i,direction:s}=t,r=["--action","resample","0","--size",a.join(","),"--spacing",o.join(","),"--origin",i.join(","),"--direction",s.join(","),"--memory-io","0"],l=[{type:Ye.Image,data:n}],c=[{type:Ye.Image}];return(await this.runTask("dicom",r,l,c)).outputs[0].data}async buildImage(t){return await this.initialize(),(await Is(t.map(a=>$o(a)))).image}}const Nt={vti:"application/vnd.unknown.vti",vtp:"application/vnd.unknown.vtp",stl:"model/stl",dcm:"application/dicom",zip:"application/zip",json:"application/json",gipl:"application/vnd.unknown.gipl","gipl.gz":"application/vnd.unknown.gipl",hdf5:"application/x-hdf5",jpg:"image/jpeg",jpeg:"image/jpeg",lsm:"application/vnd.unknown.lsm",mnc:"application/vnd.unknown.minc","mnc.gz":"application/vnd.unknown.minc",mnc2:"application/vnd.unknown.minc",mgh:"application/vnd.unknown.mgh",mgz:"application/vnd.unknown.mgh","mgh.gz":"application/vnd.unknown.mgh",mha:"application/vnd.unknown.metaimage",mhd:"application/vnd.unknown.metaimage",mrc:"application/vnd.unknown.mrc",nia:"application/vnd.unknown.nifti-1",nii:"application/vnd.unknown.nifti-1","nii.gz":"application/vnd.unknown.nifti-1",hdr:"application/vnd.unknown.nifti-1",nrrd:"application/vnd.unknown.nrrd",nhdr:"application/vnd.unknown.nrrd",png:"image/png",pic:"application/vnd.unknown.biorad",tif:"image/tiff",tiff:"image/tiff",vtk:"application/vnd.unknown.vtk",isq:"application/vnd.unknown.scanco",fdf:"application/vnd.unknown.fdf"},Uo=new Set(Object.keys(Nt)),Ho=new Set(Object.values(Nt)),Ni=new Set(["application/zip"]),Wo=[{mime:"application/dicom",skip:128,header:Array.from("DICM").map(e=>e.charCodeAt(0))}],dl=512;function hl(e,t){if(t.length>e.length)return!1;for(let n=0;n<t.length;n+=1)if(t[n]!==e[n])return!1;return!0}async function gl(e){return new Promise(t=>{const n=e.slice(0,dl),a=new FileReader;a.onload=()=>{const o=new Uint8Array(a.result);for(let i=0;i<Wo.length;i+=1){const{mime:s,header:r,skip:l=0}=Wo[i];if(hl(o.slice(l),r)){t(s);return}}t(null)},a.readAsArrayBuffer(n)})}async function $i(e){const t=e.type.toLowerCase();if(Ho.has(t))return t;if(Uo.has(t))return Nt[t];const n=[...Uo].find(o=>e.name.toLowerCase().endsWith(`.${o}`));if(n)return Nt[n];const a=await gl(e);return a&&Ho.has(a)?a:null}async function fl(e){const t=await $i(e)??"";return new File([e],e.name,{type:t.toLowerCase()})}async function pl(e,t){return new Promise(n=>{const a=new globalThis.FileReader;if(a.onload=()=>n(a.result),t==="ArrayBuffer")a.readAsArrayBuffer(e);else if(t==="Text")a.readAsText(e);else throw new TypeError(`readAs${t} is not a function`)})}async function ml(e){return pl(e,"ArrayBuffer")}const Hn=new Map;function Ui(e){return e}function Hi(){let e=null,t=null;const n=i=>{e&&e(i)},a=i=>{t&&t(i)};return{promise:new Promise((i,s)=>{e=i,t=s}),resolve:n,reject:a}}function $t(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}function Wi(e,t,n){return Math.min(n,Math.max(t,e))}function zo(e,...t){return t.reduce((n,a)=>({...n,[a]:e[a]}),{})}function Kt(e,t){const n=[[],[]];return t.forEach(a=>{const o=e(a)?0:1;n[o].push(a)}),n}const vl=(e,t,n)=>(e in t||(t[e]=n),t[e]);function Jn(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function yl(e,t=Yn){const n=Math.round(e);return Math.abs(n-e)<=t?n:e}function wl(e){return e instanceof Error?e:new Error(JSON.stringify(e))}function Sl(e){if(!e)return"#ffffff";const t=document.createElement("canvas").getContext("2d");if(!t)throw new Error("Could not create canvas context");return t.fillStyle=e,t.fillStyle}class zi{constructor(t){this.msgID=0,this.worker=t,this.waiting={},this.worker.onmessage=this.handleMessage.bind(this)}postMessage(t,n=[]){const a={id:this.msgID,message:t},o=Hi();return this.waiting[a.id]=o,this.worker.postMessage(a,n),this.msgID+=1,o.promise}handleMessage(t){const{id:n,error:a,message:o}=t.data;if(n in this.waiting){const i=this.waiting[n];delete this.waiting[n],a?i.reject(new Error(a)):i.resolve(o)}}}const Zn=e=>async t=>{const a=await new zi(new Worker(new URL("/assets/async.reader.worker-f0ea3ad1.js",self.location),{type:"module"})).postMessage({file:t,readerName:e});if(a.status==="success")return Tr(a.obj);throw a.error},_l=e=>async t=>{const a=await new zi(new Worker(new URL("/assets/async.writer.worker-42a67950.js",self.location),{type:"module"})).postMessage({obj:t.getState(),writerName:e});if(a.status==="success")return a.data;throw a.error},Cl=Zn("stl"),ji=Zn("vti"),bl=Zn("vtp"),Tl=_l("vti"),Il=Array.from(new Set(Array.from(Rs.keys()).map(e=>Nt[e.toLowerCase()])));Di.setReadImageArrayBufferFromITK(xs);async function Rl(e){const t=await ml(e),n=Di.newInstance();n.setFileName(e.name);try{await n.parseAsArrayBuffer(t)}catch{throw new Error("Failed to parse file")}return n.getOutputData()}function xl(e){e.set("application/vnd.unknown.vti",ji),e.set("application/vnd.unknown.vtp",bl),e.set("model/stl",Cl),Il.forEach(t=>{e.set(t,Rl)})}function Gi(e,t){const n=_.debounce(t.renderWindow.render,5);e.resize=()=>{if(t.container){const s=t.container.getBoundingClientRect();if(s.width===s.height&&s.width===0)return;const r=window.devicePixelRatio||1,l=Math.max(10,Math.floor(r*s.width)),c=Math.max(10,Math.floor(r*s.height));t.renderWindow.getViews()[0].setSize(l,c),e.invokeResize({width:l,height:c}),e.render(!0)}},e.render=(s=!0)=>{t.orientationWidget.updateMarkerOrientation(),s?t.renderWindow.render():n()};let a=null;e.renderLater=()=>{a==null&&(a=setTimeout(()=>{e.render(),a=null},0))},e.removeAllRepresentations=()=>{t.representations.forEach(s=>t.renderer.removeViewProp(s)),t.representations.length=0},e.updateCamera=(s,r,l)=>{const c=gi(l);fi(c,c,s),t.camera.setFocalPoint(...l),t.camera.setPosition(...c),t.camera.setDirectionOfProjection(...s),t.camera.setViewUp(...r)};const{setContainer:o}=e;e.setContainer=s=>{o(s),t.cornerAnnotation.setContainer(null)};const{resetCamera:i}=e;e.resetCamera=(...s)=>{i(s),t.renderer.updateLightsGeometryToFollowCamera()}}function Dl(e,t){t.classHierarchy.push("vtkLPSView3DProxy"),Gi(e,t)}function Xi(e,t,n={}){Object.assign(t,n),Ir.extend(e,t,n),Dl(e,t)}const El=_.newInstance(Xi,"vtkLPSView3DProxy"),Ll={newInstance:El,extend:Xi};function Ol(e,t){t.classHierarchy.push("vtkLPSView2DProxy");const n={...e};Gi(e,t),e.bindRepresentationToManipulator=()=>{},e.resetCamera=(a=null)=>{t.renderer.resetCamera(a)},e.addRepresentation=a=>{a&&(t.representations.indexOf(a)===-1&&(t.representations.push(a),t.renderer.addViewProp(a)),a.setSlicingMode&&t.slicingMode&&a.setSlicingMode(t.slicingMode))},e.setSlicingMode=a=>{if(t.axis="IJK".indexOf(a),n.setSlicingMode(a)&&a){let o=t.representations.length;for(;o--;){const i=t.representations[o];i.setSlicingMode&&i.setSlicingMode(a)}}},e.resizeToFit=(a,o,i)=>{const[s,r]=t.renderWindow.getViews()[0].getSize();let l,c;a===0&&o===1?[,c,l]=i:a===0&&o===2?[,l,c]=i:a===1&&o===0?[c,,l]=i:a===1&&o===2?[l,,c]=i:a===2&&o===0?[c,l]=i:a===2&&o===1&&([l,c]=i);const u=s/r,d=l/c;let h=0;u>=d?h=c/2:h=l/2/u,t.camera.setParallelScale(h)}}const Vl={slicingMode:null};function qi(e,t,n={}){Object.assign(t,n,Vl),_.setGet(e,t,["slicingMode"]),Rr.extend(e,t,n),Ol(e,t)}const Pl=_.newInstance(qi,"vtkLPSView2DProxy"),kl={newInstance:Pl,extend:qi},Ml={X:"I",Y:"J",Z:"K",I:"I",J:"J",K:"K"};function Bl(e,t){t.classHierarchy.push("vtkIJKSliceRepresentationProxy");const n={...e};e.setSlicingMode=a=>n.setSlicingMode(Ml[a])}const Al={};function Yi(e,t,n={}){Object.assign(t,Al,n),xr.extend(e,t),_.proxyPropertyMapping(e,t,{opacity:{modelKey:"property",property:"opacity"}}),Bl(e,t)}const Fl=_.newInstance(Yi,"vtkIJKSliceRepresentationProxy"),Ki={newInstance:Fl,extend:Yi},{InterpolationType:Nl}=Dr;function $l(e,t){t.classHierarchy.push("vtkLabelMapSliceRepProxy");let n=null;t.property.setUseLookupTableScalarRange(!0),t.property.setInterpolationType(Nl.NEAREST),t.mapper.setRelativeCoincidentTopologyPolygonOffsetParameters(-2,-2);let a=null;function o(s){const r=s.getColorMap();if(r===a)return;a=r;const l=Er.newInstance(),c=Lr.newInstance();Object.keys(r).forEach(u=>{const d=Number(u);l.addRGBPoint(d,...r[u].slice(0,3).map(h=>h/255)),c.addPoint(d,r[u][3]/255)}),t.property.setRGBTransferFunction(l),t.property.setScalarOpacity(c)}function i(s){n&&(n.unsubscribe(),n=null),s&&(n=s.onModified(()=>o(s)),o(s))}e.setColorBy=()=>{},e.delete=_.chain(e.delete,()=>{n&&(n.unsubscribe(),n=null)}),t.sourceDependencies.push({setInputData:i})}const Ul={};function Qi(e,t,n={}){Object.assign(t,Ul,n),Ki.extend(e,t),$l(e,t)}const Hl=_.newInstance(Qi,"vtkLabelMapSliceRepProxy"),Wl={newInstance:Hl,extend:Qi};function qe(e,t=[],n=[],a={},o={}){return{class:e,options:{links:n,ui:t,...a},props:o}}function jo(e,t=[],n={}){return qe(e,[],[],t,n)}const zl={definitions:{Proxy:{LookupTable:qe(Or,[],[],{presetName:"Default (Cool to Warm)"}),PiecewiseFunction:qe(Ee)},Sources:{TrivialProducer:qe(Vr)},Representations:{ImageSlice:qe(Ki),LabelMapSlice:qe(Wl),Volume:qe(Pr),Geometry:qe(kr)},Views:{View3D:jo(Ll),View2D:jo(kl)}},representations:{View3D:{vtkImageData:{name:"Volume"},vtkPolyData:{name:"Geometry"}},View2D:{vtkImageData:{name:"ImageSlice"},vtkLabelMap:{name:"LabelMapSlice"}}}};function jl({stencil:e,location:t,slicingIndex:n,indexToWorld:a}){const[o,i]=e.size,s=Math.floor((o-1)/2),r=Math.floor((i-1)/2),l=o+1,c=i+1,u=[],d=[],h={},v=(f,m)=>{const w=`${f},${m}`;if(w in h)return h[w];const T=[...t].map(O=>Math.round(O));n===0?(T[1]+=f-s-.5,T[2]+=m-r-.5):n===1?(T[0]+=f-s-.5,T[2]+=m-r-.5):n===2&&(T[0]+=f-s-.5,T[1]+=m-r-.5);const S=[];pe(S,T,a),u.push(S);const b=u.length-1;return h[w]=b,b},p=(f,m)=>f<0||f>=o||m<0||m>=i?0:e.pixels[m*o+f]||0;for(let f=0;f<c;f++)for(let m=0;m<l;m++){const w=p(m,f)+p(m-1,f)+p(m,f-1)+p(m-1,f-1);if(w>0&&w<4){const T=v(m,f);if(p(m,f)!==p(m,f-1)){const S=v(m+1,f);d.push([T,S])}if(p(m,f)!==p(m-1,f)){const S=v(m,f+1);d.push([T,S])}}}return{points:new Float32Array(u.flat()),lines:new Uint16Array(d.map(([f,m])=>[2,f,m]).flat())}}function Gl(e,t){t.classHierarchy.push("vtkPaintBrushContextRepresentation"),t.internalPolyData=Ze.newInstance({mtime:0}),t.internalArrays={points:t.internalPolyData.getPoints(),lines:t.internalPolyData.getLines()},t.pipelines={brush:{source:e,mapper:Br.newInstance({transformCoordinate:Ar.newInstance({coordinateSystem:Fr.WORLD})}),actor:Nr.newInstance({pickable:!1,parentProp:e})}};const n=t.pipelines.brush.actor.getProperty();n.setLineWidth(2),n.setColor([1,0,0]),n.setDisplayLocation($r.FOREGROUND),n.setRepresentation(Ur.SURFACE),Qn.connectPipeline(t.pipelines.brush),e.addActor(t.pipelines.brush.actor),e.requestData=(a,o)=>{const i=a[0],s=i.getStencil(),r=i.getBrush(),{indexToWorld:l,worldToIndex:c}=t;if(s&&r.getOrigin()){const u=[];pe(u,r.getOrigin(),c);const d=jl({stencil:s,location:u,slicingIndex:t.slicingIndex,indexToWorld:l}),{points:h,lines:v}=t.internalArrays;h.setData(d.points),v.setData(d.lines),t.internalPolyData.modified()}o[0]=t.internalPolyData}}const Xl={defaultScale:1,drawBorder:!1,drawFace:!0,worldToIndex:null,indexToWorld:null,slicingIndex:0};function Ji(e,t,n={}){Object.assign(t,Xl,n),Mr.extend(e,t,n),_.setGet(e,t,["slicingIndex","indexToWorld","worldToIndex"]),_.get(e,t,["mapper","actor"]),Gl(e,t)}const ql=_.newInstance(Ji,"vtkPaintBrushContextRepresentation"),Yl={newInstance:ql,extend:Ji};function Pn(e){return e.altKey||e.controlKey||e.shiftKey}function Kl(e,t){t.classHierarchy.push("vtkPaintWidgetProp"),_.setGet(e,t,["manipulator"]);let n=!1;e.handleLeftButtonPress=a=>{if(!t.manipulator||Pn(a))return _.VOID;const o=t.manipulator.handleEvent(a,t._apiSpecificRenderWindow);return o?(t.widgetState.getBrush().setOrigin(...o),n=!0,e.invokeStartInteractionEvent(),_.EVENT_ABORT):_.VOID},e.handleMouseMove=a=>{if(Pn(a))return _.VOID;const o=t.manipulator.handleEvent(a,t._apiSpecificRenderWindow);return o?(t.widgetState.getBrush().setOrigin(...o),n&&e.invokeInteractionEvent(),_.EVENT_ABORT):_.VOID},e.handleLeftButtonRelease=a=>!n||Pn(a)?_.VOID:(n=!1,e.invokeEndInteractionEvent(),_.EVENT_ABORT),e.handleMouseWheel=()=>n?_.EVENT_ABORT:_.VOID,e.grabFocus=()=>{t.hasFocus||(t.hasFocus=!0,t._interactor.requestAnimation(e))},e.loseFocus=()=>{t.hasFocus&&t._interactor.cancelAnimation(e),t.hasFocus=!1}}function Ql(){return Ei.createBuilder().addStateFromMixin({labels:["brush"],name:"brush",mixins:["origin","scale1","visible","color"],initialValues:{scale1:1,origin:null,visible:!0}}).addField({name:"stencil",initialValue:null}).build()}function Jl(e,t){t.classHierarchy.push("vtkPaintWidget"),t.methodsToLink=["slicingIndex","indexToWorld","worldToIndex"],e.getRepresentationsForViewType=()=>[{builder:Yl,labels:["brush"]}],t.manipulator=je.newInstance()}const Zl={};function Zi(e,t,n={}){Object.assign(t,Zl,n),mn.extend(e,t,{...n,behavior:Kl,widgetState:Ql()}),_.get(e,t,["manipulator"]),Jl(e,t)}const ec=_.newInstance(Zi,"vtkPaintWidget"),tc={newInstance:ec,extend:Zi};function nc(e,t){const n=new Uint8Array(e*t),a=(m,w)=>{n[m+w*e]=1},o=(m,w,T)=>{const S=T*e+m,b=S+(w-m+1);n.fill(1,S,b)};let i=0,s=0,r=e-1,l=t-1,c=r,u=l;const d=u&1;let h=4*(1-c)*u*u,v=4*(d+1)*c*c,p=h+v+d*c*c,f=0;s+=Math.floor((u+1)/2),l=s-d,c*=8*c,u*=8*u;do o(i,r,s),o(i,r,l),f=2*p,f<=v&&(s++,l--,v+=c,p+=v),(f>=h||2*p>v)&&(i++,r--,h+=u,p+=h);while(i<=r);for(;s-l<t;)a(i-1,s),a(r+1,s++),a(i-1,l),a(r+1,l--);return n}class oc{constructor(){this.size=1,this.scale=[1,1],this.recomputeStencil()}setSize(t){this.size=Math.max(0,t),this.recomputeStencil()}setScale(t){this.scale=t,this.recomputeStencil()}recomputeStencil(){const t=[Math.ceil(this.size*this.scale[0]),Math.ceil(this.size*this.scale[1])];this.cachedStencil={size:t,pixels:nc(t[0],t[1])}}getStencil(){return this.cachedStencil}}let ic=class{constructor(){this.factory=tc.newInstance(),this.brush=new oc,this.brushValue=1}updateWidgetStencil(){const t=this.brush.getStencil();this.factory.getWidgetState().setStencil(t)}setBrushSize(t){this.brush.setSize(t),this.updateWidgetStencil()}setBrushScale(t){this.brush.setScale(t),this.updateWidgetStencil()}setBrushValue(t){this.brushValue=t}paintLabelmap(t,n,a,o){const i=this.brush.getStencil(),s=[...a.map(D=>Math.round(D))],r=s[n];s.splice(n,1);let l=[...s];o&&(l=[...o.map(D=>Math.round(D))],l.splice(n,1));const c=t.getPointData().getScalars().getData(),u=t.getDimensions(),d=u[0],h=u[0]*u[1],v=D=>D[0]>=0&&D[1]>=0&&D[2]>=0&&D[0]<u[0]&&D[1]<u[1]&&D[2]<u[2],{pixels:p,size:f}=i,m=Math.floor((f[0]-1)/2),w=Math.floor((f[1]-1)/2),T=[...s],S=[...l],b=[0,0,0],O=[0,0];for(let D=0;D<f[1];D++){const k=D-w,L=D*f[0];for(let $=0;$<f[0];$++){const Y=$-m,J=L+$;if(p[J]){T[0]=s[0]+Y,T[1]=s[1]+k,S[0]=l[0]+Y,S[1]=l[1]+k;const B=S[0]-T[0],W=S[1]-T[1];let Z=Math.abs(Math.abs(B)>Math.abs(W)?B:W);const Ce=B/Z,me=W/Z;for([O[0],O[1]]=T;Z-->=0;){if(O.splice(n,0,r),b[0]=Math.round(O[0]),b[1]=Math.round(O[1]),b[2]=Math.round(O[2]),v(b)){const Ge=b[0]+b[1]*d+b[2]*h;c[Ge]=this.brushValue}O.splice(n,1),O[0]+=Ce,O[1]+=me}}}}t.modified()}};function ac({paint:e,proxies:t,dicomIO:n}={}){const a={$paint:e??new ic,$proxies:t,$dicomIO:n??new Fi};return()=>a}var ea=(e=>(e.Volume="View3D",e.Slice="View2D",e))(ea||{});class sc{constructor(t){this.viewProxies=new Map,this.dataProxies=new Map,this.proxyManager=t}delete(){const t=n=>this.proxyManager.deleteProxy(n);this.viewProxies.forEach(t),this.dataProxies.forEach(t)}createView(t,n){if(this.viewProxies.has(t))throw new Error("Cannot create a view with the same ID");const a=this.proxyManager.createProxy("Views",n,{name:n});return this.viewProxies.set(t,a),a}getView(t){return this.viewProxies.get(t)}removeView(t){const n=this.viewProxies.get(t);n&&(this.proxyManager.deleteProxy(n),this.viewProxies.delete(t))}addData(t,n){if(this.dataProxies.has(t))return;const a=this.proxyManager.createProxy("Sources","TrivialProducer");a.setInputData(n),this.dataProxies.set(t,a)}getData(t){return this.dataProxies.get(t)??null}updateData(t,n){const a=this.dataProxies.get(t);a&&a.setInputData(n)}deleteData(t){const n=this.dataProxies.get(t);if(this.dataProxies.delete(t),n)this.proxyManager.deleteProxy(n);else throw new Error("Did not find proxy for ID")}getDataRepresentationForView(t,n){const a=this.dataProxies.get(t),o=this.viewProxies.get(n);return!a||!o?null:this.proxyManager.getRepresentation(a,o)}}function rc(){const{exitPointerLock:e}=document;document.exitPointerLock=()=>{try{e==null||e.call(document)}catch{}}}const{VITE_SENTRY_DSN:ta}={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},na="error-reporting-off",lc=!!ta,cc=e=>{localStorage.getItem(na)!=="true"&&lc&&Ds({app:e,dsn:ta,integrations:[new Es],tracesSampleRate:.1,replaysSessionSampleRate:.1,replaysOnErrorSampleRate:1})},uc=()=>{Os(200)};te("error-reporting",()=>{const e=Ls(na,"false"),t=M(e.value==="true");return F(t,()=>{e.value=String(t.value),t.value&&uc()}),{disableReporting:t}});const Go=[{username:"Mitchel",password:"12345"},{username:"Glisant",password:"12345"},{username:"admin",password:"admin123"}];const dc={data(){return{timeofday:"Day",container:"container",invalidLogin:!1,loaded:!1}},created(){this.timeofday=this.getTimeOfDay(),this.container=`${this.container} ${this.timeofday.toLowerCase()}`,window.localStorage.setItem("userLoggedIn","GUEST USER")},mounted(){setTimeout(()=>{this.loaded=!0},100)},methods:{getTimeOfDay(){const e=new Date().getHours();return e>=5&&e<12?"Morning":e>=12&&e<18?"Afternoon":e>=18&&e<23?"Evening":"Day"},login(e){e.preventDefault(),Go.find(n=>n.username===this.username&&n.password===this.password)?(window.localStorage.setItem("userLoggedIn",this.username),this.$router.push("/home")):this.invalidLogin=!0},signup(e){e.preventDefault();const t={username:this.username,password:this.password};Go.push(t),this.$router.push("/home")}}},Qt=e=>(le("data-v-4ccf444f"),e=e(),ce(),e),hc=Qt(()=>g("h4",null,"Sign into your account",-1)),gc={for:"username"},fc=Qt(()=>g("p",null,"Username not found",-1)),pc=[fc],mc={for:"password"},vc=Qt(()=>g("p",null,"Invalid Password",-1)),yc=[vc],wc=Qt(()=>g("button",{type:"submit",style:{"align-self":"center"}},"Log In",-1)),Sc=Qt(()=>g("h4",{style:{"margin-top":"40px"}},"Don't have an account?",-1));function _c(e,t,n,a,o,i){return R(),E("div",{class:N(o.container)},[g("div",{class:N(["login-form",{loaded:o.loaded}])},[g("h2",null,"Good "+U(o.timeofday),1),hc,g("form",{onSubmit:t[4]||(t[4]=(...s)=>i.login&&i.login(...s))},[g("label",gc,[H("User name "),pt(g("input",{type:"text",id:"username","onUpdate:modelValue":t[0]||(t[0]=s=>e.username=s),required:""},null,512),[[Fn,e.username]])]),g("div",{class:N(["invalidLogin",{view:o.invalidLogin}])},pc,2),g("label",mc,[H("Password "),pt(g("input",{type:"password",id:"password","onUpdate:modelValue":t[1]||(t[1]=s=>e.password=s),required:""},null,512),[[Fn,e.password]])]),g("div",{class:N(["invalidLogin",{view:o.invalidLogin}])},yc,2),wc,Sc,g("h4",{onClick:t[2]||(t[2]=(...s)=>i.signup&&i.signup(...s)),onKeydown:t[3]||(t[3]=Pe(oe((...s)=>e.handleKeyDown&&e.handleKeyDown(...s),["prevent"]),["space"])),style:{color:"#0085ff"},class:"sign-up-b"}," Try as Guest ",32)],32)],2)],2)}const Cc=A(dc,[["render",_c],["__scopeId","data-v-4ccf444f"]]);const bc={props:{username:String},methods:{getTimeOfDay(){const e=new Date().getHours();return e>=5&&e<12?"Morning":e>=12&&e<18?"Afternoon":e>=18&&e<23?"Evening":"Night"}},data(){return{timeofday:"Day"}},created(){this.timeofday=this.getTimeOfDay()}},Tc={class:"greeting"};function Ic(e,t,n,a,o,i){return R(),E("div",Tc,[g("h2",null,"Good "+U(o.timeofday)+",",1),g("h1",null,U(n.username),1)])}const Rc=A(bc,[["render",Ic],["__scopeId","data-v-91098397"]]);const xc={props:{patient:Object},methods:{updatepatient(e){window.localStorage.setItem("currentPatient",JSON.stringify(e))}},data(){return{isHovered:!1,currentPatient:""}}};function Dc(e,t,n,a,o,i){const s=P("router-link");return R(),K(s,{to:"/analysis",style:{"text-decoration":"none"}},{default:x(()=>[g("div",{class:"patient",onMouseover:t[0]||(t[0]=r=>o.isHovered=!0),onFocusin:t[1]||(t[1]=r=>o.isHovered=!0),onClick:t[2]||(t[2]=r=>i.updatepatient(n.patient)),onKeydown:t[3]||(t[3]=Pe(oe((...r)=>e.handleKeyDown&&e.handleKeyDown(...r),["prevent"]),["space"])),onMouseout:t[4]||(t[4]=r=>o.isHovered=!1),onFocusout:t[5]||(t[5]=r=>o.isHovered=!1)},[g("h3",{class:N({hovered:o.isHovered})},U(n.patient.name),3),g("h3",{class:N({hovered:o.isHovered})},U(n.patient.lastname),3),g("h3",{class:N({hovered:o.isHovered})},U(n.patient.dob),3),g("h3",{class:N({hovered:o.isHovered})},U(n.patient.gender),3),g("h3",{class:N({hovered:o.isHovered})},U(n.patient.scandate),3),g("h3",{class:N({hovered:o.isHovered})},U(n.patient.scanlocation),3)],32)]),_:1})}const Ec=A(xc,[["render",Dc],["__scopeId","data-v-1d35c230"]]);const Lc={},Oc={class:"loading-container"},Vc=g("div",{class:"loading-spinner"},null,-1),Pc=g("p",{class:"loading-text"},"Loading...",-1),kc=[Vc,Pc];function Mc(e,t){return R(),E("div",Oc,kc)}const oa=A(Lc,[["render",Mc]]);const Bc={props:{patients:{type:Array}},data(){return{filter:"",loaded:!1}},computed:{filteredPatients(){const e=this.filter.toLowerCase().replace(/\s/g,"");return e===""?this.patients:this.patients.filter(t=>t.name.toLowerCase().includes(e)||t.lastname.toLowerCase().includes(e)||t.scanlocation.toLowerCase().includes(e))}},methods:{},components:{PatientElement:Ec,LoadingScreen:oa},mounted(){setTimeout(()=>{this.loaded=!0},600)}},Ac=e=>(le("data-v-84376fbc"),e=e(),ce(),e),Fc=Ac(()=>g("div",{class:"patient-header"},[g("h3",null,"Last Name"),g("h3",null,"First Name"),g("h3",null,"Date of Birth"),g("h3",null,"Gender"),g("h3",null,"Scan Date"),g("h3",null,"Scan Location")],-1)),Nc={key:0,class:"patient-container"},$c={key:1};function Uc(e,t,n,a,o,i){const s=P("PatientElement"),r=P("LoadingScreen");return R(),E(ue,null,[Fc,o.loaded?(R(),E("div",Nc,[(R(!0),E(ue,null,Be(i.filteredPatients,l=>(R(),E("div",{key:l.id},[y(s,{patient:l},null,8,["patient"])]))),128))])):(R(),E("div",$c,[y(r)]))],64)}const Hc=A(Bc,[["render",Uc],["__scopeId","data-v-84376fbc"]]),Xo=0,Ct=te("id",()=>{let e=Xo;return{nextId(){return String(++e)},reset(){e=Xo}}}),eo=["Sagittal","Coronal","Axial"];function gt(){return{Sagittal:0,Coronal:0,Axial:0}}function ia(){return{Sagittal:[0,0],Coronal:[0,0],Axial:[0,0]}}function We(e,t,n){const a=2*n[t];return e.slice(a,a+2)}function Te(e){switch(e){case"Superior":case"Inferior":return"Axial";case"Left":case"Right":return"Sagittal";case"Posterior":case"Anterior":return"Coronal";default:throw new Error(`Invalid LPS direction: ${e}`)}}const aa=()=>({Left:Ke(1,0,0),Right:Ke(-1,0,0),Posterior:Ke(0,1,0),Anterior:Ke(0,-1,0),Superior:Ke(0,0,1),Inferior:Ke(0,0,-1),Sagittal:0,Coronal:1,Axial:2});function sa(e){const t=[0,1,2],n=[0,1,2],a=aa();for(let o=0;o<3;o++){let i=0,s=[0,0],r=[0,0];t.forEach((p,f)=>{n.forEach((m,w)=>{const T=e[p*3+m];Math.abs(T)>Math.abs(i)&&(i=T,s=[p,m],r=[f,w])})});const[l,c]=s,u=e.slice(l*3,(l+1)*3),d=Math.sign(i),h=u.map(p=>p*d),v=u.map(p=>p*-d);c===0?(a.Left=h,a.Right=v,a.Sagittal=l):c===1?(a.Posterior=h,a.Anterior=v,a.Coronal=l):c===2&&(a.Superior=h,a.Inferior=v,a.Axial=l),t.splice(r[0],1),n.splice(r[1],1)}return a}var ne=(e=>(e.WindowLevel="WindowLevel",e.Pan="Pan",e.Zoom="Zoom",e.Ruler="Ruler",e.Paint="Paint",e.Rectangle="Rectangle",e.Crosshairs="Crosshairs",e.Crop="Crop",e.Contour="Contour",e))(ne||{}),xe=(e=>(e.V="V",e.H="H",e))(xe||{}),wn=(e=>(e.DICOM="dicom",e.IMAGE="image",e))(wn||{});const Wc=C.nativeEnum(wn),zc=C.union([C.literal("Left"),C.literal("Right"),C.literal("Posterior"),C.literal("Anterior"),C.literal("Superior"),C.literal("Inferior")]),jc=C.object({id:C.string(),path:C.string(),type:Wc}),Gc=C.object({archiveSrc:C.object({path:C.string()}).optional(),uriSrc:C.object({uri:C.string(),name:C.string()}).optional()}),ra=Gc.extend({parent:C.lazy(()=>ra.optional())}),Xc=C.nativeEnum(xe),la=C.lazy(()=>C.object({name:C.string().optional(),direction:Xc,items:C.array(C.union([la,C.string()]))})),Ue=C.tuple([C.number(),C.number(),C.number()]),qc=C.object({width:C.number(),level:C.number(),min:C.number(),max:C.number()}),Yc=C.object({slice:C.number(),min:C.number(),max:C.number(),axisDirection:zc}),Kc=C.object({parallelScale:C.number().optional(),position:Ue.optional(),focalPoint:Ue.optional(),directionOfProjection:Ue.optional(),viewUp:Ue.optional()}),to=C.object({arrayName:C.string(),location:C.string()}),Qc=C.object({position:C.number(),height:C.number(),width:C.number(),xBias:C.number(),yBias:C.number()}),Jc=C.object({x:C.number(),y:C.number(),midpoint:C.number(),sharpness:C.number()}),Zc=C.object({mode:C.literal(Ee.Mode.Gaussians),gaussians:Qc.array(),mappingRange:C.tuple([C.number(),C.number()])}),eu=C.object({mode:C.literal(Ee.Mode.Points),preset:C.string(),shift:C.number(),mappingRange:C.tuple([C.number(),C.number()])}),tu=C.object({mode:C.literal(Ee.Mode.Nodes),nodes:Jc.array(),mappingRange:C.tuple([C.number(),C.number()])}),no=C.union([Zc,eu,tu]),oo=C.object({preset:C.string(),mappingRange:C.tuple([C.number(),C.number()])});C.object({colorBy:to,transferFunction:oo,opacityFunction:no});const nu=C.object({enabled:C.boolean(),lightFollowsCamera:C.boolean(),volumeQuality:C.number(),useVolumetricScatteringBlending:C.boolean(),volumetricScatteringBlending:C.number(),useLocalAmbientOcclusion:C.boolean(),laoKernelSize:C.number(),laoKernelRadius:C.number(),ambient:C.number(),diffuse:C.number(),specular:C.number()}),ou=C.object({colorBy:to,transferFunction:oo,opacityFunction:no,cvr:nu}),iu=C.object({opacity:C.number()}),au=C.object({colorBy:to,transferFunction:oo,opacityFunction:no,blendConfig:iu}),su=C.object({window:qc.optional(),slice:Yc.optional(),layers:au.optional(),camera:Kc.optional(),volumeColorConfig:ou.optional()}),ru=C.union([C.literal("2D"),C.literal("3D")]),lu=C.object({id:C.string(),type:ru,props:C.record(C.any()),config:C.record(su)}),cu=C.object({id:C.string(),parent:C.string(),path:C.string()});C.union([C.literal("Axial"),C.literal("Sagittal"),C.literal("Coronal")]);const uu=C.object({planeOrigin:Ue,planeNormal:Ue}),du=C.object({imageID:C.string(),frameOfReference:uu,slice:C.number(),id:C.string(),name:C.string(),color:C.string(),label:C.string().optional(),labelName:C.string().optional()}),ca=e=>C.object({tools:C.array(e),labels:C.record(e.partial())}),ua=du.extend({firstPoint:Ue,secondPoint:Ue}),hu=ca(ua),gu=ua.extend({id:C.string(),fillColor:C.string().optional()}),fu=ca(gu),pu=C.object({position:Ue}),mu=C.nativeEnum(ne),vu=C.object({activeLabelmapID:C.string().nullable(),brushSize:C.number(),brushValue:C.number(),labelmapOpacity:C.number()}),yu=C.object({Sagittal:C.tuple([C.number(),C.number()]),Coronal:C.tuple([C.number(),C.number()]),Axial:C.tuple([C.number(),C.number()])}),wu=C.record(yu),Su=C.object({rulers:hu.optional(),rectangles:fu.optional(),crosshairs:pu,paint:vu,crop:wu,current:mu}),_u=C.object({selectionKey:C.string(),sourceSelectionKeys:C.string().array()}).array(),Cu=C.object({version:C.string(),datasets:jc.array(),remoteFiles:C.record(ra.array()),labelMaps:cu.array(),tools:Su,views:lu.array(),primarySelection:C.string().optional(),layout:la,parentToLayers:_u}),io=e=>({fileSrc:{file:e,fileType:e.type}});function da(e){return!!e.uriSrc||!!e.parent&&da(e.parent)}function ha(e){var t;if(e!=null&&e.fileSrc)return e.fileSrc.file.name;if(e!=null&&e.uriSrc)return e.uriSrc.name;if((t=e==null?void 0:e.dicomSrc)!=null&&t.sources.length){const{sources:n}=e.dicomSrc,[a]=n,o=n.length>1?` (+${n.length-1} more)`:"";return`${ha(a)}${o}`}return null}function ga(e){const t={...e};return delete t.fileSrc,t.parent&&(t.parent=ga(t.parent)),t}const st=te("files",{state:()=>({byDataID:{}}),getters:{getDataSources:e=>t=>e.byDataID[t]??[],getFiles:e=>t=>(e.byDataID[t]??[]).map(n=>n.fileSrc.file)},actions:{remove(e){e in this.byDataID&&delete this.byDataID[e]},add(e,t){this.byDataID[e]=t}}});async function fa(e,t,n){const a=st(),{zip:o}=e,{manifest:{datasets:i,remoteFiles:s}}=e;t.forEach(r=>{const l=a.getDataSources(r);if(!l.length)throw new Error(`No files for dataID: ${r}`);const[c,u]=Kt(da,l);s[r]=c.map(ga);const d=`data/${r}/`;u.forEach(h=>{const{file:v}=h.fileSrc,p=`${d}/${v.name}`;o.file(p,v)}),i.push({id:r,path:d,type:n})})}const pa=()=>({name:"(none)",orientation:pi(),lpsOrientation:aa(),spacing:Ke(1,1,1),origin:Le(),dimensions:Ke(1,1,1),worldBounds:[0,1,0,1,0,1],worldToIndex:mt(),indexToWorld:mt()}),Re=te("images",{state:()=>({idList:[],dataIndex:Object.create(null),metadata:Object.create(null)}),actions:{addVTKImageData(e,t){const n=Ct().nextId();return this.idList.push(n),this.dataIndex[n]=t,this.$proxies.addData(n,t),this.metadata[n]={...pa(),name:e},this.updateData(n,t),n},updateData(e,t){if(e in this.metadata){const n={name:this.metadata[e].name,dimensions:t.getDimensions(),spacing:t.getSpacing(),origin:t.getOrigin(),orientation:t.getDirection(),lpsOrientation:sa(t.getDirection()),worldBounds:t.getBounds(),worldToIndex:t.getWorldToIndex(),indexToWorld:t.getIndexToWorld()};this.metadata[e]=n}this.$proxies.updateData(e,t),this.dataIndex[e]=t},deleteData(e){e in this.dataIndex&&(delete this.dataIndex[e],delete this.metadata[e],$t(this.idList,e))},async serialize(e){const t=st(),n=this.idList.filter(a=>a in t.byDataID);await fa(e,n,wn.IMAGE)}}}),bu="Anonymous",Tu="ANONYMOUS";function Iu(e,t){return`${e}!!${t}`}const Ru=(e,t)=>e.readTags(t,[{name:"PatientName",tag:"0010|0010",strconv:!0},{name:"PatientID",tag:"0010|0020",strconv:!0},{name:"PatientBirthDate",tag:"0010|0030"},{name:"PatientSex",tag:"0010|0040"},{name:"StudyInstanceUID",tag:"0020|000d"},{name:"StudyDate",tag:"0008|0020"},{name:"StudyTime",tag:"0008|0030"},{name:"StudyID",tag:"0020|0010",strconv:!0},{name:"AccessionNumber",tag:"0008|0050"},{name:"StudyDescription",tag:"0008|1030",strconv:!0},{name:"Modality",tag:"0008|0060"},{name:"SeriesInstanceUID",tag:"0020|000e"},{name:"SeriesNumber",tag:"0020|0011"},{name:"SeriesDescription",tag:"0008|103e",strconv:!0}]),_e=te("dicom",{state:()=>({sliceData:{},volumeToImageID:{},imageIDToVolumeKey:{},patientInfo:{},patientStudies:{},studyInfo:{},studyVolumes:{},volumeInfo:{},volumeStudy:{},studyPatient:{},needsRebuild:{}}),actions:{async importFiles(e){if(!e.length)return[];const t=this.$dicomIO,n=new Map(e.map(s=>[s.fileSrc.file,s])),a=[...n.keys()],o=await t.categorizeFiles(a),i=st();return Object.entries(o).forEach(([s,r])=>{const l=r.map(c=>{const u=n.get(c);if(!u)throw new Error("Did not match File with source DataSource");return u});i.add(s,l)}),await Promise.all(Object.entries(o).map(async([s,r])=>{if(!(s in this.volumeInfo)){const l=await Ru(t,r[0]),c={PatientID:l.PatientID||Tu,PatientName:l.PatientName||bu,PatientBirthDate:l.PatientBirthDate||"",PatientSex:l.PatientSex||""},u=zo(l,"StudyID","StudyInstanceUID","StudyDate","StudyTime","AccessionNumber","StudyDescription"),d={...zo(l,"Modality","SeriesInstanceUID","SeriesNumber","SeriesDescription"),NumberOfSlices:r.length,VolumeID:s};this._updateDatabase(c,u,d)}s in this.volumeToImageID&&(this.needsRebuild[s]=!0)})),Object.keys(o)},_updateDatabase(e,t,n){const a=e.PatientID,o=t.StudyInstanceUID,i=n.VolumeID;a in this.patientInfo||(this.patientInfo[a]=e,this.patientStudies[a]=[]),o in this.studyInfo||(this.studyInfo[o]=t,this.studyVolumes[o]=[],this.studyPatient[o]=a,this.patientStudies[a].push(o)),i in this.volumeInfo||(this.volumeInfo[i]=n,this.volumeStudy[i]=o,this.sliceData[i]={},this.studyVolumes[o].push(i))},deleteVolume(e){const t=Re();if(e in this.volumeInfo){const n=this.volumeStudy[e];if(delete this.volumeInfo[e],delete this.sliceData[e],delete this.volumeStudy[e],e in this.volumeToImageID){const a=this.volumeToImageID[e];t.deleteData(a),delete this.volumeToImageID[e],delete this.imageIDToVolumeKey[a]}$t(this.studyVolumes[n],e),this.studyVolumes[n].length===0&&this.deleteStudy(n)}},deleteStudy(e){if(e in this.studyInfo){const t=this.studyPatient[e];delete this.studyInfo[e],delete this.studyPatient[e],[...this.studyVolumes[e]].forEach(n=>this.deleteVolume(n)),delete this.studyVolumes[e],$t(this.patientStudies[t],e),this.patientStudies[t].length===0&&this.deletePatient(t)}},deletePatient(e){e in this.patientInfo&&(delete this.patientInfo[e],[...this.patientStudies[e]].forEach(t=>this.deleteStudy(t)),delete this.patientStudies[e])},async serialize(e){const t=Object.keys(this.volumeInfo);await fa(e,t,wn.DICOM)},async deserialize(e){return this.importFiles(e).then(t=>{if(t.length!==1)throw new Error("Invalid state file.");return t[0]})},async getVolumeSlice(e,t,n=!1){const a=this.$dicomIO,o=st(),i=Iu(t,n);if(e in this.sliceData&&i in this.sliceData[e])return this.sliceData[e][i];if(!(e in this.volumeInfo))throw new Error(`Cannot find given volume key: ${e}`);const r=this.volumeInfo[e].NumberOfSlices;if(t<1||t>r)throw new Error(`Slice ${t} is out of bounds`);const l=o.getFiles(e);if(!l)throw new Error(`No files found for volume key: ${e}`);const c=l[t-1],u=await a.getVolumeSlice(c,n);return this.sliceData[e][i]=u,u},async getVolumeThumbnail(e){const{NumberOfSlices:t}=this.volumeInfo[e],n=Math.ceil(t/2);return this.getVolumeSlice(e,n,!0)},async buildVolume(e,t=!1){const n=Re(),a=this.$dicomIO;if(!(t||this.needsRebuild[e])&&this.volumeToImageID[e]){const c=this.volumeToImageID[e];return n.dataIndex[c]}const s=st().getFiles(e);if(!s)throw new Error("No files for volume key");const r=hn.convertItkToVtkImage(await a.buildImage(s)),l=this.volumeToImageID[e];if(l)n.updateData(l,r);else{const c=this.volumeInfo[e].SeriesInstanceUID,u=n.addVTKImageData(c,r);this.imageIDToVolumeKey[u]=e,this.volumeToImageID[e]=u}return delete this.needsRebuild[e],r}}}),ma=te("models",{state:()=>({idList:[],dataIndex:{},metadata:{}}),actions:{addVTKPolyData(e,t){const n=Ct().nextId();return this.idList.push(n),this.dataIndex[n]=t,this.$proxies.addData(n,t),n}}});var Wn=(e=>(e[e.Error=0]="Error",e[e.Warning=1]="Warning",e[e.Info=2]="Info",e[e.Success=3]="Success",e))(Wn||{});const Jt=te("message",{state:()=>({_nextID:1,byID:{},msgList:[]}),getters:{messages(){return this.msgList.map(e=>this.byID[e])},importantMessages(){return this.messages.filter(e=>e.type!==3)}},actions:{addError(e,t){return t instanceof Error?this._addMessage({type:0,title:e},{details:String(t),persist:!1}):this._addMessage({type:0,title:e},t)},addWarning(e,t){return this._addMessage({type:1,title:e},t)},addInfo(e,t){return this._addMessage({type:2,title:e},t)},addSuccess(e,t){return this._addMessage({type:3,title:e},t)},clearOne(e){e in this.byID&&($t(this.msgList,e),delete this.byID[e])},clearAll(){this.byID={},this.msgList=[]},_addMessage(e,t){const n=String(this._nextID++),a={persist:!1,...typeof t=="string"?{details:t}:t};return this.byID[n]={...e,options:a,id:n},this.msgList.push(n),n}}});async function ao(e,t){try{return await t()}catch(n){n instanceof Error&&Jt().addError(e,{details:`${n}. More details can be found in the developer's console.`}),console.error(n)}}const Ut=e=>({type:"dicom",volumeKey:e}),Ht=e=>({type:"image",dataID:e}),va=e=>{if(e.type==="image")return e.dataID;if(e.type==="dicom")return _e().volumeToImageID[e.volumeKey];const t=e;throw new Error(`invalid selection type ${t}`)},xu=async e=>{const t=Re(),n=_e();return e.type==="dicom"?(await ao("Failed to build volume",()=>n.buildVolume(e.volumeKey)),t.dataIndex[va(e)]):t.dataIndex[e.dataID]},ya=e=>_e().imageIDToVolumeKey[e]??e,wa=e=>_e().volumeToImageID[e]??e;function Du(e,t){return e.type==="dicom"&&t.type==="dicom"?e.volumeKey===t.volumeKey:e.type==="image"&&t.type==="image"?e.dataID===t.dataID:!1}const Rt=te("dataset",()=>{const e=Re(),t=ma(),n=_e(),a=st(),o=M(null),i=I(()=>{if(o.value)return va(o.value)}),s=I(()=>{const{dataIndex:d}=e;return i.value&&d[i.value]||null}),r=I(()=>[...e.idList,...t.idList]);function l(d){return this.$proxies.getData(d)}function c(d){o.value=d,d!==null&&d.type==="dicom"&&ao("Failed to build volume",()=>n.buildVolume(d.volumeKey))}async function u(d){if(await n.serialize(d),await e.serialize(d),o.value!==null){let h=null;o.value.type==="dicom"?h=o.value.volumeKey:h=o.value.dataID;const{manifest:v}=d;v.primarySelection=h}}return e.$onAction(({name:d,args:h,after:v})=>{d==="deleteData"&&v(()=>{const[p]=h,f=o.value;(f==null?void 0:f.type)==="image"&&f.dataID===p&&(o.value=null),a.remove(p)})}),n.$onAction(({name:d,args:h,after:v})=>{d==="deleteVolume"&&v(()=>{const[p]=h,f=o.value;(f==null?void 0:f.type)==="dicom"&&p===f.volumeKey&&(o.value=null),a.remove(p)})}),{primarySelection:o,primaryDataset:s,allDataIDs:r,getDataProxyByID:l,setPrimarySelection:c,serialize:u}});function Eu(e,t,n){return{message:e,inputDataStackTrace:[t],cause:n}}const kn=Symbol("DoneSentinel");class Sn{constructor(t){this.handlers=Array.from(t??[])}async execute(t,n){return this.startExecutionContext(t,n)}async startExecutionContext(t,n){const a=[...this.handlers],o=[],i=Hi(),s=(h,v)=>{v?i.reject(v):i.resolve(h)},r=async(h,v)=>{let p=!1,f;const m=v>=a.length,w={done:S=>{if(p)throw new Error("done() called twice!");return p=!0,f=S,kn},execute:async(S,b)=>{const O=this.execute(S,b??n);return o.push(O),O},extra:n};let T;m&&(T=kn);try{if(m)T=kn;else{const S=a[v];T=await S(h,w)}}catch(S){const b=S instanceof Error?S:new Error(S?String(S):"Unknown error occurred");s(void 0,b);return}if(p||m){s(f);return}r(T,v+1)},l={ok:!0,data:[],errors:[]};try{await r(t,0);const h=await i.promise;h!=null&&l.data.push(h)}catch(h){const v=h instanceof Error?h.message:String(h);l.ok=!1,l.errors.push(Eu(v,t,h))}const c=await Promise.all(o),[u,d]=Kt(h=>h.ok,c);return d.length>0&&(l.ok=!1),u.forEach(h=>{l.data.push(...h.data)}),d.forEach(h=>{const{errors:v}=h;v.forEach(p=>{p.inputDataStackTrace.push(t)}),l.errors.push(...v)}),l}}const Lu=(e,{extra:t,done:n})=>{const{fileSrc:a}=e;return t!=null&&t.dicomDataSources&&(a==null?void 0:a.fileType)==="application/dicom"?(t.dicomDataSources.push(e),n()):e},Ou={testURL:e=>{const{protocol:t}=new It(e,window.location.href);return t==="http:"||t==="https:"},fetchURL:async(e,t={})=>{var c;const{progress:n}=t,a=await fetch(e);if(a.status!==200)throw new Error(`Fetching resource failed (HTTP code ${a.status})`);if(!n)return a.blob();const o=Number(a.headers.get("content-length"))??-1;if(o<0)return n(1/0),a.blob();const i=(c=a.body)==null?void 0:c.getReader();if(!i)return null;const s=new Uint8Array(o);let r=0,l=!1;do{const u=await i.read();l=u.done,u.value&&!l&&(s.set(u.value,r),r+=u.value.length,n(r/o))}while(!l);return new Blob([s])}},so=[Ou];function Vu(e){return!!so.find(t=>t.testURL(e))}async function Pu(e,t,n){const a=so.find(s=>s.testURL(e));if(!a)throw new Error(`Cannot find a handler for URL: ${e}`);const o=n==null?void 0:n.cache;if(o!=null&&o.has(e))return o.get(e);const i=a.fetchURL(e,n).then(s=>{if(!s)throw new Error(`Failed to download ${e}`);return new File([s],t)});return i.catch(()=>{o==null||o.delete(e)}),o==null||o.set(e,i),i}async function ku(e,t){const n=so.find(s=>s.testURL(e));if(!n)throw new Error(`Cannot find a handler for URL: ${e}`);const a=await n.fetchURL(e,t);if(!a)throw new Error(`Failed to download ${e}`);const o=await a.arrayBuffer(),i=new TextDecoder;return JSON.parse(i.decode(new Uint8Array(o)))}const Sa=async(e,{execute:t,done:n,extra:a})=>{const{fileSrc:o,uriSrc:i}=e;if(!o&&i&&Vu(i.uri))try{const s=await Pu(i.uri,i.name,{cache:a==null?void 0:a.fetchFileCache});return t({...e,fileSrc:{file:s,fileType:""}}),n()}catch(s){throw new Error(`Could not download URL ${i.uri}`,{cause:s instanceof Error?s:void 0})}return e};async function ro(e){const t=await mi.loadAsync(e),n=[],a=[];return t.forEach((o,i)=>{if(!i.dir){const s=ul(i.name),r=cl(i.name),l=t.file(i.name);l&&(n.push(l.async("blob").then(c=>new File([c],s))),a.push(r))}}),Promise.all(n).then(o=>o.map((i,s)=>({file:i,archivePath:a[s]})))}function _a(e){return!!e.fileSrc&&Ni.has(e.fileSrc.fileType)}const Mu=async(e,{execute:t,done:n})=>_a(e)?((await ro(e.fileSrc.file)).forEach(o=>{t({fileSrc:{file:o.file,fileType:""},archiveSrc:{path:`${o.archivePath}/${o.file.name}`},parent:e})}),n()):e;async function Bu(e,t){let n=t==null?void 0:t.get(e);return n||(n=ro(e).then(a=>a.reduce((o,i)=>{const s=_t(i.archivePath,i.file.name);return Object.assign(o,{[s]:i.file})},{})),t&&t.set(e,n),n)}const Ca=async(e,{extra:t,execute:n,done:a})=>{const{fileSrc:o,archiveSrc:i,parent:s}=e,{archiveCache:r}=t??{};if(!o&&i&&s){if(!(s!=null&&s.fileSrc))throw new Error("Cannot extract an archive target with an unresolved parent");if(!_a(s))throw new Error("Parent is not a supported archive file");const l=await Bu(s.fileSrc.file,r),c=St(i.path),u=l[c];if(!u)throw new Error(`Failed to find archive member ${c}`);return n({...e,fileSrc:{file:u,fileType:""}}),a()}return e},Au=e=>new It(e).protocol==="s3:";function Fu(e,t){return`https://${e}.s3.amazonaws.com/${t}`}async function Nu(e,t,n=()=>{}){const a=new Vs({region:"us-east-1",signer:{sign:async i=>i}}),o=async i=>{const s=new Ps({Bucket:e,Prefix:t,ContinuationToken:i,MaxKeys:1e3});let r;try{r=await a.send(s)}catch(l){throw console.error(l),l}if(!r.Contents)throw new Error("S3 returned no objects");r.Contents.forEach(l=>{if(!l.Key)return;const c=l.Key,u=Fu(e,l.Key);n(c,u)}),r.IsTruncated&&r.NextContinuationToken&&await o(r.NextContinuationToken)};await o()}const $u=e=>{const{hostname:t,pathname:n}=new It(e),a=n.replace(/^\//,"");return[t,a]},Uu=async(e,t=()=>{})=>{const[n,a]=$u(e);await Nu(n,a,t)},Hu=async(e,{execute:t,done:n})=>{const{uriSrc:a}=e;if(a&&Au(a.uri))try{return await Uu(a.uri,(o,i)=>{t({uriSrc:{uri:i,name:o},parent:e})}),n()}catch(o){throw new Error(`Could not download S3 URI ${a.uri}`,{cause:o instanceof Error?o:void 0})}return e},Wu=e=>new It(e).protocol==="gs:",zu=e=>{const{hostname:t,pathname:n}=new It(e),a=n.replace(/^\//,"");return[t,a]},ju=e=>`https://storage.googleapis.com/storage/v1/b/${e}/o`;async function Gu(e,t,n=()=>{}){const a=[],o=async i=>{const s=new It(ju(e));s.searchParams.append("prefix",t),s.searchParams.append("maxResults","1000"),i&&s.searchParams.append("pageToken",i);const r=await ku(s.toString());if(r.kind!=="storage#objects")throw new Error("GCS did not return a list of objects!");a.push(...r.items),r.items.forEach(l=>n(l)),r.nextPageToken&&await o(r.nextPageToken)};return await o(),a}const Xu=async(e,t=()=>{})=>{const[n,a]=zu(e);return Gu(n,a,t)},qu=async(e,{execute:t,done:n})=>{const{uriSrc:a}=e;if(a&&Wu(a.uri))try{return await Xu(a.uri,o=>{t({uriSrc:{uri:o.mediaLink,name:o.name},parent:e})}),n()}catch(o){throw new Error(`Could not download GCS URI ${a.uri}`,{cause:o instanceof Error?o:void 0})}return e},Yu=async(e,{done:t})=>{if(!e.fileSrc)return e;const{fileSrc:n}=e;if(!Hn.has(n.fileType))return e;const o=await Hn.get(n.fileType)(n.file),i=st();if(o.isA("vtkImageData")){const s=Re().addVTKImageData(n.file.name,o);return i.add(s,[e]),t({dataID:s,dataSource:e,dataType:"image"})}if(o.isA("vtkPolyData")){const s=ma().addVTKPolyData(n.file.name,o);return i.add(s,[e]),t({dataID:s,dataSource:e,dataType:"model"})}throw new Error("Data reader did not produce a valid dataset")},Ku=C.object({url:C.string(),name:C.optional(C.string())}),Qu=C.object({resources:C.array(Ku)});async function Ju(e){const t=new TextDecoder,n=await e.arrayBuffer(),a=t.decode(new Uint8Array(n));return Qu.parse(JSON.parse(a))}const Zu=async(e,{done:t,execute:n})=>{const{fileSrc:a}=e;if((a==null?void 0:a.fileType)==="application/json"){const o=[];try{(await Ju(a.file)).resources.forEach(s=>{o.push({uriSrc:{uri:s.url,name:s.name??new URL(s.url).pathname},parent:e})})}catch{return e}return o.forEach(i=>{n(i)}),t()}return e};function ed(e,t){t.classHierarchy.push("vtkLabelMap"),t.colorMap===null&&(t.colorMap={0:[0,0,0,0],1:[0,0,0,255]})}const td={colorMap:null};function ba(e,t,n={}){Object.assign(t,td,n),Li.extend(e,t,n),_.setGet(e,t,["colorMap"]),ed(e,t)}const nd=_.newInstance(ba,"vtkLabelMap"),Ta={newInstance:nd,extend:ba},re={Coronal:"Coronal",Sagittal:"Sagittal",Axial:"Axial",Three:"3D"},Ia={[re.Coronal]:{viewType:"2D",props:{viewDirection:"Right",viewUp:"Superior"}},[re.Sagittal]:{viewType:"2D",props:{viewDirection:"Posterior",viewUp:"Superior"}},[re.Axial]:{viewType:"2D",props:{viewDirection:"Superior",viewUp:"Anterior"}},[re.Three]:{viewType:"3D",props:{viewDirection:"Posterior",viewUp:"Superior"}}},od=Ia[re.Axial],qo=[{name:"Axial Only",direction:xe.H,items:[re.Axial]},{name:"Axial Primary",direction:xe.V,items:[re.Axial,{direction:xe.H,items:[re.Three,re.Coronal,re.Sagittal]}]},{name:"3D Primary",direction:xe.V,items:[re.Three,{direction:xe.H,items:[re.Coronal,re.Sagittal,re.Axial]}]},{name:"Quad View",direction:xe.H,items:[{direction:xe.V,items:[re.Coronal,re.Three]},{direction:xe.V,items:[re.Sagittal,re.Axial]}]},{name:"3D Only",direction:xe.H,items:[re.Three]}].reduce((e,t)=>({...e,[t.name]:t}),{}),Mt={0:[0,0,0,0],1:[153,153,0,255],2:[76,76,0,255],3:[255,255,0,255],4:[0,76,0,255],5:[0,153,0,255],6:[0,255,0,255],7:[76,0,0,255],8:[153,0,0,255],9:[255,0,0,255],10:[0,76,76,255],11:[0,153,153,255],12:[0,255,255,255],13:[0,0,76,255],14:[0,0,153,255]},id=["#58f24c","#8de4d3","#f0a4b1","#a3c9fe","#c8f251","#fea53b"],ad={red:{color:"red"},green:{color:"#00ff00"},white:{color:"#ffffff"}},sd={artifact:{color:"#888888",fillColor:"#ffbf0040"},innocuous:{color:"#00ff00",fillColor:"#00ff0020"},lesion:{color:"red",fillColor:"transparent"}},rd="q",ld="w",Yo={CT:"CT-AAA",MR:"CT-Coronary-Arteries-2",US:"US-Fetal"},cd=Uint8Array;function ud(e){const t=new cd(e.getNumberOfPoints()),n=Ta.newInstance(e.get("spacing","origin","direction"));return n.getPointData().setScalars(Oi.newInstance({numberOfComponents:1,values:t})),n.setDimensions(e.getDimensions()),n.computeTransforms(),n.setColorMap(Mt),n}function dd(e){const t=Ta.newInstance(e.get("spacing","origin","direction","indexToWorld","worldToIndex","dataDescription","pointData"));return t.setDimensions(e.getDimensions()),t.computeTransforms(),t.setColorMap(Mt),t}const fn=te("labelmap",{state:()=>({idList:[],labelmaps:Object.create(null),parentImage:Object.create(null)}),actions:{newLabelmapFromImage(e){const n=Re().dataIndex[e];if(!n)return null;const a=Ct().nextId(),o=ud(n);return this.idList.push(a),this.parentImage[a]=e,this.labelmaps[a]=o,this.$proxies.addData(a,o),a},async serialize(e){const{labelMaps:t}=e.manifest,{zip:n}=e;await Promise.all(Object.entries(this.labelmaps).map(async([a,o])=>{const i=`labels/${a}.vti`,s=ya(this.parentImage[a]);t.push({id:a,parent:s,path:i});const r=await Tl(o);n.file(i,r)}))},async deserialize(e,t,n){const{labelMaps:a}=e,o={};return a.forEach(async i=>{const[s]=t.filter(d=>_t(d.archivePath,d.file.name)===St(i.path)).map(d=>d.file);i.parent=n[i.parent];const{parent:r}=i,l=Ct().nextId();o[i.id]=l;const c=await ji(s),u=dd(c);this.idList.push(l),this.parentImage[l]=wa(r),this.labelmaps[l]=u,this.$proxies.addData(l,u)}),o}}});async function hd(e,t,n,a=[{type:Ye.Image}]){const o=navigator.hardwareConcurrency?navigator.hardwareConcurrency:6,i=n[0],s=Math.min(parseInt(o/2,10),Math.max(i.size[i.size.length-1],1),4),r=s.toString(),l=[...Array(s).keys()].map(v=>{const p=[...[...Array(n.length).keys()].map(m=>m.toString()),"0",...t,"--max-total-splits",r,"--split",v.toString(),"--number-of-splits",r,"--memory-io"],f=n.map(m=>({type:Ye.Image,data:ks(m)}));return[e,p,a,f,_t("/","/itk/pipelines"),_t("/","/itk/pipeline.worker.js")]}),c=new Ms(o,hi),u=await c.runTasks(l).promise;c.terminateWorkers();const h=u.filter(v=>v.returnValue===0).map(({outputs:v})=>v[0].data);return Bs(h)}const gd=["size","direction","origin","spacing"];function fd(e,t){return gd.map(a=>Jn(e[a],t[a])).every(a=>a)}async function pd(e,t){if(fd(e,t))return t;const{size:n,spacing:a,origin:o,direction:i}=e,s=["--size",n.join(","),"--spacing",a.join(","),"--origin",o.join(","),"--direction",i.join(",")];return hd("resample",s,[t])}const Ra=e=>{throw new Error(`Unknown DataSelection: ${e}`)},md=e=>e.type==="dicom"?e.volumeKey:e.type==="image"?e.dataID:Ra(e),Vt=e=>{const t=md(e);return`${e.type}::${t}`},Mn=e=>{const[t,n]=e.split("::");return t==="dicom"?Ut(n):t==="image"?Ht(n):Ra(t)},xt=te("layer",()=>{const e=M({}),t=M({});async function n(h,v){if(!h)throw new Error("Tried to addLayer without parent data selection");const p=Vt(h),f=`${p}::${Vt(v)}`;this.parentToLayers[p]=[...this.parentToLayers[p]??[],{selection:v,id:f}];const[m,w]=await Promise.all([h,v].map(xu));if(!Hr.intersects(m.getBounds(),w.getBounds()))throw this.deleteLayer(h,v),new Error("Image bounds do not intersect, so no overlap in physical space");const T=await pd(hn.convertVtkToItkImage(m),hn.convertVtkToItkImage(w)),S=hn.convertItkToVtkImage(T);this.$proxies.addData(f,S),this.layerImages[f]=S}async function a(h,v){return ao("Failed to build layer",()=>this._addLayer(h,v))}function o(h,v){if(!h)throw new Error("Tried to deleteLayer without parent data selection");const p=Vt(h),f=this.parentToLayers[p]??[],m=f.find(({selection:w})=>Du(w,v));m&&(this.parentToLayers[p]=f.filter(w=>w!==m),delete this.layerImages[m.id],this.$proxies.getData(m.id)&&this.$proxies.deleteData(m.id))}function i(h){if(!h)return[];const v=Vt(h);return e.value[v]??[]}const s=h=>Object.values(e.value).flat().flat().find(({id:v})=>v===h),r=h=>{const v=xt();v.getLayers(h).forEach(({selection:p})=>v.deleteLayer(h,p)),Object.keys(v.parentToLayers).map(p=>Mn(p)).forEach(p=>v.deleteLayer(p,h))};Re().$onAction(({name:h,args:v})=>{if(h!=="deleteData")return;const[p]=v,f=Ht(p);r(f)}),_e().$onAction(({name:h,args:v})=>{if(h!=="deleteVolume")return;const[p]=v,f=Ut(p);r(f)});function u(h){h.manifest.parentToLayers=Object.entries(this.parentToLayers).map(([v,p])=>({selectionKey:v,sourceSelectionKeys:p.map(({selection:f})=>Vt(f))}))}function d(h,v){const p=m=>{if(m.type==="dicom")return Ut(v[m.volumeKey]);if(m.type==="image")return Ht(v[m.dataID]);const w=m;throw new Error(`invalid selection type ${w}`)},{parentToLayers:f}=h;f.forEach(({selectionKey:m,sourceSelectionKeys:w})=>{const T=p(Mn(m));w.forEach(S=>{const b=p(Mn(S));this.addLayer(T,b)})})}return{parentToLayers:e,layerImages:t,_addLayer:n,addLayer:a,deleteLayer:o,getLayers:i,getLayer:s,serialize:u,deserialize:d}});function xa(e){const t=Re();if(e&&e in t.metadata){const{lpsOrientation:n}=t.metadata[e],a=t.dataIndex[e];if(a){const o=a.getSpatialExtent();return{Sagittal:We(o,"Sagittal",n),Coronal:We(o,"Coronal",n),Axial:We(o,"Axial",n)}}}return ia()}function se(){const e=Rt(),t=_e(),n=Re(),a=xt(),o=I(()=>{const{primarySelection:u}=e,{volumeToImageID:d}=t;return(u==null?void 0:u.type)==="image"?u.dataID:(u==null?void 0:u.type)==="dicom"&&d[u.volumeKey]||null}),i=I(()=>{const{metadata:u}=n,d=o.value;return d?u[d]:pa()}),s=I(()=>{if(o.value)return n.dataIndex[o.value]}),r=I(()=>xa(o.value)),l=I(()=>!!e.primarySelection&&!e.primaryDataset),c=I(()=>a.getLayers(e.primarySelection).filter(({id:u})=>u in a.layerImages));return{currentImageData:s,currentImageID:o,currentImageMetadata:i,currentImageExtent:r,isImageLoading:l,currentLayers:c}}function Bn(e,t){return[Math.max(t[0],Math.min(t[1],e[0])),Math.max(t[0],Math.min(t[1],e[1]))]}function dt(e,t,n,a){const{indexToWorld:o,orientation:i,lpsOrientation:s}=t,r=[0,0,0],l=s[n];r[l]=e[n][a],pe(r,r,o);const c=-(a*2-1),u=[...i.slice(l*3,l*3+3).map(d=>d*c)];return Wr.newInstance({origin:r,normal:u})}const bt=te("crop",()=>{const e=Re(),t=ze({croppingByImageID:{}}),n=c=>I(()=>{const u=z(c);if(u&&u in t.croppingByImageID&&u in e.metadata){const d=t.croppingByImageID[u],h=e.metadata[u];return[dt(d,h,"Sagittal",0),dt(d,h,"Sagittal",1),dt(d,h,"Coronal",0),dt(d,h,"Coronal",1),dt(d,h,"Axial",0),dt(d,h,"Axial",1)]}return null}),a=(c,u)=>{const d=xa(c);return{Sagittal:Bn(u.Sagittal,d.Sagittal),Coronal:Bn(u.Coronal,d.Coronal),Axial:Bn(u.Axial,d.Axial)}},o=(c,u)=>{t.croppingByImageID[c]=a(c,u)},i=(c,u,d)=>{c in t.croppingByImageID&&o(c,{...t.croppingByImageID[c],[u]:d})},s=c=>{const u=e.dataIndex[c];if(!u)return;const{lpsOrientation:d}=e.metadata[c],h=u.getSpatialExtent();o(c,{Sagittal:We(h,"Sagittal",d),Coronal:We(h,"Coronal",d),Axial:We(h,"Axial",d)})};function r(c){const{tools:u}=c.manifest;u.crop=t.croppingByImageID}function l(c,u){const d=c.tools.crop;Object.entries(d).forEach(([h,v])=>{const p=u[h];o(p,v)})}return{croppingByImageID:As(t.croppingByImageID),getComputedVTKPlanes:n,setCropping:o,setCroppingForAxis:i,resetCropping:s,serialize:r,deserialize:l}});function vd(){return Ei.createBuilder().addField({name:"placed",initialValue:!1}).addField({name:"indexToWorld",initialValue:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}).addField({name:"worldToIndex",initialValue:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}).addStateFromMixin({labels:["handle"],mixins:["origin","bounds"],name:"handle",initialValues:{origin:null}}).build()}function yd(e,t){return t.map((n,a)=>Math.max(e[a*2],Math.min(e[a*2+1],n)))}function wd(e,t){t.classHierarchy.push("vtkCrosshairsWidgetProp");let n=!1;_.setGet(e,t,["manipulator"]);function a(o){return o.altKey||o.controlKey||o.shiftKey}e.handleLeftButtonPress=o=>!t.pickable||a(o)?_.VOID:(t.widgetState.setPlaced(!0),n=!0,t._interactor.requestAnimation(e),t._apiSpecificRenderWindow.setCursor("crosshairs"),e.invokeStartInteractionEvent(),e.handleMouseMove(o),_.EVENT_ABORT),e.handleMouseMove=o=>{if((!t.widgetState.getPlaced()||n)&&t.pickable&&t.manipulator&&!a(o)){const i=t.manipulator.handleEvent(o,t._apiSpecificRenderWindow),s=t.widgetState.getHandle(),r=t.widgetState.getWorldToIndex(),l=t.widgetState.getIndexToWorld();if(r.length&&l.length){const c=Le(),u=Le(),d=s.getBounds();pe(c,i,r);const h=yd(d,c);return pe(u,h,l),s.setOrigin(u),e.invokeInteractionEvent(),_.EVENT_ABORT}}return _.VOID},e.handleLeftButtonRelease=()=>{n&&t.pickable&&(t._interactor.cancelAnimation(e),t._apiSpecificRenderWindow.setCursor("default"),e.invokeEndInteractionEvent()),n=!1},e.grabFocus=()=>{},e.loseFocus=()=>{}}function Sd(e,t){t.classHierarchy.push("vtkCrosshairsWidget"),t.behavior=wd,t.widgetState=vd(),e.getRepresentationsForViewType=n=>{switch(n){case Qe.DEFAULT:case Qe.GEOMETRY:case Qe.SLICE:case Qe.VOLUME:default:return[]}},t.widgetState.onBoundsChange(n=>{const a=[(n[0]+n[1])*.5,(n[2]+n[3])*.5,(n[4]+n[5])*.5];t.widgetState.getHandle().setOrigin(a)}),t.manipulator=je.newInstance()}const _d={};function Da(e,t,n={}){Object.assign(t,_d,n),mn.extend(e,t,n),_.setGet(e,t,["manipulator"]),Sd(e,t)}const Cd=_.newInstance(Da,"vtkCrosshairsWidget"),bd={newInstance:Cd,extend:Da};function Tt(e,t,n,a){t in e||(e[t]={}),e[t][n]={...e[t][n],...a}}function Zt(e,t){Object.keys(e).forEach(n=>{delete e[n][t]})}function en(e,t,n){var a;return t==null||n==null?null:(a=e[t])==null?void 0:a[n]}const Td=(e,t,n)=>{const a=e.manifest.datasets.map(i=>i.id),{views:o}=e.manifest;o.forEach(i=>{a.forEach(s=>{var c;const{config:r}=i,l=(c=t[i.id])==null?void 0:c[s];if(l!==void 0){const u=vl(s,r,{});u[n]=l}})})},tn=(e,t)=>n=>{Td(n,e,t)},lo=()=>({slice:0,min:0,max:1,axisDirection:"Inferior"}),Dt=te("viewSlice",()=>{const e=ze({}),t=(l,c)=>en(e,l,c),n=(l,c,u)=>{const d={...lo(),...t(l,c),...u};d.slice=Wi(d.slice,d.min,d.max),Tt(e,l,c,d)},a=(l,c)=>{const u=t(l,c);u&&n(l,c,{slice:Math.ceil((u.min+u.max)/2)})},o=l=>{delete e[l]},i=(l,c)=>{var u;c?(u=e[c])==null||delete u[l]:Zt(e,l)},s=tn(e,"slice");return{configs:e,getConfig:t,updateConfig:n,resetSlice:a,removeView:o,removeData:i,serialize:s,deserialize:(l,c)=>{Object.entries(c).forEach(([u,d])=>{d.slice&&n(l,u,d.slice)})}}}),Ea=()=>({width:1,level:.5,min:0,max:1}),co=te("windowing",()=>{const e=ze({}),t=M(!0),n=d=>{t.value=d},a=(d,h)=>en(e,d,h),o=(d,h)=>{var p;if(!t.value)return;const v=(p=e[d])==null?void 0:p[h];v&&Object.keys(e).filter(f=>f!==d).forEach(f=>{Tt(e,f,h,v)})},i=(d,h,v)=>{var p;Tt(e,d,h,{...Ea(),...(p=e[d])==null?void 0:p[h],...v}),t.value&&o(d,h)},s=(d,h)=>{var m;const v=(m=e[d])==null?void 0:m[h];if(v==null)return;const p=v.max-v.min,f=(v.max+v.min)/2;i(d,h,{width:p,level:f})},r=d=>{delete e[d]},l=(d,h)=>{var v;h?(v=e[h])==null||delete v[d]:Zt(e,d)},c=tn(e,"window");return{configs:e,getConfig:a,setSyncAcrossViews:n,updateConfig:i,resetWindowLevel:s,removeView:r,removeData:l,serialize:c,deserialize:(d,h)=>{Object.entries(h).forEach(([v,p])=>{p.window&&i(d,v,p.window)})}}});function La(e,t){var a,o;const n=(o=(a=t.getRenderWindow())==null?void 0:a.getViews())==null?void 0:o[0];if(n){const[i,s,r]=e;return n.worldToDisplay(i,s,r,t)}return null}function Id(e,t){const n=t.getCanvas();if(!n)return null;const a=n.getBoundingClientRect(),o=n.width/a.width,i=n.height/a.height;return[o*(e.clientX-a.left),i*(a.height-e.clientY+a.top)]}function Rd(e,t,n,a){var s;const o=(s=t.getRenderWindow())==null?void 0:s.getViews()[0];if(!o)return null;const i=Id(e,o);return i?zr(i[0],i[1],n,a,t,o):null}function Wt(e,t){var o,i;const n=La(e,t),a=(i=(o=t.getRenderWindow())==null?void 0:o.getViews())==null?void 0:i[0];if(n&&a){const[,s]=a.getViewportSize(t);return[n[0]/devicePixelRatio,(s-n[1])/devicePixelRatio]}return null}function uo(e){var o,i,s;const{pokedRenderer:t}=e,n=(i=(o=t==null?void 0:t.getRenderWindow())==null?void 0:o.getViews())==null?void 0:i[0],a=(s=n==null?void 0:n.getContainer())==null?void 0:s.getBoundingClientRect();return!("position"in e)||!a?null:[a.left+e.position.x/devicePixelRatio,a.top+a.height-e.position.y/devicePixelRatio]}function xd(e,t,n){const a=vn.getPresetByName(e);if(a.OpacityPoints){const o=a.OpacityPoints,i=[];for(let c=0;c<o.length;c+=2)i.push([o[c],o[c+1]]);const[s,r]=t,l=r-s;return i.map(([c,u])=>[(c-s)/l+n,u])}return null}function Oa(e){return vn.getPresetByName(e).OpacityPoints?{mode:Ee.Mode.Points,preset:e,shift:0}:{mode:Ee.Mode.Gaussians,gaussians:JSON.parse(JSON.stringify(Ee.Defaults.Gaussians))}}function Va(e){const t=vn.getPresetByName(e);if(!t)return null;const{AbsoluteRange:n,RGBPoints:a}=t;if(n&&a){let o=1/0,i=-1/0;for(let s=0;s<a.length;s+=4)o=Math.min(o,a[s]),i=Math.max(i,a[s]);return[o,i]}return null}const Dd=[{Name:"CT-AAA",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,143.556,0,166.222,.686275,214.389,.696078,419.736,.833333,3071,.803922],RGBPoints:[-3024,0,0,0,143.556,.615686,.356863,.184314,166.222,.882353,.603922,.290196,214.389,1,1,1,419.736,1,.937033,.954531,3071,.827451,.658824,1],EffectiveRange:[143.556,419.736]},{Name:"CT-AAA2",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,129.542,0,145.244,.166667,157.02,.5,169.918,.627451,395.575,.8125,1578.73,.8125,3071,.8125],RGBPoints:[-3024,0,0,0,129.542,.54902,.25098,.14902,145.244,.6,.627451,.843137,157.02,.890196,.47451,.6,169.918,.992157,.870588,.392157,395.575,1,.886275,.658824,1578.73,1,.829256,.957922,3071,.827451,.658824,1],EffectiveRange:[0,1600]},{Name:"CT-Bone",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-16.4458,0,641.385,.715686,3071,.705882],RGBPoints:[-3024,0,0,0,-16.4458,.729412,.254902,.301961,641.385,.905882,.815686,.552941,3071,1,1,1],EffectiveRange:[-16.4458,641.385]},{Name:"CT-Bones",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-1e3,0,152.19,0,278.93,.190476,952,.2],RGBPoints:[-1e3,.3,.3,1,-488,.3,1,.3,463.28,1,0,0,659.15,1,.912535,.0374849,953,1,.3,.3],EffectiveRange:[152.19,952]},{Name:"CT-Cardiac",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-77.6875,0,94.9518,.285714,179.052,.553571,260.439,.848214,3071,.875],RGBPoints:[-3024,0,0,0,-77.6875,.54902,.25098,.14902,94.9518,.882353,.603922,.290196,179.052,1,.937033,.954531,260.439,.615686,0,0,3071,.827451,.658824,1],EffectiveRange:[-77.6875,260.439]},{Name:"CT-Cardiac2",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,42.8964,0,163.488,.428571,277.642,.776786,1587,.754902,3071,.754902],RGBPoints:[-3024,0,0,0,42.8964,.54902,.25098,.14902,163.488,.917647,.639216,.0588235,277.642,1,.878431,.623529,1587,1,1,1,3071,.827451,.658824,1],EffectiveRange:[42.8964,1587]},{Name:"CT-Cardiac3",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-86.9767,0,45.3791,.169643,139.919,.589286,347.907,.607143,1224.16,.607143,3071,.616071],RGBPoints:[-3024,0,0,0,-86.9767,0,.25098,1,45.3791,1,0,0,139.919,1,.894893,.894893,347.907,1,1,.25098,1224.16,1,1,1,3071,.827451,.658824,1],EffectiveRange:[-86.9767,1224.16]},{Name:"CT-Chest-Contrast-Enhanced",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,67.0106,0,251.105,.446429,439.291,.625,3071,.616071],RGBPoints:[-3024,0,0,0,67.0106,.54902,.25098,.14902,251.105,.882353,.603922,.290196,439.291,1,.937033,.954531,3071,.827451,.658824,1],EffectiveRange:[67.0106,439.291]},{Name:"CT-Chest-Vessels",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-1278.35,0,22.8277,.428571,439.291,.625,3071,.616071],RGBPoints:[-3024,0,0,0,-1278.35,.54902,.25098,.14902,22.8277,.882353,.603922,.290196,439.291,1,.937033,.954531,3071,.827451,.658824,1],EffectiveRange:[-1278.35,439.291]},{Name:"CT-Coronary-Arteries",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,136.47,0,159.215,.258929,318.43,.571429,478.693,.776786,3661,1],RGBPoints:[-2048,0,0,0,136.47,0,0,0,159.215,.159804,.159804,.159804,318.43,.764706,.764706,.764706,478.693,1,1,1,3661,1,1,1],EffectiveRange:[136.47,478.693]},{Name:"CT-Coronary-Arteries-2",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,142.677,0,145.016,.116071,192.174,.5625,217.24,.776786,384.347,.830357,3661,.830357],RGBPoints:[-2048,0,0,0,142.677,0,0,0,145.016,.615686,0,.0156863,192.174,.909804,.454902,0,217.24,.972549,.807843,.611765,384.347,.909804,.909804,1,3661,1,1,1],EffectiveRange:[142.677,384.347]},{Name:"CT-Coronary-Arteries-3",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,128.643,0,129.982,.0982143,173.636,.669643,255.884,.857143,584.878,.866071,3661,1],RGBPoints:[-2048,0,0,0,128.643,0,0,0,129.982,.615686,0,.0156863,173.636,.909804,.454902,0,255.884,.886275,.886275,.886275,584.878,.968627,.968627,.968627,3661,1,1,1],EffectiveRange:[128.643,584.878]},{Name:"CT-Cropped-Volume-Bone",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,-451,0,-450,1,1050,1,3661,1],RGBPoints:[-2048,0,0,0,-451,0,0,0,-450,.0556356,.0556356,.0556356,1050,1,1,1,3661,1,1,1],EffectiveRange:[-451,1050]},{Name:"CT-Fat",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-1e3,0,-100,0,-99,.15,-60,.15,-59,0,101.2,0,952,0],RGBPoints:[-1e3,.3,.3,1,-497.5,.3,1,.3,-99,0,0,1,-76.946,0,1,0,-65.481,.835431,.888889,.0165387,83.89,1,0,0,463.28,1,0,0,659.15,1,.912535,.0374849,2952,1,.300267,.299886],EffectiveRange:[-100,101.2]},{Name:"CT-Liver-Vasculature",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,149.113,0,157.884,.482143,339.96,.660714,388.526,.830357,1197.95,.839286,3661,.848214],RGBPoints:[-2048,0,0,0,149.113,0,0,0,157.884,.501961,.25098,0,339.96,.695386,.59603,.36886,388.526,.854902,.85098,.827451,1197.95,1,1,1,3661,1,1,1],EffectiveRange:[149.113,1197.95]},{Name:"CT-Lung",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-1e3,0,-600,0,-599,.15,-400,.15,-399,0,2952,0],RGBPoints:[-1e3,.3,.3,1,-600,0,0,1,-530,.134704,.781726,.0724558,-460,.929244,1,.109473,-400,.888889,.254949,.0240258,2952,1,.3,.3],EffectiveRange:[-600,-399]},{Name:"CT-MIP",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-637.62,0,700,1,3071,1],RGBPoints:[-3024,0,0,0,-637.62,1,1,1,700,1,1,1,3071,1,1,1],EffectiveRange:[-637.62,700]},{Name:"CT-Muscle",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-155.407,0,217.641,.676471,419.736,.833333,3071,.803922],RGBPoints:[-3024,0,0,0,-155.407,.54902,.25098,.14902,217.641,.882353,.603922,.290196,419.736,1,.937033,.954531,3071,.827451,.658824,1],EffectiveRange:[-155.407,419.736]},{Name:"CT-Pulmonary-Arteries",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,-568.625,0,-364.081,.0714286,-244.813,.401786,18.2775,.607143,447.798,.830357,3592.73,.839286],RGBPoints:[-2048,0,0,0,-568.625,0,0,0,-364.081,.396078,.301961,.180392,-244.813,.611765,.352941,.0705882,18.2775,.843137,.0156863,.156863,447.798,.752941,.752941,.752941,3592.73,1,1,1],EffectiveRange:[-568.625,447.798]},{Name:"CT-Soft-Tissue",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,-167.01,0,-160,1,240,1,3661,1],RGBPoints:[-2048,0,0,0,-167.01,0,0,0,-160,.0556356,.0556356,.0556356,240,1,1,1,3661,1,1,1],EffectiveRange:[-167.01,240]},{Name:"CT-Air",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,.705882,-900,.715686,-500,0,3071,0],RGBPoints:[-3024,1,1,1,-900,.2,1,1,-500,.3,.3,1,3071,0,0,0],EffectiveRange:[-1200,-200]},{Name:"CT-X-ray",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-200,0,1500,.05,3071,.05],RGBPoints:[-3024,1,1,1,3071,1,1,1],EffectiveRange:[-250,1550]},{Name:"MR-Angio",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,151.354,0,158.279,.4375,190.112,.580357,200.873,.732143,3661,.741071],RGBPoints:[-2048,0,0,0,151.354,0,0,0,158.279,.74902,.376471,0,190.112,1,.866667,.733333,200.873,.937255,.937255,.937255,3661,1,1,1],EffectiveRange:[151.354,200.873]},{Name:"MR-Default",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[0,0,20,0,40,.15,120,.3,220,.375,1024,.5],RGBPoints:[0,0,0,0,20,.168627,0,0,40,.403922,.145098,.0784314,120,.780392,.607843,.380392,220,.847059,.835294,.788235,1024,1,1,1],EffectiveRange:[0,220]},{Name:"MR-MIP",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[0,0,98.3725,0,416.637,1,2800,1],RGBPoints:[0,1,1,1,98.3725,1,1,1,416.637,1,1,1,2800,1,1,1],EffectiveRange:[0,416.637]},{Name:"MR-T2-Brain",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[0,0,36.05,0,218.302,.171429,412.406,1,641,1],RGBPoints:[0,0,0,0,98.7223,.956863,.839216,.192157,412.406,0,.592157,.807843,641,1,1,1],EffectiveRange:[0,412.406]},{Name:"DTI-FA-Brain",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[0,0,0,0,.3501,.0158,.49379,.7619,.6419,1,.992,1,.995,0,.995,0],RGBPoints:[0,1,0,0,0,1,0,0,.24974,.4941,1,0,.49949,0,.9882,1,.7492,.51764,0,1,.995,1,0,0,.995,1,0,0],EffectiveRange:[0,1]},{Name:"US-Fetal",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-10,0,0,0,270,.8],RGBPoints:[-10,.325,.153,.153,74,.474,.392,.302,136,.718,.51,.443,270,.76,.44,.53],EffectiveRange:[-10,270]},{ColorSpace:"Lab",Name:"2hot",RGBPoints:[-1,.0416667,0,0,-.873016,.208333,0,0,-.746032,.375,0,0,-.619048,.541667,0,0,-.492063,.708333,0,0,-.365079,.854137,0,0,-.238095,.937488,.039062,0,-.111111,1,.208333,0,.015873,1,.375,0,.142857,1,.541667,0,.269841,1,.708333,0,.396825,1,.858805,.03125,.52381,1,.947392,.15625,.650794,1,1,.3125,.777778,1,1,.5625,.904762,1,1,.8125,1,1,1,1]}];function Ed(e){for(let t=0;t<e.length;t+=1)vn.addPreset(e[t])}Ed(Dd);const Ld=[{group:"CT",presets:["CT-AAA","CT-AAA2","CT-Bone","CT-Bones","CT-Cardiac","CT-Cardiac2","CT-Cardiac3","CT-Chest-Contrast-Enhanced","CT-Chest-Vessels","CT-Coronary-Arteries","CT-Coronary-Arteries-2","CT-Coronary-Arteries-3","CT-Cropped-Volume-Bone","CT-Fat","CT-Liver-Vasculature","CT-Lung","CT-MIP","CT-Muscle","CT-Pulmonary-Arteries","CT-Soft-Tissue","CT-Air","CT-X-ray"]},{group:"MR",presets:["MR-Default","MR-Angio","MR-MIP","MR-T2-Brain"]},{group:"DTI",presets:["DTI-FA-Brain"]},{group:"US",presets:["US-Fetal"]}],zn="CT-AAA";Ld.flatMap(e=>e.presets);const Od={PT:"2hot"};function Vd(e){const n=xt().getLayer(e);if(n&&n.selection.type==="dicom"){const a=_e(),{Modality:o=void 0}=a.volumeInfo[n.selection.volumeKey];return o&&Od[o]||zn}return zn}const Ko=()=>({colorBy:{arrayName:"",location:"pointData"},transferFunction:{preset:"",mappingRange:[0,1]},opacityFunction:{mode:Ee.Mode.Gaussians,gaussians:[],mappingRange:[0,1]},blendConfig:{opacity:.6}}),Pa=te("layerColoring",()=>{const e=ze({}),t=(p,f)=>en(e,p,f),n=(p,f,m)=>{const w={...Ko(),...t(p,f),...m};Tt(e,p,f,w)},a=(p,f=Ui)=>(m,w,T)=>{const S=t(m,w)??Ko(),b=f({...S[p],...T});n(m,w,{[p]:b})},o=a("colorBy"),i=a("transferFunction"),s=a("opacityFunction"),r=a("blendConfig"),l=(p,f,m)=>{const T=xt().layerImages[f];if(!T)return;const S=T.getPointData().getScalars().getRange(),b=Va(m);i(p,f,{preset:m,mappingRange:b||S});const D=Oa(m);D.mappingRange=S,s(p,f,D)},c=(p,f,m)=>{const w=m.getPointData().getScalars();o(p,f,{arrayName:w.getName()+f,location:"pointData"}),l(p,f,Vd(f))},u=p=>{delete e[p]},d=(p,f)=>{var m;f?(m=e[f])==null||delete m[p]:Zt(e,p)},h=tn(e,"layers");return{configs:e,getConfig:t,updateConfig:n,updateColorBy:o,updateColorTransferFunction:i,updateOpacityFunction:s,updateBlendConfig:r,resetToDefault:c,setColorPreset:l,removeView:u,removeData:d,serialize:h,deserialize:(p,f)=>{Object.entries(f).forEach(([m,w])=>{w.layers&&n(p,m,w.layers)})}}}),ho=te("viewCamera",()=>{const e=ze({}),t=(r,l)=>en(e,r,l),n=(r,l,c)=>{const u={...t(r,l),...c};Tt(e,r,l,u)},a=r=>{delete e[r]},o=(r,l)=>{var c;l?(c=e[l])==null||delete c[r]:Zt(e,r)},i=tn(e,"camera");return{configs:e,getConfig:t,updateConfig:n,removeView:a,removeData:o,serialize:i,deserialize:(r,l)=>{Object.entries(l).forEach(([c,u])=>{u.camera&&n(r,c,u.camera)})}}}),Pd=.2,kd=.7,Md=.3;function Bd(e){const t=_e();if(e in t.imageIDToVolumeKey){const n=t.imageIDToVolumeKey[e],{Modality:a}=t.volumeInfo[n];if(a in Yo)return Yo[a]}return zn}const Qo=()=>({colorBy:{arrayName:"",location:"pointData"},transferFunction:{preset:"",mappingRange:[0,1]},opacityFunction:{mode:Ee.Mode.Gaussians,gaussians:[],mappingRange:[0,1]},cvr:{enabled:!0,lightFollowsCamera:!0,volumeQuality:2,useVolumetricScatteringBlending:!0,volumetricScatteringBlending:.5,useLocalAmbientOcclusion:!0,laoKernelRadius:5,laoKernelSize:15,ambient:Pd,diffuse:kd,specular:Md}}),Ad=te("volumeColoring",()=>{const e=ze({}),t=(p,f)=>en(e,p,f),n=(p,f,m)=>{const w={...Qo(),...t(p,f),...m};Tt(e,p,f,w)},a=(p,f=Ui)=>(m,w,T)=>{const S=t(m,w)??Qo(),b=f({...S[p],...T});n(m,w,{[p]:b})},o=a("colorBy"),i=a("transferFunction"),s=a("opacityFunction"),r=a("cvr"),l=(p,f,m)=>{const T=Re().dataIndex[f];if(!T)return;const S=T.getPointData().getScalars().getRange(),b=Va(m);i(p,f,{preset:m,mappingRange:b||S});const D=Oa(m);D.mappingRange=S,s(p,f,D)},c=(p,f,m)=>{const w=m.getPointData().getScalars();o(p,f,{arrayName:w.getName(),location:"pointData"}),l(p,f,Bd(f))},u=p=>{delete e[p]},d=(p,f)=>{var m;f?(m=e[f])==null||delete m[p]:Zt(e,p)},h=tn(e,"volumeColorConfig");return{configs:e,getConfig:t,updateConfig:n,updateColorBy:o,updateColorTransferFunction:i,updateOpacityFunction:s,updateCVRParameters:r,resetToDefaultColoring:c,setColorPreset:l,removeView:u,removeData:d,serialize:h,deserialize:(p,f)=>{Object.entries(f).forEach(([m,w])=>{w.volumeColorConfig&&n(p,m,w.volumeColorConfig)})}}}),Jo=te("viewConfig",()=>{const e=Dt(),t=co(),n=Pa(),a=ho(),o=Ad(),i=u=>{e.removeView(u),t.removeView(u),n.removeView(u),a.removeView(u),o.removeView(u)},s=(u,d)=>{e.removeData(u,d),t.removeData(u,d),n.removeData(u,d),a.removeData(u,d),o.removeData(u,d)},r=u=>{e.serialize(u),t.serialize(u),n.serialize(u),a.serialize(u),o.serialize(u)},l=(u,d,h)=>{const v={};Object.entries(d).forEach(([p,f])=>{const m=h[p];v[m]=f}),e.deserialize(u,v),t.deserialize(u,v),n.deserialize(u,v),a.deserialize(u,v),o.deserialize(u,v)};return Re().$onAction(({name:u,args:d})=>{if(u==="deleteData"){const[h]=d;s(h)}}),{removeView:i,removeData:s,serialize:r,deserialize:l}}),de=te("view",{state:()=>({layout:{direction:xe.V,items:[]},viewSpecs:structuredClone(Ia)}),getters:{viewIDs(e){return Object.keys(e.viewSpecs)},getViewProxy(){return e=>this.$proxies.getView(e)},getDataRepresentationForView(){return(e,t)=>this.$proxies.getDataRepresentationForView(e,t)}},actions:{createOrGetViewProxy(e,t){return this.$proxies.getView(e)??this.$proxies.createView(e,t)},addView(e){e in this.viewSpecs||(this.viewSpecs[e]=structuredClone(od))},removeView(e){e in this.viewSpecs&&(delete this.viewSpecs[e],this.$proxies.removeView(e))},setLayout(e){this.layout=e;const t=[e];for(;t.length;)t.shift().items.forEach(a=>{typeof a=="string"?this.addView(a):t.push(a)})},serialize(e){const t=Jo(),{manifest:n}=e,{views:a}=n;n.layout=this.layout,Object.entries(this.viewSpecs).forEach(([o,i])=>{const s=i.viewType,{props:r}=i,c={id:o,type:s,props:r,config:{}};a.push(c)}),t.serialize(e)},deserialize(e,t){const n=Jo();e.forEach(a=>{const o=a.id,i={viewType:a.type,props:a.props};this.viewSpecs[o]=i;const{config:s}=a;n.deserialize(o,s,t)})}}}),zt=te("crosshairs",()=>{const e=bd.newInstance(),t=e.getWidgetState(),n=t.getHandle(),a=M(!1),{currentImageID:o,currentImageMetadata:i}=se(),s=M([0,0,0]),r=I(()=>{const w=Le();return pe(w,s.value,i.value.worldToIndex),w}),l=Dt(),c=de(),u=I(()=>{const w=z(o);return w?c.viewIDs.filter(T=>!!l.getConfig(T,w)):[]});function d(){return e}function h(w){s.value=w}F(r,w=>{if(a.value){const T=z(o),{lpsOrientation:S}=z(i);if(!T)return;u.value.forEach(b=>{const O=l.getConfig(b,T),D=Te(O.axisDirection),k=S[D],L=Math.round(w[k]);l.updateConfig(b,T,{slice:L})})}}),F(i,w=>{t.setIndexToWorld(w.indexToWorld),t.setWorldToIndex(w.worldToIndex);const[T,S,b]=w.dimensions,O=[0,T-1,0,S-1,0,b-1];n.setBounds(jr(O,.5))},{immediate:!0}),n.onModified(()=>{const w=n.getOrigin();w&&(s.value=w)});function v(){return t.setPlaced(!1),a.value=!0,!0}function p(){a.value=!1}function f(w){const{crosshairs:T}=w.manifest.tools;T.position=s.value}function m(w){const{crosshairs:T}=w.tools;s.value=T.position}return{getWidgetFactory:d,setPosition:h,position:s,imagePosition:r,activateTool:v,deactivateTool:p,serialize:f,deserialize:m}}),Fd=4,Nd=1,rt=te("paint",()=>{const e=M(null),t=M(Fd),n=M(Nd),a=M([]),o=M(1),i=M(!1),{currentImageID:s}=se();function r(){return this.$paint.factory}const l=I(()=>e.value?fn().labelmaps[e.value]??null:null);function c(D){if(!D){e.value=null;return}const k=fn(),L=Object.entries(k.parentImage).find(([,$])=>D===$);L?[e.value]=L:e.value=k.newLabelmapFromImage(D)}function u(D){t.value=Math.round(D),this.$paint.setBrushSize(D)}function d(D){n.value=D,this.$paint.setBrushValue(D)}function h(D){o.value=Math.min(1,Math.max(0,D))}function v(D){if(!l.value)return;const k=a.value.length-1;if(k>=0){const L=a.value[k],$=k>=1?a.value[k-1]:void 0;this.$paint.paintLabelmap(l.value,D,L,$)}}function p(D){if(!l.value)return;const k=l.value.getSpacing();k.splice(D,1);const L=[1/k[0],1/k[1]];this.$paint.setBrushScale(L)}function f(D,k){a.value=[gi(D)],v.call(this,k)}function m(D,k){a.value.push(D),v.call(this,k)}function w(D,k){a.value.push(D),v.call(this,k)}function T(){const D=s.value;return D?(c(D),this.$paint.setBrushSize(this.brushSize),i.value=!0,!0):!1}function S(){e.value=null,i.value=!1}function b(D){const{paint:k}=D.manifest.tools;k.activeLabelmapID=e.value,k.brushSize=t.value,k.brushValue=n.value,k.labelmapOpacity=o.value}function O(D,k){const{paint:L}=D.tools;this.setBrushSize(L.brushSize),this.setBrushValue(L.brushValue),this.setLabelmapOpacity(L.labelmapOpacity),i.value=D.tools.current===ne.Paint,L.activeLabelmapID!==null&&(e.value=k[L.activeLabelmapID])}return F(s,D=>{i.value&&c(D)}),{activeLabelmapID:e,brushSize:t,brushValue:n,strokePoints:a,labelmapOpacity:o,isActive:i,getWidgetFactory:r,activateTool:T,deactivateTool:S,selectOrCreateLabelmap:c,setBrushSize:u,setBrushValue:d,setLabelmapOpacity:h,setSliceAxis:p,startStroke:f,placeStrokePoint:m,endStroke:w,serialize:b,deserialize:O}}),Zo=Le();function _n(e,t,n){const a=(n==null?void 0:n.epsilon)??Yn,o=(n==null?void 0:n.allowNonIntegralSlice)??!1,i=(n==null?void 0:n.allowOutOfBoundsSlice)??!1,{planeNormal:s,planeOrigin:r}=e,{dimensions:l,lpsOrientation:c,worldToIndex:u}=t;let d=null;const{Left:h,Right:v,Posterior:p,Anterior:f,Superior:m,Inferior:w}=c;if(at(h,s)||at(v,s)?d="Sagittal":at(p,s)||at(f,s)?d="Coronal":(at(m,s)||at(w,s))&&(d="Axial"),!d)return null;pe(Zo,r,u);const T=c[d],S=yl(Zo[T],a);return!o&&!Number.isInteger(S)||!i&&(S<0||S>=l[T])?null:{axis:d,slice:S}}const $d={labelName:"New Label"},Ud=e=>{const t=M({}),n=M(),a=d=>{n.value=d},o=(d={})=>{const h=Ct().nextId();return t.value[h]={...$d,...e,...d},a(h),h},i=d=>{if(!(d in t.value))throw new Error("Label does not exist");if(delete t.value[d],t.value={...t.value},d===n.value){const h=Object.keys(t.value);h.length!==0?a(h[0]):a("")}},s=(d,h)=>{if(!(d in t.value))throw new Error("Label does not exist");t.value={...t.value,[d]:{...t.value[d],...h}}},r=M(!0),l=()=>{r.value&&(t.value={}),r.value=!1},c=(d,h=!0)=>{h&&l();const{labelName:v}=d,p=Object.entries(t.value).find(([,{labelName:f}])=>f===v);if(p){const[f]=p;return s(f,d),f}return o(d)};return{labels:t,activeLabel:n,setActiveLabel:a,addLabel:o,deleteLabel:i,updateLabel:s,mergeLabel:c,mergeLabels:(d,h=!0)=>{Object.entries(d??{}).forEach(([v,p])=>c({...p,labelName:v},h))}}},Hd=()=>({frameOfReference:{planeOrigin:[0,0,0],planeNormal:[1,0,0]},slice:-1,imageID:"",placing:!1,color:id[0],name:"baseAnnotationTool"}),go=({toolDefaults:e,initialLabels:t,newLabelDefault:n})=>{const a=M([]),o=M(Object.create(null)),i=I(()=>{const m=o.value;return a.value.map(w=>m[w])}),s=Ud(n);s.mergeLabels(t,!1);function r(m){if(!m)return{labelName:""};const w=s.labels.value[m];return w||{labelName:""}}function l(m){const w=Ct().nextId();if(w in o.value)throw new Error("Cannot add tool with conflicting ID");return o.value[w]={...Hd(),...e(),label:s.activeLabel.value,...m,...r(m.label),id:w},a.value.push(w),w}function c(m){m in o.value&&($t(a.value,m),delete o.value[m])}function u(m,w){m in o.value&&(o.value[m]={...o.value[m],...w,id:m})}F(s.labels,()=>{a.value.forEach(m=>{const w=o.value[m],T=r(w.label);u(m,{...w,...T})})});function d(m){const w=o.value[m],{currentImageID:T,currentImageMetadata:S}=se(),b=T.value;if(!b||w.imageID!==b)return;const O=_n(w.frameOfReference,S.value);if(!O)return;const D=de(),k=D.viewIDs.filter($=>{const J=D.viewSpecs[$].props.viewDirection;return J&&Te(J)===O.axis}),L=Dt();k.forEach($=>{L.updateConfig($,b,{slice:w.slice})})}const h=()=>!0,v=()=>{},p=()=>({tools:a.value.map(w=>o.value[w]).filter(w=>!w.placing).map(({imageID:w,...T})=>({imageID:ya(w),...T})),labels:s.labels.value});function f(m,w){const T=Object.fromEntries(Object.entries((m==null?void 0:m.labels)??{}).map(([S,b])=>{const O=s.mergeLabel(b);return[S,O]}));m==null||m.tools.map(({imageID:S,label:b,...O})=>({...O,imageID:wa(w[S]),label:b&&T[b]||""})).forEach(S=>l.call(this,S))}return{...s,toolIDs:a,toolByID:o,tools:i,addTool:l,removeTool:c,updateTool:u,jumpToTool:d,activateTool:h,deactivateTool:v,serialize:p,deserialize:f}},Wd=()=>({firstPoint:[0,0,0],secondPoint:[0,0,0],id:"",name:"Ruler"}),zd={color:"#ffffff"},Ae=te("ruler",()=>{const{toolIDs:e,toolByID:t,tools:n,addTool:a,updateTool:o,removeTool:i,jumpToTool:s,serialize:r,deserialize:l,activateTool:c,deactivateTool:u,...d}=go({toolDefaults:Wd,initialLabels:ad,newLabelDefault:zd}),h=I(()=>{const f=t.value;return e.value.reduce((m,w)=>{const{firstPoint:T,secondPoint:S}=f[w];return Object.assign(m,{[w]:Math.sqrt(Vi(T,S))})},{})});function v(f){f.manifest.tools.rulers=r()}function p(f,m){l.call(this,f.tools.rulers,m)}return{...d,rulerIDs:e,rulerByID:t,rulers:n,lengthByID:h,addRuler:a,updateRuler:o,removeRuler:i,jumpToRuler:s,serialize:v,deserialize:p,activateTool:c,deactivateTool:u}}),jd=()=>({firstPoint:[0,0,0],secondPoint:[0,0,0],id:"",name:"Rectangle",fillColor:"transparent"}),Gd={color:"#ffffff",fillColor:"transparent"},Fe=te("rectangles",()=>{const{serialize:e,deserialize:t,...n}=go({toolDefaults:jd,initialLabels:sd,newLabelDefault:Gd});function a(i){i.manifest.tools.rectangles=e()}function o(i,s){t.call(this,i.tools.rectangles,s)}return{...n,serialize:a,deserialize:o}});function ka(){return{t:mt(),_tInv:null}}const Bt=Le(),ei=pi();function Cn(e,t,n){const a=n??Le();return vi(Bt,e[0],e[1],0),pe(a,Bt,t.t),a}function Ma(e){const t=mt();return Fs(t,e),t}function Xd(e){return e._tInv=e._tInv??Ma(e.t),e._tInv}function et(e,t,n){const a=n??Me(),o=Xd(t);return pe(Bt,e,o),vt(a,Bt[0],Bt[1]),a}function qd(e){const t=[0,0,0];pe(t,t,e.t);const n=[0,0,1];return Ns(ei,e.t),$s(n,n,ei),Us(n,n),{planeNormal:n,planeOrigin:t}}const Yd={0:Pt(0,1,0,0,0,0,1,0,1,0,0,0,0,0,0,1),1:Pt(1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1),2:mt()};function Kd(e,t,n){const a=mt();return Hs(a,[0,0,t]),Vo(a,Yd[n],a),Vo(a,e,a),{t:a,_tInv:Ma(a)}}var ye=(e=>(e.Select="Select",e.FreehandDraw="FreehandDraw",e.CircleNudge="CircleNudge",e.PointPlacing="PointPlacing",e.Threshold="Threshold",e))(ye||{});const Qd=()=>({id:"",name:"Contour",polyLine:[],referencePlane:ka()}),bn=te("contour",()=>{const e=M(),t=M("FreehandDraw"),{serialize:n,deserialize:a,...o}=go({toolDefaults:Qd,initialLabels:{"Default label":{color:"#ff0000"}},newLabelDefault:{color:"#ff0000"}});function i(l){e.value=l}function s(l){return e.value===l&&(e.value=null),o.removeTool(l)}function r(l){t.value=l}return{...o,removeTool:s,serialize:()=>{},deserialize:()=>{},selectedContourID:e,mode:t,selectContour:i,setMode:r}});function Ba(e){return e===ne.Ruler?Ae():e===ne.Rectangle?Fe():e===ne.Paint?rt():e===ne.Crosshairs?zt():e===ne.Contour?bn():null}function Jd(e){const t=Ba(e);return t?t.activateTool():!0}function Zd(e){const t=Ba(e);t&&t.deactivateTool()}const Oe=te("tool",{state:()=>({currentTool:ne.WindowLevel}),actions:{setCurrentTool(e){Jd(e)&&(Zd(this.currentTool),this.currentTool=e)},serialize(e){const{tools:t}=e.manifest,n=Ae(),a=Fe(),o=zt(),i=rt(),s=bt();n.serialize(e),a.serialize(e),o.serialize(e),i.serialize(e),s.serialize(e),t.current=this.currentTool},deserialize(e,t,n){const{tools:a}=e,o=Ae(),i=Fe(),s=zt(),r=rt(),l=bt();o.deserialize(e,n),i.deserialize(e,n),s.deserialize(e),r.deserialize(e,t),l.deserialize(e,n),this.currentTool=a.current}}}),Aa="manifest.json";async function eh(e){const t=await fl(e);return Ni.has(t.type)?(await mi.loadAsync(t)).file(Aa)!==null:!1}const fo=(e,{done:t})=>t({dataSource:e}),Tn=async e=>{let t=e;const{fileSrc:n}=t;if(n&&n.fileType===""){const a=await $i(n.file);a&&(t={...t,fileSrc:{...n,fileType:a}})}return t},th=async(e,{extra:t,done:n})=>{const{uriSrc:a}=e;if(a){const o=await new Sn([Sa,Tn,fo]).execute(e,t);if(!o.ok)throw o.errors[0].cause;return n({dataSource:o.data[0].dataSource})}return e},nh=async(e,{execute:t})=>{const{fileSrc:n,parent:a}=e;if(!n&&a){const o=await t(a);if(!o.ok)throw new Error("Could not process parent",{cause:wl(o.errors[0].cause)});return{...e,parent:o.data[0].dataSource}}return e},oh=async(e,{extra:t,done:n})=>{if(e.archiveSrc){const o=await new Sn([Ca,Tn,fo]).execute(e,t);if(!o.ok)throw o.errors[0].cause;return n({dataSource:o.data[0].dataSource})}return e};function ih(e,t,n){const a=n.filter(i=>St(i.archivePath)===St(e.path)).map(i=>io(i.file)),o=t.remoteFiles[e.id]??[];return[...a,...o]}async function ah(e,t,{extra:n,execute:a}){const o=new Map,i=t.map(c=>({...c,archivePath:St(c.archivePath)})),{datasets:s}=e,r={},l=new Sn([Tn,th,nh,oh,fo]);return await Promise.all(s.map(async c=>{let u=ih(c,e,i);u=await Promise.all(u.map(async v=>{const p=await l.execute(v,{...n,archiveCache:o});if(!p.ok)throw p.errors[0].cause;return p.data[0].dataSource}));const d=[],h=await Promise.all(u.map(v=>a(v,{...n,archiveCache:o,dicomDataSources:d})));if(d.length){const v=_e(),p=await v.importFiles(d);if(p.length!==1)throw new Error("Obtained more than one volume from DICOM import");const[f]=p;await v.buildVolume(f),r[c.id]=f}else if(h.length===1){if(!h[0].ok)throw h[0].errors[0].cause;const[v]=h;if(v.data.length!==1)throw new Error("Import encountered multiple volumes for a single dataset");const{dataID:p}=v.data[0];if(!p)throw new Error("Failed to import dataset");r[c.id]=p}else throw new Error("Could not load any data from the session")})),r}const sh=async(e,{done:t,extra:n,execute:a})=>{const{fileSrc:o}=e;if(o&&await eh(o.file)){const i=await ro(o.file),[s,r]=Kt(d=>d.file.name===Aa,i);if(s.length!==1)throw new Error("State file does not have exactly 1 manifest");const l=Cu.parse(JSON.parse(await s[0].file.text()));de().setLayout(l.layout);const c=await ah(l,r,{extra:n,execute:a,done:t});if(l.primarySelection!==void 0){const d=c[l.primarySelection];let h;d in _e().volumeInfo?h=Ut(d):h=Ht(d),Rt().setPrimarySelection(h)}de().deserialize(l.views,c);const u=await fn().deserialize(l,r,c);return Oe().deserialize(l,u,c),xt().deserialize(l,c),t()}return e},Fa=C.string(),po=C.object({color:Fa}),rh=po,lh=C.intersection(po,C.object({fillColor:Fa})),ch=C.object({labels:C.record(po).or(C.null()).optional(),rulerLabels:C.record(rh).or(C.null()).optional(),rectangleLabels:C.record(lh).or(C.null()).optional()}),uh=async e=>{const t=new TextDecoder,n=await e.arrayBuffer(),a=t.decode(new Uint8Array(n));return ch.parse(JSON.parse(a))},dh=e=>{const t=n=>n===void 0?e.labels:n;Ae().mergeLabels(t(e.rulerLabels)),Fe().mergeLabels(t(e.rectangleLabels))},hh=async(e,{done:t})=>{const{fileSrc:n}=e;if((n==null?void 0:n.fileType)==="application/json"){try{const a=await uh(n.file);dh(a)}catch{return e}return t()}return e};function Na(e){if(e.data.length===0)return null;const{dataID:t,dataType:n}=e.data[0];return t?n==="dicom"?Ut(t):n==="image"?Ht(t):null:null}function gh(e){const t=String(e);return!t||t==="[object Object]"?"Unknown error. More details in the dev console.":t}const fh=()=>{throw new Error("Failed to handle resource")};async function $a(e){const t=[Tn,hh,sh,Zu,qu,Hu,Sa,Ca,Mu,Lu,Yu,fh],n={fetchFileCache:new Map,dicomDataSources:[]},a=new Sn(t),o=await Promise.all(e.map(r=>a.execute(r,n)));if(!n.dicomDataSources.length)return o;const i={dicomSrc:{sources:n.dicomDataSources}},s={ok:!0,data:[],errors:[]};try{const r=await _e().importFiles(n.dicomDataSources);s.data.push(...r.map(l=>({dataID:l,dataType:"dicom",dataSource:i})))}catch(r){s.ok=!1,s.errors.push({message:gh(r),cause:r,inputDataStackTrace:[i]})}return[...o.filter(r=>r.data.length),s]}const ph={name:"ToolButton",props:{icon:{type:String,required:!0},name:{type:String,required:!0},size:{type:[Number,String],default:40},buttonClass:[String,Array,Object],tooltipLocation:{type:String,default:"right"}},computed:{sizeV(){return Number(this.size)},iconSize(){return Math.floor(.6*this.sizeV)},classV(){const e=this.buttonClass;return typeof e=="string"?e:Array.isArray(e)?e.join(" "):e&&Object.keys(e).length?Object.keys(this.buttonClass).filter(t=>this.buttonClass[t]).join(" "):""}}};function mh(e,t,n,a,o,i){return R(),K(ft,Xt({variant:"text",rounded:0,dark:"",height:i.sizeV,width:i.sizeV,"min-width":i.sizeV,"max-width":i.sizeV,class:i.classV},e.$attrs),{default:x(()=>[y(yt,{size:i.iconSize},{default:x(()=>[H(U(n.icon),1)]),_:1},8,["size"]),y(bi,{location:n.tooltipLocation,activator:"parent",transition:"slide-x-transition"},{default:x(()=>[g("span",null,U(n.name),1)]),_:1},8,["location"]),be(e.$slots,"default")]),_:3},16,["height","width","min-width","max-width","class"])}const $e=A(ph,[["render",mh]]),Ua=Symbol("ItemGroup"),Ha=X({props:{modelValue:null,mandatory:Boolean,equalsTest:Function},setup(e,{emit:t,slots:n}){const{modelValue:a,mandatory:o,equalsTest:i}=ae(e),s=M();return F(a,c=>{c!==s.value&&(s.value=c)}),ee(()=>{s.value=a.value}),Nn(Ua,{selectItem:c=>{o.value&&!c||(s.value=c,t("update:modelValue",s.value))},isSelected:c=>s.value==null?!1:i.value?i.value(c,s.value):c===s.value}),()=>{var c;return(c=n.default)==null?void 0:c.call(n)}}}),Wa=X({props:{value:{type:null,required:!0}},setup(e,{slots:t}){const{value:n}=ae(e),a=lt(Ua);if(!a)throw new Error("GroupableItem needs ItemGroup!");const o=()=>{a.selectItem(n.value)},i=()=>{a&&a.selectItem(a.isSelected(n.value)?void 0:n.value)};return()=>{var s;return(s=t.default)==null?void 0:s.call(t,{active:a.isSelected(n.value),select:o,toggle:i})}}});function za(e){return`#${e.map(n=>`0${n.toString(16)}`.slice(-2)).join("")}`}function vh(e){const t=e.startsWith("#")?e.substring(1):e,n=[0,0,0,255],a=Math.min(4,t.length/2);for(let o=0;o<a;o++)n[o]=Number.parseInt(t.substring(2*o,2*o+2),16);return n}function yh(e,t=5){const n={},a=[],o=Object.entries(e);for(;o.length;){const[i,s]=o.shift(),r=za(s).toUpperCase();n[r]=Number(i);let l=a[a.length-1];(!l||l.length===t)&&(l=[],a.push(l)),l.push(r)}return{hexToValue:n,swatches:a}}const wh=X({name:"PaintControls",setup(){const e=rt(),{hexToValue:t,swatches:n}=yh(Mt,3),a=I(()=>{const c=e.brushValue;return c in Mt?za(Mt[c]):null}),o=c=>{const u=`${c}FF`.toUpperCase();u in t&&e.setBrushValue(t[u])},i=I(()=>e.brushSize),s=c=>{e.setBrushSize(Number(c))},r=I(()=>e.labelmapOpacity);return{brushSize:i,setBrushSize:s,swatches:n,brushColor:a,setBrushColor:o,opacity:r,setOpacity:c=>{e.setLabelmapOpacity(Number(c))}}}});function Sh(e,t,n,a,o,i){return R(),K(qt,{width:"350px"},{default:x(()=>[y(Ii,null,{default:x(()=>[y(dn,{"no-gutters":"",align:"center"},{default:x(()=>[y(kt,null,{default:x(()=>[y(Po,{"model-value":e.brushSize,"onUpdate:modelValue":e.setBrushSize,density:"compact","hide-details":"",label:"Size",min:"1",max:"50"},{append:x(()=>[y($n,{"model-value":e.brushSize,onInput:e.setBrushSize,variant:"underlined",class:"mt-n1 pt-0",style:{width:"40px"},"hide-details":"",type:"number",min:"1",max:"50"},null,8,["model-value","onInput"])]),_:1},8,["model-value","onUpdate:modelValue"])]),_:1})]),_:1}),y(dn,{"no-gutters":"",align:"center"},{default:x(()=>[y(kt,null,{default:x(()=>[y(Po,{"model-value":e.opacity,"onUpdate:modelValue":e.setOpacity,density:"compact","hide-details":"",label:"Opacity",min:"0",max:"1",step:"0.01"},{append:x(()=>[y($n,{"model-value":e.opacity,onInput:e.setOpacity,variant:"underlined",class:"mt-n1 pt-0",style:{width:"40px"},"hide-details":"",type:"number",min:"0",max:"1",step:"0.1"},null,8,["model-value","onInput"])]),_:1},8,["model-value","onUpdate:modelValue"])]),_:1})]),_:1}),y(dn,{"no-gutters":"",align:"center"},{default:x(()=>[y(kt,null,{default:x(()=>[y(Ti,{"hide-canvas":"","hide-inputs":"","hide-mode-switch":"","hide-sliders":"","show-swatches":"",elevation:"0",swatches:e.swatches,"model-value":e.brushColor,"onUpdate:modelValue":e.setBrushColor},null,8,["swatches","model-value","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})}const ja=A(wh,[["render",Sh],["__scopeId","data-v-6027fe65"]]),_h=X({name:"MenuToolButton",props:{icon:{type:String,required:!0},name:{type:String,required:!0},size:{type:[Number,String],default:40},active:Boolean,disabled:Boolean,mobileOnlyMenu:Boolean},components:{ToolButton:$e},setup(e){const t=Kn(),n=I(()=>!t.mobile.value),a=M(!1),o=I(()=>!e.mobileOnlyMenu||t.mobile.value);F(a,s=>{a.value=s&&o.value});const i=I(()=>e.active);return F(i,s=>{s||(a.value=!1)}),{showLeft:n,menuOn:a,enableMenu:o}}});const Ch={class:"menu-content elevation-24"};function bh(e,t,n,a,o,i){const s=P("tool-button");return R(),K(wt,{"no-click-animation":"","close-on-content-click":!1,modelValue:e.menuOn,"onUpdate:modelValue":t[1]||(t[1]=r=>e.menuOn=r),location:e.showLeft?"left":"right",class:"overflow-auto"},{activator:x(({props:r})=>[y(s,Xt({icon:e.icon,name:e.name,buttonClass:["tool-btn",e.active?"tool-btn-selected":""],disabled:e.disabled,size:e.size,onClick:t[0]||(t[0]=l=>e.$emit("click"))},r),{default:x(()=>[e.active&&e.enableMenu?(R(),K(yt,{key:0,class:N([e.showLeft?"menu-more-left":"menu-more-right"]),size:"18"},{default:x(()=>[H(U(e.showLeft?"mdi-menu-left":"mdi-menu-right"),1)]),_:1},8,["class"])):j("",!0)]),_:2},1040,["icon","name","buttonClass","disabled","size"])]),default:x(()=>[g("div",Ch,[be(e.$slots,"default",{},void 0,!0)])]),_:3},8,["modelValue","location"])}const Ga=A(_h,[["render",bh],["__scopeId","data-v-b1e30b7b"]]),Th=X({components:{ToolButton:$e},setup(){const{currentImageID:e}=se(),t=bt();return{resetCrop:()=>{const a=e.value;a&&t.resetCropping(a)}}}});function Ih(e,t,n,a,o,i){const s=P("tool-button");return R(),K(qt,{dark:""},{default:x(()=>[y(s,{size:"40",icon:"mdi-restore",name:"Reset Crop",onClick:e.resetCrop},null,8,["onClick"])]),_:1})}const Xa=A(Th,[["render",Ih]]),Rh={class:"d-flex flex-row"},xh={class:"flex-grow-1 d-flex flex-column justify-space-between mr-4"},Dh=X({__name:"LabelEditor",props:{label:null,labelsStore:null},emits:["close"],setup(e,{emit:t}){const n=e,a=I(()=>n.labelsStore.labels[n.label]),o=M(a.value.labelName);F(o,r=>{n.labelsStore.updateLabel(n.label,{labelName:r})});const i=M(Sl(a.value.color));F(i,r=>{n.labelsStore.updateLabel(n.label,{color:r})});const s=()=>{t("close"),n.labelsStore.deleteLabel(n.label)};return(r,l)=>(R(),K(qt,null,{default:x(()=>[y(pr,{class:"d-flex flex-row align-center"},{default:x(()=>[H(" Edit Label "),y(ko),y(ft,{variant:"text",density:"compact",icon:"mdi-close",onClick:l[0]||(l[0]=c=>r.$emit("close"))})]),_:1}),y(vr,null,{default:x(()=>[g("div",Rh,[g("div",xh,[g("div",null,[y($n,{modelValue:o.value,"onUpdate:modelValue":l[1]||(l[1]=c=>o.value=c),onKeydown:l[2]||(l[2]=Pe(oe(c=>r.$emit("close"),["stop"]),["enter"])),label:"Name",class:"flex-grow-0"},null,8,["modelValue"])]),y(mr,{class:"mb-2 px-0"},{default:x(()=>[y(ft,{color:"secondary",variant:"elevated",onClick:l[3]||(l[3]=c=>r.$emit("close"))},{default:x(()=>[H(" Done ")]),_:1}),y(ko),y(ft,{color:"red",variant:"tonal",onClick:s},{default:x(()=>[H(" Delete label ")]),_:1})]),_:1})]),y(Ti,{modelValue:i.value,"onUpdate:modelValue":l[4]||(l[4]=c=>i.value=c),mode:"rgb",label:"Color"},null,8,["modelValue"])])]),_:1})]),_:1}))}}),Eh={class:"dot-container mr-3"},Lh={class:"overflow-hidden"},Oh=X({__name:"LabelControls",props:{labelsStore:null},setup(e){const t=e,n=I(()=>Object.entries(t.labelsStore.labels)),a=I(()=>n.value.findIndex(([c])=>c===t.labelsStore.activeLabel)),o=M(void 0),i=()=>{o.value=t.labelsStore.addLabel()},s=M(!1);fe(()=>{s.value=!!o.value});const r=Kn(),l=I(()=>r.mobile.value);return(c,u)=>(R(),E(ue,null,[y(qt,{class:"pt-2"},{default:x(()=>[y(Ri,null,{default:x(()=>[H("Labels")]),_:1}),y(Ii,null,{default:x(()=>[y(xi,{"model-value":z(a),"selected-class":"card-active",mandatory:""},{default:x(()=>[y(dn,{dense:""},{default:x(()=>[(R(!0),E(ue,null,Be(z(n),([d,{labelName:h,color:v}])=>(R(),K(kt,{cols:"6",key:d},{default:x(()=>[y(ht,null,{default:x(({selectedClass:p,toggle:f})=>[y(Mo,{variant:"tonal",class:N(["w-100 d-flex",p]),onClick:()=>{f(),e.labelsStore.setActiveLabel(d)}},{default:x(()=>[g("div",Eh,[g("div",{class:"color-dot",style:ie({background:v})},null,4)]),g("span",Lh,U(h),1),y(ft,{icon:"mdi-pencil",density:"compact",class:"ml-auto",variant:"plain",onClick:oe(()=>{o.value=d,s.value=!0},["stop"])},null,8,["onClick"])]),_:2},1032,["class","onClick"])]),_:2},1024)]),_:2},1024))),128)),y(kt,{cols:"6"},{default:x(()=>[y(Mo,{variant:"outlined",class:"w-100",onClick:i},{default:x(()=>[y(yt,{class:"mr-2"},{default:x(()=>[H("mdi-plus")]),_:1}),H(" Add Label ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])]),_:1})]),_:1}),y(yr,{modelValue:s.value,"onUpdate:modelValue":u[1]||(u[1]=d=>s.value=d),width:z(l)?"100%":"50%"},{default:x(()=>[o.value?(R(),K(Dh,{key:0,onClose:u[0]||(u[0]=d=>o.value=void 0),label:o.value,labelsStore:e.labelsStore},null,8,["label","labelsStore"])):j("",!0)]),_:1},8,["modelValue","width"])],64))}});const mo=A(Oh,[["__scopeId","data-v-3ba66c80"]]),qa=X({__name:"RulerControls",setup(e){const t=Ae();return(n,a)=>(R(),K(mo,{"labels-store":z(t)},null,8,["labels-store"]))}}),Ya=X({__name:"RectangleControls",setup(e){const t=Fe();return(n,a)=>(R(),K(mo,{"labels-store":z(t)},null,8,["labels-store"]))}}),Ka=X({__name:"ContourControls",setup(e){const t=bn(),{mode:n}=tt(t);function a(o){t.setMode(o)}return(o,i)=>(R(),K(qt,{dark:""},{default:x(()=>[y(Ri,{class:"my-1"},{default:x(()=>[H("Tools")]),_:1}),y(xi,{mandatory:"","selected-class":"tool-btn-selected","model-value":z(n),"onUpdate:modelValue":a},{default:x(()=>[y(ht,{value:z(ye).Select},{default:x(({selectedClass:s,toggle:r})=>[y($e,{size:"40",icon:"mdi-cursor-default",name:"Select",buttonClass:s||"",onClick:r},null,8,["buttonClass","onClick"])]),_:1},8,["value"]),y(ht,{value:z(ye).FreehandDraw},{default:x(({selectedClass:s,toggle:r})=>[y($e,{size:"40",icon:"mdi-draw",name:"Freehand",buttonClass:s||"",onClick:r},null,8,["buttonClass","onClick"])]),_:1},8,["value"]),y(ht,{value:z(ye).PointPlacing},{default:x(({selectedClass:s,toggle:r})=>[y($e,{size:"40",icon:"mdi-vector-polyline",name:"Point Placing",buttonClass:s||"",onClick:r},null,8,["buttonClass","onClick"])]),_:1},8,["value"]),y(ht,{value:z(ye).Threshold},{default:x(({selectedClass:s,toggle:r})=>[y($e,{size:"40",icon:"mdi-math-integral",name:"Threshold",buttonClass:s||"",onClick:r},null,8,["buttonClass","onClick"])]),_:1},8,["value"]),y(ht,{value:z(ye).CircleNudge},{default:x(({selectedClass:s,toggle:r})=>[y($e,{size:"40",icon:"mdi-circle-multiple-outline",name:"Nudge",buttonClass:s||"",onClick:r},null,8,["buttonClass","onClick"])]),_:1},8,["value"])]),_:1},8,["model-value"]),y(mo,{"labels-store":z(t)},null,8,["labels-store"])]),_:1}))}});const Vh=X({components:{ToolButton:$e,MenuToolButton:Ga,ItemGroup:Ha,GroupableItem:Wa,PaintControls:ja,CropControls:Xa,RulerControls:qa,RectangleControls:Ya,ContourControls:Ka},setup(){const e=Rt(),t=Oe();console.log(tt(t));const n=I(()=>!e.primaryDataset),a=I(()=>t.currentTool),o=Fe(),i=Ae(),s=M(!1),r=M(!1);return At("Escape",()=>{s.value=!1,r.value=!1}),{currentTool:a,setCurrentTool:t.setCurrentTool,noCurrentImage:n,Tools:ne,paintMenu:s,cropMenu:r,rectangleStore:o,rulerStore:i}}});function Ph(e,t,n,a,o,i){const s=P("tool-button"),r=P("groupable-item"),l=P("paint-controls"),c=P("menu-tool-button"),u=P("rectangle-controls"),d=P("ruler-controls"),h=P("contour-controls"),v=P("crop-controls"),p=P("item-group");return R(),K(p,{mandatory:"","model-value":e.currentTool,"onUpdate:modelValue":t[0]||(t[0]=f=>e.setCurrentTool(f))},{default:x(()=>[y(r,{value:e.Tools.WindowLevel},{default:x(({active:f,toggle:m})=>[y(s,{icon:"mdi-circle-half-full",name:"Window & Level",buttonClass:["tool-btn",f?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Pan},{default:x(({active:f,toggle:m})=>[y(s,{icon:"mdi-cursor-move",name:"Pan",buttonClass:["tool-btn",f?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Zoom},{default:x(({active:f,toggle:m})=>[y(s,{icon:"mdi-magnify-plus-outline",name:"Zoom",buttonClass:["tool-btn",f?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Crosshairs},{default:x(({active:f,toggle:m})=>[y(s,{icon:"mdi-crosshairs",name:"Crosshairs",buttonClass:["tool-btn",f?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Paint},{default:x(({active:f,toggle:m})=>[y(c,{icon:"mdi-brush",name:"Paint",active:f,disabled:e.noCurrentImage,onClick:m},{default:x(()=>[y(l)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Rectangle},{default:x(({active:f,toggle:m})=>[y(c,{icon:"mdi-vector-square",name:"Rectangle",mobileOnlyMenu:!0,active:f,disabled:e.noCurrentImage,onClick:m},{default:x(()=>[y(u)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Ruler},{default:x(({active:f,toggle:m})=>[y(c,{icon:"mdi-ruler",name:"Ruler",mobileOnlyMenu:!0,active:f,disabled:e.noCurrentImage,onClick:m},{default:x(()=>[y(d)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Contour},{default:x(({active:f,toggle:m})=>[y(c,{icon:"mdi-shape-circle-plus",name:"Contour",active:f,disabled:e.noCurrentImage,onClick:m},{default:x(()=>[y(h)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Crop},{default:x(({active:f,toggle:m})=>[y(c,{icon:"mdi-crop",name:"Crop",active:f,disabled:e.noCurrentImage,onClick:m},{default:x(()=>[y(v)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"])]),_:1},8,["model-value"])}const kh=A(Vh,[["render",Ph],["__scopeId","data-v-63968322"]]);function jt(e){Ne(()=>e.unsubscribe())}function Mh(e,t=!1){const n=M(t);let a=!0;const o={position:[0,0,0],parallelScale:0};jt(e.onModified(()=>{if(a&&n.value){const r=e.getPosition(),l=e.getParallelScale();(!at(r,o.position)||l!==o.parallelScale)&&(n.value=!1)}}));function i(r){if(a){a=!1;try{r()}finally{a=!0}}}function s(){o.position=e.getPosition(),o.parallelScale=e.getParallelScale()}return{resizeToFit:n,ignoreResizeToFitTracking:i,resetResizeToFitTracking:s}}function Bh(e){if(!e||e==="none")return 0;const t=e.match(/matrix(?:3d)?\((.+)\)/)[1].split(",").map(a=>Number(a));return e.includes("3d")?t[13]:t[5]}const Ah={props:{slice:{type:Number,default:0},min:{type:Number,required:!0},max:{type:Number,required:!0},step:{type:Number,required:!0},handleHeight:{type:Number,default:20}},data(){return{maxHandlePos:0,dragging:!1,initialHandlePos:0,initialMousePosY:0,yOffset:0}},computed:{handlePosition(){const e=this.max-this.min<=0?1:this.max-this.min,t=this.maxHandlePos*((this.slice-this.min)/e);return this.dragging?this.draggingHandlePos:t},draggingHandlePos(){return Math.min(Math.max(0,this.initialHandlePos+this.yOffset),this.maxHandlePos)}},mounted(){this.updateMaxHandlePos(),this.resizeObserver=new ResizeObserver(e=>{e.length===1&&this.updateMaxHandlePos()}),this.resizeObserver.observe(this.$refs.handleContainer)},beforeUnmount(){this.resizeObserver.disconnect()},methods:{updateMaxHandlePos(){this.maxHandlePos=this.$refs.handleContainer.clientHeight-this.handleHeight},onDragStart(e){if(e.preventDefault(),this.dragging=!0,this.initialMousePosY=e.pageY,e.target===this.$refs.handle){const t=window.getComputedStyle(this.$refs.handle);this.initialHandlePos=Bh(t.transform)}else{const{y:t}=this.$refs.handleContainer.getBoundingClientRect();this.initialHandlePos=Math.max(0,Math.min(this.maxHandlePos,e.pageY-t-this.handleHeight/2));const n=this.getNearestSlice(this.initialHandlePos);this.$emit("input",n)}this.yOffset=0,this.$refs.handleContainer.setPointerCapture(e.pointerId)},onDragMove(e){if(!this.$refs.handleContainer.hasPointerCapture(e.pointerId))return;e.preventDefault(),this.yOffset=e.pageY-this.initialMousePosY;const t=this.getNearestSlice(this.handlePosition);this.$emit("input",t)},onDragEnd(e){if(!this.$refs.handleContainer.hasPointerCapture(e.pointerId))return;e.preventDefault(),this.$refs.handleContainer.releasePointerCapture(e.pointerId),this.dragging=!1;const t=this.getNearestSlice(this.handlePosition);this.$emit("input",t)},getNearestSlice(e){const n=e/this.maxHandlePos*(this.max-this.min)+this.min;return Math.round(n/this.step)*this.step}}},Fh=e=>(le("data-v-45b64a9f"),e=e(),ce(),e),Nh=Fh(()=>g("div",{class:"slice-slider-track"},null,-1));function $h(e,t,n,a,o,i){return R(),E("div",{class:"slice-slider",ref:"handleContainer",onPointerdown:t[0]||(t[0]=(...s)=>i.onDragStart&&i.onDragStart(...s)),onPointermove:t[1]||(t[1]=(...s)=>i.onDragMove&&i.onDragMove(...s)),onPointerup:t[2]||(t[2]=(...s)=>i.onDragEnd&&i.onDragEnd(...s)),onPointercancel:t[3]||(t[3]=(...s)=>i.onDragEnd&&i.onDragEnd(...s)),onContextmenu:t[4]||(t[4]=s=>s.preventDefault())},[Nh,g("div",{class:"slice-slider-handle",ref:"handle",style:ie({height:`${n.handleHeight}px`,transform:`translate3d(0, ${i.handlePosition}px, 0)`})},null,4)],544)}const Uh=A(Ah,[["render",$h],["__scopeId","data-v-45b64a9f"]]),Hh="_gridRoot_102tk_2",Wh="_row_102tk_9",zh="_cell_102tk_16",jh="_top_102tk_20",Gh="_left_102tk_21",Xh="_center_102tk_25",qh="_middle_102tk_26",Yh="_bottom_102tk_30",Kh="_right_102tk_31",Qh={gridRoot:Hh,row:Wh,cell:zh,top:jh,left:Gh,center:Xh,middle:qh,bottom:Yh,right:Kh},Jh={};function Zh(e,t){return R(),E("div",{class:N(e.$style.gridRoot)},[g("div",{class:N([e.$style.top,e.$style.row])},[g("div",{class:N([e.$style.left,e.$style.cell])},[be(e.$slots,"top-left")],2),g("div",{class:N([e.$style.center,e.$style.cell])},[be(e.$slots,"top-center")],2),g("div",{class:N([e.$style.right,e.$style.cell])},[be(e.$slots,"top-right")],2)],2),g("div",{class:N([e.$style.middle,e.$style.row])},[g("div",{class:N([e.$style.left,e.$style.cell])},[be(e.$slots,"middle-left")],2),g("div",{class:N([e.$style.center,e.$style.cell])},[be(e.$slots,"middle-center")],2),g("div",{class:N([e.$style.right,e.$style.cell])},[be(e.$slots,"middle-right")],2)],2),g("div",{class:N([e.$style.bottom,e.$style.row])},[g("div",{class:N([e.$style.left,e.$style.cell])},[be(e.$slots,"bottom-left")],2),g("div",{class:N([e.$style.center,e.$style.cell])},[be(e.$slots,"bottom-center")],2),g("div",{class:N([e.$style.right,e.$style.cell])},[be(e.$slots,"bottom-right")],2)],2)],2)}const eg={$style:Qh},tg=A(Jh,[["render",Zh],["__cssModules",eg]]);function In(e,t){const n=new ResizeObserver(a=>{a.length===1&&t(a[0])});return F(e,(a,o)=>{o&&n.unobserve(o),a&&n.observe(a)},{immediate:!0}),we(()=>{const a=z(e);a&&n.unobserve(a)}),n}function Se(e){return n=>{let a=null;const o=()=>{a==null||a.unsubscribe(),a=null};Ne(o),Ws(e)?fe(()=>{o(),e.value&&(a=e.value(n))}):e&&(a=e(n))}}function cn(e){return e.map((t,n)=>({value:t,axis:n})).filter(({value:t})=>Math.abs(t)>Yn).sort((t,n)=>Math.abs(n.value)-Math.abs(t.value)).map(({value:t,axis:n})=>(Math.sign(t)===1?"LPS":"RAI")[n]).join("")}function ng(e){const t=I(()=>e.value.getCamera()),n=M(""),a=M(""),o=M(""),i=M("");function s(){const l=t.value.getViewUp(),c=t.value.getDirectionOfProjection(),u=[0,0,0];Gn(u,c,l);const d=l.map(v=>v*-1),h=u.map(v=>v*-1);n.value=cn(l),i.value=cn(u),o.value=cn(d),a.value=cn(h)}return Se(I(()=>t.value.onModified))(s),s(),{top:n,right:i,bottom:o,left:a}}function og(e,t,n){const a=I(()=>n.value.orientation),o=I(()=>sa(a.value)),i=I(()=>o.value[z(e)]),s=I(()=>o.value[z(t)]);return{cameraDirVec:i,cameraUpVec:s}}function un(e,t){return Math.min(t-e,1)/256}const ig=X({name:"WindowLevelTool",props:{viewId:{type:String,required:!0}},setup(e){const{viewId:t}=ae(e),n=co(),a=de(),{currentImageID:o}=se(),i=I(()=>a.getViewProxy(t.value)),s=Ea(),r=I(()=>n.getConfig(t.value,o.value)),l=I(()=>({min:1e-12,max:r.value!=null?r.value.max-r.value.min:s.max,step:r.value!=null?un(r.value.min,r.value.max):un(s.min,s.max)})),c=I(()=>({min:r.value!=null?r.value.min:s.min,max:r.value!=null?r.value.max:s.max,step:r.value!=null?un(r.value.min,r.value.max):un(s.min,s.max)})),u=I(()=>r.value!=null?r.value.width:s.width),d=I(()=>r.value!=null?r.value.level:s.level),h=Pi.newInstance({button:1,scrollEnabled:!1});F(i,(p,f)=>{f&&f.getInteractorStyle2D().removeMouseManipulator(h),p&&i.value.getInteractorStyle2D().addMouseManipulator(h)},{immediate:!0}),we(()=>{i.value.isDeleted()||i.value.getInteractorStyle2D().removeMouseManipulator(h)});function v(){h.removeAllListeners();const p=l.value,f=c.value;h.setVerticalListener(p.min,p.max,p.step,()=>u.value,m=>{o.value!=null&&n.updateConfig(t.value,o.value,{width:m})}),h.setHorizontalListener(f.min,f.max,f.step,()=>d.value,m=>{o.value!=null&&n.updateConfig(t.value,o.value,{level:m})})}return F(()=>JSON.stringify({w:l.value,l:c.value}),v,{immediate:!0}),()=>null}});function ag(e){const t=Oe();return I(()=>t.currentTool===ne.WindowLevel).value?Xn(ig,e):[]}const sg=X({name:"SliceScrollTool",props:{viewId:{type:String,required:!0}},setup(e){const{viewId:t}=ae(e),n=Dt(),a=de(),{currentImageID:o}=se(),i=I(()=>a.getViewProxy(t.value)),s=lo(),r=I(()=>n.getConfig(t.value,o.value)),l=I(()=>({min:r.value!=null?r.value.min:s.min,max:r.value!=null?r.value.max:s.max,step:1,default:r.value!=null?r.value.slice:s.slice})),c=M(0),u=Pi.newInstance({button:-1,scrollEnabled:!0});F(i,(h,v)=>{v&&v.getInteractorStyle2D().removeMouseManipulator(u),h&&i.value.getInteractorStyle2D().addMouseManipulator(u)},{immediate:!0}),we(()=>{i.value.isDeleted()||i.value.getInteractorStyle2D().removeMouseManipulator(u)});function d(){u.removeAllListeners();const h=l.value;u.setScrollListener(h.min,h.max,h.step,()=>c.value,v=>{o.value!==null&&n.updateConfig(t.value,o.value,{slice:v})})}return F(l,h=>{c.value=h.default,d()},{immediate:!0}),()=>null}}),Qa=X({name:"MouseManipulatorTool",props:{name:String,viewId:{type:String,required:!0},manipulatorClass:{type:Object,required:!0},options:{type:Array,default:()=>[]}},setup(e){const{viewId:t,options:n}=ae(e),a=de(),o=I(()=>a.getViewProxy(t.value)),i=I(()=>o.value.isA("vtkView2DProxy")?o.value.getInteractorStyle2D():o.value.getInteractorStyle3D()),s=[];function r(l,c,u){l!==null&&(u.forEach(d=>l.removeMouseManipulator(d)),c.forEach(d=>l.addMouseManipulator(d)))}return F(n,l=>{for(;s.length>l.length;){const u=s.pop();i.value.removeMouseManipulator(u),u.delete()}const c=Array.from(s);for(let u=s.length;u<l.length;++u)s.push(e.manipulatorClass.newInstance(l[u]));l.forEach((u,d)=>{"button"in u&&s[d].setButton(u.button),s[d].setShift(!!u.shift),s[d].setControl(!!u.control)}),r(i.value,s,c)},{immediate:!0}),F(i,(l,c)=>{s.forEach(u=>{c&&c.removeMouseManipulator(u),l&&l.addMouseManipulator(u)})},{immediate:!0}),we(()=>{o.value.isDeleted()||s.forEach(l=>i.value.removeMouseManipulator(l))}),()=>null}});function rg(e){const t=Oe(),n=[];return n.push({button:2}),n.push({button:1,shift:!0}),t.currentTool===ne.Pan&&n.push({button:1}),Xn(Qa,{...e,name:"PanTool",manipulatorClass:Gr,options:n})}function lg(e){const t=Oe(),n=[];return n.push({button:3,flipDirection:!0}),n.push({button:1,control:!0,flipDirection:!0}),t.currentTool===ne.Zoom&&n.push({button:1,flipDirection:!0}),Xn(Qa,{...e,name:"ZoomTool",manipulatorClass:Xr,options:n})}var Gt=(e=>(e.PlacingFirst="PlacingFirst",e.PlacingSecond="PlacingSecond",e.Select="Select",e.Dragging="Dragging",e))(Gt||{});function ti(e){return e.altKey||e.controlKey||e.shiftKey}function cg(e,t){t.classHierarchy.push("vtkRulerWidgetProp"),t.interactionState="Select";let n=null;_.setGet(e,t,["interactionState"]),_.setGet(e,t,["manipulator"]),_.event(e,t,"RightClickEvent"),_.event(e,t,"PlacedEvent"),e.deactivateAllHandles=()=>{t.widgetState.deactivate(),t.activeState=null},e.setFirstPoint=o=>{t.widgetState.getFirstPoint().setOrigin(o)},e.setSecondPoint=o=>{t.widgetState.getSecondPoint().setOrigin(o)};const a=e.setInteractionState;e.setInteractionState=o=>{const i=a(o);return i&&o==="PlacingFirst"&&(t.widgetState.setIsPlaced(!1),t.widgetState.getFirstPoint().setVisible(!1),t.widgetState.getSecondPoint().setVisible(!1)),i},e.resetInteractions=()=>{t._interactor.cancelAnimation(e,!0)},e.handleLeftButtonPress=o=>{var l;if(!t.manipulator||ti(o))return _.VOID;const i=t._widgetManager.getActiveWidget();if(i&&i!==e)return _.VOID;const s=t.manipulator.handleEvent(o,t._apiSpecificRenderWindow);if(!s.length)return _.VOID;const r=e.getInteractionState();return r==="PlacingFirst"?(e.setFirstPoint(s),e.setSecondPoint(s),t.widgetState.getFirstPoint().setVisible(!0),t.widgetState.getSecondPoint().setVisible(!0),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),e.setInteractionState("PlacingSecond"),_.EVENT_ABORT):r==="PlacingSecond"?(e.setSecondPoint(s),t.widgetState.setIsPlaced(!0),e.setInteractionState("Select"),e.invokeEndInteractionEvent(),e.invokePlacedEvent(),t._interactor.cancelAnimation(e),_.EVENT_ABORT):(l=t.activeState)!=null&&l.getActive()&&t.pickable?(n=t.activeState,e.setInteractionState("Dragging"),t._apiSpecificRenderWindow.setCursor("grabbing"),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),_.EVENT_ABORT):_.VOID},e.handleMouseMove=o=>{const i=t.manipulator.handleEvent(o,t._apiSpecificRenderWindow);return i.length?e.getInteractionState()==="PlacingSecond"?(t.widgetState.getSecondPoint().setOrigin(i),t.widgetState.getSecondPoint().setVisible(!0),e.invokeInteractionEvent(),_.EVENT_ABORT):e.getInteractionState()==="Dragging"&&n?(n.setOrigin(i),e.invokeInteractionEvent(),_.EVENT_ABORT):_.VOID:_.VOID},e.handleLeftButtonRelease=o=>{if(n){const i=t.manipulator.handleEvent(o,t._apiSpecificRenderWindow);i.length&&n.setOrigin(i),n=null,e.setInteractionState("Select"),t._apiSpecificRenderWindow.setCursor("pointer"),t.widgetState.deactivate(),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent(),t._widgetManager.enablePicking()}},e.handleRightButtonPress=o=>ti(o)||e.getInteractionState()!=="Select"||!t.activeState?_.VOID:(e.invokeRightClickEvent(o),_.EVENT_ABORT),e.grabFocus=()=>{throw new Error("grabFocus is not implemented")},e.loseFocus=()=>{throw new Error("loseFocus is not implemented")}}const ug=20;function dg(e,t,n,a){let o=n();const i=t.$subscribe(()=>{const r=n();(a?a(o,r):o!==r)&&(o=r,e.modified())}),s=e.delete;e.delete=()=>{i(),s()}}function hg(e,t,{id:n,store:a,key:o,visible:i=!0}){Object.assign(t,{id:n,_store:a,key:o}),yn.extend(e,t,{}),ki.extend(e,t,{visible:i}),qr.extend(e,t,{scale1:ug});const s=()=>t._store.rulerByID[t.id],r=l=>t._store.updateRuler(t.id,l);e.getOrigin=()=>{var l;return(l=s())==null?void 0:l[t.key]},e.setOrigin=l=>{r({[t.key]:l}),e.modified()},dg(e,t._store,()=>{var l;return(l=s())==null?void 0:l[t.key]})}const ni=_.newInstance(hg,"vtkRulerWidgetStatePoint"),Ja="points";function oi(e,t,n){let a=t.onModified(n);const o=e.delete;e.delete=()=>{a.unsubscribe(),a=null,o()}}function gg(e,t){const n=ni({id:t.id,store:t._store,key:"firstPoint",visible:!0}),a=ni({id:t.id,store:t._store,key:"secondPoint",visible:!0});oi(e,n,()=>e.modified()),oi(e,a,()=>e.modified()),t.labels={[Ja]:[n,a]},e.getFirstPoint=()=>n,e.getSecondPoint=()=>a}const fg=e=>({isPlaced:!1,...e});function pg(e,t,n){Object.assign(t,fg(n)),yn.extend(e,t,n),Mi.extend(e,t),_.get(e,t,["id"]),_.setGet(e,t,["isPlaced"]),_.moveToProtected(e,t,["store"]),gg(e,t)}const mg=_.newInstance(pg,"vtkRulerWidgetState");function vg(e,t){t.classHierarchy.push("vtkRulerWidget"),e.getRepresentationsForViewType=()=>[{builder:Yr,labels:[Ja],initialValues:{scaleInPixels:!0}}],e.getLength=()=>{const n=t.widgetState.getFirstPoint().getOrigin(),a=t.widgetState.getSecondPoint().getOrigin();return!n||!a?0:Math.sqrt(Vi(n,a))},t.manipulator=je.newInstance()}const yg={};function Za(e,t,n={}){Object.assign(t,yg,n),mn.extend(e,t,{...n,behavior:cg,widgetState:mg(n)}),_.get(e,t,["manipulator"]),vg(e,t)}const wg=_.newInstance(Za,"vtkRulerWidget"),es={newInstance:wg,extend:Za};function nn(e,t,n,a){const{lpsOrientation:o}=a,i=o[Te(t)],s=o[t],r=[0,0,0];r[i]=n,pe(r,r,a.indexToWorld),e.setUserNormal(s),e.setUserOrigin(r)}const Sg=X({props:{point1:Array,point2:Array,color:String,length:Number,viewId:{type:String,required:!0},textOffset:{type:Number,default:8},textSize:{type:Number,default:14}},setup(e){const{viewId:t,point1:n,point2:a,textOffset:o,length:i}=ae(e),s=M(),r=M(),l=de(),c=I(()=>l.getViewProxy(t.value)),u=()=>{const p=c.value.getRenderer(),f=z(n),m=z(a);if(f){const w=Wt(f,p);w&&(s.value={x:w[0],y:w[1]})}else s.value=null;if(m){const w=Wt(m,p);w&&(r.value={x:w[0],y:w[1]})}else r.value=null};Se(I(()=>c.value.getCamera().onModified))(u),F([c,n,a],u,{deep:!0,immediate:!0});const h=I(()=>{const p=z(s),f=z(r),m=o.value;return!p||!f?null:f.x>p.x?{dx:m,dy:-m,anchor:"start"}:{dx:-m,dy:-m,anchor:"end"}}),v=lt(pn);return In(v,()=>{u()}),{devicePixelRatio,textdx:I(()=>{var p;return((p=h.value)==null?void 0:p.dx)??0}),textdy:I(()=>{var p;return((p=h.value)==null?void 0:p.dy)??0}),anchor:I(()=>{var p;return((p=h.value)==null?void 0:p.anchor)??"start"}),first:s,second:r,rulerLength:I(()=>{var p;return((p=i==null?void 0:i.value)==null?void 0:p.toFixed(2))??""})}}});const _g=["x1","y1","x2","y2","stroke"],Cg=["cx","cy","stroke","r"],bg=["cx","cy","stroke","r"],Tg=["x","y","dx","dy","text-anchor","font-size"];function Ig(e,t,n,a,o,i){return R(),E("g",null,[e.first&&e.second?(R(),E("line",{key:0,x1:e.first.x,y1:e.first.y,x2:e.second.x,y2:e.second.y,stroke:e.color,"stroke-width":"1"},null,8,_g)):j("",!0),e.first?(R(),E("circle",{key:1,cx:e.first.x,cy:e.first.y,stroke:e.color,"stroke-width":"1",fill:"transparent",r:10/e.devicePixelRatio},null,8,Cg)):j("",!0),e.second?(R(),E("circle",{key:2,cx:e.second.x,cy:e.second.y,stroke:e.color,"stroke-width":"1",fill:"transparent",r:10/e.devicePixelRatio,class:"handle"},null,8,bg)):j("",!0),e.second?(R(),E("text",{key:3,x:e.second.x,y:e.second.y,dx:e.textdx,dy:e.textdy,"text-anchor":e.anchor,"stroke-width":"0.75",stroke:"black",fill:"white","font-size":`${e.textSize}px`,"font-weight":"bold"},U(e.rulerLength),9,Tg)):j("",!0)])}const Rg=A(Sg,[["render",Ig],["__scopeId","data-v-85f6f954"]]),xg=X({name:"RulerWidget2D",emits:["placed","contextmenu"],props:{rulerId:{type:String,required:!0},widgetManager:{type:Object,required:!0},viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},currentSlice:{type:Number,required:!0},isPlacing:{type:Boolean,default:!1}},components:{RulerSVG2D:Rg},setup(e,{emit:t}){const{rulerId:n,widgetManager:a,viewDirection:o,currentSlice:i,isPlacing:s}=ae(e),r=Ae(),l=I(()=>r.rulerByID[n.value]),{currentImageID:c,currentImageMetadata:u}=se(),d=es.newInstance({id:n.value,store:r,isPlaced:!s.value}),h=M(null);ee(()=>{h.value=a.value.addWidget(d)}),Ne(()=>{h.value&&(a.value.removeWidget(h.value),h.value.delete(),d.delete())}),F([s,h],([S,b])=>{S&&b&&b.setInteractionState(Gt.PlacingFirst)},{immediate:!0}),F([i,c,h],()=>{var b;const S=(b=h.value)==null?void 0:b.getWidgetState().getIsPlaced();h.value&&!S&&(h.value.resetInteractions(),h.value.setInteractionState(Gt.PlacingFirst))}),Se(I(()=>{var S;return(S=h.value)==null?void 0:S.onPlacedEvent}))(()=>{t("placed")});let p=null;ee(()=>{h.value&&(p=h.value.onRightClickEvent(S=>{const b=uo(S);b&&t("contextmenu",b)}))}),we(()=>{p&&(p.unsubscribe(),p=null)});const f=je.newInstance();ee(()=>{h.value&&h.value.setManipulator(f)}),fe(()=>{var S;nn(f,o.value,((S=l.value)==null?void 0:S.slice)??i.value,u.value)}),F(()=>{var S;return!!h.value&&((S=l.value)==null?void 0:S.slice)===i.value},S=>{var b;(b=h.value)==null||b.setVisibility(S)},{immediate:!0}),ee(()=>{h.value&&(h.value.setHandleVisibility(!1),a.value.renderWidgets())});const m=S=>{const b=M(!1),O=()=>{S.value&&(b.value=S.value.getVisible())};return Se(I(()=>{var k;return(k=S.value)==null?void 0:k.onModified}))(()=>O()),yi(S,()=>O()),b},w=m(I(()=>{var S;return(S=h.value)==null?void 0:S.getWidgetState().getFirstPoint()})),T=m(I(()=>{var S;return(S=h.value)==null?void 0:S.getWidgetState().getSecondPoint()}));return{ruler:l,firstPoint:I(()=>w.value?l.value.firstPoint:void 0),secondPoint:I(()=>T.value?l.value.secondPoint:void 0),length:I(()=>r.lengthByID[l.value.id])}}});function Dg(e,t,n,a,o,i){const s=P("RulerSVG2D");return pt((R(),K(s,{"view-id":e.viewId,point1:e.firstPoint,point2:e.secondPoint,color:e.ruler.color,length:e.length},null,8,["view-id","point1","point2","color","length"])),[[qn,e.currentSlice===e.ruler.slice]])}const Eg=A(xg,[["render",Dg]]),Lg=X({name:"RulerTool",props:{viewId:{type:String,required:!0},currentSlice:{type:Number,required:!0},viewDirection:{type:String,required:!0},widgetManager:{type:Object,required:!0}},components:{RulerWidget2D:Eg},setup(e){const{viewDirection:t,currentSlice:n}=ae(e),a=Oe(),o=Ae(),{rulers:i,activeLabel:s}=tt(o),{currentImageID:r,currentImageMetadata:l}=se(),c=I(()=>a.currentTool===ne.Ruler),u=I(()=>Te(t.value)),d=M(null);F(d,(S,b)=>{b!=null&&o.updateRuler(b,{placing:!1}),S!=null&&o.updateRuler(S,{placing:!0})},{immediate:!0}),F([c,r],([S,b])=>{d.value!=null&&(o.removeRuler(d.value),d.value=null),S&&b&&(d.value=o.addRuler({imageID:b,placing:!0}))},{immediate:!0}),F([s,d],([S,b])=>{b!=null&&o.updateRuler(b,{label:S,...S&&o.labels[S]})},{immediate:!0}),Ne(()=>{d.value!=null&&(o.removeRuler(d.value),d.value=null)});const h=()=>{r.value&&(d.value=o.addRuler({imageID:r.value,placing:!0}))},v=()=>{const{lpsOrientation:S,indexToWorld:b}=l.value,O=S[t.value],D=S[u.value],k=[0,0,0];return k[D]=n.value,pe(k,k,b),{planeNormal:O,planeOrigin:k}};F([n,d],([S,b])=>{b&&o.updateRuler(b,{frameOfReference:v(),slice:S})},{immediate:!0});const p=ze({show:!1,x:0,y:0,forRulerID:""}),f=(S,b)=>{[p.x,p.y]=b,p.show=!0,p.forRulerID=S},m=()=>{o.removeRuler(p.forRulerID)},w=S=>{if(!S.frameOfReference)return!1;const b=_n(S.frameOfReference,l.value,{allowOutOfBoundsSlice:!0});return!!b&&b.axis===u.value};return{rulers:I(()=>{const{lengthByID:S}=o,b=r.value;return i.value.filter(D=>D.imageID===b&&w(D)).map(D=>({...D,length:S[D.id]}))}),placingRulerID:d,contextMenu:p,openContextMenu:f,deleteRulerFromContextMenu:m,onRulerPlaced:h}}});const Og={class:"overlay-no-events"},Vg={class:"overlay-no-events"};function Pg(e,t,n,a,o,i){const s=P("RulerWidget2D");return R(),E("div",Og,[(R(),E("svg",Vg,[(R(!0),E(ue,null,Be(e.rulers,r=>(R(),K(s,{key:r.id,"ruler-id":r.id,"is-placing":r.id===e.placingRulerID,"current-slice":e.currentSlice,"view-id":e.viewId,"view-direction":e.viewDirection,"widget-manager":e.widgetManager,onContextmenu:l=>e.openContextMenu(r.id,l),onPlaced:e.onRulerPlaced},null,8,["ruler-id","is-placing","current-slice","view-id","view-direction","widget-manager","onContextmenu","onPlaced"]))),128))])),y(wt,{modelValue:e.contextMenu.show,"onUpdate:modelValue":t[0]||(t[0]=r=>e.contextMenu.show=r),class:"position-absolute",style:ie({top:`${e.contextMenu.y}px`,left:`${e.contextMenu.x}px`}),"close-on-click":"","close-on-content-click":""},{default:x(()=>[y(Ft,{density:"compact"},{default:x(()=>[y(Je,{onClick:e.deleteRulerFromContextMenu},{default:x(()=>[y(De,null,{default:x(()=>[H("Delete")]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1},8,["modelValue","style"])])}const kg=A(Lg,[["render",Pg],["__scopeId","data-v-6e6ae374"]]);function Mg(e,t){t.classHierarchy.push("vtkRectangleWidget")}const Bg={};function ts(e,t,n={}){Object.assign(t,Bg,n);const{store:a,...o}=n,i={...a,rulerByID:a.toolByID,updateRuler:a.updateTool};es.extend(e,t,{store:i,...o}),Mg(e,t)}const Ag=_.newInstance(ts,"vtkRectangleWidget"),Fg={newInstance:Ag,extend:ts},Ng=X({props:{point1:Array,point2:Array,color:String,fillColor:String,viewId:{type:String,required:!0}},setup(e){const{viewId:t,point1:n,point2:a}=ae(e),o=M(),i=M(),s=de(),r=I(()=>s.getViewProxy(t.value)),l=()=>{const h=r.value.getRenderer(),v=z(n),p=z(a);if(v){const f=Wt(v,h);f&&(o.value={x:f[0],y:f[1]})}else o.value=null;if(p){const f=Wt(p,h);f&&(i.value={x:f[0],y:f[1]})}else i.value=null},c=I(()=>{var m,w,T,S;const[h,v]=[((m=o.value)==null?void 0:m.x)??0,((w=o.value)==null?void 0:w.y)??0],[p,f]=[((T=i.value)==null?void 0:T.x)??h,((S=i.value)==null?void 0:S.y)??v];return{x:Math.min(h,p),y:Math.min(v,f),width:Math.abs(h-p),height:Math.abs(v-f)}});Se(I(()=>r.value.getCamera().onModified))(l),F([r,n,a],l,{deep:!0,immediate:!0});const d=lt(pn);return In(d,()=>{l()}),{devicePixelRatio,first:o,second:i,rectangle:c}}}),$g=["x","y","width","height","stroke","fill"],Ug=["cx","cy","stroke","r"],Hg=["cx","cy","stroke","r"];function Wg(e,t,n,a,o,i){return R(),E("g",null,[g("rect",{x:e.rectangle.x,y:e.rectangle.y,width:e.rectangle.width,height:e.rectangle.height,stroke:e.color,"stroke-width":"1",fill:e.fillColor},null,8,$g),e.first?(R(),E("circle",{key:0,cx:e.first.x,cy:e.first.y,stroke:e.color,"stroke-width":"1",fill:"transparent",r:10/e.devicePixelRatio},null,8,Ug)):j("",!0),e.second?(R(),E("circle",{key:1,cx:e.second.x,cy:e.second.y,stroke:e.color,"stroke-width":"1",fill:"transparent",r:10/e.devicePixelRatio},null,8,Hg)):j("",!0)])}const zg=A(Ng,[["render",Wg]]),jg=Fe,Gg=Fg,Xg=zg,qg=X({name:"RectangleWidget2D",emits:["placed","contextmenu"],props:{toolId:{type:String,required:!0},widgetManager:{type:Object,required:!0},viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},currentSlice:{type:Number,required:!0},isPlacing:{type:Boolean,default:!1}},components:{SVG2DComponent:Xg},setup(e,{emit:t}){const{toolId:n,widgetManager:a,viewDirection:o,currentSlice:i,isPlacing:s}=ae(e),r=M(n.value),l=jg(),c=I(()=>l.toolByID[r.value]),{currentImageID:u,currentImageMetadata:d}=se(),h=Gg.newInstance({id:r.value,store:l,isPlaced:!s.value}),v=M(null);ee(()=>{v.value=a.value.addWidget(h)}),Ne(()=>{v.value&&(a.value.removeWidget(v.value),v.value.delete(),h.delete())}),F([s,v],([b,O])=>{b&&O&&O.setInteractionState(Gt.PlacingFirst)},{immediate:!0}),F([i,u,v],()=>{var O;const b=(O=v.value)==null?void 0:O.getWidgetState().getIsPlaced();v.value&&!b&&(v.value.resetInteractions(),v.value.setInteractionState(Gt.PlacingFirst))}),Se(I(()=>{var b;return(b=v.value)==null?void 0:b.onPlacedEvent}))(()=>{t("placed")});let f=null;ee(()=>{v.value&&(f=v.value.onRightClickEvent(b=>{const O=uo(b);O&&t("contextmenu",O)}))}),we(()=>{f&&(f.unsubscribe(),f=null)});const m=je.newInstance();ee(()=>{v.value&&v.value.setManipulator(m)}),fe(()=>{var b;nn(m,o.value,((b=c.value)==null?void 0:b.slice)??i.value,d.value)}),F(()=>{var b;return!!v.value&&((b=c.value)==null?void 0:b.slice)===i.value},b=>{var O;(O=v.value)==null||O.setVisibility(b)},{immediate:!0}),ee(()=>{v.value&&(v.value.setHandleVisibility(!1),a.value.renderWidgets())});const w=b=>{const O=M(!1),D=()=>{b.value&&(O.value=b.value.getVisible())};return Se(I(()=>{var L;return(L=b.value)==null?void 0:L.onModified}))(()=>D()),yi(b,()=>D()),O},T=w(I(()=>{var b;return(b=v.value)==null?void 0:b.getWidgetState().getFirstPoint()})),S=w(I(()=>{var b;return(b=v.value)==null?void 0:b.getWidgetState().getSecondPoint()}));return{tool:c,firstPoint:I(()=>T.value?c.value.firstPoint:void 0),secondPoint:I(()=>S.value?c.value.secondPoint:void 0)}}});function Yg(e,t,n,a,o,i){const s=P("SVG2DComponent");return pt((R(),K(s,{"view-id":e.viewId,point1:e.firstPoint,point2:e.secondPoint,color:e.tool.color,"fill-color":e.tool.fillColor},null,8,["view-id","point1","point2","color","fill-color"])),[[qn,e.currentSlice===e.tool.slice]])}const Kg=A(qg,[["render",Yg]]),Qg=Fe,Jg=X({name:"RectangleTool",props:{viewId:{type:String,required:!0},currentSlice:{type:Number,required:!0},viewDirection:{type:String,required:!0},widgetManager:{type:Object,required:!0}},components:{RectangleWidget2D:Kg},setup(e){const{viewDirection:t,currentSlice:n}=ae(e),a=Oe(),o=Qg(),{tools:i,activeLabel:s}=tt(o),{currentImageID:r,currentImageMetadata:l}=se(),c=I(()=>a.currentTool===ne.Rectangle),u=I(()=>Te(t.value)),d=M(null);F(d,(S,b)=>{b!=null&&o.updateTool(b,{placing:!1}),S!=null&&o.updateTool(S,{placing:!0})},{immediate:!0}),F([c,r],([S,b])=>{d.value!=null&&(o.removeTool(d.value),d.value=null),S&&b&&(d.value=o.addTool({imageID:b,placing:!0}))},{immediate:!0}),F([s,d],([S,b])=>{b!=null&&o.updateTool(b,{label:S,...S&&o.labels[S]})},{immediate:!0}),Ne(()=>{d.value!=null&&(o.removeTool(d.value),d.value=null)});const h=()=>{r.value&&(d.value=o.addTool({imageID:r.value,placing:!0}))},v=()=>{const{lpsOrientation:S,indexToWorld:b}=l.value,O=S[t.value],D=S[u.value],k=[0,0,0];return k[D]=n.value,pe(k,k,b),{planeNormal:O,planeOrigin:k}};F([n,d],([S,b])=>{b&&o.updateTool(b,{frameOfReference:v(),slice:S})},{immediate:!0});const p=ze({show:!1,x:0,y:0,forToolID:""}),f=(S,b)=>{[p.x,p.y]=b,p.show=!0,p.forToolID=S},m=()=>{o.removeTool(p.forToolID)},w=S=>{if(!S.frameOfReference)return!1;const b=_n(S.frameOfReference,l.value,{allowOutOfBoundsSlice:!0});return!!b&&b.axis===u.value};return{tools:I(()=>{const S=r.value;return i.value.filter(b=>b.imageID===S&&w(b))}),placingToolID:d,contextMenu:p,openContextMenu:f,deleteToolFromContextMenu:m,onToolPlaced:h}}});const Zg={class:"overlay-no-events"},ef={class:"overlay-no-events"};function tf(e,t,n,a,o,i){const s=P("RectangleWidget2D");return R(),E("div",Zg,[(R(),E("svg",ef,[(R(!0),E(ue,null,Be(e.tools,r=>(R(),K(s,{key:r.id,"tool-id":r.id,"is-placing":r.id===e.placingToolID,"current-slice":e.currentSlice,"view-id":e.viewId,"view-direction":e.viewDirection,"widget-manager":e.widgetManager,onContextmenu:l=>e.openContextMenu(r.id,l),onPlaced:e.onToolPlaced},null,8,["tool-id","is-placing","current-slice","view-id","view-direction","widget-manager","onContextmenu","onPlaced"]))),128))])),y(wt,{modelValue:e.contextMenu.show,"onUpdate:modelValue":t[0]||(t[0]=r=>e.contextMenu.show=r),class:"position-absolute",style:ie({top:`${e.contextMenu.y}px`,left:`${e.contextMenu.x}px`}),"close-on-click":"","close-on-content-click":""},{default:x(()=>[y(Ft,{density:"compact"},{default:x(()=>[y(Je,{onClick:e.deleteToolFromContextMenu},{default:x(()=>[y(De,null,{default:x(()=>[H("Delete")]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1},8,["modelValue","style"])])}const nf=A(Jg,[["render",tf],["__scopeId","data-v-152d5701"]]),of=32,ii=2,af=4;function sf(e,t){t.classHierarchy.push("vtkContourRepresentation"),t._polyData=Ze.newInstance({mtime:0}),t._pdPoints=null,t._pdLines=null,t._pipelines={lines:{source:e,mapper:Yt.newInstance(),actor:Bi.newInstance({parentProp:e})}},t._pipelines.lines.actor.getProperty().setLineWidth(2),Qn.connectPipeline(t._pipelines.lines),e.addActor(t._pipelines.lines.actor),e.getRepresentationStates=(i=t.inputData[0])=>i;function n(i){var f,m;const s=i.getPolyLine(),r=i.getReferencePlane(),l=i.getPolyLineLength(),c=i.getFinalized(),u=c?1:0;if(!s||!r)return;((f=t._pdPoints)==null?void 0:f.length)!==l*3&&(t._pdPoints=new Float32Array(l*3)),((m=t._pdLines)==null?void 0:m.length)!==l+1&&(t._pdLines=new Float32Array(l+1+u));let d=0,h=0;t._pdLines[h++]=l+u;const v=Me(),p=Le();for(let w=0;w<s.length;)t._pdLines[h++]=d/3,vi(v,s[w++],s[w++]),Cn(v,r,p),t._pdPoints[d++]=p[0],t._pdPoints[d++]=p[1],t._pdPoints[d++]=p[2];c&&(t._pdLines[h]=0)}let a=ii;e.requestData=(i,s)=>{const r=e.getRepresentationStates(i[0]);n(r),t._pdPoints&&t._pdLines&&(t._polyData.getPoints().setData(t._pdPoints),t._polyData.getLines().setData(t._pdLines),t._polyData.getPoints().modified(),t._polyData.modified()),a=r.getSelected()?af:ii,t._pipelines.lines.actor.getProperty().setLineWidth(a),t._pipelines.lines.actor.getProperty().setColor(r.getColor()),s[0]=t._polyData},e.getSelectedState=()=>t.inputData[0];const{updateActorVisibility:o}=e;e.updateActorVisibility=(i=Ao.FRONT_BUFFER,s=!0,r=!0)=>{i===Ao.PICKING_BUFFER?t._pipelines.lines.actor.getProperty().setLineWidth(of):t._pipelines.lines.actor.getProperty().setLineWidth(a),o(i,s,r)}}const rf={};function ns(e,t,n={}){const a={...rf,...n};Qn.extend(e,t,a),sf(e,t)}const lf=_.newInstance(ns,"vtkContourRepresentation"),cf={newInstance:lf,extend:ns};var Ve=(e=>(e.Select="Select",e.Freehand="Freehand",e.Nudge="Nudge",e.PointPlacing="PointPlacing",e.Threshold="Threshold",e))(Ve||{});const Q={Idle:"Idle",Moving:"Moving",FreehandDrawing:"FreehandDrawing",Nudging:"Nudging",PointPlacing:"PointPlacing",Thresholding:"Thresholding"};function he(e){return e.altKey||e.controlKey||e.shiftKey}function Ie(e,t){const n=e.manipulator.handleEvent(t,e._apiSpecificRenderWindow);return(n==null?void 0:n.length)===3?n:null}function os(e,t){const n=(t==null?void 0:t.degree)??2,a=(t==null?void 0:t.interPointSpacing)??.1,o=(t==null?void 0:t.closed)??!1,i=(t==null?void 0:t.clamped)??!1,s=e.length/3,r=[],l=Me();let c=0;for(let p=0;p<e.length;p+=2){const f=[e[p],e[p+1]];r.push(f),p>0&&(c+=wi(l,f)),zs(l,f)}o&&r.push(...r.slice(0,n+1));let u;if(i){u=[];const p=r.length;for(let f=0;f<p+n+1;f++)u.push(f)}const d=!i&&o?1-1/(s+1):1,h=(t==null?void 0:t.dt)??a/c,v=[];for(let p=0;p<1;p+=h){const f=js(p*d,n,r,u);v.push(f[0],f[1])}return v}function uf(e,t){const n={...e};function a(){return e.getMode()===Ve.Freehand}function o(){e.setInteractionState(Q.Idle),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent()}e.resetInteractionState=()=>{a()&&!e.isInteractionIdle()&&(t.widgetState.clearPolyLine(),o()),n.resetInteractionState()},e.handleLeftButtonPress=i=>{var l;if(((l=n.handleLeftButtonPress)==null?void 0:l.call(n,i))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!a()||!t.manipulator||he(i))return _.VOID;if(t.widgetState.getFinalized())return _.VOID;const s=t._widgetManager.getActiveWidget();if(s&&s!==e)return _.VOID;const r=Ie(t,i);return r?(e.setInteractionState(Q.FreehandDrawing),t.widgetState.clearPolyLine(),t.widgetState.add3dPointToPolyLine(r),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),_.EVENT_ABORT):_.VOID},e.handleMouseMove=i=>{var r;if(((r=n.handleMouseMove)==null?void 0:r.call(n,i))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!a()||e.getInteractionState()!==Q.FreehandDrawing||he(i))return _.VOID;const s=Ie(t,i);return s&&(t.widgetState.add3dPointToPolyLine(s),e.invokeInteractionEvent()),_.EVENT_ABORT},e.handleLeftButtonRelease=i=>{var l;if(((l=n.handleLeftButtonRelease)==null?void 0:l.call(n,i))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!a()||e.getInteractionState()!==Q.FreehandDrawing||he(i))return _.VOID;const s=Ie(t,i);if(s&&t.widgetState.add3dPointToPolyLine(s),t.widgetState.getPolyLine().length>=3*2){const c=os(t.widgetState.getPolyLine(),{degree:2,interPointSpacing:.01,closed:!0,clamped:!1});t.widgetState.setPolyLine(c),t.widgetState.setFinalized(!0)}return o(),_.EVENT_ABORT}}const df=new Set([Ve.Nudge]);function hf(e,t){const n={...e};let a=[0,0],o=null;_.event(e,t,"SelectedEvent");const i=Me();function s(l){if(!o)return;Gs(i,l,a);const c=t.widgetState.getPolyLine();for(let u=0;u<c.length;u+=2)c[u]=o[u]+i[0],c[u+1]=o[u+1]+i[1];t.widgetState.modified()}function r(){e.setInteractionState(Q.Idle),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent()}e.resetInteractionState=()=>{e.getInteractionState()===Q.Moving&&r(),n.resetInteractionState()},e.handleLeftButtonPress=l=>{var u;if(((u=n.handleLeftButtonPress)==null?void 0:u.call(n,l))===_.EVENT_ABORT)return _.EVENT_ABORT;if(he(l))return _.VOID;if(t._widgetManager.getActiveWidget()!==e)return df.has(e.getMode())||e.invokeSelectedEvent(!1),_.VOID;e.invokeSelectedEvent(!0);const c=Ie(t,l);return c?(a=et(c,t.widgetState.getReferencePlane()),o=[...t.widgetState.getPolyLine()],e.setInteractionState(Q.Moving),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),_.EVENT_ABORT):_.EVENT_ABORT},e.handleMouseMove=l=>{var u;if(((u=n.handleMouseMove)==null?void 0:u.call(n,l))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!e.isSelected()||e.getInteractionState()!==Q.Moving||he(l))return _.VOID;const c=Ie(t,l);return c&&(s(et(c,t.widgetState.getReferencePlane())),e.invokeInteractionEvent()),_.EVENT_ABORT},e.handleLeftButtonRelease=l=>{var u;if(((u=n.handleLeftButtonRelease)==null?void 0:u.call(n,l))===_.EVENT_ABORT)return _.EVENT_ABORT;if(e.getInteractionState()!==Q.Moving||he(l))return _.VOID;const c=Ie(t,l);return c&&s(et(c,t.widgetState.getReferencePlane())),r(),_.EVENT_ABORT}}function An(e,t,n){return(e+t)%n}function gf(e,t,n){e[0]=(t[0]+n[0])/2,e[1]=(t[1]+n[1])/2}function ff(e,t,n){const{radius:a,center:o}=t,i=a**2,s=Le(),r=[0,0,0],l=[0,0];for(let c=0;c<e.length;c+=2){vt(l,e[c],e[c+1]),Cn(l,n,r);const u=Xs(r,o);u>=i||(fi(s,r,o),qs(s,s,Math.sqrt(i/u)),Ys(r,o,s),et(r,n,l),e[c]=l[0],e[c+1]=l[1])}}function pf(e,t,n){if(e.length<2)return;const a=t**2,o=n**2,i=Me(),s=Me(),r=Me(),l=Me();let c=0,u=!1,d=!1;do{let h=c;const v=An(c,2,e.length);vt(i,e[c],e[c+1]),vt(s,e[v],e[v+1]);const p=Si(i,s);if(p<a)gf(r,i,s),e.splice(v,2),e.splice(c,2),e.splice(c,0,...r);else if(p>o){const m=1/(Math.ceil(Math.sqrt(p/o))+1),w=[];for(let T=m;T<1;T+=m)Ks(l,i,s,T),w.push(...l);e.splice(v,0,...w),h=An(c,w.length+2,e.length)}else h=An(c,2,e.length);d=u,u=h<c,c=h}while(!d)}function mf(e,t,n,a=1e-4,o=.1){ff(e,t,n),pf(e,a,o)}function vf(e,t){let n=0,a=1/0;const o=Me();for(let i=0;i<e.length;i+=2){vt(o,e[i],e[i+1]);const s=Si(o,t);s<a&&(n=i,a=s)}return n}const yf=.95;function wf(e,t){const n={...e};t._radius=1;function a(){return e.getMode()===Ve.Nudge}function o(s){const r=t.widgetState.getPolyLine(),l=t.widgetState.getReferencePlane();mf(r,{center:s,radius:t._radius},l),t.widgetState.modified()}function i(){e.getWidgetState().getCircleContext().setVisible(!1),e.setInteractionState(Q.Idle),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent()}e.resetInteractionState=()=>{a()&&!e.isInteractionIdle()&&i(),n.resetInteractionState()},e.handleLeftButtonPress=s=>{var T;if(((T=n.handleLeftButtonPress)==null?void 0:T.call(n,s))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!a()||!e.isSelected()||!t.manipulator||he(s))return _.VOID;const r=t._widgetManager.getActiveWidget();if(r&&r!==e)return _.VOID;const l=Ie(t,s);if(!l)return _.VOID;const{widgetState:c}=t,u=c.getPolyLine(),d=c.getReferencePlane(),h=vf(u,et(l,d)),v=Qs(l,Cn([u[h],u[h+1]],d));t._radius=v*yf;const p=t.manipulator.getNormal(),f=t._renderer.getActiveCamera().getViewUp(),m=Le();Gn(m,f,p);const w=c.getCircleContext();return w.setDirection(p),w.setUp(f),w.setRight(m),w.setOrigin(l),w.setScale3([t._radius,t._radius,1]),w.setVisible(!0),e.setInteractionState(Q.Nudging),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),_.EVENT_ABORT},e.handleMouseMove=s=>{var l;if(((l=n.handleMouseMove)==null?void 0:l.call(n,s))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!a()||!e.isSelected()||e.getInteractionState()!==Q.Nudging||he(s))return _.VOID;const r=Ie(t,s);return r&&(e.getWidgetState().getCircleContext().setOrigin(r),o(r),e.invokeInteractionEvent()),_.EVENT_ABORT},e.handleLeftButtonRelease=s=>{var l;if(((l=n.handleLeftButtonRelease)==null?void 0:l.call(n,s))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!a()||!e.isSelected()||e.getInteractionState()!==Q.Nudging||he(s))return _.VOID;const r=Ie(t,s);return r&&o(r),i(),_.EVENT_ABORT}}function Sf(e,t){const n={...e};function a(){return e.getMode()===Ve.PointPlacing}function o(){t._widgetManager.releaseFocus(),e.setInteractionState(Q.Idle),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent()}function i(r){const l=t.widgetState.getPolyLine(),c=l.length-1;l[c-1]=r[0],l[c]=r[1],t.widgetState.modified()}function s(){t.widgetState.getPolyLine().splice(-2,2),t.widgetState.modified()}e.resetInteractionState=()=>{a()&&!e.isInteractionIdle()&&(t.widgetState.clearPolyLine(),o()),n.resetInteractionState()},e.handleLeftButtonPress=r=>{var d;if(((d=n.handleLeftButtonPress)==null?void 0:d.call(n,r))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!a()||!t.manipulator||he(r))return _.VOID;if(t.widgetState.getFinalized())return _.VOID;const l=t._widgetManager.getActiveWidget();if(l&&l!==e)return _.VOID;const c=Ie(t,r);if(!c)return _.VOID;const u=et(c,t.widgetState.getReferencePlane());return e.getInteractionState()===Q.PointPlacing?(i(u),t.widgetState.add2dPointToPolyLine(u),e.invokeInteractionEvent()):(t._widgetManager.grabFocus(e),e.setInteractionState(Q.PointPlacing),t.widgetState.setFinalized(!1),t.widgetState.clearPolyLine(),t.widgetState.add2dPointToPolyLine(u),t.widgetState.add2dPointToPolyLine(u),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent()),_.EVENT_ABORT},e.handleMouseMove=r=>{var c;if(((c=n.handleMouseMove)==null?void 0:c.call(n,r))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!a()||e.getInteractionState()!==Q.PointPlacing||he(r))return _.VOID;const l=Ie(t,r);if(l){const u=et(l,t.widgetState.getReferencePlane());i(u),e.invokeInteractionEvent()}return _.EVENT_ABORT},e.handleRightButtonPress=r=>{var l;if(((l=n.handleRightButtonPress)==null?void 0:l.call(n,r))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!a()||e.getInteractionState()!==Q.PointPlacing||he(r))return _.VOID;if(s(),t.widgetState.getPolyLineLength()<=2)t.widgetState.clearPolyLine();else{const c=os(t.widgetState.getPolyLine(),{degree:2,interPointSpacing:.01,closed:!0,clamped:!1});t.widgetState.setPolyLine(c),t.widgetState.setFinalized(!0)}return o(),_.EVENT_ABORT}}const{vtkErrorMacro:_f}=_;function Cf(e,t){t.classHierarchy.push("vtkImageMarchingSquares"),e.getContourValues=()=>t.contourValues,e.setContourValues=s=>{t.contourValues=s,e.modified()};const n=[],a=[],o=[],i=Kr.newInstance();e.getPixelScalars=(s,r,l,c,u,d,h,v)=>{n[0]=l*c+r*u[0]+s,n[1]=n[0]+1,n[2]=n[0]+u[0],n[3]=n[2]+1;const p=s>=0,f=r>=0,m=s+1<u[0],w=r+1<u[1];a[0]=p&&f?v[n[0]]:0,a[1]=m&&f?v[n[1]]:0,a[2]=p&&w?v[n[2]]:0,a[3]=m&&w?v[n[3]]:0},e.getPixelPoints=(s,r,l,c,u,d)=>{o[0]=u[0]+s*d[0],o[1]=u[1]+r*d[1],o[2]=o[0]+d[0],o[3]=o[1],o[4]=o[0],o[5]=o[1]+d[1],o[6]=o[2],o[7]=o[5]},e.produceLines=(s,r,l,c,u,d,h,v,p,f,m)=>{var k;const w=[1,2,8,4],T=[];let S;e.getPixelScalars(r,l,c,u,d,h,v,p);let b=0;for(let L=0;L<4;L++)a[L]>=s&&(b|=w[L]);const O=Fo.getCase(b);if(O[0]<0)return;e.getPixelPoints(r,l,c,d,h,v);const D=h[2]+c*v[2];for(let L=0;O[L]>=0;L+=2){m.push(2);for(let $=0;$<2;$++){const Y=Fo.getEdge(O[L+$]);if(S=void 0,t.mergePoints&&(S=(k=i.isInsertedEdge(n[Y[0]],n[Y[1]]))==null?void 0:k.value),S===void 0){const B=Y[0]*2,W=o[B],Z=o[B+1],Ce=Y[1]*2,me=o[Ce],Ge=o[Ce+1];T[0]=W+.5*(me-W),T[1]=Z+.5*(Ge-Z),S=f.length/3,f.push(T[0],T[1],D),t.mergePoints&&i.insertEdge(n[Y[0]],n[Y[1]],S)}m.push(S)}}},e.requestData=(s,r)=>{const l=s[0];if(!l){_f("Invalid or missing input");return}const c=l.getOrigin(),u=l.getSpacing(),d=l.getDimensions(),h=l.getPointData().getScalars().getData(),v=[],p=[],f=d[0]*d[1];let m=Math.round(t.slice);m>=d[2]&&(m=0);for(let T=0;T<t.contourValues.length;++T){for(let S=-1;S<d[1];++S)for(let b=-1;b<d[0];++b)e.produceLines(t.contourValues[T],b,S,m,f,d,c,u,h,v,p);i.initialize()}const w=Ze.newInstance();w.getPoints().setData(new Float32Array(v),3),w.getLines().setData(new Uint32Array(p)),r[0]=w}}const bf={contourValues:[],slice:0,mergePoints:!1};function is(e,t,n={}){Object.assign(t,bf,n),_.obj(e,t),_.algo(e,t,1,1),_.setGet(e,t,["slice","mergePoints"]),_.algo(e,t,1,1),Cf(e,t)}const Tf=_.newInstance(is,"vtkImageMarchingSquares"),If={newInstance:Tf,extend:is},as=2,Rf=1,xf=0;function Df(e,t){const n=[...e];return n.splice(t,1),n}function Ef(e,t){const[n,a]=Df(e.getDimensions(),t),o=new Uint8Array(n*a),i=Oi.newInstance({values:o,numberOfComponents:1}),s=Li.newInstance();return s.setDimensions([n,a,1]),s.getPointData().setScalars(i),s}function Lf(e,t,n){const a=[...e];return a.splice(t,0,n),a}function gn(e,t){const n=[...e];return n.splice(t,1),n}function Of(e,t){return wi(e,t)}function ai(e,t=3){if(t>3)throw new Error("Cannot support dim > 3");const n=e.getPointData().getScalars().getData(),[a,o,i]=e.getDimensions(),s=t===3?a*o:0,r=t>=2?a:0;return{get:l=>{const c=l[0]??0,u=l[1]??0,d=l[2]??0;return n[d*s+u*r+c]},set:(l,c)=>{const u=l[0]??0,d=l[1]??0,h=l[2]??0;n[h*s+d*r+u]=c},inBounds:l=>{const c=l[0]??0,u=l[1]??0,d=l[2]??0;return c>=0&&c<a&&u>=0&&u<o&&d>=0&&d<i},fill:l=>{n.fill(l)}}}function Vf(e,t,n,a,o,i,s,r=Of){const l=ai(e,3),c=ai(a,2),u=gn(o,t),d=l.get(o),h=d-i,v=d+i;c.fill(xf);const p=[u];for(;p.length;){const f=p.shift();if(!c.inBounds(f)||c.get(f)!==0||r(u,f)>s)continue;c.set(f,Rf);const m=Lf(f,t,n),w=l.get(m);if(w<h||w>v)continue;c.set(f,as);const[T,S]=f;for(let b=-1;b<=1;b++)for(let O=-1;O<=1;O++)(!b&&O||b&&!O)&&p.push([T+b,S+O])}}function Pf(e){const t=If.newInstance({mergePoints:!0});return t.setContourValues([as]),t.setInputData(e),t.getOutputData()}Pt(0,1,0,0,0,0,1,0,1,0,0,0,0,0,0,1),Pt(1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1),Pt(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);function kf(e,t){t.classHierarchy.push("vtkContourLoopExtraction");const n=new Set;e.traverseLoop=(a,o,i,s,r)=>{let l=i,c=s,u=!1,d=0;for(;!u;){const{cellPointIds:h}=a.getCellPoints(l);if(!h)continue;c=h[0]!==c?h[0]:h[1],d++;const v=o*d;r.push({t:v,ptId:c});const p=a.getPointCells(c);if(p.length!==2||c===s)return c;p.length===2?(l=p[0]!==l?p[0]:p[1],n.add(l)):u=!0}return c},e.computeConvexHull=(a,o)=>{const i=a.getPoints().getData(),s=[];for(let u=0;u<i.length;u+=3)s.push([i[u],i[u+1]]);const r=Js(s,1/0),l=new i.constructor(r.length*3),c=new Uint32Array(1+r.length+1);c[0]=r.length;for(let u=0,d=0;u<r.length;u++,d+=3){const h=r[u];l[d]=h[0],l[d+1]=h[1],l[d+2]=0,c[u+1]=u}c[c.length-1]=c[1],o.getPoints().setData(l),o.getLines().setData(c)},e.extractContours=(a,o)=>{var l;const i=[];n.clear();const s=a.getLines();o.getPoints().setData(Float32Array.from(a.getPoints().getData()));for(let c=0;c<s.getNumberOfCells();c++){if(n.has(c))continue;const{cellPointIds:u}=a.getCellPoints(c);if(!u)continue;n.add(c);const d=u[0],h=[];h.push({t:0,ptId:d});const v=e.traverseLoop(a,1,c,d,h);d!==v&&(e.traverseLoop(a,-1,c,d,h),h.sort((p,f)=>p.t<f.t?-1:1),h.length&&h[0].ptId!==((l=h.at(-1))==null?void 0:l.ptId)&&h.push({...h.at(-1)})),h.length&&i.push(h)}const r=o.getLines();if(r.resize(0),e.getMergeContours()&&i.length){let c=0,u=0;i.forEach((d,h)=>{d.length>u&&(c=h,u=d.length)}),r.insertNextCell(i[c].map(d=>d.ptId))}else i.forEach(c=>{r.insertNextCell(c.map(u=>u.ptId))})},e.requestData=(a,o)=>{const[i]=a;o[0]||(o[0]=Ze.newInstance());const[s]=o;e.getConvexHull()?e.computeConvexHull(i,s):e.extractContours(i,s),s.modified()}}const Mf={mergeContours:!1,convexHull:!1};function ss(e,t,n={}){Object.assign(t,Mf,n),_.obj(e,t),_.algo(e,t,1,1),_.setGet(e,t,["mergeContours","convexHull"]),kf(e,t)}const Bf=_.newInstance(ss,"vtkContourLoopExtraction"),Af={newInstance:Bf,extend:ss};function Ff(e){return Array.isArray(e)?[...e]:e.constructor.from(e)}function Nf(e,t){t.classHierarchy.push("vtkTransformPolyDataToPlane"),e.requestData=(n,a)=>{const o=e.getRefPlane()??ka(),[i]=n;a[0]||(a[0]=Ze.newInstance());const[s]=a,r=Float32Array.from(i.getPoints().getData());s.getPoints().setData(r);const l=[0,0],c=[0,0,0];for(let d=0;d<r.length;d+=3)vt(l,r[d],r[d+1]),Cn(l,o,c),r[d]=c[0],r[d+1]=c[1],r[d+2]=c[2];const u=i.getLines().getData();s.getLines().setData(Ff(u)),s.modified()}}const $f={refPlane:null};function rs(e,t,n={}){Object.assign(t,$f,n),_.obj(e,t),_.algo(e,t,1,1),_.setGet(e,t,["refPlane"]),Nf(e,t)}const Uf=_.newInstance(rs,"vtkTransformPolyDataToPlane"),Hf={newInstance:Uf,extend:rs},Wf="m",zf="c",jf=2;function Gf(){const e=Bi.newInstance(),t=Yt.newInstance(),n=e.getProperty();return e.setMapper(t),{actor:e,mapper:t,property:n}}function Xf(e,t){const n={...e};t.imageData=null,t.sliceAxis=0,t.slice=0,t.loops=Ze.newInstance(),t.maskBoundaryLines=Ze.newInstance(),t.mergeContours=!1,t.doConvexHull=!1,t.contour=Gf(),t.contour.property.setLineWidth(jf),t.contourLoopExtraction=Af.newInstance(),t.transformPolyData=Hf.newInstance(),t.transformPolyData.setInputConnection(t.contourLoopExtraction.getOutputPort());function a(){t.contour.mapper.setInputData(Ze.newInstance())}function o(){var w;(w=t._renderer)==null||w.addActor(t.contour.actor)}function i(){var w;(w=t._renderer)==null||w.removeActor(t.contour.actor)}function s(){const w=t.widgetState.getStore(),T=t.widgetState.getId(),S=w.toolByID[T],b=t.contourLoopExtraction.getOutputData(),O=b.getLines(),D=b.getPoints(),k=O.getData().length,L=[0,0,0];for(let $=0;$<k;){const Y=O.getCell($);$+=Y.length+1;const J=[];let{length:B}=Y;Y[0]===Y.at(-1)&&B--;for(let W=0;W<B;W++)D.getPoint(Y[W],L),J.push(L[0],L[1]);w.addTool({...S,polyLine:J})}}a();let r=null,l=null,c=0,u=0,d=[0,0,0],h=[0,0,0],v=[0,0];function p(){if(!r)return;t.transformPolyData.setRefPlane(t.widgetState.getReferencePlane());const w=t.transformPolyData.getOutputData();t.contour.mapper.setInputData(w),t.contour.mapper.modified()}function f(){return e.getMode()===Ve.Threshold}function m(){i(),a(),e.getWidgetState().getCircleContext().setVisible(!1),t._widgetManager.releaseFocus(),e.setInteractionState(Q.Idle),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent()}e.resetInteractionState=()=>{f()&&!e.isInteractionIdle()&&m(),n.resetInteractionState()},e.setThresholdingImageSlice=(w,T,S)=>{t.imageData=w,t.sliceAxis=T,t.slice=Math.round(S)},e.handleKeyPress=w=>{var S;if(((S=n.handleKeyPress)==null?void 0:S.call(n,w))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!f()||!t.manipulator||he(w)||t.widgetState.getFinalized()||e.getInteractionState()!==Q.Thresholding)return _.VOID;let T=!1;return w.key===Wf?(t.mergeContours=!t.mergeContours,t.contourLoopExtraction.setMergeContours(t.mergeContours),T=!0):w.key===zf&&(t.doConvexHull=!t.doConvexHull,t.contourLoopExtraction.setConvexHull(t.doConvexHull),T=!0),T?(p(),e.invokeInteractionEvent(),_.EVENT_ABORT):_.VOID},e.handleLeftButtonPress=w=>{var O;if(((O=n.handleLeftButtonPress)==null?void 0:O.call(n,w))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!f()||!t.manipulator||he(w))return _.VOID;if(!t.imageData||t.sliceAxis==null||t.slice==null)return _.VOID;if(r=t.imageData,c=t.sliceAxis,u=t.slice,l=Ef(r,c),t.widgetState.getFinalized())return _.VOID;const T=t._widgetManager.getActiveWidget();if(T&&T!==e)return _.VOID;const S=Ie(t,w);if(!S)return _.VOID;o(),t.mergeContours=!1;const b=t.imageData.worldToIndex(S);return d=S,h=No(b),v=gn(h,c),t._widgetManager.grabFocus(e),e.setInteractionState(Q.Thresholding),t.widgetState.setFinalized(!1),t.widgetState.clearPolyLine(),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),_.EVENT_ABORT},e.handleMouseMove=w=>{var S;if(((S=n.handleMouseMove)==null?void 0:S.call(n,w))===_.EVENT_ABORT)return _.EVENT_ABORT;if(!f()||e.getInteractionState()!==Q.Thresholding||he(w))return _.VOID;if(!r)return _.VOID;const T=No(r.worldToIndex(Ie(t,w)));if(T&&r&&l){const b=gn(T,c),O=Math.abs(b[0]-v[0]),D=Math.abs(b[1]-v[1]),k=r.getDimensions(),L=gn(k,c),$=Math.sqrt(L[0]**2+k[1]**2),Y=r.getPointData().getScalars().getRange(),J=Y[1]-Y[0],B=Math.min(D,$)/$*J;Vf(r,c,u,l,h,B,O),t.maskBoundaryLines=Pf(l),t.maskBoundaryLines.buildLinks(),t.contourLoopExtraction.setInputData(t.maskBoundaryLines),p();const W=t.manipulator.getNormal(),Z=t._renderer.getActiveCamera().getViewUp(),Ce=Le();Gn(Ce,Z,W);const me=t.widgetState.getCircleContext();me.setDirection(W),me.setUp(Z),me.setRight(Ce),me.setOrigin(d),me.setScale3([O,D,1]),me.setVisible(!0),e.invokeInteractionEvent()}return _.EVENT_ABORT},e.handleLeftButtonRelease=w=>{var T;return((T=n.handleLeftButtonRelease)==null?void 0:T.call(n,w))===_.EVENT_ABORT?_.EVENT_ABORT:!f()||e.getInteractionState()!==Q.Thresholding||he(w)?_.VOID:(s(),m(),_.EVENT_ABORT)}}function qf(e,t){t.classHierarchy.push("vtkContourWidgetProp"),t.interactionState=Q.Idle,t.mode=null,_.event(e,t,"RightClickEvent"),_.setGet(e,t,["manipulator"]),_.setGet(e,t,["mode"]),_.setGet(e,t,["interactionState"]),e.setDisplayCallback=n=>t.representations[0].setDisplayCallback(n),e.isInteractionIdle=()=>e.getInteractionState()===Q.Idle,e.resetInteractionState=()=>{e.setInteractionState(Q.Idle)},e.isSelected=()=>t.widgetState.getSelected(),e.handleRightButtonPress=n=>he(n)||t._widgetManager.getActiveWidget()!==e?_.VOID:(e.invokeRightClickEvent(n),_.EVENT_ABORT),hf(e,t),uf(e,t),Sf(e,t),wf(e,t),Xf(e,t)}function Yf(e,t,n){yn.extend(e,t,n),Qr.extend(e,t,n),ki.extend(e,t,n),Jr.extend(e,t,n),Zr.extend(e,t,n)}const Kf=_.newInstance(Yf,"vtkCircleContextContourWidgetState");function Qf(e,t){t.classHierarchy.push("vtkContourWidgetState"),t._circleContextState=Kf(),e.bindState(t._circleContextState,["circleContext"]),e.getCircleContext=()=>t._circleContextState;function n(){return t._store.toolByID[t.id]}e.getPolyLine=()=>{var o;return Zs((o=n())==null?void 0:o.polyLine)},e.getReferencePlane=()=>{var o;return(o=n())==null?void 0:o.referencePlane},e.getPolyLineLength=()=>{var i;const o=(i=n())==null?void 0:i.polyLine;return o?o.length/2:0};const a=Me();e.add3dPointToPolyLine=o=>{const i=e.getPolyLine(),s=e.getReferencePlane();!i||!s||(et(o,s,a),e.add2dPointToPolyLine(a))},e.add2dPointToPolyLine=o=>{const i=e.getPolyLine();i&&(i.push(...o),e.modified())},e.clearPolyLine=()=>{const o=e.getPolyLine();o&&(o.length=0,e.modified())},e.setPolyLine=o=>{const i=n();i&&(i.polyLine=o,e.modified())},e.getColor=()=>{var i;const o=(i=n())==null?void 0:i.label;return o?vh(t._store.labels[o].color).map(s=>s/255):null}}const Jf=e=>({finalized:!1,selected:!1,...e});function Zf(e,t,n){if(Object.assign(t,Jf(n)),yn.extend(e,t,n),Mi.extend(e,t),_.get(e,t,["id"]),_.setGet(e,t,["finalized","selected"]),_.moveToProtected(e,t,["store"]),_.get(e,t,["_store"]),!t.id)throw new Error("No ID provided!");if(!t._store)throw new Error("No store provided!");Qf(e,t)}const ep=_.newInstance(Zf,"vtkContourWidgetState");function tp(e){return ep(e)}function np(e,t){t.classHierarchy.push("vtkContourWidget"),e.getRepresentationsForViewType=n=>{switch(n){case Qe.DEFAULT:case Qe.GEOMETRY:case Qe.SLICE:case Qe.VOLUME:default:return[{builder:cf},{builder:el,labels:["circleContext"]}]}},e.setManipulator(t.manipulator||je.newInstance())}const op=e=>({manipulator:null,behavior:qf,widgetState:tp(e),...e});function ls(e,t,n={}){Object.assign(t,op(n)),mn.extend(e,t,n),_.setGet(e,t,["manipulator"]),_.event(e,t,"finalized"),np(e,t)}const ip=_.newInstance(ls,"vtkContourWidget"),ap={newInstance:ip,extend:ls},sp={[ye.Select]:Ve.Select,[ye.FreehandDraw]:Ve.Freehand,[ye.CircleNudge]:Ve.Nudge,[ye.PointPlacing]:Ve.PointPlacing,[ye.Threshold]:Ve.Threshold},rp=X({name:"ContourWidget2D",emits:["finalize","select","contextmenu"],props:{contourId:{type:String,required:!0},widgetManager:{type:Object,required:!0},viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},currentSlice:{type:Number,required:!0},drawing:{type:Boolean,default:!1},selected:{type:Boolean,default:!1},mode:{type:String,required:!0}},setup(e,{emit:t}){const{viewId:n,contourId:a,widgetManager:o,viewDirection:i,currentSlice:s,drawing:r,selected:l,mode:c}=ae(e),u=bn(),d=I(()=>u.toolByID[a.value]),{currentImageData:h,currentImageID:v,currentImageMetadata:p}=se(),f=I(()=>u.$proxies.getView(n.value)),m=ap.newInstance({id:a.value,store:u,finalized:!r.value}),w=M(null),T=I(()=>{var L;return(L=w.value)==null?void 0:L.getWidgetState()});ee(()=>{w.value=o.value.addWidget(m)}),Ne(()=>{w.value&&(o.value.removeWidget(w.value),w.value.delete(),m.delete())}),fe(()=>{var $;const L=sp[c.value];($=w.value)==null||$.setMode(L)}),F([s,v,w],()=>{var L;(L=w.value)==null||L.resetInteractionState()}),we(()=>{var L;(L=w.value)==null||L.resetInteractionState()}),Se(I(()=>{var L;return(L=w.value)==null?void 0:L.onEndInteractionEvent}))(()=>{var L;(L=w.value)!=null&&L.getWidgetState().getFinalized()&&t("finalize")}),Se(I(()=>{var L;return(L=w.value)==null?void 0:L.onSelectedEvent}))(L=>{t("select",L)}),fe(()=>{var L,$;(L=T.value)==null||L.setSelected(l.value),($=f.value)==null||$.renderLater()});let O=null;ee(()=>{w.value&&(O=w.value.onRightClickEvent(L=>{const $=uo(L);$&&t("contextmenu",$)}))}),we(()=>{O&&(O.unsubscribe(),O=null)});const D=je.newInstance();ee(()=>{var L;(L=w.value)==null||L.setManipulator(D)}),fe(()=>{nn(D,i.value,s.value,p.value)}),F(()=>{var L;return!!f.value&&!!w.value&&((L=d.value)==null?void 0:L.slice)===s.value},L=>{var $;($=w.value)==null||$.setVisibility(L)},{immediate:!0}),ee(()=>{var L;w.value&&(w.value.setHandleVisibility(!1),o.value.renderWidgets(),(L=f.value)==null||L.renderLater())}),F(()=>{var L;return(L=w.value)==null?void 0:L.getWidgetState().getColor()},()=>{var L,$;(L=w.value)==null||L.getWidgetState().modified(),($=f.value)==null||$.renderLater()});const k=I(()=>p.value.lpsOrientation[Te(i.value)]);return fe(()=>{const L=h.value,$=k.value,Y=s.value;w.value&&L&&w.value.setThresholdingImageSlice(L,$,Y)}),()=>null}}),lp=new Set([ye.FreehandDraw,ye.PointPlacing,ye.Threshold]);function cp(e,t,n=1e-6){return Math.abs(e-t)<n}const up=X({components:{ContourWidget2D:rp},props:{viewId:{type:String,required:!0},currentSlice:{type:Number,required:!0},viewDirection:{type:String,required:!0},widgetManager:{type:Object,required:!0}},setup(e){const{viewId:t,viewDirection:n,currentSlice:a}=ae(e),o=Oe(),i=bn(),{currentImageID:s,currentImageMetadata:r}=se(),l=I(()=>Te(n.value)),{mode:c,selectedContourID:u}=tt(i),d=M(null),h=I(()=>o.currentTool===ne.Contour),v=I(()=>de().viewSpecs[t.value].viewType),p=(B,W)=>{const{toolByID:Z}=i;if(!(B in Z))return!1;const{referencePlane:Ce,imageID:me}=Z[B],Ge=qd(Ce),Et=_n(Ge,r.value,{allowOutOfBoundsSlice:!0});if(!Et)return!1;const Dn=(W==null?void 0:W.checkImageID)??!1,an=(W==null?void 0:W.checkSlice)??!1,{axis:En,slice:sn}=Et;return En===l.value&&(!Dn||me===s.value)&&(!an||cp(sn,a.value))},f=I(()=>i.toolIDs.filter(B=>p(B,{checkImageID:!0})).map(B=>i.toolByID[B]).filter(Boolean)),m=()=>{d.value=null},w=()=>{s.value&&!d.value&&(d.value=i.addTool({imageID:s.value}))},T=()=>{d.value!=null&&(i.removeTool(d.value),d.value=null)},{activeLabel:S}=tt(i);F([S,d],([B,W])=>{W&&i.updateTool(W,{label:B})},{immediate:!0}),F([h,s],([B,W])=>{T(),B&&W&&w()},{immediate:!0}),F(c,B=>{T(),lp.has(B)&&w()},{immediate:!0}),Ne(()=>{T()});const b=B=>{B===d.value&&(m(),w())};function O(){const{lpsOrientation:B,indexToWorld:W}=r.value,Z=B[l.value];return Kd(W,a.value,Z)}F([a,d],([B,W])=>{W&&i.updateTool(W,{slice:B,referencePlane:O()})},{immediate:!0});const D=(B,W)=>{W?i.selectContour(B):B===u.value&&i.selectContour(null)};F([a,s],()=>{const B=u.value;B&&p(B,{checkImageID:!0,checkSlice:!0})&&i.selectContour(null)}),At(["Delete","Backspace"],B=>{B.preventDefault(),u.value&&i.removeTool(u.value)});const k=ze({visible:!1,x:0,y:0,id:""}),L=(B,W)=>{[k.x,k.y]=W,k.visible=!0,k.id=B},$=()=>{i.removeTool(k.id)},Y=I(()=>{const{id:B}=k;if(!(B in i.toolByID))return[];const W=i.toolByID[B];return Object.entries(i.labels).map(([Z,Ce])=>({id:Z,name:Ce.labelName,isCurrent:W.label===Z}))}),J=B=>{i.updateTool(k.id,{label:B})};return{isToolActive:h,is2D:I(()=>v.value==="2D"),contours:f,drawingContourID:d,selectedContourID:u,toolMode:I(()=>h.value?c.value:ye.Select),contextMenu:k,contextMenuLabels:Y,onContourFinalized:b,onContourSelected:D,onContextMenu:L,deleteFromContextMenu:$,setLabelFromContextMenu:J}}});const dp=e=>(le("data-v-f660d016"),e=e(),ce(),e),hp={key:0,class:"overlay-no-events"},gp=dp(()=>g("span",null,"Change label to...",-1));function fp(e,t,n,a,o,i){const s=P("ContourWidget2D");return e.is2D?(R(),E("div",hp,[(R(!0),E(ue,null,Be(e.contours,r=>(R(),K(s,{key:r.id,"view-id":e.viewId,"current-slice":e.currentSlice,"contour-id":r.id,"view-direction":e.viewDirection,"widget-manager":e.widgetManager,drawing:e.drawingContourID===r.id,mode:e.toolMode,selected:e.selectedContourID===r.id,onFinalize:l=>e.onContourFinalized(r.id),onSelect:l=>e.onContourSelected(r.id,l),onContextmenu:l=>e.onContextMenu(r.id,l)},null,8,["view-id","current-slice","contour-id","view-direction","widget-manager","drawing","mode","selected","onFinalize","onSelect","onContextmenu"]))),128)),y(wt,{modelValue:e.contextMenu.visible,"onUpdate:modelValue":t[1]||(t[1]=r=>e.contextMenu.visible=r),style:ie({position:"absolute",top:`${e.contextMenu.y}px`,left:`${e.contextMenu.x}px`}),"close-on-click":"","close-on-content-click":""},{default:x(()=>[y(Ft,{dense:""},{default:x(()=>[y(Je,{onClick:t[0]||(t[0]=oe(()=>{},["stop"]))},{default:x(()=>[y(De,{class:"d-flex flex-row align-center justify-space-betwen"},{default:x(()=>[gp,y(yt,null,{default:x(()=>[H("mdi-chevron-right")]),_:1})]),_:1}),y(wt,{"open-on-hover":"",activator:"parent",location:"end"},{default:x(()=>[y(Ft,{dense:""},{default:x(()=>[(R(!0),E(ue,null,Be(e.contextMenuLabels,(r,l)=>(R(),K(Je,{key:l},{default:x(()=>[y(wr,{label:r.name,"model-value":r.isCurrent,onClick:c=>e.setLabelFromContextMenu(r.id)},null,8,["label","model-value","onClick"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),y(Je,{onClick:e.deleteFromContextMenu},{default:x(()=>[y(De,null,{default:x(()=>[H("Delete")]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1},8,["modelValue","style"])])):j("",!0)}const pp=A(up,[["render",fp],["__scopeId","data-v-f660d016"]]),mp=X({name:"PaintWidget2D",props:{widgetManager:{type:Object,required:!0},viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},slice:{type:Number,required:!0}},setup(e){const{widgetManager:t,viewDirection:n,slice:a,viewId:o}=ae(e),i=rt(),s=i.getWidgetFactory(),r=de(),l=I(()=>r.getViewProxy(o.value)),c=M(),{currentImageMetadata:u}=se(),d=I(()=>Te(n.value)),h=I(()=>u.value.lpsOrientation[d.value]),v=m=>{const{worldToIndex:w}=u.value,T=Le();return pe(T,m,w),T};ee(()=>{const m=t.value;if(c.value=m.addWidget(s),!c.value)throw new Error("[PaintWidget2D] failed to create view widget")}),fe(()=>{const m=c.value,w=u.value,T=w.lpsOrientation[d.value];m&&(m.setSlicingIndex(T),m.setIndexToWorld(w.indexToWorld),m.setWorldToIndex(w.worldToIndex))});const p=[];ee(()=>{const m=c.value;p.push(m.onStartInteractionEvent(()=>{const w=m.getWidgetState(),T=v(w.getBrush().getOrigin());i.startStroke(T,h.value)}),m.onInteractionEvent(()=>{const w=m.getWidgetState(),T=v(w.getBrush().getOrigin());i.placeStrokePoint(T,h.value)}),m.onEndInteractionEvent(()=>{const w=m.getWidgetState(),T=v(w.getBrush().getOrigin());i.endStroke(T,h.value)}))}),Ne(()=>{for(;p.length;)p.pop().unsubscribe()});const f=je.newInstance();return ee(()=>{c.value.setManipulator(f)}),fe(()=>{nn(f,n.value,a.value,u.value)}),ee(()=>{c.value.setVisibility(!1)}),jt(l.value.getInteractor().onMouseEnter(()=>{const m=c.value;m&&(i.setSliceAxis(h.value),m.setVisibility(!0))})),jt(l.value.getInteractor().onMouseLeave(()=>{const m=c.value;m&&m.setVisibility(!1)})),ee(()=>{const m=t.value;m.renderWidgets(),m.grabFocus(c.value)}),we(()=>{t.value.removeWidget(c.value),t.value.releaseFocus()}),()=>null}}),vp=X({name:"PaintTool",props:{viewId:{type:String,required:!0},slice:{type:Number,required:!0},viewDirection:{type:String,required:!0},widgetManager:{type:Object,required:!0}},components:{PaintWidget2D:mp},setup(){const e=rt();return{active:I(()=>e.isActive)}}});const yp={class:"overlay-no-events"};function wp(e,t,n,a,o,i){const s=P("PaintWidget2D");return R(),E("div",yp,[e.active?(R(),K(s,{key:0,slice:e.slice,"view-id":e.viewId,"view-direction":e.viewDirection,"widget-manager":e.widgetManager},null,8,["slice","view-id","view-direction","widget-manager"])):j("",!0)])}const Sp=A(vp,[["render",wp],["__scopeId","data-v-5ff6d31b"]]);function _p(e,t){const n=de(),a=I(()=>n.getViewProxy(e.value)),o=I(()=>{var u;const c=(u=t.baseImage)==null?void 0:u.value;return c?n.getDataRepresentationForView(c,e.value):null}),i=I(()=>{var u;return(((u=t.labelmaps)==null?void 0:u.value)??[]).map(d=>n.getDataRepresentationForView(d,e.value)).filter(Boolean)}),s=I(()=>{var c;return(((c=t.layers)==null?void 0:c.value)??[]).map(u=>n.getDataRepresentationForView(u,e.value)).filter(Boolean)}),r=I(()=>{var u;return(((u=t.models)==null?void 0:u.value)??[]).map(d=>n.getDataRepresentationForView(d,e.value)).filter(Boolean)}),l=I(()=>[o.value,...i.value,...s.value,...r.value].filter(Boolean));return F([a,l],([c,u],[,d])=>{if(!c)throw new Error("[useSceneBuilder] No view available");d&&Jn(u,d)||(c.removeAllRepresentations(),u.forEach(h=>{c.addRepresentation(h)}),c.getRenderer().computeVisiblePropBounds(),c.renderLater())},{immediate:!0}),{baseImageRep:o,labelmapReps:i,layerReps:s,modelReps:r}}function Cp(e,t,n,...a){const o=ho();let i=!0;const s=[];a.indexOf("position")>-1&&s.push(()=>{t.value!==null&&i&&o.updateConfig(e.value,t.value,{position:n.value.getCamera().getPosition()})}),a.indexOf("viewUp")>-1&&s.push(()=>{t.value!==null&&i&&o.updateConfig(e.value,t.value,{viewUp:n.value.getCamera().getViewUp()})}),a.indexOf("focalPoint")>-1&&s.push(()=>{t.value!==null&&i&&o.updateConfig(e.value,t.value,{focalPoint:n.value.getCamera().getFocalPoint()})}),a.indexOf("directionOfProjection")>-1&&s.push(()=>{t.value!==null&&i&&o.updateConfig(e.value,t.value,{directionOfProjection:n.value.getCamera().getDirectionOfProjection()})}),a.indexOf("parallelScale")>-1&&s.push(()=>{t.value!==null&&i&&o.updateConfig(e.value,t.value,{parallelScale:n.value.getCamera().getParallelScale()})}),jt(n.value.getCamera().onModified(()=>{s.forEach(c=>c())}));function r(c){i=!1;try{c()}finally{i=!0}}function l(c){r(()=>{a.forEach(u=>{if(u==="parallelScale"&&c.parallelScale)n.value.getCamera().setParallelScale(c.parallelScale);else if(u==="position"&&c.position){const{position:d}=c;n.value.getCamera().setPosition(d[0],d[1],d[2])}else if(u==="focalPoint"&&c.focalPoint){const{focalPoint:d}=c;n.value.getCamera().setFocalPoint(d[0],d[1],d[2]),n.value.getInteractorStyle2D().setCenterOfRotation([...d]),n.value.getInteractorStyle3D().setCenterOfRotation([...d])}else if(u==="directionOfProjection"&&c.directionOfProjection){const{directionOfProjection:d}=c;n.value.getCamera().setDirectionOfProjection(d[0],d[1],d[2])}else if(u==="viewUp"&&c.viewUp){const{viewUp:d}=c;n.value.getCamera().setViewUp(d[0],d[1],d[2])}})})}return{restoreCameraConfig:l}}const bp=X({name:"CrosshairsWidget2D",props:{widgetManager:{type:Object,required:!0},viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},slice:{type:Number,required:!0}},setup(e){const{widgetManager:t,viewDirection:n,slice:a}=ae(e),i=zt().getWidgetFactory(),s=M(),{currentImageMetadata:r}=se();ee(()=>{const c=t.value;if(s.value=c.addWidget(i),!s.value)throw new Error("[PaintWidget2D] failed to create view widget")});const l=je.newInstance();return ee(()=>{s.value.setManipulator(l)}),fe(()=>{nn(l,n.value,a.value,r.value)}),ee(()=>{s.value.setVisibility(!0)}),ee(()=>{t.value.renderWidgets()}),we(()=>{t.value.removeWidget(s.value)}),()=>null}}),Tp=X({props:{position:Array,viewId:{type:String,required:!0}},setup(e){const{viewId:t,position:n}=ae(e),a=M(),o=de(),i=I(()=>o.getViewProxy(t.value)),s=()=>{const c=i.value.getRenderer(),u=z(n);if(u){const d=Wt(u,c);d&&(a.value={x:d[0],y:d[1]})}};Se(I(()=>i.value.getCamera().onModified))(s),fe(s);const l=lt(pn);return In(l,()=>{s()}),{devicePixelRatio,x:I(()=>{var c;return(c=a.value)==null?void 0:c.x}),y:I(()=>{var c;return(c=a.value)==null?void 0:c.y})}}});const Ip=["x1","x2","y2"],Rp=["x1","y1","x2"],xp=["y1","x2","y2"],Dp=["x1","y1","y2"];function Ep(e,t,n,a,o,i){return R(),E("g",null,[e.x!=null&&e.y!=null?(R(),E("line",{key:0,x1:e.x,y1:"0%",x2:e.x,y2:e.y-8,stroke:"yellow","stroke-width":"1"},null,8,Ip)):j("",!0),e.x!=null&&e.y!=null?(R(),E("line",{key:1,x1:e.x,y1:e.y+8,x2:e.x,y2:"100%",stroke:"yellow","stroke-width":"1"},null,8,Rp)):j("",!0),e.x!=null&&e.y!=null?(R(),E("line",{key:2,x1:"0%",y1:e.y,x2:e.x-8,y2:e.y,stroke:"yellow","stroke-width":"1"},null,8,xp)):j("",!0),e.x!=null&&e.y!=null?(R(),E("line",{key:3,x1:e.x+8,y1:e.y,x2:"100%",y2:e.y,stroke:"yellow","stroke-width":"1"},null,8,Dp)):j("",!0)])}const Lp=A(Tp,[["render",Ep],["__scopeId","data-v-d7c70d6c"]]),Op=X({name:"CrosshairsTool",props:{viewId:{type:String,required:!0},slice:{type:Number,required:!0},viewDirection:{type:String,required:!0},widgetManager:{type:Object,required:!0}},components:{CrosshairsWidget2D:bp,CrosshairSVG2D:Lp},setup(e){const{viewDirection:t,slice:n}=ae(e),a=Oe(),{position:o,imagePosition:i}=tt(zt()),{currentImageMetadata:s}=se(),r=I(()=>a.currentTool===ne.Crosshairs),l=I(()=>{const{lpsOrientation:c,dimensions:u}=s.value,d=Te(t.value),h=c[d],v=Wi(i.value[h],0,u[h]-1);return Math.round(v)===n.value});return{active:r,position:o,isVisible:l}}});const Vp={key:0,class:"overlay-no-events"},Pp={class:"overlay-no-events"};function kp(e,t,n,a,o,i){const s=P("CrosshairSVG2D"),r=P("CrosshairsWidget2D");return e.active?(R(),E("div",Vp,[(R(),E("svg",Pp,[pt(y(s,{"view-id":e.viewId,position:e.position},null,8,["view-id","position"]),[[qn,e.isVisible]])])),y(r,{slice:e.slice,"view-id":e.viewId,"view-direction":e.viewDirection,"widget-manager":e.widgetManager},null,8,["slice","view-id","view-direction","widget-manager"])])):j("",!0)}const Mp=A(Op,[["render",kp],["__scopeId","data-v-8f19f7a7"]]);function Bp(e,t){const n=de(),a=M(null),o=s=>{a.value=s??null},i=I(()=>n.createOrGetViewProxy(z(e),z(t)));return F(i,(s,r)=>{r.setContainer(null),s.setContainer(a.value)}),F(a,s=>{i.value.setContainer(s),i.value.modified()}),{viewProxy:i,setContainer:o}}function Ap(e,t){Se(I(()=>z(e).onModified))(t)}function cs(e){const t=M(!1),n=()=>{t.value=!!z(e).getContainer()};return n(),Ap(e,n),t}function us(e,t){const n=cs(e);F(n,a=>{a&&t()},{immediate:!0})}function Fp(e,t){const n=cs(e);F(n,(a,o)=>{o&&!a&&t()},{immediate:!0})}function Np(e){const t=I(()=>tl.newInstance({pickingEnabled:!1,useSvgLayer:!1,captureOn:nl.MOUSE_MOVE}));return us(e,()=>{t.value.setRenderer(e.value.getRenderer()),t.value.enablePicking()}),Fp(e,()=>{t.value.disablePicking()}),F(t,(n,a)=>{n&&(n.setRenderer(e.value.getRenderer()),n.enablePicking()),a&&a.delete()}),Ne(()=>{t.value.delete()}),{widgetManager:t}}function ds(e){const t=Dt(),{currentImageMetadata:n,currentImageID:a}=se();return I(()=>{const o=t.getConfig(z(e),a.value);if(!o)return null;const{lpsOrientation:i}=n.value,s=Te(o.axisDirection),r=[0,0,0];return r[i[s]]=o.slice,{axisName:s,axisIndex:i[s],number:o.slice,planeNormal:i[o.axisDirection],planeOrigin:r}})}function $p(e){const t=M(null),n=()=>{var o;t.value=((o=z(e))==null?void 0:o.getContainer())??null};return Se(I(()=>{var o;return(o=z(e))==null?void 0:o.onModified}))(n),n(),t}function Up(e,t){const n=M([]),a=I(()=>{var r,l,c;return(c=(l=(r=z(t))==null?void 0:r.getRenderWindow())==null?void 0:l.getViews())==null?void 0:c[0]}),o=$p(a),i=()=>{const r=z(e),l=z(t);r==null||!l||(n.value=r.map(c=>{const u=La(c,l);return[u[0]/devicePixelRatio,u[1]/devicePixelRatio]}))},s=Se(I(()=>{var r;return(r=z(t))==null?void 0:r.getActiveCamera().onModified}));return er(o,i),fe(i),s(i),i(),n}function Hp(e,t){const n=Up(e,t);return I(()=>{var r,l;const o=n.value,i=z(t),s=(l=(r=i==null?void 0:i.getRenderWindow())==null?void 0:r.getViews())==null?void 0:l[0];if(i&&s){const[,c]=s.getViewportSize(i);return o.map(u=>[u[0],c/devicePixelRatio-u[1]])}return null})}const Wp=X({props:{line:{required:!0,type:Object},clickWidth:{default:20,type:Number},outOfBounds:{default:!1,type:Boolean}},setup(){const e=M("grab"),t=M(null),n=M(0);return{onPointer:(i,s)=>{var r,l;i?(r=t.value)==null||r.setPointerCapture(s.pointerId):(l=t.value)==null||l.releasePointerCapture(s.pointerId),e.value=i?"grabbing":"grab"},onHover:i=>{n.value=i?2:0},cursor:e,grabLineEl:t,focusWidth:n}}});const zp=["x1","y1","x2","y2","stroke-width"],jp=["x1","y1","x2","y2","stroke-width","stroke-dasharray"],Gp=["x1","y1","x2","y2","stroke-width"],Xp=["x1","y1","x2","y2","stroke-width"];function qp(e,t,n,a,o,i){return R(),E("g",null,[g("line",{x1:e.line.startEdge[0],y1:e.line.startEdge[1],x2:e.line.startCrop[0],y2:e.line.startCrop[1],"stroke-width":2+e.focusWidth,"stroke-dasharray":"6","stroke-linecap":"square",stroke:"rgba(200, 255, 0, 0.5)"},null,8,zp),g("line",{x1:e.line.startCrop[0],y1:e.line.startCrop[1],x2:e.line.endCrop[0],y2:e.line.endCrop[1],"stroke-width":2+e.focusWidth,"stroke-dasharray":e.outOfBounds?6:"none","stroke-linecap":"butt",stroke:"rgb(200, 255, 0)"},null,8,jp),g("line",{x1:e.line.endCrop[0],y1:e.line.endCrop[1],x2:e.line.endEdge[0],y2:e.line.endEdge[1],"stroke-width":2+e.focusWidth,"stroke-dasharray":"6","stroke-linecap":"square",stroke:"rgba(200, 255, 0, 0.5)"},null,8,Gp),g("line",Xt({ref:"grabLineEl",class:"pointer-events-all",style:{cursor:e.cursor},onPointerenter:t[0]||(t[0]=s=>e.onHover(!0)),onPointerleave:t[1]||(t[1]=s=>e.onHover(!1)),onPointerdown:t[2]||(t[2]=s=>e.onPointer(!0,s)),onPointerup:t[3]||(t[3]=s=>e.onPointer(!1,s)),x1:e.line.startEdge[0],y1:e.line.startEdge[1],x2:e.line.endEdge[0],y2:e.line.endEdge[1],fill:"none","stroke-opacity":"0","stroke-dasharray":"none","stroke-width":Number(e.$attrs["stroke-width"]||0)+e.clickWidth||0},e.$attrs),null,16,Xp)])}const Yp=A(Wp,[["render",qp],["__scopeId","data-v-926e0a5c"]]);function si(e,t,n,a){const o=ds(e);return I(()=>{const i=e.value,s=t.value,r=n.value,l=a.value,c=o.value;if(!i||!s||!c)return null;const u=c.axisName,[d]=eo.filter(S=>S!==s&&S!==u),h=r[s],v=r[d],p=l[d],f=r[u],m=c.number,w=m<f[0]||f[1]<m,T=S=>{const b=gt(),O=gt(),D=gt(),k=gt();return b[s]=h[S],O[s]=h[S],D[s]=h[S],k[s]=h[S],[b[d],k[d]]=p,[O[d],D[d]]=v,{startEdge:b,startCrop:O,endCrop:D,endEdge:k}};return{lowerLine:T(0),upperLine:T(1),outOfBounds:w}})}function ri(e,t,n){const a=I(()=>{const i=e.value,{lpsOrientation:s,indexToWorld:r}=t.value;return i?[i.lowerLine.startEdge,i.lowerLine.startCrop,i.lowerLine.endCrop,i.lowerLine.endEdge,i.upperLine.startEdge,i.upperLine.startCrop,i.upperLine.endCrop,i.upperLine.endEdge].map(l=>{const c=[0,0,0];c[s.Sagittal]=l.Sagittal,c[s.Coronal]=l.Coronal,c[s.Axial]=l.Axial;const u=[0,0,0];return pe(u,c,r),u}):null}),o=Hp(a,n);return I(()=>{const i=e.value,s=o.value;return!i||!(s!=null&&s.length)?null:{lowerLine:{startEdge:s[0],startCrop:s[1],endCrop:s[2],endEdge:s[3]},upperLine:{startEdge:s[4],startCrop:s[5],endCrop:s[6],endEdge:s[7]},outOfBounds:i.outOfBounds}})}function Kp({mouseEventToLPSPoint:e,getCropEdgePos:t,setCropEdgePos:n}){const a=M(),o=M(),i=M(gt()),s=M(0);return{onPointerDown:(u,d,h)=>{const v=e(h);v&&(i.value=v,s.value=t(u,d),a.value=u,o.value=d)},onPointerMove:u=>{if(a.value==null||o.value==null)return;const d=a.value,h=e(u);if(!h)return;const v=h[d]-i.value[d];n(d,o.value,s.value+v)},onPointerUp:()=>{a.value=null,o.value=null}}}const Qp=X({props:{viewId:{required:!0,type:String}},components:{Crop2DLineHandle:Yp},setup(e){const{viewId:t}=ae(e),n=de(),a=I(()=>n.getViewProxy(t.value)),o=I(()=>{var D;return(D=a.value)==null?void 0:D.getRenderer()}),{currentImageExtent:i,currentImageID:s,currentImageMetadata:r}=se(),l=ds(t),c=I(()=>{var D;return((D=l.value)==null?void 0:D.axisName)??null}),u=bt(),d=I(()=>{const D=s.value;return D&&D in u.croppingByImageID?u.croppingByImageID[D]:ia()}),h=I(()=>eo.filter(D=>c.value&&D!==c.value)),v=I(()=>h.value[0]??null),p=I(()=>h.value[1]??null),f=si(t,v,d,i),m=si(t,p,d,i),w=ri(f,r,o),T=ri(m,r,o),{onPointerDown:S,onPointerMove:b,onPointerUp:O}=Kp({mouseEventToLPSPoint(D){const k=o.value;if(!k)return null;const L=l.value;if(!L)return null;const{lpsOrientation:$,worldToIndex:Y}=r.value,J=Rd(D,k,L.planeOrigin,L.planeNormal);if(!J)return null;pe(J,J,Y);const B=gt();return B.Sagittal=J[$.Sagittal],B.Coronal=J[$.Coronal],B.Axial=J[$.Axial],B},getCropEdgePos(D,k){return d.value[D][k]},setCropEdgePos(D,k,L){if(!s.value)return;const $=d.value,[Y,J]=$[D],[B,W]=i.value[D],Z=[Y,J];k===0?Z[0]=Math.max(B,Math.min(L,J)):k===1&&(Z[1]=Math.max(Y,Math.min(L,W))),u.setCroppingForAxis(s.value,D,Z)}});return{ax1:I(()=>({name:v.value,lines:w.value})),ax2:I(()=>({name:p.value,lines:T.value})),onPointerDown:S,onPointerMove:b,onPointerUp:O}}});function Jp(e,t,n,a,o,i){const s=P("crop-2D-line-handle");return R(),E("g",null,[e.ax1.lines!=null?(R(),E(ue,{key:0},[y(s,{line:e.ax1.lines.lowerLine,"out-of-bounds":e.ax1.lines.outOfBounds,onPointerdown:t[0]||(t[0]=r=>e.onPointerDown(e.ax1.name,0,r)),onPointermove:e.onPointerMove,onPointerup:e.onPointerUp},null,8,["line","out-of-bounds","onPointermove","onPointerup"]),y(s,{line:e.ax1.lines.upperLine,"out-of-bounds":e.ax1.lines.outOfBounds,onPointerdown:t[1]||(t[1]=r=>e.onPointerDown(e.ax1.name,1,r)),onPointermove:e.onPointerMove,onPointerup:e.onPointerUp},null,8,["line","out-of-bounds","onPointermove","onPointerup"])],64)):j("",!0),e.ax2.lines!=null?(R(),E(ue,{key:1},[y(s,{line:e.ax2.lines.lowerLine,"out-of-bounds":e.ax2.lines.outOfBounds,onPointerdown:t[2]||(t[2]=r=>e.onPointerDown(e.ax2.name,0,r)),onPointermove:e.onPointerMove,onPointerup:e.onPointerUp},null,8,["line","out-of-bounds","onPointermove","onPointerup"]),y(s,{line:e.ax2.lines.upperLine,"out-of-bounds":e.ax2.lines.outOfBounds,onPointerdown:t[3]||(t[3]=r=>e.onPointerDown(e.ax2.name,1,r)),onPointermove:e.onPointerMove,onPointerup:e.onPointerUp},null,8,["line","out-of-bounds","onPointermove","onPointerup"])],64)):j("",!0)])}const Zp=A(Qp,[["render",Jp],["__scopeId","data-v-e3a0b15f"]]);function em(e){return e.Sagittal[0]<=e.Sagittal[1]&&e.Coronal[0]<=e.Coronal[1]&&e.Axial[0]<=e.Axial[1]}function tm(e,t){return e.Axial[0]===t.Axial[0]&&e.Axial[1]===t.Axial[1]&&e.Sagittal[0]===t.Sagittal[0]&&e.Sagittal[1]===t.Sagittal[1]&&e.Coronal[0]===t.Coronal[0]&&e.Coronal[1]===t.Coronal[1]}const nm=X({props:{viewId:{type:String,required:!0}},setup(e){const{viewId:t}=ae(e),n=lt(Sr);if(!n)throw new Error("Crop3D component cannot access the 2D widget manager.");const a=de(),o=I(()=>a.getViewProxy(t.value)),i=bt(),{currentImageID:s,currentImageMetadata:r}=se(),l=I(()=>{const p=s.value;return p&&p in i.croppingByImageID?i.croppingByImageID[p]:null}),c=ol.newInstance(),u=c.getWidgetState();c.setEdgeHandlesEnabled(!1),c.setFaceHandlesEnabled(!0),c.setCornerHandlesEnabled(!0);const d=M();F(n,(p,f)=>{f&&f.removeWidget(c),p&&(d.value=p.addWidget(c))}),us(o,()=>{n.value&&(d.value=n.value.addWidget(c),d.value.getRepresentations().forEach(p=>{p.getActors().forEach(f=>{f.getProperty().setAmbient(1)})}),o.value.renderLater())}),we(()=>{n.value&&n.value.removeWidget(c)}),F(r,p=>{u.setWorldToIndexT(p.worldToIndex),u.setIndexToWorldT(p.indexToWorld),u.placeWidget(p.worldBounds)},{immediate:!0});const h=p=>{const{lpsOrientation:f}=r.value,m=[0,0,0,0,0,0];eo.forEach(w=>{[m[f[w]*2],m[f[w]*2+1]]=p[w]}),Jn(m,u.getCroppingPlanes().getPlanes())||(u.getCroppingPlanes().setPlanes(m),o.value.renderLater())};return F(l,p=>{p&&h(p)},{immediate:!0}),Se(u.getCroppingPlanes().onModified)(()=>{const p=s.value;if(!p)return;const f=u.getCroppingPlanes().getPlanes(),{lpsOrientation:m}=r.value,w={Sagittal:We(f,"Sagittal",m),Coronal:We(f,"Coronal",m),Axial:We(f,"Axial",m)},T=l.value;T&&tm(w,T)||(em(w)?i.setCropping(p,w):T&&h(T))}),()=>null}}),om=X({props:{viewId:{type:String,required:!0}},components:{Crop2D:Zp,Crop3D:nm},setup(e){const{viewId:t}=ae(e),{currentImageID:n}=se(),a=bt(),o=Oe(),i=I(()=>o.currentTool===ne.Crop);F(n,r=>{r&&!(r in a.croppingByImageID)&&a.resetCropping(r)},{immediate:!0});const s=I(()=>de().viewSpecs[t.value].viewType);return{active:i,viewType:s}}});const im={class:"overlay-no-events"};function am(e,t,n,a,o,i){const s=P("crop-2D"),r=P("crop-3D");return R(),E("svg",im,[e.active&&e.viewType==="2D"?(R(),K(s,{key:0,"view-id":e.viewId},null,8,["view-id"])):j("",!0),e.active&&e.viewType==="3D"?(R(),K(r,{key:1,"view-id":e.viewId},null,8,["view-id"])):j("",!0)])}const sm=A(om,[["render",am],["__scopeId","data-v-c08e53d9"]]),li="ProxyManager";function rm(e){const t=lt("ProxyManager");return t?e(t):null}function lm(e=li){return lt(e??li)}const ci={ArrowLeft:-1,ArrowRight:1,ArrowUp:-1,ArrowDown:1},cm=X({name:"VtkTwoView",props:{id:{type:String,required:!0},viewDirection:{type:String,required:!0},viewUp:{type:String,required:!0}},components:{SliceSlider:Uh,ViewOverlayGrid:tg,WindowLevelTool:ag,SliceScrollTool:sg,PanTool:rg,ZoomTool:lg,RulerTool:kg,RectangleTool:nf,PaintTool:Sp,CrosshairsTool:Mp,CropTool:sm,ContourTool:pp},setup(e){const t=co(),n=Dt(),a=ho(),o=Pa(),i=rt(),{id:s,viewDirection:r,viewUp:l}=ae(e),c=M(),u=I(()=>Te(r.value)),{currentImageData:d,currentImageID:h,currentImageMetadata:v,isImageLoading:p,currentLayers:f}=se(),m=_e(),w=lo(),T=I(()=>n.getConfig(s.value,h.value)),S=I(()=>{var V;return((V=T.value)==null?void 0:V.slice)??w.slice}),b=I(()=>{var V;return((V=T.value)==null?void 0:V.min)??w.min}),O=I(()=>{var V;return((V=T.value)==null?void 0:V.max)??w.max}),D=I({get:()=>t.getConfig(s.value,h.value),set:V=>{const G=h.value;G!==null&&V!=null&&t.updateConfig(s.value,G,V)}}),k=I(()=>{var V;return(V=D.value)==null?void 0:V.width}),L=I(()=>{var V;return(V=D.value)==null?void 0:V.level}),$=I(()=>{if(h.value!==null&&h.value in m.imageIDToVolumeKey){const V=m.imageIDToVolumeKey[h.value],G=m.volumeInfo[V],ge=m.volumeStudy[V],ve=m.studyInfo[ge],Xe=m.studyPatient[ge],On=m.patientInfo[Xe].PatientID,ln=ve.StudyID,ke=ve.StudyDescription,Ot=G.SeriesNumber,it=G.SeriesDescription;return{patientID:On,studyID:ln,studyDescription:ke,seriesNumber:Ot,seriesDescription:it}}return null}),Y=I(()=>{const{lpsOrientation:V,dimensions:G}=v.value,ge=V[u.value];return{min:0,max:G[ge]-1}}),J=V=>{h.value!==null&&n.updateConfig(s.value,h.value,{slice:V})},{viewProxy:B,setContainer:W}=Bp(s,ea.Slice);tr(()=>{B.value.getInteractorStyle2D().removeAllManipulators()}),ee(()=>{W(c.value),B.value.setOrientationAxesVisibility(!1)}),we(()=>{W(null)}),fe(()=>{const V=v.value.lpsOrientation[u.value];B.value.setSlicingMode("IJK"[V])}),F([s,h,r],([V,G,ge])=>{!G||T.value!=null||(n.updateConfig(V,G,{...Y.value,axisDirection:ge}),n.resetSlice(V,G))},{immediate:!0});const Z=M(!1),Ce=V=>{if(!h.value||!Z.value)return;const G=ci[V.key]??0;G&&(n.updateConfig(s.value,h.value,{slice:S.value+G}),V.stopPropagation())};nr(Object.keys(ci),Ce),In(c,()=>B.value.resize());const me=M();Nn(pn,me);const{widgetManager:Ge}=Np(B);Nn(_r,Ge),F(d,V=>{if(h.value==null||D.value!=null||!V)return;const G=V.getPointData().getScalars().getRange();t.updateConfig(s.value,h.value,{min:G[0],max:G[1]}),t.resetWindowLevel(s.value,h.value)},{immediate:!0});const Et=fn(),Dn=I(()=>Et.idList.filter(V=>Et.parentImage[V]===h.value)),an=I(()=>f.value.map(({id:V})=>V)),{baseImageRep:En,labelmapReps:sn,layerReps:Ln}=_p(s,{baseImage:h,labelmaps:Dn,layers:an}),{cameraDirVec:So,cameraUpVec:_o}=og(r,l,v),{resizeToFit:ot,ignoreResizeToFitTracking:Co,resetResizeToFitTracking:Ss}=Mh(B.value.getCamera(),!1),bo=()=>Co(()=>{const V=v.value.lpsOrientation[Te(r.value)],G=v.value.lpsOrientation[Te(l.value)],ge=v.value.dimensions.map((ve,Xe)=>ve*v.value.spacing[Xe]);B.value.resizeToFit(V,G,ge),Ss()}),To=()=>{const V=v.value.worldBounds,G=[(V[0]+V[1])/2,(V[2]+V[3])/2,(V[4]+V[5])/2];Co(()=>{B.value.updateCamera(So.value,_o.value,G),B.value.resetCamera(V)}),bo(),B.value.renderLater()};jt(B.value.onResize(()=>{ot.value&&bo()})),F(ot,()=>{ot.value&&To()});const{restoreCameraConfig:_s}=Cp(s,h,B,"parallelScale","position","focalPoint","viewUp");F([h,So,_o],()=>{const V=a.getConfig(s.value,h.value);V?(_s(V),B.value.getRenderer().resetCameraClippingRange(),B.value.renderLater(),ot.value=!1):ot.value?To():ot.value=!0},{immediate:!0,deep:!0});const{top:Cs,left:bs}=ng(B);fe(()=>{if(T.value==null||D.value==null)return;const{slice:V}=T.value,{width:G,level:ge}=D.value,ve=En.value;ve&&(ve.setSlice(V),ve.setWindowWidth(G),ve.setWindowLevel(ge)),[...Ln.value,...sn.value].forEach(Xe=>{Xe.setSlice(V)}),B.value.renderLater()}),fe(()=>{const{labelmapOpacity:V}=i;sn.value.forEach(G=>{G.setOpacity(V)})});const Lt=I(()=>an.value.map(V=>o.getConfig(s.value,V))),Ts=xt();F([s,f],()=>{f.value.forEach(({id:V},G)=>{const ge=Ts.layerImages[V],ve=Lt.value[G];ge&&!ve&&o.resetToDefault(s.value,V,ge)})},{immediate:!0});const Io=lm(),Ro=I(()=>Lt.value.map(V=>V==null?void 0:V.colorBy)),xo=I(()=>Lt.value.map(V=>V==null?void 0:V.transferFunction)),Do=I(()=>Lt.value.map(V=>V==null?void 0:V.opacityFunction)),Eo=I(()=>Lt.value.map(V=>V==null?void 0:V.blendConfig));return F([Ln,Ro,xo,Do,Eo],()=>{Ln.value.map((V,G)=>[V,Ro.value[G],xo.value[G],Do.value[G],Eo.value[G]]).forEach(([V,G,ge,ve,Xe])=>{if(!G||!ge||!ve||!Xe)return;const{arrayName:rn,location:On}=G,ln=ge,ke=ve,Ot=Io.getLookupTable(rn);Ot.setMode(il.Preset),Ot.setPresetName(ln.preset),Ot.setDataRange(...ln.mappingRange);const it=Io.getPiecewiseFunction(rn);switch(it.setMode(ke.mode),it.setDataRange(...ke.mappingRange),ke.mode){case Ee.Mode.Gaussians:it.setGaussians(ke.gaussians);break;case Ee.Mode.Points:{const Lo=xd(ke.preset,ke.mappingRange,ke.shift);Lo&&it.setPoints(Lo);break}case Ee.Mode.Nodes:it.setNodes(ke.nodes);break}V.setRescaleOnColorBy(!1),V.setColorBy(rn,On),V.setOpacity(Xe.opacity),B.value.renderLater()})},{immediate:!0,deep:!0}),{vtkContainerRef:c,toolContainer:me,viewID:s,viewProxy:B,viewAxis:u,active:!0,currentSlice:S,sliceMin:b,sliceMax:O,windowWidth:k,windowLevel:L,topLabel:Cs,leftLabel:bs,isImageLoading:p,setSlice:J,widgetManager:Ge,dicomInfo:$,enableResizeToFit(){ot.value=!0},hover:Z}}});const um=e=>(le("data-v-f1605346"),e=e(),ce(),e),dm={class:"vtk-gutter"},hm={class:"vtk-sub-container"},gm={class:"vtk-view",ref:"vtkContainerRef"},fm={class:"overlay-no-events tool-layer",ref:"toolContainer"},pm={class:"annotation-cell"},mm={class:"annotation-cell"},vm={class:"annotation-cell"},ym={key:0},wm={class:"annotation-cell"},Sm={key:0,class:"overlay-no-events loading"},_m=um(()=>g("div",null,"Loading the image",-1));function Cm(e,t,n,a,o,i){const s=P("slice-slider"),r=P("pan-tool"),l=P("zoom-tool"),c=P("slice-scroll-tool"),u=P("window-level-tool"),d=P("contour-tool"),h=P("ruler-tool"),v=P("rectangle-tool"),p=P("paint-tool"),f=P("crosshairs-tool"),m=P("crop-tool"),w=P("view-overlay-grid");return R(),E("div",{class:"vtk-container-wrapper",tabindex:"0",onPointerenter:t[0]||(t[0]=T=>e.hover=!0),onPointerleave:t[1]||(t[1]=T=>e.hover=!1),onFocusin:t[2]||(t[2]=T=>e.hover=!0),onFocusout:t[3]||(t[3]=T=>e.hover=!1)},[g("div",dm,[y(ft,{dark:"",icon:"",size:"medium",variant:"text",onClick:e.enableResizeToFit},{default:x(()=>[y(yt,{size:"medium",class:"py-1"},{default:x(()=>[H("mdi-camera-flip-outline")]),_:1}),y(bi,{location:"right",activator:"parent",transition:"slide-x-transition"},{default:x(()=>[H(" Reset Camera ")]),_:1})]),_:1},8,["onClick"]),y(s,{class:"slice-slider",slice:e.currentSlice,min:e.sliceMin,max:e.sliceMax,step:1,"handle-height":20,onInput:e.setSlice},null,8,["slice","min","max","onInput"])]),g("div",{class:N(["vtk-container",e.active?"active":""])},[g("div",hm,[g("div",gm,null,512)]),g("div",fm,[y(r,{"view-id":e.viewID},null,8,["view-id"]),y(l,{"view-id":e.viewID},null,8,["view-id"]),y(c,{"view-id":e.viewID},null,8,["view-id"]),y(u,{"view-id":e.viewID},null,8,["view-id"]),y(d,{"view-id":e.viewID,"widget-manager":e.widgetManager,"view-direction":e.viewDirection,"current-slice":e.currentSlice},null,8,["view-id","widget-manager","view-direction","current-slice"]),y(h,{"view-id":e.viewID,"widget-manager":e.widgetManager,"view-direction":e.viewDirection,"current-slice":e.currentSlice},null,8,["view-id","widget-manager","view-direction","current-slice"]),y(v,{"view-id":e.viewID,"widget-manager":e.widgetManager,"view-direction":e.viewDirection,"current-slice":e.currentSlice},null,8,["view-id","widget-manager","view-direction","current-slice"]),y(p,{"view-id":e.viewID,"view-direction":e.viewDirection,"widget-manager":e.widgetManager,slice:e.currentSlice},null,8,["view-id","view-direction","widget-manager","slice"]),y(f,{"view-id":e.viewID,"view-direction":e.viewDirection,"widget-manager":e.widgetManager,slice:e.currentSlice},null,8,["view-id","view-direction","widget-manager","slice"]),y(m,{"view-id":e.viewID},null,8,["view-id"])],512),y(w,{class:"overlay-no-events view-annotations"},{"top-center":x(()=>[g("div",pm,[g("span",null,U(e.topLabel),1)])]),"middle-left":x(()=>[g("div",mm,[g("span",null,U(e.leftLabel),1)])]),"bottom-left":x(()=>[g("div",vm,[g("div",null,"Slice: "+U(e.currentSlice+1)+"/"+U(e.sliceMax+1),1),typeof e.windowWidth=="number"&&typeof e.windowLevel=="number"?(R(),E("div",ym," W/L: "+U(e.windowWidth.toFixed(2))+" / "+U(e.windowLevel.toFixed(2)),1)):j("",!0)])]),"top-right":x(()=>[g("div",wm,[e.dicomInfo!==null?(R(),K(wt,{key:0,"open-on-hover":"",location:"bottom left",left:"","nudge-left":"10",dark:"","max-width":"300px"},{activator:x(({props:T})=>[y(yt,Xt(T,{dark:"",size:"x-large",class:"pointer-events-all hover-info"}),{default:x(()=>[H(" mdi-information ")]),_:2},1040)]),default:x(()=>[y(Ft,{class:"bg-grey-darken-3"},{default:x(()=>[y(Je,null,{default:x(()=>[y(De,{class:"font-weight-bold"},{default:x(()=>[H(" PATIENT / CASE ")]),_:1}),y(Vn),y(De,null,{default:x(()=>[H(" ID: "+U(e.dicomInfo.patientID),1)]),_:1})]),_:1}),y(Je,null,{default:x(()=>[y(De,{class:"font-weight-bold"},{default:x(()=>[H(" STUDY ")]),_:1}),y(Vn),y(De,null,{default:x(()=>[H(" ID: "+U(e.dicomInfo.studyID),1)]),_:1}),y(De,null,{default:x(()=>[H(U(e.dicomInfo.studyDescription),1)]),_:1})]),_:1}),y(Je,null,{default:x(()=>[y(De,{class:"font-weight-bold"},{default:x(()=>[H(" SERIES ")]),_:1}),y(Vn),y(De,null,{default:x(()=>[H(" Series #: "+U(e.dicomInfo.seriesNumber),1)]),_:1}),y(De,null,{default:x(()=>[H(U(e.dicomInfo.seriesDescription),1)]),_:1})]),_:1})]),_:1})]),_:1})):j("",!0)])]),_:1}),y(He,{name:"loading"},{default:x(()=>[e.isImageLoading?(R(),E("div",Sm,[_m,g("div",null,[y(Cr,{indeterminate:"",color:"blue"})])])):j("",!0)]),_:1})],2)],32)}const hs=A(cm,[["render",Cm],["__scopeId","data-v-f1605346"]]);const bm={components:{CheckContoursToolStrip:kh,VtkTwoView:hs}},Tm={class:"viewers-tools-container"},Im={class:"tool-strip"};function Rm(e,t,n,a,o,i){const s=P("VtkTwoView"),r=P("CheckContoursToolStrip");return R(),E("div",Tm,[y(s,{key:"sagitalv",id:"Sagittal",viewDirection:"Posterior",viewUp:"Superior"}),g("div",Im,[y(r)]),y(s,{key:"sagitalv",id:"Coronal",viewDirection:"Right",viewUp:"Superior"})])}const gs=A(bm,[["render",Rm],["__scopeId","data-v-2880b87f"]]);async function xm(e){const t=e.createReader(),n=[];let a=[];do a=await new Promise((o,i)=>{t.readEntries(o,i)}),n.push(...a);while(a.length);return n}async function Dm(e){return new Promise((t,n)=>{e.file(t,n)})}async function Em(e){const t=[...e],n=[];for(;t.length;){const a=t.shift();a.isFile?n.push(a):t.push(...await xm(a))}return Promise.all(n.map(Dm))}const Lm={name:"DragAndDrop",props:{enabled:Boolean},data(){return{dragHover:!1}},methods:{onDragOver(e){if(this.enabled){e.preventDefault();const{types:t}=e.dataTransfer;(t&&t instanceof Array?t.indexOf("Files")!==-1:"Files"in t)&&(this.dragHover=!0,this.dragTimeout!==null&&(window.clearTimeout(this.dragTimeout),this.dragTimeout=null))}},onDragLeave(){this.enabled&&(this.dragTimeout=window.setTimeout(()=>{this.dragHover=!1,this.dragTimeout=null},50))},async onDrop(e){if(this.enabled)if(this.dragHover=!1,e.dataTransfer.items){const t=[...e.dataTransfer.items].map(a=>(a.webkitGetAsEntry||a.getAsEntry).call(a)),n=await Em(t);this.$emit("drop-files",n)}else this.$emit("drop-files",Array.from(e.dataTransfer.files))}},created(){this.dragTimeout=null}};function Om(e,t,n,a,o,i){return R(),E("div",Xt({onDragover:t[0]||(t[0]=oe((...s)=>i.onDragOver&&i.onDragOver(...s),["prevent"])),onDragleave:t[1]||(t[1]=(...s)=>i.onDragLeave&&i.onDragLeave(...s)),onDrop:t[2]||(t[2]=oe((...s)=>i.onDrop&&i.onDrop(...s),["prevent"]))},e.$attrs),[be(e.$slots,"default",{dragHover:o.dragHover})],16)}const Vm=A(Lm,[["render",Om]]);function Pm(e){let t=e;for(;t;)t!==e?console.error("The above error was caused by:",t):console.error(t),t instanceof Error?t=t.cause:t=null}function km(){const e=Jt(),t=n=>{e.addError("Application error (click for details)",n.error)};ee(()=>{window.addEventListener("error",t)}),we(()=>{window.removeEventListener("error",t)})}var jn=(e=>(e[e.ProxyCreated=0]="ProxyCreated",e[e.ProxyModified=1]="ProxyModified",e[e.ProxyDeleted=2]="ProxyDeleted",e[e.ProxyRegistrationChange=3]="ProxyRegistrationChange",e))(jn||{});function ui(e,t){const n=[];rm(a=>{const o=Object.create(null);n.push(a.onProxyRegistrationChange(i=>{const{action:s,proxyId:r,proxy:l}=i;s==="register"?(e===0&&t(r,l),e===1&&(o[r]=l.onModified(()=>t(r,l)))):s==="unregister"&&(r in o&&(o[r].unsubscribe(),delete o[r]),e===2&&t(r,null))}))}),we(()=>{for(;n.length;)n.pop().unsubscribe()})}function Mm(){const e=new Map,t=ir(()=>{Jt().addError(Bo.WebGLLost.title,Bo.WebGLLost.details)},100);ui(jn.ProxyCreated,(n,a)=>{if(!a||!a.isA("vtkViewProxy"))return;const i=a.getRenderWindow().getViews()[0].getCanvas(),s=or(i,"webglcontextlost",t);e.set(n,s)}),ui(jn.ProxyDeleted,n=>{e.has(n)&&(e.get(n)(),e.delete(n))})}const Bm=ar({position:"bottom-left",timeout:3e3,hideProgressBar:!0,maxToasts:3,transition:"Vue-Toastification__fade"}),Am=()=>Bm;function Fm(){const e=Am(),t=Jt();let n=0,a=null,o=null;const i=()=>{n=0,a=null,o=null},s=u=>{o=u},r=()=>{n++,a===null&&(a=e.info("Loading datasets...",{timeout:!1,closeButton:!1,closeOnClick:!1}))},l=()=>{n--,n===0&&a!==null&&(o?(e.dismiss(a),t.addError("Some files failed to load",o)):e.update(a,{content:"Datasets loaded!",options:{type:sr.SUCCESS,timeout:3e3,closeButton:"button",closeOnClick:!0}}),i())};return{runAsLoading:async u=>{r();try{return await u(s)}finally{l()}}}}const di=e=>{const t={[ne.Rectangle]:Fe(),[ne.Ruler]:Ae()},n=Oe(),a=t[n.currentTool];if(!a)return;const o=Object.entries(a.labels),i=o.findIndex(([r])=>r===a.activeLabel),[s]=o.at((i+e)%o.length);a.setActiveLabel(s)};function Nm(){At(rd,()=>di(-1)),At(ld,()=>di(1))}async function $m(e,t){const n=Rt();let a;try{a=await $a(e)}catch(s){t(s);return}const[o,i]=Kt(s=>s.ok,a);if(!n.primarySelection&&o.length){const s=Na(o[0]);s&&n.setPrimarySelection(s)}if(i.length){const s=i.map(l=>{const[c]=l.errors,u=ha(c.inputDataStackTrace[0]);return Pm(c.cause),`- ${u}: ${c.message}`}),r=new Error(`These files failed to load:
${s.join(`
`)}`);t(r)}}const Um=X({components:{},setup(){const e=Re(),t=Jt(),n=de();km(),Mm(),Nm();const{runAsLoading:a}=Fm(),o=M("Quad View"),{layout:i}=tt(n);F(o,()=>{const f=qo[o.value]||[];n.setLayout(f)},{immediate:!0}),F(i,()=>{var f;(f=i.value)!=null&&f.name&&i.value.name!==o.value&&(o.value=i.value.name)});async function s(f){if(!f)return;const m=Array.from(f).map(io);a(w=>$m(m,w))}const r=document.createElement("input");r.setAttribute("type","file"),r.setAttribute("multiple","multiple"),r.setAttribute("accept","*"),r.addEventListener("change",()=>s(r.files));function l(){r.value="",r.click()}const c=I(()=>e.idList.length>0),u=I(()=>t.importantMessages.length),d=I(()=>t.importantMessages.find(f=>f.type===Wn.Error)?"error":t.importantMessages.find(f=>f.type===Wn.Warning)?"warning":"primary"),h=M(!1),v=M(!1),p=Kn();return{aboutBoxDialog:M(!1),messageDialog:M(!1),settingsDialog:M(!1),saveDialog:h,saveHappening:v,leftSideBar:M(!p.mobile.value),mobile:p.mobile,messageCount:u,messageBadgeColor:d,layoutName:o,currentLayout:i,Layouts:qo,userPromptFiles:l,openFiles:s,hasData:c}}});const Hm={components:{DragAndDrop:Vm,HandleUpload:Um,CheckContours:gs},data(){return{showOverlay:!1,showTextOverlay:!1,isDraggingOver:!1,loadFileText:"Load Files",browseTextFile:"Browse your data to automatically add a new study.",dataStore:Rt(),currentPatientStoreID:null}},methods:{async openFiles(e){const t=Array.from(e).map(io);this.loadFiles(t)},async loadFiles(e){const t=await $a(e);this.currentPatientStoreID=t[0].data[0].dataID;const a=Kt(h=>h.ok,t)[0];if(!this.dataStore.primarySelection&&a.length){const h=Na(a[0]);h&&this.dataStore.setPrimarySelection(h)}const o=_e(),i=this.currentPatientStoreID,s=o.volumeInfo[i],r=o.volumeStudy[i],l=o.studyInfo[r],c=o.studyPatient[r],u=o.patientInfo[c],d={id:1,name:u.PatientID,lastname:u.PatientName,dob:u.PatientBirthDate,gender:u.PatientSex,scandate:l.StudyDate,scanlocation:s.SeriesDescription};this.$emit("new-patient",d),this.openOverlay()},handleKeyDown(e){e.key===" "&&this.showOverlay()},openOverlay(){this.showOverlay&&(this.showTextOverlay=!1),this.showOverlay=!this.showOverlay,this.showOverlay&&setTimeout(()=>{this.showTextOverlay=!0},200)},openFileDialog(){this.$refs.fileInput.click()},handleFileChange(e){const t=e.target.files[0];this.openFiles(t)},handleDragEnter(e){e.preventDefault(),this.isDraggingOver=!0},handleDragOver(e){e.preventDefault(),this.isDraggingOver=!0,this.loadFileText="Drop File to Upload"},handleDragLeave(e){e.preventDefault(),this.isDraggingOver=!1,this.loadFileText="Load Files"},handleDrop(e){e.preventDefault(),this.isDraggingOver=!1,this.loadFileText="Load Files";let t;e.dataTransfer?t=e.dataTransfer.files:e.target&&e.target.files&&(t=e.target.files),console.log(t)}}},vo=e=>(le("data-v-382c1de8"),e=e(),ce(),e),Wm={style:{position:"relative"}},zm=vo(()=>g("i",{class:"fa-solid fa-user-plus",style:{color:"#ffffff"}},null,-1)),jm=vo(()=>g("i",{class:"fa-solid fa-file-import fa-2xl",style:{color:"#ffffff"}},null,-1)),Gm=vo(()=>g("br",null,null,-1)),Xm={style:{display:"none"}};function qm(e,t,n,a,o,i){const s=P("HandleUpload"),r=P("drag-and-drop"),l=P("CheckContours");return R(),E(ue,null,[y(s,{ref:"handleUpload"},null,512),g("div",Wm,[g("button",{onClick:t[0]||(t[0]=(...c)=>i.openOverlay&&i.openOverlay(...c))},[H(" Add New Patient "),zm]),y(r,{enabled:"",onDropFiles:i.openFiles,id:"app-container"},{default:x(()=>[g("div",{class:N(["overlay",{show:o.showOverlay}]),onDragover:t[9]||(t[9]=(...c)=>i.handleDragOver&&i.handleDragOver(...c))},[g("div",{class:N(["add-patient-header",{visible:o.showTextOverlay}])},[g("i",{onClick:t[1]||(t[1]=(...c)=>i.openOverlay&&i.openOverlay(...c)),onKeydown:t[2]||(t[2]=Pe(oe((...c)=>i.handleKeyDown&&i.handleKeyDown(...c),["prevent"]),["space"])),class:"fa-solid fa-xmark fa-xl",style:{color:"#ffffff"}},null,32)],2),g("div",{onClick:t[4]||(t[4]=(...c)=>i.openFileDialog&&i.openFileDialog(...c)),onDragenter:t[5]||(t[5]=(...c)=>i.handleDragEnter&&i.handleDragEnter(...c)),onDragleave:t[6]||(t[6]=(...c)=>i.handleDragLeave&&i.handleDragLeave(...c)),onDrop:t[7]||(t[7]=(...c)=>i.handleDrop&&i.handleDrop(...c)),onKeydown:t[8]||(t[8]=Pe(oe((...c)=>i.handleKeyDown&&i.handleKeyDown(...c),["prevent"]),["space"])),class:N(["load-files",{visible:o.showTextOverlay}])},[g("input",{type:"file",ref:"fileInput",style:{display:"none"},onChange:t[3]||(t[3]=(...c)=>i.handleFileChange&&i.handleFileChange(...c)),"aria-labelledby":"fileInput"},null,544),jm,Gm,g("h2",null,U(o.loadFileText),1),g("h4",null,U(o.browseTextFile),1)],34)],34)]),_:1},8,["onDropFiles"])]),g("div",Xm,[y(l)])],64)}const Ym=A(Hm,[["render",qm],["__scopeId","data-v-382c1de8"]]);const Km={data(){return{searchTerm:""}},methods:{handleInput(){this.$emit("search-term-updated",this.searchTerm)},handleSearch(){this.$emit("search-term-updated",this.searchTerm)}}},Qm={class:"searchbar"};function Jm(e,t,n,a,o,i){return R(),E("div",Qm,[pt(g("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=s=>o.searchTerm=s),onInput:t[1]||(t[1]=(...s)=>i.handleInput&&i.handleInput(...s)),placeholder:"Find Patient...","aria-labelledby":"findPatientSearchBox"},null,544),[[Fn,o.searchTerm]])])}const Zm=A(Km,[["render",Jm],["__scopeId","data-v-93436b4b"]]);const ev={methods:{logOutUser(){window.localStorage.setItem("userLoggedIn","GUEST USER"),window.localStorage.clear()}}},tv=e=>(le("data-v-a1f7f5c7"),e=e(),ce(),e),nv=tv(()=>g("i",{class:"fa-solid fa-arrow-right-from-bracket",style:{color:"#ffffff"}},null,-1));function ov(e,t,n,a,o,i){const s=P("router-link");return R(),K(s,{to:"/login",style:{"text-decoration":"none"}},{default:x(()=>[g("button",{onClick:t[0]||(t[0]=(...r)=>i.logOutUser&&i.logOutUser(...r))},[H(" Log Out "),nv])]),_:1})}const iv=A(ev,[["render",ov],["__scopeId","data-v-a1f7f5c7"]]);const av={data(){return{username:"GUEST USER",filter:"",container:"container",patients:[{id:111,name:"SAMPLE",lastname:"SAMPLE",dob:"01/02/1982",breathingrate:"60",age:"32",weight:65,height:175,gender:"Male",scandate:"01/02/2023",scanlocation:"Area 19 Office"}]}},components:{HomeGreetings:Rc,PatientContainer:Hc,AddPatient:Ym,FindPatient:Zm,LogOut:iv},mounted(){this.username=window.localStorage.getItem("userLoggedIn"),window.localStorage.setItem("currentView","QualityCheck")},methods:{updatefilter(){},getTimeOfDay(){const e=new Date().getHours();return e>=5&&e<12?"Morning":e>=12&&e<18?"Afternoon":e>=18&&e<23?"Evening":"Day"},handleNewPatient(e){this.patients.push(e)}},created(){this.timeofday=this.getTimeOfDay(),this.container=`${this.container} ${this.timeofday.toLowerCase()}`}},fs=e=>(le("data-v-94767a96"),e=e(),ce(),e),sv={class:"home"},rv=fs(()=>g("br",null,null,-1)),lv={class:"user-bar"},cv=fs(()=>g("h5",{style:{color:"grey","margin-left":"90%"}},"Area 19 OCG Prototype V.0.1",-1));function uv(e,t,n,a,o,i){const s=P("HomeGreetings"),r=P("AddPatient"),l=P("FindPatient"),c=P("LogOut"),u=P("PatientContainer");return R(),E("div",{class:N(o.container)},[g("div",sv,[y(s,{username:o.username},null,8,["username"]),rv,g("div",lv,[y(r,{onNewPatient:i.handleNewPatient},null,8,["onNewPatient"]),y(l,{onSearchTermUpdated:i.updatefilter},null,8,["onSearchTermUpdated"]),y(c,{style:{"margin-left":"auto","align-self":"center"}})]),y(u,{patients:o.patients},null,8,["patients"]),cv])],2)}const dv=A(av,[["render",uv],["__scopeId","data-v-94767a96"]]),hv=X({components:{ToolButton:$e,MenuToolButton:Ga,ItemGroup:Ha,GroupableItem:Wa,PaintControls:ja,CropControls:Xa,RulerControls:qa,RectangleControls:Ya,ContourControls:Ka},setup(){const e=Rt(),t=Oe(),n=I(()=>!e.primaryDataset),a=I(()=>t.currentTool),o=Fe(),i=Ae(),s=M(!1),r=M(!1);return At("Escape",()=>{s.value=!1,r.value=!1}),{currentTool:a,setCurrentTool:t.setCurrentTool,noCurrentImage:n,Tools:ne,paintMenu:s,cropMenu:r,rectangleStore:o,rulerStore:i}}});const yo=e=>(le("data-v-001108e5"),e=e(),ce(),e),gv=yo(()=>g("div",{class:"my-1 tool-separator"},null,-1)),fv=yo(()=>g("div",{class:"my-1 tool-separator"},null,-1)),pv=yo(()=>g("div",{class:"my-1 tool-separator"},null,-1));function mv(e,t,n,a,o,i){const s=P("tool-button"),r=P("groupable-item"),l=P("paint-controls"),c=P("menu-tool-button"),u=P("rectangle-controls"),d=P("ruler-controls"),h=P("contour-controls"),v=P("crop-controls"),p=P("item-group");return R(),K(p,{mandatory:"","model-value":e.currentTool,"onUpdate:modelValue":t[0]||(t[0]=f=>e.setCurrentTool(f))},{default:x(()=>[gv,y(r,{value:e.Tools.WindowLevel},{default:x(({active:f,toggle:m})=>[y(s,{icon:"mdi-circle-half-full",name:"Window & Level",buttonClass:["tool-btn",f?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Pan},{default:x(({active:f,toggle:m})=>[y(s,{icon:"mdi-cursor-move",name:"Pan",buttonClass:["tool-btn",f?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Zoom},{default:x(({active:f,toggle:m})=>[y(s,{icon:"mdi-magnify-plus-outline",name:"Zoom",buttonClass:["tool-btn",f?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Crosshairs},{default:x(({active:f,toggle:m})=>[y(s,{icon:"mdi-crosshairs",name:"Crosshairs",buttonClass:["tool-btn",f?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:m},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),fv,y(r,{value:e.Tools.Paint},{default:x(({active:f,toggle:m})=>[y(c,{icon:"mdi-brush",name:"Paint",active:f,disabled:e.noCurrentImage,onClick:m},{default:x(()=>[y(l)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Rectangle},{default:x(({active:f,toggle:m})=>[y(c,{icon:"mdi-vector-square",name:"Rectangle",mobileOnlyMenu:!0,active:f,disabled:e.noCurrentImage,onClick:m},{default:x(()=>[y(u)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Ruler},{default:x(({active:f,toggle:m})=>[y(c,{icon:"mdi-ruler",name:"Ruler",mobileOnlyMenu:!0,active:f,disabled:e.noCurrentImage,onClick:m},{default:x(()=>[y(d)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),y(r,{value:e.Tools.Contour},{default:x(({active:f,toggle:m})=>[y(c,{icon:"mdi-shape-circle-plus",name:"Contour","mobile-only-menu":"",active:f,disabled:e.noCurrentImage,onClick:m},{default:x(()=>[y(h)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),pv,y(r,{value:e.Tools.Crop},{default:x(({active:f,toggle:m})=>[y(c,{icon:"mdi-crop",name:"Crop",active:f,disabled:e.noCurrentImage,onClick:m},{default:x(()=>[y(v)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"])]),_:1},8,["model-value"])}const vv=A(hv,[["render",mv],["__scopeId","data-v-001108e5"]]);const yv={props:{number:{type:Number,default:1}}},wv={class:"circleIcon"};function Sv(e,t,n,a,o,i){return R(),E("div",wv,U(n.number),1)}const _v=A(yv,[["render",Sv],["__scopeId","data-v-071ecef1"]]);const Cv={components:{ToolStrip:vv,IconNumber:_v},props:{activeComponent:{type:String,default:"analysis"}},data(){return{patient:null,patientName:null,patientLastName:null,patientBrate:null,patientage:null,patientweight:null,patientheight:null,patientgender:null,checkContours:null}},mounted(){const e=window.sessionStorage.getItem("currentQaView");e?this.handleclick(e):this.checkContours=!1,this.patient=JSON.parse(window.localStorage.getItem("currentPatient")),this.patientName=this.patient.name.toUpperCase(),this.patientLastName=this.patient.lastname.toUpperCase(),this.patientBrate=this.patient.breathingrate,this.patientage=this.patient.age,this.patientweight=this.patient.weight,this.patientheight=this.patient.height,this.patientgender=this.patient.gender},methods:{handleclick(e){e==="CheckBreathingSplits"?this.checkContours=!1:this.checkContours=!0,window.sessionStorage.setItem("currentQaView",e),this.$emit("updatequalitycheck",this.checkContours)}}},nt=e=>(le("data-v-afc27cb0"),e=e(),ce(),e),bv={class:"header-container"},Tv={class:"patient-info-container"},Iv={class:"patient-name"},Rv=nt(()=>g("h3",{class:"label"},"PATIENT",-1)),xv={class:"breathing-rate"},Dv=nt(()=>g("h3",{class:"label",style:{"text-align":"left"}},[H("RESTING "),g("br"),H("HEART RATE")],-1)),Ev={class:"info"},Lv=nt(()=>g("h3",{class:"label"},"AGE",-1)),Ov=nt(()=>g("h3",{class:"label"},"WEIGHT",-1)),Vv=nt(()=>g("h3",{class:"label"},"HEIGHT",-1)),Pv=nt(()=>g("h3",{class:"label"},"GENDER",-1)),kv={key:0,class:"tools"},Mv={key:1,class:"quality-screen-toggle"},Bv=nt(()=>g("h2",null,"CHECK BREATHING SPLITS",-1)),Av=nt(()=>g("h2",null,"CHECK CONTOURS",-1));function Fv(e,t,n,a,o,i){const s=P("ToolStrip"),r=P("IconNumber");return R(),E("div",bv,[g("div",Tv,[g("div",Iv,[Rv,g("h3",null,U(o.patientName)+" "+U(o.patientLastName),1)]),g("div",xv,[g("h1",null,U(o.patientBrate),1),Dv]),g("div",Ev,[g("div",null,[Lv,g("h3",null,U(o.patientage),1)]),g("div",null,[Ov,g("h3",null,U(o.patientweight)+" Kg",1)]),g("div",null,[Vv,g("h3",null,U(o.patientheight)+" cm",1)]),g("div",null,[Pv,g("h3",null,U(o.patientgender),1)])])]),n.activeComponent=="GraphicalAnalysis"?(R(),E("div",kv,[y(s)])):j("",!0),n.activeComponent=="QualityCheck"?(R(),E("div",Mv,[g("div",{class:N(["toggleQaContainer",{clicked:o.checkContours==!1}]),onClick:t[0]||(t[0]=l=>i.handleclick("CheckBreathingSplits")),onKeydown:t[1]||(t[1]=Pe(oe((...l)=>e.handleKeyDown&&e.handleKeyDown(...l),["prevent"]),["space"]))},[y(r),Bv],34),g("div",{class:N(["toggleQaContainer",{clicked:o.checkContours}]),onClick:t[2]||(t[2]=l=>i.handleclick("CheckContours")),onKeydown:t[3]||(t[3]=Pe(oe((...l)=>e.handleKeyDown&&e.handleKeyDown(...l),["prevent"]),["space"]))},[y(r,{number:2}),Av],34)])):j("",!0)])}const Nv=A(Cv,[["render",Fv],["__scopeId","data-v-afc27cb0"]]);const $v={data(){return{selectedTool:"QualityCheck"}},methods:{selectTool(e){this.selectedTool!==e&&(this.selectedTool=e,this.$emit("tool-selected",e))},handleKeyDown(e){console.log(e),e.key==="1"?this.selectTool("QualityCheck"):e.key==="2"?this.selectTool("GraphicalAnalysis"):this.selectTool("ReportMaker")}},mounted(){this.selectedTool=window.localStorage.getItem("currentView")}},Rn=e=>(le("data-v-46cbd000"),e=e(),ce(),e),Uv={class:"toolbar"},Hv={class:"tools"},Wv={class:"tool"},zv={key:0,class:"fa-solid fa-people-arrows fa-xl"},jv={key:1,class:"fa-solid fa-people-arrows fa-lg"},Gv=Rn(()=>g("h4",{class:"section-tag"},"Patient List",-1)),Xv={key:0,class:"fa-solid fa-file-circle-check fa-xl"},qv={key:1,class:"fa-solid fa-file-circle-check fa-lg"},Yv=Rn(()=>g("h4",{class:"section-tag"},"Quality Check",-1)),Kv={key:0,class:"fa-sharp fa-solid fa-microscope fa-xl"},Qv={key:1,class:"fa-sharp fa-solid fa-microscope fa-lg"},Jv=Rn(()=>g("h4",{class:"section-tag"},"Analysis",-1)),Zv={key:0,class:"fa-regular fa-file-pdf fa-xl"},e0={key:1,class:"fa-regular fa-file-pdf fa-lg"},t0=Rn(()=>g("h4",{class:"section-tag"},"Report",-1));function n0(e,t,n,a,o,i){const s=P("router-link");return R(),E("div",Uv,[g("div",Hv,[y(s,{to:"/home",style:{"text-decoration":"none"},class:"normal"},{default:x(()=>[g("div",Wv,[e.$matches.mediumLaptop.min?(R(),E("i",zv)):(R(),E("i",jv)),Gv])]),_:1}),g("div",{class:N(["tool",{active:o.selectedTool==="QualityCheck"}]),onClick:t[0]||(t[0]=r=>i.selectTool("QualityCheck")),onKeydown:t[1]||(t[1]=oe((...r)=>i.handleKeyDown&&i.handleKeyDown(...r),["prevent"]))},[e.$matches.mediumLaptop.min?(R(),E("i",Xv)):(R(),E("i",qv)),Yv],34),g("div",{class:N(["tool",{active:o.selectedTool==="GraphicalAnalysis"}]),onClick:t[2]||(t[2]=r=>i.selectTool("GraphicalAnalysis")),onKeydown:t[3]||(t[3]=oe((...r)=>i.handleKeyDown&&i.handleKeyDown(...r),["prevent"]))},[e.$matches.mediumLaptop.min?(R(),E("i",Kv)):(R(),E("i",Qv)),Jv],34),g("div",{class:N(["tool",{active:o.selectedTool==="ReportMaker"}]),onClick:t[4]||(t[4]=r=>i.selectTool("ReportMaker")),onKeydown:t[5]||(t[5]=oe((...r)=>i.handleKeyDown&&i.handleKeyDown(...r),["prevent"]))},[e.$matches.mediumLaptop.min?(R(),E("i",Zv)):(R(),E("i",e0)),t0],34)])])}const o0=A($v,[["render",n0],["__scopeId","data-v-46cbd000"]]);const i0={props:{heartrate:{type:Number,required:!0},duration:{type:String,required:!0},state:{type:String,required:!0},isActive:{type:Boolean,required:!0},stateColor:{type:String,required:!1,default:"#66C9DA"}},data(){return{isHovered:!1}},methods:{handleClick(){this.$emit("state-change",this.state)}}},ps=e=>(le("data-v-258e6b3d"),e=e(),ce(),e),a0={class:"button-content"},s0={style:{display:"flex","justify-content":"space-between"}},r0=ps(()=>g("h4",null,"HEART RATE",-1)),l0=ps(()=>g("h4",null,"DURATION",-1));function c0(e,t,n,a,o,i){return R(),E("div",{class:N({"custom-button":!0,highlighted:n.isActive}),onClick:t[0]||(t[0]=(...s)=>i.handleClick&&i.handleClick(...s)),onMouseover:t[1]||(t[1]=s=>o.isHovered=!0),onFocusin:t[2]||(t[2]=s=>o.isHovered=!0),onMouseout:t[3]||(t[3]=s=>o.isHovered=!1),onFocusout:t[4]||(t[4]=s=>o.isHovered=!1),onKeydown:t[5]||(t[5]=Pe(oe((...s)=>e.handleKeyDown&&e.handleKeyDown(...s),["prevent"]),["space"]))},[g("div",a0,[g("div",null,[g("h1",{style:ie({color:n.stateColor})},U(n.state),5)]),g("div",s0,[g("div",null,[g("h2",null,U(n.heartrate)+" BPM",1),r0]),g("div",null,[g("h2",null,U(n.duration),1),l0])])])],34)}const u0=A(i0,[["render",c0],["__scopeId","data-v-258e6b3d"]]),d0={name:"PatientInfoHUD",mounted(){const{canvas:e}=this.$refs;e.width=this.numImages*this.imgWidth,e.height=this.imgHeight,this.addPhaseId(),this.addHRInfo()},data(){return{paddingX:15}},props:{isHidden:{type:Boolean},numImages:{type:Number,required:!0},imgWidth:{type:Number,required:!0},imgHeight:{type:Number,required:!0}},methods:{addPhaseId(){const{canvas:e}=this.$refs,t=e.getContext("2d");t.font="500 12px Roboto",t.textAlign="left",t.textBaseline="middle",t.fillStyle="white";const{numImages:n}=this,a=this.paddingX,o=15;for(let i=0;i<n;i++)t.fillText(`Phase ${i+1}`,a+this.imgWidth*i,o)},addHRInfo(){const{canvas:e}=this.$refs,t=e.getContext("2d");t.font="500 12px Roboto",t.textAlign="left",t.textBaseline="middle",t.fillStyle="white";const{numImages:n}=this,a=this.paddingX,o=30;for(let i=0;i<n;i++)t.fillText(`HR ${this.getRandomInt(106,30)}`,a+this.imgWidth*i,o)},getRandomInt(e,t){return t+Math.floor(Math.random()*(e-t))}}},h0={ref:"canvas"};function g0(e,t,n,a,o,i){return R(),E("div",null,[g("canvas",h0,null,512)])}const f0=A(d0,[["render",g0]]);const p0={name:"RangeSlider",props:{maxExpand:{type:Number,default:10},minExpand:{type:Number,default:3},canvasWidth:{type:Number},sliceObj:{type:Object},numImages:Number,imgWidth:Number},data(){return{canvasHeight:44,thumbRadius:3,isDragging:!1,startThumbX:0,endThumbX:0,minValue:0,maxValue:100,startValue:0,startValueParent:0,endValue:10,startDragX:null,scrollerHeight:12,canvasCursor:"pointer"}},mounted(){this.endValue=1/(this.imgWidth*this.numImages/(this.canvasWidth-8)/100),console.log(`IMAGE STRIP WIDTH: ${this.canvasWidth}`),this.drawCanvas(),this.throttledSliderMove=rr(this.moveScale,5)},methods:{drawCurrentView(e,t){const n=e,a=Math.abs(t-e),{canvas:o}=this.$refs,i=o.getContext("2d");i.strokeStyle="#FFFFFF",i.fillStyle="#FFFFFF05";const s=35,r=(this.canvasHeight-s)/2;i.lineWidth=3;const l=6;i.beginPath(),i.moveTo(n+l,r),i.lineTo(n+a-l,r),i.arcTo(n+a,r,n+a,r+l,l),i.lineTo(n+a,r+s-l),i.arcTo(n+a,r+s,n+a-l,r+s,l),i.lineTo(n+l,r+s),i.arcTo(n,r+s,n,r+s-l,l),i.lineTo(n,r+l),i.arcTo(n,r,n+l,r,l),i.closePath(),i.fill(),i.stroke()},drawHandle(e,t,n,a,o,i,s){const r=e,l=t+a,c=n+o;r.beginPath(),r.moveTo(t+i,n),r.lineTo(l-i,n),r.quadraticCurveTo(l,n,l,n+i),r.lineTo(l,c-i),r.quadraticCurveTo(l,c,l-i,c),r.lineTo(t+i,c),r.quadraticCurveTo(t,c,t,c-i),r.lineTo(t,n+i),r.quadraticCurveTo(t,n,t+i,n),r.closePath(),r.lineWidth=2,r.strokeStyle=s,r.stroke(),r.fillStyle=s,r.fill()},drawSegment(e,t,n){const{canvas:a}=this.$refs,o=a.getContext("2d"),i=(this.canvasHeight-32)/2,s=Math.abs(t-e);this.drawHandle(o,e,i,8,32,4,n),o.fillStyle=n,o.fillRect(e,a.height/2-this.scrollerHeight/2,s,this.scrollerHeight),this.drawHandle(o,t,i,8,32,4,n)},drawTrack(){const{canvas:e}=this.$refs,t=e.getContext("2d");t.fillStyle="#3D3D3D",t.fillRect(0,e.height/2-this.scrollerHeight/2,e.width,this.scrollerHeight)},drawCanvas(){const{canvas:e}=this.$refs,t=e.getContext("2d");e.width=this.canvasWidth-8,e.height=this.canvasHeight;const n=this.getValueToXPosition(this.startValue),a=this.getValueToXPosition(this.endValue),o=this.getObjLocToVal(this.sliceObj.states.FREEBREATHING.start),i=this.getObjLocToVal(this.sliceObj.states.FREEBREATHING.end),s=this.getObjLocToVal(this.sliceObj.states.HYPERVENTILATION.start),r=this.getObjLocToVal(this.sliceObj.states.HYPERVENTILATION.end),l=this.getObjLocToVal(this.sliceObj.states.BREATHHOLD.start),c=this.getObjLocToVal(this.sliceObj.states.BREATHHOLD.end);t.clearRect(0,0,e.width,e.height),this.drawTrack(),this.drawSegment(o,i-7,"#5FBBCB"),this.drawSegment(s+3,r-7,"#C24ABC"),this.drawSegment(l+3,c-7,"#D95476"),this.drawCurrentView(n,a)},getObjLocToVal(e){const t=e.XLocation/(this.imgWidth*this.numImages);return this.getValueToXPosition(t*100)},getValueToXPosition(e){const t=this.maxValue-this.minValue,n=this.canvasWidth-8-this.thumbRadius*2;return(e-this.minValue)*n/t+this.thumbRadius},getXPositionToValue(e){const t=this.maxValue-this.minValue,n=this.canvasWidth-8-this.thumbRadius*2;return(e-this.thumbRadius)*t/n+this.minValue},handleMouseDown(e){const{canvas:t}=this.$refs,n=t.getBoundingClientRect(),a=e.clientX-n.left,o=this.getValueToXPosition(this.startValue),i=this.getValueToXPosition(this.endValue);this.startDragX=a,a<i&&a>o&&(this.isDragging="middle",this.canvasCursor="grab")},handledblCkick(e){const{canvas:t}=this.$refs,n=t.getBoundingClientRect(),a=e.clientX-n.left,o=Math.abs(this.startValue-this.endValue),i=Math.min(Math.max(this.getXPositionToValue(a)-o/2,0),this.maxValue-o);this.startValue=i,this.endValue=this.startValue+o,this.throttledSliderMove(this.startValue),this.drawCanvas()},handleMouseMove(e){if(!this.isDragging)return;const{canvas:t}=this.$refs,n=t.getBoundingClientRect(),a=e.clientX-n.left,o=this.getXPositionToValue(a),i=o-this.getXPositionToValue(this.startDragX);this.endValue+i>this.maxValue||this.startValue+i<this.minValue||(this.startValue+=i,this.endValue+=i,this.throttledSliderMove(this.startValue),this.drawCanvas(),this.startDragX=this.getValueToXPosition(o))},handleMouseUp(){this.isDragging&&(this.isDragging=!1,this.canvasCursor="pointer")},moveScale(e){this.$emit("move",e)},updatePosition(e){const t=e-this.startValue;this.startValue=e,this.endValue+=t,this.drawCanvas()}},watch:{canvasWidth(){this.drawCanvas()}}};function m0(e,t,n,a,o,i){return R(),E("div",{class:"range-slider",style:ie({width:n.canvasWidth+"px"})},[g("canvas",{ref:"canvas",onMousedown:t[0]||(t[0]=(...s)=>i.handleMouseDown&&i.handleMouseDown(...s)),onDblclick:t[1]||(t[1]=(...s)=>i.handledblCkick&&i.handledblCkick(...s)),onMousemove:t[2]||(t[2]=(...s)=>i.handleMouseMove&&i.handleMouseMove(...s)),onMouseup:t[3]||(t[3]=(...s)=>i.handleMouseUp&&i.handleMouseUp(...s)),onMouseleave:t[4]||(t[4]=(...s)=>i.handleMouseUp&&i.handleMouseUp(...s)),onFocusout:t[5]||(t[5]=(...s)=>i.handleMouseUp&&i.handleMouseUp(...s)),style:ie({cursor:o.canvasCursor})},null,36)],4)}const v0=A(p0,[["render",m0],["__scopeId","data-v-363fb1ad"]]);const y0={props:{hasLabel:null},data(){return{showContextMenu:!1,showError:!1,contextMenuX:0,contextMenuY:0}},methods:{openContextMenu(e){this.showContextMenu=!0,this.contextMenuX=e.clientX,this.contextMenuY=e.clientY},closeContextMenu(){this.showContextMenu=!1,this.showError=!1},addLabel(e){this.$emit("add-label",e),this.showContextMenu=!1},removeLabel(){this.$emit("remove-label"),this.showContextMenu=!1},popError(e){this.showError=!0,this.contextMenuX=e.clientX,this.contextMenuY=e.clientY},handleKeyPress(){}}},ct=e=>(le("data-v-d079620a"),e=e(),ce(),e),w0=ct(()=>g("i",{class:"fa-solid fa-plus fa-sm",style:{color:"#ffffff"}},null,-1)),S0=ct(()=>g("h5",null,"Add Systole Label",-1)),_0=[w0,S0],C0=ct(()=>g("i",{class:"fa-solid fa-circle-plus fa-sm",style:{color:"#ffffff"}},null,-1)),b0=ct(()=>g("h5",null,"Add Diastole Label",-1)),T0=[C0,b0],I0=ct(()=>g("i",{class:"fa-regular fa-trash-can fa-sm",style:{color:"#ffffff"}},null,-1)),R0=ct(()=>g("h5",null,"Delete Label",-1)),x0=[I0,R0],D0=ct(()=>g("div",{class:"warning"},[g("i",{class:"fa-solid fa-triangle-exclamation",style:{color:"#ffcc00"}}),g("h5",null,"Unable to edit label! Please click within a breathing state.")],-1)),E0=[D0];function L0(e,t,n,a,o,i){return R(),E("div",{onContextmenu:t[6]||(t[6]=oe((...s)=>i.openContextMenu&&i.openContextMenu(...s),["prevent"])),onClick:t[7]||(t[7]=(...s)=>i.closeContextMenu&&i.closeContextMenu(...s)),onMousewheelPassive:t[8]||(t[8]=(...s)=>i.closeContextMenu&&i.closeContextMenu(...s)),onKeypress:t[9]||(t[9]=oe((...s)=>i.handleKeyPress&&i.handleKeyPress(...s),["prevent"]))},[be(e.$slots,"default",{},void 0,!0),y(He,{name:"fade"},{default:x(()=>[o.showContextMenu?(R(),E("div",{key:0,class:"custom-context-menu",style:ie({top:`${o.contextMenuY}px`,left:`${o.contextMenuX}px`})},[g("div",{class:N(["option",{noClick:n.hasLabel}]),onClick:t[0]||(t[0]=s=>i.addLabel("systoles")),onKeypress:t[1]||(t[1]=(...s)=>e.h&&e.h(...s))},_0,34),g("div",{class:N(["option",{noClick:n.hasLabel}]),onClick:t[2]||(t[2]=s=>i.addLabel("diastoles")),onKeypress:t[3]||(t[3]=(...s)=>e.h&&e.h(...s))},T0,34),g("div",{class:N(["option",{noClick:!n.hasLabel}]),onClick:t[4]||(t[4]=s=>i.removeLabel()),onKeypress:t[5]||(t[5]=(...s)=>e.h&&e.h(...s))},x0,34)],4)):j("",!0)]),_:1}),y(He,{name:"fade"},{default:x(()=>[o.showError?(R(),E("div",{key:0,class:"custom-context-menu",style:ie({top:`${o.contextMenuY}px`,left:`${o.contextMenuX}px`})},E0,4)):j("",!0)]),_:1})],32)}const O0=A(y0,[["render",L0],["__scopeId","data-v-d079620a"]]);const V0={emits:["update-slice","remove-label","add-label"],props:{isHidden:{type:Boolean},numImages:{type:Number,required:!0},imgWidth:{type:Number,required:!0},sliceObj:{type:Object,required:!0},BARHEIGHT:{type:Number,default:284},BARWIDTH:{type:Number,default:800}},components:{AddCardiacCycle:O0},data(){return{handlerBarWidth:9,cardiacCyclesLabelWidth:110,handleBarGrab:{width:30,height:28},addNewLabelX:0,hasLabelOnClick:!1,canvasCursor:"default",moving:!1,movingObj:"none",barHeight:this.BARHEIGHT,startX:0,barWidth:this.BARWIDTH,mouse:{x:null,y:null}}},mounted(){this.addXLocations(),this.drawTrimmer()},watch:{barWidth(){this.drawTrimmer()},barHeight(){this.drawTrimmer()}},methods:{drawCycleLabel(e){const t=e,n=t.XLocation,a=t.id,o=this.cardiacCyclesLabelWidth,{canvas:i}=this.$refs,s=i.getContext("2d");s.fillStyle="#00000070";const r=8,l=35,c=15;s.beginPath(),s.moveTo(n+c,r),s.lineTo(n+o-c,r),s.arcTo(n+o,r,n+o,r+c,c),s.lineTo(n+o,r+l-c),s.arcTo(n+o,r+l,n+o-c,r+l,c),s.lineTo(n+c,r+l),s.arcTo(n,r+l,n,r+l-c,c),s.lineTo(n,r+c),s.arcTo(n,r,n+c,r,c),s.closePath(),s.fill(),s.font="300 18px Roboto",s.textAlign="center",s.textBaseline="middle",s.fillStyle="white";const u=n+o/2,d=r+l/2;s.fillText(a,u,d);const h=2,v=3,p=2.5,f="rgba(255,255,255,0.65)";for(let m=0;m<3;m++){const w=n-10+o/2+v+m*(2*h+v),T=18+p+10+(2*h+p);s.beginPath(),s.arc(w,T,h,0,Math.PI*2),s.fillStyle=f,s.fill(),s.closePath()}},drawBars(e,t){const{canvas:n}=this.$refs,a=n.getContext("2d");a.fillStyle=t;const o=this.sliceObj.states[e].start.XLocation+this.handlerBarWidth,i=this.sliceObj.states[e].end.XLocation;a.beginPath(),a.moveTo(o,0),a.lineTo(i,0),a.moveTo(o,this.barHeight),a.lineTo(i,this.barHeight),a.lineWidth=3,a.strokeStyle=t,a.stroke()},drawTrimmer(){const{canvas:e}=this.$refs,t=e.getContext("2d"),n=this.barWidth,a=this.barHeight;e.width=n,e.height=a,t.clearRect(0,0,e.width,e.height),Object.entries(this.sliceObj.states).forEach(([o,i])=>{this.drawBars(o,i.color),i.cardiacCycles.systoles.forEach(s=>this.drawCycleLabel(s)),i.cardiacCycles.diastoles.forEach(s=>this.drawCycleLabel(s)),this.drawStartEndHandlers(i)})},findIfLabelOnClick(){const e=Math.floor(this.addNewLabelX/this.imgWidth)+1,t=this.findStateUserClicked();try{const{cardiacCycles:n}=this.sliceObj.states[t];let a=null,o=null;if(Object.keys(n).some(i=>(o=n[i].findIndex(s=>s.phaseLocation===e?(a=i,!0):!1),o!==-1)),o!==-1)return{state:t,foundLabel:a,foundIndex:o}}catch{return"error"}return null},findStateUserClicked(){let e=null;return Object.keys(this.sliceObj.states).some(t=>{const n=this.sliceObj.states[t].end.XLocation;return this.sliceObj.states[t].start.XLocation<=this.mouse.x&&this.mouse.x<=n?(e=t,!0):!1}),e},findObjonCursor(e){const t=this.sliceObj.states[e],{start:n,end:a,cardiacCycles:o}=t;if(this.checkMouseOnStart(n))return n;if(this.checkMouseOnEnd(a))return a;const i=this.checkAllLabels(o.systoles);if(i)return i;const s=this.checkAllLabels(o.diastoles);return s||null},checkMouseOnStart(e){const t=e.XLocation,n=t+this.handleBarGrab.width,a=this.barHeight/2-this.handleBarGrab.height,o=this.barHeight/2+this.handleBarGrab.height;return this.checkMouseInArea(t,n,a,o)},checkMouseOnEnd(e){const t=e.XLocation-this.handleBarGrab.width,n=t+this.handleBarGrab.width,a=this.barHeight/2-this.handleBarGrab.height,o=this.barHeight/2+this.handleBarGrab.height;return this.checkMouseInArea(t,n,a,o)},checkMouseOnLabel(e){const t=e.XLocation,n=t+this.cardiacCyclesLabelWidth,a=8,o=40;return this.checkMouseInArea(t,n,a,o)},checkAllLabels(e){return e.find(t=>this.checkMouseOnLabel(t))},checkMouseInArea(e,t,n,a){return this.mouse.x>=e&&this.mouse.x<=t&&this.mouse.y>=n&&this.mouse.y<=a},startResize(e){this.$refs.menu.closeContextMenu(),this.mouse.x=e.offsetX,this.mouse.y=e.offsetY,this.startX=this.mouse.x;const t=this.findStateUserClicked();if(t){const n=this.findObjonCursor(t);n&&(this.moving=!0,this.movingObj=n)}},handleNotMoving(){const e=this.findStateUserClicked();this.updateCursor(),e&&(this.findObjonCursor(e)?this.updateCursor("grab"):this.updateCursor())},handleCheckUpperLowerBound(e,t,n,a,o){return e==="start"?this.sliceObj.states[t].start.XLocation+n+this.imgWidth>this.sliceObj.states[t].end.XLocation||this.sliceObj.states[t].start.XLocation+n<=a:this.sliceObj.states[t].end.XLocation+n-this.imgWidth-50<this.sliceObj.states[t].start.XLocation||this.sliceObj.states[t].end.XLocation+n>=o},mousemoving(e){if(!(e.offsetX>=this.sliceObj.states.FREEBREATHING.start.XLocation&&e.offsetX<=this.sliceObj.states.BREATHHOLD.end.XLocation+30||this.moving)){this.updateCursor();return}if(this.mouse.x=e.offsetX,this.mouse.y=e.offsetY,!this.moving){this.handleNotMoving();return}e.preventDefault();const t=e.offsetX,n=t-this.startX;if(this.movingObj.id==="end"||this.movingObj.id==="start"){const a=this.getPreviousKey(this.sliceObj.states,this.movingObj.state),o=this.getNextKey(this.sliceObj.states,this.movingObj.state),i=a?this.sliceObj.states[a].end.XLocation:0,s=o?this.sliceObj.states[o].start.XLocation:this.barWidth;if(this.handleCheckUpperLowerBound(this.movingObj.id,this.movingObj.state,n,i,s))return;const{cardiacCycles:r}=this.sliceObj.states[this.movingObj.state];if(Object.keys(r).some(c=>r[c].some(d=>this.checkCollisionStartEnd(d,n))))return;this.startX=t,this.movingObj.XLocation+=n,requestAnimationFrame(this.drawTrimmer);return}this.movingObj.XLocation+n<=this.sliceObj.states[this.movingObj.state].start.XLocation||this.movingObj.XLocation+n>this.sliceObj.states[this.movingObj.state].end.XLocation-this.cardiacCyclesLabelWidth||(this.movingObj.XLocation+=n,requestAnimationFrame(this.drawTrimmer),this.startX=t)},checkCollisionStartEnd(e,t){return this.movingObj.id==="start"?t<0?!1:this.movingObj.XLocation+t-10>=(e.phaseLocation-1)*this.imgWidth:this.movingObj.id==="end"?t>0?!1:this.movingObj.XLocation+t+15<=e.phaseLocation*this.imgWidth:!1},drawhandle(e,t,n,a,o,i,s){const r=e;r.beginPath(),r.moveTo(t+i,n),r.lineTo(a-i,n),r.quadraticCurveTo(a,n,a,n+i),r.lineTo(a,o-i),r.quadraticCurveTo(a,o,a-i,o),r.lineTo(t+i,o),r.quadraticCurveTo(t,o,t,o-i),r.lineTo(t,n+i),r.quadraticCurveTo(t,n,t+i,n),r.closePath(),r.lineWidth=2,r.strokeStyle=s,r.stroke(),r.fillStyle=s,r.fill();const l=2.5,c=3,u=2.5,d="rgba(255,255,255,0.65)";for(let h=0;h<3;h++)for(let v=0;v<2;v++){const p=t+i+c+v*(2*l+c),f=n+i+u+10+h*(2*l+u);r.beginPath(),r.arc(p,f,l,0,Math.PI*2),r.fillStyle=d,r.fill(),r.closePath()}},drawStartEndHandlers(e){const t=e,{canvas:n}=this.$refs,a=n.getContext("2d"),o=5,i=this.handlerBarWidth+o,s=this.barHeight,r=0;let l=t.start.XLocation;t.start.XLocation=l;const c=t.color;a.beginPath(),a.moveTo(l+o,r),a.lineTo(l+i-o,r),a.lineTo(l+i-o,r+s),a.lineTo(l+o,r+s),a.arcTo(l,r+s,l,r+s-o,o),a.lineTo(l,r+o),a.arcTo(l,r,l+o,r,o),a.closePath(),a.fillStyle=c,a.fill(),this.drawhandle(a,l+o-4,s/2-this.handleBarGrab.height,l+this.handleBarGrab.width,s/2+this.handleBarGrab.height,8,c),l=t.end.XLocation,t.end.XLocation=l,l-=o,a.beginPath(),a.moveTo(l+o,r),a.arcTo(l+i,r,l+i,r+o,o),a.lineTo(l+i,r+s-o),a.arcTo(l+i,r+s,l+i-o,r+s,o),a.lineTo(l+o,r+s),a.closePath(),a.fillStyle=c,a.fill(),this.drawhandle(a,l-this.handleBarGrab.width+o+7,s/2-this.handleBarGrab.height,l+o+4,s/2+this.handleBarGrab.height,8,c)},checksingleobj(e){return this.mouse.x>=e.location&&this.mouse.x<=e.location+e.width},snapObject(){this.movingObj.phaseLocation=this.convertXLocationtoPhase(this.movingObj.XLocation,this.movingObj.id),this.movingObj.XLocation=this.convertPhaseLocationtoX(this.movingObj.phaseLocation,this.movingObj.id)},endResize(){this.moving&&(this.moving=!1,this.snapObject(),this.drawTrimmer(),this.startX=this.mouse.x,this.moving=!1,this.movingObj="none",this.$emit("update-slice",this.sliceObj))},updateCursor(e="default"){this.canvasCursor=e},getNextKey(e,t){const n=Object.keys(e),a=n.indexOf(t);return a===-1||a===n.length-1?!1:n[a+1]},getPreviousKey(e,t){const n=Object.keys(e),a=n.indexOf(t);return a<=0?!1:n[a-1]},handleAddLabel(e){const t=this.findStateUserClicked(),n=e==="systoles"?"Systole":"Diastole",a=Math.floor(this.mouse.x/this.imgWidth)+1,o=this.convertPhaseLocationtoX(a),i={id:n,state:t,phaseLocation:a,XLocation:o};this.$emit("add-label",{id:this.sliceObj.id,target:e,state:t,newLabel:i}),this.drawTrimmer()},handleRightClick(e){if(this.addNewLabelX=e.offsetX,this.mouse.x=this.addNewLabelX,this.hasLabelOnClick=this.findIfLabelOnClick(),this.hasLabelOnClick==="error"){this.$refs.menu.popError(e);return}this.$refs.menu.openContextMenu(e)},handleRemoveLabel(){const{state:e,foundLabel:t,foundIndex:n}=this.hasLabelOnClick,a=this.sliceObj.states[e].cardiacCycles[t],o=this.removeElementAtIndex(a,n);this.$emit("remove-label",{id:this.sliceObj.id,state:e,cycle:t,newArray:o}),this.drawTrimmer()},removeElementAtIndex(e,t){if(t<0||t>=e.length)throw new Error("Index is out of range");const n=[...e];return n.splice(t,1),n},convertPhaseLocationtoX(e,t){let n;if(t==="start")n=(e-1)*this.imgWidth;else if(t==="end")n=e*this.imgWidth-this.handlerBarWidth;else{const a=(this.imgWidth-this.cardiacCyclesLabelWidth)/2;n=(e-1)*this.imgWidth+a}return n},convertXLocationtoPhase(e,t){let n;if(t==="start"){const a=e+this.imgWidth/2;n=Math.floor(a/this.imgWidth)+1}else if(t==="end"){const a=e-this.imgWidth/2;n=Math.floor(a/this.imgWidth)+1}else{const a=e+this.cardiacCyclesLabelWidth/2;n=Math.floor(a/this.imgWidth)+1}return n},addXLocation(e,t){const n=e;n.XLocation=this.convertPhaseLocationtoX(n.phaseLocation,t)},addXLocations(){Object.entries(this.sliceObj.states).forEach(([e])=>{const t=this.sliceObj.states[e];this.addXLocation(t.start,"start"),this.addXLocation(t.end,"end"),t.cardiacCycles.diastoles.forEach(n=>this.addXLocation(n)),t.cardiacCycles.systoles.forEach(n=>this.addXLocation(n))})}}};function P0(e,t,n,a,o,i){const s=P("AddCardiacCycle");return R(),E(ue,null,[g("div",{class:N([{hide:n.isHidden},"horizontal-bar"])},[g("canvas",{ref:"canvas",style:ie({cursor:o.canvasCursor}),onMousedown:t[0]||(t[0]=(...r)=>i.startResize&&i.startResize(...r)),onFocusin:t[1]||(t[1]=(...r)=>i.startResize&&i.startResize(...r)),onFocusout:t[2]||(t[2]=(...r)=>i.endResize&&i.endResize(...r)),onMousemove:t[3]||(t[3]=(...r)=>i.mousemoving&&i.mousemoving(...r)),onMouseup:t[4]||(t[4]=(...r)=>i.endResize&&i.endResize(...r)),onMouseout:t[5]||(t[5]=(...r)=>i.endResize&&i.endResize(...r)),onContextmenu:t[6]||(t[6]=oe((...r)=>i.handleRightClick&&i.handleRightClick(...r),["prevent"])),onMousewheelPassive:t[7]||(t[7]=(...r)=>this.$refs.menu.closeContextMenu&&this.$refs.menu.closeContextMenu(...r))},null,36)],2),y(s,{ref:"menu","has-label":o.hasLabelOnClick,onAddLabel:i.handleAddLabel,onRemoveLabel:i.handleRemoveLabel},null,8,["has-label","onAddLabel","onRemoveLabel"])],64)}const k0=A(V0,[["render",P0],["__scopeId","data-v-548ead61"]]);const M0={components:{ImageStripSlider:v0,VideoTrimmer:k0,ImageBarImageInfo:f0},emits:["newstate","update-slice","remove-label","add-label"],props:{currentState:{type:String,default:"FREEBREATHING"},maxWidth:{type:Number,default:1560},isHidden:{type:Boolean,default:!0},hideinfo:{type:Boolean,required:!0,default:!0},numImages:{type:Number,default:100},id:{type:String},sliceObj:{type:Object,required:!0}},data(){return{imageWidth:286,requestId:null,videTrimWidth:null,imageHeight:284,imageRatio:0,originalImageWidth:0,imageHeightWidthRatio:0,heightHere:284,viewState:"FREEBREATHING"}},created(){this.videTrimWidth=this.imageWidth*this.numImages},mounted(){const e=new Image;e.src="./images/test.png",e.onload=()=>{this.imageHeightWidthRatio=e.naturalHeight/e.naturalWidth,this.imageHeight=this.imageWidth*this.imageHeightWidthRatio,this.$refs.videotrimmer.barHeight=this.imageHeight},e.onerror=()=>{console.error("Failed to load the image.")},this.drawMovieStrip()},methods:{drawMovieStrip(){const e=this.$refs.movieStripCanvas,t=e.getContext("2d"),{numImages:n}=this;e.width=this.imageWidth*n,e.height=this.imageHeight,this.videTrimWidth=e.width,t.clearRect(0,0,e.width,e.height);const a=Array(n).fill("./images/test.png"),{imageWidth:o}=this;let i=0;const s=a.map(r=>new Promise((l,c)=>{const u=new Image;u.src=r,u.onload=()=>{l(u)},u.onerror=d=>{c(d)}}));Promise.all(s).then(r=>{r.forEach(l=>{t.drawImage(l,i,0,o,this.imageHeight),i+=o})}).catch(r=>{console.error(r)})},scrollX(e){const t="image-container",n=this.$refs[t];e.ctrlKey?n.scrollLeft+=e.deltaY*2.5:n.scrollLeft+=e.deltaY/4,this.$refs.sliderBar.updatePosition(100*n.scrollLeft/n.scrollWidth),this.getScrollState()},moveX(e){const t="image-container";this.$refs[t].scrollLeft=this.$refs[t].scrollWidth*(e/100),this.getScrollState()},getScrollState(){const e=["FREEBREATHING","HYPERVENTILATION","BREATHHOLD"],t=this.sliceObj,n=this.$refs["image-container"].scrollLeft;if(!(t.states[this.viewState].start.XLocation<n&&n<t.states[this.viewState].end.XLocation)){const a=e.find(o=>n<t.states[o].end.XLocation);a&&(this.viewState=a,this.$emit("newstate",this.viewState))}},scrollAnimation(e,t){const n=e,a=n.scrollLeft,o=300;let i;function s(r){i||(i=r);const l=r-i,c=Math.min(l/o,1);n.scrollLeft=a+t*c,c<1&&requestAnimationFrame(s)}requestAnimationFrame(s)},scrollToState(e){const t=this.$refs["image-container"],n=this.sliceObj.states[e].start.XLocation,a=n-t.scrollLeft;this.scrollAnimation(t,a),this.$refs.sliderBar.updatePosition(100*n/t.scrollWidth)},handleUpdateSlice(e){this.$emit("update-slice",e),this.$refs.sliderBar.drawCanvas()},handleRemoveLabel(e){this.$emit("remove-label",e)},handleAddLabel(e){this.$emit("add-label",e)}}},B0={style:{height:"284px"}},A0={class:"video-trimmer-container",ref:"video-trimmer-container"},F0={ref:"movieStripCanvas"},N0={key:0};function $0(e,t,n,a,o,i){const s=P("VideoTrimmer"),r=P("ImageBarImageInfo"),l=P("ImageStripSlider");return R(),E(ue,null,[g("div",B0,[g("div",{class:"strip",style:ie({width:n.maxWidth-250+"px"}),ref:"image-container",onMousewheelPassive:t[0]||(t[0]=(...c)=>i.scrollX&&i.scrollX(...c))},[g("div",A0,[y(s,{"slice-obj":n.sliceObj,BARHEIGHT:o.imageHeight,BARWIDTH:o.videTrimWidth,numImages:this.numImages,imgWidth:o.imageWidth,isHidden:!n.isHidden,ref:"videotrimmer",onUpdateSlice:i.handleUpdateSlice,onRemoveLabel:i.handleRemoveLabel,onAddLabel:i.handleAddLabel},null,8,["slice-obj","BARHEIGHT","BARWIDTH","numImages","imgWidth","isHidden","onUpdateSlice","onRemoveLabel","onAddLabel"])],512),g("div",{style:ie({height:o.heightHere+"px"}),ref:"moviestripcont"},[g("canvas",F0,null,512)],4),y(He,null,{default:x(()=>[n.hideinfo?(R(),E("div",N0,[y(r,{numImages:this.numImages,imgWidth:o.imageWidth,imgHeight:o.heightHere},null,8,["numImages","imgWidth","imgHeight"])])):j("",!0)]),_:1})],36)]),y(l,{numImages:this.numImages,imgWidth:o.imageWidth,"slice-obj":n.sliceObj,canvasWidth:n.maxWidth-250,onUpdateDone:i.drawMovieStrip,onMove:i.moveX,ref:"sliderBar"},null,8,["numImages","imgWidth","slice-obj","canvasWidth","onUpdateDone","onMove"])],64)}const U0=A(M0,[["render",$0],["__scopeId","data-v-446bbfb7"]]);const H0={props:{iconSource:{type:String,default:"input-cursor"},id:{type:Number},status:{type:Boolean,default:!0},iconHeight:{type:Number,default:30}},methods:{handleclick(){this.$emit("toggleVisibility",this.status)}}},W0=["src"];function z0(e,t,n,a,o,i){return R(),E("div",{onClick:t[0]||(t[0]=(...s)=>i.handleclick&&i.handleclick(...s)),class:N(["circle2",{clicked:n.status}]),onKeydown:t[1]||(t[1]=Pe(oe((...s)=>e.handleKeyDown&&e.handleKeyDown(...s),["prevent"]),["space"]))},[g("div",{class:N([{clicked:n.status},"icon-container"])},[g("img",{src:"/icons/"+n.iconSource+".svg",style:ie({height:n.iconHeight+"px"}),alt:"Icon"},null,12,W0)],2)],34)}const j0=A(H0,[["render",z0],["__scopeId","data-v-2d9b6532"]]);const G0={components:{StateButtons:u0,ImageBar:U0,IconToggleQA:j0},props:{sliceInfo:{type:Object}},data(){return{stateButtons:this.sliceInfo.stateButtons,allowedWidth:null}},methods:{handleStateChange(e){const t=e.replace(/\s/g,"");this.$emit("state-change",t),this.$refs.imgBar.scrollToState(t)},handleNewState(e){this.$emit("state-change",e)},handleUpdateSlice(e){this.$emit("update-slice",e)},handleRemoveLabel(e){this.$emit("remove-label",e)},handleAddLabel(e){this.$emit("add-label",e)},handleResize(){this.allowedWidth=window.innerWidth-100,this.allowedWidth>2e3&&(this.allowedWidth=2e3)}},created(){window.addEventListener("resize",this.handleResize),this.handleResize()}},X0={class:"state-control"},q0={class:"slice-name"},Y0={class:"toggle-icons-container"},K0={class:"state-buttons"},Q0={class:"movie-strip"};function J0(e,t,n,a,o,i){const s=P("IconToggleQA"),r=P("StateButtons"),l=P("ImageBar");return R(),E("div",{class:"slice",style:ie({width:o.allowedWidth+"px"})},[g("div",X0,[g("h1",q0,U(n.sliceInfo.name),1),g("div",Y0,[y(s,{id:n.sliceInfo.id,onToggleVisibility:t[0]||(t[0]=c=>e.$emit("toggle-trimmer",n.sliceInfo.id)),iconSource:"adjust-trim",status:n.sliceInfo.imgBarProperties.showTrimmer},null,8,["id","status"]),y(s,{id:n.sliceInfo.id,onToggleVisibility:t[1]||(t[1]=c=>e.$emit("toggle-patient-info",n.sliceInfo.id)),iconSource:"hide-bottom",status:n.sliceInfo.imgBarProperties.showPatientInfo},null,8,["id","status"]),y(s,{id:n.sliceInfo.id,status:n.sliceInfo.imgBarProperties.showGraph,iconSource:"show-contours",onToggleVisibility:t[2]||(t[2]=c=>e.$emit("toggle-graph",n.sliceInfo.id))},null,8,["id","status"])]),g("div",K0,[y(r,{id:n.sliceInfo.id,heartrate:o.stateButtons.FREEBREATHING.heartrate,duration:o.stateButtons.FREEBREATHING.duration,state:"FREE BREATHING","is-active":o.stateButtons.currentState==="FREEBREATHING",onStateChange:i.handleStateChange},null,8,["id","heartrate","duration","is-active","onStateChange"]),y(r,{id:n.sliceInfo.id,heartrate:o.stateButtons.HYPERVENTILATION.heartrate,duration:o.stateButtons.HYPERVENTILATION.duration,state:"HYPERVENTILATION","is-active":o.stateButtons.currentState==="HYPERVENTILATION",stateColor:o.stateButtons.HYPERVENTILATION.stateColor,onStateChange:i.handleStateChange},null,8,["id","heartrate","duration","is-active","stateColor","onStateChange"]),y(r,{id:n.sliceInfo.id,heartrate:o.stateButtons.BREATHHOLD.heartrate,duration:o.stateButtons.BREATHHOLD.duration,state:"BREATHHOLD","is-active":o.stateButtons.currentState==="BREATHHOLD",stateColor:o.stateButtons.BREATHHOLD.stateColor,onStateChange:i.handleStateChange},null,8,["id","heartrate","duration","is-active","stateColor","onStateChange"])])]),g("div",Q0,[y(l,{id:n.sliceInfo.sliceOBJ.id,isHidden:n.sliceInfo.imgBarProperties.showTrimmer,hideinfo:n.sliceInfo.imgBarProperties.showPatientInfo,"slice-obj":n.sliceInfo.sliceOBJ,currentState:o.stateButtons.currentState,maxWidth:o.allowedWidth,ref:"imgBar",onNewstate:i.handleNewState,onUpdateSlice:i.handleUpdateSlice,onRemoveLabel:i.handleRemoveLabel,onAddLabel:i.handleAddLabel},null,8,["id","isHidden","hideinfo","slice-obj","currentState","maxWidth","onNewstate","onUpdateSlice","onRemoveLabel","onAddLabel"])])],4)}const Z0=A(G0,[["render",J0],["__scopeId","data-v-2e7ebc24"]]);const e1={components:{BreathingSplitRow:Z0},data(){return{caseObj:{slice1:{id:"slice1",states:{FREEBREATHING:{color:"#79CFDE",start:{id:"start",state:"FREEBREATHING",phaseLocation:1},end:{id:"end",state:"FREEBREATHING",phaseLocation:4},cardiacCycles:{systoles:[{id:"Systole",state:"FREEBREATHING",phaseLocation:1},{id:"Systole",state:"FREEBREATHING",phaseLocation:2}],diastoles:[{id:"Diastole",state:"FREEBREATHING",phaseLocation:3}]}},HYPERVENTILATION:{color:"#C24ABC",start:{id:"start",state:"HYPERVENTILATION",phaseLocation:5},end:{id:"end",state:"HYPERVENTILATION",phaseLocation:20},cardiacCycles:{systoles:[{id:"Systole",state:"HYPERVENTILATION",phaseLocation:5}],diastoles:[{id:"Diastole",state:"HYPERVENTILATION",phaseLocation:6}]}},BREATHHOLD:{color:"#d95476",start:{id:"start",state:"BREATHHOLD",phaseLocation:21},end:{id:"end",state:"BREATHHOLD",phaseLocation:30},cardiacCycles:{systoles:[{id:"Systole",state:"BREATHHOLD",phaseLocation:25}],diastoles:[{id:"Diastole",state:"BREATHHOLD",phaseLocation:28}]}}}},slice2:{id:"slice2",states:{FREEBREATHING:{color:"#79CFDE",start:{id:"start",state:"FREEBREATHING",phaseLocation:1},end:{id:"end",state:"FREEBREATHING",phaseLocation:10},cardiacCycles:{systoles:[{id:"Systole",state:"FREEBREATHING",phaseLocation:3}],diastoles:[{id:"Diastole",state:"FREEBREATHING",phaseLocation:5}]}},HYPERVENTILATION:{color:"#C24ABC",start:{id:"start",state:"HYPERVENTILATION",phaseLocation:11},end:{id:"end",state:"HYPERVENTILATION",phaseLocation:30},cardiacCycles:{systoles:[{id:"Systole",state:"HYPERVENTILATION",phaseLocation:12}],diastoles:[{id:"Diastole",state:"HYPERVENTILATION",phaseLocation:20}]}},BREATHHOLD:{color:"#d95476",start:{id:"start",state:"BREATHHOLD",phaseLocation:31},end:{id:"end",state:"BREATHHOLD",phaseLocation:80},cardiacCycles:{systoles:[{id:"Systole",state:"BREATHHOLD",phaseLocation:35}],diastoles:[{id:"Diastole",state:"BREATHHOLD",phaseLocation:60}]}}}}},sliceInfo1:{name:"SLICE 1",id:1,sliceOBJ:null,stateButtons:{currentState:"FREEBREATHING",FREEBREATHING:{state:"FREEBREATHING",heartrate:80,duration:"01:32",stateColor:"#E242E6"},HYPERVENTILATION:{state:"FREEBREATHING",heartrate:120,duration:"02:32",stateColor:"#E242E6"},BREATHHOLD:{state:"FREEBREATHING",heartrate:70,duration:"00:32",stateColor:"#D95476"}},imgBarProperties:{showTrimmer:!0,showPatientInfo:!0,showGraph:!1}},sliceInfo2:{name:"SLICE 2",id:2,sliceOBJ:null,stateButtons:{currentState:"FREEBREATHING",FREEBREATHING:{state:"FREEBREATHING",heartrate:50,duration:"01:32",stateColor:"#E242E6"},HYPERVENTILATION:{state:"FREEBREATHING",heartrate:60,duration:"01:32",stateColor:"#E242E6"},BREATHHOLD:{state:"FREEBREATHING",heartrate:125,duration:"01:32",stateColor:"#D95476"}},imgBarProperties:{showTrimmer:!0,showPatientInfo:!0,showGraph:!1}}}},methods:{handleUpdateSlice(e){const t=e.id;this.caseObj[t]=e},handleRemoveLabel(e){this.caseObj[e.id].states[e.state].cardiacCycles[e.cycle]=e.newArray},handleAddLabel(e){this.caseObj[e.id].states[e.state].cardiacCycles[e.target].push(e.newLabel)}},created(){this.sliceInfo1.sliceOBJ=this.caseObj.slice1,this.sliceInfo2.sliceOBJ=this.caseObj.slice2}},t1={class:"slices-containers"};function n1(e,t,n,a,o,i){const s=P("BreathingSplitRow");return R(),E("div",t1,[y(s,{"slice-info":o.sliceInfo1,onToggleTrimmer:t[0]||(t[0]=r=>o.sliceInfo1.imgBarProperties.showTrimmer=!o.sliceInfo1.imgBarProperties.showTrimmer),onTogglePatientInfo:t[1]||(t[1]=r=>o.sliceInfo1.imgBarProperties.showPatientInfo=!o.sliceInfo1.imgBarProperties.showPatientInfo),onToggleGraph:t[2]||(t[2]=r=>o.sliceInfo1.imgBarProperties.showGraph=!o.sliceInfo1.imgBarProperties.showGraph),onStateChange:t[3]||(t[3]=r=>o.sliceInfo1.stateButtons.currentState=r),onUpdateSlice:i.handleUpdateSlice,onRemoveLabel:i.handleRemoveLabel,onAddLabel:i.handleAddLabel},null,8,["slice-info","onUpdateSlice","onRemoveLabel","onAddLabel"]),y(s,{"slice-info":o.sliceInfo2,onToggleTrimmer:t[4]||(t[4]=r=>o.sliceInfo2.imgBarProperties.showTrimmer=!o.sliceInfo2.imgBarProperties.showTrimmer),onTogglePatientInfo:t[5]||(t[5]=r=>o.sliceInfo2.imgBarProperties.showPatientInfo=!o.sliceInfo2.imgBarProperties.showPatientInfo),onToggleGraph:t[6]||(t[6]=r=>o.sliceInfo2.imgBarProperties.showGraph=!o.sliceInfo2.imgBarProperties.showGraph),onStateChange:t[7]||(t[7]=r=>o.sliceInfo2.stateButtons.currentState=r),onUpdateSlice:i.handleUpdateSlice,onRemoveLabel:i.handleRemoveLabel,onAddLabel:i.handleAddLabel},null,8,["slice-info","onUpdateSlice","onRemoveLabel","onAddLabel"])])}const o1=A(e1,[["render",n1],["__scopeId","data-v-4bc1b451"]]);const i1={components:{CheckBreathingSplits:o1,CheckContours:gs,LoadingScreen:oa},data(){return{currentComponent:"CheckBreathingSplits"}},methods:{handleButtonClicked(e){this.activeButton=e},toggleComponent(e){this.currentComponent=e}},mounted(){const e=window.sessionStorage.getItem("currentQaView");console.log(e),this.currentComponent=e}},a1={class:"qualitycontainer"};function s1(e,t,n,a,o,i){return R(),E("div",a1,[g("div",{class:N([{loaded:1},"comp-container"])},[y(He,{name:"fade"},{default:x(()=>[(R(),K(_i(o.currentComponent)))]),_:1})])])}const r1=A(i1,[["render",s1],["__scopeId","data-v-0f6c2646"]]);const l1={props:{editable:{type:Boolean}},data(){return{imageSource:null,hovering:!1}},methods:{openImageDialog(){this.$refs.imageInput.click()},handleImageChange(e){this.uploadImage(e.target.files[0])},handleImageDrop(e){e.preventDefault();const t=e.dataTransfer.files[0];this.uploadImage(t)},handleDragOver(e){e.preventDefault(),this.hovering=!0},handleDragLeave(){this.hovering=!1},uploadImage(e){if(e){const t=new FileReader;t.onloadend=()=>{this.imageSource=t.result},t.readAsDataURL(e)}}}},c1=["src"];function u1(e,t,n,a,o,i){return R(),E("div",{class:"logo-holder",onClick:t[2]||(t[2]=(...s)=>i.openImageDialog&&i.openImageDialog(...s)),onDragenter:t[3]||(t[3]=(...s)=>i.handleDragOver&&i.handleDragOver(...s)),onDragover:t[4]||(t[4]=(...s)=>i.handleDragOver&&i.handleDragOver(...s)),onDrop:t[5]||(t[5]=(...s)=>i.handleImageDrop&&i.handleImageDrop(...s)),onDragleave:t[6]||(t[6]=(...s)=>i.handleDragLeave&&i.handleDragLeave(...s)),ref:"logoContainer",onKeydown:t[7]||(t[7]=Pe(oe((...s)=>e.handleKeyDown&&e.handleKeyDown(...s),["prevent"]),["space"]))},[o.imageSource?(R(),E("img",{key:0,src:o.imageSource,alt:"Uploaded Logo",style:{cursor:"pointer"}},null,8,c1)):j("",!0),n.editable&&!o.imageSource?(R(),E("div",{key:1,class:N(["place-holder",{hover:o.hovering}])},[g("h4",{onDragover:t[0]||(t[0]=(...s)=>i.handleDragOver&&i.handleDragOver(...s))},"Click or Drop Logo",32)],2)):j("",!0),g("input",{ref:"imageInput",type:"file",style:{display:"none"},accept:"image/*",onChange:t[1]||(t[1]=(...s)=>i.handleImageChange&&i.handleImageChange(...s)),"aria-labelledby":"logoImageInput"},null,544)],544)}const d1=A(l1,[["render",u1],["__scopeId","data-v-bca1a7a6"]]);const h1={props:{id:{type:String,required:!0},options:{type:Array,required:!0},editable:{type:Boolean,default:!0}},data(){return{selectedOption:"Select..."}},methods:{onOptionSelected(e){const t=e.target.value;this.selectedOption=t,this.$emit("option-selected",this.id,t)}}},g1=e=>(le("data-v-6a5101fe"),e=e(),ce(),e),f1={key:0,class:"select"},p1=["id"],m1=g1(()=>g("option",{value:"",disabled:"",selected:""},"Select...",-1)),v1=["value"],y1={key:1,class:"selected-option"};function w1(e,t,n,a,o,i){return n.editable?(R(),E("div",f1,[g("select",{id:n.id,required:"",onChange:t[0]||(t[0]=s=>i.onOptionSelected(s)),"aria-labelledby":"dropDownComponentinReportElement"},[m1,(R(!0),E(ue,null,Be(n.options,(s,r)=>(R(),E("option",{key:r,value:s.value},U(s.label),9,v1))),128))],40,p1)])):(R(),E("h5",y1,U(o.selectedOption),1))}const S1=A(h1,[["render",w1],["__scopeId","data-v-6a5101fe"]]);const _1={props:{id:{type:String},width:{type:Number,default:200},height:{type:Number,default:250},canvasText:{type:String,default:"Select or Drop Image"},addBar:{type:String,default:null},editable:{type:Boolean,default:!0}},data(){return{moveMode:!1,isMoving:!1,cStartX:null,cStartY:null,canvasX:0,canvasY:0,zoomValue:1,defaultZoomValue:1,originalImage:null,hovering:!1}},methods:{setupCanvas(){const{canvas:e}=this.$refs,t=e.getContext("2d");e.width=this.width*(1/.75),e.height=this.height,t.fillStyle="rgba(0, 0, 0, 0.3)",t.fillRect(0,0,e.width,e.height),t.fillStyle="white",t.font="20px Arial",t.textAlign="center",t.textBaseline="middle",this.wrapText(t,this.canvasText,e.width/2,e.height/2,150)},wrapText(e,t,n,a,o){let i=a;const s=t.split(" ");let r="";const l=e.measureText("M").width*1.2;for(let c=0;c<s.length;c++){const u=`${r+s[c]} `;e.measureText(u).width>o&&c>0?(e.fillText(r,n,i),r=`${s[c]} `,i+=l):r=u}e.fillText(r,n,i)},drawImage(){const{canvas:e}=this.$refs,t=e.getContext("2d");t.clearRect(0,0,e.width,e.height),t.drawImage(this.originalImage,0,0)},openFilePicker(){this.$refs.imageLoaderInput.click()},uploadImage(e){const t=e.target.files[0],{canvas:n}=this.$refs;if(t){const a=new FileReader;a.onload=o=>{this.originalImage=new Image,this.originalImage.onload=()=>{n.width=this.originalImage.width+10,n.height=this.originalImage.height+10,this.drawImage()},this.originalImage.src=o.target.result,this.updateImageZoom(),this.resetImagePositionAndZoom()},a.readAsDataURL(t)}},uploadImageDrop(e){const{canvas:t}=this.$refs;if(e){const n=new FileReader;n.onload=a=>{this.originalImage=new Image,this.originalImage.onload=()=>{t.width=this.originalImage.width+10,t.height=this.originalImage.height+10,this.drawImage()},this.originalImage.src=a.target.result,this.updateImageZoom(),this.resetImagePositionAndZoom()},n.readAsDataURL(e)}},handleImageDrop(e){e.preventDefault();const t=e.dataTransfer.files[0];this.uploadImageDrop(t),this.hovering=!1},handleDragOver(e){e.preventDefault(),this.hovering=!0},handleDragLeave(){this.hovering=!1},toggleMoveMode(){this.originalImage&&(this.moveMode=!this.moveMode)},handleMouseDown(e){this.moveMode&&(this.isMoving=!0,this.cStartX=e.clientX,this.cStartY=e.clientY)},handleMouseMove(e){if(!(!this.moveMode||!this.isMoving)){if(this.cStartX!==void 0&&this.cStartY!==void 0){const t=e.clientX-this.cStartX,n=e.clientY-this.cStartY;this.canvasX+=t,this.canvasY+=n,this.$refs.canvas.style.transform=`translate(${this.canvasX}px, ${this.canvasY}px)`,this.cStartX=e.clientX,this.cStartY=e.clientY}}},handleMouseUp(){this.isMoving=!1,this.cStartX=void 0,this.cStartY=void 0},zoomIn(){this.zoomValue+=.025,this.updateImageZoom()},zoomOut(){this.zoomValue-=.025,this.updateImageZoom()},resetImagePositionAndZoom(){this.moveMode=!1,this.zoomValue=this.defaultZoomValue,this.updateImageZoom()},updateImageZoom(){if(this.originalImage){const e=this.$refs.zoomControl;e.style.transform=`scale(${this.zoomValue})`,e.style.transformOrigin="0 0"}},async captureScreenshot(){const e=this.$refs["vascular-image-div"];Ci(e,{logging:!1,scale:3}).then(t=>{const n=t.toDataURL("image/png");this.$emit("screenshot-captured",this.id,n)}).catch(t=>{console.error("Error capturing screenshot:",t)})}},mounted(){if(this.setupCanvas(),this.addBar){const e=new Image;e.src=this.addBar,e.onload=()=>{this.$refs.barGraphLegend.src=e.src}}},watch:{editable(){this.moveMode&&(this.moveMode=!this.moveMode,this.handleMouseUp())}}},xn=e=>(le("data-v-3e2c92d2"),e=e(),ce(),e),C1={key:0,class:"buttons"},b1={class:"upload-button",title:"Upload File",alt:"Upload File",style:{position:"relative"}},T1=xn(()=>g("i",{class:"fas fa-upload fa-lg",style:{color:"#ffffff"}},null,-1)),I1=[T1],R1={key:0,class:"move-button",title:"Move",alt:"Move",style:{position:"relative"}},x1=xn(()=>g("i",{class:"fas fa-arrows fa-lg",style:{color:"#ffffff"}},null,-1)),D1=[x1],E1={key:1,class:"zoom-in-button",title:"Zoom In",alt:"Zoom In",style:{position:"relative"}},L1=xn(()=>g("i",{class:"fas fa-search-plus fa-lg",style:{color:"#ffffff"}},null,-1)),O1=[L1],V1={key:2,class:"zoom-out-button",title:"Zoom Out",alt:"Zoom Out",style:{position:"relative"}},P1=xn(()=>g("i",{class:"fas fa-search-minus fa-lg",style:{color:"#ffffff"}},null,-1)),k1=[P1],M1={ref:"vascular-image-div"},B1={key:0,style:{position:"relative"}},A1={style:{"user-select":"none","-webkit-user-drag":"none"},id:"bar-graph-legend-os",ref:"barGraphLegend",alt:"Image Not Loaded"};function F1(e,t,n,a,o,i){return R(),E("div",{id:"image-container",class:N({moving:o.moveMode,hover:o.hovering}),style:ie({height:n.height+"px",width:n.width+"pt"}),onDragenter:t[8]||(t[8]=(...s)=>i.handleDragOver&&i.handleDragOver(...s)),onDragover:t[9]||(t[9]=(...s)=>i.handleDragOver&&i.handleDragOver(...s)),onDrop:t[10]||(t[10]=(...s)=>i.handleImageDrop&&i.handleImageDrop(...s)),onDragleave:t[11]||(t[11]=(...s)=>i.handleDragLeave&&i.handleDragLeave(...s))},[n.editable?(R(),E("div",C1,[g("div",b1,[g("button",{class:"upload-buttons upload-image",onClick:t[0]||(t[0]=(...s)=>i.openFilePicker&&i.openFilePicker(...s))},I1),g("input",{type:"file",ref:"imageLoaderInput",name:"imageLoader",style:{display:"none"},accept:"image/*",onChange:t[1]||(t[1]=(...s)=>i.uploadImage&&i.uploadImage(...s)),"aria-labelledby":"hiddenImageInputinReport"},null,544)]),o.originalImage?(R(),E("div",R1,[g("button",{class:N(["upload-buttons",{moving:o.moveMode}]),style:{left:"50px"},onClick:t[2]||(t[2]=(...s)=>i.toggleMoveMode&&i.toggleMoveMode(...s))},D1,2)])):j("",!0),o.originalImage?(R(),E("div",E1,[g("button",{class:"upload-buttons",style:{left:"90px"},onClick:t[3]||(t[3]=(...s)=>i.zoomIn&&i.zoomIn(...s))},O1)])):j("",!0),o.originalImage?(R(),E("div",V1,[g("button",{class:"upload-buttons",style:{left:"130px"},onClick:t[4]||(t[4]=(...s)=>i.zoomOut&&i.zoomOut(...s))},k1)])):j("",!0)])):j("",!0),g("div",M1,[n.addBar?(R(),E("div",B1,[g("img",A1,null,512)])):j("",!0),g("div",{style:ie({height:n.height+"px",width:n.width+"pt"}),ref:"zoomControl"},[g("canvas",{ref:"canvas",id:"vascular-image",onMousedown:t[5]||(t[5]=(...s)=>i.handleMouseDown&&i.handleMouseDown(...s)),onMousemove:t[6]||(t[6]=(...s)=>i.handleMouseMove&&i.handleMouseMove(...s)),onMouseup:t[7]||(t[7]=(...s)=>i.handleMouseUp&&i.handleMouseUp(...s))},null,544)],4)],512)],38)}const N1=A(_1,[["render",F1],["__scopeId","data-v-3e2c92d2"]]);const $1={props:{id:{type:String,required:!1},values:{type:Array,required:!0}},data(){return{outerradius:85/2-1,LAD:null,LCX:null,RCA:null}},watch:{values(){this.setValues(),this.createChart()}},mounted(){this.setValues(),this.createChart()},methods:{setValues(){[this.LAD,this.LCX,this.RCA]=this.values},createChart(){const e=this.$refs.chartCanvas,t=e.getContext("2d");e.width=85,e.height=85;const n=e.width/2,a=e.height/2,o=this.outerradius,i=o/4;t.clearRect(0,0,e.width,e.height);const s=this.getColors([this.RCA,this.LAD,this.LCX]),r=[1,1,1],l=r.reduce((u,d)=>u+d,0);let c=0;r.forEach((u,d)=>{const h=u/l*Math.PI*2,v=c+h;t.beginPath(),t.moveTo(n+o*Math.cos(c),a+o*Math.sin(c)),t.arc(n,a,o,c,v),t.arc(n,a,i,v,c,!0),t.closePath(),t.fillStyle=s[d],t.fill(),t.lineWidth=.5,t.strokeStyle="black",t.stroke(),c=v}),t.beginPath(),t.arc(n,a,o,0,Math.PI*2),t.strokeStyle="#00000",t.lineWidth=0,t.stroke(),t.beginPath(),t.arc(n,a,i,0,Math.PI*2),t.strokeStyle="#00000",t.lineWidth=0,t.stroke()},numberToColorGradient(e){let t=e;t=t.toString().replace(/%/g,"");const n=[{color:[1,25,242],minPercentage:0,maxPercentage:.23},{color:[0,227,252],minPercentage:.23,maxPercentage:.45},{color:[44,246,91],minPercentage:.45,maxPercentage:.6},{color:[252,208,13],minPercentage:.6,maxPercentage:.75},{color:[255,16,1],minPercentage:.75,maxPercentage:1}];t=Math.min(Math.max(Number(t),-20),20);const a=(t+20)/40;let o,i;for(let u=0;u<n.length;u++)if(a>=n[u].minPercentage&&a<=n[u].maxPercentage){o=n[u],i=n[u+1];break}i||(o=n[n.length-2],i=n[n.length-1]);const s=(a-o.minPercentage)/(i.maxPercentage-o.minPercentage),r=Math.round(o.color[0]+s*(i.color[0]-o.color[0])),l=Math.round(o.color[1]+s*(i.color[1]-o.color[1])),c=Math.round(o.color[2]+s*(i.color[2]-o.color[2]));return`rgb(${r}, ${l}, ${c})`},getColors(e){return[this.numberToColorGradient(e[0]),this.numberToColorGradient(e[1]),this.numberToColorGradient(e[2])]}}},U1={style:{position:"relative"}},H1={ref:"chartCanvas"},W1={style:{position:"absolute",color:"rgb(255, 255, 255)",top:"10px",left:"14px",width:"38px",height:"20px","text-align":"center"}},z1={style:{position:"absolute",color:"rgb(255, 255, 255)",top:"55px",left:"12px",width:"38px",height:"20px","text-align":"center"}},j1={style:{position:"absolute",color:"rgb(255, 255, 255)",top:"32px",left:"52px",width:"35px",height:"20px","text-align":"center"}};function G1(e,t,n,a,o,i){return R(),E("div",U1,[g("canvas",H1,null,512),g("div",W1,[g("h5",null,U(o.LAD),1)]),g("div",z1,[g("h5",null,U(o.RCA),1)]),g("div",j1,[g("h5",null,U(o.LCX),1)])])}const X1=A($1,[["render",G1],["__scopeId","data-v-4c39254e"]]);const q1={props:{id:{type:String,required:!0},propValue:{type:String,required:!0,default:"00"},editable:{type:Boolean,default:!0}},data(){return{editing:0,editedValue:this.propValue}},methods:{stopEditing(){this.$emit("updateValue",this.id,this.editedValue)},updateProp(e){this.editedValue=e.target.value}},watch:{editable(){this.$refs.inputField.readOnly=!this.editable}},mounted(){this.editable||(this.$refs.inputField.readOnly=!0)}},Y1=["value"];function K1(e,t,n,a,o,i){return R(),E("input",{value:n.propValue,onInput:t[0]||(t[0]=(...s)=>i.updateProp&&i.updateProp(...s)),onBlur:t[1]||(t[1]=(...s)=>i.stopEditing&&i.stopEditing(...s)),ref:"inputField",class:N({edit:n.editable})},null,42,Y1)}const Q1=A(q1,[["render",K1],["__scopeId","data-v-e918b819"]]);const J1={props:{id:{type:String,required:!0},propValue:{type:String,required:!0,default:"00"},placeholder:{type:String,default:""},editable:{type:Boolean,default:!0}},data(){return{editing:0,editedValue:this.propValue}},methods:{stopEditing(){this.$emit("updateValue",this.id,this.editedValue)},updateProp(e){this.editedValue=e.target.value}},mounted(){this.editable||(this.$refs.inputField.readOnly=!0)},watch:{editable(){this.$refs.inputField.readOnly=!this.editable}}},Z1=["value","placeholder"];function ey(e,t,n,a,o,i){return R(),E("textarea",{value:n.propValue,onInput:t[0]||(t[0]=(...s)=>i.updateProp&&i.updateProp(...s)),onBlur:t[1]||(t[1]=(...s)=>i.stopEditing&&i.stopEditing(...s)),ref:"inputField",class:N({edit:n.editable,noedit:!n.editable}),placeholder:n.placeholder,"aria-labelledby":"textAreaInReportEditable"},null,42,Z1)}const ty=A(J1,[["render",ey],["__scopeId","data-v-ab34c9dc"]]);const ny={components:{ReportLogoHolder:d1,ReportDropDown:S1,ReportImageContainer:N1,ReportStrainMaps:X1,ReportTextBox:Q1,ReportTextBoxMultiple:ty},props:{editable:{type:Boolean,required:!0,default:!0}},data(){return{genderOptions:[{value:"Female",label:"Female"},{value:"Male",label:"Male"},{value:"Other",label:"Other"}],completeDataOptions:[{value:"Yes",label:"Yes"},{value:"No",label:"No"}],imageQualityOptions:[{value:"Excellent",label:"Excellent"},{value:"Good",label:"Good"},{value:"OK",label:"OK"},{value:"Bad",label:"Bad"}],OS_REPORT_VALUES:{reportTitle:"BE-OS CMR Report",reportLogo:null,patientName:"PATIENT NAME",patientGender:"",patientAge:"00",patientDOB:"DD-Mon-YYYY",patientID:"123 456 789",rbhNumber:"000 000 000",protocol:"OS C-",scanDate:"DD-Mon-YYYY",scanTime:"00:00",completeData:"",imageQuality:"",reader:"Reader Name, MD",verifier:"Verifier Name, MD",scannerSystem:"Philips Ingenia",fieldStrength:"1.5T",softwareVersion:"5.7.1.3",starClaimer:"*Normal values are continuously being updated, therefore, may be subject to changes",summary:"",heartRateBaseline:"00",heartRateHV:"00",heartRateBH:"00",dtheartrate:"00",dtheartrateNormalRange:">15",vascularGlobal:"00",vascularLAD:"00",vascularLCX:"00",vascularRCA:"00",normalRangeVascular:">9.1",strainLADBaseline:"00",strainLADHV:"00",strainLADBH:"00",strainLCXBaseline:"00",strainLCXHV:"00",strainLCXBH:"00",strainRCABaseline:"00",strainRCAHV:"00",strainRCABH:"00",strainGLOBALBaseline:"00",strainGLOBALHV:"00",strainGLOBALBH:"00",vascularImage:"",strainImage:"",oxygenSensitiveMap:"",strainMapImage:"",strainMapBaseline:"",strainMapHV:"",strainMapBH:"",normalRange:"<-20%"}}},methods:{onOptionSelected(e,t){this.OS_REPORT_VALUES[e]=t},handleLogoUpdate(e){this.OS_REPORT_VALUES.reportLogo=e},handleUpdateValues(e,t){this.OS_REPORT_VALUES[e]=t},downloadReport(){this.buildPDF()},async getImage(e){await this.$refs[e].captureScreenshot()},async getImages(){await this.getImage("strainImage"),await this.getImage("vascularImage"),await this.getImage("oxygenSensitiveMap"),await this.captureScreenshot("strainMapImage","territorymapimg"),await this.captureScreenshot("reportLogo","reportLogo")},async captureScreenshot(e,t){const n=this.$refs[t];Ci(n,{logging:!1,scale:3}).then(a=>{const o=a.toDataURL("image/png");this.handleImageScreenshot(e,o)}).catch(a=>{console.error("Error capturing screenshot:",a)})},handleImageScreenshot(e,t){this.OS_REPORT_VALUES[e]=t},buildPDF(){const e=this.OS_REPORT_VALUES;window.jsPDF=window.jspdf.jsPDF;const t=lr("p","pt",[612,792]);t.addFont("/fonts/Roboto-Light.ttf","Roboto","normal"),t.addFont("/fonts/arial_italic.ttf","Arial","normal"),t.addFont("/fonts/arial_greek.ttf","ArialGreek","normal"),t.setFont("helvetica","bold"),t.setFontSize(22),t.text(e.reportTitle,42,60),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Patient",42,80),e.reportLogo!=null&&t.addImage(e.reportLogo,"PNG",413,25,150,52.5),t.setFontSize(15),t.setTextColor("#229ED7"),t.text(e.patientName,42,97),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Gender:",43,114),t.setFontSize(10),t.setTextColor("#000917"),t.text(e.patientGender,81,114),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Age:",164,114),t.setFontSize(10),t.setTextColor("#000917"),t.text(e.patientAge,187,114),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("DOB:",269,114),t.setFontSize(10),t.setTextColor("#000917"),t.text(e.patientDOB,294,114),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Patient ID:",410,114),t.setFontSize(10),t.setTextColor("#000917"),t.text(e.patientID,460,114),t.setLineWidth(.1),t.line(577,120,35,122),t.setFontSize(10),t.setTextColor("#5E5D6C"),t.text("Exam",42,148),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("RBH number:",42,162),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.rbhNumber,42,175),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Protocol:",42,189),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.protocol,42,202),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Date:",42,216),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.scanDate,42,229),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Time:",42,243),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.scanTime,42,256),t.setFontSize(10),t.setTextColor("#5E5D6C"),t.text("Scan",42,293),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Complete Data:",42,307),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.completeData,42,320),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Image Quality:",42,334),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.imageQuality,42,347),t.setFontSize(10),t.setTextColor("#5E5D6C"),t.text("Analytical Team",42,383),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Reader:",42,397),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.reader,42,410),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Verified By:",42,424),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.verifier,42,437),t.setFontSize(10),t.setTextColor("#5E5D6C"),t.text("Scanner",42,473),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("System:",42,487),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.scannerSystem,42,500),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Field Strength:",42,514),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.fieldStrength,42,527),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("Software Version:",42,541),t.setFontSize(9),t.setTextColor("#000917"),t.text(e.softwareVersion,42,554),t.setTextColor("#5E5D6C"),t.setFont("helvetica","normal"),t.setFont("Arial"),this.processSentences(e.starClaimer,120,t,42,594),t.text("For research use only.",42,760),t.setFont("helvetica","bold"),t.setFontSize(12),t.setTextColor("#5E5D6C"),t.text("SUMMARY",170,148),t.setFillColor("#f8f8f8"),t.setDrawColor(255,255,255),t.roundedRect(166,155,425,110,10,10,"FD"),t.setFontSize(9),t.setTextColor("#000917"),this.processSentences(e.summary,380,t,178,170),t.setFillColor("#f8f8f8"),t.setDrawColor(255,255,255),t.roundedRect(166,270,425,500,10,10,"FD"),t.setFillColor("#e0e0e0"),t.setDrawColor(255,255,255),t.roundedRect(176,275,405,55,5,5,"FD"),t.setFontSize(10),t.setTextColor("#000917"),t.text("Heart Rate",186,305),t.text("Normal Range",186,320),t.text(e.heartRateBaseline,286,305),t.text(e.heartRateHV,379,305),t.text(e.heartRateBH,440,305),t.text(e.dtheartrate,520,305),t.text(e.dtheartrateNormalRange,520,320),t.setFontSize(9),t.setTextColor("#5E5D6C"),t.text("BASELINE",286,290),t.text("HV",379,290),t.text("BH @ 30 SEC",440,290),t.setFont("helvetica","normal"),t.setFont("ArialGreek"),t.text("Δ",520,290),t.setFont("helvetica","bold"),t.text("HR",530,290),t.setFillColor("#e0e0e0"),t.setDrawColor(255,255,255),t.roundedRect(176,350,200,75,5,5,"FD"),t.roundedRect(381,350,200,75,5,5,"FD"),t.setFontSize(12),t.text("VASCULAR",180,345),t.text("STRAIN",385,345),t.setFontSize(8),t.text("B-MORE",185,365),t.setTextColor("#000917"),t.setFontSize(9),t.text("Global",185,380),t.text("LAD",185,392),t.text("LCX",185,404),t.text("RCA",185,415),t.text(e.vascularGlobal,230,380),t.text("*Normal Range: ",260,380),t.text(e.normalRangeVascular,330,380),t.text(e.vascularLAD,230,392),t.text(e.vascularLCX,230,404),t.text(e.vascularRCA,230,415),t.setFontSize(8),t.setTextColor("#5E5D6C"),t.text("B-MORE",390,365),t.text("BASELINE",435,365),t.text("HV",485,365),t.text("BH @ 30 SEC",522,365),t.setFontSize(9),t.setTextColor("#000917"),t.text("Global",390,380),t.text("LAD",390,392),t.text("LCX",390,404),t.text("RCA",390,415),t.text(e.strainGLOBALBaseline,435,380),t.text(e.strainGLOBALHV,485,380),t.text(e.strainGLOBALBH,523,380),t.text(e.strainLADBaseline,435,392),t.text(e.strainLADHV,485,392),t.text(e.strainLADBH,523,392),t.text(e.strainLCXBaseline,435,404),t.text(e.strainLCXHV,485,404),t.text(e.strainLCXBH,523,404),t.text(e.strainRCABaseline,435,415),t.text(e.strainRCAHV,485,415),t.text(e.strainRCABH,523,415),t.roundedRect(176,430,200,187.5,0,0,"FD"),t.roundedRect(381,430,200,187.5,0,0,"FD"),t.setFontSize(12),t.setTextColor("#000917"),t.text("Oxygen Sensitive Map",210,635),t.text("STRAIN MAPS",382,635),t.setFontSize(8),t.setTextColor("#5E5D6C"),t.text("BASELINE",390,753),t.text("HYPER-",467,748),t.text("VENTILATION",455,758),t.text("BREATH-",535,743),t.text("HOLD",540,753),t.text("(30 sec)",537,763),t.setFillColor("#e0e0e0"),t.setDrawColor(255,255,255),t.roundedRect(375,715,75,25,7,7,"FD"),t.setFontSize(9),t.setTextColor("#000917"),t.text("Normal Range: ",380,724.5),t.text(e.normalRange,380,734.5),t.addImage(e.strainImage,"PNG",381,430,200,187.5),t.addImage(e.vascularImage,"PNG",176,430,200,187.5),t.addImage(e.oxygenSensitiveMap,"PNG",201,650,150,112.5),t.addImage(e.strainMapImage,"PNG",376,645,210,70);const n=new Date().toLocaleDateString("en-US");t.save(`Area19_Report_${e.patientName}_${n}.pdf`)},processSentences(e,t,n,a,o){function i(u){const d=document.createElement("span");d.style.font="10px Arial",d.style.position="absolute",d.style.visibility="hidden",d.textContent=u,document.body.appendChild(d);const{width:h}=d.getBoundingClientRect();return document.body.removeChild(d),h}let s=e.trim().split(new RegExp("(?<=[.!?])|\\n"));s=s.map(u=>u.replace(/\n/g,""));function r(u,d){const h=u.split(" "),v=[];let p=h[0];for(let f=1;f<h.length;f++){const m=`${p} ${h[f]}`;i(m)<=d?p=m:(v.push(p),p=h[f])}return v.push(p),v}let l=0,c=o;s.forEach(u=>{i(u)>t?r(u,t).forEach(h=>{l>0&&(c+=14),n.text(h,a,c),l++}):(l>0&&(c+=14),n.text(u,a,c),l++)})}},watch:{OS_REPORT_VALUES:{handler(){window.localStorage.setItem("reportValues",JSON.stringify(this.OS_REPORT_VALUES))},deep:!0},editable(){this.editable||this.getImages()}}},q=e=>(le("data-v-d503f07e"),e=e(),ce(),e),oy={class:"print-area"},iy={id:"report-element",class:"report-element"},ay={class:"row1"},sy={ref:"reportLogo"},ry={class:"row2"},ly=q(()=>g("h5",null,"Patient",-1)),cy={class:"row3",style:{"border-bottom":"1px solid black"}},uy={id:"gender",style:{display:"flex",gap:"5px"}},dy=q(()=>g("h5",null,"Gender:",-1)),hy={class:"below"},gy={class:"left-column"},fy={class:"Exam"},py=q(()=>g("h4",{style:{"margin-bottom":"5px"}},"Exam",-1)),my=q(()=>g("h5",{style:{height:"15px"}},"RBH number:",-1)),vy=q(()=>g("h5",{style:{height:"15px"}},"Protocol:",-1)),yy=q(()=>g("h5",{style:{height:"15px"}},"Date:",-1)),wy=q(()=>g("h5",{style:{height:"15px"}},"Time:",-1)),Sy={class:"Scan"},_y=q(()=>g("h4",{style:{"margin-bottom":"5px"}},"Scan",-1)),Cy=q(()=>g("h5",null,"Complete Data:",-1)),by=q(()=>g("h5",null,"Image Quality:",-1)),Ty={class:"Technologist"},Iy=q(()=>g("h4",{style:{"margin-bottom":"10px"}},"Analytical Team",-1)),Ry=q(()=>g("h5",{style:{height:"15px"}},"Reader:",-1)),xy=q(()=>g("h5",{style:{height:"15px"}},"Verified by:",-1)),Dy={class:"Scanner"},Ey=q(()=>g("h4",{style:{"margin-bottom":"10px"}},"Scanner",-1)),Ly=q(()=>g("h5",{style:{height:"15px"}},"System:",-1)),Oy=q(()=>g("h5",{style:{height:"15px"}},"Field Strength:",-1)),Vy=q(()=>g("h5",{style:{height:"15px"}},"Software Version:",-1)),Py={class:"Scanner"},ky=q(()=>g("div",null,[g("h5",{style:{width:"150px","font-style":"italic"}}," For research use only. ")],-1)),My={class:"right-column"},By={class:"summary"},Ay=q(()=>g("h4",{style:{height:"15px"}},"SUMMARY",-1)),Fy={class:"detailed-report"},Ny={class:"overview"},$y=q(()=>g("div",{class:"labels"},[g("br"),g("h5",{style:{width:"120px"}},"Heart Rate"),g("h5",{style:{width:"120px"}},"Normal Range")],-1)),Uy={class:"baselinevals"},Hy=q(()=>g("h5",{style:{color:"#5e5d6c"}},"BASELINE",-1)),Wy={class:"hyperventvals"},zy=q(()=>g("h5",{style:{color:"#5e5d6c"}},"HV",-1)),jy={class:"BHvals"},Gy=q(()=>g("h5",{style:{color:"#5e5d6c",width:"90px"}},"BH @ 30 SEC",-1)),Xy={class:"baselinevals"},qy=q(()=>g("h5",{style:{color:"#5e5d6c"}},"Δ HR",-1)),Yy={class:"overview_middle"},Ky={class:"col"},Qy=q(()=>g("h4",null,"VASCULAR",-1)),Jy={class:"vals"},Zy={class:"valuesOCG",style:{"padding-left":"10px","padding-top":"10px"}},ew=q(()=>g("h6",{style:{"margin-bottom":"10px","padding-left":"5px"}}," B-MORE ",-1)),tw={style:{display:"flex",position:"relative"}},nw={style:{position:"absolute",left:"80px",width:"190px"}},ow={style:{"margin-left":"25px"}},iw={class:"col",style:{"margin-left":"2%"}},aw=q(()=>g("h4",null,"STRAIN",-1)),sw={class:"vals"},rw={class:"valuesSTRAIN"},lw=q(()=>g("div",{class:"strain-containter"},[g("h6",null,"B-MORE"),g("h5",null,"Global"),g("h5",null,"LAD"),g("h5",null,"LCX"),g("h5",null,"RCA")],-1)),cw={class:"strain-containter"},uw=q(()=>g("h6",null,"BASELINE",-1)),dw={class:"strain-containter"},hw=q(()=>g("h6",{style:{"padding-left":"8%"}},"HV",-1)),gw={class:"strain-containter"},fw=q(()=>g("h6",null,"BH @ 30 SEC",-1)),pw={class:"overview_graphs"},mw={style:{display:"flex","flex-direction":"column","align-items":"center",width:"278px"}},vw=q(()=>g("h4",{style:{color:"black"}},"Oxygen Sensitive Map",-1)),yw={class:"strainmaps"},ww=q(()=>g("h4",{style:{color:"black"}},"STRAIN MAPS",-1)),Sw={class:"territorymaps",ref:"territorymapimg"},_w={style:{"margin-right":"auto","background-color":"#8f8f8f3b",width:"90px",padding:"2px","padding-left":"5px","border-radius":"10px"}},Cw=q(()=>g("div",{class:"mapnames"},[g("h5",null,"BASELINE"),g("h5",null,"HYPER-VENTILATION"),g("h5",null,[H(" BREATH-HOLD "),g("br"),H(" (30 sec) ")])],-1));function bw(e,t,n,a,o,i){const s=P("ReportTextBox"),r=P("ReportLogoHolder"),l=P("ReportDropDown"),c=P("ReportTextBoxMultiple"),u=P("ReportImageContainer"),d=P("ReportStrainMaps");return R(),E("div",oy,[g("div",iy,[g("div",ay,[y(s,{id:"reportTitle",editable:n.editable,propValue:o.OS_REPORT_VALUES.reportTitle,onUpdateValue:i.handleUpdateValues,style:{width:"450px",color:"#000000","font-weight":"bold","font-size":"30px",height:"40px",padding:"0%"}},null,8,["editable","propValue","onUpdateValue"]),g("div",sy,[y(r,{editable:n.editable,onImageUpdated:i.handleLogoUpdate},null,8,["editable","onImageUpdated"])],512)]),g("div",ry,[ly,y(s,{id:"patientName",editable:n.editable,propValue:o.OS_REPORT_VALUES.patientName,onUpdateValue:i.handleUpdateValues,style:{width:"650px",color:"#229ed7","font-weight":"500","font-size":"30px",height:"35px",padding:"0%"}},null,8,["editable","propValue","onUpdateValue"])]),g("div",cy,[g("div",uy,[dy,y(l,{editable:n.editable,id:"patientGender",options:o.genderOptions,onOptionSelected:i.onOptionSelected},null,8,["editable","options","onOptionSelected"])]),g("div",null,[g("h5",null,[H(" Age: "),y(s,{id:"patientAge",editable:n.editable,propValue:o.OS_REPORT_VALUES.patientAge,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"])])]),g("div",null,[g("h5",null,[H(" DOB: "),y(s,{id:"patientDOB",editable:n.editable,propValue:o.OS_REPORT_VALUES.patientDOB,onUpdateValue:i.handleUpdateValues,style:{width:"120px"}},null,8,["editable","propValue","onUpdateValue"])])]),g("div",null,[g("h5",null,[H(" Patient ID: "),y(s,{id:"patientID",editable:n.editable,propValue:o.OS_REPORT_VALUES.patientID,onUpdateValue:i.handleUpdateValues,style:{width:"110px"}},null,8,["editable","propValue","onUpdateValue"])])])]),g("div",hy,[g("div",gy,[g("div",fy,[py,my,y(s,{id:"rbhNumber",editable:n.editable,propValue:o.OS_REPORT_VALUES.rbhNumber,onUpdateValue:i.handleUpdateValues,style:{width:"110px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"]),vy,y(s,{id:"protocol",editable:n.editable,propValue:o.OS_REPORT_VALUES.protocol,onUpdateValue:i.handleUpdateValues,style:{width:"110px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"]),yy,y(s,{id:"scanDate",editable:n.editable,propValue:o.OS_REPORT_VALUES.scanDate,onUpdateValue:i.handleUpdateValues,style:{width:"110px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"]),wy,y(s,{id:"scanTime",editable:n.editable,propValue:o.OS_REPORT_VALUES.scanTime,onUpdateValue:i.handleUpdateValues,style:{width:"110px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"])]),g("div",Sy,[_y,Cy,y(l,{id:"completeData",editable:n.editable,options:o.completeDataOptions,onOptionSelected:i.onOptionSelected},null,8,["editable","options","onOptionSelected"]),by,y(l,{id:"imageQuality",editable:n.editable,options:o.imageQualityOptions,onOptionSelected:i.onOptionSelected},null,8,["editable","options","onOptionSelected"])]),g("div",Ty,[Iy,Ry,y(s,{id:"reader",editable:n.editable,propValue:o.OS_REPORT_VALUES.reader,onUpdateValue:i.handleUpdateValues,style:{width:"150px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"]),xy,y(s,{id:"verifier",editable:n.editable,propValue:o.OS_REPORT_VALUES.verifier,onUpdateValue:i.handleUpdateValues,style:{width:"150px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"])]),g("div",Dy,[Ey,Ly,y(s,{id:"scannerSystem",editable:n.editable,propValue:o.OS_REPORT_VALUES.scannerSystem,onUpdateValue:i.handleUpdateValues,style:{width:"150px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"]),Oy,y(s,{id:"fieldStrength",editable:n.editable,propValue:o.OS_REPORT_VALUES.fieldStrength,onUpdateValue:i.handleUpdateValues,style:{width:"100px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"]),Vy,y(s,{id:"softwareVersion",editable:n.editable,propValue:o.OS_REPORT_VALUES.softwareVersion,onUpdateValue:i.handleUpdateValues,style:{width:"100px","padding-left":"0px"}},null,8,["editable","propValue","onUpdateValue"])]),g("div",Py,[y(c,{id:"starClaimer",editable:n.editable,propValue:o.OS_REPORT_VALUES.starClaimer,onUpdateValue:i.handleUpdateValues,style:{width:"170px",height:"120px",padding:"0px","padding-top":"5px","font-style":"italic"}},null,8,["editable","propValue","onUpdateValue"])]),ky]),g("div",My,[g("div",By,[Ay,y(c,{id:"summary",editable:n.editable,propValue:o.OS_REPORT_VALUES.summary,placeholder:"Type Summary Here...",onUpdateValue:i.handleUpdateValues,style:{width:"100%",padding:"10px 10px",height:"190px","font-size":"14px",color:"black","background-color":"#f8f8f8"}},null,8,["editable","propValue","onUpdateValue"])]),g("div",Fy,[g("div",Ny,[$y,g("div",Uy,[Hy,y(s,{id:"heartRateBaseline",editable:n.editable,propValue:o.OS_REPORT_VALUES.heartRateBaseline,onUpdateValue:i.handleUpdateValues,style:{width:"60px","padding-left":"0px","font-size":"14px"}},null,8,["editable","propValue","onUpdateValue"])]),g("div",Wy,[zy,y(s,{id:"heartRateHV",editable:n.editable,propValue:o.OS_REPORT_VALUES.heartRateHV,onUpdateValue:i.handleUpdateValues,style:{width:"60px","padding-left":"0px","font-size":"14px"}},null,8,["editable","propValue","onUpdateValue"])]),g("div",jy,[Gy,y(s,{id:"heartRateBH",editable:n.editable,propValue:o.OS_REPORT_VALUES.heartRateBH,onUpdateValue:i.handleUpdateValues,style:{width:"60px","padding-left":"0px","font-size":"14px"}},null,8,["editable","propValue","onUpdateValue"])]),g("div",Xy,[qy,y(s,{id:"dtheartrate",editable:n.editable,propValue:o.OS_REPORT_VALUES.dtheartrate,onUpdateValue:i.handleUpdateValues,style:{width:"60px","padding-left":"0px","font-size":"14px"}},null,8,["editable","propValue","onUpdateValue"]),y(s,{id:"dtheartrateNormalRange",editable:n.editable,propValue:o.OS_REPORT_VALUES.dtheartrateNormalRange,onUpdateValue:i.handleUpdateValues,style:{width:"60px","padding-left":"0px","font-size":"14px"}},null,8,["editable","propValue","onUpdateValue"])])]),g("div",Yy,[g("div",Ky,[Qy,g("div",Jy,[g("div",Zy,[ew,g("div",tw,[g("h5",null,[H(" Global "),y(s,{id:"vascularGlobal",editable:n.editable,propValue:o.OS_REPORT_VALUES.vascularGlobal,onUpdateValue:i.handleUpdateValues,style:{"margin-left":"12px","padding-left":"4%"}},null,8,["editable","propValue","onUpdateValue"])]),g("div",nw,[g("h5",ow,[H(" *Normal Range: "),y(s,{id:"normalRangeVascular",editable:n.editable,propValue:o.OS_REPORT_VALUES.normalRangeVascular,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"])])])]),g("h5",null,[H(" LAD "),y(s,{id:"vascularLAD",editable:n.editable,propValue:o.OS_REPORT_VALUES.vascularLAD,onUpdateValue:i.handleUpdateValues,style:{"margin-left":"24.5px"}},null,8,["editable","propValue","onUpdateValue"])]),g("h5",null,[H(" LCX "),y(s,{id:"vascularLCX",editable:n.editable,propValue:o.OS_REPORT_VALUES.vascularLCX,onUpdateValue:i.handleUpdateValues,style:{"margin-left":"25.5px"}},null,8,["editable","propValue","onUpdateValue"])]),g("h5",null,[H(" RCA "),y(s,{id:"vascularRCA",editable:n.editable,propValue:o.OS_REPORT_VALUES.vascularRCA,onUpdateValue:i.handleUpdateValues,style:{"margin-left":"23px"}},null,8,["editable","propValue","onUpdateValue"])])])]),y(u,{id:"vascularImage",ref:"vascularImage",editable:n.editable,"add-bar":"./images/bar.png",onScreenshotCaptured:i.handleImageScreenshot},null,8,["editable","add-bar","onScreenshotCaptured"])]),g("div",iw,[aw,g("div",sw,[g("div",rw,[lw,g("div",cw,[uw,y(s,{id:"strainGLOBALBaseline",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainGLOBALBaseline,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),y(s,{id:"strainLADBaseline",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainLADBaseline,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),y(s,{id:"strainLCXBaseline",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainLCXBaseline,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),y(s,{id:"strainRCABaseline",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainRCABaseline,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"])]),g("div",dw,[hw,y(s,{id:"strainGLOBALHV",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainGLOBALHV,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),y(s,{id:"strainLADHV",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainLADHV,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),y(s,{id:"strainLCXHV",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainLCXHV,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),y(s,{id:"strainRCAHV",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainRCAHV,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"])]),g("div",gw,[fw,y(s,{id:"strainGLOBALBH",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainGLOBALBH,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),y(s,{id:"strainLADBH",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainLADBH,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),y(s,{id:"strainLCXBH",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainLCXBH,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"]),y(s,{id:"strainRCABH",editable:n.editable,propValue:o.OS_REPORT_VALUES.strainRCABH,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"])])])]),y(u,{id:"strainImage",ref:"strainImage",editable:n.editable,onScreenshotCaptured:i.handleImageScreenshot},null,8,["editable","onScreenshotCaptured"])])]),g("div",pw,[g("div",mw,[vw,y(u,{id:"oxygenSensitiveMap",ref:"oxygenSensitiveMap",editable:n.editable,width:150,height:150,canvasText:"Upload OS-Map",onScreenshotCaptured:i.handleImageScreenshot},null,8,["editable","onScreenshotCaptured"])]),g("div",yw,[ww,g("div",Sw,[y(d,{id:"strainMapBaseline",values:[o.OS_REPORT_VALUES.strainLADBaseline,o.OS_REPORT_VALUES.strainLCXBaseline,o.OS_REPORT_VALUES.strainRCABaseline]},null,8,["values"]),y(d,{id:"strainMapHV",values:[o.OS_REPORT_VALUES.strainLADHV,o.OS_REPORT_VALUES.strainLCXHV,o.OS_REPORT_VALUES.strainRCAHV]},null,8,["values"]),y(d,{id:"strainMapBH",values:[o.OS_REPORT_VALUES.strainLADBH,o.OS_REPORT_VALUES.strainLCXBH,o.OS_REPORT_VALUES.strainRCABH]},null,8,["values"])],512),g("div",null,[g("p",_w,[H(" Normal Range: "),y(s,{id:"normalRange",editable:n.editable,propValue:o.OS_REPORT_VALUES.normalRange,onUpdateValue:i.handleUpdateValues},null,8,["editable","propValue","onUpdateValue"])])]),Cw])])])])])])])}const Tw=A(ny,[["render",bw],["__scopeId","data-v-d503f07e"]]);const Iw={components:{Report:Tw},methods:{printReport(){this.$refs.editablereport.buildPDF()},handleEdit(){this.edit=!this.edit},handleSave(){this.edit?(this.showPopup=!0,setTimeout(()=>{this.showPopup=!1},3e3)):this.$refs.editablereport.downloadReport()}},data(){return{edit:!0,showPopup:!1}}},on=e=>(le("data-v-d6cad36d"),e=e(),ce(),e),Rw={class:"reportcontainermain"},xw={class:"reporthere"},Dw={class:"toolbar"},Ew=on(()=>g("h1",null,"Edit",-1)),Lw=[Ew],Ow=on(()=>g("button",{class:"tool"},[g("h1",null,"Share")],-1)),Vw=on(()=>g("h1",null,"Print",-1)),Pw=[Vw],kw={style:{position:"relative"}},Mw=on(()=>g("h1",null,"Save",-1)),Bw=[Mw],Aw=on(()=>g("h5",null,"Please stop editing first.",-1)),Fw=[Aw];function Nw(e,t,n,a,o,i){const s=P("Report");return R(),E("div",Rw,[g("div",xw,[y(s,{ref:"editablereport",editable:o.edit},null,8,["editable"])]),g("div",Dw,[g("button",{class:N(["tool",{clicked:o.edit}]),onClick:t[0]||(t[0]=(...r)=>i.handleEdit&&i.handleEdit(...r))},Lw,2),Ow,g("button",{class:"tool",onClick:t[1]||(t[1]=(...r)=>i.printReport&&i.printReport(...r))},Pw),g("div",kw,[g("button",{class:"tool",onClick:t[2]||(t[2]=(...r)=>i.handleSave&&i.handleSave(...r))},Bw),g("div",{class:N(["popup",{show:o.showPopup}])},Fw,2)])])])}const $w=A(Iw,[["render",Nw],["__scopeId","data-v-d6cad36d"]]);const Uw={props:{dataToGraph:{type:Array}},watch:{dataToGraph:{deep:!0,handler(){this.drawLines()}}},data(){return{canvasId:"myCanvas",minX:0,minY:0,maxX:15,maxY:1,unitsPerTickX:5,unitsPerTickY:.25,title:"Normalized SI (RV-LV)",padding:15,tickSize:.1,axisColor:"white",pointRadius:1,font:"10pt Arial",fontHeight:10,rangeX:null,rangeY:null,numXTicks:null,numYTicks:null,x:null,y:null,width:null,height:null,scaleX:null,scaleY:null,context:null,data:null}},methods:{drawSysDias(e,t){const n=e;n.save(),n.translate(this.x,this.y+this.height),n.font="12px Arial",n.fillStyle="white",n.fillText("Systole",0*this.scaleX,0-(this.height+this.padding));const a=n.createLinearGradient(t*this.scaleX,0,this.maxX*this.scaleX-50,0);a.addColorStop(0,"rgba(38, 151, 192, 0.25)"),a.addColorStop(1,"#686F7100"),n.fillStyle=a,n.fillRect(t*this.scaleX,0,this.maxX*this.scaleX,0-(this.height+2*this.padding)),n.strokeStyle="white",n.lineWidth=1,n.beginPath(),n.moveTo(t*this.scaleX,0),n.lineTo(t*this.scaleX,0-(this.height+2*this.padding)),n.stroke(),n.fillStyle="white",n.fillText("Diastole",t*this.scaleX+5,0-(this.height+this.padding)),n.restore()},getLongestValueWidth(e){let t=0;const n=e;n.font=this.font;for(let a=0;a<=this.numYTicks;a++){const o=this.maxY-a*this.unitsPerTickY;t=Math.max(t,n.measureText(o).width)}return t},drawXAxis(e){const t=e;t.save(),t.beginPath(),t.moveTo(this.x,this.y+this.height),t.strokeStyle=this.axisColor,t.lineWidth=1,t.stroke(),t.font=this.font,t.fillStyle="white",t.textAlign="center",t.textBaseline="middle";for(let n=-1;n<this.numXTicks;n++){const a=Math.round((n+1)*this.maxX/this.numXTicks);t.save(),t.translate((n+1)*this.width/this.numXTicks+this.x,this.y+this.height+this.padding),t.fillText(a,0,0),t.restore()}t.restore()},drawYAxis(e){const t=e;t.save(),t.save(),t.beginPath(),t.moveTo(this.x,this.y),t.strokeStyle=this.axisColor,t.stroke(),t.restore(),t.font=this.font,t.fillStyle="white",t.textAlign="right",t.textBaseline="middle";for(let n=0;n<=this.numYTicks;n++){const a=this.maxY-n*this.maxY/this.numYTicks;t.save(),t.translate(this.x-this.padding+5,n*this.height/this.numYTicks+this.y),t.fillText(a,0,0),t.restore()}t.restore()},drawLine(e,t,n,a){const o=e;o.save(),this.transformContext(o),o.lineWidth=a,o.strokeStyle=n,o.fillStyle=n,o.shadowBlur=10,o.shadowColor=n,o.beginPath(),o.moveTo(t[0].x*this.scaleX,t[0].y*this.scaleY);for(let i=0;i<t.length;i++){const s=t[i];o.lineTo(s.x*this.scaleX,s.y*this.scaleY),o.stroke(),o.closePath(),o.beginPath(),o.arc(s.x*this.scaleX,s.y*this.scaleY,this.pointRadius,0,2*Math.PI,!1),o.fill(),o.closePath(),o.beginPath(),o.moveTo(s.x*this.scaleX,s.y*this.scaleY)}o.restore()},transformContext(e){e.translate(this.x,this.y+this.height),e.scale(1,-1)},generateRandomData(e){const t=[];for(let n=0;n<=e;n++){const a=n*1,o=Math.random();t.push({x:a,y:o})}return t},drawLines(){const{context:e}=this;e.clearRect(0+this.padding,this.y-2*this.padding,this.width+4*this.padding,this.height+4*this.padding);const t=["#a2191a","#105a93","#1f7c55"];for(let n=0;n<this.dataToGraph.length;n++)this.dataToGraph[n]===1&&this.drawLine(e,this.data[n],t[n],2);this.drawSysDias(e,7.5),this.drawXAxis(e),this.drawYAxis(e)}},mounted(){const{canvas:e}=this.$refs,t=e.getContext("2d");this.x=this.getLongestValueWidth(t)+this.padding*2+25,this.context=t,this.y=this.padding*2,this.width=e.width-this.x-this.padding*2,this.height=e.height-this.y-this.padding-this.fontHeight,this.rangeX=this.maxX-this.minY,this.scaleX=this.width/this.rangeX,this.rangeY=this.maxY-this.minY,this.scaleY=this.height/this.rangeY,this.numXTicks=Math.round(this.rangeX/this.unitsPerTickX),this.numYTicks=Math.round(this.rangeY/this.unitsPerTickY),this.drawXAxis(t),this.drawYAxis(t),t.save(),t.translate(10,this.height/1.5),t.rotate(270*Math.PI/180),t.font="12px Arial",t.fillStyle="white",t.textAlign="center",t.textBaseline="middle",t.fillText(this.title,0,0),t.restore(),this.drawSysDias(t,7.5);const n=[this.generateRandomData(15),this.generateRandomData(15),this.generateRandomData(15)];this.data=n,this.drawLines()}},Hw={ref:"canvas",width:"411",height:"206",style:{}};function Ww(e,t,n,a,o,i){return R(),E("div",null,[g("canvas",Hw,null,512)])}const zw=A(Uw,[["render",Ww],["__scopeId","data-v-01332437"]]),jw={props:{id:{type:Number,required:!0}},data(){return{sectionOpacities:[.7,.7,.7],hoveredSection:-1,outerradius:60}},mounted(){this.createChart()},methods:{createChart(){const e=this.$refs.chartCanvas,t=e.getContext("2d"),n=e.width/2-85,a=e.height/2,o=this.outerradius,i=o/3;t.clearRect(0,0,e.width,e.height),e.addEventListener("click",this.handleChartClick),e.addEventListener("mousemove",this.handleChartHover),e.addEventListener("mouseleave",this.handleChartLeave),e.addEventListener("dblclick",this.handleChartDoubleClick);const s=["#a2191a","#105a93","#1f7c55"],r=[1,1,1],l=r.reduce((u,d)=>u+d,0);let c=0;r.forEach((u,d)=>{const h=u/l*Math.PI*2,v=c+h;t.beginPath(),t.moveTo(n+o*Math.cos(c),a+o*Math.sin(c)),t.arc(n,a,o,c,v),t.arc(n,a,i,v,c,!0),t.closePath();const p=this.hoveredSection===d?this.sectionOpacities[d]+.3:this.sectionOpacities[d];t.globalAlpha=p,t.fillStyle=s[d],t.fill(),t.globalAlpha=1,t.strokeStyle="#ffffff",t.lineWidth=2,t.stroke(),c=v}),t.beginPath(),t.arc(n,a,o,0,Math.PI*2),t.strokeStyle="#ffffff",t.lineWidth=1,t.stroke(),t.beginPath(),t.arc(n,a,i,0,Math.PI*2),t.strokeStyle="#ffffff",t.lineWidth=1,t.stroke()},handleChartClick(e){const t=this.$refs.chartCanvas,n=t.getBoundingClientRect(),a=e.clientX-n.left,o=e.clientY-n.top,i=t.width/2-85,s=t.height/2,r=this.outerradius,l=r/3,c=Math.sqrt((a-i)**2+(o-s)**2);if(c<l)this.sectionOpacities=[.7,.7,.7];else{if(c>=r)return;{const u=Math.atan2(o-s,a-i),d=u>=0?u:u+Math.PI*2,h=Math.floor(d/(Math.PI*2)*3);this.sectionOpacities[h]=this.sectionOpacities[h]===.7?.2:.7}}this.createChart(),this.$emit("segment-updated",this.id,this.sectionOpacities)},handleChartDoubleClick(e){const t=this.$refs.chartCanvas,n=t.getBoundingClientRect(),a=e.clientX-n.left,o=e.clientY-n.top,i=t.width/2-85,s=t.height/2,r=this.outerradius,l=r/3,c=Math.sqrt((a-i)**2+(o-s)**2);if(c<l)this.sectionOpacities=[.7,.7,.7];else{if(c>=r)return;{const u=Math.atan2(o-s,a-i),d=u>=0?u:u+Math.PI*2,h=Math.floor(d/(Math.PI*2)*3);this.sectionOpacities=[.2,.2,.2],this.sectionOpacities[h]=.7}}this.createChart(),this.$emit("segment-updated",this.id,this.sectionOpacities)},handleChartHover(e){const t=this.$refs.chartCanvas,n=t.getBoundingClientRect(),a=e.clientX-n.left,o=e.clientY-n.top,i=t.width/2-85,s=t.height/2,r=this.outerradius,l=r/3,c=Math.sqrt((a-i)**2+(o-s)**2);if(c<l)this.hoveredSection=-1;else if(c>=r){this.handleChartLeave();return}else{const u=Math.atan2(o-s,a-i),d=u>=0?u:u+Math.PI*2,h=Math.floor(d/(Math.PI*2)*3);this.hoveredSection=h}this.createChart()},handleChartLeave(){this.hoveredSection=-1,this.createChart()}}},Gw={ref:"chartCanvas"};function Xw(e,t,n,a,o,i){return R(),E("div",null,[g("canvas",Gw,null,512)])}const qw=A(jw,[["render",Xw]]);const Yw={props:{label:{type:String,default:"Territory Min"},textOpacity:{type:Number,default:1}},updated(){},data(){return{setTextOpacity:this.textOpacity}},methods:{handleMouseEnter(){this.setTextOpacity+=.3},handleMouseLeave(){this.setTextOpacity-=.3},handleClick(){this.$emit("biomarker-click",this.label)}}};function Kw(e,t,n,a,o,i){return R(),E("div",null,[g("h4",{onMouseenter:t[0]||(t[0]=(...s)=>i.handleMouseEnter&&i.handleMouseEnter(...s)),onFocusin:t[1]||(t[1]=(...s)=>i.handleMouseEnter&&i.handleMouseEnter(...s)),onMouseleave:t[2]||(t[2]=(...s)=>i.handleMouseLeave&&i.handleMouseLeave(...s)),onFocusout:t[3]||(t[3]=(...s)=>i.handleMouseLeave&&i.handleMouseLeave(...s)),onClick:t[4]||(t[4]=(...s)=>i.handleClick&&i.handleClick(...s)),style:ie({opacity:o.setTextOpacity}),onKeydown:t[5]||(t[5]=Pe(oe((...s)=>e.handleKeyDown&&e.handleKeyDown(...s),["prevent"]),["space"]))},U(n.label),37)])}const Qw=A(Yw,[["render",Kw],["__scopeId","data-v-65722d25"]]);const Jw={components:{SimpleGraph:zw,TerritoriesSegments:qw,GraphTerritories:Qw},data(){return{canGraph:[{id:1,allowed:[1,1,1]},{id:2,allowed:[1,1,1]},{id:3,allowed:[1,1,1]}],itemHeight:510,showComponent:[1,1,1],territoryGraphs:[{id:1,title:"Territory Min",opacity:.3},{id:2,title:"Territory Absolute Velocity",opacity:.3},{id:3,title:"Territory Median",opacity:.3},{id:4,title:"Sector Median",opacity:.3},{id:5,title:"Sector Max",opacity:.3},{id:6,title:"Sector Min",opacity:.3}]}},methods:{handleSegmentUpdate(e,t){for(let n=0;n<3;n++)this.canGraph[e-1].allowed[n]=t[n]>.5},scrollX(e,t){const n=`scrollContainer${t}`;this.$refs[n].scrollLeft+=e.deltaY/10},handleToggleMarker(e){console.log(e),this.showComponent[e]=!1,this.showComponent[e]=!0}}},wo=e=>(le("data-v-e71c7254"),e=e(),ce(),e),Zw={class:"biomarkerviewer"},eS={class:"biomarkercomponent"},tS={class:"graphs"},nS=wo(()=>g("div",{class:"headertitle"},[g("h2",null,"ANALYSIS")],-1)),oS={class:"content"},iS={class:"left"},aS={class:"right"},sS={key:0},rS={class:"biomarkercomponent"},lS={class:"graphs"},cS=wo(()=>g("h2",null,"ANALYSIS",-1)),uS={class:"content"},dS={class:"left"},hS={class:"right"},gS={key:0},fS={class:"biomarkercomponent"},pS={class:"graphs"},mS=wo(()=>g("h2",null,"ANALYSIS",-1)),vS={class:"content"},yS={class:"left"},wS={class:"right"},SS={key:0};function _S(e,t,n,a,o,i){const s=P("ScreenTemp"),r=P("GraphTerritories"),l=P("TerritoriesSegments"),c=P("SimpleGraph");return R(),E("div",Zw,[g("div",eS,[g("div",{class:"screen1",style:ie({height:o.itemHeight+"px"})},[y(s)],4),g("div",tS,[nS,g("div",{class:"territoryGraphs",ref:"scrollContainer0",onMousewheel:t[1]||(t[1]=u=>i.scrollX(u,0))},[(R(!0),E(ue,null,Be(o.territoryGraphs,u=>(R(),E("div",{key:u.id},[y(r,{id:u.id,label:u.title,textOpacity:u.opacity,onBiomarkerClick:t[0]||(t[0]=d=>i.handleToggleMarker(0))},null,8,["id","label","textOpacity"])]))),128))],544),g("div",oS,[g("div",iS,[y(l,{id:1,onSegmentUpdated:i.handleSegmentUpdate},null,8,["onSegmentUpdated"])]),g("div",aS,[y(He,{name:"fade"},{default:x(()=>[o.showComponent[0]?(R(),E("div",sS,[y(c,{dataToGraph:o.canGraph[0].allowed},null,8,["dataToGraph"])])):j("",!0)]),_:1})])])])]),g("div",rS,[g("div",{class:"screen1",style:ie({height:o.itemHeight+"px"})},[y(s)],4),g("div",lS,[cS,g("div",{class:"territoryGraphs",ref:"scrollContainer1",onMousewheel:t[3]||(t[3]=u=>i.scrollX(u,1))},[(R(!0),E(ue,null,Be(o.territoryGraphs,u=>(R(),E("div",{key:u.id},[y(r,{id:u.id,label:u.title,textOpacity:u.opacity,onBiomarkerClick:t[2]||(t[2]=d=>i.handleToggleMarker(1))},null,8,["id","label","textOpacity"])]))),128))],544),g("div",uS,[g("div",dS,[y(l,{id:2,onSegmentUpdated:i.handleSegmentUpdate},null,8,["onSegmentUpdated"])]),g("div",hS,[y(He,{name:"fade"},{default:x(()=>[o.showComponent[1]?(R(),E("div",gS,[y(c,{dataToGraph:o.canGraph[1].allowed},null,8,["dataToGraph"])])):j("",!0)]),_:1})])])])]),g("div",fS,[g("div",{class:"screen1",style:ie({height:o.itemHeight+"px"})},[y(s)],4),g("div",pS,[mS,g("div",{class:"territoryGraphs",ref:"scrollContainer2",onMousewheel:t[5]||(t[5]=u=>i.scrollX(u,2))},[(R(!0),E(ue,null,Be(o.territoryGraphs,u=>(R(),E("div",{key:u.id},[y(r,{label:u.title,textOpacity:u.opacity,onBiomarkerClick:t[4]||(t[4]=d=>i.handleToggleMarker(2))},null,8,["label","textOpacity"])]))),128))],544),g("div",vS,[g("div",yS,[y(l,{id:3,onSegmentUpdated:i.handleSegmentUpdate},null,8,["onSegmentUpdated"])]),g("div",wS,[y(He,{name:"fade"},{default:x(()=>[o.showComponent[2]?(R(),E("div",SS,[y(c,{dataToGraph:o.canGraph[2].allowed},null,8,["dataToGraph"])])):j("",!0)]),_:1})])])])])])}const CS=A(Jw,[["render",_S],["__scopeId","data-v-e71c7254"]]);const bS={components:{PatientHeaderInfo:Nv,AnalysisNavigationBar:o0,VtkTwoView:hs,QualityCheck:r1,ReportMaker:$w,GraphicalAnalysis:CS},data(){return{container:"container",currentComponent:"QualityCheck"}},methods:{getTimeOfDay(){const e=new Date().getHours();return e>=5&&e<12?"Morning":e>=12&&e<18?"Afternoon":e>=18&&e<23?"Evening":"Day"},handleToolSelected(e){e==="ReportMaker"?this.currentComponent="ReportMaker":e==="QualityCheck"?this.currentComponent="QualityCheck":e==="GraphicalAnalysis"&&(this.currentComponent="GraphicalAnalysis"),window.localStorage.setItem("currentView",this.currentComponent)},handleUpdateQualityCheck(e){e?this.$refs.mainAnalysisComponent.toggleComponent("CheckContours"):this.$refs.mainAnalysisComponent.toggleComponent("CheckBreathingSplits")}},created(){this.timeofday=this.getTimeOfDay(),this.container=`${this.container} ${this.timeofday.toLowerCase()}`},mounted(){this.currentComponent=window.localStorage.getItem("currentView")}},ms=e=>(le("data-v-a9c51548"),e=e(),ce(),e),TS=ms(()=>g("div",{class:"mobile-overlay"},[g("div",{class:"warning"},[g("h2",null,[H(" It appears that you are trying to use our app on a screen size of less than 1200 px wide. "),g("br"),H(" Currently our app is limited to larger devices. Please try on a larger laptop. ")])])],-1)),IS={class:"body"},RS={class:"navigationBar"},xS={class:"header-main"},DS={class:"header"},ES={class:"main"},LS=ms(()=>g("h5",{style:{"margin-left":"auto",color:"grey"}}," Area 19 OCG Prototype V.0.1 ",-1));function OS(e,t,n,a,o,i){const s=P("AnalysisNavigationBar"),r=P("PatientHeaderInfo");return R(),E(ue,null,[TS,g("div",{class:N(o.container)},[g("div",IS,[g("div",RS,[y(s,{onToolSelected:i.handleToolSelected},null,8,["onToolSelected"])]),g("div",xS,[g("div",DS,[y(r,{activeComponent:o.currentComponent,onUpdatequalitycheck:i.handleUpdateQualityCheck},null,8,["activeComponent","onUpdatequalitycheck"])]),g("div",ES,[y(He,{name:"fade"},{default:x(()=>[(R(),K(_i(o.currentComponent),{ref:"mainAnalysisComponent"},null,512))]),_:1})]),LS])])],2)],64)}const VS=A(bS,[["render",OS],["__scopeId","data-v-a9c51548"]]),PS=[{path:"/",redirect:"/login"},{path:"/login",name:"Login",component:Cc},{path:"/home",name:"Home",component:dv},{path:"/analysis",name:"Analysis",component:VS}],kS=cr({history:ur(),routes:PS});rc();Yt.setResolveCoincidentTopologyToPolygonOffset();Yt.setResolveCoincidentTopologyPolygonOffsetParameters(-3,-3);Yt.setResolveCoincidentTopologyLineOffsetParameters(-3,-3);Ai.setResolveCoincidentTopologyToPolygonOffset();Ai.setResolveCoincidentTopologyPolygonOffsetParameters(1,1);xl(Hn);const vs=al.newInstance({proxyConfiguration:zl}),ys=new Fi;ys.initialize();const ws=dr();ws.use(ac({proxies:new sc(vs),dicomIO:ys}));const ut=hr(ll);cc(ut);ut.provide("ProxyManager",vs);ut.use(ws);ut.use(gr);ut.use(br);ut.use(fr,{smallLaptop:1200,mediumLaptop:1300,largerLaptop:1400,xLargeLaptop:1600,desktop:1900,_4K:2500});ut.use(kS).mount("#app");
//# sourceMappingURL=index-d2de1616.js.map
