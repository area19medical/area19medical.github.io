import{b2 as ne,b3 as Ye,b4 as T,b5 as Ha,a5 as Be,a8 as xt,az as M,ao as _,b6 as Et,b7 as vo,b8 as Dr,b9 as Ar,ba as ct,bb as Tr,bc as kr,bd as Ga,be as Er,an as Me,aI as Rr,aB as K,A as Se,u as Xe,as as B,bf as Ka,bg as Yt,H as qa,bh as He,bi as Bt,E as Vr,n as Mr,Y as Pr,I as Lr,B as $r,al as la,a_ as k,bj as U,bk as y,aD as p,bl as $,bm as j,bn as I,bo as De,aE as wt,bp as Ne,a$ as x,bq as Ge,br as Ue,bs as We,bt as re,aH as ke,aF as Or,ap as Ce,K as ho,aw as z,aq as Y,ay as yo,aA as Rt,bu as G,aL as X,bv as Za,aS as Vt,aW as Mt,bw as F,bx as Ke,aN as se,by as ce,bz as Qa,bA as xr,bB as Br,bC as Fr,bD as Ja,bE as Nr,ah as Ya,V as Ur,bF as Wr,bG as zr,bH as jr,bI as Hr,aG as Gr,bJ as Rn,bK as me,bL as Kr,aY as qr,bM as Zr,aC as Vn,aQ as Xa,bN as eo,L as Qr,aM as es,aR as wo,bO as Jr,bP as Yr,b1 as Mn,bQ as ts,bR as ns,bS as Xr,b0 as os,bT as el,bU as tl,bV as nl,bW as ol,bX as al,bY as sl,bZ as il,b_ as rl,b$ as ca,c0 as ll,c1 as cl,c2 as ul,c3 as dl,c4 as fl,c5 as pl}from"./vendor-1aa231cc.js";import{E as Co,_ as H,V as Z,a as Ee,b as ae,T as Pn,c as It,d as xe,e as we,f as Dt,g as gl,h as as,i as ml,j as ut,k as At,l as Pt,m as oe,n as le,o as ot,p as Ln,q as Oe,r as vl,s as ht,t as Ht,u as dt,v as ft,w as pt,x as dn,y as ss,z as fn,A as Ft,B as is,C as rs,D as hl,F as $n,G as Jt,H as ls,I as cs,J as $t,K as ua,L as yl,M as wl,N as Cl,O as Sl,P as to,Q as da,R as _l,S as bl,U as fa,W as Il,X as pa,Y as Dl,Z as ga,$ as Al,a0 as Tl,a1 as kl,a2 as El}from"./vuetify-c33e2270.js";import{v as Te,I as kn,m as A,a as us,b as Rl,c as ds,d as Vl,e as Ml,f as fs,g as On,V as gt,h as st,i as Pl,j as xn,_ as Ll,k as ps,l as gs,n as $l,o as Ol,p as Bn,q as ms,s as xl,r as vs,t as Bl,u as So,w as mt,x as pn,y as hs,R as ma,z as Fl,A as va,B as ha,C as Nl,D as Ul,E as Wl,F as zl,G as jl,H as Hl,J as Gl,M as ys,K as Kl,L as ws,N as Cs,O as ql,P as Zl,Q as Ql,S as Jl,T as Yl,U as Xl,W as ec,X as tc,Y as nc,Z as oc,$ as ac,a0 as sc,a1 as ic,a2 as rc,a3 as lc,a4 as cc,a5 as uc,a6 as Ss,a7 as dc}from"./vtk.js-b933f752.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function n(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(a){if(a.ep)return;a.ep=!0;const r=n(a);fetch(a.href,r)}})();function fc(e){const t=e.split(/\/+/g);return t.splice(-1,1),t.join("/")}function _s(e){return e.split(/\/+/g).at(-1)??e}function Nt(e){return e.replace(/\/+/g,"/").replace(/\/$/,"")}function Ut(...e){return Nt(e.join("/"))}function bs(e){return e}function Is(){let e=null,t=null;const n=r=>{e&&e(r)},o=r=>{t&&t(r)};return{promise:new Promise((r,s)=>{e=r,t=s}),resolve:n,reject:o}}function yt(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}function Ds(e,t,n){return Math.min(n,Math.max(t,e))}function Xt(e,...t){return t.reduce((n,o)=>({...n,[o]:e[o]}),{})}function Fn(e,t){const n=[[],[]];return t.forEach(o=>{const a=e(o)?0:1;n[a].push(o)}),n}const pc=(e,t,n)=>(e in t||(t[e]=n),t[e]);function _o(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function gc(e,t,n){if(e.length!==t.length)return!1;for(let o=0;o<e.length;o++)if(!n(e[o],t[o]))return!1;return!0}function uo(e){return Array.isArray(e)?e:[e]}function mc(e,t=2){if(!+e)return"0 Bytes";const n=1024,o=t<0?0:t,a=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],r=Math.floor(Math.log(e)/Math.log(n));return`${parseFloat((e/n**r).toFixed(o))} ${a[r]}`}function vc(e,t=Co){const n=Math.round(e);return Math.abs(n-e)<=t?n:e}function hc(e,t){return t in e}function ya(e,t){return Object.fromEntries(Object.entries(e).map(([n,o])=>{if(hc(t,n))return[t[n],o];throw new Error(`Key ${n} not found in keyMap`)}))}const yc=(e,t)=>Object.fromEntries(Object.entries(e).filter(([n])=>!uo(t).includes(n)));function wc(e){return e instanceof Error?e:new Error(JSON.stringify(e))}function Cc(e){return Object.entries(e).reduce((t,[n,o])=>o===void 0?t:{...t,[n]:o},{})}function Sc(e){if(!e)return"#ffffff";const t=document.createElement("canvas").getContext("2d");if(!t)throw new Error("Could not create canvas context");return t.fillStyle=e,t.fillStyle}const wa=0,Wt=ne("id",()=>{let e=wa;return{nextId(){return String(++e)},reset(){e=wa}}}),bo=["Sagittal","Coronal","Axial"];function Ot(){return{Sagittal:0,Coronal:0,Axial:0}}function As(){return{Sagittal:[0,0],Coronal:[0,0],Axial:[0,0]}}function at(e,t,n){const o=2*n[t];return e.slice(o,o+2)}function Le(e){switch(e){case"Superior":case"Inferior":return"Axial";case"Left":case"Right":return"Sagittal";case"Posterior":case"Anterior":return"Coronal";default:throw new Error(`Invalid LPS direction: ${e}`)}}const Ts=()=>({Left:Ye(1,0,0),Right:Ye(-1,0,0),Posterior:Ye(0,1,0),Anterior:Ye(0,-1,0),Superior:Ye(0,0,1),Inferior:Ye(0,0,-1),Sagittal:0,Coronal:1,Axial:2});function ks(e){const t=[0,1,2],n=[0,1,2],o=Ts();for(let a=0;a<3;a++){let r=0,s=[0,0],i=[0,0];t.forEach((g,v)=>{n.forEach((h,w)=>{const D=e[g*3+h];Math.abs(D)>Math.abs(r)&&(r=D,s=[g,h],i=[v,w])})});const[l,c]=s,u=e.slice(l*3,(l+1)*3),d=Math.sign(r),f=u.map(g=>g*d),m=u.map(g=>g*-d);c===0?(o.Left=f,o.Right=m,o.Sagittal=l):c===1?(o.Posterior=f,o.Anterior=m,o.Coronal=l):c===2&&(o.Superior=f,o.Inferior=m,o.Axial=l),t.splice(i[0],1),n.splice(i[1],1)}return o}var ee=(e=>(e.WindowLevel="WindowLevel",e.Pan="Pan",e.Zoom="Zoom",e.Ruler="Ruler",e.Paint="Paint",e.Rectangle="Rectangle",e.Crosshairs="Crosshairs",e.Crop="Crop",e.Contour="Contour",e))(ee||{}),Re=(e=>(e.V="V",e.H="H",e))(Re||{}),Nn=(e=>(e.DICOM="dicom",e.IMAGE="image",e))(Nn||{});const _c=T.nativeEnum(Nn),bc=T.union([T.literal("Left"),T.literal("Right"),T.literal("Posterior"),T.literal("Anterior"),T.literal("Superior"),T.literal("Inferior")]),Ic=T.object({id:T.string(),path:T.string(),type:_c}),Dc=T.object({archiveSrc:T.object({path:T.string()}).optional(),uriSrc:T.object({uri:T.string(),name:T.string()}).optional()}),Es=Dc.extend({parent:T.lazy(()=>Es.optional())}),Ac=T.nativeEnum(Re),Rs=T.lazy(()=>T.object({name:T.string().optional(),direction:Ac,items:T.array(T.union([Rs,T.string()]))})),nt=T.tuple([T.number(),T.number(),T.number()]),Tc=T.object({width:T.number(),level:T.number(),min:T.number(),max:T.number()}),kc=T.object({slice:T.number(),min:T.number(),max:T.number(),axisDirection:bc}),Ec=T.object({parallelScale:T.number().optional(),position:nt.optional(),focalPoint:nt.optional(),directionOfProjection:nt.optional(),viewUp:nt.optional()}),Io=T.object({arrayName:T.string(),location:T.string()}),Rc=T.object({position:T.number(),height:T.number(),width:T.number(),xBias:T.number(),yBias:T.number()}),Vc=T.object({x:T.number(),y:T.number(),midpoint:T.number(),sharpness:T.number()}),Mc=T.object({mode:T.literal(Te.Mode.Gaussians),gaussians:Rc.array(),mappingRange:T.tuple([T.number(),T.number()])}),Pc=T.object({mode:T.literal(Te.Mode.Points),preset:T.string(),shift:T.number(),mappingRange:T.tuple([T.number(),T.number()])}),Lc=T.object({mode:T.literal(Te.Mode.Nodes),nodes:Vc.array(),mappingRange:T.tuple([T.number(),T.number()])}),Do=T.union([Mc,Pc,Lc]),Ao=T.object({preset:T.string(),mappingRange:T.tuple([T.number(),T.number()])});T.object({colorBy:Io,transferFunction:Ao,opacityFunction:Do});const $c=T.object({enabled:T.boolean(),lightFollowsCamera:T.boolean(),volumeQuality:T.number(),useVolumetricScatteringBlending:T.boolean(),volumetricScatteringBlending:T.number(),useLocalAmbientOcclusion:T.boolean(),laoKernelSize:T.number(),laoKernelRadius:T.number(),ambient:T.number(),diffuse:T.number(),specular:T.number()}),Oc=T.object({colorBy:Io,transferFunction:Ao,opacityFunction:Do,cvr:$c}),xc=T.object({opacity:T.number()}),Bc=T.object({colorBy:Io,transferFunction:Ao,opacityFunction:Do,blendConfig:xc}),Fc=T.object({window:Tc.optional(),slice:kc.optional(),layers:Bc.optional(),camera:Ec.optional(),volumeColorConfig:Oc.optional()}),Nc=T.union([T.literal("2D"),T.literal("3D")]),Uc=T.object({id:T.string(),type:Nc,props:T.record(T.any()),config:T.record(Fc)}),Wc=T.object({id:T.string(),parent:T.string(),path:T.string()});T.union([T.literal("Axial"),T.literal("Sagittal"),T.literal("Coronal")]);const zc=T.object({planeOrigin:nt,planeNormal:nt}),jc=T.object({imageID:T.string(),frameOfReference:zc,slice:T.number(),id:T.string(),name:T.string(),color:T.string(),label:T.string().optional(),labelName:T.string().optional()}),Vs=e=>T.object({tools:T.array(e),labels:T.record(e.partial())}),Ms=jc.extend({firstPoint:nt,secondPoint:nt}),Hc=Vs(Ms),Gc=Ms.extend({id:T.string(),fillColor:T.string().optional()}),Kc=Vs(Gc),qc=T.object({position:nt}),Zc=T.nativeEnum(ee),Qc=T.object({activeLabelmapID:T.string().nullable(),brushSize:T.number(),brushValue:T.number(),labelmapOpacity:T.number()}),Jc=T.object({Sagittal:T.tuple([T.number(),T.number()]),Coronal:T.tuple([T.number(),T.number()]),Axial:T.tuple([T.number(),T.number()])}),Yc=T.record(Jc),Xc=T.object({rulers:Hc.optional(),rectangles:Kc.optional(),crosshairs:qc,paint:Qc,crop:Yc,current:Zc}),eu=T.object({selectionKey:T.string(),sourceSelectionKeys:T.string().array()}).array(),tu=T.object({version:T.string(),datasets:Ic.array(),remoteFiles:T.record(Es.array()),labelMaps:Wc.array(),tools:Xc,views:Uc.array(),primarySelection:T.string().optional(),layout:Rs,parentToLayers:eu}),Un=e=>({fileSrc:{file:e,fileType:e.type}}),Ps=(e,t)=>({uriSrc:{uri:e,name:t}}),nu=(e,t)=>({...Un(e),...Ps(t,e.name)});function Ls(e){return!!e.uriSrc||!!e.parent&&Ls(e.parent)}function $s(e){var t;if(e!=null&&e.fileSrc)return e.fileSrc.file.name;if(e!=null&&e.uriSrc)return e.uriSrc.name;if((t=e==null?void 0:e.dicomSrc)!=null&&t.sources.length){const{sources:n}=e.dicomSrc,[o]=n,a=n.length>1?` (+${n.length-1} more)`:"";return`${$s(o)}${a}`}return null}function Os(e){const t={...e};return delete t.fileSrc,t.parent&&(t.parent=Os(t.parent)),t}const bt=ne("files",{state:()=>({byDataID:{}}),getters:{getDataSources:e=>t=>e.byDataID[t]??[],getFiles:e=>t=>(e.byDataID[t]??[]).map(n=>n.fileSrc.file)},actions:{remove(e){e in this.byDataID&&delete this.byDataID[e]},add(e,t){this.byDataID[e]=t}}});async function xs(e,t,n){const o=bt(),{zip:a}=e,{manifest:{datasets:r,remoteFiles:s}}=e;t.forEach(i=>{const l=o.getDataSources(i);if(!l.length)throw new Error(`No files for dataID: ${i}`);const[c,u]=Fn(Ls,l);s[i]=c.map(Os);const d=`data/${i}/`;u.forEach(f=>{const{file:m}=f.fileSrc,g=`${d}/${m.name}`;a.file(g,m)}),r.push({id:i,path:d,type:n})})}const Bs=()=>({name:"(none)",orientation:Ha(),lpsOrientation:Ts(),spacing:Ye(1,1,1),origin:Be(),dimensions:Ye(1,1,1),worldBounds:[0,1,0,1,0,1],worldToIndex:xt(),indexToWorld:xt()}),_e=ne("images",{state:()=>({idList:[],dataIndex:Object.create(null),metadata:Object.create(null)}),actions:{addVTKImageData(e,t){const n=Wt().nextId();return this.idList.push(n),this.dataIndex[n]=t,this.$proxies.addData(n,t),this.metadata[n]={...Bs(),name:e},this.updateData(n,t),n},updateData(e,t){if(e in this.metadata){const n={name:this.metadata[e].name,dimensions:t.getDimensions(),spacing:t.getSpacing(),origin:t.getOrigin(),orientation:t.getDirection(),lpsOrientation:ks(t.getDirection()),worldBounds:t.getBounds(),worldToIndex:t.getWorldToIndex(),indexToWorld:t.getIndexToWorld()};this.metadata[e]=n}this.$proxies.updateData(e,t),this.dataIndex[e]=t},deleteData(e){e in this.dataIndex&&(delete this.dataIndex[e],delete this.metadata[e],yt(this.idList,e))},async serialize(e){const t=bt(),n=this.idList.filter(o=>o in t.byDataID);await xs(e,n,Nn.IMAGE)}}}),Fs="Anonymous",Ns="ANONYMOUS";function ou(e,t){return`${e}!!${t}`}const au=(e,t)=>e.readTags(t,[{name:"PatientName",tag:"0010|0010",strconv:!0},{name:"PatientID",tag:"0010|0020",strconv:!0},{name:"PatientBirthDate",tag:"0010|0030"},{name:"PatientSex",tag:"0010|0040"},{name:"StudyInstanceUID",tag:"0020|000d"},{name:"StudyDate",tag:"0008|0020"},{name:"StudyTime",tag:"0008|0030"},{name:"StudyID",tag:"0020|0010",strconv:!0},{name:"AccessionNumber",tag:"0008|0050"},{name:"StudyDescription",tag:"0008|1030",strconv:!0},{name:"Modality",tag:"0008|0060"},{name:"SeriesInstanceUID",tag:"0020|000e"},{name:"SeriesNumber",tag:"0020|0011"},{name:"SeriesDescription",tag:"0008|103e",strconv:!0}]),ge=ne("dicom",{state:()=>({sliceData:{},volumeToImageID:{},imageIDToVolumeKey:{},patientInfo:{},patientStudies:{},studyInfo:{},studyVolumes:{},volumeInfo:{},volumeStudy:{},studyPatient:{},needsRebuild:{}}),actions:{async importFiles(e){if(!e.length)return[];const t=this.$dicomIO,n=new Map(e.map(s=>[s.fileSrc.file,s])),o=[...n.keys()],a=await t.categorizeFiles(o),r=bt();return Object.entries(a).forEach(([s,i])=>{const l=i.map(c=>{const u=n.get(c);if(!u)throw new Error("Did not match File with source DataSource");return u});r.add(s,l)}),await Promise.all(Object.entries(a).map(async([s,i])=>{if(!(s in this.volumeInfo)){const l=await au(t,i[0]),c={PatientID:l.PatientID||Ns,PatientName:l.PatientName||Fs,PatientBirthDate:l.PatientBirthDate||"",PatientSex:l.PatientSex||""},u=Xt(l,"StudyID","StudyInstanceUID","StudyDate","StudyTime","AccessionNumber","StudyDescription"),d={...Xt(l,"Modality","SeriesInstanceUID","SeriesNumber","SeriesDescription"),NumberOfSlices:i.length,VolumeID:s};this._updateDatabase(c,u,d)}s in this.volumeToImageID&&(this.needsRebuild[s]=!0)})),Object.keys(a)},_updateDatabase(e,t,n){const o=e.PatientID,a=t.StudyInstanceUID,r=n.VolumeID;o in this.patientInfo||(this.patientInfo[o]=e,this.patientStudies[o]=[]),a in this.studyInfo||(this.studyInfo[a]=t,this.studyVolumes[a]=[],this.studyPatient[a]=o,this.patientStudies[o].push(a)),r in this.volumeInfo||(this.volumeInfo[r]=n,this.volumeStudy[r]=a,this.sliceData[r]={},this.studyVolumes[a].push(r))},deleteVolume(e){const t=_e();if(e in this.volumeInfo){const n=this.volumeStudy[e];if(delete this.volumeInfo[e],delete this.sliceData[e],delete this.volumeStudy[e],e in this.volumeToImageID){const o=this.volumeToImageID[e];t.deleteData(o),delete this.volumeToImageID[e],delete this.imageIDToVolumeKey[o]}yt(this.studyVolumes[n],e),this.studyVolumes[n].length===0&&this.deleteStudy(n)}},deleteStudy(e){if(e in this.studyInfo){const t=this.studyPatient[e];delete this.studyInfo[e],delete this.studyPatient[e],[...this.studyVolumes[e]].forEach(n=>this.deleteVolume(n)),delete this.studyVolumes[e],yt(this.patientStudies[t],e),this.patientStudies[t].length===0&&this.deletePatient(t)}},deletePatient(e){e in this.patientInfo&&(delete this.patientInfo[e],[...this.patientStudies[e]].forEach(t=>this.deleteStudy(t)),delete this.patientStudies[e])},async serialize(e){const t=Object.keys(this.volumeInfo);await xs(e,t,Nn.DICOM)},async deserialize(e){return this.importFiles(e).then(t=>{if(t.length!==1)throw new Error("Invalid state file.");return t[0]})},async getVolumeSlice(e,t,n=!1){const o=this.$dicomIO,a=bt(),r=ou(t,n);if(e in this.sliceData&&r in this.sliceData[e])return this.sliceData[e][r];if(!(e in this.volumeInfo))throw new Error(`Cannot find given volume key: ${e}`);const i=this.volumeInfo[e].NumberOfSlices;if(t<1||t>i)throw new Error(`Slice ${t} is out of bounds`);const l=a.getFiles(e);if(!l)throw new Error(`No files found for volume key: ${e}`);const c=l[t-1],u=await o.getVolumeSlice(c,n);return this.sliceData[e][r]=u,u},async getVolumeThumbnail(e){const{NumberOfSlices:t}=this.volumeInfo[e],n=Math.ceil(t/2);return this.getVolumeSlice(e,n,!0)},async buildVolume(e,t=!1){const n=_e(),o=this.$dicomIO;if(!(t||this.needsRebuild[e])&&this.volumeToImageID[e]){const c=this.volumeToImageID[e];return n.dataIndex[c]}const s=bt().getFiles(e);if(!s)throw new Error("No files for volume key");const i=kn.convertItkToVtkImage(await o.buildImage(s)),l=this.volumeToImageID[e];if(l)n.updateData(l,i);else{const c=this.volumeInfo[e].SeriesInstanceUID,u=n.addVTKImageData(c,i);this.imageIDToVolumeKey[u]=e,this.volumeToImageID[e]=u}return delete this.needsRebuild[e],i}}}),To=ne("models",{state:()=>({idList:[],dataIndex:{},metadata:{}}),actions:{addVTKPolyData(e,t){const n=Wt().nextId();return this.idList.push(n),this.dataIndex[n]=t,this.$proxies.addData(n,t),n}}});var Ve=(e=>(e[e.Error=0]="Error",e[e.Warning=1]="Warning",e[e.Info=2]="Info",e[e.Success=3]="Success",e))(Ve||{});const Qe=ne("message",{state:()=>({_nextID:1,byID:{},msgList:[]}),getters:{messages(){return this.msgList.map(e=>this.byID[e])},importantMessages(){return this.messages.filter(e=>e.type!==3)}},actions:{addError(e,t){return t instanceof Error?this._addMessage({type:0,title:e},{details:String(t),persist:!1}):this._addMessage({type:0,title:e},t)},addWarning(e,t){return this._addMessage({type:1,title:e},t)},addInfo(e,t){return this._addMessage({type:2,title:e},t)},addSuccess(e,t){return this._addMessage({type:3,title:e},t)},clearOne(e){e in this.byID&&(yt(this.msgList,e),delete this.byID[e])},clearAll(){this.byID={},this.msgList=[]},_addMessage(e,t){const n=String(this._nextID++),o={persist:!1,...typeof t=="string"?{details:t}:t};return this.byID[n]={...e,options:o,id:n},this.msgList.push(n),n}}});async function ko(e,t){try{return await t()}catch(n){n instanceof Error&&Qe().addError(e,{details:`${n}. More details can be found in the developer's console.`}),console.error(n)}}const on=e=>({type:"dicom",volumeKey:e}),an=e=>({type:"image",dataID:e}),Us=e=>{if(e.type==="image")return e.dataID;if(e.type==="dicom")return ge().volumeToImageID[e.volumeKey];const t=e;throw new Error(`invalid selection type ${t}`)},su=async e=>{const t=_e(),n=ge();return e.type==="dicom"?(await ko("Failed to build volume",()=>n.buildVolume(e.volumeKey)),t.dataIndex[Us(e)]):t.dataIndex[e.dataID]},Ws=e=>ge().imageIDToVolumeKey[e]??e,zs=e=>ge().volumeToImageID[e]??e;function Eo(e,t){return e.type==="dicom"&&t.type==="dicom"?e.volumeKey===t.volumeKey:e.type==="image"&&t.type==="image"?e.dataID===t.dataID:!1}const Je=ne("dataset",()=>{const e=_e(),t=To(),n=ge(),o=bt(),a=M(null),r=_(()=>{if(a.value)return Us(a.value)}),s=_(()=>{const{dataIndex:d}=e;return r.value&&d[r.value]||null}),i=_(()=>[...e.idList,...t.idList]);function l(d){return this.$proxies.getData(d)}function c(d){a.value=d,d!==null&&d.type==="dicom"&&ko("Failed to build volume",()=>n.buildVolume(d.volumeKey))}async function u(d){if(await n.serialize(d),await e.serialize(d),a.value!==null){let f=null;a.value.type==="dicom"?f=a.value.volumeKey:f=a.value.dataID;const{manifest:m}=d;m.primarySelection=f}}return e.$onAction(({name:d,args:f,after:m})=>{d==="deleteData"&&m(()=>{const[g]=f,v=a.value;(v==null?void 0:v.type)==="image"&&v.dataID===g&&(a.value=null),o.remove(g)})}),n.$onAction(({name:d,args:f,after:m})=>{d==="deleteVolume"&&m(()=>{const[g]=f,v=a.value;(v==null?void 0:v.type)==="dicom"&&g===v.volumeKey&&(a.value=null),o.remove(g)})}),{primarySelection:a,primaryDataset:s,allDataIDs:i,getDataProxyByID:l,setPrimarySelection:c,serialize:u}});function iu(e){let t=e;for(;t;)t!==e?console.error("The above error was caused by:",t):console.error(t),t instanceof Error?t=t.cause:t=null}function ru(e,t,n){return{message:e,inputDataStackTrace:[t],cause:n}}const no=Symbol("DoneSentinel");class Wn{constructor(t){this.handlers=Array.from(t??[])}async execute(t,n){return this.startExecutionContext(t,n)}async startExecutionContext(t,n){const o=[...this.handlers],a=[],r=Is(),s=(f,m)=>{m?r.reject(m):r.resolve(f)},i=async(f,m)=>{let g=!1,v;const h=m>=o.length,w={done:b=>{if(g)throw new Error("done() called twice!");return g=!0,v=b,no},execute:async(b,S)=>{const V=this.execute(b,S??n);return a.push(V),V},extra:n};let D;h&&(D=no);try{if(h)D=no;else{const b=o[m];D=await b(f,w)}}catch(b){const S=b instanceof Error?b:new Error(b?String(b):"Unknown error occurred");s(void 0,S);return}if(g||h){s(v);return}i(D,m+1)},l={ok:!0,data:[],errors:[]};try{await i(t,0);const f=await r.promise;f!=null&&l.data.push(f)}catch(f){const m=f instanceof Error?f.message:String(f);l.ok=!1,l.errors.push(ru(m,t,f))}const c=await Promise.all(a),[u,d]=Fn(f=>f.ok,c);return d.length>0&&(l.ok=!1),u.forEach(f=>{l.data.push(...f.data)}),d.forEach(f=>{const{errors:m}=f;m.forEach(g=>{g.inputDataStackTrace.push(t)}),l.errors.push(...m)}),l}}const lu=(e,{extra:t,done:n})=>{const{fileSrc:o}=e;return t!=null&&t.dicomDataSources&&(o==null?void 0:o.fileType)==="application/dicom"?(t.dicomDataSources.push(e),n()):e},cu={testURL:e=>{const{protocol:t}=new Et(e,window.location.href);return t==="http:"||t==="https:"},fetchURL:async(e,t={})=>{var c;const{progress:n}=t,o=await fetch(e);if(o.status!==200)throw new Error(`Fetching resource failed (HTTP code ${o.status})`);if(!n)return o.blob();const a=Number(o.headers.get("content-length"))??-1;if(a<0)return n(1/0),o.blob();const r=(c=o.body)==null?void 0:c.getReader();if(!r)return null;const s=new Uint8Array(a);let i=0,l=!1;do{const u=await r.read();l=u.done,u.value&&!l&&(s.set(u.value,i),i+=u.value.length,n(i/a))}while(!l);return new Blob([s])}},Ro=[cu];function uu(e){return!!Ro.find(t=>t.testURL(e))}async function js(e,t,n){const o=Ro.find(s=>s.testURL(e));if(!o)throw new Error(`Cannot find a handler for URL: ${e}`);const a=n==null?void 0:n.cache;if(a!=null&&a.has(e))return a.get(e);const r=o.fetchURL(e,n).then(s=>{if(!s)throw new Error(`Failed to download ${e}`);return new File([s],t)});return r.catch(()=>{a==null||a.delete(e)}),a==null||a.set(e,r),r}async function du(e,t){const n=Ro.find(s=>s.testURL(e));if(!n)throw new Error(`Cannot find a handler for URL: ${e}`);const o=await n.fetchURL(e,t);if(!o)throw new Error(`Failed to download ${e}`);const a=await o.arrayBuffer(),r=new TextDecoder;return JSON.parse(r.decode(new Uint8Array(a)))}const Hs=async(e,{execute:t,done:n,extra:o})=>{const{fileSrc:a,uriSrc:r}=e;if(!a&&r&&uu(r.uri))try{const s=await js(r.uri,r.name,{cache:o==null?void 0:o.fetchFileCache});return t({...e,fileSrc:{file:s,fileType:""}}),n()}catch(s){throw new Error(`Could not download URL ${r.uri}`,{cause:s instanceof Error?s:void 0})}return e};async function Vo(e){const t=await vo.loadAsync(e),n=[],o=[];return t.forEach((a,r)=>{if(!r.dir){const s=_s(r.name),i=fc(r.name),l=t.file(r.name);l&&(n.push(l.async("blob").then(c=>new File([c],s))),o.push(i))}}),Promise.all(n).then(a=>a.map((r,s)=>({file:r,archivePath:o[s]})))}const sn={vti:"application/vnd.unknown.vti",vtp:"application/vnd.unknown.vtp",stl:"model/stl",dcm:"application/dicom",zip:"application/zip",json:"application/json",gipl:"application/vnd.unknown.gipl","gipl.gz":"application/vnd.unknown.gipl",hdf5:"application/x-hdf5",jpg:"image/jpeg",jpeg:"image/jpeg",lsm:"application/vnd.unknown.lsm",mnc:"application/vnd.unknown.minc","mnc.gz":"application/vnd.unknown.minc",mnc2:"application/vnd.unknown.minc",mgh:"application/vnd.unknown.mgh",mgz:"application/vnd.unknown.mgh","mgh.gz":"application/vnd.unknown.mgh",mha:"application/vnd.unknown.metaimage",mhd:"application/vnd.unknown.metaimage",mrc:"application/vnd.unknown.mrc",nia:"application/vnd.unknown.nifti-1",nii:"application/vnd.unknown.nifti-1","nii.gz":"application/vnd.unknown.nifti-1",hdr:"application/vnd.unknown.nifti-1",nrrd:"application/vnd.unknown.nrrd",nhdr:"application/vnd.unknown.nrrd",png:"image/png",pic:"application/vnd.unknown.biorad",tif:"image/tiff",tiff:"image/tiff",vtk:"application/vnd.unknown.vtk",isq:"application/vnd.unknown.scanco",fdf:"application/vnd.unknown.fdf"},Ca=new Set(Object.keys(sn)),Sa=new Set(Object.values(sn)),Gs=new Set(["application/zip"]);function Ks(e){return!!e.fileSrc&&Gs.has(e.fileSrc.fileType)}const fu=async(e,{execute:t,done:n})=>Ks(e)?((await Vo(e.fileSrc.file)).forEach(a=>{t({fileSrc:{file:a.file,fileType:""},archiveSrc:{path:`${a.archivePath}/${a.file.name}`},parent:e})}),n()):e;async function pu(e,t){let n=t==null?void 0:t.get(e);return n||(n=Vo(e).then(o=>o.reduce((a,r)=>{const s=Ut(r.archivePath,r.file.name);return Object.assign(a,{[s]:r.file})},{})),t&&t.set(e,n),n)}const qs=async(e,{extra:t,execute:n,done:o})=>{const{fileSrc:a,archiveSrc:r,parent:s}=e,{archiveCache:i}=t??{};if(!a&&r&&s){if(!(s!=null&&s.fileSrc))throw new Error("Cannot extract an archive target with an unresolved parent");if(!Ks(s))throw new Error("Parent is not a supported archive file");const l=await pu(s.fileSrc.file,i),c=Nt(r.path),u=l[c];if(!u)throw new Error(`Failed to find archive member ${c}`);return n({...e,fileSrc:{file:u,fileType:""}}),o()}return e},gu=e=>new Et(e).protocol==="s3:";function mu(e,t){return`https://${e}.s3.amazonaws.com/${t}`}async function vu(e,t,n=()=>{}){const o=new Dr({region:"us-east-1",signer:{sign:async r=>r}}),a=async r=>{const s=new Ar({Bucket:e,Prefix:t,ContinuationToken:r,MaxKeys:1e3});let i;try{i=await o.send(s)}catch(l){throw console.error(l),l}if(!i.Contents)throw new Error("S3 returned no objects");i.Contents.forEach(l=>{if(!l.Key)return;const c=l.Key,u=mu(e,l.Key);n(c,u)}),i.IsTruncated&&i.NextContinuationToken&&await a(i.NextContinuationToken)};await a()}const hu=e=>{const{hostname:t,pathname:n}=new Et(e),o=n.replace(/^\//,"");return[t,o]},yu=async(e,t=()=>{})=>{const[n,o]=hu(e);await vu(n,o,t)},wu=async(e,{execute:t,done:n})=>{const{uriSrc:o}=e;if(o&&gu(o.uri))try{return await yu(o.uri,(a,r)=>{t({uriSrc:{uri:r,name:a},parent:e})}),n()}catch(a){throw new Error(`Could not download S3 URI ${o.uri}`,{cause:a instanceof Error?a:void 0})}return e},Cu=e=>new Et(e).protocol==="gs:",Su=e=>{const{hostname:t,pathname:n}=new Et(e),o=n.replace(/^\//,"");return[t,o]},_u=e=>`https://storage.googleapis.com/storage/v1/b/${e}/o`;async function bu(e,t,n=()=>{}){const o=[],a=async r=>{const s=new Et(_u(e));s.searchParams.append("prefix",t),s.searchParams.append("maxResults","1000"),r&&s.searchParams.append("pageToken",r);const i=await du(s.toString());if(i.kind!=="storage#objects")throw new Error("GCS did not return a list of objects!");o.push(...i.items),i.items.forEach(l=>n(l)),i.nextPageToken&&await a(i.nextPageToken)};return await a(),o}const Iu=async(e,t=()=>{})=>{const[n,o]=Su(e);return bu(n,o,t)},Du=async(e,{execute:t,done:n})=>{const{uriSrc:o}=e;if(o&&Cu(o.uri))try{return await Iu(o.uri,a=>{t({uriSrc:{uri:a.mediaLink,name:a.name},parent:e})}),n()}catch(a){throw new Error(`Could not download GCS URI ${o.uri}`,{cause:a instanceof Error?a:void 0})}return e},_a=[{mime:"application/dicom",skip:128,header:Array.from("DICM").map(e=>e.charCodeAt(0))}],Au=512;function Tu(e,t){if(t.length>e.length)return!1;for(let n=0;n<t.length;n+=1)if(t[n]!==e[n])return!1;return!0}async function ku(e){return new Promise(t=>{const n=e.slice(0,Au),o=new FileReader;o.onload=()=>{const a=new Uint8Array(o.result);for(let r=0;r<_a.length;r+=1){const{mime:s,header:i,skip:l=0}=_a[r];if(Tu(a.slice(l),i)){t(s);return}}t(null)},o.readAsArrayBuffer(n)})}async function Zs(e){const t=e.type.toLowerCase();if(Sa.has(t))return t;if(Ca.has(t))return sn[t];const n=[...Ca].find(a=>e.name.toLowerCase().endsWith(`.${a}`));if(n)return sn[n];const o=await ku(e);return o&&Sa.has(o)?o:null}async function Eu(e){const t=await Zs(e)??"";return new File([e],e.name,{type:t.toLowerCase()})}async function Ru(e,t){return new Promise(n=>{const o=new globalThis.FileReader;if(o.onload=()=>n(o.result),t==="ArrayBuffer")o.readAsArrayBuffer(e);else if(t==="Text")o.readAsText(e);else throw new TypeError(`readAs${t} is not a function`)})}async function Vu(e){return Ru(e,"ArrayBuffer")}const fo=new Map,Mu=async(e,{done:t})=>{if(!e.fileSrc)return e;const{fileSrc:n}=e;if(!fo.has(n.fileType))return e;const a=await fo.get(n.fileType)(n.file),r=bt();if(a.isA("vtkImageData")){const s=_e().addVTKImageData(n.file.name,a);return r.add(s,[e]),t({dataID:s,dataSource:e,dataType:"image"})}if(a.isA("vtkPolyData")){const s=To().addVTKPolyData(n.file.name,a);return r.add(s,[e]),t({dataID:s,dataSource:e,dataType:"model"})}throw new Error("Data reader did not produce a valid dataset")},Pu=T.object({url:T.string(),name:T.optional(T.string())}),Lu=T.object({resources:T.array(Pu)});async function $u(e){const t=new TextDecoder,n=await e.arrayBuffer(),o=t.decode(new Uint8Array(n));return Lu.parse(JSON.parse(o))}const Ou=async(e,{done:t,execute:n})=>{const{fileSrc:o}=e;if((o==null?void 0:o.fileType)==="application/json"){const a=[];try{(await $u(o.file)).resources.forEach(s=>{a.push({uriSrc:{uri:s.url,name:s.name??new URL(s.url).pathname},parent:e})})}catch{return e}return a.forEach(r=>{n(r)}),t()}return e};function xu(e,t){t.classHierarchy.push("vtkLabelMap"),t.colorMap===null&&(t.colorMap={0:[0,0,0,0],1:[0,0,0,255]})}const Bu={colorMap:null};function Qs(e,t,n={}){Object.assign(t,Bu,n),us.extend(e,t,n),A.setGet(e,t,["colorMap"]),xu(e,t)}const Fu=A.newInstance(Qs,"vtkLabelMap"),Js={newInstance:Fu,extend:Qs},Nu="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4gIoSUNDX1BST0ZJTEUAAQEAAAIYAAAAAAQwAABtbnRyUkdCIFhZWiAAAAAAAAAAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAAHRyWFlaAAABZAAAABRnWFlaAAABeAAAABRiWFlaAAABjAAAABRyVFJDAAABoAAAAChnVFJDAAABoAAAAChiVFJDAAABoAAAACh3dHB0AAAByAAAABRjcHJ0AAAB3AAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAFgAAAAcAHMAUgBHAEIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFhZWiAAAAAAAABvogAAOPUAAAOQWFlaIAAAAAAAAGKZAAC3hQAAGNpYWVogAAAAAAAAJKAAAA+EAAC2z3BhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABYWVogAAAAAAAA9tYAAQAAAADTLW1sdWMAAAAAAAAAAQAAAAxlblVTAAAAIAAAABwARwBvAG8AZwBsAGUAIABJAG4AYwAuACAAMgAwADEANv/bAEMACwgICggHCwoJCg0MCw0RHBIRDw8RIhkaFBwpJCsqKCQnJy0yQDctMD0wJyc4TDk9Q0VISUgrNk9VTkZUQEdIRf/bAEMBDA0NEQ8RIRISIUUuJy5FRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRf/AABEIAIAAgAMBIgACEQEDEQH/xAAbAAAABwEAAAAAAAAAAAAAAAAAAQIDBAUGB//EADUQAAEDAwIDBgUEAQUBAAAAAAECAxEABCEFMRJBUQYTYXGBkRQiMrHBB6HR8DMVRFNi4fH/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/8QAFBEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEQMRAD8A5Y19JpzcUhr6fWl0AoGZobYoUA6daHnQoqA6LagBMUZxtQCi8qHrQoAaPnRUcmgG9A9aFCaAHxpt76R504MnO29IeJ4I5TO1AGvppfQ0hsfIKWTQCi39a2XZb9PrrW2Pj9Qd+B00Z71YhSx/1B5eJ9Jrc2Ft2a0YcGkaUm8dRg3L4BBPUEg/sBQcfZ0u/uUg29jcugiQW2lKB9hTdxY3VoYubZ5k9HGyn7iu6O6/ergd8hkR9LSBHuZ/FQb28F8wpq7uFLQcAOEEH0IoOJDenHkd2QklJMTgzWk1bs4DcOfCuIKslKQQOIdAOvhVONE1Ar4fhXJmJIgTQV+9LQ044YQhSj4Ca0Ondkbtd0ym7bLYX8wChGOsHNbm27N2ViQW3FpWOaRBoOULsrhCQpbLiRyJSRTRBBggjzFdqF1dW+EXHfI2LdwhK0ke01W6gNC1JtSNX0hNsuZF1ZgAZO5HIe+1Byei54rR9oeyrmkqU7bOC5sjBQ+3lJB2nod/as7kfmgFE84SwEcKcEmYyZ5T0o9qQ7lHrQBvCRWu7GdnrW/W7qmsEp0y0IlP/MvcIHXxisxY2rl7cNW7KSpxxQSAOpNbm9WbMWmmsAi3tUkhO3EonKj4k/sBQaO/1Z3VnEhY7ixbA7u3SYwNpjw9qhv6k3bohJSABAEgCspfa53ailKiQMGDuenlVFdaldXZPEspRsAMAeFBsLjtKylQS46QRyCsjPh+aQzfM3yzwOMtwkkqcdEEjlByDvFYjhJSpW8EA+Zn+KMNkkpwCACST4UG1unLY2jpcKAtMgKBBJPQEZNR7bXNQtHEs2928hskJ4UqJAPMidqpraxSEIU+2tSyYQ2nBJ6k8hXQtB0gXbVu3qCSpCUgFobDG1BQC5avSs3LxfWlUAKWTA6CDP32qdwKWyhppt4FQlKWyqTGORJ364rcudn9GeZDCLNlIGAlKB7k1lL600qyduGUWSEKSojiSox7TG+KCquLy+tACpK+Eg/K6kpPkDEe9BOppfbkgicFKhkeFTQD3KgGG0txEKSCDHnWT1Zs2ay7bQG1GFN5IFBapvHLV492eJhYIcaMEEHeAcVnNYs2GlpuLMqNu4SAFbpI3BpCb8gyFGQYKSZHoalWykXQctnTAegoIM8J3ny60FJM0hzKDT77Krd5baxCkmDTDn0Gg1/YlLGn2uoaw+AXLdAZt0k7rVMkeQH70zd3altqddUSpRJUrwxgU2m4bZ0K0smTJKi88RzWRAHoI96g35Kiw2DKSmSAef8A9NBDUlTyysgwRtG1KQmUlA2JkipzbYQ1kbDMDaojwBVIgc6COW+FRESCZI60/pzCr7UmGFEJDrgBnIAnn1pkqJMVZdm1ts63buvKCUoO52mDAoOio0Bi2uWHFhCQmeJKRABBgR0ECrhNw20mW4BO5PM1WLvmnk8SVhU5BMxNMm4kSSDG8mKCdqfaBNnakJJ78j5YOw6mstaLcvrriWqUlQJJO5qBc3CtQ1BziMJCinB5AwIq8tBbt23ClAA6kUDusqbFoFNEHbPWshqSwthwEZgn1q71S9S2yQTJnArMXbxUlXEcnfwFBUZwRgTg0+ytRIiREkEcozTXduESEqInkKNBU2owIIyRQSr5z4tpD5kuIhCyREjkfx7VBKJZWokADA8T0qW0scSm1ZQ4OEzyPI+8VEdJDIHSfegsLYgWKDjiCiCZyRAj807dI4btskQOAEHrOaisJItErCgpMgFIOQf6KdfeUpLSlGQmUjGw6f3rQPFWQBMedRXZBMmnQ5IETyppwTBJk0EeJMyAPKnEvBpBSASCQSep/ppEcjtvQIBkHYbR/NB03SNVttR0tjuQhSm2wlbcwUkAAmOh3mo93cth0ISQFnJSDkCufWiXO+UUOKaSkEqUCQQB5VLbvAh0qSFAkg4OaC2dQli4ISRMk75NPG9UlAwZjfakDTb3Urb4plslKSQZHCokcwOfjUVl9oIHfqSDMYk0BPKcfXJ+aSIHQ006wEgcQkEySeZ8PCnXtSZbA7kApn5upqO/qSXkkJSAY33oG3L1LJwjHIAVEduUvEkNhJIgmZnxptwlyStURkAc6Uhn5QclRyfAUCFEgQCMZpu4T8qyPP0NSHWwlMzJJ+kchiPeo7xPdA9AUn7/AJoJmnt94lLfJQMDqQCQPcR61IbbQ9bONLwY4knxpNiwSwhUlKhkCIPgQantMFT6VGE8REk4Anc0FElZQohRMgwRTyJeICElSiJgCa6BfdjGruwT3zYYum0yl5ohSXk8jvCj4ggxuJqhvOy12xZst6c2bgFRLjqFAHoAQTIFBmnWXAT8igBzg4pvugEnjcCYAJGSTjlV3daZfoJYtrV1baAA6oAqTxc4Jge1Nf6cRwF8p4mwB3aBIGZknYnNBDabLdoSr63DMcwkfyftSS2UcJKSJAggRV6y5YI1G0Nwl121QQXkKACgJEgAHpmtJ2uToo0sfDuWLtypYNv8EmClvmF5InaJzNBTaf2lTpelBp5tThTJbIIBzkAzvz2rLOLW4+XHAAHSTJwBJqU9bB62SUuJKkkwCZIHQ469KSm3cQ0kPpWtMiYEhKQcgHkTQQlIUl1SQQcxIMjpPlSwkJRwgQoE8XUQYqbatsLu0B5IbZkgggmAd5jO32qWLJt55abdpXdpP+QpIBGcnny2oK+301y5u+6QsKSASXMhIA3OaksWhS0VKBJJx4jYe9W1lbFUoAIbUrgUspICjBJE9YG1TriwKBhJAG5jYRyoMk6yQmCIO+NhUFZAQ6hXMSPAj/yav9QaSOFKGwkgEEgmVGSZ+w9Kp7u2Sw2tTzgDhHytpMnzPTy3oLzQ+2KbW0astY09nUbNsQgkcDrYmcKGSPA+9azT7Hs52gQDo+o/C3B/2l2QDPQHn6SetcpRlApckbGg7bZaZqOjNusPMuuW6h/jCe8aJ6wMjzEEGoatNaCHbixfdt3FGSwslYkbgHfyketYDRu3Wu6IkN218pxkbNPDjSB0E5A8iK1dp+rDVzwjWdIYdOxW1+AZ+9Abmm3F0Sm7uHFomeEKMf30qUjs62pngLYiCAQIIB5jxqxt+2PZG8CSVPWqui0nHoCafe7Q6W3w/AvpuRGCARHmIOKDNq0Bi1U22pSRcFJMEkEgTJz4fY1W22lMlp0rUkJDhRxKgAwcR5yK6ELjTrxAublxhLvAUSgEKSDuJhR2JGw3NVdnY6Mye6tbpCiHO8IdSopChtymAPEZz4UGVa7MKafLiVBKAICYknqT/FLe0B9I4rRwtq34ZIB/vQ1sXgk3IPxVn3QE/I6AVHG4UQRHrTD9zYtJKlXlmkA7F0qI9EpM+9BlZu0qRb3zLRWRIUhkFR3zIFWlvpN1eS0Eqt2jAJj5l55jcD1FPu9pdCtiePUeIgZDDEyekqJj1FU99+otoyFJ0+xLx5KuiVjzCcJHoKDWWOmWdu0GW08akEwltJcUCd8AGP2qv15dnpzKnL59LA2DSVBbqj0IBIT6knwrD336ga5eNd0m57hrYIaATA6YAEelZt64duFlbzinFHmokmgs9Q1xVw+sWSfh2TgQZUR1Kt/aB4VTOElBJMknelYpDn0GgDf0ClbUloSml+WaAoodKHrQ3oBJAo+IjIJHkaLehvQKKlHBUT60QJGxMedF5UdA537oEBxcRsFGKQpSifmJPmZoqLegOhQoR5UAopyDR0VAf3pDv0UvG9Id+n1oP//Z",pe={Coronal:"Coronal",Sagittal:"Sagittal",Axial:"Axial",Three:"3D"},Ys={[pe.Coronal]:{viewType:"2D",props:{viewDirection:"Right",viewUp:"Superior"}},[pe.Sagittal]:{viewType:"2D",props:{viewDirection:"Posterior",viewUp:"Superior"}},[pe.Axial]:{viewType:"2D",props:{viewDirection:"Superior",viewUp:"Anterior"}},[pe.Three]:{viewType:"3D",props:{viewDirection:"Posterior",viewUp:"Superior"}}},Uu=Ys[pe.Axial],ba=[{name:"Axial Only",direction:Re.H,items:[pe.Axial]},{name:"Axial Primary",direction:Re.V,items:[pe.Axial,{direction:Re.H,items:[pe.Three,pe.Coronal,pe.Sagittal]}]},{name:"3D Primary",direction:Re.V,items:[pe.Three,{direction:Re.H,items:[pe.Coronal,pe.Sagittal,pe.Axial]}]},{name:"Quad View",direction:Re.H,items:[{direction:Re.V,items:[pe.Coronal,pe.Three]},{direction:Re.V,items:[pe.Sagittal,pe.Axial]}]},{name:"3D Only",direction:Re.H,items:[pe.Three]}].reduce((e,t)=>({...e,[t.name]:t}),{}),en={0:[0,0,0,0],1:[153,153,0,255],2:[76,76,0,255],3:[255,255,0,255],4:[0,76,0,255],5:[0,153,0,255],6:[0,255,0,255],7:[76,0,0,255],8:[153,0,0,255],9:[255,0,0,255],10:[0,76,76,255],11:[0,153,153,255],12:[0,255,255,255],13:[0,0,76,255],14:[0,0,153,255]},Wu=[{name:"MRI Cardiac 3D and Cine",filename:"MRI-Cardiac-3D_and_Cine.zip",description:"MRI scan with two series: 3D axial non-gated and 2 chamber cine. (4 MB)",url:"https://data.kitware.com/api/v1/item/6350b28f11dab8142820949d/download",image:Nu}],zu=["#58f24c","#8de4d3","#f0a4b1","#a3c9fe","#c8f251","#fea53b"],ju={red:{color:"red"},green:{color:"#00ff00"},white:{color:"#ffffff"}},Hu={artifact:{color:"#888888",fillColor:"#ffbf0040"},innocuous:{color:"#00ff00",fillColor:"#00ff0020"},lesion:{color:"red",fillColor:"transparent"}},Gu="q",Ku="w",Ia={CT:"CT-AAA",MR:"CT-Coronary-Arteries-2",US:"US-Fetal"};class Xs{constructor(t){this.msgID=0,this.worker=t,this.waiting={},this.worker.onmessage=this.handleMessage.bind(this)}postMessage(t,n=[]){const o={id:this.msgID,message:t},a=Is();return this.waiting[o.id]=a,this.worker.postMessage(o,n),this.msgID+=1,a.promise}handleMessage(t){const{id:n,error:o,message:a}=t.data;if(n in this.waiting){const r=this.waiting[n];delete this.waiting[n],o?r.reject(new Error(o)):r.resolve(a)}}}const Mo=e=>async t=>{const o=await new Xs(new Worker(new URL("/assets/async.reader.worker-f0ea3ad1.js",self.location),{type:"module"})).postMessage({file:t,readerName:e});if(o.status==="success")return Rl(o.obj);throw o.error},qu=e=>async t=>{const o=await new Xs(new Worker(new URL("/assets/async.writer.worker-42a67950.js",self.location),{type:"module"})).postMessage({obj:t.getState(),writerName:e});if(o.status==="success")return o.data;throw o.error},Zu=Mo("stl"),ei=Mo("vti"),Qu=Mo("vtp"),Ju=qu("vti"),Yu=Uint8Array;function Xu(e){const t=new Yu(e.getNumberOfPoints()),n=Js.newInstance(e.get("spacing","origin","direction"));return n.getPointData().setScalars(ds.newInstance({numberOfComponents:1,values:t})),n.setDimensions(e.getDimensions()),n.computeTransforms(),n.setColorMap(en),n}function ed(e){const t=Js.newInstance(e.get("spacing","origin","direction","indexToWorld","worldToIndex","dataDescription","pointData"));return t.setDimensions(e.getDimensions()),t.computeTransforms(),t.setColorMap(en),t}const zt=ne("labelmap",{state:()=>({idList:[],labelmaps:Object.create(null),parentImage:Object.create(null)}),actions:{newLabelmapFromImage(e){const n=_e().dataIndex[e];if(!n)return null;const o=Wt().nextId(),a=Xu(n);return this.idList.push(o),this.parentImage[o]=e,this.labelmaps[o]=a,this.$proxies.addData(o,a),o},async serialize(e){const{labelMaps:t}=e.manifest,{zip:n}=e;await Promise.all(Object.entries(this.labelmaps).map(async([o,a])=>{const r=`labels/${o}.vti`,s=Ws(this.parentImage[o]);t.push({id:o,parent:s,path:r});const i=await Ju(a);n.file(r,i)}))},async deserialize(e,t,n){const{labelMaps:o}=e,a={};return o.forEach(async r=>{const[s]=t.filter(d=>Ut(d.archivePath,d.file.name)===Nt(r.path)).map(d=>d.file);r.parent=n[r.parent];const{parent:i}=r,l=Wt().nextId();a[r.id]=l;const c=await ei(s),u=ed(c);this.idList.push(l),this.parentImage[l]=zs(i),this.labelmaps[l]=u,this.$proxies.addData(l,u)}),a}}});async function td(e,t,n,o=[{type:ct.Image}]){const a=navigator.hardwareConcurrency?navigator.hardwareConcurrency:6,r=n[0],s=Math.min(parseInt(a/2,10),Math.max(r.size[r.size.length-1],1),4),i=s.toString(),l=[...Array(s).keys()].map(m=>{const g=[...[...Array(n.length).keys()].map(h=>h.toString()),"0",...t,"--max-total-splits",i,"--split",m.toString(),"--number-of-splits",i,"--memory-io"],v=n.map(h=>({type:ct.Image,data:Tr(h)}));return[e,g,o,v,Ut("/","/itk/pipelines"),Ut("/","/itk/pipeline.worker.js")]}),c=new kr(a,Ga),u=await c.runTasks(l).promise;c.terminateWorkers();const f=u.filter(m=>m.returnValue===0).map(({outputs:m})=>m[0].data);return Er(f)}const nd=["size","direction","origin","spacing"];function od(e,t){return nd.map(o=>_o(e[o],t[o])).every(o=>o)}async function ad(e,t){if(od(e,t))return t;const{size:n,spacing:o,origin:a,direction:r}=e,s=["--size",n.join(","),"--spacing",o.join(","),"--origin",a.join(","),"--direction",r.join(",")];return td("resample",s,[t])}const ti=e=>{throw new Error(`Unknown DataSelection: ${e}`)},sd=e=>e.type==="dicom"?e.volumeKey:e.type==="image"?e.dataID:ti(e),Qt=e=>{const t=sd(e);return`${e.type}::${t}`},oo=e=>{const[t,n]=e.split("::");return t==="dicom"?on(n):t==="image"?an(n):ti(t)},it=ne("layer",()=>{const e=M({}),t=M({});async function n(f,m){if(!f)throw new Error("Tried to addLayer without parent data selection");const g=Qt(f),v=`${g}::${Qt(m)}`;this.parentToLayers[g]=[...this.parentToLayers[g]??[],{selection:m,id:v}];const[h,w]=await Promise.all([f,m].map(su));if(!Vl.intersects(h.getBounds(),w.getBounds()))throw this.deleteLayer(f,m),new Error("Image bounds do not intersect, so no overlap in physical space");const D=await ad(kn.convertVtkToItkImage(h),kn.convertVtkToItkImage(w)),b=kn.convertItkToVtkImage(D);this.$proxies.addData(v,b),this.layerImages[v]=b}async function o(f,m){return ko("Failed to build layer",()=>this._addLayer(f,m))}function a(f,m){if(!f)throw new Error("Tried to deleteLayer without parent data selection");const g=Qt(f),v=this.parentToLayers[g]??[],h=v.find(({selection:w})=>Eo(w,m));h&&(this.parentToLayers[g]=v.filter(w=>w!==h),delete this.layerImages[h.id],this.$proxies.getData(h.id)&&this.$proxies.deleteData(h.id))}function r(f){if(!f)return[];const m=Qt(f);return e.value[m]??[]}const s=f=>Object.values(e.value).flat().flat().find(({id:m})=>m===f),i=f=>{const m=it();m.getLayers(f).forEach(({selection:g})=>m.deleteLayer(f,g)),Object.keys(m.parentToLayers).map(g=>oo(g)).forEach(g=>m.deleteLayer(g,f))};_e().$onAction(({name:f,args:m})=>{if(f!=="deleteData")return;const[g]=m,v=an(g);i(v)}),ge().$onAction(({name:f,args:m})=>{if(f!=="deleteVolume")return;const[g]=m,v=on(g);i(v)});function u(f){f.manifest.parentToLayers=Object.entries(this.parentToLayers).map(([m,g])=>({selectionKey:m,sourceSelectionKeys:g.map(({selection:v})=>Qt(v))}))}function d(f,m){const g=h=>{if(h.type==="dicom")return on(m[h.volumeKey]);if(h.type==="image")return an(m[h.dataID]);const w=h;throw new Error(`invalid selection type ${w}`)},{parentToLayers:v}=f;v.forEach(({selectionKey:h,sourceSelectionKeys:w})=>{const D=g(oo(h));w.forEach(b=>{const S=g(oo(b));this.addLayer(D,S)})})}return{parentToLayers:e,layerImages:t,_addLayer:n,addLayer:o,deleteLayer:a,getLayers:r,getLayer:s,serialize:u,deserialize:d}});function ni(e){const t=_e();if(e&&e in t.metadata){const{lpsOrientation:n}=t.metadata[e],o=t.dataIndex[e];if(o){const a=o.getSpatialExtent();return{Sagittal:at(a,"Sagittal",n),Coronal:at(a,"Coronal",n),Axial:at(a,"Axial",n)}}}return As()}function ie(){const e=Je(),t=ge(),n=_e(),o=it(),a=_(()=>{const{primarySelection:u}=e,{volumeToImageID:d}=t;return(u==null?void 0:u.type)==="image"?u.dataID:(u==null?void 0:u.type)==="dicom"&&d[u.volumeKey]||null}),r=_(()=>{const{metadata:u}=n,d=a.value;return d?u[d]:Bs()}),s=_(()=>{if(a.value)return n.dataIndex[a.value]}),i=_(()=>ni(a.value)),l=_(()=>!!e.primarySelection&&!e.primaryDataset),c=_(()=>o.getLayers(e.primarySelection).filter(({id:u})=>u in o.layerImages));return{currentImageData:s,currentImageID:a,currentImageMetadata:r,currentImageExtent:i,isImageLoading:l,currentLayers:c}}function ao(e,t){return[Math.max(t[0],Math.min(t[1],e[0])),Math.max(t[0],Math.min(t[1],e[1]))]}function Lt(e,t,n,o){const{indexToWorld:a,orientation:r,lpsOrientation:s}=t,i=[0,0,0],l=s[n];i[l]=e[n][o],Se(i,i,a);const c=-(o*2-1),u=[...r.slice(l*3,l*3+3).map(d=>d*c)];return Ml.newInstance({origin:i,normal:u})}function id(e,t){return gc(e,t,(n,o)=>Xe(n.getOrigin(),o.getOrigin())&&Xe(n.getNormal(),o.getNormal()))}const Tt=ne("crop",()=>{const e=_e(),t=Me({croppingByImageID:{}}),n=c=>_(()=>{const u=K(c);if(u&&u in t.croppingByImageID&&u in e.metadata){const d=t.croppingByImageID[u],f=e.metadata[u];return[Lt(d,f,"Sagittal",0),Lt(d,f,"Sagittal",1),Lt(d,f,"Coronal",0),Lt(d,f,"Coronal",1),Lt(d,f,"Axial",0),Lt(d,f,"Axial",1)]}return null}),o=(c,u)=>{const d=ni(c);return{Sagittal:ao(u.Sagittal,d.Sagittal),Coronal:ao(u.Coronal,d.Coronal),Axial:ao(u.Axial,d.Axial)}},a=(c,u)=>{t.croppingByImageID[c]=o(c,u)},r=(c,u,d)=>{c in t.croppingByImageID&&a(c,{...t.croppingByImageID[c],[u]:d})},s=c=>{const u=e.dataIndex[c];if(!u)return;const{lpsOrientation:d}=e.metadata[c],f=u.getSpatialExtent();a(c,{Sagittal:at(f,"Sagittal",d),Coronal:at(f,"Coronal",d),Axial:at(f,"Axial",d)})};function i(c){const{tools:u}=c.manifest;u.crop=t.croppingByImageID}function l(c,u){const d=c.tools.crop;Object.entries(d).forEach(([f,m])=>{const g=u[f];a(g,m)})}return{croppingByImageID:Rr(t.croppingByImageID),getComputedVTKPlanes:n,setCropping:a,setCroppingForAxis:r,resetCropping:s,serialize:i,deserialize:l}});function rd(){return fs.createBuilder().addField({name:"placed",initialValue:!1}).addField({name:"indexToWorld",initialValue:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}).addField({name:"worldToIndex",initialValue:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}).addStateFromMixin({labels:["handle"],mixins:["origin","bounds"],name:"handle",initialValues:{origin:null}}).build()}function ld(e,t){return t.map((n,o)=>Math.max(e[o*2],Math.min(e[o*2+1],n)))}function cd(e,t){t.classHierarchy.push("vtkCrosshairsWidgetProp");let n=!1;A.setGet(e,t,["manipulator"]);function o(a){return a.altKey||a.controlKey||a.shiftKey}e.handleLeftButtonPress=a=>!t.pickable||o(a)?A.VOID:(t.widgetState.setPlaced(!0),n=!0,t._interactor.requestAnimation(e),t._apiSpecificRenderWindow.setCursor("crosshairs"),e.invokeStartInteractionEvent(),e.handleMouseMove(a),A.EVENT_ABORT),e.handleMouseMove=a=>{if((!t.widgetState.getPlaced()||n)&&t.pickable&&t.manipulator&&!o(a)){const r=t.manipulator.handleEvent(a,t._apiSpecificRenderWindow),s=t.widgetState.getHandle(),i=t.widgetState.getWorldToIndex(),l=t.widgetState.getIndexToWorld();if(i.length&&l.length){const c=Be(),u=Be(),d=s.getBounds();Se(c,r,i);const f=ld(d,c);return Se(u,f,l),s.setOrigin(u),e.invokeInteractionEvent(),A.EVENT_ABORT}}return A.VOID},e.handleLeftButtonRelease=()=>{n&&t.pickable&&(t._interactor.cancelAnimation(e),t._apiSpecificRenderWindow.setCursor("default"),e.invokeEndInteractionEvent()),n=!1},e.grabFocus=()=>{},e.loseFocus=()=>{}}function ud(e,t){t.classHierarchy.push("vtkCrosshairsWidget"),t.behavior=cd,t.widgetState=rd(),e.getRepresentationsForViewType=n=>{switch(n){case gt.DEFAULT:case gt.GEOMETRY:case gt.SLICE:case gt.VOLUME:default:return[]}},t.widgetState.onBoundsChange(n=>{const o=[(n[0]+n[1])*.5,(n[2]+n[3])*.5,(n[4]+n[5])*.5];t.widgetState.getHandle().setOrigin(o)}),t.manipulator=st.newInstance()}const dd={};function oi(e,t,n={}){Object.assign(t,dd,n),On.extend(e,t,n),A.setGet(e,t,["manipulator"]),ud(e,t)}const fd=A.newInstance(oi,"vtkCrosshairsWidget"),pd={newInstance:fd,extend:oi};function jt(e,t,n,o){t in e||(e[t]={}),e[t][n]={...e[t][n],...o}}function gn(e,t){Object.keys(e).forEach(n=>{delete e[n][t]})}function mn(e,t,n){var o;return t==null||n==null?null:(o=e[t])==null?void 0:o[n]}const gd=(e,t,n)=>{const o=e.manifest.datasets.map(r=>r.id),{views:a}=e.manifest;a.forEach(r=>{o.forEach(s=>{var c;const{config:i}=r,l=(c=t[r.id])==null?void 0:c[s];if(l!==void 0){const u=pc(s,i,{});u[n]=l}})})},vn=(e,t)=>n=>{gd(n,e,t)},Po=()=>({slice:0,min:0,max:1,axisDirection:"Inferior"}),Gt=ne("viewSlice",()=>{const e=Me({}),t=(l,c)=>mn(e,l,c),n=(l,c,u)=>{const d={...Po(),...t(l,c),...u};d.slice=Ds(d.slice,d.min,d.max),jt(e,l,c,d)},o=(l,c)=>{const u=t(l,c);u&&n(l,c,{slice:Math.ceil((u.min+u.max)/2)})},a=l=>{delete e[l]},r=(l,c)=>{var u;c?(u=e[c])==null||delete u[l]:gn(e,l)},s=vn(e,"slice");return{configs:e,getConfig:t,updateConfig:n,resetSlice:o,removeView:a,removeData:r,serialize:s,deserialize:(l,c)=>{Object.entries(c).forEach(([u,d])=>{d.slice&&n(l,u,d.slice)})}}}),ai=()=>({width:1,level:.5,min:0,max:1}),Lo=ne("windowing",()=>{const e=Me({}),t=M(!0),n=d=>{t.value=d},o=(d,f)=>mn(e,d,f),a=(d,f)=>{var g;if(!t.value)return;const m=(g=e[d])==null?void 0:g[f];m&&Object.keys(e).filter(v=>v!==d).forEach(v=>{jt(e,v,f,m)})},r=(d,f,m)=>{var g;jt(e,d,f,{...ai(),...(g=e[d])==null?void 0:g[f],...m}),t.value&&a(d,f)},s=(d,f)=>{var h;const m=(h=e[d])==null?void 0:h[f];if(m==null)return;const g=m.max-m.min,v=(m.max+m.min)/2;r(d,f,{width:g,level:v})},i=d=>{delete e[d]},l=(d,f)=>{var m;f?(m=e[f])==null||delete m[d]:gn(e,d)},c=vn(e,"window");return{configs:e,getConfig:o,setSyncAcrossViews:n,updateConfig:r,resetWindowLevel:s,removeView:i,removeData:l,serialize:c,deserialize:(d,f)=>{Object.entries(f).forEach(([m,g])=>{g.window&&r(d,m,g.window)})}}});function si(e,t){var o,a;const n=(a=(o=t.getRenderWindow())==null?void 0:o.getViews())==null?void 0:a[0];if(n){const[r,s,i]=e;return n.worldToDisplay(r,s,i,t)}return null}function md(e,t){const n=t.getCanvas();if(!n)return null;const o=n.getBoundingClientRect(),a=n.width/o.width,r=n.height/o.height;return[a*(e.clientX-o.left),r*(o.height-e.clientY+o.top)]}function vd(e,t,n,o){var s;const a=(s=t.getRenderWindow())==null?void 0:s.getViews()[0];if(!a)return null;const r=md(e,a);return r?Pl(r[0],r[1],n,o,t,a):null}function rn(e,t){var a,r;const n=si(e,t),o=(r=(a=t.getRenderWindow())==null?void 0:a.getViews())==null?void 0:r[0];if(n&&o){const[,s]=o.getViewportSize(t);return[n[0]/devicePixelRatio,(s-n[1])/devicePixelRatio]}return null}function $o(e){var a,r,s;const{pokedRenderer:t}=e,n=(r=(a=t==null?void 0:t.getRenderWindow())==null?void 0:a.getViews())==null?void 0:r[0],o=(s=n==null?void 0:n.getContainer())==null?void 0:s.getBoundingClientRect();return!("position"in e)||!o?null:[o.left+e.position.x/devicePixelRatio,o.top+o.height-e.position.y/devicePixelRatio]}function ii(e,t,n){const o=xn.getPresetByName(e);if(o.OpacityPoints){const a=o.OpacityPoints,r=[];for(let c=0;c<a.length;c+=2)r.push([a[c],a[c+1]]);const[s,i]=t,l=i-s;return r.map(([c,u])=>[(c-s)/l+n,u])}return null}function ri(e){return xn.getPresetByName(e).OpacityPoints?{mode:Te.Mode.Points,preset:e,shift:0}:{mode:Te.Mode.Gaussians,gaussians:JSON.parse(JSON.stringify(Te.Defaults.Gaussians))}}function li(e){const t=xn.getPresetByName(e);if(!t)return null;const{AbsoluteRange:n,RGBPoints:o}=t;if(n&&o){let a=1/0,r=-1/0;for(let s=0;s<o.length;s+=4)a=Math.min(a,o[s]),r=Math.max(r,o[s]);return[a,r]}return null}const hd=[{Name:"CT-AAA",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,143.556,0,166.222,.686275,214.389,.696078,419.736,.833333,3071,.803922],RGBPoints:[-3024,0,0,0,143.556,.615686,.356863,.184314,166.222,.882353,.603922,.290196,214.389,1,1,1,419.736,1,.937033,.954531,3071,.827451,.658824,1],EffectiveRange:[143.556,419.736]},{Name:"CT-AAA2",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,129.542,0,145.244,.166667,157.02,.5,169.918,.627451,395.575,.8125,1578.73,.8125,3071,.8125],RGBPoints:[-3024,0,0,0,129.542,.54902,.25098,.14902,145.244,.6,.627451,.843137,157.02,.890196,.47451,.6,169.918,.992157,.870588,.392157,395.575,1,.886275,.658824,1578.73,1,.829256,.957922,3071,.827451,.658824,1],EffectiveRange:[0,1600]},{Name:"CT-Bone",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-16.4458,0,641.385,.715686,3071,.705882],RGBPoints:[-3024,0,0,0,-16.4458,.729412,.254902,.301961,641.385,.905882,.815686,.552941,3071,1,1,1],EffectiveRange:[-16.4458,641.385]},{Name:"CT-Bones",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-1e3,0,152.19,0,278.93,.190476,952,.2],RGBPoints:[-1e3,.3,.3,1,-488,.3,1,.3,463.28,1,0,0,659.15,1,.912535,.0374849,953,1,.3,.3],EffectiveRange:[152.19,952]},{Name:"CT-Cardiac",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-77.6875,0,94.9518,.285714,179.052,.553571,260.439,.848214,3071,.875],RGBPoints:[-3024,0,0,0,-77.6875,.54902,.25098,.14902,94.9518,.882353,.603922,.290196,179.052,1,.937033,.954531,260.439,.615686,0,0,3071,.827451,.658824,1],EffectiveRange:[-77.6875,260.439]},{Name:"CT-Cardiac2",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,42.8964,0,163.488,.428571,277.642,.776786,1587,.754902,3071,.754902],RGBPoints:[-3024,0,0,0,42.8964,.54902,.25098,.14902,163.488,.917647,.639216,.0588235,277.642,1,.878431,.623529,1587,1,1,1,3071,.827451,.658824,1],EffectiveRange:[42.8964,1587]},{Name:"CT-Cardiac3",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-86.9767,0,45.3791,.169643,139.919,.589286,347.907,.607143,1224.16,.607143,3071,.616071],RGBPoints:[-3024,0,0,0,-86.9767,0,.25098,1,45.3791,1,0,0,139.919,1,.894893,.894893,347.907,1,1,.25098,1224.16,1,1,1,3071,.827451,.658824,1],EffectiveRange:[-86.9767,1224.16]},{Name:"CT-Chest-Contrast-Enhanced",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,67.0106,0,251.105,.446429,439.291,.625,3071,.616071],RGBPoints:[-3024,0,0,0,67.0106,.54902,.25098,.14902,251.105,.882353,.603922,.290196,439.291,1,.937033,.954531,3071,.827451,.658824,1],EffectiveRange:[67.0106,439.291]},{Name:"CT-Chest-Vessels",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-1278.35,0,22.8277,.428571,439.291,.625,3071,.616071],RGBPoints:[-3024,0,0,0,-1278.35,.54902,.25098,.14902,22.8277,.882353,.603922,.290196,439.291,1,.937033,.954531,3071,.827451,.658824,1],EffectiveRange:[-1278.35,439.291]},{Name:"CT-Coronary-Arteries",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,136.47,0,159.215,.258929,318.43,.571429,478.693,.776786,3661,1],RGBPoints:[-2048,0,0,0,136.47,0,0,0,159.215,.159804,.159804,.159804,318.43,.764706,.764706,.764706,478.693,1,1,1,3661,1,1,1],EffectiveRange:[136.47,478.693]},{Name:"CT-Coronary-Arteries-2",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,142.677,0,145.016,.116071,192.174,.5625,217.24,.776786,384.347,.830357,3661,.830357],RGBPoints:[-2048,0,0,0,142.677,0,0,0,145.016,.615686,0,.0156863,192.174,.909804,.454902,0,217.24,.972549,.807843,.611765,384.347,.909804,.909804,1,3661,1,1,1],EffectiveRange:[142.677,384.347]},{Name:"CT-Coronary-Arteries-3",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,128.643,0,129.982,.0982143,173.636,.669643,255.884,.857143,584.878,.866071,3661,1],RGBPoints:[-2048,0,0,0,128.643,0,0,0,129.982,.615686,0,.0156863,173.636,.909804,.454902,0,255.884,.886275,.886275,.886275,584.878,.968627,.968627,.968627,3661,1,1,1],EffectiveRange:[128.643,584.878]},{Name:"CT-Cropped-Volume-Bone",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,-451,0,-450,1,1050,1,3661,1],RGBPoints:[-2048,0,0,0,-451,0,0,0,-450,.0556356,.0556356,.0556356,1050,1,1,1,3661,1,1,1],EffectiveRange:[-451,1050]},{Name:"CT-Fat",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-1e3,0,-100,0,-99,.15,-60,.15,-59,0,101.2,0,952,0],RGBPoints:[-1e3,.3,.3,1,-497.5,.3,1,.3,-99,0,0,1,-76.946,0,1,0,-65.481,.835431,.888889,.0165387,83.89,1,0,0,463.28,1,0,0,659.15,1,.912535,.0374849,2952,1,.300267,.299886],EffectiveRange:[-100,101.2]},{Name:"CT-Liver-Vasculature",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,149.113,0,157.884,.482143,339.96,.660714,388.526,.830357,1197.95,.839286,3661,.848214],RGBPoints:[-2048,0,0,0,149.113,0,0,0,157.884,.501961,.25098,0,339.96,.695386,.59603,.36886,388.526,.854902,.85098,.827451,1197.95,1,1,1,3661,1,1,1],EffectiveRange:[149.113,1197.95]},{Name:"CT-Lung",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-1e3,0,-600,0,-599,.15,-400,.15,-399,0,2952,0],RGBPoints:[-1e3,.3,.3,1,-600,0,0,1,-530,.134704,.781726,.0724558,-460,.929244,1,.109473,-400,.888889,.254949,.0240258,2952,1,.3,.3],EffectiveRange:[-600,-399]},{Name:"CT-MIP",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-637.62,0,700,1,3071,1],RGBPoints:[-3024,0,0,0,-637.62,1,1,1,700,1,1,1,3071,1,1,1],EffectiveRange:[-637.62,700]},{Name:"CT-Muscle",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-155.407,0,217.641,.676471,419.736,.833333,3071,.803922],RGBPoints:[-3024,0,0,0,-155.407,.54902,.25098,.14902,217.641,.882353,.603922,.290196,419.736,1,.937033,.954531,3071,.827451,.658824,1],EffectiveRange:[-155.407,419.736]},{Name:"CT-Pulmonary-Arteries",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,-568.625,0,-364.081,.0714286,-244.813,.401786,18.2775,.607143,447.798,.830357,3592.73,.839286],RGBPoints:[-2048,0,0,0,-568.625,0,0,0,-364.081,.396078,.301961,.180392,-244.813,.611765,.352941,.0705882,18.2775,.843137,.0156863,.156863,447.798,.752941,.752941,.752941,3592.73,1,1,1],EffectiveRange:[-568.625,447.798]},{Name:"CT-Soft-Tissue",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,-167.01,0,-160,1,240,1,3661,1],RGBPoints:[-2048,0,0,0,-167.01,0,0,0,-160,.0556356,.0556356,.0556356,240,1,1,1,3661,1,1,1],EffectiveRange:[-167.01,240]},{Name:"CT-Air",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,.705882,-900,.715686,-500,0,3071,0],RGBPoints:[-3024,1,1,1,-900,.2,1,1,-500,.3,.3,1,3071,0,0,0],EffectiveRange:[-1200,-200]},{Name:"CT-X-ray",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-200,0,1500,.05,3071,.05],RGBPoints:[-3024,1,1,1,3071,1,1,1],EffectiveRange:[-250,1550]},{Name:"MR-Angio",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,151.354,0,158.279,.4375,190.112,.580357,200.873,.732143,3661,.741071],RGBPoints:[-2048,0,0,0,151.354,0,0,0,158.279,.74902,.376471,0,190.112,1,.866667,.733333,200.873,.937255,.937255,.937255,3661,1,1,1],EffectiveRange:[151.354,200.873]},{Name:"MR-Default",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[0,0,20,0,40,.15,120,.3,220,.375,1024,.5],RGBPoints:[0,0,0,0,20,.168627,0,0,40,.403922,.145098,.0784314,120,.780392,.607843,.380392,220,.847059,.835294,.788235,1024,1,1,1],EffectiveRange:[0,220]},{Name:"MR-MIP",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[0,0,98.3725,0,416.637,1,2800,1],RGBPoints:[0,1,1,1,98.3725,1,1,1,416.637,1,1,1,2800,1,1,1],EffectiveRange:[0,416.637]},{Name:"MR-T2-Brain",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[0,0,36.05,0,218.302,.171429,412.406,1,641,1],RGBPoints:[0,0,0,0,98.7223,.956863,.839216,.192157,412.406,0,.592157,.807843,641,1,1,1],EffectiveRange:[0,412.406]},{Name:"DTI-FA-Brain",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[0,0,0,0,.3501,.0158,.49379,.7619,.6419,1,.992,1,.995,0,.995,0],RGBPoints:[0,1,0,0,0,1,0,0,.24974,.4941,1,0,.49949,0,.9882,1,.7492,.51764,0,1,.995,1,0,0,.995,1,0,0],EffectiveRange:[0,1]},{Name:"US-Fetal",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-10,0,0,0,270,.8],RGBPoints:[-10,.325,.153,.153,74,.474,.392,.302,136,.718,.51,.443,270,.76,.44,.53],EffectiveRange:[-10,270]},{ColorSpace:"Lab",Name:"2hot",RGBPoints:[-1,.0416667,0,0,-.873016,.208333,0,0,-.746032,.375,0,0,-.619048,.541667,0,0,-.492063,.708333,0,0,-.365079,.854137,0,0,-.238095,.937488,.039062,0,-.111111,1,.208333,0,.015873,1,.375,0,.142857,1,.541667,0,.269841,1,.708333,0,.396825,1,.858805,.03125,.52381,1,.947392,.15625,.650794,1,1,.3125,.777778,1,1,.5625,.904762,1,1,.8125,1,1,1,1]}];function yd(e){for(let t=0;t<e.length;t+=1)xn.addPreset(e[t])}yd(hd);const wd=[{group:"CT",presets:["CT-AAA","CT-AAA2","CT-Bone","CT-Bones","CT-Cardiac","CT-Cardiac2","CT-Cardiac3","CT-Chest-Contrast-Enhanced","CT-Chest-Vessels","CT-Coronary-Arteries","CT-Coronary-Arteries-2","CT-Coronary-Arteries-3","CT-Cropped-Volume-Bone","CT-Fat","CT-Liver-Vasculature","CT-Lung","CT-MIP","CT-Muscle","CT-Pulmonary-Arteries","CT-Soft-Tissue","CT-Air","CT-X-ray"]},{group:"MR",presets:["MR-Default","MR-Angio","MR-MIP","MR-T2-Brain"]},{group:"DTI",presets:["DTI-FA-Brain"]},{group:"US",presets:["US-Fetal"]}],po="CT-AAA";wd.flatMap(e=>e.presets);const Cd={PT:"2hot"};function Sd(e){const n=it().getLayer(e);if(n&&n.selection.type==="dicom"){const o=ge(),{Modality:a=void 0}=o.volumeInfo[n.selection.volumeKey];return a&&Cd[a]||po}return po}const Da=()=>({colorBy:{arrayName:"",location:"pointData"},transferFunction:{preset:"",mappingRange:[0,1]},opacityFunction:{mode:Te.Mode.Gaussians,gaussians:[],mappingRange:[0,1]},blendConfig:{opacity:.6}}),ci=ne("layerColoring",()=>{const e=Me({}),t=(g,v)=>mn(e,g,v),n=(g,v,h)=>{const w={...Da(),...t(g,v),...h};jt(e,g,v,w)},o=(g,v=bs)=>(h,w,D)=>{const b=t(h,w)??Da(),S=v({...b[g],...D});n(h,w,{[g]:S})},a=o("colorBy"),r=o("transferFunction"),s=o("opacityFunction"),i=o("blendConfig"),l=(g,v,h)=>{const D=it().layerImages[v];if(!D)return;const b=D.getPointData().getScalars().getRange(),S=li(h);r(g,v,{preset:h,mappingRange:S||b});const C=ri(h);C.mappingRange=b,s(g,v,C)},c=(g,v,h)=>{const w=h.getPointData().getScalars();a(g,v,{arrayName:w.getName()+v,location:"pointData"}),l(g,v,Sd(v))},u=g=>{delete e[g]},d=(g,v)=>{var h;v?(h=e[v])==null||delete h[g]:gn(e,g)},f=vn(e,"layers");return{configs:e,getConfig:t,updateConfig:n,updateColorBy:a,updateColorTransferFunction:r,updateOpacityFunction:s,updateBlendConfig:i,resetToDefault:c,setColorPreset:l,removeView:u,removeData:d,serialize:f,deserialize:(g,v)=>{Object.entries(v).forEach(([h,w])=>{w.layers&&n(g,h,w.layers)})}}}),zn=ne("viewCamera",()=>{const e=Me({}),t=(i,l)=>mn(e,i,l),n=(i,l,c)=>{const u={...t(i,l),...c};jt(e,i,l,u)},o=i=>{delete e[i]},a=(i,l)=>{var c;l?(c=e[l])==null||delete c[i]:gn(e,i)},r=vn(e,"camera");return{configs:e,getConfig:t,updateConfig:n,removeView:o,removeData:a,serialize:r,deserialize:(i,l)=>{Object.entries(l).forEach(([c,u])=>{u.camera&&n(i,c,u.camera)})}}}),ui=.2,di=.7,fi=.3;function _d(e){const t=ge();if(e in t.imageIDToVolumeKey){const n=t.imageIDToVolumeKey[e],{Modality:o}=t.volumeInfo[n];if(o in Ia)return Ia[o]}return po}const Aa=()=>({colorBy:{arrayName:"",location:"pointData"},transferFunction:{preset:"",mappingRange:[0,1]},opacityFunction:{mode:Te.Mode.Gaussians,gaussians:[],mappingRange:[0,1]},cvr:{enabled:!0,lightFollowsCamera:!0,volumeQuality:2,useVolumetricScatteringBlending:!0,volumetricScatteringBlending:.5,useLocalAmbientOcclusion:!0,laoKernelRadius:5,laoKernelSize:15,ambient:ui,diffuse:di,specular:fi}}),pi=ne("volumeColoring",()=>{const e=Me({}),t=(g,v)=>mn(e,g,v),n=(g,v,h)=>{const w={...Aa(),...t(g,v),...h};jt(e,g,v,w)},o=(g,v=bs)=>(h,w,D)=>{const b=t(h,w)??Aa(),S=v({...b[g],...D});n(h,w,{[g]:S})},a=o("colorBy"),r=o("transferFunction"),s=o("opacityFunction"),i=o("cvr"),l=(g,v,h)=>{const D=_e().dataIndex[v];if(!D)return;const b=D.getPointData().getScalars().getRange(),S=li(h);r(g,v,{preset:h,mappingRange:S||b});const C=ri(h);C.mappingRange=b,s(g,v,C)},c=(g,v,h)=>{const w=h.getPointData().getScalars();a(g,v,{arrayName:w.getName(),location:"pointData"}),l(g,v,_d(v))},u=g=>{delete e[g]},d=(g,v)=>{var h;v?(h=e[v])==null||delete h[g]:gn(e,g)},f=vn(e,"volumeColorConfig");return{configs:e,getConfig:t,updateConfig:n,updateColorBy:a,updateColorTransferFunction:r,updateOpacityFunction:s,updateCVRParameters:i,resetToDefaultColoring:c,setColorPreset:l,removeView:u,removeData:d,serialize:f,deserialize:(g,v)=>{Object.entries(v).forEach(([h,w])=>{w.volumeColorConfig&&n(g,h,w.volumeColorConfig)})}}}),Ta=ne("viewConfig",()=>{const e=Gt(),t=Lo(),n=ci(),o=zn(),a=pi(),r=u=>{e.removeView(u),t.removeView(u),n.removeView(u),o.removeView(u),a.removeView(u)},s=(u,d)=>{e.removeData(u,d),t.removeData(u,d),n.removeData(u,d),o.removeData(u,d),a.removeData(u,d)},i=u=>{e.serialize(u),t.serialize(u),n.serialize(u),o.serialize(u),a.serialize(u)},l=(u,d,f)=>{const m={};Object.entries(d).forEach(([g,v])=>{const h=f[g];m[h]=v}),e.deserialize(u,m),t.deserialize(u,m),n.deserialize(u,m),o.deserialize(u,m),a.deserialize(u,m)};return _e().$onAction(({name:u,args:d})=>{if(u==="deleteData"){const[f]=d;s(f)}}),{removeView:r,removeData:s,serialize:i,deserialize:l}}),ue=ne("view",{state:()=>({layout:{direction:Re.V,items:[]},viewSpecs:structuredClone(Ys)}),getters:{viewIDs(e){return Object.keys(e.viewSpecs)},getViewProxy(){return e=>this.$proxies.getView(e)},getDataRepresentationForView(){return(e,t)=>this.$proxies.getDataRepresentationForView(e,t)}},actions:{createOrGetViewProxy(e,t){return this.$proxies.getView(e)??this.$proxies.createView(e,t)},addView(e){e in this.viewSpecs||(this.viewSpecs[e]=structuredClone(Uu))},removeView(e){e in this.viewSpecs&&(delete this.viewSpecs[e],this.$proxies.removeView(e))},setLayout(e){this.layout=e;const t=[e];for(;t.length;)t.shift().items.forEach(o=>{typeof o=="string"?this.addView(o):t.push(o)})},serialize(e){const t=Ta(),{manifest:n}=e,{views:o}=n;n.layout=this.layout,Object.entries(this.viewSpecs).forEach(([a,r])=>{const s=r.viewType,{props:i}=r,c={id:a,type:s,props:i,config:{}};o.push(c)}),t.serialize(e)},deserialize(e,t){const n=Ta();e.forEach(o=>{const a=o.id,r={viewType:o.type,props:o.props};this.viewSpecs[a]=r;const{config:s}=o;n.deserialize(a,s,t)})}}}),ln=ne("crosshairs",()=>{const e=pd.newInstance(),t=e.getWidgetState(),n=t.getHandle(),o=M(!1),{currentImageID:a,currentImageMetadata:r}=ie(),s=M([0,0,0]),i=_(()=>{const w=Be();return Se(w,s.value,r.value.worldToIndex),w}),l=Gt(),c=ue(),u=_(()=>{const w=K(a);return w?c.viewIDs.filter(D=>!!l.getConfig(D,w)):[]});function d(){return e}function f(w){s.value=w}B(i,w=>{if(o.value){const D=K(a),{lpsOrientation:b}=K(r);if(!D)return;u.value.forEach(S=>{const V=l.getConfig(S,D),C=Le(V.axisDirection),R=b[C],E=Math.round(w[R]);l.updateConfig(S,D,{slice:E})})}}),B(r,w=>{t.setIndexToWorld(w.indexToWorld),t.setWorldToIndex(w.worldToIndex);const[D,b,S]=w.dimensions,V=[0,D-1,0,b-1,0,S-1];n.setBounds(Ll(V,.5))},{immediate:!0}),n.onModified(()=>{const w=n.getOrigin();w&&(s.value=w)});function m(){return t.setPlaced(!1),o.value=!0,!0}function g(){o.value=!1}function v(w){const{crosshairs:D}=w.manifest.tools;D.position=s.value}function h(w){const{crosshairs:D}=w.tools;s.value=D.position}return{getWidgetFactory:d,setPosition:f,position:s,imagePosition:i,activateTool:m,deactivateTool:g,serialize:v,deserialize:h}}),bd=4,Id=1,kt=ne("paint",()=>{const e=M(null),t=M(bd),n=M(Id),o=M([]),a=M(1),r=M(!1),{currentImageID:s}=ie();function i(){return this.$paint.factory}const l=_(()=>e.value?zt().labelmaps[e.value]??null:null);function c(C){if(!C){e.value=null;return}const R=zt(),E=Object.entries(R.parentImage).find(([,P])=>C===P);E?[e.value]=E:e.value=R.newLabelmapFromImage(C)}function u(C){t.value=Math.round(C),this.$paint.setBrushSize(C)}function d(C){n.value=C,this.$paint.setBrushValue(C)}function f(C){a.value=Math.min(1,Math.max(0,C))}function m(C){if(!l.value)return;const R=o.value.length-1;if(R>=0){const E=o.value[R],P=R>=1?o.value[R-1]:void 0;this.$paint.paintLabelmap(l.value,C,E,P)}}function g(C){if(!l.value)return;const R=l.value.getSpacing();R.splice(C,1);const E=[1/R[0],1/R[1]];this.$paint.setBrushScale(E)}function v(C,R){o.value=[Ka(C)],m.call(this,R)}function h(C,R){o.value.push(C),m.call(this,R)}function w(C,R){o.value.push(C),m.call(this,R)}function D(){const C=s.value;return C?(c(C),this.$paint.setBrushSize(this.brushSize),r.value=!0,!0):!1}function b(){e.value=null,r.value=!1}function S(C){const{paint:R}=C.manifest.tools;R.activeLabelmapID=e.value,R.brushSize=t.value,R.brushValue=n.value,R.labelmapOpacity=a.value}function V(C,R){const{paint:E}=C.tools;this.setBrushSize(E.brushSize),this.setBrushValue(E.brushValue),this.setLabelmapOpacity(E.labelmapOpacity),r.value=C.tools.current===ee.Paint,E.activeLabelmapID!==null&&(e.value=R[E.activeLabelmapID])}return B(s,C=>{r.value&&c(C)}),{activeLabelmapID:e,brushSize:t,brushValue:n,strokePoints:o,labelmapOpacity:a,isActive:r,getWidgetFactory:i,activateTool:D,deactivateTool:b,selectOrCreateLabelmap:c,setBrushSize:u,setBrushValue:d,setLabelmapOpacity:f,setSliceAxis:g,startStroke:v,placeStrokePoint:h,endStroke:w,serialize:S,deserialize:V}}),ka=Be();function jn(e,t,n){const o=(n==null?void 0:n.epsilon)??Co,a=(n==null?void 0:n.allowNonIntegralSlice)??!1,r=(n==null?void 0:n.allowOutOfBoundsSlice)??!1,{planeNormal:s,planeOrigin:i}=e,{dimensions:l,lpsOrientation:c,worldToIndex:u}=t;let d=null;const{Left:f,Right:m,Posterior:g,Anterior:v,Superior:h,Inferior:w}=c;if(Xe(f,s)||Xe(m,s)?d="Sagittal":Xe(g,s)||Xe(v,s)?d="Coronal":(Xe(h,s)||Xe(w,s))&&(d="Axial"),!d)return null;Se(ka,i,u);const D=c[d],b=vc(ka[D],o);return!a&&!Number.isInteger(b)||!r&&(b<0||b>=l[D])?null:{axis:d,slice:b}}const Dd={labelName:"New Label"},Ad=e=>{const t=M({}),n=M(),o=d=>{n.value=d},a=(d={})=>{const f=Wt().nextId();return t.value[f]={...Dd,...e,...d},o(f),f},r=d=>{if(!(d in t.value))throw new Error("Label does not exist");if(delete t.value[d],t.value={...t.value},d===n.value){const f=Object.keys(t.value);f.length!==0?o(f[0]):o("")}},s=(d,f)=>{if(!(d in t.value))throw new Error("Label does not exist");t.value={...t.value,[d]:{...t.value[d],...f}}},i=M(!0),l=()=>{i.value&&(t.value={}),i.value=!1},c=(d,f=!0)=>{f&&l();const{labelName:m}=d,g=Object.entries(t.value).find(([,{labelName:v}])=>v===m);if(g){const[v]=g;return s(v,d),v}return a(d)};return{labels:t,activeLabel:n,setActiveLabel:o,addLabel:a,deleteLabel:r,updateLabel:s,mergeLabel:c,mergeLabels:(d,f=!0)=>{Object.entries(d??{}).forEach(([m,g])=>c({...g,labelName:m},f))}}},Td=()=>({frameOfReference:{planeOrigin:[0,0,0],planeNormal:[1,0,0]},slice:-1,imageID:"",placing:!1,color:zu[0],name:"baseAnnotationTool"}),Oo=({toolDefaults:e,initialLabels:t,newLabelDefault:n})=>{const o=M([]),a=M(Object.create(null)),r=_(()=>{const h=a.value;return o.value.map(w=>h[w])}),s=Ad(n);s.mergeLabels(t,!1);function i(h){if(!h)return{labelName:""};const w=s.labels.value[h];return w||{labelName:""}}function l(h){const w=Wt().nextId();if(w in a.value)throw new Error("Cannot add tool with conflicting ID");return a.value[w]={...Td(),...e(),label:s.activeLabel.value,...h,...i(h.label),id:w},o.value.push(w),w}function c(h){h in a.value&&(yt(o.value,h),delete a.value[h])}function u(h,w){h in a.value&&(a.value[h]={...a.value[h],...w,id:h})}B(s.labels,()=>{o.value.forEach(h=>{const w=a.value[h],D=i(w.label);u(h,{...w,...D})})});function d(h){const w=a.value[h],{currentImageID:D,currentImageMetadata:b}=ie(),S=D.value;if(!S||w.imageID!==S)return;const V=jn(w.frameOfReference,b.value);if(!V)return;const C=ue(),R=C.viewIDs.filter(P=>{const q=C.viewSpecs[P].props.viewDirection;return q&&Le(q)===V.axis}),E=Gt();R.forEach(P=>{E.updateConfig(P,S,{slice:w.slice})})}const f=()=>!0,m=()=>{},g=()=>({tools:o.value.map(w=>a.value[w]).filter(w=>!w.placing).map(({imageID:w,...D})=>({imageID:Ws(w),...D})),labels:s.labels.value});function v(h,w){const D=Object.fromEntries(Object.entries((h==null?void 0:h.labels)??{}).map(([b,S])=>{const V=s.mergeLabel(S);return[b,V]}));h==null||h.tools.map(({imageID:b,label:S,...V})=>({...V,imageID:zs(w[b]),label:S&&D[S]||""})).forEach(b=>l.call(this,b))}return{...s,toolIDs:o,toolByID:a,tools:r,addTool:l,removeTool:c,updateTool:u,jumpToTool:d,activateTool:f,deactivateTool:m,serialize:g,deserialize:v}},kd=()=>({firstPoint:[0,0,0],secondPoint:[0,0,0],id:"",name:"Ruler"}),Ed={color:"#ffffff"},qe=ne("ruler",()=>{const{toolIDs:e,toolByID:t,tools:n,addTool:o,updateTool:a,removeTool:r,jumpToTool:s,serialize:i,deserialize:l,activateTool:c,deactivateTool:u,...d}=Oo({toolDefaults:kd,initialLabels:ju,newLabelDefault:Ed}),f=_(()=>{const v=t.value;return e.value.reduce((h,w)=>{const{firstPoint:D,secondPoint:b}=v[w];return Object.assign(h,{[w]:Math.sqrt(ps(D,b))})},{})});function m(v){v.manifest.tools.rulers=i()}function g(v,h){l.call(this,v.tools.rulers,h)}return{...d,rulerIDs:e,rulerByID:t,rulers:n,lengthByID:f,addRuler:o,updateRuler:a,removeRuler:r,jumpToRuler:s,serialize:m,deserialize:g,activateTool:c,deactivateTool:u}}),Rd=()=>({firstPoint:[0,0,0],secondPoint:[0,0,0],id:"",name:"Rectangle",fillColor:"transparent"}),Vd={color:"#ffffff",fillColor:"transparent"},Ze=ne("rectangles",()=>{const{serialize:e,deserialize:t,...n}=Oo({toolDefaults:Rd,initialLabels:Hu,newLabelDefault:Vd});function o(r){r.manifest.tools.rectangles=e()}function a(r,s){t.call(this,r.tools.rectangles,s)}return{...n,serialize:o,deserialize:a}});function gi(){return{t:xt(),_tInv:null}}const tn=Be(),Ea=Ha();function Hn(e,t,n){const o=n??Be();return qa(tn,e[0],e[1],0),Se(o,tn,t.t),o}function mi(e){const t=xt();return Vr(t,e),t}function Md(e){return e._tInv=e._tInv??mi(e.t),e._tInv}function vt(e,t,n){const o=n??He(),a=Md(t);return Se(tn,e,a),Bt(o,tn[0],tn[1]),o}function Pd(e){const t=[0,0,0];Se(t,t,e.t);const n=[0,0,1];return Mr(Ea,e.t),Pr(n,n,Ea),Lr(n,n),{planeNormal:n,planeOrigin:t}}const Ld={0:Yt(0,1,0,0,0,0,1,0,1,0,0,0,0,0,0,1),1:Yt(1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1),2:xt()};function $d(e,t,n){const o=xt();return $r(o,[0,0,t]),la(o,Ld[n],o),la(o,e,o),{t:o,_tInv:mi(o)}}var Ae=(e=>(e.Select="Select",e.FreehandDraw="FreehandDraw",e.CircleNudge="CircleNudge",e.PointPlacing="PointPlacing",e.Threshold="Threshold",e))(Ae||{});const Od=()=>({id:"",name:"Contour",polyLine:[],referencePlane:gi()}),Gn=ne("contour",()=>{const e=M(),t=M("FreehandDraw"),{serialize:n,deserialize:o,...a}=Oo({toolDefaults:Od,initialLabels:{"Default label":{color:"#ff0000"}},newLabelDefault:{color:"#ff0000"}});function r(l){e.value=l}function s(l){return e.value===l&&(e.value=null),a.removeTool(l)}function i(l){t.value=l}return{...a,removeTool:s,serialize:()=>{},deserialize:()=>{},selectedContourID:e,mode:t,selectContour:r,setMode:i}});function vi(e){return e===ee.Ruler?qe():e===ee.Rectangle?Ze():e===ee.Paint?kt():e===ee.Crosshairs?ln():e===ee.Contour?Gn():null}function xd(e){const t=vi(e);return t?t.activateTool():!0}function Bd(e){const t=vi(e);t&&t.deactivateTool()}const Pe=ne("tool",{state:()=>({currentTool:ee.WindowLevel}),actions:{setCurrentTool(e){xd(e)&&(Bd(this.currentTool),this.currentTool=e)},serialize(e){const{tools:t}=e.manifest,n=qe(),o=Ze(),a=ln(),r=kt(),s=Tt();n.serialize(e),o.serialize(e),a.serialize(e),r.serialize(e),s.serialize(e),t.current=this.currentTool},deserialize(e,t,n){const{tools:o}=e,a=qe(),r=Ze(),s=ln(),i=kt(),l=Tt();a.deserialize(e,n),r.deserialize(e,n),s.deserialize(e),i.deserialize(e,t),l.deserialize(e,n),this.currentTool=o.current}}}),xo="manifest.json",Fd="2.1.0";async function hi(){const e=Je(),t=ue(),n=zt(),o=Pe(),a=it(),r=new vo,s={version:Fd,datasets:[],remoteFiles:{},labelMaps:[],tools:{crosshairs:{position:[0,0,0]},paint:{activeLabelmapID:null,brushSize:8,brushValue:1,labelmapOpacity:1},crop:{},current:ee.WindowLevel},layout:{direction:Re.H,items:[]},views:[],parentToLayers:[]},i={zip:r,manifest:s};return await e.serialize(i),t.serialize(i),await n.serialize(i),o.serialize(i),await a.serialize(i),r.file(xo,JSON.stringify(s)),r.generateAsync({type:"blob"})}async function Nd(e){const t=await Eu(e);return Gs.has(t.type)?(await vo.loadAsync(t)).file(xo)!==null:!1}const Bo=(e,{done:t})=>t({dataSource:e}),Kn=async e=>{let t=e;const{fileSrc:n}=t;if(n&&n.fileType===""){const o=await Zs(n.file);o&&(t={...t,fileSrc:{...n,fileType:o}})}return t},Ud=async(e,{extra:t,done:n})=>{const{uriSrc:o}=e;if(o){const a=await new Wn([Hs,Kn,Bo]).execute(e,t);if(!a.ok)throw a.errors[0].cause;return n({dataSource:a.data[0].dataSource})}return e},Wd=async(e,{execute:t})=>{const{fileSrc:n,parent:o}=e;if(!n&&o){const a=await t(o);if(!a.ok)throw new Error("Could not process parent",{cause:wc(a.errors[0].cause)});return{...e,parent:a.data[0].dataSource}}return e},zd=async(e,{extra:t,done:n})=>{if(e.archiveSrc){const a=await new Wn([qs,Kn,Bo]).execute(e,t);if(!a.ok)throw a.errors[0].cause;return n({dataSource:a.data[0].dataSource})}return e};function jd(e,t,n){const o=n.filter(r=>Nt(r.archivePath)===Nt(e.path)).map(r=>Un(r.file)),a=t.remoteFiles[e.id]??[];return[...o,...a]}async function Hd(e,t,{extra:n,execute:o}){const a=new Map,r=t.map(c=>({...c,archivePath:Nt(c.archivePath)})),{datasets:s}=e,i={},l=new Wn([Kn,Ud,Wd,zd,Bo]);return await Promise.all(s.map(async c=>{let u=jd(c,e,r);u=await Promise.all(u.map(async m=>{const g=await l.execute(m,{...n,archiveCache:a});if(!g.ok)throw g.errors[0].cause;return g.data[0].dataSource}));const d=[],f=await Promise.all(u.map(m=>o(m,{...n,archiveCache:a,dicomDataSources:d})));if(d.length){const m=ge(),g=await m.importFiles(d);if(g.length!==1)throw new Error("Obtained more than one volume from DICOM import");const[v]=g;await m.buildVolume(v),i[c.id]=v}else if(f.length===1){if(!f[0].ok)throw f[0].errors[0].cause;const[m]=f;if(m.data.length!==1)throw new Error("Import encountered multiple volumes for a single dataset");const{dataID:g}=m.data[0];if(!g)throw new Error("Failed to import dataset");i[c.id]=g}else throw new Error("Could not load any data from the session")})),i}const Gd=async(e,{done:t,extra:n,execute:o})=>{const{fileSrc:a}=e;if(a&&await Nd(a.file)){const r=await Vo(a.file),[s,i]=Fn(d=>d.file.name===xo,r);if(s.length!==1)throw new Error("State file does not have exactly 1 manifest");const l=tu.parse(JSON.parse(await s[0].file.text()));ue().setLayout(l.layout);const c=await Hd(l,i,{extra:n,execute:o,done:t});if(l.primarySelection!==void 0){const d=c[l.primarySelection];let f;d in ge().volumeInfo?f=on(d):f=an(d),Je().setPrimarySelection(f)}ue().deserialize(l.views,c);const u=await zt().deserialize(l,i,c);return Pe().deserialize(l,u,c),it().deserialize(l,c),t()}return e},yi=T.string(),Fo=T.object({color:yi}),Kd=Fo,qd=T.intersection(Fo,T.object({fillColor:yi})),Zd=T.object({labels:T.record(Fo).or(T.null()).optional(),rulerLabels:T.record(Kd).or(T.null()).optional(),rectangleLabels:T.record(qd).or(T.null()).optional()}),Qd=async e=>{const t=new TextDecoder,n=await e.arrayBuffer(),o=t.decode(new Uint8Array(n));return Zd.parse(JSON.parse(o))},Jd=e=>{const t=n=>n===void 0?e.labels:n;qe().mergeLabels(t(e.rulerLabels)),Ze().mergeLabels(t(e.rectangleLabels))},Yd=async(e,{done:t})=>{const{fileSrc:n}=e;if((n==null?void 0:n.fileType)==="application/json"){try{const o=await Qd(n.file);Jd(o)}catch{return e}return t()}return e};function No(e){if(e.data.length===0)return null;const{dataID:t,dataType:n}=e.data[0];return t?n==="dicom"?on(t):n==="image"?an(t):null:null}function Xd(e){const t=String(e);return!t||t==="[object Object]"?"Unknown error. More details in the dev console.":t}const e1=()=>{throw new Error("Failed to handle resource")};async function Uo(e){const t=[Kn,Yd,Gd,Ou,Du,wu,Hs,qs,fu,lu,Mu,e1],n={fetchFileCache:new Map,dicomDataSources:[]},o=new Wn(t),a=await Promise.all(e.map(i=>o.execute(i,n)));if(!n.dicomDataSources.length)return a;const r={dicomSrc:{sources:n.dicomDataSources}},s={ok:!0,data:[],errors:[]};try{const i=await ge().importFiles(n.dicomDataSources);s.data.push(...i.map(l=>({dataID:l,dataType:"dicom",dataSource:r})))}catch(i){s.ok=!1,s.errors.push({message:Xd(i),cause:i,inputDataStackTrace:[r]})}return[...a.filter(i=>i.data.length),s]}const t1={name:"ToolButton",props:{icon:{type:String,required:!0},name:{type:String,required:!0},size:{type:[Number,String],default:40},buttonClass:[String,Array,Object],tooltipLocation:{type:String,default:"right"}},computed:{sizeV(){return Number(this.size)},iconSize(){return Math.floor(.6*this.sizeV)},classV(){const e=this.buttonClass;return typeof e=="string"?e:Array.isArray(e)?e.join(" "):e&&Object.keys(e).length?Object.keys(this.buttonClass).filter(t=>this.buttonClass[t]).join(" "):""}}};function n1(e,t,n,o,a,r){return k(),U(ae,wt({variant:"text",rounded:0,dark:"",height:r.sizeV,width:r.sizeV,"min-width":r.sizeV,"max-width":r.sizeV,class:r.classV},e.$attrs),{default:y(()=>[p(Z,{size:r.iconSize},{default:y(()=>[$(j(n.icon),1)]),_:1},8,["size"]),p(Ee,{location:n.tooltipLocation,activator:"parent",transition:"slide-x-transition"},{default:y(()=>[I("span",null,j(n.name),1)]),_:1},8,["location"]),De(e.$slots,"default")]),_:3},16,["height","width","min-width","max-width","class"])}const tt=H(t1,[["render",n1]]);function cn(e){Ne(()=>e.unsubscribe())}function o1(e,t=!1){const n=M(t);let o=!0;const a={position:[0,0,0],parallelScale:0};cn(e.onModified(()=>{if(o&&n.value){const i=e.getPosition(),l=e.getParallelScale();(!Xe(i,a.position)||l!==a.parallelScale)&&(n.value=!1)}}));function r(i){if(o){o=!1;try{i()}finally{o=!0}}}function s(){a.position=e.getPosition(),a.parallelScale=e.getParallelScale()}return{resizeToFit:n,ignoreResizeToFitTracking:r,resetResizeToFitTracking:s}}function a1(e){if(!e||e==="none")return 0;const t=e.match(/matrix(?:3d)?\((.+)\)/)[1].split(",").map(o=>Number(o));return e.includes("3d")?t[13]:t[5]}const s1={props:{slice:{type:Number,default:0},min:{type:Number,required:!0},max:{type:Number,required:!0},step:{type:Number,required:!0},handleHeight:{type:Number,default:20}},data(){return{maxHandlePos:0,dragging:!1,initialHandlePos:0,initialMousePosY:0,yOffset:0}},computed:{handlePosition(){const e=this.max-this.min<=0?1:this.max-this.min,t=this.maxHandlePos*((this.slice-this.min)/e);return this.dragging?this.draggingHandlePos:t},draggingHandlePos(){return Math.min(Math.max(0,this.initialHandlePos+this.yOffset),this.maxHandlePos)}},mounted(){this.updateMaxHandlePos(),this.resizeObserver=new ResizeObserver(e=>{e.length===1&&this.updateMaxHandlePos()}),this.resizeObserver.observe(this.$refs.handleContainer)},beforeUnmount(){this.resizeObserver.disconnect()},methods:{updateMaxHandlePos(){this.maxHandlePos=this.$refs.handleContainer.clientHeight-this.handleHeight},onDragStart(e){if(e.preventDefault(),this.dragging=!0,this.initialMousePosY=e.pageY,e.target===this.$refs.handle){const t=window.getComputedStyle(this.$refs.handle);this.initialHandlePos=a1(t.transform)}else{const{y:t}=this.$refs.handleContainer.getBoundingClientRect();this.initialHandlePos=Math.max(0,Math.min(this.maxHandlePos,e.pageY-t-this.handleHeight/2));const n=this.getNearestSlice(this.initialHandlePos);this.$emit("input",n)}this.yOffset=0,this.$refs.handleContainer.setPointerCapture(e.pointerId)},onDragMove(e){if(!this.$refs.handleContainer.hasPointerCapture(e.pointerId))return;e.preventDefault(),this.yOffset=e.pageY-this.initialMousePosY;const t=this.getNearestSlice(this.handlePosition);this.$emit("input",t)},onDragEnd(e){if(!this.$refs.handleContainer.hasPointerCapture(e.pointerId))return;e.preventDefault(),this.$refs.handleContainer.releasePointerCapture(e.pointerId),this.dragging=!1;const t=this.getNearestSlice(this.handlePosition);this.$emit("input",t)},getNearestSlice(e){const n=e/this.maxHandlePos*(this.max-this.min)+this.min;return Math.round(n/this.step)*this.step}}},i1=e=>(Ue("data-v-45b64a9f"),e=e(),We(),e),r1=i1(()=>I("div",{class:"slice-slider-track"},null,-1));function l1(e,t,n,o,a,r){return k(),x("div",{class:"slice-slider",ref:"handleContainer",onPointerdown:t[0]||(t[0]=(...s)=>r.onDragStart&&r.onDragStart(...s)),onPointermove:t[1]||(t[1]=(...s)=>r.onDragMove&&r.onDragMove(...s)),onPointerup:t[2]||(t[2]=(...s)=>r.onDragEnd&&r.onDragEnd(...s)),onPointercancel:t[3]||(t[3]=(...s)=>r.onDragEnd&&r.onDragEnd(...s)),onContextmenu:t[4]||(t[4]=s=>s.preventDefault())},[r1,I("div",{class:"slice-slider-handle",ref:"handle",style:Ge({height:`${n.handleHeight}px`,transform:`translate3d(0, ${r.handlePosition}px, 0)`})},null,4)],544)}const c1=H(s1,[["render",l1],["__scopeId","data-v-45b64a9f"]]),u1="_gridRoot_102tk_2",d1="_row_102tk_9",f1="_cell_102tk_16",p1="_top_102tk_20",g1="_left_102tk_21",m1="_center_102tk_25",v1="_middle_102tk_26",h1="_bottom_102tk_30",y1="_right_102tk_31",w1={gridRoot:u1,row:d1,cell:f1,top:p1,left:g1,center:m1,middle:v1,bottom:h1,right:y1},C1={};function S1(e,t){return k(),x("div",{class:re(e.$style.gridRoot)},[I("div",{class:re([e.$style.top,e.$style.row])},[I("div",{class:re([e.$style.left,e.$style.cell])},[De(e.$slots,"top-left")],2),I("div",{class:re([e.$style.center,e.$style.cell])},[De(e.$slots,"top-center")],2),I("div",{class:re([e.$style.right,e.$style.cell])},[De(e.$slots,"top-right")],2)],2),I("div",{class:re([e.$style.middle,e.$style.row])},[I("div",{class:re([e.$style.left,e.$style.cell])},[De(e.$slots,"middle-left")],2),I("div",{class:re([e.$style.center,e.$style.cell])},[De(e.$slots,"middle-center")],2),I("div",{class:re([e.$style.right,e.$style.cell])},[De(e.$slots,"middle-right")],2)],2),I("div",{class:re([e.$style.bottom,e.$style.row])},[I("div",{class:re([e.$style.left,e.$style.cell])},[De(e.$slots,"bottom-left")],2),I("div",{class:re([e.$style.center,e.$style.cell])},[De(e.$slots,"bottom-center")],2),I("div",{class:re([e.$style.right,e.$style.cell])},[De(e.$slots,"bottom-right")],2)],2)],2)}const _1={$style:w1},wi=H(C1,[["render",S1],["__cssModules",_1]]);function hn(e,t){const n=new ResizeObserver(o=>{o.length===1&&t(o[0])});return B(e,(o,a)=>{a&&n.unobserve(a),o&&n.observe(o)},{immediate:!0}),ke(()=>{const o=K(e);o&&n.unobserve(o)}),n}function be(e){return n=>{let o=null;const a=()=>{o==null||o.unsubscribe(),o=null};Ne(a),Or(e)?Ce(()=>{a(),e.value&&(o=e.value(n))}):e&&(o=e(n))}}function Dn(e){return e.map((t,n)=>({value:t,axis:n})).filter(({value:t})=>Math.abs(t)>Co).sort((t,n)=>Math.abs(n.value)-Math.abs(t.value)).map(({value:t,axis:n})=>(Math.sign(t)===1?"LPS":"RAI")[n]).join("")}function b1(e){const t=_(()=>e.value.getCamera()),n=M(""),o=M(""),a=M(""),r=M("");function s(){const l=t.value.getViewUp(),c=t.value.getDirectionOfProjection(),u=[0,0,0];ho(u,c,l);const d=l.map(m=>m*-1),f=u.map(m=>m*-1);n.value=Dn(l),r.value=Dn(u),a.value=Dn(d),o.value=Dn(f)}return be(_(()=>t.value.onModified))(s),s(),{top:n,right:r,bottom:a,left:o}}function Ci(e,t,n){const o=_(()=>n.value.orientation),a=_(()=>ks(o.value)),r=_(()=>a.value[K(e)]),s=_(()=>a.value[K(t)]);return{cameraDirVec:r,cameraUpVec:s}}function An(e,t){return Math.min(t-e,1)/256}const I1=z({name:"WindowLevelTool",props:{viewId:{type:String,required:!0}},setup(e){const{viewId:t}=Y(e),n=Lo(),o=ue(),{currentImageID:a}=ie(),r=_(()=>o.getViewProxy(t.value)),s=ai(),i=_(()=>n.getConfig(t.value,a.value)),l=_(()=>({min:1e-12,max:i.value!=null?i.value.max-i.value.min:s.max,step:i.value!=null?An(i.value.min,i.value.max):An(s.min,s.max)})),c=_(()=>({min:i.value!=null?i.value.min:s.min,max:i.value!=null?i.value.max:s.max,step:i.value!=null?An(i.value.min,i.value.max):An(s.min,s.max)})),u=_(()=>i.value!=null?i.value.width:s.width),d=_(()=>i.value!=null?i.value.level:s.level),f=gs.newInstance({button:1,scrollEnabled:!1});B(r,(g,v)=>{v&&v.getInteractorStyle2D().removeMouseManipulator(f),g&&r.value.getInteractorStyle2D().addMouseManipulator(f)},{immediate:!0}),ke(()=>{r.value.isDeleted()||r.value.getInteractorStyle2D().removeMouseManipulator(f)});function m(){f.removeAllListeners();const g=l.value,v=c.value;f.setVerticalListener(g.min,g.max,g.step,()=>u.value,h=>{a.value!=null&&n.updateConfig(t.value,a.value,{width:h})}),f.setHorizontalListener(v.min,v.max,v.step,()=>d.value,h=>{a.value!=null&&n.updateConfig(t.value,a.value,{level:h})})}return B(()=>JSON.stringify({w:l.value,l:c.value}),m,{immediate:!0}),()=>null}});function D1(e){const t=Pe();return _(()=>t.currentTool===ee.WindowLevel).value?yo(I1,e):[]}const A1=z({name:"SliceScrollTool",props:{viewId:{type:String,required:!0}},setup(e){const{viewId:t}=Y(e),n=Gt(),o=ue(),{currentImageID:a}=ie(),r=_(()=>o.getViewProxy(t.value)),s=Po(),i=_(()=>n.getConfig(t.value,a.value)),l=_(()=>({min:i.value!=null?i.value.min:s.min,max:i.value!=null?i.value.max:s.max,step:1,default:i.value!=null?i.value.slice:s.slice})),c=M(0),u=gs.newInstance({button:-1,scrollEnabled:!0});B(r,(f,m)=>{m&&m.getInteractorStyle2D().removeMouseManipulator(u),f&&r.value.getInteractorStyle2D().addMouseManipulator(u)},{immediate:!0}),ke(()=>{r.value.isDeleted()||r.value.getInteractorStyle2D().removeMouseManipulator(u)});function d(){u.removeAllListeners();const f=l.value;u.setScrollListener(f.min,f.max,f.step,()=>c.value,m=>{a.value!==null&&n.updateConfig(t.value,a.value,{slice:m})})}return B(l,f=>{c.value=f.default,d()},{immediate:!0}),()=>null}}),Si=z({name:"MouseManipulatorTool",props:{name:String,viewId:{type:String,required:!0},manipulatorClass:{type:Object,required:!0},options:{type:Array,default:()=>[]}},setup(e){const{viewId:t,options:n}=Y(e),o=ue(),a=_(()=>o.getViewProxy(t.value)),r=_(()=>a.value.isA("vtkView2DProxy")?a.value.getInteractorStyle2D():a.value.getInteractorStyle3D()),s=[];function i(l,c,u){l!==null&&(u.forEach(d=>l.removeMouseManipulator(d)),c.forEach(d=>l.addMouseManipulator(d)))}return B(n,l=>{for(;s.length>l.length;){const u=s.pop();r.value.removeMouseManipulator(u),u.delete()}const c=Array.from(s);for(let u=s.length;u<l.length;++u)s.push(e.manipulatorClass.newInstance(l[u]));l.forEach((u,d)=>{"button"in u&&s[d].setButton(u.button),s[d].setShift(!!u.shift),s[d].setControl(!!u.control)}),i(r.value,s,c)},{immediate:!0}),B(r,(l,c)=>{s.forEach(u=>{c&&c.removeMouseManipulator(u),l&&l.addMouseManipulator(u)})},{immediate:!0}),ke(()=>{a.value.isDeleted()||s.forEach(l=>r.value.removeMouseManipulator(l))}),()=>null}});function _i(e){const t=Pe(),n=[];return n.push({button:2}),n.push({button:1,shift:!0}),t.currentTool===ee.Pan&&n.push({button:1}),yo(Si,{...e,name:"PanTool",manipulatorClass:$l,options:n})}function T1(e){const t=Pe(),n=[];return n.push({button:3,flipDirection:!0}),n.push({button:1,control:!0,flipDirection:!0}),t.currentTool===ee.Zoom&&n.push({button:1,flipDirection:!0}),yo(Si,{...e,name:"ZoomTool",manipulatorClass:Ol,options:n})}var un=(e=>(e.PlacingFirst="PlacingFirst",e.PlacingSecond="PlacingSecond",e.Select="Select",e.Dragging="Dragging",e))(un||{});function Ra(e){return e.altKey||e.controlKey||e.shiftKey}function k1(e,t){t.classHierarchy.push("vtkRulerWidgetProp"),t.interactionState="Select";let n=null;A.setGet(e,t,["interactionState"]),A.setGet(e,t,["manipulator"]),A.event(e,t,"RightClickEvent"),A.event(e,t,"PlacedEvent"),e.deactivateAllHandles=()=>{t.widgetState.deactivate(),t.activeState=null},e.setFirstPoint=a=>{t.widgetState.getFirstPoint().setOrigin(a)},e.setSecondPoint=a=>{t.widgetState.getSecondPoint().setOrigin(a)};const o=e.setInteractionState;e.setInteractionState=a=>{const r=o(a);return r&&a==="PlacingFirst"&&(t.widgetState.setIsPlaced(!1),t.widgetState.getFirstPoint().setVisible(!1),t.widgetState.getSecondPoint().setVisible(!1)),r},e.resetInteractions=()=>{t._interactor.cancelAnimation(e,!0)},e.handleLeftButtonPress=a=>{var l;if(!t.manipulator||Ra(a))return A.VOID;const r=t._widgetManager.getActiveWidget();if(r&&r!==e)return A.VOID;const s=t.manipulator.handleEvent(a,t._apiSpecificRenderWindow);if(!s.length)return A.VOID;const i=e.getInteractionState();return i==="PlacingFirst"?(e.setFirstPoint(s),e.setSecondPoint(s),t.widgetState.getFirstPoint().setVisible(!0),t.widgetState.getSecondPoint().setVisible(!0),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),e.setInteractionState("PlacingSecond"),A.EVENT_ABORT):i==="PlacingSecond"?(e.setSecondPoint(s),t.widgetState.setIsPlaced(!0),e.setInteractionState("Select"),e.invokeEndInteractionEvent(),e.invokePlacedEvent(),t._interactor.cancelAnimation(e),A.EVENT_ABORT):(l=t.activeState)!=null&&l.getActive()&&t.pickable?(n=t.activeState,e.setInteractionState("Dragging"),t._apiSpecificRenderWindow.setCursor("grabbing"),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),A.EVENT_ABORT):A.VOID},e.handleMouseMove=a=>{const r=t.manipulator.handleEvent(a,t._apiSpecificRenderWindow);return r.length?e.getInteractionState()==="PlacingSecond"?(t.widgetState.getSecondPoint().setOrigin(r),t.widgetState.getSecondPoint().setVisible(!0),e.invokeInteractionEvent(),A.EVENT_ABORT):e.getInteractionState()==="Dragging"&&n?(n.setOrigin(r),e.invokeInteractionEvent(),A.EVENT_ABORT):A.VOID:A.VOID},e.handleLeftButtonRelease=a=>{if(n){const r=t.manipulator.handleEvent(a,t._apiSpecificRenderWindow);r.length&&n.setOrigin(r),n=null,e.setInteractionState("Select"),t._apiSpecificRenderWindow.setCursor("pointer"),t.widgetState.deactivate(),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent(),t._widgetManager.enablePicking()}},e.handleRightButtonPress=a=>Ra(a)||e.getInteractionState()!=="Select"||!t.activeState?A.VOID:(e.invokeRightClickEvent(a),A.EVENT_ABORT),e.grabFocus=()=>{throw new Error("grabFocus is not implemented")},e.loseFocus=()=>{throw new Error("loseFocus is not implemented")}}const E1=20;function R1(e,t,n,o){let a=n();const r=t.$subscribe(()=>{const i=n();(o?o(a,i):a!==i)&&(a=i,e.modified())}),s=e.delete;e.delete=()=>{r(),s()}}function V1(e,t,{id:n,store:o,key:a,visible:r=!0}){Object.assign(t,{id:n,_store:o,key:a}),Bn.extend(e,t,{}),ms.extend(e,t,{visible:r}),xl.extend(e,t,{scale1:E1});const s=()=>t._store.rulerByID[t.id],i=l=>t._store.updateRuler(t.id,l);e.getOrigin=()=>{var l;return(l=s())==null?void 0:l[t.key]},e.setOrigin=l=>{i({[t.key]:l}),e.modified()},R1(e,t._store,()=>{var l;return(l=s())==null?void 0:l[t.key]})}const Va=A.newInstance(V1,"vtkRulerWidgetStatePoint"),bi="points";function Ma(e,t,n){let o=t.onModified(n);const a=e.delete;e.delete=()=>{o.unsubscribe(),o=null,a()}}function M1(e,t){const n=Va({id:t.id,store:t._store,key:"firstPoint",visible:!0}),o=Va({id:t.id,store:t._store,key:"secondPoint",visible:!0});Ma(e,n,()=>e.modified()),Ma(e,o,()=>e.modified()),t.labels={[bi]:[n,o]},e.getFirstPoint=()=>n,e.getSecondPoint=()=>o}const P1=e=>({isPlaced:!1,...e});function L1(e,t,n){Object.assign(t,P1(n)),Bn.extend(e,t,n),vs.extend(e,t),A.get(e,t,["id"]),A.setGet(e,t,["isPlaced"]),A.moveToProtected(e,t,["store"]),M1(e,t)}const $1=A.newInstance(L1,"vtkRulerWidgetState");function O1(e,t){t.classHierarchy.push("vtkRulerWidget"),e.getRepresentationsForViewType=()=>[{builder:Bl,labels:[bi],initialValues:{scaleInPixels:!0}}],e.getLength=()=>{const n=t.widgetState.getFirstPoint().getOrigin(),o=t.widgetState.getSecondPoint().getOrigin();return!n||!o?0:Math.sqrt(ps(n,o))},t.manipulator=st.newInstance()}const x1={};function Ii(e,t,n={}){Object.assign(t,x1,n),On.extend(e,t,{...n,behavior:k1,widgetState:$1(n)}),A.get(e,t,["manipulator"]),O1(e,t)}const B1=A.newInstance(Ii,"vtkRulerWidget"),Di={newInstance:B1,extend:Ii};function yn(e,t,n,o){const{lpsOrientation:a}=o,r=a[Le(t)],s=a[t],i=[0,0,0];i[r]=n,Se(i,i,o.indexToWorld),e.setUserNormal(s),e.setUserOrigin(i)}const F1=z({props:{point1:Array,point2:Array,color:String,length:Number,viewId:{type:String,required:!0},textOffset:{type:Number,default:8},textSize:{type:Number,default:14}},setup(e){const{viewId:t,point1:n,point2:o,textOffset:a,length:r}=Y(e),s=M(),i=M(),l=ue(),c=_(()=>l.getViewProxy(t.value)),u=()=>{const g=c.value.getRenderer(),v=K(n),h=K(o);if(v){const w=rn(v,g);w&&(s.value={x:w[0],y:w[1]})}else s.value=null;if(h){const w=rn(h,g);w&&(i.value={x:w[0],y:w[1]})}else i.value=null};be(_(()=>c.value.getCamera().onModified))(u),B([c,n,o],u,{deep:!0,immediate:!0});const f=_(()=>{const g=K(s),v=K(i),h=a.value;return!g||!v?null:v.x>g.x?{dx:h,dy:-h,anchor:"start"}:{dx:-h,dy:-h,anchor:"end"}}),m=Rt(Pn);return hn(m,()=>{u()}),{devicePixelRatio,textdx:_(()=>{var g;return((g=f.value)==null?void 0:g.dx)??0}),textdy:_(()=>{var g;return((g=f.value)==null?void 0:g.dy)??0}),anchor:_(()=>{var g;return((g=f.value)==null?void 0:g.anchor)??"start"}),first:s,second:i,rulerLength:_(()=>{var g;return((g=r==null?void 0:r.value)==null?void 0:g.toFixed(2))??""})}}});const N1=["x1","y1","x2","y2","stroke"],U1=["cx","cy","stroke","r"],W1=["cx","cy","stroke","r"],z1=["x","y","dx","dy","text-anchor","font-size"];function j1(e,t,n,o,a,r){return k(),x("g",null,[e.first&&e.second?(k(),x("line",{key:0,x1:e.first.x,y1:e.first.y,x2:e.second.x,y2:e.second.y,stroke:e.color,"stroke-width":"1"},null,8,N1)):G("",!0),e.first?(k(),x("circle",{key:1,cx:e.first.x,cy:e.first.y,stroke:e.color,"stroke-width":"1",fill:"transparent",r:10/e.devicePixelRatio},null,8,U1)):G("",!0),e.second?(k(),x("circle",{key:2,cx:e.second.x,cy:e.second.y,stroke:e.color,"stroke-width":"1",fill:"transparent",r:10/e.devicePixelRatio,class:"handle"},null,8,W1)):G("",!0),e.second?(k(),x("text",{key:3,x:e.second.x,y:e.second.y,dx:e.textdx,dy:e.textdy,"text-anchor":e.anchor,"stroke-width":"0.75",stroke:"black",fill:"white","font-size":`${e.textSize}px`,"font-weight":"bold"},j(e.rulerLength),9,z1)):G("",!0)])}const H1=H(F1,[["render",j1],["__scopeId","data-v-85f6f954"]]),G1=z({name:"RulerWidget2D",emits:["placed","contextmenu"],props:{rulerId:{type:String,required:!0},widgetManager:{type:Object,required:!0},viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},currentSlice:{type:Number,required:!0},isPlacing:{type:Boolean,default:!1}},components:{RulerSVG2D:H1},setup(e,{emit:t}){const{rulerId:n,widgetManager:o,viewDirection:a,currentSlice:r,isPlacing:s}=Y(e),i=qe(),l=_(()=>i.rulerByID[n.value]),{currentImageID:c,currentImageMetadata:u}=ie(),d=Di.newInstance({id:n.value,store:i,isPlaced:!s.value}),f=M(null);X(()=>{f.value=o.value.addWidget(d)}),Ne(()=>{f.value&&(o.value.removeWidget(f.value),f.value.delete(),d.delete())}),B([s,f],([b,S])=>{b&&S&&S.setInteractionState(un.PlacingFirst)},{immediate:!0}),B([r,c,f],()=>{var S;const b=(S=f.value)==null?void 0:S.getWidgetState().getIsPlaced();f.value&&!b&&(f.value.resetInteractions(),f.value.setInteractionState(un.PlacingFirst))}),be(_(()=>{var b;return(b=f.value)==null?void 0:b.onPlacedEvent}))(()=>{t("placed")});let g=null;X(()=>{f.value&&(g=f.value.onRightClickEvent(b=>{const S=$o(b);S&&t("contextmenu",S)}))}),ke(()=>{g&&(g.unsubscribe(),g=null)});const v=st.newInstance();X(()=>{f.value&&f.value.setManipulator(v)}),Ce(()=>{var b;yn(v,a.value,((b=l.value)==null?void 0:b.slice)??r.value,u.value)}),B(()=>{var b;return!!f.value&&((b=l.value)==null?void 0:b.slice)===r.value},b=>{var S;(S=f.value)==null||S.setVisibility(b)},{immediate:!0}),X(()=>{f.value&&(f.value.setHandleVisibility(!1),o.value.renderWidgets())});const h=b=>{const S=M(!1),V=()=>{b.value&&(S.value=b.value.getVisible())};return be(_(()=>{var R;return(R=b.value)==null?void 0:R.onModified}))(()=>V()),Za(b,()=>V()),S},w=h(_(()=>{var b;return(b=f.value)==null?void 0:b.getWidgetState().getFirstPoint()})),D=h(_(()=>{var b;return(b=f.value)==null?void 0:b.getWidgetState().getSecondPoint()}));return{ruler:l,firstPoint:_(()=>w.value?l.value.firstPoint:void 0),secondPoint:_(()=>D.value?l.value.secondPoint:void 0),length:_(()=>i.lengthByID[l.value.id])}}});function K1(e,t,n,o,a,r){const s=F("RulerSVG2D");return Vt((k(),U(s,{"view-id":e.viewId,point1:e.firstPoint,point2:e.secondPoint,color:e.ruler.color,length:e.length},null,8,["view-id","point1","point2","color","length"])),[[Mt,e.currentSlice===e.ruler.slice]])}const q1=H(G1,[["render",K1]]),Z1=z({name:"RulerTool",props:{viewId:{type:String,required:!0},currentSlice:{type:Number,required:!0},viewDirection:{type:String,required:!0},widgetManager:{type:Object,required:!0}},components:{RulerWidget2D:q1},setup(e){const{viewDirection:t,currentSlice:n}=Y(e),o=Pe(),a=qe(),{rulers:r,activeLabel:s}=Ke(a),{currentImageID:i,currentImageMetadata:l}=ie(),c=_(()=>o.currentTool===ee.Ruler),u=_(()=>Le(t.value)),d=M(null);B(d,(b,S)=>{S!=null&&a.updateRuler(S,{placing:!1}),b!=null&&a.updateRuler(b,{placing:!0})},{immediate:!0}),B([c,i],([b,S])=>{d.value!=null&&(a.removeRuler(d.value),d.value=null),b&&S&&(d.value=a.addRuler({imageID:S,placing:!0}))},{immediate:!0}),B([s,d],([b,S])=>{S!=null&&a.updateRuler(S,{label:b,...b&&a.labels[b]})},{immediate:!0}),Ne(()=>{d.value!=null&&(a.removeRuler(d.value),d.value=null)});const f=()=>{i.value&&(d.value=a.addRuler({imageID:i.value,placing:!0}))},m=()=>{const{lpsOrientation:b,indexToWorld:S}=l.value,V=b[t.value],C=b[u.value],R=[0,0,0];return R[C]=n.value,Se(R,R,S),{planeNormal:V,planeOrigin:R}};B([n,d],([b,S])=>{S&&a.updateRuler(S,{frameOfReference:m(),slice:b})},{immediate:!0});const g=Me({show:!1,x:0,y:0,forRulerID:""}),v=(b,S)=>{[g.x,g.y]=S,g.show=!0,g.forRulerID=b},h=()=>{a.removeRuler(g.forRulerID)},w=b=>{if(!b.frameOfReference)return!1;const S=jn(b.frameOfReference,l.value,{allowOutOfBoundsSlice:!0});return!!S&&S.axis===u.value};return{rulers:_(()=>{const{lengthByID:b}=a,S=i.value;return r.value.filter(C=>C.imageID===S&&w(C)).map(C=>({...C,length:b[C.id]}))}),placingRulerID:d,contextMenu:g,openContextMenu:v,deleteRulerFromContextMenu:h,onRulerPlaced:f}}});const Q1={class:"overlay-no-events"},J1={class:"overlay-no-events"};function Y1(e,t,n,o,a,r){const s=F("RulerWidget2D");return k(),x("div",Q1,[(k(),x("svg",J1,[(k(!0),x(se,null,ce(e.rulers,i=>(k(),U(s,{key:i.id,"ruler-id":i.id,"is-placing":i.id===e.placingRulerID,"current-slice":e.currentSlice,"view-id":e.viewId,"view-direction":e.viewDirection,"widget-manager":e.widgetManager,onContextmenu:l=>e.openContextMenu(i.id,l),onPlaced:e.onRulerPlaced},null,8,["ruler-id","is-placing","current-slice","view-id","view-direction","widget-manager","onContextmenu","onPlaced"]))),128))])),p(Dt,{modelValue:e.contextMenu.show,"onUpdate:modelValue":t[0]||(t[0]=i=>e.contextMenu.show=i),class:"position-absolute",style:Ge({top:`${e.contextMenu.y}px`,left:`${e.contextMenu.x}px`}),"close-on-click":"","close-on-content-click":""},{default:y(()=>[p(It,{density:"compact"},{default:y(()=>[p(xe,{onClick:e.deleteRulerFromContextMenu},{default:y(()=>[p(we,null,{default:y(()=>[$("Delete")]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1},8,["modelValue","style"])])}const X1=H(Z1,[["render",Y1],["__scopeId","data-v-6e6ae374"]]);function e2(e,t){t.classHierarchy.push("vtkRectangleWidget")}const t2={};function Ai(e,t,n={}){Object.assign(t,t2,n);const{store:o,...a}=n,r={...o,rulerByID:o.toolByID,updateRuler:o.updateTool};Di.extend(e,t,{store:r,...a}),e2(e,t)}const n2=A.newInstance(Ai,"vtkRectangleWidget"),o2={newInstance:n2,extend:Ai},a2=z({props:{point1:Array,point2:Array,color:String,fillColor:String,viewId:{type:String,required:!0}},setup(e){const{viewId:t,point1:n,point2:o}=Y(e),a=M(),r=M(),s=ue(),i=_(()=>s.getViewProxy(t.value)),l=()=>{const f=i.value.getRenderer(),m=K(n),g=K(o);if(m){const v=rn(m,f);v&&(a.value={x:v[0],y:v[1]})}else a.value=null;if(g){const v=rn(g,f);v&&(r.value={x:v[0],y:v[1]})}else r.value=null},c=_(()=>{var h,w,D,b;const[f,m]=[((h=a.value)==null?void 0:h.x)??0,((w=a.value)==null?void 0:w.y)??0],[g,v]=[((D=r.value)==null?void 0:D.x)??f,((b=r.value)==null?void 0:b.y)??m];return{x:Math.min(f,g),y:Math.min(m,v),width:Math.abs(f-g),height:Math.abs(m-v)}});be(_(()=>i.value.getCamera().onModified))(l),B([i,n,o],l,{deep:!0,immediate:!0});const d=Rt(Pn);return hn(d,()=>{l()}),{devicePixelRatio,first:a,second:r,rectangle:c}}}),s2=["x","y","width","height","stroke","fill"],i2=["cx","cy","stroke","r"],r2=["cx","cy","stroke","r"];function l2(e,t,n,o,a,r){return k(),x("g",null,[I("rect",{x:e.rectangle.x,y:e.rectangle.y,width:e.rectangle.width,height:e.rectangle.height,stroke:e.color,"stroke-width":"1",fill:e.fillColor},null,8,s2),e.first?(k(),x("circle",{key:0,cx:e.first.x,cy:e.first.y,stroke:e.color,"stroke-width":"1",fill:"transparent",r:10/e.devicePixelRatio},null,8,i2)):G("",!0),e.second?(k(),x("circle",{key:1,cx:e.second.x,cy:e.second.y,stroke:e.color,"stroke-width":"1",fill:"transparent",r:10/e.devicePixelRatio},null,8,r2)):G("",!0)])}const c2=H(a2,[["render",l2]]),u2=Ze,d2=o2,f2=c2,p2=z({name:"RectangleWidget2D",emits:["placed","contextmenu"],props:{toolId:{type:String,required:!0},widgetManager:{type:Object,required:!0},viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},currentSlice:{type:Number,required:!0},isPlacing:{type:Boolean,default:!1}},components:{SVG2DComponent:f2},setup(e,{emit:t}){const{toolId:n,widgetManager:o,viewDirection:a,currentSlice:r,isPlacing:s}=Y(e),i=M(n.value),l=u2(),c=_(()=>l.toolByID[i.value]),{currentImageID:u,currentImageMetadata:d}=ie(),f=d2.newInstance({id:i.value,store:l,isPlaced:!s.value}),m=M(null);X(()=>{m.value=o.value.addWidget(f)}),Ne(()=>{m.value&&(o.value.removeWidget(m.value),m.value.delete(),f.delete())}),B([s,m],([S,V])=>{S&&V&&V.setInteractionState(un.PlacingFirst)},{immediate:!0}),B([r,u,m],()=>{var V;const S=(V=m.value)==null?void 0:V.getWidgetState().getIsPlaced();m.value&&!S&&(m.value.resetInteractions(),m.value.setInteractionState(un.PlacingFirst))}),be(_(()=>{var S;return(S=m.value)==null?void 0:S.onPlacedEvent}))(()=>{t("placed")});let v=null;X(()=>{m.value&&(v=m.value.onRightClickEvent(S=>{const V=$o(S);V&&t("contextmenu",V)}))}),ke(()=>{v&&(v.unsubscribe(),v=null)});const h=st.newInstance();X(()=>{m.value&&m.value.setManipulator(h)}),Ce(()=>{var S;yn(h,a.value,((S=c.value)==null?void 0:S.slice)??r.value,d.value)}),B(()=>{var S;return!!m.value&&((S=c.value)==null?void 0:S.slice)===r.value},S=>{var V;(V=m.value)==null||V.setVisibility(S)},{immediate:!0}),X(()=>{m.value&&(m.value.setHandleVisibility(!1),o.value.renderWidgets())});const w=S=>{const V=M(!1),C=()=>{S.value&&(V.value=S.value.getVisible())};return be(_(()=>{var E;return(E=S.value)==null?void 0:E.onModified}))(()=>C()),Za(S,()=>C()),V},D=w(_(()=>{var S;return(S=m.value)==null?void 0:S.getWidgetState().getFirstPoint()})),b=w(_(()=>{var S;return(S=m.value)==null?void 0:S.getWidgetState().getSecondPoint()}));return{tool:c,firstPoint:_(()=>D.value?c.value.firstPoint:void 0),secondPoint:_(()=>b.value?c.value.secondPoint:void 0)}}});function g2(e,t,n,o,a,r){const s=F("SVG2DComponent");return Vt((k(),U(s,{"view-id":e.viewId,point1:e.firstPoint,point2:e.secondPoint,color:e.tool.color,"fill-color":e.tool.fillColor},null,8,["view-id","point1","point2","color","fill-color"])),[[Mt,e.currentSlice===e.tool.slice]])}const m2=H(p2,[["render",g2]]),v2=Ze,h2=z({name:"RectangleTool",props:{viewId:{type:String,required:!0},currentSlice:{type:Number,required:!0},viewDirection:{type:String,required:!0},widgetManager:{type:Object,required:!0}},components:{RectangleWidget2D:m2},setup(e){const{viewDirection:t,currentSlice:n}=Y(e),o=Pe(),a=v2(),{tools:r,activeLabel:s}=Ke(a),{currentImageID:i,currentImageMetadata:l}=ie(),c=_(()=>o.currentTool===ee.Rectangle),u=_(()=>Le(t.value)),d=M(null);B(d,(b,S)=>{S!=null&&a.updateTool(S,{placing:!1}),b!=null&&a.updateTool(b,{placing:!0})},{immediate:!0}),B([c,i],([b,S])=>{d.value!=null&&(a.removeTool(d.value),d.value=null),b&&S&&(d.value=a.addTool({imageID:S,placing:!0}))},{immediate:!0}),B([s,d],([b,S])=>{S!=null&&a.updateTool(S,{label:b,...b&&a.labels[b]})},{immediate:!0}),Ne(()=>{d.value!=null&&(a.removeTool(d.value),d.value=null)});const f=()=>{i.value&&(d.value=a.addTool({imageID:i.value,placing:!0}))},m=()=>{const{lpsOrientation:b,indexToWorld:S}=l.value,V=b[t.value],C=b[u.value],R=[0,0,0];return R[C]=n.value,Se(R,R,S),{planeNormal:V,planeOrigin:R}};B([n,d],([b,S])=>{S&&a.updateTool(S,{frameOfReference:m(),slice:b})},{immediate:!0});const g=Me({show:!1,x:0,y:0,forToolID:""}),v=(b,S)=>{[g.x,g.y]=S,g.show=!0,g.forToolID=b},h=()=>{a.removeTool(g.forToolID)},w=b=>{if(!b.frameOfReference)return!1;const S=jn(b.frameOfReference,l.value,{allowOutOfBoundsSlice:!0});return!!S&&S.axis===u.value};return{tools:_(()=>{const b=i.value;return r.value.filter(S=>S.imageID===b&&w(S))}),placingToolID:d,contextMenu:g,openContextMenu:v,deleteToolFromContextMenu:h,onToolPlaced:f}}});const y2={class:"overlay-no-events"},w2={class:"overlay-no-events"};function C2(e,t,n,o,a,r){const s=F("RectangleWidget2D");return k(),x("div",y2,[(k(),x("svg",w2,[(k(!0),x(se,null,ce(e.tools,i=>(k(),U(s,{key:i.id,"tool-id":i.id,"is-placing":i.id===e.placingToolID,"current-slice":e.currentSlice,"view-id":e.viewId,"view-direction":e.viewDirection,"widget-manager":e.widgetManager,onContextmenu:l=>e.openContextMenu(i.id,l),onPlaced:e.onToolPlaced},null,8,["tool-id","is-placing","current-slice","view-id","view-direction","widget-manager","onContextmenu","onPlaced"]))),128))])),p(Dt,{modelValue:e.contextMenu.show,"onUpdate:modelValue":t[0]||(t[0]=i=>e.contextMenu.show=i),class:"position-absolute",style:Ge({top:`${e.contextMenu.y}px`,left:`${e.contextMenu.x}px`}),"close-on-click":"","close-on-content-click":""},{default:y(()=>[p(It,{density:"compact"},{default:y(()=>[p(xe,{onClick:e.deleteToolFromContextMenu},{default:y(()=>[p(we,null,{default:y(()=>[$("Delete")]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1},8,["modelValue","style"])])}const S2=H(h2,[["render",C2],["__scopeId","data-v-152d5701"]]),_2=32,Pa=2,b2=4;function I2(e,t){t.classHierarchy.push("vtkContourRepresentation"),t._polyData=mt.newInstance({mtime:0}),t._pdPoints=null,t._pdLines=null,t._pipelines={lines:{source:e,mapper:pn.newInstance(),actor:hs.newInstance({parentProp:e})}},t._pipelines.lines.actor.getProperty().setLineWidth(2),So.connectPipeline(t._pipelines.lines),e.addActor(t._pipelines.lines.actor),e.getRepresentationStates=(r=t.inputData[0])=>r;function n(r){var v,h;const s=r.getPolyLine(),i=r.getReferencePlane(),l=r.getPolyLineLength(),c=r.getFinalized(),u=c?1:0;if(!s||!i)return;((v=t._pdPoints)==null?void 0:v.length)!==l*3&&(t._pdPoints=new Float32Array(l*3)),((h=t._pdLines)==null?void 0:h.length)!==l+1&&(t._pdLines=new Float32Array(l+1+u));let d=0,f=0;t._pdLines[f++]=l+u;const m=He(),g=Be();for(let w=0;w<s.length;)t._pdLines[f++]=d/3,qa(m,s[w++],s[w++]),Hn(m,i,g),t._pdPoints[d++]=g[0],t._pdPoints[d++]=g[1],t._pdPoints[d++]=g[2];c&&(t._pdLines[f]=0)}let o=Pa;e.requestData=(r,s)=>{const i=e.getRepresentationStates(r[0]);n(i),t._pdPoints&&t._pdLines&&(t._polyData.getPoints().setData(t._pdPoints),t._polyData.getLines().setData(t._pdLines),t._polyData.getPoints().modified(),t._polyData.modified()),o=i.getSelected()?b2:Pa,t._pipelines.lines.actor.getProperty().setLineWidth(o),t._pipelines.lines.actor.getProperty().setColor(i.getColor()),s[0]=t._polyData},e.getSelectedState=()=>t.inputData[0];const{updateActorVisibility:a}=e;e.updateActorVisibility=(r=ma.FRONT_BUFFER,s=!0,i=!0)=>{r===ma.PICKING_BUFFER?t._pipelines.lines.actor.getProperty().setLineWidth(_2):t._pipelines.lines.actor.getProperty().setLineWidth(o),a(r,s,i)}}const D2={};function Ti(e,t,n={}){const o={...D2,...n};So.extend(e,t,o),I2(e,t)}const A2=A.newInstance(Ti,"vtkContourRepresentation"),T2={newInstance:A2,extend:Ti};var Fe=(e=>(e.Select="Select",e.Freehand="Freehand",e.Nudge="Nudge",e.PointPlacing="PointPlacing",e.Threshold="Threshold",e))(Fe||{});const te={Idle:"Idle",Moving:"Moving",FreehandDrawing:"FreehandDrawing",Nudging:"Nudging",PointPlacing:"PointPlacing",Thresholding:"Thresholding"};function he(e){return e.altKey||e.controlKey||e.shiftKey}function $e(e,t){const n=e.manipulator.handleEvent(t,e._apiSpecificRenderWindow);return(n==null?void 0:n.length)===3?n:null}function ki(e,t){const n=(t==null?void 0:t.degree)??2,o=(t==null?void 0:t.interPointSpacing)??.1,a=(t==null?void 0:t.closed)??!1,r=(t==null?void 0:t.clamped)??!1,s=e.length/3,i=[],l=He();let c=0;for(let g=0;g<e.length;g+=2){const v=[e[g],e[g+1]];i.push(v),g>0&&(c+=Qa(l,v)),xr(l,v)}a&&i.push(...i.slice(0,n+1));let u;if(r){u=[];const g=i.length;for(let v=0;v<g+n+1;v++)u.push(v)}const d=!r&&a?1-1/(s+1):1,f=(t==null?void 0:t.dt)??o/c,m=[];for(let g=0;g<1;g+=f){const v=Br(g*d,n,i,u);m.push(v[0],v[1])}return m}function k2(e,t){const n={...e};function o(){return e.getMode()===Fe.Freehand}function a(){e.setInteractionState(te.Idle),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent()}e.resetInteractionState=()=>{o()&&!e.isInteractionIdle()&&(t.widgetState.clearPolyLine(),a()),n.resetInteractionState()},e.handleLeftButtonPress=r=>{var l;if(((l=n.handleLeftButtonPress)==null?void 0:l.call(n,r))===A.EVENT_ABORT)return A.EVENT_ABORT;if(!o()||!t.manipulator||he(r))return A.VOID;if(t.widgetState.getFinalized())return A.VOID;const s=t._widgetManager.getActiveWidget();if(s&&s!==e)return A.VOID;const i=$e(t,r);return i?(e.setInteractionState(te.FreehandDrawing),t.widgetState.clearPolyLine(),t.widgetState.add3dPointToPolyLine(i),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),A.EVENT_ABORT):A.VOID},e.handleMouseMove=r=>{var i;if(((i=n.handleMouseMove)==null?void 0:i.call(n,r))===A.EVENT_ABORT)return A.EVENT_ABORT;if(!o()||e.getInteractionState()!==te.FreehandDrawing||he(r))return A.VOID;const s=$e(t,r);return s&&(t.widgetState.add3dPointToPolyLine(s),e.invokeInteractionEvent()),A.EVENT_ABORT},e.handleLeftButtonRelease=r=>{var l;if(((l=n.handleLeftButtonRelease)==null?void 0:l.call(n,r))===A.EVENT_ABORT)return A.EVENT_ABORT;if(!o()||e.getInteractionState()!==te.FreehandDrawing||he(r))return A.VOID;const s=$e(t,r);s&&t.widgetState.add3dPointToPolyLine(s);const i=ki(t.widgetState.getPolyLine(),{degree:2,interPointSpacing:.01,closed:!0,clamped:!1});return t.widgetState.setPolyLine(i),t.widgetState.setFinalized(!0),a(),A.EVENT_ABORT}}const E2=new Set([Fe.Nudge]);function R2(e,t){const n={...e};let o=[0,0],a=null;A.event(e,t,"SelectedEvent");const r=He();function s(l){if(!a)return;Fr(r,l,o);const c=t.widgetState.getPolyLine();for(let u=0;u<c.length;u+=2)c[u]=a[u]+r[0],c[u+1]=a[u+1]+r[1];t.widgetState.modified()}function i(){e.setInteractionState(te.Idle),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent()}e.resetInteractionState=()=>{e.getInteractionState()===te.Moving&&i(),n.resetInteractionState()},e.handleLeftButtonPress=l=>{var u;if(((u=n.handleLeftButtonPress)==null?void 0:u.call(n,l))===A.EVENT_ABORT)return A.EVENT_ABORT;if(he(l))return A.VOID;if(t._widgetManager.getActiveWidget()!==e)return E2.has(e.getMode())||e.invokeSelectedEvent(!1),A.VOID;e.invokeSelectedEvent(!0);const c=$e(t,l);return c?(o=vt(c,t.widgetState.getReferencePlane()),a=[...t.widgetState.getPolyLine()],e.setInteractionState(te.Moving),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),A.EVENT_ABORT):A.EVENT_ABORT},e.handleMouseMove=l=>{var u;if(((u=n.handleMouseMove)==null?void 0:u.call(n,l))===A.EVENT_ABORT)return A.EVENT_ABORT;if(!e.isSelected()||e.getInteractionState()!==te.Moving||he(l))return A.VOID;const c=$e(t,l);return c&&(s(vt(c,t.widgetState.getReferencePlane())),e.invokeInteractionEvent()),A.EVENT_ABORT},e.handleLeftButtonRelease=l=>{var u;if(((u=n.handleLeftButtonRelease)==null?void 0:u.call(n,l))===A.EVENT_ABORT)return A.EVENT_ABORT;if(e.getInteractionState()!==te.Moving||he(l))return A.VOID;const c=$e(t,l);return c&&s(vt(c,t.widgetState.getReferencePlane())),i(),A.EVENT_ABORT}}function so(e,t,n){return(e+t)%n}function V2(e,t,n){e[0]=(t[0]+n[0])/2,e[1]=(t[1]+n[1])/2}function M2(e,t,n){const{radius:o,center:a}=t,r=o**2,s=Be(),i=[0,0,0],l=[0,0];for(let c=0;c<e.length;c+=2){Bt(l,e[c],e[c+1]),Hn(l,n,i);const u=Nr(i,a);u>=r||(Ya(s,i,a),Ur(s,s,Math.sqrt(r/u)),Wr(i,a,s),vt(i,n,l),e[c]=l[0],e[c+1]=l[1])}}function P2(e,t,n){if(e.length<2)return;const o=t**2,a=n**2,r=He(),s=He(),i=He(),l=He();let c=0,u=!1,d=!1;do{let f=c;const m=so(c,2,e.length);Bt(r,e[c],e[c+1]),Bt(s,e[m],e[m+1]);const g=Ja(r,s);if(g<o)V2(i,r,s),e.splice(m,2),e.splice(c,2),e.splice(c,0,...i);else if(g>a){const h=1/(Math.ceil(Math.sqrt(g/a))+1),w=[];for(let D=h;D<1;D+=h)zr(l,r,s,D),w.push(...l);e.splice(m,0,...w),f=so(c,w.length+2,e.length)}else f=so(c,2,e.length);d=u,u=f<c,c=f}while(!d)}function L2(e,t,n,o=1e-4,a=.1){M2(e,t,n),P2(e,o,a)}function $2(e,t){let n=0,o=1/0;const a=He();for(let r=0;r<e.length;r+=2){Bt(a,e[r],e[r+1]);const s=Ja(a,t);s<o&&(n=r,o=s)}return n}const O2=.95;function x2(e,t){const n={...e};t._radius=1;function o(){return e.getMode()===Fe.Nudge}function a(s){const i=t.widgetState.getPolyLine(),l=t.widgetState.getReferencePlane();L2(i,{center:s,radius:t._radius},l),t.widgetState.modified()}function r(){e.getWidgetState().getCircleContext().setVisible(!1),e.setInteractionState(te.Idle),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent()}e.resetInteractionState=()=>{o()&&!e.isInteractionIdle()&&r(),n.resetInteractionState()},e.handleLeftButtonPress=s=>{var D;if(((D=n.handleLeftButtonPress)==null?void 0:D.call(n,s))===A.EVENT_ABORT)return A.EVENT_ABORT;if(!o()||!e.isSelected()||!t.manipulator||he(s))return A.VOID;const i=t._widgetManager.getActiveWidget();if(i&&i!==e)return A.VOID;const l=$e(t,s);if(!l)return A.VOID;const{widgetState:c}=t,u=c.getPolyLine(),d=c.getReferencePlane(),f=$2(u,vt(l,d)),m=jr(l,Hn([u[f],u[f+1]],d));t._radius=m*O2;const g=t.manipulator.getNormal(),v=t._renderer.getActiveCamera().getViewUp(),h=Be();ho(h,v,g);const w=c.getCircleContext();return w.setDirection(g),w.setUp(v),w.setRight(h),w.setOrigin(l),w.setScale3([t._radius,t._radius,1]),w.setVisible(!0),e.setInteractionState(te.Nudging),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),A.EVENT_ABORT},e.handleMouseMove=s=>{var l;if(((l=n.handleMouseMove)==null?void 0:l.call(n,s))===A.EVENT_ABORT)return A.EVENT_ABORT;if(!o()||!e.isSelected()||e.getInteractionState()!==te.Nudging||he(s))return A.VOID;const i=$e(t,s);return i&&(e.getWidgetState().getCircleContext().setOrigin(i),a(i),e.invokeInteractionEvent()),A.EVENT_ABORT},e.handleLeftButtonRelease=s=>{var l;if(((l=n.handleLeftButtonRelease)==null?void 0:l.call(n,s))===A.EVENT_ABORT)return A.EVENT_ABORT;if(!o()||!e.isSelected()||e.getInteractionState()!==te.Nudging||he(s))return A.VOID;const i=$e(t,s);return i&&a(i),r(),A.EVENT_ABORT}}function B2(e,t){const n={...e};function o(){return e.getMode()===Fe.PointPlacing}function a(){t._widgetManager.releaseFocus(),e.setInteractionState(te.Idle),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent()}function r(i){const l=t.widgetState.getPolyLine(),c=l.length-1;l[c-1]=i[0],l[c]=i[1],t.widgetState.modified()}function s(){t.widgetState.getPolyLine().splice(-2,2),t.widgetState.modified()}e.resetInteractionState=()=>{o()&&!e.isInteractionIdle()&&(t.widgetState.clearPolyLine(),a()),n.resetInteractionState()},e.handleLeftButtonPress=i=>{var d;if(((d=n.handleLeftButtonPress)==null?void 0:d.call(n,i))===A.EVENT_ABORT)return A.EVENT_ABORT;if(!o()||!t.manipulator||he(i))return A.VOID;if(t.widgetState.getFinalized())return A.VOID;const l=t._widgetManager.getActiveWidget();if(l&&l!==e)return A.VOID;const c=$e(t,i);if(!c)return A.VOID;const u=vt(c,t.widgetState.getReferencePlane());return e.getInteractionState()===te.PointPlacing?(r(u),t.widgetState.add2dPointToPolyLine(u),e.invokeInteractionEvent()):(t._widgetManager.grabFocus(e),e.setInteractionState(te.PointPlacing),t.widgetState.setFinalized(!1),t.widgetState.clearPolyLine(),t.widgetState.add2dPointToPolyLine(u),t.widgetState.add2dPointToPolyLine(u),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent()),A.EVENT_ABORT},e.handleMouseMove=i=>{var c;if(((c=n.handleMouseMove)==null?void 0:c.call(n,i))===A.EVENT_ABORT)return A.EVENT_ABORT;if(!o()||e.getInteractionState()!==te.PointPlacing||he(i))return A.VOID;const l=$e(t,i);if(l){const u=vt(l,t.widgetState.getReferencePlane());r(u),e.invokeInteractionEvent()}return A.EVENT_ABORT},e.handleRightButtonPress=i=>{var l;if(((l=n.handleRightButtonPress)==null?void 0:l.call(n,i))===A.EVENT_ABORT)return A.EVENT_ABORT;if(!o()||e.getInteractionState()!==te.PointPlacing||he(i))return A.VOID;if(s(),t.widgetState.getPolyLineLength()<=2)t.widgetState.clearPolyLine();else{const c=ki(t.widgetState.getPolyLine(),{degree:2,interPointSpacing:.01,closed:!0,clamped:!1});t.widgetState.setPolyLine(c),t.widgetState.setFinalized(!0)}return a(),A.EVENT_ABORT}}const{vtkErrorMacro:F2}=A;function N2(e,t){t.classHierarchy.push("vtkImageMarchingSquares"),e.getContourValues=()=>t.contourValues,e.setContourValues=s=>{t.contourValues=s,e.modified()};const n=[],o=[],a=[],r=Fl.newInstance();e.getPixelScalars=(s,i,l,c,u,d,f,m)=>{n[0]=l*c+i*u[0]+s,n[1]=n[0]+1,n[2]=n[0]+u[0],n[3]=n[2]+1;const g=s>=0,v=i>=0,h=s+1<u[0],w=i+1<u[1];o[0]=g&&v?m[n[0]]:0,o[1]=h&&v?m[n[1]]:0,o[2]=g&&w?m[n[2]]:0,o[3]=h&&w?m[n[3]]:0},e.getPixelPoints=(s,i,l,c,u,d)=>{a[0]=u[0]+s*d[0],a[1]=u[1]+i*d[1],a[2]=a[0]+d[0],a[3]=a[1],a[4]=a[0],a[5]=a[1]+d[1],a[6]=a[2],a[7]=a[5]},e.produceLines=(s,i,l,c,u,d,f,m,g,v,h)=>{var R;const w=[1,2,8,4],D=[];let b;e.getPixelScalars(i,l,c,u,d,f,m,g);let S=0;for(let E=0;E<4;E++)o[E]>=s&&(S|=w[E]);const V=va.getCase(S);if(V[0]<0)return;e.getPixelPoints(i,l,c,d,f,m);const C=f[2]+c*m[2];for(let E=0;V[E]>=0;E+=2){h.push(2);for(let P=0;P<2;P++){const N=va.getEdge(V[E+P]);if(b=void 0,t.mergePoints&&(b=(R=r.isInsertedEdge(n[N[0]],n[N[1]]))==null?void 0:R.value),b===void 0){const L=N[0]*2,W=a[L],Q=a[L+1],fe=N[1]*2,ve=a[fe],ze=a[fe+1];D[0]=W+.5*(ve-W),D[1]=Q+.5*(ze-Q),b=v.length/3,v.push(D[0],D[1],C),t.mergePoints&&r.insertEdge(n[N[0]],n[N[1]],b)}h.push(b)}}},e.requestData=(s,i)=>{const l=s[0];if(!l){F2("Invalid or missing input");return}const c=l.getOrigin(),u=l.getSpacing(),d=l.getDimensions(),f=l.getPointData().getScalars().getData(),m=[],g=[],v=d[0]*d[1];let h=Math.round(t.slice);h>=d[2]&&(h=0);for(let D=0;D<t.contourValues.length;++D){for(let b=-1;b<d[1];++b)for(let S=-1;S<d[0];++S)e.produceLines(t.contourValues[D],S,b,h,v,d,c,u,f,m,g);r.initialize()}const w=mt.newInstance();w.getPoints().setData(new Float32Array(m),3),w.getLines().setData(new Uint32Array(g)),i[0]=w}}const U2={contourValues:[],slice:0,mergePoints:!1};function Ei(e,t,n={}){Object.assign(t,U2,n),A.obj(e,t),A.algo(e,t,1,1),A.setGet(e,t,["slice","mergePoints"]),A.algo(e,t,1,1),N2(e,t)}const W2=A.newInstance(Ei,"vtkImageMarchingSquares"),z2={newInstance:W2,extend:Ei},Ri=2,j2=1,H2=0;function G2(e,t){const n=[...e];return n.splice(t,1),n}function K2(e,t){const[n,o]=G2(e.getDimensions(),t),a=new Uint8Array(n*o),r=ds.newInstance({values:a,numberOfComponents:1}),s=us.newInstance();return s.setDimensions([n,o,1]),s.getPointData().setScalars(r),s}function q2(e,t,n){const o=[...e];return o.splice(t,0,n),o}function En(e,t){const n=[...e];return n.splice(t,1),n}function Z2(e,t){return Qa(e,t)}function La(e,t=3){if(t>3)throw new Error("Cannot support dim > 3");const n=e.getPointData().getScalars().getData(),[o,a,r]=e.getDimensions(),s=t===3?o*a:0,i=t>=2?o:0;return{get:l=>{const c=l[0]??0,u=l[1]??0,d=l[2]??0;return n[d*s+u*i+c]},set:(l,c)=>{const u=l[0]??0,d=l[1]??0,f=l[2]??0;n[f*s+d*i+u]=c},inBounds:l=>{const c=l[0]??0,u=l[1]??0,d=l[2]??0;return c>=0&&c<o&&u>=0&&u<a&&d>=0&&d<r},fill:l=>{n.fill(l)}}}function Q2(e,t,n,o,a,r,s,i=Z2){const l=La(e,3),c=La(o,2),u=En(a,t),d=l.get(a),f=d-r,m=d+r;c.fill(H2);const g=[u];for(;g.length;){const v=g.shift();if(!c.inBounds(v)||c.get(v)!==0||i(u,v)>s)continue;c.set(v,j2);const h=q2(v,t,n),w=l.get(h);if(w<f||w>m)continue;c.set(v,Ri);const[D,b]=v;for(let S=-1;S<=1;S++)for(let V=-1;V<=1;V++)(!S&&V||S&&!V)&&g.push([D+S,b+V])}}function J2(e){const t=z2.newInstance({mergePoints:!0});return t.setContourValues([Ri]),t.setInputData(e),t.getOutputData()}Yt(0,1,0,0,0,0,1,0,1,0,0,0,0,0,0,1),Yt(1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1),Yt(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);function Y2(e,t){t.classHierarchy.push("vtkContourLoopExtraction");const n=new Set;e.traverseLoop=(o,a,r,s,i)=>{let l=r,c=s,u=!1,d=0;for(;!u;){const{cellPointIds:f}=o.getCellPoints(l);if(!f)continue;c=f[0]!==c?f[0]:f[1],d++;const m=a*d;i.push({t:m,ptId:c});const g=o.getPointCells(c);if(g.length!==2||c===s)return c;g.length===2?(l=g[0]!==l?g[0]:g[1],n.add(l)):u=!0}return c},e.computeConvexHull=(o,a)=>{const r=o.getPoints().getData(),s=[];for(let u=0;u<r.length;u+=3)s.push([r[u],r[u+1]]);const i=Hr(s,1/0),l=new r.constructor(i.length*3),c=new Uint32Array(1+i.length+1);c[0]=i.length;for(let u=0,d=0;u<i.length;u++,d+=3){const f=i[u];l[d]=f[0],l[d+1]=f[1],l[d+2]=0,c[u+1]=u}c[c.length-1]=c[1],a.getPoints().setData(l),a.getLines().setData(c)},e.extractContours=(o,a)=>{var l;const r=[];n.clear();const s=o.getLines();a.getPoints().setData(Float32Array.from(o.getPoints().getData()));for(let c=0;c<s.getNumberOfCells();c++){if(n.has(c))continue;const{cellPointIds:u}=o.getCellPoints(c);if(!u)continue;n.add(c);const d=u[0],f=[];f.push({t:0,ptId:d});const m=e.traverseLoop(o,1,c,d,f);d!==m&&(e.traverseLoop(o,-1,c,d,f),f.sort((g,v)=>g.t<v.t?-1:1),f.length&&f[0].ptId!==((l=f.at(-1))==null?void 0:l.ptId)&&f.push({...f.at(-1)})),f.length&&r.push(f)}const i=a.getLines();if(i.resize(0),e.getMergeContours()&&r.length){let c=0,u=0;r.forEach((d,f)=>{d.length>u&&(c=f,u=d.length)}),i.insertNextCell(r[c].map(d=>d.ptId))}else r.forEach(c=>{i.insertNextCell(c.map(u=>u.ptId))})},e.requestData=(o,a)=>{const[r]=o;a[0]||(a[0]=mt.newInstance());const[s]=a;e.getConvexHull()?e.computeConvexHull(r,s):e.extractContours(r,s),s.modified()}}const X2={mergeContours:!1,convexHull:!1};function Vi(e,t,n={}){Object.assign(t,X2,n),A.obj(e,t),A.algo(e,t,1,1),A.setGet(e,t,["mergeContours","convexHull"]),Y2(e,t)}const e0=A.newInstance(Vi,"vtkContourLoopExtraction"),t0={newInstance:e0,extend:Vi};function n0(e){return Array.isArray(e)?[...e]:e.constructor.from(e)}function o0(e,t){t.classHierarchy.push("vtkTransformPolyDataToPlane"),e.requestData=(n,o)=>{const a=e.getRefPlane()??gi(),[r]=n;o[0]||(o[0]=mt.newInstance());const[s]=o,i=Float32Array.from(r.getPoints().getData());s.getPoints().setData(i);const l=[0,0],c=[0,0,0];for(let d=0;d<i.length;d+=3)Bt(l,i[d],i[d+1]),Hn(l,a,c),i[d]=c[0],i[d+1]=c[1],i[d+2]=c[2];const u=r.getLines().getData();s.getLines().setData(n0(u)),s.modified()}}const a0={refPlane:null};function Mi(e,t,n={}){Object.assign(t,a0,n),A.obj(e,t),A.algo(e,t,1,1),A.setGet(e,t,["refPlane"]),o0(e,t)}const s0=A.newInstance(Mi,"vtkTransformPolyDataToPlane"),i0={newInstance:s0,extend:Mi},r0="m",l0="c",c0=2;function u0(){const e=hs.newInstance(),t=pn.newInstance(),n=e.getProperty();return e.setMapper(t),{actor:e,mapper:t,property:n}}function d0(e,t){const n={...e};t.imageData=null,t.sliceAxis=0,t.slice=0,t.loops=mt.newInstance(),t.maskBoundaryLines=mt.newInstance(),t.mergeContours=!1,t.doConvexHull=!1,t.contour=u0(),t.contour.property.setLineWidth(c0),t.contourLoopExtraction=t0.newInstance(),t.transformPolyData=i0.newInstance(),t.transformPolyData.setInputConnection(t.contourLoopExtraction.getOutputPort());function o(){t.contour.mapper.setInputData(mt.newInstance())}function a(){var w;(w=t._renderer)==null||w.addActor(t.contour.actor)}function r(){var w;(w=t._renderer)==null||w.removeActor(t.contour.actor)}function s(){const w=t.widgetState.getStore(),D=t.widgetState.getId(),b=w.toolByID[D],S=t.contourLoopExtraction.getOutputData(),V=S.getLines(),C=S.getPoints(),R=V.getData().length,E=[0,0,0];for(let P=0;P<R;){const N=V.getCell(P);P+=N.length+1;const q=[];let{length:L}=N;N[0]===N.at(-1)&&L--;for(let W=0;W<L;W++)C.getPoint(N[W],E),q.push(E[0],E[1]);w.addTool({...b,polyLine:q})}}o();let i=null,l=null,c=0,u=0,d=[0,0,0],f=[0,0,0],m=[0,0];function g(){if(!i)return;t.transformPolyData.setRefPlane(t.widgetState.getReferencePlane());const w=t.transformPolyData.getOutputData();t.contour.mapper.setInputData(w),t.contour.mapper.modified()}function v(){return e.getMode()===Fe.Threshold}function h(){r(),o(),e.getWidgetState().getCircleContext().setVisible(!1),t._widgetManager.releaseFocus(),e.setInteractionState(te.Idle),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent()}e.resetInteractionState=()=>{v()&&!e.isInteractionIdle()&&h(),n.resetInteractionState()},e.setThresholdingImageSlice=(w,D,b)=>{t.imageData=w,t.sliceAxis=D,t.slice=Math.round(b)},e.handleKeyPress=w=>{var b;if(((b=n.handleKeyPress)==null?void 0:b.call(n,w))===A.EVENT_ABORT)return A.EVENT_ABORT;if(!v()||!t.manipulator||he(w)||t.widgetState.getFinalized()||e.getInteractionState()!==te.Thresholding)return A.VOID;let D=!1;return w.key===r0?(t.mergeContours=!t.mergeContours,t.contourLoopExtraction.setMergeContours(t.mergeContours),D=!0):w.key===l0&&(t.doConvexHull=!t.doConvexHull,t.contourLoopExtraction.setConvexHull(t.doConvexHull),D=!0),D?(g(),e.invokeInteractionEvent(),A.EVENT_ABORT):A.VOID},e.handleLeftButtonPress=w=>{var V;if(((V=n.handleLeftButtonPress)==null?void 0:V.call(n,w))===A.EVENT_ABORT)return A.EVENT_ABORT;if(!v()||!t.manipulator||he(w))return A.VOID;if(!t.imageData||t.sliceAxis==null||t.slice==null)return A.VOID;if(i=t.imageData,c=t.sliceAxis,u=t.slice,l=K2(i,c),t.widgetState.getFinalized())return A.VOID;const D=t._widgetManager.getActiveWidget();if(D&&D!==e)return A.VOID;const b=$e(t,w);if(!b)return A.VOID;a(),t.mergeContours=!1;const S=t.imageData.worldToIndex(b);return d=b,f=ha(S),m=En(f,c),t._widgetManager.grabFocus(e),e.setInteractionState(te.Thresholding),t.widgetState.setFinalized(!1),t.widgetState.clearPolyLine(),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),A.EVENT_ABORT},e.handleMouseMove=w=>{var b;if(((b=n.handleMouseMove)==null?void 0:b.call(n,w))===A.EVENT_ABORT)return A.EVENT_ABORT;if(!v()||e.getInteractionState()!==te.Thresholding||he(w))return A.VOID;if(!i)return A.VOID;const D=ha(i.worldToIndex($e(t,w)));if(D&&i&&l){const S=En(D,c),V=Math.abs(S[0]-m[0]),C=Math.abs(S[1]-m[1]),R=i.getDimensions(),E=En(R,c),P=Math.sqrt(E[0]**2+R[1]**2),N=i.getPointData().getScalars().getRange(),q=N[1]-N[0],L=Math.min(C,P)/P*q;Q2(i,c,u,l,f,L,V),t.maskBoundaryLines=J2(l),t.maskBoundaryLines.buildLinks(),t.contourLoopExtraction.setInputData(t.maskBoundaryLines),g();const W=t.manipulator.getNormal(),Q=t._renderer.getActiveCamera().getViewUp(),fe=Be();ho(fe,Q,W);const ve=t.widgetState.getCircleContext();ve.setDirection(W),ve.setUp(Q),ve.setRight(fe),ve.setOrigin(d),ve.setScale3([V,C,1]),ve.setVisible(!0),e.invokeInteractionEvent()}return A.EVENT_ABORT},e.handleLeftButtonRelease=w=>{var D;return((D=n.handleLeftButtonRelease)==null?void 0:D.call(n,w))===A.EVENT_ABORT?A.EVENT_ABORT:!v()||e.getInteractionState()!==te.Thresholding||he(w)?A.VOID:(s(),h(),A.EVENT_ABORT)}}function f0(e,t){t.classHierarchy.push("vtkContourWidgetProp"),t.interactionState=te.Idle,t.mode=null,A.event(e,t,"RightClickEvent"),A.setGet(e,t,["manipulator"]),A.setGet(e,t,["mode"]),A.setGet(e,t,["interactionState"]),e.setDisplayCallback=n=>t.representations[0].setDisplayCallback(n),e.isInteractionIdle=()=>e.getInteractionState()===te.Idle,e.resetInteractionState=()=>{e.setInteractionState(te.Idle)},e.isSelected=()=>t.widgetState.getSelected(),e.handleRightButtonPress=n=>he(n)||t._widgetManager.getActiveWidget()!==e?A.VOID:(e.invokeRightClickEvent(n),A.EVENT_ABORT),R2(e,t),k2(e,t),B2(e,t),x2(e,t),d0(e,t)}function Pi(e){return`#${e.map(n=>`0${n.toString(16)}`.slice(-2)).join("")}`}function p0(e){const t=e.startsWith("#")?e.substring(1):e,n=[0,0,0,255],o=Math.min(4,t.length/2);for(let a=0;a<o;a++)n[a]=Number.parseInt(t.substring(2*a,2*a+2),16);return n}function g0(e,t,n){Bn.extend(e,t,n),Nl.extend(e,t,n),ms.extend(e,t,n),Ul.extend(e,t,n),Wl.extend(e,t,n)}const m0=A.newInstance(g0,"vtkCircleContextContourWidgetState");function v0(e,t){t.classHierarchy.push("vtkContourWidgetState"),t._circleContextState=m0(),e.bindState(t._circleContextState,["circleContext"]),e.getCircleContext=()=>t._circleContextState;function n(){return t._store.toolByID[t.id]}e.getPolyLine=()=>{var a;return Gr((a=n())==null?void 0:a.polyLine)},e.getReferencePlane=()=>{var a;return(a=n())==null?void 0:a.referencePlane},e.getPolyLineLength=()=>{var r;const a=(r=n())==null?void 0:r.polyLine;return a?a.length/2:0};const o=He();e.add3dPointToPolyLine=a=>{const r=e.getPolyLine(),s=e.getReferencePlane();!r||!s||(vt(a,s,o),e.add2dPointToPolyLine(o))},e.add2dPointToPolyLine=a=>{const r=e.getPolyLine();r&&(r.push(...a),e.modified())},e.clearPolyLine=()=>{const a=e.getPolyLine();a&&(a.length=0,e.modified())},e.setPolyLine=a=>{const r=n();r&&(r.polyLine=a,e.modified())},e.getColor=()=>{var r;const a=(r=n())==null?void 0:r.label;return a?p0(t._store.labels[a].color).map(s=>s/255):null}}const h0=e=>({finalized:!1,selected:!1,...e});function y0(e,t,n){if(Object.assign(t,h0(n)),Bn.extend(e,t,n),vs.extend(e,t),A.get(e,t,["id"]),A.setGet(e,t,["finalized","selected"]),A.moveToProtected(e,t,["store"]),A.get(e,t,["_store"]),!t.id)throw new Error("No ID provided!");if(!t._store)throw new Error("No store provided!");v0(e,t)}const w0=A.newInstance(y0,"vtkContourWidgetState");function C0(e){return w0(e)}function S0(e,t){t.classHierarchy.push("vtkContourWidget"),e.getRepresentationsForViewType=n=>{switch(n){case gt.DEFAULT:case gt.GEOMETRY:case gt.SLICE:case gt.VOLUME:default:return[{builder:T2},{builder:zl,labels:["circleContext"]}]}},e.setManipulator(t.manipulator||st.newInstance())}const _0=e=>({manipulator:null,behavior:f0,widgetState:C0(e),...e});function Li(e,t,n={}){Object.assign(t,_0(n)),On.extend(e,t,n),A.setGet(e,t,["manipulator"]),A.event(e,t,"finalized"),S0(e,t)}const b0=A.newInstance(Li,"vtkContourWidget"),I0={newInstance:b0,extend:Li},D0={[Ae.Select]:Fe.Select,[Ae.FreehandDraw]:Fe.Freehand,[Ae.CircleNudge]:Fe.Nudge,[Ae.PointPlacing]:Fe.PointPlacing,[Ae.Threshold]:Fe.Threshold},A0=z({name:"ContourWidget2D",emits:["finalize","select","contextmenu"],props:{contourId:{type:String,required:!0},widgetManager:{type:Object,required:!0},viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},currentSlice:{type:Number,required:!0},drawing:{type:Boolean,default:!1},selected:{type:Boolean,default:!1},mode:{type:String,required:!0}},setup(e,{emit:t}){const{viewId:n,contourId:o,widgetManager:a,viewDirection:r,currentSlice:s,drawing:i,selected:l,mode:c}=Y(e),u=Gn(),d=_(()=>u.toolByID[o.value]),{currentImageData:f,currentImageID:m,currentImageMetadata:g}=ie(),v=_(()=>u.$proxies.getView(n.value)),h=I0.newInstance({id:o.value,store:u,finalized:!i.value}),w=M(null),D=_(()=>{var E;return(E=w.value)==null?void 0:E.getWidgetState()});X(()=>{w.value=a.value.addWidget(h)}),Ne(()=>{w.value&&(a.value.removeWidget(w.value),w.value.delete(),h.delete())}),Ce(()=>{var P;const E=D0[c.value];(P=w.value)==null||P.setMode(E)}),B([s,m,w],()=>{var E;(E=w.value)==null||E.resetInteractionState()}),ke(()=>{var E;(E=w.value)==null||E.resetInteractionState()}),be(_(()=>{var E;return(E=w.value)==null?void 0:E.onEndInteractionEvent}))(()=>{var E;(E=w.value)!=null&&E.getWidgetState().getFinalized()&&t("finalize")}),be(_(()=>{var E;return(E=w.value)==null?void 0:E.onSelectedEvent}))(E=>{t("select",E)}),Ce(()=>{var E,P;(E=D.value)==null||E.setSelected(l.value),(P=v.value)==null||P.renderLater()});let V=null;X(()=>{w.value&&(V=w.value.onRightClickEvent(E=>{const P=$o(E);P&&t("contextmenu",P)}))}),ke(()=>{V&&(V.unsubscribe(),V=null)});const C=st.newInstance();X(()=>{var E;(E=w.value)==null||E.setManipulator(C)}),Ce(()=>{yn(C,r.value,s.value,g.value)}),B(()=>{var E;return!!v.value&&!!w.value&&((E=d.value)==null?void 0:E.slice)===s.value},E=>{var P;(P=w.value)==null||P.setVisibility(E)},{immediate:!0}),X(()=>{var E;w.value&&(w.value.setHandleVisibility(!1),a.value.renderWidgets(),(E=v.value)==null||E.renderLater())}),B(()=>{var E;return(E=w.value)==null?void 0:E.getWidgetState().getColor()},()=>{var E,P;(E=w.value)==null||E.getWidgetState().modified(),(P=v.value)==null||P.renderLater()});const R=_(()=>g.value.lpsOrientation[Le(r.value)]);return Ce(()=>{const E=f.value,P=R.value,N=s.value;w.value&&E&&w.value.setThresholdingImageSlice(E,P,N)}),()=>null}}),T0=new Set([Ae.FreehandDraw,Ae.PointPlacing,Ae.Threshold]);function k0(e,t,n=1e-6){return Math.abs(e-t)<n}const E0=z({components:{ContourWidget2D:A0},props:{viewId:{type:String,required:!0},currentSlice:{type:Number,required:!0},viewDirection:{type:String,required:!0},widgetManager:{type:Object,required:!0}},setup(e){const{viewId:t,viewDirection:n,currentSlice:o}=Y(e),a=Pe(),r=Gn(),{currentImageID:s,currentImageMetadata:i}=ie(),l=_(()=>Le(n.value)),{mode:c,selectedContourID:u}=Ke(r),d=M(null),f=_(()=>a.currentTool===ee.Contour),m=_(()=>ue().viewSpecs[t.value].viewType),g=(L,W)=>{const{toolByID:Q}=r;if(!(L in Q))return!1;const{referencePlane:fe,imageID:ve}=Q[L],ze=Pd(fe),Ct=jn(ze,i.value,{allowOutOfBoundsSlice:!0});if(!Ct)return!1;const Qn=(W==null?void 0:W.checkImageID)??!1,Sn=(W==null?void 0:W.checkSlice)??!1,{axis:Jn,slice:_n}=Ct;return Jn===l.value&&(!Qn||ve===s.value)&&(!Sn||k0(_n,o.value))},v=_(()=>r.toolIDs.filter(L=>g(L,{checkImageID:!0})).map(L=>r.toolByID[L]).filter(Boolean)),h=()=>{d.value=null},w=()=>{s.value&&!d.value&&(d.value=r.addTool({imageID:s.value}))},D=()=>{d.value!=null&&(r.removeTool(d.value),d.value=null)},{activeLabel:b}=Ke(r);B([b,d],([L,W])=>{W&&r.updateTool(W,{label:L})},{immediate:!0}),B([f,s],([L,W])=>{D(),L&&W&&w()},{immediate:!0}),B(c,L=>{D(),T0.has(L)&&w()},{immediate:!0}),Ne(()=>{D()});const S=()=>{h(),w()};function V(){const{lpsOrientation:L,indexToWorld:W}=i.value,Q=L[l.value];return $d(W,o.value,Q)}B([o,d],([L,W])=>{W&&r.updateTool(W,{slice:L,referencePlane:V()})},{immediate:!0});const C=(L,W)=>{W?r.selectContour(L):L===u.value&&r.selectContour(null)};B([o,s],()=>{const L=u.value;L&&g(L,{checkImageID:!0,checkSlice:!0})&&r.selectContour(null)}),Rn(["Delete","Backspace"],L=>{L.preventDefault(),u.value&&r.removeTool(u.value)});const R=Me({visible:!1,x:0,y:0,id:""}),E=(L,W)=>{[R.x,R.y]=W,R.visible=!0,R.id=L},P=()=>{r.removeTool(R.id)},N=_(()=>{const{id:L}=R;if(!(L in r.toolByID))return[];const W=r.toolByID[L];return Object.entries(r.labels).map(([Q,fe])=>({id:Q,name:fe.labelName,isCurrent:W.label===Q}))}),q=L=>{r.updateTool(R.id,{label:L})};return{isToolActive:f,is2D:_(()=>m.value==="2D"),contours:v,drawingContourID:d,selectedContourID:u,toolMode:_(()=>f.value?c.value:Ae.Select),contextMenu:R,contextMenuLabels:N,onContourFinalized:S,onContourSelected:C,onContextMenu:E,deleteFromContextMenu:P,setLabelFromContextMenu:q}}});const R0=e=>(Ue("data-v-7c231be9"),e=e(),We(),e),V0={key:0,class:"overlay-no-events"},M0=R0(()=>I("span",null,"Change label to...",-1));function P0(e,t,n,o,a,r){const s=F("ContourWidget2D");return e.is2D?(k(),x("div",V0,[(k(!0),x(se,null,ce(e.contours,i=>(k(),U(s,{key:i.id,"view-id":e.viewId,"current-slice":e.currentSlice,"contour-id":i.id,"view-direction":e.viewDirection,"widget-manager":e.widgetManager,drawing:e.drawingContourID===i.id,mode:e.toolMode,selected:e.selectedContourID===i.id,onFinalize:e.onContourFinalized,onSelect:l=>e.onContourSelected(i.id,l),onContextmenu:l=>e.onContextMenu(i.id,l)},null,8,["view-id","current-slice","contour-id","view-direction","widget-manager","drawing","mode","selected","onFinalize","onSelect","onContextmenu"]))),128)),p(Dt,{modelValue:e.contextMenu.visible,"onUpdate:modelValue":t[1]||(t[1]=i=>e.contextMenu.visible=i),style:Ge({position:"absolute",top:`${e.contextMenu.y}px`,left:`${e.contextMenu.x}px`}),"close-on-click":"","close-on-content-click":""},{default:y(()=>[p(It,{dense:""},{default:y(()=>[p(xe,{onClick:t[0]||(t[0]=me(()=>{},["stop"]))},{default:y(()=>[p(we,{class:"d-flex flex-row align-center justify-space-betwen"},{default:y(()=>[M0,p(Z,null,{default:y(()=>[$("mdi-chevron-right")]),_:1})]),_:1}),p(Dt,{"open-on-hover":"",activator:"parent",location:"end"},{default:y(()=>[p(It,{dense:""},{default:y(()=>[(k(!0),x(se,null,ce(e.contextMenuLabels,(i,l)=>(k(),U(xe,{key:l},{default:y(()=>[p(gl,{label:i.name,"model-value":i.isCurrent,onClick:c=>e.setLabelFromContextMenu(i.id)},null,8,["label","model-value","onClick"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),p(xe,{onClick:e.deleteFromContextMenu},{default:y(()=>[p(we,null,{default:y(()=>[$("Delete")]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1},8,["modelValue","style"])])):G("",!0)}const L0=H(E0,[["render",P0],["__scopeId","data-v-7c231be9"]]),$0=z({name:"PaintWidget2D",props:{widgetManager:{type:Object,required:!0},viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},slice:{type:Number,required:!0}},setup(e){const{widgetManager:t,viewDirection:n,slice:o,viewId:a}=Y(e),r=kt(),s=r.getWidgetFactory(),i=ue(),l=_(()=>i.getViewProxy(a.value)),c=M(),{currentImageMetadata:u}=ie(),d=_(()=>Le(n.value)),f=_(()=>u.value.lpsOrientation[d.value]),m=h=>{const{worldToIndex:w}=u.value,D=Be();return Se(D,h,w),D};X(()=>{const h=t.value;if(c.value=h.addWidget(s),!c.value)throw new Error("[PaintWidget2D] failed to create view widget")}),Ce(()=>{const h=c.value,w=u.value,D=w.lpsOrientation[d.value];h&&(h.setSlicingIndex(D),h.setIndexToWorld(w.indexToWorld),h.setWorldToIndex(w.worldToIndex))});const g=[];X(()=>{const h=c.value;g.push(h.onStartInteractionEvent(()=>{const w=h.getWidgetState(),D=m(w.getBrush().getOrigin());r.startStroke(D,f.value)}),h.onInteractionEvent(()=>{const w=h.getWidgetState(),D=m(w.getBrush().getOrigin());r.placeStrokePoint(D,f.value)}),h.onEndInteractionEvent(()=>{const w=h.getWidgetState(),D=m(w.getBrush().getOrigin());r.endStroke(D,f.value)}))}),Ne(()=>{for(;g.length;)g.pop().unsubscribe()});const v=st.newInstance();return X(()=>{c.value.setManipulator(v)}),Ce(()=>{yn(v,n.value,o.value,u.value)}),X(()=>{c.value.setVisibility(!1)}),cn(l.value.getInteractor().onMouseEnter(()=>{const h=c.value;h&&(r.setSliceAxis(f.value),h.setVisibility(!0))})),cn(l.value.getInteractor().onMouseLeave(()=>{const h=c.value;h&&h.setVisibility(!1)})),X(()=>{const h=t.value;h.renderWidgets(),h.grabFocus(c.value)}),ke(()=>{t.value.removeWidget(c.value),t.value.releaseFocus()}),()=>null}}),O0=z({name:"PaintTool",props:{viewId:{type:String,required:!0},slice:{type:Number,required:!0},viewDirection:{type:String,required:!0},widgetManager:{type:Object,required:!0}},components:{PaintWidget2D:$0},setup(){const e=kt();return{active:_(()=>e.isActive)}}});const x0={class:"overlay-no-events"};function B0(e,t,n,o,a,r){const s=F("PaintWidget2D");return k(),x("div",x0,[e.active?(k(),U(s,{key:0,slice:e.slice,"view-id":e.viewId,"view-direction":e.viewDirection,"widget-manager":e.widgetManager},null,8,["slice","view-id","view-direction","widget-manager"])):G("",!0)])}const F0=H(O0,[["render",B0],["__scopeId","data-v-5ff6d31b"]]);function $i(e,t){const n=ue(),o=_(()=>n.getViewProxy(e.value)),a=_(()=>{var u;const c=(u=t.baseImage)==null?void 0:u.value;return c?n.getDataRepresentationForView(c,e.value):null}),r=_(()=>{var u;return(((u=t.labelmaps)==null?void 0:u.value)??[]).map(d=>n.getDataRepresentationForView(d,e.value)).filter(Boolean)}),s=_(()=>{var c;return(((c=t.layers)==null?void 0:c.value)??[]).map(u=>n.getDataRepresentationForView(u,e.value)).filter(Boolean)}),i=_(()=>{var u;return(((u=t.models)==null?void 0:u.value)??[]).map(d=>n.getDataRepresentationForView(d,e.value)).filter(Boolean)}),l=_(()=>[a.value,...r.value,...s.value,...i.value].filter(Boolean));return B([o,l],([c,u],[,d])=>{if(!c)throw new Error("[useSceneBuilder] No view available");d&&_o(u,d)||(c.removeAllRepresentations(),u.forEach(f=>{c.addRepresentation(f)}),c.getRenderer().computeVisiblePropBounds(),c.renderLater())},{immediate:!0}),{baseImageRep:a,labelmapReps:r,layerReps:s,modelReps:i}}function Oi(e,t,n,...o){const a=zn();let r=!0;const s=[];o.indexOf("position")>-1&&s.push(()=>{t.value!==null&&r&&a.updateConfig(e.value,t.value,{position:n.value.getCamera().getPosition()})}),o.indexOf("viewUp")>-1&&s.push(()=>{t.value!==null&&r&&a.updateConfig(e.value,t.value,{viewUp:n.value.getCamera().getViewUp()})}),o.indexOf("focalPoint")>-1&&s.push(()=>{t.value!==null&&r&&a.updateConfig(e.value,t.value,{focalPoint:n.value.getCamera().getFocalPoint()})}),o.indexOf("directionOfProjection")>-1&&s.push(()=>{t.value!==null&&r&&a.updateConfig(e.value,t.value,{directionOfProjection:n.value.getCamera().getDirectionOfProjection()})}),o.indexOf("parallelScale")>-1&&s.push(()=>{t.value!==null&&r&&a.updateConfig(e.value,t.value,{parallelScale:n.value.getCamera().getParallelScale()})}),cn(n.value.getCamera().onModified(()=>{s.forEach(c=>c())}));function i(c){r=!1;try{c()}finally{r=!0}}function l(c){i(()=>{o.forEach(u=>{if(u==="parallelScale"&&c.parallelScale)n.value.getCamera().setParallelScale(c.parallelScale);else if(u==="position"&&c.position){const{position:d}=c;n.value.getCamera().setPosition(d[0],d[1],d[2])}else if(u==="focalPoint"&&c.focalPoint){const{focalPoint:d}=c;n.value.getCamera().setFocalPoint(d[0],d[1],d[2]),n.value.getInteractorStyle2D().setCenterOfRotation([...d]),n.value.getInteractorStyle3D().setCenterOfRotation([...d])}else if(u==="directionOfProjection"&&c.directionOfProjection){const{directionOfProjection:d}=c;n.value.getCamera().setDirectionOfProjection(d[0],d[1],d[2])}else if(u==="viewUp"&&c.viewUp){const{viewUp:d}=c;n.value.getCamera().setViewUp(d[0],d[1],d[2])}})})}return{restoreCameraConfig:l}}const N0=z({name:"CrosshairsWidget2D",props:{widgetManager:{type:Object,required:!0},viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},slice:{type:Number,required:!0}},setup(e){const{widgetManager:t,viewDirection:n,slice:o}=Y(e),r=ln().getWidgetFactory(),s=M(),{currentImageMetadata:i}=ie();X(()=>{const c=t.value;if(s.value=c.addWidget(r),!s.value)throw new Error("[PaintWidget2D] failed to create view widget")});const l=st.newInstance();return X(()=>{s.value.setManipulator(l)}),Ce(()=>{yn(l,n.value,o.value,i.value)}),X(()=>{s.value.setVisibility(!0)}),X(()=>{t.value.renderWidgets()}),ke(()=>{t.value.removeWidget(s.value)}),()=>null}}),U0=z({props:{position:Array,viewId:{type:String,required:!0}},setup(e){const{viewId:t,position:n}=Y(e),o=M(),a=ue(),r=_(()=>a.getViewProxy(t.value)),s=()=>{const c=r.value.getRenderer(),u=K(n);if(u){const d=rn(u,c);d&&(o.value={x:d[0],y:d[1]})}};be(_(()=>r.value.getCamera().onModified))(s),Ce(s);const l=Rt(Pn);return hn(l,()=>{s()}),{devicePixelRatio,x:_(()=>{var c;return(c=o.value)==null?void 0:c.x}),y:_(()=>{var c;return(c=o.value)==null?void 0:c.y})}}});const W0=["x1","x2","y2"],z0=["x1","y1","x2"],j0=["y1","x2","y2"],H0=["x1","y1","y2"];function G0(e,t,n,o,a,r){return k(),x("g",null,[e.x!=null&&e.y!=null?(k(),x("line",{key:0,x1:e.x,y1:"0%",x2:e.x,y2:e.y-8,stroke:"yellow","stroke-width":"1"},null,8,W0)):G("",!0),e.x!=null&&e.y!=null?(k(),x("line",{key:1,x1:e.x,y1:e.y+8,x2:e.x,y2:"100%",stroke:"yellow","stroke-width":"1"},null,8,z0)):G("",!0),e.x!=null&&e.y!=null?(k(),x("line",{key:2,x1:"0%",y1:e.y,x2:e.x-8,y2:e.y,stroke:"yellow","stroke-width":"1"},null,8,j0)):G("",!0),e.x!=null&&e.y!=null?(k(),x("line",{key:3,x1:e.x+8,y1:e.y,x2:"100%",y2:e.y,stroke:"yellow","stroke-width":"1"},null,8,H0)):G("",!0)])}const K0=H(U0,[["render",G0],["__scopeId","data-v-d7c70d6c"]]),q0=z({name:"CrosshairsTool",props:{viewId:{type:String,required:!0},slice:{type:Number,required:!0},viewDirection:{type:String,required:!0},widgetManager:{type:Object,required:!0}},components:{CrosshairsWidget2D:N0,CrosshairSVG2D:K0},setup(e){const{viewDirection:t,slice:n}=Y(e),o=Pe(),{position:a,imagePosition:r}=Ke(ln()),{currentImageMetadata:s}=ie(),i=_(()=>o.currentTool===ee.Crosshairs),l=_(()=>{const{lpsOrientation:c,dimensions:u}=s.value,d=Le(t.value),f=c[d],m=Ds(r.value[f],0,u[f]-1);return Math.round(m)===n.value});return{active:i,position:a,isVisible:l}}});const Z0={key:0,class:"overlay-no-events"},Q0={class:"overlay-no-events"};function J0(e,t,n,o,a,r){const s=F("CrosshairSVG2D"),i=F("CrosshairsWidget2D");return e.active?(k(),x("div",Z0,[(k(),x("svg",Q0,[Vt(p(s,{"view-id":e.viewId,position:e.position},null,8,["view-id","position"]),[[Mt,e.isVisible]])])),p(i,{slice:e.slice,"view-id":e.viewId,"view-direction":e.viewDirection,"widget-manager":e.widgetManager},null,8,["slice","view-id","view-direction","widget-manager"])])):G("",!0)}const Y0=H(q0,[["render",J0],["__scopeId","data-v-8f19f7a7"]]);var Wo=(e=>(e.Volume="View3D",e.Slice="View2D",e))(Wo||{});class X0{constructor(t){this.viewProxies=new Map,this.dataProxies=new Map,this.proxyManager=t}delete(){const t=n=>this.proxyManager.deleteProxy(n);this.viewProxies.forEach(t),this.dataProxies.forEach(t)}createView(t,n){if(this.viewProxies.has(t))throw new Error("Cannot create a view with the same ID");const o=this.proxyManager.createProxy("Views",n,{name:n});return this.viewProxies.set(t,o),o}getView(t){return this.viewProxies.get(t)}removeView(t){const n=this.viewProxies.get(t);n&&(this.proxyManager.deleteProxy(n),this.viewProxies.delete(t))}addData(t,n){if(this.dataProxies.has(t))return;const o=this.proxyManager.createProxy("Sources","TrivialProducer");o.setInputData(n),this.dataProxies.set(t,o)}getData(t){return this.dataProxies.get(t)??null}updateData(t,n){const o=this.dataProxies.get(t);o&&o.setInputData(n)}deleteData(t){const n=this.dataProxies.get(t);if(this.dataProxies.delete(t),n)this.proxyManager.deleteProxy(n);else throw new Error("Did not find proxy for ID")}getDataRepresentationForView(t,n){const o=this.dataProxies.get(t),a=this.viewProxies.get(n);return!o||!a?null:this.proxyManager.getRepresentation(o,a)}}function xi(e,t){const n=ue(),o=M(null),a=s=>{o.value=s??null},r=_(()=>n.createOrGetViewProxy(K(e),K(t)));return B(r,(s,i)=>{i.setContainer(null),s.setContainer(o.value)}),B(o,s=>{r.value.setContainer(s),r.value.modified()}),{viewProxy:r,setContainer:a}}function ef(e,t){be(_(()=>K(e).onModified))(t)}function Bi(e){const t=M(!1),n=()=>{t.value=!!K(e).getContainer()};return n(),ef(e,n),t}function Fi(e,t){const n=Bi(e);B(n,o=>{o&&t()},{immediate:!0})}function tf(e,t){const n=Bi(e);B(n,(o,a)=>{a&&!o&&t()},{immediate:!0})}function Ni(e){const t=_(()=>jl.newInstance({pickingEnabled:!1,useSvgLayer:!1,captureOn:Hl.MOUSE_MOVE}));return Fi(e,()=>{t.value.setRenderer(e.value.getRenderer()),t.value.enablePicking()}),tf(e,()=>{t.value.disablePicking()}),B(t,(n,o)=>{n&&(n.setRenderer(e.value.getRenderer()),n.enablePicking()),o&&o.delete()}),Ne(()=>{t.value.delete()}),{widgetManager:t}}function Ui(e){const t=Gt(),{currentImageMetadata:n,currentImageID:o}=ie();return _(()=>{const a=t.getConfig(K(e),o.value);if(!a)return null;const{lpsOrientation:r}=n.value,s=Le(a.axisDirection),i=[0,0,0];return i[r[s]]=a.slice,{axisName:s,axisIndex:r[s],number:a.slice,planeNormal:r[a.axisDirection],planeOrigin:i}})}function nf(e){const t=M(null),n=()=>{var a;t.value=((a=K(e))==null?void 0:a.getContainer())??null};return be(_(()=>{var a;return(a=K(e))==null?void 0:a.onModified}))(n),n(),t}function of(e,t){const n=M([]),o=_(()=>{var i,l,c;return(c=(l=(i=K(t))==null?void 0:i.getRenderWindow())==null?void 0:l.getViews())==null?void 0:c[0]}),a=nf(o),r=()=>{const i=K(e),l=K(t);i==null||!l||(n.value=i.map(c=>{const u=si(c,l);return[u[0]/devicePixelRatio,u[1]/devicePixelRatio]}))},s=be(_(()=>{var i;return(i=K(t))==null?void 0:i.getActiveCamera().onModified}));return Kr(a,r),Ce(r),s(r),r(),n}function af(e,t){const n=of(e,t);return _(()=>{var i,l;const a=n.value,r=K(t),s=(l=(i=r==null?void 0:r.getRenderWindow())==null?void 0:i.getViews())==null?void 0:l[0];if(r&&s){const[,c]=s.getViewportSize(r);return a.map(u=>[u[0],c/devicePixelRatio-u[1]])}return null})}const sf=z({props:{line:{required:!0,type:Object},clickWidth:{default:20,type:Number},outOfBounds:{default:!1,type:Boolean}},setup(){const e=M("grab"),t=M(null),n=M(0);return{onPointer:(r,s)=>{var i,l;r?(i=t.value)==null||i.setPointerCapture(s.pointerId):(l=t.value)==null||l.releasePointerCapture(s.pointerId),e.value=r?"grabbing":"grab"},onHover:r=>{n.value=r?2:0},cursor:e,grabLineEl:t,focusWidth:n}}});const rf=["x1","y1","x2","y2","stroke-width"],lf=["x1","y1","x2","y2","stroke-width","stroke-dasharray"],cf=["x1","y1","x2","y2","stroke-width"],uf=["x1","y1","x2","y2","stroke-width"];function df(e,t,n,o,a,r){return k(),x("g",null,[I("line",{x1:e.line.startEdge[0],y1:e.line.startEdge[1],x2:e.line.startCrop[0],y2:e.line.startCrop[1],"stroke-width":2+e.focusWidth,"stroke-dasharray":"6","stroke-linecap":"square",stroke:"rgba(200, 255, 0, 0.5)"},null,8,rf),I("line",{x1:e.line.startCrop[0],y1:e.line.startCrop[1],x2:e.line.endCrop[0],y2:e.line.endCrop[1],"stroke-width":2+e.focusWidth,"stroke-dasharray":e.outOfBounds?6:"none","stroke-linecap":"butt",stroke:"rgb(200, 255, 0)"},null,8,lf),I("line",{x1:e.line.endCrop[0],y1:e.line.endCrop[1],x2:e.line.endEdge[0],y2:e.line.endEdge[1],"stroke-width":2+e.focusWidth,"stroke-dasharray":"6","stroke-linecap":"square",stroke:"rgba(200, 255, 0, 0.5)"},null,8,cf),I("line",wt({ref:"grabLineEl",class:"pointer-events-all",style:{cursor:e.cursor},onPointerenter:t[0]||(t[0]=s=>e.onHover(!0)),onPointerleave:t[1]||(t[1]=s=>e.onHover(!1)),onPointerdown:t[2]||(t[2]=s=>e.onPointer(!0,s)),onPointerup:t[3]||(t[3]=s=>e.onPointer(!1,s)),x1:e.line.startEdge[0],y1:e.line.startEdge[1],x2:e.line.endEdge[0],y2:e.line.endEdge[1],fill:"none","stroke-opacity":"0","stroke-dasharray":"none","stroke-width":Number(e.$attrs["stroke-width"]||0)+e.clickWidth||0},e.$attrs),null,16,uf)])}const ff=H(sf,[["render",df],["__scopeId","data-v-926e0a5c"]]);function $a(e,t,n,o){const a=Ui(e);return _(()=>{const r=e.value,s=t.value,i=n.value,l=o.value,c=a.value;if(!r||!s||!c)return null;const u=c.axisName,[d]=bo.filter(b=>b!==s&&b!==u),f=i[s],m=i[d],g=l[d],v=i[u],h=c.number,w=h<v[0]||v[1]<h,D=b=>{const S=Ot(),V=Ot(),C=Ot(),R=Ot();return S[s]=f[b],V[s]=f[b],C[s]=f[b],R[s]=f[b],[S[d],R[d]]=g,[V[d],C[d]]=m,{startEdge:S,startCrop:V,endCrop:C,endEdge:R}};return{lowerLine:D(0),upperLine:D(1),outOfBounds:w}})}function Oa(e,t,n){const o=_(()=>{const r=e.value,{lpsOrientation:s,indexToWorld:i}=t.value;return r?[r.lowerLine.startEdge,r.lowerLine.startCrop,r.lowerLine.endCrop,r.lowerLine.endEdge,r.upperLine.startEdge,r.upperLine.startCrop,r.upperLine.endCrop,r.upperLine.endEdge].map(l=>{const c=[0,0,0];c[s.Sagittal]=l.Sagittal,c[s.Coronal]=l.Coronal,c[s.Axial]=l.Axial;const u=[0,0,0];return Se(u,c,i),u}):null}),a=af(o,n);return _(()=>{const r=e.value,s=a.value;return!r||!(s!=null&&s.length)?null:{lowerLine:{startEdge:s[0],startCrop:s[1],endCrop:s[2],endEdge:s[3]},upperLine:{startEdge:s[4],startCrop:s[5],endCrop:s[6],endEdge:s[7]},outOfBounds:r.outOfBounds}})}function pf({mouseEventToLPSPoint:e,getCropEdgePos:t,setCropEdgePos:n}){const o=M(),a=M(),r=M(Ot()),s=M(0);return{onPointerDown:(u,d,f)=>{const m=e(f);m&&(r.value=m,s.value=t(u,d),o.value=u,a.value=d)},onPointerMove:u=>{if(o.value==null||a.value==null)return;const d=o.value,f=e(u);if(!f)return;const m=f[d]-r.value[d];n(d,a.value,s.value+m)},onPointerUp:()=>{o.value=null,a.value=null}}}const gf=z({props:{viewId:{required:!0,type:String}},components:{Crop2DLineHandle:ff},setup(e){const{viewId:t}=Y(e),n=ue(),o=_(()=>n.getViewProxy(t.value)),a=_(()=>{var C;return(C=o.value)==null?void 0:C.getRenderer()}),{currentImageExtent:r,currentImageID:s,currentImageMetadata:i}=ie(),l=Ui(t),c=_(()=>{var C;return((C=l.value)==null?void 0:C.axisName)??null}),u=Tt(),d=_(()=>{const C=s.value;return C&&C in u.croppingByImageID?u.croppingByImageID[C]:As()}),f=_(()=>bo.filter(C=>c.value&&C!==c.value)),m=_(()=>f.value[0]??null),g=_(()=>f.value[1]??null),v=$a(t,m,d,r),h=$a(t,g,d,r),w=Oa(v,i,a),D=Oa(h,i,a),{onPointerDown:b,onPointerMove:S,onPointerUp:V}=pf({mouseEventToLPSPoint(C){const R=a.value;if(!R)return null;const E=l.value;if(!E)return null;const{lpsOrientation:P,worldToIndex:N}=i.value,q=vd(C,R,E.planeOrigin,E.planeNormal);if(!q)return null;Se(q,q,N);const L=Ot();return L.Sagittal=q[P.Sagittal],L.Coronal=q[P.Coronal],L.Axial=q[P.Axial],L},getCropEdgePos(C,R){return d.value[C][R]},setCropEdgePos(C,R,E){if(!s.value)return;const P=d.value,[N,q]=P[C],[L,W]=r.value[C],Q=[N,q];R===0?Q[0]=Math.max(L,Math.min(E,q)):R===1&&(Q[1]=Math.max(N,Math.min(E,W))),u.setCroppingForAxis(s.value,C,Q)}});return{ax1:_(()=>({name:m.value,lines:w.value})),ax2:_(()=>({name:g.value,lines:D.value})),onPointerDown:b,onPointerMove:S,onPointerUp:V}}});function mf(e,t,n,o,a,r){const s=F("crop-2D-line-handle");return k(),x("g",null,[e.ax1.lines!=null?(k(),x(se,{key:0},[p(s,{line:e.ax1.lines.lowerLine,"out-of-bounds":e.ax1.lines.outOfBounds,onPointerdown:t[0]||(t[0]=i=>e.onPointerDown(e.ax1.name,0,i)),onPointermove:e.onPointerMove,onPointerup:e.onPointerUp},null,8,["line","out-of-bounds","onPointermove","onPointerup"]),p(s,{line:e.ax1.lines.upperLine,"out-of-bounds":e.ax1.lines.outOfBounds,onPointerdown:t[1]||(t[1]=i=>e.onPointerDown(e.ax1.name,1,i)),onPointermove:e.onPointerMove,onPointerup:e.onPointerUp},null,8,["line","out-of-bounds","onPointermove","onPointerup"])],64)):G("",!0),e.ax2.lines!=null?(k(),x(se,{key:1},[p(s,{line:e.ax2.lines.lowerLine,"out-of-bounds":e.ax2.lines.outOfBounds,onPointerdown:t[2]||(t[2]=i=>e.onPointerDown(e.ax2.name,0,i)),onPointermove:e.onPointerMove,onPointerup:e.onPointerUp},null,8,["line","out-of-bounds","onPointermove","onPointerup"]),p(s,{line:e.ax2.lines.upperLine,"out-of-bounds":e.ax2.lines.outOfBounds,onPointerdown:t[3]||(t[3]=i=>e.onPointerDown(e.ax2.name,1,i)),onPointermove:e.onPointerMove,onPointerup:e.onPointerUp},null,8,["line","out-of-bounds","onPointermove","onPointerup"])],64)):G("",!0)])}const vf=H(gf,[["render",mf],["__scopeId","data-v-e3a0b15f"]]);function hf(e){return e.Sagittal[0]<=e.Sagittal[1]&&e.Coronal[0]<=e.Coronal[1]&&e.Axial[0]<=e.Axial[1]}function yf(e,t){return e.Axial[0]===t.Axial[0]&&e.Axial[1]===t.Axial[1]&&e.Sagittal[0]===t.Sagittal[0]&&e.Sagittal[1]===t.Sagittal[1]&&e.Coronal[0]===t.Coronal[0]&&e.Coronal[1]===t.Coronal[1]}const wf=z({props:{viewId:{type:String,required:!0}},setup(e){const{viewId:t}=Y(e),n=Rt(as);if(!n)throw new Error("Crop3D component cannot access the 2D widget manager.");const o=ue(),a=_(()=>o.getViewProxy(t.value)),r=Tt(),{currentImageID:s,currentImageMetadata:i}=ie(),l=_(()=>{const g=s.value;return g&&g in r.croppingByImageID?r.croppingByImageID[g]:null}),c=Gl.newInstance(),u=c.getWidgetState();c.setEdgeHandlesEnabled(!1),c.setFaceHandlesEnabled(!0),c.setCornerHandlesEnabled(!0);const d=M();B(n,(g,v)=>{v&&v.removeWidget(c),g&&(d.value=g.addWidget(c))}),Fi(a,()=>{n.value&&(d.value=n.value.addWidget(c),d.value.getRepresentations().forEach(g=>{g.getActors().forEach(v=>{v.getProperty().setAmbient(1)})}),a.value.renderLater())}),ke(()=>{n.value&&n.value.removeWidget(c)}),B(i,g=>{u.setWorldToIndexT(g.worldToIndex),u.setIndexToWorldT(g.indexToWorld),u.placeWidget(g.worldBounds)},{immediate:!0});const f=g=>{const{lpsOrientation:v}=i.value,h=[0,0,0,0,0,0];bo.forEach(w=>{[h[v[w]*2],h[v[w]*2+1]]=g[w]}),_o(h,u.getCroppingPlanes().getPlanes())||(u.getCroppingPlanes().setPlanes(h),a.value.renderLater())};return B(l,g=>{g&&f(g)},{immediate:!0}),be(u.getCroppingPlanes().onModified)(()=>{const g=s.value;if(!g)return;const v=u.getCroppingPlanes().getPlanes(),{lpsOrientation:h}=i.value,w={Sagittal:at(v,"Sagittal",h),Coronal:at(v,"Coronal",h),Axial:at(v,"Axial",h)},D=l.value;D&&yf(w,D)||(hf(w)?r.setCropping(g,w):D&&f(D))}),()=>null}}),Cf=z({props:{viewId:{type:String,required:!0}},components:{Crop2D:vf,Crop3D:wf},setup(e){const{viewId:t}=Y(e),{currentImageID:n}=ie(),o=Tt(),a=Pe(),r=_(()=>a.currentTool===ee.Crop);B(n,i=>{i&&!(i in o.croppingByImageID)&&o.resetCropping(i)},{immediate:!0});const s=_(()=>ue().viewSpecs[t.value].viewType);return{active:r,viewType:s}}});const Sf={class:"overlay-no-events"};function _f(e,t,n,o,a,r){const s=F("crop-2D"),i=F("crop-3D");return k(),x("svg",Sf,[e.active&&e.viewType==="2D"?(k(),U(s,{key:0,"view-id":e.viewId},null,8,["view-id"])):G("",!0),e.active&&e.viewType==="3D"?(k(),U(i,{key:1,"view-id":e.viewId},null,8,["view-id"])):G("",!0)])}const Wi=H(Cf,[["render",_f],["__scopeId","data-v-c08e53d9"]]),xa="ProxyManager";function bf(e){const t=Rt("ProxyManager");return t?e(t):null}function zi(e=xa){return Rt(e??xa)}const Ba={ArrowLeft:-1,ArrowRight:1,ArrowUp:-1,ArrowDown:1},If=z({name:"VtkTwoView",props:{id:{type:String,required:!0},viewDirection:{type:String,required:!0},viewUp:{type:String,required:!0}},components:{SliceSlider:c1,ViewOverlayGrid:wi,WindowLevelTool:D1,SliceScrollTool:A1,PanTool:_i,ZoomTool:T1,RulerTool:X1,RectangleTool:S2,PaintTool:F0,CrosshairsTool:Y0,CropTool:Wi,ContourTool:L0},setup(e){const t=Lo(),n=Gt(),o=zn(),a=ci(),r=kt(),{id:s,viewDirection:i,viewUp:l}=Y(e),c=M(),u=_(()=>Le(i.value)),{currentImageData:d,currentImageID:f,currentImageMetadata:m,isImageLoading:g,currentLayers:v}=ie(),h=ge(),w=Po(),D=_(()=>n.getConfig(s.value,f.value)),b=_(()=>{var O;return((O=D.value)==null?void 0:O.slice)??w.slice}),S=_(()=>{var O;return((O=D.value)==null?void 0:O.min)??w.min}),V=_(()=>{var O;return((O=D.value)==null?void 0:O.max)??w.max}),C=_({get:()=>t.getConfig(s.value,f.value),set:O=>{const J=f.value;J!==null&&O!=null&&t.updateConfig(s.value,J,O)}}),R=_(()=>{var O;return(O=C.value)==null?void 0:O.width}),E=_(()=>{var O;return(O=C.value)==null?void 0:O.level}),P=_(()=>{if(f.value!==null&&f.value in h.imageIDToVolumeKey){const O=h.imageIDToVolumeKey[f.value],J=h.volumeInfo[O],ye=h.volumeStudy[O],Ie=h.studyInfo[ye],rt=h.studyPatient[ye],Xn=h.patientInfo[rt].PatientID,In=Ie.StudyID,je=Ie.StudyDescription,Zt=J.SeriesNumber,_t=J.SeriesDescription;return{patientID:Xn,studyID:In,studyDescription:je,seriesNumber:Zt,seriesDescription:_t}}return null}),N=_(()=>{const{lpsOrientation:O,dimensions:J}=m.value,ye=O[u.value];return{min:0,max:J[ye]-1}}),q=O=>{f.value!==null&&n.updateConfig(s.value,f.value,{slice:O})},{viewProxy:L,setContainer:W}=xi(s,Wo.Slice);qr(()=>{L.value.getInteractorStyle2D().removeAllManipulators()}),X(()=>{W(c.value),L.value.setOrientationAxesVisibility(!1)}),ke(()=>{W(null)}),Ce(()=>{const O=m.value.lpsOrientation[u.value];L.value.setSlicingMode("IJK"[O])}),B([s,f,i],([O,J,ye])=>{!J||D.value!=null||(n.updateConfig(O,J,{...N.value,axisDirection:ye}),n.resetSlice(O,J))},{immediate:!0});const Q=M(!1),fe=O=>{if(!f.value||!Q.value)return;const J=Ba[O.key]??0;J&&(n.updateConfig(s.value,f.value,{slice:b.value+J}),O.stopPropagation())};Zr(Object.keys(Ba),fe),hn(c,()=>L.value.resize());const ve=M();Vn(Pn,ve);const{widgetManager:ze}=Ni(L);Vn(ml,ze),B(d,O=>{if(f.value==null||C.value!=null||!O)return;const J=O.getPointData().getScalars().getRange();t.updateConfig(s.value,f.value,{min:J[0],max:J[1]}),t.resetWindowLevel(s.value,f.value)},{immediate:!0});const Ct=zt(),Qn=_(()=>Ct.idList.filter(O=>Ct.parentImage[O]===f.value)),Sn=_(()=>v.value.map(({id:O})=>O)),{baseImageRep:Jn,labelmapReps:_n,layerReps:Yn}=$i(s,{baseImage:f,labelmaps:Qn,layers:Sn}),{cameraDirVec:Jo,cameraUpVec:Yo}=Ci(i,l,m),{resizeToFit:St,ignoreResizeToFitTracking:Xo,resetResizeToFitTracking:Cr}=o1(L.value.getCamera(),!1),ea=()=>Xo(()=>{const O=m.value.lpsOrientation[Le(i.value)],J=m.value.lpsOrientation[Le(l.value)],ye=m.value.dimensions.map((Ie,rt)=>Ie*m.value.spacing[rt]);L.value.resizeToFit(O,J,ye),Cr()}),ta=()=>{const O=m.value.worldBounds,J=[(O[0]+O[1])/2,(O[2]+O[3])/2,(O[4]+O[5])/2];Xo(()=>{L.value.updateCamera(Jo.value,Yo.value,J),L.value.resetCamera(O)}),ea(),L.value.renderLater()};cn(L.value.onResize(()=>{St.value&&ea()})),B(St,()=>{St.value&&ta()});const{restoreCameraConfig:Sr}=Oi(s,f,L,"parallelScale","position","focalPoint","viewUp");B([f,Jo,Yo],()=>{const O=o.getConfig(s.value,f.value);O?(Sr(O),L.value.getRenderer().resetCameraClippingRange(),L.value.renderLater(),St.value=!1):St.value?ta():St.value=!0},{immediate:!0,deep:!0});const{top:_r,left:br}=b1(L);Ce(()=>{if(D.value==null||C.value==null)return;const{slice:O}=D.value,{width:J,level:ye}=C.value,Ie=Jn.value;Ie&&(Ie.setSlice(O),Ie.setWindowWidth(J),Ie.setWindowLevel(ye)),[...Yn.value,..._n.value].forEach(rt=>{rt.setSlice(O)}),L.value.renderLater()}),Ce(()=>{const{labelmapOpacity:O}=r;_n.value.forEach(J=>{J.setOpacity(O)})});const qt=_(()=>Sn.value.map(O=>a.getConfig(s.value,O))),Ir=it();B([s,v],()=>{v.value.forEach(({id:O},J)=>{const ye=Ir.layerImages[O],Ie=qt.value[J];ye&&!Ie&&a.resetToDefault(s.value,O,ye)})},{immediate:!0});const na=zi(),oa=_(()=>qt.value.map(O=>O==null?void 0:O.colorBy)),aa=_(()=>qt.value.map(O=>O==null?void 0:O.transferFunction)),sa=_(()=>qt.value.map(O=>O==null?void 0:O.opacityFunction)),ia=_(()=>qt.value.map(O=>O==null?void 0:O.blendConfig));return B([Yn,oa,aa,sa,ia],()=>{Yn.value.map((O,J)=>[O,oa.value[J],aa.value[J],sa.value[J],ia.value[J]]).forEach(([O,J,ye,Ie,rt])=>{if(!J||!ye||!Ie||!rt)return;const{arrayName:bn,location:Xn}=J,In=ye,je=Ie,Zt=na.getLookupTable(bn);Zt.setMode(ys.Preset),Zt.setPresetName(In.preset),Zt.setDataRange(...In.mappingRange);const _t=na.getPiecewiseFunction(bn);switch(_t.setMode(je.mode),_t.setDataRange(...je.mappingRange),je.mode){case Te.Mode.Gaussians:_t.setGaussians(je.gaussians);break;case Te.Mode.Points:{const ra=ii(je.preset,je.mappingRange,je.shift);ra&&_t.setPoints(ra);break}case Te.Mode.Nodes:_t.setNodes(je.nodes);break}O.setRescaleOnColorBy(!1),O.setColorBy(bn,Xn),O.setOpacity(rt.opacity),L.value.renderLater()})},{immediate:!0,deep:!0}),{vtkContainerRef:c,toolContainer:ve,viewID:s,viewProxy:L,viewAxis:u,active:!0,currentSlice:b,sliceMin:S,sliceMax:V,windowWidth:R,windowLevel:E,topLabel:_r,leftLabel:br,isImageLoading:g,setSlice:q,widgetManager:ze,dicomInfo:P,enableResizeToFit(){St.value=!0},hover:Q}}});const Df=e=>(Ue("data-v-f1605346"),e=e(),We(),e),Af={class:"vtk-gutter"},Tf={class:"vtk-sub-container"},kf={class:"vtk-view",ref:"vtkContainerRef"},Ef={class:"overlay-no-events tool-layer",ref:"toolContainer"},Rf={class:"annotation-cell"},Vf={class:"annotation-cell"},Mf={class:"annotation-cell"},Pf={key:0},Lf={class:"annotation-cell"},$f={key:0,class:"overlay-no-events loading"},Of=Df(()=>I("div",null,"Loading the image",-1));function xf(e,t,n,o,a,r){const s=F("slice-slider"),i=F("pan-tool"),l=F("zoom-tool"),c=F("slice-scroll-tool"),u=F("window-level-tool"),d=F("contour-tool"),f=F("ruler-tool"),m=F("rectangle-tool"),g=F("paint-tool"),v=F("crosshairs-tool"),h=F("crop-tool"),w=F("view-overlay-grid");return k(),x("div",{class:"vtk-container-wrapper",tabindex:"0",onPointerenter:t[0]||(t[0]=D=>e.hover=!0),onPointerleave:t[1]||(t[1]=D=>e.hover=!1),onFocusin:t[2]||(t[2]=D=>e.hover=!0),onFocusout:t[3]||(t[3]=D=>e.hover=!1)},[I("div",Af,[p(ae,{dark:"",icon:"",size:"medium",variant:"text",onClick:e.enableResizeToFit},{default:y(()=>[p(Z,{size:"medium",class:"py-1"},{default:y(()=>[$("mdi-camera-flip-outline")]),_:1}),p(Ee,{location:"right",activator:"parent",transition:"slide-x-transition"},{default:y(()=>[$(" Reset Camera ")]),_:1})]),_:1},8,["onClick"]),p(s,{class:"slice-slider",slice:e.currentSlice,min:e.sliceMin,max:e.sliceMax,step:1,"handle-height":20,onInput:e.setSlice},null,8,["slice","min","max","onInput"])]),I("div",{class:re(["vtk-container",e.active?"active":""])},[I("div",Tf,[I("div",kf,null,512)]),I("div",Ef,[p(i,{"view-id":e.viewID},null,8,["view-id"]),p(l,{"view-id":e.viewID},null,8,["view-id"]),p(c,{"view-id":e.viewID},null,8,["view-id"]),p(u,{"view-id":e.viewID},null,8,["view-id"]),p(d,{"view-id":e.viewID,"widget-manager":e.widgetManager,"view-direction":e.viewDirection,"current-slice":e.currentSlice},null,8,["view-id","widget-manager","view-direction","current-slice"]),p(f,{"view-id":e.viewID,"widget-manager":e.widgetManager,"view-direction":e.viewDirection,"current-slice":e.currentSlice},null,8,["view-id","widget-manager","view-direction","current-slice"]),p(m,{"view-id":e.viewID,"widget-manager":e.widgetManager,"view-direction":e.viewDirection,"current-slice":e.currentSlice},null,8,["view-id","widget-manager","view-direction","current-slice"]),p(g,{"view-id":e.viewID,"view-direction":e.viewDirection,"widget-manager":e.widgetManager,slice:e.currentSlice},null,8,["view-id","view-direction","widget-manager","slice"]),p(v,{"view-id":e.viewID,"view-direction":e.viewDirection,"widget-manager":e.widgetManager,slice:e.currentSlice},null,8,["view-id","view-direction","widget-manager","slice"]),p(h,{"view-id":e.viewID},null,8,["view-id"])],512),p(w,{class:"overlay-no-events view-annotations"},{"top-center":y(()=>[I("div",Rf,[I("span",null,j(e.topLabel),1)])]),"middle-left":y(()=>[I("div",Vf,[I("span",null,j(e.leftLabel),1)])]),"bottom-left":y(()=>[I("div",Mf,[I("div",null,"Slice: "+j(e.currentSlice+1)+"/"+j(e.sliceMax+1),1),typeof e.windowWidth=="number"&&typeof e.windowLevel=="number"?(k(),x("div",Pf," W/L: "+j(e.windowWidth.toFixed(2))+" / "+j(e.windowLevel.toFixed(2)),1)):G("",!0)])]),"top-right":y(()=>[I("div",Lf,[e.dicomInfo!==null?(k(),U(Dt,{key:0,"open-on-hover":"",location:"bottom left",left:"","nudge-left":"10",dark:"","max-width":"300px"},{activator:y(({props:D})=>[p(Z,wt(D,{dark:"",size:"x-large",class:"pointer-events-all hover-info"}),{default:y(()=>[$(" mdi-information ")]),_:2},1040)]),default:y(()=>[p(It,{class:"bg-grey-darken-3"},{default:y(()=>[p(xe,null,{default:y(()=>[p(we,{class:"font-weight-bold"},{default:y(()=>[$(" PATIENT / CASE ")]),_:1}),p(ut),p(we,null,{default:y(()=>[$(" ID: "+j(e.dicomInfo.patientID),1)]),_:1})]),_:1}),p(xe,null,{default:y(()=>[p(we,{class:"font-weight-bold"},{default:y(()=>[$(" STUDY ")]),_:1}),p(ut),p(we,null,{default:y(()=>[$(" ID: "+j(e.dicomInfo.studyID),1)]),_:1}),p(we,null,{default:y(()=>[$(j(e.dicomInfo.studyDescription),1)]),_:1})]),_:1}),p(xe,null,{default:y(()=>[p(we,{class:"font-weight-bold"},{default:y(()=>[$(" SERIES ")]),_:1}),p(ut),p(we,null,{default:y(()=>[$(" Series #: "+j(e.dicomInfo.seriesNumber),1)]),_:1}),p(we,null,{default:y(()=>[$(j(e.dicomInfo.seriesDescription),1)]),_:1})]),_:1})]),_:1})]),_:1})):G("",!0)])]),_:1}),p(Xa,{name:"loading"},{default:y(()=>[e.isImageLoading?(k(),x("div",$f,[Of,I("div",null,[p(At,{indeterminate:"",color:"blue"})])])):G("",!0)]),_:1})],2)],32)}const ji=H(If,[["render",xf],["__scopeId","data-v-f1605346"]]);function Bf(e){const t=M(!1),n=be(_(()=>K(e).getInteractor().onStartAnimation)),o=be(_(()=>K(e).getInteractor().onEndAnimation));return n(()=>{t.value=!0}),o(()=>{t.value=!1}),t}function Ff(e,t,n){const o=_(()=>{var C;return(C=e.value)==null?void 0:C.cvr}),a=eo(t,()=>{var C;return(C=t.value)==null?void 0:C.getMapper()}),r=eo(t,()=>{var C;return(C=t.value)==null?void 0:C.getInputDataSet()}),s=eo(t,()=>{var C;return(C=t.value)==null?void 0:C.getVolumes()[0]}),i=_(()=>n.value.getRenderer()),l=Bf(n),c=_(()=>{var E;const C=!!((E=o.value)!=null&&E.enabled),R=l.value;return C&&!R}),u=()=>{l.value||n.value.renderLater()},d=_(()=>{if(!s.value)return null;const C=s.value.getBounds();return[(C[0]+C[1])/2,(C[2]+C[3])/2,(C[4]+C[5])/2]}),f=_(()=>{var C;return((C=o.value)==null?void 0:C.lightFollowsCamera)??!0});B([d,i,c,f],([C,R,E,P])=>{if(!C)return;R.getLights().length===0&&R.createLight();const N=R.getLights()[0];E?(N.setFocalPoint(...C),N.setColor(1,1,1),N.setIntensity(1),N.setConeAngle(90),N.setPositional(!0),R.setTwoSidedLighting(!1),P?(N.setLightTypeToHeadLight(),R.updateLightsGeometryToFollowCamera()):N.setLightTypeToSceneLight()):N.setPositional(!1),u()},{immediate:!0});const m=_(()=>{var C;return(C=o.value)==null?void 0:C.volumeQuality});B([s,r,a,m,c,l],([C,R,E,P,N,q])=>{if(!(!C||!E||P==null||!R)){if(q)E.setSampleDistance(.75),E.setMaximumSamplesPerRay(1e3),E.setGlobalIlluminationReach(0),E.setComputeNormalFromOpacity(!1);else{const L=R.getDimensions(),W=R.getSpacing(),Q=Qr(Ye(L[0]*W[0],L[1]*W[1],L[2]*W[2]));let fe=W.reduce((ze,Ct)=>ze+Ct)/3;fe/=P>1?.5*P**2:1;const ve=Q/fe+1;E.setMaximumSamplesPerRay(ve),E.setSampleDistance(fe),E.setGlobalIlluminationReach(N?.25*P:0),E.setComputeNormalFromOpacity(!N&&P>2)}u()}},{immediate:!0});const g=_(()=>{var C;return((C=o.value)==null?void 0:C.ambient)??0}),v=_(()=>{var C;return((C=o.value)==null?void 0:C.diffuse)??0}),h=_(()=>{var C;return((C=o.value)==null?void 0:C.specular)??0});B([s,r,g,v,h,c],([C,R,E,P,N,q])=>{if(!C||!R)return;const L=C.getProperty();L.setScalarOpacityUnitDistance(0,.5*Kl(R.getBounds())/Math.max(...R.getDimensions())),L.setShade(!0),L.setUseGradientOpacity(0,!q),L.setGradientOpacityMinimumValue(0,0);const W=R.getPointData().getScalars().getRange();L.setGradientOpacityMaximumValue(0,(W[1]-W[0])*.01),L.setGradientOpacityMinimumOpacity(0,0),L.setGradientOpacityMinimumOpacity(0,1),L.setAmbient(q?E:ui),L.setDiffuse(q?P:di),L.setSpecular(q?N:fi),u()},{immediate:!0});const w=_(()=>{var C;return((C=o.value)==null?void 0:C.useVolumetricScatteringBlending)??!1}),D=_(()=>{var C;return((C=o.value)==null?void 0:C.volumetricScatteringBlending)??0});B([w,D,a,c],([C,R,E,P])=>{E&&(P&&C?E.setVolumetricScatteringBlending(R):E.setVolumetricScatteringBlending(0),u())},{immediate:!0});const b=_(()=>{var C;return((C=o.value)==null?void 0:C.useLocalAmbientOcclusion)??!1}),S=_(()=>{var C;return((C=o.value)==null?void 0:C.laoKernelSize)??0}),V=_(()=>{var C;return((C=o.value)==null?void 0:C.laoKernelRadius)??0});B([b,S,V,a,c],([C,R,E,P,N])=>{P&&(N&&C?(P.setLocalAmbientOcclusion(!0),P.setLAOKernelSize(R),P.setLAOKernelRadius(E)):(P.setLocalAmbientOcclusion(!1),P.setLAOKernelSize(0),P.setLAOKernelRadius(0)),u())},{immediate:!0})}function Nf(e,t,n){const o=_(()=>{var i;return(i=e.value)==null?void 0:i.colorBy}),a=_(()=>{var i;return(i=e.value)==null?void 0:i.transferFunction}),r=_(()=>{var i;return(i=e.value)==null?void 0:i.opacityFunction}),s=zi();B([t,o,a,r],([i,l,c,u])=>{if(!i||!l||!c||!u||!s)return;const{arrayName:d,location:f}=l,m=s.getLookupTable(d);m.setMode(ys.Preset),m.setPresetName(c.preset),m.setDataRange(...c.mappingRange);const g=s.getPiecewiseFunction(d);switch(g.setMode(u.mode),g.setDataRange(...u.mappingRange),u.mode){case Te.Mode.Gaussians:g.setGaussians(u.gaussians);break;case Te.Mode.Points:{const v=ii(u.preset,u.mappingRange,u.shift);v&&g.setPoints(v);break}case Te.Mode.Nodes:g.setNodes(u.nodes);break}i&&(i.setRescaleOnColorBy(!1),i.setColorBy(d,f)),n.value.renderLater()},{immediate:!0})}const Uf=z({props:{id:{type:String,required:!0},viewDirection:{type:String,required:!0},viewUp:{type:String,required:!0}},components:{ViewOverlayGrid:wi,CropTool:Wi,PanTool:_i},setup(e){const t=To(),n=pi(),o=zn(),{id:a,viewDirection:r,viewUp:s}=Y(e),i=M(),{currentImageID:l,currentImageMetadata:c,currentImageData:u,isImageLoading:d}=ie(),{viewProxy:f,setContainer:m}=xi(a,Wo.Volume);X(()=>{f.value.setOrientationAxesVisibility(!0),f.value.setOrientationAxesType("cube"),f.value.setBackground([0,0,0,0]),m(i.value)}),ke(()=>{m(null),f.value.setContainer(null)}),hn(i,()=>f.value.resize());const{baseImageRep:g}=$i(a,{baseImage:l,models:_(()=>t.idList)});B(g,R=>{R&&R.getVolumes().forEach(E=>E.setPickable(!1))},{immediate:!0});const{widgetManager:v}=Ni(f);Vn(as,v);const{cameraUpVec:h,cameraDirVec:w}=Ci(r,s,c),D=()=>{const R=c.value.worldBounds,E=[(R[0]+R[1])/2,(R[2]+R[3])/2,(R[4]+R[5])/2];f.value.updateCamera(w.value,h.value,E),f.value.resetCamera(),f.value.renderLater()};B([g,w,h],()=>{o.getConfig(a.value,l.value)||es(D)},{immediate:!0});const{restoreCameraConfig:b}=Oi(a,l,f,"position","focalPoint","directionOfProjection","viewUp");B(l,()=>{const R=o.getConfig(a.value,l.value);R&&(b(R),f.value.getRenderer().resetCameraClippingRange(),f.value.renderLater())});const S=_(()=>n.getConfig(a.value,l.value));B([a,l],()=>{l.value&&u.value&&!S.value&&n.resetToDefaultColoring(a.value,l.value,u.value)},{immediate:!0}),Ff(S,g,f),Nf(S,g,f);const C=Tt().getComputedVTKPlanes(l);return B(C,(R,E)=>{var N;const P=(N=g.value)==null?void 0:N.getMapper();!P||!R||E&&id(R,E)||(P.removeAllClippingPlanes(),R.forEach(q=>P.addClippingPlane(q)),P.modified(),f.value.renderLater())},{immediate:!0}),{vtkContainerRef:i,viewID:a,active:!1,topLeftLabel:_(()=>{var R;return((R=S.value)==null?void 0:R.transferFunction.preset.replace(/-/g," "))??""}),isImageLoading:d,resetCamera:D}}});const Wf=e=>(Ue("data-v-03dd54d9"),e=e(),We(),e),zf={class:"vtk-container-wrapper vtk-three-container"},jf={class:"vtk-sub-container"},Hf={class:"vtk-view",ref:"vtkContainerRef"},Gf={class:"overlay-no-events tool-layer"},Kf={class:"annotation-cell"},qf={class:"ml-3"},Zf={key:0,class:"overlay-no-events loading"},Qf=Wf(()=>I("div",null,"Loading the image",-1));function Jf(e,t,n,o,a,r){const s=F("crop-tool"),i=F("pan-tool"),l=F("view-overlay-grid");return k(),x("div",zf,[I("div",{class:re(["vtk-container",e.active?"active":""])},[I("div",jf,[I("div",Hf,null,512)]),I("div",Gf,[p(s,{"view-id":e.viewID},null,8,["view-id"]),p(i,{"view-id":e.viewID},null,8,["view-id"])]),p(l,{class:"overlay-no-events view-annotations"},{"top-left":y(()=>[I("div",Kf,[p(ae,{class:"pointer-events-all",dark:"",icon:"",size:"medium",variant:"text",onClick:e.resetCamera},{default:y(()=>[p(Z,{size:"medium",class:"py-1"},{default:y(()=>[$(" mdi-camera-flip-outline ")]),_:1}),p(Ee,{location:"right",activator:"parent",transition:"slide-x-transition"},{default:y(()=>[$(" Reset Camera ")]),_:1})]),_:1},8,["onClick"]),I("span",qf,j(e.topLeftLabel),1)])]),_:1}),p(Xa,{name:"loading"},{default:y(()=>[e.isImageLoading?(k(),x("div",Zf,[Qf,I("div",null,[p(At,{indeterminate:"",color:"blue"})])])):G("",!0)]),_:1})],2)])}const Yf=H(Uf,[["render",Jf],["__scopeId","data-v-03dd54d9"]]),Xf={"2D":ji,"3D":Yf},ep=z({name:"LayoutGrid",props:{layout:{type:Object,required:!0}},setup(e){const{layout:t}=Y(e),n=ue(),{viewSpecs:o}=Ke(n),a=_(()=>t.value.direction===Re.H?"flex-column":"flex-row");return{items:_(()=>{const s=o.value;return t.value.items.map(i=>{if(typeof i=="string"){const l=s[i];return{type:"view",id:i,component:Xf[l.viewType],props:l.props}}return{type:"layout",...i}})}),flexFlow:a}}});const tp={key:1,class:"layout-item"};function np(e,t,n,o,a,r){const s=F("layout-grid",!0);return k(),x("div",{class:re(["layout-container flex-equal",e.flexFlow])},[(k(!0),x(se,null,ce(e.items,(i,l)=>(k(),x("div",{key:l,class:"d-flex flex-equal"},[i.type==="layout"?(k(),U(s,{key:0,layout:i},null,8,["layout"])):(k(),x("div",tp,[(k(),U(wo(i.component),wt({key:i.id,id:i.id},i.props),null,16,["id"]))]))]))),128))],2)}const op=H(ep,[["render",np],["__scopeId","data-v-ff08ec32"]]);const ap={__name:"PersistentOverlay",props:{disabled:{type:Boolean,default:!1},color:{type:String,default:""},opacity:{type:Number,default:.2},zIndex:{type:Number,default:10}},setup(e){const t=e,{disabled:n,color:o,opacity:a,zIndex:r}=Y(t),s=_(()=>o.value&&o.value.startsWith("#")?o.value:""),i=_(()=>o.value&&!s.value?`bg-${o.value}`:""),l=_(()=>{const d={"persistent-overlay-scrim":!0,"persistent-overlay-scrim-themed":o.value.length===0};return i.value&&(d[i.value]=!0),d}),c=_(()=>{const d={opacity:a.value};return s.value&&(d["background-color"]=s.value),d}),u=_(()=>({zIndex:r.value}));return(d,f)=>K(n)?G("",!0):(k(),x("div",{key:0,class:"persistent-overlay",style:Ge(K(u))},[I("div",{class:re(K(l)),style:Ge(K(c))},null,6),De(d.$slots,"default",{},void 0,!0)],4))}},qn=H(ap,[["__scopeId","data-v-dc194336"]]),sp=z({name:"ImageListCard",props:{active:Boolean,imageSize:{type:Number,default:80},imageUrl:{type:String},selectable:{type:Boolean,default:!1},id:String,modelValue:Array,inputValue:String,disabled:Boolean,htmlTitle:String},components:{PersistentOverlay:qn}});const ip={class:"ml-2"};function rp(e,t,n,o,a,r){const s=F("persistent-overlay");return k(),U(vl,null,{default:y(({isHovering:i,props:l})=>[p(Oe,wt({disabled:e.disabled,variant:"outlined",ripple:!e.disabled,class:{"image-list-card-hover":!e.disabled&&i,"image-list-card-active":!e.disabled&&e.active}},{...l,...e.$attrs}),{default:y(()=>[p(Pt,{title:e.htmlTitle},{default:y(()=>[p(oe,{"no-gutters":"",class:"flex-nowrap"},{default:y(()=>[e.selectable?(k(),U(le,{key:0,cols:"1",class:"d-flex align-center"},{default:y(()=>[(k(),U(ot,{onClick:t[0]||(t[0]=me(()=>{},["stop"])),key:e.id,density:"compact",disabled:e.disabled,value:e.inputValue,"model-value":e.modelValue,"onUpdate:modelValue":t[1]||(t[1]=c=>e.$emit("update:model-value",c))},null,8,["disabled","value","model-value"]))]),_:1})):G("",!0),p(le,{cols:"4",class:"image-container flex-grow-0",style:Ge({maxWidth:`${e.imageSize}px`})},{default:y(()=>[p(Ln,{contain:"",height:`${e.imageSize}px`,width:`${e.imageSize}px`,src:e.imageUrl},null,8,["height","width","src"]),p(s,{disabled:!e.$slots["image-overlay"]},{default:y(()=>[De(e.$slots,"image-overlay",{},void 0,!0)]),_:3},8,["disabled"])]),_:3},8,["style"]),p(le,{cols:e.selectable?7:8},{default:y(()=>[I("div",ip,[De(e.$slots,"default",{},void 0,!0)])]),_:3},8,["cols"])]),_:3})]),_:3},8,["title"])]),_:2},1040,["disabled","ripple","class"])]),_:3})}const Hi=H(sp,[["render",rp],["__scopeId","data-v-a02c040f"]]),lp=z({components:{ImageListCard:Hi},setup(){const e=Je(),t=Me({progress:{}}),n=Me({urlToID:{},idToURL:{}}),o=l=>{const c=n.idToURL[l];c&&(delete n.idToURL[l],delete n.urlToID[c])};_e().$onAction(({name:l,args:c,after:u})=>{l==="deleteData"&&u(()=>{const[d]=c;o(d)})}),ge().$onAction(({name:l,args:c,after:u})=>{l==="deleteVolume"&&u(()=>{const[d]=c;o(d)})});async function s(l){const c=u=>{t.progress[l.name]={state:0,progress:u*100}};try{c(1/0);const u=await js(l.url,l.filename,{progress:c});t.progress[l.name].state=2;const[d]=await Uo([nu(u,l.url)]);if(!d)throw new Error("Did not receive a load result");if(!d.ok)throw d.errors[0].cause;const f=No(d);if(f){const m=f.type==="image"?f.dataID:f.volumeKey;n.idToURL[m]=l.url,n.urlToID[l.url]=m}e.setPrimarySelection(f)}catch(u){t.progress[l.name].state=1,Qe().addError("Failed to load sample data",u)}finally{delete t.progress[l.name]}}return{samples:_(()=>Wu.map(l=>{var m,g,v;const c=((m=t.progress[l.name])==null?void 0:m.state)===2,u=((g=t.progress[l.name])==null?void 0:g.state)===1,d=!!n.urlToID[l.url],f=c||d?100:Math.floor((v=t.progress[l.name])==null?void 0:v.progress);return{...l,isDownloading:l.name in t.progress,isDone:c,isError:u,isLoaded:d,indeterminate:f===1/0,progress:f}})),downloadSample:s}}});const cp={class:"text-body-2 font-weight-bold text-no-wrap text-truncate"},up={class:"text-body-2 mt-2"},dp={key:2,class:"text-caption text--white"};function fp(e,t,n,o,a,r){const s=F("image-list-card");return k(),x("div",null,[(k(!0),x(se,null,ce(e.samples,i=>(k(),U(s,{disabled:i.isDownloading||i.isLoaded,key:i.name,"html-title":i.name,"image-url":i.image,"image-size":100,class:"mb-1",onClick:l=>e.downloadSample(i)},Jr({default:y(()=>[I("div",cp,j(i.name),1),I("div",up,j(i.description),1)]),_:2},[i.isDownloading||i.isLoaded?{name:"image-overlay",fn:y(()=>[p(oe,{class:"fill-height ma-0 align-center justify-center"},{default:y(()=>[p(At,{class:"sample-progress",color:"white",indeterminate:i.indeterminate&&!i.isDone,"model-value":i.progress},{default:y(()=>[i.isDone||i.isLoaded?(k(),U(Z,{key:0,small:"",color:"white"},{default:y(()=>[$(" mdi-check ")]),_:1})):i.isError?(k(),U(Z,{key:1,small:"",color:"white"},{default:y(()=>[$(" mdi-alert-circle ")]),_:1})):i.indeterminate?G("",!0):(k(),x("span",dp,j(i.progress),1))]),_:2},1032,["indeterminate","model-value"])]),_:2},1024)]),key:"0"}:void 0]),1032,["disabled","html-title","image-url","onClick"]))),128))])}const pp=H(lp,[["render",fp],["__scopeId","data-v-23248f20"]]),et=ne("dicom-meta",{state:()=>({patientInfo:{},patientStudies:{},studyInfo:{},studyVolumes:{},volumeInfo:{},volumeInstances:{},instanceInfo:{},instanceVolume:{},volumeStudy:{},studyPatient:{},needsRebuild:{}}),actions:{async importMeta(e){const t={PatientID:e.PatientID||Ns,PatientName:e.PatientName||Fs,PatientBirthDate:e.PatientBirthDate||"",PatientSex:e.PatientSex||""},n=Xt(e,"StudyID","StudyInstanceUID","StudyDate","StudyTime","AccessionNumber","StudyDescription"),o={...Xt(e,"Modality","SeriesInstanceUID","SeriesNumber","SeriesDescription"),NumberOfSlices:0,VolumeID:e.SeriesInstanceUID},a={...Xt(e,"SopInstanceUID","InstanceNumber"),Rows:Number.parseInt(e.Rows,10),Columns:Number.parseInt(e.Columns,10)};this._updateDatabase(t,n,o,a)},deleteVolume(e){if(e in this.volumeInfo){const t=this.volumeStudy[e];delete this.volumeInfo[e],delete this.volumeStudy[e],yt(this.studyVolumes[t],e),this.studyVolumes[t].length===0&&this.deleteStudy(t)}},deleteStudy(e){if(e in this.studyInfo){const t=this.studyPatient[e];delete this.studyInfo[e],delete this.studyPatient[e],delete this.studyVolumes[e],yt(this.patientStudies[t],e),this.patientStudies[t].length===0&&this.deletePatient(t)}},deletePatient(e){e in this.patientInfo&&(delete this.patientInfo[e],[...this.patientStudies[e]].forEach(t=>this.deleteStudy(t)),delete this.patientStudies[e])},_updateDatabase(e,t,n,o){const a=e.PatientID;a&&!(a in this.patientInfo)&&(this.patientInfo[a]=e,this.patientStudies[a]=[]);const r=t.StudyInstanceUID;r&&!(r in this.studyInfo)&&(this.studyInfo[r]=t,this.studyVolumes[r]=[],this.studyPatient[r]=a,this.patientStudies[a].push(r));const s=n.VolumeID;s&&!(s in this.volumeInfo)&&(this.volumeInfo[s]=n,this.volumeInstances[s]=[],this.volumeStudy[s]=r,this.studyVolumes[r].push(s));const i=o.SopInstanceUID;i&&!(i in this.instanceInfo)&&(this.instanceInfo[i]=o,this.instanceVolume[i]=s,this.volumeInstances[s].push(i),this.volumeInfo[s].NumberOfSlices+=1),Object.entries(this.patientStudies).forEach(([l,c])=>{c.length===0&&this.deletePatient(l)})}}}),gp={PatientID:"00100020",PatientName:"00100010",PatientBirthDate:"00100030",PatientSex:"00100040",StudyID:"00200010",StudyInstanceUID:"0020000D",StudyName:"00100010",StudyDate:"00080020",StudyTime:"00080030",AccessionNumber:"00080050",StudyDescription:"00081030",SeriesInstanceUID:"0020000E",SeriesNumber:"00200011",SeriesDescription:"0008103E",Modality:"00080060",SopInstanceUID:"00080018",InstanceNumber:"00200013",Rows:"00280010",Columns:"00280011"};function mp(e){var o;const t=(o=e==null?void 0:e.Value)==null?void 0:o[0],n=t==null?void 0:t.Alphabetic;return n||t}function zo(e){const t=Object.entries(gp).reduce((n,[o,a])=>({...n,[o]:mp(e[a])}),{});return Cc(t)}let Fa=0;function vp(e){return Fa++,new File([new Blob([e])],`dicom-web.${Fa}.dcm`)}function wn(e){return new Yr.DICOMwebClient({url:e})}async function hp(e){return(await wn(e).searchForStudies()).map(zo)}async function Gi(e,t){return(await wn(e).searchForSeries(t)).map(zo)}async function Ki(e,t){return(await wn(e).retrieveSeriesMetadata(t)).map(zo)}async function yp(e,t,n){return(await wn(e).retrieveSeries({...t,progressCallback:n})).map(vp)}async function wp(e,t){const o=await wn(e).retrieveInstanceRendered({...t,mediaTypes:[{mediaType:"image/jpeg"}]}),a=new Uint8Array(o),r=new Blob([a],{type:"image/jpeg"});return URL.createObjectURL(r)}const Cp=["series","studies"];function Sp(e){const t=e.replace(/\/$/,"");let n=t.split("/");const o=Cp.reduce((i,l)=>{const[c,u]=n.slice(-2);return c===l?(n=n.slice(0,-2),{[l]:u,...i}):i},{}),a=Object.keys(o).length*2,r=t.split("/");return{host:r.slice(0,r.length-a).join("/"),...o}}const _p="dicomweb",qi=e=>!e||["Pending","Done"].every(t=>t!==e.state),bp={host:hp,studies:Gi,series:Ki},Ip={studies:"studyInstanceUID",series:"seriesInstanceUID"},Dp={studies:"StudyInstanceUID",series:"SeriesInstanceUID"},Cn=ne("dicom-web",()=>{const{VITE_DICOM_WEB_NAME:e,VITE_DICOM_WEB_URL:t}={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},n=e?M(e):Mn("dicomWebHostName",""),o=Mn("dicomWebHost",""),s=ws.extractURLParameters()[_p]??t;s&&(o.value=s);const i=_(()=>Sp(o.value??"")),l=_(()=>i.value.host),c=_(()=>!!l.value),u=async V=>{const C=et(),R=C.volumeInfo[V],E=Math.floor(R.NumberOfSlices/2),P=C.volumeInstances[V].map(W=>C.instanceInfo[W]).sort(({InstanceNumber:W},{InstanceNumber:Q})=>Number(W)-Number(Q))[E],N=C.volumeStudy[V],L={studyInstanceUID:C.studyInfo[N].StudyInstanceUID,seriesInstanceUID:R.SeriesInstanceUID,sopInstanceUID:P.SopInstanceUID};return wp(l.value,L)},d=async V=>{const C=et();(await Promise.all(C.patientStudies[V].map(E=>C.studyInfo[E]).map(async E=>(await Gi(l.value,{studyInstanceUID:E.StudyInstanceUID})).map(N=>({...E,...N}))))).flat().forEach(E=>C.importMeta(E))},f=async V=>{const C=et();(await Promise.all(V.map(async E=>{const P=C.volumeInfo[E],N=C.studyInfo[C.volumeStudy[E]];return(await Ki(l.value,{studyInstanceUID:N.StudyInstanceUID,seriesInstanceUID:P.SeriesInstanceUID})).map(L=>({...N,...P,...L}))}))).flat().forEach(E=>C.importMeta(E))},m=M({}),g=async V=>{const C=Je(),R=et();if(!qi(m.value[V]))return;m.value[V]={...m.value[V],state:"Pending",loaded:0,total:0};const{SeriesInstanceUID:E}=R.volumeInfo[V],P=R.volumeStudy[V],{StudyInstanceUID:N}=R.studyInfo[P],q={studyInstanceUID:N,seriesInstanceUID:E},L=({loaded:W,total:Q})=>{m.value[V]={...m.value[V],loaded:W,total:Q}};try{const W=await yp(l.value,q,L);if(!W)throw new Error("Could not fetch series");const[Q]=await Uo(W.map(Un));if(!Q)throw new Error("Did not receive a load result");if(!Q.ok)throw Q.errors[0].cause;const fe=No(Q);C.setPrimarySelection(fe),m.value[V]={...m.value[V],state:"Done"}}catch(W){Qe().addError("Failed to load DICOM",W),m.value[V]={...m.value[V],state:"Error",loaded:0}}},v=M(void 0);let h=!1;const w=async()=>{h=!0,v.value=void 0;const V=et();if(V.$reset(),!l.value)return;const C=Object.keys(i.value).pop(),R=bp[C],E=yc(i.value,"host"),P=ya(E,Ip);try{const N=await R(l.value,P),q=ya(E,Dp);N.map(W=>({...q,...W})).forEach(W=>V.importMeta(W))}catch(N){v.value=N,console.error(N)}if(C==="series"){const N=Object.values(i.value).pop();g(N)}},D=()=>{h||w()},b=_(()=>{if(v.value)return`Error fetching DICOMWeb data: ${v.value}`;const V=et();return Object.values(V.patientInfo).length===0?"Found zero dicoms.":""});return ge().$onAction(({name:V,args:C,after:R})=>{V==="deleteVolume"&&R(()=>{const[E]=C,P=Object.keys(m.value).find(N=>E.startsWith(N));P&&(m.value[P]={...m.value[P],state:"Remote",loaded:0})})}),{host:o,isConfigured:c,hostName:n,message:b,volumes:m,fetchInitialDicoms:w,fetchInitialDicomsOnce:D,fetchPatientMeta:d,fetchVolumesMeta:f,fetchVolumeThumbnail:u,downloadVolume:g}}),Zi=Symbol("ItemGroup"),jo=z({props:{modelValue:null,mandatory:Boolean,equalsTest:Function},setup(e,{emit:t,slots:n}){const{modelValue:o,mandatory:a,equalsTest:r}=Y(e),s=M();return B(o,c=>{c!==s.value&&(s.value=c)}),X(()=>{s.value=o.value}),Vn(Zi,{selectItem:c=>{a.value&&!c||(s.value=c,t("update:modelValue",s.value))},isSelected:c=>s.value==null?!1:r.value?r.value(c,s.value):c===s.value}),()=>{var c;return(c=n.default)==null?void 0:c.call(n)}}}),Ho=z({props:{value:{type:null,required:!0}},setup(e,{slots:t}){const{value:n}=Y(e),o=Rt(Zi);if(!o)throw new Error("GroupableItem needs ItemGroup!");const a=()=>{o.selectItem(n.value)},r=()=>{o&&o.selectItem(o.isSelected(n.value)?void 0:n.value)};return()=>{var s;return(s=t.default)==null?void 0:s.call(t,{active:o.isSelected(n.value),select:a,toggle:r})}}});var nn=(e=>(e[e.First=0]="First",e[e.Middle=1]="Middle",e[e.Last=2]="Last",e))(nn||{});function Ap(e,t,n,o,a){const r=new ImageData(t,n),s=new Uint32Array(r.data.buffer),i=255/(a-o);for(let l=0;l<e.length;l+=1){const c=Math.floor((e[l]-o)*i);s[l]=255<<24|c<<16|c<<8|c}return r}function Tp(e,t=2,n=nn.Middle){const o=e.getPointData().getScalars(),a=o.getData(),r=o.getRange(),s=e.getDimensions();let i=0;n===nn.Middle?i=Math.floor(s[t]/2):n===nn.Last&&(i=s[t]-1);let l,c,u;if(t===0){l=new a.constructor(s[1]*s[2]),[,c,u]=s;for(let d=0;d<s[2];d++)for(let f=0;f<s[1];f++){const m=i+f*s[0]+d*s[0]*s[1],g=d*s[1]+f;l[g]=a[m]}}else if(t===1){l=new a.constructor(s[0]*s[2]),[c,,u]=s;for(let d=0;d<s[2];d++)for(let f=0;f<s[0];f++){const m=f+i*s[0]+d*s[0]*s[1],g=d*s[0]+f;l[g]=a[m]}}else if(t===2){[c,u]=s;const d=s[0]*s[1],f=i*d;l=Array.isArray(a)?a.slice(f,f+d):a.subarray(f,f+d)}return Ap(l,c,u,r[0],r[1])}function kp(){const e=document.createElement("canvas"),t=e.getContext("2d"),n=document.createElement("canvas"),o=n.getContext("2d");if(!t||!o)throw new Error("[thumbnailer] Failed to create a 2D context");return{generate(a,r=2,s=nn.Middle){return Tp(a,r,s)},imageDataToDataURI(a,r,s){e.width=a.width,e.height=a.height,t.putImageData(a,0,0);let{width:i,height:l}=a;return a.width>a.height?(i=r,l*=r/a.width):(l=s,i*=s/a.height),n.width=i,n.height=l,o.clearRect(0,0,i,l),o.scale(i/a.width,l/a.height),o.drawImage(e,0,0),n.toDataURL("image/jpeg")}}}function Go(e){const t=M([]),n=M(!1),o=_(()=>t.value.length>0);return B(t,()=>{n.value=t.value.length>0&&t.value.length===e.value.length}),B(n,a=>{a?t.value=e.value:t.value=[]}),{selected:t,selectedAll:n,selectedSome:o}}function io(e){return`image-${e}`}const Ep=z({components:{ItemGroup:jo,GroupableItem:Ho,ImageListCard:Hi},setup(){const e=_e(),t=ge(),n=Je(),o=it(),a=_(()=>n.primarySelection),r=_(()=>e.idList.filter(m=>!(m in t.imageIDToVolumeKey))),s=_(()=>{var D,b;const{metadata:m}=e,g=o.getLayers(a.value).filter(({selection:S})=>S.type==="image"),v=g.map(({selection:S})=>S.dataID),h=g.filter(({id:S})=>S in o.layerImages).map(({selection:S})=>S.dataID),w=((D=a.value)==null?void 0:D.type)==="image"&&((b=a.value)==null?void 0:b.dataID);return r.value.map(S=>{const V={type:"image",dataID:S},C=v.includes(S),R=h.includes(S),E=C&&!R,P=S!==w&&a.value;return{id:S,cacheKey:io(S),selectionKey:V,name:m[S].name,dimensions:m[S].dimensions,spacing:[...m[S].spacing].map(N=>N.toFixed(2)),layerable:P,loading:E,layerIcon:C?"mdi-layers-minus":"mdi-layers-plus",layerTooltip:C?"Remove Layer":"Add Layer",layerHandler:()=>{!E&&P&&(C?o.deleteLayer(a.value,V):o.addLayer(a.value,V))}}})}),i=Me({}),l=kp();B(r,m=>{m.forEach(async v=>{const h=io(v);if(!(h in i)){const w=e.dataIndex[v],D=l.generate(w),b=l.imageDataToDataURI(D,100,100),S=w.getDimensions(),V=S[0]/S[1];i[h]={imageURI:b,aspectRatio:V}}});const g=new Set(m.map(v=>io(v)));Object.keys(i).forEach(v=>{g.has(v)||delete i[v]})},{immediate:!0,deep:!0});const{selected:c,selectedAll:u,selectedSome:d}=Go(r);function f(){c.value.forEach(m=>{e.deleteData(m)}),c.value=[]}return{selected:c,selectedAll:u,selectedSome:d,removeSelection:f,images:s,thumbnails:i,primarySelection:a,selectionEquals:Eo,setPrimarySelection:m=>{n.setPrimarySelection(m)}}}}),Rp={key:0,class:"text-center"},Vp={class:"text-body-2 font-weight-bold text-no-wrap text-truncate"},Mp={class:"text-caption"},Pp={class:"text-caption"};function Lp(e,t,n,o,a,r){const s=F("image-list-card"),i=F("groupable-item"),l=F("item-group");return k(),x("div",null,[e.images.length===0?(k(),x("div",Rp,"No images loaded")):G("",!0),Vt(p(Pt,{class:"pa-0"},{default:y(()=>[p(oe,{"no-gutters":"",justify:"space-between",align:"center",class:"mb-1"},{default:y(()=>[p(le,{cols:"6"},{default:y(()=>[p(ot,{class:"ml-3",indeterminate:e.selectedSome&&!e.selectedAll,label:"Select All",modelValue:e.selectedAll,"onUpdate:modelValue":t[0]||(t[0]=c=>e.selectedAll=c),density:"compact","hide-details":""},null,8,["indeterminate","modelValue"])]),_:1}),p(le,{cols:"6","align-self":"center",class:"d-flex justify-end"},{default:y(()=>[p(ae,{icon:"",variant:"text",disabled:!e.selectedSome,onClick:me(e.removeSelection,["stop"])},{default:y(()=>[p(Z,null,{default:y(()=>[$("mdi-delete")]),_:1}),p(Ee,{disabled:!e.selectedSome,location:"left",activator:"parent"},{default:y(()=>[$(" Delete selected ")]),_:1},8,["disabled"])]),_:1},8,["disabled","onClick"])]),_:1})]),_:1})]),_:1},512),[[Mt,e.images.length]]),p(l,{"model-value":e.primarySelection,"equals-test":e.selectionEquals,"onUpdate:modelValue":e.setPrimarySelection},{default:y(()=>[(k(!0),x(se,null,ce(e.images,c=>(k(),U(i,{key:c.id,value:c.selectionKey},{default:y(({active:u,select:d})=>[p(s,{modelValue:e.selected,"onUpdate:modelValue":t[1]||(t[1]=f=>e.selected=f),class:"mt-1",selectable:"",inputValue:c.id,active:u,"html-title":c.name,"image-url":(e.thumbnails[c.cacheKey]||{}).imageURI||"","image-size":100,id:c.id,onClick:d},{default:y(()=>[I("div",Vp,j(c.name),1),I("div",Mp," Dims: ("+j(c.dimensions.join(", "))+") ",1),I("div",Pp," Spacing: ("+j(c.spacing.join(", "))+") ",1),p(ae,{icon:"",variant:"text",disabled:!c.layerable,loading:c.loading,onClick:me(f=>c.layerHandler(),["stop"]),class:"mt-1"},{default:y(()=>[p(Z,{icon:c.layerIcon},null,8,["icon"]),p(Ee,{location:"top",activator:"parent"},{default:y(()=>[$(j(c.layerTooltip),1)]),_:2},1024)]),_:2},1032,["disabled","loading","onClick"])]),_:2},1032,["modelValue","inputValue","active","html-title","image-url","id","onClick"])]),_:2},1032,["value"]))),128))]),_:1},8,["model-value","equals-test","onUpdate:modelValue"])])}const $p=H(Ep,[["render",Lp]]),Tn=document.createElement("canvas");function ro(e){return`dicom-${e}`}function Op(e){const[t,n]=e.size,o=new ImageData(t,n),a=new Uint32Array(o.data.buffer),r=e.data;if(!r)return"";for(let i=0;i<r.length;i+=1){const l=r[i];a[i]=255<<24|l<<16|l<<8|l}Tn.width=t,Tn.height=n;const s=Tn.getContext("2d");return s?(s.putImageData(o,0,0),Tn.toDataURL("image/png")):""}async function xp(e,t){if(t in e.volumeInfo)return await e.getVolumeThumbnail(t);throw new Error("No matching volume key in dicomStore")}const Bp=z({name:"PatientStudyVolumeBrowser",props:{volumeKeys:{type:Array,required:!0}},components:{GroupableItem:Ho,PersistentOverlay:qn},setup(e){const{volumeKeys:t}=Y(e),n=ge(),o=Je(),a=it(),r=_(()=>{const{volumeInfo:d}=n,{primarySelection:f}=o,m=a.getLayers(f).filter(({selection:w})=>w.type==="dicom"),g=m.map(({selection:w})=>w.volumeKey),v=m.filter(({id:w})=>w in a.layerImages).map(({selection:w})=>w.volumeKey),h=(f==null?void 0:f.type)==="dicom"&&f.volumeKey;return t.value.map(w=>{const D={type:"dicom",volumeKey:w},b=g.includes(w),S=v.includes(w),V=b&&!S,C=w!==h&&f;return{key:w,cacheKey:ro(w),info:d[w],selectionKey:D,layerable:C,loading:V,layerIcon:b?"mdi-layers-minus":"mdi-layers-plus",layerTooltip:b?"Remove Layer":"Add Layer",layerHandler:()=>{!V&&C&&(b?a.deleteLayer(f,D):a.addLayer(f,D))}}})}),s=Me({});B(t,d=>{d.forEach(async m=>{const g=ro(m);if(!(g in s))try{const v=await xp(n,m);if(v!==null){const h=Op(v);s[g]=h}}catch(v){v instanceof Error&&Qe().addError("Failed to generate thumbnails",{details:`${v}. More details can be found in the developer's console.`})}});const f=new Set(d.map(m=>ro(m)));Object.keys(s).forEach(m=>{f.has(m)||delete s[m]})},{immediate:!0,deep:!0});const{selected:i,selectedAll:l,selectedSome:c}=Go(t);return{selected:i,selectedAll:l,selectedSome:c,thumbnailCache:s,volumes:r,removeSelectedDICOMVolumes:()=>{i.value.forEach(async d=>{n.deleteVolume(d)}),i.value=[]}}}});const Fp={class:"my-2 volume-list"},Np={class:"thumbnail-container"},Up={class:"d-flex flex-column fill-height"},Wp={class:"layer-btn-container"},zp={class:"mb-1 ml-1 text-caption"},jp={class:"text-ellipsis"};function Hp(e,t,n,o,a,r){const s=F("persistent-overlay"),i=F("groupable-item");return k(),U(Pt,{class:"pa-0"},{default:y(()=>[p(oe,{"no-gutters":"",justify:"space-between"},{default:y(()=>[p(le,{cols:"6","align-self":"center"},{default:y(()=>[p(ot,{class:"ml-3 align-center justify-center",indeterminate:e.selectedSome&&!e.selectedAll,label:"Select All",modelValue:e.selectedAll,"onUpdate:modelValue":t[0]||(t[0]=l=>e.selectedAll=l),density:"compact","hide-details":""},null,8,["indeterminate","modelValue"])]),_:1}),p(le,{cols:"6","align-self":"center",class:"d-flex justify-end mt-2"},{default:y(()=>[p(ae,{icon:"",variant:"text",disabled:!e.selectedSome,onClick:me(e.removeSelectedDICOMVolumes,["stop"])},{default:y(()=>[p(Z,null,{default:y(()=>[$("mdi-delete")]),_:1}),p(Ee,{location:"left",activator:"parent"},{default:y(()=>[$(" Delete selected ")]),_:1})]),_:1},8,["disabled","onClick"])]),_:1})]),_:1}),p(oe,{"no-gutters":""},{default:y(()=>[p(le,null,{default:y(()=>[I("div",Fp,[(k(!0),x(se,null,ce(e.volumes,l=>(k(),U(i,{key:l.info.VolumeID,value:l.selectionKey},{default:y(({active:c,select:u})=>[p(Oe,{variant:"outlined",ripple:"",class:re({"volume-card":!0,"mt-1":!0,"volume-card-active":c}),"min-height":"180px","min-width":"180px","html-title":l.info.SeriesDescription,onClick:u},{default:y(()=>[p(oe,{"no-gutters":"",class:"pa-0",justify:"center"},{default:y(()=>[I("div",Np,[p(Ln,{cover:"",height:"150",width:"150",src:(e.thumbnailCache||{})[l.cacheKey]||""},{placeholder:y(()=>[p(oe,{class:"fill-height ma-0",align:"center",justify:"center"},{default:y(()=>[p(At,{indeterminate:"",color:"grey-lighten-5"})]),_:1})]),default:y(()=>[p(s,null,{default:y(()=>[I("div",Up,[p(oe,{"no-gutters":"",justify:"end","align-content":"start"},{default:y(()=>[I("div",Wp,[p(ae,{disabled:!l.layerable,loading:l.loading,icon:"",variant:"plain",density:"compact",onClick:me(l.layerHandler,["stop"])},{default:y(()=>[p(Z,{icon:l.layerIcon},null,8,["icon"]),p(Ee,{location:"top",activator:"parent"},{default:y(()=>[$(j(l.layerTooltip),1)]),_:2},1024)]),_:2},1032,["disabled","loading","onClick"])]),(k(),U(ot,{key:l.info.VolumeID,value:l.key,modelValue:e.selected,"onUpdate:modelValue":t[1]||(t[1]=d=>e.selected=d),onClick:t[2]||(t[2]=me(()=>{},["stop"])),density:"compact","hide-details":"",class:"series-selector"},null,8,["value","modelValue"]))]),_:2},1024),p(ht),p(oe,{"no-gutters":"",justify:"start",align:"end"},{default:y(()=>[I("div",zp," ["+j(l.info.NumberOfSlices)+"] ",1)]),_:2},1024)])]),_:2},1024)]),_:2},1032,["src"])])]),_:2},1024),p(Ht,{class:"text--primary text-caption text-center series-desc mt-n3"},{default:y(()=>[I("div",jp,j(l.info.SeriesDescription||"(no description)"),1)]),_:2},1024)]),_:2},1032,["class","html-title","onClick"])]),_:2},1032,["value"]))),128))])]),_:1})]),_:1})]),_:1})}const Gp=H(Bp,[["render",Hp],["__scopeId","data-v-c0458abd"]]),Kp=z({name:"PatientBrowser",props:{patientKey:{type:String,required:!0}},components:{ItemGroup:jo,PatientStudyVolumeBrowser:Gp},setup(e){const{patientKey:t}=Y(e),n=M([]),o=ge(),a=Je(),r=_(()=>a.primarySelection),s=_(()=>{const m=t.value,{patientStudies:g,studyInfo:v,studyVolumes:h}=o;return(g[m]??[]).map(w=>{const D=v[w];return{...D,key:w,title:D.StudyDescription||D.StudyDate||D.StudyInstanceUID,volumeKeys:h[w].sort()}})}),i=_(()=>s.value.map(m=>m.key)),l=M([]);B(i,m=>{l.value=Array.from(new Set([...l.value,...m]))},{immediate:!0});const{selected:c,selectedAll:u,selectedSome:d}=Go(i);return{selected:c,selectedAll:u,selectedSome:d,selectedSeries:n,primarySelection:r,removeSelectedStudies:()=>{c.value.forEach(async m=>{o.deleteStudy(m)}),c.value=[]},studies:s,selectionEquals:Eo,setPrimarySelection:m=>{a.setPrimarySelection(m)},panels:l}}});const qp={class:"study-header"},Zp={class:"study-header-title"},Qp={class:"ml-2 overflow-hidden text-no-wrap"},Jp=["title"],Yp={key:0,class:"text-caption text-truncate"},Xp={class:"d-flex flex-column align-center justify-end mx-2"},eg={class:"d-flex flex-row align-center mr-2"},tg={class:"text-caption text--secondary text-no-wrap"};function ng(e,t,n,o,a,r){const s=F("patient-study-volume-browser"),i=F("item-group");return k(),U(i,{"model-value":e.primarySelection,"equals-test":e.selectionEquals,"onUpdate:modelValue":e.setPrimarySelection},{default:y(()=>[p(Pt,{class:"pa-0"},{default:y(()=>[p(oe,{"no-gutters":"",justify:"space-between",class:"mb-2"},{default:y(()=>[p(le,{cols:"6","align-self":"center"},{default:y(()=>[p(ot,{class:"ml-3 align-center justify-center",indeterminate:e.selectedSome&&!e.selectedAll,label:"Select All Studies",modelValue:e.selectedAll,"onUpdate:modelValue":t[0]||(t[0]=l=>e.selectedAll=l),density:"compact","hide-details":""},null,8,["indeterminate","modelValue"])]),_:1}),p(le,{cols:"6","align-self":"center",class:"d-flex justify-end mt-2"},{default:y(()=>[p(ae,{icon:"",variant:"text",disabled:!e.selectedSome,onClick:me(e.removeSelectedStudies,["stop"])},{default:y(()=>[p(Z,null,{default:y(()=>[$("mdi-delete")]),_:1}),p(Ee,{activator:"parent",location:"left"},{default:y(()=>[$(" Delete Selected ")]),_:1})]),_:1},8,["disabled","onClick"])]),_:1})]),_:1})]),_:1}),p(dn,{modelValue:e.panels,"onUpdate:modelValue":t[3]||(t[3]=l=>e.panels=l),id:"patient-data-studies",accordion:"",multiple:""},{default:y(()=>[(k(!0),x(se,null,ce(e.studies,l=>(k(),U(dt,{key:l.StudyInstanceUID,value:l.StudyInstanceUID,class:"patient-data-study-panel"},{default:y(()=>[p(ft,{color:"#1976fa0a",class:"pl-3 no-select",title:l.StudyDate},{default:y(()=>[I("div",qp,[I("div",Zp,[(k(),U(ot,{class:"study-selector",density:"compact","hide-details":"",key:l.StudyInstanceUID,value:l.StudyInstanceUID,modelValue:e.selected,"onUpdate:modelValue":t[1]||(t[1]=c=>e.selected=c),onClick:t[2]||(t[2]=me(()=>{},["stop"]))},null,8,["value","modelValue"])),p(Z,null,{default:y(()=>[$("mdi-folder-table")]),_:1}),I("div",Qp,[I("div",{class:"text-subtitle-2 text-truncate",title:l.title},j(l.title),9,Jp),l.StudyDescription?(k(),x("div",Yp,j(l.StudyDate),1)):G("",!0)])]),I("div",Xp,[I("div",eg,[p(Z,{small:""},{default:y(()=>[$("mdi-folder-open")]),_:1}),I("span",tg," : "+j(l.volumeKeys.length),1),p(Ee,{location:"bottom",activator:"parent"},{default:y(()=>[$(" Total series in study ")]),_:1})])])])]),_:2},1032,["title"]),p(pt,null,{default:y(()=>[p(s,{"volume-keys":l.volumeKeys},null,8,["volume-keys"])]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["model-value","equals-test","onUpdate:modelValue"])}const og=H(Kp,[["render",ng],["__scopeId","data-v-3c13102a"]]),ag=e=>{if(!e||e.total===0)return 0;const{total:t,loaded:n}=e;return Math.round(100*n/t)},sg=z({name:"StudyVolumeDicomWeb",props:{volumeKeys:{type:Array,required:!0}},components:{PersistentOverlay:qn},setup(e){const{volumeKeys:t}=Y(e),n=et(),o=Cn(),a=M(!0);o.fetchVolumesMeta(t.value).then(()=>{a.value=!1});const r=_(()=>{if(a.value)return[];const{volumeInfo:l,volumeInstances:c,instanceInfo:u}=n;return t.value.map(d=>{const{Rows:f,Columns:m}=u[c[d][0]],g=l[d];return{key:d,info:g,widthHeightFrames:`${m} x ${f} x ${g.NumberOfSlices}`,isDisabled:!qi(o.volumes[d]),progress:{...o.volumes[d],percent:ag(o.volumes[d])}}})}),s=Me({});B([t,a],([l,c])=>{c||l.filter(u=>!(u in s)).forEach(async u=>{const d=await o.fetchVolumeThumbnail(u);d!==null&&(s[u]=d)})},{immediate:!0,deep:!0});function i(l){o.downloadVolume(l)}return{thumbnailCache:s,volumes:r,downloadDicom:i,formatBytes:mc,isFetching:a}}});const ig={class:"my-2 volume-list"},rg={class:"thumbnail-container"},lg={class:"mb-1 ml-1 text-caption"},cg={class:"d-flex flex-column fill-height ma-0"},ug={key:2,class:"text-caption text--white"},dg={key:0,class:"mb-1 text-caption"},fg={class:"text-ellipsis"};function pg(e,t,n,o,a,r){const s=F("persistent-overlay");return k(),U(Pt,{class:"pa-0"},{default:y(()=>[p(oe,{"no-gutters":""},{default:y(()=>[p(le,null,{default:y(()=>[I("div",ig,[e.isFetching?(k(),U(At,{key:0,class:"fetching",indeterminate:""})):G("",!0),(k(!0),x(se,null,ce(e.volumes,i=>(k(),U(Oe,{key:i.info.VolumeID,variant:"outlined",class:"volume-card mt-1","min-height":"180px","min-width":"180px","html-title":i.info.SeriesDescription,disabled:i.isDisabled,ripple:!i.isDisabled,onClick:l=>e.downloadDicom(i.info.VolumeID)},{default:y(()=>[p(oe,{"no-gutters":"",class:"pa-0",justify:"center"},{default:y(()=>[I("div",rg,[p(Ln,{cover:"",height:"150",width:"150",src:(e.thumbnailCache||{})[i.key]||""},{default:y(()=>[p(s,null,{default:y(()=>[p(oe,{"no-gutters":""},{default:y(()=>[I("div",lg,[$(j(i.widthHeightFrames)+" ",1),p(Ee,{location:"top",activator:"parent"},{default:y(()=>[$(" Width by height by frames ")]),_:1})])]),_:2},1024)]),_:2},1024),i.progress&&i.progress.state&&i.progress.state!=="Remote"?(k(),U(s,{key:0},{default:y(()=>[I("div",cg,[p(oe,{"no-gutters":"",justify:"center",align:"end"},{default:y(()=>[p(At,{color:"white",indeterminate:i.progress.percent===0&&i.progress.state!=="Done","model-value":i.progress.percent},{default:y(()=>[i.progress.state==="Done"?(k(),U(Z,{key:0,color:"white"},{default:y(()=>[$(" mdi-check ")]),_:1})):i.progress.state==="Error"?(k(),U(Z,{key:1,color:"white"},{default:y(()=>[$(" mdi-alert-circle ")]),_:1})):i.progress.percent!==0?(k(),x("span",ug,j(i.progress.percent),1)):G("",!0)]),_:2},1032,["indeterminate","model-value"])]),_:2},1024),p(oe,{"no-gutters":"",justify:"center",align:"end"},{default:y(()=>[i.progress.loaded!==0?(k(),x("div",dg,j(e.formatBytes(i.progress.loaded)),1)):G("",!0)]),_:2},1024)])]),_:2},1024)):G("",!0)]),_:2},1032,["src"])])]),_:2},1024),p(Ht,{class:"text--primary text-caption text-center series-desc mt-n3"},{default:y(()=>[I("div",fg,j(i.info.SeriesDescription||"(no series description)"),1)]),_:2},1024)]),_:2},1032,["html-title","disabled","ripple","onClick"]))),128))])]),_:1})]),_:1})]),_:1})}const gg=H(sg,[["render",pg],["__scopeId","data-v-4de834a9"]]),mg=z({name:"PatientDetails",props:{patientKey:{type:String,required:!0}},components:{StudyVolumeDicomWeb:gg},setup(e){const{patientKey:t}=Y(e),n=et(),o=Cn(),a=M(!0);return o.fetchPatientMeta(t.value).then(()=>{a.value=!1}),{studies:_(()=>{const{patientStudies:s,studyInfo:i,studyVolumes:l}=n;return s[t.value].map(c=>{const u=i[c];return{...u,key:c,title:u.StudyDescription||u.StudyDate||u.StudyInstanceUID,volumeKeys:l[c].sort()}})}),isFetching:a}}});const vg={class:"study-header"},hg={class:"study-header-title"},yg={class:"ml-2 overflow-hidden text-no-wrap"},wg=["title"],Cg={key:0,class:"text-caption text-truncate"},Sg={class:"d-flex flex-column align-center justify-end mx-2"},_g={class:"d-flex flex-row align-center mr-2"},bg={class:"text-caption text--secondary text-no-wrap"};function Ig(e,t,n,o,a,r){const s=F("study-volume-dicom-web");return k(),U(dn,{id:"patient-data-studies",accordion:"",multiple:""},{default:y(()=>[(k(!0),x(se,null,ce(e.studies,i=>(k(),U(dt,{key:i.StudyInstanceUID,class:"patient-data-study-panel"},{default:y(()=>[p(ft,{color:"#1976fa0a",class:"pl-3 no-select",title:i.StudyDate},{default:y(()=>[I("div",vg,[I("div",hg,[p(Z,{class:"mb-2"},{default:y(()=>[$("mdi-folder-table")]),_:1}),I("div",yg,[I("div",{class:"text-subtitle-2 text-truncate",title:i.title},j(i.title),9,wg),i.StudyDescription?(k(),x("div",Cg,j(i.StudyDate),1)):G("",!0)])]),I("div",Sg,[I("div",_g,[e.isFetching?(k(),U(At,{key:0,indeterminate:"",size:20,width:2,class:"mr-2"})):G("",!0),p(Z,{size:"small"},{default:y(()=>[$("mdi-folder-open")]),_:1}),I("span",bg," : "+j(i.volumeKeys.length),1),p(Ee,{location:"bottom",activator:"parent"},{default:y(()=>[$(" Total series in study ")]),_:1})])])])]),_:2},1032,["title"]),p(pt,null,{default:y(()=>[p(s,{"volume-keys":i.volumeKeys},null,8,["volume-keys"])]),_:2},1024)]),_:2},1024))),128))]),_:1})}const Dg=H(mg,[["render",Ig],["__scopeId","data-v-fc2fc5ae"]]),Ag=z({components:{PatientDetails:Dg},setup(){const e=Cn(),t=et();return e.fetchInitialDicomsOnce(),{patients:_(()=>Object.values(t.patientInfo).map(o=>({key:o.PatientID,name:o.PatientName})).sort((o,a)=>o.name<a.name?-1:1)),dicomWeb:e}}});const Tg={key:0,class:"error-message"},kg={class:"patient-header"},Eg=["title"];function Rg(e,t,n,o,a,r){const s=F("patient-details");return e.dicomWeb.message.length>0?(k(),x("p",Tg,j(e.dicomWeb.message),1)):e.patients.length>0?(k(),U(dn,{key:1,multiple:"",accordion:""},{default:y(()=>[(k(!0),x(se,null,ce(e.patients,i=>(k(),U(dt,{key:i.key},{default:y(()=>[p(ft,null,{default:y(()=>[I("div",kg,[p(Z,{class:"collection-header-icon"},{default:y(()=>[$("mdi-account")]),_:1}),I("span",{class:"patient-header-name",title:i.name},j(i.name),9,Eg)])]),_:2},1024),p(pt,null,{default:y(()=>[p(s,{"patient-key":i.key},null,8,["patient-key"])]),_:2},1024)]),_:2},1024))),128))]),_:1})):G("",!0)}const Vg=H(Ag,[["render",Rg],["__scopeId","data-v-70b77c48"]]),lo="sampleData",Na="anonymousData",Mg="dicomWeb",Pg=z({name:"DataBrowser",components:{SampleDataBrowser:pp,ImageDataBrowser:$p,PatientBrowser:og,PatientList:Vg},setup(){const e=ge(),t=_e(),n=Cn(),o=_(()=>Object.entries(e.patientInfo).map(([s,i])=>({key:s,name:i.PatientName,info:i})).sort((s,i)=>s.name<i.name?-1:1)),a=_(()=>t.idList.filter(s=>!(s in e.imageIDToVolumeKey)).length>0),r=M([lo]);return B([a,o],([s,i])=>{const l=i.length>0;s&&r.value.push(Na),l&&r.value.push(...i.map(c=>c.key)),(s||l)&&yt(r.value,lo)}),{panels:r,patients:o,deletePatient:e.deletePatient,hasAnonymousImages:a,dicomWeb:n,SAMPLE_DATA_KEY:lo,ANONYMOUS_DATA_KEY:Na,DICOM_WEB_KEY:Mg}}});const Qi=e=>(Ue("data-v-b9571660"),e=e(),We(),e),Lg={id:"data-module",class:"mx-1 fill-height"},$g={id:"data-panels"},Og=Qi(()=>I("span",null,"Anonymous",-1)),xg={class:"patient-header"},Bg=["title"],Fg={class:"text-truncate"},Ng=Qi(()=>I("span",null,"Sample Data",-1));function Ug(e,t,n,o,a,r){const s=F("image-data-browser"),i=F("patient-browser"),l=F("patient-list"),c=F("sample-data-browser");return k(),x("div",Lg,[I("div",$g,[p(dn,{modelValue:e.panels,"onUpdate:modelValue":t[1]||(t[1]=u=>e.panels=u),multiple:"",variant:"accordion"},{default:y(()=>[e.hasAnonymousImages?(k(),U(dt,{key:0,value:e.ANONYMOUS_DATA_KEY},{default:y(()=>[p(ft,null,{default:y(()=>[p(Z,{class:"collection-header-icon"},{default:y(()=>[$("mdi-image")]),_:1}),Og]),_:1}),p(pt,null,{default:y(()=>[p(s)]),_:1})]),_:1},8,["value"])):G("",!0),(k(!0),x(se,null,ce(e.patients,u=>(k(),U(dt,{key:u.key,value:u.key},{default:y(()=>[p(ft,null,{default:y(()=>[I("div",xg,[p(Z,{class:"collection-header-icon"},{default:y(()=>[$("mdi-account")]),_:1}),I("span",{class:"patient-header-name",title:u.name},j(u.name),9,Bg),p(ht),p(Dt,{"offset-x":""},{activator:y(({props:d})=>[p(ae,wt(d,{variant:"text",icon:"mdi-dots-vertical",size:"small",class:"mr-3",onClick:t[0]||(t[0]=me(()=>{},["stop"]))}),null,16)]),default:y(()=>[p(It,{density:"compact"},{default:y(()=>[p(xe,{onClick:me(d=>e.deletePatient(u.key),["stop"])},{default:y(()=>[p(we,null,{default:y(()=>[$("Delete Patient")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)])]),_:2},1024),p(pt,null,{default:y(()=>[p(i,{"patient-key":u.key},null,8,["patient-key"])]),_:2},1024)]),_:2},1032,["value"]))),128)),e.dicomWeb.isConfigured?(k(),U(dt,{key:1,value:e.DICOM_WEB_KEY},{default:y(()=>[p(ft,null,{default:y(()=>[p(Z,{class:"collection-header-icon"},{default:y(()=>[$("mdi-cloud-download")]),_:1}),I("span",Fg,j(`${e.dicomWeb.hostName||e.dicomWeb.host} | DICOMWeb`),1)]),_:1}),p(pt,null,{default:y(()=>[p(l)]),_:1})]),_:1},8,["value"])):G("",!0),p(dt,{value:e.SAMPLE_DATA_KEY},{default:y(()=>[p(ft,null,{default:y(()=>[p(Z,{class:"collection-header-icon"},{default:y(()=>[$("mdi-card-bulleted")]),_:1}),Ng]),_:1}),p(pt,null,{default:y(()=>[p(c)]),_:1})]),_:1},8,["value"])]),_:1},8,["modelValue"])])])}const Wg=H(Pg,[["render",Ug],["__scopeId","data-v-b9571660"]]),zg=z({setup(){const e=qe(),{currentImageID:t}=ie(),n=_(()=>{const r=t.value,{lengthByID:s}=e;return e.rulers.filter(i=>i.imageID===r&&!i.placing).map(i=>({...i,length:s[i.id]}))});function o(r){e.removeRuler(r)}function a(r){e.jumpToRuler(r)}return{rulers:n,remove:o,jumpTo:a}}});const jg={class:"value"};function Hg(e,t,n,o,a,r){return k(!0),x(se,null,ce(e.rulers,s=>(k(),U(xe,{key:s.id,lines:"two"},{prepend:y(()=>[p(Z,{class:"tool-icon"},{default:y(()=>[$("mdi-ruler")]),_:1}),I("div",{class:"color-dot mr-3",style:Ge({backgroundColor:s.color})},null,4)]),append:y(()=>[p(oe,null,{default:y(()=>[p(ae,{class:"mr-2",icon:"mdi-target",variant:"text",onClick:i=>e.jumpTo(s.id)},{default:y(()=>[p(Z,null,{default:y(()=>[$("mdi-target")]),_:1}),p(Ee,{location:"top",activator:"parent"},{default:y(()=>[$(" Reveal Slice ")]),_:1})]),_:2},1032,["onClick"]),p(ae,{icon:"mdi-delete",variant:"text",onClick:i=>e.remove(s.id)},{default:y(()=>[p(Z,null,{default:y(()=>[$("mdi-delete")]),_:1}),p(Ee,{location:"top",activator:"parent"},{default:y(()=>[$("Delete")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),default:y(()=>[p(we,ts(ns(e.$attrs)),{default:y(()=>[$(j(s.labelName),1)]),_:2},1040),p(ss,null,{default:y(()=>[p(oe,null,{default:y(()=>[p(le,null,{default:y(()=>[$("Length: "),I("span",jg,j(s.length.toFixed(2))+"mm",1)]),_:2},1024),p(le,null,{default:y(()=>[$("ID: "+j(s.id),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)}const Gg=H(zg,[["render",Hg],["__scopeId","data-v-cee46374"]]),Kg=z({setup(){const e=Ze(),{currentImageID:t}=ie(),n=_(()=>e.tools.filter(r=>!r.placing&&r.imageID===t.value));function o(r){e.removeTool(r)}function a(r){e.jumpToTool(r)}return{rects:n,remove:o,jumpTo:a}}});function qg(e,t,n,o,a,r){return k(!0),x(se,null,ce(e.rects,s=>(k(),U(xe,{key:s.id,lines:"two"},{prepend:y(()=>[p(Z,{class:"tool-icon"},{default:y(()=>[$("mdi-vector-square")]),_:1}),I("div",{class:"color-dot mr-3",style:Ge({backgroundColor:s.color})},null,4)]),append:y(()=>[p(oe,null,{default:y(()=>[p(ae,{class:"mr-2",icon:"mdi-target",variant:"text",onClick:i=>e.jumpTo(s.id)},{default:y(()=>[p(Z,null,{default:y(()=>[$("mdi-target")]),_:1}),p(Ee,{location:"top",activator:"parent"},{default:y(()=>[$(" Reveal Slice ")]),_:1})]),_:2},1032,["onClick"]),p(ae,{icon:"mdi-delete",variant:"text",onClick:i=>e.remove(s.id)},{default:y(()=>[p(Z,null,{default:y(()=>[$("mdi-delete")]),_:1}),p(Ee,{location:"top",activator:"parent"},{default:y(()=>[$("Delete")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),default:y(()=>[p(we,ts(ns(e.$attrs)),{default:y(()=>[$(j(s.labelName),1)]),_:2},1040),p(ss,null,{default:y(()=>[p(oe,null,{default:y(()=>[p(le,null,{default:y(()=>[$("ID: "+j(s.id),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)}const Zg=H(Kg,[["render",qg],["__scopeId","data-v-84b6f397"]]),Qg=z({name:"LabelmapList",setup(){const e=zt();return{labelmaps:_(()=>e.idList.map(n=>({id:n})))}}});function Jg(e,t,n,o,a,r){return e.labelmaps.length?(k(),U(It,{key:0,density:"compact"},{default:y(()=>[(k(!0),x(se,null,ce(e.labelmaps,s=>(k(),U(xe,{key:s.id,lines:"two"},{default:y(()=>[p(we,null,{default:y(()=>[$("Labelmap (ID = "+j(s.id)+")",1)]),_:2},1024)]),_:2},1024))),128))]),_:1})):G("",!0)}const Yg=H(Qg,[["render",Jg],["__scopeId","data-v-ce4f2c3b"]]),Xg={class:"d-flex flex-row"},em={class:"flex-grow-1 d-flex flex-column justify-space-between mr-4"},tm=z({__name:"LabelEditor",props:{label:null,labelsStore:null},emits:["close"],setup(e,{emit:t}){const n=e,o=_(()=>n.labelsStore.labels[n.label]),a=M(o.value.labelName);B(a,i=>{n.labelsStore.updateLabel(n.label,{labelName:i})});const r=M(Sc(o.value.color));B(r,i=>{n.labelsStore.updateLabel(n.label,{color:i})});const s=()=>{t("close"),n.labelsStore.deleteLabel(n.label)};return(i,l)=>(k(),U(Oe,null,{default:y(()=>[p(fn,{class:"d-flex flex-row align-center"},{default:y(()=>[$(" Edit Label "),p(ht),p(ae,{variant:"text",density:"compact",icon:"mdi-close",onClick:l[0]||(l[0]=c=>i.$emit("close"))})]),_:1}),p(hl,null,{default:y(()=>[I("div",Xg,[I("div",em,[I("div",null,[p(Ft,{modelValue:a.value,"onUpdate:modelValue":l[1]||(l[1]=c=>a.value=c),onKeydown:l[2]||(l[2]=Xr(me(c=>i.$emit("close"),["stop"]),["enter"])),label:"Name",class:"flex-grow-0"},null,8,["modelValue"])]),p(is,{class:"mb-2 px-0"},{default:y(()=>[p(ae,{color:"secondary",variant:"elevated",onClick:l[3]||(l[3]=c=>i.$emit("close"))},{default:y(()=>[$(" Done ")]),_:1}),p(ht),p(ae,{color:"red",variant:"tonal",onClick:s},{default:y(()=>[$(" Delete label ")]),_:1})]),_:1})]),p(rs,{modelValue:r.value,"onUpdate:modelValue":l[4]||(l[4]=c=>r.value=c),mode:"rgb",label:"Color"},null,8,["modelValue"])])]),_:1})]),_:1}))}}),nm={class:"dot-container mr-3"},om={class:"overflow-hidden"},am=z({__name:"LabelControls",props:{labelsStore:null},setup(e){const t=e,n=_(()=>Object.entries(t.labelsStore.labels)),o=_(()=>n.value.findIndex(([c])=>c===t.labelsStore.activeLabel)),a=M(void 0),r=()=>{a.value=t.labelsStore.addLabel()},s=M(!1);Ce(()=>{s.value=!!a.value});const i=$n(),l=_(()=>i.mobile.value);return(c,u)=>(k(),x(se,null,[p(Oe,{class:"pt-2"},{default:y(()=>[p(ls,null,{default:y(()=>[$("Labels")]),_:1}),p(Pt,null,{default:y(()=>[p(cs,{"model-value":K(o),"selected-class":"card-active",mandatory:""},{default:y(()=>[p(oe,{dense:""},{default:y(()=>[(k(!0),x(se,null,ce(K(n),([d,{labelName:f,color:m}])=>(k(),U(le,{cols:"6",key:d},{default:y(()=>[p($t,null,{default:y(({selectedClass:g,toggle:v})=>[p(ua,{variant:"tonal",class:re(["w-100 d-flex",g]),onClick:()=>{v(),e.labelsStore.setActiveLabel(d)}},{default:y(()=>[I("div",nm,[I("div",{class:"color-dot",style:Ge({background:m})},null,4)]),I("span",om,j(f),1),p(ae,{icon:"mdi-pencil",density:"compact",class:"ml-auto",variant:"plain",onClick:me(()=>{a.value=d,s.value=!0},["stop"])},null,8,["onClick"])]),_:2},1032,["class","onClick"])]),_:2},1024)]),_:2},1024))),128)),p(le,{cols:"6"},{default:y(()=>[p(ua,{variant:"outlined",class:"w-100",onClick:r},{default:y(()=>[p(Z,{class:"mr-2"},{default:y(()=>[$("mdi-plus")]),_:1}),$(" Add Label ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])]),_:1})]),_:1}),p(Jt,{modelValue:s.value,"onUpdate:modelValue":u[1]||(u[1]=d=>s.value=d),width:K(l)?"100%":"50%"},{default:y(()=>[a.value?(k(),U(tm,{key:0,onClose:u[0]||(u[0]=d=>a.value=void 0),label:a.value,labelsStore:e.labelsStore},null,8,["label","labelsStore"])):G("",!0)]),_:1},8,["modelValue","width"])],64))}});const Ko=H(am,[["__scopeId","data-v-3ba66c80"]]),Ji=z({__name:"RectangleControls",setup(e){const t=Ze();return(n,o)=>(k(),U(Ko,{"labels-store":K(t)},null,8,["labels-store"]))}}),Yi=z({__name:"RulerControls",setup(e){const t=qe();return(n,o)=>(k(),U(Ko,{"labels-store":K(t)},null,8,["labels-store"]))}}),Xi=z({__name:"ContourControls",setup(e){const t=Gn(),{mode:n}=Ke(t);function o(a){t.setMode(a)}return(a,r)=>(k(),U(Oe,{dark:""},{default:y(()=>[p(ls,{class:"my-1"},{default:y(()=>[$("Tools")]),_:1}),p(cs,{mandatory:"","selected-class":"tool-btn-selected","model-value":K(n),"onUpdate:modelValue":o},{default:y(()=>[p($t,{value:K(Ae).Select},{default:y(({selectedClass:s,toggle:i})=>[p(tt,{size:"40",icon:"mdi-cursor-default",name:"Select",buttonClass:s||"",onClick:i},null,8,["buttonClass","onClick"])]),_:1},8,["value"]),p($t,{value:K(Ae).FreehandDraw},{default:y(({selectedClass:s,toggle:i})=>[p(tt,{size:"40",icon:"mdi-draw",name:"Freehand",buttonClass:s||"",onClick:i},null,8,["buttonClass","onClick"])]),_:1},8,["value"]),p($t,{value:K(Ae).PointPlacing},{default:y(({selectedClass:s,toggle:i})=>[p(tt,{size:"40",icon:"mdi-vector-polyline",name:"Point Placing",buttonClass:s||"",onClick:i},null,8,["buttonClass","onClick"])]),_:1},8,["value"]),p($t,{value:K(Ae).Threshold},{default:y(({selectedClass:s,toggle:i})=>[p(tt,{size:"40",icon:"mdi-math-integral",name:"Threshold",buttonClass:s||"",onClick:i},null,8,["buttonClass","onClick"])]),_:1},8,["value"]),p($t,{value:K(Ae).CircleNudge},{default:y(({selectedClass:s,toggle:i})=>[p(tt,{size:"40",icon:"mdi-circle-multiple-outline",name:"Nudge",buttonClass:s||"",onClick:i},null,8,["buttonClass","onClick"])]),_:1},8,["value"])]),_:1},8,["model-value"]),p(Ko,{"labels-store":K(t)},null,8,["labels-store"])]),_:1}))}});const sm={key:0},im={class:"header"},rm={class:"content"},lm=z({__name:"ToolControls",setup(e){const t=Pe(),n=new Map([[ee.Rectangle,{component:Ji,label:"Rectangle"}],[ee.Ruler,{component:Yi,label:"Ruler"}],[ee.Contour,{component:Xi,label:"Contour"}]]),o=_(()=>n.get(t.currentTool));return(a,r)=>K(o)?(k(),x("div",sm,[I("div",im,j(K(o).label),1),I("div",rm,[(k(),U(wo(K(o).component)))])])):G("",!0)}});const cm=H(lm,[["__scopeId","data-v-afbd0ec0"]]),um=z({components:{MeasurementsRulerList:Gg,MeasurementsRectangleList:Zg,LabelmapList:Yg,ToolControls:cm},setup(){}});const Zn=e=>(Ue("data-v-ef15180d"),e=e(),We(),e),dm={class:"overflow-y-auto mx-2 fill-height"},fm=Zn(()=>I("div",{class:"header"},"Measurements",-1)),pm={class:"content"},gm=Zn(()=>I("div",{class:"text-caption text-center empty-state"},"No measurements",-1)),mm=Zn(()=>I("div",{class:"header"},"Labelmaps",-1)),vm={class:"content"},hm=Zn(()=>I("div",{class:"text-caption text-center empty-state"},"No labelmaps",-1));function ym(e,t,n,o,a,r){const s=F("tool-controls"),i=F("measurements-ruler-list"),l=F("measurements-rectangle-list"),c=F("labelmap-list");return k(),x("div",dm,[p(s),fm,I("div",pm,[p(i),p(l)]),gm,mm,I("div",vm,[p(c)]),hm])}const wm=H(um,[["render",ym],["__scopeId","data-v-ef15180d"]]),Cm=[{name:"Data",icon:"database",component:Wg},{name:"Annotations",icon:"pencil",component:wm}],Sm=[ee.Rectangle,ee.Ruler,ee.Contour],_m=z({name:"ModulePanel",setup(){const e=M(0),t=Pe();return B(()=>t.currentTool,n=>{Sm.includes(n)&&(e.value=1)}),{selectedModuleIndex:e,Modules:Cm}}});const bm={class:"fill-height d-flex flex-column"},Im={id:"module-switcher"},Dm={class:"tab-content"},Am={class:"mb-0 mt-1 module-text"},Tm={id:"module-container"};function km(e,t,n,o,a,r){return k(),x("div",bm,[I("div",Im,[p(wl,{id:"module-switcher-tabs",modelValue:e.selectedModuleIndex,"onUpdate:modelValue":t[0]||(t[0]=s=>e.selectedModuleIndex=s),"icons-and-text":"","show-arrows":""},{default:y(()=>[(k(!0),x(se,null,ce(e.Modules,s=>(k(),U(yl,{key:s.name},{default:y(()=>[I("div",Dm,[I("span",Am,j(s.name),1),p(Z,null,{default:y(()=>[$("mdi-"+j(s.icon),1)]),_:2},1024)])]),_:2},1024))),128))]),_:1},8,["modelValue"])]),I("div",Tm,[p(Sl,{modelValue:e.selectedModuleIndex,"onUpdate:modelValue":t[1]||(t[1]=s=>e.selectedModuleIndex=s),touchless:"",class:"fill-height"},{default:y(()=>[(k(!0),x(se,null,ce(e.Modules,s=>(k(),U(Cl,{key:s.name,class:"fill-height"},{default:y(()=>[Vt((k(),U(wo(s.component),{key:s.name})),[[Mt,e.Modules[e.selectedModuleIndex]===s]])]),_:2},1024))),128))]),_:1},8,["modelValue"])])])}const Em=H(_m,[["render",km],["__scopeId","data-v-9c257752"]]);async function Rm(e){const t=e.createReader(),n=[];let o=[];do o=await new Promise((a,r)=>{t.readEntries(a,r)}),n.push(...o);while(o.length);return n}async function Vm(e){return new Promise((t,n)=>{e.file(t,n)})}async function Mm(e){const t=[...e],n=[];for(;t.length;){const o=t.shift();o.isFile?n.push(o):t.push(...await Rm(o))}return Promise.all(n.map(Vm))}const Pm={name:"DragAndDrop",props:{enabled:Boolean},data(){return{dragHover:!1}},methods:{onDragOver(e){if(this.enabled){e.preventDefault();const{types:t}=e.dataTransfer;(t&&t instanceof Array?t.indexOf("Files")!==-1:"Files"in t)&&(this.dragHover=!0,this.dragTimeout!==null&&(window.clearTimeout(this.dragTimeout),this.dragTimeout=null))}},onDragLeave(){this.enabled&&(this.dragTimeout=window.setTimeout(()=>{this.dragHover=!1,this.dragTimeout=null},50))},async onDrop(e){if(this.enabled)if(this.dragHover=!1,e.dataTransfer.items){const t=[...e.dataTransfer.items].map(o=>(o.webkitGetAsEntry||o.getAsEntry).call(o)),n=await Mm(t);this.$emit("drop-files",n)}else this.$emit("drop-files",Array.from(e.dataTransfer.files))}},created(){this.dragTimeout=null}};function Lm(e,t,n,o,a,r){return k(),x("div",wt({onDragover:t[0]||(t[0]=me((...s)=>r.onDragOver&&r.onDragOver(...s),["prevent"])),onDragleave:t[1]||(t[1]=(...s)=>r.onDragLeave&&r.onDragLeave(...s)),onDrop:t[2]||(t[2]=me((...s)=>r.onDrop&&r.onDrop(...s),["prevent"]))},e.$attrs),[De(e.$slots,"default",{dragHover:a.dragHover})],16)}const $m=H(Pm,[["render",Lm]]),Om={name:"volview-full-logo"},xm={width:"362",height:"46",viewBox:"0 0 362 46",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Bm=os('<g clip-path="url(#clip0_137_135)"><path d="M217.55 26.6132C217.498 26.6912 217.447 26.7951 217.37 26.8731C216.06 28.64 213.364 29.3676 210 28.8999C209.846 28.8739 209.692 28.8479 209.537 28.8219C207.509 28.4841 205.3 27.7306 203.092 26.6132C201.782 25.9377 200.472 25.1062 199.214 24.1447C197.853 23.1054 196.621 21.988 195.568 20.7928C193.898 18.9479 192.666 16.9991 191.87 15.1282C190.56 12.0361 190.56 9.28175 191.844 7.48883C193.154 5.7219 195.722 5.04631 198.932 5.54001C200.524 5.77387 202.27 6.31954 204.068 7.12505C205.84 7.93057 207.663 8.99592 209.435 10.3471C212.979 13.0235 215.649 16.2715 217.087 19.3377C218.474 22.2479 218.654 24.8463 217.55 26.6132Z" fill="#3EAE2B"></path><path d="M217.55 26.6132C217.498 26.6912 217.447 26.7951 217.37 26.8731C216.06 28.64 213.364 29.3676 210 28.8998C209.846 28.8739 209.692 28.8479 209.537 28.8219C207.663 28.4321 205.506 27.7306 203.092 26.6132C201.782 25.9376 200.473 25.1061 199.214 24.1447C197.853 23.1054 196.621 21.988 195.568 20.7928C193 16.5054 193.539 11.1786 195.08 9.48961C196.954 7.41087 201.243 6.94315 207.945 11.4904C213.852 15.492 218.089 23.2613 217.55 26.6132Z" fill="black" fill-opacity="0.15"></path><path d="M214.442 22.2479C214.442 22.7416 214.34 23.1833 214.16 23.5731C214.108 23.703 214.031 23.8329 213.929 23.9628C213.518 24.5345 212.85 24.8983 211.951 25.0801C211.053 25.262 209.974 25.2101 208.767 24.9762C206.353 24.5085 203.58 23.2353 201.14 21.4164C201.115 21.3904 201.063 21.3644 201.037 21.3384C198.675 19.5195 196.877 17.3109 195.876 15.2581C194.849 13.1534 194.772 11.3085 195.619 10.1652C196.441 9.02188 198.213 8.68409 200.498 9.1518C202.784 9.61952 205.429 10.8927 207.843 12.7376C210.257 14.5825 212.26 16.8172 213.415 18.9219C214.108 20.1431 214.442 21.2864 214.442 22.2479Z" fill="#3EAE2B"></path><path d="M214.16 23.5731C214.108 23.7031 214.031 23.833 213.929 23.9629C213.518 24.5346 212.85 24.8983 211.951 25.0802C211.053 25.2621 209.974 25.2102 208.767 24.9763C206.353 24.5086 203.58 23.2353 201.14 21.4165C201.114 21.3905 201.063 21.3645 201.037 21.3385C198.187 18.4542 198.059 13.855 199.214 12.5558C200.524 11.3865 202.835 11.4125 207.072 14.2708C210.616 16.6873 213.877 21.1826 214.16 23.5731Z" fill="black" fill-opacity="0.15"></path><path d="M210.616 21.4944C210.436 21.7282 210.128 21.8841 209.666 21.9621C209.204 22.0141 208.613 21.9881 207.92 21.8062C206.559 21.4684 204.915 20.6889 203.374 19.5196C201.834 18.3503 200.652 17.0251 199.985 15.8038C199.651 15.2062 199.471 14.6605 199.394 14.1928C199.343 13.7251 199.42 13.4133 199.599 13.1794C199.779 12.9456 200.062 12.7637 200.524 12.7117C200.96 12.6597 201.525 12.6857 202.193 12.8416C202.835 12.9975 203.58 13.2834 204.324 13.6731C205.069 14.0629 205.865 14.5566 206.61 15.1542C208.151 16.3235 209.383 17.6487 210.102 18.844C210.462 19.4416 210.667 19.9873 210.744 20.455C210.847 20.9487 210.77 21.2865 210.616 21.4944Z" fill="#3EAE2B"></path><path d="M211.309 21.8061C211.078 22.4038 210.847 22.8455 210.462 23.3912C208.151 26.5093 203.323 26.951 199.933 24.3786C196.543 21.8061 195.67 16.999 197.956 13.8809C198.418 13.3093 198.752 12.9195 199.291 12.4778C199.188 12.5557 199.111 12.6337 199.034 12.7376C198.701 13.1794 198.624 13.725 198.701 14.2967C198.778 14.8683 199.009 15.5179 199.368 16.1675C200.087 17.4668 201.346 18.8959 202.963 20.1172C204.581 21.3384 206.302 22.1699 207.791 22.5077C208.536 22.6896 209.229 22.7416 209.794 22.6636C210.385 22.5857 210.898 22.3518 211.232 21.9101C211.258 21.9101 211.284 21.8581 211.309 21.8061Z" fill="#0068C7"></path><path d="M214.879 24.0148C214.571 24.9502 213.441 26.6652 212.747 27.4447C209.101 32.3558 201.448 33.2132 195.953 29.0558C190.483 24.9762 189.482 16.6873 193.128 11.7502C193.693 10.9967 194.643 9.80143 195.465 9.09985C195.285 9.25576 195.105 9.43765 194.951 9.64552C193.821 11.1786 194.078 13.4132 195.131 15.6219C196.21 17.8565 198.136 20.1951 200.627 22.092C201.885 23.0534 203.22 23.8589 204.581 24.4825C205.942 25.1062 207.303 25.5739 208.562 25.8077C209.846 26.0676 211.027 26.1195 212.054 25.9117C213.081 25.7038 213.954 25.2621 214.545 24.4825C214.699 24.3266 214.802 24.1707 214.879 24.0148Z" fill="#0068C7"></path><path d="M218.577 26.4054C218.012 27.9385 216.959 29.8353 215.495 31.5503C209.589 38.3582 199.368 39.6314 192.024 34.0448C184.705 28.5101 182.985 18.3503 187.787 10.633C188.865 8.89203 190.945 6.83928 192.178 5.95581C192.152 5.98179 191.459 6.6314 191.176 7.02116C189.61 9.15187 189.738 12.296 191.099 15.466C192.46 18.6881 195.08 22.066 198.701 24.8204C200.524 26.1975 202.424 27.2889 204.324 28.1204C206.225 28.9519 208.125 29.4716 209.871 29.7314C213.364 30.1991 216.445 29.5235 218.012 27.3928C218.243 27.081 218.448 26.7432 218.577 26.4054Z" fill="#0068C7"></path><path d="M217.832 18.9739C216.317 15.7779 213.544 12.4259 209.923 9.67158C206.328 6.91725 202.424 5.22828 199.06 4.70859C197.853 4.5267 196.672 4.50072 195.619 4.63064C195.568 4.63064 195.516 4.63064 195.491 4.65662C195.337 4.68261 195.157 4.70859 195.003 4.73458C194.977 4.73458 194.951 4.73458 194.9 4.76056C194.797 4.78654 194.695 4.81253 194.618 4.83851C194.515 4.8645 194.438 4.89048 194.361 4.91647C194.284 4.94245 194.207 4.96843 194.13 4.99442C193.385 5.22828 192.717 5.59206 192.127 6.05977C191.767 6.31962 191.459 6.63143 191.176 7.02119C189.61 9.1519 189.738 12.296 191.099 15.4661C192.46 18.6881 195.08 22.0661 198.701 24.8204C200.524 26.1976 202.424 27.2889 204.324 28.1204C206.225 28.9519 208.125 29.4716 209.871 29.7314C213.364 30.1991 216.445 29.5236 218.012 27.3928C218.243 27.107 218.423 26.7692 218.577 26.4314C219.527 24.3527 219.116 21.6763 217.832 18.9739ZM217.55 26.6133C217.498 26.6913 217.447 26.7952 217.37 26.8732C216.06 28.6401 213.364 29.3676 210 28.8999C209.846 28.8739 209.692 28.848 209.537 28.822C207.509 28.4842 205.3 27.7306 203.092 26.6133C201.782 25.9377 200.473 25.1062 199.214 24.1448C197.853 23.1054 196.621 21.9881 195.568 20.7928C193.899 18.948 192.666 16.9991 191.87 15.1283C190.56 12.0362 190.56 9.28182 191.844 7.48891C193.154 5.72198 195.722 5.04639 198.932 5.54009C200.524 5.77395 202.27 6.31962 204.068 7.12513C205.84 7.93064 207.663 8.99599 209.435 10.3472C212.979 13.0236 215.649 16.2716 217.087 19.3377C218.474 22.248 218.654 24.8464 217.55 26.6133Z" fill="white"></path><path d="M214.16 18.5061C212.953 16.2975 210.873 13.9589 208.382 12.062C205.891 10.1652 203.143 8.84 200.704 8.3463C198.88 7.95654 197.16 8.03449 195.927 8.78803C195.901 8.78803 195.876 8.81402 195.876 8.81402C195.876 8.81402 195.85 8.81402 195.85 8.84C195.799 8.86599 195.747 8.89197 195.722 8.94394C195.645 8.99591 195.568 9.07386 195.491 9.12583C195.311 9.28173 195.131 9.46362 194.977 9.6715C193.847 11.2046 194.104 13.4392 195.157 15.6479C196.235 17.8825 198.161 20.2211 200.652 22.118C201.911 23.0794 203.246 23.8849 204.607 24.5085C205.968 25.1321 207.329 25.5998 208.587 25.8337C209.871 26.0935 211.053 26.1455 212.08 25.9376C213.107 25.7298 213.98 25.288 214.571 24.5085C214.673 24.3786 214.776 24.2227 214.853 24.0668C215.675 22.5077 215.238 20.4809 214.16 18.5061ZM213.929 23.9628C213.518 24.5345 212.85 24.8983 211.951 25.0802C211.053 25.262 209.974 25.2101 208.767 24.9762C206.353 24.5085 203.58 23.2353 201.14 21.4164C198.726 19.5975 196.877 17.3369 195.876 15.2581C194.849 13.1534 194.772 11.3085 195.619 10.1652C196.441 9.02189 198.213 8.6841 200.498 9.15181C202.784 9.61953 205.429 10.8928 207.843 12.7376C210.256 14.5825 212.259 16.8172 213.415 18.9219C214.108 20.1691 214.442 21.3124 214.442 22.2739C214.442 22.9235 214.288 23.4951 213.929 23.9628Z" fill="white"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M211.515 20.351C211.412 19.7793 211.155 19.1297 210.77 18.4801C210 17.1809 208.716 15.7778 207.098 14.5565C205.506 13.3352 203.837 12.4778 202.398 12.14C201.679 11.9581 201.012 11.9061 200.447 11.9841C200.01 12.036 199.599 12.2179 199.291 12.4778C199.189 12.5557 199.111 12.6337 199.034 12.7376C198.701 13.1793 198.624 13.725 198.701 14.2967C198.778 14.8683 199.009 15.5179 199.368 16.1675C200.087 17.4667 201.346 18.8959 202.963 20.1171C204.581 21.3384 206.302 22.1699 207.791 22.5077C208.536 22.6896 209.229 22.7415 209.794 22.6636C210.385 22.5856 210.899 22.3518 211.232 21.91C211.258 21.8581 211.284 21.8321 211.309 21.7801C211.54 21.3904 211.592 20.8707 211.515 20.351ZM210.616 21.4943C210.436 21.7281 210.128 21.8841 209.666 21.962C209.204 22.014 208.613 21.988 207.92 21.8061C206.559 21.4683 204.915 20.6888 203.374 19.5195C201.834 18.3502 200.652 17.025 199.985 15.8037C199.651 15.2061 199.471 14.6604 199.394 14.1927C199.343 13.725 199.42 13.4132 199.599 13.1793C199.779 12.9455 200.062 12.7636 200.524 12.7116C200.96 12.6596 201.525 12.6856 202.193 12.8415C202.835 12.9974 203.58 13.2833 204.324 13.673C205.069 14.0628 205.865 14.5565 206.61 15.1541C208.151 16.3234 209.383 17.6486 210.102 18.8439C210.462 19.4415 210.667 19.9872 210.744 20.4549C210.847 20.9486 210.77 21.2864 210.616 21.4943Z" fill="white"></path></g><path d="M246.292 9.76333H243.172L235.252 31.1633L227.372 9.76333H224.252L233.692 35.0433H236.852L246.292 9.76333ZM261.251 25.4033C261.251 29.8033 260.131 32.6033 255.691 32.6033C251.251 32.6033 250.091 29.8033 250.091 25.4033C250.091 21.0033 251.251 18.2033 255.691 18.2033C260.131 18.2033 261.251 21.0033 261.251 25.4033ZM255.691 35.3633C261.771 35.3633 264.171 31.2833 264.171 25.4033C264.171 19.4033 261.891 15.4433 255.691 15.4433C249.571 15.4433 247.171 19.5233 247.171 25.4033C247.171 31.4033 249.451 35.3633 255.691 35.3633ZM268.747 29.6833C268.747 33.8433 270.827 35.2833 273.587 35.2833C274.627 35.2833 275.427 35.1233 275.947 34.8833L275.547 32.2433C275.107 32.4433 274.507 32.5233 273.827 32.5233C272.467 32.5233 271.667 31.8833 271.667 29.2433V7.76333H268.747V29.6833Z" fill="#3EAE2B"></path><path d="M299.261 9.76333H296.141L288.221 31.1633L280.341 9.76333H277.221L286.661 35.0433H289.821L299.261 9.76333ZM302.505 35.0433H305.425V15.7633H302.505V35.0433ZM302.065 9.16333C302.065 10.2033 302.905 11.0433 303.985 11.0433C305.025 11.0433 305.865 10.2033 305.865 9.16333C305.865 8.12333 305.025 7.24333 303.985 7.24333C302.905 7.24333 302.065 8.08333 302.065 9.16333ZM326.615 23.8833C326.615 18.2833 323.615 15.4433 318.535 15.4433C312.215 15.4433 310.175 19.8833 310.175 25.4433C310.175 32.2833 313.295 35.3633 319.455 35.3633C321.815 35.3633 324.095 34.8833 325.975 34.0433L325.535 31.2833C324.095 32.0433 321.735 32.6033 319.495 32.6033C315.495 32.6033 313.135 30.8033 313.135 26.7233V26.5633H326.295C326.535 25.7233 326.615 24.6833 326.615 23.8833ZM313.135 23.8433C313.135 19.6833 315.215 18.0433 318.455 18.0433C321.735 18.0433 323.815 19.7233 323.815 23.8433V24.0833H313.135V23.8433ZM332.648 15.7633H329.648L336.368 35.0433H339.368L344.608 20.2833L349.848 35.0433H352.848L359.568 15.7633H356.568L351.328 31.0833L346.088 15.7633H343.128L337.888 31.0833L332.648 15.7633Z" fill="#0068C7"></path><path d="M8.87229 5.59206L0.781128 14.7137L2.74742 16.9885L13.3699 5.00647H10.1831C9.68593 5.00647 9.2113 5.20917 8.87229 5.59206Z" fill="#3EAE2B"></path><path d="M15.0876 5.59206L3.85486 18.2497L5.82115 20.5245L19.5852 5.00647H16.3984C15.9012 5.00647 15.404 5.20917 15.0876 5.59206Z" fill="#3EAE2B"></path><path d="M25.7778 5.00647H22.6137C22.1165 5.00647 21.6193 5.23169 21.2802 5.59206L6.90601 21.8083L19.879 36.8308C20.218 37.2137 20.6926 37.4389 21.2124 37.4389H24.3314L10.8386 21.8308L25.7778 5.00647Z" fill="#3EAE2B"></path><path d="M12.059 37.4389L0.781128 24.3983V28.9479L7.60663 36.8307C7.94565 37.2136 8.42027 37.4389 8.94009 37.4389H12.059Z" fill="#0068C7"></path><path d="M18.2065 37.4389L0.781128 17.2812V21.8308L13.7541 36.8308C14.0931 37.2137 14.5677 37.4389 15.0876 37.4389H18.2065Z" fill="#0068C7"></path><path d="M31.2925 7.37134H34.2532V35.029H31.2925V7.37134ZM43.2936 15.4794H47.068L38.9316 24.7137L47.8816 35.0065H44.1073L35.1573 24.7137L43.2936 15.4794Z" fill="#0068C7"></path><path d="M51.6786 6.85327C52.7408 6.85327 53.5996 7.75417 53.5996 8.79021C53.5996 9.84877 52.7408 10.7046 51.6786 10.7046C50.5711 10.7046 49.7349 9.84877 49.7349 8.79021C49.7349 7.70913 50.5937 6.85327 51.6786 6.85327ZM50.1869 15.4794H53.1476V35.0289H50.1869V15.4794Z" fill="#0068C7"></path><path d="M57.6453 10.2091H60.606V15.4794H68.4486V18.2722H60.606V28.1596C60.606 31.5154 62.1203 32.5289 64.3804 32.5289C66.0077 32.5289 67.7253 32.1235 68.8554 31.6055L69.3074 34.3983C67.9965 34.9614 66.2111 35.3217 64.3804 35.3217C60.4252 35.3217 57.6227 33.4974 57.6227 28.137V10.2091H57.6453Z" fill="#0068C7"></path><path d="M79.0032 31.0199L84.337 15.4794H87.343L92.6768 30.9974L97.988 15.4794H101.039L94.2137 35.0289H91.1625L85.8287 20.074L80.4949 35.0289H77.4437L70.6182 15.4794H73.6694L79.0032 31.0199Z" fill="#0068C7"></path><path d="M117.109 34.2182C115.278 34.8713 112.385 35.3443 109.673 35.3443C104.949 35.3443 101.83 33.7677 101.83 29.3533C101.83 24.9839 104.972 23.3173 110.283 23.3173H114.148V21.4029C114.148 18.7227 112.272 17.8668 109.176 17.8668C106.893 17.8668 105.017 18.2722 103.797 18.7227L103.345 15.9975C104.927 15.547 106.915 15.1416 109.289 15.1416C113.764 15.1416 117.109 16.7632 117.109 21.6281V34.2182ZM114.148 25.6596H110.328C106.712 25.6596 104.791 26.5605 104.791 29.3083C104.791 32.056 106.712 32.7993 109.582 32.7993C111.006 32.7993 112.882 32.6416 114.148 32.2362V25.6596Z" fill="#0068C7"></path><path d="M121.651 16.2902C122.962 15.6821 125.403 15.1866 127.799 15.1866C129.336 15.1866 130.647 15.3443 131.709 15.6821L131.144 18.4299C130.534 18.1821 129.313 17.9794 127.889 17.9794C126.217 17.9794 125.335 18.1821 124.635 18.4975V35.0065H121.674V16.2902H121.651Z" fill="#0068C7"></path><path d="M148.931 26.4253H135.528V26.583C135.528 30.7271 137.924 32.5515 141.992 32.5515C144.275 32.5515 146.671 31.9884 148.14 31.2226L148.592 34.0154C146.671 34.8713 144.365 35.3442 141.97 35.3442C135.709 35.3442 132.522 32.2136 132.522 25.2992C132.522 19.6686 134.602 15.1641 141.02 15.1641C146.196 15.1641 149.247 18.0469 149.247 23.7226C149.247 24.5334 149.157 25.5695 148.931 26.4253ZM135.528 23.9253H146.399V23.6776C146.399 19.5109 144.275 17.7992 140.953 17.7992C137.653 17.7992 135.551 19.4659 135.551 23.6776V23.9253H135.528Z" fill="#0068C7"></path><line x1="170.559" y1="0.935669" x2="170.559" y2="42.4279" stroke="#CACACA"></line><defs><clipPath id="clip0_137_135"><rect width="34" height="33" fill="white" transform="translate(185.09 4.55261)"></rect></clipPath></defs>',17),Fm=[Bm];function Nm(e,t,n,o,a,r){return k(),x("svg",xm,Fm)}const er=H(Om,[["render",Nm]]),Um="/assets/KitwareHeadAndNeck-6fe4377e.jpg";const Wm=z({name:"AboutBox",components:{VolViewFullLogo:er},setup(){return{mobile:$n().xs,versions:{volview:"4.1.0","vtk.js":"27.4.6","itk-wasm":"1.0.0-b.66"}}}}),de=e=>(Ue("data-v-1fc1ea8c"),e=e(),We(),e),zm=de(()=>I("h2",{class:"mt-2"},"About VolView",-1)),jm={class:"float-right"},Hm=de(()=>I("br",null,null,-1)),Gm=de(()=>I("p",null,[I("a",{rel:"noopener noreferrer",target:"_blank",href:"https://volview.kitware.com/"},[I("span",null,"VolView")]),$(" is an open-source web application developed at "),I("a",{rel:"noopener noreferrer",target:"_blank",href:"https://kitware.com/"},[I("span",null,"Kitware")]),$(" for visualizing and annotating medical images. It key features include: ")],-1)),Km=de(()=>I("ul",{class:"pl-6"},[I("li",null,"Fast: Drag-and-drop DICOM files for quick viewing"),I("li",null," Flexible: Designed to be easily integrated into existing systems "),I("li",null," Beautiful: Cinematic volume rendering to generate high-quality 3D visualizations "),I("li",null," Friendly: Familiar radiological image visualization and annotation tools "),I("li",null," Secure: Your data stays on your machine. No cloud services or data servers are used. ")],-1)),qm=de(()=>I("br",null,null,-1)),Zm=de(()=>I("a",{rel:"noopener noreferrer",target:"_blank",href:"https://github.com/InsightSoftwareConsortium/itk-wasm/"},[I("span",null,"itk-wasm")],-1)),Qm=de(()=>I("a",{rel:"noopener noreferrer",target:"_blank",href:"https://github.com/Kitware/vtk-js"},[I("span",null,"vtk.js")],-1)),Jm=de(()=>I("br",null,null,-1)),Ym=de(()=>I("br",null,null,-1)),Xm=de(()=>I("a",{"rel-":"noopener noreferrer",target:"_blank",href:"https://www.kitware.com/contact/project/"},"Contact Kitware!",-1)),ev=de(()=>I("h2",{class:"mt-2"},"Useful Links",-1)),tv=de(()=>I("ul",{class:"pl-6"},[I("li",null,[I("span",null,"VolView source code repo: "),I("a",{rel:"noopener noreferrer",target:"_blank",href:"https://github.com/Kitware/VolView"}," https://github.com/Kitware/VolView ")]),I("li",null,[I("span",null,"Community support forum: "),I("a",{rel:"noopener noreferrer",target:"_blank",href:"https://discourse.vtk.org/c/web/volview/14"}," https://discourse.vtk.org/c/web/volview/14 ")]),I("li",null,[I("span",null,"File an bug report or feature request: "),I("a",{rel:"noopener noreferrer",target:"_blank",href:"https://github.com/Kitware/VolView/issues"}," https://github.com/Kitware/VolView/issues ")])],-1)),nv=de(()=>I("h2",null,"Version Info",-1)),ov={class:"pl-6"},av={class:"d-flex flex-flow align-center text-no-wrap"},sv=de(()=>I("span",null,"VolView: ",-1)),iv={class:"d-flex flex-flow align-center text-no-wrap"},rv=de(()=>I("span",null,"vtk.js: ",-1)),lv={class:"d-flex flex-flow align-center text-no-wrap"},cv=de(()=>I("span",null,"itk-wasm: ",-1)),uv=de(()=>I("h2",{class:"mt-2"},"Acknowledgments",-1)),dv=de(()=>I("br",null,null,-1)),fv=de(()=>I("br",null,null,-1)),pv=de(()=>I("ul",{class:"pl-6"},[I("li",null,[$(' PROSTATEx Challenge Data: Geert Litjens, Oscar Debats, Jelle Barentsz, Nico Karssemeijer, and Henkjan Huisman. "ProstateX Challenge data", The Cancer Imaging Archive (2017). DOI: 10.7937/K9TCIA.2017.MURS5CL ('),I("a",{rel:"noopener noreferrer",target:"_blank",href:"https://wiki.cancerimagingarchive.net/pages/viewpage.action?pageId=23691656"},"TCIA"),$(") ")]),I("li",null,[$(' MRA Head and Neck: Test case 98890234 from the "Patient Contributed Image Repository" ('),I("a",{rel:"noopener noreferrer",target:"_blank",href:"http://www.pcir.org/researchers/98890234_20030505_MR.html"},"PCIR.org"),$(") ")]),I("li",null,[$(" 3D ultrasound of a fetus: Sample data from "),I("a",{rel:"noopener noreferrer",target:"_blank",href:"http://tomovision.comi"},"tomovision.com")])],-1));function gv(e,t,n,o,a,r){const s=F("vol-view-full-logo");return k(),U(Oe,{class:"py-4"},{default:y(()=>[p(ae,{variant:"text",class:"close-button",icon:"mdi-close",onClick:t[0]||(t[0]=i=>e.$emit("close"))}),p(fn,{class:"d-flex flex-row justify-center"},{default:y(()=>[p(s)]),_:1}),p(Ht,null,{default:y(()=>[zm,p(ut,{class:"mb-2"}),I("p",jm,[Vt(p(Ln,{src:Um,alt:"Head and neck CT rendering",width:"200px",class:"ma-1",align:"center"},null,512),[[Mt,!e.mobile]]),Hm]),Gm,Km,qm,$(" VolView is freely available for research, educational, and commercial applications. It is built using a variety of open-source toolks created by Kitware, such as "),Zm,$(" for DICOM I/O and image processing, and "),Qm,$(" for in-browser scientific visualization. "),Jm,Ym,$(" Want help customizing VolView or creating a new web-based visualization application? "),Xm,ev,p(ut,{class:"mb-2"}),tv,nv,p(ut,{class:"mb-2"}),I("ul",ov,[I("li",null,[I("div",av,[sv,p(to,{inline:"",content:e.versions.volview},null,8,["content"])])]),I("li",null,[I("div",iv,[rv,p(to,{inline:"",content:e.versions["vtk.js"]},null,8,["content"])])]),I("li",null,[I("div",lv,[cv,p(to,{inline:"",content:e.versions["itk-wasm"]},null,8,["content"])])])]),uv,p(ut,{class:"mb-2"}),$(" This work was funded, in part, by the NIH via NIBIB and NIGMS R01EB021396, NIBIB R01EB014955, NCI R01CA220681, and NINDS R42NS086295 "),dv,fv,$(" Sample data provided by the following sources: "),pv]),_:1})]),_:1})}const mv=H(Wm,[["render",gv],["__scopeId","data-v-1fc1ea8c"]]);function vv(e,t=5){const n={},o=[],a=Object.entries(e);for(;a.length;){const[r,s]=a.shift(),i=Pi(s).toUpperCase();n[i]=Number(r);let l=o[o.length-1];(!l||l.length===t)&&(l=[],o.push(l)),l.push(i)}return{hexToValue:n,swatches:o}}const hv=z({name:"PaintControls",setup(){const e=kt(),{hexToValue:t,swatches:n}=vv(en,3),o=_(()=>{const c=e.brushValue;return c in en?Pi(en[c]):null}),a=c=>{const u=`${c}FF`.toUpperCase();u in t&&e.setBrushValue(t[u])},r=_(()=>e.brushSize),s=c=>{e.setBrushSize(Number(c))},i=_(()=>e.labelmapOpacity);return{brushSize:r,setBrushSize:s,swatches:n,brushColor:o,setBrushColor:a,opacity:i,setOpacity:c=>{e.setLabelmapOpacity(Number(c))}}}});function yv(e,t,n,o,a,r){return k(),U(Oe,{width:"350px"},{default:y(()=>[p(Pt,null,{default:y(()=>[p(oe,{"no-gutters":"",align:"center"},{default:y(()=>[p(le,null,{default:y(()=>[p(da,{"model-value":e.brushSize,"onUpdate:modelValue":e.setBrushSize,density:"compact","hide-details":"",label:"Size",min:"1",max:"50"},{append:y(()=>[p(Ft,{"model-value":e.brushSize,onInput:e.setBrushSize,variant:"underlined",class:"mt-n1 pt-0",style:{width:"40px"},"hide-details":"",type:"number",min:"1",max:"50"},null,8,["model-value","onInput"])]),_:1},8,["model-value","onUpdate:modelValue"])]),_:1})]),_:1}),p(oe,{"no-gutters":"",align:"center"},{default:y(()=>[p(le,null,{default:y(()=>[p(da,{"model-value":e.opacity,"onUpdate:modelValue":e.setOpacity,density:"compact","hide-details":"",label:"Opacity",min:"0",max:"1",step:"0.01"},{append:y(()=>[p(Ft,{"model-value":e.opacity,onInput:e.setOpacity,variant:"underlined",class:"mt-n1 pt-0",style:{width:"40px"},"hide-details":"",type:"number",min:"0",max:"1",step:"0.1"},null,8,["model-value","onInput"])]),_:1},8,["model-value","onUpdate:modelValue"])]),_:1})]),_:1}),p(oe,{"no-gutters":"",align:"center"},{default:y(()=>[p(le,null,{default:y(()=>[p(rs,{"hide-canvas":"","hide-inputs":"","hide-mode-switch":"","hide-sliders":"","show-swatches":"",elevation:"0",swatches:e.swatches,"model-value":e.brushColor,"onUpdate:modelValue":e.setBrushColor},null,8,["swatches","model-value","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})}const wv=H(hv,[["render",yv],["__scopeId","data-v-6027fe65"]]),Cv=z({name:"MenuToolButton",props:{icon:{type:String,required:!0},name:{type:String,required:!0},size:{type:[Number,String],default:40},active:Boolean,disabled:Boolean,mobileOnlyMenu:Boolean},components:{ToolButton:tt},setup(e){const t=$n(),n=_(()=>!t.mobile.value),o=M(!1),a=_(()=>!e.mobileOnlyMenu||t.mobile.value);B(o,s=>{o.value=s&&a.value});const r=_(()=>e.active);return B(r,s=>{s||(o.value=!1)}),{showLeft:n,menuOn:o,enableMenu:a}}});const Sv={class:"menu-content elevation-24"};function _v(e,t,n,o,a,r){const s=F("tool-button");return k(),U(Dt,{"no-click-animation":"","close-on-content-click":!1,modelValue:e.menuOn,"onUpdate:modelValue":t[1]||(t[1]=i=>e.menuOn=i),location:e.showLeft?"left":"right",class:"overflow-auto"},{activator:y(({props:i})=>[p(s,wt({icon:e.icon,name:e.name,buttonClass:["tool-btn",e.active?"tool-btn-selected":""],disabled:e.disabled,size:e.size,onClick:t[0]||(t[0]=l=>e.$emit("click"))},i),{default:y(()=>[e.active&&e.enableMenu?(k(),U(Z,{key:0,class:re([e.showLeft?"menu-more-left":"menu-more-right"]),size:"18"},{default:y(()=>[$(j(e.showLeft?"mdi-menu-left":"mdi-menu-right"),1)]),_:1},8,["class"])):G("",!0)]),_:2},1040,["icon","name","buttonClass","disabled","size"])]),default:y(()=>[I("div",Sv,[De(e.$slots,"default",{},void 0,!0)])]),_:3},8,["modelValue","location"])}const bv=H(Cv,[["render",_v],["__scopeId","data-v-b1e30b7b"]]),Iv=z({components:{ToolButton:tt},setup(){const{currentImageID:e}=ie(),t=Tt();return{resetCrop:()=>{const o=e.value;o&&t.resetCropping(o)}}}});function Dv(e,t,n,o,a,r){const s=F("tool-button");return k(),U(Oe,{dark:""},{default:y(()=>[p(s,{size:"40",icon:"mdi-restore",name:"Reset Crop",onClick:e.resetCrop},null,8,["onClick"])]),_:1})}const Av=H(Iv,[["render",Dv]]),Tv=z({components:{ToolButton:tt,MenuToolButton:bv,ItemGroup:jo,GroupableItem:Ho,PaintControls:wv,CropControls:Av,RulerControls:Yi,RectangleControls:Ji,ContourControls:Xi},setup(){const e=Je(),t=Pe(),n=_(()=>!e.primaryDataset),o=_(()=>t.currentTool),a=Ze(),r=qe(),s=M(!1),i=M(!1);return Rn("Escape",()=>{s.value=!1,i.value=!1}),{currentTool:o,setCurrentTool:t.setCurrentTool,noCurrentImage:n,Tools:ee,paintMenu:s,cropMenu:i,rectangleStore:a,rulerStore:r}}});const qo=e=>(Ue("data-v-001108e5"),e=e(),We(),e),kv=qo(()=>I("div",{class:"my-1 tool-separator"},null,-1)),Ev=qo(()=>I("div",{class:"my-1 tool-separator"},null,-1)),Rv=qo(()=>I("div",{class:"my-1 tool-separator"},null,-1));function Vv(e,t,n,o,a,r){const s=F("tool-button"),i=F("groupable-item"),l=F("paint-controls"),c=F("menu-tool-button"),u=F("rectangle-controls"),d=F("ruler-controls"),f=F("contour-controls"),m=F("crop-controls"),g=F("item-group");return k(),U(g,{mandatory:"","model-value":e.currentTool,"onUpdate:modelValue":t[0]||(t[0]=v=>e.setCurrentTool(v))},{default:y(()=>[kv,p(i,{value:e.Tools.WindowLevel},{default:y(({active:v,toggle:h})=>[p(s,{icon:"mdi-circle-half-full",name:"Window & Level",buttonClass:["tool-btn",v?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:h},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),p(i,{value:e.Tools.Pan},{default:y(({active:v,toggle:h})=>[p(s,{icon:"mdi-cursor-move",name:"Pan",buttonClass:["tool-btn",v?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:h},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),p(i,{value:e.Tools.Zoom},{default:y(({active:v,toggle:h})=>[p(s,{icon:"mdi-magnify-plus-outline",name:"Zoom",buttonClass:["tool-btn",v?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:h},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),p(i,{value:e.Tools.Crosshairs},{default:y(({active:v,toggle:h})=>[p(s,{icon:"mdi-crosshairs",name:"Crosshairs",buttonClass:["tool-btn",v?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:h},null,8,["buttonClass","disabled","onClick"])]),_:1},8,["value"]),Ev,p(i,{value:e.Tools.Paint},{default:y(({active:v,toggle:h})=>[p(c,{icon:"mdi-brush",name:"Paint",active:v,disabled:e.noCurrentImage,onClick:h},{default:y(()=>[p(l)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),p(i,{value:e.Tools.Rectangle},{default:y(({active:v,toggle:h})=>[p(c,{icon:"mdi-vector-square",name:"Rectangle",mobileOnlyMenu:!0,active:v,disabled:e.noCurrentImage,onClick:h},{default:y(()=>[p(u)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),p(i,{value:e.Tools.Ruler},{default:y(({active:v,toggle:h})=>[p(c,{icon:"mdi-ruler",name:"Ruler",mobileOnlyMenu:!0,active:v,disabled:e.noCurrentImage,onClick:h},{default:y(()=>[p(d)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),p(i,{value:e.Tools.Contour},{default:y(({active:v,toggle:h})=>[p(c,{icon:"mdi-shape-circle-plus",name:"Contour","mobile-only-menu":"",active:v,disabled:e.noCurrentImage,onClick:h},{default:y(()=>[p(f)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"]),Rv,p(i,{value:e.Tools.Crop},{default:y(({active:v,toggle:h})=>[p(c,{icon:"mdi-crop",name:"Crop",active:v,disabled:e.noCurrentImage,onClick:h},{default:y(()=>[p(m)]),_:2},1032,["active","disabled","onClick"])]),_:1},8,["value"])]),_:1},8,["model-value"])}const tr=H(Tv,[["render",Vv],["__scopeId","data-v-001108e5"]]),Mv={[Ve.Error]:"error",[Ve.Warning]:"warn",[Ve.Info]:"info",[Ve.Success]:""},Pv=z({props:{message:{type:Object,required:!0}},setup(e){const{message:t}=Y(e);return{headerClass:_(()=>{const o=Mv[t.value.type];return o!=null&&o.length?`${o}-message`:""})}}});const Lv={class:"header"},$v={class:"mt-4"},Ov={class:"details"};function xv(e,t,n,o,a,r){return k(),U(dt,null,{default:y(()=>[p(ft,{class:re(e.headerClass)},{default:y(()=>[I("div",Lv,[I("span",null,j(e.message.title),1),p(ae,{icon:"mdi-delete",variant:"text",size:"small",class:"mr-3",onClick:t[0]||(t[0]=me(s=>e.$emit("delete"),["stop"]))})])]),_:1},8,["class"]),e.message.options.details?(k(),U(pt,{key:0},{default:y(()=>[I("div",$v,[I("pre",Ov,j(e.message.options.details),1)])]),_:1})):G("",!0)]),_:1})}const Bv=H(Pv,[["render",xv],["__scopeId","data-v-4dc38f88"]]),Fv=z({components:{MessageItem:Bv},setup(){const e=Qe(),{messages:t}=Ke(e),n=M(!0),o=M(!0),a=M(!0),r=_(()=>{const i={errors:n.value,warnings:o.value,info:a.value};return t.value.filter(l=>l.type===Ve.Error&&i.errors||l.type===Ve.Warning&&i.warnings||l.type===Ve.Info&&i.info)});function s(i){e.clearOne(i)}return{deleteItem:s,clearAll:()=>{e.clearAll()},showErrors:n,showWarnings:o,showInfo:a,filteredMessages:r}}});const nr=e=>(Ue("data-v-cd09406c"),e=e(),We(),e),Nv=nr(()=>I("span",null,"Notifications",-1)),Uv={class:"action-bar ma-2"},Wv={class:"filter-bar"},zv=nr(()=>I("span",null,"Clear All",-1)),jv={class:"message-list ma-2"},Hv={key:0,class:"empty"};function Gv(e,t,n,o,a,r){const s=F("message-item");return k(),U(Oe,{class:"fill-height message-center"},{default:y(()=>[p(fn,{class:"d-flex flex-row align-center"},{default:y(()=>[Nv,p(ht),p(ae,{variant:"text",icon:"mdi-close",onClick:t[0]||(t[0]=i=>e.$emit("close"))})]),_:1}),p(Ht,{class:"content-container pt-4"},{default:y(()=>[I("div",Uv,[I("div",Wv,[p(ot,{modelValue:e.showErrors,"onUpdate:modelValue":t[1]||(t[1]=i=>e.showErrors=i),class:"px-2","hide-details":"",label:"Error"},null,8,["modelValue"]),p(ot,{modelValue:e.showWarnings,"onUpdate:modelValue":t[2]||(t[2]=i=>e.showWarnings=i),class:"px-2","hide-details":"",label:"Warning"},null,8,["modelValue"]),p(ot,{modelValue:e.showInfo,"onUpdate:modelValue":t[3]||(t[3]=i=>e.showInfo=i),class:"px-2","hide-details":"",label:"Info"},null,8,["modelValue"])]),p(ae,{color:"secondary",onClick:e.clearAll},{default:y(()=>[p(Z,{class:"mr-2"},{default:y(()=>[$("mdi-delete")]),_:1}),zv]),_:1},8,["onClick"])]),I("div",jv,[p(dn,{variant:"accordion",multiple:""},{default:y(()=>[(k(!0),x(se,null,ce(e.filteredMessages,i=>(k(),U(s,{key:i.id,message:i,onDelete:l=>e.deleteItem(i.id)},null,8,["message","onDelete"]))),128))]),_:1}),e.filteredMessages.length===0?(k(),x("div",Hv,"No notifications to display")):G("",!0)])]),_:1})]),_:1})}const Kv=H(Fv,[["render",Gv],["__scopeId","data-v-cd09406c"]]),qv=el({position:"bottom-left",timeout:3e3,hideProgressBar:!0,maxToasts:3,transition:"Vue-Toastification__fade"}),or=()=>qv,Zv=z({props:{message:String,detailsButton:Boolean}});const Qv={key:0,class:"button"};function Jv(e,t,n,o,a,r){return k(),x("div",null,[I("span",null,j(e.message),1),$("   "),e.detailsButton?(k(),x("button",Qv,"details")):G("",!0)])}const Yv=H(Zv,[["render",Jv],["__scopeId","data-v-fb318769"]]),Xv=5e3,e3=z({setup(e,{emit:t}){const n=Qe(),{byID:o}=Ke(n),a={},r=or(),s=i=>({timeout:o.value[i].options.persist?!1:Xv,closeOnClick:!o.value[i].options.persist,onClick:()=>t("open-notifications"),onClose:()=>{delete a[i]}});return B(o,i=>{Object.keys(a).forEach(l=>{l in i||(r.dismiss(a[l]),delete a[l])})}),n.$onAction(({name:i,args:l,after:c})=>{if(i==="_addMessage"){const u=l[0];c(d=>{if(!d)return;let f=r.info,m=!1;u.type===Ve.Error?(f=r.error,m=!0):u.type===Ve.Warning?(f=r.warning,m=!0):u.type===Ve.Info?f=r.info:u.type===Ve.Success&&(f=r.success),a[d]=f({component:Yv,props:{message:u.title,detailsButton:m}},s(d))})}}),()=>null}}),t3=z({setup(){const e=Cn(),t=M();return X(()=>{t.value=e.host}),Ne(()=>{(t.value!==e.host||e.message)&&e.fetchInitialDicoms()}),{dicomWeb:e}}}),n3=I("h3",{class:"mb-4"},"DICOMWeb",-1);function o3(e,t,n,o,a,r){return k(),x("div",null,[n3,p(Ft,{modelValue:e.dicomWeb.hostName,"onUpdate:modelValue":t[0]||(t[0]=s=>e.dicomWeb.hostName=s),class:"server-param",label:"Host Display Name",clearable:""},null,8,["modelValue"]),p(Ft,{modelValue:e.dicomWeb.host,"onUpdate:modelValue":t[1]||(t[1]=s=>e.dicomWeb.host=s),class:"server-param",label:"Host Address",clearable:""},null,8,["modelValue"])])}const a3=H(t3,[["render",o3]]),{VITE_SENTRY_DSN:ar}={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},sr="error-reporting-off",Zo=!!ar,s3=e=>{localStorage.getItem(sr)!=="true"&&Zo&&tl({app:e,dsn:ar,integrations:[new nl],tracesSampleRate:.1,replaysSessionSampleRate:.1,replaysOnErrorSampleRate:1})},i3=()=>{ol(200)},ir=ne("error-reporting",()=>{const e=Mn(sr,"false"),t=M(e.value==="true");return B(t,()=>{e.value=String(t.value),t.value&&i3()}),{disableReporting:t}}),r3=z({setup(){const e=_l(),t=Mn(bl,e.global.name.value),n=M(e.global.name.value===fa);B(n,r=>{e.global.name.value=r?fa:Il,t.value=e.global.name.value});const o=ir(),a=M(o.disableReporting);return B(a,r=>{o.disableReporting=r}),{dark:n,disableReporting:a,errorReportingConfigured:Zo}},components:{DicomWebSettings:a3}});function l3(e,t,n,o,a,r){const s=F("dicom-web-settings");return k(),U(Oe,null,{default:y(()=>[p(fn,{class:"d-flex flex-row align-center"},{default:y(()=>[$(" Settings "),p(ht),p(ae,{variant:"text",density:"compact",icon:"mdi-close",onClick:t[0]||(t[0]=i=>e.$emit("close"))})]),_:1}),p(Ht,null,{default:y(()=>[p(pa,{label:"Dark Theme",modelValue:e.dark,"onUpdate:modelValue":t[1]||(t[1]=i=>e.dark=i)},null,8,["modelValue"]),e.errorReportingConfigured?(k(),U(pa,{key:0,label:"Disable Error Reporting",modelValue:e.disableReporting,"onUpdate:modelValue":t[2]||(t[2]=i=>e.disableReporting=i)},null,8,["modelValue"])):G("",!0),p(ut,{class:"mt-2 mb-6"}),p(s)]),_:1})]),_:1})}const c3=H(r3,[["render",l3]]),u3={},d3={width:"178",height:"41",viewBox:"0 0 178 41",fill:"none",xmlns:"http://www.w3.org/2000/svg"},f3=os('<g clip-path="url(#clip0_137_151)"><path d="M33.2403 22.3722C33.189 22.4501 33.1376 22.554 33.0606 22.632C31.7509 24.3989 29.0545 25.1265 25.6905 24.6588C25.5364 24.6328 25.3823 24.6068 25.2282 24.5808C23.1995 24.243 20.9911 23.4895 18.7826 22.3722C17.4729 21.6966 16.1633 20.8651 14.905 19.9037C13.5439 18.8643 12.3113 17.747 11.2584 16.5517C9.58926 14.7068 8.35663 12.758 7.56056 10.8871C6.25089 7.79499 6.25089 5.04066 7.53488 3.24774C8.84455 1.48082 11.4125 0.805225 14.6225 1.29893C16.2146 1.53278 17.9609 2.07845 19.7584 2.88396C21.5303 3.68948 23.3536 4.75483 25.1255 6.10601C28.6693 8.78239 31.34 12.0304 32.7781 15.0966C34.1648 18.0068 34.3445 20.6052 33.2403 22.3722Z" fill="#3EAE2B"></path><path d="M33.2404 22.3721C33.189 22.4501 33.1377 22.554 33.0606 22.632C31.7509 24.3989 29.0546 25.1265 25.6905 24.6588C25.5364 24.6328 25.3824 24.6068 25.2283 24.5808C23.3537 24.191 21.1966 23.4895 18.7827 22.3721C17.473 21.6966 16.1633 20.8651 14.905 19.9036C13.544 18.8643 12.3114 17.7469 11.2585 16.5517C8.69052 12.2643 9.2298 6.9375 10.7706 5.24852C12.6452 3.16978 16.9337 2.70206 23.6361 7.24931C29.5425 11.2509 33.7796 19.0202 33.2404 22.3721Z" fill="black" fill-opacity="0.15"></path><path d="M30.1331 18.0068C30.1331 18.5005 30.0304 18.9422 29.8506 19.332C29.7993 19.4619 29.7222 19.5918 29.6195 19.7217C29.2086 20.2934 28.541 20.6572 27.6422 20.8391C26.7434 21.021 25.6648 20.969 24.4579 20.7351C22.044 20.2674 19.2706 18.9942 16.831 17.1753C16.8053 17.1493 16.7539 17.1233 16.7283 17.0973C14.3657 15.2784 12.5681 13.0698 11.5666 11.017C10.5394 8.91229 10.4624 7.06741 11.3098 5.9241C12.1316 4.78079 13.9035 4.443 16.189 4.91071C18.4745 5.37843 21.1195 6.65166 23.5334 8.49654C25.9473 10.3414 27.9503 12.5761 29.1059 14.6808C29.7993 15.9021 30.1331 17.0454 30.1331 18.0068Z" fill="#3EAE2B"></path><path d="M29.8506 19.3321C29.7992 19.462 29.7222 19.5919 29.6195 19.7218C29.2086 20.2935 28.5409 20.6573 27.6421 20.8391C26.7433 21.021 25.6648 20.9691 24.4578 20.7352C22.0439 20.2675 19.2705 18.9943 16.831 17.1754C16.8053 17.1494 16.7539 17.1234 16.7282 17.0974C13.8778 14.2132 13.7494 9.61394 14.905 8.31473C16.2146 7.14544 18.5258 7.17142 22.763 10.0297C26.3068 12.4462 29.5681 16.9415 29.8506 19.3321Z" fill="black" fill-opacity="0.15"></path><path d="M26.3068 17.2533C26.1271 17.4871 25.8189 17.6431 25.3567 17.721C24.8944 17.773 24.3038 17.747 23.6105 17.5651C22.2494 17.2273 20.6059 16.4478 19.0651 15.2785C17.5243 14.1092 16.3431 12.784 15.6754 11.5627C15.3416 10.9651 15.1618 10.4194 15.0848 9.95171C15.0334 9.484 15.1105 9.17219 15.2902 8.93833C15.47 8.70447 15.7524 8.52258 16.2147 8.47061C16.6512 8.41864 17.2162 8.44463 17.8839 8.60053C18.5259 8.75644 19.2706 9.04227 20.0153 9.43203C20.76 9.82179 21.5561 10.3155 22.3008 10.9131C23.8416 12.0824 25.0742 13.4076 25.7932 14.6029C26.1528 15.2005 26.3582 15.7462 26.4352 16.2139C26.5379 16.7076 26.4609 17.0454 26.3068 17.2533Z" fill="#3EAE2B"></path><path d="M27.0001 17.565C26.769 18.1627 26.5379 18.6044 26.1527 19.1501C23.8415 22.2682 19.0137 22.7099 15.624 20.1375C12.2343 17.565 11.3612 12.758 13.6467 9.63984C14.1089 9.06819 14.4427 8.67843 14.982 8.23669C14.8793 8.31465 14.8022 8.3926 14.7252 8.49654C14.3914 8.93827 14.3143 9.48394 14.3914 10.0556C14.4684 10.6272 14.6995 11.2769 15.059 11.9265C15.7781 13.2257 17.0364 14.6548 18.6542 15.8761C20.272 17.0973 21.9926 17.9288 23.482 18.2666C24.2267 18.4485 24.9201 18.5005 25.485 18.4225C26.0757 18.3446 26.5893 18.1107 26.9231 17.669C26.9488 17.669 26.9745 17.617 27.0001 17.565Z" fill="#0068C7"></path><path d="M30.5696 19.7737C30.2615 20.7092 29.1316 22.4241 28.4382 23.2036C24.7917 28.1147 17.1391 28.9722 11.6436 24.8147C6.17386 20.7351 5.17235 12.4462 8.81888 7.50916C9.38383 6.75562 10.334 5.56034 11.1557 4.85876C10.976 5.01467 10.7962 5.19656 10.6421 5.40443C9.51223 6.93751 9.76903 9.17215 10.8219 11.3808C11.9004 13.6155 13.8264 15.954 16.3174 17.8509C17.5757 18.8123 18.911 19.6178 20.272 20.2414C21.6331 20.8651 22.9941 21.3328 24.2524 21.5666C25.5364 21.8265 26.7177 21.8784 27.7449 21.6706C28.7721 21.4627 29.6452 21.021 30.2358 20.2414C30.3899 20.0855 30.4926 19.9296 30.5696 19.7737Z" fill="#0068C7"></path><path d="M34.2675 22.1643C33.7025 23.6974 32.6497 25.5942 31.1859 27.3092C25.2796 34.1171 15.059 35.3903 7.71463 29.8037C0.395901 24.2691 -1.32464 14.1092 3.47747 6.39189C4.55602 4.65094 6.63608 2.59819 7.86871 1.71472C7.84303 1.74071 7.14968 2.39031 6.8672 2.78008C5.30074 4.91078 5.42913 8.05488 6.79016 11.225C8.15119 14.447 10.7705 17.825 14.3914 20.5793C16.2146 21.9565 18.1149 23.0478 20.0152 23.8793C21.9155 24.7108 23.8158 25.2305 25.5621 25.4903C29.0545 25.958 32.1361 25.2824 33.7026 23.1517C33.9337 22.8399 34.1391 22.5021 34.2675 22.1643Z" fill="#0068C7"></path><path d="M33.5228 14.7329C32.0077 11.5368 29.2343 8.18483 25.6135 5.4305C22.0183 2.67616 18.115 0.987188 14.7509 0.467503C13.544 0.285613 12.3627 0.259629 11.3098 0.38955C11.2585 0.38955 11.2071 0.38955 11.1814 0.415535C11.0274 0.441519 10.8476 0.467503 10.6935 0.493487C10.6679 0.493487 10.6422 0.493487 10.5908 0.519472C10.4881 0.545456 10.3854 0.57144 10.3083 0.597424C10.2056 0.623409 10.1286 0.649393 10.0515 0.675377C9.9745 0.701361 9.89746 0.727346 9.82042 0.75333C9.07571 0.987188 8.40803 1.35097 7.8174 1.81868C7.45788 2.07853 7.14973 2.39034 6.86725 2.7801C5.30078 4.91081 5.42918 8.0549 6.79021 11.225C8.15124 14.447 10.7706 17.825 14.3914 20.5793C16.2147 21.9565 18.115 23.0478 20.0153 23.8793C21.9156 24.7108 23.8159 25.2305 25.5621 25.4903C29.0546 25.9581 32.1361 25.2825 33.7026 23.1518C33.9337 22.8659 34.1135 22.5281 34.2675 22.1903C35.2177 20.1116 34.8068 17.4352 33.5228 14.7329ZM33.2404 22.3722C33.189 22.4502 33.1376 22.5541 33.0606 22.6321C31.7509 24.399 29.0546 25.1266 25.6905 24.6588C25.5364 24.6329 25.3824 24.6069 25.2283 24.5809C23.1996 24.2431 20.9911 23.4895 18.7827 22.3722C17.473 21.6966 16.1633 20.8651 14.905 19.9037C13.544 18.8644 12.3114 17.747 11.2585 16.5518C9.5893 14.7069 8.35667 12.7581 7.5606 10.8872C6.25093 7.79506 6.25093 5.04073 7.53492 3.24782C8.84459 1.48089 11.4126 0.805298 14.6225 1.299C16.2147 1.53286 17.9609 2.07853 19.7585 2.88404C21.5304 3.68955 23.3537 4.7549 25.1256 6.10609C28.6694 8.78246 31.3401 12.0305 32.7781 15.0966C34.1648 18.0069 34.3446 20.6053 33.2404 22.3722Z" fill="white"></path><path d="M29.8506 14.2651C28.6436 12.0564 26.5636 9.71781 24.0726 7.82096C21.5817 5.92411 18.834 4.59891 16.3944 4.10521C14.5711 3.71545 12.8506 3.7934 11.618 4.54694C11.5923 4.54694 11.5666 4.57293 11.5666 4.57293C11.5666 4.57293 11.5409 4.57293 11.5409 4.59891C11.4896 4.6249 11.4382 4.65088 11.4125 4.70285C11.3355 4.75482 11.2584 4.83277 11.1814 4.88474C11.0016 5.04065 10.8219 5.22254 10.6678 5.43041C9.5379 6.96348 9.79469 9.19813 10.8476 11.4068C11.9261 13.6414 13.8521 15.98 16.343 17.8769C17.6013 18.8383 18.9367 19.6438 20.2977 20.2674C21.6587 20.891 23.0198 21.3588 24.2781 21.5926C25.5621 21.8525 26.7433 21.9044 27.7705 21.6966C28.7977 21.4887 29.6708 21.0469 30.2615 20.2674C30.3642 20.1375 30.4669 19.9816 30.5439 19.8257C31.3657 18.2666 30.9291 16.2399 29.8506 14.2651ZM29.6195 19.7217C29.2086 20.2934 28.5409 20.6572 27.6421 20.8391C26.7433 21.021 25.6648 20.969 24.4578 20.7351C22.0439 20.2674 19.2705 18.9942 16.8309 17.1753C14.4171 15.3564 12.5681 13.0958 11.5666 11.017C10.5394 8.9123 10.4624 7.06742 11.3098 5.92411C12.1316 4.7808 13.9035 4.44301 16.189 4.91072C18.4745 5.37844 21.1195 6.65167 23.5334 8.49655C25.9473 10.3414 27.9503 12.5761 29.1059 14.6808C29.7992 15.928 30.1331 17.0714 30.1331 18.0328C30.1331 18.6824 29.979 19.254 29.6195 19.7217Z" fill="white"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M27.2056 16.1099C27.1029 15.5382 26.8461 14.8886 26.4609 14.239C25.6905 12.9398 24.4065 11.5367 22.7887 10.3154C21.1965 9.09415 19.5274 8.23667 18.0893 7.89887C17.3703 7.71698 16.7026 7.66501 16.1376 7.74296C15.7011 7.79493 15.2902 7.97682 14.982 8.23667C14.8793 8.31462 14.8023 8.39257 14.7252 8.49651C14.3914 8.93824 14.3144 9.48391 14.3914 10.0556C14.4684 10.6272 14.6996 11.2768 15.0591 11.9264C15.7781 13.2256 17.0364 14.6548 18.6542 15.876C20.2721 17.0973 21.9926 17.9288 23.482 18.2666C24.2268 18.4485 24.9201 18.5004 25.4851 18.4225C26.0757 18.3445 26.5893 18.1107 26.9231 17.6689C26.9488 17.617 26.9745 17.591 27.0002 17.539C27.2313 17.1493 27.2826 16.6296 27.2056 16.1099ZM26.3068 17.2532C26.1271 17.4871 25.8189 17.643 25.3567 17.7209C24.8944 17.7729 24.3038 17.7469 23.6104 17.565C22.2494 17.2272 20.6059 16.4477 19.0651 15.2784C17.5243 14.1091 16.3431 12.7839 15.6754 11.5626C15.3416 10.965 15.1618 10.4193 15.0848 9.95163C15.0334 9.48391 15.1104 9.1721 15.2902 8.93824C15.47 8.70438 15.7524 8.52249 16.2147 8.47052C16.6512 8.41855 17.2162 8.44454 17.8839 8.60044C18.5259 8.75635 19.2706 9.04218 20.0153 9.43194C20.76 9.8217 21.5561 10.3154 22.3008 10.913C23.8416 12.0823 25.0742 13.4075 25.7932 14.6028C26.1527 15.2004 26.3582 15.7461 26.4352 16.2138C26.5379 16.7075 26.4609 17.0453 26.3068 17.2532Z" fill="white"></path></g><path d="M61.9829 5.52224H58.8629L50.9429 26.9222L43.0629 5.52224H39.9429L49.3829 30.8022H52.5429L61.9829 5.52224ZM76.9417 21.1622C76.9417 25.5622 75.8217 28.3622 71.3817 28.3622C66.9417 28.3622 65.7817 25.5622 65.7817 21.1622C65.7817 16.7622 66.9417 13.9622 71.3817 13.9622C75.8217 13.9622 76.9417 16.7622 76.9417 21.1622ZM71.3817 31.1222C77.4617 31.1222 79.8617 27.0422 79.8617 21.1622C79.8617 15.1622 77.5817 11.2022 71.3817 11.2022C65.2617 11.2022 62.8617 15.2822 62.8617 21.1622C62.8617 27.1622 65.1417 31.1222 71.3817 31.1222ZM84.4373 25.4422C84.4373 29.6022 86.5173 31.0422 89.2773 31.0422C90.3173 31.0422 91.1173 30.8822 91.6373 30.6422L91.2373 28.0022C90.7973 28.2022 90.1973 28.2822 89.5173 28.2822C88.1573 28.2822 87.3573 27.6422 87.3573 25.0022V3.52224H84.4373V25.4422Z" fill="#3EAE2B"></path><path d="M114.952 5.52224H111.832L103.912 26.9222L96.0317 5.52224H92.9117L102.352 30.8022H105.512L114.952 5.52224ZM118.196 30.8022H121.116V11.5222H118.196V30.8022ZM117.756 4.92225C117.756 5.96224 118.596 6.80225 119.676 6.80225C120.716 6.80225 121.556 5.96224 121.556 4.92225C121.556 3.88224 120.716 3.00224 119.676 3.00224C118.596 3.00224 117.756 3.84225 117.756 4.92225ZM142.306 19.6422C142.306 14.0422 139.306 11.2022 134.226 11.2022C127.906 11.2022 125.866 15.6422 125.866 21.2022C125.866 28.0422 128.986 31.1222 135.146 31.1222C137.506 31.1222 139.786 30.6422 141.666 29.8022L141.226 27.0422C139.786 27.8022 137.426 28.3622 135.186 28.3622C131.186 28.3622 128.826 26.5622 128.826 22.4822V22.3222H141.986C142.226 21.4822 142.306 20.4422 142.306 19.6422ZM128.826 19.6022C128.826 15.4422 130.906 13.8022 134.146 13.8022C137.426 13.8022 139.506 15.4822 139.506 19.6022V19.8422H128.826V19.6022ZM148.339 11.5222H145.339L152.059 30.8022H155.059L160.299 16.0422L165.539 30.8022H168.539L175.259 11.5222H172.259L167.019 26.8422L161.779 11.5222H158.819L153.579 26.8422L148.339 11.5222Z" fill="#0068C7"></path><defs><clipPath id="clip0_137_151"><rect width="34" height="33" fill="white" transform="translate(0.781128 0.311523)"></rect></clipPath></defs>',4),p3=[f3];function g3(e,t){return k(),x("svg",d3,p3)}const m3=H(u3,[["render",g3]]),v3="session.volview.zip",h3=z({setup(e,{emit:t}){const n=M(""),o=M(!0),a=M(!1);async function r(){if(n.value.trim().length>=0){a.value=!0;try{const i=await hi();al.saveAs(i,n.value),t("close")}finally{a.value=!1}}}X(()=>{n.value=v3});function s(i){return i.trim().length>0||"Required"}return{saving:a,saveSession:r,fileName:n,validFileName:s,valid:o}}}),y3=I("span",null,"Save",-1);function w3(e,t,n,o,a,r){return k(),U(Oe,null,{default:y(()=>[p(fn,{class:"d-flex flex-row align-center"},{default:y(()=>[$(" Saving Session State "),p(ht),p(ae,{variant:"text",icon:"mdi-close",onClick:t[0]||(t[0]=s=>e.$emit("close"))})]),_:1}),p(Ht,null,{default:y(()=>[p(Dl,{modelValue:e.valid,"onUpdate:modelValue":t[2]||(t[2]=s=>e.valid=s),onSubmit:me(e.saveSession,["prevent"])},{default:y(()=>[p(Ft,{modelValue:e.fileName,"onUpdate:modelValue":t[1]||(t[1]=s=>e.fileName=s),hint:"The filename to use for the session state file.",label:"Session State Filename",rules:[e.validFileName],required:""},null,8,["modelValue","rules"])]),_:1},8,["modelValue","onSubmit"])]),_:1}),p(is,null,{default:y(()=>[p(ht),p(ae,{loading:e.saving,color:"secondary",onClick:e.saveSession,disabled:!e.valid},{default:y(()=>[p(Z,{class:"mr-2"},{default:y(()=>[$("mdi-content-save-all")]),_:1}),y3]),_:1},8,["loading","onClick","disabled"])]),_:1})]),_:1})}const C3=H(h3,[["render",w3]]);function S3(){const e=Qe(),t=n=>{e.addError("Application error (click for details)",n.error)};X(()=>{window.addEventListener("error",t)}),ke(()=>{window.removeEventListener("error",t)})}var go=(e=>(e[e.ProxyCreated=0]="ProxyCreated",e[e.ProxyModified=1]="ProxyModified",e[e.ProxyDeleted=2]="ProxyDeleted",e[e.ProxyRegistrationChange=3]="ProxyRegistrationChange",e))(go||{});function Ua(e,t){const n=[];bf(o=>{const a=Object.create(null);n.push(o.onProxyRegistrationChange(r=>{const{action:s,proxyId:i,proxy:l}=r;s==="register"?(e===0&&t(i,l),e===1&&(a[i]=l.onModified(()=>t(i,l)))):s==="unregister"&&(i in a&&(a[i].unsubscribe(),delete a[i]),e===2&&t(i,null))}))}),ke(()=>{for(;n.length;)n.pop().unsubscribe()})}function _3(){const e=new Map,t=il(()=>{Qe().addError(ga.WebGLLost.title,ga.WebGLLost.details)},100);Ua(go.ProxyCreated,(n,o)=>{if(!o||!o.isA("vtkViewProxy"))return;const r=o.getRenderWindow().getViews()[0].getCanvas(),s=sl(r,"webglcontextlost",t);e.set(n,s)}),Ua(go.ProxyDeleted,n=>{e.has(n)&&(e.get(n)(),e.delete(n))})}function b3(){const e=or(),t=Qe();let n=0,o=null,a=null;const r=()=>{n=0,o=null,a=null},s=u=>{a=u},i=()=>{n++,o===null&&(o=e.info("Loading datasets...",{timeout:!1,closeButton:!1,closeOnClick:!1}))},l=()=>{n--,n===0&&o!==null&&(a?(e.dismiss(o),t.addError("Some files failed to load",a)):e.update(o,{content:"Datasets loaded!",options:{type:rl.SUCCESS,timeout:3e3,closeButton:"button",closeOnClick:!0}}),r())};return{runAsLoading:async u=>{i();try{return await u(s)}finally{l()}}}}const Wa=e=>{const t={[ee.Rectangle]:Ze(),[ee.Ruler]:qe()},n=Pe(),o=t[n.currentTool];if(!o)return;const a=Object.entries(o.labels),r=a.findIndex(([i])=>i===o.activeLabel),[s]=a.at((r+e)%a.length);o.setActiveLabel(s)};function I3(){Rn(Gu,()=>Wa(-1)),Rn(Ku,()=>Wa(1))}const D3={components:{ToolStrip:tr,VtkTwoView:ji}},A3=e=>(Ue("data-v-264539b7"),e=e(),We(),e),T3=A3(()=>I("div",{style:{padding:"10px",display:"flex","flex-direction":"column","align-items":"center","justify-content":"center"}},[I("h2",{style:{"margin-left":"2%"}},"DEMO PROTOTYOPE FROM VolView"),I("h4",{style:{"margin-left":"2%"}},"Montreal, Aug, 2023")],-1)),k3={class:"viewers-tools-container"},E3={class:"tool-strip"};function R3(e,t,n,o,a,r){const s=F("VtkTwoView"),i=F("ToolStrip");return k(),x(se,null,[T3,I("div",k3,[p(s,{key:"sagitalv",id:"Sagittal",viewDirection:"Posterior",viewUp:"Superior"}),I("div",E3,[p(i)]),p(s,{key:"sagitalv",id:"Coronal",viewDirection:"Right",viewUp:"Superior"})])],64)}const V3=H(D3,[["render",R3],["__scopeId","data-v-264539b7"]]);async function rr(e,t){const n=Je();let o;try{o=await Uo(e)}catch(s){t(s);return}const[a,r]=Fn(s=>s.ok,o);if(!n.primarySelection&&a.length){const s=No(a[0]);s&&n.setPrimarySelection(s)}if(r.length){const s=r.map(l=>{const[c]=l.errors,u=$s(c.inputDataStackTrace[0]);return iu(c.cause),`- ${u}: ${c.message}`}),i=new Error(`These files failed to load:
${s.join(`
`)}`);t(i)}}async function M3(e,t){const n=uo(e.urls),o=uo(e.names??[]),a=n.map((r,s)=>Ps(r,o[s]||_s(new Et(r,window.location.href).pathname)||r));await rr(a,t)}const P3=z({name:"App",components:{ToolButton:tt,LayoutGrid:op,DragAndDrop:$m,AboutBox:mv,ToolStrip:tr,ModulePanel:Em,MessageCenter:Kv,MessageNotifications:e3,VolViewFullLogo:er,VolViewLogo:m3,Settings:c3,SaveSession:C3,LayoutGridDemo:V3,PersistentOverlay:qn},setup(){const e=_e(),t=Qe(),n=ue();S3(),_3(),I3();const{runAsLoading:o}=b3(),a=M("Quad View"),{layout:r}=Ke(n);B(a,()=>{const S=ba[a.value]||[];n.setLayout(S)},{immediate:!0}),B(r,()=>{var S;(S=r.value)!=null&&S.name&&r.value.name!==a.value&&(a.value=r.value.name)});async function s(S){if(console.log(S),!S)return;const V=Array.from(S).map(Un);o(C=>rr(V,C))}const i=document.createElement("input");i.setAttribute("type","file"),i.setAttribute("multiple","multiple"),i.setAttribute("accept","*"),i.addEventListener("change",()=>s(i.files));function l(){i.value="",i.click()}const c=ws.extractURLParameters();X(()=>{c.urls&&es(()=>{o(S=>M3(c,S))})});const u=_(()=>e.idList.length>0),d=_(()=>t.importantMessages.length),f=_(()=>t.importantMessages.find(S=>S.type===Ve.Error)?"error":t.importantMessages.find(S=>S.type===Ve.Warning)?"warning":"primary"),m=M(!1),g={}.VITE_ENABLE_REMOTE_SAVE&&c.save,v=M(!1),h=async()=>{if(g)try{v.value=!0;const S=await hi();(await fetch(g,{method:"POST",headers:{"Content-Type":"application/zip","Content-Length":S.size.toString()},body:S})).ok?t.addSuccess("Save Successful"):t.addError("Save Failed","Network response not OK")}catch(S){t.addError("Save Failed with error",`Failed from: ${S}`)}finally{v.value=!1}else m.value=!0},w=$n(),D=ir(),b=_(()=>Zo&&!D.disableReporting);return{aboutBoxDialog:M(!1),messageDialog:M(!1),settingsDialog:M(!1),saveDialog:m,handleSave:h,saveHappening:v,leftSideBar:M(!w.mobile.value),mobile:w.mobile,messageCount:d,messageBadgeColor:f,layoutName:a,currentLayout:r,Layouts:ba,userPromptFiles:l,openFiles:s,hasData:u,showErrorReporting:b,saveUrl:g}}});const Qo=e=>(Ue("data-v-6431d185"),e=e(),We(),e),L3={class:"fill-height d-flex flex-row flex-grow-1"},$3={class:"d-flex flex-column flex-grow-1"},O3={key:0,style:{width:"100%",height:"100%"}},x3=Qo(()=>I("div",null,"Click to open local files.",-1)),B3={class:"mt-8"},F3=Qo(()=>I("div",null,"Drag & drop your DICOM files.",-1)),N3={key:0,class:"vertical-offset-margin"},U3={key:1},W3={key:2,class:"vertical-offset-margin"},z3={class:"d-flex flex-column align-center justify-center h-100"},j3={class:"dnd-prompt"},H3=Qo(()=>I("div",{class:"text-h2 font-weight-bold"},"Drop your files to open",-1));function G3(e,t,n,o,a,r){const s=F("module-panel"),i=F("LayoutGridDemo"),l=F("about-box"),c=F("message-center"),u=F("message-notifications"),d=F("settings"),f=F("save-session"),m=F("persistent-overlay"),g=F("drag-and-drop");return k(),U(g,{enabled:"",onDropFiles:e.openFiles,id:"app-container"},{default:y(({dragHover:v})=>[p(kl,null,{default:y(()=>[p(Al,{modelValue:e.leftSideBar,"onUpdate:modelValue":t[1]||(t[1]=h=>e.leftSideBar=h),app:"",clipped:"",touchless:"",width:"450",id:"left-nav"},{default:y(()=>[p(s,{onClose:t[0]||(t[0]=h=>e.leftSideBar=!1)})]),_:1},8,["modelValue"]),p(Tl,{id:"content-main"},{default:y(()=>[I("div",L3,[I("div",$3,[e.hasData?(k(),x("div",O3,[p(i)])):G("",!0),Vt(p(oe,{"no-gutters":"",align:"center",class:"clickable bg-grey-darken-3",onClick:e.userPromptFiles},{default:y(()=>[p(le,null,{default:y(()=>[p(oe,{justify:"center"},{default:y(()=>[p(Oe,{flat:"",dark:"",color:"transparent",class:"text-center headline"},{default:y(()=>[I("div",null,[p(Z,{size:"64"},{default:y(()=>[$("mdi-folder-open")]),_:1})]),x3,I("div",B3,[p(Z,{size:"64"},{default:y(()=>[$("mdi-arrow-down-bold")]),_:1})]),F3,e.saveUrl?G("",!0):(k(),x("div",N3,[p(Z,{size:"64"},{default:y(()=>[$("mdi-cloud-off-outline")]),_:1})])),e.saveUrl?G("",!0):(k(),x("div",U3," Secure: Image data never leaves your machine. ")),e.showErrorReporting?(k(),x("div",W3,[$(" Opt out of error reporting: "),p(ae,{icon:"mdi-cog",onClick:t[2]||(t[2]=me(h=>e.settingsDialog=!0,["stop"])),density:"comfortable"})])):G("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["onClick"]),[[Mt,!e.hasData]])])])]),_:1}),p(Jt,{modelValue:e.aboutBoxDialog,"onUpdate:modelValue":t[4]||(t[4]=h=>e.aboutBoxDialog=h),width:e.mobile?"100%":"80%"},{default:y(()=>[p(l,{onClose:t[3]||(t[3]=h=>e.aboutBoxDialog=!1)})]),_:1},8,["modelValue","width"]),p(Jt,{modelValue:e.messageDialog,"onUpdate:modelValue":t[6]||(t[6]=h=>e.messageDialog=h),width:e.mobile?"100%":"75%","content-class":"fill-height"},{default:y(()=>[p(c,{onClose:t[5]||(t[5]=h=>e.messageDialog=!1)})]),_:1},8,["modelValue","width"]),p(u,{onOpenNotifications:t[7]||(t[7]=h=>e.messageDialog=!0)}),p(Jt,{modelValue:e.settingsDialog,"onUpdate:modelValue":t[9]||(t[9]=h=>e.settingsDialog=h),width:e.mobile?"100%":"50%"},{default:y(()=>[e.settingsDialog?(k(),U(d,{key:0,onClose:t[8]||(t[8]=h=>e.settingsDialog=!1)})):G("",!0)]),_:1},8,["modelValue","width"]),p(Jt,{modelValue:e.saveDialog,"onUpdate:modelValue":t[11]||(t[11]=h=>e.saveDialog=h),width:e.mobile?"100%":"30%"},{default:y(()=>[p(f,{onClose:t[10]||(t[10]=h=>e.saveDialog=!1)})]),_:1},8,["modelValue","width"])]),_:1}),p(m,{disabled:!v,color:"#000",opacity:.3,"z-index":2e3,class:"text-center"},{default:y(()=>[I("div",z3,[I("div",j3,[p(Z,{size:"4.75rem"},{default:y(()=>[$("mdi-download")]),_:1}),H3])])]),_:2},1032,["disabled","opacity"])]),_:1},8,["onDropFiles"])}const K3=H(P3,[["render",G3],["__scopeId","data-v-6431d185"]]);function mo(e){return e.replace(/\//g,"_")}function za(e){return new File([e],mo(e.name))}class lr{constructor(){this.webWorker=null,this.initializeCheck=null}async runTask(t,n,o,a){return Ga(this.webWorker,t,n,a,o,Ut("/","/itk/pipelines"),Ut("/","/itk/pipeline.worker.js"))}async initialize(){return this.initializeCheck||(this.initializeCheck=new Promise((t,n)=>{this.runTask("dicom",[],[],[]).then(o=>{o.webWorker?this.webWorker=o.webWorker:n(new Error("Could not initialize webworker"))}).then(async()=>{try{await ca(this.webWorker,new File([],""),null)}catch{}t()}).catch(n)})),this.initializeCheck}async categorizeFiles(t){await this.initialize();const n=await Promise.all(t.map(async(l,c)=>{const u=await l.arrayBuffer();return{type:ct.BinaryFile,data:{path:c.toString(),data:new Uint8Array(u)}}})),o=["--action","categorize","--memory-io","0","--files",...n.map(l=>l.data.path)],a=[{type:ct.TextStream}],r=await this.runTask("dicom",o,n,a),s=JSON.parse(r.outputs[0].data.data);return Object.fromEntries(Object.entries(s).map(([l,c])=>[l,c.map(u=>t[parseInt(u,10)])]))}async readTags(t,n){const o=n.map(s=>s.tag),r=(await ca(this.webWorker,za(t),o)).tags;return n.reduce((s,i)=>{const{tag:l,name:c}=i;return r.has(l)?{...s,[c]:r.get(l)}:s},{})}async getVolumeSlice(t,n=!1){await this.initialize();const o=await t.arrayBuffer(),a=[{type:ct.BinaryFile,data:{path:mo(t.name),data:new Uint8Array(o)}}],r=["--action","getSliceImage","--thumbnail",n.toString(),"--file",mo(t.name),"--memory-io","0"],s=[{type:ct.Image}];return(await this.runTask("dicom",r,a,s)).outputs[0].data}async resample(t,n){await this.initialize();const{size:o,spacing:a,origin:r,direction:s}=t,i=["--action","resample","0","--size",o.join(","),"--spacing",a.join(","),"--origin",r.join(","),"--direction",s.join(","),"--memory-io","0"],l=[{type:ct.Image,data:n}],c=[{type:ct.Image}];return(await this.runTask("dicom",i,l,c)).outputs[0].data}async buildImage(t){return await this.initialize(),(await ll(t.map(o=>za(o)))).image}}const q3=Array.from(new Set(Array.from(cl.keys()).map(e=>sn[e.toLowerCase()])));Cs.setReadImageArrayBufferFromITK(ul);async function Z3(e){const t=await Vu(e),n=Cs.newInstance();n.setFileName(e.name);try{await n.parseAsArrayBuffer(t)}catch{throw new Error("Failed to parse file")}return n.getOutputData()}function Q3(e){e.set("application/vnd.unknown.vti",ei),e.set("application/vnd.unknown.vtp",Qu),e.set("model/stl",Zu),q3.forEach(t=>{e.set(t,Z3)})}function cr(e,t){const n=A.debounce(t.renderWindow.render,5);e.resize=()=>{if(t.container){const s=t.container.getBoundingClientRect();if(s.width===s.height&&s.width===0)return;const i=window.devicePixelRatio||1,l=Math.max(10,Math.floor(i*s.width)),c=Math.max(10,Math.floor(i*s.height));t.renderWindow.getViews()[0].setSize(l,c),e.invokeResize({width:l,height:c}),e.render(!0)}},e.render=(s=!0)=>{t.orientationWidget.updateMarkerOrientation(),s?t.renderWindow.render():n()};let o=null;e.renderLater=()=>{o==null&&(o=setTimeout(()=>{e.render(),o=null},0))},e.removeAllRepresentations=()=>{t.representations.forEach(s=>t.renderer.removeViewProp(s)),t.representations.length=0},e.updateCamera=(s,i,l)=>{const c=Ka(l);Ya(c,c,s),t.camera.setFocalPoint(...l),t.camera.setPosition(...c),t.camera.setDirectionOfProjection(...s),t.camera.setViewUp(...i)};const{setContainer:a}=e;e.setContainer=s=>{a(s),t.cornerAnnotation.setContainer(null)};const{resetCamera:r}=e;e.resetCamera=(...s)=>{r(s),t.renderer.updateLightsGeometryToFollowCamera()}}function J3(e,t){t.classHierarchy.push("vtkLPSView3DProxy"),cr(e,t)}function ur(e,t,n={}){Object.assign(t,n),ql.extend(e,t,n),J3(e,t)}const Y3=A.newInstance(ur,"vtkLPSView3DProxy"),X3={newInstance:Y3,extend:ur};function eh(e,t){t.classHierarchy.push("vtkLPSView2DProxy");const n={...e};cr(e,t),e.bindRepresentationToManipulator=()=>{},e.resetCamera=(o=null)=>{t.renderer.resetCamera(o)},e.addRepresentation=o=>{o&&(t.representations.indexOf(o)===-1&&(t.representations.push(o),t.renderer.addViewProp(o)),o.setSlicingMode&&t.slicingMode&&o.setSlicingMode(t.slicingMode))},e.setSlicingMode=o=>{if(t.axis="IJK".indexOf(o),n.setSlicingMode(o)&&o){let a=t.representations.length;for(;a--;){const r=t.representations[a];r.setSlicingMode&&r.setSlicingMode(o)}}},e.resizeToFit=(o,a,r)=>{const[s,i]=t.renderWindow.getViews()[0].getSize();let l,c;o===0&&a===1?[,c,l]=r:o===0&&a===2?[,l,c]=r:o===1&&a===0?[c,,l]=r:o===1&&a===2?[l,,c]=r:o===2&&a===0?[c,l]=r:o===2&&a===1&&([l,c]=r);const u=s/i,d=l/c;let f=0;u>=d?f=c/2:f=l/2/u,t.camera.setParallelScale(f)}}const th={slicingMode:null};function dr(e,t,n={}){Object.assign(t,n,th),A.setGet(e,t,["slicingMode"]),Zl.extend(e,t,n),eh(e,t)}const nh=A.newInstance(dr,"vtkLPSView2DProxy"),oh={newInstance:nh,extend:dr},ah={X:"I",Y:"J",Z:"K",I:"I",J:"J",K:"K"};function sh(e,t){t.classHierarchy.push("vtkIJKSliceRepresentationProxy");const n={...e};e.setSlicingMode=o=>n.setSlicingMode(ah[o])}const ih={};function fr(e,t,n={}){Object.assign(t,ih,n),Ql.extend(e,t),A.proxyPropertyMapping(e,t,{opacity:{modelKey:"property",property:"opacity"}}),sh(e,t)}const rh=A.newInstance(fr,"vtkIJKSliceRepresentationProxy"),pr={newInstance:rh,extend:fr},{InterpolationType:lh}=Jl;function ch(e,t){t.classHierarchy.push("vtkLabelMapSliceRepProxy");let n=null;t.property.setUseLookupTableScalarRange(!0),t.property.setInterpolationType(lh.NEAREST),t.mapper.setRelativeCoincidentTopologyPolygonOffsetParameters(-2,-2);let o=null;function a(s){const i=s.getColorMap();if(i===o)return;o=i;const l=Yl.newInstance(),c=Xl.newInstance();Object.keys(i).forEach(u=>{const d=Number(u);l.addRGBPoint(d,...i[u].slice(0,3).map(f=>f/255)),c.addPoint(d,i[u][3]/255)}),t.property.setRGBTransferFunction(l),t.property.setScalarOpacity(c)}function r(s){n&&(n.unsubscribe(),n=null),s&&(n=s.onModified(()=>a(s)),a(s))}e.setColorBy=()=>{},e.delete=A.chain(e.delete,()=>{n&&(n.unsubscribe(),n=null)}),t.sourceDependencies.push({setInputData:r})}const uh={};function gr(e,t,n={}){Object.assign(t,uh,n),pr.extend(e,t),ch(e,t)}const dh=A.newInstance(gr,"vtkLabelMapSliceRepProxy"),fh={newInstance:dh,extend:gr};function lt(e,t=[],n=[],o={},a={}){return{class:e,options:{links:n,ui:t,...o},props:a}}function ja(e,t=[],n={}){return lt(e,[],[],t,n)}const ph={definitions:{Proxy:{LookupTable:lt(ec,[],[],{presetName:"Default (Cool to Warm)"}),PiecewiseFunction:lt(Te)},Sources:{TrivialProducer:lt(tc)},Representations:{ImageSlice:lt(pr),LabelMapSlice:lt(fh),Volume:lt(nc),Geometry:lt(oc)},Views:{View3D:ja(X3),View2D:ja(oh)}},representations:{View3D:{vtkImageData:{name:"Volume"},vtkPolyData:{name:"Geometry"}},View2D:{vtkImageData:{name:"ImageSlice"},vtkLabelMap:{name:"LabelMapSlice"}}}};function gh({stencil:e,location:t,slicingIndex:n,indexToWorld:o}){const[a,r]=e.size,s=Math.floor((a-1)/2),i=Math.floor((r-1)/2),l=a+1,c=r+1,u=[],d=[],f={},m=(v,h)=>{const w=`${v},${h}`;if(w in f)return f[w];const D=[...t].map(V=>Math.round(V));n===0?(D[1]+=v-s-.5,D[2]+=h-i-.5):n===1?(D[0]+=v-s-.5,D[2]+=h-i-.5):n===2&&(D[0]+=v-s-.5,D[1]+=h-i-.5);const b=[];Se(b,D,o),u.push(b);const S=u.length-1;return f[w]=S,S},g=(v,h)=>v<0||v>=a||h<0||h>=r?0:e.pixels[h*a+v]||0;for(let v=0;v<c;v++)for(let h=0;h<l;h++){const w=g(h,v)+g(h-1,v)+g(h,v-1)+g(h-1,v-1);if(w>0&&w<4){const D=m(h,v);if(g(h,v)!==g(h,v-1)){const b=m(h+1,v);d.push([D,b])}if(g(h,v)!==g(h-1,v)){const b=m(h,v+1);d.push([D,b])}}}return{points:new Float32Array(u.flat()),lines:new Uint16Array(d.map(([v,h])=>[2,v,h]).flat())}}function mh(e,t){t.classHierarchy.push("vtkPaintBrushContextRepresentation"),t.internalPolyData=mt.newInstance({mtime:0}),t.internalArrays={points:t.internalPolyData.getPoints(),lines:t.internalPolyData.getLines()},t.pipelines={brush:{source:e,mapper:sc.newInstance({transformCoordinate:ic.newInstance({coordinateSystem:rc.WORLD})}),actor:lc.newInstance({pickable:!1,parentProp:e})}};const n=t.pipelines.brush.actor.getProperty();n.setLineWidth(2),n.setColor([1,0,0]),n.setDisplayLocation(cc.FOREGROUND),n.setRepresentation(uc.SURFACE),So.connectPipeline(t.pipelines.brush),e.addActor(t.pipelines.brush.actor),e.requestData=(o,a)=>{const r=o[0],s=r.getStencil(),i=r.getBrush(),{indexToWorld:l,worldToIndex:c}=t;if(s&&i.getOrigin()){const u=[];Se(u,i.getOrigin(),c);const d=gh({stencil:s,location:u,slicingIndex:t.slicingIndex,indexToWorld:l}),{points:f,lines:m}=t.internalArrays;f.setData(d.points),m.setData(d.lines),t.internalPolyData.modified()}a[0]=t.internalPolyData}}const vh={defaultScale:1,drawBorder:!1,drawFace:!0,worldToIndex:null,indexToWorld:null,slicingIndex:0};function mr(e,t,n={}){Object.assign(t,vh,n),ac.extend(e,t,n),A.setGet(e,t,["slicingIndex","indexToWorld","worldToIndex"]),A.get(e,t,["mapper","actor"]),mh(e,t)}const hh=A.newInstance(mr,"vtkPaintBrushContextRepresentation"),yh={newInstance:hh,extend:mr};function co(e){return e.altKey||e.controlKey||e.shiftKey}function wh(e,t){t.classHierarchy.push("vtkPaintWidgetProp"),A.setGet(e,t,["manipulator"]);let n=!1;e.handleLeftButtonPress=o=>{if(!t.manipulator||co(o))return A.VOID;const a=t.manipulator.handleEvent(o,t._apiSpecificRenderWindow);return a?(t.widgetState.getBrush().setOrigin(...a),n=!0,e.invokeStartInteractionEvent(),A.EVENT_ABORT):A.VOID},e.handleMouseMove=o=>{if(co(o))return A.VOID;const a=t.manipulator.handleEvent(o,t._apiSpecificRenderWindow);return a?(t.widgetState.getBrush().setOrigin(...a),n&&e.invokeInteractionEvent(),A.EVENT_ABORT):A.VOID},e.handleLeftButtonRelease=o=>!n||co(o)?A.VOID:(n=!1,e.invokeEndInteractionEvent(),A.EVENT_ABORT),e.handleMouseWheel=()=>n?A.EVENT_ABORT:A.VOID,e.grabFocus=()=>{t.hasFocus||(t.hasFocus=!0,t._interactor.requestAnimation(e))},e.loseFocus=()=>{t.hasFocus&&t._interactor.cancelAnimation(e),t.hasFocus=!1}}function Ch(){return fs.createBuilder().addStateFromMixin({labels:["brush"],name:"brush",mixins:["origin","scale1","visible","color"],initialValues:{scale1:1,origin:null,visible:!0}}).addField({name:"stencil",initialValue:null}).build()}function Sh(e,t){t.classHierarchy.push("vtkPaintWidget"),t.methodsToLink=["slicingIndex","indexToWorld","worldToIndex"],e.getRepresentationsForViewType=()=>[{builder:yh,labels:["brush"]}],t.manipulator=st.newInstance()}const _h={};function vr(e,t,n={}){Object.assign(t,_h,n),On.extend(e,t,{...n,behavior:wh,widgetState:Ch()}),A.get(e,t,["manipulator"]),Sh(e,t)}const bh=A.newInstance(vr,"vtkPaintWidget"),Ih={newInstance:bh,extend:vr};function Dh(e,t){const n=new Uint8Array(e*t),o=(h,w)=>{n[h+w*e]=1},a=(h,w,D)=>{const b=D*e+h,S=b+(w-h+1);n.fill(1,b,S)};let r=0,s=0,i=e-1,l=t-1,c=i,u=l;const d=u&1;let f=4*(1-c)*u*u,m=4*(d+1)*c*c,g=f+m+d*c*c,v=0;s+=Math.floor((u+1)/2),l=s-d,c*=8*c,u*=8*u;do a(r,i,s),a(r,i,l),v=2*g,v<=m&&(s++,l--,m+=c,g+=m),(v>=f||2*g>m)&&(r++,i--,f+=u,g+=f);while(r<=i);for(;s-l<t;)o(r-1,s),o(i+1,s++),o(r-1,l),o(i+1,l--);return n}class Ah{constructor(){this.size=1,this.scale=[1,1],this.recomputeStencil()}setSize(t){this.size=Math.max(0,t),this.recomputeStencil()}setScale(t){this.scale=t,this.recomputeStencil()}recomputeStencil(){const t=[Math.ceil(this.size*this.scale[0]),Math.ceil(this.size*this.scale[1])];this.cachedStencil={size:t,pixels:Dh(t[0],t[1])}}getStencil(){return this.cachedStencil}}class Th{constructor(){this.factory=Ih.newInstance(),this.brush=new Ah,this.brushValue=1}updateWidgetStencil(){const t=this.brush.getStencil();this.factory.getWidgetState().setStencil(t)}setBrushSize(t){this.brush.setSize(t),this.updateWidgetStencil()}setBrushScale(t){this.brush.setScale(t),this.updateWidgetStencil()}setBrushValue(t){this.brushValue=t}paintLabelmap(t,n,o,a){const r=this.brush.getStencil(),s=[...o.map(C=>Math.round(C))],i=s[n];s.splice(n,1);let l=[...s];a&&(l=[...a.map(C=>Math.round(C))],l.splice(n,1));const c=t.getPointData().getScalars().getData(),u=t.getDimensions(),d=u[0],f=u[0]*u[1],m=C=>C[0]>=0&&C[1]>=0&&C[2]>=0&&C[0]<u[0]&&C[1]<u[1]&&C[2]<u[2],{pixels:g,size:v}=r,h=Math.floor((v[0]-1)/2),w=Math.floor((v[1]-1)/2),D=[...s],b=[...l],S=[0,0,0],V=[0,0];for(let C=0;C<v[1];C++){const R=C-w,E=C*v[0];for(let P=0;P<v[0];P++){const N=P-h,q=E+P;if(g[q]){D[0]=s[0]+N,D[1]=s[1]+R,b[0]=l[0]+N,b[1]=l[1]+R;const L=b[0]-D[0],W=b[1]-D[1];let Q=Math.abs(Math.abs(L)>Math.abs(W)?L:W);const fe=L/Q,ve=W/Q;for([V[0],V[1]]=D;Q-->=0;){if(V.splice(n,0,i),S[0]=Math.round(V[0]),S[1]=Math.round(V[1]),S[2]=Math.round(V[2]),m(S)){const ze=S[0]+S[1]*d+S[2]*f;c[ze]=this.brushValue}V.splice(n,1),V[0]+=fe,V[1]+=ve}}}}t.modified()}}function kh({paint:e,proxies:t,dicomIO:n}={}){const o={$paint:e??new Th,$proxies:t,$dicomIO:n??new lr};return()=>o}function Eh(){const{exitPointerLock:e}=document;document.exitPointerLock=()=>{try{e==null||e.call(document)}catch{}}}Eh();pn.setResolveCoincidentTopologyToPolygonOffset();pn.setResolveCoincidentTopologyPolygonOffsetParameters(-3,-3);pn.setResolveCoincidentTopologyLineOffsetParameters(-3,-3);Ss.setResolveCoincidentTopologyToPolygonOffset();Ss.setResolveCoincidentTopologyPolygonOffsetParameters(1,1);Q3(fo);const hr=dc.newInstance({proxyConfiguration:ph}),yr=new lr;yr.initialize();const wr=dl();wr.use(kh({proxies:new X0(hr),dicomIO:yr}));const Kt=fl(K3);s3(Kt);Kt.provide("ProxyManager",hr);Kt.use(wr);Kt.use(pl);Kt.use(El);Kt.mount("#app");
//# sourceMappingURL=index-20f7b5ee.js.map
